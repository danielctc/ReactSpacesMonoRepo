function nye(n,e){for(var i=0;i<e.length;i++){const a=e[i];if(typeof a!="string"&&!Array.isArray(a)){for(const l in a)if(l!=="default"&&!(l in n)){const d=Object.getOwnPropertyDescriptor(a,l);d&&Object.defineProperty(n,l,d.get?d:{enumerable:!0,get:()=>a[l]})}}}return Object.freeze(Object.defineProperty(n,Symbol.toStringTag,{value:"Module"}))}var my=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function I0(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}var WM={exports:{}},iw={},zM={exports:{}},pr={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var j$;function rye(){if(j$)return pr;j$=1;var n=Symbol.for("react.element"),e=Symbol.for("react.portal"),i=Symbol.for("react.fragment"),a=Symbol.for("react.strict_mode"),l=Symbol.for("react.profiler"),d=Symbol.for("react.provider"),p=Symbol.for("react.context"),y=Symbol.for("react.forward_ref"),v=Symbol.for("react.suspense"),b=Symbol.for("react.memo"),w=Symbol.for("react.lazy"),A=Symbol.iterator;function N(Te){return Te===null||typeof Te!="object"?null:(Te=A&&Te[A]||Te["@@iterator"],typeof Te=="function"?Te:null)}var V={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},j=Object.assign,B={};function G(Te,be,Ae){this.props=Te,this.context=be,this.refs=B,this.updater=Ae||V}G.prototype.isReactComponent={},G.prototype.setState=function(Te,be){if(typeof Te!="object"&&typeof Te!="function"&&Te!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,Te,be,"setState")},G.prototype.forceUpdate=function(Te){this.updater.enqueueForceUpdate(this,Te,"forceUpdate")};function ee(){}ee.prototype=G.prototype;function K(Te,be,Ae){this.props=Te,this.context=be,this.refs=B,this.updater=Ae||V}var ne=K.prototype=new ee;ne.constructor=K,j(ne,G.prototype),ne.isPureReactComponent=!0;var ce=Array.isArray,oe=Object.prototype.hasOwnProperty,ge={current:null},te={key:!0,ref:!0,__self:!0,__source:!0};function Z(Te,be,Ae){var Ue,ze={},et=null,nt=null;if(be!=null)for(Ue in be.ref!==void 0&&(nt=be.ref),be.key!==void 0&&(et=""+be.key),be)oe.call(be,Ue)&&!te.hasOwnProperty(Ue)&&(ze[Ue]=be[Ue]);var dt=arguments.length-2;if(dt===1)ze.children=Ae;else if(1<dt){for(var Xe=Array(dt),It=0;It<dt;It++)Xe[It]=arguments[It+2];ze.children=Xe}if(Te&&Te.defaultProps)for(Ue in dt=Te.defaultProps,dt)ze[Ue]===void 0&&(ze[Ue]=dt[Ue]);return{$$typeof:n,type:Te,key:et,ref:nt,props:ze,_owner:ge.current}}function J(Te,be){return{$$typeof:n,type:Te.type,key:be,ref:Te.ref,props:Te.props,_owner:Te._owner}}function se(Te){return typeof Te=="object"&&Te!==null&&Te.$$typeof===n}function he(Te){var be={"=":"=0",":":"=2"};return"$"+Te.replace(/[=:]/g,function(Ae){return be[Ae]})}var fe=/\/+/g;function ue(Te,be){return typeof Te=="object"&&Te!==null&&Te.key!=null?he(""+Te.key):be.toString(36)}function Me(Te,be,Ae,Ue,ze){var et=typeof Te;(et==="undefined"||et==="boolean")&&(Te=null);var nt=!1;if(Te===null)nt=!0;else switch(et){case"string":case"number":nt=!0;break;case"object":switch(Te.$$typeof){case n:case e:nt=!0}}if(nt)return nt=Te,ze=ze(nt),Te=Ue===""?"."+ue(nt,0):Ue,ce(ze)?(Ae="",Te!=null&&(Ae=Te.replace(fe,"$&/")+"/"),Me(ze,be,Ae,"",function(It){return It})):ze!=null&&(se(ze)&&(ze=J(ze,Ae+(!ze.key||nt&&nt.key===ze.key?"":(""+ze.key).replace(fe,"$&/")+"/")+Te)),be.push(ze)),1;if(nt=0,Ue=Ue===""?".":Ue+":",ce(Te))for(var dt=0;dt<Te.length;dt++){et=Te[dt];var Xe=Ue+ue(et,dt);nt+=Me(et,be,Ae,Xe,ze)}else if(Xe=N(Te),typeof Xe=="function")for(Te=Xe.call(Te),dt=0;!(et=Te.next()).done;)et=et.value,Xe=Ue+ue(et,dt++),nt+=Me(et,be,Ae,Xe,ze);else if(et==="object")throw be=String(Te),Error("Objects are not valid as a React child (found: "+(be==="[object Object]"?"object with keys {"+Object.keys(Te).join(", ")+"}":be)+"). If you meant to render a collection of children, use an array instead.");return nt}function He(Te,be,Ae){if(Te==null)return Te;var Ue=[],ze=0;return Me(Te,Ue,"","",function(et){return be.call(Ae,et,ze++)}),Ue}function rt(Te){if(Te._status===-1){var be=Te._result;be=be(),be.then(function(Ae){(Te._status===0||Te._status===-1)&&(Te._status=1,Te._result=Ae)},function(Ae){(Te._status===0||Te._status===-1)&&(Te._status=2,Te._result=Ae)}),Te._status===-1&&(Te._status=0,Te._result=be)}if(Te._status===1)return Te._result.default;throw Te._result}var we={current:null},Ce={transition:null},ve={ReactCurrentDispatcher:we,ReactCurrentBatchConfig:Ce,ReactCurrentOwner:ge};function Ne(){throw Error("act(...) is not supported in production builds of React.")}return pr.Children={map:He,forEach:function(Te,be,Ae){He(Te,function(){be.apply(this,arguments)},Ae)},count:function(Te){var be=0;return He(Te,function(){be++}),be},toArray:function(Te){return He(Te,function(be){return be})||[]},only:function(Te){if(!se(Te))throw Error("React.Children.only expected to receive a single React element child.");return Te}},pr.Component=G,pr.Fragment=i,pr.Profiler=l,pr.PureComponent=K,pr.StrictMode=a,pr.Suspense=v,pr.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=ve,pr.act=Ne,pr.cloneElement=function(Te,be,Ae){if(Te==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+Te+".");var Ue=j({},Te.props),ze=Te.key,et=Te.ref,nt=Te._owner;if(be!=null){if(be.ref!==void 0&&(et=be.ref,nt=ge.current),be.key!==void 0&&(ze=""+be.key),Te.type&&Te.type.defaultProps)var dt=Te.type.defaultProps;for(Xe in be)oe.call(be,Xe)&&!te.hasOwnProperty(Xe)&&(Ue[Xe]=be[Xe]===void 0&&dt!==void 0?dt[Xe]:be[Xe])}var Xe=arguments.length-2;if(Xe===1)Ue.children=Ae;else if(1<Xe){dt=Array(Xe);for(var It=0;It<Xe;It++)dt[It]=arguments[It+2];Ue.children=dt}return{$$typeof:n,type:Te.type,key:ze,ref:et,props:Ue,_owner:nt}},pr.createContext=function(Te){return Te={$$typeof:p,_currentValue:Te,_currentValue2:Te,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},Te.Provider={$$typeof:d,_context:Te},Te.Consumer=Te},pr.createElement=Z,pr.createFactory=function(Te){var be=Z.bind(null,Te);return be.type=Te,be},pr.createRef=function(){return{current:null}},pr.forwardRef=function(Te){return{$$typeof:y,render:Te}},pr.isValidElement=se,pr.lazy=function(Te){return{$$typeof:w,_payload:{_status:-1,_result:Te},_init:rt}},pr.memo=function(Te,be){return{$$typeof:b,type:Te,compare:be===void 0?null:be}},pr.startTransition=function(Te){var be=Ce.transition;Ce.transition={};try{Te()}finally{Ce.transition=be}},pr.unstable_act=Ne,pr.useCallback=function(Te,be){return we.current.useCallback(Te,be)},pr.useContext=function(Te){return we.current.useContext(Te)},pr.useDebugValue=function(){},pr.useDeferredValue=function(Te){return we.current.useDeferredValue(Te)},pr.useEffect=function(Te,be){return we.current.useEffect(Te,be)},pr.useId=function(){return we.current.useId()},pr.useImperativeHandle=function(Te,be,Ae){return we.current.useImperativeHandle(Te,be,Ae)},pr.useInsertionEffect=function(Te,be){return we.current.useInsertionEffect(Te,be)},pr.useLayoutEffect=function(Te,be){return we.current.useLayoutEffect(Te,be)},pr.useMemo=function(Te,be){return we.current.useMemo(Te,be)},pr.useReducer=function(Te,be,Ae){return we.current.useReducer(Te,be,Ae)},pr.useRef=function(Te){return we.current.useRef(Te)},pr.useState=function(Te){return we.current.useState(Te)},pr.useSyncExternalStore=function(Te,be,Ae){return we.current.useSyncExternalStore(Te,be,Ae)},pr.useTransition=function(){return we.current.useTransition()},pr.version="18.3.1",pr}var B$;function Ou(){return B$||(B$=1,zM.exports=rye()),zM.exports}/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var W$;function iye(){if(W$)return iw;W$=1;var n=Ou(),e=Symbol.for("react.element"),i=Symbol.for("react.fragment"),a=Object.prototype.hasOwnProperty,l=n.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,d={key:!0,ref:!0,__self:!0,__source:!0};function p(y,v,b){var w,A={},N=null,V=null;b!==void 0&&(N=""+b),v.key!==void 0&&(N=""+v.key),v.ref!==void 0&&(V=v.ref);for(w in v)a.call(v,w)&&!d.hasOwnProperty(w)&&(A[w]=v[w]);if(y&&y.defaultProps)for(w in v=y.defaultProps,v)A[w]===void 0&&(A[w]=v[w]);return{$$typeof:e,type:y,key:N,ref:V,props:A,_owner:l.current}}return iw.Fragment=i,iw.jsx=p,iw.jsxs=p,iw}var z$;function sye(){return z$||(z$=1,WM.exports=iye()),WM.exports}var C=sye(),D=Ou();const ri=I0(D),G$=nye({__proto__:null,default:ri},[D]);var oO={},GM={exports:{}},zc={},HM={exports:{}},$M={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var H$;function oye(){return H$||(H$=1,function(n){function e(Ce,ve){var Ne=Ce.length;Ce.push(ve);e:for(;0<Ne;){var Te=Ne-1>>>1,be=Ce[Te];if(0<l(be,ve))Ce[Te]=ve,Ce[Ne]=be,Ne=Te;else break e}}function i(Ce){return Ce.length===0?null:Ce[0]}function a(Ce){if(Ce.length===0)return null;var ve=Ce[0],Ne=Ce.pop();if(Ne!==ve){Ce[0]=Ne;e:for(var Te=0,be=Ce.length,Ae=be>>>1;Te<Ae;){var Ue=2*(Te+1)-1,ze=Ce[Ue],et=Ue+1,nt=Ce[et];if(0>l(ze,Ne))et<be&&0>l(nt,ze)?(Ce[Te]=nt,Ce[et]=Ne,Te=et):(Ce[Te]=ze,Ce[Ue]=Ne,Te=Ue);else if(et<be&&0>l(nt,Ne))Ce[Te]=nt,Ce[et]=Ne,Te=et;else break e}}return ve}function l(Ce,ve){var Ne=Ce.sortIndex-ve.sortIndex;return Ne!==0?Ne:Ce.id-ve.id}if(typeof performance=="object"&&typeof performance.now=="function"){var d=performance;n.unstable_now=function(){return d.now()}}else{var p=Date,y=p.now();n.unstable_now=function(){return p.now()-y}}var v=[],b=[],w=1,A=null,N=3,V=!1,j=!1,B=!1,G=typeof setTimeout=="function"?setTimeout:null,ee=typeof clearTimeout=="function"?clearTimeout:null,K=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function ne(Ce){for(var ve=i(b);ve!==null;){if(ve.callback===null)a(b);else if(ve.startTime<=Ce)a(b),ve.sortIndex=ve.expirationTime,e(v,ve);else break;ve=i(b)}}function ce(Ce){if(B=!1,ne(Ce),!j)if(i(v)!==null)j=!0,rt(oe);else{var ve=i(b);ve!==null&&we(ce,ve.startTime-Ce)}}function oe(Ce,ve){j=!1,B&&(B=!1,ee(Z),Z=-1),V=!0;var Ne=N;try{for(ne(ve),A=i(v);A!==null&&(!(A.expirationTime>ve)||Ce&&!he());){var Te=A.callback;if(typeof Te=="function"){A.callback=null,N=A.priorityLevel;var be=Te(A.expirationTime<=ve);ve=n.unstable_now(),typeof be=="function"?A.callback=be:A===i(v)&&a(v),ne(ve)}else a(v);A=i(v)}if(A!==null)var Ae=!0;else{var Ue=i(b);Ue!==null&&we(ce,Ue.startTime-ve),Ae=!1}return Ae}finally{A=null,N=Ne,V=!1}}var ge=!1,te=null,Z=-1,J=5,se=-1;function he(){return!(n.unstable_now()-se<J)}function fe(){if(te!==null){var Ce=n.unstable_now();se=Ce;var ve=!0;try{ve=te(!0,Ce)}finally{ve?ue():(ge=!1,te=null)}}else ge=!1}var ue;if(typeof K=="function")ue=function(){K(fe)};else if(typeof MessageChannel<"u"){var Me=new MessageChannel,He=Me.port2;Me.port1.onmessage=fe,ue=function(){He.postMessage(null)}}else ue=function(){G(fe,0)};function rt(Ce){te=Ce,ge||(ge=!0,ue())}function we(Ce,ve){Z=G(function(){Ce(n.unstable_now())},ve)}n.unstable_IdlePriority=5,n.unstable_ImmediatePriority=1,n.unstable_LowPriority=4,n.unstable_NormalPriority=3,n.unstable_Profiling=null,n.unstable_UserBlockingPriority=2,n.unstable_cancelCallback=function(Ce){Ce.callback=null},n.unstable_continueExecution=function(){j||V||(j=!0,rt(oe))},n.unstable_forceFrameRate=function(Ce){0>Ce||125<Ce?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):J=0<Ce?Math.floor(1e3/Ce):5},n.unstable_getCurrentPriorityLevel=function(){return N},n.unstable_getFirstCallbackNode=function(){return i(v)},n.unstable_next=function(Ce){switch(N){case 1:case 2:case 3:var ve=3;break;default:ve=N}var Ne=N;N=ve;try{return Ce()}finally{N=Ne}},n.unstable_pauseExecution=function(){},n.unstable_requestPaint=function(){},n.unstable_runWithPriority=function(Ce,ve){switch(Ce){case 1:case 2:case 3:case 4:case 5:break;default:Ce=3}var Ne=N;N=Ce;try{return ve()}finally{N=Ne}},n.unstable_scheduleCallback=function(Ce,ve,Ne){var Te=n.unstable_now();switch(typeof Ne=="object"&&Ne!==null?(Ne=Ne.delay,Ne=typeof Ne=="number"&&0<Ne?Te+Ne:Te):Ne=Te,Ce){case 1:var be=-1;break;case 2:be=250;break;case 5:be=1073741823;break;case 4:be=1e4;break;default:be=5e3}return be=Ne+be,Ce={id:w++,callback:ve,priorityLevel:Ce,startTime:Ne,expirationTime:be,sortIndex:-1},Ne>Te?(Ce.sortIndex=Ne,e(b,Ce),i(v)===null&&Ce===i(b)&&(B?(ee(Z),Z=-1):B=!0,we(ce,Ne-Te))):(Ce.sortIndex=be,e(v,Ce),j||V||(j=!0,rt(oe))),Ce},n.unstable_shouldYield=he,n.unstable_wrapCallback=function(Ce){var ve=N;return function(){var Ne=N;N=ve;try{return Ce.apply(this,arguments)}finally{N=Ne}}}}($M)),$M}var $$;function aye(){return $$||($$=1,HM.exports=oye()),HM.exports}/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var K$;function cye(){if(K$)return zc;K$=1;var n=Ou(),e=aye();function i(f){for(var g="https://reactjs.org/docs/error-decoder.html?invariant="+f,T=1;T<arguments.length;T++)g+="&args[]="+encodeURIComponent(arguments[T]);return"Minified React error #"+f+"; visit "+g+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var a=new Set,l={};function d(f,g){p(f,g),p(f+"Capture",g)}function p(f,g){for(l[f]=g,f=0;f<g.length;f++)a.add(g[f])}var y=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),v=Object.prototype.hasOwnProperty,b=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,w={},A={};function N(f){return v.call(A,f)?!0:v.call(w,f)?!1:b.test(f)?A[f]=!0:(w[f]=!0,!1)}function V(f,g,T,O){if(T!==null&&T.type===0)return!1;switch(typeof g){case"function":case"symbol":return!0;case"boolean":return O?!1:T!==null?!T.acceptsBooleans:(f=f.toLowerCase().slice(0,5),f!=="data-"&&f!=="aria-");default:return!1}}function j(f,g,T,O){if(g===null||typeof g>"u"||V(f,g,T,O))return!0;if(O)return!1;if(T!==null)switch(T.type){case 3:return!g;case 4:return g===!1;case 5:return isNaN(g);case 6:return isNaN(g)||1>g}return!1}function B(f,g,T,O,M,H,ae){this.acceptsBooleans=g===2||g===3||g===4,this.attributeName=O,this.attributeNamespace=M,this.mustUseProperty=T,this.propertyName=f,this.type=g,this.sanitizeURL=H,this.removeEmptyString=ae}var G={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(f){G[f]=new B(f,0,!1,f,null,!1,!1)}),[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(f){var g=f[0];G[g]=new B(g,1,!1,f[1],null,!1,!1)}),["contentEditable","draggable","spellCheck","value"].forEach(function(f){G[f]=new B(f,2,!1,f.toLowerCase(),null,!1,!1)}),["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(f){G[f]=new B(f,2,!1,f,null,!1,!1)}),"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(f){G[f]=new B(f,3,!1,f.toLowerCase(),null,!1,!1)}),["checked","multiple","muted","selected"].forEach(function(f){G[f]=new B(f,3,!0,f,null,!1,!1)}),["capture","download"].forEach(function(f){G[f]=new B(f,4,!1,f,null,!1,!1)}),["cols","rows","size","span"].forEach(function(f){G[f]=new B(f,6,!1,f,null,!1,!1)}),["rowSpan","start"].forEach(function(f){G[f]=new B(f,5,!1,f.toLowerCase(),null,!1,!1)});var ee=/[\-:]([a-z])/g;function K(f){return f[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(f){var g=f.replace(ee,K);G[g]=new B(g,1,!1,f,null,!1,!1)}),"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(f){var g=f.replace(ee,K);G[g]=new B(g,1,!1,f,"http://www.w3.org/1999/xlink",!1,!1)}),["xml:base","xml:lang","xml:space"].forEach(function(f){var g=f.replace(ee,K);G[g]=new B(g,1,!1,f,"http://www.w3.org/XML/1998/namespace",!1,!1)}),["tabIndex","crossOrigin"].forEach(function(f){G[f]=new B(f,1,!1,f.toLowerCase(),null,!1,!1)}),G.xlinkHref=new B("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1),["src","href","action","formAction"].forEach(function(f){G[f]=new B(f,1,!1,f.toLowerCase(),null,!0,!0)});function ne(f,g,T,O){var M=G.hasOwnProperty(g)?G[g]:null;(M!==null?M.type!==0:O||!(2<g.length)||g[0]!=="o"&&g[0]!=="O"||g[1]!=="n"&&g[1]!=="N")&&(j(g,T,M,O)&&(T=null),O||M===null?N(g)&&(T===null?f.removeAttribute(g):f.setAttribute(g,""+T)):M.mustUseProperty?f[M.propertyName]=T===null?M.type===3?!1:"":T:(g=M.attributeName,O=M.attributeNamespace,T===null?f.removeAttribute(g):(M=M.type,T=M===3||M===4&&T===!0?"":""+T,O?f.setAttributeNS(O,g,T):f.setAttribute(g,T))))}var ce=n.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,oe=Symbol.for("react.element"),ge=Symbol.for("react.portal"),te=Symbol.for("react.fragment"),Z=Symbol.for("react.strict_mode"),J=Symbol.for("react.profiler"),se=Symbol.for("react.provider"),he=Symbol.for("react.context"),fe=Symbol.for("react.forward_ref"),ue=Symbol.for("react.suspense"),Me=Symbol.for("react.suspense_list"),He=Symbol.for("react.memo"),rt=Symbol.for("react.lazy"),we=Symbol.for("react.offscreen"),Ce=Symbol.iterator;function ve(f){return f===null||typeof f!="object"?null:(f=Ce&&f[Ce]||f["@@iterator"],typeof f=="function"?f:null)}var Ne=Object.assign,Te;function be(f){if(Te===void 0)try{throw Error()}catch(T){var g=T.stack.trim().match(/\n( *(at )?)/);Te=g&&g[1]||""}return`
`+Te+f}var Ae=!1;function Ue(f,g){if(!f||Ae)return"";Ae=!0;var T=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(g)if(g=function(){throw Error()},Object.defineProperty(g.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(g,[])}catch(it){var O=it}Reflect.construct(f,[],g)}else{try{g.call()}catch(it){O=it}f.call(g.prototype)}else{try{throw Error()}catch(it){O=it}f()}}catch(it){if(it&&O&&typeof it.stack=="string"){for(var M=it.stack.split(`
`),H=O.stack.split(`
`),ae=M.length-1,Ie=H.length-1;1<=ae&&0<=Ie&&M[ae]!==H[Ie];)Ie--;for(;1<=ae&&0<=Ie;ae--,Ie--)if(M[ae]!==H[Ie]){if(ae!==1||Ie!==1)do if(ae--,Ie--,0>Ie||M[ae]!==H[Ie]){var xe=`
`+M[ae].replace(" at new "," at ");return f.displayName&&xe.includes("<anonymous>")&&(xe=xe.replace("<anonymous>",f.displayName)),xe}while(1<=ae&&0<=Ie);break}}}finally{Ae=!1,Error.prepareStackTrace=T}return(f=f?f.displayName||f.name:"")?be(f):""}function ze(f){switch(f.tag){case 5:return be(f.type);case 16:return be("Lazy");case 13:return be("Suspense");case 19:return be("SuspenseList");case 0:case 2:case 15:return f=Ue(f.type,!1),f;case 11:return f=Ue(f.type.render,!1),f;case 1:return f=Ue(f.type,!0),f;default:return""}}function et(f){if(f==null)return null;if(typeof f=="function")return f.displayName||f.name||null;if(typeof f=="string")return f;switch(f){case te:return"Fragment";case ge:return"Portal";case J:return"Profiler";case Z:return"StrictMode";case ue:return"Suspense";case Me:return"SuspenseList"}if(typeof f=="object")switch(f.$$typeof){case he:return(f.displayName||"Context")+".Consumer";case se:return(f._context.displayName||"Context")+".Provider";case fe:var g=f.render;return f=f.displayName,f||(f=g.displayName||g.name||"",f=f!==""?"ForwardRef("+f+")":"ForwardRef"),f;case He:return g=f.displayName||null,g!==null?g:et(f.type)||"Memo";case rt:g=f._payload,f=f._init;try{return et(f(g))}catch{}}return null}function nt(f){var g=f.type;switch(f.tag){case 24:return"Cache";case 9:return(g.displayName||"Context")+".Consumer";case 10:return(g._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return f=g.render,f=f.displayName||f.name||"",g.displayName||(f!==""?"ForwardRef("+f+")":"ForwardRef");case 7:return"Fragment";case 5:return g;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return et(g);case 8:return g===Z?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof g=="function")return g.displayName||g.name||null;if(typeof g=="string")return g}return null}function dt(f){switch(typeof f){case"boolean":case"number":case"string":case"undefined":return f;case"object":return f;default:return""}}function Xe(f){var g=f.type;return(f=f.nodeName)&&f.toLowerCase()==="input"&&(g==="checkbox"||g==="radio")}function It(f){var g=Xe(f)?"checked":"value",T=Object.getOwnPropertyDescriptor(f.constructor.prototype,g),O=""+f[g];if(!f.hasOwnProperty(g)&&typeof T<"u"&&typeof T.get=="function"&&typeof T.set=="function"){var M=T.get,H=T.set;return Object.defineProperty(f,g,{configurable:!0,get:function(){return M.call(this)},set:function(ae){O=""+ae,H.call(this,ae)}}),Object.defineProperty(f,g,{enumerable:T.enumerable}),{getValue:function(){return O},setValue:function(ae){O=""+ae},stopTracking:function(){f._valueTracker=null,delete f[g]}}}}function hn(f){f._valueTracker||(f._valueTracker=It(f))}function Ut(f){if(!f)return!1;var g=f._valueTracker;if(!g)return!0;var T=g.getValue(),O="";return f&&(O=Xe(f)?f.checked?"true":"false":f.value),f=O,f!==T?(g.setValue(f),!0):!1}function ln(f){if(f=f||(typeof document<"u"?document:void 0),typeof f>"u")return null;try{return f.activeElement||f.body}catch{return f.body}}function xn(f,g){var T=g.checked;return Ne({},g,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:T??f._wrapperState.initialChecked})}function Xt(f,g){var T=g.defaultValue==null?"":g.defaultValue,O=g.checked!=null?g.checked:g.defaultChecked;T=dt(g.value!=null?g.value:T),f._wrapperState={initialChecked:O,initialValue:T,controlled:g.type==="checkbox"||g.type==="radio"?g.checked!=null:g.value!=null}}function Yn(f,g){g=g.checked,g!=null&&ne(f,"checked",g,!1)}function qt(f,g){Yn(f,g);var T=dt(g.value),O=g.type;if(T!=null)O==="number"?(T===0&&f.value===""||f.value!=T)&&(f.value=""+T):f.value!==""+T&&(f.value=""+T);else if(O==="submit"||O==="reset"){f.removeAttribute("value");return}g.hasOwnProperty("value")?Fe(f,g.type,T):g.hasOwnProperty("defaultValue")&&Fe(f,g.type,dt(g.defaultValue)),g.checked==null&&g.defaultChecked!=null&&(f.defaultChecked=!!g.defaultChecked)}function Re(f,g,T){if(g.hasOwnProperty("value")||g.hasOwnProperty("defaultValue")){var O=g.type;if(!(O!=="submit"&&O!=="reset"||g.value!==void 0&&g.value!==null))return;g=""+f._wrapperState.initialValue,T||g===f.value||(f.value=g),f.defaultValue=g}T=f.name,T!==""&&(f.name=""),f.defaultChecked=!!f._wrapperState.initialChecked,T!==""&&(f.name=T)}function Fe(f,g,T){(g!=="number"||ln(f.ownerDocument)!==f)&&(T==null?f.defaultValue=""+f._wrapperState.initialValue:f.defaultValue!==""+T&&(f.defaultValue=""+T))}var Ke=Array.isArray;function Et(f,g,T,O){if(f=f.options,g){g={};for(var M=0;M<T.length;M++)g["$"+T[M]]=!0;for(T=0;T<f.length;T++)M=g.hasOwnProperty("$"+f[T].value),f[T].selected!==M&&(f[T].selected=M),M&&O&&(f[T].defaultSelected=!0)}else{for(T=""+dt(T),g=null,M=0;M<f.length;M++){if(f[M].value===T){f[M].selected=!0,O&&(f[M].defaultSelected=!0);return}g!==null||f[M].disabled||(g=f[M])}g!==null&&(g.selected=!0)}}function bt(f,g){if(g.dangerouslySetInnerHTML!=null)throw Error(i(91));return Ne({},g,{value:void 0,defaultValue:void 0,children:""+f._wrapperState.initialValue})}function Ge(f,g){var T=g.value;if(T==null){if(T=g.children,g=g.defaultValue,T!=null){if(g!=null)throw Error(i(92));if(Ke(T)){if(1<T.length)throw Error(i(93));T=T[0]}g=T}g==null&&(g=""),T=g}f._wrapperState={initialValue:dt(T)}}function Ot(f,g){var T=dt(g.value),O=dt(g.defaultValue);T!=null&&(T=""+T,T!==f.value&&(f.value=T),g.defaultValue==null&&f.defaultValue!==T&&(f.defaultValue=T)),O!=null&&(f.defaultValue=""+O)}function Jt(f){var g=f.textContent;g===f._wrapperState.initialValue&&g!==""&&g!==null&&(f.value=g)}function fn(f){switch(f){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function an(f,g){return f==null||f==="http://www.w3.org/1999/xhtml"?fn(g):f==="http://www.w3.org/2000/svg"&&g==="foreignObject"?"http://www.w3.org/1999/xhtml":f}var ir,la=function(f){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(g,T,O,M){MSApp.execUnsafeLocalFunction(function(){return f(g,T,O,M)})}:f}(function(f,g){if(f.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in f)f.innerHTML=g;else{for(ir=ir||document.createElement("div"),ir.innerHTML="<svg>"+g.valueOf().toString()+"</svg>",g=ir.firstChild;f.firstChild;)f.removeChild(f.firstChild);for(;g.firstChild;)f.appendChild(g.firstChild)}});function Vt(f,g){if(g){var T=f.firstChild;if(T&&T===f.lastChild&&T.nodeType===3){T.nodeValue=g;return}}f.textContent=g}var sn={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},ki=["Webkit","ms","Moz","O"];Object.keys(sn).forEach(function(f){ki.forEach(function(g){g=g+f.charAt(0).toUpperCase()+f.substring(1),sn[g]=sn[f]})});function _i(f,g,T){return g==null||typeof g=="boolean"||g===""?"":T||typeof g!="number"||g===0||sn.hasOwnProperty(f)&&sn[f]?(""+g).trim():g+"px"}function Ri(f,g){f=f.style;for(var T in g)if(g.hasOwnProperty(T)){var O=T.indexOf("--")===0,M=_i(T,g[T],O);T==="float"&&(T="cssFloat"),O?f.setProperty(T,M):f[T]=M}}var dr=Ne({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function Wa(f,g){if(g){if(dr[f]&&(g.children!=null||g.dangerouslySetInnerHTML!=null))throw Error(i(137,f));if(g.dangerouslySetInnerHTML!=null){if(g.children!=null)throw Error(i(60));if(typeof g.dangerouslySetInnerHTML!="object"||!("__html"in g.dangerouslySetInnerHTML))throw Error(i(61))}if(g.style!=null&&typeof g.style!="object")throw Error(i(62))}}function il(f,g){if(f.indexOf("-")===-1)return typeof g.is=="string";switch(f){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var uo=null;function ho(f){return f=f.target||f.srcElement||window,f.correspondingUseElement&&(f=f.correspondingUseElement),f.nodeType===3?f.parentNode:f}var Fl=null,js=null,uc=null;function ua(f){if(f=nm(f)){if(typeof Fl!="function")throw Error(i(280));var g=f.stateNode;g&&(g=rm(g),Fl(f.stateNode,f.type,g))}}function dc(f){js?uc?uc.push(f):uc=[f]:js=f}function sl(){if(js){var f=js,g=uc;if(uc=js=null,ua(f),g)for(f=0;f<g.length;f++)ua(g[f])}}function Mu(f,g){return f(g)}function hc(){}var ol=!1;function Ao(f,g,T){if(ol)return f(g,T);ol=!0;try{return Mu(f,g,T)}finally{ol=!1,(js!==null||uc!==null)&&(hc(),sl())}}function ji(f,g){var T=f.stateNode;if(T===null)return null;var O=rm(T);if(O===null)return null;T=O[g];e:switch(g){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(O=!O.disabled)||(f=f.type,O=!(f==="button"||f==="input"||f==="select"||f==="textarea")),f=!O;break e;default:f=!1}if(f)return null;if(T&&typeof T!="function")throw Error(i(231,g,typeof T));return T}var hs=!1;if(y)try{var za={};Object.defineProperty(za,"passive",{get:function(){hs=!0}}),window.addEventListener("test",za,za),window.removeEventListener("test",za,za)}catch{hs=!1}function Uu(f,g,T,O,M,H,ae,Ie,xe){var it=Array.prototype.slice.call(arguments,3);try{g.apply(T,it)}catch(At){this.onError(At)}}var fc=!1,da=null,ha=!1,Fd=null,Vg={onError:function(f){fc=!0,da=f}};function Vu(f,g,T,O,M,H,ae,Ie,xe){fc=!1,da=null,Uu.apply(Vg,arguments)}function hf(f,g,T,O,M,H,ae,Ie,xe){if(Vu.apply(this,arguments),fc){if(fc){var it=da;fc=!1,da=null}else throw Error(i(198));ha||(ha=!0,Fd=it)}}function Bs(f){var g=f,T=f;if(f.alternate)for(;g.return;)g=g.return;else{f=g;do g=f,(g.flags&4098)!==0&&(T=g.return),f=g.return;while(f)}return g.tag===3?T:null}function Fu(f){if(f.tag===13){var g=f.memoizedState;if(g===null&&(f=f.alternate,f!==null&&(g=f.memoizedState)),g!==null)return g.dehydrated}return null}function fa(f){if(Bs(f)!==f)throw Error(i(188))}function jd(f){var g=f.alternate;if(!g){if(g=Bs(f),g===null)throw Error(i(188));return g!==f?null:f}for(var T=f,O=g;;){var M=T.return;if(M===null)break;var H=M.alternate;if(H===null){if(O=M.return,O!==null){T=O;continue}break}if(M.child===H.child){for(H=M.child;H;){if(H===T)return fa(M),f;if(H===O)return fa(M),g;H=H.sibling}throw Error(i(188))}if(T.return!==O.return)T=M,O=H;else{for(var ae=!1,Ie=M.child;Ie;){if(Ie===T){ae=!0,T=M,O=H;break}if(Ie===O){ae=!0,O=M,T=H;break}Ie=Ie.sibling}if(!ae){for(Ie=H.child;Ie;){if(Ie===T){ae=!0,T=H,O=M;break}if(Ie===O){ae=!0,O=H,T=M;break}Ie=Ie.sibling}if(!ae)throw Error(i(189))}}if(T.alternate!==O)throw Error(i(190))}if(T.tag!==3)throw Error(i(188));return T.stateNode.current===T?f:g}function Bd(f){return f=jd(f),f!==null?Ga(f):null}function Ga(f){if(f.tag===5||f.tag===6)return f;for(f=f.child;f!==null;){var g=Ga(f);if(g!==null)return g;f=f.sibling}return null}var Wd=e.unstable_scheduleCallback,ju=e.unstable_cancelCallback,Po=e.unstable_shouldYield,zd=e.unstable_requestPaint,Fr=e.unstable_now,yi=e.unstable_getCurrentPriorityLevel,pc=e.unstable_ImmediatePriority,al=e.unstable_UserBlockingPriority,pa=e.unstable_NormalPriority,ff=e.unstable_LowPriority,Gd=e.unstable_IdlePriority,jl=null,fo=null;function Bp(f){if(fo&&typeof fo.onCommitFiberRoot=="function")try{fo.onCommitFiberRoot(jl,f,void 0,(f.current.flags&128)===128)}catch{}}var Xs=Math.clz32?Math.clz32:Hd,pf=Math.log,cl=Math.LN2;function Hd(f){return f>>>=0,f===0?32:31-(pf(f)/cl|0)|0}var $d=64,hr=4194304;function Bl(f){switch(f&-f){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return f&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return f&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return f}}function Wl(f,g){var T=f.pendingLanes;if(T===0)return 0;var O=0,M=f.suspendedLanes,H=f.pingedLanes,ae=T&268435455;if(ae!==0){var Ie=ae&~M;Ie!==0?O=Bl(Ie):(H&=ae,H!==0&&(O=Bl(H)))}else ae=T&~M,ae!==0?O=Bl(ae):H!==0&&(O=Bl(H));if(O===0)return 0;if(g!==0&&g!==O&&(g&M)===0&&(M=O&-O,H=g&-g,M>=H||M===16&&(H&4194240)!==0))return g;if((O&4)!==0&&(O|=T&16),g=f.entangledLanes,g!==0)for(f=f.entanglements,g&=O;0<g;)T=31-Xs(g),M=1<<T,O|=f[T],g&=~M;return O}function Bu(f,g){switch(f){case 1:case 2:case 4:return g+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return g+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function Ha(f,g){for(var T=f.suspendedLanes,O=f.pingedLanes,M=f.expirationTimes,H=f.pendingLanes;0<H;){var ae=31-Xs(H),Ie=1<<ae,xe=M[ae];xe===-1?((Ie&T)===0||(Ie&O)!==0)&&(M[ae]=Bu(Ie,g)):xe<=g&&(f.expiredLanes|=Ie),H&=~Ie}}function Oo(f){return f=f.pendingLanes&-1073741825,f!==0?f:f&1073741824?1073741824:0}function Wu(){var f=$d;return $d<<=1,($d&4194240)===0&&($d=64),f}function ll(f){for(var g=[],T=0;31>T;T++)g.push(f);return g}function zl(f,g,T){f.pendingLanes|=g,g!==536870912&&(f.suspendedLanes=0,f.pingedLanes=0),f=f.eventTimes,g=31-Xs(g),f[g]=T}function Gr(f,g){var T=f.pendingLanes&~g;f.pendingLanes=g,f.suspendedLanes=0,f.pingedLanes=0,f.expiredLanes&=g,f.mutableReadLanes&=g,f.entangledLanes&=g,g=f.entanglements;var O=f.eventTimes;for(f=f.expirationTimes;0<T;){var M=31-Xs(T),H=1<<M;g[M]=0,O[M]=-1,f[M]=-1,T&=~H}}function $a(f,g){var T=f.entangledLanes|=g;for(f=f.entanglements;T;){var O=31-Xs(T),M=1<<O;M&g|f[O]&g&&(f[O]|=g),T&=~M}}var nr=0;function mc(f){return f&=-f,1<f?4<f?(f&268435455)!==0?16:536870912:4:1}var Wp,Gl,Kd,mf,zp,gf=!1,ko=[],is=null,No=null,Do=null,Hl=new Map,Lo=new Map,xo=[],Gp="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function gc(f,g){switch(f){case"focusin":case"focusout":is=null;break;case"dragenter":case"dragleave":No=null;break;case"mouseover":case"mouseout":Do=null;break;case"pointerover":case"pointerout":Hl.delete(g.pointerId);break;case"gotpointercapture":case"lostpointercapture":Lo.delete(g.pointerId)}}function fs(f,g,T,O,M,H){return f===null||f.nativeEvent!==H?(f={blockedOn:g,domEventName:T,eventSystemFlags:O,nativeEvent:H,targetContainers:[M]},g!==null&&(g=nm(g),g!==null&&Gl(g)),f):(f.eventSystemFlags|=O,g=f.targetContainers,M!==null&&g.indexOf(M)===-1&&g.push(M),f)}function zu(f,g,T,O,M){switch(g){case"focusin":return is=fs(is,f,g,T,O,M),!0;case"dragenter":return No=fs(No,f,g,T,O,M),!0;case"mouseover":return Do=fs(Do,f,g,T,O,M),!0;case"pointerover":var H=M.pointerId;return Hl.set(H,fs(Hl.get(H)||null,f,g,T,O,M)),!0;case"gotpointercapture":return H=M.pointerId,Lo.set(H,fs(Lo.get(H)||null,f,g,T,O,M)),!0}return!1}function _f(f){var g=Rf(f.target);if(g!==null){var T=Bs(g);if(T!==null){if(g=T.tag,g===13){if(g=Fu(T),g!==null){f.blockedOn=g,zp(f.priority,function(){Kd(T)});return}}else if(g===3&&T.stateNode.current.memoizedState.isDehydrated){f.blockedOn=T.tag===3?T.stateNode.containerInfo:null;return}}}f.blockedOn=null}function ul(f){if(f.blockedOn!==null)return!1;for(var g=f.targetContainers;0<g.length;){var T=yr(f.domEventName,f.eventSystemFlags,g[0],f.nativeEvent);if(T===null){T=f.nativeEvent;var O=new T.constructor(T.type,T);uo=O,T.target.dispatchEvent(O),uo=null}else return g=nm(T),g!==null&&Gl(g),f.blockedOn=T,!1;g.shift()}return!0}function $l(f,g,T){ul(f)&&T.delete(g)}function Hp(){gf=!1,is!==null&&ul(is)&&(is=null),No!==null&&ul(No)&&(No=null),Do!==null&&ul(Do)&&(Do=null),Hl.forEach($l),Lo.forEach($l)}function ma(f,g){f.blockedOn===g&&(f.blockedOn=null,gf||(gf=!0,e.unstable_scheduleCallback(e.unstable_NormalPriority,Hp)))}function ga(f){function g(M){return ma(M,f)}if(0<ko.length){ma(ko[0],f);for(var T=1;T<ko.length;T++){var O=ko[T];O.blockedOn===f&&(O.blockedOn=null)}}for(is!==null&&ma(is,f),No!==null&&ma(No,f),Do!==null&&ma(Do,f),Hl.forEach(g),Lo.forEach(g),T=0;T<xo.length;T++)O=xo[T],O.blockedOn===f&&(O.blockedOn=null);for(;0<xo.length&&(T=xo[0],T.blockedOn===null);)_f(T),T.blockedOn===null&&xo.shift()}var dl=ce.ReactCurrentBatchConfig,Se=!0;function De(f,g,T,O){var M=nr,H=dl.transition;dl.transition=null;try{nr=1,Kt(f,g,T,O)}finally{nr=M,dl.transition=H}}function tt(f,g,T,O){var M=nr,H=dl.transition;dl.transition=null;try{nr=4,Kt(f,g,T,O)}finally{nr=M,dl.transition=H}}function Kt(f,g,T,O){if(Se){var M=yr(f,g,T,O);if(M===null)sE(f,g,O,Hn,T),gc(f,O);else if(zu(M,f,g,T,O))O.stopPropagation();else if(gc(f,O),g&4&&-1<Gp.indexOf(f)){for(;M!==null;){var H=nm(M);if(H!==null&&Wp(H),H=yr(f,g,T,O),H===null&&sE(f,g,O,Hn,T),H===M)break;M=H}M!==null&&O.stopPropagation()}else sE(f,g,O,null,T)}}var Hn=null;function yr(f,g,T,O){if(Hn=null,f=ho(O),f=Rf(f),f!==null)if(g=Bs(f),g===null)f=null;else if(T=g.tag,T===13){if(f=Fu(g),f!==null)return f;f=null}else if(T===3){if(g.stateNode.current.memoizedState.isDehydrated)return g.tag===3?g.stateNode.containerInfo:null;f=null}else g!==f&&(f=null);return Hn=f,null}function jr(f){switch(f){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(yi()){case pc:return 1;case al:return 4;case pa:case ff:return 16;case Gd:return 536870912;default:return 16}default:return 16}}var cn=null,Nr=null,Ei=null;function Os(){if(Ei)return Ei;var f,g=Nr,T=g.length,O,M="value"in cn?cn.value:cn.textContent,H=M.length;for(f=0;f<T&&g[f]===M[f];f++);var ae=T-f;for(O=1;O<=ae&&g[T-O]===M[H-O];O++);return Ei=M.slice(f,1<O?1-O:void 0)}function Mo(f){var g=f.keyCode;return"charCode"in f?(f=f.charCode,f===0&&g===13&&(f=13)):f=g,f===10&&(f=13),32<=f||f===13?f:0}function Uo(){return!0}function Gu(){return!1}function Ji(f){function g(T,O,M,H,ae){this._reactName=T,this._targetInst=M,this.type=O,this.nativeEvent=H,this.target=ae,this.currentTarget=null;for(var Ie in f)f.hasOwnProperty(Ie)&&(T=f[Ie],this[Ie]=T?T(H):H[Ie]);return this.isDefaultPrevented=(H.defaultPrevented!=null?H.defaultPrevented:H.returnValue===!1)?Uo:Gu,this.isPropagationStopped=Gu,this}return Ne(g.prototype,{preventDefault:function(){this.defaultPrevented=!0;var T=this.nativeEvent;T&&(T.preventDefault?T.preventDefault():typeof T.returnValue!="unknown"&&(T.returnValue=!1),this.isDefaultPrevented=Uo)},stopPropagation:function(){var T=this.nativeEvent;T&&(T.stopPropagation?T.stopPropagation():typeof T.cancelBubble!="unknown"&&(T.cancelBubble=!0),this.isPropagationStopped=Uo)},persist:function(){},isPersistent:Uo}),g}var hl={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(f){return f.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},qd=Ji(hl),_c=Ne({},hl,{view:0,detail:0}),Fg=Ji(_c),$p,Hu,Vo,Kl=Ne({},_c,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:yc,button:0,buttons:0,relatedTarget:function(f){return f.relatedTarget===void 0?f.fromElement===f.srcElement?f.toElement:f.fromElement:f.relatedTarget},movementX:function(f){return"movementX"in f?f.movementX:(f!==Vo&&(Vo&&f.type==="mousemove"?($p=f.screenX-Vo.screenX,Hu=f.screenY-Vo.screenY):Hu=$p=0,Vo=f),$p)},movementY:function(f){return"movementY"in f?f.movementY:Hu}}),Kp=Ji(Kl),jg=Ne({},Kl,{dataTransfer:0}),Jy=Ji(jg),qp=Ne({},_c,{relatedTarget:0}),Yp=Ji(qp),$u=Ne({},hl,{animationName:0,elapsedTime:0,pseudoElement:0}),Ku=Ji($u),qu=Ne({},hl,{clipboardData:function(f){return"clipboardData"in f?f.clipboardData:window.clipboardData}}),Bg=Ji(qu),Qy=Ne({},hl,{data:0}),Mn=Ji(Qy),Xp={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},Fo={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},Zy={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function eE(f){var g=this.nativeEvent;return g.getModifierState?g.getModifierState(f):(f=Zy[f])?!!g[f]:!1}function yc(){return eE}var I=Ne({},_c,{key:function(f){if(f.key){var g=Xp[f.key]||f.key;if(g!=="Unidentified")return g}return f.type==="keypress"?(f=Mo(f),f===13?"Enter":String.fromCharCode(f)):f.type==="keydown"||f.type==="keyup"?Fo[f.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:yc,charCode:function(f){return f.type==="keypress"?Mo(f):0},keyCode:function(f){return f.type==="keydown"||f.type==="keyup"?f.keyCode:0},which:function(f){return f.type==="keypress"?Mo(f):f.type==="keydown"||f.type==="keyup"?f.keyCode:0}}),W=Ji(I),Q=Ne({},Kl,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),pe=Ji(Q),qe=Ne({},_c,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:yc}),at=Ji(qe),xt=Ne({},hl,{propertyName:0,elapsedTime:0,pseudoElement:0}),Hr=Ji(xt),oi=Ne({},Kl,{deltaX:function(f){return"deltaX"in f?f.deltaX:"wheelDeltaX"in f?-f.wheelDeltaX:0},deltaY:function(f){return"deltaY"in f?f.deltaY:"wheelDeltaY"in f?-f.wheelDeltaY:"wheelDelta"in f?-f.wheelDelta:0},deltaZ:0,deltaMode:0}),Er=Ji(oi),Ws=[9,13,27,32],ps=y&&"CompositionEvent"in window,Ka=null;y&&"documentMode"in document&&(Ka=document.documentMode);var jo=y&&"TextEvent"in window&&!Ka,yf=y&&(!ps||Ka&&8<Ka&&11>=Ka),Jp=" ",qa=!1;function SC(f,g){switch(f){case"keyup":return Ws.indexOf(g.keyCode)!==-1;case"keydown":return g.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function bC(f){return f=f.detail,typeof f=="object"&&"data"in f?f.data:null}var Qp=!1;function _N(f,g){switch(f){case"compositionend":return bC(g);case"keypress":return g.which!==32?null:(qa=!0,Jp);case"textInput":return f=g.data,f===Jp&&qa?null:f;default:return null}}function TC(f,g){if(Qp)return f==="compositionend"||!ps&&SC(f,g)?(f=Os(),Ei=Nr=cn=null,Qp=!1,f):null;switch(f){case"paste":return null;case"keypress":if(!(g.ctrlKey||g.altKey||g.metaKey)||g.ctrlKey&&g.altKey){if(g.char&&1<g.char.length)return g.char;if(g.which)return String.fromCharCode(g.which)}return null;case"compositionend":return yf&&g.locale!=="ko"?null:g.data;default:return null}}var yN={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function wC(f){var g=f&&f.nodeName&&f.nodeName.toLowerCase();return g==="input"?!!yN[f.type]:g==="textarea"}function W0(f,g,T,O){dc(O),g=oE(g,"onChange"),0<g.length&&(T=new qd("onChange","change",null,T,O),f.push({event:T,listeners:g}))}var Ef=null,Wg=null;function EN(f){Y0(f,0)}function vf(f){var g=Cf(f);if(Ut(g))return f}function vN(f,g){if(f==="change")return g}var RC=!1;if(y){var z0;if(y){var Ec="oninput"in document;if(!Ec){var CC=document.createElement("div");CC.setAttribute("oninput","return;"),Ec=typeof CC.oninput=="function"}z0=Ec}else z0=!1;RC=z0&&(!document.documentMode||9<document.documentMode)}function IC(){Ef&&(Ef.detachEvent("onpropertychange",_a),Wg=Ef=null)}function _a(f){if(f.propertyName==="value"&&vf(Wg)){var g=[];W0(g,Wg,f,ho(f)),Ao(EN,g)}}function SN(f,g,T){f==="focusin"?(IC(),Ef=g,Wg=T,Ef.attachEvent("onpropertychange",_a)):f==="focusout"&&IC()}function bN(f){if(f==="selectionchange"||f==="keyup"||f==="keydown")return vf(Wg)}function TN(f,g){if(f==="click")return vf(g)}function wN(f,g){if(f==="input"||f==="change")return vf(g)}function AC(f,g){return f===g&&(f!==0||1/f===1/g)||f!==f&&g!==g}var fl=typeof Object.is=="function"?Object.is:AC;function zg(f,g){if(fl(f,g))return!0;if(typeof f!="object"||f===null||typeof g!="object"||g===null)return!1;var T=Object.keys(f),O=Object.keys(g);if(T.length!==O.length)return!1;for(O=0;O<T.length;O++){var M=T[O];if(!v.call(g,M)||!fl(f[M],g[M]))return!1}return!0}function PC(f){for(;f&&f.firstChild;)f=f.firstChild;return f}function G0(f,g){var T=PC(f);f=0;for(var O;T;){if(T.nodeType===3){if(O=f+T.textContent.length,f<=g&&O>=g)return{node:T,offset:g-f};f=O}e:{for(;T;){if(T.nextSibling){T=T.nextSibling;break e}T=T.parentNode}T=void 0}T=PC(T)}}function OC(f,g){return f&&g?f===g?!0:f&&f.nodeType===3?!1:g&&g.nodeType===3?OC(f,g.parentNode):"contains"in f?f.contains(g):f.compareDocumentPosition?!!(f.compareDocumentPosition(g)&16):!1:!1}function kC(){for(var f=window,g=ln();g instanceof f.HTMLIFrameElement;){try{var T=typeof g.contentWindow.location.href=="string"}catch{T=!1}if(T)f=g.contentWindow;else break;g=ln(f.document)}return g}function Gg(f){var g=f&&f.nodeName&&f.nodeName.toLowerCase();return g&&(g==="input"&&(f.type==="text"||f.type==="search"||f.type==="tel"||f.type==="url"||f.type==="password")||g==="textarea"||f.contentEditable==="true")}function H0(f){var g=kC(),T=f.focusedElem,O=f.selectionRange;if(g!==T&&T&&T.ownerDocument&&OC(T.ownerDocument.documentElement,T)){if(O!==null&&Gg(T)){if(g=O.start,f=O.end,f===void 0&&(f=g),"selectionStart"in T)T.selectionStart=g,T.selectionEnd=Math.min(f,T.value.length);else if(f=(g=T.ownerDocument||document)&&g.defaultView||window,f.getSelection){f=f.getSelection();var M=T.textContent.length,H=Math.min(O.start,M);O=O.end===void 0?H:Math.min(O.end,M),!f.extend&&H>O&&(M=O,O=H,H=M),M=G0(T,H);var ae=G0(T,O);M&&ae&&(f.rangeCount!==1||f.anchorNode!==M.node||f.anchorOffset!==M.offset||f.focusNode!==ae.node||f.focusOffset!==ae.offset)&&(g=g.createRange(),g.setStart(M.node,M.offset),f.removeAllRanges(),H>O?(f.addRange(g),f.extend(ae.node,ae.offset)):(g.setEnd(ae.node,ae.offset),f.addRange(g)))}}for(g=[],f=T;f=f.parentNode;)f.nodeType===1&&g.push({element:f,left:f.scrollLeft,top:f.scrollTop});for(typeof T.focus=="function"&&T.focus(),T=0;T<g.length;T++)f=g[T],f.element.scrollLeft=f.left,f.element.scrollTop=f.top}}var RN=y&&"documentMode"in document&&11>=document.documentMode,ot=null,$0=null,Hg=null,K0=!1;function NC(f,g,T){var O=T.window===T?T.document:T.nodeType===9?T:T.ownerDocument;K0||ot==null||ot!==ln(O)||(O=ot,"selectionStart"in O&&Gg(O)?O={start:O.selectionStart,end:O.selectionEnd}:(O=(O.ownerDocument&&O.ownerDocument.defaultView||window).getSelection(),O={anchorNode:O.anchorNode,anchorOffset:O.anchorOffset,focusNode:O.focusNode,focusOffset:O.focusOffset}),Hg&&zg(Hg,O)||(Hg=O,O=oE($0,"onSelect"),0<O.length&&(g=new qd("onSelect","select",null,g,T),f.push({event:g,listeners:O}),g.target=ot)))}function tE(f,g){var T={};return T[f.toLowerCase()]=g.toLowerCase(),T["Webkit"+f]="webkit"+g,T["Moz"+f]="moz"+g,T}var Zp={animationend:tE("Animation","AnimationEnd"),animationiteration:tE("Animation","AnimationIteration"),animationstart:tE("Animation","AnimationStart"),transitionend:tE("Transition","TransitionEnd")},q0={},DC={};y&&(DC=document.createElement("div").style,"AnimationEvent"in window||(delete Zp.animationend.animation,delete Zp.animationiteration.animation,delete Zp.animationstart.animation),"TransitionEvent"in window||delete Zp.transitionend.transition);function Sf(f){if(q0[f])return q0[f];if(!Zp[f])return f;var g=Zp[f],T;for(T in g)if(g.hasOwnProperty(T)&&T in DC)return q0[f]=g[T];return f}var bf=Sf("animationend"),LC=Sf("animationiteration"),xC=Sf("animationstart"),MC=Sf("transitionend"),UC=new Map,nE="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function Yd(f,g){UC.set(f,g),d(g,[f])}for(var rE=0;rE<nE.length;rE++){var Ya=nE[rE],CN=Ya.toLowerCase(),$g=Ya[0].toUpperCase()+Ya.slice(1);Yd(CN,"on"+$g)}Yd(bf,"onAnimationEnd"),Yd(LC,"onAnimationIteration"),Yd(xC,"onAnimationStart"),Yd("dblclick","onDoubleClick"),Yd("focusin","onFocus"),Yd("focusout","onBlur"),Yd(MC,"onTransitionEnd"),p("onMouseEnter",["mouseout","mouseover"]),p("onMouseLeave",["mouseout","mouseover"]),p("onPointerEnter",["pointerout","pointerover"]),p("onPointerLeave",["pointerout","pointerover"]),d("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),d("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),d("onBeforeInput",["compositionend","keypress","textInput","paste"]),d("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),d("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),d("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Kg="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),IN=new Set("cancel close invalid load scroll toggle".split(" ").concat(Kg));function VC(f,g,T){var O=f.type||"unknown-event";f.currentTarget=T,hf(O,g,void 0,f),f.currentTarget=null}function Y0(f,g){g=(g&4)!==0;for(var T=0;T<f.length;T++){var O=f[T],M=O.event;O=O.listeners;e:{var H=void 0;if(g)for(var ae=O.length-1;0<=ae;ae--){var Ie=O[ae],xe=Ie.instance,it=Ie.currentTarget;if(Ie=Ie.listener,xe!==H&&M.isPropagationStopped())break e;VC(M,Ie,it),H=xe}else for(ae=0;ae<O.length;ae++){if(Ie=O[ae],xe=Ie.instance,it=Ie.currentTarget,Ie=Ie.listener,xe!==H&&M.isPropagationStopped())break e;VC(M,Ie,it),H=xe}}}if(ha)throw f=Fd,ha=!1,Fd=null,f}function Ci(f,g){var T=g[Jg];T===void 0&&(T=g[Jg]=new Set);var O=f+"__bubble";T.has(O)||(FC(g,f,2,!1),T.add(O))}function X0(f,g,T){var O=0;g&&(O|=4),FC(T,f,O,g)}var iE="_reactListening"+Math.random().toString(36).slice(2);function Tf(f){if(!f[iE]){f[iE]=!0,a.forEach(function(T){T!=="selectionchange"&&(IN.has(T)||X0(T,!1,f),X0(T,!0,f))});var g=f.nodeType===9?f:f.ownerDocument;g===null||g[iE]||(g[iE]=!0,X0("selectionchange",!1,g))}}function FC(f,g,T,O){switch(jr(g)){case 1:var M=De;break;case 4:M=tt;break;default:M=Kt}T=M.bind(null,g,T,f),M=void 0,!hs||g!=="touchstart"&&g!=="touchmove"&&g!=="wheel"||(M=!0),O?M!==void 0?f.addEventListener(g,T,{capture:!0,passive:M}):f.addEventListener(g,T,!0):M!==void 0?f.addEventListener(g,T,{passive:M}):f.addEventListener(g,T,!1)}function sE(f,g,T,O,M){var H=O;if((g&1)===0&&(g&2)===0&&O!==null)e:for(;;){if(O===null)return;var ae=O.tag;if(ae===3||ae===4){var Ie=O.stateNode.containerInfo;if(Ie===M||Ie.nodeType===8&&Ie.parentNode===M)break;if(ae===4)for(ae=O.return;ae!==null;){var xe=ae.tag;if((xe===3||xe===4)&&(xe=ae.stateNode.containerInfo,xe===M||xe.nodeType===8&&xe.parentNode===M))return;ae=ae.return}for(;Ie!==null;){if(ae=Rf(Ie),ae===null)return;if(xe=ae.tag,xe===5||xe===6){O=H=ae;continue e}Ie=Ie.parentNode}}O=O.return}Ao(function(){var it=H,At=ho(T),Pt=[];e:{var Ct=UC.get(f);if(Ct!==void 0){var Ht=qd,en=f;switch(f){case"keypress":if(Mo(T)===0)break e;case"keydown":case"keyup":Ht=W;break;case"focusin":en="focus",Ht=Yp;break;case"focusout":en="blur",Ht=Yp;break;case"beforeblur":case"afterblur":Ht=Yp;break;case"click":if(T.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":Ht=Kp;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":Ht=Jy;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":Ht=at;break;case bf:case LC:case xC:Ht=Ku;break;case MC:Ht=Hr;break;case"scroll":Ht=Fg;break;case"wheel":Ht=Er;break;case"copy":case"cut":case"paste":Ht=Bg;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":Ht=pe}var tn=(g&4)!==0,Zi=!tn&&f==="scroll",Je=tn?Ct!==null?Ct+"Capture":null:Ct;tn=[];for(var Ve=it,Ze;Ve!==null;){Ze=Ve;var Dt=Ze.stateNode;if(Ze.tag===5&&Dt!==null&&(Ze=Dt,Je!==null&&(Dt=ji(Ve,Je),Dt!=null&&tn.push(em(Ve,Dt,Ze)))),Zi)break;Ve=Ve.return}0<tn.length&&(Ct=new Ht(Ct,en,null,T,At),Pt.push({event:Ct,listeners:tn}))}}if((g&7)===0){e:{if(Ct=f==="mouseover"||f==="pointerover",Ht=f==="mouseout"||f==="pointerout",Ct&&T!==uo&&(en=T.relatedTarget||T.fromElement)&&(Rf(en)||en[vc]))break e;if((Ht||Ct)&&(Ct=At.window===At?At:(Ct=At.ownerDocument)?Ct.defaultView||Ct.parentWindow:window,Ht?(en=T.relatedTarget||T.toElement,Ht=it,en=en?Rf(en):null,en!==null&&(Zi=Bs(en),en!==Zi||en.tag!==5&&en.tag!==6)&&(en=null)):(Ht=null,en=it),Ht!==en)){if(tn=Kp,Dt="onMouseLeave",Je="onMouseEnter",Ve="mouse",(f==="pointerout"||f==="pointerover")&&(tn=pe,Dt="onPointerLeave",Je="onPointerEnter",Ve="pointer"),Zi=Ht==null?Ct:Cf(Ht),Ze=en==null?Ct:Cf(en),Ct=new tn(Dt,Ve+"leave",Ht,T,At),Ct.target=Zi,Ct.relatedTarget=Ze,Dt=null,Rf(At)===it&&(tn=new tn(Je,Ve+"enter",en,T,At),tn.target=Ze,tn.relatedTarget=Zi,Dt=tn),Zi=Dt,Ht&&en)t:{for(tn=Ht,Je=en,Ve=0,Ze=tn;Ze;Ze=wf(Ze))Ve++;for(Ze=0,Dt=Je;Dt;Dt=wf(Dt))Ze++;for(;0<Ve-Ze;)tn=wf(tn),Ve--;for(;0<Ze-Ve;)Je=wf(Je),Ze--;for(;Ve--;){if(tn===Je||Je!==null&&tn===Je.alternate)break t;tn=wf(tn),Je=wf(Je)}tn=null}else tn=null;Ht!==null&&qg(Pt,Ct,Ht,tn,!1),en!==null&&Zi!==null&&qg(Pt,Zi,en,tn,!0)}}e:{if(Ct=it?Cf(it):window,Ht=Ct.nodeName&&Ct.nodeName.toLowerCase(),Ht==="select"||Ht==="input"&&Ct.type==="file")var nn=vN;else if(wC(Ct))if(RC)nn=wN;else{nn=bN;var pn=SN}else(Ht=Ct.nodeName)&&Ht.toLowerCase()==="input"&&(Ct.type==="checkbox"||Ct.type==="radio")&&(nn=TN);if(nn&&(nn=nn(f,it))){W0(Pt,nn,T,At);break e}pn&&pn(f,Ct,it),f==="focusout"&&(pn=Ct._wrapperState)&&pn.controlled&&Ct.type==="number"&&Fe(Ct,"number",Ct.value)}switch(pn=it?Cf(it):window,f){case"focusin":(wC(pn)||pn.contentEditable==="true")&&(ot=pn,$0=it,Hg=null);break;case"focusout":Hg=$0=ot=null;break;case"mousedown":K0=!0;break;case"contextmenu":case"mouseup":case"dragend":K0=!1,NC(Pt,T,At);break;case"selectionchange":if(RN)break;case"keydown":case"keyup":NC(Pt,T,At)}var En;if(ps)e:{switch(f){case"compositionstart":var On="onCompositionStart";break e;case"compositionend":On="onCompositionEnd";break e;case"compositionupdate":On="onCompositionUpdate";break e}On=void 0}else Qp?SC(f,T)&&(On="onCompositionEnd"):f==="keydown"&&T.keyCode===229&&(On="onCompositionStart");On&&(yf&&T.locale!=="ko"&&(Qp||On!=="onCompositionStart"?On==="onCompositionEnd"&&Qp&&(En=Os()):(cn=At,Nr="value"in cn?cn.value:cn.textContent,Qp=!0)),pn=oE(it,On),0<pn.length&&(On=new Mn(On,f,null,T,At),Pt.push({event:On,listeners:pn}),En?On.data=En:(En=bC(T),En!==null&&(On.data=En)))),(En=jo?_N(f,T):TC(f,T))&&(it=oE(it,"onBeforeInput"),0<it.length&&(At=new Mn("onBeforeInput","beforeinput",null,T,At),Pt.push({event:At,listeners:it}),At.data=En))}Y0(Pt,g)})}function em(f,g,T){return{instance:f,listener:g,currentTarget:T}}function oE(f,g){for(var T=g+"Capture",O=[];f!==null;){var M=f,H=M.stateNode;M.tag===5&&H!==null&&(M=H,H=ji(f,T),H!=null&&O.unshift(em(f,H,M)),H=ji(f,g),H!=null&&O.push(em(f,H,M))),f=f.return}return O}function wf(f){if(f===null)return null;do f=f.return;while(f&&f.tag!==5);return f||null}function qg(f,g,T,O,M){for(var H=g._reactName,ae=[];T!==null&&T!==O;){var Ie=T,xe=Ie.alternate,it=Ie.stateNode;if(xe!==null&&xe===O)break;Ie.tag===5&&it!==null&&(Ie=it,M?(xe=ji(T,H),xe!=null&&ae.unshift(em(T,xe,Ie))):M||(xe=ji(T,H),xe!=null&&ae.push(em(T,xe,Ie)))),T=T.return}ae.length!==0&&f.push({event:g,listeners:ae})}var AN=/\r\n?/g,PN=/\u0000|\uFFFD/g;function jC(f){return(typeof f=="string"?f:""+f).replace(AN,`
`).replace(PN,"")}function aE(f,g,T){if(g=jC(g),jC(f)!==g&&T)throw Error(i(425))}function cE(){}var lE=null,Yg=null;function J0(f,g){return f==="textarea"||f==="noscript"||typeof g.children=="string"||typeof g.children=="number"||typeof g.dangerouslySetInnerHTML=="object"&&g.dangerouslySetInnerHTML!==null&&g.dangerouslySetInnerHTML.__html!=null}var Xg=typeof setTimeout=="function"?setTimeout:void 0,ON=typeof clearTimeout=="function"?clearTimeout:void 0,BC=typeof Promise=="function"?Promise:void 0,kN=typeof queueMicrotask=="function"?queueMicrotask:typeof BC<"u"?function(f){return BC.resolve(null).then(f).catch(NN)}:Xg;function NN(f){setTimeout(function(){throw f})}function Q0(f,g){var T=g,O=0;do{var M=T.nextSibling;if(f.removeChild(T),M&&M.nodeType===8)if(T=M.data,T==="/$"){if(O===0){f.removeChild(M),ga(g);return}O--}else T!=="$"&&T!=="$?"&&T!=="$!"||O++;T=M}while(T);ga(g)}function Xd(f){for(;f!=null;f=f.nextSibling){var g=f.nodeType;if(g===1||g===3)break;if(g===8){if(g=f.data,g==="$"||g==="$!"||g==="$?")break;if(g==="/$")return null}}return f}function WC(f){f=f.previousSibling;for(var g=0;f;){if(f.nodeType===8){var T=f.data;if(T==="$"||T==="$!"||T==="$?"){if(g===0)return f;g--}else T==="/$"&&g++}f=f.previousSibling}return null}var tm=Math.random().toString(36).slice(2),ql="__reactFiber$"+tm,Jd="__reactProps$"+tm,vc="__reactContainer$"+tm,Jg="__reactEvents$"+tm,DN="__reactListeners$"+tm,LN="__reactHandles$"+tm;function Rf(f){var g=f[ql];if(g)return g;for(var T=f.parentNode;T;){if(g=T[vc]||T[ql]){if(T=g.alternate,g.child!==null||T!==null&&T.child!==null)for(f=WC(f);f!==null;){if(T=f[ql])return T;f=WC(f)}return g}f=T,T=f.parentNode}return null}function nm(f){return f=f[ql]||f[vc],!f||f.tag!==5&&f.tag!==6&&f.tag!==13&&f.tag!==3?null:f}function Cf(f){if(f.tag===5||f.tag===6)return f.stateNode;throw Error(i(33))}function rm(f){return f[Jd]||null}var Z0=[],im=-1;function Sc(f){return{current:f}}function Ii(f){0>im||(f.current=Z0[im],Z0[im]=null,im--)}function vi(f,g){im++,Z0[im]=f.current,f.current=g}var Qd={},po=Sc(Qd),ya=Sc(!1),If=Qd;function Af(f,g){var T=f.type.contextTypes;if(!T)return Qd;var O=f.stateNode;if(O&&O.__reactInternalMemoizedUnmaskedChildContext===g)return O.__reactInternalMemoizedMaskedChildContext;var M={},H;for(H in T)M[H]=g[H];return O&&(f=f.stateNode,f.__reactInternalMemoizedUnmaskedChildContext=g,f.__reactInternalMemoizedMaskedChildContext=M),M}function Ea(f){return f=f.childContextTypes,f!=null}function uE(){Ii(ya),Ii(po)}function zC(f,g,T){if(po.current!==Qd)throw Error(i(168));vi(po,g),vi(ya,T)}function dE(f,g,T){var O=f.stateNode;if(g=g.childContextTypes,typeof O.getChildContext!="function")return T;O=O.getChildContext();for(var M in O)if(!(M in g))throw Error(i(108,nt(f)||"Unknown",M));return Ne({},T,O)}function hE(f){return f=(f=f.stateNode)&&f.__reactInternalMemoizedMergedChildContext||Qd,If=po.current,vi(po,f),vi(ya,ya.current),!0}function GC(f,g,T){var O=f.stateNode;if(!O)throw Error(i(169));T?(f=dE(f,g,If),O.__reactInternalMemoizedMergedChildContext=f,Ii(ya),Ii(po),vi(po,f)):Ii(ya),vi(ya,T)}var bc=null,fE=!1,eb=!1;function HC(f){bc===null?bc=[f]:bc.push(f)}function xN(f){fE=!0,HC(f)}function Zd(){if(!eb&&bc!==null){eb=!0;var f=0,g=nr;try{var T=bc;for(nr=1;f<T.length;f++){var O=T[f];do O=O(!0);while(O!==null)}bc=null,fE=!1}catch(M){throw bc!==null&&(bc=bc.slice(f+1)),Wd(pc,Zd),M}finally{nr=g,eb=!1}}return null}var sm=[],Yu=0,Qg=null,pE=0,Tc=[],Xa=0,Pf=null,Xu=1,Ju="";function Qu(f,g){sm[Yu++]=pE,sm[Yu++]=Qg,Qg=f,pE=g}function mE(f,g,T){Tc[Xa++]=Xu,Tc[Xa++]=Ju,Tc[Xa++]=Pf,Pf=f;var O=Xu;f=Ju;var M=32-Xs(O)-1;O&=~(1<<M),T+=1;var H=32-Xs(g)+M;if(30<H){var ae=M-M%5;H=(O&(1<<ae)-1).toString(32),O>>=ae,M-=ae,Xu=1<<32-Xs(g)+M|T<<M|O,Ju=H+f}else Xu=1<<H|T<<M|O,Ju=f}function gE(f){f.return!==null&&(Qu(f,1),mE(f,1,0))}function Zg(f){for(;f===Qg;)Qg=sm[--Yu],sm[Yu]=null,pE=sm[--Yu],sm[Yu]=null;for(;f===Pf;)Pf=Tc[--Xa],Tc[Xa]=null,Ju=Tc[--Xa],Tc[Xa]=null,Xu=Tc[--Xa],Tc[Xa]=null}var va=null,Sa=null,ai=!1,Bo=null;function $C(f,g){var T=Za(5,null,null,0);T.elementType="DELETED",T.stateNode=g,T.return=f,g=f.deletions,g===null?(f.deletions=[T],f.flags|=16):g.push(T)}function KC(f,g){switch(f.tag){case 5:var T=f.type;return g=g.nodeType!==1||T.toLowerCase()!==g.nodeName.toLowerCase()?null:g,g!==null?(f.stateNode=g,va=f,Sa=Xd(g.firstChild),!0):!1;case 6:return g=f.pendingProps===""||g.nodeType!==3?null:g,g!==null?(f.stateNode=g,va=f,Sa=null,!0):!1;case 13:return g=g.nodeType!==8?null:g,g!==null?(T=Pf!==null?{id:Xu,overflow:Ju}:null,f.memoizedState={dehydrated:g,treeContext:T,retryLane:1073741824},T=Za(18,null,null,0),T.stateNode=g,T.return=f,f.child=T,va=f,Sa=null,!0):!1;default:return!1}}function _E(f){return(f.mode&1)!==0&&(f.flags&128)===0}function tb(f){if(ai){var g=Sa;if(g){var T=g;if(!KC(f,g)){if(_E(f))throw Error(i(418));g=Xd(T.nextSibling);var O=va;g&&KC(f,g)?$C(O,T):(f.flags=f.flags&-4097|2,ai=!1,va=f)}}else{if(_E(f))throw Error(i(418));f.flags=f.flags&-4097|2,ai=!1,va=f}}}function qC(f){for(f=f.return;f!==null&&f.tag!==5&&f.tag!==3&&f.tag!==13;)f=f.return;va=f}function e_(f){if(f!==va)return!1;if(!ai)return qC(f),ai=!0,!1;var g;if((g=f.tag!==3)&&!(g=f.tag!==5)&&(g=f.type,g=g!=="head"&&g!=="body"&&!J0(f.type,f.memoizedProps)),g&&(g=Sa)){if(_E(f))throw YC(),Error(i(418));for(;g;)$C(f,g),g=Xd(g.nextSibling)}if(qC(f),f.tag===13){if(f=f.memoizedState,f=f!==null?f.dehydrated:null,!f)throw Error(i(317));e:{for(f=f.nextSibling,g=0;f;){if(f.nodeType===8){var T=f.data;if(T==="/$"){if(g===0){Sa=Xd(f.nextSibling);break e}g--}else T!=="$"&&T!=="$!"&&T!=="$?"||g++}f=f.nextSibling}Sa=null}}else Sa=va?Xd(f.stateNode.nextSibling):null;return!0}function YC(){for(var f=Sa;f;)f=Xd(f.nextSibling)}function om(){Sa=va=null,ai=!1}function nb(f){Bo===null?Bo=[f]:Bo.push(f)}var MN=ce.ReactCurrentBatchConfig;function t_(f,g,T){if(f=T.ref,f!==null&&typeof f!="function"&&typeof f!="object"){if(T._owner){if(T=T._owner,T){if(T.tag!==1)throw Error(i(309));var O=T.stateNode}if(!O)throw Error(i(147,f));var M=O,H=""+f;return g!==null&&g.ref!==null&&typeof g.ref=="function"&&g.ref._stringRef===H?g.ref:(g=function(ae){var Ie=M.refs;ae===null?delete Ie[H]:Ie[H]=ae},g._stringRef=H,g)}if(typeof f!="string")throw Error(i(284));if(!T._owner)throw Error(i(290,f))}return f}function yE(f,g){throw f=Object.prototype.toString.call(g),Error(i(31,f==="[object Object]"?"object with keys {"+Object.keys(g).join(", ")+"}":f))}function rb(f){var g=f._init;return g(f._payload)}function eh(f){function g(Je,Ve){if(f){var Ze=Je.deletions;Ze===null?(Je.deletions=[Ve],Je.flags|=16):Ze.push(Ve)}}function T(Je,Ve){if(!f)return null;for(;Ve!==null;)g(Je,Ve),Ve=Ve.sibling;return null}function O(Je,Ve){for(Je=new Map;Ve!==null;)Ve.key!==null?Je.set(Ve.key,Ve):Je.set(Ve.index,Ve),Ve=Ve.sibling;return Je}function M(Je,Ve){return Je=od(Je,Ve),Je.index=0,Je.sibling=null,Je}function H(Je,Ve,Ze){return Je.index=Ze,f?(Ze=Je.alternate,Ze!==null?(Ze=Ze.index,Ze<Ve?(Je.flags|=2,Ve):Ze):(Je.flags|=2,Ve)):(Je.flags|=1048576,Ve)}function ae(Je){return f&&Je.alternate===null&&(Je.flags|=2),Je}function Ie(Je,Ve,Ze,Dt){return Ve===null||Ve.tag!==6?(Ve=jb(Ze,Je.mode,Dt),Ve.return=Je,Ve):(Ve=M(Ve,Ze),Ve.return=Je,Ve)}function xe(Je,Ve,Ze,Dt){var nn=Ze.type;return nn===te?At(Je,Ve,Ze.props.children,Dt,Ze.key):Ve!==null&&(Ve.elementType===nn||typeof nn=="object"&&nn!==null&&nn.$$typeof===rt&&rb(nn)===Ve.type)?(Dt=M(Ve,Ze.props),Dt.ref=t_(Je,Ve,Ze),Dt.return=Je,Dt):(Dt=iv(Ze.type,Ze.key,Ze.props,null,Je.mode,Dt),Dt.ref=t_(Je,Ve,Ze),Dt.return=Je,Dt)}function it(Je,Ve,Ze,Dt){return Ve===null||Ve.tag!==4||Ve.stateNode.containerInfo!==Ze.containerInfo||Ve.stateNode.implementation!==Ze.implementation?(Ve=Bb(Ze,Je.mode,Dt),Ve.return=Je,Ve):(Ve=M(Ve,Ze.children||[]),Ve.return=Je,Ve)}function At(Je,Ve,Ze,Dt,nn){return Ve===null||Ve.tag!==7?(Ve=Bf(Ze,Je.mode,Dt,nn),Ve.return=Je,Ve):(Ve=M(Ve,Ze),Ve.return=Je,Ve)}function Pt(Je,Ve,Ze){if(typeof Ve=="string"&&Ve!==""||typeof Ve=="number")return Ve=jb(""+Ve,Je.mode,Ze),Ve.return=Je,Ve;if(typeof Ve=="object"&&Ve!==null){switch(Ve.$$typeof){case oe:return Ze=iv(Ve.type,Ve.key,Ve.props,null,Je.mode,Ze),Ze.ref=t_(Je,null,Ve),Ze.return=Je,Ze;case ge:return Ve=Bb(Ve,Je.mode,Ze),Ve.return=Je,Ve;case rt:var Dt=Ve._init;return Pt(Je,Dt(Ve._payload),Ze)}if(Ke(Ve)||ve(Ve))return Ve=Bf(Ve,Je.mode,Ze,null),Ve.return=Je,Ve;yE(Je,Ve)}return null}function Ct(Je,Ve,Ze,Dt){var nn=Ve!==null?Ve.key:null;if(typeof Ze=="string"&&Ze!==""||typeof Ze=="number")return nn!==null?null:Ie(Je,Ve,""+Ze,Dt);if(typeof Ze=="object"&&Ze!==null){switch(Ze.$$typeof){case oe:return Ze.key===nn?xe(Je,Ve,Ze,Dt):null;case ge:return Ze.key===nn?it(Je,Ve,Ze,Dt):null;case rt:return nn=Ze._init,Ct(Je,Ve,nn(Ze._payload),Dt)}if(Ke(Ze)||ve(Ze))return nn!==null?null:At(Je,Ve,Ze,Dt,null);yE(Je,Ze)}return null}function Ht(Je,Ve,Ze,Dt,nn){if(typeof Dt=="string"&&Dt!==""||typeof Dt=="number")return Je=Je.get(Ze)||null,Ie(Ve,Je,""+Dt,nn);if(typeof Dt=="object"&&Dt!==null){switch(Dt.$$typeof){case oe:return Je=Je.get(Dt.key===null?Ze:Dt.key)||null,xe(Ve,Je,Dt,nn);case ge:return Je=Je.get(Dt.key===null?Ze:Dt.key)||null,it(Ve,Je,Dt,nn);case rt:var pn=Dt._init;return Ht(Je,Ve,Ze,pn(Dt._payload),nn)}if(Ke(Dt)||ve(Dt))return Je=Je.get(Ze)||null,At(Ve,Je,Dt,nn,null);yE(Ve,Dt)}return null}function en(Je,Ve,Ze,Dt){for(var nn=null,pn=null,En=Ve,On=Ve=0,Es=null;En!==null&&On<Ze.length;On++){En.index>On?(Es=En,En=null):Es=En.sibling;var vr=Ct(Je,En,Ze[On],Dt);if(vr===null){En===null&&(En=Es);break}f&&En&&vr.alternate===null&&g(Je,En),Ve=H(vr,Ve,On),pn===null?nn=vr:pn.sibling=vr,pn=vr,En=Es}if(On===Ze.length)return T(Je,En),ai&&Qu(Je,On),nn;if(En===null){for(;On<Ze.length;On++)En=Pt(Je,Ze[On],Dt),En!==null&&(Ve=H(En,Ve,On),pn===null?nn=En:pn.sibling=En,pn=En);return ai&&Qu(Je,On),nn}for(En=O(Je,En);On<Ze.length;On++)Es=Ht(En,Je,On,Ze[On],Dt),Es!==null&&(f&&Es.alternate!==null&&En.delete(Es.key===null?On:Es.key),Ve=H(Es,Ve,On),pn===null?nn=Es:pn.sibling=Es,pn=Es);return f&&En.forEach(function(dh){return g(Je,dh)}),ai&&Qu(Je,On),nn}function tn(Je,Ve,Ze,Dt){var nn=ve(Ze);if(typeof nn!="function")throw Error(i(150));if(Ze=nn.call(Ze),Ze==null)throw Error(i(151));for(var pn=nn=null,En=Ve,On=Ve=0,Es=null,vr=Ze.next();En!==null&&!vr.done;On++,vr=Ze.next()){En.index>On?(Es=En,En=null):Es=En.sibling;var dh=Ct(Je,En,vr.value,Dt);if(dh===null){En===null&&(En=Es);break}f&&En&&dh.alternate===null&&g(Je,En),Ve=H(dh,Ve,On),pn===null?nn=dh:pn.sibling=dh,pn=dh,En=Es}if(vr.done)return T(Je,En),ai&&Qu(Je,On),nn;if(En===null){for(;!vr.done;On++,vr=Ze.next())vr=Pt(Je,vr.value,Dt),vr!==null&&(Ve=H(vr,Ve,On),pn===null?nn=vr:pn.sibling=vr,pn=vr);return ai&&Qu(Je,On),nn}for(En=O(Je,En);!vr.done;On++,vr=Ze.next())vr=Ht(En,Je,On,vr.value,Dt),vr!==null&&(f&&vr.alternate!==null&&En.delete(vr.key===null?On:vr.key),Ve=H(vr,Ve,On),pn===null?nn=vr:pn.sibling=vr,pn=vr);return f&&En.forEach(function(QN){return g(Je,QN)}),ai&&Qu(Je,On),nn}function Zi(Je,Ve,Ze,Dt){if(typeof Ze=="object"&&Ze!==null&&Ze.type===te&&Ze.key===null&&(Ze=Ze.props.children),typeof Ze=="object"&&Ze!==null){switch(Ze.$$typeof){case oe:e:{for(var nn=Ze.key,pn=Ve;pn!==null;){if(pn.key===nn){if(nn=Ze.type,nn===te){if(pn.tag===7){T(Je,pn.sibling),Ve=M(pn,Ze.props.children),Ve.return=Je,Je=Ve;break e}}else if(pn.elementType===nn||typeof nn=="object"&&nn!==null&&nn.$$typeof===rt&&rb(nn)===pn.type){T(Je,pn.sibling),Ve=M(pn,Ze.props),Ve.ref=t_(Je,pn,Ze),Ve.return=Je,Je=Ve;break e}T(Je,pn);break}else g(Je,pn);pn=pn.sibling}Ze.type===te?(Ve=Bf(Ze.props.children,Je.mode,Dt,Ze.key),Ve.return=Je,Je=Ve):(Dt=iv(Ze.type,Ze.key,Ze.props,null,Je.mode,Dt),Dt.ref=t_(Je,Ve,Ze),Dt.return=Je,Je=Dt)}return ae(Je);case ge:e:{for(pn=Ze.key;Ve!==null;){if(Ve.key===pn)if(Ve.tag===4&&Ve.stateNode.containerInfo===Ze.containerInfo&&Ve.stateNode.implementation===Ze.implementation){T(Je,Ve.sibling),Ve=M(Ve,Ze.children||[]),Ve.return=Je,Je=Ve;break e}else{T(Je,Ve);break}else g(Je,Ve);Ve=Ve.sibling}Ve=Bb(Ze,Je.mode,Dt),Ve.return=Je,Je=Ve}return ae(Je);case rt:return pn=Ze._init,Zi(Je,Ve,pn(Ze._payload),Dt)}if(Ke(Ze))return en(Je,Ve,Ze,Dt);if(ve(Ze))return tn(Je,Ve,Ze,Dt);yE(Je,Ze)}return typeof Ze=="string"&&Ze!==""||typeof Ze=="number"?(Ze=""+Ze,Ve!==null&&Ve.tag===6?(T(Je,Ve.sibling),Ve=M(Ve,Ze),Ve.return=Je,Je=Ve):(T(Je,Ve),Ve=jb(Ze,Je.mode,Dt),Ve.return=Je,Je=Ve),ae(Je)):T(Je,Ve)}return Zi}var am=eh(!0),XC=eh(!1),EE=Sc(null),n_=null,cm=null,vE=null;function ib(){vE=cm=n_=null}function sb(f){var g=EE.current;Ii(EE),f._currentValue=g}function ob(f,g,T){for(;f!==null;){var O=f.alternate;if((f.childLanes&g)!==g?(f.childLanes|=g,O!==null&&(O.childLanes|=g)):O!==null&&(O.childLanes&g)!==g&&(O.childLanes|=g),f===T)break;f=f.return}}function Zu(f,g){n_=f,vE=cm=null,f=f.dependencies,f!==null&&f.firstContext!==null&&((f.lanes&g)!==0&&(Ta=!0),f.firstContext=null)}function wc(f){var g=f._currentValue;if(vE!==f)if(f={context:f,memoizedValue:g,next:null},cm===null){if(n_===null)throw Error(i(308));cm=f,n_.dependencies={lanes:0,firstContext:f}}else cm=cm.next=f;return g}var Of=null;function ab(f){Of===null?Of=[f]:Of.push(f)}function JC(f,g,T,O){var M=g.interleaved;return M===null?(T.next=T,ab(g)):(T.next=M.next,M.next=T),g.interleaved=T,ed(f,O)}function ed(f,g){f.lanes|=g;var T=f.alternate;for(T!==null&&(T.lanes|=g),T=f,f=f.return;f!==null;)f.childLanes|=g,T=f.alternate,T!==null&&(T.childLanes|=g),T=f,f=f.return;return T.tag===3?T.stateNode:null}var th=!1;function r_(f){f.updateQueue={baseState:f.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function QC(f,g){f=f.updateQueue,g.updateQueue===f&&(g.updateQueue={baseState:f.baseState,firstBaseUpdate:f.firstBaseUpdate,lastBaseUpdate:f.lastBaseUpdate,shared:f.shared,effects:f.effects})}function Yl(f,g){return{eventTime:f,lane:g,tag:0,payload:null,callback:null,next:null}}function nh(f,g,T){var O=f.updateQueue;if(O===null)return null;if(O=O.shared,(wr&2)!==0){var M=O.pending;return M===null?g.next=g:(g.next=M.next,M.next=g),O.pending=g,ed(f,T)}return M=O.interleaved,M===null?(g.next=g,ab(O)):(g.next=M.next,M.next=g),O.interleaved=g,ed(f,T)}function i_(f,g,T){if(g=g.updateQueue,g!==null&&(g=g.shared,(T&4194240)!==0)){var O=g.lanes;O&=f.pendingLanes,T|=O,g.lanes=T,$a(f,T)}}function ZC(f,g){var T=f.updateQueue,O=f.alternate;if(O!==null&&(O=O.updateQueue,T===O)){var M=null,H=null;if(T=T.firstBaseUpdate,T!==null){do{var ae={eventTime:T.eventTime,lane:T.lane,tag:T.tag,payload:T.payload,callback:T.callback,next:null};H===null?M=H=ae:H=H.next=ae,T=T.next}while(T!==null);H===null?M=H=g:H=H.next=g}else M=H=g;T={baseState:O.baseState,firstBaseUpdate:M,lastBaseUpdate:H,shared:O.shared,effects:O.effects},f.updateQueue=T;return}f=T.lastBaseUpdate,f===null?T.firstBaseUpdate=g:f.next=g,T.lastBaseUpdate=g}function SE(f,g,T,O){var M=f.updateQueue;th=!1;var H=M.firstBaseUpdate,ae=M.lastBaseUpdate,Ie=M.shared.pending;if(Ie!==null){M.shared.pending=null;var xe=Ie,it=xe.next;xe.next=null,ae===null?H=it:ae.next=it,ae=xe;var At=f.alternate;At!==null&&(At=At.updateQueue,Ie=At.lastBaseUpdate,Ie!==ae&&(Ie===null?At.firstBaseUpdate=it:Ie.next=it,At.lastBaseUpdate=xe))}if(H!==null){var Pt=M.baseState;ae=0,At=it=xe=null,Ie=H;do{var Ct=Ie.lane,Ht=Ie.eventTime;if((O&Ct)===Ct){At!==null&&(At=At.next={eventTime:Ht,lane:0,tag:Ie.tag,payload:Ie.payload,callback:Ie.callback,next:null});e:{var en=f,tn=Ie;switch(Ct=g,Ht=T,tn.tag){case 1:if(en=tn.payload,typeof en=="function"){Pt=en.call(Ht,Pt,Ct);break e}Pt=en;break e;case 3:en.flags=en.flags&-65537|128;case 0:if(en=tn.payload,Ct=typeof en=="function"?en.call(Ht,Pt,Ct):en,Ct==null)break e;Pt=Ne({},Pt,Ct);break e;case 2:th=!0}}Ie.callback!==null&&Ie.lane!==0&&(f.flags|=64,Ct=M.effects,Ct===null?M.effects=[Ie]:Ct.push(Ie))}else Ht={eventTime:Ht,lane:Ct,tag:Ie.tag,payload:Ie.payload,callback:Ie.callback,next:null},At===null?(it=At=Ht,xe=Pt):At=At.next=Ht,ae|=Ct;if(Ie=Ie.next,Ie===null){if(Ie=M.shared.pending,Ie===null)break;Ct=Ie,Ie=Ct.next,Ct.next=null,M.lastBaseUpdate=Ct,M.shared.pending=null}}while(!0);if(At===null&&(xe=Pt),M.baseState=xe,M.firstBaseUpdate=it,M.lastBaseUpdate=At,g=M.shared.interleaved,g!==null){M=g;do ae|=M.lane,M=M.next;while(M!==g)}else H===null&&(M.shared.lanes=0);Mf|=ae,f.lanes=ae,f.memoizedState=Pt}}function eI(f,g,T){if(f=g.effects,g.effects=null,f!==null)for(g=0;g<f.length;g++){var O=f[g],M=O.callback;if(M!==null){if(O.callback=null,O=T,typeof M!="function")throw Error(i(191,M));M.call(O)}}}var s_={},Xl=Sc(s_),o_=Sc(s_),lm=Sc(s_);function kf(f){if(f===s_)throw Error(i(174));return f}function cb(f,g){switch(vi(lm,g),vi(o_,f),vi(Xl,s_),f=g.nodeType,f){case 9:case 11:g=(g=g.documentElement)?g.namespaceURI:an(null,"");break;default:f=f===8?g.parentNode:g,g=f.namespaceURI||null,f=f.tagName,g=an(g,f)}Ii(Xl),vi(Xl,g)}function Nf(){Ii(Xl),Ii(o_),Ii(lm)}function tI(f){kf(lm.current);var g=kf(Xl.current),T=an(g,f.type);g!==T&&(vi(o_,f),vi(Xl,T))}function um(f){o_.current===f&&(Ii(Xl),Ii(o_))}var Ni=Sc(0);function rh(f){for(var g=f;g!==null;){if(g.tag===13){var T=g.memoizedState;if(T!==null&&(T=T.dehydrated,T===null||T.data==="$?"||T.data==="$!"))return g}else if(g.tag===19&&g.memoizedProps.revealOrder!==void 0){if((g.flags&128)!==0)return g}else if(g.child!==null){g.child.return=g,g=g.child;continue}if(g===f)break;for(;g.sibling===null;){if(g.return===null||g.return===f)return null;g=g.return}g.sibling.return=g.return,g=g.sibling}return null}var lb=[];function ub(){for(var f=0;f<lb.length;f++)lb[f]._workInProgressVersionPrimary=null;lb.length=0}var bE=ce.ReactCurrentDispatcher,db=ce.ReactCurrentBatchConfig,Jl=0,Bi=null,ms=null,gs=null,dm=!1,a_=!1,c_=0,UN=0;function mo(){throw Error(i(321))}function hb(f,g){if(g===null)return!1;for(var T=0;T<g.length&&T<f.length;T++)if(!fl(f[T],g[T]))return!1;return!0}function hm(f,g,T,O,M,H){if(Jl=H,Bi=g,g.memoizedState=null,g.updateQueue=null,g.lanes=0,bE.current=f===null||f.memoizedState===null?jN:hI,f=T(O,M),a_){H=0;do{if(a_=!1,c_=0,25<=H)throw Error(i(301));H+=1,gs=ms=null,g.updateQueue=null,bE.current=BN,f=T(O,M)}while(a_)}if(bE.current=CE,g=ms!==null&&ms.next!==null,Jl=0,gs=ms=Bi=null,dm=!1,g)throw Error(i(300));return f}function fb(){var f=c_!==0;return c_=0,f}function Wo(){var f={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return gs===null?Bi.memoizedState=gs=f:gs=gs.next=f,gs}function ba(){if(ms===null){var f=Bi.alternate;f=f!==null?f.memoizedState:null}else f=ms.next;var g=gs===null?Bi.memoizedState:gs.next;if(g!==null)gs=g,ms=f;else{if(f===null)throw Error(i(310));ms=f,f={memoizedState:ms.memoizedState,baseState:ms.baseState,baseQueue:ms.baseQueue,queue:ms.queue,next:null},gs===null?Bi.memoizedState=gs=f:gs=gs.next=f}return gs}function ih(f,g){return typeof g=="function"?g(f):g}function Df(f){var g=ba(),T=g.queue;if(T===null)throw Error(i(311));T.lastRenderedReducer=f;var O=ms,M=O.baseQueue,H=T.pending;if(H!==null){if(M!==null){var ae=M.next;M.next=H.next,H.next=ae}O.baseQueue=M=H,T.pending=null}if(M!==null){H=M.next,O=O.baseState;var Ie=ae=null,xe=null,it=H;do{var At=it.lane;if((Jl&At)===At)xe!==null&&(xe=xe.next={lane:0,action:it.action,hasEagerState:it.hasEagerState,eagerState:it.eagerState,next:null}),O=it.hasEagerState?it.eagerState:f(O,it.action);else{var Pt={lane:At,action:it.action,hasEagerState:it.hasEagerState,eagerState:it.eagerState,next:null};xe===null?(Ie=xe=Pt,ae=O):xe=xe.next=Pt,Bi.lanes|=At,Mf|=At}it=it.next}while(it!==null&&it!==H);xe===null?ae=O:xe.next=Ie,fl(O,g.memoizedState)||(Ta=!0),g.memoizedState=O,g.baseState=ae,g.baseQueue=xe,T.lastRenderedState=O}if(f=T.interleaved,f!==null){M=f;do H=M.lane,Bi.lanes|=H,Mf|=H,M=M.next;while(M!==f)}else M===null&&(T.lanes=0);return[g.memoizedState,T.dispatch]}function fm(f){var g=ba(),T=g.queue;if(T===null)throw Error(i(311));T.lastRenderedReducer=f;var O=T.dispatch,M=T.pending,H=g.memoizedState;if(M!==null){T.pending=null;var ae=M=M.next;do H=f(H,ae.action),ae=ae.next;while(ae!==M);fl(H,g.memoizedState)||(Ta=!0),g.memoizedState=H,g.baseQueue===null&&(g.baseState=H),T.lastRenderedState=H}return[H,O]}function nI(){}function pb(f,g){var T=Bi,O=ba(),M=g(),H=!fl(O.memoizedState,M);if(H&&(O.memoizedState=M,Ta=!0),O=O.queue,Rc(iI.bind(null,T,O,f),[f]),O.getSnapshot!==g||H||gs!==null&&gs.memoizedState.tag&1){if(T.flags|=2048,l_(9,mb.bind(null,T,O,M,g),void 0,null),zs===null)throw Error(i(349));(Jl&30)!==0||rI(T,g,M)}return M}function rI(f,g,T){f.flags|=16384,f={getSnapshot:g,value:T},g=Bi.updateQueue,g===null?(g={lastEffect:null,stores:null},Bi.updateQueue=g,g.stores=[f]):(T=g.stores,T===null?g.stores=[f]:T.push(f))}function mb(f,g,T,O){g.value=T,g.getSnapshot=O,sI(g)&&TE(f)}function iI(f,g,T){return T(function(){sI(g)&&TE(f)})}function sI(f){var g=f.getSnapshot;f=f.value;try{var T=g();return!fl(f,T)}catch{return!0}}function TE(f){var g=ed(f,1);g!==null&&Pc(g,f,1,-1)}function wE(f){var g=Wo();return typeof f=="function"&&(f=f()),g.memoizedState=g.baseState=f,f={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:ih,lastRenderedState:f},g.queue=f,f=f.dispatch=FN.bind(null,Bi,f),[g.memoizedState,f]}function l_(f,g,T,O){return f={tag:f,create:g,destroy:T,deps:O,next:null},g=Bi.updateQueue,g===null?(g={lastEffect:null,stores:null},Bi.updateQueue=g,g.lastEffect=f.next=f):(T=g.lastEffect,T===null?g.lastEffect=f.next=f:(O=T.next,T.next=f,f.next=O,g.lastEffect=f)),f}function oI(){return ba().memoizedState}function u_(f,g,T,O){var M=Wo();Bi.flags|=f,M.memoizedState=l_(1|g,T,void 0,O===void 0?null:O)}function pm(f,g,T,O){var M=ba();O=O===void 0?null:O;var H=void 0;if(ms!==null){var ae=ms.memoizedState;if(H=ae.destroy,O!==null&&hb(O,ae.deps)){M.memoizedState=l_(g,T,H,O);return}}Bi.flags|=f,M.memoizedState=l_(1|g,T,H,O)}function aI(f,g){return u_(8390656,8,f,g)}function Rc(f,g){return pm(2048,8,f,g)}function Lf(f,g){return pm(4,2,f,g)}function sh(f,g){return pm(4,4,f,g)}function gb(f,g){if(typeof g=="function")return f=f(),g(f),function(){g(null)};if(g!=null)return f=f(),g.current=f,function(){g.current=null}}function _b(f,g,T){return T=T!=null?T.concat([f]):null,pm(4,4,gb.bind(null,g,f),T)}function td(){}function RE(f,g){var T=ba();g=g===void 0?null:g;var O=T.memoizedState;return O!==null&&g!==null&&hb(g,O[1])?O[0]:(T.memoizedState=[f,g],f)}function cI(f,g){var T=ba();g=g===void 0?null:g;var O=T.memoizedState;return O!==null&&g!==null&&hb(g,O[1])?O[0]:(f=f(),T.memoizedState=[f,g],f)}function yb(f,g,T){return(Jl&21)===0?(f.baseState&&(f.baseState=!1,Ta=!0),f.memoizedState=T):(fl(T,g)||(T=Wu(),Bi.lanes|=T,Mf|=T,f.baseState=!0),g)}function VN(f,g){var T=nr;nr=T!==0&&4>T?T:4,f(!0);var O=db.transition;db.transition={};try{f(!1),g()}finally{nr=T,db.transition=O}}function Eb(){return ba().memoizedState}function lI(f,g,T){var O=Ac(f);if(T={lane:O,action:T,hasEagerState:!1,eagerState:null,next:null},nd(f))uI(g,T);else if(T=JC(f,g,T,O),T!==null){var M=Zs();Pc(T,f,O,M),dI(T,g,O)}}function FN(f,g,T){var O=Ac(f),M={lane:O,action:T,hasEagerState:!1,eagerState:null,next:null};if(nd(f))uI(g,M);else{var H=f.alternate;if(f.lanes===0&&(H===null||H.lanes===0)&&(H=g.lastRenderedReducer,H!==null))try{var ae=g.lastRenderedState,Ie=H(ae,T);if(M.hasEagerState=!0,M.eagerState=Ie,fl(Ie,ae)){var xe=g.interleaved;xe===null?(M.next=M,ab(g)):(M.next=xe.next,xe.next=M),g.interleaved=M;return}}catch{}finally{}T=JC(f,g,M,O),T!==null&&(M=Zs(),Pc(T,f,O,M),dI(T,g,O))}}function nd(f){var g=f.alternate;return f===Bi||g!==null&&g===Bi}function uI(f,g){a_=dm=!0;var T=f.pending;T===null?g.next=g:(g.next=T.next,T.next=g),f.pending=g}function dI(f,g,T){if((T&4194240)!==0){var O=g.lanes;O&=f.pendingLanes,T|=O,g.lanes=T,$a(f,T)}}var CE={readContext:wc,useCallback:mo,useContext:mo,useEffect:mo,useImperativeHandle:mo,useInsertionEffect:mo,useLayoutEffect:mo,useMemo:mo,useReducer:mo,useRef:mo,useState:mo,useDebugValue:mo,useDeferredValue:mo,useTransition:mo,useMutableSource:mo,useSyncExternalStore:mo,useId:mo,unstable_isNewReconciler:!1},jN={readContext:wc,useCallback:function(f,g){return Wo().memoizedState=[f,g===void 0?null:g],f},useContext:wc,useEffect:aI,useImperativeHandle:function(f,g,T){return T=T!=null?T.concat([f]):null,u_(4194308,4,gb.bind(null,g,f),T)},useLayoutEffect:function(f,g){return u_(4194308,4,f,g)},useInsertionEffect:function(f,g){return u_(4,2,f,g)},useMemo:function(f,g){var T=Wo();return g=g===void 0?null:g,f=f(),T.memoizedState=[f,g],f},useReducer:function(f,g,T){var O=Wo();return g=T!==void 0?T(g):g,O.memoizedState=O.baseState=g,f={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:f,lastRenderedState:g},O.queue=f,f=f.dispatch=lI.bind(null,Bi,f),[O.memoizedState,f]},useRef:function(f){var g=Wo();return f={current:f},g.memoizedState=f},useState:wE,useDebugValue:td,useDeferredValue:function(f){return Wo().memoizedState=f},useTransition:function(){var f=wE(!1),g=f[0];return f=VN.bind(null,f[1]),Wo().memoizedState=f,[g,f]},useMutableSource:function(){},useSyncExternalStore:function(f,g,T){var O=Bi,M=Wo();if(ai){if(T===void 0)throw Error(i(407));T=T()}else{if(T=g(),zs===null)throw Error(i(349));(Jl&30)!==0||rI(O,g,T)}M.memoizedState=T;var H={value:T,getSnapshot:g};return M.queue=H,aI(iI.bind(null,O,H,f),[f]),O.flags|=2048,l_(9,mb.bind(null,O,H,T,g),void 0,null),T},useId:function(){var f=Wo(),g=zs.identifierPrefix;if(ai){var T=Ju,O=Xu;T=(O&~(1<<32-Xs(O)-1)).toString(32)+T,g=":"+g+"R"+T,T=c_++,0<T&&(g+="H"+T.toString(32)),g+=":"}else T=UN++,g=":"+g+"r"+T.toString(32)+":";return f.memoizedState=g},unstable_isNewReconciler:!1},hI={readContext:wc,useCallback:RE,useContext:wc,useEffect:Rc,useImperativeHandle:_b,useInsertionEffect:Lf,useLayoutEffect:sh,useMemo:cI,useReducer:Df,useRef:oI,useState:function(){return Df(ih)},useDebugValue:td,useDeferredValue:function(f){var g=ba();return yb(g,ms.memoizedState,f)},useTransition:function(){var f=Df(ih)[0],g=ba().memoizedState;return[f,g]},useMutableSource:nI,useSyncExternalStore:pb,useId:Eb,unstable_isNewReconciler:!1},BN={readContext:wc,useCallback:RE,useContext:wc,useEffect:Rc,useImperativeHandle:_b,useInsertionEffect:Lf,useLayoutEffect:sh,useMemo:cI,useReducer:fm,useRef:oI,useState:function(){return fm(ih)},useDebugValue:td,useDeferredValue:function(f){var g=ba();return ms===null?g.memoizedState=f:yb(g,ms.memoizedState,f)},useTransition:function(){var f=fm(ih)[0],g=ba().memoizedState;return[f,g]},useMutableSource:nI,useSyncExternalStore:pb,useId:Eb,unstable_isNewReconciler:!1};function Ja(f,g){if(f&&f.defaultProps){g=Ne({},g),f=f.defaultProps;for(var T in f)g[T]===void 0&&(g[T]=f[T]);return g}return g}function IE(f,g,T,O){g=f.memoizedState,T=T(O,g),T=T==null?g:Ne({},g,T),f.memoizedState=T,f.lanes===0&&(f.updateQueue.baseState=T)}var AE={isMounted:function(f){return(f=f._reactInternals)?Bs(f)===f:!1},enqueueSetState:function(f,g,T){f=f._reactInternals;var O=Zs(),M=Ac(f),H=Yl(O,M);H.payload=g,T!=null&&(H.callback=T),g=nh(f,H,M),g!==null&&(Pc(g,f,M,O),i_(g,f,M))},enqueueReplaceState:function(f,g,T){f=f._reactInternals;var O=Zs(),M=Ac(f),H=Yl(O,M);H.tag=1,H.payload=g,T!=null&&(H.callback=T),g=nh(f,H,M),g!==null&&(Pc(g,f,M,O),i_(g,f,M))},enqueueForceUpdate:function(f,g){f=f._reactInternals;var T=Zs(),O=Ac(f),M=Yl(T,O);M.tag=2,g!=null&&(M.callback=g),g=nh(f,M,O),g!==null&&(Pc(g,f,O,T),i_(g,f,O))}};function vb(f,g,T,O,M,H,ae){return f=f.stateNode,typeof f.shouldComponentUpdate=="function"?f.shouldComponentUpdate(O,H,ae):g.prototype&&g.prototype.isPureReactComponent?!zg(T,O)||!zg(M,H):!0}function fI(f,g,T){var O=!1,M=Qd,H=g.contextType;return typeof H=="object"&&H!==null?H=wc(H):(M=Ea(g)?If:po.current,O=g.contextTypes,H=(O=O!=null)?Af(f,M):Qd),g=new g(T,H),f.memoizedState=g.state!==null&&g.state!==void 0?g.state:null,g.updater=AE,f.stateNode=g,g._reactInternals=f,O&&(f=f.stateNode,f.__reactInternalMemoizedUnmaskedChildContext=M,f.__reactInternalMemoizedMaskedChildContext=H),g}function pI(f,g,T,O){f=g.state,typeof g.componentWillReceiveProps=="function"&&g.componentWillReceiveProps(T,O),typeof g.UNSAFE_componentWillReceiveProps=="function"&&g.UNSAFE_componentWillReceiveProps(T,O),g.state!==f&&AE.enqueueReplaceState(g,g.state,null)}function Sb(f,g,T,O){var M=f.stateNode;M.props=T,M.state=f.memoizedState,M.refs={},r_(f);var H=g.contextType;typeof H=="object"&&H!==null?M.context=wc(H):(H=Ea(g)?If:po.current,M.context=Af(f,H)),M.state=f.memoizedState,H=g.getDerivedStateFromProps,typeof H=="function"&&(IE(f,g,H,T),M.state=f.memoizedState),typeof g.getDerivedStateFromProps=="function"||typeof M.getSnapshotBeforeUpdate=="function"||typeof M.UNSAFE_componentWillMount!="function"&&typeof M.componentWillMount!="function"||(g=M.state,typeof M.componentWillMount=="function"&&M.componentWillMount(),typeof M.UNSAFE_componentWillMount=="function"&&M.UNSAFE_componentWillMount(),g!==M.state&&AE.enqueueReplaceState(M,M.state,null),SE(f,T,M,O),M.state=f.memoizedState),typeof M.componentDidMount=="function"&&(f.flags|=4194308)}function mm(f,g){try{var T="",O=g;do T+=ze(O),O=O.return;while(O);var M=T}catch(H){M=`
Error generating stack: `+H.message+`
`+H.stack}return{value:f,source:g,stack:M,digest:null}}function bb(f,g,T){return{value:f,source:null,stack:T??null,digest:g??null}}function Tb(f,g){try{console.error(g.value)}catch(T){setTimeout(function(){throw T})}}var WN=typeof WeakMap=="function"?WeakMap:Map;function wb(f,g,T){T=Yl(-1,T),T.tag=3,T.payload={element:null};var O=g.value;return T.callback=function(){$E||($E=!0,xb=O),Tb(f,g)},T}function rd(f,g,T){T=Yl(-1,T),T.tag=3;var O=f.type.getDerivedStateFromError;if(typeof O=="function"){var M=g.value;T.payload=function(){return O(M)},T.callback=function(){Tb(f,g)}}var H=f.stateNode;return H!==null&&typeof H.componentDidCatch=="function"&&(T.callback=function(){Tb(f,g),typeof O!="function"&&(oh===null?oh=new Set([this]):oh.add(this));var ae=g.stack;this.componentDidCatch(g.value,{componentStack:ae!==null?ae:""})}),T}function mI(f,g,T){var O=f.pingCache;if(O===null){O=f.pingCache=new WN;var M=new Set;O.set(g,M)}else M=O.get(g),M===void 0&&(M=new Set,O.set(g,M));M.has(T)||(M.add(T),f=FI.bind(null,f,g,T),g.then(f,f))}function gI(f){do{var g;if((g=f.tag===13)&&(g=f.memoizedState,g=g!==null?g.dehydrated!==null:!0),g)return f;f=f.return}while(f!==null);return null}function _I(f,g,T,O,M){return(f.mode&1)===0?(f===g?f.flags|=65536:(f.flags|=128,T.flags|=131072,T.flags&=-52805,T.tag===1&&(T.alternate===null?T.tag=17:(g=Yl(-1,1),g.tag=2,nh(T,g,1))),T.lanes|=1),f):(f.flags|=65536,f.lanes=M,f)}var zN=ce.ReactCurrentOwner,Ta=!1;function zo(f,g,T,O){g.child=f===null?XC(g,null,T,O):am(g,f.child,T,O)}function PE(f,g,T,O,M){T=T.render;var H=g.ref;return Zu(g,M),O=hm(f,g,T,O,H,M),T=fb(),f!==null&&!Ta?(g.updateQueue=f.updateQueue,g.flags&=-2053,f.lanes&=~M,Ql(f,g,M)):(ai&&T&&gE(g),g.flags|=1,zo(f,g,O,M),g.child)}function yI(f,g,T,O,M){if(f===null){var H=T.type;return typeof H=="function"&&!ch(H)&&H.defaultProps===void 0&&T.compare===null&&T.defaultProps===void 0?(g.tag=15,g.type=H,EI(f,g,H,O,M)):(f=iv(T.type,null,O,g,g.mode,M),f.ref=g.ref,f.return=g,g.child=f)}if(H=f.child,(f.lanes&M)===0){var ae=H.memoizedProps;if(T=T.compare,T=T!==null?T:zg,T(ae,O)&&f.ref===g.ref)return Ql(f,g,M)}return g.flags|=1,f=od(H,O),f.ref=g.ref,f.return=g,g.child=f}function EI(f,g,T,O,M){if(f!==null){var H=f.memoizedProps;if(zg(H,O)&&f.ref===g.ref)if(Ta=!1,g.pendingProps=O=H,(f.lanes&M)!==0)(f.flags&131072)!==0&&(Ta=!0);else return g.lanes=f.lanes,Ql(f,g,M)}return Rb(f,g,T,O,M)}function vI(f,g,T){var O=g.pendingProps,M=O.children,H=f!==null?f.memoizedState:null;if(O.mode==="hidden")if((g.mode&1)===0)g.memoizedState={baseLanes:0,cachePool:null,transitions:null},vi(pl,Qa),Qa|=T;else{if((T&1073741824)===0)return f=H!==null?H.baseLanes|T:T,g.lanes=g.childLanes=1073741824,g.memoizedState={baseLanes:f,cachePool:null,transitions:null},g.updateQueue=null,vi(pl,Qa),Qa|=f,null;g.memoizedState={baseLanes:0,cachePool:null,transitions:null},O=H!==null?H.baseLanes:T,vi(pl,Qa),Qa|=O}else H!==null?(O=H.baseLanes|T,g.memoizedState=null):O=T,vi(pl,Qa),Qa|=O;return zo(f,g,M,T),g.child}function SI(f,g){var T=g.ref;(f===null&&T!==null||f!==null&&f.ref!==T)&&(g.flags|=512,g.flags|=2097152)}function Rb(f,g,T,O,M){var H=Ea(T)?If:po.current;return H=Af(g,H),Zu(g,M),T=hm(f,g,T,O,H,M),O=fb(),f!==null&&!Ta?(g.updateQueue=f.updateQueue,g.flags&=-2053,f.lanes&=~M,Ql(f,g,M)):(ai&&O&&gE(g),g.flags|=1,zo(f,g,T,M),g.child)}function bI(f,g,T,O,M){if(Ea(T)){var H=!0;hE(g)}else H=!1;if(Zu(g,M),g.stateNode===null)xE(f,g),fI(g,T,O),Sb(g,T,O,M),O=!0;else if(f===null){var ae=g.stateNode,Ie=g.memoizedProps;ae.props=Ie;var xe=ae.context,it=T.contextType;typeof it=="object"&&it!==null?it=wc(it):(it=Ea(T)?If:po.current,it=Af(g,it));var At=T.getDerivedStateFromProps,Pt=typeof At=="function"||typeof ae.getSnapshotBeforeUpdate=="function";Pt||typeof ae.UNSAFE_componentWillReceiveProps!="function"&&typeof ae.componentWillReceiveProps!="function"||(Ie!==O||xe!==it)&&pI(g,ae,O,it),th=!1;var Ct=g.memoizedState;ae.state=Ct,SE(g,O,ae,M),xe=g.memoizedState,Ie!==O||Ct!==xe||ya.current||th?(typeof At=="function"&&(IE(g,T,At,O),xe=g.memoizedState),(Ie=th||vb(g,T,Ie,O,Ct,xe,it))?(Pt||typeof ae.UNSAFE_componentWillMount!="function"&&typeof ae.componentWillMount!="function"||(typeof ae.componentWillMount=="function"&&ae.componentWillMount(),typeof ae.UNSAFE_componentWillMount=="function"&&ae.UNSAFE_componentWillMount()),typeof ae.componentDidMount=="function"&&(g.flags|=4194308)):(typeof ae.componentDidMount=="function"&&(g.flags|=4194308),g.memoizedProps=O,g.memoizedState=xe),ae.props=O,ae.state=xe,ae.context=it,O=Ie):(typeof ae.componentDidMount=="function"&&(g.flags|=4194308),O=!1)}else{ae=g.stateNode,QC(f,g),Ie=g.memoizedProps,it=g.type===g.elementType?Ie:Ja(g.type,Ie),ae.props=it,Pt=g.pendingProps,Ct=ae.context,xe=T.contextType,typeof xe=="object"&&xe!==null?xe=wc(xe):(xe=Ea(T)?If:po.current,xe=Af(g,xe));var Ht=T.getDerivedStateFromProps;(At=typeof Ht=="function"||typeof ae.getSnapshotBeforeUpdate=="function")||typeof ae.UNSAFE_componentWillReceiveProps!="function"&&typeof ae.componentWillReceiveProps!="function"||(Ie!==Pt||Ct!==xe)&&pI(g,ae,O,xe),th=!1,Ct=g.memoizedState,ae.state=Ct,SE(g,O,ae,M);var en=g.memoizedState;Ie!==Pt||Ct!==en||ya.current||th?(typeof Ht=="function"&&(IE(g,T,Ht,O),en=g.memoizedState),(it=th||vb(g,T,it,O,Ct,en,xe)||!1)?(At||typeof ae.UNSAFE_componentWillUpdate!="function"&&typeof ae.componentWillUpdate!="function"||(typeof ae.componentWillUpdate=="function"&&ae.componentWillUpdate(O,en,xe),typeof ae.UNSAFE_componentWillUpdate=="function"&&ae.UNSAFE_componentWillUpdate(O,en,xe)),typeof ae.componentDidUpdate=="function"&&(g.flags|=4),typeof ae.getSnapshotBeforeUpdate=="function"&&(g.flags|=1024)):(typeof ae.componentDidUpdate!="function"||Ie===f.memoizedProps&&Ct===f.memoizedState||(g.flags|=4),typeof ae.getSnapshotBeforeUpdate!="function"||Ie===f.memoizedProps&&Ct===f.memoizedState||(g.flags|=1024),g.memoizedProps=O,g.memoizedState=en),ae.props=O,ae.state=en,ae.context=xe,O=it):(typeof ae.componentDidUpdate!="function"||Ie===f.memoizedProps&&Ct===f.memoizedState||(g.flags|=4),typeof ae.getSnapshotBeforeUpdate!="function"||Ie===f.memoizedProps&&Ct===f.memoizedState||(g.flags|=1024),O=!1)}return OE(f,g,T,O,H,M)}function OE(f,g,T,O,M,H){SI(f,g);var ae=(g.flags&128)!==0;if(!O&&!ae)return M&&GC(g,T,!1),Ql(f,g,H);O=g.stateNode,zN.current=g;var Ie=ae&&typeof T.getDerivedStateFromError!="function"?null:O.render();return g.flags|=1,f!==null&&ae?(g.child=am(g,f.child,null,H),g.child=am(g,null,Ie,H)):zo(f,g,Ie,H),g.memoizedState=O.state,M&&GC(g,T,!0),g.child}function Cb(f){var g=f.stateNode;g.pendingContext?zC(f,g.pendingContext,g.pendingContext!==g.context):g.context&&zC(f,g.context,!1),cb(f,g.containerInfo)}function TI(f,g,T,O,M){return om(),nb(M),g.flags|=256,zo(f,g,T,O),g.child}var Ib={dehydrated:null,treeContext:null,retryLane:0};function gm(f){return{baseLanes:f,cachePool:null,transitions:null}}function kE(f,g,T){var O=g.pendingProps,M=Ni.current,H=!1,ae=(g.flags&128)!==0,Ie;if((Ie=ae)||(Ie=f!==null&&f.memoizedState===null?!1:(M&2)!==0),Ie?(H=!0,g.flags&=-129):(f===null||f.memoizedState!==null)&&(M|=1),vi(Ni,M&1),f===null)return tb(g),f=g.memoizedState,f!==null&&(f=f.dehydrated,f!==null)?((g.mode&1)===0?g.lanes=1:f.data==="$!"?g.lanes=8:g.lanes=1073741824,null):(ae=O.children,f=O.fallback,H?(O=g.mode,H=g.child,ae={mode:"hidden",children:ae},(O&1)===0&&H!==null?(H.childLanes=0,H.pendingProps=ae):H=lh(ae,O,0,null),f=Bf(f,O,T,null),H.return=g,f.return=g,H.sibling=f,g.child=H,g.child.memoizedState=gm(T),g.memoizedState=Ib,f):NE(g,ae));if(M=f.memoizedState,M!==null&&(Ie=M.dehydrated,Ie!==null))return wI(f,g,ae,O,Ie,M,T);if(H){H=O.fallback,ae=g.mode,M=f.child,Ie=M.sibling;var xe={mode:"hidden",children:O.children};return(ae&1)===0&&g.child!==M?(O=g.child,O.childLanes=0,O.pendingProps=xe,g.deletions=null):(O=od(M,xe),O.subtreeFlags=M.subtreeFlags&14680064),Ie!==null?H=od(Ie,H):(H=Bf(H,ae,T,null),H.flags|=2),H.return=g,O.return=g,O.sibling=H,g.child=O,O=H,H=g.child,ae=f.child.memoizedState,ae=ae===null?gm(T):{baseLanes:ae.baseLanes|T,cachePool:null,transitions:ae.transitions},H.memoizedState=ae,H.childLanes=f.childLanes&~T,g.memoizedState=Ib,O}return H=f.child,f=H.sibling,O=od(H,{mode:"visible",children:O.children}),(g.mode&1)===0&&(O.lanes=T),O.return=g,O.sibling=null,f!==null&&(T=g.deletions,T===null?(g.deletions=[f],g.flags|=16):T.push(f)),g.child=O,g.memoizedState=null,O}function NE(f,g){return g=lh({mode:"visible",children:g},f.mode,0,null),g.return=f,f.child=g}function xf(f,g,T,O){return O!==null&&nb(O),am(g,f.child,null,T),f=NE(g,g.pendingProps.children),f.flags|=2,g.memoizedState=null,f}function wI(f,g,T,O,M,H,ae){if(T)return g.flags&256?(g.flags&=-257,O=bb(Error(i(422))),xf(f,g,ae,O)):g.memoizedState!==null?(g.child=f.child,g.flags|=128,null):(H=O.fallback,M=g.mode,O=lh({mode:"visible",children:O.children},M,0,null),H=Bf(H,M,ae,null),H.flags|=2,O.return=g,H.return=g,O.sibling=H,g.child=O,(g.mode&1)!==0&&am(g,f.child,null,ae),g.child.memoizedState=gm(ae),g.memoizedState=Ib,H);if((g.mode&1)===0)return xf(f,g,ae,null);if(M.data==="$!"){if(O=M.nextSibling&&M.nextSibling.dataset,O)var Ie=O.dgst;return O=Ie,H=Error(i(419)),O=bb(H,O,void 0),xf(f,g,ae,O)}if(Ie=(ae&f.childLanes)!==0,Ta||Ie){if(O=zs,O!==null){switch(ae&-ae){case 4:M=2;break;case 16:M=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:M=32;break;case 536870912:M=268435456;break;default:M=0}M=(M&(O.suspendedLanes|ae))!==0?0:M,M!==0&&M!==H.retryLane&&(H.retryLane=M,ed(f,M),Pc(O,f,M,-1))}return Vb(),O=bb(Error(i(421))),xf(f,g,ae,O)}return M.data==="$?"?(g.flags|=128,g.child=f.child,g=tv.bind(null,f),M._reactRetry=g,null):(f=H.treeContext,Sa=Xd(M.nextSibling),va=g,ai=!0,Bo=null,f!==null&&(Tc[Xa++]=Xu,Tc[Xa++]=Ju,Tc[Xa++]=Pf,Xu=f.id,Ju=f.overflow,Pf=g),g=NE(g,O.children),g.flags|=4096,g)}function RI(f,g,T){f.lanes|=g;var O=f.alternate;O!==null&&(O.lanes|=g),ob(f.return,g,T)}function DE(f,g,T,O,M){var H=f.memoizedState;H===null?f.memoizedState={isBackwards:g,rendering:null,renderingStartTime:0,last:O,tail:T,tailMode:M}:(H.isBackwards=g,H.rendering=null,H.renderingStartTime=0,H.last=O,H.tail=T,H.tailMode=M)}function LE(f,g,T){var O=g.pendingProps,M=O.revealOrder,H=O.tail;if(zo(f,g,O.children,T),O=Ni.current,(O&2)!==0)O=O&1|2,g.flags|=128;else{if(f!==null&&(f.flags&128)!==0)e:for(f=g.child;f!==null;){if(f.tag===13)f.memoizedState!==null&&RI(f,T,g);else if(f.tag===19)RI(f,T,g);else if(f.child!==null){f.child.return=f,f=f.child;continue}if(f===g)break e;for(;f.sibling===null;){if(f.return===null||f.return===g)break e;f=f.return}f.sibling.return=f.return,f=f.sibling}O&=1}if(vi(Ni,O),(g.mode&1)===0)g.memoizedState=null;else switch(M){case"forwards":for(T=g.child,M=null;T!==null;)f=T.alternate,f!==null&&rh(f)===null&&(M=T),T=T.sibling;T=M,T===null?(M=g.child,g.child=null):(M=T.sibling,T.sibling=null),DE(g,!1,M,T,H);break;case"backwards":for(T=null,M=g.child,g.child=null;M!==null;){if(f=M.alternate,f!==null&&rh(f)===null){g.child=M;break}f=M.sibling,M.sibling=T,T=M,M=f}DE(g,!0,T,null,H);break;case"together":DE(g,!1,null,null,void 0);break;default:g.memoizedState=null}return g.child}function xE(f,g){(g.mode&1)===0&&f!==null&&(f.alternate=null,g.alternate=null,g.flags|=2)}function Ql(f,g,T){if(f!==null&&(g.dependencies=f.dependencies),Mf|=g.lanes,(T&g.childLanes)===0)return null;if(f!==null&&g.child!==f.child)throw Error(i(153));if(g.child!==null){for(f=g.child,T=od(f,f.pendingProps),g.child=T,T.return=g;f.sibling!==null;)f=f.sibling,T=T.sibling=od(f,f.pendingProps),T.return=g;T.sibling=null}return g.child}function CI(f,g,T){switch(g.tag){case 3:Cb(g),om();break;case 5:tI(g);break;case 1:Ea(g.type)&&hE(g);break;case 4:cb(g,g.stateNode.containerInfo);break;case 10:var O=g.type._context,M=g.memoizedProps.value;vi(EE,O._currentValue),O._currentValue=M;break;case 13:if(O=g.memoizedState,O!==null)return O.dehydrated!==null?(vi(Ni,Ni.current&1),g.flags|=128,null):(T&g.child.childLanes)!==0?kE(f,g,T):(vi(Ni,Ni.current&1),f=Ql(f,g,T),f!==null?f.sibling:null);vi(Ni,Ni.current&1);break;case 19:if(O=(T&g.childLanes)!==0,(f.flags&128)!==0){if(O)return LE(f,g,T);g.flags|=128}if(M=g.memoizedState,M!==null&&(M.rendering=null,M.tail=null,M.lastEffect=null),vi(Ni,Ni.current),O)break;return null;case 22:case 23:return g.lanes=0,vI(f,g,T)}return Ql(f,g,T)}var II,ME,Ab,AI;II=function(f,g){for(var T=g.child;T!==null;){if(T.tag===5||T.tag===6)f.appendChild(T.stateNode);else if(T.tag!==4&&T.child!==null){T.child.return=T,T=T.child;continue}if(T===g)break;for(;T.sibling===null;){if(T.return===null||T.return===g)return;T=T.return}T.sibling.return=T.return,T=T.sibling}},ME=function(){},Ab=function(f,g,T,O){var M=f.memoizedProps;if(M!==O){f=g.stateNode,kf(Xl.current);var H=null;switch(T){case"input":M=xn(f,M),O=xn(f,O),H=[];break;case"select":M=Ne({},M,{value:void 0}),O=Ne({},O,{value:void 0}),H=[];break;case"textarea":M=bt(f,M),O=bt(f,O),H=[];break;default:typeof M.onClick!="function"&&typeof O.onClick=="function"&&(f.onclick=cE)}Wa(T,O);var ae;T=null;for(it in M)if(!O.hasOwnProperty(it)&&M.hasOwnProperty(it)&&M[it]!=null)if(it==="style"){var Ie=M[it];for(ae in Ie)Ie.hasOwnProperty(ae)&&(T||(T={}),T[ae]="")}else it!=="dangerouslySetInnerHTML"&&it!=="children"&&it!=="suppressContentEditableWarning"&&it!=="suppressHydrationWarning"&&it!=="autoFocus"&&(l.hasOwnProperty(it)?H||(H=[]):(H=H||[]).push(it,null));for(it in O){var xe=O[it];if(Ie=M!=null?M[it]:void 0,O.hasOwnProperty(it)&&xe!==Ie&&(xe!=null||Ie!=null))if(it==="style")if(Ie){for(ae in Ie)!Ie.hasOwnProperty(ae)||xe&&xe.hasOwnProperty(ae)||(T||(T={}),T[ae]="");for(ae in xe)xe.hasOwnProperty(ae)&&Ie[ae]!==xe[ae]&&(T||(T={}),T[ae]=xe[ae])}else T||(H||(H=[]),H.push(it,T)),T=xe;else it==="dangerouslySetInnerHTML"?(xe=xe?xe.__html:void 0,Ie=Ie?Ie.__html:void 0,xe!=null&&Ie!==xe&&(H=H||[]).push(it,xe)):it==="children"?typeof xe!="string"&&typeof xe!="number"||(H=H||[]).push(it,""+xe):it!=="suppressContentEditableWarning"&&it!=="suppressHydrationWarning"&&(l.hasOwnProperty(it)?(xe!=null&&it==="onScroll"&&Ci("scroll",f),H||Ie===xe||(H=[])):(H=H||[]).push(it,xe))}T&&(H=H||[]).push("style",T);var it=H;(g.updateQueue=it)&&(g.flags|=4)}},AI=function(f,g,T,O){T!==O&&(g.flags|=4)};function d_(f,g){if(!ai)switch(f.tailMode){case"hidden":g=f.tail;for(var T=null;g!==null;)g.alternate!==null&&(T=g),g=g.sibling;T===null?f.tail=null:T.sibling=null;break;case"collapsed":T=f.tail;for(var O=null;T!==null;)T.alternate!==null&&(O=T),T=T.sibling;O===null?g||f.tail===null?f.tail=null:f.tail.sibling=null:O.sibling=null}}function go(f){var g=f.alternate!==null&&f.alternate.child===f.child,T=0,O=0;if(g)for(var M=f.child;M!==null;)T|=M.lanes|M.childLanes,O|=M.subtreeFlags&14680064,O|=M.flags&14680064,M.return=f,M=M.sibling;else for(M=f.child;M!==null;)T|=M.lanes|M.childLanes,O|=M.subtreeFlags,O|=M.flags,M.return=f,M=M.sibling;return f.subtreeFlags|=O,f.childLanes=T,g}function UE(f,g,T){var O=g.pendingProps;switch(Zg(g),g.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return go(g),null;case 1:return Ea(g.type)&&uE(),go(g),null;case 3:return O=g.stateNode,Nf(),Ii(ya),Ii(po),ub(),O.pendingContext&&(O.context=O.pendingContext,O.pendingContext=null),(f===null||f.child===null)&&(e_(g)?g.flags|=4:f===null||f.memoizedState.isDehydrated&&(g.flags&256)===0||(g.flags|=1024,Bo!==null&&(JE(Bo),Bo=null))),ME(f,g),go(g),null;case 5:um(g);var M=kf(lm.current);if(T=g.type,f!==null&&g.stateNode!=null)Ab(f,g,T,O,M),f.ref!==g.ref&&(g.flags|=512,g.flags|=2097152);else{if(!O){if(g.stateNode===null)throw Error(i(166));return go(g),null}if(f=kf(Xl.current),e_(g)){O=g.stateNode,T=g.type;var H=g.memoizedProps;switch(O[ql]=g,O[Jd]=H,f=(g.mode&1)!==0,T){case"dialog":Ci("cancel",O),Ci("close",O);break;case"iframe":case"object":case"embed":Ci("load",O);break;case"video":case"audio":for(M=0;M<Kg.length;M++)Ci(Kg[M],O);break;case"source":Ci("error",O);break;case"img":case"image":case"link":Ci("error",O),Ci("load",O);break;case"details":Ci("toggle",O);break;case"input":Xt(O,H),Ci("invalid",O);break;case"select":O._wrapperState={wasMultiple:!!H.multiple},Ci("invalid",O);break;case"textarea":Ge(O,H),Ci("invalid",O)}Wa(T,H),M=null;for(var ae in H)if(H.hasOwnProperty(ae)){var Ie=H[ae];ae==="children"?typeof Ie=="string"?O.textContent!==Ie&&(H.suppressHydrationWarning!==!0&&aE(O.textContent,Ie,f),M=["children",Ie]):typeof Ie=="number"&&O.textContent!==""+Ie&&(H.suppressHydrationWarning!==!0&&aE(O.textContent,Ie,f),M=["children",""+Ie]):l.hasOwnProperty(ae)&&Ie!=null&&ae==="onScroll"&&Ci("scroll",O)}switch(T){case"input":hn(O),Re(O,H,!0);break;case"textarea":hn(O),Jt(O);break;case"select":case"option":break;default:typeof H.onClick=="function"&&(O.onclick=cE)}O=M,g.updateQueue=O,O!==null&&(g.flags|=4)}else{ae=M.nodeType===9?M:M.ownerDocument,f==="http://www.w3.org/1999/xhtml"&&(f=fn(T)),f==="http://www.w3.org/1999/xhtml"?T==="script"?(f=ae.createElement("div"),f.innerHTML="<script><\/script>",f=f.removeChild(f.firstChild)):typeof O.is=="string"?f=ae.createElement(T,{is:O.is}):(f=ae.createElement(T),T==="select"&&(ae=f,O.multiple?ae.multiple=!0:O.size&&(ae.size=O.size))):f=ae.createElementNS(f,T),f[ql]=g,f[Jd]=O,II(f,g,!1,!1),g.stateNode=f;e:{switch(ae=il(T,O),T){case"dialog":Ci("cancel",f),Ci("close",f),M=O;break;case"iframe":case"object":case"embed":Ci("load",f),M=O;break;case"video":case"audio":for(M=0;M<Kg.length;M++)Ci(Kg[M],f);M=O;break;case"source":Ci("error",f),M=O;break;case"img":case"image":case"link":Ci("error",f),Ci("load",f),M=O;break;case"details":Ci("toggle",f),M=O;break;case"input":Xt(f,O),M=xn(f,O),Ci("invalid",f);break;case"option":M=O;break;case"select":f._wrapperState={wasMultiple:!!O.multiple},M=Ne({},O,{value:void 0}),Ci("invalid",f);break;case"textarea":Ge(f,O),M=bt(f,O),Ci("invalid",f);break;default:M=O}Wa(T,M),Ie=M;for(H in Ie)if(Ie.hasOwnProperty(H)){var xe=Ie[H];H==="style"?Ri(f,xe):H==="dangerouslySetInnerHTML"?(xe=xe?xe.__html:void 0,xe!=null&&la(f,xe)):H==="children"?typeof xe=="string"?(T!=="textarea"||xe!=="")&&Vt(f,xe):typeof xe=="number"&&Vt(f,""+xe):H!=="suppressContentEditableWarning"&&H!=="suppressHydrationWarning"&&H!=="autoFocus"&&(l.hasOwnProperty(H)?xe!=null&&H==="onScroll"&&Ci("scroll",f):xe!=null&&ne(f,H,xe,ae))}switch(T){case"input":hn(f),Re(f,O,!1);break;case"textarea":hn(f),Jt(f);break;case"option":O.value!=null&&f.setAttribute("value",""+dt(O.value));break;case"select":f.multiple=!!O.multiple,H=O.value,H!=null?Et(f,!!O.multiple,H,!1):O.defaultValue!=null&&Et(f,!!O.multiple,O.defaultValue,!0);break;default:typeof M.onClick=="function"&&(f.onclick=cE)}switch(T){case"button":case"input":case"select":case"textarea":O=!!O.autoFocus;break e;case"img":O=!0;break e;default:O=!1}}O&&(g.flags|=4)}g.ref!==null&&(g.flags|=512,g.flags|=2097152)}return go(g),null;case 6:if(f&&g.stateNode!=null)AI(f,g,f.memoizedProps,O);else{if(typeof O!="string"&&g.stateNode===null)throw Error(i(166));if(T=kf(lm.current),kf(Xl.current),e_(g)){if(O=g.stateNode,T=g.memoizedProps,O[ql]=g,(H=O.nodeValue!==T)&&(f=va,f!==null))switch(f.tag){case 3:aE(O.nodeValue,T,(f.mode&1)!==0);break;case 5:f.memoizedProps.suppressHydrationWarning!==!0&&aE(O.nodeValue,T,(f.mode&1)!==0)}H&&(g.flags|=4)}else O=(T.nodeType===9?T:T.ownerDocument).createTextNode(O),O[ql]=g,g.stateNode=O}return go(g),null;case 13:if(Ii(Ni),O=g.memoizedState,f===null||f.memoizedState!==null&&f.memoizedState.dehydrated!==null){if(ai&&Sa!==null&&(g.mode&1)!==0&&(g.flags&128)===0)YC(),om(),g.flags|=98560,H=!1;else if(H=e_(g),O!==null&&O.dehydrated!==null){if(f===null){if(!H)throw Error(i(318));if(H=g.memoizedState,H=H!==null?H.dehydrated:null,!H)throw Error(i(317));H[ql]=g}else om(),(g.flags&128)===0&&(g.memoizedState=null),g.flags|=4;go(g),H=!1}else Bo!==null&&(JE(Bo),Bo=null),H=!0;if(!H)return g.flags&65536?g:null}return(g.flags&128)!==0?(g.lanes=T,g):(O=O!==null,O!==(f!==null&&f.memoizedState!==null)&&O&&(g.child.flags|=8192,(g.mode&1)!==0&&(f===null||(Ni.current&1)!==0?ys===0&&(ys=3):Vb())),g.updateQueue!==null&&(g.flags|=4),go(g),null);case 4:return Nf(),ME(f,g),f===null&&Tf(g.stateNode.containerInfo),go(g),null;case 10:return sb(g.type._context),go(g),null;case 17:return Ea(g.type)&&uE(),go(g),null;case 19:if(Ii(Ni),H=g.memoizedState,H===null)return go(g),null;if(O=(g.flags&128)!==0,ae=H.rendering,ae===null)if(O)d_(H,!1);else{if(ys!==0||f!==null&&(f.flags&128)!==0)for(f=g.child;f!==null;){if(ae=rh(f),ae!==null){for(g.flags|=128,d_(H,!1),O=ae.updateQueue,O!==null&&(g.updateQueue=O,g.flags|=4),g.subtreeFlags=0,O=T,T=g.child;T!==null;)H=T,f=O,H.flags&=14680066,ae=H.alternate,ae===null?(H.childLanes=0,H.lanes=f,H.child=null,H.subtreeFlags=0,H.memoizedProps=null,H.memoizedState=null,H.updateQueue=null,H.dependencies=null,H.stateNode=null):(H.childLanes=ae.childLanes,H.lanes=ae.lanes,H.child=ae.child,H.subtreeFlags=0,H.deletions=null,H.memoizedProps=ae.memoizedProps,H.memoizedState=ae.memoizedState,H.updateQueue=ae.updateQueue,H.type=ae.type,f=ae.dependencies,H.dependencies=f===null?null:{lanes:f.lanes,firstContext:f.firstContext}),T=T.sibling;return vi(Ni,Ni.current&1|2),g.child}f=f.sibling}H.tail!==null&&Fr()>Em&&(g.flags|=128,O=!0,d_(H,!1),g.lanes=4194304)}else{if(!O)if(f=rh(ae),f!==null){if(g.flags|=128,O=!0,T=f.updateQueue,T!==null&&(g.updateQueue=T,g.flags|=4),d_(H,!0),H.tail===null&&H.tailMode==="hidden"&&!ae.alternate&&!ai)return go(g),null}else 2*Fr()-H.renderingStartTime>Em&&T!==1073741824&&(g.flags|=128,O=!0,d_(H,!1),g.lanes=4194304);H.isBackwards?(ae.sibling=g.child,g.child=ae):(T=H.last,T!==null?T.sibling=ae:g.child=ae,H.last=ae)}return H.tail!==null?(g=H.tail,H.rendering=g,H.tail=g.sibling,H.renderingStartTime=Fr(),g.sibling=null,T=Ni.current,vi(Ni,O?T&1|2:T&1),g):(go(g),null);case 22:case 23:return E_(),O=g.memoizedState!==null,f!==null&&f.memoizedState!==null!==O&&(g.flags|=8192),O&&(g.mode&1)!==0?(Qa&1073741824)!==0&&(go(g),g.subtreeFlags&6&&(g.flags|=8192)):go(g),null;case 24:return null;case 25:return null}throw Error(i(156,g.tag))}function GN(f,g){switch(Zg(g),g.tag){case 1:return Ea(g.type)&&uE(),f=g.flags,f&65536?(g.flags=f&-65537|128,g):null;case 3:return Nf(),Ii(ya),Ii(po),ub(),f=g.flags,(f&65536)!==0&&(f&128)===0?(g.flags=f&-65537|128,g):null;case 5:return um(g),null;case 13:if(Ii(Ni),f=g.memoizedState,f!==null&&f.dehydrated!==null){if(g.alternate===null)throw Error(i(340));om()}return f=g.flags,f&65536?(g.flags=f&-65537|128,g):null;case 19:return Ii(Ni),null;case 4:return Nf(),null;case 10:return sb(g.type._context),null;case 22:case 23:return E_(),null;case 24:return null;default:return null}}var VE=!1,_o=!1,PI=typeof WeakSet=="function"?WeakSet:Set,Qt=null;function _m(f,g){var T=f.ref;if(T!==null)if(typeof T=="function")try{T(null)}catch(O){Wi(f,g,O)}else T.current=null}function h_(f,g,T){try{T()}catch(O){Wi(f,g,O)}}var OI=!1;function Pb(f,g){if(lE=Se,f=kC(),Gg(f)){if("selectionStart"in f)var T={start:f.selectionStart,end:f.selectionEnd};else e:{T=(T=f.ownerDocument)&&T.defaultView||window;var O=T.getSelection&&T.getSelection();if(O&&O.rangeCount!==0){T=O.anchorNode;var M=O.anchorOffset,H=O.focusNode;O=O.focusOffset;try{T.nodeType,H.nodeType}catch{T=null;break e}var ae=0,Ie=-1,xe=-1,it=0,At=0,Pt=f,Ct=null;t:for(;;){for(var Ht;Pt!==T||M!==0&&Pt.nodeType!==3||(Ie=ae+M),Pt!==H||O!==0&&Pt.nodeType!==3||(xe=ae+O),Pt.nodeType===3&&(ae+=Pt.nodeValue.length),(Ht=Pt.firstChild)!==null;)Ct=Pt,Pt=Ht;for(;;){if(Pt===f)break t;if(Ct===T&&++it===M&&(Ie=ae),Ct===H&&++At===O&&(xe=ae),(Ht=Pt.nextSibling)!==null)break;Pt=Ct,Ct=Pt.parentNode}Pt=Ht}T=Ie===-1||xe===-1?null:{start:Ie,end:xe}}else T=null}T=T||{start:0,end:0}}else T=null;for(Yg={focusedElem:f,selectionRange:T},Se=!1,Qt=g;Qt!==null;)if(g=Qt,f=g.child,(g.subtreeFlags&1028)!==0&&f!==null)f.return=g,Qt=f;else for(;Qt!==null;){g=Qt;try{var en=g.alternate;if((g.flags&1024)!==0)switch(g.tag){case 0:case 11:case 15:break;case 1:if(en!==null){var tn=en.memoizedProps,Zi=en.memoizedState,Je=g.stateNode,Ve=Je.getSnapshotBeforeUpdate(g.elementType===g.type?tn:Ja(g.type,tn),Zi);Je.__reactInternalSnapshotBeforeUpdate=Ve}break;case 3:var Ze=g.stateNode.containerInfo;Ze.nodeType===1?Ze.textContent="":Ze.nodeType===9&&Ze.documentElement&&Ze.removeChild(Ze.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(i(163))}}catch(Dt){Wi(g,g.return,Dt)}if(f=g.sibling,f!==null){f.return=g.return,Qt=f;break}Qt=g.return}return en=OI,OI=!1,en}function f_(f,g,T){var O=g.updateQueue;if(O=O!==null?O.lastEffect:null,O!==null){var M=O=O.next;do{if((M.tag&f)===f){var H=M.destroy;M.destroy=void 0,H!==void 0&&h_(g,T,H)}M=M.next}while(M!==O)}}function p_(f,g){if(g=g.updateQueue,g=g!==null?g.lastEffect:null,g!==null){var T=g=g.next;do{if((T.tag&f)===f){var O=T.create;T.destroy=O()}T=T.next}while(T!==g)}}function Ob(f){var g=f.ref;if(g!==null){var T=f.stateNode;switch(f.tag){case 5:f=T;break;default:f=T}typeof g=="function"?g(f):g.current=f}}function kI(f){var g=f.alternate;g!==null&&(f.alternate=null,kI(g)),f.child=null,f.deletions=null,f.sibling=null,f.tag===5&&(g=f.stateNode,g!==null&&(delete g[ql],delete g[Jd],delete g[Jg],delete g[DN],delete g[LN])),f.stateNode=null,f.return=null,f.dependencies=null,f.memoizedProps=null,f.memoizedState=null,f.pendingProps=null,f.stateNode=null,f.updateQueue=null}function kb(f){return f.tag===5||f.tag===3||f.tag===4}function NI(f){e:for(;;){for(;f.sibling===null;){if(f.return===null||kb(f.return))return null;f=f.return}for(f.sibling.return=f.return,f=f.sibling;f.tag!==5&&f.tag!==6&&f.tag!==18;){if(f.flags&2||f.child===null||f.tag===4)continue e;f.child.return=f,f=f.child}if(!(f.flags&2))return f.stateNode}}function Nb(f,g,T){var O=f.tag;if(O===5||O===6)f=f.stateNode,g?T.nodeType===8?T.parentNode.insertBefore(f,g):T.insertBefore(f,g):(T.nodeType===8?(g=T.parentNode,g.insertBefore(f,T)):(g=T,g.appendChild(f)),T=T._reactRootContainer,T!=null||g.onclick!==null||(g.onclick=cE));else if(O!==4&&(f=f.child,f!==null))for(Nb(f,g,T),f=f.sibling;f!==null;)Nb(f,g,T),f=f.sibling}function FE(f,g,T){var O=f.tag;if(O===5||O===6)f=f.stateNode,g?T.insertBefore(f,g):T.appendChild(f);else if(O!==4&&(f=f.child,f!==null))for(FE(f,g,T),f=f.sibling;f!==null;)FE(f,g,T),f=f.sibling}var Js=null,Cc=!1;function Zl(f,g,T){for(T=T.child;T!==null;)DI(f,g,T),T=T.sibling}function DI(f,g,T){if(fo&&typeof fo.onCommitFiberUnmount=="function")try{fo.onCommitFiberUnmount(jl,T)}catch{}switch(T.tag){case 5:_o||_m(T,g);case 6:var O=Js,M=Cc;Js=null,Zl(f,g,T),Js=O,Cc=M,Js!==null&&(Cc?(f=Js,T=T.stateNode,f.nodeType===8?f.parentNode.removeChild(T):f.removeChild(T)):Js.removeChild(T.stateNode));break;case 18:Js!==null&&(Cc?(f=Js,T=T.stateNode,f.nodeType===8?Q0(f.parentNode,T):f.nodeType===1&&Q0(f,T),ga(f)):Q0(Js,T.stateNode));break;case 4:O=Js,M=Cc,Js=T.stateNode.containerInfo,Cc=!0,Zl(f,g,T),Js=O,Cc=M;break;case 0:case 11:case 14:case 15:if(!_o&&(O=T.updateQueue,O!==null&&(O=O.lastEffect,O!==null))){M=O=O.next;do{var H=M,ae=H.destroy;H=H.tag,ae!==void 0&&((H&2)!==0||(H&4)!==0)&&h_(T,g,ae),M=M.next}while(M!==O)}Zl(f,g,T);break;case 1:if(!_o&&(_m(T,g),O=T.stateNode,typeof O.componentWillUnmount=="function"))try{O.props=T.memoizedProps,O.state=T.memoizedState,O.componentWillUnmount()}catch(Ie){Wi(T,g,Ie)}Zl(f,g,T);break;case 21:Zl(f,g,T);break;case 22:T.mode&1?(_o=(O=_o)||T.memoizedState!==null,Zl(f,g,T),_o=O):Zl(f,g,T);break;default:Zl(f,g,T)}}function LI(f){var g=f.updateQueue;if(g!==null){f.updateQueue=null;var T=f.stateNode;T===null&&(T=f.stateNode=new PI),g.forEach(function(O){var M=jI.bind(null,f,O);T.has(O)||(T.add(O),O.then(M,M))})}}function Go(f,g){var T=g.deletions;if(T!==null)for(var O=0;O<T.length;O++){var M=T[O];try{var H=f,ae=g,Ie=ae;e:for(;Ie!==null;){switch(Ie.tag){case 5:Js=Ie.stateNode,Cc=!1;break e;case 3:Js=Ie.stateNode.containerInfo,Cc=!0;break e;case 4:Js=Ie.stateNode.containerInfo,Cc=!0;break e}Ie=Ie.return}if(Js===null)throw Error(i(160));DI(H,ae,M),Js=null,Cc=!1;var xe=M.alternate;xe!==null&&(xe.return=null),M.return=null}catch(it){Wi(M,g,it)}}if(g.subtreeFlags&12854)for(g=g.child;g!==null;)Db(g,f),g=g.sibling}function Db(f,g){var T=f.alternate,O=f.flags;switch(f.tag){case 0:case 11:case 14:case 15:if(Go(g,f),wa(f),O&4){try{f_(3,f,f.return),p_(3,f)}catch(tn){Wi(f,f.return,tn)}try{f_(5,f,f.return)}catch(tn){Wi(f,f.return,tn)}}break;case 1:Go(g,f),wa(f),O&512&&T!==null&&_m(T,T.return);break;case 5:if(Go(g,f),wa(f),O&512&&T!==null&&_m(T,T.return),f.flags&32){var M=f.stateNode;try{Vt(M,"")}catch(tn){Wi(f,f.return,tn)}}if(O&4&&(M=f.stateNode,M!=null)){var H=f.memoizedProps,ae=T!==null?T.memoizedProps:H,Ie=f.type,xe=f.updateQueue;if(f.updateQueue=null,xe!==null)try{Ie==="input"&&H.type==="radio"&&H.name!=null&&Yn(M,H),il(Ie,ae);var it=il(Ie,H);for(ae=0;ae<xe.length;ae+=2){var At=xe[ae],Pt=xe[ae+1];At==="style"?Ri(M,Pt):At==="dangerouslySetInnerHTML"?la(M,Pt):At==="children"?Vt(M,Pt):ne(M,At,Pt,it)}switch(Ie){case"input":qt(M,H);break;case"textarea":Ot(M,H);break;case"select":var Ct=M._wrapperState.wasMultiple;M._wrapperState.wasMultiple=!!H.multiple;var Ht=H.value;Ht!=null?Et(M,!!H.multiple,Ht,!1):Ct!==!!H.multiple&&(H.defaultValue!=null?Et(M,!!H.multiple,H.defaultValue,!0):Et(M,!!H.multiple,H.multiple?[]:"",!1))}M[Jd]=H}catch(tn){Wi(f,f.return,tn)}}break;case 6:if(Go(g,f),wa(f),O&4){if(f.stateNode===null)throw Error(i(162));M=f.stateNode,H=f.memoizedProps;try{M.nodeValue=H}catch(tn){Wi(f,f.return,tn)}}break;case 3:if(Go(g,f),wa(f),O&4&&T!==null&&T.memoizedState.isDehydrated)try{ga(g.containerInfo)}catch(tn){Wi(f,f.return,tn)}break;case 4:Go(g,f),wa(f);break;case 13:Go(g,f),wa(f),M=f.child,M.flags&8192&&(H=M.memoizedState!==null,M.stateNode.isHidden=H,!H||M.alternate!==null&&M.alternate.memoizedState!==null||(HE=Fr())),O&4&&LI(f);break;case 22:if(At=T!==null&&T.memoizedState!==null,f.mode&1?(_o=(it=_o)||At,Go(g,f),_o=it):Go(g,f),wa(f),O&8192){if(it=f.memoizedState!==null,(f.stateNode.isHidden=it)&&!At&&(f.mode&1)!==0)for(Qt=f,At=f.child;At!==null;){for(Pt=Qt=At;Qt!==null;){switch(Ct=Qt,Ht=Ct.child,Ct.tag){case 0:case 11:case 14:case 15:f_(4,Ct,Ct.return);break;case 1:_m(Ct,Ct.return);var en=Ct.stateNode;if(typeof en.componentWillUnmount=="function"){O=Ct,T=Ct.return;try{g=O,en.props=g.memoizedProps,en.state=g.memoizedState,en.componentWillUnmount()}catch(tn){Wi(O,T,tn)}}break;case 5:_m(Ct,Ct.return);break;case 22:if(Ct.memoizedState!==null){m_(Pt);continue}}Ht!==null?(Ht.return=Ct,Qt=Ht):m_(Pt)}At=At.sibling}e:for(At=null,Pt=f;;){if(Pt.tag===5){if(At===null){At=Pt;try{M=Pt.stateNode,it?(H=M.style,typeof H.setProperty=="function"?H.setProperty("display","none","important"):H.display="none"):(Ie=Pt.stateNode,xe=Pt.memoizedProps.style,ae=xe!=null&&xe.hasOwnProperty("display")?xe.display:null,Ie.style.display=_i("display",ae))}catch(tn){Wi(f,f.return,tn)}}}else if(Pt.tag===6){if(At===null)try{Pt.stateNode.nodeValue=it?"":Pt.memoizedProps}catch(tn){Wi(f,f.return,tn)}}else if((Pt.tag!==22&&Pt.tag!==23||Pt.memoizedState===null||Pt===f)&&Pt.child!==null){Pt.child.return=Pt,Pt=Pt.child;continue}if(Pt===f)break e;for(;Pt.sibling===null;){if(Pt.return===null||Pt.return===f)break e;At===Pt&&(At=null),Pt=Pt.return}At===Pt&&(At=null),Pt.sibling.return=Pt.return,Pt=Pt.sibling}}break;case 19:Go(g,f),wa(f),O&4&&LI(f);break;case 21:break;default:Go(g,f),wa(f)}}function wa(f){var g=f.flags;if(g&2){try{e:{for(var T=f.return;T!==null;){if(kb(T)){var O=T;break e}T=T.return}throw Error(i(160))}switch(O.tag){case 5:var M=O.stateNode;O.flags&32&&(Vt(M,""),O.flags&=-33);var H=NI(f);FE(f,H,M);break;case 3:case 4:var ae=O.stateNode.containerInfo,Ie=NI(f);Nb(f,Ie,ae);break;default:throw Error(i(161))}}catch(xe){Wi(f,f.return,xe)}f.flags&=-3}g&4096&&(f.flags&=-4097)}function ym(f,g,T){Qt=f,Lb(f)}function Lb(f,g,T){for(var O=(f.mode&1)!==0;Qt!==null;){var M=Qt,H=M.child;if(M.tag===22&&O){var ae=M.memoizedState!==null||VE;if(!ae){var Ie=M.alternate,xe=Ie!==null&&Ie.memoizedState!==null||_o;Ie=VE;var it=_o;if(VE=ae,(_o=xe)&&!it)for(Qt=M;Qt!==null;)ae=Qt,xe=ae.child,ae.tag===22&&ae.memoizedState!==null?xI(M):xe!==null?(xe.return=ae,Qt=xe):xI(M);for(;H!==null;)Qt=H,Lb(H),H=H.sibling;Qt=M,VE=Ie,_o=it}jE(f)}else(M.subtreeFlags&8772)!==0&&H!==null?(H.return=M,Qt=H):jE(f)}}function jE(f){for(;Qt!==null;){var g=Qt;if((g.flags&8772)!==0){var T=g.alternate;try{if((g.flags&8772)!==0)switch(g.tag){case 0:case 11:case 15:_o||p_(5,g);break;case 1:var O=g.stateNode;if(g.flags&4&&!_o)if(T===null)O.componentDidMount();else{var M=g.elementType===g.type?T.memoizedProps:Ja(g.type,T.memoizedProps);O.componentDidUpdate(M,T.memoizedState,O.__reactInternalSnapshotBeforeUpdate)}var H=g.updateQueue;H!==null&&eI(g,H,O);break;case 3:var ae=g.updateQueue;if(ae!==null){if(T=null,g.child!==null)switch(g.child.tag){case 5:T=g.child.stateNode;break;case 1:T=g.child.stateNode}eI(g,ae,T)}break;case 5:var Ie=g.stateNode;if(T===null&&g.flags&4){T=Ie;var xe=g.memoizedProps;switch(g.type){case"button":case"input":case"select":case"textarea":xe.autoFocus&&T.focus();break;case"img":xe.src&&(T.src=xe.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(g.memoizedState===null){var it=g.alternate;if(it!==null){var At=it.memoizedState;if(At!==null){var Pt=At.dehydrated;Pt!==null&&ga(Pt)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(i(163))}_o||g.flags&512&&Ob(g)}catch(Ct){Wi(g,g.return,Ct)}}if(g===f){Qt=null;break}if(T=g.sibling,T!==null){T.return=g.return,Qt=T;break}Qt=g.return}}function m_(f){for(;Qt!==null;){var g=Qt;if(g===f){Qt=null;break}var T=g.sibling;if(T!==null){T.return=g.return,Qt=T;break}Qt=g.return}}function xI(f){for(;Qt!==null;){var g=Qt;try{switch(g.tag){case 0:case 11:case 15:var T=g.return;try{p_(4,g)}catch(xe){Wi(g,T,xe)}break;case 1:var O=g.stateNode;if(typeof O.componentDidMount=="function"){var M=g.return;try{O.componentDidMount()}catch(xe){Wi(g,M,xe)}}var H=g.return;try{Ob(g)}catch(xe){Wi(g,H,xe)}break;case 5:var ae=g.return;try{Ob(g)}catch(xe){Wi(g,ae,xe)}}}catch(xe){Wi(g,g.return,xe)}if(g===f){Qt=null;break}var Ie=g.sibling;if(Ie!==null){Ie.return=g.return,Qt=Ie;break}Qt=g.return}}var HN=Math.ceil,BE=ce.ReactCurrentDispatcher,WE=ce.ReactCurrentOwner,Ic=ce.ReactCurrentBatchConfig,wr=0,zs=null,Qi=null,_s=0,Qa=0,pl=Sc(0),ys=0,Qs=null,Mf=0,zE=0,GE=0,g_=null,Ho=null,HE=0,Em=1/0,eu=null,$E=!1,xb=null,oh=null,vm=!1,tu=null,KE=0,Uf=0,Mb=null,__=-1,qE=0;function Zs(){return(wr&6)!==0?Fr():__!==-1?__:__=Fr()}function Ac(f){return(f.mode&1)===0?1:(wr&2)!==0&&_s!==0?_s&-_s:MN.transition!==null?(qE===0&&(qE=Wu()),qE):(f=nr,f!==0||(f=window.event,f=f===void 0?16:jr(f.type)),f)}function Pc(f,g,T,O){if(50<Uf)throw Uf=0,Mb=null,Error(i(185));zl(f,T,O),((wr&2)===0||f!==zs)&&(f===zs&&((wr&2)===0&&(zE|=T),ys===4&&id(f,_s)),yo(f,O),T===1&&wr===0&&(g.mode&1)===0&&(Em=Fr()+500,fE&&Zd()))}function yo(f,g){var T=f.callbackNode;Ha(f,g);var O=Wl(f,f===zs?_s:0);if(O===0)T!==null&&ju(T),f.callbackNode=null,f.callbackPriority=0;else if(g=O&-O,f.callbackPriority!==g){if(T!=null&&ju(T),g===1)f.tag===0?xN(Vf.bind(null,f)):HC(Vf.bind(null,f)),kN(function(){(wr&6)===0&&Zd()}),T=null;else{switch(mc(O)){case 1:T=pc;break;case 4:T=al;break;case 16:T=pa;break;case 536870912:T=Gd;break;default:T=pa}T=v_(T,YE.bind(null,f))}f.callbackPriority=g,f.callbackNode=T}}function YE(f,g){if(__=-1,qE=0,(wr&6)!==0)throw Error(i(327));var T=f.callbackNode;if(Sm()&&f.callbackNode!==T)return null;var O=Wl(f,f===zs?_s:0);if(O===0)return null;if((O&30)!==0||(O&f.expiredLanes)!==0||g)g=nu(f,O);else{g=O;var M=wr;wr|=2;var H=MI();(zs!==f||_s!==g)&&(eu=null,Em=Fr()+500,ah(f,g));do try{$N();break}catch(Ie){Ub(f,Ie)}while(!0);ib(),BE.current=H,wr=M,Qi!==null?g=0:(zs=null,_s=0,g=ys)}if(g!==0){if(g===2&&(M=Oo(f),M!==0&&(O=M,g=XE(f,M))),g===1)throw T=Qs,ah(f,0),id(f,O),yo(f,Fr()),T;if(g===6)id(f,O);else{if(M=f.current.alternate,(O&30)===0&&!QE(M)&&(g=nu(f,O),g===2&&(H=Oo(f),H!==0&&(O=H,g=XE(f,H))),g===1))throw T=Qs,ah(f,0),id(f,O),yo(f,Fr()),T;switch(f.finishedWork=M,f.finishedLanes=O,g){case 0:case 1:throw Error(i(345));case 2:Ff(f,Ho,eu);break;case 3:if(id(f,O),(O&130023424)===O&&(g=HE+500-Fr(),10<g)){if(Wl(f,0)!==0)break;if(M=f.suspendedLanes,(M&O)!==O){Zs(),f.pingedLanes|=f.suspendedLanes&M;break}f.timeoutHandle=Xg(Ff.bind(null,f,Ho,eu),g);break}Ff(f,Ho,eu);break;case 4:if(id(f,O),(O&4194240)===O)break;for(g=f.eventTimes,M=-1;0<O;){var ae=31-Xs(O);H=1<<ae,ae=g[ae],ae>M&&(M=ae),O&=~H}if(O=M,O=Fr()-O,O=(120>O?120:480>O?480:1080>O?1080:1920>O?1920:3e3>O?3e3:4320>O?4320:1960*HN(O/1960))-O,10<O){f.timeoutHandle=Xg(Ff.bind(null,f,Ho,eu),O);break}Ff(f,Ho,eu);break;case 5:Ff(f,Ho,eu);break;default:throw Error(i(329))}}}return yo(f,Fr()),f.callbackNode===T?YE.bind(null,f):null}function XE(f,g){var T=g_;return f.current.memoizedState.isDehydrated&&(ah(f,g).flags|=256),f=nu(f,g),f!==2&&(g=Ho,Ho=T,g!==null&&JE(g)),f}function JE(f){Ho===null?Ho=f:Ho.push.apply(Ho,f)}function QE(f){for(var g=f;;){if(g.flags&16384){var T=g.updateQueue;if(T!==null&&(T=T.stores,T!==null))for(var O=0;O<T.length;O++){var M=T[O],H=M.getSnapshot;M=M.value;try{if(!fl(H(),M))return!1}catch{return!1}}}if(T=g.child,g.subtreeFlags&16384&&T!==null)T.return=g,g=T;else{if(g===f)break;for(;g.sibling===null;){if(g.return===null||g.return===f)return!0;g=g.return}g.sibling.return=g.return,g=g.sibling}}return!0}function id(f,g){for(g&=~GE,g&=~zE,f.suspendedLanes|=g,f.pingedLanes&=~g,f=f.expirationTimes;0<g;){var T=31-Xs(g),O=1<<T;f[T]=-1,g&=~O}}function Vf(f){if((wr&6)!==0)throw Error(i(327));Sm();var g=Wl(f,0);if((g&1)===0)return yo(f,Fr()),null;var T=nu(f,g);if(f.tag!==0&&T===2){var O=Oo(f);O!==0&&(g=O,T=XE(f,O))}if(T===1)throw T=Qs,ah(f,0),id(f,g),yo(f,Fr()),T;if(T===6)throw Error(i(345));return f.finishedWork=f.current.alternate,f.finishedLanes=g,Ff(f,Ho,eu),yo(f,Fr()),null}function y_(f,g){var T=wr;wr|=1;try{return f(g)}finally{wr=T,wr===0&&(Em=Fr()+500,fE&&Zd())}}function sd(f){tu!==null&&tu.tag===0&&(wr&6)===0&&Sm();var g=wr;wr|=1;var T=Ic.transition,O=nr;try{if(Ic.transition=null,nr=1,f)return f()}finally{nr=O,Ic.transition=T,wr=g,(wr&6)===0&&Zd()}}function E_(){Qa=pl.current,Ii(pl)}function ah(f,g){f.finishedWork=null,f.finishedLanes=0;var T=f.timeoutHandle;if(T!==-1&&(f.timeoutHandle=-1,ON(T)),Qi!==null)for(T=Qi.return;T!==null;){var O=T;switch(Zg(O),O.tag){case 1:O=O.type.childContextTypes,O!=null&&uE();break;case 3:Nf(),Ii(ya),Ii(po),ub();break;case 5:um(O);break;case 4:Nf();break;case 13:Ii(Ni);break;case 19:Ii(Ni);break;case 10:sb(O.type._context);break;case 22:case 23:E_()}T=T.return}if(zs=f,Qi=f=od(f.current,null),_s=Qa=g,ys=0,Qs=null,GE=zE=Mf=0,Ho=g_=null,Of!==null){for(g=0;g<Of.length;g++)if(T=Of[g],O=T.interleaved,O!==null){T.interleaved=null;var M=O.next,H=T.pending;if(H!==null){var ae=H.next;H.next=M,O.next=ae}T.pending=O}Of=null}return f}function Ub(f,g){do{var T=Qi;try{if(ib(),bE.current=CE,dm){for(var O=Bi.memoizedState;O!==null;){var M=O.queue;M!==null&&(M.pending=null),O=O.next}dm=!1}if(Jl=0,gs=ms=Bi=null,a_=!1,c_=0,WE.current=null,T===null||T.return===null){ys=1,Qs=g,Qi=null;break}e:{var H=f,ae=T.return,Ie=T,xe=g;if(g=_s,Ie.flags|=32768,xe!==null&&typeof xe=="object"&&typeof xe.then=="function"){var it=xe,At=Ie,Pt=At.tag;if((At.mode&1)===0&&(Pt===0||Pt===11||Pt===15)){var Ct=At.alternate;Ct?(At.updateQueue=Ct.updateQueue,At.memoizedState=Ct.memoizedState,At.lanes=Ct.lanes):(At.updateQueue=null,At.memoizedState=null)}var Ht=gI(ae);if(Ht!==null){Ht.flags&=-257,_I(Ht,ae,Ie,H,g),Ht.mode&1&&mI(H,it,g),g=Ht,xe=it;var en=g.updateQueue;if(en===null){var tn=new Set;tn.add(xe),g.updateQueue=tn}else en.add(xe);break e}else{if((g&1)===0){mI(H,it,g),Vb();break e}xe=Error(i(426))}}else if(ai&&Ie.mode&1){var Zi=gI(ae);if(Zi!==null){(Zi.flags&65536)===0&&(Zi.flags|=256),_I(Zi,ae,Ie,H,g),nb(mm(xe,Ie));break e}}H=xe=mm(xe,Ie),ys!==4&&(ys=2),g_===null?g_=[H]:g_.push(H),H=ae;do{switch(H.tag){case 3:H.flags|=65536,g&=-g,H.lanes|=g;var Je=wb(H,xe,g);ZC(H,Je);break e;case 1:Ie=xe;var Ve=H.type,Ze=H.stateNode;if((H.flags&128)===0&&(typeof Ve.getDerivedStateFromError=="function"||Ze!==null&&typeof Ze.componentDidCatch=="function"&&(oh===null||!oh.has(Ze)))){H.flags|=65536,g&=-g,H.lanes|=g;var Dt=rd(H,Ie,g);ZC(H,Dt);break e}}H=H.return}while(H!==null)}VI(T)}catch(nn){g=nn,Qi===T&&T!==null&&(Qi=T=T.return);continue}break}while(!0)}function MI(){var f=BE.current;return BE.current=CE,f===null?CE:f}function Vb(){(ys===0||ys===3||ys===2)&&(ys=4),zs===null||(Mf&268435455)===0&&(zE&268435455)===0||id(zs,_s)}function nu(f,g){var T=wr;wr|=2;var O=MI();(zs!==f||_s!==g)&&(eu=null,ah(f,g));do try{UI();break}catch(M){Ub(f,M)}while(!0);if(ib(),wr=T,BE.current=O,Qi!==null)throw Error(i(261));return zs=null,_s=0,ys}function UI(){for(;Qi!==null;)ZE(Qi)}function $N(){for(;Qi!==null&&!Po();)ZE(Qi)}function ZE(f){var g=nv(f.alternate,f,Qa);f.memoizedProps=f.pendingProps,g===null?VI(f):Qi=g,WE.current=null}function VI(f){var g=f;do{var T=g.alternate;if(f=g.return,(g.flags&32768)===0){if(T=UE(T,g,Qa),T!==null){Qi=T;return}}else{if(T=GN(T,g),T!==null){T.flags&=32767,Qi=T;return}if(f!==null)f.flags|=32768,f.subtreeFlags=0,f.deletions=null;else{ys=6,Qi=null;return}}if(g=g.sibling,g!==null){Qi=g;return}Qi=g=f}while(g!==null);ys===0&&(ys=5)}function Ff(f,g,T){var O=nr,M=Ic.transition;try{Ic.transition=null,nr=1,KN(f,g,T,O)}finally{Ic.transition=M,nr=O}return null}function KN(f,g,T,O){do Sm();while(tu!==null);if((wr&6)!==0)throw Error(i(327));T=f.finishedWork;var M=f.finishedLanes;if(T===null)return null;if(f.finishedWork=null,f.finishedLanes=0,T===f.current)throw Error(i(177));f.callbackNode=null,f.callbackPriority=0;var H=T.lanes|T.childLanes;if(Gr(f,H),f===zs&&(Qi=zs=null,_s=0),(T.subtreeFlags&2064)===0&&(T.flags&2064)===0||vm||(vm=!0,v_(pa,function(){return Sm(),null})),H=(T.flags&15990)!==0,(T.subtreeFlags&15990)!==0||H){H=Ic.transition,Ic.transition=null;var ae=nr;nr=1;var Ie=wr;wr|=4,WE.current=null,Pb(f,T),Db(T,f),H0(Yg),Se=!!lE,Yg=lE=null,f.current=T,ym(T),zd(),wr=Ie,nr=ae,Ic.transition=H}else f.current=T;if(vm&&(vm=!1,tu=f,KE=M),H=f.pendingLanes,H===0&&(oh=null),Bp(T.stateNode),yo(f,Fr()),g!==null)for(O=f.onRecoverableError,T=0;T<g.length;T++)M=g[T],O(M.value,{componentStack:M.stack,digest:M.digest});if($E)throw $E=!1,f=xb,xb=null,f;return(KE&1)!==0&&f.tag!==0&&Sm(),H=f.pendingLanes,(H&1)!==0?f===Mb?Uf++:(Uf=0,Mb=f):Uf=0,Zd(),null}function Sm(){if(tu!==null){var f=mc(KE),g=Ic.transition,T=nr;try{if(Ic.transition=null,nr=16>f?16:f,tu===null)var O=!1;else{if(f=tu,tu=null,KE=0,(wr&6)!==0)throw Error(i(331));var M=wr;for(wr|=4,Qt=f.current;Qt!==null;){var H=Qt,ae=H.child;if((Qt.flags&16)!==0){var Ie=H.deletions;if(Ie!==null){for(var xe=0;xe<Ie.length;xe++){var it=Ie[xe];for(Qt=it;Qt!==null;){var At=Qt;switch(At.tag){case 0:case 11:case 15:f_(8,At,H)}var Pt=At.child;if(Pt!==null)Pt.return=At,Qt=Pt;else for(;Qt!==null;){At=Qt;var Ct=At.sibling,Ht=At.return;if(kI(At),At===it){Qt=null;break}if(Ct!==null){Ct.return=Ht,Qt=Ct;break}Qt=Ht}}}var en=H.alternate;if(en!==null){var tn=en.child;if(tn!==null){en.child=null;do{var Zi=tn.sibling;tn.sibling=null,tn=Zi}while(tn!==null)}}Qt=H}}if((H.subtreeFlags&2064)!==0&&ae!==null)ae.return=H,Qt=ae;else e:for(;Qt!==null;){if(H=Qt,(H.flags&2048)!==0)switch(H.tag){case 0:case 11:case 15:f_(9,H,H.return)}var Je=H.sibling;if(Je!==null){Je.return=H.return,Qt=Je;break e}Qt=H.return}}var Ve=f.current;for(Qt=Ve;Qt!==null;){ae=Qt;var Ze=ae.child;if((ae.subtreeFlags&2064)!==0&&Ze!==null)Ze.return=ae,Qt=Ze;else e:for(ae=Ve;Qt!==null;){if(Ie=Qt,(Ie.flags&2048)!==0)try{switch(Ie.tag){case 0:case 11:case 15:p_(9,Ie)}}catch(nn){Wi(Ie,Ie.return,nn)}if(Ie===ae){Qt=null;break e}var Dt=Ie.sibling;if(Dt!==null){Dt.return=Ie.return,Qt=Dt;break e}Qt=Ie.return}}if(wr=M,Zd(),fo&&typeof fo.onPostCommitFiberRoot=="function")try{fo.onPostCommitFiberRoot(jl,f)}catch{}O=!0}return O}finally{nr=T,Ic.transition=g}}return!1}function ev(f,g,T){g=mm(T,g),g=wb(f,g,1),f=nh(f,g,1),g=Zs(),f!==null&&(zl(f,1,g),yo(f,g))}function Wi(f,g,T){if(f.tag===3)ev(f,f,T);else for(;g!==null;){if(g.tag===3){ev(g,f,T);break}else if(g.tag===1){var O=g.stateNode;if(typeof g.type.getDerivedStateFromError=="function"||typeof O.componentDidCatch=="function"&&(oh===null||!oh.has(O))){f=mm(T,f),f=rd(g,f,1),g=nh(g,f,1),f=Zs(),g!==null&&(zl(g,1,f),yo(g,f));break}}g=g.return}}function FI(f,g,T){var O=f.pingCache;O!==null&&O.delete(g),g=Zs(),f.pingedLanes|=f.suspendedLanes&T,zs===f&&(_s&T)===T&&(ys===4||ys===3&&(_s&130023424)===_s&&500>Fr()-HE?ah(f,0):GE|=T),yo(f,g)}function Fb(f,g){g===0&&((f.mode&1)===0?g=1:(g=hr,hr<<=1,(hr&130023424)===0&&(hr=4194304)));var T=Zs();f=ed(f,g),f!==null&&(zl(f,g,T),yo(f,T))}function tv(f){var g=f.memoizedState,T=0;g!==null&&(T=g.retryLane),Fb(f,T)}function jI(f,g){var T=0;switch(f.tag){case 13:var O=f.stateNode,M=f.memoizedState;M!==null&&(T=M.retryLane);break;case 19:O=f.stateNode;break;default:throw Error(i(314))}O!==null&&O.delete(g),Fb(f,T)}var nv;nv=function(f,g,T){if(f!==null)if(f.memoizedProps!==g.pendingProps||ya.current)Ta=!0;else{if((f.lanes&T)===0&&(g.flags&128)===0)return Ta=!1,CI(f,g,T);Ta=(f.flags&131072)!==0}else Ta=!1,ai&&(g.flags&1048576)!==0&&mE(g,pE,g.index);switch(g.lanes=0,g.tag){case 2:var O=g.type;xE(f,g),f=g.pendingProps;var M=Af(g,po.current);Zu(g,T),M=hm(null,g,O,f,M,T);var H=fb();return g.flags|=1,typeof M=="object"&&M!==null&&typeof M.render=="function"&&M.$$typeof===void 0?(g.tag=1,g.memoizedState=null,g.updateQueue=null,Ea(O)?(H=!0,hE(g)):H=!1,g.memoizedState=M.state!==null&&M.state!==void 0?M.state:null,r_(g),M.updater=AE,g.stateNode=M,M._reactInternals=g,Sb(g,O,f,T),g=OE(null,g,O,!0,H,T)):(g.tag=0,ai&&H&&gE(g),zo(null,g,M,T),g=g.child),g;case 16:O=g.elementType;e:{switch(xE(f,g),f=g.pendingProps,M=O._init,O=M(O._payload),g.type=O,M=g.tag=jf(O),f=Ja(O,f),M){case 0:g=Rb(null,g,O,f,T);break e;case 1:g=bI(null,g,O,f,T);break e;case 11:g=PE(null,g,O,f,T);break e;case 14:g=yI(null,g,O,Ja(O.type,f),T);break e}throw Error(i(306,O,""))}return g;case 0:return O=g.type,M=g.pendingProps,M=g.elementType===O?M:Ja(O,M),Rb(f,g,O,M,T);case 1:return O=g.type,M=g.pendingProps,M=g.elementType===O?M:Ja(O,M),bI(f,g,O,M,T);case 3:e:{if(Cb(g),f===null)throw Error(i(387));O=g.pendingProps,H=g.memoizedState,M=H.element,QC(f,g),SE(g,O,null,T);var ae=g.memoizedState;if(O=ae.element,H.isDehydrated)if(H={element:O,isDehydrated:!1,cache:ae.cache,pendingSuspenseBoundaries:ae.pendingSuspenseBoundaries,transitions:ae.transitions},g.updateQueue.baseState=H,g.memoizedState=H,g.flags&256){M=mm(Error(i(423)),g),g=TI(f,g,O,T,M);break e}else if(O!==M){M=mm(Error(i(424)),g),g=TI(f,g,O,T,M);break e}else for(Sa=Xd(g.stateNode.containerInfo.firstChild),va=g,ai=!0,Bo=null,T=XC(g,null,O,T),g.child=T;T;)T.flags=T.flags&-3|4096,T=T.sibling;else{if(om(),O===M){g=Ql(f,g,T);break e}zo(f,g,O,T)}g=g.child}return g;case 5:return tI(g),f===null&&tb(g),O=g.type,M=g.pendingProps,H=f!==null?f.memoizedProps:null,ae=M.children,J0(O,M)?ae=null:H!==null&&J0(O,H)&&(g.flags|=32),SI(f,g),zo(f,g,ae,T),g.child;case 6:return f===null&&tb(g),null;case 13:return kE(f,g,T);case 4:return cb(g,g.stateNode.containerInfo),O=g.pendingProps,f===null?g.child=am(g,null,O,T):zo(f,g,O,T),g.child;case 11:return O=g.type,M=g.pendingProps,M=g.elementType===O?M:Ja(O,M),PE(f,g,O,M,T);case 7:return zo(f,g,g.pendingProps,T),g.child;case 8:return zo(f,g,g.pendingProps.children,T),g.child;case 12:return zo(f,g,g.pendingProps.children,T),g.child;case 10:e:{if(O=g.type._context,M=g.pendingProps,H=g.memoizedProps,ae=M.value,vi(EE,O._currentValue),O._currentValue=ae,H!==null)if(fl(H.value,ae)){if(H.children===M.children&&!ya.current){g=Ql(f,g,T);break e}}else for(H=g.child,H!==null&&(H.return=g);H!==null;){var Ie=H.dependencies;if(Ie!==null){ae=H.child;for(var xe=Ie.firstContext;xe!==null;){if(xe.context===O){if(H.tag===1){xe=Yl(-1,T&-T),xe.tag=2;var it=H.updateQueue;if(it!==null){it=it.shared;var At=it.pending;At===null?xe.next=xe:(xe.next=At.next,At.next=xe),it.pending=xe}}H.lanes|=T,xe=H.alternate,xe!==null&&(xe.lanes|=T),ob(H.return,T,g),Ie.lanes|=T;break}xe=xe.next}}else if(H.tag===10)ae=H.type===g.type?null:H.child;else if(H.tag===18){if(ae=H.return,ae===null)throw Error(i(341));ae.lanes|=T,Ie=ae.alternate,Ie!==null&&(Ie.lanes|=T),ob(ae,T,g),ae=H.sibling}else ae=H.child;if(ae!==null)ae.return=H;else for(ae=H;ae!==null;){if(ae===g){ae=null;break}if(H=ae.sibling,H!==null){H.return=ae.return,ae=H;break}ae=ae.return}H=ae}zo(f,g,M.children,T),g=g.child}return g;case 9:return M=g.type,O=g.pendingProps.children,Zu(g,T),M=wc(M),O=O(M),g.flags|=1,zo(f,g,O,T),g.child;case 14:return O=g.type,M=Ja(O,g.pendingProps),M=Ja(O.type,M),yI(f,g,O,M,T);case 15:return EI(f,g,g.type,g.pendingProps,T);case 17:return O=g.type,M=g.pendingProps,M=g.elementType===O?M:Ja(O,M),xE(f,g),g.tag=1,Ea(O)?(f=!0,hE(g)):f=!1,Zu(g,T),fI(g,O,M),Sb(g,O,M,T),OE(null,g,O,!0,f,T);case 19:return LE(f,g,T);case 22:return vI(f,g,T)}throw Error(i(156,g.tag))};function v_(f,g){return Wd(f,g)}function rv(f,g,T,O){this.tag=f,this.key=T,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=g,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=O,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Za(f,g,T,O){return new rv(f,g,T,O)}function ch(f){return f=f.prototype,!(!f||!f.isReactComponent)}function jf(f){if(typeof f=="function")return ch(f)?1:0;if(f!=null){if(f=f.$$typeof,f===fe)return 11;if(f===He)return 14}return 2}function od(f,g){var T=f.alternate;return T===null?(T=Za(f.tag,g,f.key,f.mode),T.elementType=f.elementType,T.type=f.type,T.stateNode=f.stateNode,T.alternate=f,f.alternate=T):(T.pendingProps=g,T.type=f.type,T.flags=0,T.subtreeFlags=0,T.deletions=null),T.flags=f.flags&14680064,T.childLanes=f.childLanes,T.lanes=f.lanes,T.child=f.child,T.memoizedProps=f.memoizedProps,T.memoizedState=f.memoizedState,T.updateQueue=f.updateQueue,g=f.dependencies,T.dependencies=g===null?null:{lanes:g.lanes,firstContext:g.firstContext},T.sibling=f.sibling,T.index=f.index,T.ref=f.ref,T}function iv(f,g,T,O,M,H){var ae=2;if(O=f,typeof f=="function")ch(f)&&(ae=1);else if(typeof f=="string")ae=5;else e:switch(f){case te:return Bf(T.children,M,H,g);case Z:ae=8,M|=8;break;case J:return f=Za(12,T,g,M|2),f.elementType=J,f.lanes=H,f;case ue:return f=Za(13,T,g,M),f.elementType=ue,f.lanes=H,f;case Me:return f=Za(19,T,g,M),f.elementType=Me,f.lanes=H,f;case we:return lh(T,M,H,g);default:if(typeof f=="object"&&f!==null)switch(f.$$typeof){case se:ae=10;break e;case he:ae=9;break e;case fe:ae=11;break e;case He:ae=14;break e;case rt:ae=16,O=null;break e}throw Error(i(130,f==null?f:typeof f,""))}return g=Za(ae,T,g,M),g.elementType=f,g.type=O,g.lanes=H,g}function Bf(f,g,T,O){return f=Za(7,f,O,g),f.lanes=T,f}function lh(f,g,T,O){return f=Za(22,f,O,g),f.elementType=we,f.lanes=T,f.stateNode={isHidden:!1},f}function jb(f,g,T){return f=Za(6,f,null,g),f.lanes=T,f}function Bb(f,g,T){return g=Za(4,f.children!==null?f.children:[],f.key,g),g.lanes=T,g.stateNode={containerInfo:f.containerInfo,pendingChildren:null,implementation:f.implementation},g}function qN(f,g,T,O,M){this.tag=g,this.containerInfo=f,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=ll(0),this.expirationTimes=ll(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=ll(0),this.identifierPrefix=O,this.onRecoverableError=M,this.mutableSourceEagerHydrationData=null}function Wb(f,g,T,O,M,H,ae,Ie,xe){return f=new qN(f,g,T,Ie,xe),g===1?(g=1,H===!0&&(g|=8)):g=0,H=Za(3,null,null,g),f.current=H,H.stateNode=f,H.memoizedState={element:O,isDehydrated:T,cache:null,transitions:null,pendingSuspenseBoundaries:null},r_(H),f}function YN(f,g,T){var O=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:ge,key:O==null?null:""+O,children:f,containerInfo:g,implementation:T}}function BI(f){if(!f)return Qd;f=f._reactInternals;e:{if(Bs(f)!==f||f.tag!==1)throw Error(i(170));var g=f;do{switch(g.tag){case 3:g=g.stateNode.context;break e;case 1:if(Ea(g.type)){g=g.stateNode.__reactInternalMemoizedMergedChildContext;break e}}g=g.return}while(g!==null);throw Error(i(171))}if(f.tag===1){var T=f.type;if(Ea(T))return dE(f,T,g)}return g}function sv(f,g,T,O,M,H,ae,Ie,xe){return f=Wb(T,O,!0,f,M,H,ae,Ie,xe),f.context=BI(null),T=f.current,O=Zs(),M=Ac(T),H=Yl(O,M),H.callback=g??null,nh(T,H,M),f.current.lanes=M,zl(f,M,O),yo(f,O),f}function S_(f,g,T,O){var M=g.current,H=Zs(),ae=Ac(M);return T=BI(T),g.context===null?g.context=T:g.pendingContext=T,g=Yl(H,ae),g.payload={element:f},O=O===void 0?null:O,O!==null&&(g.callback=O),f=nh(M,g,ae),f!==null&&(Pc(f,M,ae,H),i_(f,M,ae)),ae}function ov(f){if(f=f.current,!f.child)return null;switch(f.child.tag){case 5:return f.child.stateNode;default:return f.child.stateNode}}function zb(f,g){if(f=f.memoizedState,f!==null&&f.dehydrated!==null){var T=f.retryLane;f.retryLane=T!==0&&T<g?T:g}}function Gb(f,g){zb(f,g),(f=f.alternate)&&zb(f,g)}function b_(){return null}var ml=typeof reportError=="function"?reportError:function(f){console.error(f)};function av(f){this._internalRoot=f}cv.prototype.render=av.prototype.render=function(f){var g=this._internalRoot;if(g===null)throw Error(i(409));S_(f,g,null,null)},cv.prototype.unmount=av.prototype.unmount=function(){var f=this._internalRoot;if(f!==null){this._internalRoot=null;var g=f.containerInfo;sd(function(){S_(null,f,null,null)}),g[vc]=null}};function cv(f){this._internalRoot=f}cv.prototype.unstable_scheduleHydration=function(f){if(f){var g=mf();f={blockedOn:null,target:f,priority:g};for(var T=0;T<xo.length&&g!==0&&g<xo[T].priority;T++);xo.splice(T,0,f),T===0&&_f(f)}};function Hb(f){return!(!f||f.nodeType!==1&&f.nodeType!==9&&f.nodeType!==11)}function bm(f){return!(!f||f.nodeType!==1&&f.nodeType!==9&&f.nodeType!==11&&(f.nodeType!==8||f.nodeValue!==" react-mount-point-unstable "))}function $b(){}function XN(f,g,T,O,M){if(M){if(typeof O=="function"){var H=O;O=function(){var it=ov(ae);H.call(it)}}var ae=sv(g,O,f,0,null,!1,!1,"",$b);return f._reactRootContainer=ae,f[vc]=ae.current,Tf(f.nodeType===8?f.parentNode:f),sd(),ae}for(;M=f.lastChild;)f.removeChild(M);if(typeof O=="function"){var Ie=O;O=function(){var it=ov(xe);Ie.call(it)}}var xe=Wb(f,0,!1,null,null,!1,!1,"",$b);return f._reactRootContainer=xe,f[vc]=xe.current,Tf(f.nodeType===8?f.parentNode:f),sd(function(){S_(g,xe,T,O)}),xe}function Wf(f,g,T,O,M){var H=T._reactRootContainer;if(H){var ae=H;if(typeof M=="function"){var Ie=M;M=function(){var xe=ov(ae);Ie.call(xe)}}S_(g,ae,f,M)}else ae=XN(T,g,f,M,O);return ov(ae)}Wp=function(f){switch(f.tag){case 3:var g=f.stateNode;if(g.current.memoizedState.isDehydrated){var T=Bl(g.pendingLanes);T!==0&&($a(g,T|1),yo(g,Fr()),(wr&6)===0&&(Em=Fr()+500,Zd()))}break;case 13:sd(function(){var O=ed(f,1);if(O!==null){var M=Zs();Pc(O,f,1,M)}}),Gb(f,1)}},Gl=function(f){if(f.tag===13){var g=ed(f,134217728);if(g!==null){var T=Zs();Pc(g,f,134217728,T)}Gb(f,134217728)}},Kd=function(f){if(f.tag===13){var g=Ac(f),T=ed(f,g);if(T!==null){var O=Zs();Pc(T,f,g,O)}Gb(f,g)}},mf=function(){return nr},zp=function(f,g){var T=nr;try{return nr=f,g()}finally{nr=T}},Fl=function(f,g,T){switch(g){case"input":if(qt(f,T),g=T.name,T.type==="radio"&&g!=null){for(T=f;T.parentNode;)T=T.parentNode;for(T=T.querySelectorAll("input[name="+JSON.stringify(""+g)+'][type="radio"]'),g=0;g<T.length;g++){var O=T[g];if(O!==f&&O.form===f.form){var M=rm(O);if(!M)throw Error(i(90));Ut(O),qt(O,M)}}}break;case"textarea":Ot(f,T);break;case"select":g=T.value,g!=null&&Et(f,!!T.multiple,g,!1)}},Mu=y_,hc=sd;var uh={usingClientEntryPoint:!1,Events:[nm,Cf,rm,dc,sl,y_]},ad={findFiberByHostInstance:Rf,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},JN={bundleType:ad.bundleType,version:ad.version,rendererPackageName:ad.rendererPackageName,rendererConfig:ad.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:ce.ReactCurrentDispatcher,findHostInstanceByFiber:function(f){return f=Bd(f),f===null?null:f.stateNode},findFiberByHostInstance:ad.findFiberByHostInstance||b_,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var lv=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!lv.isDisabled&&lv.supportsFiber)try{jl=lv.inject(JN),fo=lv}catch{}}return zc.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=uh,zc.createPortal=function(f,g){var T=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!Hb(g))throw Error(i(200));return YN(f,g,null,T)},zc.createRoot=function(f,g){if(!Hb(f))throw Error(i(299));var T=!1,O="",M=ml;return g!=null&&(g.unstable_strictMode===!0&&(T=!0),g.identifierPrefix!==void 0&&(O=g.identifierPrefix),g.onRecoverableError!==void 0&&(M=g.onRecoverableError)),g=Wb(f,1,!1,null,null,T,!1,O,M),f[vc]=g.current,Tf(f.nodeType===8?f.parentNode:f),new av(g)},zc.findDOMNode=function(f){if(f==null)return null;if(f.nodeType===1)return f;var g=f._reactInternals;if(g===void 0)throw typeof f.render=="function"?Error(i(188)):(f=Object.keys(f).join(","),Error(i(268,f)));return f=Bd(g),f=f===null?null:f.stateNode,f},zc.flushSync=function(f){return sd(f)},zc.hydrate=function(f,g,T){if(!bm(g))throw Error(i(200));return Wf(null,f,g,!0,T)},zc.hydrateRoot=function(f,g,T){if(!Hb(f))throw Error(i(405));var O=T!=null&&T.hydratedSources||null,M=!1,H="",ae=ml;if(T!=null&&(T.unstable_strictMode===!0&&(M=!0),T.identifierPrefix!==void 0&&(H=T.identifierPrefix),T.onRecoverableError!==void 0&&(ae=T.onRecoverableError)),g=sv(g,null,f,1,T??null,M,!1,H,ae),f[vc]=g.current,Tf(f),O)for(f=0;f<O.length;f++)T=O[f],M=T._getVersion,M=M(T._source),g.mutableSourceEagerHydrationData==null?g.mutableSourceEagerHydrationData=[T,M]:g.mutableSourceEagerHydrationData.push(T,M);return new cv(g)},zc.render=function(f,g,T){if(!bm(g))throw Error(i(200));return Wf(null,f,g,!1,T)},zc.unmountComponentAtNode=function(f){if(!bm(f))throw Error(i(40));return f._reactRootContainer?(sd(function(){Wf(null,null,f,!1,function(){f._reactRootContainer=null,f[vc]=null})}),!0):!1},zc.unstable_batchedUpdates=y_,zc.unstable_renderSubtreeIntoContainer=function(f,g,T,O){if(!bm(T))throw Error(i(200));if(f==null||f._reactInternals===void 0)throw Error(i(38));return Wf(f,g,T,!1,O)},zc.version="18.3.1-next-f1338f8080-20240426",zc}var q$;function SQ(){if(q$)return GM.exports;q$=1;function n(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(n)}catch(e){console.error(e)}}return n(),GM.exports=cye(),GM.exports}var Y$;function lye(){if(Y$)return oO;Y$=1;var n=SQ();return oO.createRoot=n.createRoot,oO.hydrateRoot=n.hydrateRoot,oO}var uye=lye();const c1=I0(uye);function dye(n,e,i,a){return n.addEventListener(e,i,a),()=>{n.removeEventListener(e,i,a)}}function l1(n){return n!=null&&typeof n=="object"&&"nodeType"in n&&n.nodeType===Node.ELEMENT_NODE}function hye(){return!!(globalThis!=null&&globalThis.document)}function bQ(n){return n.parentElement&&bQ(n.parentElement)?!0:n.hidden}function fye(n){const e=n.getAttribute("contenteditable");return e!=="false"&&e!=null}function pye(n){return!!n.getAttribute("disabled")||!!n.getAttribute("aria-disabled")}function mye(n){var e;return((e=TQ(n))==null?void 0:e.defaultView)??window}function TQ(n){return l1(n)?n.ownerDocument:document}function gye(n){return n.view??window}function _ye(n){return TQ(n).activeElement}function yye(n){const e=gye(n);return typeof e.PointerEvent<"u"&&n instanceof e.PointerEvent?n.pointerType==="mouse":n instanceof e.MouseEvent}function wQ(n){return!!n.touches}function Eye(n){return wQ(n)&&n.touches.length>1}function vye(n,e="page"){const i=n.touches[0]||n.changedTouches[0];return{x:i[`${e}X`],y:i[`${e}Y`]}}function Sye(n,e="page"){return{x:n[`${e}X`],y:n[`${e}Y`]}}function RQ(n,e="page"){return wQ(n)?vye(n,e):Sye(n,e)}function bye(n){return e=>{const i=yye(e);(!i||i&&e.button===0)&&n(e)}}function Tye(n,e=!1){function i(l){n(l,{point:RQ(l)})}return e?bye(i):i}function FO(n,e,i,a){return dye(n,e,Tye(i,e==="pointerdown"),a)}function wye(n,...e){if(n==null)throw new TypeError("Cannot convert undefined or null to object");const i={...n};for(const a of e)if(a!=null)for(const l in a)Object.prototype.hasOwnProperty.call(a,l)&&(l in i&&delete i[l],i[l]=a[l]);return i}const Kn=n=>n?"":void 0,FS=n=>n?!0:void 0;function Rye(n){return Array.isArray(n)}function Au(n){const e=typeof n;return n!=null&&(e==="object"||e==="function")&&!Rye(n)}function Cye(n){const e=n==null?0:n.length;return e?n[e-1]:void 0}function Iye(n){const e=parseFloat(n.toString()),i=n.toString().replace(String(e),"");return{unitless:!i,value:e,unit:i}}function mU(n){if(n==null)return n;const{unitless:e}=Iye(n);return e||typeof n=="number"?`${n}px`:n}const CQ=(n,e)=>parseInt(n[1],10)>parseInt(e[1],10)?1:-1,ZV=n=>Object.fromEntries(Object.entries(n).sort(CQ));function X$(n){const e=ZV(n);return Object.assign(Object.values(e),e)}function Aye(n){const e=Object.keys(ZV(n));return new Set(e)}function J$(n){if(!n)return n;n=mU(n)??n;const e=-.02;return typeof n=="number"?`${n+e}`:n.replace(/(\d+\.?\d*)/u,i=>`${parseFloat(i)+e}`)}function Cw(n,e){const i=["@media screen"];return n&&i.push("and",`(min-width: ${mU(n)})`),e&&i.push("and",`(max-width: ${mU(e)})`),i.join(" ")}function Pye(n){if(!n)return null;n.base=n.base??"0px";const e=X$(n),i=Object.entries(n).sort(CQ).map(([d,p],y,v)=>{let[,b]=v[y+1]??[];return b=parseFloat(b)>0?J$(b):void 0,{_minW:J$(p),breakpoint:d,minW:p,maxW:b,maxWQuery:Cw(null,b),minWQuery:Cw(p),minMaxQuery:Cw(p,b)}}),a=Aye(n),l=Array.from(a.values());return{keys:a,normalized:e,isResponsive(d){const p=Object.keys(d);return p.length>0&&p.every(y=>a.has(y))},asObject:ZV(n),asArray:X$(n),details:i,get(d){return i.find(p=>p.breakpoint===d)},media:[null,...e.map(d=>Cw(d)).slice(1)],toArrayValue(d){if(!Au(d))throw new Error("toArrayValue: value must be an object");const p=l.map(y=>d[y]??null);for(;Cye(p)===null;)p.pop();return p},toObjectValue(d){if(!Array.isArray(d))throw new Error("toObjectValue: value must be an array");return d.reduce((p,y,v)=>{const b=l[v];return b!=null&&y!=null&&(p[b]=y),p},{})}}}function IQ(...n){return function(...i){n.forEach(a=>a==null?void 0:a(...i))}}function Qn(...n){return function(i){n.some(a=>(a==null||a(i),i==null?void 0:i.defaultPrevented))}}function eF(n){return D.Children.toArray(n).filter(e=>D.isValidElement(e))}function u1(n){const e=Object.assign({},n);for(let i in e)e[i]===void 0&&delete e[i];return e}function Oye(n,e){return`${n} returned \`undefined\`. Seems you forgot to wrap component within ${e}`}function Ui(n={}){const{name:e,strict:i=!0,hookName:a="useContext",providerName:l="Provider",errorMessage:d,defaultValue:p}=n,y=D.createContext(p);y.displayName=e;function v(){var w;const b=D.useContext(y);if(!b&&i){const A=new Error(d??Oye(a,l));throw A.name="ContextError",(w=Error.captureStackTrace)==null||w.call(Error,A,v),A}return b}return[y.Provider,v,y]}const un=(...n)=>n.filter(Boolean).join(" "),AQ=n=>n.hasAttribute("tabindex"),kye=n=>AQ(n)&&n.tabIndex===-1;function vk(n){if(!l1(n)||bQ(n)||pye(n))return!1;const{localName:e}=n;if(["input","select","textarea","button"].indexOf(e)>=0)return!0;const a={a:()=>n.hasAttribute("href"),audio:()=>n.hasAttribute("controls"),video:()=>n.hasAttribute("controls")};return e in a?a[e]():fye(n)?!0:AQ(n)}function Nye(n){return n?l1(n)&&vk(n)&&!kye(n):!1}const Dye=["input:not(:disabled):not([disabled])","select:not(:disabled):not([disabled])","textarea:not(:disabled):not([disabled])","embed","iframe","object","a[href]","area[href]","button:not(:disabled):not([disabled])","[tabindex]","audio[controls]","video[controls]","*[tabindex]:not([aria-disabled])","*[contenteditable]"],Lye=Dye.join(),xye=n=>n.offsetWidth>0&&n.offsetHeight>0;function PQ(n){const e=Array.from(n.querySelectorAll(Lye));return e.unshift(n),e.filter(i=>vk(i)&&xye(i))}function Mye(n,e,i,a){const l=typeof e=="string"?e.split("."):[e];for(a=0;a<l.length&&n;a+=1)n=n[l[a]];return n===void 0?i:n}const Uye=n=>{const e=new WeakMap;return(a,l,d,p)=>{if(typeof a>"u")return n(a,l,d);e.has(a)||e.set(a,new Map);const y=e.get(a);if(y.has(l))return y.get(l);const v=n(a,l,d,p);return y.set(l,v),v}},OQ=Uye(Mye),Vye=n=>n.default||n;function tF(n){const{wasSelected:e,enabled:i,isSelected:a,mode:l="unmount"}=n;return!!(!i||a||l==="keepMounted"&&e)}function Fye(n){const e=parseFloat(n);return typeof e!="number"||Number.isNaN(e)?0:e}function jye(n,e){let i=Fye(n);const a=10**(e??10);return i=Math.round(i*a)/a,e?i.toFixed(e):i.toString()}function Bye(n){if(!Number.isFinite(n))return 0;let e=1,i=0;for(;Math.round(n*e)/e!==n;)e*=10,i+=1;return i}function Q$(n,e,i){return(n-e)*100/(i-e)}function Wye(n,e,i){return(i-e)*n+e}function Z$(n,e,i){const a=Math.round((n-e)/i)*i+e,l=Bye(i);return jye(a,l)}function KM(n,e,i){return n==null?n:(i<e&&console.warn("clamp: max cannot be less than min"),Math.min(Math.max(n,e),i))}function A0(n,e=[]){const i=Object.assign({},n);for(const a of e)a in i&&delete i[a];return i}function kQ(n,e){const i={};for(const a of e)a in n&&(i[a]=n[a]);return i}function d1(n,e){return Array.isArray(n)?n.map(i=>i===null?null:e(i)):Au(n)?Object.keys(n).reduce((i,a)=>(i[a]=e(n[a]),i),{}):n!=null?e(n):null}const zye=n=>typeof n=="function";function Xc(n,...e){return zye(n)?n(...e):n}function Gye(n){const e=n.ownerDocument.defaultView||window,{overflow:i,overflowX:a,overflowY:l}=e.getComputedStyle(n);return/auto|scroll|overlay|hidden/.test(i+l+a)}function Hye(n){return n.localName==="html"?n:n.assignedSlot||n.parentElement||n.ownerDocument.documentElement}function NQ(n){return["html","body","#document"].includes(n.localName)?n.ownerDocument.body:l1(n)&&Gye(n)?n:NQ(Hye(n))}function $ye(n,e){const i={},a={};for(const[l,d]of Object.entries(n))e.includes(l)?i[l]=d:a[l]=d;return[i,a]}function Kye(n,...e){const i=Object.getOwnPropertyDescriptors(n),a=Object.keys(i),l=p=>{const y={};for(let v=0;v<p.length;v++){const b=p[v];i[b]&&(Object.defineProperty(y,b,i[b]),delete i[b])}return y},d=p=>l(Array.isArray(p)?p:a.filter(p));return e.map(d).concat(l(a))}function eK(n,e,i={}){const{stop:a,getKey:l}=i;function d(p,y=[]){if(Au(p)||Array.isArray(p)){const v={};for(const[b,w]of Object.entries(p)){const A=(l==null?void 0:l(b))??b,N=[...y,A];if(a!=null&&a(p,N))return e(p,y);v[A]=d(w,N)}return v}return e(p,y)}return d(n)}var Iw={exports:{}};Iw.exports;var tK;function qye(){return tK||(tK=1,function(n,e){var i=200,a="__lodash_hash_undefined__",l=800,d=16,p=9007199254740991,y="[object Arguments]",v="[object Array]",b="[object AsyncFunction]",w="[object Boolean]",A="[object Date]",N="[object Error]",V="[object Function]",j="[object GeneratorFunction]",B="[object Map]",G="[object Number]",ee="[object Null]",K="[object Object]",ne="[object Proxy]",ce="[object RegExp]",oe="[object Set]",ge="[object String]",te="[object Undefined]",Z="[object WeakMap]",J="[object ArrayBuffer]",se="[object DataView]",he="[object Float32Array]",fe="[object Float64Array]",ue="[object Int8Array]",Me="[object Int16Array]",He="[object Int32Array]",rt="[object Uint8Array]",we="[object Uint8ClampedArray]",Ce="[object Uint16Array]",ve="[object Uint32Array]",Ne=/[\\^$.*+?()[\]{}|]/g,Te=/^\[object .+?Constructor\]$/,be=/^(?:0|[1-9]\d*)$/,Ae={};Ae[he]=Ae[fe]=Ae[ue]=Ae[Me]=Ae[He]=Ae[rt]=Ae[we]=Ae[Ce]=Ae[ve]=!0,Ae[y]=Ae[v]=Ae[J]=Ae[w]=Ae[se]=Ae[A]=Ae[N]=Ae[V]=Ae[B]=Ae[G]=Ae[K]=Ae[ce]=Ae[oe]=Ae[ge]=Ae[Z]=!1;var Ue=typeof my=="object"&&my&&my.Object===Object&&my,ze=typeof self=="object"&&self&&self.Object===Object&&self,et=Ue||ze||Function("return this")(),nt=e&&!e.nodeType&&e,dt=nt&&!0&&n&&!n.nodeType&&n,Xe=dt&&dt.exports===nt,It=Xe&&Ue.process,hn=function(){try{var Se=dt&&dt.require&&dt.require("util").types;return Se||It&&It.binding&&It.binding("util")}catch{}}(),Ut=hn&&hn.isTypedArray;function ln(Se,De,tt){switch(tt.length){case 0:return Se.call(De);case 1:return Se.call(De,tt[0]);case 2:return Se.call(De,tt[0],tt[1]);case 3:return Se.call(De,tt[0],tt[1],tt[2])}return Se.apply(De,tt)}function xn(Se,De){for(var tt=-1,Kt=Array(Se);++tt<Se;)Kt[tt]=De(tt);return Kt}function Xt(Se){return function(De){return Se(De)}}function Yn(Se,De){return Se==null?void 0:Se[De]}function qt(Se,De){return function(tt){return Se(De(tt))}}var Re=Array.prototype,Fe=Function.prototype,Ke=Object.prototype,Et=et["__core-js_shared__"],bt=Fe.toString,Ge=Ke.hasOwnProperty,Ot=function(){var Se=/[^.]+$/.exec(Et&&Et.keys&&Et.keys.IE_PROTO||"");return Se?"Symbol(src)_1."+Se:""}(),Jt=Ke.toString,fn=bt.call(Object),an=RegExp("^"+bt.call(Ge).replace(Ne,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),ir=Xe?et.Buffer:void 0,la=et.Symbol,Vt=et.Uint8Array;ir&&ir.allocUnsafe;var sn=qt(Object.getPrototypeOf,Object),ki=Object.create,_i=Ke.propertyIsEnumerable,Ri=Re.splice,dr=la?la.toStringTag:void 0,Wa=function(){try{var Se=Ha(Object,"defineProperty");return Se({},"",{}),Se}catch{}}(),il=ir?ir.isBuffer:void 0,uo=Math.max,ho=Date.now,Fl=Ha(et,"Map"),js=Ha(Object,"create"),uc=function(){function Se(){}return function(De){if(!gc(De))return{};if(ki)return ki(De);Se.prototype=De;var tt=new Se;return Se.prototype=void 0,tt}}();function ua(Se){var De=-1,tt=Se==null?0:Se.length;for(this.clear();++De<tt;){var Kt=Se[De];this.set(Kt[0],Kt[1])}}function dc(){this.__data__=js?js(null):{},this.size=0}function sl(Se){var De=this.has(Se)&&delete this.__data__[Se];return this.size-=De?1:0,De}function Mu(Se){var De=this.__data__;if(js){var tt=De[Se];return tt===a?void 0:tt}return Ge.call(De,Se)?De[Se]:void 0}function hc(Se){var De=this.__data__;return js?De[Se]!==void 0:Ge.call(De,Se)}function ol(Se,De){var tt=this.__data__;return this.size+=this.has(Se)?0:1,tt[Se]=js&&De===void 0?a:De,this}ua.prototype.clear=dc,ua.prototype.delete=sl,ua.prototype.get=Mu,ua.prototype.has=hc,ua.prototype.set=ol;function Ao(Se){var De=-1,tt=Se==null?0:Se.length;for(this.clear();++De<tt;){var Kt=Se[De];this.set(Kt[0],Kt[1])}}function ji(){this.__data__=[],this.size=0}function hs(Se){var De=this.__data__,tt=zd(De,Se);if(tt<0)return!1;var Kt=De.length-1;return tt==Kt?De.pop():Ri.call(De,tt,1),--this.size,!0}function za(Se){var De=this.__data__,tt=zd(De,Se);return tt<0?void 0:De[tt][1]}function Uu(Se){return zd(this.__data__,Se)>-1}function fc(Se,De){var tt=this.__data__,Kt=zd(tt,Se);return Kt<0?(++this.size,tt.push([Se,De])):tt[Kt][1]=De,this}Ao.prototype.clear=ji,Ao.prototype.delete=hs,Ao.prototype.get=za,Ao.prototype.has=Uu,Ao.prototype.set=fc;function da(Se){var De=-1,tt=Se==null?0:Se.length;for(this.clear();++De<tt;){var Kt=Se[De];this.set(Kt[0],Kt[1])}}function ha(){this.size=0,this.__data__={hash:new ua,map:new(Fl||Ao),string:new ua}}function Fd(Se){var De=Bu(this,Se).delete(Se);return this.size-=De?1:0,De}function Vg(Se){return Bu(this,Se).get(Se)}function Vu(Se){return Bu(this,Se).has(Se)}function hf(Se,De){var tt=Bu(this,Se),Kt=tt.size;return tt.set(Se,De),this.size+=tt.size==Kt?0:1,this}da.prototype.clear=ha,da.prototype.delete=Fd,da.prototype.get=Vg,da.prototype.has=Vu,da.prototype.set=hf;function Bs(Se){var De=this.__data__=new Ao(Se);this.size=De.size}function Fu(){this.__data__=new Ao,this.size=0}function fa(Se){var De=this.__data__,tt=De.delete(Se);return this.size=De.size,tt}function jd(Se){return this.__data__.get(Se)}function Bd(Se){return this.__data__.has(Se)}function Ga(Se,De){var tt=this.__data__;if(tt instanceof Ao){var Kt=tt.__data__;if(!Fl||Kt.length<i-1)return Kt.push([Se,De]),this.size=++tt.size,this;tt=this.__data__=new da(Kt)}return tt.set(Se,De),this.size=tt.size,this}Bs.prototype.clear=Fu,Bs.prototype.delete=fa,Bs.prototype.get=jd,Bs.prototype.has=Bd,Bs.prototype.set=Ga;function Wd(Se,De){var tt=No(Se),Kt=!tt&&is(Se),Hn=!tt&&!Kt&&Lo(Se),yr=!tt&&!Kt&&!Hn&&_f(Se),jr=tt||Kt||Hn||yr,cn=jr?xn(Se.length,String):[],Nr=cn.length;for(var Ei in Se)jr&&(Ei=="length"||Hn&&(Ei=="offset"||Ei=="parent")||yr&&(Ei=="buffer"||Ei=="byteLength"||Ei=="byteOffset")||ll(Ei,Nr))||cn.push(Ei);return cn}function ju(Se,De,tt){(tt!==void 0&&!ko(Se[De],tt)||tt===void 0&&!(De in Se))&&Fr(Se,De,tt)}function Po(Se,De,tt){var Kt=Se[De];(!(Ge.call(Se,De)&&ko(Kt,tt))||tt===void 0&&!(De in Se))&&Fr(Se,De,tt)}function zd(Se,De){for(var tt=Se.length;tt--;)if(ko(Se[tt][0],De))return tt;return-1}function Fr(Se,De,tt){De=="__proto__"&&Wa?Wa(Se,De,{configurable:!0,enumerable:!0,value:tt,writable:!0}):Se[De]=tt}var yi=Wl();function pc(Se){return Se==null?Se===void 0?te:ee:dr&&dr in Object(Se)?Oo(Se):Wp(Se)}function al(Se){return fs(Se)&&pc(Se)==y}function pa(Se){if(!gc(Se)||$a(Se))return!1;var De=xo(Se)?an:Te;return De.test(gf(Se))}function ff(Se){return fs(Se)&&Gp(Se.length)&&!!Ae[pc(Se)]}function Gd(Se){if(!gc(Se))return mc(Se);var De=nr(Se),tt=[];for(var Kt in Se)Kt=="constructor"&&(De||!Ge.call(Se,Kt))||tt.push(Kt);return tt}function jl(Se,De,tt,Kt,Hn){Se!==De&&yi(De,function(yr,jr){if(Hn||(Hn=new Bs),gc(yr))fo(Se,De,jr,tt,jl,Kt,Hn);else{var cn=Kt?Kt(Kd(Se,jr),yr,jr+"",Se,De,Hn):void 0;cn===void 0&&(cn=yr),ju(Se,jr,cn)}},$l)}function fo(Se,De,tt,Kt,Hn,yr,jr){var cn=Kd(Se,tt),Nr=Kd(De,tt),Ei=jr.get(Nr);if(Ei){ju(Se,tt,Ei);return}var Os=yr?yr(cn,Nr,tt+"",Se,De,jr):void 0,Mo=Os===void 0;if(Mo){var Uo=No(Nr),Gu=!Uo&&Lo(Nr),Ji=!Uo&&!Gu&&_f(Nr);Os=Nr,Uo||Gu||Ji?No(cn)?Os=cn:Hl(cn)?Os=$d(cn):Gu?(Mo=!1,Os=pf(Nr)):Ji?(Mo=!1,Os=Hd(Nr)):Os=[]:zu(Nr)||is(Nr)?(Os=cn,is(cn)?Os=ul(cn):(!gc(cn)||xo(cn))&&(Os=Wu(Nr))):Mo=!1}Mo&&(jr.set(Nr,Os),Hn(Os,Nr,Kt,yr,jr),jr.delete(Nr)),ju(Se,tt,Os)}function Bp(Se,De){return mf(Gl(Se,De,ga),Se+"")}var Xs=Wa?function(Se,De){return Wa(Se,"toString",{configurable:!0,enumerable:!1,value:ma(De),writable:!0})}:ga;function pf(Se,De){return Se.slice()}function cl(Se){var De=new Se.constructor(Se.byteLength);return new Vt(De).set(new Vt(Se)),De}function Hd(Se,De){var tt=cl(Se.buffer);return new Se.constructor(tt,Se.byteOffset,Se.length)}function $d(Se,De){var tt=-1,Kt=Se.length;for(De||(De=Array(Kt));++tt<Kt;)De[tt]=Se[tt];return De}function hr(Se,De,tt,Kt){var Hn=!tt;tt||(tt={});for(var yr=-1,jr=De.length;++yr<jr;){var cn=De[yr],Nr=void 0;Nr===void 0&&(Nr=Se[cn]),Hn?Fr(tt,cn,Nr):Po(tt,cn,Nr)}return tt}function Bl(Se){return Bp(function(De,tt){var Kt=-1,Hn=tt.length,yr=Hn>1?tt[Hn-1]:void 0,jr=Hn>2?tt[2]:void 0;for(yr=Se.length>3&&typeof yr=="function"?(Hn--,yr):void 0,jr&&zl(tt[0],tt[1],jr)&&(yr=Hn<3?void 0:yr,Hn=1),De=Object(De);++Kt<Hn;){var cn=tt[Kt];cn&&Se(De,cn,Kt,yr)}return De})}function Wl(Se){return function(De,tt,Kt){for(var Hn=-1,yr=Object(De),jr=Kt(De),cn=jr.length;cn--;){var Nr=jr[++Hn];if(tt(yr[Nr],Nr,yr)===!1)break}return De}}function Bu(Se,De){var tt=Se.__data__;return Gr(De)?tt[typeof De=="string"?"string":"hash"]:tt.map}function Ha(Se,De){var tt=Yn(Se,De);return pa(tt)?tt:void 0}function Oo(Se){var De=Ge.call(Se,dr),tt=Se[dr];try{Se[dr]=void 0;var Kt=!0}catch{}var Hn=Jt.call(Se);return Kt&&(De?Se[dr]=tt:delete Se[dr]),Hn}function Wu(Se){return typeof Se.constructor=="function"&&!nr(Se)?uc(sn(Se)):{}}function ll(Se,De){var tt=typeof Se;return De=De??p,!!De&&(tt=="number"||tt!="symbol"&&be.test(Se))&&Se>-1&&Se%1==0&&Se<De}function zl(Se,De,tt){if(!gc(tt))return!1;var Kt=typeof De;return(Kt=="number"?Do(tt)&&ll(De,tt.length):Kt=="string"&&De in tt)?ko(tt[De],Se):!1}function Gr(Se){var De=typeof Se;return De=="string"||De=="number"||De=="symbol"||De=="boolean"?Se!=="__proto__":Se===null}function $a(Se){return!!Ot&&Ot in Se}function nr(Se){var De=Se&&Se.constructor,tt=typeof De=="function"&&De.prototype||Ke;return Se===tt}function mc(Se){var De=[];if(Se!=null)for(var tt in Object(Se))De.push(tt);return De}function Wp(Se){return Jt.call(Se)}function Gl(Se,De,tt){return De=uo(De===void 0?Se.length-1:De,0),function(){for(var Kt=arguments,Hn=-1,yr=uo(Kt.length-De,0),jr=Array(yr);++Hn<yr;)jr[Hn]=Kt[De+Hn];Hn=-1;for(var cn=Array(De+1);++Hn<De;)cn[Hn]=Kt[Hn];return cn[De]=tt(jr),ln(Se,this,cn)}}function Kd(Se,De){if(!(De==="constructor"&&typeof Se[De]=="function")&&De!="__proto__")return Se[De]}var mf=zp(Xs);function zp(Se){var De=0,tt=0;return function(){var Kt=ho(),Hn=d-(Kt-tt);if(tt=Kt,Hn>0){if(++De>=l)return arguments[0]}else De=0;return Se.apply(void 0,arguments)}}function gf(Se){if(Se!=null){try{return bt.call(Se)}catch{}try{return Se+""}catch{}}return""}function ko(Se,De){return Se===De||Se!==Se&&De!==De}var is=al(function(){return arguments}())?al:function(Se){return fs(Se)&&Ge.call(Se,"callee")&&!_i.call(Se,"callee")},No=Array.isArray;function Do(Se){return Se!=null&&Gp(Se.length)&&!xo(Se)}function Hl(Se){return fs(Se)&&Do(Se)}var Lo=il||dl;function xo(Se){if(!gc(Se))return!1;var De=pc(Se);return De==V||De==j||De==b||De==ne}function Gp(Se){return typeof Se=="number"&&Se>-1&&Se%1==0&&Se<=p}function gc(Se){var De=typeof Se;return Se!=null&&(De=="object"||De=="function")}function fs(Se){return Se!=null&&typeof Se=="object"}function zu(Se){if(!fs(Se)||pc(Se)!=K)return!1;var De=sn(Se);if(De===null)return!0;var tt=Ge.call(De,"constructor")&&De.constructor;return typeof tt=="function"&&tt instanceof tt&&bt.call(tt)==fn}var _f=Ut?Xt(Ut):ff;function ul(Se){return hr(Se,$l(Se))}function $l(Se){return Do(Se)?Wd(Se):Gd(Se)}var Hp=Bl(function(Se,De,tt,Kt){jl(Se,De,tt,Kt)});function ma(Se){return function(){return Se}}function ga(Se){return Se}function dl(){return!1}n.exports=Hp}(Iw,Iw.exports)),Iw.exports}var Yye=qye();const zh=I0(Yye);function Jc(n,e=[]){const i=D.useRef(n);return D.useEffect(()=>{i.current=n}),D.useCallback((...a)=>{var l;return(l=i.current)==null?void 0:l.call(i,...a)},e)}function jS(n,e,i,a){const l=Jc(i);return D.useEffect(()=>{const d=typeof n=="function"?n():n??document;if(!(!i||!d))return d.addEventListener(e,l,a),()=>{d.removeEventListener(e,l,a)}},[e,n,a,l,i]),()=>{const d=typeof n=="function"?n():n??document;d==null||d.removeEventListener(e,l,a)}}function DQ(n){const{isOpen:e,ref:i}=n,[a,l]=D.useState(e),[d,p]=D.useState(!1);return D.useEffect(()=>{d||(l(e),p(!0))},[e,d,a]),jS(()=>i.current,"animationend",()=>{l(e)}),{present:!(e?!1:!a),onComplete(){var w;const v=mye(i.current),b=new v.CustomEvent("animationend",{bubbles:!0});(w=i.current)==null||w.dispatchEvent(b)}}}function LQ(n){const{value:e,defaultValue:i,onChange:a,shouldUpdate:l=(N,V)=>N!==V}=n,d=Jc(a),p=Jc(l),[y,v]=D.useState(i),b=e!==void 0,w=b?e:y,A=Jc(N=>{const j=typeof N=="function"?N(w):N;p(w,j)&&(b||v(j),d(j))},[b,d,w,p]);return[w,A]}function rf(n={}){const{onClose:e,onOpen:i,isOpen:a,id:l}=n,d=Jc(i),p=Jc(e),[y,v]=D.useState(n.defaultIsOpen||!1),b=a!==void 0?a:y,w=a!==void 0,A=D.useId(),N=l??`disclosure-${A}`,V=D.useCallback(()=>{w||v(!1),p==null||p()},[w,p]),j=D.useCallback(()=>{w||v(!0),d==null||d()},[w,d]),B=D.useCallback(()=>{b?V():j()},[b,j,V]);function G(K={}){return{...K,"aria-expanded":b,"aria-controls":N,onClick(ne){var ce;(ce=K.onClick)==null||ce.call(K,ne),B()}}}function ee(K={}){return{...K,hidden:!b,id:N}}return{isOpen:b,onOpen:j,onClose:V,onToggle:B,isControlled:w,getButtonProps:G,getDisclosureProps:ee}}const bp=globalThis!=null&&globalThis.document?D.useLayoutEffect:D.useEffect,Eg=(n,e)=>{const i=D.useRef(!1),a=D.useRef(!1);D.useEffect(()=>{if(i.current&&a.current)return n();a.current=!0},e),D.useEffect(()=>(i.current=!0,()=>{i.current=!1}),[])};function Xye(n){const e=n.current;if(!e)return!1;const i=_ye(e);return!i||e.contains(i)?!1:!!Nye(i)}function xQ(n,e){const{shouldFocus:i,visible:a,focusRef:l}=e,d=i&&!a;Eg(()=>{if(!d||Xye(n))return;const p=(l==null?void 0:l.current)||n.current;let y;if(p)return y=requestAnimationFrame(()=>{p.focus({preventScroll:!0})}),()=>{cancelAnimationFrame(y)}},[d,n,l])}const Jye={preventScroll:!0,shouldFocus:!1};function Qye(n,e=Jye){const{focusRef:i,preventScroll:a,shouldFocus:l,visible:d}=e,p=Zye(n)?n.current:n,y=l&&d,v=D.useRef(y),b=D.useRef(d);bp(()=>{!b.current&&d&&(v.current=y),b.current=d},[d,y]);const w=D.useCallback(()=>{if(!(!d||!p||!v.current)&&(v.current=!1,!p.contains(document.activeElement)))if(i!=null&&i.current)requestAnimationFrame(()=>{var A;(A=i.current)==null||A.focus({preventScroll:a})});else{const A=PQ(p);A.length>0&&requestAnimationFrame(()=>{A[0].focus({preventScroll:a})})}},[d,a,p,i]);Eg(()=>{w()},[w]),jS(p,"transitionend",w)}function Zye(n){return"current"in n}function eEe(n){return"current"in n}const MQ=()=>typeof window<"u";function tEe(){const n=navigator.userAgentData;return(n==null?void 0:n.platform)??navigator.platform}const nEe=n=>MQ()&&n.test(navigator.vendor),rEe=n=>MQ()&&n.test(tEe()),iEe=()=>rEe(/mac|iphone|ipad|ipod/i),sEe=()=>iEe()&&nEe(/apple/i);function oEe(n){const{ref:e,elements:i,enabled:a}=n,l=()=>{var d;return((d=e.current)==null?void 0:d.ownerDocument)??document};jS(l,"pointerdown",d=>{var b,w;if(!sEe()||!a)return;const p=((w=(b=d.composedPath)==null?void 0:b.call(d))==null?void 0:w[0])??d.target,v=(i??[e]).some(A=>{const N=eEe(A)?A.current:A;return(N==null?void 0:N.contains(p))||N===p});l().activeElement!==p&&v&&(d.preventDefault(),p.focus())})}function aEe(n,e){const i=D.useId();return D.useMemo(()=>n||[e,i].filter(Boolean).join("-"),[n,e,i])}function cEe(n,...e){const i=aEe(n);return D.useMemo(()=>e.map(a=>`${a}-${i}`),[i,e])}function UQ(n){const e=D.useRef(null);return e.current=n,e}function lEe(n,e){if(n!=null){if(typeof n=="function"){n(e);return}try{n.current=e}catch{throw new Error(`Cannot assign value '${e}' to ref '${n}'`)}}}function rs(...n){return e=>{n.forEach(i=>{lEe(i,e)})}}function uEe(...n){return D.useMemo(()=>rs(...n),n)}function VQ(n){const{ref:e,handler:i,enabled:a=!0}=n,l=Jc(i),p=D.useRef({isPointerDown:!1,ignoreEmulatedMouseEvents:!1}).current;D.useEffect(()=>{if(!a)return;const y=A=>{qM(A,e)&&(p.isPointerDown=!0)},v=A=>{if(p.ignoreEmulatedMouseEvents){p.ignoreEmulatedMouseEvents=!1;return}p.isPointerDown&&i&&qM(A,e)&&(p.isPointerDown=!1,l(A))},b=A=>{p.ignoreEmulatedMouseEvents=!0,i&&p.isPointerDown&&qM(A,e)&&(p.isPointerDown=!1,l(A))},w=FQ(e.current);return w.addEventListener("mousedown",y,!0),w.addEventListener("mouseup",v,!0),w.addEventListener("touchstart",y,!0),w.addEventListener("touchend",b,!0),()=>{w.removeEventListener("mousedown",y,!0),w.removeEventListener("mouseup",v,!0),w.removeEventListener("touchstart",y,!0),w.removeEventListener("touchend",b,!0)}},[i,e,l,p,a])}function qM(n,e){var a,l;const i=((a=n.composedPath)==null?void 0:a.call(n)[0])??n.target;return i&&!FQ(i).contains(i)?!1:!((l=e.current)!=null&&l.contains(i))}function FQ(n){return(n==null?void 0:n.ownerDocument)??document}function dEe(n,e){const i=Jc(n);D.useEffect(()=>{if(e==null)return;let a=null;return a=window.setTimeout(()=>{i()},e),()=>{a&&window.clearTimeout(a)}},[e,i])}const jQ=1/60*1e3,hEe=typeof performance<"u"?()=>performance.now():()=>Date.now(),BQ=typeof window<"u"?n=>window.requestAnimationFrame(n):n=>setTimeout(()=>n(hEe()),jQ);function fEe(n){let e=[],i=[],a=0,l=!1,d=!1;const p=new WeakSet,y={schedule:(v,b=!1,w=!1)=>{const A=w&&l,N=A?e:i;return b&&p.add(v),N.indexOf(v)===-1&&(N.push(v),A&&l&&(a=e.length)),v},cancel:v=>{const b=i.indexOf(v);b!==-1&&i.splice(b,1),p.delete(v)},process:v=>{if(l){d=!0;return}if(l=!0,[e,i]=[i,e],i.length=0,a=e.length,a)for(let b=0;b<a;b++){const w=e[b];w(v),p.has(w)&&(y.schedule(w),n())}l=!1,d&&(d=!1,y.process(v))}};return y}const pEe=40;let gU=!0,hR=!1,_U=!1;const BS={delta:0,timestamp:0},zR=["read","update","preRender","render","postRender"],h1=zR.reduce((n,e)=>(n[e]=fEe(()=>hR=!0),n),{}),mEe=zR.reduce((n,e)=>{const i=h1[e];return n[e]=(a,l=!1,d=!1)=>(hR||yEe(),i.schedule(a,l,d)),n},{}),gEe=zR.reduce((n,e)=>(n[e]=h1[e].cancel,n),{});zR.reduce((n,e)=>(n[e]=()=>h1[e].process(BS),n),{});const _Ee=n=>h1[n].process(BS),WQ=n=>{hR=!1,BS.delta=gU?jQ:Math.max(Math.min(n-BS.timestamp,pEe),1),BS.timestamp=n,_U=!0,zR.forEach(_Ee),_U=!1,hR&&(gU=!1,BQ(WQ))},yEe=()=>{hR=!0,gU=!0,_U||BQ(WQ)},nK=()=>BS;var EEe=Object.defineProperty,vEe=(n,e,i)=>e in n?EEe(n,e,{enumerable:!0,configurable:!0,writable:!0,value:i}):n[e]=i,wd=(n,e,i)=>(vEe(n,typeof e!="symbol"?e+"":e,i),i);class SEe{constructor(e,i,a){if(wd(this,"history",[]),wd(this,"startEvent",null),wd(this,"lastEvent",null),wd(this,"lastEventInfo",null),wd(this,"handlers",{}),wd(this,"removeListeners",()=>{}),wd(this,"threshold",3),wd(this,"win"),wd(this,"updatePoint",()=>{if(!(this.lastEvent&&this.lastEventInfo))return;const y=YM(this.lastEventInfo,this.history),v=this.startEvent!==null,b=REe(y.offset,{x:0,y:0})>=this.threshold;if(!v&&!b)return;const{timestamp:w}=nK();this.history.push({...y.point,timestamp:w});const{onStart:A,onMove:N}=this.handlers;v||(A==null||A(this.lastEvent,y),this.startEvent=this.lastEvent),N==null||N(this.lastEvent,y)}),wd(this,"onPointerMove",(y,v)=>{this.lastEvent=y,this.lastEventInfo=v,mEe.update(this.updatePoint,!0)}),wd(this,"onPointerUp",(y,v)=>{const b=YM(v,this.history),{onEnd:w,onSessionEnd:A}=this.handlers;A==null||A(y,b),this.end(),!(!w||!this.startEvent)&&(w==null||w(y,b))}),this.win=e.view??window,Eye(e))return;this.handlers=i,a&&(this.threshold=a),e.stopPropagation(),e.preventDefault();const l={point:RQ(e)},{timestamp:d}=nK();this.history=[{...l.point,timestamp:d}];const{onSessionStart:p}=i;p==null||p(e,YM(l,this.history)),this.removeListeners=wEe(FO(this.win,"pointermove",this.onPointerMove),FO(this.win,"pointerup",this.onPointerUp),FO(this.win,"pointercancel",this.onPointerUp))}updateHandlers(e){this.handlers=e}end(){var e;(e=this.removeListeners)==null||e.call(this),gEe.update(this.updatePoint)}}function rK(n,e){return{x:n.x-e.x,y:n.y-e.y}}function YM(n,e){return{point:n.point,delta:rK(n.point,e[e.length-1]),offset:rK(n.point,e[0]),velocity:TEe(e,.1)}}const bEe=n=>n*1e3;function TEe(n,e){if(n.length<2)return{x:0,y:0};let i=n.length-1,a=null;const l=n[n.length-1];for(;i>=0&&(a=n[i],!(l.timestamp-a.timestamp>bEe(e)));)i--;if(!a)return{x:0,y:0};const d=(l.timestamp-a.timestamp)/1e3;if(d===0)return{x:0,y:0};const p={x:(l.x-a.x)/d,y:(l.y-a.y)/d};return p.x===1/0&&(p.x=0),p.y===1/0&&(p.y=0),p}function wEe(...n){return e=>n.reduce((i,a)=>a(i),e)}function XM(n,e){return Math.abs(n-e)}function iK(n){return"x"in n&&"y"in n}function REe(n,e){if(typeof n=="number"&&typeof e=="number")return XM(n,e);if(iK(n)&&iK(e)){const i=XM(n.x,e.x),a=XM(n.y,e.y);return Math.sqrt(i**2+a**2)}return 0}function CEe(n,e){const{onPan:i,onPanStart:a,onPanEnd:l,onPanSessionStart:d,onPanSessionEnd:p,threshold:y}=e,v=!!(i||a||l||d||p),b=D.useRef(null),w=UQ({onSessionStart:d,onSessionEnd:p,onStart:a,onMove:i,onEnd(A,N){b.current=null,l==null||l(A,N)}});D.useEffect(()=>{var A;(A=b.current)==null||A.updateHandlers(w.current)}),D.useEffect(()=>{const A=n.current;if(!A||!v)return;function N(V){b.current=new SEe(V,w.current,y)}return FO(A,"pointerdown",N)},[n,v,w,y]),D.useEffect(()=>()=>{var A;(A=b.current)==null||A.end(),b.current=null},[])}const so={open:(n,e)=>`${n}[data-open], ${n}[open], ${n}[data-state=open] ${e}`,closed:(n,e)=>`${n}[data-closed], ${n}[data-state=closed] ${e}`,hover:(n,e)=>`${n}:hover ${e}, ${n}[data-hover] ${e}`,focus:(n,e)=>`${n}:focus ${e}, ${n}[data-focus] ${e}`,focusVisible:(n,e)=>`${n}:focus-visible ${e}`,focusWithin:(n,e)=>`${n}:focus-within ${e}`,active:(n,e)=>`${n}:active ${e}, ${n}[data-active] ${e}`,disabled:(n,e)=>`${n}:disabled ${e}, ${n}[data-disabled] ${e}`,invalid:(n,e)=>`${n}:invalid ${e}, ${n}[data-invalid] ${e}`,checked:(n,e)=>`${n}:checked ${e}, ${n}[data-checked] ${e}`,placeholderShown:(n,e)=>`${n}:placeholder-shown ${e}`},Dh=n=>zQ(e=>n(e,"&"),"[role=group]","[data-group]",".group"),cp=n=>zQ(e=>n(e,"~ &"),"[data-peer]",".peer"),zQ=(n,...e)=>e.map(n).join(", "),WS={_hover:"&:hover, &[data-hover]",_active:"&:active, &[data-active]",_focus:"&:focus, &[data-focus]",_highlighted:"&[data-highlighted]",_focusWithin:"&:focus-within, &[data-focus-within]",_focusVisible:"&:focus-visible, &[data-focus-visible]",_disabled:"&:disabled, &[disabled], &[aria-disabled=true], &[data-disabled]",_readOnly:"&[aria-readonly=true], &[readonly], &[data-readonly]",_before:"&::before",_after:"&::after",_empty:"&:empty, &[data-empty]",_expanded:"&[aria-expanded=true], &[data-expanded], &[data-state=expanded]",_checked:"&[aria-checked=true], &[data-checked], &[data-state=checked]",_grabbed:"&[aria-grabbed=true], &[data-grabbed]",_pressed:"&[aria-pressed=true], &[data-pressed]",_invalid:"&[aria-invalid=true], &[data-invalid]",_valid:"&[data-valid], &[data-state=valid]",_loading:"&[data-loading], &[aria-busy=true]",_selected:"&[aria-selected=true], &[data-selected]",_hidden:"&[hidden], &[data-hidden]",_autofill:"&:-webkit-autofill",_even:"&:nth-of-type(even)",_odd:"&:nth-of-type(odd)",_first:"&:first-of-type",_firstLetter:"&::first-letter",_last:"&:last-of-type",_notFirst:"&:not(:first-of-type)",_notLast:"&:not(:last-of-type)",_visited:"&:visited",_activeLink:"&[aria-current=page]",_activeStep:"&[aria-current=step]",_indeterminate:"&:indeterminate, &[aria-checked=mixed], &[data-indeterminate], &[data-state=indeterminate]",_groupOpen:Dh(so.open),_groupClosed:Dh(so.closed),_groupHover:Dh(so.hover),_peerHover:cp(so.hover),_groupFocus:Dh(so.focus),_peerFocus:cp(so.focus),_groupFocusVisible:Dh(so.focusVisible),_peerFocusVisible:cp(so.focusVisible),_groupActive:Dh(so.active),_peerActive:cp(so.active),_groupDisabled:Dh(so.disabled),_peerDisabled:cp(so.disabled),_groupInvalid:Dh(so.invalid),_peerInvalid:cp(so.invalid),_groupChecked:Dh(so.checked),_peerChecked:cp(so.checked),_groupFocusWithin:Dh(so.focusWithin),_peerFocusWithin:cp(so.focusWithin),_peerPlaceholderShown:cp(so.placeholderShown),_placeholder:"&::placeholder, &[data-placeholder]",_placeholderShown:"&:placeholder-shown, &[data-placeholder-shown]",_fullScreen:"&:fullscreen, &[data-fullscreen]",_selection:"&::selection",_rtl:"[dir=rtl] &, &[dir=rtl]",_ltr:"[dir=ltr] &, &[dir=ltr]",_mediaDark:"@media (prefers-color-scheme: dark)",_mediaReduceMotion:"@media (prefers-reduced-motion: reduce)",_dark:".chakra-ui-dark &:not([data-theme]),[data-theme=dark] &:not([data-theme]),&[data-theme=dark]",_light:".chakra-ui-light &:not([data-theme]),[data-theme=light] &:not([data-theme]),&[data-theme=light]",_horizontal:"&[data-orientation=horizontal]",_vertical:"&[data-orientation=vertical]",_open:"&[data-open], &[open], &[data-state=open]",_closed:"&[data-closed], &[data-state=closed]",_complete:"&[data-complete]",_incomplete:"&[data-incomplete]",_current:"&[data-current]"},GQ=Object.keys(WS),IEe=n=>/!(important)?$/.test(n),sK=n=>typeof n=="string"?n.replace(/!(important)?$/,"").trim():n,AEe=(n,e)=>i=>{const a=String(e),l=IEe(a),d=sK(a),p=n?`${n}.${d}`:d;let y=Au(i.__cssMap)&&p in i.__cssMap?i.__cssMap[p].varRef:e;return y=sK(y),l?`${y} !important`:y};function nF(n){const{scale:e,transform:i,compose:a}=n;return(d,p)=>{const y=AEe(e,d)(p);let v=(i==null?void 0:i(y,p))??y;return a&&(v=a(v,p)),v}}const aO=(...n)=>e=>n.reduce((i,a)=>a(i),e);function Su(n,e){return i=>{const a={property:i,scale:n};return a.transform=nF({scale:n,transform:e}),a}}const PEe=({rtl:n,ltr:e})=>i=>i.direction==="rtl"?n:e;function OEe(n){const{property:e,scale:i,transform:a}=n;return{scale:i,property:PEe(e),transform:i?nF({scale:i,compose:a}):a}}const HQ=["rotate(var(--chakra-rotate, 0))","scaleX(var(--chakra-scale-x, 1))","scaleY(var(--chakra-scale-y, 1))","skewX(var(--chakra-skew-x, 0))","skewY(var(--chakra-skew-y, 0))"];function kEe(){return["translateX(var(--chakra-translate-x, 0))","translateY(var(--chakra-translate-y, 0))",...HQ].join(" ")}function NEe(){return["translate3d(var(--chakra-translate-x, 0), var(--chakra-translate-y, 0), 0)",...HQ].join(" ")}const DEe={"--chakra-blur":"var(--chakra-empty,/*!*/ /*!*/)","--chakra-brightness":"var(--chakra-empty,/*!*/ /*!*/)","--chakra-contrast":"var(--chakra-empty,/*!*/ /*!*/)","--chakra-grayscale":"var(--chakra-empty,/*!*/ /*!*/)","--chakra-hue-rotate":"var(--chakra-empty,/*!*/ /*!*/)","--chakra-invert":"var(--chakra-empty,/*!*/ /*!*/)","--chakra-saturate":"var(--chakra-empty,/*!*/ /*!*/)","--chakra-sepia":"var(--chakra-empty,/*!*/ /*!*/)","--chakra-drop-shadow":"var(--chakra-empty,/*!*/ /*!*/)",filter:["var(--chakra-blur)","var(--chakra-brightness)","var(--chakra-contrast)","var(--chakra-grayscale)","var(--chakra-hue-rotate)","var(--chakra-invert)","var(--chakra-saturate)","var(--chakra-sepia)","var(--chakra-drop-shadow)"].join(" ")},LEe={backdropFilter:["var(--chakra-backdrop-blur)","var(--chakra-backdrop-brightness)","var(--chakra-backdrop-contrast)","var(--chakra-backdrop-grayscale)","var(--chakra-backdrop-hue-rotate)","var(--chakra-backdrop-invert)","var(--chakra-backdrop-opacity)","var(--chakra-backdrop-saturate)","var(--chakra-backdrop-sepia)"].join(" "),"--chakra-backdrop-blur":"var(--chakra-empty,/*!*/ /*!*/)","--chakra-backdrop-brightness":"var(--chakra-empty,/*!*/ /*!*/)","--chakra-backdrop-contrast":"var(--chakra-empty,/*!*/ /*!*/)","--chakra-backdrop-grayscale":"var(--chakra-empty,/*!*/ /*!*/)","--chakra-backdrop-hue-rotate":"var(--chakra-empty,/*!*/ /*!*/)","--chakra-backdrop-invert":"var(--chakra-empty,/*!*/ /*!*/)","--chakra-backdrop-opacity":"var(--chakra-empty,/*!*/ /*!*/)","--chakra-backdrop-saturate":"var(--chakra-empty,/*!*/ /*!*/)","--chakra-backdrop-sepia":"var(--chakra-empty,/*!*/ /*!*/)"};function xEe(n){return{"--chakra-ring-offset-shadow":"var(--chakra-ring-inset) 0 0 0 var(--chakra-ring-offset-width) var(--chakra-ring-offset-color)","--chakra-ring-shadow":"var(--chakra-ring-inset) 0 0 0 calc(var(--chakra-ring-width) + var(--chakra-ring-offset-width)) var(--chakra-ring-color)","--chakra-ring-width":n,boxShadow:["var(--chakra-ring-offset-shadow)","var(--chakra-ring-shadow)","var(--chakra-shadow, 0 0 #0000)"].join(", ")}}const MEe={"row-reverse":{space:"--chakra-space-x-reverse",divide:"--chakra-divide-x-reverse"},"column-reverse":{space:"--chakra-space-y-reverse",divide:"--chakra-divide-y-reverse"}},yU={"to-t":"to top","to-tr":"to top right","to-r":"to right","to-br":"to bottom right","to-b":"to bottom","to-bl":"to bottom left","to-l":"to left","to-tl":"to top left"},UEe=new Set(Object.values(yU)),EU=new Set(["none","-moz-initial","inherit","initial","revert","unset"]),VEe=n=>n.trim();function FEe(n,e){if(n==null||EU.has(n))return n;if(!(vU(n)||EU.has(n)))return`url('${n}')`;const l=/(^[a-z-A-Z]+)\((.*)\)/g.exec(n),d=l==null?void 0:l[1],p=l==null?void 0:l[2];if(!d||!p)return n;const y=d.includes("-gradient")?d:`${d}-gradient`,[v,...b]=p.split(",").map(VEe).filter(Boolean);if((b==null?void 0:b.length)===0)return n;const w=v in yU?yU[v]:v;b.unshift(w);const A=b.map(N=>{if(UEe.has(N))return N;const V=N.indexOf(" "),[j,B]=V!==-1?[N.substr(0,V),N.substr(V+1)]:[N],G=vU(B)?B:B&&B.split(" "),ee=`colors.${j}`,K=ee in e.__cssMap?e.__cssMap[ee].varRef:j;return G?[K,...Array.isArray(G)?G:[G]].join(" "):K});return`${y}(${A.join(", ")})`}const vU=n=>typeof n=="string"&&n.includes("(")&&n.includes(")"),jEe=(n,e)=>FEe(n,e??{});function BEe(n){return/^var\(--.+\)$/.test(n)}const WEe=n=>{const e=parseFloat(n.toString()),i=n.toString().replace(String(e),"");return{unitless:!i,value:e,unit:i}},Lh=n=>e=>`${n}(${e})`,Ar={filter(n){return n!=="auto"?n:DEe},backdropFilter(n){return n!=="auto"?n:LEe},ring(n){return xEe(Ar.px(n))},bgClip(n){return n==="text"?{color:"transparent",backgroundClip:"text"}:{backgroundClip:n}},transform(n){return n==="auto"?kEe():n==="auto-gpu"?NEe():n},vh(n){return n==="$100vh"?"var(--chakra-vh)":n},px(n){if(n==null)return n;const{unitless:e}=WEe(n);return e||typeof n=="number"?`${n}px`:n},fraction(n){return typeof n!="number"||n>1?n:`${n*100}%`},float(n,e){const i={left:"right",right:"left"};return e.direction==="rtl"?i[n]:n},degree(n){if(BEe(n)||n==null)return n;const e=typeof n=="string"&&!n.endsWith("deg");return typeof n=="number"||e?`${n}deg`:n},gradient:jEe,blur:Lh("blur"),opacity:Lh("opacity"),brightness:Lh("brightness"),contrast:Lh("contrast"),dropShadow:Lh("drop-shadow"),grayscale:Lh("grayscale"),hueRotate:n=>Lh("hue-rotate")(Ar.degree(n)),invert:Lh("invert"),saturate:Lh("saturate"),sepia:Lh("sepia"),bgImage(n){return n==null||vU(n)||EU.has(n)?n:`url(${n})`},outline(n){const e=String(n)==="0"||String(n)==="none";return n!==null&&e?{outline:"2px solid transparent",outlineOffset:"2px"}:{outline:n}},flexDirection(n){const{space:e,divide:i}=MEe[n]??{},a={flexDirection:n};return e&&(a[e]=1),i&&(a[i]=1),a}},Be={borderWidths:Su("borderWidths"),borderStyles:Su("borderStyles"),colors:Su("colors"),borders:Su("borders"),gradients:Su("gradients",Ar.gradient),radii:Su("radii",Ar.px),space:Su("space",aO(Ar.vh,Ar.px)),spaceT:Su("space",aO(Ar.vh,Ar.px)),degreeT(n){return{property:n,transform:Ar.degree}},prop(n,e,i){return{property:n,scale:e,...e&&{transform:nF({scale:e,transform:i})}}},propT(n,e){return{property:n,transform:e}},sizes:Su("sizes",aO(Ar.vh,Ar.px)),sizesT:Su("sizes",aO(Ar.vh,Ar.fraction)),shadows:Su("shadows"),logical:OEe,blur:Su("blur",Ar.blur)},jO={background:Be.colors("background"),backgroundColor:Be.colors("backgroundColor"),backgroundImage:Be.gradients("backgroundImage"),backgroundSize:!0,backgroundPosition:!0,backgroundRepeat:!0,backgroundAttachment:!0,backgroundClip:{transform:Ar.bgClip},bgSize:Be.prop("backgroundSize"),bgPosition:Be.prop("backgroundPosition"),bg:Be.colors("background"),bgColor:Be.colors("backgroundColor"),bgPos:Be.prop("backgroundPosition"),bgRepeat:Be.prop("backgroundRepeat"),bgAttachment:Be.prop("backgroundAttachment"),bgGradient:Be.gradients("backgroundImage"),bgClip:{transform:Ar.bgClip}};Object.assign(jO,{bgImage:jO.backgroundImage,bgImg:jO.backgroundImage});const Kr={border:Be.borders("border"),borderWidth:Be.borderWidths("borderWidth"),borderStyle:Be.borderStyles("borderStyle"),borderColor:Be.colors("borderColor"),borderRadius:Be.radii("borderRadius"),borderTop:Be.borders("borderTop"),borderBlockStart:Be.borders("borderBlockStart"),borderTopLeftRadius:Be.radii("borderTopLeftRadius"),borderStartStartRadius:Be.logical({scale:"radii",property:{ltr:"borderTopLeftRadius",rtl:"borderTopRightRadius"}}),borderEndStartRadius:Be.logical({scale:"radii",property:{ltr:"borderBottomLeftRadius",rtl:"borderBottomRightRadius"}}),borderTopRightRadius:Be.radii("borderTopRightRadius"),borderStartEndRadius:Be.logical({scale:"radii",property:{ltr:"borderTopRightRadius",rtl:"borderTopLeftRadius"}}),borderEndEndRadius:Be.logical({scale:"radii",property:{ltr:"borderBottomRightRadius",rtl:"borderBottomLeftRadius"}}),borderRight:Be.borders("borderRight"),borderInlineEnd:Be.borders("borderInlineEnd"),borderBottom:Be.borders("borderBottom"),borderBlockEnd:Be.borders("borderBlockEnd"),borderBottomLeftRadius:Be.radii("borderBottomLeftRadius"),borderBottomRightRadius:Be.radii("borderBottomRightRadius"),borderLeft:Be.borders("borderLeft"),borderInlineStart:{property:"borderInlineStart",scale:"borders"},borderInlineStartRadius:Be.logical({scale:"radii",property:{ltr:["borderTopLeftRadius","borderBottomLeftRadius"],rtl:["borderTopRightRadius","borderBottomRightRadius"]}}),borderInlineEndRadius:Be.logical({scale:"radii",property:{ltr:["borderTopRightRadius","borderBottomRightRadius"],rtl:["borderTopLeftRadius","borderBottomLeftRadius"]}}),borderX:Be.borders(["borderLeft","borderRight"]),borderInline:Be.borders("borderInline"),borderY:Be.borders(["borderTop","borderBottom"]),borderBlock:Be.borders("borderBlock"),borderTopWidth:Be.borderWidths("borderTopWidth"),borderBlockStartWidth:Be.borderWidths("borderBlockStartWidth"),borderTopColor:Be.colors("borderTopColor"),borderBlockStartColor:Be.colors("borderBlockStartColor"),borderTopStyle:Be.borderStyles("borderTopStyle"),borderBlockStartStyle:Be.borderStyles("borderBlockStartStyle"),borderBottomWidth:Be.borderWidths("borderBottomWidth"),borderBlockEndWidth:Be.borderWidths("borderBlockEndWidth"),borderBottomColor:Be.colors("borderBottomColor"),borderBlockEndColor:Be.colors("borderBlockEndColor"),borderBottomStyle:Be.borderStyles("borderBottomStyle"),borderBlockEndStyle:Be.borderStyles("borderBlockEndStyle"),borderLeftWidth:Be.borderWidths("borderLeftWidth"),borderInlineStartWidth:Be.borderWidths("borderInlineStartWidth"),borderLeftColor:Be.colors("borderLeftColor"),borderInlineStartColor:Be.colors("borderInlineStartColor"),borderLeftStyle:Be.borderStyles("borderLeftStyle"),borderInlineStartStyle:Be.borderStyles("borderInlineStartStyle"),borderRightWidth:Be.borderWidths("borderRightWidth"),borderInlineEndWidth:Be.borderWidths("borderInlineEndWidth"),borderRightColor:Be.colors("borderRightColor"),borderInlineEndColor:Be.colors("borderInlineEndColor"),borderRightStyle:Be.borderStyles("borderRightStyle"),borderInlineEndStyle:Be.borderStyles("borderInlineEndStyle"),borderTopRadius:Be.radii(["borderTopLeftRadius","borderTopRightRadius"]),borderBottomRadius:Be.radii(["borderBottomLeftRadius","borderBottomRightRadius"]),borderLeftRadius:Be.radii(["borderTopLeftRadius","borderBottomLeftRadius"]),borderRightRadius:Be.radii(["borderTopRightRadius","borderBottomRightRadius"])};Object.assign(Kr,{rounded:Kr.borderRadius,roundedTop:Kr.borderTopRadius,roundedTopLeft:Kr.borderTopLeftRadius,roundedTopRight:Kr.borderTopRightRadius,roundedTopStart:Kr.borderStartStartRadius,roundedTopEnd:Kr.borderStartEndRadius,roundedBottom:Kr.borderBottomRadius,roundedBottomLeft:Kr.borderBottomLeftRadius,roundedBottomRight:Kr.borderBottomRightRadius,roundedBottomStart:Kr.borderEndStartRadius,roundedBottomEnd:Kr.borderEndEndRadius,roundedLeft:Kr.borderLeftRadius,roundedRight:Kr.borderRightRadius,roundedStart:Kr.borderInlineStartRadius,roundedEnd:Kr.borderInlineEndRadius,borderStart:Kr.borderInlineStart,borderEnd:Kr.borderInlineEnd,borderTopStartRadius:Kr.borderStartStartRadius,borderTopEndRadius:Kr.borderStartEndRadius,borderBottomStartRadius:Kr.borderEndStartRadius,borderBottomEndRadius:Kr.borderEndEndRadius,borderStartRadius:Kr.borderInlineStartRadius,borderEndRadius:Kr.borderInlineEndRadius,borderStartWidth:Kr.borderInlineStartWidth,borderEndWidth:Kr.borderInlineEndWidth,borderStartColor:Kr.borderInlineStartColor,borderEndColor:Kr.borderInlineEndColor,borderStartStyle:Kr.borderInlineStartStyle,borderEndStyle:Kr.borderInlineEndStyle});const zEe={color:Be.colors("color"),textColor:Be.colors("color"),fill:Be.colors("fill"),stroke:Be.colors("stroke"),accentColor:Be.colors("accentColor"),textFillColor:Be.colors("textFillColor")},Sk={alignItems:!0,alignContent:!0,justifyItems:!0,justifyContent:!0,flexWrap:!0,flexDirection:{transform:Ar.flexDirection},flex:!0,flexFlow:!0,flexGrow:!0,flexShrink:!0,flexBasis:Be.sizes("flexBasis"),justifySelf:!0,alignSelf:!0,order:!0,placeItems:!0,placeContent:!0,placeSelf:!0,gap:Be.space("gap"),rowGap:Be.space("rowGap"),columnGap:Be.space("columnGap")};Object.assign(Sk,{flexDir:Sk.flexDirection});const wu={width:Be.sizesT("width"),inlineSize:Be.sizesT("inlineSize"),height:Be.sizes("height"),blockSize:Be.sizes("blockSize"),boxSize:Be.sizes(["width","height"]),minWidth:Be.sizes("minWidth"),minInlineSize:Be.sizes("minInlineSize"),minHeight:Be.sizes("minHeight"),minBlockSize:Be.sizes("minBlockSize"),maxWidth:Be.sizes("maxWidth"),maxInlineSize:Be.sizes("maxInlineSize"),maxHeight:Be.sizes("maxHeight"),maxBlockSize:Be.sizes("maxBlockSize"),overflow:!0,overflowX:!0,overflowY:!0,overscrollBehavior:!0,overscrollBehaviorX:!0,overscrollBehaviorY:!0,display:!0,aspectRatio:!0,hideFrom:{scale:"breakpoints",transform:(n,e)=>{var l,d;return{[`@media screen and (min-width: ${((d=(l=e.__breakpoints)==null?void 0:l.get(n))==null?void 0:d.minW)??n})`]:{display:"none"}}}},hideBelow:{scale:"breakpoints",transform:(n,e)=>{var l,d;return{[`@media screen and (max-width: ${((d=(l=e.__breakpoints)==null?void 0:l.get(n))==null?void 0:d._minW)??n})`]:{display:"none"}}}},verticalAlign:!0,boxSizing:!0,boxDecorationBreak:!0,float:Be.propT("float",Ar.float),objectFit:!0,objectPosition:!0,visibility:!0,isolation:!0};Object.assign(wu,{w:wu.width,h:wu.height,minW:wu.minWidth,maxW:wu.maxWidth,minH:wu.minHeight,maxH:wu.maxHeight,overscroll:wu.overscrollBehavior,overscrollX:wu.overscrollBehaviorX,overscrollY:wu.overscrollBehaviorY});const GEe={filter:{transform:Ar.filter},blur:Be.blur("--chakra-blur"),brightness:Be.propT("--chakra-brightness",Ar.brightness),contrast:Be.propT("--chakra-contrast",Ar.contrast),hueRotate:Be.propT("--chakra-hue-rotate",Ar.hueRotate),invert:Be.propT("--chakra-invert",Ar.invert),saturate:Be.propT("--chakra-saturate",Ar.saturate),dropShadow:Be.propT("--chakra-drop-shadow",Ar.dropShadow),backdropFilter:{transform:Ar.backdropFilter},backdropBlur:Be.blur("--chakra-backdrop-blur"),backdropBrightness:Be.propT("--chakra-backdrop-brightness",Ar.brightness),backdropContrast:Be.propT("--chakra-backdrop-contrast",Ar.contrast),backdropHueRotate:Be.propT("--chakra-backdrop-hue-rotate",Ar.hueRotate),backdropInvert:Be.propT("--chakra-backdrop-invert",Ar.invert),backdropSaturate:Be.propT("--chakra-backdrop-saturate",Ar.saturate)},HEe={ring:{transform:Ar.ring},ringColor:Be.colors("--chakra-ring-color"),ringOffset:Be.prop("--chakra-ring-offset-width"),ringOffsetColor:Be.colors("--chakra-ring-offset-color"),ringInset:Be.prop("--chakra-ring-inset")},$Ee={appearance:!0,cursor:!0,resize:!0,userSelect:!0,pointerEvents:!0,outline:{transform:Ar.outline},outlineOffset:!0,outlineColor:Be.colors("outlineColor")},$Q={gridGap:Be.space("gridGap"),gridColumnGap:Be.space("gridColumnGap"),gridRowGap:Be.space("gridRowGap"),gridColumn:!0,gridRow:!0,gridAutoFlow:!0,gridAutoColumns:!0,gridColumnStart:!0,gridColumnEnd:!0,gridRowStart:!0,gridRowEnd:!0,gridAutoRows:!0,gridTemplate:!0,gridTemplateColumns:!0,gridTemplateRows:!0,gridTemplateAreas:!0,gridArea:!0};function KEe(n,e,i,a){const l=typeof e=="string"?e.split("."):[e];for(a=0;a<l.length&&n;a+=1)n=n[l[a]];return n===void 0?i:n}const qEe=n=>{const e=new WeakMap;return(a,l,d,p)=>{if(typeof a>"u")return n(a,l,d);e.has(a)||e.set(a,new Map);const y=e.get(a);if(y.has(l))return y.get(l);const v=n(a,l,d,p);return y.set(l,v),v}},YEe=qEe(KEe),XEe={border:"0px",clip:"rect(0, 0, 0, 0)",width:"1px",height:"1px",margin:"-1px",padding:"0px",overflow:"hidden",whiteSpace:"nowrap",position:"absolute"},JEe={position:"static",width:"auto",height:"auto",clip:"auto",padding:"0",margin:"0",overflow:"visible",whiteSpace:"normal"},JM=(n,e,i)=>{const a={},l=YEe(n,e,{});for(const d in l)d in i&&i[d]!=null||(a[d]=l[d]);return a},QEe={srOnly:{transform(n){return n===!0?XEe:n==="focusable"?JEe:{}}},layerStyle:{processResult:!0,transform:(n,e,i)=>JM(e,`layerStyles.${n}`,i)},textStyle:{processResult:!0,transform:(n,e,i)=>JM(e,`textStyles.${n}`,i)},apply:{processResult:!0,transform:(n,e,i)=>JM(e,n,i)}},Gw={position:!0,pos:Be.prop("position"),zIndex:Be.prop("zIndex","zIndices"),inset:Be.spaceT("inset"),insetX:Be.spaceT(["left","right"]),insetInline:Be.spaceT("insetInline"),insetY:Be.spaceT(["top","bottom"]),insetBlock:Be.spaceT("insetBlock"),top:Be.spaceT("top"),insetBlockStart:Be.spaceT("insetBlockStart"),bottom:Be.spaceT("bottom"),insetBlockEnd:Be.spaceT("insetBlockEnd"),left:Be.spaceT("left"),insetInlineStart:Be.logical({scale:"space",property:{ltr:"left",rtl:"right"}}),right:Be.spaceT("right"),insetInlineEnd:Be.logical({scale:"space",property:{ltr:"right",rtl:"left"}})};Object.assign(Gw,{insetStart:Gw.insetInlineStart,insetEnd:Gw.insetInlineEnd});const SU={boxShadow:Be.shadows("boxShadow"),mixBlendMode:!0,blendMode:Be.prop("mixBlendMode"),backgroundBlendMode:!0,bgBlendMode:Be.prop("backgroundBlendMode"),opacity:!0};Object.assign(SU,{shadow:SU.boxShadow});const qi={margin:Be.spaceT("margin"),marginTop:Be.spaceT("marginTop"),marginBlockStart:Be.spaceT("marginBlockStart"),marginRight:Be.spaceT("marginRight"),marginInlineEnd:Be.spaceT("marginInlineEnd"),marginBottom:Be.spaceT("marginBottom"),marginBlockEnd:Be.spaceT("marginBlockEnd"),marginLeft:Be.spaceT("marginLeft"),marginInlineStart:Be.spaceT("marginInlineStart"),marginX:Be.spaceT(["marginInlineStart","marginInlineEnd"]),marginInline:Be.spaceT("marginInline"),marginY:Be.spaceT(["marginTop","marginBottom"]),marginBlock:Be.spaceT("marginBlock"),padding:Be.space("padding"),paddingTop:Be.space("paddingTop"),paddingBlockStart:Be.space("paddingBlockStart"),paddingRight:Be.space("paddingRight"),paddingBottom:Be.space("paddingBottom"),paddingBlockEnd:Be.space("paddingBlockEnd"),paddingLeft:Be.space("paddingLeft"),paddingInlineStart:Be.space("paddingInlineStart"),paddingInlineEnd:Be.space("paddingInlineEnd"),paddingX:Be.space(["paddingInlineStart","paddingInlineEnd"]),paddingInline:Be.space("paddingInline"),paddingY:Be.space(["paddingTop","paddingBottom"]),paddingBlock:Be.space("paddingBlock")};Object.assign(qi,{m:qi.margin,mt:qi.marginTop,mr:qi.marginRight,me:qi.marginInlineEnd,marginEnd:qi.marginInlineEnd,mb:qi.marginBottom,ml:qi.marginLeft,ms:qi.marginInlineStart,marginStart:qi.marginInlineStart,mx:qi.marginX,my:qi.marginY,p:qi.padding,pt:qi.paddingTop,py:qi.paddingY,px:qi.paddingX,pb:qi.paddingBottom,pl:qi.paddingLeft,ps:qi.paddingInlineStart,paddingStart:qi.paddingInlineStart,pr:qi.paddingRight,pe:qi.paddingInlineEnd,paddingEnd:qi.paddingInlineEnd});const ZEe={scrollBehavior:!0,scrollSnapAlign:!0,scrollSnapStop:!0,scrollSnapType:!0,scrollMargin:Be.spaceT("scrollMargin"),scrollMarginTop:Be.spaceT("scrollMarginTop"),scrollMarginBottom:Be.spaceT("scrollMarginBottom"),scrollMarginLeft:Be.spaceT("scrollMarginLeft"),scrollMarginRight:Be.spaceT("scrollMarginRight"),scrollMarginX:Be.spaceT(["scrollMarginLeft","scrollMarginRight"]),scrollMarginY:Be.spaceT(["scrollMarginTop","scrollMarginBottom"]),scrollPadding:Be.spaceT("scrollPadding"),scrollPaddingTop:Be.spaceT("scrollPaddingTop"),scrollPaddingBottom:Be.spaceT("scrollPaddingBottom"),scrollPaddingLeft:Be.spaceT("scrollPaddingLeft"),scrollPaddingRight:Be.spaceT("scrollPaddingRight"),scrollPaddingX:Be.spaceT(["scrollPaddingLeft","scrollPaddingRight"]),scrollPaddingY:Be.spaceT(["scrollPaddingTop","scrollPaddingBottom"])},eve={fontFamily:Be.prop("fontFamily","fonts"),fontSize:Be.prop("fontSize","fontSizes",Ar.px),fontWeight:Be.prop("fontWeight","fontWeights"),lineHeight:Be.prop("lineHeight","lineHeights"),letterSpacing:Be.prop("letterSpacing","letterSpacings"),textAlign:!0,fontStyle:!0,textIndent:!0,wordBreak:!0,overflowWrap:!0,textOverflow:!0,textTransform:!0,whiteSpace:!0,isTruncated:{transform(n){if(n===!0)return{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"}}},noOfLines:{static:{overflow:"hidden",textOverflow:"ellipsis",display:"-webkit-box",WebkitBoxOrient:"vertical",WebkitLineClamp:"var(--chakra-line-clamp)"},property:"--chakra-line-clamp"}},tve={textDecorationColor:Be.colors("textDecorationColor"),textDecoration:!0,textDecor:{property:"textDecoration"},textDecorationLine:!0,textDecorationStyle:!0,textDecorationThickness:!0,textUnderlineOffset:!0,textShadow:Be.shadows("textShadow")},nve={clipPath:!0,transform:Be.propT("transform",Ar.transform),transformOrigin:!0,translateX:Be.spaceT("--chakra-translate-x"),translateY:Be.spaceT("--chakra-translate-y"),skewX:Be.degreeT("--chakra-skew-x"),skewY:Be.degreeT("--chakra-skew-y"),scaleX:Be.prop("--chakra-scale-x"),scaleY:Be.prop("--chakra-scale-y"),scale:Be.prop(["--chakra-scale-x","--chakra-scale-y"]),rotate:Be.degreeT("--chakra-rotate")},rve={listStyleType:!0,listStylePosition:!0,listStylePos:Be.prop("listStylePosition"),listStyleImage:!0,listStyleImg:Be.prop("listStyleImage")},ive={transition:!0,transitionDelay:!0,animation:!0,willChange:!0,transitionDuration:Be.prop("transitionDuration","transition.duration"),transitionProperty:Be.prop("transitionProperty","transition.property"),transitionTimingFunction:Be.prop("transitionTimingFunction","transition.easing")},rF=zh({},jO,Kr,zEe,Sk,wu,GEe,HEe,$Ee,$Q,QEe,Gw,SU,qi,ZEe,eve,tve,nve,rve,ive),sve=Object.assign({},qi,wu,Sk,$Q,Gw),ove=Object.keys(sve),ave=[...Object.keys(rF),...GQ],cve={...rF,...WS},lve=n=>n in cve,uve=n=>e=>{if(!e.__breakpoints)return n;const{isResponsive:i,toArrayValue:a,media:l}=e.__breakpoints,d={};for(const p in n){let y=Xc(n[p],e);if(y==null)continue;if(y=Au(y)&&i(y)?a(y):y,!Array.isArray(y)){d[p]=y;continue}const v=y.slice(0,l.length).length;for(let b=0;b<v;b+=1){const w=l==null?void 0:l[b];if(!w){d[p]=y[b];continue}d[w]=d[w]||{},y[b]!=null&&(d[w][p]=y[b])}}return d};function dve(n){const e=[];let i="",a=!1;for(let l=0;l<n.length;l++){const d=n[l];d==="("?(a=!0,i+=d):d===")"?(a=!1,i+=d):d===","&&!a?(e.push(i),i=""):i+=d}return i=i.trim(),i&&e.push(i),e}function hve(n){return/^var\(--.+\)$/.test(n)}const fve=(n,e)=>n.startsWith("--")&&typeof e=="string"&&!hve(e),pve=(n,e)=>{if(e==null)return e;const i=p=>{var y,v;return(v=(y=n.__cssMap)==null?void 0:y[p])==null?void 0:v.varRef},a=p=>i(p)??p,[l,d]=dve(e);return e=i(l)??a(d)??a(e),e};function mve(n){const{configs:e={},pseudos:i={},theme:a}=n,l=(d,p=!1)=>{var w;const y=Xc(d,a),v=uve(y)(a);let b={};for(let A in v){const N=v[A];let V=Xc(N,a);A in i&&(A=i[A]),fve(A,V)&&(V=pve(a,V));let j=e[A];if(j===!0&&(j={property:A}),Au(V)){b[A]=b[A]??{},b[A]=zh({},b[A],l(V,!0));continue}let B=((w=j==null?void 0:j.transform)==null?void 0:w.call(j,V,a,y))??V;B=j!=null&&j.processResult?l(B,!0):B;const G=Xc(j==null?void 0:j.property,a);if(!p&&(j!=null&&j.static)){const ee=Xc(j.static,a);b=zh({},b,ee)}if(G&&Array.isArray(G)){for(const ee of G)b[ee]=B;continue}if(G){G==="&"&&Au(B)?b=zh({},b,B):b[G]=B;continue}if(Au(B)){b=zh({},b,B);continue}b[A]=B}return b};return l}const KQ=n=>e=>mve({theme:e,pseudos:WS,configs:rF})(n);function Q8e(n){return n}function Z8e(n){return n}function Vi(n){return{definePartsStyle(e){return e},defineMultiStyleConfig(e){return{parts:n,...e}}}}function gve(n,e,i){var a,l;return((l=(a=n.__cssMap)==null?void 0:a[`${e}.${i}`])==null?void 0:l.varRef)??i}function _ve(n,e){if(Array.isArray(n))return n;if(Au(n))return e(n);if(n!=null)return[n]}function yve(n,e){for(let i=e+1;i<n.length;i++)if(n[i]!=null)return i;return-1}function Eve(n){const e=n.__breakpoints;return function(a,l,d,p){var N,V;if(!e)return;const y={},v=_ve(d,e.toArrayValue);if(!v)return y;const b=v.length,w=b===1,A=!!a.parts;for(let j=0;j<b;j++){const B=e.details[j],G=e.details[yve(v,j)],ee=Cw(B.minW,G==null?void 0:G._minW),K=Xc((N=a[l])==null?void 0:N[v[j]],p);if(K){if(A){(V=a.parts)==null||V.forEach(ne=>{zh(y,{[ne]:w?K[ne]:{[ee]:K[ne]}})});continue}if(!A){w?zh(y,K):y[ee]=K;continue}y[ee]=K}}return y}}function vve(n){return e=>{const{variant:i,size:a,theme:l}=e,d=Eve(l);return zh({},Xc(n.baseStyle??{},e),d(n,"sizes",a,e),d(n,"variants",i,e))}}function Fi(n){return A0(n,["styleConfig","size","variant","colorScheme"])}function qQ(n){return Au(n)&&n.reference?n.reference:String(n)}const f1=(n,...e)=>e.map(qQ).join(` ${n} `).replace(/calc/g,""),oK=(...n)=>`calc(${f1("+",...n)})`,aK=(...n)=>`calc(${f1("-",...n)})`,bU=(...n)=>`calc(${f1("*",...n)})`,cK=(...n)=>`calc(${f1("/",...n)})`,lK=n=>{const e=qQ(n);return e!=null&&!Number.isNaN(parseFloat(e))?String(e).startsWith("-")?String(e).slice(1):`-${e}`:bU(e,-1)},fp=Object.assign(n=>({add:(...e)=>fp(oK(n,...e)),subtract:(...e)=>fp(aK(n,...e)),multiply:(...e)=>fp(bU(n,...e)),divide:(...e)=>fp(cK(n,...e)),negate:()=>fp(lK(n)),toString:()=>n.toString()}),{add:oK,subtract:aK,multiply:bU,divide:cK,negate:lK});function Sve(n,e="-"){return n.replace(/\s+/g,e)}function bve(n){const e=Sve(n.toString());return wve(Tve(e))}function Tve(n){return n.includes("\\.")?n:!Number.isInteger(parseFloat(n.toString()))?n.replace(".","\\."):n}function wve(n){return n.replace(/[!-,/:-@[-^`{-~]/g,"\\$&")}function Rve(n,e=""){return[e,n].filter(Boolean).join("-")}function Cve(n,e){return`var(${n}${e?`, ${e}`:""})`}function Ive(n,e=""){return bve(`--${Rve(n,e)}`)}function Pn(n,e,i){const a=Ive(n,i);return{variable:a,reference:Cve(a,e)}}function Ave(n,e){const i={};for(const a of e){if(Array.isArray(a)){const[l,d]=a;i[l]=Pn(`${n}-${l}`,d);continue}i[a]=Pn(`${n}-${a}`)}return i}const Pve=["colors","borders","borderWidths","borderStyles","fonts","fontSizes","fontWeights","gradients","letterSpacings","lineHeights","radii","space","shadows","sizes","zIndices","transition","blur","breakpoints"];function Ove(n){return kQ(n,Pve)}function kve(n){return n.semanticTokens}function Nve(n){const{__cssMap:e,__cssVars:i,__breakpoints:a,...l}=n;return l}function Dve(n){const e=Ove(n),i=kve(n),a=d=>GQ.includes(d)||d==="default",l={};return eK(e,(d,p)=>{d!=null&&(l[p.join(".")]={isSemantic:!1,value:d})}),eK(i,(d,p)=>{d!=null&&(l[p.join(".")]={isSemantic:!0,value:d})},{stop:d=>Object.keys(d).every(a)}),l}function uK(n,e){return Pn(String(n).replace(/\./g,"-"),void 0,e)}function Lve(n){var p;const e=Dve(n),i=(p=n.config)==null?void 0:p.cssVarPrefix;let a={};const l={};function d(y,v){const w=[String(y).split(".")[0],v].join(".");if(!e[w])return v;const{reference:N}=uK(w,i);return N}for(const[y,v]of Object.entries(e)){const{isSemantic:b,value:w}=v,{variable:A,reference:N}=uK(y,i);if(!b){if(y.startsWith("space")){const j=y.split("."),[B,...G]=j,ee=`${B}.-${G.join(".")}`,K=fp.negate(w),ne=fp.negate(N);l[ee]={value:K,var:A,varRef:ne}}a[A]=w,l[y]={value:w,var:A,varRef:N};continue}const V=Au(w)?w:{default:w};a=zh(a,Object.entries(V).reduce((j,[B,G])=>{if(!G)return j;const ee=d(y,`${G}`);if(B==="default")return j[A]=ee,j;const K=(WS==null?void 0:WS[B])??B;return j[K]={[A]:ee},j},{})),l[y]={value:N,var:A,varRef:N}}return{cssVars:a,cssMap:l}}function xve(n){const e=Nve(n),{cssMap:i,cssVars:a}=Lve(e);return Object.assign(e,{__cssVars:{...{"--chakra-ring-inset":"var(--chakra-empty,/*!*/ /*!*/)","--chakra-ring-offset-width":"0px","--chakra-ring-offset-color":"#fff","--chakra-ring-color":"rgba(66, 153, 225, 0.6)","--chakra-ring-offset-shadow":"0 0 #0000","--chakra-ring-shadow":"0 0 #0000","--chakra-space-x-reverse":"0","--chakra-space-y-reverse":"0"},...a},__cssMap:i,__breakpoints:Pye(e.breakpoints)}),e}function Jr(n,e={}){let i=!1;function a(){if(!i){i=!0;return}throw new Error("[anatomy] .part(...) should only be called once. Did you mean to use .extend(...) ?")}function l(...w){a();for(const A of w)e[A]=v(A);return Jr(n,e)}function d(...w){for(const A of w)A in e||(e[A]=v(A));return Jr(n,e)}function p(){return Object.fromEntries(Object.entries(e).map(([A,N])=>[A,N.selector]))}function y(){return Object.fromEntries(Object.entries(e).map(([A,N])=>[A,N.className]))}function v(w){const V=`chakra-${(["container","root"].includes(w??"")?[n]:[n,w]).filter(Boolean).join("__")}`;return{className:V,selector:`.${V}`,toString:()=>w}}return{parts:l,toPart:v,extend:d,selectors:p,classnames:y,get keys(){return Object.keys(e)},__type:{}}}const Mve=Jr("accordion").parts("root","container","button","panel","icon"),Uve=Jr("alert").parts("title","description","container","icon","spinner"),Vve=Jr("avatar").parts("label","badge","container","excessLabel","group"),Fve=Jr("breadcrumb").parts("link","item","container","separator");Jr("button").parts();const jve=Jr("checkbox").parts("control","icon","container","label");Jr("progress").parts("track","filledTrack","label");const Bve=Jr("drawer").parts("overlay","dialogContainer","dialog","header","closeButton","body","footer"),Wve=Jr("editable").parts("preview","input","textarea"),zve=Jr("form").parts("container","requiredIndicator","helperText"),Gve=Jr("formError").parts("text","icon"),Hve=Jr("input").parts("addon","field","element","group"),$ve=Jr("list").parts("container","item","icon"),Kve=Jr("menu").parts("button","list","item","groupTitle","icon","command","divider"),qve=Jr("modal").parts("overlay","dialogContainer","dialog","header","closeButton","body","footer"),Yve=Jr("numberinput").parts("root","field","stepperGroup","stepper");Jr("pininput").parts("field");const Xve=Jr("popover").parts("content","header","body","footer","popper","arrow","closeButton"),Jve=Jr("progress").parts("label","filledTrack","track"),Qve=Jr("radio").parts("container","control","label"),Zve=Jr("select").parts("field","icon"),eSe=Jr("slider").parts("container","track","thumb","filledTrack","mark"),tSe=Jr("stat").parts("container","label","helpText","number","icon"),nSe=Jr("switch").parts("container","track","thumb","label"),rSe=Jr("table").parts("table","thead","tbody","tr","th","td","tfoot","caption"),iSe=Jr("tabs").parts("root","tab","tablist","tabpanel","tabpanels","indicator"),sSe=Jr("tag").parts("container","label","closeButton"),oSe=Jr("card").parts("container","header","body","footer");Jr("stepper").parts("stepper","step","title","description","indicator","separator","icon","number");const{definePartsStyle:aSe,defineMultiStyleConfig:cSe}=Vi(Mve.keys),lSe={borderTopWidth:"1px",borderColor:"inherit",_last:{borderBottomWidth:"1px"}},uSe={transitionProperty:"common",transitionDuration:"normal",fontSize:"md",_focusVisible:{boxShadow:"outline"},_hover:{bg:"blackAlpha.50"},_disabled:{opacity:.4,cursor:"not-allowed"},px:"4",py:"2"},dSe={pt:"2",px:"4",pb:"5"},hSe={fontSize:"1.25em"},fSe=aSe({container:lSe,button:uSe,panel:dSe,icon:hSe}),pSe=cSe({baseStyle:fSe});function gy(n,e,i){return Math.min(Math.max(n,i),e)}class mSe extends Error{constructor(e){super(`Failed to parse color: "${e}"`)}}var Aw=mSe;function iF(n){if(typeof n!="string")throw new Aw(n);if(n.trim().toLowerCase()==="transparent")return[0,0,0,0];let e=n.trim();e=TSe.test(n)?ySe(n):n;const i=ESe.exec(e);if(i){const p=Array.from(i).slice(1);return[...p.slice(0,3).map(y=>parseInt(fR(y,2),16)),parseInt(fR(p[3]||"f",2),16)/255]}const a=vSe.exec(e);if(a){const p=Array.from(a).slice(1);return[...p.slice(0,3).map(y=>parseInt(y,16)),parseInt(p[3]||"ff",16)/255]}const l=SSe.exec(e);if(l){const p=Array.from(l).slice(1);return[...p.slice(0,3).map(y=>parseInt(y,10)),parseFloat(p[3]||"1")]}const d=bSe.exec(e);if(d){const[p,y,v,b]=Array.from(d).slice(1).map(parseFloat);if(gy(0,100,y)!==y)throw new Aw(n);if(gy(0,100,v)!==v)throw new Aw(n);return[...wSe(p,y,v),Number.isNaN(b)?1:b]}throw new Aw(n)}function gSe(n){let e=5381,i=n.length;for(;i;)e=e*33^n.charCodeAt(--i);return(e>>>0)%2341}const dK=n=>parseInt(n.replace(/_/g,""),36),_Se="1q29ehhb 1n09sgk7 1kl1ekf_ _yl4zsno 16z9eiv3 1p29lhp8 _bd9zg04 17u0____ _iw9zhe5 _to73___ _r45e31e _7l6g016 _jh8ouiv _zn3qba8 1jy4zshs 11u87k0u 1ro9yvyo 1aj3xael 1gz9zjz0 _3w8l4xo 1bf1ekf_ _ke3v___ _4rrkb__ 13j776yz _646mbhl _nrjr4__ _le6mbhl 1n37ehkb _m75f91n _qj3bzfz 1939yygw 11i5z6x8 _1k5f8xs 1509441m 15t5lwgf _ae2th1n _tg1ugcv 1lp1ugcv 16e14up_ _h55rw7n _ny9yavn _7a11xb_ 1ih442g9 _pv442g9 1mv16xof 14e6y7tu 1oo9zkds 17d1cisi _4v9y70f _y98m8kc 1019pq0v 12o9zda8 _348j4f4 1et50i2o _8epa8__ _ts6senj 1o350i2o 1mi9eiuo 1259yrp0 1ln80gnw _632xcoy 1cn9zldc _f29edu4 1n490c8q _9f9ziet 1b94vk74 _m49zkct 1kz6s73a 1eu9dtog _q58s1rz 1dy9sjiq __u89jo3 _aj5nkwg _ld89jo3 13h9z6wx _qa9z2ii _l119xgq _bs5arju 1hj4nwk9 1qt4nwk9 1ge6wau6 14j9zlcw 11p1edc_ _ms1zcxe _439shk6 _jt9y70f _754zsow 1la40eju _oq5p___ _x279qkz 1fa5r3rv _yd2d9ip _424tcku _8y1di2_ _zi2uabw _yy7rn9h 12yz980_ __39ljp6 1b59zg0x _n39zfzp 1fy9zest _b33k___ _hp9wq92 1il50hz4 _io472ub _lj9z3eo 19z9ykg0 _8t8iu3a 12b9bl4a 1ak5yw0o _896v4ku _tb8k8lv _s59zi6t _c09ze0p 1lg80oqn 1id9z8wb _238nba5 1kq6wgdi _154zssg _tn3zk49 _da9y6tc 1sg7cv4f _r12jvtt 1gq5fmkz 1cs9rvci _lp9jn1c _xw1tdnb 13f9zje6 16f6973h _vo7ir40 _bt5arjf _rc45e4t _hr4e100 10v4e100 _hc9zke2 _w91egv_ _sj2r1kk 13c87yx8 _vqpds__ _ni8ggk8 _tj9yqfb 1ia2j4r4 _7x9b10u 1fc9ld4j 1eq9zldr _5j9lhpx _ez9zl6o _md61fzm".split(" ").reduce((n,e)=>{const i=dK(e.substring(0,3)),a=dK(e.substring(3)).toString(16);let l="";for(let d=0;d<6-a.length;d++)l+="0";return n[i]=`${l}${a}`,n},{});function ySe(n){const e=n.toLowerCase().trim(),i=_Se[gSe(e)];if(!i)throw new Aw(n);return`#${i}`}const fR=(n,e)=>Array.from(Array(e)).map(()=>n).join(""),ESe=new RegExp(`^#${fR("([a-f0-9])",3)}([a-f0-9])?$`,"i"),vSe=new RegExp(`^#${fR("([a-f0-9]{2})",3)}([a-f0-9]{2})?$`,"i"),SSe=new RegExp(`^rgba?\\(\\s*(\\d+)\\s*${fR(",\\s*(\\d+)\\s*",2)}(?:,\\s*([\\d.]+))?\\s*\\)$`,"i"),bSe=/^hsla?\(\s*([\d.]+)\s*,\s*([\d.]+)%\s*,\s*([\d.]+)%(?:\s*,\s*([\d.]+))?\s*\)$/i,TSe=/^[a-z]+$/i,hK=n=>Math.round(n*255),wSe=(n,e,i)=>{let a=i/100;if(e===0)return[a,a,a].map(hK);const l=(n%360+360)%360/60,d=(1-Math.abs(2*a-1))*(e/100),p=d*(1-Math.abs(l%2-1));let y=0,v=0,b=0;l>=0&&l<1?(y=d,v=p):l>=1&&l<2?(y=p,v=d):l>=2&&l<3?(v=d,b=p):l>=3&&l<4?(v=p,b=d):l>=4&&l<5?(y=p,b=d):l>=5&&l<6&&(y=d,b=p);const w=a-d/2,A=y+w,N=v+w,V=b+w;return[A,N,V].map(hK)};function RSe(n,e,i,a){return`rgba(${gy(0,255,n).toFixed()}, ${gy(0,255,e).toFixed()}, ${gy(0,255,i).toFixed()}, ${parseFloat(gy(0,1,a).toFixed(3))})`}function CSe(n,e){const[i,a,l,d]=iF(n);return RSe(i,a,l,d-e)}function ISe(n){const[e,i,a,l]=iF(n);let d=p=>{const y=gy(0,255,p).toString(16);return y.length===1?`0${y}`:y};return`#${d(e)}${d(i)}${d(a)}${l<1?d(Math.round(l*255)):""}`}const ASe=n=>Object.keys(n).length===0;function PSe(n,e,i,a,l){for(e=e.split?e.split("."):e,a=0;a<e.length;a++)n=n?n[e[a]]:l;return n===l?i:n}const ac=(n,e,i)=>{const a=PSe(n,`colors.${e}`,e);try{return ISe(a),a}catch{return i??"#000000"}},OSe=n=>{const[e,i,a]=iF(n);return(e*299+i*587+a*114)/1e3},kSe=n=>e=>{const i=ac(e,n);return OSe(i)<128?"dark":"light"},NSe=n=>e=>kSe(n)(e)==="dark",r0=(n,e)=>i=>{const a=ac(i,n);return CSe(a,1-e)};function fK(n="1rem",e="rgba(255, 255, 255, 0.15)"){return{backgroundImage:`linear-gradient(
    45deg,
    ${e} 25%,
    transparent 25%,
    transparent 50%,
    ${e} 50%,
    ${e} 75%,
    transparent 75%,
    transparent
  )`,backgroundSize:`${n} ${n}`}}const DSe=()=>`#${Math.floor(Math.random()*16777215).toString(16).padEnd(6,"0")}`;function LSe(n){const e=DSe();return!n||ASe(n)?e:n.string&&n.colors?MSe(n.string,n.colors):n.string&&!n.colors?xSe(n.string):n.colors&&!n.string?USe(n.colors):e}function xSe(n){let e=0;if(n.length===0)return e.toString();for(let a=0;a<n.length;a+=1)e=n.charCodeAt(a)+((e<<5)-e),e=e&e;let i="#";for(let a=0;a<3;a+=1){const l=e>>a*8&255;i+=`00${l.toString(16)}`.substr(-2)}return i}function MSe(n,e){let i=0;if(n.length===0)return e[0];for(let a=0;a<n.length;a+=1)i=n.charCodeAt(a)+((i<<5)-i),i=i&i;return i=(i%e.length+e.length)%e.length,e[i]}function USe(n){return n[Math.floor(Math.random()*n.length)]}function An(n,e){return i=>i.colorMode==="dark"?e:n}function sF(n){const{orientation:e,vertical:i,horizontal:a}=n;return e?e==="vertical"?i:a:{}}function YQ(n){return Au(n)&&n.reference?n.reference:String(n)}const p1=(n,...e)=>e.map(YQ).join(` ${n} `).replace(/calc/g,""),pK=(...n)=>`calc(${p1("+",...n)})`,mK=(...n)=>`calc(${p1("-",...n)})`,TU=(...n)=>`calc(${p1("*",...n)})`,gK=(...n)=>`calc(${p1("/",...n)})`,_K=n=>{const e=YQ(n);return e!=null&&!Number.isNaN(parseFloat(e))?String(e).startsWith("-")?String(e).slice(1):`-${e}`:TU(e,-1)},pp=Object.assign(n=>({add:(...e)=>pp(pK(n,...e)),subtract:(...e)=>pp(mK(n,...e)),multiply:(...e)=>pp(TU(n,...e)),divide:(...e)=>pp(gK(n,...e)),negate:()=>pp(_K(n)),toString:()=>n.toString()}),{add:pK,subtract:mK,multiply:TU,divide:gK,negate:_K});function VSe(n){return!Number.isInteger(parseFloat(n.toString()))}function FSe(n,e="-"){return n.replace(/\s+/g,e)}function XQ(n){const e=FSe(n.toString());return e.includes("\\.")?n:VSe(n)?e.replace(".","\\."):n}function jSe(n,e=""){return[e,XQ(n)].filter(Boolean).join("-")}function BSe(n,e){return`var(${XQ(n)}${e?`, ${e}`:""})`}function WSe(n,e=""){return`--${jSe(n,e)}`}function lo(n,e){const i=WSe(n,e==null?void 0:e.prefix);return{variable:i,reference:BSe(i,zSe(e==null?void 0:e.fallback))}}function zSe(n){return n==null?void 0:n.reference}const{definePartsStyle:GR,defineMultiStyleConfig:GSe}=Vi(Uve.keys),kl=Pn("alert-fg"),Pp=Pn("alert-bg"),HSe=GR({container:{bg:Pp.reference,px:"4",py:"3"},title:{fontWeight:"bold",lineHeight:"6",marginEnd:"2"},description:{lineHeight:"6"},icon:{color:kl.reference,flexShrink:0,marginEnd:"3",w:"5",h:"6"},spinner:{color:kl.reference,flexShrink:0,marginEnd:"3",w:"5",h:"5"}});function oF(n){const{theme:e,colorScheme:i}=n,a=r0(`${i}.200`,.16)(e);return{light:`colors.${i}.100`,dark:a}}const $Se=GR(n=>{const{colorScheme:e}=n,i=oF(n);return{container:{[kl.variable]:`colors.${e}.600`,[Pp.variable]:i.light,_dark:{[kl.variable]:`colors.${e}.200`,[Pp.variable]:i.dark}}}}),KSe=GR(n=>{const{colorScheme:e}=n,i=oF(n);return{container:{[kl.variable]:`colors.${e}.600`,[Pp.variable]:i.light,_dark:{[kl.variable]:`colors.${e}.200`,[Pp.variable]:i.dark},paddingStart:"3",borderStartWidth:"4px",borderStartColor:kl.reference}}}),qSe=GR(n=>{const{colorScheme:e}=n,i=oF(n);return{container:{[kl.variable]:`colors.${e}.600`,[Pp.variable]:i.light,_dark:{[kl.variable]:`colors.${e}.200`,[Pp.variable]:i.dark},pt:"2",borderTopWidth:"4px",borderTopColor:kl.reference}}}),YSe=GR(n=>{const{colorScheme:e}=n;return{container:{[kl.variable]:"colors.white",[Pp.variable]:`colors.${e}.600`,_dark:{[kl.variable]:"colors.gray.900",[Pp.variable]:`colors.${e}.200`},color:kl.reference}}}),XSe={subtle:$Se,"left-accent":KSe,"top-accent":qSe,solid:YSe},JSe=GSe({baseStyle:HSe,variants:XSe,defaultProps:{variant:"subtle",colorScheme:"blue"}}),JQ={px:"1px",.5:"0.125rem",1:"0.25rem",1.5:"0.375rem",2:"0.5rem",2.5:"0.625rem",3:"0.75rem",3.5:"0.875rem",4:"1rem",5:"1.25rem",6:"1.5rem",7:"1.75rem",8:"2rem",9:"2.25rem",10:"2.5rem",12:"3rem",14:"3.5rem",16:"4rem",20:"5rem",24:"6rem",28:"7rem",32:"8rem",36:"9rem",40:"10rem",44:"11rem",48:"12rem",52:"13rem",56:"14rem",60:"15rem",64:"16rem",72:"18rem",80:"20rem",96:"24rem"},QSe={max:"max-content",min:"min-content",full:"100%","3xs":"14rem","2xs":"16rem",xs:"20rem",sm:"24rem",md:"28rem",lg:"32rem",xl:"36rem","2xl":"42rem","3xl":"48rem","4xl":"56rem","5xl":"64rem","6xl":"72rem","7xl":"80rem","8xl":"90rem",prose:"60ch"},ZSe={sm:"640px",md:"768px",lg:"1024px",xl:"1280px"},QQ={...JQ,...QSe,container:ZSe},e0e=n=>typeof n=="function";function cc(n,...e){return e0e(n)?n(...e):n}const{definePartsStyle:ZQ,defineMultiStyleConfig:t0e}=Vi(Vve.keys),zS=Pn("avatar-border-color"),Hw=Pn("avatar-bg"),pR=Pn("avatar-font-size"),i0=Pn("avatar-size"),n0e={borderRadius:"full",border:"0.2em solid",borderColor:zS.reference,[zS.variable]:"white",_dark:{[zS.variable]:"colors.gray.800"}},r0e={bg:Hw.reference,fontSize:pR.reference,width:i0.reference,height:i0.reference,lineHeight:"1",[Hw.variable]:"colors.gray.200",_dark:{[Hw.variable]:"colors.whiteAlpha.400"}},i0e=n=>{const{name:e,theme:i}=n,a=e?LSe({string:e}):"colors.gray.400",l=NSe(a)(i);let d="white";return l||(d="gray.800"),{bg:Hw.reference,fontSize:pR.reference,color:d,borderColor:zS.reference,verticalAlign:"top",width:i0.reference,height:i0.reference,"&:not([data-loaded])":{[Hw.variable]:a},[zS.variable]:"colors.white",_dark:{[zS.variable]:"colors.gray.800"}}},s0e={fontSize:pR.reference,lineHeight:"1"},o0e=ZQ(n=>({badge:cc(n0e,n),excessLabel:cc(r0e,n),container:cc(i0e,n),label:s0e}));function qm(n){const e=n!=="100%"?QQ[n]:void 0;return ZQ({container:{[i0.variable]:e??n,[pR.variable]:`calc(${e??n} / 2.5)`},excessLabel:{[i0.variable]:e??n,[pR.variable]:`calc(${e??n} / 2.5)`}})}const a0e={"2xs":qm(4),xs:qm(6),sm:qm(8),md:qm(12),lg:qm(16),xl:qm(24),"2xl":qm(32),full:qm("100%")},c0e=t0e({baseStyle:o0e,sizes:a0e,defaultProps:{size:"md"}}),Vs=Ave("badge",["bg","color","shadow"]),l0e={px:1,textTransform:"uppercase",fontSize:"xs",borderRadius:"sm",fontWeight:"bold",bg:Vs.bg.reference,color:Vs.color.reference,boxShadow:Vs.shadow.reference},u0e=n=>{const{colorScheme:e,theme:i}=n,a=r0(`${e}.500`,.6)(i);return{[Vs.bg.variable]:`colors.${e}.500`,[Vs.color.variable]:"colors.white",_dark:{[Vs.bg.variable]:a,[Vs.color.variable]:"colors.whiteAlpha.800"}}},d0e=n=>{const{colorScheme:e,theme:i}=n,a=r0(`${e}.200`,.16)(i);return{[Vs.bg.variable]:`colors.${e}.100`,[Vs.color.variable]:`colors.${e}.800`,_dark:{[Vs.bg.variable]:a,[Vs.color.variable]:`colors.${e}.200`}}},h0e=n=>{const{colorScheme:e,theme:i}=n,a=r0(`${e}.200`,.8)(i);return{[Vs.color.variable]:`colors.${e}.500`,_dark:{[Vs.color.variable]:a},[Vs.shadow.variable]:`inset 0 0 0px 1px ${Vs.color.reference}`}},f0e={solid:u0e,subtle:d0e,outline:h0e},$w={baseStyle:l0e,variants:f0e,defaultProps:{variant:"subtle",colorScheme:"gray"}},{defineMultiStyleConfig:p0e,definePartsStyle:m0e}=Vi(Fve.keys),QM=Pn("breadcrumb-link-decor"),g0e={transitionProperty:"common",transitionDuration:"fast",transitionTimingFunction:"ease-out",outline:"none",color:"inherit",textDecoration:QM.reference,[QM.variable]:"none","&:not([aria-current=page])":{cursor:"pointer",_hover:{[QM.variable]:"underline"},_focusVisible:{boxShadow:"outline"}}},_0e=m0e({link:g0e}),y0e=p0e({baseStyle:_0e}),E0e={lineHeight:"1.2",borderRadius:"md",fontWeight:"semibold",transitionProperty:"common",transitionDuration:"normal",_focusVisible:{boxShadow:"outline"},_disabled:{opacity:.4,cursor:"not-allowed",boxShadow:"none"},_hover:{_disabled:{bg:"initial"}}},eZ=n=>{const{colorScheme:e,theme:i}=n;if(e==="gray")return{color:An("gray.800","whiteAlpha.900")(n),_hover:{bg:An("gray.100","whiteAlpha.200")(n)},_active:{bg:An("gray.200","whiteAlpha.300")(n)}};const a=r0(`${e}.200`,.12)(i),l=r0(`${e}.200`,.24)(i);return{color:An(`${e}.600`,`${e}.200`)(n),bg:"transparent",_hover:{bg:An(`${e}.50`,a)(n)},_active:{bg:An(`${e}.100`,l)(n)}}},v0e=n=>{const{colorScheme:e}=n,i=An("gray.200","whiteAlpha.300")(n);return{border:"1px solid",borderColor:e==="gray"?i:"currentColor",".chakra-button__group[data-attached][data-orientation=horizontal] > &:not(:last-of-type)":{marginEnd:"-1px"},".chakra-button__group[data-attached][data-orientation=vertical] > &:not(:last-of-type)":{marginBottom:"-1px"},...cc(eZ,n)}},S0e={yellow:{bg:"yellow.400",color:"black",hoverBg:"yellow.500",activeBg:"yellow.600"},cyan:{bg:"cyan.400",color:"black",hoverBg:"cyan.500",activeBg:"cyan.600"}},b0e=n=>{const{colorScheme:e}=n;if(e==="gray"){const y=An("gray.100","whiteAlpha.200")(n);return{bg:y,color:An("gray.800","whiteAlpha.900")(n),_hover:{bg:An("gray.200","whiteAlpha.300")(n),_disabled:{bg:y}},_active:{bg:An("gray.300","whiteAlpha.400")(n)}}}const{bg:i=`${e}.500`,color:a="white",hoverBg:l=`${e}.600`,activeBg:d=`${e}.700`}=S0e[e]??{},p=An(i,`${e}.200`)(n);return{bg:p,color:An(a,"gray.800")(n),_hover:{bg:An(l,`${e}.300`)(n),_disabled:{bg:p}},_active:{bg:An(d,`${e}.400`)(n)}}},T0e=n=>{const{colorScheme:e}=n;return{padding:0,height:"auto",lineHeight:"normal",verticalAlign:"baseline",color:An(`${e}.500`,`${e}.200`)(n),_hover:{textDecoration:"underline",_disabled:{textDecoration:"none"}},_active:{color:An(`${e}.700`,`${e}.500`)(n)}}},w0e={bg:"none",color:"inherit",display:"inline",lineHeight:"inherit",m:"0",p:"0"},R0e={ghost:eZ,outline:v0e,solid:b0e,link:T0e,unstyled:w0e},C0e={lg:{h:"12",minW:"12",fontSize:"lg",px:"6"},md:{h:"10",minW:"10",fontSize:"md",px:"4"},sm:{h:"8",minW:"8",fontSize:"sm",px:"3"},xs:{h:"6",minW:"6",fontSize:"xs",px:"2"}},I0e={baseStyle:E0e,variants:R0e,sizes:C0e,defaultProps:{variant:"solid",size:"md",colorScheme:"gray"}},{definePartsStyle:vy,defineMultiStyleConfig:A0e}=Vi(oSe.keys),bk=Pn("card-bg"),Tp=Pn("card-padding"),tZ=Pn("card-shadow"),BO=Pn("card-radius"),nZ=Pn("card-border-width","0"),rZ=Pn("card-border-color"),P0e=vy({container:{[bk.variable]:"colors.chakra-body-bg",backgroundColor:bk.reference,boxShadow:tZ.reference,borderRadius:BO.reference,color:"chakra-body-text",borderWidth:nZ.reference,borderColor:rZ.reference},body:{padding:Tp.reference,flex:"1 1 0%"},header:{padding:Tp.reference},footer:{padding:Tp.reference}}),O0e={sm:vy({container:{[BO.variable]:"radii.base",[Tp.variable]:"space.3"}}),md:vy({container:{[BO.variable]:"radii.md",[Tp.variable]:"space.5"}}),lg:vy({container:{[BO.variable]:"radii.xl",[Tp.variable]:"space.7"}})},k0e={elevated:vy({container:{[tZ.variable]:"shadows.base",_dark:{[bk.variable]:"colors.gray.700"}}}),outline:vy({container:{[nZ.variable]:"1px",[rZ.variable]:"colors.chakra-border-color"}}),filled:vy({container:{[bk.variable]:"colors.chakra-subtle-bg"}}),unstyled:{body:{[Tp.variable]:0},header:{[Tp.variable]:0},footer:{[Tp.variable]:0}}},N0e=A0e({baseStyle:P0e,variants:k0e,sizes:O0e,defaultProps:{variant:"elevated",size:"md"}}),{definePartsStyle:WO,defineMultiStyleConfig:D0e}=Vi(jve.keys),Kw=Pn("checkbox-size"),L0e=n=>{const{colorScheme:e}=n;return{w:Kw.reference,h:Kw.reference,transitionProperty:"box-shadow",transitionDuration:"normal",border:"2px solid",borderRadius:"sm",borderColor:"inherit",color:"white",_checked:{bg:An(`${e}.500`,`${e}.200`)(n),borderColor:An(`${e}.500`,`${e}.200`)(n),color:An("white","gray.900")(n),_hover:{bg:An(`${e}.600`,`${e}.300`)(n),borderColor:An(`${e}.600`,`${e}.300`)(n)},_disabled:{borderColor:An("gray.200","transparent")(n),bg:An("gray.200","whiteAlpha.300")(n),color:An("gray.500","whiteAlpha.500")(n)}},_indeterminate:{bg:An(`${e}.500`,`${e}.200`)(n),borderColor:An(`${e}.500`,`${e}.200`)(n),color:An("white","gray.900")(n)},_disabled:{bg:An("gray.100","whiteAlpha.100")(n),borderColor:An("gray.100","transparent")(n)},_focusVisible:{boxShadow:"outline"},_invalid:{borderColor:An("red.500","red.300")(n)}}},x0e={_disabled:{cursor:"not-allowed"}},M0e={userSelect:"none",_disabled:{opacity:.4}},U0e={transitionProperty:"transform",transitionDuration:"normal"},V0e=WO(n=>({icon:U0e,container:x0e,control:cc(L0e,n),label:M0e})),F0e={sm:WO({control:{[Kw.variable]:"sizes.3"},label:{fontSize:"sm"},icon:{fontSize:"3xs"}}),md:WO({control:{[Kw.variable]:"sizes.4"},label:{fontSize:"md"},icon:{fontSize:"2xs"}}),lg:WO({control:{[Kw.variable]:"sizes.5"},label:{fontSize:"lg"},icon:{fontSize:"2xs"}})},eg=D0e({baseStyle:V0e,sizes:F0e,defaultProps:{size:"md",colorScheme:"blue"}}),qw=lo("close-button-size"),sw=lo("close-button-bg"),j0e={w:[qw.reference],h:[qw.reference],borderRadius:"md",transitionProperty:"common",transitionDuration:"normal",_disabled:{opacity:.4,cursor:"not-allowed",boxShadow:"none"},_hover:{[sw.variable]:"colors.blackAlpha.100",_dark:{[sw.variable]:"colors.whiteAlpha.100"}},_active:{[sw.variable]:"colors.blackAlpha.200",_dark:{[sw.variable]:"colors.whiteAlpha.200"}},_focusVisible:{boxShadow:"outline"},bg:sw.reference},B0e={lg:{[qw.variable]:"sizes.10",fontSize:"md"},md:{[qw.variable]:"sizes.8",fontSize:"xs"},sm:{[qw.variable]:"sizes.6",fontSize:"2xs"}},W0e={baseStyle:j0e,sizes:B0e,defaultProps:{size:"md"}},{variants:z0e,defaultProps:G0e}=$w,H0e={fontFamily:"mono",fontSize:"sm",px:"0.2em",borderRadius:"sm",bg:Vs.bg.reference,color:Vs.color.reference,boxShadow:Vs.shadow.reference},$0e={baseStyle:H0e,variants:z0e,defaultProps:G0e},K0e={w:"100%",mx:"auto",maxW:"prose",px:"4"},q0e={baseStyle:K0e},Y0e={opacity:.6,borderColor:"inherit"},X0e={borderStyle:"solid"},J0e={borderStyle:"dashed"},Q0e={solid:X0e,dashed:J0e},Z0e={baseStyle:Y0e,variants:Q0e,defaultProps:{variant:"solid"}},{definePartsStyle:wU,defineMultiStyleConfig:ebe}=Vi(Bve.keys),ZM=Pn("drawer-bg"),e2=Pn("drawer-box-shadow");function fS(n){return wU(n==="full"?{dialog:{maxW:"100vw",h:"100vh"}}:{dialog:{maxW:n}})}const tbe={bg:"blackAlpha.600",zIndex:"modal"},nbe={display:"flex",zIndex:"modal",justifyContent:"center"},rbe=n=>{const{isFullHeight:e}=n;return{...e&&{height:"100vh"},zIndex:"modal",maxH:"100vh",color:"inherit",[ZM.variable]:"colors.white",[e2.variable]:"shadows.lg",_dark:{[ZM.variable]:"colors.gray.700",[e2.variable]:"shadows.dark-lg"},bg:ZM.reference,boxShadow:e2.reference}},ibe={px:"6",py:"4",fontSize:"xl",fontWeight:"semibold"},sbe={position:"absolute",top:"2",insetEnd:"3"},obe={px:"6",py:"2",flex:"1",overflow:"auto"},abe={px:"6",py:"4"},cbe=wU(n=>({overlay:tbe,dialogContainer:nbe,dialog:cc(rbe,n),header:ibe,closeButton:sbe,body:obe,footer:abe})),lbe={xs:fS("xs"),sm:fS("md"),md:fS("lg"),lg:fS("2xl"),xl:fS("4xl"),full:fS("full")},ube=ebe({baseStyle:cbe,sizes:lbe,defaultProps:{size:"xs"}}),{definePartsStyle:dbe,defineMultiStyleConfig:hbe}=Vi(Wve.keys),fbe={borderRadius:"md",py:"1",transitionProperty:"common",transitionDuration:"normal"},pbe={borderRadius:"md",py:"1",transitionProperty:"common",transitionDuration:"normal",width:"full",_focusVisible:{boxShadow:"outline"},_placeholder:{opacity:.6}},mbe={borderRadius:"md",py:"1",transitionProperty:"common",transitionDuration:"normal",width:"full",_focusVisible:{boxShadow:"outline"},_placeholder:{opacity:.6}},gbe=dbe({preview:fbe,input:pbe,textarea:mbe}),_be=hbe({baseStyle:gbe}),{definePartsStyle:ybe,defineMultiStyleConfig:Ebe}=Vi(zve.keys),GS=Pn("form-control-color"),vbe={marginStart:"1",[GS.variable]:"colors.red.500",_dark:{[GS.variable]:"colors.red.300"},color:GS.reference},Sbe={mt:"2",[GS.variable]:"colors.gray.600",_dark:{[GS.variable]:"colors.whiteAlpha.600"},color:GS.reference,lineHeight:"normal",fontSize:"sm"},bbe=ybe({container:{width:"100%",position:"relative"},requiredIndicator:vbe,helperText:Sbe}),Tbe=Ebe({baseStyle:bbe}),{definePartsStyle:wbe,defineMultiStyleConfig:Rbe}=Vi(Gve.keys),HS=Pn("form-error-color"),Cbe={[HS.variable]:"colors.red.500",_dark:{[HS.variable]:"colors.red.300"},color:HS.reference,mt:"2",fontSize:"sm",lineHeight:"normal"},Ibe={marginEnd:"0.5em",[HS.variable]:"colors.red.500",_dark:{[HS.variable]:"colors.red.300"},color:HS.reference},Abe=wbe({text:Cbe,icon:Ibe}),Pbe=Rbe({baseStyle:Abe}),Obe={fontSize:"md",marginEnd:"3",mb:"2",fontWeight:"medium",transitionProperty:"common",transitionDuration:"normal",opacity:1,_disabled:{opacity:.4}},kbe={baseStyle:Obe},Nbe={fontFamily:"heading",fontWeight:"bold"},Dbe={"4xl":{fontSize:["6xl",null,"7xl"],lineHeight:1},"3xl":{fontSize:["5xl",null,"6xl"],lineHeight:1},"2xl":{fontSize:["4xl",null,"5xl"],lineHeight:[1.2,null,1]},xl:{fontSize:["3xl",null,"4xl"],lineHeight:[1.33,null,1.2]},lg:{fontSize:["2xl",null,"3xl"],lineHeight:[1.33,null,1.2]},md:{fontSize:"xl",lineHeight:1.2},sm:{fontSize:"md",lineHeight:1.2},xs:{fontSize:"sm",lineHeight:1.2}},Lbe={baseStyle:Nbe,sizes:Dbe,defaultProps:{size:"xl"}},{definePartsStyle:gp,defineMultiStyleConfig:xbe}=Vi(Hve.keys),IS=Pn("input-height"),AS=Pn("input-font-size"),PS=Pn("input-padding"),OS=Pn("input-border-radius"),Mbe=gp({addon:{height:IS.reference,fontSize:AS.reference,px:PS.reference,borderRadius:OS.reference},field:{width:"100%",height:IS.reference,fontSize:AS.reference,px:PS.reference,borderRadius:OS.reference,minWidth:0,outline:0,position:"relative",appearance:"none",transitionProperty:"common",transitionDuration:"normal",_disabled:{opacity:.4,cursor:"not-allowed"}}}),Ym={lg:{[AS.variable]:"fontSizes.lg",[PS.variable]:"space.4",[OS.variable]:"radii.md",[IS.variable]:"sizes.12"},md:{[AS.variable]:"fontSizes.md",[PS.variable]:"space.4",[OS.variable]:"radii.md",[IS.variable]:"sizes.10"},sm:{[AS.variable]:"fontSizes.sm",[PS.variable]:"space.3",[OS.variable]:"radii.sm",[IS.variable]:"sizes.8"},xs:{[AS.variable]:"fontSizes.xs",[PS.variable]:"space.2",[OS.variable]:"radii.sm",[IS.variable]:"sizes.6"}},Ube={lg:gp({field:Ym.lg,group:Ym.lg}),md:gp({field:Ym.md,group:Ym.md}),sm:gp({field:Ym.sm,group:Ym.sm}),xs:gp({field:Ym.xs,group:Ym.xs})};function aF(n){const{focusBorderColor:e,errorBorderColor:i}=n;return{focusBorderColor:e||An("blue.500","blue.300")(n),errorBorderColor:i||An("red.500","red.300")(n)}}const Vbe=gp(n=>{const{theme:e}=n,{focusBorderColor:i,errorBorderColor:a}=aF(n);return{field:{border:"1px solid",borderColor:"inherit",bg:"inherit",_hover:{borderColor:An("gray.300","whiteAlpha.400")(n)},_readOnly:{boxShadow:"none !important",userSelect:"all"},_invalid:{borderColor:ac(e,a),boxShadow:`0 0 0 1px ${ac(e,a)}`},_focusVisible:{zIndex:1,borderColor:ac(e,i),boxShadow:`0 0 0 1px ${ac(e,i)}`}},addon:{border:"1px solid",borderColor:An("inherit","whiteAlpha.50")(n),bg:An("gray.100","whiteAlpha.300")(n)}}}),Fbe=gp(n=>{const{theme:e}=n,{focusBorderColor:i,errorBorderColor:a}=aF(n);return{field:{border:"2px solid",borderColor:"transparent",bg:An("gray.100","whiteAlpha.50")(n),_hover:{bg:An("gray.200","whiteAlpha.100")(n)},_readOnly:{boxShadow:"none !important",userSelect:"all"},_invalid:{borderColor:ac(e,a)},_focusVisible:{bg:"transparent",borderColor:ac(e,i)}},addon:{border:"2px solid",borderColor:"transparent",bg:An("gray.100","whiteAlpha.50")(n)}}}),jbe=gp(n=>{const{theme:e}=n,{focusBorderColor:i,errorBorderColor:a}=aF(n);return{field:{borderBottom:"1px solid",borderColor:"inherit",borderRadius:"0",px:"0",bg:"transparent",_readOnly:{boxShadow:"none !important",userSelect:"all"},_invalid:{borderColor:ac(e,a),boxShadow:`0px 1px 0px 0px ${ac(e,a)}`},_focusVisible:{borderColor:ac(e,i),boxShadow:`0px 1px 0px 0px ${ac(e,i)}`}},addon:{borderBottom:"2px solid",borderColor:"inherit",borderRadius:"0",px:"0",bg:"transparent"}}}),Bbe=gp({field:{bg:"transparent",px:"0",height:"auto"},addon:{bg:"transparent",px:"0",height:"auto"}}),Wbe={outline:Vbe,filled:Fbe,flushed:jbe,unstyled:Bbe},Xr=xbe({baseStyle:Mbe,sizes:Ube,variants:Wbe,defaultProps:{size:"md",variant:"outline"}}),t2=Pn("kbd-bg"),zbe={[t2.variable]:"colors.gray.100",_dark:{[t2.variable]:"colors.whiteAlpha.100"},bg:t2.reference,borderRadius:"md",borderWidth:"1px",borderBottomWidth:"3px",fontSize:"0.8em",fontWeight:"bold",lineHeight:"normal",px:"0.4em",whiteSpace:"nowrap"},Gbe={baseStyle:zbe},Hbe={transitionProperty:"common",transitionDuration:"fast",transitionTimingFunction:"ease-out",cursor:"pointer",textDecoration:"none",outline:"none",color:"inherit",_hover:{textDecoration:"underline"},_focusVisible:{boxShadow:"outline"}},$be={baseStyle:Hbe},{defineMultiStyleConfig:Kbe,definePartsStyle:qbe}=Vi($ve.keys),Ybe={marginEnd:"2",display:"inline",verticalAlign:"text-bottom"},Xbe=qbe({icon:Ybe}),Jbe=Kbe({baseStyle:Xbe}),{defineMultiStyleConfig:Qbe,definePartsStyle:Zbe}=Vi(Kve.keys),xh=Pn("menu-bg"),n2=Pn("menu-shadow"),eTe={[xh.variable]:"#fff",[n2.variable]:"shadows.sm",_dark:{[xh.variable]:"colors.gray.700",[n2.variable]:"shadows.dark-lg"},color:"inherit",minW:"3xs",py:"2",zIndex:"dropdown",borderRadius:"md",borderWidth:"1px",bg:xh.reference,boxShadow:n2.reference},tTe={py:"1.5",px:"3",transitionProperty:"background",transitionDuration:"ultra-fast",transitionTimingFunction:"ease-in",_focus:{[xh.variable]:"colors.gray.100",_dark:{[xh.variable]:"colors.whiteAlpha.100"}},_active:{[xh.variable]:"colors.gray.200",_dark:{[xh.variable]:"colors.whiteAlpha.200"}},_expanded:{[xh.variable]:"colors.gray.100",_dark:{[xh.variable]:"colors.whiteAlpha.100"}},_disabled:{opacity:.4,cursor:"not-allowed"},bg:xh.reference},nTe={mx:4,my:2,fontWeight:"semibold",fontSize:"sm"},rTe={display:"inline-flex",alignItems:"center",justifyContent:"center",flexShrink:0},iTe={opacity:.6},sTe={border:0,borderBottom:"1px solid",borderColor:"inherit",my:"2",opacity:.6},oTe={transitionProperty:"common",transitionDuration:"normal"},aTe=Zbe({button:oTe,list:eTe,item:tTe,groupTitle:nTe,icon:rTe,command:iTe,divider:sTe}),cTe=Qbe({baseStyle:aTe}),{defineMultiStyleConfig:lTe,definePartsStyle:RU}=Vi(qve.keys),r2=Pn("modal-bg"),i2=Pn("modal-shadow"),uTe={bg:"blackAlpha.600",zIndex:"modal"},dTe=n=>{const{isCentered:e,scrollBehavior:i}=n;return{display:"flex",zIndex:"modal",justifyContent:"center",alignItems:e?"center":"flex-start",overflow:i==="inside"?"hidden":"auto",overscrollBehaviorY:"none"}},hTe=n=>{const{isCentered:e,scrollBehavior:i}=n;return{borderRadius:"md",color:"inherit",my:e?"auto":"16",mx:e?"auto":void 0,zIndex:"modal",maxH:i==="inside"?"calc(100% - 7.5rem)":void 0,[r2.variable]:"colors.white",[i2.variable]:"shadows.lg",_dark:{[r2.variable]:"colors.gray.700",[i2.variable]:"shadows.dark-lg"},bg:r2.reference,boxShadow:i2.reference}},fTe={px:"6",py:"4",fontSize:"xl",fontWeight:"semibold"},pTe={position:"absolute",top:"2",insetEnd:"3"},mTe=n=>{const{scrollBehavior:e}=n;return{px:"6",py:"2",flex:"1",overflow:e==="inside"?"auto":void 0}},gTe={px:"6",py:"4"},_Te=RU(n=>({overlay:uTe,dialogContainer:cc(dTe,n),dialog:cc(hTe,n),header:fTe,closeButton:pTe,body:cc(mTe,n),footer:gTe}));function Rd(n){return RU(n==="full"?{dialog:{maxW:"100vw",minH:"$100vh",my:"0",borderRadius:"0"}}:{dialog:{maxW:n}})}const yTe={xs:Rd("xs"),sm:Rd("sm"),md:Rd("md"),lg:Rd("lg"),xl:Rd("xl"),"2xl":Rd("2xl"),"3xl":Rd("3xl"),"4xl":Rd("4xl"),"5xl":Rd("5xl"),"6xl":Rd("6xl"),full:Rd("full")},ETe=lTe({baseStyle:_Te,sizes:yTe,defaultProps:{size:"md"}}),iZ={letterSpacings:{tighter:"-0.05em",tight:"-0.025em",normal:"0",wide:"0.025em",wider:"0.05em",widest:"0.1em"},lineHeights:{normal:"normal",none:1,shorter:1.25,short:1.375,base:1.5,tall:1.625,taller:"2",3:".75rem",4:"1rem",5:"1.25rem",6:"1.5rem",7:"1.75rem",8:"2rem",9:"2.25rem",10:"2.5rem"},fontWeights:{hairline:100,thin:200,light:300,normal:400,medium:500,semibold:600,bold:700,extrabold:800,black:900},fonts:{heading:'-apple-system, BlinkMacSystemFont, "Segoe UI", Helvetica, Arial, sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol"',body:'-apple-system, BlinkMacSystemFont, "Segoe UI", Helvetica, Arial, sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol"',mono:'SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono","Courier New",monospace'},fontSizes:{"3xs":"0.45rem","2xs":"0.625rem",xs:"0.75rem",sm:"0.875rem",md:"1rem",lg:"1.125rem",xl:"1.25rem","2xl":"1.5rem","3xl":"1.875rem","4xl":"2.25rem","5xl":"3rem","6xl":"3.75rem","7xl":"4.5rem","8xl":"6rem","9xl":"8rem"}},{defineMultiStyleConfig:vTe,definePartsStyle:sZ}=Vi(Yve.keys),cF=lo("number-input-stepper-width"),oZ=lo("number-input-input-padding"),STe=pp(cF).add("0.5rem").toString(),s2=lo("number-input-bg"),o2=lo("number-input-color"),a2=lo("number-input-border-color"),bTe={[cF.variable]:"sizes.6",[oZ.variable]:STe},TTe=n=>{var e;return((e=cc(Xr.baseStyle,n))==null?void 0:e.field)??{}},wTe={width:cF.reference},RTe={borderStart:"1px solid",borderStartColor:a2.reference,color:o2.reference,bg:s2.reference,[o2.variable]:"colors.chakra-body-text",[a2.variable]:"colors.chakra-border-color",_dark:{[o2.variable]:"colors.whiteAlpha.800",[a2.variable]:"colors.whiteAlpha.300"},_active:{[s2.variable]:"colors.gray.200",_dark:{[s2.variable]:"colors.whiteAlpha.300"}},_disabled:{opacity:.4,cursor:"not-allowed"}},CTe=sZ(n=>({root:bTe,field:cc(TTe,n)??{},stepperGroup:wTe,stepper:RTe}));function cO(n){var d,p;const e=(d=Xr.sizes)==null?void 0:d[n],i={lg:"md",md:"md",sm:"sm",xs:"sm"},a=((p=e.field)==null?void 0:p.fontSize)??"md",l=iZ.fontSizes[a];return sZ({field:{...e.field,paddingInlineEnd:oZ.reference,verticalAlign:"top"},stepper:{fontSize:pp(l).multiply(.75).toString(),_first:{borderTopEndRadius:i[n]},_last:{borderBottomEndRadius:i[n],mt:"-1px",borderTopWidth:1}}})}const ITe={xs:cO("xs"),sm:cO("sm"),md:cO("md"),lg:cO("lg")},ATe=vTe({baseStyle:CTe,sizes:ITe,variants:Xr.variants,defaultProps:Xr.defaultProps});var iQ;const PTe={...(iQ=Xr.baseStyle)==null?void 0:iQ.field,textAlign:"center"},OTe={lg:{fontSize:"lg",w:12,h:12,borderRadius:"md"},md:{fontSize:"md",w:10,h:10,borderRadius:"md"},sm:{fontSize:"sm",w:8,h:8,borderRadius:"sm"},xs:{fontSize:"xs",w:6,h:6,borderRadius:"sm"}};var sQ;const kTe={outline:n=>{var e,i;return((i=cc((e=Xr.variants)==null?void 0:e.outline,n))==null?void 0:i.field)??{}},flushed:n=>{var e,i;return((i=cc((e=Xr.variants)==null?void 0:e.flushed,n))==null?void 0:i.field)??{}},filled:n=>{var e,i;return((i=cc((e=Xr.variants)==null?void 0:e.filled,n))==null?void 0:i.field)??{}},unstyled:((sQ=Xr.variants)==null?void 0:sQ.unstyled.field)??{}},NTe={baseStyle:PTe,sizes:OTe,variants:kTe,defaultProps:Xr.defaultProps},{defineMultiStyleConfig:DTe,definePartsStyle:LTe}=Vi(Xve.keys),lO=lo("popper-bg"),xTe=lo("popper-arrow-bg"),yK=lo("popper-arrow-shadow-color"),MTe={zIndex:"popover"},UTe={[lO.variable]:"colors.white",bg:lO.reference,[xTe.variable]:lO.reference,[yK.variable]:"colors.gray.200",_dark:{[lO.variable]:"colors.gray.700",[yK.variable]:"colors.whiteAlpha.300"},width:"xs",border:"1px solid",borderColor:"inherit",borderRadius:"md",boxShadow:"sm",zIndex:"inherit",_focusVisible:{outline:0,boxShadow:"outline"}},VTe={px:3,py:2,borderBottomWidth:"1px"},FTe={px:3,py:2},jTe={px:3,py:2,borderTopWidth:"1px"},BTe={position:"absolute",borderRadius:"md",top:1,insetEnd:2,padding:2},WTe=LTe({popper:MTe,content:UTe,header:VTe,body:FTe,footer:jTe,closeButton:BTe}),zTe=DTe({baseStyle:WTe}),{defineMultiStyleConfig:GTe,definePartsStyle:Pw}=Vi(Jve.keys),HTe=n=>{const{colorScheme:e,theme:i,isIndeterminate:a,hasStripe:l}=n,d=An(fK(),fK("1rem","rgba(0,0,0,0.1)"))(n),p=An(`${e}.500`,`${e}.200`)(n),y=`linear-gradient(
    to right,
    transparent 0%,
    ${ac(i,p)} 50%,
    transparent 100%
  )`;return{...!a&&l&&d,...a?{bgImage:y}:{bgColor:p}}},$Te={lineHeight:"1",fontSize:"0.25em",fontWeight:"bold",color:"white"},KTe=n=>({bg:An("gray.100","whiteAlpha.300")(n)}),qTe=n=>({transitionProperty:"common",transitionDuration:"slow",...HTe(n)}),YTe=Pw(n=>({label:$Te,filledTrack:qTe(n),track:KTe(n)})),XTe={xs:Pw({track:{h:"1"}}),sm:Pw({track:{h:"2"}}),md:Pw({track:{h:"3"}}),lg:Pw({track:{h:"4"}})},JTe=GTe({sizes:XTe,baseStyle:YTe,defaultProps:{size:"md",colorScheme:"blue"}}),{defineMultiStyleConfig:QTe,definePartsStyle:zO}=Vi(Qve.keys),ZTe=n=>{var i;const e=(i=cc(eg.baseStyle,n))==null?void 0:i.control;return{...e,borderRadius:"full",_checked:{...e==null?void 0:e._checked,_before:{content:'""',display:"inline-block",pos:"relative",w:"50%",h:"50%",borderRadius:"50%",bg:"currentColor"}}}},ewe=zO(n=>{var e,i;return{label:(e=eg.baseStyle)==null?void 0:e.call(eg,n).label,container:(i=eg.baseStyle)==null?void 0:i.call(eg,n).container,control:ZTe(n)}}),twe={md:zO({control:{w:"4",h:"4"},label:{fontSize:"md"}}),lg:zO({control:{w:"5",h:"5"},label:{fontSize:"lg"}}),sm:zO({control:{width:"3",height:"3"},label:{fontSize:"sm"}})},nwe=QTe({baseStyle:ewe,sizes:twe,defaultProps:{size:"md",colorScheme:"blue"}}),{defineMultiStyleConfig:rwe,definePartsStyle:iwe}=Vi(Zve.keys),uO=Pn("select-bg");var oQ;const swe={...(oQ=Xr.baseStyle)==null?void 0:oQ.field,appearance:"none",paddingBottom:"1px",lineHeight:"normal",bg:uO.reference,[uO.variable]:"colors.white",_dark:{[uO.variable]:"colors.gray.700"},"> option, > optgroup":{bg:uO.reference}},owe={width:"6",height:"100%",insetEnd:"2",position:"relative",color:"currentColor",fontSize:"xl",_disabled:{opacity:.5}},awe=iwe({field:swe,icon:owe}),dO={paddingInlineEnd:"8"};var aQ,cQ,lQ,uQ,dQ,hQ,fQ,pQ;const cwe={lg:{...(aQ=Xr.sizes)==null?void 0:aQ.lg,field:{...(cQ=Xr.sizes)==null?void 0:cQ.lg.field,...dO}},md:{...(lQ=Xr.sizes)==null?void 0:lQ.md,field:{...(uQ=Xr.sizes)==null?void 0:uQ.md.field,...dO}},sm:{...(dQ=Xr.sizes)==null?void 0:dQ.sm,field:{...(hQ=Xr.sizes)==null?void 0:hQ.sm.field,...dO}},xs:{...(fQ=Xr.sizes)==null?void 0:fQ.xs,field:{...(pQ=Xr.sizes)==null?void 0:pQ.xs.field,...dO},icon:{insetEnd:"1"}}},lwe=rwe({baseStyle:awe,sizes:cwe,variants:Xr.variants,defaultProps:Xr.defaultProps}),c2=Pn("skeleton-start-color"),l2=Pn("skeleton-end-color"),uwe={[c2.variable]:"colors.gray.100",[l2.variable]:"colors.gray.400",_dark:{[c2.variable]:"colors.gray.800",[l2.variable]:"colors.gray.600"},background:c2.reference,borderColor:l2.reference,opacity:.7,borderRadius:"sm"},dwe={baseStyle:uwe},u2=Pn("skip-link-bg"),hwe={borderRadius:"md",fontWeight:"semibold",_focusVisible:{boxShadow:"outline",padding:"4",position:"fixed",top:"6",insetStart:"6",[u2.variable]:"colors.white",_dark:{[u2.variable]:"colors.gray.700"},bg:u2.reference}},fwe={baseStyle:hwe},{defineMultiStyleConfig:pwe,definePartsStyle:m1}=Vi(eSe.keys),Py=Pn("slider-thumb-size"),mR=Pn("slider-track-size"),tg=Pn("slider-bg"),mwe=n=>{const{orientation:e}=n;return{display:"inline-block",position:"relative",cursor:"pointer",_disabled:{opacity:.6,cursor:"default",pointerEvents:"none"},...sF({orientation:e,vertical:{h:"100%",px:fp(Py.reference).divide(2).toString()},horizontal:{w:"100%",py:fp(Py.reference).divide(2).toString()}})}},gwe=n=>({...sF({orientation:n.orientation,horizontal:{h:mR.reference},vertical:{w:mR.reference}}),overflow:"hidden",borderRadius:"sm",[tg.variable]:"colors.gray.200",_dark:{[tg.variable]:"colors.whiteAlpha.200"},_disabled:{[tg.variable]:"colors.gray.300",_dark:{[tg.variable]:"colors.whiteAlpha.300"}},bg:tg.reference}),_we=n=>{const{orientation:e}=n;return{...sF({orientation:e,vertical:{left:"50%",transform:"translateX(-50%)",_active:{transform:"translateX(-50%) scale(1.15)"}},horizontal:{top:"50%",transform:"translateY(-50%)",_active:{transform:"translateY(-50%) scale(1.15)"}}}),w:Py.reference,h:Py.reference,display:"flex",alignItems:"center",justifyContent:"center",position:"absolute",outline:0,zIndex:1,borderRadius:"full",bg:"white",boxShadow:"base",border:"1px solid",borderColor:"transparent",transitionProperty:"transform",transitionDuration:"normal",_focusVisible:{boxShadow:"outline"},_disabled:{bg:"gray.300"}}},ywe=n=>{const{colorScheme:e}=n;return{width:"inherit",height:"inherit",[tg.variable]:`colors.${e}.500`,_dark:{[tg.variable]:`colors.${e}.200`},bg:tg.reference}},Ewe=m1(n=>({container:mwe(n),track:gwe(n),thumb:_we(n),filledTrack:ywe(n)})),vwe=m1({container:{[Py.variable]:"sizes.4",[mR.variable]:"sizes.1"}}),Swe=m1({container:{[Py.variable]:"sizes.3.5",[mR.variable]:"sizes.1"}}),bwe=m1({container:{[Py.variable]:"sizes.2.5",[mR.variable]:"sizes.0.5"}}),Twe={lg:vwe,md:Swe,sm:bwe},wwe=pwe({baseStyle:Ewe,sizes:Twe,defaultProps:{size:"md",colorScheme:"blue"}}),fy=lo("spinner-size"),Rwe={width:[fy.reference],height:[fy.reference]},Cwe={xs:{[fy.variable]:"sizes.3"},sm:{[fy.variable]:"sizes.4"},md:{[fy.variable]:"sizes.6"},lg:{[fy.variable]:"sizes.8"},xl:{[fy.variable]:"sizes.12"}},Iwe={baseStyle:Rwe,sizes:Cwe,defaultProps:{size:"md"}},{defineMultiStyleConfig:Awe,definePartsStyle:aZ}=Vi(tSe.keys),Pwe={fontWeight:"medium"},Owe={opacity:.8,marginBottom:"2"},kwe={verticalAlign:"baseline",fontWeight:"semibold"},Nwe={marginEnd:1,w:"3.5",h:"3.5",verticalAlign:"middle"},Dwe=aZ({container:{},label:Pwe,helpText:Owe,number:kwe,icon:Nwe}),Lwe={md:aZ({label:{fontSize:"sm"},helpText:{fontSize:"sm"},number:{fontSize:"2xl"}})},xwe=Awe({baseStyle:Dwe,sizes:Lwe,defaultProps:{size:"md"}}),{defineMultiStyleConfig:Mwe,definePartsStyle:Ow}=Vi(["stepper","step","title","description","indicator","separator","icon","number"]),mp=Pn("stepper-indicator-size"),kS=Pn("stepper-icon-size"),NS=Pn("stepper-title-font-size"),kw=Pn("stepper-description-font-size"),ow=Pn("stepper-accent-color"),Uwe=Ow(({colorScheme:n})=>({stepper:{display:"flex",justifyContent:"space-between",gap:"4","&[data-orientation=vertical]":{flexDirection:"column",alignItems:"flex-start"},"&[data-orientation=horizontal]":{flexDirection:"row",alignItems:"center"},[ow.variable]:`colors.${n}.500`,_dark:{[ow.variable]:`colors.${n}.200`}},title:{fontSize:NS.reference,fontWeight:"medium"},description:{fontSize:kw.reference,color:"chakra-subtle-text"},number:{fontSize:NS.reference},step:{flexShrink:0,position:"relative",display:"flex",gap:"2","&[data-orientation=horizontal]":{alignItems:"center"},flex:"1","&:last-of-type:not([data-stretch])":{flex:"initial"}},icon:{flexShrink:0,width:kS.reference,height:kS.reference},indicator:{flexShrink:0,borderRadius:"full",width:mp.reference,height:mp.reference,display:"flex",justifyContent:"center",alignItems:"center","&[data-status=active]":{borderWidth:"2px",borderColor:ow.reference},"&[data-status=complete]":{bg:ow.reference,color:"chakra-inverse-text"},"&[data-status=incomplete]":{borderWidth:"2px"}},separator:{bg:"chakra-border-color",flex:"1","&[data-status=complete]":{bg:ow.reference},"&[data-orientation=horizontal]":{width:"100%",height:"2px",marginStart:"2"},"&[data-orientation=vertical]":{width:"2px",position:"absolute",height:"100%",maxHeight:`calc(100% - ${mp.reference} - 8px)`,top:`calc(${mp.reference} + 4px)`,insetStart:`calc(${mp.reference} / 2 - 1px)`}}})),Vwe=Mwe({baseStyle:Uwe,sizes:{xs:Ow({stepper:{[mp.variable]:"sizes.4",[kS.variable]:"sizes.3",[NS.variable]:"fontSizes.xs",[kw.variable]:"fontSizes.xs"}}),sm:Ow({stepper:{[mp.variable]:"sizes.6",[kS.variable]:"sizes.4",[NS.variable]:"fontSizes.sm",[kw.variable]:"fontSizes.xs"}}),md:Ow({stepper:{[mp.variable]:"sizes.8",[kS.variable]:"sizes.5",[NS.variable]:"fontSizes.md",[kw.variable]:"fontSizes.sm"}}),lg:Ow({stepper:{[mp.variable]:"sizes.10",[kS.variable]:"sizes.6",[NS.variable]:"fontSizes.lg",[kw.variable]:"fontSizes.md"}})},defaultProps:{size:"md",colorScheme:"blue"}}),{defineMultiStyleConfig:Fwe,definePartsStyle:GO}=Vi(nSe.keys),Yw=lo("switch-track-width"),Sy=lo("switch-track-height"),d2=lo("switch-track-diff"),jwe=pp.subtract(Yw,Sy),CU=lo("switch-thumb-x"),aw=lo("switch-bg"),Bwe=n=>{const{colorScheme:e}=n;return{borderRadius:"full",p:"0.5",width:[Yw.reference],height:[Sy.reference],transitionProperty:"common",transitionDuration:"fast",[aw.variable]:"colors.gray.300",_dark:{[aw.variable]:"colors.whiteAlpha.400"},_focusVisible:{boxShadow:"outline"},_disabled:{opacity:.4,cursor:"not-allowed"},_checked:{[aw.variable]:`colors.${e}.500`,_dark:{[aw.variable]:`colors.${e}.200`}},bg:aw.reference}},Wwe={bg:"white",transitionProperty:"transform",transitionDuration:"normal",borderRadius:"inherit",width:[Sy.reference],height:[Sy.reference],_checked:{transform:`translateX(${CU.reference})`}},zwe=GO(n=>({container:{[d2.variable]:jwe,[CU.variable]:d2.reference,_rtl:{[CU.variable]:pp(d2).negate().toString()}},track:Bwe(n),thumb:Wwe})),Gwe={sm:GO({container:{[Yw.variable]:"1.375rem",[Sy.variable]:"sizes.3"}}),md:GO({container:{[Yw.variable]:"1.875rem",[Sy.variable]:"sizes.4"}}),lg:GO({container:{[Yw.variable]:"2.875rem",[Sy.variable]:"sizes.6"}})},Hwe=Fwe({baseStyle:zwe,sizes:Gwe,defaultProps:{size:"md",colorScheme:"blue"}}),{defineMultiStyleConfig:$we,definePartsStyle:$S}=Vi(rSe.keys),Kwe=$S({table:{fontVariantNumeric:"lining-nums tabular-nums",borderCollapse:"collapse",width:"full"},th:{fontFamily:"heading",fontWeight:"bold",textTransform:"uppercase",letterSpacing:"wider",textAlign:"start"},td:{textAlign:"start"},caption:{mt:4,fontFamily:"heading",textAlign:"center",fontWeight:"medium"}}),Tk={"&[data-is-numeric=true]":{textAlign:"end"}},qwe=$S(n=>{const{colorScheme:e}=n;return{th:{color:An("gray.600","gray.400")(n),borderBottom:"1px",borderColor:An(`${e}.100`,`${e}.700`)(n),...Tk},td:{borderBottom:"1px",borderColor:An(`${e}.100`,`${e}.700`)(n),...Tk},caption:{color:An("gray.600","gray.100")(n)},tfoot:{tr:{"&:last-of-type":{th:{borderBottomWidth:0}}}}}}),Ywe=$S(n=>{const{colorScheme:e}=n;return{th:{color:An("gray.600","gray.400")(n),borderBottom:"1px",borderColor:An(`${e}.100`,`${e}.700`)(n),...Tk},td:{borderBottom:"1px",borderColor:An(`${e}.100`,`${e}.700`)(n),...Tk},caption:{color:An("gray.600","gray.100")(n)},tbody:{tr:{"&:nth-of-type(odd)":{"th, td":{borderBottomWidth:"1px",borderColor:An(`${e}.100`,`${e}.700`)(n)},td:{background:An(`${e}.100`,`${e}.700`)(n)}}}},tfoot:{tr:{"&:last-of-type":{th:{borderBottomWidth:0}}}}}}),Xwe={simple:qwe,striped:Ywe,unstyled:{}},Jwe={sm:$S({th:{px:"4",py:"1",lineHeight:"4",fontSize:"xs"},td:{px:"4",py:"2",fontSize:"sm",lineHeight:"4"},caption:{px:"4",py:"2",fontSize:"xs"}}),md:$S({th:{px:"6",py:"3",lineHeight:"4",fontSize:"xs"},td:{px:"6",py:"4",lineHeight:"5"},caption:{px:"6",py:"2",fontSize:"sm"}}),lg:$S({th:{px:"8",py:"4",lineHeight:"5",fontSize:"sm"},td:{px:"8",py:"5",lineHeight:"6"},caption:{px:"6",py:"2",fontSize:"md"}})},Qwe=$we({baseStyle:Kwe,variants:Xwe,sizes:Jwe,defaultProps:{variant:"simple",size:"md",colorScheme:"gray"}}),Kc=Pn("tabs-color"),Ad=Pn("tabs-bg"),hO=Pn("tabs-border-color"),{defineMultiStyleConfig:Zwe,definePartsStyle:Kh}=Vi(iSe.keys),eRe=n=>{const{orientation:e}=n;return{display:e==="vertical"?"flex":"block"}},tRe=n=>{const{isFitted:e}=n;return{flex:e?1:void 0,transitionProperty:"common",transitionDuration:"normal",_focusVisible:{zIndex:1,boxShadow:"outline"},_disabled:{cursor:"not-allowed",opacity:.4}}},nRe=n=>{const{align:e="start",orientation:i}=n;return{justifyContent:{end:"flex-end",center:"center",start:"flex-start"}[e],flexDirection:i==="vertical"?"column":"row"}},rRe={p:4},iRe=Kh(n=>({root:eRe(n),tab:tRe(n),tablist:nRe(n),tabpanel:rRe})),sRe={sm:Kh({tab:{py:1,px:4,fontSize:"sm"}}),md:Kh({tab:{fontSize:"md",py:2,px:4}}),lg:Kh({tab:{fontSize:"lg",py:3,px:4}})},oRe=Kh(n=>{const{colorScheme:e,orientation:i}=n,a=i==="vertical",l=a?"borderStart":"borderBottom",d=a?"marginStart":"marginBottom";return{tablist:{[l]:"2px solid",borderColor:"inherit"},tab:{[l]:"2px solid",borderColor:"transparent",[d]:"-2px",_selected:{[Kc.variable]:`colors.${e}.600`,_dark:{[Kc.variable]:`colors.${e}.300`},borderColor:"currentColor"},_active:{[Ad.variable]:"colors.gray.200",_dark:{[Ad.variable]:"colors.whiteAlpha.300"}},_disabled:{_active:{bg:"none"}},color:Kc.reference,bg:Ad.reference}}}),aRe=Kh(n=>{const{colorScheme:e}=n;return{tab:{borderTopRadius:"md",border:"1px solid",borderColor:"transparent",mb:"-1px",[hO.variable]:"transparent",_selected:{[Kc.variable]:`colors.${e}.600`,[hO.variable]:"colors.white",_dark:{[Kc.variable]:`colors.${e}.300`,[hO.variable]:"colors.gray.800"},borderColor:"inherit",borderBottomColor:hO.reference},color:Kc.reference},tablist:{mb:"-1px",borderBottom:"1px solid",borderColor:"inherit"}}}),cRe=Kh(n=>{const{colorScheme:e}=n;return{tab:{border:"1px solid",borderColor:"inherit",[Ad.variable]:"colors.gray.50",_dark:{[Ad.variable]:"colors.whiteAlpha.50"},mb:"-1px",_notLast:{marginEnd:"-1px"},_selected:{[Ad.variable]:"colors.white",[Kc.variable]:`colors.${e}.600`,_dark:{[Ad.variable]:"colors.gray.800",[Kc.variable]:`colors.${e}.300`},borderColor:"inherit",borderTopColor:"currentColor",borderBottomColor:"transparent"},color:Kc.reference,bg:Ad.reference},tablist:{mb:"-1px",borderBottom:"1px solid",borderColor:"inherit"}}}),lRe=Kh(n=>{const{colorScheme:e,theme:i}=n;return{tab:{borderRadius:"full",fontWeight:"semibold",color:"gray.600",_selected:{color:ac(i,`${e}.700`),bg:ac(i,`${e}.100`)}}}}),uRe=Kh(n=>{const{colorScheme:e}=n;return{tab:{borderRadius:"full",fontWeight:"semibold",[Kc.variable]:"colors.gray.600",_dark:{[Kc.variable]:"inherit"},_selected:{[Kc.variable]:"colors.white",[Ad.variable]:`colors.${e}.600`,_dark:{[Kc.variable]:"colors.gray.800",[Ad.variable]:`colors.${e}.300`}},color:Kc.reference,bg:Ad.reference}}}),dRe=Kh({}),hRe={line:oRe,enclosed:aRe,"enclosed-colored":cRe,"soft-rounded":lRe,"solid-rounded":uRe,unstyled:dRe},fRe=Zwe({baseStyle:iRe,sizes:sRe,variants:hRe,defaultProps:{size:"md",variant:"line",colorScheme:"blue"}}),{defineMultiStyleConfig:pRe,definePartsStyle:by}=Vi(sSe.keys),EK=Pn("tag-bg"),vK=Pn("tag-color"),h2=Pn("tag-shadow"),HO=Pn("tag-min-height"),$O=Pn("tag-min-width"),KO=Pn("tag-font-size"),qO=Pn("tag-padding-inline"),mRe={fontWeight:"medium",lineHeight:1.2,outline:0,[vK.variable]:Vs.color.reference,[EK.variable]:Vs.bg.reference,[h2.variable]:Vs.shadow.reference,color:vK.reference,bg:EK.reference,boxShadow:h2.reference,borderRadius:"md",minH:HO.reference,minW:$O.reference,fontSize:KO.reference,px:qO.reference,_focusVisible:{[h2.variable]:"shadows.outline"}},gRe={lineHeight:1.2,overflow:"visible"},_Re={fontSize:"lg",w:"5",h:"5",transitionProperty:"common",transitionDuration:"normal",borderRadius:"full",marginStart:"1.5",marginEnd:"-1",opacity:.5,_disabled:{opacity:.4},_focusVisible:{boxShadow:"outline",bg:"rgba(0, 0, 0, 0.14)"},_hover:{opacity:.8},_active:{opacity:1}},yRe=by({container:mRe,label:gRe,closeButton:_Re}),ERe={sm:by({container:{[HO.variable]:"sizes.5",[$O.variable]:"sizes.5",[KO.variable]:"fontSizes.xs",[qO.variable]:"space.2"},closeButton:{marginEnd:"-2px",marginStart:"0.35rem"}}),md:by({container:{[HO.variable]:"sizes.6",[$O.variable]:"sizes.6",[KO.variable]:"fontSizes.sm",[qO.variable]:"space.2"}}),lg:by({container:{[HO.variable]:"sizes.8",[$O.variable]:"sizes.8",[KO.variable]:"fontSizes.md",[qO.variable]:"space.3"}})},vRe={subtle:by(n=>{var e;return{container:(e=$w.variants)==null?void 0:e.subtle(n)}}),solid:by(n=>{var e;return{container:(e=$w.variants)==null?void 0:e.solid(n)}}),outline:by(n=>{var e;return{container:(e=$w.variants)==null?void 0:e.outline(n)}})},SRe=pRe({variants:vRe,baseStyle:yRe,sizes:ERe,defaultProps:{size:"md",variant:"subtle",colorScheme:"gray"}});var mQ;const bRe={...(mQ=Xr.baseStyle)==null?void 0:mQ.field,paddingY:"2",minHeight:"20",lineHeight:"short",verticalAlign:"top"};var gQ;const TRe={outline:n=>{var e;return((e=Xr.variants)==null?void 0:e.outline(n).field)??{}},flushed:n=>{var e;return((e=Xr.variants)==null?void 0:e.flushed(n).field)??{}},filled:n=>{var e;return((e=Xr.variants)==null?void 0:e.filled(n).field)??{}},unstyled:((gQ=Xr.variants)==null?void 0:gQ.unstyled.field)??{}};var _Q,yQ,EQ,vQ;const wRe={xs:((_Q=Xr.sizes)==null?void 0:_Q.xs.field)??{},sm:((yQ=Xr.sizes)==null?void 0:yQ.sm.field)??{},md:((EQ=Xr.sizes)==null?void 0:EQ.md.field)??{},lg:((vQ=Xr.sizes)==null?void 0:vQ.lg.field)??{}},RRe={baseStyle:bRe,sizes:wRe,variants:TRe,defaultProps:{size:"md",variant:"outline"}},fO=lo("tooltip-bg"),f2=lo("tooltip-fg"),CRe=lo("popper-arrow-bg"),IRe={bg:fO.reference,color:f2.reference,[fO.variable]:"colors.gray.700",[f2.variable]:"colors.whiteAlpha.900",_dark:{[fO.variable]:"colors.gray.300",[f2.variable]:"colors.gray.900"},[CRe.variable]:fO.reference,px:"2",py:"0.5",borderRadius:"sm",fontWeight:"medium",fontSize:"sm",boxShadow:"md",maxW:"xs",zIndex:"tooltip"},ARe={baseStyle:IRe},PRe={Accordion:pSe,Alert:JSe,Avatar:c0e,Badge:$w,Breadcrumb:y0e,Button:I0e,Checkbox:eg,CloseButton:W0e,Code:$0e,Container:q0e,Divider:Z0e,Drawer:ube,Editable:_be,Form:Tbe,FormError:Pbe,FormLabel:kbe,Heading:Lbe,Input:Xr,Kbd:Gbe,Link:$be,List:Jbe,Menu:cTe,Modal:ETe,NumberInput:ATe,PinInput:NTe,Popover:zTe,Progress:JTe,Radio:nwe,Select:lwe,Skeleton:dwe,SkipLink:fwe,Slider:wwe,Spinner:Iwe,Stat:xwe,Switch:Hwe,Table:Qwe,Tabs:fRe,Tag:SRe,Textarea:RRe,Tooltip:ARe,Card:N0e,Stepper:Vwe},ORe={none:0,"1px":"1px solid","2px":"2px solid","4px":"4px solid","8px":"8px solid"},kRe={base:"0em",sm:"30em",md:"48em",lg:"62em",xl:"80em","2xl":"96em"},NRe={transparent:"transparent",current:"currentColor",black:"#000000",white:"#FFFFFF",whiteAlpha:{50:"rgba(255, 255, 255, 0.04)",100:"rgba(255, 255, 255, 0.06)",200:"rgba(255, 255, 255, 0.08)",300:"rgba(255, 255, 255, 0.16)",400:"rgba(255, 255, 255, 0.24)",500:"rgba(255, 255, 255, 0.36)",600:"rgba(255, 255, 255, 0.48)",700:"rgba(255, 255, 255, 0.64)",800:"rgba(255, 255, 255, 0.80)",900:"rgba(255, 255, 255, 0.92)"},blackAlpha:{50:"rgba(0, 0, 0, 0.04)",100:"rgba(0, 0, 0, 0.06)",200:"rgba(0, 0, 0, 0.08)",300:"rgba(0, 0, 0, 0.16)",400:"rgba(0, 0, 0, 0.24)",500:"rgba(0, 0, 0, 0.36)",600:"rgba(0, 0, 0, 0.48)",700:"rgba(0, 0, 0, 0.64)",800:"rgba(0, 0, 0, 0.80)",900:"rgba(0, 0, 0, 0.92)"},gray:{50:"#F7FAFC",100:"#EDF2F7",200:"#E2E8F0",300:"#CBD5E0",400:"#A0AEC0",500:"#718096",600:"#4A5568",700:"#2D3748",800:"#1A202C",900:"#171923"},red:{50:"#FFF5F5",100:"#FED7D7",200:"#FEB2B2",300:"#FC8181",400:"#F56565",500:"#E53E3E",600:"#C53030",700:"#9B2C2C",800:"#822727",900:"#63171B"},orange:{50:"#FFFAF0",100:"#FEEBC8",200:"#FBD38D",300:"#F6AD55",400:"#ED8936",500:"#DD6B20",600:"#C05621",700:"#9C4221",800:"#7B341E",900:"#652B19"},yellow:{50:"#FFFFF0",100:"#FEFCBF",200:"#FAF089",300:"#F6E05E",400:"#ECC94B",500:"#D69E2E",600:"#B7791F",700:"#975A16",800:"#744210",900:"#5F370E"},green:{50:"#F0FFF4",100:"#C6F6D5",200:"#9AE6B4",300:"#68D391",400:"#48BB78",500:"#38A169",600:"#2F855A",700:"#276749",800:"#22543D",900:"#1C4532"},teal:{50:"#E6FFFA",100:"#B2F5EA",200:"#81E6D9",300:"#4FD1C5",400:"#38B2AC",500:"#319795",600:"#2C7A7B",700:"#285E61",800:"#234E52",900:"#1D4044"},blue:{50:"#ebf8ff",100:"#bee3f8",200:"#90cdf4",300:"#63b3ed",400:"#4299e1",500:"#3182ce",600:"#2b6cb0",700:"#2c5282",800:"#2a4365",900:"#1A365D"},cyan:{50:"#EDFDFD",100:"#C4F1F9",200:"#9DECF9",300:"#76E4F7",400:"#0BC5EA",500:"#00B5D8",600:"#00A3C4",700:"#0987A0",800:"#086F83",900:"#065666"},purple:{50:"#FAF5FF",100:"#E9D8FD",200:"#D6BCFA",300:"#B794F4",400:"#9F7AEA",500:"#805AD5",600:"#6B46C1",700:"#553C9A",800:"#44337A",900:"#322659"},pink:{50:"#FFF5F7",100:"#FED7E2",200:"#FBB6CE",300:"#F687B3",400:"#ED64A6",500:"#D53F8C",600:"#B83280",700:"#97266D",800:"#702459",900:"#521B41"}},DRe={none:"0",sm:"0.125rem",base:"0.25rem",md:"0.375rem",lg:"0.5rem",xl:"0.75rem","2xl":"1rem","3xl":"1.5rem",full:"9999px"},LRe={xs:"0 0 0 1px rgba(0, 0, 0, 0.05)",sm:"0 1px 2px 0 rgba(0, 0, 0, 0.05)",base:"0 1px 3px 0 rgba(0, 0, 0, 0.1), 0 1px 2px 0 rgba(0, 0, 0, 0.06)",md:"0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06)",lg:"0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05)",xl:"0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04)","2xl":"0 25px 50px -12px rgba(0, 0, 0, 0.25)",outline:"0 0 0 3px rgba(66, 153, 225, 0.6)",inner:"inset 0 2px 4px 0 rgba(0,0,0,0.06)",none:"none","dark-lg":"rgba(0, 0, 0, 0.1) 0px 0px 0px 1px, rgba(0, 0, 0, 0.2) 0px 5px 10px, rgba(0, 0, 0, 0.4) 0px 15px 40px"},xRe={common:"background-color, border-color, color, fill, stroke, opacity, box-shadow, transform",colors:"background-color, border-color, color, fill, stroke",dimensions:"width, height",position:"left, right, top, bottom",background:"background-color, background-image, background-position"},MRe={"ease-in":"cubic-bezier(0.4, 0, 1, 1)","ease-out":"cubic-bezier(0, 0, 0.2, 1)","ease-in-out":"cubic-bezier(0.4, 0, 0.2, 1)"},URe={"ultra-fast":"50ms",faster:"100ms",fast:"150ms",normal:"200ms",slow:"300ms",slower:"400ms","ultra-slow":"500ms"},VRe={property:xRe,easing:MRe,duration:URe},FRe={hide:-1,auto:"auto",base:0,docked:10,dropdown:1e3,sticky:1100,banner:1200,overlay:1300,modal:1400,popover:1500,skipLink:1600,toast:1700,tooltip:1800},jRe={none:0,sm:"4px",base:"8px",md:"12px",lg:"16px",xl:"24px","2xl":"40px","3xl":"64px"},BRe={breakpoints:kRe,zIndices:FRe,radii:DRe,blur:jRe,colors:NRe,...iZ,sizes:QQ,shadows:LRe,space:JQ,borders:ORe,transition:VRe},WRe={colors:{"chakra-body-text":{_light:"gray.800",_dark:"whiteAlpha.900"},"chakra-body-bg":{_light:"white",_dark:"gray.800"},"chakra-border-color":{_light:"gray.200",_dark:"whiteAlpha.300"},"chakra-inverse-text":{_light:"white",_dark:"gray.800"},"chakra-subtle-bg":{_light:"gray.100",_dark:"gray.700"},"chakra-subtle-text":{_light:"gray.600",_dark:"gray.400"},"chakra-placeholder-color":{_light:"gray.500",_dark:"whiteAlpha.400"}}},zRe={global:{body:{fontFamily:"body",color:"chakra-body-text",bg:"chakra-body-bg",transitionProperty:"background-color",transitionDuration:"normal",lineHeight:"base"},"*::placeholder":{color:"chakra-placeholder-color"},"*, *::before, &::after":{borderColor:"chakra-border-color"}}},GRe="ltr",HRe={useSystemColorMode:!1,initialColorMode:"light",cssVarPrefix:"chakra"},$Re={semanticTokens:WRe,direction:GRe,...BRe,components:PRe,styles:zRe,config:HRe};function KRe(n){if(n.sheet)return n.sheet;for(var e=0;e<document.styleSheets.length;e++)if(document.styleSheets[e].ownerNode===n)return document.styleSheets[e]}function qRe(n){var e=document.createElement("style");return e.setAttribute("data-emotion",n.key),n.nonce!==void 0&&e.setAttribute("nonce",n.nonce),e.appendChild(document.createTextNode("")),e.setAttribute("data-s",""),e}var YRe=function(){function n(i){var a=this;this._insertTag=function(l){var d;a.tags.length===0?a.insertionPoint?d=a.insertionPoint.nextSibling:a.prepend?d=a.container.firstChild:d=a.before:d=a.tags[a.tags.length-1].nextSibling,a.container.insertBefore(l,d),a.tags.push(l)},this.isSpeedy=i.speedy===void 0?!0:i.speedy,this.tags=[],this.ctr=0,this.nonce=i.nonce,this.key=i.key,this.container=i.container,this.prepend=i.prepend,this.insertionPoint=i.insertionPoint,this.before=null}var e=n.prototype;return e.hydrate=function(a){a.forEach(this._insertTag)},e.insert=function(a){this.ctr%(this.isSpeedy?65e3:1)===0&&this._insertTag(qRe(this));var l=this.tags[this.tags.length-1];if(this.isSpeedy){var d=KRe(l);try{d.insertRule(a,d.cssRules.length)}catch{}}else l.appendChild(document.createTextNode(a));this.ctr++},e.flush=function(){this.tags.forEach(function(a){var l;return(l=a.parentNode)==null?void 0:l.removeChild(a)}),this.tags=[],this.ctr=0},n}(),Da="-ms-",wk="-moz-",qr="-webkit-",cZ="comm",lF="rule",uF="decl",XRe="@import",lZ="@keyframes",JRe="@layer",QRe=Math.abs,g1=String.fromCharCode,ZRe=Object.assign;function eCe(n,e){return ta(n,0)^45?(((e<<2^ta(n,0))<<2^ta(n,1))<<2^ta(n,2))<<2^ta(n,3):0}function uZ(n){return n.trim()}function tCe(n,e){return(n=e.exec(n))?n[0]:n}function Yr(n,e,i){return n.replace(e,i)}function IU(n,e){return n.indexOf(e)}function ta(n,e){return n.charCodeAt(e)|0}function gR(n,e,i){return n.slice(e,i)}function Vh(n){return n.length}function dF(n){return n.length}function pO(n,e){return e.push(n),n}function nCe(n,e){return n.map(e).join("")}var _1=1,s0=1,dZ=0,el=0,Ks=0,P0="";function y1(n,e,i,a,l,d,p){return{value:n,root:e,parent:i,type:a,props:l,children:d,line:_1,column:s0,length:p,return:""}}function cw(n,e){return ZRe(y1("",null,null,"",null,null,0),n,{length:-n.length},e)}function rCe(){return Ks}function iCe(){return Ks=el>0?ta(P0,--el):0,s0--,Ks===10&&(s0=1,_1--),Ks}function Nl(){return Ks=el<dZ?ta(P0,el++):0,s0++,Ks===10&&(s0=1,_1++),Ks}function qh(){return ta(P0,el)}function YO(){return el}function HR(n,e){return gR(P0,n,e)}function _R(n){switch(n){case 0:case 9:case 10:case 13:case 32:return 5;case 33:case 43:case 44:case 47:case 62:case 64:case 126:case 59:case 123:case 125:return 4;case 58:return 3;case 34:case 39:case 40:case 91:return 2;case 41:case 93:return 1}return 0}function hZ(n){return _1=s0=1,dZ=Vh(P0=n),el=0,[]}function fZ(n){return P0="",n}function XO(n){return uZ(HR(el-1,AU(n===91?n+2:n===40?n+1:n)))}function sCe(n){for(;(Ks=qh())&&Ks<33;)Nl();return _R(n)>2||_R(Ks)>3?"":" "}function oCe(n,e){for(;--e&&Nl()&&!(Ks<48||Ks>102||Ks>57&&Ks<65||Ks>70&&Ks<97););return HR(n,YO()+(e<6&&qh()==32&&Nl()==32))}function AU(n){for(;Nl();)switch(Ks){case n:return el;case 34:case 39:n!==34&&n!==39&&AU(Ks);break;case 40:n===41&&AU(n);break;case 92:Nl();break}return el}function aCe(n,e){for(;Nl()&&n+Ks!==57;)if(n+Ks===84&&qh()===47)break;return"/*"+HR(e,el-1)+"*"+g1(n===47?n:Nl())}function cCe(n){for(;!_R(qh());)Nl();return HR(n,el)}function lCe(n){return fZ(JO("",null,null,null,[""],n=hZ(n),0,[0],n))}function JO(n,e,i,a,l,d,p,y,v){for(var b=0,w=0,A=p,N=0,V=0,j=0,B=1,G=1,ee=1,K=0,ne="",ce=l,oe=d,ge=a,te=ne;G;)switch(j=K,K=Nl()){case 40:if(j!=108&&ta(te,A-1)==58){IU(te+=Yr(XO(K),"&","&\f"),"&\f")!=-1&&(ee=-1);break}case 34:case 39:case 91:te+=XO(K);break;case 9:case 10:case 13:case 32:te+=sCe(j);break;case 92:te+=oCe(YO()-1,7);continue;case 47:switch(qh()){case 42:case 47:pO(uCe(aCe(Nl(),YO()),e,i),v);break;default:te+="/"}break;case 123*B:y[b++]=Vh(te)*ee;case 125*B:case 59:case 0:switch(K){case 0:case 125:G=0;case 59+w:ee==-1&&(te=Yr(te,/\f/g,"")),V>0&&Vh(te)-A&&pO(V>32?bK(te+";",a,i,A-1):bK(Yr(te," ","")+";",a,i,A-2),v);break;case 59:te+=";";default:if(pO(ge=SK(te,e,i,b,w,l,y,ne,ce=[],oe=[],A),d),K===123)if(w===0)JO(te,e,ge,ge,ce,d,A,y,oe);else switch(N===99&&ta(te,3)===110?100:N){case 100:case 108:case 109:case 115:JO(n,ge,ge,a&&pO(SK(n,ge,ge,0,0,l,y,ne,l,ce=[],A),oe),l,oe,A,y,a?ce:oe);break;default:JO(te,ge,ge,ge,[""],oe,0,y,oe)}}b=w=V=0,B=ee=1,ne=te="",A=p;break;case 58:A=1+Vh(te),V=j;default:if(B<1){if(K==123)--B;else if(K==125&&B++==0&&iCe()==125)continue}switch(te+=g1(K),K*B){case 38:ee=w>0?1:(te+="\f",-1);break;case 44:y[b++]=(Vh(te)-1)*ee,ee=1;break;case 64:qh()===45&&(te+=XO(Nl())),N=qh(),w=A=Vh(ne=te+=cCe(YO())),K++;break;case 45:j===45&&Vh(te)==2&&(B=0)}}return d}function SK(n,e,i,a,l,d,p,y,v,b,w){for(var A=l-1,N=l===0?d:[""],V=dF(N),j=0,B=0,G=0;j<a;++j)for(var ee=0,K=gR(n,A+1,A=QRe(B=p[j])),ne=n;ee<V;++ee)(ne=uZ(B>0?N[ee]+" "+K:Yr(K,/&\f/g,N[ee])))&&(v[G++]=ne);return y1(n,e,i,l===0?lF:y,v,b,w)}function uCe(n,e,i){return y1(n,e,i,cZ,g1(rCe()),gR(n,2,-2),0)}function bK(n,e,i,a){return y1(n,e,i,uF,gR(n,0,a),gR(n,a+1,-1),a)}function KS(n,e){for(var i="",a=dF(n),l=0;l<a;l++)i+=e(n[l],l,n,e)||"";return i}function dCe(n,e,i,a){switch(n.type){case JRe:if(n.children.length)break;case XRe:case uF:return n.return=n.return||n.value;case cZ:return"";case lZ:return n.return=n.value+"{"+KS(n.children,a)+"}";case lF:n.value=n.props.join(",")}return Vh(i=KS(n.children,a))?n.return=n.value+"{"+i+"}":""}function hCe(n){var e=dF(n);return function(i,a,l,d){for(var p="",y=0;y<e;y++)p+=n[y](i,a,l,d)||"";return p}}function fCe(n){return function(e){e.root||(e=e.return)&&n(e)}}var TK=function(e){var i=new WeakMap;return function(a){if(i.has(a))return i.get(a);var l=e(a);return i.set(a,l),l}};function pZ(n){var e=Object.create(null);return function(i){return e[i]===void 0&&(e[i]=n(i)),e[i]}}var pCe=function(e,i,a){for(var l=0,d=0;l=d,d=qh(),l===38&&d===12&&(i[a]=1),!_R(d);)Nl();return HR(e,el)},mCe=function(e,i){var a=-1,l=44;do switch(_R(l)){case 0:l===38&&qh()===12&&(i[a]=1),e[a]+=pCe(el-1,i,a);break;case 2:e[a]+=XO(l);break;case 4:if(l===44){e[++a]=qh()===58?"&\f":"",i[a]=e[a].length;break}default:e[a]+=g1(l)}while(l=Nl());return e},gCe=function(e,i){return fZ(mCe(hZ(e),i))},wK=new WeakMap,_Ce=function(e){if(!(e.type!=="rule"||!e.parent||e.length<1)){for(var i=e.value,a=e.parent,l=e.column===a.column&&e.line===a.line;a.type!=="rule";)if(a=a.parent,!a)return;if(!(e.props.length===1&&i.charCodeAt(0)!==58&&!wK.get(a))&&!l){wK.set(e,!0);for(var d=[],p=gCe(i,d),y=a.props,v=0,b=0;v<p.length;v++)for(var w=0;w<y.length;w++,b++)e.props[b]=d[v]?p[v].replace(/&\f/g,y[w]):y[w]+" "+p[v]}}},yCe=function(e){if(e.type==="decl"){var i=e.value;i.charCodeAt(0)===108&&i.charCodeAt(2)===98&&(e.return="",e.value="")}};function mZ(n,e){switch(eCe(n,e)){case 5103:return qr+"print-"+n+n;case 5737:case 4201:case 3177:case 3433:case 1641:case 4457:case 2921:case 5572:case 6356:case 5844:case 3191:case 6645:case 3005:case 6391:case 5879:case 5623:case 6135:case 4599:case 4855:case 4215:case 6389:case 5109:case 5365:case 5621:case 3829:return qr+n+n;case 5349:case 4246:case 4810:case 6968:case 2756:return qr+n+wk+n+Da+n+n;case 6828:case 4268:return qr+n+Da+n+n;case 6165:return qr+n+Da+"flex-"+n+n;case 5187:return qr+n+Yr(n,/(\w+).+(:[^]+)/,qr+"box-$1$2"+Da+"flex-$1$2")+n;case 5443:return qr+n+Da+"flex-item-"+Yr(n,/flex-|-self/,"")+n;case 4675:return qr+n+Da+"flex-line-pack"+Yr(n,/align-content|flex-|-self/,"")+n;case 5548:return qr+n+Da+Yr(n,"shrink","negative")+n;case 5292:return qr+n+Da+Yr(n,"basis","preferred-size")+n;case 6060:return qr+"box-"+Yr(n,"-grow","")+qr+n+Da+Yr(n,"grow","positive")+n;case 4554:return qr+Yr(n,/([^-])(transform)/g,"$1"+qr+"$2")+n;case 6187:return Yr(Yr(Yr(n,/(zoom-|grab)/,qr+"$1"),/(image-set)/,qr+"$1"),n,"")+n;case 5495:case 3959:return Yr(n,/(image-set\([^]*)/,qr+"$1$`$1");case 4968:return Yr(Yr(n,/(.+:)(flex-)?(.*)/,qr+"box-pack:$3"+Da+"flex-pack:$3"),/s.+-b[^;]+/,"justify")+qr+n+n;case 4095:case 3583:case 4068:case 2532:return Yr(n,/(.+)-inline(.+)/,qr+"$1$2")+n;case 8116:case 7059:case 5753:case 5535:case 5445:case 5701:case 4933:case 4677:case 5533:case 5789:case 5021:case 4765:if(Vh(n)-1-e>6)switch(ta(n,e+1)){case 109:if(ta(n,e+4)!==45)break;case 102:return Yr(n,/(.+:)(.+)-([^]+)/,"$1"+qr+"$2-$3$1"+wk+(ta(n,e+3)==108?"$3":"$2-$3"))+n;case 115:return~IU(n,"stretch")?mZ(Yr(n,"stretch","fill-available"),e)+n:n}break;case 4949:if(ta(n,e+1)!==115)break;case 6444:switch(ta(n,Vh(n)-3-(~IU(n,"!important")&&10))){case 107:return Yr(n,":",":"+qr)+n;case 101:return Yr(n,/(.+:)([^;!]+)(;|!.+)?/,"$1"+qr+(ta(n,14)===45?"inline-":"")+"box$3$1"+qr+"$2$3$1"+Da+"$2box$3")+n}break;case 5936:switch(ta(n,e+11)){case 114:return qr+n+Da+Yr(n,/[svh]\w+-[tblr]{2}/,"tb")+n;case 108:return qr+n+Da+Yr(n,/[svh]\w+-[tblr]{2}/,"tb-rl")+n;case 45:return qr+n+Da+Yr(n,/[svh]\w+-[tblr]{2}/,"lr")+n}return qr+n+Da+n+n}return n}var ECe=function(e,i,a,l){if(e.length>-1&&!e.return)switch(e.type){case uF:e.return=mZ(e.value,e.length);break;case lZ:return KS([cw(e,{value:Yr(e.value,"@","@"+qr)})],l);case lF:if(e.length)return nCe(e.props,function(d){switch(tCe(d,/(::plac\w+|:read-\w+)/)){case":read-only":case":read-write":return KS([cw(e,{props:[Yr(d,/:(read-\w+)/,":"+wk+"$1")]})],l);case"::placeholder":return KS([cw(e,{props:[Yr(d,/:(plac\w+)/,":"+qr+"input-$1")]}),cw(e,{props:[Yr(d,/:(plac\w+)/,":"+wk+"$1")]}),cw(e,{props:[Yr(d,/:(plac\w+)/,Da+"input-$1")]})],l)}return""})}},vCe=[ECe],SCe=function(e){var i=e.key;if(i==="css"){var a=document.querySelectorAll("style[data-emotion]:not([data-s])");Array.prototype.forEach.call(a,function(B){var G=B.getAttribute("data-emotion");G.indexOf(" ")!==-1&&(document.head.appendChild(B),B.setAttribute("data-s",""))})}var l=e.stylisPlugins||vCe,d={},p,y=[];p=e.container||document.head,Array.prototype.forEach.call(document.querySelectorAll('style[data-emotion^="'+i+' "]'),function(B){for(var G=B.getAttribute("data-emotion").split(" "),ee=1;ee<G.length;ee++)d[G[ee]]=!0;y.push(B)});var v,b=[_Ce,yCe];{var w,A=[dCe,fCe(function(B){w.insert(B)})],N=hCe(b.concat(l,A)),V=function(G){return KS(lCe(G),N)};v=function(G,ee,K,ne){w=K,V(G?G+"{"+ee.styles+"}":ee.styles),ne&&(j.inserted[ee.name]=!0)}}var j={key:i,sheet:new YRe({key:i,container:p,nonce:e.nonce,speedy:e.speedy,prepend:e.prepend,insertionPoint:e.insertionPoint}),nonce:e.nonce,inserted:d,registered:{},insert:v};return j.sheet.hydrate(y),j};function Oy(){return Oy=Object.assign?Object.assign.bind():function(n){for(var e=1;e<arguments.length;e++){var i=arguments[e];for(var a in i)({}).hasOwnProperty.call(i,a)&&(n[a]=i[a])}return n},Oy.apply(null,arguments)}var p2={exports:{}},ni={};/** @license React v16.13.1
 * react-is.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var RK;function bCe(){if(RK)return ni;RK=1;var n=typeof Symbol=="function"&&Symbol.for,e=n?Symbol.for("react.element"):60103,i=n?Symbol.for("react.portal"):60106,a=n?Symbol.for("react.fragment"):60107,l=n?Symbol.for("react.strict_mode"):60108,d=n?Symbol.for("react.profiler"):60114,p=n?Symbol.for("react.provider"):60109,y=n?Symbol.for("react.context"):60110,v=n?Symbol.for("react.async_mode"):60111,b=n?Symbol.for("react.concurrent_mode"):60111,w=n?Symbol.for("react.forward_ref"):60112,A=n?Symbol.for("react.suspense"):60113,N=n?Symbol.for("react.suspense_list"):60120,V=n?Symbol.for("react.memo"):60115,j=n?Symbol.for("react.lazy"):60116,B=n?Symbol.for("react.block"):60121,G=n?Symbol.for("react.fundamental"):60117,ee=n?Symbol.for("react.responder"):60118,K=n?Symbol.for("react.scope"):60119;function ne(oe){if(typeof oe=="object"&&oe!==null){var ge=oe.$$typeof;switch(ge){case e:switch(oe=oe.type,oe){case v:case b:case a:case d:case l:case A:return oe;default:switch(oe=oe&&oe.$$typeof,oe){case y:case w:case j:case V:case p:return oe;default:return ge}}case i:return ge}}}function ce(oe){return ne(oe)===b}return ni.AsyncMode=v,ni.ConcurrentMode=b,ni.ContextConsumer=y,ni.ContextProvider=p,ni.Element=e,ni.ForwardRef=w,ni.Fragment=a,ni.Lazy=j,ni.Memo=V,ni.Portal=i,ni.Profiler=d,ni.StrictMode=l,ni.Suspense=A,ni.isAsyncMode=function(oe){return ce(oe)||ne(oe)===v},ni.isConcurrentMode=ce,ni.isContextConsumer=function(oe){return ne(oe)===y},ni.isContextProvider=function(oe){return ne(oe)===p},ni.isElement=function(oe){return typeof oe=="object"&&oe!==null&&oe.$$typeof===e},ni.isForwardRef=function(oe){return ne(oe)===w},ni.isFragment=function(oe){return ne(oe)===a},ni.isLazy=function(oe){return ne(oe)===j},ni.isMemo=function(oe){return ne(oe)===V},ni.isPortal=function(oe){return ne(oe)===i},ni.isProfiler=function(oe){return ne(oe)===d},ni.isStrictMode=function(oe){return ne(oe)===l},ni.isSuspense=function(oe){return ne(oe)===A},ni.isValidElementType=function(oe){return typeof oe=="string"||typeof oe=="function"||oe===a||oe===b||oe===d||oe===l||oe===A||oe===N||typeof oe=="object"&&oe!==null&&(oe.$$typeof===j||oe.$$typeof===V||oe.$$typeof===p||oe.$$typeof===y||oe.$$typeof===w||oe.$$typeof===G||oe.$$typeof===ee||oe.$$typeof===K||oe.$$typeof===B)},ni.typeOf=ne,ni}var CK;function TCe(){return CK||(CK=1,p2.exports=bCe()),p2.exports}var m2,IK;function wCe(){if(IK)return m2;IK=1;var n=TCe(),e={childContextTypes:!0,contextType:!0,contextTypes:!0,defaultProps:!0,displayName:!0,getDefaultProps:!0,getDerivedStateFromError:!0,getDerivedStateFromProps:!0,mixins:!0,propTypes:!0,type:!0},i={name:!0,length:!0,prototype:!0,caller:!0,callee:!0,arguments:!0,arity:!0},a={$$typeof:!0,render:!0,defaultProps:!0,displayName:!0,propTypes:!0},l={$$typeof:!0,compare:!0,defaultProps:!0,displayName:!0,propTypes:!0,type:!0},d={};d[n.ForwardRef]=a,d[n.Memo]=l;function p(j){return n.isMemo(j)?l:d[j.$$typeof]||e}var y=Object.defineProperty,v=Object.getOwnPropertyNames,b=Object.getOwnPropertySymbols,w=Object.getOwnPropertyDescriptor,A=Object.getPrototypeOf,N=Object.prototype;function V(j,B,G){if(typeof B!="string"){if(N){var ee=A(B);ee&&ee!==N&&V(j,ee,G)}var K=v(B);b&&(K=K.concat(b(B)));for(var ne=p(j),ce=p(B),oe=0;oe<K.length;++oe){var ge=K[oe];if(!i[ge]&&!(G&&G[ge])&&!(ce&&ce[ge])&&!(ne&&ne[ge])){var te=w(B,ge);try{y(j,ge,te)}catch{}}}}return j}return m2=V,m2}wCe();var RCe=!0;function gZ(n,e,i){var a="";return i.split(" ").forEach(function(l){n[l]!==void 0?e.push(n[l]+";"):l&&(a+=l+" ")}),a}var hF=function(e,i,a){var l=e.key+"-"+i.name;(a===!1||RCe===!1)&&e.registered[l]===void 0&&(e.registered[l]=i.styles)},fF=function(e,i,a){hF(e,i,a);var l=e.key+"-"+i.name;if(e.inserted[i.name]===void 0){var d=i;do e.insert(i===d?"."+l:"",d,e.sheet,!0),d=d.next;while(d!==void 0)}};function CCe(n){for(var e=0,i,a=0,l=n.length;l>=4;++a,l-=4)i=n.charCodeAt(a)&255|(n.charCodeAt(++a)&255)<<8|(n.charCodeAt(++a)&255)<<16|(n.charCodeAt(++a)&255)<<24,i=(i&65535)*1540483477+((i>>>16)*59797<<16),i^=i>>>24,e=(i&65535)*1540483477+((i>>>16)*59797<<16)^(e&65535)*1540483477+((e>>>16)*59797<<16);switch(l){case 3:e^=(n.charCodeAt(a+2)&255)<<16;case 2:e^=(n.charCodeAt(a+1)&255)<<8;case 1:e^=n.charCodeAt(a)&255,e=(e&65535)*1540483477+((e>>>16)*59797<<16)}return e^=e>>>13,e=(e&65535)*1540483477+((e>>>16)*59797<<16),((e^e>>>15)>>>0).toString(36)}var ICe={animationIterationCount:1,aspectRatio:1,borderImageOutset:1,borderImageSlice:1,borderImageWidth:1,boxFlex:1,boxFlexGroup:1,boxOrdinalGroup:1,columnCount:1,columns:1,flex:1,flexGrow:1,flexPositive:1,flexShrink:1,flexNegative:1,flexOrder:1,gridRow:1,gridRowEnd:1,gridRowSpan:1,gridRowStart:1,gridColumn:1,gridColumnEnd:1,gridColumnSpan:1,gridColumnStart:1,msGridRow:1,msGridRowSpan:1,msGridColumn:1,msGridColumnSpan:1,fontWeight:1,lineHeight:1,opacity:1,order:1,orphans:1,scale:1,tabSize:1,widows:1,zIndex:1,zoom:1,WebkitLineClamp:1,fillOpacity:1,floodOpacity:1,stopOpacity:1,strokeDasharray:1,strokeDashoffset:1,strokeMiterlimit:1,strokeOpacity:1,strokeWidth:1},ACe=/[A-Z]|^ms/g,PCe=/_EMO_([^_]+?)_([^]*?)_EMO_/g,_Z=function(e){return e.charCodeAt(1)===45},AK=function(e){return e!=null&&typeof e!="boolean"},g2=pZ(function(n){return _Z(n)?n:n.replace(ACe,"-$&").toLowerCase()}),PK=function(e,i){switch(e){case"animation":case"animationName":if(typeof i=="string")return i.replace(PCe,function(a,l,d){return Fh={name:l,styles:d,next:Fh},l})}return ICe[e]!==1&&!_Z(e)&&typeof i=="number"&&i!==0?i+"px":i};function yR(n,e,i){if(i==null)return"";var a=i;if(a.__emotion_styles!==void 0)return a;switch(typeof i){case"boolean":return"";case"object":{var l=i;if(l.anim===1)return Fh={name:l.name,styles:l.styles,next:Fh},l.name;var d=i;if(d.styles!==void 0){var p=d.next;if(p!==void 0)for(;p!==void 0;)Fh={name:p.name,styles:p.styles,next:Fh},p=p.next;var y=d.styles+";";return y}return OCe(n,e,i)}case"function":{if(n!==void 0){var v=Fh,b=i(n);return Fh=v,yR(n,e,b)}break}}var w=i;if(e==null)return w;var A=e[w];return A!==void 0?A:w}function OCe(n,e,i){var a="";if(Array.isArray(i))for(var l=0;l<i.length;l++)a+=yR(n,e,i[l])+";";else for(var d in i){var p=i[d];if(typeof p!="object"){var y=p;e!=null&&e[y]!==void 0?a+=d+"{"+e[y]+"}":AK(y)&&(a+=g2(d)+":"+PK(d,y)+";")}else if(Array.isArray(p)&&typeof p[0]=="string"&&(e==null||e[p[0]]===void 0))for(var v=0;v<p.length;v++)AK(p[v])&&(a+=g2(d)+":"+PK(d,p[v])+";");else{var b=yR(n,e,p);switch(d){case"animation":case"animationName":{a+=g2(d)+":"+b+";";break}default:a+=d+"{"+b+"}"}}}return a}var OK=/label:\s*([^\s;{]+)\s*(;|$)/g,Fh;function E1(n,e,i){if(n.length===1&&typeof n[0]=="object"&&n[0]!==null&&n[0].styles!==void 0)return n[0];var a=!0,l="";Fh=void 0;var d=n[0];if(d==null||d.raw===void 0)a=!1,l+=yR(i,e,d);else{var p=d;l+=p[0]}for(var y=1;y<n.length;y++)if(l+=yR(i,e,n[y]),a){var v=d;l+=v[y]}OK.lastIndex=0;for(var b="",w;(w=OK.exec(l))!==null;)b+="-"+w[1];var A=CCe(l)+b;return{name:A,styles:l,next:Fh}}var kCe=function(e){return e()},yZ=G$.useInsertionEffect?G$.useInsertionEffect:!1,EZ=yZ||kCe,kK=yZ||D.useLayoutEffect,pF=D.createContext(typeof HTMLElement<"u"?SCe({key:"css"}):null);pF.Provider;var NCe=function(){return D.useContext(pF)},mF=function(e){return D.forwardRef(function(i,a){var l=D.useContext(pF);return e(i,l,a)})},o0=D.createContext({}),DCe=function(e,i){if(typeof i=="function"){var a=i(e);return a}return Oy({},e,i)},LCe=TK(function(n){return TK(function(e){return DCe(n,e)})}),xCe=function(e){var i=D.useContext(o0);return e.theme!==i&&(i=LCe(i)(e.theme)),D.createElement(o0.Provider,{value:i},e.children)},gF={}.hasOwnProperty,PU="__EMOTION_TYPE_PLEASE_DO_NOT_USE__",MCe=function(e,i){var a={};for(var l in i)gF.call(i,l)&&(a[l]=i[l]);return a[PU]=e,a},UCe=function(e){var i=e.cache,a=e.serialized,l=e.isStringTag;return hF(i,a,l),EZ(function(){return fF(i,a,l)}),null},VCe=mF(function(n,e,i){var a=n.css;typeof a=="string"&&e.registered[a]!==void 0&&(a=e.registered[a]);var l=n[PU],d=[a],p="";typeof n.className=="string"?p=gZ(e.registered,d,n.className):n.className!=null&&(p=n.className+" ");var y=E1(d,void 0,D.useContext(o0));p+=e.key+"-"+y.name;var v={};for(var b in n)gF.call(n,b)&&b!=="css"&&b!==PU&&(v[b]=n[b]);return v.className=p,i&&(v.ref=i),D.createElement(D.Fragment,null,D.createElement(UCe,{cache:e,serialized:y,isStringTag:typeof l=="string"}),D.createElement(l,v))}),FCe=VCe,NK=function(e,i){var a=arguments;if(i==null||!gF.call(i,"css"))return D.createElement.apply(void 0,a);var l=a.length,d=new Array(l);d[0]=FCe,d[1]=MCe(e,i);for(var p=2;p<l;p++)d[p]=a[p];return D.createElement.apply(null,d)};(function(n){var e;e||(e=n.JSX||(n.JSX={}))})(NK||(NK={}));var v1=mF(function(n,e){var i=n.styles,a=E1([i],void 0,D.useContext(o0)),l=D.useRef();return kK(function(){var d=e.key+"-global",p=new e.sheet.constructor({key:d,nonce:e.sheet.nonce,container:e.sheet.container,speedy:e.sheet.isSpeedy}),y=!1,v=document.querySelector('style[data-emotion="'+d+" "+a.name+'"]');return e.sheet.tags.length&&(p.before=e.sheet.tags[0]),v!==null&&(y=!0,v.setAttribute("data-emotion",d),p.hydrate([v])),l.current=[p,y],function(){p.flush()}},[e]),kK(function(){var d=l.current,p=d[0],y=d[1];if(y){d[1]=!1;return}if(a.next!==void 0&&fF(e,a.next,!0),p.tags.length){var v=p.tags[p.tags.length-1].nextElementSibling;p.before=v,p.flush()}e.insert("",a,p,!1)},[e,a.name]),null});function jCe(){for(var n=arguments.length,e=new Array(n),i=0;i<n;i++)e[i]=arguments[i];return E1(e)}function $R(){var n=jCe.apply(void 0,arguments),e="animation-"+n.name;return{name:e,styles:"@keyframes "+e+"{"+n.styles+"}",anim:1,toString:function(){return"_EMO_"+this.name+"_"+this.styles+"_EMO_"}}}const _F=D.createContext({});_F.displayName="ColorModeContext";function S1(){const n=D.useContext(_F);if(n===void 0)throw new Error("useColorMode must be used within a ColorModeProvider");return n}function BCe(n,e){const{colorMode:i}=S1();return i==="dark"?e:n}const mO={light:"chakra-ui-light",dark:"chakra-ui-dark"};function WCe(n={}){const{preventTransition:e=!0,nonce:i}=n,a={setDataset:l=>{const d=e?a.preventTransition():void 0;document.documentElement.dataset.theme=l,document.documentElement.style.colorScheme=l,d==null||d()},setClassName(l){document.body.classList.add(l?mO.dark:mO.light),document.body.classList.remove(l?mO.light:mO.dark)},query(){return window.matchMedia("(prefers-color-scheme: dark)")},getSystemTheme(l){return a.query().matches??l==="dark"?"dark":"light"},addListener(l){const d=a.query(),p=y=>{l(y.matches?"dark":"light")};return typeof d.addListener=="function"?d.addListener(p):d.addEventListener("change",p),()=>{typeof d.removeListener=="function"?d.removeListener(p):d.removeEventListener("change",p)}},preventTransition(){const l=document.createElement("style");return l.appendChild(document.createTextNode("*{-webkit-transition:none!important;-moz-transition:none!important;-o-transition:none!important;-ms-transition:none!important;transition:none!important}")),i!==void 0&&(l.nonce=i),document.head.appendChild(l),()=>{window.getComputedStyle(document.body),requestAnimationFrame(()=>{requestAnimationFrame(()=>{document.head.removeChild(l)})})}}};return a}const zCe="chakra-ui-color-mode";function GCe(n){return{ssr:!1,type:"localStorage",get(e){if(!(globalThis!=null&&globalThis.document))return e;let i;try{i=localStorage.getItem(n)||e}catch{}return i||e},set(e){try{localStorage.setItem(n,e)}catch{}}}}const HCe=GCe(zCe),DK=()=>{},$Ce=hye()?D.useLayoutEffect:D.useEffect;function LK(n,e){return n.type==="cookie"&&n.ssr?n.get(e):e}const vZ=function(e){const{value:i,children:a,options:{useSystemColorMode:l,initialColorMode:d,disableTransitionOnChange:p}={},colorModeManager:y=HCe}=e,v=NCe(),b=d==="dark"?"dark":"light",[w,A]=D.useState(()=>LK(y,b)),[N,V]=D.useState(()=>LK(y)),{getSystemTheme:j,setClassName:B,setDataset:G,addListener:ee}=D.useMemo(()=>WCe({preventTransition:p,nonce:v==null?void 0:v.nonce}),[p,v==null?void 0:v.nonce]),K=d==="system"&&!w?N:w,ne=D.useCallback(ge=>{const te=ge==="system"?j():ge;A(te),B(te==="dark"),G(te),y.set(te)},[y,j,B,G]);$Ce(()=>{d==="system"&&V(j())},[]),D.useEffect(()=>{const ge=y.get();if(ge){ne(ge);return}if(d==="system"){ne("system");return}ne(b)},[y,b,d,ne]);const ce=D.useCallback(()=>{ne(K==="dark"?"light":"dark")},[K,ne]);D.useEffect(()=>{if(l)return ee(ne)},[l,ee,ne]);const oe=D.useMemo(()=>({colorMode:i??K,toggleColorMode:i?DK:ce,setColorMode:i?DK:ne,forced:i!==void 0}),[K,ce,ne,i]);return C.jsx(_F.Provider,{value:oe,children:a})};vZ.displayName="ColorModeProvider";const SZ=String.raw,bZ=SZ`
  :root,
  :host {
    --chakra-vh: 100vh;
  }

  @supports (height: -webkit-fill-available) {
    :root,
    :host {
      --chakra-vh: -webkit-fill-available;
    }
  }

  @supports (height: -moz-fill-available) {
    :root,
    :host {
      --chakra-vh: -moz-fill-available;
    }
  }

  @supports (height: 100dvh) {
    :root,
    :host {
      --chakra-vh: 100dvh;
    }
  }
`,KCe=()=>C.jsx(v1,{styles:bZ}),qCe=({scope:n=""})=>C.jsx(v1,{styles:SZ`
      html {
        line-height: 1.5;
        -webkit-text-size-adjust: 100%;
        font-family: system-ui, sans-serif;
        -webkit-font-smoothing: antialiased;
        text-rendering: optimizeLegibility;
        -moz-osx-font-smoothing: grayscale;
        touch-action: manipulation;
      }

      body {
        position: relative;
        min-height: 100%;
        margin: 0;
        font-feature-settings: "kern";
      }

      ${n} :where(*, *::before, *::after) {
        border-width: 0;
        border-style: solid;
        box-sizing: border-box;
        word-wrap: break-word;
      }

      main {
        display: block;
      }

      ${n} hr {
        border-top-width: 1px;
        box-sizing: content-box;
        height: 0;
        overflow: visible;
      }

      ${n} :where(pre, code, kbd,samp) {
        font-family: SFMono-Regular, Menlo, Monaco, Consolas, monospace;
        font-size: 1em;
      }

      ${n} a {
        background-color: transparent;
        color: inherit;
        text-decoration: inherit;
      }

      ${n} abbr[title] {
        border-bottom: none;
        text-decoration: underline;
        -webkit-text-decoration: underline dotted;
        text-decoration: underline dotted;
      }

      ${n} :where(b, strong) {
        font-weight: bold;
      }

      ${n} small {
        font-size: 80%;
      }

      ${n} :where(sub,sup) {
        font-size: 75%;
        line-height: 0;
        position: relative;
        vertical-align: baseline;
      }

      ${n} sub {
        bottom: -0.25em;
      }

      ${n} sup {
        top: -0.5em;
      }

      ${n} img {
        border-style: none;
      }

      ${n} :where(button, input, optgroup, select, textarea) {
        font-family: inherit;
        font-size: 100%;
        line-height: 1.15;
        margin: 0;
      }

      ${n} :where(button, input) {
        overflow: visible;
      }

      ${n} :where(button, select) {
        text-transform: none;
      }

      ${n} :where(
          button::-moz-focus-inner,
          [type="button"]::-moz-focus-inner,
          [type="reset"]::-moz-focus-inner,
          [type="submit"]::-moz-focus-inner
        ) {
        border-style: none;
        padding: 0;
      }

      ${n} fieldset {
        padding: 0.35em 0.75em 0.625em;
      }

      ${n} legend {
        box-sizing: border-box;
        color: inherit;
        display: table;
        max-width: 100%;
        padding: 0;
        white-space: normal;
      }

      ${n} progress {
        vertical-align: baseline;
      }

      ${n} textarea {
        overflow: auto;
      }

      ${n} :where([type="checkbox"], [type="radio"]) {
        box-sizing: border-box;
        padding: 0;
      }

      ${n} input[type="number"]::-webkit-inner-spin-button,
      ${n} input[type="number"]::-webkit-outer-spin-button {
        -webkit-appearance: none !important;
      }

      ${n} input[type="number"] {
        -moz-appearance: textfield;
      }

      ${n} input[type="search"] {
        -webkit-appearance: textfield;
        outline-offset: -2px;
      }

      ${n} input[type="search"]::-webkit-search-decoration {
        -webkit-appearance: none !important;
      }

      ${n} ::-webkit-file-upload-button {
        -webkit-appearance: button;
        font: inherit;
      }

      ${n} details {
        display: block;
      }

      ${n} summary {
        display: list-item;
      }

      template {
        display: none;
      }

      [hidden] {
        display: none !important;
      }

      ${n} :where(
          blockquote,
          dl,
          dd,
          h1,
          h2,
          h3,
          h4,
          h5,
          h6,
          hr,
          figure,
          p,
          pre
        ) {
        margin: 0;
      }

      ${n} button {
        background: transparent;
        padding: 0;
      }

      ${n} fieldset {
        margin: 0;
        padding: 0;
      }

      ${n} :where(ol, ul) {
        margin: 0;
        padding: 0;
      }

      ${n} textarea {
        resize: vertical;
      }

      ${n} :where(button, [role="button"]) {
        cursor: pointer;
      }

      ${n} button::-moz-focus-inner {
        border: 0 !important;
      }

      ${n} table {
        border-collapse: collapse;
      }

      ${n} :where(h1, h2, h3, h4, h5, h6) {
        font-size: inherit;
        font-weight: inherit;
      }

      ${n} :where(button, input, optgroup, select, textarea) {
        padding: 0;
        line-height: inherit;
        color: inherit;
      }

      ${n} :where(img, svg, video, canvas, audio, iframe, embed, object) {
        display: block;
      }

      ${n} :where(img, video) {
        max-width: 100%;
        height: auto;
      }

      [data-js-focus-visible]
        :focus:not([data-focus-visible-added]):not(
          [data-focus-visible-disabled]
        ) {
        outline: none;
        box-shadow: none;
      }

      ${n} select::-ms-expand {
        display: none;
      }

      ${bZ}
    `});function YCe(n){const{cssVarsRoot:e,theme:i,children:a}=n,l=D.useMemo(()=>xve(i),[i]);return C.jsxs(xCe,{theme:l,children:[C.jsx(XCe,{root:e}),a]})}function XCe({root:n=":host, :root"}){const e=[n,"[data-theme]"].join(",");return C.jsx(v1,{styles:i=>({[e]:i.__cssVars})})}Ui({name:"StylesContext",errorMessage:"useStyles: `styles` is undefined. Seems you forgot to wrap the components in `<StylesProvider />` "});function JCe(){const{colorMode:n}=S1();return C.jsx(v1,{styles:e=>{const i=OQ(e,"styles.global"),a=Xc(i,{theme:e,colorMode:n});return a?KQ(a)(e):void 0}})}const[QCe,ZCe]=Ui({strict:!1,name:"PortalManagerContext"});function yF(n){const{children:e,zIndex:i}=n;return C.jsx(QCe,{value:{zIndex:i},children:e})}yF.displayName="PortalManager";const EF=D.createContext({getDocument(){return document},getWindow(){return window}});EF.displayName="EnvironmentContext";function eIe({defer:n}={}){const[,e]=D.useReducer(i=>i+1,0);return bp(()=>{n&&e()},[n]),D.useContext(EF)}function TZ(n){const{children:e,environment:i,disabled:a}=n,l=D.useRef(null),d=D.useMemo(()=>i||{getDocument:()=>{var y;return((y=l.current)==null?void 0:y.ownerDocument)??document},getWindow:()=>{var y;return((y=l.current)==null?void 0:y.ownerDocument.defaultView)??window}},[i]),p=!a||!i;return C.jsxs(EF.Provider,{value:d,children:[e,p&&C.jsx("span",{id:"__chakra_env",hidden:!0,ref:l})]})}TZ.displayName="EnvironmentProvider";const tIe=n=>{const{children:e,colorModeManager:i,portalZIndex:a,resetScope:l,resetCSS:d=!0,theme:p={},environment:y,cssVarsRoot:v,disableEnvironment:b,disableGlobalStyle:w}=n,A=C.jsx(TZ,{environment:y,disabled:b,children:e});return C.jsx(YCe,{theme:p,cssVarsRoot:v,children:C.jsxs(vZ,{colorModeManager:i,options:p.config,children:[d?C.jsx(qCe,{scope:l}):C.jsx(KCe,{}),!w&&C.jsx(JCe,{}),a?C.jsx(yF,{zIndex:a,children:A}):A]})})},vF=D.createContext({});function SF(n){const e=D.useRef(null);return e.current===null&&(e.current=n()),e.current}const KR=D.createContext(null),bF=D.createContext({transformPagePoint:n=>n,isStatic:!1,reducedMotion:"never"});class nIe extends D.Component{getSnapshotBeforeUpdate(e){const i=this.props.childRef.current;if(i&&e.isPresent&&!this.props.isPresent){const a=this.props.sizeRef.current;a.height=i.offsetHeight||0,a.width=i.offsetWidth||0,a.top=i.offsetTop,a.left=i.offsetLeft}return null}componentDidUpdate(){}render(){return this.props.children}}function rIe({children:n,isPresent:e}){const i=D.useId(),a=D.useRef(null),l=D.useRef({width:0,height:0,top:0,left:0}),{nonce:d}=D.useContext(bF);return D.useInsertionEffect(()=>{const{width:p,height:y,top:v,left:b}=l.current;if(e||!a.current||!p||!y)return;a.current.dataset.motionPopId=i;const w=document.createElement("style");return d&&(w.nonce=d),document.head.appendChild(w),w.sheet&&w.sheet.insertRule(`
          [data-motion-pop-id="${i}"] {
            position: absolute !important;
            width: ${p}px !important;
            height: ${y}px !important;
            top: ${v}px !important;
            left: ${b}px !important;
          }
        `),()=>{document.head.removeChild(w)}},[e]),C.jsx(nIe,{isPresent:e,childRef:a,sizeRef:l,children:D.cloneElement(n,{ref:a})})}const iIe=({children:n,initial:e,isPresent:i,onExitComplete:a,custom:l,presenceAffectsLayout:d,mode:p})=>{const y=SF(sIe),v=D.useId(),b=D.useCallback(A=>{y.set(A,!0);for(const N of y.values())if(!N)return;a&&a()},[y,a]),w=D.useMemo(()=>({id:v,initial:e,isPresent:i,custom:l,onExitComplete:b,register:A=>(y.set(A,!1),()=>y.delete(A))}),d?[Math.random(),b]:[i,b]);return D.useMemo(()=>{y.forEach((A,N)=>y.set(N,!1))},[i]),D.useEffect(()=>{!i&&!y.size&&a&&a()},[i]),p==="popLayout"&&(n=C.jsx(rIe,{isPresent:i,children:n})),C.jsx(KR.Provider,{value:w,children:n})};function sIe(){return new Map}function TF(n=!0){const e=D.useContext(KR);if(e===null)return[!0,null];const{isPresent:i,onExitComplete:a,register:l}=e,d=D.useId();D.useEffect(()=>{n&&l(d)},[n]);const p=D.useCallback(()=>n&&a&&a(d),[d,a,n]);return!i&&a?[!1,p]:[!0]}function oIe(){return aIe(D.useContext(KR))}function aIe(n){return n===null?!0:n.isPresent}const gO=n=>n.key||"";function xK(n){const e=[];return D.Children.forEach(n,i=>{D.isValidElement(i)&&e.push(i)}),e}const wF=typeof window<"u",wZ=wF?D.useLayoutEffect:D.useEffect,O0=({children:n,custom:e,initial:i=!0,onExitComplete:a,presenceAffectsLayout:l=!0,mode:d="sync",propagate:p=!1})=>{const[y,v]=TF(p),b=D.useMemo(()=>xK(n),[n]),w=p&&!y?[]:b.map(gO),A=D.useRef(!0),N=D.useRef(b),V=SF(()=>new Map),[j,B]=D.useState(b),[G,ee]=D.useState(b);wZ(()=>{A.current=!1,N.current=b;for(let ce=0;ce<G.length;ce++){const oe=gO(G[ce]);w.includes(oe)?V.delete(oe):V.get(oe)!==!0&&V.set(oe,!1)}},[G,w.length,w.join("-")]);const K=[];if(b!==j){let ce=[...b];for(let oe=0;oe<G.length;oe++){const ge=G[oe],te=gO(ge);w.includes(te)||(ce.splice(oe,0,ge),K.push(ge))}d==="wait"&&K.length&&(ce=K),ee(xK(ce)),B(b);return}const{forceRender:ne}=D.useContext(vF);return C.jsx(C.Fragment,{children:G.map(ce=>{const oe=gO(ce),ge=p&&!y?!1:b===G||w.includes(oe),te=()=>{if(V.has(oe))V.set(oe,!0);else return;let Z=!0;V.forEach(J=>{J||(Z=!1)}),Z&&(ne==null||ne(),ee(N.current),p&&(v==null||v()),a&&a())};return C.jsx(iIe,{isPresent:ge,initial:!A.current||i?void 0:!1,custom:ge?void 0:e,presenceAffectsLayout:l,mode:d,onExitComplete:ge?void 0:te,children:ce},oe)})})},Dl=n=>n;let RZ=Dl;function RF(n){let e;return()=>(e===void 0&&(e=n()),e)}const a0=(n,e,i)=>{const a=e-n;return a===0?1:(i-n)/a},wp=n=>n*1e3,Rp=n=>n/1e3,cIe={useManualTiming:!1};function lIe(n){let e=new Set,i=new Set,a=!1,l=!1;const d=new WeakSet;let p={delta:0,timestamp:0,isProcessing:!1};function y(b){d.has(b)&&(v.schedule(b),n()),b(p)}const v={schedule:(b,w=!1,A=!1)=>{const V=A&&a?e:i;return w&&d.add(b),V.has(b)||V.add(b),b},cancel:b=>{i.delete(b),d.delete(b)},process:b=>{if(p=b,a){l=!0;return}a=!0,[e,i]=[i,e],e.forEach(y),e.clear(),a=!1,l&&(l=!1,v.process(b))}};return v}const _O=["read","resolveKeyframes","update","preRender","render","postRender"],uIe=40;function CZ(n,e){let i=!1,a=!0;const l={delta:0,timestamp:0,isProcessing:!1},d=()=>i=!0,p=_O.reduce((ee,K)=>(ee[K]=lIe(d),ee),{}),{read:y,resolveKeyframes:v,update:b,preRender:w,render:A,postRender:N}=p,V=()=>{const ee=performance.now();i=!1,l.delta=a?1e3/60:Math.max(Math.min(ee-l.timestamp,uIe),1),l.timestamp=ee,l.isProcessing=!0,y.process(l),v.process(l),b.process(l),w.process(l),A.process(l),N.process(l),l.isProcessing=!1,i&&e&&(a=!1,n(V))},j=()=>{i=!0,a=!0,l.isProcessing||n(V)};return{schedule:_O.reduce((ee,K)=>{const ne=p[K];return ee[K]=(ce,oe=!1,ge=!1)=>(i||j(),ne.schedule(ce,oe,ge)),ee},{}),cancel:ee=>{for(let K=0;K<_O.length;K++)p[_O[K]].cancel(ee)},state:l,steps:p}}const{schedule:Xi,cancel:vg,state:Zo,steps:_2}=CZ(typeof requestAnimationFrame<"u"?requestAnimationFrame:Dl,!0),IZ=D.createContext({strict:!1}),MK={animation:["animate","variants","whileHover","whileTap","exit","whileInView","whileFocus","whileDrag"],exit:["exit"],drag:["drag","dragControls"],focus:["whileFocus"],hover:["whileHover","onHoverStart","onHoverEnd"],tap:["whileTap","onTap","onTapStart","onTapCancel"],pan:["onPan","onPanStart","onPanSessionStart","onPanEnd"],inView:["whileInView","onViewportEnter","onViewportLeave"],layout:["layout","layoutId"]},c0={};for(const n in MK)c0[n]={isEnabled:e=>MK[n].some(i=>!!e[i])};function dIe(n){for(const e in n)c0[e]={...c0[e],...n[e]}}const hIe=new Set(["animate","exit","variants","initial","style","values","variants","transition","transformTemplate","custom","inherit","onBeforeLayoutMeasure","onAnimationStart","onAnimationComplete","onUpdate","onDragStart","onDrag","onDragEnd","onMeasureDragConstraints","onDirectionLock","onDragTransitionEnd","_dragX","_dragY","onHoverStart","onHoverEnd","onViewportEnter","onViewportLeave","globalTapTarget","ignoreStrict","viewport"]);function Rk(n){return n.startsWith("while")||n.startsWith("drag")&&n!=="draggable"||n.startsWith("layout")||n.startsWith("onTap")||n.startsWith("onPan")||n.startsWith("onLayout")||hIe.has(n)}let AZ=n=>!Rk(n);function fIe(n){n&&(AZ=e=>e.startsWith("on")?!Rk(e):n(e))}try{fIe(require("@emotion/is-prop-valid").default)}catch{}function pIe(n,e,i){const a={};for(const l in n)l==="values"&&typeof n.values=="object"||(AZ(l)||i===!0&&Rk(l)||!e&&!Rk(l)||n.draggable&&l.startsWith("onDrag"))&&(a[l]=n[l]);return a}function mIe(n){if(typeof Proxy>"u")return n;const e=new Map,i=(...a)=>n(...a);return new Proxy(i,{get:(a,l)=>l==="create"?n:(e.has(l)||e.set(l,n(l)),e.get(l))})}const b1=D.createContext({});function ER(n){return typeof n=="string"||Array.isArray(n)}function T1(n){return n!==null&&typeof n=="object"&&typeof n.start=="function"}const CF=["animate","whileInView","whileFocus","whileHover","whileTap","whileDrag","exit"],IF=["initial",...CF];function w1(n){return T1(n.animate)||IF.some(e=>ER(n[e]))}function PZ(n){return!!(w1(n)||n.variants)}function gIe(n,e){if(w1(n)){const{initial:i,animate:a}=n;return{initial:i===!1||ER(i)?i:void 0,animate:ER(a)?a:void 0}}return n.inherit!==!1?e:{}}function _Ie(n){const{initial:e,animate:i}=gIe(n,D.useContext(b1));return D.useMemo(()=>({initial:e,animate:i}),[UK(e),UK(i)])}function UK(n){return Array.isArray(n)?n.join(" "):n}const yIe=Symbol.for("motionComponentSymbol");function DS(n){return n&&typeof n=="object"&&Object.prototype.hasOwnProperty.call(n,"current")}function EIe(n,e,i){return D.useCallback(a=>{a&&n.onMount&&n.onMount(a),e&&(a?e.mount(a):e.unmount()),i&&(typeof i=="function"?i(a):DS(i)&&(i.current=a))},[e])}const AF=n=>n.replace(/([a-z])([A-Z])/gu,"$1-$2").toLowerCase(),vIe="framerAppearId",OZ="data-"+AF(vIe),{schedule:PF}=CZ(queueMicrotask,!1),kZ=D.createContext({});function SIe(n,e,i,a,l){var d,p;const{visualElement:y}=D.useContext(b1),v=D.useContext(IZ),b=D.useContext(KR),w=D.useContext(bF).reducedMotion,A=D.useRef(null);a=a||v.renderer,!A.current&&a&&(A.current=a(n,{visualState:e,parent:y,props:i,presenceContext:b,blockInitialAnimation:b?b.initial===!1:!1,reducedMotionConfig:w}));const N=A.current,V=D.useContext(kZ);N&&!N.projection&&l&&(N.type==="html"||N.type==="svg")&&bIe(A.current,i,l,V);const j=D.useRef(!1);D.useInsertionEffect(()=>{N&&j.current&&N.update(i,b)});const B=i[OZ],G=D.useRef(!!B&&!(!((d=window.MotionHandoffIsComplete)===null||d===void 0)&&d.call(window,B))&&((p=window.MotionHasOptimisedAnimation)===null||p===void 0?void 0:p.call(window,B)));return wZ(()=>{N&&(j.current=!0,window.MotionIsMounted=!0,N.updateFeatures(),PF.render(N.render),G.current&&N.animationState&&N.animationState.animateChanges())}),D.useEffect(()=>{N&&(!G.current&&N.animationState&&N.animationState.animateChanges(),G.current&&(queueMicrotask(()=>{var ee;(ee=window.MotionHandoffMarkAsComplete)===null||ee===void 0||ee.call(window,B)}),G.current=!1))}),N}function bIe(n,e,i,a){const{layoutId:l,layout:d,drag:p,dragConstraints:y,layoutScroll:v,layoutRoot:b}=e;n.projection=new i(n.latestValues,e["data-framer-portal-id"]?void 0:NZ(n.parent)),n.projection.setOptions({layoutId:l,layout:d,alwaysMeasureLayout:!!p||y&&DS(y),visualElement:n,animationType:typeof d=="string"?d:"both",initialPromotionConfig:a,layoutScroll:v,layoutRoot:b})}function NZ(n){if(n)return n.options.allowProjection!==!1?n.projection:NZ(n.parent)}function TIe({preloadedFeatures:n,createVisualElement:e,useRender:i,useVisualState:a,Component:l}){var d,p;n&&dIe(n);function y(b,w){let A;const N={...D.useContext(bF),...b,layoutId:wIe(b)},{isStatic:V}=N,j=_Ie(b),B=a(b,V);if(!V&&wF){RIe();const G=CIe(N);A=G.MeasureLayout,j.visualElement=SIe(l,B,N,e,G.ProjectionNode)}return C.jsxs(b1.Provider,{value:j,children:[A&&j.visualElement?C.jsx(A,{visualElement:j.visualElement,...N}):null,i(l,b,EIe(B,j.visualElement,w),B,V,j.visualElement)]})}y.displayName=`motion.${typeof l=="string"?l:`create(${(p=(d=l.displayName)!==null&&d!==void 0?d:l.name)!==null&&p!==void 0?p:""})`}`;const v=D.forwardRef(y);return v[yIe]=l,v}function wIe({layoutId:n}){const e=D.useContext(vF).id;return e&&n!==void 0?e+"-"+n:n}function RIe(n,e){D.useContext(IZ).strict}function CIe(n){const{drag:e,layout:i}=c0;if(!e&&!i)return{};const a={...e,...i};return{MeasureLayout:e!=null&&e.isEnabled(n)||i!=null&&i.isEnabled(n)?a.MeasureLayout:void 0,ProjectionNode:a.ProjectionNode}}const IIe=["animate","circle","defs","desc","ellipse","g","image","line","filter","marker","mask","metadata","path","pattern","polygon","polyline","rect","stop","switch","symbol","svg","text","tspan","use","view"];function OF(n){return typeof n!="string"||n.includes("-")?!1:!!(IIe.indexOf(n)>-1||/[A-Z]/u.test(n))}function VK(n){const e=[{},{}];return n==null||n.values.forEach((i,a)=>{e[0][a]=i.get(),e[1][a]=i.getVelocity()}),e}function kF(n,e,i,a){if(typeof e=="function"){const[l,d]=VK(a);e=e(i!==void 0?i:n.custom,l,d)}if(typeof e=="string"&&(e=n.variants&&n.variants[e]),typeof e=="function"){const[l,d]=VK(a);e=e(i!==void 0?i:n.custom,l,d)}return e}const OU=n=>Array.isArray(n),AIe=n=>!!(n&&typeof n=="object"&&n.mix&&n.toValue),PIe=n=>OU(n)?n[n.length-1]||0:n,Va=n=>!!(n&&n.getVelocity);function QO(n){const e=Va(n)?n.get():n;return AIe(e)?e.toValue():e}function OIe({scrapeMotionValuesFromProps:n,createRenderState:e,onUpdate:i},a,l,d){const p={latestValues:kIe(a,l,d,n),renderState:e()};return i&&(p.onMount=y=>i({props:a,current:y,...p}),p.onUpdate=y=>i(y)),p}const DZ=n=>(e,i)=>{const a=D.useContext(b1),l=D.useContext(KR),d=()=>OIe(n,e,a,l);return i?d():SF(d)};function kIe(n,e,i,a){const l={},d=a(n,{});for(const N in d)l[N]=QO(d[N]);let{initial:p,animate:y}=n;const v=w1(n),b=PZ(n);e&&b&&!v&&n.inherit!==!1&&(p===void 0&&(p=e.initial),y===void 0&&(y=e.animate));let w=i?i.initial===!1:!1;w=w||p===!1;const A=w?y:p;if(A&&typeof A!="boolean"&&!T1(A)){const N=Array.isArray(A)?A:[A];for(let V=0;V<N.length;V++){const j=kF(n,N[V]);if(j){const{transitionEnd:B,transition:G,...ee}=j;for(const K in ee){let ne=ee[K];if(Array.isArray(ne)){const ce=w?ne.length-1:0;ne=ne[ce]}ne!==null&&(l[K]=ne)}for(const K in B)l[K]=B[K]}}}return l}const k0=["transformPerspective","x","y","z","translateX","translateY","translateZ","scale","scaleX","scaleY","rotate","rotateX","rotateY","rotateZ","skew","skewX","skewY"],zy=new Set(k0),LZ=n=>e=>typeof e=="string"&&e.startsWith(n),xZ=LZ("--"),NIe=LZ("var(--"),NF=n=>NIe(n)?DIe.test(n.split("/*")[0].trim()):!1,DIe=/var\(--(?:[\w-]+\s*|[\w-]+\s*,(?:\s*[^)(\s]|\s*\((?:[^)(]|\([^)(]*\))*\))+\s*)\)$/iu,MZ=(n,e)=>e&&typeof n=="number"?e.transform(n):n,Op=(n,e,i)=>i>e?e:i<n?n:i,N0={test:n=>typeof n=="number",parse:parseFloat,transform:n=>n},vR={...N0,transform:n=>Op(0,1,n)},yO={...N0,default:1},qR=n=>({test:e=>typeof e=="string"&&e.endsWith(n)&&e.split(" ").length===1,parse:parseFloat,transform:e=>`${e}${n}`}),Qm=qR("deg"),Yh=qR("%"),Nn=qR("px"),LIe=qR("vh"),xIe=qR("vw"),FK={...Yh,parse:n=>Yh.parse(n)/100,transform:n=>Yh.transform(n*100)},MIe={borderWidth:Nn,borderTopWidth:Nn,borderRightWidth:Nn,borderBottomWidth:Nn,borderLeftWidth:Nn,borderRadius:Nn,radius:Nn,borderTopLeftRadius:Nn,borderTopRightRadius:Nn,borderBottomRightRadius:Nn,borderBottomLeftRadius:Nn,width:Nn,maxWidth:Nn,height:Nn,maxHeight:Nn,top:Nn,right:Nn,bottom:Nn,left:Nn,padding:Nn,paddingTop:Nn,paddingRight:Nn,paddingBottom:Nn,paddingLeft:Nn,margin:Nn,marginTop:Nn,marginRight:Nn,marginBottom:Nn,marginLeft:Nn,backgroundPositionX:Nn,backgroundPositionY:Nn},UIe={rotate:Qm,rotateX:Qm,rotateY:Qm,rotateZ:Qm,scale:yO,scaleX:yO,scaleY:yO,scaleZ:yO,skew:Qm,skewX:Qm,skewY:Qm,distance:Nn,translateX:Nn,translateY:Nn,translateZ:Nn,x:Nn,y:Nn,z:Nn,perspective:Nn,transformPerspective:Nn,opacity:vR,originX:FK,originY:FK,originZ:Nn},jK={...N0,transform:Math.round},DF={...MIe,...UIe,zIndex:jK,size:Nn,fillOpacity:vR,strokeOpacity:vR,numOctaves:jK},VIe={x:"translateX",y:"translateY",z:"translateZ",transformPerspective:"perspective"},FIe=k0.length;function jIe(n,e,i){let a="",l=!0;for(let d=0;d<FIe;d++){const p=k0[d],y=n[p];if(y===void 0)continue;let v=!0;if(typeof y=="number"?v=y===(p.startsWith("scale")?1:0):v=parseFloat(y)===0,!v||i){const b=MZ(y,DF[p]);if(!v){l=!1;const w=VIe[p]||p;a+=`${w}(${b}) `}i&&(e[p]=b)}}return a=a.trim(),i?a=i(e,l?"":a):l&&(a="none"),a}function LF(n,e,i){const{style:a,vars:l,transformOrigin:d}=n;let p=!1,y=!1;for(const v in e){const b=e[v];if(zy.has(v)){p=!0;continue}else if(xZ(v)){l[v]=b;continue}else{const w=MZ(b,DF[v]);v.startsWith("origin")?(y=!0,d[v]=w):a[v]=w}}if(e.transform||(p||i?a.transform=jIe(e,n.transform,i):a.transform&&(a.transform="none")),y){const{originX:v="50%",originY:b="50%",originZ:w=0}=d;a.transformOrigin=`${v} ${b} ${w}`}}const BIe={offset:"stroke-dashoffset",array:"stroke-dasharray"},WIe={offset:"strokeDashoffset",array:"strokeDasharray"};function zIe(n,e,i=1,a=0,l=!0){n.pathLength=1;const d=l?BIe:WIe;n[d.offset]=Nn.transform(-a);const p=Nn.transform(e),y=Nn.transform(i);n[d.array]=`${p} ${y}`}function BK(n,e,i){return typeof n=="string"?n:Nn.transform(e+i*n)}function GIe(n,e,i){const a=BK(e,n.x,n.width),l=BK(i,n.y,n.height);return`${a} ${l}`}function xF(n,{attrX:e,attrY:i,attrScale:a,originX:l,originY:d,pathLength:p,pathSpacing:y=1,pathOffset:v=0,...b},w,A){if(LF(n,b,A),w){n.style.viewBox&&(n.attrs.viewBox=n.style.viewBox);return}n.attrs=n.style,n.style={};const{attrs:N,style:V,dimensions:j}=n;N.transform&&(j&&(V.transform=N.transform),delete N.transform),j&&(l!==void 0||d!==void 0||V.transform)&&(V.transformOrigin=GIe(j,l!==void 0?l:.5,d!==void 0?d:.5)),e!==void 0&&(N.x=e),i!==void 0&&(N.y=i),a!==void 0&&(N.scale=a),p!==void 0&&zIe(N,p,y,v,!1)}const MF=()=>({style:{},transform:{},transformOrigin:{},vars:{}}),UZ=()=>({...MF(),attrs:{}}),UF=n=>typeof n=="string"&&n.toLowerCase()==="svg";function VZ(n,{style:e,vars:i},a,l){Object.assign(n.style,e,l&&l.getProjectionStyles(a));for(const d in i)n.style.setProperty(d,i[d])}const FZ=new Set(["baseFrequency","diffuseConstant","kernelMatrix","kernelUnitLength","keySplines","keyTimes","limitingConeAngle","markerHeight","markerWidth","numOctaves","targetX","targetY","surfaceScale","specularConstant","specularExponent","stdDeviation","tableValues","viewBox","gradientTransform","pathLength","startOffset","textLength","lengthAdjust"]);function jZ(n,e,i,a){VZ(n,e,void 0,a);for(const l in e.attrs)n.setAttribute(FZ.has(l)?l:AF(l),e.attrs[l])}const Ck={};function HIe(n){Object.assign(Ck,n)}function BZ(n,{layout:e,layoutId:i}){return zy.has(n)||n.startsWith("origin")||(e||i!==void 0)&&(!!Ck[n]||n==="opacity")}function VF(n,e,i){var a;const{style:l}=n,d={};for(const p in l)(Va(l[p])||e.style&&Va(e.style[p])||BZ(p,n)||((a=i==null?void 0:i.getValue(p))===null||a===void 0?void 0:a.liveStyle)!==void 0)&&(d[p]=l[p]);return d}function WZ(n,e,i){const a=VF(n,e,i);for(const l in n)if(Va(n[l])||Va(e[l])){const d=k0.indexOf(l)!==-1?"attr"+l.charAt(0).toUpperCase()+l.substring(1):l;a[d]=n[l]}return a}function $Ie(n,e){try{e.dimensions=typeof n.getBBox=="function"?n.getBBox():n.getBoundingClientRect()}catch{e.dimensions={x:0,y:0,width:0,height:0}}}const WK=["x","y","width","height","cx","cy","r"],KIe={useVisualState:DZ({scrapeMotionValuesFromProps:WZ,createRenderState:UZ,onUpdate:({props:n,prevProps:e,current:i,renderState:a,latestValues:l})=>{if(!i)return;let d=!!n.drag;if(!d){for(const y in l)if(zy.has(y)){d=!0;break}}if(!d)return;let p=!e;if(e)for(let y=0;y<WK.length;y++){const v=WK[y];n[v]!==e[v]&&(p=!0)}p&&Xi.read(()=>{$Ie(i,a),Xi.render(()=>{xF(a,l,UF(i.tagName),n.transformTemplate),jZ(i,a)})})}})},qIe={useVisualState:DZ({scrapeMotionValuesFromProps:VF,createRenderState:MF})};function zZ(n,e,i){for(const a in e)!Va(e[a])&&!BZ(a,i)&&(n[a]=e[a])}function YIe({transformTemplate:n},e){return D.useMemo(()=>{const i=MF();return LF(i,e,n),Object.assign({},i.vars,i.style)},[e])}function XIe(n,e){const i=n.style||{},a={};return zZ(a,i,n),Object.assign(a,YIe(n,e)),a}function JIe(n,e){const i={},a=XIe(n,e);return n.drag&&n.dragListener!==!1&&(i.draggable=!1,a.userSelect=a.WebkitUserSelect=a.WebkitTouchCallout="none",a.touchAction=n.drag===!0?"none":`pan-${n.drag==="x"?"y":"x"}`),n.tabIndex===void 0&&(n.onTap||n.onTapStart||n.whileTap)&&(i.tabIndex=0),i.style=a,i}function QIe(n,e,i,a){const l=D.useMemo(()=>{const d=UZ();return xF(d,e,UF(a),n.transformTemplate),{...d.attrs,style:{...d.style}}},[e]);if(n.style){const d={};zZ(d,n.style,n),l.style={...d,...l.style}}return l}function ZIe(n=!1){return(i,a,l,{latestValues:d},p)=>{const v=(OF(i)?QIe:JIe)(a,d,p,i),b=pIe(a,typeof i=="string",n),w=i!==D.Fragment?{...b,...v,ref:l}:{},{children:A}=a,N=D.useMemo(()=>Va(A)?A.get():A,[A]);return D.createElement(i,{...w,children:N})}}function eAe(n,e){return function(a,{forwardMotionProps:l}={forwardMotionProps:!1}){const p={...OF(a)?KIe:qIe,preloadedFeatures:n,useRender:ZIe(l),createVisualElement:e,Component:a};return TIe(p)}}function GZ(n,e){if(!Array.isArray(e))return!1;const i=e.length;if(i!==n.length)return!1;for(let a=0;a<i;a++)if(e[a]!==n[a])return!1;return!0}function R1(n,e,i){const a=n.getProps();return kF(a,e,i!==void 0?i:a.custom,n)}const tAe=RF(()=>window.ScrollTimeline!==void 0);class nAe{constructor(e){this.stop=()=>this.runAll("stop"),this.animations=e.filter(Boolean)}get finished(){return Promise.all(this.animations.map(e=>"finished"in e?e.finished:e))}getAll(e){return this.animations[0][e]}setAll(e,i){for(let a=0;a<this.animations.length;a++)this.animations[a][e]=i}attachTimeline(e,i){const a=this.animations.map(l=>{if(tAe()&&l.attachTimeline)return l.attachTimeline(e);if(typeof i=="function")return i(l)});return()=>{a.forEach((l,d)=>{l&&l(),this.animations[d].stop()})}}get time(){return this.getAll("time")}set time(e){this.setAll("time",e)}get speed(){return this.getAll("speed")}set speed(e){this.setAll("speed",e)}get startTime(){return this.getAll("startTime")}get duration(){let e=0;for(let i=0;i<this.animations.length;i++)e=Math.max(e,this.animations[i].duration);return e}runAll(e){this.animations.forEach(i=>i[e]())}flatten(){this.runAll("flatten")}play(){this.runAll("play")}pause(){this.runAll("pause")}cancel(){this.runAll("cancel")}complete(){this.runAll("complete")}}class rAe extends nAe{then(e,i){return Promise.all(this.animations).then(e).catch(i)}}function FF(n,e){return n?n[e]||n.default||n:void 0}const kU=2e4;function HZ(n){let e=0;const i=50;let a=n.next(e);for(;!a.done&&e<kU;)e+=i,a=n.next(e);return e>=kU?1/0:e}function jF(n){return typeof n=="function"}function zK(n,e){n.timeline=e,n.onfinish=null}const BF=n=>Array.isArray(n)&&typeof n[0]=="number",iAe={linearEasing:void 0};function sAe(n,e){const i=RF(n);return()=>{var a;return(a=iAe[e])!==null&&a!==void 0?a:i()}}const Ik=sAe(()=>{try{document.createElement("div").animate({opacity:0},{easing:"linear(0, 1)"})}catch{return!1}return!0},"linearEasing"),$Z=(n,e,i=10)=>{let a="";const l=Math.max(Math.round(e/i),2);for(let d=0;d<l;d++)a+=n(a0(0,l-1,d))+", ";return`linear(${a.substring(0,a.length-2)})`};function KZ(n){return!!(typeof n=="function"&&Ik()||!n||typeof n=="string"&&(n in NU||Ik())||BF(n)||Array.isArray(n)&&n.every(KZ))}const Nw=([n,e,i,a])=>`cubic-bezier(${n}, ${e}, ${i}, ${a})`,NU={linear:"linear",ease:"ease",easeIn:"ease-in",easeOut:"ease-out",easeInOut:"ease-in-out",circIn:Nw([0,.65,.55,1]),circOut:Nw([.55,0,1,.45]),backIn:Nw([.31,.01,.66,-.59]),backOut:Nw([.33,1.53,.69,.99])};function qZ(n,e){if(n)return typeof n=="function"&&Ik()?$Z(n,e):BF(n)?Nw(n):Array.isArray(n)?n.map(i=>qZ(i,e)||NU.easeOut):NU[n]}const Id={x:!1,y:!1};function YZ(){return Id.x||Id.y}function oAe(n,e,i){var a;if(n instanceof Element)return[n];if(typeof n=="string"){let l=document;const d=(a=void 0)!==null&&a!==void 0?a:l.querySelectorAll(n);return d?Array.from(d):[]}return Array.from(n)}function XZ(n,e){const i=oAe(n),a=new AbortController,l={passive:!0,...e,signal:a.signal};return[i,l,()=>a.abort()]}function GK(n){return e=>{e.pointerType==="touch"||YZ()||n(e)}}function aAe(n,e,i={}){const[a,l,d]=XZ(n,i),p=GK(y=>{const{target:v}=y,b=e(y);if(typeof b!="function"||!v)return;const w=GK(A=>{b(A),v.removeEventListener("pointerleave",w)});v.addEventListener("pointerleave",w,l)});return a.forEach(y=>{y.addEventListener("pointerenter",p,l)}),d}const JZ=(n,e)=>e?n===e?!0:JZ(n,e.parentElement):!1,WF=n=>n.pointerType==="mouse"?typeof n.button!="number"||n.button<=0:n.isPrimary!==!1,cAe=new Set(["BUTTON","INPUT","SELECT","TEXTAREA","A"]);function lAe(n){return cAe.has(n.tagName)||n.tabIndex!==-1}const Dw=new WeakSet;function HK(n){return e=>{e.key==="Enter"&&n(e)}}function y2(n,e){n.dispatchEvent(new PointerEvent("pointer"+e,{isPrimary:!0,bubbles:!0}))}const uAe=(n,e)=>{const i=n.currentTarget;if(!i)return;const a=HK(()=>{if(Dw.has(i))return;y2(i,"down");const l=HK(()=>{y2(i,"up")}),d=()=>y2(i,"cancel");i.addEventListener("keyup",l,e),i.addEventListener("blur",d,e)});i.addEventListener("keydown",a,e),i.addEventListener("blur",()=>i.removeEventListener("keydown",a),e)};function $K(n){return WF(n)&&!YZ()}function dAe(n,e,i={}){const[a,l,d]=XZ(n,i),p=y=>{const v=y.currentTarget;if(!$K(y)||Dw.has(v))return;Dw.add(v);const b=e(y),w=(V,j)=>{window.removeEventListener("pointerup",A),window.removeEventListener("pointercancel",N),!(!$K(V)||!Dw.has(v))&&(Dw.delete(v),typeof b=="function"&&b(V,{success:j}))},A=V=>{w(V,i.useGlobalTarget||JZ(v,V.target))},N=V=>{w(V,!1)};window.addEventListener("pointerup",A,l),window.addEventListener("pointercancel",N,l)};return a.forEach(y=>{!lAe(y)&&y.getAttribute("tabindex")===null&&(y.tabIndex=0),(i.useGlobalTarget?window:y).addEventListener("pointerdown",p,l),y.addEventListener("focus",b=>uAe(b,l),l)}),d}function hAe(n){return n==="x"||n==="y"?Id[n]?null:(Id[n]=!0,()=>{Id[n]=!1}):Id.x||Id.y?null:(Id.x=Id.y=!0,()=>{Id.x=Id.y=!1})}const QZ=new Set(["width","height","top","left","right","bottom",...k0]);let ZO;function fAe(){ZO=void 0}const Xh={now:()=>(ZO===void 0&&Xh.set(Zo.isProcessing||cIe.useManualTiming?Zo.timestamp:performance.now()),ZO),set:n=>{ZO=n,queueMicrotask(fAe)}};function zF(n,e){n.indexOf(e)===-1&&n.push(e)}function GF(n,e){const i=n.indexOf(e);i>-1&&n.splice(i,1)}class HF{constructor(){this.subscriptions=[]}add(e){return zF(this.subscriptions,e),()=>GF(this.subscriptions,e)}notify(e,i,a){const l=this.subscriptions.length;if(l)if(l===1)this.subscriptions[0](e,i,a);else for(let d=0;d<l;d++){const p=this.subscriptions[d];p&&p(e,i,a)}}getSize(){return this.subscriptions.length}clear(){this.subscriptions.length=0}}function ZZ(n,e){return e?n*(1e3/e):0}const KK=30,pAe=n=>!isNaN(parseFloat(n));class mAe{constructor(e,i={}){this.version="11.18.2",this.canTrackVelocity=null,this.events={},this.updateAndNotify=(a,l=!0)=>{const d=Xh.now();this.updatedAt!==d&&this.setPrevFrameValue(),this.prev=this.current,this.setCurrent(a),this.current!==this.prev&&this.events.change&&this.events.change.notify(this.current),l&&this.events.renderRequest&&this.events.renderRequest.notify(this.current)},this.hasAnimated=!1,this.setCurrent(e),this.owner=i.owner}setCurrent(e){this.current=e,this.updatedAt=Xh.now(),this.canTrackVelocity===null&&e!==void 0&&(this.canTrackVelocity=pAe(this.current))}setPrevFrameValue(e=this.current){this.prevFrameValue=e,this.prevUpdatedAt=this.updatedAt}onChange(e){return this.on("change",e)}on(e,i){this.events[e]||(this.events[e]=new HF);const a=this.events[e].add(i);return e==="change"?()=>{a(),Xi.read(()=>{this.events.change.getSize()||this.stop()})}:a}clearListeners(){for(const e in this.events)this.events[e].clear()}attach(e,i){this.passiveEffect=e,this.stopPassiveEffect=i}set(e,i=!0){!i||!this.passiveEffect?this.updateAndNotify(e,i):this.passiveEffect(e,this.updateAndNotify)}setWithVelocity(e,i,a){this.set(i),this.prev=void 0,this.prevFrameValue=e,this.prevUpdatedAt=this.updatedAt-a}jump(e,i=!0){this.updateAndNotify(e),this.prev=e,this.prevUpdatedAt=this.prevFrameValue=void 0,i&&this.stop(),this.stopPassiveEffect&&this.stopPassiveEffect()}get(){return this.current}getPrevious(){return this.prev}getVelocity(){const e=Xh.now();if(!this.canTrackVelocity||this.prevFrameValue===void 0||e-this.updatedAt>KK)return 0;const i=Math.min(this.updatedAt-this.prevUpdatedAt,KK);return ZZ(parseFloat(this.current)-parseFloat(this.prevFrameValue),i)}start(e){return this.stop(),new Promise(i=>{this.hasAnimated=!0,this.animation=e(i),this.events.animationStart&&this.events.animationStart.notify()}).then(()=>{this.events.animationComplete&&this.events.animationComplete.notify(),this.clearAnimation()})}stop(){this.animation&&(this.animation.stop(),this.events.animationCancel&&this.events.animationCancel.notify()),this.clearAnimation()}isAnimating(){return!!this.animation}clearAnimation(){delete this.animation}destroy(){this.clearListeners(),this.stop(),this.stopPassiveEffect&&this.stopPassiveEffect()}}function SR(n,e){return new mAe(n,e)}function gAe(n,e,i){n.hasValue(e)?n.getValue(e).set(i):n.addValue(e,SR(i))}function _Ae(n,e){const i=R1(n,e);let{transitionEnd:a={},transition:l={},...d}=i||{};d={...d,...a};for(const p in d){const y=PIe(d[p]);gAe(n,p,y)}}function yAe(n){return!!(Va(n)&&n.add)}function DU(n,e){const i=n.getValue("willChange");if(yAe(i))return i.add(e)}function eee(n){return n.props[OZ]}const tee=(n,e,i)=>(((1-3*i+3*e)*n+(3*i-6*e))*n+3*e)*n,EAe=1e-7,vAe=12;function SAe(n,e,i,a,l){let d,p,y=0;do p=e+(i-e)/2,d=tee(p,a,l)-n,d>0?i=p:e=p;while(Math.abs(d)>EAe&&++y<vAe);return p}function YR(n,e,i,a){if(n===e&&i===a)return Dl;const l=d=>SAe(d,0,1,n,i);return d=>d===0||d===1?d:tee(l(d),e,a)}const nee=n=>e=>e<=.5?n(2*e)/2:(2-n(2*(1-e)))/2,ree=n=>e=>1-n(1-e),iee=YR(.33,1.53,.69,.99),$F=ree(iee),see=nee($F),oee=n=>(n*=2)<1?.5*$F(n):.5*(2-Math.pow(2,-10*(n-1))),KF=n=>1-Math.sin(Math.acos(n)),aee=ree(KF),cee=nee(KF),lee=n=>/^0[^.\s]+$/u.test(n);function bAe(n){return typeof n=="number"?n===0:n!==null?n==="none"||n==="0"||lee(n):!0}const Xw=n=>Math.round(n*1e5)/1e5,qF=/-?(?:\d+(?:\.\d+)?|\.\d+)/gu;function TAe(n){return n==null}const wAe=/^(?:#[\da-f]{3,8}|(?:rgb|hsl)a?\((?:-?[\d.]+%?[,\s]+){2}-?[\d.]+%?\s*(?:[,/]\s*)?(?:\b\d+(?:\.\d+)?|\.\d+)?%?\))$/iu,YF=(n,e)=>i=>!!(typeof i=="string"&&wAe.test(i)&&i.startsWith(n)||e&&!TAe(i)&&Object.prototype.hasOwnProperty.call(i,e)),uee=(n,e,i)=>a=>{if(typeof a!="string")return a;const[l,d,p,y]=a.match(qF);return{[n]:parseFloat(l),[e]:parseFloat(d),[i]:parseFloat(p),alpha:y!==void 0?parseFloat(y):1}},RAe=n=>Op(0,255,n),E2={...N0,transform:n=>Math.round(RAe(n))},_y={test:YF("rgb","red"),parse:uee("red","green","blue"),transform:({red:n,green:e,blue:i,alpha:a=1})=>"rgba("+E2.transform(n)+", "+E2.transform(e)+", "+E2.transform(i)+", "+Xw(vR.transform(a))+")"};function CAe(n){let e="",i="",a="",l="";return n.length>5?(e=n.substring(1,3),i=n.substring(3,5),a=n.substring(5,7),l=n.substring(7,9)):(e=n.substring(1,2),i=n.substring(2,3),a=n.substring(3,4),l=n.substring(4,5),e+=e,i+=i,a+=a,l+=l),{red:parseInt(e,16),green:parseInt(i,16),blue:parseInt(a,16),alpha:l?parseInt(l,16)/255:1}}const LU={test:YF("#"),parse:CAe,transform:_y.transform},LS={test:YF("hsl","hue"),parse:uee("hue","saturation","lightness"),transform:({hue:n,saturation:e,lightness:i,alpha:a=1})=>"hsla("+Math.round(n)+", "+Yh.transform(Xw(e))+", "+Yh.transform(Xw(i))+", "+Xw(vR.transform(a))+")"},La={test:n=>_y.test(n)||LU.test(n)||LS.test(n),parse:n=>_y.test(n)?_y.parse(n):LS.test(n)?LS.parse(n):LU.parse(n),transform:n=>typeof n=="string"?n:n.hasOwnProperty("red")?_y.transform(n):LS.transform(n)},IAe=/(?:#[\da-f]{3,8}|(?:rgb|hsl)a?\((?:-?[\d.]+%?[,\s]+){2}-?[\d.]+%?\s*(?:[,/]\s*)?(?:\b\d+(?:\.\d+)?|\.\d+)?%?\))/giu;function AAe(n){var e,i;return isNaN(n)&&typeof n=="string"&&(((e=n.match(qF))===null||e===void 0?void 0:e.length)||0)+(((i=n.match(IAe))===null||i===void 0?void 0:i.length)||0)>0}const dee="number",hee="color",PAe="var",OAe="var(",qK="${}",kAe=/var\s*\(\s*--(?:[\w-]+\s*|[\w-]+\s*,(?:\s*[^)(\s]|\s*\((?:[^)(]|\([^)(]*\))*\))+\s*)\)|#[\da-f]{3,8}|(?:rgb|hsl)a?\((?:-?[\d.]+%?[,\s]+){2}-?[\d.]+%?\s*(?:[,/]\s*)?(?:\b\d+(?:\.\d+)?|\.\d+)?%?\)|-?(?:\d+(?:\.\d+)?|\.\d+)/giu;function bR(n){const e=n.toString(),i=[],a={color:[],number:[],var:[]},l=[];let d=0;const y=e.replace(kAe,v=>(La.test(v)?(a.color.push(d),l.push(hee),i.push(La.parse(v))):v.startsWith(OAe)?(a.var.push(d),l.push(PAe),i.push(v)):(a.number.push(d),l.push(dee),i.push(parseFloat(v))),++d,qK)).split(qK);return{values:i,split:y,indexes:a,types:l}}function fee(n){return bR(n).values}function pee(n){const{split:e,types:i}=bR(n),a=e.length;return l=>{let d="";for(let p=0;p<a;p++)if(d+=e[p],l[p]!==void 0){const y=i[p];y===dee?d+=Xw(l[p]):y===hee?d+=La.transform(l[p]):d+=l[p]}return d}}const NAe=n=>typeof n=="number"?0:n;function DAe(n){const e=fee(n);return pee(n)(e.map(NAe))}const Sg={test:AAe,parse:fee,createTransformer:pee,getAnimatableNone:DAe},LAe=new Set(["brightness","contrast","saturate","opacity"]);function xAe(n){const[e,i]=n.slice(0,-1).split("(");if(e==="drop-shadow")return n;const[a]=i.match(qF)||[];if(!a)return n;const l=i.replace(a,"");let d=LAe.has(e)?1:0;return a!==i&&(d*=100),e+"("+d+l+")"}const MAe=/\b([a-z-]*)\(.*?\)/gu,xU={...Sg,getAnimatableNone:n=>{const e=n.match(MAe);return e?e.map(xAe).join(" "):n}},UAe={...DF,color:La,backgroundColor:La,outlineColor:La,fill:La,stroke:La,borderColor:La,borderTopColor:La,borderRightColor:La,borderBottomColor:La,borderLeftColor:La,filter:xU,WebkitFilter:xU},XF=n=>UAe[n];function mee(n,e){let i=XF(n);return i!==xU&&(i=Sg),i.getAnimatableNone?i.getAnimatableNone(e):void 0}const VAe=new Set(["auto","none","0"]);function FAe(n,e,i){let a=0,l;for(;a<n.length&&!l;){const d=n[a];typeof d=="string"&&!VAe.has(d)&&bR(d).values.length&&(l=n[a]),a++}if(l&&i)for(const d of e)n[d]=mee(i,l)}const YK=n=>n===N0||n===Nn,XK=(n,e)=>parseFloat(n.split(", ")[e]),JK=(n,e)=>(i,{transform:a})=>{if(a==="none"||!a)return 0;const l=a.match(/^matrix3d\((.+)\)$/u);if(l)return XK(l[1],e);{const d=a.match(/^matrix\((.+)\)$/u);return d?XK(d[1],n):0}},jAe=new Set(["x","y","z"]),BAe=k0.filter(n=>!jAe.has(n));function WAe(n){const e=[];return BAe.forEach(i=>{const a=n.getValue(i);a!==void 0&&(e.push([i,a.get()]),a.set(i.startsWith("scale")?1:0))}),e}const l0={width:({x:n},{paddingLeft:e="0",paddingRight:i="0"})=>n.max-n.min-parseFloat(e)-parseFloat(i),height:({y:n},{paddingTop:e="0",paddingBottom:i="0"})=>n.max-n.min-parseFloat(e)-parseFloat(i),top:(n,{top:e})=>parseFloat(e),left:(n,{left:e})=>parseFloat(e),bottom:({y:n},{top:e})=>parseFloat(e)+(n.max-n.min),right:({x:n},{left:e})=>parseFloat(e)+(n.max-n.min),x:JK(4,13),y:JK(5,14)};l0.translateX=l0.x;l0.translateY=l0.y;const Ty=new Set;let MU=!1,UU=!1;function gee(){if(UU){const n=Array.from(Ty).filter(a=>a.needsMeasurement),e=new Set(n.map(a=>a.element)),i=new Map;e.forEach(a=>{const l=WAe(a);l.length&&(i.set(a,l),a.render())}),n.forEach(a=>a.measureInitialState()),e.forEach(a=>{a.render();const l=i.get(a);l&&l.forEach(([d,p])=>{var y;(y=a.getValue(d))===null||y===void 0||y.set(p)})}),n.forEach(a=>a.measureEndState()),n.forEach(a=>{a.suspendedScrollY!==void 0&&window.scrollTo(0,a.suspendedScrollY)})}UU=!1,MU=!1,Ty.forEach(n=>n.complete()),Ty.clear()}function _ee(){Ty.forEach(n=>{n.readKeyframes(),n.needsMeasurement&&(UU=!0)})}function zAe(){_ee(),gee()}class JF{constructor(e,i,a,l,d,p=!1){this.isComplete=!1,this.isAsync=!1,this.needsMeasurement=!1,this.isScheduled=!1,this.unresolvedKeyframes=[...e],this.onComplete=i,this.name=a,this.motionValue=l,this.element=d,this.isAsync=p}scheduleResolve(){this.isScheduled=!0,this.isAsync?(Ty.add(this),MU||(MU=!0,Xi.read(_ee),Xi.resolveKeyframes(gee))):(this.readKeyframes(),this.complete())}readKeyframes(){const{unresolvedKeyframes:e,name:i,element:a,motionValue:l}=this;for(let d=0;d<e.length;d++)if(e[d]===null)if(d===0){const p=l==null?void 0:l.get(),y=e[e.length-1];if(p!==void 0)e[0]=p;else if(a&&i){const v=a.readValue(i,y);v!=null&&(e[0]=v)}e[0]===void 0&&(e[0]=y),l&&p===void 0&&l.set(e[0])}else e[d]=e[d-1]}setFinalKeyframe(){}measureInitialState(){}renderEndStyles(){}measureEndState(){}complete(){this.isComplete=!0,this.onComplete(this.unresolvedKeyframes,this.finalKeyframe),Ty.delete(this)}cancel(){this.isComplete||(this.isScheduled=!1,Ty.delete(this))}resume(){this.isComplete||this.scheduleResolve()}}const yee=n=>/^-?(?:\d+(?:\.\d+)?|\.\d+)$/u.test(n),GAe=/^var\(--(?:([\w-]+)|([\w-]+), ?([a-zA-Z\d ()%#.,-]+))\)/u;function HAe(n){const e=GAe.exec(n);if(!e)return[,];const[,i,a,l]=e;return[`--${i??a}`,l]}function Eee(n,e,i=1){const[a,l]=HAe(n);if(!a)return;const d=window.getComputedStyle(e).getPropertyValue(a);if(d){const p=d.trim();return yee(p)?parseFloat(p):p}return NF(l)?Eee(l,e,i+1):l}const vee=n=>e=>e.test(n),$Ae={test:n=>n==="auto",parse:n=>n},See=[N0,Nn,Yh,Qm,xIe,LIe,$Ae],QK=n=>See.find(vee(n));class bee extends JF{constructor(e,i,a,l,d){super(e,i,a,l,d,!0)}readKeyframes(){const{unresolvedKeyframes:e,element:i,name:a}=this;if(!i||!i.current)return;super.readKeyframes();for(let v=0;v<e.length;v++){let b=e[v];if(typeof b=="string"&&(b=b.trim(),NF(b))){const w=Eee(b,i.current);w!==void 0&&(e[v]=w),v===e.length-1&&(this.finalKeyframe=b)}}if(this.resolveNoneKeyframes(),!QZ.has(a)||e.length!==2)return;const[l,d]=e,p=QK(l),y=QK(d);if(p!==y)if(YK(p)&&YK(y))for(let v=0;v<e.length;v++){const b=e[v];typeof b=="string"&&(e[v]=parseFloat(b))}else this.needsMeasurement=!0}resolveNoneKeyframes(){const{unresolvedKeyframes:e,name:i}=this,a=[];for(let l=0;l<e.length;l++)bAe(e[l])&&a.push(l);a.length&&FAe(e,a,i)}measureInitialState(){const{element:e,unresolvedKeyframes:i,name:a}=this;if(!e||!e.current)return;a==="height"&&(this.suspendedScrollY=window.pageYOffset),this.measuredOrigin=l0[a](e.measureViewportBox(),window.getComputedStyle(e.current)),i[0]=this.measuredOrigin;const l=i[i.length-1];l!==void 0&&e.getValue(a,l).jump(l,!1)}measureEndState(){var e;const{element:i,name:a,unresolvedKeyframes:l}=this;if(!i||!i.current)return;const d=i.getValue(a);d&&d.jump(this.measuredOrigin,!1);const p=l.length-1,y=l[p];l[p]=l0[a](i.measureViewportBox(),window.getComputedStyle(i.current)),y!==null&&this.finalKeyframe===void 0&&(this.finalKeyframe=y),!((e=this.removedTransforms)===null||e===void 0)&&e.length&&this.removedTransforms.forEach(([v,b])=>{i.getValue(v).set(b)}),this.resolveNoneKeyframes()}}const ZK=(n,e)=>e==="zIndex"?!1:!!(typeof n=="number"||Array.isArray(n)||typeof n=="string"&&(Sg.test(n)||n==="0")&&!n.startsWith("url("));function KAe(n){const e=n[0];if(n.length===1)return!0;for(let i=0;i<n.length;i++)if(n[i]!==e)return!0}function qAe(n,e,i,a){const l=n[0];if(l===null)return!1;if(e==="display"||e==="visibility")return!0;const d=n[n.length-1],p=ZK(l,e),y=ZK(d,e);return!p||!y?!1:KAe(n)||(i==="spring"||jF(i))&&a}const YAe=n=>n!==null;function C1(n,{repeat:e,repeatType:i="loop"},a){const l=n.filter(YAe),d=e&&i!=="loop"&&e%2===1?0:l.length-1;return!d||a===void 0?l[d]:a}const XAe=40;class Tee{constructor({autoplay:e=!0,delay:i=0,type:a="keyframes",repeat:l=0,repeatDelay:d=0,repeatType:p="loop",...y}){this.isStopped=!1,this.hasAttemptedResolve=!1,this.createdAt=Xh.now(),this.options={autoplay:e,delay:i,type:a,repeat:l,repeatDelay:d,repeatType:p,...y},this.updateFinishedPromise()}calcStartTime(){return this.resolvedAt?this.resolvedAt-this.createdAt>XAe?this.resolvedAt:this.createdAt:this.createdAt}get resolved(){return!this._resolved&&!this.hasAttemptedResolve&&zAe(),this._resolved}onKeyframesResolved(e,i){this.resolvedAt=Xh.now(),this.hasAttemptedResolve=!0;const{name:a,type:l,velocity:d,delay:p,onComplete:y,onUpdate:v,isGenerator:b}=this.options;if(!b&&!qAe(e,a,l,d))if(p)this.options.duration=0;else{v&&v(C1(e,this.options,i)),y&&y(),this.resolveFinishedPromise();return}const w=this.initPlayback(e,i);w!==!1&&(this._resolved={keyframes:e,finalKeyframe:i,...w},this.onPostResolved())}onPostResolved(){}then(e,i){return this.currentFinishedPromise.then(e,i)}flatten(){this.options.type="keyframes",this.options.ease="linear"}updateFinishedPromise(){this.currentFinishedPromise=new Promise(e=>{this.resolveFinishedPromise=e})}}const us=(n,e,i)=>n+(e-n)*i;function v2(n,e,i){return i<0&&(i+=1),i>1&&(i-=1),i<1/6?n+(e-n)*6*i:i<1/2?e:i<2/3?n+(e-n)*(2/3-i)*6:n}function JAe({hue:n,saturation:e,lightness:i,alpha:a}){n/=360,e/=100,i/=100;let l=0,d=0,p=0;if(!e)l=d=p=i;else{const y=i<.5?i*(1+e):i+e-i*e,v=2*i-y;l=v2(v,y,n+1/3),d=v2(v,y,n),p=v2(v,y,n-1/3)}return{red:Math.round(l*255),green:Math.round(d*255),blue:Math.round(p*255),alpha:a}}function Ak(n,e){return i=>i>0?e:n}const S2=(n,e,i)=>{const a=n*n,l=i*(e*e-a)+a;return l<0?0:Math.sqrt(l)},QAe=[LU,_y,LS],ZAe=n=>QAe.find(e=>e.test(n));function eq(n){const e=ZAe(n);if(!e)return!1;let i=e.parse(n);return e===LS&&(i=JAe(i)),i}const tq=(n,e)=>{const i=eq(n),a=eq(e);if(!i||!a)return Ak(n,e);const l={...i};return d=>(l.red=S2(i.red,a.red,d),l.green=S2(i.green,a.green,d),l.blue=S2(i.blue,a.blue,d),l.alpha=us(i.alpha,a.alpha,d),_y.transform(l))},ePe=(n,e)=>i=>e(n(i)),XR=(...n)=>n.reduce(ePe),VU=new Set(["none","hidden"]);function tPe(n,e){return VU.has(n)?i=>i<=0?n:e:i=>i>=1?e:n}function nPe(n,e){return i=>us(n,e,i)}function QF(n){return typeof n=="number"?nPe:typeof n=="string"?NF(n)?Ak:La.test(n)?tq:sPe:Array.isArray(n)?wee:typeof n=="object"?La.test(n)?tq:rPe:Ak}function wee(n,e){const i=[...n],a=i.length,l=n.map((d,p)=>QF(d)(d,e[p]));return d=>{for(let p=0;p<a;p++)i[p]=l[p](d);return i}}function rPe(n,e){const i={...n,...e},a={};for(const l in i)n[l]!==void 0&&e[l]!==void 0&&(a[l]=QF(n[l])(n[l],e[l]));return l=>{for(const d in a)i[d]=a[d](l);return i}}function iPe(n,e){var i;const a=[],l={color:0,var:0,number:0};for(let d=0;d<e.values.length;d++){const p=e.types[d],y=n.indexes[p][l[p]],v=(i=n.values[y])!==null&&i!==void 0?i:0;a[d]=v,l[p]++}return a}const sPe=(n,e)=>{const i=Sg.createTransformer(e),a=bR(n),l=bR(e);return a.indexes.var.length===l.indexes.var.length&&a.indexes.color.length===l.indexes.color.length&&a.indexes.number.length>=l.indexes.number.length?VU.has(n)&&!l.values.length||VU.has(e)&&!a.values.length?tPe(n,e):XR(wee(iPe(a,l),l.values),i):Ak(n,e)};function Ree(n,e,i){return typeof n=="number"&&typeof e=="number"&&typeof i=="number"?us(n,e,i):QF(n)(n,e)}const oPe=5;function Cee(n,e,i){const a=Math.max(e-oPe,0);return ZZ(i-n(a),e-a)}const Is={stiffness:100,damping:10,mass:1,velocity:0,duration:800,bounce:.3,visualDuration:.3,restSpeed:{granular:.01,default:2},restDelta:{granular:.005,default:.5},minDuration:.01,maxDuration:10,minDamping:.05,maxDamping:1},nq=.001;function aPe({duration:n=Is.duration,bounce:e=Is.bounce,velocity:i=Is.velocity,mass:a=Is.mass}){let l,d,p=1-e;p=Op(Is.minDamping,Is.maxDamping,p),n=Op(Is.minDuration,Is.maxDuration,Rp(n)),p<1?(l=b=>{const w=b*p,A=w*n,N=w-i,V=FU(b,p),j=Math.exp(-A);return nq-N/V*j},d=b=>{const A=b*p*n,N=A*i+i,V=Math.pow(p,2)*Math.pow(b,2)*n,j=Math.exp(-A),B=FU(Math.pow(b,2),p);return(-l(b)+nq>0?-1:1)*((N-V)*j)/B}):(l=b=>{const w=Math.exp(-b*n),A=(b-i)*n+1;return-.001+w*A},d=b=>{const w=Math.exp(-b*n),A=(i-b)*(n*n);return w*A});const y=5/n,v=lPe(l,d,y);if(n=wp(n),isNaN(v))return{stiffness:Is.stiffness,damping:Is.damping,duration:n};{const b=Math.pow(v,2)*a;return{stiffness:b,damping:p*2*Math.sqrt(a*b),duration:n}}}const cPe=12;function lPe(n,e,i){let a=i;for(let l=1;l<cPe;l++)a=a-n(a)/e(a);return a}function FU(n,e){return n*Math.sqrt(1-e*e)}const uPe=["duration","bounce"],dPe=["stiffness","damping","mass"];function rq(n,e){return e.some(i=>n[i]!==void 0)}function hPe(n){let e={velocity:Is.velocity,stiffness:Is.stiffness,damping:Is.damping,mass:Is.mass,isResolvedFromDuration:!1,...n};if(!rq(n,dPe)&&rq(n,uPe))if(n.visualDuration){const i=n.visualDuration,a=2*Math.PI/(i*1.2),l=a*a,d=2*Op(.05,1,1-(n.bounce||0))*Math.sqrt(l);e={...e,mass:Is.mass,stiffness:l,damping:d}}else{const i=aPe(n);e={...e,...i,mass:Is.mass},e.isResolvedFromDuration=!0}return e}function Iee(n=Is.visualDuration,e=Is.bounce){const i=typeof n!="object"?{visualDuration:n,keyframes:[0,1],bounce:e}:n;let{restSpeed:a,restDelta:l}=i;const d=i.keyframes[0],p=i.keyframes[i.keyframes.length-1],y={done:!1,value:d},{stiffness:v,damping:b,mass:w,duration:A,velocity:N,isResolvedFromDuration:V}=hPe({...i,velocity:-Rp(i.velocity||0)}),j=N||0,B=b/(2*Math.sqrt(v*w)),G=p-d,ee=Rp(Math.sqrt(v/w)),K=Math.abs(G)<5;a||(a=K?Is.restSpeed.granular:Is.restSpeed.default),l||(l=K?Is.restDelta.granular:Is.restDelta.default);let ne;if(B<1){const oe=FU(ee,B);ne=ge=>{const te=Math.exp(-B*ee*ge);return p-te*((j+B*ee*G)/oe*Math.sin(oe*ge)+G*Math.cos(oe*ge))}}else if(B===1)ne=oe=>p-Math.exp(-ee*oe)*(G+(j+ee*G)*oe);else{const oe=ee*Math.sqrt(B*B-1);ne=ge=>{const te=Math.exp(-B*ee*ge),Z=Math.min(oe*ge,300);return p-te*((j+B*ee*G)*Math.sinh(Z)+oe*G*Math.cosh(Z))/oe}}const ce={calculatedDuration:V&&A||null,next:oe=>{const ge=ne(oe);if(V)y.done=oe>=A;else{let te=0;B<1&&(te=oe===0?wp(j):Cee(ne,oe,ge));const Z=Math.abs(te)<=a,J=Math.abs(p-ge)<=l;y.done=Z&&J}return y.value=y.done?p:ge,y},toString:()=>{const oe=Math.min(HZ(ce),kU),ge=$Z(te=>ce.next(oe*te).value,oe,30);return oe+"ms "+ge}};return ce}function iq({keyframes:n,velocity:e=0,power:i=.8,timeConstant:a=325,bounceDamping:l=10,bounceStiffness:d=500,modifyTarget:p,min:y,max:v,restDelta:b=.5,restSpeed:w}){const A=n[0],N={done:!1,value:A},V=Z=>y!==void 0&&Z<y||v!==void 0&&Z>v,j=Z=>y===void 0?v:v===void 0||Math.abs(y-Z)<Math.abs(v-Z)?y:v;let B=i*e;const G=A+B,ee=p===void 0?G:p(G);ee!==G&&(B=ee-A);const K=Z=>-B*Math.exp(-Z/a),ne=Z=>ee+K(Z),ce=Z=>{const J=K(Z),se=ne(Z);N.done=Math.abs(J)<=b,N.value=N.done?ee:se};let oe,ge;const te=Z=>{V(N.value)&&(oe=Z,ge=Iee({keyframes:[N.value,j(N.value)],velocity:Cee(ne,Z,N.value),damping:l,stiffness:d,restDelta:b,restSpeed:w}))};return te(0),{calculatedDuration:null,next:Z=>{let J=!1;return!ge&&oe===void 0&&(J=!0,ce(Z),te(Z)),oe!==void 0&&Z>=oe?ge.next(Z-oe):(!J&&ce(Z),N)}}}const fPe=YR(.42,0,1,1),pPe=YR(0,0,.58,1),Aee=YR(.42,0,.58,1),mPe=n=>Array.isArray(n)&&typeof n[0]!="number",gPe={linear:Dl,easeIn:fPe,easeInOut:Aee,easeOut:pPe,circIn:KF,circInOut:cee,circOut:aee,backIn:$F,backInOut:see,backOut:iee,anticipate:oee},sq=n=>{if(BF(n)){RZ(n.length===4);const[e,i,a,l]=n;return YR(e,i,a,l)}else if(typeof n=="string")return gPe[n];return n};function _Pe(n,e,i){const a=[],l=i||Ree,d=n.length-1;for(let p=0;p<d;p++){let y=l(n[p],n[p+1]);if(e){const v=Array.isArray(e)?e[p]||Dl:e;y=XR(v,y)}a.push(y)}return a}function yPe(n,e,{clamp:i=!0,ease:a,mixer:l}={}){const d=n.length;if(RZ(d===e.length),d===1)return()=>e[0];if(d===2&&e[0]===e[1])return()=>e[1];const p=n[0]===n[1];n[0]>n[d-1]&&(n=[...n].reverse(),e=[...e].reverse());const y=_Pe(e,a,l),v=y.length,b=w=>{if(p&&w<n[0])return e[0];let A=0;if(v>1)for(;A<n.length-2&&!(w<n[A+1]);A++);const N=a0(n[A],n[A+1],w);return y[A](N)};return i?w=>b(Op(n[0],n[d-1],w)):b}function EPe(n,e){const i=n[n.length-1];for(let a=1;a<=e;a++){const l=a0(0,e,a);n.push(us(i,1,l))}}function vPe(n){const e=[0];return EPe(e,n.length-1),e}function SPe(n,e){return n.map(i=>i*e)}function bPe(n,e){return n.map(()=>e||Aee).splice(0,n.length-1)}function Pk({duration:n=300,keyframes:e,times:i,ease:a="easeInOut"}){const l=mPe(a)?a.map(sq):sq(a),d={done:!1,value:e[0]},p=SPe(i&&i.length===e.length?i:vPe(e),n),y=yPe(p,e,{ease:Array.isArray(l)?l:bPe(e,l)});return{calculatedDuration:n,next:v=>(d.value=y(v),d.done=v>=n,d)}}const TPe=n=>{const e=({timestamp:i})=>n(i);return{start:()=>Xi.update(e,!0),stop:()=>vg(e),now:()=>Zo.isProcessing?Zo.timestamp:Xh.now()}},wPe={decay:iq,inertia:iq,tween:Pk,keyframes:Pk,spring:Iee},RPe=n=>n/100;class ZF extends Tee{constructor(e){super(e),this.holdTime=null,this.cancelTime=null,this.currentTime=0,this.playbackSpeed=1,this.pendingPlayState="running",this.startTime=null,this.state="idle",this.stop=()=>{if(this.resolver.cancel(),this.isStopped=!0,this.state==="idle")return;this.teardown();const{onStop:v}=this.options;v&&v()};const{name:i,motionValue:a,element:l,keyframes:d}=this.options,p=(l==null?void 0:l.KeyframeResolver)||JF,y=(v,b)=>this.onKeyframesResolved(v,b);this.resolver=new p(d,y,i,a,l),this.resolver.scheduleResolve()}flatten(){super.flatten(),this._resolved&&Object.assign(this._resolved,this.initPlayback(this._resolved.keyframes))}initPlayback(e){const{type:i="keyframes",repeat:a=0,repeatDelay:l=0,repeatType:d,velocity:p=0}=this.options,y=jF(i)?i:wPe[i]||Pk;let v,b;y!==Pk&&typeof e[0]!="number"&&(v=XR(RPe,Ree(e[0],e[1])),e=[0,100]);const w=y({...this.options,keyframes:e});d==="mirror"&&(b=y({...this.options,keyframes:[...e].reverse(),velocity:-p})),w.calculatedDuration===null&&(w.calculatedDuration=HZ(w));const{calculatedDuration:A}=w,N=A+l,V=N*(a+1)-l;return{generator:w,mirroredGenerator:b,mapPercentToKeyframes:v,calculatedDuration:A,resolvedDuration:N,totalDuration:V}}onPostResolved(){const{autoplay:e=!0}=this.options;this.play(),this.pendingPlayState==="paused"||!e?this.pause():this.state=this.pendingPlayState}tick(e,i=!1){const{resolved:a}=this;if(!a){const{keyframes:Z}=this.options;return{done:!0,value:Z[Z.length-1]}}const{finalKeyframe:l,generator:d,mirroredGenerator:p,mapPercentToKeyframes:y,keyframes:v,calculatedDuration:b,totalDuration:w,resolvedDuration:A}=a;if(this.startTime===null)return d.next(0);const{delay:N,repeat:V,repeatType:j,repeatDelay:B,onUpdate:G}=this.options;this.speed>0?this.startTime=Math.min(this.startTime,e):this.speed<0&&(this.startTime=Math.min(e-w/this.speed,this.startTime)),i?this.currentTime=e:this.holdTime!==null?this.currentTime=this.holdTime:this.currentTime=Math.round(e-this.startTime)*this.speed;const ee=this.currentTime-N*(this.speed>=0?1:-1),K=this.speed>=0?ee<0:ee>w;this.currentTime=Math.max(ee,0),this.state==="finished"&&this.holdTime===null&&(this.currentTime=w);let ne=this.currentTime,ce=d;if(V){const Z=Math.min(this.currentTime,w)/A;let J=Math.floor(Z),se=Z%1;!se&&Z>=1&&(se=1),se===1&&J--,J=Math.min(J,V+1),!!(J%2)&&(j==="reverse"?(se=1-se,B&&(se-=B/A)):j==="mirror"&&(ce=p)),ne=Op(0,1,se)*A}const oe=K?{done:!1,value:v[0]}:ce.next(ne);y&&(oe.value=y(oe.value));let{done:ge}=oe;!K&&b!==null&&(ge=this.speed>=0?this.currentTime>=w:this.currentTime<=0);const te=this.holdTime===null&&(this.state==="finished"||this.state==="running"&&ge);return te&&l!==void 0&&(oe.value=C1(v,this.options,l)),G&&G(oe.value),te&&this.finish(),oe}get duration(){const{resolved:e}=this;return e?Rp(e.calculatedDuration):0}get time(){return Rp(this.currentTime)}set time(e){e=wp(e),this.currentTime=e,this.holdTime!==null||this.speed===0?this.holdTime=e:this.driver&&(this.startTime=this.driver.now()-e/this.speed)}get speed(){return this.playbackSpeed}set speed(e){const i=this.playbackSpeed!==e;this.playbackSpeed=e,i&&(this.time=Rp(this.currentTime))}play(){if(this.resolver.isScheduled||this.resolver.resume(),!this._resolved){this.pendingPlayState="running";return}if(this.isStopped)return;const{driver:e=TPe,onPlay:i,startTime:a}=this.options;this.driver||(this.driver=e(d=>this.tick(d))),i&&i();const l=this.driver.now();this.holdTime!==null?this.startTime=l-this.holdTime:this.startTime?this.state==="finished"&&(this.startTime=l):this.startTime=a??this.calcStartTime(),this.state==="finished"&&this.updateFinishedPromise(),this.cancelTime=this.startTime,this.holdTime=null,this.state="running",this.driver.start()}pause(){var e;if(!this._resolved){this.pendingPlayState="paused";return}this.state="paused",this.holdTime=(e=this.currentTime)!==null&&e!==void 0?e:0}complete(){this.state!=="running"&&this.play(),this.pendingPlayState=this.state="finished",this.holdTime=null}finish(){this.teardown(),this.state="finished";const{onComplete:e}=this.options;e&&e()}cancel(){this.cancelTime!==null&&this.tick(this.cancelTime),this.teardown(),this.updateFinishedPromise()}teardown(){this.state="idle",this.stopDriver(),this.resolveFinishedPromise(),this.updateFinishedPromise(),this.startTime=this.cancelTime=null,this.resolver.cancel()}stopDriver(){this.driver&&(this.driver.stop(),this.driver=void 0)}sample(e){return this.startTime=0,this.tick(e,!0)}}const CPe=new Set(["opacity","clipPath","filter","transform"]);function IPe(n,e,i,{delay:a=0,duration:l=300,repeat:d=0,repeatType:p="loop",ease:y="easeInOut",times:v}={}){const b={[e]:i};v&&(b.offset=v);const w=qZ(y,l);return Array.isArray(w)&&(b.easing=w),n.animate(b,{delay:a,duration:l,easing:Array.isArray(w)?"linear":w,fill:"both",iterations:d+1,direction:p==="reverse"?"alternate":"normal"})}const APe=RF(()=>Object.hasOwnProperty.call(Element.prototype,"animate")),Ok=10,PPe=2e4;function OPe(n){return jF(n.type)||n.type==="spring"||!KZ(n.ease)}function kPe(n,e){const i=new ZF({...e,keyframes:n,repeat:0,delay:0,isGenerator:!0});let a={done:!1,value:n[0]};const l=[];let d=0;for(;!a.done&&d<PPe;)a=i.sample(d),l.push(a.value),d+=Ok;return{times:void 0,keyframes:l,duration:d-Ok,ease:"linear"}}const Pee={anticipate:oee,backInOut:see,circInOut:cee};function NPe(n){return n in Pee}class oq extends Tee{constructor(e){super(e);const{name:i,motionValue:a,element:l,keyframes:d}=this.options;this.resolver=new bee(d,(p,y)=>this.onKeyframesResolved(p,y),i,a,l),this.resolver.scheduleResolve()}initPlayback(e,i){let{duration:a=300,times:l,ease:d,type:p,motionValue:y,name:v,startTime:b}=this.options;if(!y.owner||!y.owner.current)return!1;if(typeof d=="string"&&Ik()&&NPe(d)&&(d=Pee[d]),OPe(this.options)){const{onComplete:A,onUpdate:N,motionValue:V,element:j,...B}=this.options,G=kPe(e,B);e=G.keyframes,e.length===1&&(e[1]=e[0]),a=G.duration,l=G.times,d=G.ease,p="keyframes"}const w=IPe(y.owner.current,v,e,{...this.options,duration:a,times:l,ease:d});return w.startTime=b??this.calcStartTime(),this.pendingTimeline?(zK(w,this.pendingTimeline),this.pendingTimeline=void 0):w.onfinish=()=>{const{onComplete:A}=this.options;y.set(C1(e,this.options,i)),A&&A(),this.cancel(),this.resolveFinishedPromise()},{animation:w,duration:a,times:l,type:p,ease:d,keyframes:e}}get duration(){const{resolved:e}=this;if(!e)return 0;const{duration:i}=e;return Rp(i)}get time(){const{resolved:e}=this;if(!e)return 0;const{animation:i}=e;return Rp(i.currentTime||0)}set time(e){const{resolved:i}=this;if(!i)return;const{animation:a}=i;a.currentTime=wp(e)}get speed(){const{resolved:e}=this;if(!e)return 1;const{animation:i}=e;return i.playbackRate}set speed(e){const{resolved:i}=this;if(!i)return;const{animation:a}=i;a.playbackRate=e}get state(){const{resolved:e}=this;if(!e)return"idle";const{animation:i}=e;return i.playState}get startTime(){const{resolved:e}=this;if(!e)return null;const{animation:i}=e;return i.startTime}attachTimeline(e){if(!this._resolved)this.pendingTimeline=e;else{const{resolved:i}=this;if(!i)return Dl;const{animation:a}=i;zK(a,e)}return Dl}play(){if(this.isStopped)return;const{resolved:e}=this;if(!e)return;const{animation:i}=e;i.playState==="finished"&&this.updateFinishedPromise(),i.play()}pause(){const{resolved:e}=this;if(!e)return;const{animation:i}=e;i.pause()}stop(){if(this.resolver.cancel(),this.isStopped=!0,this.state==="idle")return;this.resolveFinishedPromise(),this.updateFinishedPromise();const{resolved:e}=this;if(!e)return;const{animation:i,keyframes:a,duration:l,type:d,ease:p,times:y}=e;if(i.playState==="idle"||i.playState==="finished")return;if(this.time){const{motionValue:b,onUpdate:w,onComplete:A,element:N,...V}=this.options,j=new ZF({...V,keyframes:a,duration:l,type:d,ease:p,times:y,isGenerator:!0}),B=wp(this.time);b.setWithVelocity(j.sample(B-Ok).value,j.sample(B).value,Ok)}const{onStop:v}=this.options;v&&v(),this.cancel()}complete(){const{resolved:e}=this;e&&e.animation.finish()}cancel(){const{resolved:e}=this;e&&e.animation.cancel()}static supports(e){const{motionValue:i,name:a,repeatDelay:l,repeatType:d,damping:p,type:y}=e;if(!i||!i.owner||!(i.owner.current instanceof HTMLElement))return!1;const{onUpdate:v,transformTemplate:b}=i.owner.getProps();return APe()&&a&&CPe.has(a)&&!v&&!b&&!l&&d!=="mirror"&&p!==0&&y!=="inertia"}}const DPe={type:"spring",stiffness:500,damping:25,restSpeed:10},LPe=n=>({type:"spring",stiffness:550,damping:n===0?2*Math.sqrt(550):30,restSpeed:10}),xPe={type:"keyframes",duration:.8},MPe={type:"keyframes",ease:[.25,.1,.35,1],duration:.3},UPe=(n,{keyframes:e})=>e.length>2?xPe:zy.has(n)?n.startsWith("scale")?LPe(e[1]):DPe:MPe;function VPe({when:n,delay:e,delayChildren:i,staggerChildren:a,staggerDirection:l,repeat:d,repeatType:p,repeatDelay:y,from:v,elapsed:b,...w}){return!!Object.keys(w).length}const ej=(n,e,i,a={},l,d)=>p=>{const y=FF(a,n)||{},v=y.delay||a.delay||0;let{elapsed:b=0}=a;b=b-wp(v);let w={keyframes:Array.isArray(i)?i:[null,i],ease:"easeOut",velocity:e.getVelocity(),...y,delay:-b,onUpdate:N=>{e.set(N),y.onUpdate&&y.onUpdate(N)},onComplete:()=>{p(),y.onComplete&&y.onComplete()},name:n,motionValue:e,element:d?void 0:l};VPe(y)||(w={...w,...UPe(n,w)}),w.duration&&(w.duration=wp(w.duration)),w.repeatDelay&&(w.repeatDelay=wp(w.repeatDelay)),w.from!==void 0&&(w.keyframes[0]=w.from);let A=!1;if((w.type===!1||w.duration===0&&!w.repeatDelay)&&(w.duration=0,w.delay===0&&(A=!0)),A&&!d&&e.get()!==void 0){const N=C1(w.keyframes,y);if(N!==void 0)return Xi.update(()=>{w.onUpdate(N),w.onComplete()}),new rAe([])}return!d&&oq.supports(w)?new oq(w):new ZF(w)};function FPe({protectedKeys:n,needsAnimating:e},i){const a=n.hasOwnProperty(i)&&e[i]!==!0;return e[i]=!1,a}function Oee(n,e,{delay:i=0,transitionOverride:a,type:l}={}){var d;let{transition:p=n.getDefaultTransition(),transitionEnd:y,...v}=e;a&&(p=a);const b=[],w=l&&n.animationState&&n.animationState.getState()[l];for(const A in v){const N=n.getValue(A,(d=n.latestValues[A])!==null&&d!==void 0?d:null),V=v[A];if(V===void 0||w&&FPe(w,A))continue;const j={delay:i,...FF(p||{},A)};let B=!1;if(window.MotionHandoffAnimation){const ee=eee(n);if(ee){const K=window.MotionHandoffAnimation(ee,A,Xi);K!==null&&(j.startTime=K,B=!0)}}DU(n,A),N.start(ej(A,N,V,n.shouldReduceMotion&&QZ.has(A)?{type:!1}:j,n,B));const G=N.animation;G&&b.push(G)}return y&&Promise.all(b).then(()=>{Xi.update(()=>{y&&_Ae(n,y)})}),b}function jU(n,e,i={}){var a;const l=R1(n,e,i.type==="exit"?(a=n.presenceContext)===null||a===void 0?void 0:a.custom:void 0);let{transition:d=n.getDefaultTransition()||{}}=l||{};i.transitionOverride&&(d=i.transitionOverride);const p=l?()=>Promise.all(Oee(n,l,i)):()=>Promise.resolve(),y=n.variantChildren&&n.variantChildren.size?(b=0)=>{const{delayChildren:w=0,staggerChildren:A,staggerDirection:N}=d;return jPe(n,e,w+b,A,N,i)}:()=>Promise.resolve(),{when:v}=d;if(v){const[b,w]=v==="beforeChildren"?[p,y]:[y,p];return b().then(()=>w())}else return Promise.all([p(),y(i.delay)])}function jPe(n,e,i=0,a=0,l=1,d){const p=[],y=(n.variantChildren.size-1)*a,v=l===1?(b=0)=>b*a:(b=0)=>y-b*a;return Array.from(n.variantChildren).sort(BPe).forEach((b,w)=>{b.notify("AnimationStart",e),p.push(jU(b,e,{...d,delay:i+v(w)}).then(()=>b.notify("AnimationComplete",e)))}),Promise.all(p)}function BPe(n,e){return n.sortNodePosition(e)}function WPe(n,e,i={}){n.notify("AnimationStart",e);let a;if(Array.isArray(e)){const l=e.map(d=>jU(n,d,i));a=Promise.all(l)}else if(typeof e=="string")a=jU(n,e,i);else{const l=typeof e=="function"?R1(n,e,i.custom):e;a=Promise.all(Oee(n,l,i))}return a.then(()=>{n.notify("AnimationComplete",e)})}const zPe=IF.length;function kee(n){if(!n)return;if(!n.isControllingVariants){const i=n.parent?kee(n.parent)||{}:{};return n.props.initial!==void 0&&(i.initial=n.props.initial),i}const e={};for(let i=0;i<zPe;i++){const a=IF[i],l=n.props[a];(ER(l)||l===!1)&&(e[a]=l)}return e}const GPe=[...CF].reverse(),HPe=CF.length;function $Pe(n){return e=>Promise.all(e.map(({animation:i,options:a})=>WPe(n,i,a)))}function KPe(n){let e=$Pe(n),i=aq(),a=!0;const l=v=>(b,w)=>{var A;const N=R1(n,w,v==="exit"?(A=n.presenceContext)===null||A===void 0?void 0:A.custom:void 0);if(N){const{transition:V,transitionEnd:j,...B}=N;b={...b,...B,...j}}return b};function d(v){e=v(n)}function p(v){const{props:b}=n,w=kee(n.parent)||{},A=[],N=new Set;let V={},j=1/0;for(let G=0;G<HPe;G++){const ee=GPe[G],K=i[ee],ne=b[ee]!==void 0?b[ee]:w[ee],ce=ER(ne),oe=ee===v?K.isActive:null;oe===!1&&(j=G);let ge=ne===w[ee]&&ne!==b[ee]&&ce;if(ge&&a&&n.manuallyAnimateOnMount&&(ge=!1),K.protectedKeys={...V},!K.isActive&&oe===null||!ne&&!K.prevProp||T1(ne)||typeof ne=="boolean")continue;const te=qPe(K.prevProp,ne);let Z=te||ee===v&&K.isActive&&!ge&&ce||G>j&&ce,J=!1;const se=Array.isArray(ne)?ne:[ne];let he=se.reduce(l(ee),{});oe===!1&&(he={});const{prevResolvedValues:fe={}}=K,ue={...fe,...he},Me=we=>{Z=!0,N.has(we)&&(J=!0,N.delete(we)),K.needsAnimating[we]=!0;const Ce=n.getValue(we);Ce&&(Ce.liveStyle=!1)};for(const we in ue){const Ce=he[we],ve=fe[we];if(V.hasOwnProperty(we))continue;let Ne=!1;OU(Ce)&&OU(ve)?Ne=!GZ(Ce,ve):Ne=Ce!==ve,Ne?Ce!=null?Me(we):N.add(we):Ce!==void 0&&N.has(we)?Me(we):K.protectedKeys[we]=!0}K.prevProp=ne,K.prevResolvedValues=he,K.isActive&&(V={...V,...he}),a&&n.blockInitialAnimation&&(Z=!1),Z&&(!(ge&&te)||J)&&A.push(...se.map(we=>({animation:we,options:{type:ee}})))}if(N.size){const G={};N.forEach(ee=>{const K=n.getBaseTarget(ee),ne=n.getValue(ee);ne&&(ne.liveStyle=!0),G[ee]=K??null}),A.push({animation:G})}let B=!!A.length;return a&&(b.initial===!1||b.initial===b.animate)&&!n.manuallyAnimateOnMount&&(B=!1),a=!1,B?e(A):Promise.resolve()}function y(v,b){var w;if(i[v].isActive===b)return Promise.resolve();(w=n.variantChildren)===null||w===void 0||w.forEach(N=>{var V;return(V=N.animationState)===null||V===void 0?void 0:V.setActive(v,b)}),i[v].isActive=b;const A=p(v);for(const N in i)i[N].protectedKeys={};return A}return{animateChanges:p,setActive:y,setAnimateFunction:d,getState:()=>i,reset:()=>{i=aq(),a=!0}}}function qPe(n,e){return typeof e=="string"?e!==n:Array.isArray(e)?!GZ(e,n):!1}function oy(n=!1){return{isActive:n,protectedKeys:{},needsAnimating:{},prevResolvedValues:{}}}function aq(){return{animate:oy(!0),whileInView:oy(),whileHover:oy(),whileTap:oy(),whileDrag:oy(),whileFocus:oy(),exit:oy()}}class kg{constructor(e){this.isMounted=!1,this.node=e}update(){}}class YPe extends kg{constructor(e){super(e),e.animationState||(e.animationState=KPe(e))}updateAnimationControlsSubscription(){const{animate:e}=this.node.getProps();T1(e)&&(this.unmountControls=e.subscribe(this.node))}mount(){this.updateAnimationControlsSubscription()}update(){const{animate:e}=this.node.getProps(),{animate:i}=this.node.prevProps||{};e!==i&&this.updateAnimationControlsSubscription()}unmount(){var e;this.node.animationState.reset(),(e=this.unmountControls)===null||e===void 0||e.call(this)}}let XPe=0;class JPe extends kg{constructor(){super(...arguments),this.id=XPe++}update(){if(!this.node.presenceContext)return;const{isPresent:e,onExitComplete:i}=this.node.presenceContext,{isPresent:a}=this.node.prevPresenceContext||{};if(!this.node.animationState||e===a)return;const l=this.node.animationState.setActive("exit",!e);i&&!e&&l.then(()=>i(this.id))}mount(){const{register:e}=this.node.presenceContext||{};e&&(this.unmount=e(this.id))}unmount(){}}const QPe={animation:{Feature:YPe},exit:{Feature:JPe}};function TR(n,e,i,a={passive:!0}){return n.addEventListener(e,i,a),()=>n.removeEventListener(e,i)}function JR(n){return{point:{x:n.pageX,y:n.pageY}}}const ZPe=n=>e=>WF(e)&&n(e,JR(e));function Jw(n,e,i,a){return TR(n,e,ZPe(i),a)}const cq=(n,e)=>Math.abs(n-e);function eOe(n,e){const i=cq(n.x,e.x),a=cq(n.y,e.y);return Math.sqrt(i**2+a**2)}class Nee{constructor(e,i,{transformPagePoint:a,contextWindow:l,dragSnapToOrigin:d=!1}={}){if(this.startEvent=null,this.lastMoveEvent=null,this.lastMoveEventInfo=null,this.handlers={},this.contextWindow=window,this.updatePoint=()=>{if(!(this.lastMoveEvent&&this.lastMoveEventInfo))return;const A=T2(this.lastMoveEventInfo,this.history),N=this.startEvent!==null,V=eOe(A.offset,{x:0,y:0})>=3;if(!N&&!V)return;const{point:j}=A,{timestamp:B}=Zo;this.history.push({...j,timestamp:B});const{onStart:G,onMove:ee}=this.handlers;N||(G&&G(this.lastMoveEvent,A),this.startEvent=this.lastMoveEvent),ee&&ee(this.lastMoveEvent,A)},this.handlePointerMove=(A,N)=>{this.lastMoveEvent=A,this.lastMoveEventInfo=b2(N,this.transformPagePoint),Xi.update(this.updatePoint,!0)},this.handlePointerUp=(A,N)=>{this.end();const{onEnd:V,onSessionEnd:j,resumeAnimation:B}=this.handlers;if(this.dragSnapToOrigin&&B&&B(),!(this.lastMoveEvent&&this.lastMoveEventInfo))return;const G=T2(A.type==="pointercancel"?this.lastMoveEventInfo:b2(N,this.transformPagePoint),this.history);this.startEvent&&V&&V(A,G),j&&j(A,G)},!WF(e))return;this.dragSnapToOrigin=d,this.handlers=i,this.transformPagePoint=a,this.contextWindow=l||window;const p=JR(e),y=b2(p,this.transformPagePoint),{point:v}=y,{timestamp:b}=Zo;this.history=[{...v,timestamp:b}];const{onSessionStart:w}=i;w&&w(e,T2(y,this.history)),this.removeListeners=XR(Jw(this.contextWindow,"pointermove",this.handlePointerMove),Jw(this.contextWindow,"pointerup",this.handlePointerUp),Jw(this.contextWindow,"pointercancel",this.handlePointerUp))}updateHandlers(e){this.handlers=e}end(){this.removeListeners&&this.removeListeners(),vg(this.updatePoint)}}function b2(n,e){return e?{point:e(n.point)}:n}function lq(n,e){return{x:n.x-e.x,y:n.y-e.y}}function T2({point:n},e){return{point:n,delta:lq(n,Dee(e)),offset:lq(n,tOe(e)),velocity:nOe(e,.1)}}function tOe(n){return n[0]}function Dee(n){return n[n.length-1]}function nOe(n,e){if(n.length<2)return{x:0,y:0};let i=n.length-1,a=null;const l=Dee(n);for(;i>=0&&(a=n[i],!(l.timestamp-a.timestamp>wp(e)));)i--;if(!a)return{x:0,y:0};const d=Rp(l.timestamp-a.timestamp);if(d===0)return{x:0,y:0};const p={x:(l.x-a.x)/d,y:(l.y-a.y)/d};return p.x===1/0&&(p.x=0),p.y===1/0&&(p.y=0),p}const Lee=1e-4,rOe=1-Lee,iOe=1+Lee,xee=.01,sOe=0-xee,oOe=0+xee;function xl(n){return n.max-n.min}function aOe(n,e,i){return Math.abs(n-e)<=i}function uq(n,e,i,a=.5){n.origin=a,n.originPoint=us(e.min,e.max,n.origin),n.scale=xl(i)/xl(e),n.translate=us(i.min,i.max,n.origin)-n.originPoint,(n.scale>=rOe&&n.scale<=iOe||isNaN(n.scale))&&(n.scale=1),(n.translate>=sOe&&n.translate<=oOe||isNaN(n.translate))&&(n.translate=0)}function Qw(n,e,i,a){uq(n.x,e.x,i.x,a?a.originX:void 0),uq(n.y,e.y,i.y,a?a.originY:void 0)}function dq(n,e,i){n.min=i.min+e.min,n.max=n.min+xl(e)}function cOe(n,e,i){dq(n.x,e.x,i.x),dq(n.y,e.y,i.y)}function hq(n,e,i){n.min=e.min-i.min,n.max=n.min+xl(e)}function Zw(n,e,i){hq(n.x,e.x,i.x),hq(n.y,e.y,i.y)}function lOe(n,{min:e,max:i},a){return e!==void 0&&n<e?n=a?us(e,n,a.min):Math.max(n,e):i!==void 0&&n>i&&(n=a?us(i,n,a.max):Math.min(n,i)),n}function fq(n,e,i){return{min:e!==void 0?n.min+e:void 0,max:i!==void 0?n.max+i-(n.max-n.min):void 0}}function uOe(n,{top:e,left:i,bottom:a,right:l}){return{x:fq(n.x,i,l),y:fq(n.y,e,a)}}function pq(n,e){let i=e.min-n.min,a=e.max-n.max;return e.max-e.min<n.max-n.min&&([i,a]=[a,i]),{min:i,max:a}}function dOe(n,e){return{x:pq(n.x,e.x),y:pq(n.y,e.y)}}function hOe(n,e){let i=.5;const a=xl(n),l=xl(e);return l>a?i=a0(e.min,e.max-a,n.min):a>l&&(i=a0(n.min,n.max-l,e.min)),Op(0,1,i)}function fOe(n,e){const i={};return e.min!==void 0&&(i.min=e.min-n.min),e.max!==void 0&&(i.max=e.max-n.min),i}const BU=.35;function pOe(n=BU){return n===!1?n=0:n===!0&&(n=BU),{x:mq(n,"left","right"),y:mq(n,"top","bottom")}}function mq(n,e,i){return{min:gq(n,e),max:gq(n,i)}}function gq(n,e){return typeof n=="number"?n:n[e]||0}const _q=()=>({translate:0,scale:1,origin:0,originPoint:0}),xS=()=>({x:_q(),y:_q()}),yq=()=>({min:0,max:0}),Ms=()=>({x:yq(),y:yq()});function Ru(n){return[n("x"),n("y")]}function Mee({top:n,left:e,right:i,bottom:a}){return{x:{min:e,max:i},y:{min:n,max:a}}}function mOe({x:n,y:e}){return{top:e.min,right:n.max,bottom:e.max,left:n.min}}function gOe(n,e){if(!e)return n;const i=e({x:n.left,y:n.top}),a=e({x:n.right,y:n.bottom});return{top:i.y,left:i.x,bottom:a.y,right:a.x}}function w2(n){return n===void 0||n===1}function WU({scale:n,scaleX:e,scaleY:i}){return!w2(n)||!w2(e)||!w2(i)}function cy(n){return WU(n)||Uee(n)||n.z||n.rotate||n.rotateX||n.rotateY||n.skewX||n.skewY}function Uee(n){return Eq(n.x)||Eq(n.y)}function Eq(n){return n&&n!=="0%"}function kk(n,e,i){const a=n-i,l=e*a;return i+l}function vq(n,e,i,a,l){return l!==void 0&&(n=kk(n,l,a)),kk(n,i,a)+e}function zU(n,e=0,i=1,a,l){n.min=vq(n.min,e,i,a,l),n.max=vq(n.max,e,i,a,l)}function Vee(n,{x:e,y:i}){zU(n.x,e.translate,e.scale,e.originPoint),zU(n.y,i.translate,i.scale,i.originPoint)}const Sq=.999999999999,bq=1.0000000000001;function _Oe(n,e,i,a=!1){const l=i.length;if(!l)return;e.x=e.y=1;let d,p;for(let y=0;y<l;y++){d=i[y],p=d.projectionDelta;const{visualElement:v}=d.options;v&&v.props.style&&v.props.style.display==="contents"||(a&&d.options.layoutScroll&&d.scroll&&d!==d.root&&US(n,{x:-d.scroll.offset.x,y:-d.scroll.offset.y}),p&&(e.x*=p.x.scale,e.y*=p.y.scale,Vee(n,p)),a&&cy(d.latestValues)&&US(n,d.latestValues))}e.x<bq&&e.x>Sq&&(e.x=1),e.y<bq&&e.y>Sq&&(e.y=1)}function MS(n,e){n.min=n.min+e,n.max=n.max+e}function Tq(n,e,i,a,l=.5){const d=us(n.min,n.max,l);zU(n,e,i,d,a)}function US(n,e){Tq(n.x,e.x,e.scaleX,e.scale,e.originX),Tq(n.y,e.y,e.scaleY,e.scale,e.originY)}function Fee(n,e){return Mee(gOe(n.getBoundingClientRect(),e))}function yOe(n,e,i){const a=Fee(n,i),{scroll:l}=e;return l&&(MS(a.x,l.offset.x),MS(a.y,l.offset.y)),a}const jee=({current:n})=>n?n.ownerDocument.defaultView:null,EOe=new WeakMap;class vOe{constructor(e){this.openDragLock=null,this.isDragging=!1,this.currentDirection=null,this.originPoint={x:0,y:0},this.constraints=!1,this.hasMutatedConstraints=!1,this.elastic=Ms(),this.visualElement=e}start(e,{snapToCursor:i=!1}={}){const{presenceContext:a}=this.visualElement;if(a&&a.isPresent===!1)return;const l=w=>{const{dragSnapToOrigin:A}=this.getProps();A?this.pauseAnimation():this.stopAnimation(),i&&this.snapToCursor(JR(w).point)},d=(w,A)=>{const{drag:N,dragPropagation:V,onDragStart:j}=this.getProps();if(N&&!V&&(this.openDragLock&&this.openDragLock(),this.openDragLock=hAe(N),!this.openDragLock))return;this.isDragging=!0,this.currentDirection=null,this.resolveConstraints(),this.visualElement.projection&&(this.visualElement.projection.isAnimationBlocked=!0,this.visualElement.projection.target=void 0),Ru(G=>{let ee=this.getAxisMotionValue(G).get()||0;if(Yh.test(ee)){const{projection:K}=this.visualElement;if(K&&K.layout){const ne=K.layout.layoutBox[G];ne&&(ee=xl(ne)*(parseFloat(ee)/100))}}this.originPoint[G]=ee}),j&&Xi.postRender(()=>j(w,A)),DU(this.visualElement,"transform");const{animationState:B}=this.visualElement;B&&B.setActive("whileDrag",!0)},p=(w,A)=>{const{dragPropagation:N,dragDirectionLock:V,onDirectionLock:j,onDrag:B}=this.getProps();if(!N&&!this.openDragLock)return;const{offset:G}=A;if(V&&this.currentDirection===null){this.currentDirection=SOe(G),this.currentDirection!==null&&j&&j(this.currentDirection);return}this.updateAxis("x",A.point,G),this.updateAxis("y",A.point,G),this.visualElement.render(),B&&B(w,A)},y=(w,A)=>this.stop(w,A),v=()=>Ru(w=>{var A;return this.getAnimationState(w)==="paused"&&((A=this.getAxisMotionValue(w).animation)===null||A===void 0?void 0:A.play())}),{dragSnapToOrigin:b}=this.getProps();this.panSession=new Nee(e,{onSessionStart:l,onStart:d,onMove:p,onSessionEnd:y,resumeAnimation:v},{transformPagePoint:this.visualElement.getTransformPagePoint(),dragSnapToOrigin:b,contextWindow:jee(this.visualElement)})}stop(e,i){const a=this.isDragging;if(this.cancel(),!a)return;const{velocity:l}=i;this.startAnimation(l);const{onDragEnd:d}=this.getProps();d&&Xi.postRender(()=>d(e,i))}cancel(){this.isDragging=!1;const{projection:e,animationState:i}=this.visualElement;e&&(e.isAnimationBlocked=!1),this.panSession&&this.panSession.end(),this.panSession=void 0;const{dragPropagation:a}=this.getProps();!a&&this.openDragLock&&(this.openDragLock(),this.openDragLock=null),i&&i.setActive("whileDrag",!1)}updateAxis(e,i,a){const{drag:l}=this.getProps();if(!a||!EO(e,l,this.currentDirection))return;const d=this.getAxisMotionValue(e);let p=this.originPoint[e]+a[e];this.constraints&&this.constraints[e]&&(p=lOe(p,this.constraints[e],this.elastic[e])),d.set(p)}resolveConstraints(){var e;const{dragConstraints:i,dragElastic:a}=this.getProps(),l=this.visualElement.projection&&!this.visualElement.projection.layout?this.visualElement.projection.measure(!1):(e=this.visualElement.projection)===null||e===void 0?void 0:e.layout,d=this.constraints;i&&DS(i)?this.constraints||(this.constraints=this.resolveRefConstraints()):i&&l?this.constraints=uOe(l.layoutBox,i):this.constraints=!1,this.elastic=pOe(a),d!==this.constraints&&l&&this.constraints&&!this.hasMutatedConstraints&&Ru(p=>{this.constraints!==!1&&this.getAxisMotionValue(p)&&(this.constraints[p]=fOe(l.layoutBox[p],this.constraints[p]))})}resolveRefConstraints(){const{dragConstraints:e,onMeasureDragConstraints:i}=this.getProps();if(!e||!DS(e))return!1;const a=e.current,{projection:l}=this.visualElement;if(!l||!l.layout)return!1;const d=yOe(a,l.root,this.visualElement.getTransformPagePoint());let p=dOe(l.layout.layoutBox,d);if(i){const y=i(mOe(p));this.hasMutatedConstraints=!!y,y&&(p=Mee(y))}return p}startAnimation(e){const{drag:i,dragMomentum:a,dragElastic:l,dragTransition:d,dragSnapToOrigin:p,onDragTransitionEnd:y}=this.getProps(),v=this.constraints||{},b=Ru(w=>{if(!EO(w,i,this.currentDirection))return;let A=v&&v[w]||{};p&&(A={min:0,max:0});const N=l?200:1e6,V=l?40:1e7,j={type:"inertia",velocity:a?e[w]:0,bounceStiffness:N,bounceDamping:V,timeConstant:750,restDelta:1,restSpeed:10,...d,...A};return this.startAxisValueAnimation(w,j)});return Promise.all(b).then(y)}startAxisValueAnimation(e,i){const a=this.getAxisMotionValue(e);return DU(this.visualElement,e),a.start(ej(e,a,0,i,this.visualElement,!1))}stopAnimation(){Ru(e=>this.getAxisMotionValue(e).stop())}pauseAnimation(){Ru(e=>{var i;return(i=this.getAxisMotionValue(e).animation)===null||i===void 0?void 0:i.pause()})}getAnimationState(e){var i;return(i=this.getAxisMotionValue(e).animation)===null||i===void 0?void 0:i.state}getAxisMotionValue(e){const i=`_drag${e.toUpperCase()}`,a=this.visualElement.getProps(),l=a[i];return l||this.visualElement.getValue(e,(a.initial?a.initial[e]:void 0)||0)}snapToCursor(e){Ru(i=>{const{drag:a}=this.getProps();if(!EO(i,a,this.currentDirection))return;const{projection:l}=this.visualElement,d=this.getAxisMotionValue(i);if(l&&l.layout){const{min:p,max:y}=l.layout.layoutBox[i];d.set(e[i]-us(p,y,.5))}})}scalePositionWithinConstraints(){if(!this.visualElement.current)return;const{drag:e,dragConstraints:i}=this.getProps(),{projection:a}=this.visualElement;if(!DS(i)||!a||!this.constraints)return;this.stopAnimation();const l={x:0,y:0};Ru(p=>{const y=this.getAxisMotionValue(p);if(y&&this.constraints!==!1){const v=y.get();l[p]=hOe({min:v,max:v},this.constraints[p])}});const{transformTemplate:d}=this.visualElement.getProps();this.visualElement.current.style.transform=d?d({},""):"none",a.root&&a.root.updateScroll(),a.updateLayout(),this.resolveConstraints(),Ru(p=>{if(!EO(p,e,null))return;const y=this.getAxisMotionValue(p),{min:v,max:b}=this.constraints[p];y.set(us(v,b,l[p]))})}addListeners(){if(!this.visualElement.current)return;EOe.set(this.visualElement,this);const e=this.visualElement.current,i=Jw(e,"pointerdown",v=>{const{drag:b,dragListener:w=!0}=this.getProps();b&&w&&this.start(v)}),a=()=>{const{dragConstraints:v}=this.getProps();DS(v)&&v.current&&(this.constraints=this.resolveRefConstraints())},{projection:l}=this.visualElement,d=l.addEventListener("measure",a);l&&!l.layout&&(l.root&&l.root.updateScroll(),l.updateLayout()),Xi.read(a);const p=TR(window,"resize",()=>this.scalePositionWithinConstraints()),y=l.addEventListener("didUpdate",({delta:v,hasLayoutChanged:b})=>{this.isDragging&&b&&(Ru(w=>{const A=this.getAxisMotionValue(w);A&&(this.originPoint[w]+=v[w].translate,A.set(A.get()+v[w].translate))}),this.visualElement.render())});return()=>{p(),i(),d(),y&&y()}}getProps(){const e=this.visualElement.getProps(),{drag:i=!1,dragDirectionLock:a=!1,dragPropagation:l=!1,dragConstraints:d=!1,dragElastic:p=BU,dragMomentum:y=!0}=e;return{...e,drag:i,dragDirectionLock:a,dragPropagation:l,dragConstraints:d,dragElastic:p,dragMomentum:y}}}function EO(n,e,i){return(e===!0||e===n)&&(i===null||i===n)}function SOe(n,e=10){let i=null;return Math.abs(n.y)>e?i="y":Math.abs(n.x)>e&&(i="x"),i}class bOe extends kg{constructor(e){super(e),this.removeGroupControls=Dl,this.removeListeners=Dl,this.controls=new vOe(e)}mount(){const{dragControls:e}=this.node.getProps();e&&(this.removeGroupControls=e.subscribe(this.controls)),this.removeListeners=this.controls.addListeners()||Dl}unmount(){this.removeGroupControls(),this.removeListeners()}}const wq=n=>(e,i)=>{n&&Xi.postRender(()=>n(e,i))};class TOe extends kg{constructor(){super(...arguments),this.removePointerDownListener=Dl}onPointerDown(e){this.session=new Nee(e,this.createPanHandlers(),{transformPagePoint:this.node.getTransformPagePoint(),contextWindow:jee(this.node)})}createPanHandlers(){const{onPanSessionStart:e,onPanStart:i,onPan:a,onPanEnd:l}=this.node.getProps();return{onSessionStart:wq(e),onStart:wq(i),onMove:a,onEnd:(d,p)=>{delete this.session,l&&Xi.postRender(()=>l(d,p))}}}mount(){this.removePointerDownListener=Jw(this.node.current,"pointerdown",e=>this.onPointerDown(e))}update(){this.session&&this.session.updateHandlers(this.createPanHandlers())}unmount(){this.removePointerDownListener(),this.session&&this.session.end()}}const ek={hasAnimatedSinceResize:!0,hasEverUpdated:!1};function Rq(n,e){return e.max===e.min?0:n/(e.max-e.min)*100}const lw={correct:(n,e)=>{if(!e.target)return n;if(typeof n=="string")if(Nn.test(n))n=parseFloat(n);else return n;const i=Rq(n,e.target.x),a=Rq(n,e.target.y);return`${i}% ${a}%`}},wOe={correct:(n,{treeScale:e,projectionDelta:i})=>{const a=n,l=Sg.parse(n);if(l.length>5)return a;const d=Sg.createTransformer(n),p=typeof l[0]!="number"?1:0,y=i.x.scale*e.x,v=i.y.scale*e.y;l[0+p]/=y,l[1+p]/=v;const b=us(y,v,.5);return typeof l[2+p]=="number"&&(l[2+p]/=b),typeof l[3+p]=="number"&&(l[3+p]/=b),d(l)}};class ROe extends D.Component{componentDidMount(){const{visualElement:e,layoutGroup:i,switchLayoutGroup:a,layoutId:l}=this.props,{projection:d}=e;HIe(COe),d&&(i.group&&i.group.add(d),a&&a.register&&l&&a.register(d),d.root.didUpdate(),d.addEventListener("animationComplete",()=>{this.safeToRemove()}),d.setOptions({...d.options,onExitComplete:()=>this.safeToRemove()})),ek.hasEverUpdated=!0}getSnapshotBeforeUpdate(e){const{layoutDependency:i,visualElement:a,drag:l,isPresent:d}=this.props,p=a.projection;return p&&(p.isPresent=d,l||e.layoutDependency!==i||i===void 0?p.willUpdate():this.safeToRemove(),e.isPresent!==d&&(d?p.promote():p.relegate()||Xi.postRender(()=>{const y=p.getStack();(!y||!y.members.length)&&this.safeToRemove()}))),null}componentDidUpdate(){const{projection:e}=this.props.visualElement;e&&(e.root.didUpdate(),PF.postRender(()=>{!e.currentAnimation&&e.isLead()&&this.safeToRemove()}))}componentWillUnmount(){const{visualElement:e,layoutGroup:i,switchLayoutGroup:a}=this.props,{projection:l}=e;l&&(l.scheduleCheckAfterUnmount(),i&&i.group&&i.group.remove(l),a&&a.deregister&&a.deregister(l))}safeToRemove(){const{safeToRemove:e}=this.props;e&&e()}render(){return null}}function Bee(n){const[e,i]=TF(),a=D.useContext(vF);return C.jsx(ROe,{...n,layoutGroup:a,switchLayoutGroup:D.useContext(kZ),isPresent:e,safeToRemove:i})}const COe={borderRadius:{...lw,applyTo:["borderTopLeftRadius","borderTopRightRadius","borderBottomLeftRadius","borderBottomRightRadius"]},borderTopLeftRadius:lw,borderTopRightRadius:lw,borderBottomLeftRadius:lw,borderBottomRightRadius:lw,boxShadow:wOe};function IOe(n,e,i){const a=Va(n)?n:SR(n);return a.start(ej("",a,e,i)),a.animation}function AOe(n){return n instanceof SVGElement&&n.tagName!=="svg"}const POe=(n,e)=>n.depth-e.depth;class OOe{constructor(){this.children=[],this.isDirty=!1}add(e){zF(this.children,e),this.isDirty=!0}remove(e){GF(this.children,e),this.isDirty=!0}forEach(e){this.isDirty&&this.children.sort(POe),this.isDirty=!1,this.children.forEach(e)}}function kOe(n,e){const i=Xh.now(),a=({timestamp:l})=>{const d=l-i;d>=e&&(vg(a),n(d-e))};return Xi.read(a,!0),()=>vg(a)}const Wee=["TopLeft","TopRight","BottomLeft","BottomRight"],NOe=Wee.length,Cq=n=>typeof n=="string"?parseFloat(n):n,Iq=n=>typeof n=="number"||Nn.test(n);function DOe(n,e,i,a,l,d){l?(n.opacity=us(0,i.opacity!==void 0?i.opacity:1,LOe(a)),n.opacityExit=us(e.opacity!==void 0?e.opacity:1,0,xOe(a))):d&&(n.opacity=us(e.opacity!==void 0?e.opacity:1,i.opacity!==void 0?i.opacity:1,a));for(let p=0;p<NOe;p++){const y=`border${Wee[p]}Radius`;let v=Aq(e,y),b=Aq(i,y);if(v===void 0&&b===void 0)continue;v||(v=0),b||(b=0),v===0||b===0||Iq(v)===Iq(b)?(n[y]=Math.max(us(Cq(v),Cq(b),a),0),(Yh.test(b)||Yh.test(v))&&(n[y]+="%")):n[y]=b}(e.rotate||i.rotate)&&(n.rotate=us(e.rotate||0,i.rotate||0,a))}function Aq(n,e){return n[e]!==void 0?n[e]:n.borderRadius}const LOe=zee(0,.5,aee),xOe=zee(.5,.95,Dl);function zee(n,e,i){return a=>a<n?0:a>e?1:i(a0(n,e,a))}function Pq(n,e){n.min=e.min,n.max=e.max}function bu(n,e){Pq(n.x,e.x),Pq(n.y,e.y)}function Oq(n,e){n.translate=e.translate,n.scale=e.scale,n.originPoint=e.originPoint,n.origin=e.origin}function kq(n,e,i,a,l){return n-=e,n=kk(n,1/i,a),l!==void 0&&(n=kk(n,1/l,a)),n}function MOe(n,e=0,i=1,a=.5,l,d=n,p=n){if(Yh.test(e)&&(e=parseFloat(e),e=us(p.min,p.max,e/100)-p.min),typeof e!="number")return;let y=us(d.min,d.max,a);n===d&&(y-=e),n.min=kq(n.min,e,i,y,l),n.max=kq(n.max,e,i,y,l)}function Nq(n,e,[i,a,l],d,p){MOe(n,e[i],e[a],e[l],e.scale,d,p)}const UOe=["x","scaleX","originX"],VOe=["y","scaleY","originY"];function Dq(n,e,i,a){Nq(n.x,e,UOe,i?i.x:void 0,a?a.x:void 0),Nq(n.y,e,VOe,i?i.y:void 0,a?a.y:void 0)}function Lq(n){return n.translate===0&&n.scale===1}function Gee(n){return Lq(n.x)&&Lq(n.y)}function xq(n,e){return n.min===e.min&&n.max===e.max}function FOe(n,e){return xq(n.x,e.x)&&xq(n.y,e.y)}function Mq(n,e){return Math.round(n.min)===Math.round(e.min)&&Math.round(n.max)===Math.round(e.max)}function Hee(n,e){return Mq(n.x,e.x)&&Mq(n.y,e.y)}function Uq(n){return xl(n.x)/xl(n.y)}function Vq(n,e){return n.translate===e.translate&&n.scale===e.scale&&n.originPoint===e.originPoint}class jOe{constructor(){this.members=[]}add(e){zF(this.members,e),e.scheduleRender()}remove(e){if(GF(this.members,e),e===this.prevLead&&(this.prevLead=void 0),e===this.lead){const i=this.members[this.members.length-1];i&&this.promote(i)}}relegate(e){const i=this.members.findIndex(l=>e===l);if(i===0)return!1;let a;for(let l=i;l>=0;l--){const d=this.members[l];if(d.isPresent!==!1){a=d;break}}return a?(this.promote(a),!0):!1}promote(e,i){const a=this.lead;if(e!==a&&(this.prevLead=a,this.lead=e,e.show(),a)){a.instance&&a.scheduleRender(),e.scheduleRender(),e.resumeFrom=a,i&&(e.resumeFrom.preserveOpacity=!0),a.snapshot&&(e.snapshot=a.snapshot,e.snapshot.latestValues=a.animationValues||a.latestValues),e.root&&e.root.isUpdating&&(e.isLayoutDirty=!0);const{crossfade:l}=e.options;l===!1&&a.hide()}}exitAnimationComplete(){this.members.forEach(e=>{const{options:i,resumingFrom:a}=e;i.onExitComplete&&i.onExitComplete(),a&&a.options.onExitComplete&&a.options.onExitComplete()})}scheduleRender(){this.members.forEach(e=>{e.instance&&e.scheduleRender(!1)})}removeLeadSnapshot(){this.lead&&this.lead.snapshot&&(this.lead.snapshot=void 0)}}function BOe(n,e,i){let a="";const l=n.x.translate/e.x,d=n.y.translate/e.y,p=(i==null?void 0:i.z)||0;if((l||d||p)&&(a=`translate3d(${l}px, ${d}px, ${p}px) `),(e.x!==1||e.y!==1)&&(a+=`scale(${1/e.x}, ${1/e.y}) `),i){const{transformPerspective:b,rotate:w,rotateX:A,rotateY:N,skewX:V,skewY:j}=i;b&&(a=`perspective(${b}px) ${a}`),w&&(a+=`rotate(${w}deg) `),A&&(a+=`rotateX(${A}deg) `),N&&(a+=`rotateY(${N}deg) `),V&&(a+=`skewX(${V}deg) `),j&&(a+=`skewY(${j}deg) `)}const y=n.x.scale*e.x,v=n.y.scale*e.y;return(y!==1||v!==1)&&(a+=`scale(${y}, ${v})`),a||"none"}const ly={type:"projectionFrame",totalNodes:0,resolvedTargetDeltas:0,recalculatedProjection:0},Lw=typeof window<"u"&&window.MotionDebug!==void 0,R2=["","X","Y","Z"],WOe={visibility:"hidden"},Fq=1e3;let zOe=0;function C2(n,e,i,a){const{latestValues:l}=e;l[n]&&(i[n]=l[n],e.setStaticValue(n,0),a&&(a[n]=0))}function $ee(n){if(n.hasCheckedOptimisedAppear=!0,n.root===n)return;const{visualElement:e}=n.options;if(!e)return;const i=eee(e);if(window.MotionHasOptimisedAnimation(i,"transform")){const{layout:l,layoutId:d}=n.options;window.MotionCancelOptimisedAnimation(i,"transform",Xi,!(l||d))}const{parent:a}=n;a&&!a.hasCheckedOptimisedAppear&&$ee(a)}function Kee({attachResizeListener:n,defaultParent:e,measureScroll:i,checkIsScrollRoot:a,resetTransform:l}){return class{constructor(p={},y=e==null?void 0:e()){this.id=zOe++,this.animationId=0,this.children=new Set,this.options={},this.isTreeAnimating=!1,this.isAnimationBlocked=!1,this.isLayoutDirty=!1,this.isProjectionDirty=!1,this.isSharedProjectionDirty=!1,this.isTransformDirty=!1,this.updateManuallyBlocked=!1,this.updateBlockedByResize=!1,this.isUpdating=!1,this.isSVG=!1,this.needsReset=!1,this.shouldResetTransform=!1,this.hasCheckedOptimisedAppear=!1,this.treeScale={x:1,y:1},this.eventHandlers=new Map,this.hasTreeAnimated=!1,this.updateScheduled=!1,this.scheduleUpdate=()=>this.update(),this.projectionUpdateScheduled=!1,this.checkUpdateFailed=()=>{this.isUpdating&&(this.isUpdating=!1,this.clearAllSnapshots())},this.updateProjection=()=>{this.projectionUpdateScheduled=!1,Lw&&(ly.totalNodes=ly.resolvedTargetDeltas=ly.recalculatedProjection=0),this.nodes.forEach($Oe),this.nodes.forEach(JOe),this.nodes.forEach(QOe),this.nodes.forEach(KOe),Lw&&window.MotionDebug.record(ly)},this.resolvedRelativeTargetAt=0,this.hasProjected=!1,this.isVisible=!0,this.animationProgress=0,this.sharedNodes=new Map,this.latestValues=p,this.root=y?y.root||y:this,this.path=y?[...y.path,y]:[],this.parent=y,this.depth=y?y.depth+1:0;for(let v=0;v<this.path.length;v++)this.path[v].shouldResetTransform=!0;this.root===this&&(this.nodes=new OOe)}addEventListener(p,y){return this.eventHandlers.has(p)||this.eventHandlers.set(p,new HF),this.eventHandlers.get(p).add(y)}notifyListeners(p,...y){const v=this.eventHandlers.get(p);v&&v.notify(...y)}hasListeners(p){return this.eventHandlers.has(p)}mount(p,y=this.root.hasTreeAnimated){if(this.instance)return;this.isSVG=AOe(p),this.instance=p;const{layoutId:v,layout:b,visualElement:w}=this.options;if(w&&!w.current&&w.mount(p),this.root.nodes.add(this),this.parent&&this.parent.children.add(this),y&&(b||v)&&(this.isLayoutDirty=!0),n){let A;const N=()=>this.root.updateBlockedByResize=!1;n(p,()=>{this.root.updateBlockedByResize=!0,A&&A(),A=kOe(N,250),ek.hasAnimatedSinceResize&&(ek.hasAnimatedSinceResize=!1,this.nodes.forEach(Bq))})}v&&this.root.registerSharedNode(v,this),this.options.animate!==!1&&w&&(v||b)&&this.addEventListener("didUpdate",({delta:A,hasLayoutChanged:N,hasRelativeTargetChanged:V,layout:j})=>{if(this.isTreeAnimationBlocked()){this.target=void 0,this.relativeTarget=void 0;return}const B=this.options.transition||w.getDefaultTransition()||rke,{onLayoutAnimationStart:G,onLayoutAnimationComplete:ee}=w.getProps(),K=!this.targetLayout||!Hee(this.targetLayout,j)||V,ne=!N&&V;if(this.options.layoutRoot||this.resumeFrom&&this.resumeFrom.instance||ne||N&&(K||!this.currentAnimation)){this.resumeFrom&&(this.resumingFrom=this.resumeFrom,this.resumingFrom.resumingFrom=void 0),this.setAnimationOrigin(A,ne);const ce={...FF(B,"layout"),onPlay:G,onComplete:ee};(w.shouldReduceMotion||this.options.layoutRoot)&&(ce.delay=0,ce.type=!1),this.startAnimation(ce)}else N||Bq(this),this.isLead()&&this.options.onExitComplete&&this.options.onExitComplete();this.targetLayout=j})}unmount(){this.options.layoutId&&this.willUpdate(),this.root.nodes.remove(this);const p=this.getStack();p&&p.remove(this),this.parent&&this.parent.children.delete(this),this.instance=void 0,vg(this.updateProjection)}blockUpdate(){this.updateManuallyBlocked=!0}unblockUpdate(){this.updateManuallyBlocked=!1}isUpdateBlocked(){return this.updateManuallyBlocked||this.updateBlockedByResize}isTreeAnimationBlocked(){return this.isAnimationBlocked||this.parent&&this.parent.isTreeAnimationBlocked()||!1}startUpdate(){this.isUpdateBlocked()||(this.isUpdating=!0,this.nodes&&this.nodes.forEach(ZOe),this.animationId++)}getTransformTemplate(){const{visualElement:p}=this.options;return p&&p.getProps().transformTemplate}willUpdate(p=!0){if(this.root.hasTreeAnimated=!0,this.root.isUpdateBlocked()){this.options.onExitComplete&&this.options.onExitComplete();return}if(window.MotionCancelOptimisedAnimation&&!this.hasCheckedOptimisedAppear&&$ee(this),!this.root.isUpdating&&this.root.startUpdate(),this.isLayoutDirty)return;this.isLayoutDirty=!0;for(let w=0;w<this.path.length;w++){const A=this.path[w];A.shouldResetTransform=!0,A.updateScroll("snapshot"),A.options.layoutRoot&&A.willUpdate(!1)}const{layoutId:y,layout:v}=this.options;if(y===void 0&&!v)return;const b=this.getTransformTemplate();this.prevTransformTemplateValue=b?b(this.latestValues,""):void 0,this.updateSnapshot(),p&&this.notifyListeners("willUpdate")}update(){if(this.updateScheduled=!1,this.isUpdateBlocked()){this.unblockUpdate(),this.clearAllSnapshots(),this.nodes.forEach(jq);return}this.isUpdating||this.nodes.forEach(YOe),this.isUpdating=!1,this.nodes.forEach(XOe),this.nodes.forEach(GOe),this.nodes.forEach(HOe),this.clearAllSnapshots();const y=Xh.now();Zo.delta=Op(0,1e3/60,y-Zo.timestamp),Zo.timestamp=y,Zo.isProcessing=!0,_2.update.process(Zo),_2.preRender.process(Zo),_2.render.process(Zo),Zo.isProcessing=!1}didUpdate(){this.updateScheduled||(this.updateScheduled=!0,PF.read(this.scheduleUpdate))}clearAllSnapshots(){this.nodes.forEach(qOe),this.sharedNodes.forEach(eke)}scheduleUpdateProjection(){this.projectionUpdateScheduled||(this.projectionUpdateScheduled=!0,Xi.preRender(this.updateProjection,!1,!0))}scheduleCheckAfterUnmount(){Xi.postRender(()=>{this.isLayoutDirty?this.root.didUpdate():this.root.checkUpdateFailed()})}updateSnapshot(){this.snapshot||!this.instance||(this.snapshot=this.measure())}updateLayout(){if(!this.instance||(this.updateScroll(),!(this.options.alwaysMeasureLayout&&this.isLead())&&!this.isLayoutDirty))return;if(this.resumeFrom&&!this.resumeFrom.instance)for(let v=0;v<this.path.length;v++)this.path[v].updateScroll();const p=this.layout;this.layout=this.measure(!1),this.layoutCorrected=Ms(),this.isLayoutDirty=!1,this.projectionDelta=void 0,this.notifyListeners("measure",this.layout.layoutBox);const{visualElement:y}=this.options;y&&y.notify("LayoutMeasure",this.layout.layoutBox,p?p.layoutBox:void 0)}updateScroll(p="measure"){let y=!!(this.options.layoutScroll&&this.instance);if(this.scroll&&this.scroll.animationId===this.root.animationId&&this.scroll.phase===p&&(y=!1),y){const v=a(this.instance);this.scroll={animationId:this.root.animationId,phase:p,isRoot:v,offset:i(this.instance),wasRoot:this.scroll?this.scroll.isRoot:v}}}resetTransform(){if(!l)return;const p=this.isLayoutDirty||this.shouldResetTransform||this.options.alwaysMeasureLayout,y=this.projectionDelta&&!Gee(this.projectionDelta),v=this.getTransformTemplate(),b=v?v(this.latestValues,""):void 0,w=b!==this.prevTransformTemplateValue;p&&(y||cy(this.latestValues)||w)&&(l(this.instance,b),this.shouldResetTransform=!1,this.scheduleRender())}measure(p=!0){const y=this.measurePageBox();let v=this.removeElementScroll(y);return p&&(v=this.removeTransform(v)),ike(v),{animationId:this.root.animationId,measuredBox:y,layoutBox:v,latestValues:{},source:this.id}}measurePageBox(){var p;const{visualElement:y}=this.options;if(!y)return Ms();const v=y.measureViewportBox();if(!(((p=this.scroll)===null||p===void 0?void 0:p.wasRoot)||this.path.some(ske))){const{scroll:w}=this.root;w&&(MS(v.x,w.offset.x),MS(v.y,w.offset.y))}return v}removeElementScroll(p){var y;const v=Ms();if(bu(v,p),!((y=this.scroll)===null||y===void 0)&&y.wasRoot)return v;for(let b=0;b<this.path.length;b++){const w=this.path[b],{scroll:A,options:N}=w;w!==this.root&&A&&N.layoutScroll&&(A.wasRoot&&bu(v,p),MS(v.x,A.offset.x),MS(v.y,A.offset.y))}return v}applyTransform(p,y=!1){const v=Ms();bu(v,p);for(let b=0;b<this.path.length;b++){const w=this.path[b];!y&&w.options.layoutScroll&&w.scroll&&w!==w.root&&US(v,{x:-w.scroll.offset.x,y:-w.scroll.offset.y}),cy(w.latestValues)&&US(v,w.latestValues)}return cy(this.latestValues)&&US(v,this.latestValues),v}removeTransform(p){const y=Ms();bu(y,p);for(let v=0;v<this.path.length;v++){const b=this.path[v];if(!b.instance||!cy(b.latestValues))continue;WU(b.latestValues)&&b.updateSnapshot();const w=Ms(),A=b.measurePageBox();bu(w,A),Dq(y,b.latestValues,b.snapshot?b.snapshot.layoutBox:void 0,w)}return cy(this.latestValues)&&Dq(y,this.latestValues),y}setTargetDelta(p){this.targetDelta=p,this.root.scheduleUpdateProjection(),this.isProjectionDirty=!0}setOptions(p){this.options={...this.options,...p,crossfade:p.crossfade!==void 0?p.crossfade:!0}}clearMeasurements(){this.scroll=void 0,this.layout=void 0,this.snapshot=void 0,this.prevTransformTemplateValue=void 0,this.targetDelta=void 0,this.target=void 0,this.isLayoutDirty=!1}forceRelativeParentToResolveTarget(){this.relativeParent&&this.relativeParent.resolvedRelativeTargetAt!==Zo.timestamp&&this.relativeParent.resolveTargetDelta(!0)}resolveTargetDelta(p=!1){var y;const v=this.getLead();this.isProjectionDirty||(this.isProjectionDirty=v.isProjectionDirty),this.isTransformDirty||(this.isTransformDirty=v.isTransformDirty),this.isSharedProjectionDirty||(this.isSharedProjectionDirty=v.isSharedProjectionDirty);const b=!!this.resumingFrom||this!==v;if(!(p||b&&this.isSharedProjectionDirty||this.isProjectionDirty||!((y=this.parent)===null||y===void 0)&&y.isProjectionDirty||this.attemptToResolveRelativeTarget||this.root.updateBlockedByResize))return;const{layout:A,layoutId:N}=this.options;if(!(!this.layout||!(A||N))){if(this.resolvedRelativeTargetAt=Zo.timestamp,!this.targetDelta&&!this.relativeTarget){const V=this.getClosestProjectingParent();V&&V.layout&&this.animationProgress!==1?(this.relativeParent=V,this.forceRelativeParentToResolveTarget(),this.relativeTarget=Ms(),this.relativeTargetOrigin=Ms(),Zw(this.relativeTargetOrigin,this.layout.layoutBox,V.layout.layoutBox),bu(this.relativeTarget,this.relativeTargetOrigin)):this.relativeParent=this.relativeTarget=void 0}if(!(!this.relativeTarget&&!this.targetDelta)){if(this.target||(this.target=Ms(),this.targetWithTransforms=Ms()),this.relativeTarget&&this.relativeTargetOrigin&&this.relativeParent&&this.relativeParent.target?(this.forceRelativeParentToResolveTarget(),cOe(this.target,this.relativeTarget,this.relativeParent.target)):this.targetDelta?(this.resumingFrom?this.target=this.applyTransform(this.layout.layoutBox):bu(this.target,this.layout.layoutBox),Vee(this.target,this.targetDelta)):bu(this.target,this.layout.layoutBox),this.attemptToResolveRelativeTarget){this.attemptToResolveRelativeTarget=!1;const V=this.getClosestProjectingParent();V&&!!V.resumingFrom==!!this.resumingFrom&&!V.options.layoutScroll&&V.target&&this.animationProgress!==1?(this.relativeParent=V,this.forceRelativeParentToResolveTarget(),this.relativeTarget=Ms(),this.relativeTargetOrigin=Ms(),Zw(this.relativeTargetOrigin,this.target,V.target),bu(this.relativeTarget,this.relativeTargetOrigin)):this.relativeParent=this.relativeTarget=void 0}Lw&&ly.resolvedTargetDeltas++}}}getClosestProjectingParent(){if(!(!this.parent||WU(this.parent.latestValues)||Uee(this.parent.latestValues)))return this.parent.isProjecting()?this.parent:this.parent.getClosestProjectingParent()}isProjecting(){return!!((this.relativeTarget||this.targetDelta||this.options.layoutRoot)&&this.layout)}calcProjection(){var p;const y=this.getLead(),v=!!this.resumingFrom||this!==y;let b=!0;if((this.isProjectionDirty||!((p=this.parent)===null||p===void 0)&&p.isProjectionDirty)&&(b=!1),v&&(this.isSharedProjectionDirty||this.isTransformDirty)&&(b=!1),this.resolvedRelativeTargetAt===Zo.timestamp&&(b=!1),b)return;const{layout:w,layoutId:A}=this.options;if(this.isTreeAnimating=!!(this.parent&&this.parent.isTreeAnimating||this.currentAnimation||this.pendingAnimation),this.isTreeAnimating||(this.targetDelta=this.relativeTarget=void 0),!this.layout||!(w||A))return;bu(this.layoutCorrected,this.layout.layoutBox);const N=this.treeScale.x,V=this.treeScale.y;_Oe(this.layoutCorrected,this.treeScale,this.path,v),y.layout&&!y.target&&(this.treeScale.x!==1||this.treeScale.y!==1)&&(y.target=y.layout.layoutBox,y.targetWithTransforms=Ms());const{target:j}=y;if(!j){this.prevProjectionDelta&&(this.createProjectionDeltas(),this.scheduleRender());return}!this.projectionDelta||!this.prevProjectionDelta?this.createProjectionDeltas():(Oq(this.prevProjectionDelta.x,this.projectionDelta.x),Oq(this.prevProjectionDelta.y,this.projectionDelta.y)),Qw(this.projectionDelta,this.layoutCorrected,j,this.latestValues),(this.treeScale.x!==N||this.treeScale.y!==V||!Vq(this.projectionDelta.x,this.prevProjectionDelta.x)||!Vq(this.projectionDelta.y,this.prevProjectionDelta.y))&&(this.hasProjected=!0,this.scheduleRender(),this.notifyListeners("projectionUpdate",j)),Lw&&ly.recalculatedProjection++}hide(){this.isVisible=!1}show(){this.isVisible=!0}scheduleRender(p=!0){var y;if((y=this.options.visualElement)===null||y===void 0||y.scheduleRender(),p){const v=this.getStack();v&&v.scheduleRender()}this.resumingFrom&&!this.resumingFrom.instance&&(this.resumingFrom=void 0)}createProjectionDeltas(){this.prevProjectionDelta=xS(),this.projectionDelta=xS(),this.projectionDeltaWithTransform=xS()}setAnimationOrigin(p,y=!1){const v=this.snapshot,b=v?v.latestValues:{},w={...this.latestValues},A=xS();(!this.relativeParent||!this.relativeParent.options.layoutRoot)&&(this.relativeTarget=this.relativeTargetOrigin=void 0),this.attemptToResolveRelativeTarget=!y;const N=Ms(),V=v?v.source:void 0,j=this.layout?this.layout.source:void 0,B=V!==j,G=this.getStack(),ee=!G||G.members.length<=1,K=!!(B&&!ee&&this.options.crossfade===!0&&!this.path.some(nke));this.animationProgress=0;let ne;this.mixTargetDelta=ce=>{const oe=ce/1e3;Wq(A.x,p.x,oe),Wq(A.y,p.y,oe),this.setTargetDelta(A),this.relativeTarget&&this.relativeTargetOrigin&&this.layout&&this.relativeParent&&this.relativeParent.layout&&(Zw(N,this.layout.layoutBox,this.relativeParent.layout.layoutBox),tke(this.relativeTarget,this.relativeTargetOrigin,N,oe),ne&&FOe(this.relativeTarget,ne)&&(this.isProjectionDirty=!1),ne||(ne=Ms()),bu(ne,this.relativeTarget)),B&&(this.animationValues=w,DOe(w,b,this.latestValues,oe,K,ee)),this.root.scheduleUpdateProjection(),this.scheduleRender(),this.animationProgress=oe},this.mixTargetDelta(this.options.layoutRoot?1e3:0)}startAnimation(p){this.notifyListeners("animationStart"),this.currentAnimation&&this.currentAnimation.stop(),this.resumingFrom&&this.resumingFrom.currentAnimation&&this.resumingFrom.currentAnimation.stop(),this.pendingAnimation&&(vg(this.pendingAnimation),this.pendingAnimation=void 0),this.pendingAnimation=Xi.update(()=>{ek.hasAnimatedSinceResize=!0,this.currentAnimation=IOe(0,Fq,{...p,onUpdate:y=>{this.mixTargetDelta(y),p.onUpdate&&p.onUpdate(y)},onComplete:()=>{p.onComplete&&p.onComplete(),this.completeAnimation()}}),this.resumingFrom&&(this.resumingFrom.currentAnimation=this.currentAnimation),this.pendingAnimation=void 0})}completeAnimation(){this.resumingFrom&&(this.resumingFrom.currentAnimation=void 0,this.resumingFrom.preserveOpacity=void 0);const p=this.getStack();p&&p.exitAnimationComplete(),this.resumingFrom=this.currentAnimation=this.animationValues=void 0,this.notifyListeners("animationComplete")}finishAnimation(){this.currentAnimation&&(this.mixTargetDelta&&this.mixTargetDelta(Fq),this.currentAnimation.stop()),this.completeAnimation()}applyTransformsToTarget(){const p=this.getLead();let{targetWithTransforms:y,target:v,layout:b,latestValues:w}=p;if(!(!y||!v||!b)){if(this!==p&&this.layout&&b&&qee(this.options.animationType,this.layout.layoutBox,b.layoutBox)){v=this.target||Ms();const A=xl(this.layout.layoutBox.x);v.x.min=p.target.x.min,v.x.max=v.x.min+A;const N=xl(this.layout.layoutBox.y);v.y.min=p.target.y.min,v.y.max=v.y.min+N}bu(y,v),US(y,w),Qw(this.projectionDeltaWithTransform,this.layoutCorrected,y,w)}}registerSharedNode(p,y){this.sharedNodes.has(p)||this.sharedNodes.set(p,new jOe),this.sharedNodes.get(p).add(y);const b=y.options.initialPromotionConfig;y.promote({transition:b?b.transition:void 0,preserveFollowOpacity:b&&b.shouldPreserveFollowOpacity?b.shouldPreserveFollowOpacity(y):void 0})}isLead(){const p=this.getStack();return p?p.lead===this:!0}getLead(){var p;const{layoutId:y}=this.options;return y?((p=this.getStack())===null||p===void 0?void 0:p.lead)||this:this}getPrevLead(){var p;const{layoutId:y}=this.options;return y?(p=this.getStack())===null||p===void 0?void 0:p.prevLead:void 0}getStack(){const{layoutId:p}=this.options;if(p)return this.root.sharedNodes.get(p)}promote({needsReset:p,transition:y,preserveFollowOpacity:v}={}){const b=this.getStack();b&&b.promote(this,v),p&&(this.projectionDelta=void 0,this.needsReset=!0),y&&this.setOptions({transition:y})}relegate(){const p=this.getStack();return p?p.relegate(this):!1}resetSkewAndRotation(){const{visualElement:p}=this.options;if(!p)return;let y=!1;const{latestValues:v}=p;if((v.z||v.rotate||v.rotateX||v.rotateY||v.rotateZ||v.skewX||v.skewY)&&(y=!0),!y)return;const b={};v.z&&C2("z",p,b,this.animationValues);for(let w=0;w<R2.length;w++)C2(`rotate${R2[w]}`,p,b,this.animationValues),C2(`skew${R2[w]}`,p,b,this.animationValues);p.render();for(const w in b)p.setStaticValue(w,b[w]),this.animationValues&&(this.animationValues[w]=b[w]);p.scheduleRender()}getProjectionStyles(p){var y,v;if(!this.instance||this.isSVG)return;if(!this.isVisible)return WOe;const b={visibility:""},w=this.getTransformTemplate();if(this.needsReset)return this.needsReset=!1,b.opacity="",b.pointerEvents=QO(p==null?void 0:p.pointerEvents)||"",b.transform=w?w(this.latestValues,""):"none",b;const A=this.getLead();if(!this.projectionDelta||!this.layout||!A.target){const B={};return this.options.layoutId&&(B.opacity=this.latestValues.opacity!==void 0?this.latestValues.opacity:1,B.pointerEvents=QO(p==null?void 0:p.pointerEvents)||""),this.hasProjected&&!cy(this.latestValues)&&(B.transform=w?w({},""):"none",this.hasProjected=!1),B}const N=A.animationValues||A.latestValues;this.applyTransformsToTarget(),b.transform=BOe(this.projectionDeltaWithTransform,this.treeScale,N),w&&(b.transform=w(N,b.transform));const{x:V,y:j}=this.projectionDelta;b.transformOrigin=`${V.origin*100}% ${j.origin*100}% 0`,A.animationValues?b.opacity=A===this?(v=(y=N.opacity)!==null&&y!==void 0?y:this.latestValues.opacity)!==null&&v!==void 0?v:1:this.preserveOpacity?this.latestValues.opacity:N.opacityExit:b.opacity=A===this?N.opacity!==void 0?N.opacity:"":N.opacityExit!==void 0?N.opacityExit:0;for(const B in Ck){if(N[B]===void 0)continue;const{correct:G,applyTo:ee}=Ck[B],K=b.transform==="none"?N[B]:G(N[B],A);if(ee){const ne=ee.length;for(let ce=0;ce<ne;ce++)b[ee[ce]]=K}else b[B]=K}return this.options.layoutId&&(b.pointerEvents=A===this?QO(p==null?void 0:p.pointerEvents)||"":"none"),b}clearSnapshot(){this.resumeFrom=this.snapshot=void 0}resetTree(){this.root.nodes.forEach(p=>{var y;return(y=p.currentAnimation)===null||y===void 0?void 0:y.stop()}),this.root.nodes.forEach(jq),this.root.sharedNodes.clear()}}}function GOe(n){n.updateLayout()}function HOe(n){var e;const i=((e=n.resumeFrom)===null||e===void 0?void 0:e.snapshot)||n.snapshot;if(n.isLead()&&n.layout&&i&&n.hasListeners("didUpdate")){const{layoutBox:a,measuredBox:l}=n.layout,{animationType:d}=n.options,p=i.source!==n.layout.source;d==="size"?Ru(A=>{const N=p?i.measuredBox[A]:i.layoutBox[A],V=xl(N);N.min=a[A].min,N.max=N.min+V}):qee(d,i.layoutBox,a)&&Ru(A=>{const N=p?i.measuredBox[A]:i.layoutBox[A],V=xl(a[A]);N.max=N.min+V,n.relativeTarget&&!n.currentAnimation&&(n.isProjectionDirty=!0,n.relativeTarget[A].max=n.relativeTarget[A].min+V)});const y=xS();Qw(y,a,i.layoutBox);const v=xS();p?Qw(v,n.applyTransform(l,!0),i.measuredBox):Qw(v,a,i.layoutBox);const b=!Gee(y);let w=!1;if(!n.resumeFrom){const A=n.getClosestProjectingParent();if(A&&!A.resumeFrom){const{snapshot:N,layout:V}=A;if(N&&V){const j=Ms();Zw(j,i.layoutBox,N.layoutBox);const B=Ms();Zw(B,a,V.layoutBox),Hee(j,B)||(w=!0),A.options.layoutRoot&&(n.relativeTarget=B,n.relativeTargetOrigin=j,n.relativeParent=A)}}}n.notifyListeners("didUpdate",{layout:a,snapshot:i,delta:v,layoutDelta:y,hasLayoutChanged:b,hasRelativeTargetChanged:w})}else if(n.isLead()){const{onExitComplete:a}=n.options;a&&a()}n.options.transition=void 0}function $Oe(n){Lw&&ly.totalNodes++,n.parent&&(n.isProjecting()||(n.isProjectionDirty=n.parent.isProjectionDirty),n.isSharedProjectionDirty||(n.isSharedProjectionDirty=!!(n.isProjectionDirty||n.parent.isProjectionDirty||n.parent.isSharedProjectionDirty)),n.isTransformDirty||(n.isTransformDirty=n.parent.isTransformDirty))}function KOe(n){n.isProjectionDirty=n.isSharedProjectionDirty=n.isTransformDirty=!1}function qOe(n){n.clearSnapshot()}function jq(n){n.clearMeasurements()}function YOe(n){n.isLayoutDirty=!1}function XOe(n){const{visualElement:e}=n.options;e&&e.getProps().onBeforeLayoutMeasure&&e.notify("BeforeLayoutMeasure"),n.resetTransform()}function Bq(n){n.finishAnimation(),n.targetDelta=n.relativeTarget=n.target=void 0,n.isProjectionDirty=!0}function JOe(n){n.resolveTargetDelta()}function QOe(n){n.calcProjection()}function ZOe(n){n.resetSkewAndRotation()}function eke(n){n.removeLeadSnapshot()}function Wq(n,e,i){n.translate=us(e.translate,0,i),n.scale=us(e.scale,1,i),n.origin=e.origin,n.originPoint=e.originPoint}function zq(n,e,i,a){n.min=us(e.min,i.min,a),n.max=us(e.max,i.max,a)}function tke(n,e,i,a){zq(n.x,e.x,i.x,a),zq(n.y,e.y,i.y,a)}function nke(n){return n.animationValues&&n.animationValues.opacityExit!==void 0}const rke={duration:.45,ease:[.4,0,.1,1]},Gq=n=>typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().includes(n),Hq=Gq("applewebkit/")&&!Gq("chrome/")?Math.round:Dl;function $q(n){n.min=Hq(n.min),n.max=Hq(n.max)}function ike(n){$q(n.x),$q(n.y)}function qee(n,e,i){return n==="position"||n==="preserve-aspect"&&!aOe(Uq(e),Uq(i),.2)}function ske(n){var e;return n!==n.root&&((e=n.scroll)===null||e===void 0?void 0:e.wasRoot)}const oke=Kee({attachResizeListener:(n,e)=>TR(n,"resize",e),measureScroll:()=>({x:document.documentElement.scrollLeft||document.body.scrollLeft,y:document.documentElement.scrollTop||document.body.scrollTop}),checkIsScrollRoot:()=>!0}),I2={current:void 0},Yee=Kee({measureScroll:n=>({x:n.scrollLeft,y:n.scrollTop}),defaultParent:()=>{if(!I2.current){const n=new oke({});n.mount(window),n.setOptions({layoutScroll:!0}),I2.current=n}return I2.current},resetTransform:(n,e)=>{n.style.transform=e!==void 0?e:"none"},checkIsScrollRoot:n=>window.getComputedStyle(n).position==="fixed"}),ake={pan:{Feature:TOe},drag:{Feature:bOe,ProjectionNode:Yee,MeasureLayout:Bee}};function Kq(n,e,i){const{props:a}=n;n.animationState&&a.whileHover&&n.animationState.setActive("whileHover",i==="Start");const l="onHover"+i,d=a[l];d&&Xi.postRender(()=>d(e,JR(e)))}class cke extends kg{mount(){const{current:e}=this.node;e&&(this.unmount=aAe(e,i=>(Kq(this.node,i,"Start"),a=>Kq(this.node,a,"End"))))}unmount(){}}class lke extends kg{constructor(){super(...arguments),this.isActive=!1}onFocus(){let e=!1;try{e=this.node.current.matches(":focus-visible")}catch{e=!0}!e||!this.node.animationState||(this.node.animationState.setActive("whileFocus",!0),this.isActive=!0)}onBlur(){!this.isActive||!this.node.animationState||(this.node.animationState.setActive("whileFocus",!1),this.isActive=!1)}mount(){this.unmount=XR(TR(this.node.current,"focus",()=>this.onFocus()),TR(this.node.current,"blur",()=>this.onBlur()))}unmount(){}}function qq(n,e,i){const{props:a}=n;n.animationState&&a.whileTap&&n.animationState.setActive("whileTap",i==="Start");const l="onTap"+(i==="End"?"":i),d=a[l];d&&Xi.postRender(()=>d(e,JR(e)))}class uke extends kg{mount(){const{current:e}=this.node;e&&(this.unmount=dAe(e,i=>(qq(this.node,i,"Start"),(a,{success:l})=>qq(this.node,a,l?"End":"Cancel")),{useGlobalTarget:this.node.props.globalTapTarget}))}unmount(){}}const GU=new WeakMap,A2=new WeakMap,dke=n=>{const e=GU.get(n.target);e&&e(n)},hke=n=>{n.forEach(dke)};function fke({root:n,...e}){const i=n||document;A2.has(i)||A2.set(i,{});const a=A2.get(i),l=JSON.stringify(e);return a[l]||(a[l]=new IntersectionObserver(hke,{root:n,...e})),a[l]}function pke(n,e,i){const a=fke(e);return GU.set(n,i),a.observe(n),()=>{GU.delete(n),a.unobserve(n)}}const mke={some:0,all:1};class gke extends kg{constructor(){super(...arguments),this.hasEnteredView=!1,this.isInView=!1}startObserver(){this.unmount();const{viewport:e={}}=this.node.getProps(),{root:i,margin:a,amount:l="some",once:d}=e,p={root:i?i.current:void 0,rootMargin:a,threshold:typeof l=="number"?l:mke[l]},y=v=>{const{isIntersecting:b}=v;if(this.isInView===b||(this.isInView=b,d&&!b&&this.hasEnteredView))return;b&&(this.hasEnteredView=!0),this.node.animationState&&this.node.animationState.setActive("whileInView",b);const{onViewportEnter:w,onViewportLeave:A}=this.node.getProps(),N=b?w:A;N&&N(v)};return pke(this.node.current,p,y)}mount(){this.startObserver()}update(){if(typeof IntersectionObserver>"u")return;const{props:e,prevProps:i}=this.node;["amount","margin","root"].some(_ke(e,i))&&this.startObserver()}unmount(){}}function _ke({viewport:n={}},{viewport:e={}}={}){return i=>n[i]!==e[i]}const yke={inView:{Feature:gke},tap:{Feature:uke},focus:{Feature:lke},hover:{Feature:cke}},Eke={layout:{ProjectionNode:Yee,MeasureLayout:Bee}},HU={current:null},Xee={current:!1};function vke(){if(Xee.current=!0,!!wF)if(window.matchMedia){const n=window.matchMedia("(prefers-reduced-motion)"),e=()=>HU.current=n.matches;n.addListener(e),e()}else HU.current=!1}const Ske=[...See,La,Sg],bke=n=>Ske.find(vee(n)),Yq=new WeakMap;function Tke(n,e,i){for(const a in e){const l=e[a],d=i[a];if(Va(l))n.addValue(a,l);else if(Va(d))n.addValue(a,SR(l,{owner:n}));else if(d!==l)if(n.hasValue(a)){const p=n.getValue(a);p.liveStyle===!0?p.jump(l):p.hasAnimated||p.set(l)}else{const p=n.getStaticValue(a);n.addValue(a,SR(p!==void 0?p:l,{owner:n}))}}for(const a in i)e[a]===void 0&&n.removeValue(a);return e}const Xq=["AnimationStart","AnimationComplete","Update","BeforeLayoutMeasure","LayoutMeasure","LayoutAnimationStart","LayoutAnimationComplete"];class wke{scrapeMotionValuesFromProps(e,i,a){return{}}constructor({parent:e,props:i,presenceContext:a,reducedMotionConfig:l,blockInitialAnimation:d,visualState:p},y={}){this.current=null,this.children=new Set,this.isVariantNode=!1,this.isControllingVariants=!1,this.shouldReduceMotion=null,this.values=new Map,this.KeyframeResolver=JF,this.features={},this.valueSubscriptions=new Map,this.prevMotionValues={},this.events={},this.propEventSubscriptions={},this.notifyUpdate=()=>this.notify("Update",this.latestValues),this.render=()=>{this.current&&(this.triggerBuild(),this.renderInstance(this.current,this.renderState,this.props.style,this.projection))},this.renderScheduledAt=0,this.scheduleRender=()=>{const V=Xh.now();this.renderScheduledAt<V&&(this.renderScheduledAt=V,Xi.render(this.render,!1,!0))};const{latestValues:v,renderState:b,onUpdate:w}=p;this.onUpdate=w,this.latestValues=v,this.baseTarget={...v},this.initialValues=i.initial?{...v}:{},this.renderState=b,this.parent=e,this.props=i,this.presenceContext=a,this.depth=e?e.depth+1:0,this.reducedMotionConfig=l,this.options=y,this.blockInitialAnimation=!!d,this.isControllingVariants=w1(i),this.isVariantNode=PZ(i),this.isVariantNode&&(this.variantChildren=new Set),this.manuallyAnimateOnMount=!!(e&&e.current);const{willChange:A,...N}=this.scrapeMotionValuesFromProps(i,{},this);for(const V in N){const j=N[V];v[V]!==void 0&&Va(j)&&j.set(v[V],!1)}}mount(e){this.current=e,Yq.set(e,this),this.projection&&!this.projection.instance&&this.projection.mount(e),this.parent&&this.isVariantNode&&!this.isControllingVariants&&(this.removeFromVariantTree=this.parent.addVariantChild(this)),this.values.forEach((i,a)=>this.bindToMotionValue(a,i)),Xee.current||vke(),this.shouldReduceMotion=this.reducedMotionConfig==="never"?!1:this.reducedMotionConfig==="always"?!0:HU.current,this.parent&&this.parent.children.add(this),this.update(this.props,this.presenceContext)}unmount(){Yq.delete(this.current),this.projection&&this.projection.unmount(),vg(this.notifyUpdate),vg(this.render),this.valueSubscriptions.forEach(e=>e()),this.valueSubscriptions.clear(),this.removeFromVariantTree&&this.removeFromVariantTree(),this.parent&&this.parent.children.delete(this);for(const e in this.events)this.events[e].clear();for(const e in this.features){const i=this.features[e];i&&(i.unmount(),i.isMounted=!1)}this.current=null}bindToMotionValue(e,i){this.valueSubscriptions.has(e)&&this.valueSubscriptions.get(e)();const a=zy.has(e),l=i.on("change",y=>{this.latestValues[e]=y,this.props.onUpdate&&Xi.preRender(this.notifyUpdate),a&&this.projection&&(this.projection.isTransformDirty=!0)}),d=i.on("renderRequest",this.scheduleRender);let p;window.MotionCheckAppearSync&&(p=window.MotionCheckAppearSync(this,e,i)),this.valueSubscriptions.set(e,()=>{l(),d(),p&&p(),i.owner&&i.stop()})}sortNodePosition(e){return!this.current||!this.sortInstanceNodePosition||this.type!==e.type?0:this.sortInstanceNodePosition(this.current,e.current)}updateFeatures(){let e="animation";for(e in c0){const i=c0[e];if(!i)continue;const{isEnabled:a,Feature:l}=i;if(!this.features[e]&&l&&a(this.props)&&(this.features[e]=new l(this)),this.features[e]){const d=this.features[e];d.isMounted?d.update():(d.mount(),d.isMounted=!0)}}}triggerBuild(){this.build(this.renderState,this.latestValues,this.props)}measureViewportBox(){return this.current?this.measureInstanceViewportBox(this.current,this.props):Ms()}getStaticValue(e){return this.latestValues[e]}setStaticValue(e,i){this.latestValues[e]=i}update(e,i){(e.transformTemplate||this.props.transformTemplate)&&this.scheduleRender(),this.prevProps=this.props,this.props=e,this.prevPresenceContext=this.presenceContext,this.presenceContext=i;for(let a=0;a<Xq.length;a++){const l=Xq[a];this.propEventSubscriptions[l]&&(this.propEventSubscriptions[l](),delete this.propEventSubscriptions[l]);const d="on"+l,p=e[d];p&&(this.propEventSubscriptions[l]=this.on(l,p))}this.prevMotionValues=Tke(this,this.scrapeMotionValuesFromProps(e,this.prevProps,this),this.prevMotionValues),this.handleChildMotionValue&&this.handleChildMotionValue(),this.onUpdate&&this.onUpdate(this)}getProps(){return this.props}getVariant(e){return this.props.variants?this.props.variants[e]:void 0}getDefaultTransition(){return this.props.transition}getTransformPagePoint(){return this.props.transformPagePoint}getClosestVariantNode(){return this.isVariantNode?this:this.parent?this.parent.getClosestVariantNode():void 0}addVariantChild(e){const i=this.getClosestVariantNode();if(i)return i.variantChildren&&i.variantChildren.add(e),()=>i.variantChildren.delete(e)}addValue(e,i){const a=this.values.get(e);i!==a&&(a&&this.removeValue(e),this.bindToMotionValue(e,i),this.values.set(e,i),this.latestValues[e]=i.get())}removeValue(e){this.values.delete(e);const i=this.valueSubscriptions.get(e);i&&(i(),this.valueSubscriptions.delete(e)),delete this.latestValues[e],this.removeValueFromRenderState(e,this.renderState)}hasValue(e){return this.values.has(e)}getValue(e,i){if(this.props.values&&this.props.values[e])return this.props.values[e];let a=this.values.get(e);return a===void 0&&i!==void 0&&(a=SR(i===null?void 0:i,{owner:this}),this.addValue(e,a)),a}readValue(e,i){var a;let l=this.latestValues[e]!==void 0||!this.current?this.latestValues[e]:(a=this.getBaseTargetFromProps(this.props,e))!==null&&a!==void 0?a:this.readValueFromInstance(this.current,e,this.options);return l!=null&&(typeof l=="string"&&(yee(l)||lee(l))?l=parseFloat(l):!bke(l)&&Sg.test(i)&&(l=mee(e,i)),this.setBaseTarget(e,Va(l)?l.get():l)),Va(l)?l.get():l}setBaseTarget(e,i){this.baseTarget[e]=i}getBaseTarget(e){var i;const{initial:a}=this.props;let l;if(typeof a=="string"||typeof a=="object"){const p=kF(this.props,a,(i=this.presenceContext)===null||i===void 0?void 0:i.custom);p&&(l=p[e])}if(a&&l!==void 0)return l;const d=this.getBaseTargetFromProps(this.props,e);return d!==void 0&&!Va(d)?d:this.initialValues[e]!==void 0&&l===void 0?void 0:this.baseTarget[e]}on(e,i){return this.events[e]||(this.events[e]=new HF),this.events[e].add(i)}notify(e,...i){this.events[e]&&this.events[e].notify(...i)}}class Jee extends wke{constructor(){super(...arguments),this.KeyframeResolver=bee}sortInstanceNodePosition(e,i){return e.compareDocumentPosition(i)&2?1:-1}getBaseTargetFromProps(e,i){return e.style?e.style[i]:void 0}removeValueFromRenderState(e,{vars:i,style:a}){delete i[e],delete a[e]}handleChildMotionValue(){this.childSubscription&&(this.childSubscription(),delete this.childSubscription);const{children:e}=this.props;Va(e)&&(this.childSubscription=e.on("change",i=>{this.current&&(this.current.textContent=`${i}`)}))}}function Rke(n){return window.getComputedStyle(n)}class Cke extends Jee{constructor(){super(...arguments),this.type="html",this.renderInstance=VZ}readValueFromInstance(e,i){if(zy.has(i)){const a=XF(i);return a&&a.default||0}else{const a=Rke(e),l=(xZ(i)?a.getPropertyValue(i):a[i])||0;return typeof l=="string"?l.trim():l}}measureInstanceViewportBox(e,{transformPagePoint:i}){return Fee(e,i)}build(e,i,a){LF(e,i,a.transformTemplate)}scrapeMotionValuesFromProps(e,i,a){return VF(e,i,a)}}class Ike extends Jee{constructor(){super(...arguments),this.type="svg",this.isSVGTag=!1,this.measureInstanceViewportBox=Ms}getBaseTargetFromProps(e,i){return e[i]}readValueFromInstance(e,i){if(zy.has(i)){const a=XF(i);return a&&a.default||0}return i=FZ.has(i)?i:AF(i),e.getAttribute(i)}scrapeMotionValuesFromProps(e,i,a){return WZ(e,i,a)}build(e,i,a){xF(e,i,this.isSVGTag,a.transformTemplate)}renderInstance(e,i,a,l){jZ(e,i,a,l)}mount(e){this.isSVGTag=UF(e.tagName),super.mount(e)}}const Ake=(n,e)=>OF(n)?new Ike(e):new Cke(e,{allowProjection:n!==D.Fragment}),Pke=eAe({...QPe,...yke,...ake,...Eke},Ake),cf=mIe(Pke),Oke=(n,e)=>n.find(i=>i.id===e);function Jq(n,e){const i=Qee(n,e),a=i?n[i].findIndex(l=>l.id===e):-1;return{position:i,index:a}}function Qee(n,e){for(const[i,a]of Object.entries(n))if(Oke(a,e))return i}function kke(n){const e=n.includes("right"),i=n.includes("left");let a="center";return e&&(a="flex-end"),i&&(a="flex-start"),{display:"flex",flexDirection:"column",alignItems:a}}function Nke(n){const i=n==="top"||n==="bottom"?"0 auto":void 0,a=n.includes("top")?"env(safe-area-inset-top, 0px)":void 0,l=n.includes("bottom")?"env(safe-area-inset-bottom, 0px)":void 0,d=n.includes("left")?void 0:"env(safe-area-inset-right, 0px)",p=n.includes("right")?void 0:"env(safe-area-inset-left, 0px)";return{position:"fixed",zIndex:"var(--toast-z-index, 5500)",pointerEvents:"none",display:"flex",flexDirection:"column",margin:i,top:a,bottom:l,right:d,left:p}}var Dke=/^((children|dangerouslySetInnerHTML|key|ref|autoFocus|defaultValue|defaultChecked|innerHTML|suppressContentEditableWarning|suppressHydrationWarning|valueLink|abbr|accept|acceptCharset|accessKey|action|allow|allowUserMedia|allowPaymentRequest|allowFullScreen|allowTransparency|alt|async|autoComplete|autoPlay|capture|cellPadding|cellSpacing|challenge|charSet|checked|cite|classID|className|cols|colSpan|content|contentEditable|contextMenu|controls|controlsList|coords|crossOrigin|data|dateTime|decoding|default|defer|dir|disabled|disablePictureInPicture|disableRemotePlayback|download|draggable|encType|enterKeyHint|fetchpriority|fetchPriority|form|formAction|formEncType|formMethod|formNoValidate|formTarget|frameBorder|headers|height|hidden|high|href|hrefLang|htmlFor|httpEquiv|id|inputMode|integrity|is|keyParams|keyType|kind|label|lang|list|loading|loop|low|marginHeight|marginWidth|max|maxLength|media|mediaGroup|method|min|minLength|multiple|muted|name|nonce|noValidate|open|optimum|pattern|placeholder|playsInline|poster|preload|profile|radioGroup|readOnly|referrerPolicy|rel|required|reversed|role|rows|rowSpan|sandbox|scope|scoped|scrolling|seamless|selected|shape|size|sizes|slot|span|spellCheck|src|srcDoc|srcLang|srcSet|start|step|style|summary|tabIndex|target|title|translate|type|useMap|value|width|wmode|wrap|about|datatype|inlist|prefix|property|resource|typeof|vocab|autoCapitalize|autoCorrect|autoSave|color|incremental|fallback|inert|itemProp|itemScope|itemType|itemID|itemRef|on|option|results|security|unselectable|accentHeight|accumulate|additive|alignmentBaseline|allowReorder|alphabetic|amplitude|arabicForm|ascent|attributeName|attributeType|autoReverse|azimuth|baseFrequency|baselineShift|baseProfile|bbox|begin|bias|by|calcMode|capHeight|clip|clipPathUnits|clipPath|clipRule|colorInterpolation|colorInterpolationFilters|colorProfile|colorRendering|contentScriptType|contentStyleType|cursor|cx|cy|d|decelerate|descent|diffuseConstant|direction|display|divisor|dominantBaseline|dur|dx|dy|edgeMode|elevation|enableBackground|end|exponent|externalResourcesRequired|fill|fillOpacity|fillRule|filter|filterRes|filterUnits|floodColor|floodOpacity|focusable|fontFamily|fontSize|fontSizeAdjust|fontStretch|fontStyle|fontVariant|fontWeight|format|from|fr|fx|fy|g1|g2|glyphName|glyphOrientationHorizontal|glyphOrientationVertical|glyphRef|gradientTransform|gradientUnits|hanging|horizAdvX|horizOriginX|ideographic|imageRendering|in|in2|intercept|k|k1|k2|k3|k4|kernelMatrix|kernelUnitLength|kerning|keyPoints|keySplines|keyTimes|lengthAdjust|letterSpacing|lightingColor|limitingConeAngle|local|markerEnd|markerMid|markerStart|markerHeight|markerUnits|markerWidth|mask|maskContentUnits|maskUnits|mathematical|mode|numOctaves|offset|opacity|operator|order|orient|orientation|origin|overflow|overlinePosition|overlineThickness|panose1|paintOrder|pathLength|patternContentUnits|patternTransform|patternUnits|pointerEvents|points|pointsAtX|pointsAtY|pointsAtZ|preserveAlpha|preserveAspectRatio|primitiveUnits|r|radius|refX|refY|renderingIntent|repeatCount|repeatDur|requiredExtensions|requiredFeatures|restart|result|rotate|rx|ry|scale|seed|shapeRendering|slope|spacing|specularConstant|specularExponent|speed|spreadMethod|startOffset|stdDeviation|stemh|stemv|stitchTiles|stopColor|stopOpacity|strikethroughPosition|strikethroughThickness|string|stroke|strokeDasharray|strokeDashoffset|strokeLinecap|strokeLinejoin|strokeMiterlimit|strokeOpacity|strokeWidth|surfaceScale|systemLanguage|tableValues|targetX|targetY|textAnchor|textDecoration|textRendering|textLength|to|transform|u1|u2|underlinePosition|underlineThickness|unicode|unicodeBidi|unicodeRange|unitsPerEm|vAlphabetic|vHanging|vIdeographic|vMathematical|values|vectorEffect|version|vertAdvY|vertOriginX|vertOriginY|viewBox|viewTarget|visibility|widths|wordSpacing|writingMode|x|xHeight|x1|x2|xChannelSelector|xlinkActuate|xlinkArcrole|xlinkHref|xlinkRole|xlinkShow|xlinkTitle|xlinkType|xmlBase|xmlns|xmlnsXlink|xmlLang|xmlSpace|y|y1|y2|yChannelSelector|z|zoomAndPan|for|class|autofocus)|(([Dd][Aa][Tt][Aa]|[Aa][Rr][Ii][Aa]|x)-.*))$/,Lke=pZ(function(n){return Dke.test(n)||n.charCodeAt(0)===111&&n.charCodeAt(1)===110&&n.charCodeAt(2)<91}),xke=Lke,Mke=function(e){return e!=="theme"},Qq=function(e){return typeof e=="string"&&e.charCodeAt(0)>96?xke:Mke},Zq=function(e,i,a){var l;if(i){var d=i.shouldForwardProp;l=e.__emotion_forwardProp&&d?function(p){return e.__emotion_forwardProp(p)&&d(p)}:d}return typeof l!="function"&&a&&(l=e.__emotion_forwardProp),l},Uke=function(e){var i=e.cache,a=e.serialized,l=e.isStringTag;return hF(i,a,l),EZ(function(){return fF(i,a,l)}),null},Vke=function n(e,i){var a=e.__emotion_real===e,l=a&&e.__emotion_base||e,d,p;i!==void 0&&(d=i.label,p=i.target);var y=Zq(e,i,a),v=y||Qq(l),b=!v("as");return function(){var w=arguments,A=a&&e.__emotion_styles!==void 0?e.__emotion_styles.slice(0):[];if(d!==void 0&&A.push("label:"+d+";"),w[0]==null||w[0].raw===void 0)A.push.apply(A,w);else{var N=w[0];A.push(N[0]);for(var V=w.length,j=1;j<V;j++)A.push(w[j],N[j])}var B=mF(function(G,ee,K){var ne=b&&G.as||l,ce="",oe=[],ge=G;if(G.theme==null){ge={};for(var te in G)ge[te]=G[te];ge.theme=D.useContext(o0)}typeof G.className=="string"?ce=gZ(ee.registered,oe,G.className):G.className!=null&&(ce=G.className+" ");var Z=E1(A.concat(oe),ee.registered,ge);ce+=ee.key+"-"+Z.name,p!==void 0&&(ce+=" "+p);var J=b&&y===void 0?Qq(ne):v,se={};for(var he in G)b&&he==="as"||J(he)&&(se[he]=G[he]);return se.className=ce,K&&(se.ref=K),D.createElement(D.Fragment,null,D.createElement(Uke,{cache:ee,serialized:Z,isStringTag:typeof ne=="string"}),D.createElement(ne,se))});return B.displayName=d!==void 0?d:"Styled("+(typeof l=="string"?l:l.displayName||l.name||"Component")+")",B.defaultProps=e.defaultProps,B.__emotion_real=B,B.__emotion_base=l,B.__emotion_styles=A,B.__emotion_forwardProp=y,Object.defineProperty(B,"toString",{value:function(){return"."+p}}),B.withComponent=function(G,ee){var K=n(G,Oy({},i,ee,{shouldForwardProp:Zq(B,ee,!0)}));return K.apply(void 0,A)},B}},Fke=["a","abbr","address","area","article","aside","audio","b","base","bdi","bdo","big","blockquote","body","br","button","canvas","caption","cite","code","col","colgroup","data","datalist","dd","del","details","dfn","dialog","div","dl","dt","em","embed","fieldset","figcaption","figure","footer","form","h1","h2","h3","h4","h5","h6","head","header","hgroup","hr","html","i","iframe","img","input","ins","kbd","keygen","label","legend","li","link","main","map","mark","marquee","menu","menuitem","meta","meter","nav","noscript","object","ol","optgroup","option","output","p","param","picture","pre","progress","q","rp","rt","ruby","s","samp","script","section","select","small","source","span","strong","style","sub","summary","sup","table","tbody","td","textarea","tfoot","th","thead","time","title","tr","track","u","ul","var","video","wbr","circle","clipPath","defs","ellipse","foreignObject","g","image","line","linearGradient","mask","path","pattern","polygon","polyline","radialGradient","rect","stop","svg","text","tspan"],$U=Vke.bind(null);Fke.forEach(function(n){$U[n]=$U(n)});const jke=new Set([...ave,"textStyle","layerStyle","apply","noOfLines","focusBorderColor","errorBorderColor","as","__css","css","sx"]),Bke=new Set(["htmlWidth","htmlHeight","htmlSize","htmlTranslate"]);function Wke(n){return(Bke.has(n)||!jke.has(n))&&n[0]!=="_"}const zke=Vye($U),Gke=({baseStyle:n})=>e=>{const{theme:i,css:a,__css:l,sx:d,...p}=e,[y]=Kye(p,lve),v=Xc(n,e),b=wye({},l,v,u1(y),d),w=KQ(b)(e.theme);return a?[w,a]:w};function P2(n,e){const{baseStyle:i,...a}=e??{};a.shouldForwardProp||(a.shouldForwardProp=Wke);const l=Gke({baseStyle:i}),d=zke(n,a)(l);return D.forwardRef(function(v,b){const{children:w,...A}=v,{colorMode:N,forced:V}=S1(),j=V?N:void 0;return D.createElement(d,{ref:b,"data-theme":j,...A},w)})}function Hke(){const n=new Map;return new Proxy(P2,{apply(e,i,a){return P2(...a)},get(e,i){return n.has(i)||n.set(i,P2(i)),n.get(i)}})}const Nt=Hke(),$ke={initial:n=>{const{position:e}=n,i=["top","bottom"].includes(e)?"y":"x";let a=["top-right","bottom-right"].includes(e)?1:-1;return e==="bottom"&&(a=1),{opacity:0,[i]:a*24}},animate:{opacity:1,y:0,x:0,scale:1,transition:{duration:.4,ease:[.4,0,.2,1]}},exit:{opacity:0,scale:.85,transition:{duration:.2,ease:[.4,0,1,1]}}},Zee=D.memo(n=>{const{id:e,message:i,onCloseComplete:a,onRequestRemove:l,requestClose:d=!1,position:p="bottom",duration:y=5e3,containerStyle:v,motionVariants:b=$ke,toastSpacing:w="0.5rem"}=n,[A,N]=D.useState(y),V=oIe();Eg(()=>{V||a==null||a()},[V]),Eg(()=>{N(y)},[y]);const j=()=>N(null),B=()=>N(y),G=()=>{V&&l()};D.useEffect(()=>{V&&d&&l()},[V,d,l]),dEe(G,A);const ee=D.useMemo(()=>({pointerEvents:"auto",maxWidth:560,minWidth:300,margin:w,...v}),[v,w]),K=D.useMemo(()=>kke(p),[p]);return C.jsx(cf.div,{layout:!0,className:"chakra-toast",variants:b,initial:"initial",animate:"animate",exit:"exit",onHoverStart:j,onHoverEnd:B,custom:{position:p},style:K,children:C.jsx(Nt.div,{role:"status","aria-atomic":"true",className:"chakra-toast__inner",__css:ee,children:Xc(i,{id:e,onClose:G})})})});Zee.displayName="ToastComponent";function Bt(n){return D.forwardRef(n)}var O2,eY;function Kke(){if(eY)return O2;eY=1;var n=typeof Element<"u",e=typeof Map=="function",i=typeof Set=="function",a=typeof ArrayBuffer=="function"&&!!ArrayBuffer.isView;function l(d,p){if(d===p)return!0;if(d&&p&&typeof d=="object"&&typeof p=="object"){if(d.constructor!==p.constructor)return!1;var y,v,b;if(Array.isArray(d)){if(y=d.length,y!=p.length)return!1;for(v=y;v--!==0;)if(!l(d[v],p[v]))return!1;return!0}var w;if(e&&d instanceof Map&&p instanceof Map){if(d.size!==p.size)return!1;for(w=d.entries();!(v=w.next()).done;)if(!p.has(v.value[0]))return!1;for(w=d.entries();!(v=w.next()).done;)if(!l(v.value[1],p.get(v.value[0])))return!1;return!0}if(i&&d instanceof Set&&p instanceof Set){if(d.size!==p.size)return!1;for(w=d.entries();!(v=w.next()).done;)if(!p.has(v.value[0]))return!1;return!0}if(a&&ArrayBuffer.isView(d)&&ArrayBuffer.isView(p)){if(y=d.length,y!=p.length)return!1;for(v=y;v--!==0;)if(d[v]!==p[v])return!1;return!0}if(d.constructor===RegExp)return d.source===p.source&&d.flags===p.flags;if(d.valueOf!==Object.prototype.valueOf&&typeof d.valueOf=="function"&&typeof p.valueOf=="function")return d.valueOf()===p.valueOf();if(d.toString!==Object.prototype.toString&&typeof d.toString=="function"&&typeof p.toString=="function")return d.toString()===p.toString();if(b=Object.keys(d),y=b.length,y!==Object.keys(p).length)return!1;for(v=y;v--!==0;)if(!Object.prototype.hasOwnProperty.call(p,b[v]))return!1;if(n&&d instanceof Element)return!1;for(v=y;v--!==0;)if(!((b[v]==="_owner"||b[v]==="__v"||b[v]==="__o")&&d.$$typeof)&&!l(d[b[v]],p[b[v]]))return!1;return!0}return d!==d&&p!==p}return O2=function(p,y){try{return l(p,y)}catch(v){if((v.message||"").match(/stack|recursion/i))return console.warn("react-fast-compare cannot handle circular refs"),!1;throw v}},O2}var qke=Kke();const Yke=I0(qke);function D0(){const n=D.useContext(o0);if(!n)throw Error("useTheme: `theme` is undefined. Seems you forgot to wrap your app in `<ChakraProvider />` or `<ThemeProvider />`");return n}function ete(){const n=S1(),e=D0();return{...n,theme:e}}function Xke(n,e,i){if(e==null)return e;const a=l=>{var d,p;return(p=(d=n.__cssMap)==null?void 0:d[l])==null?void 0:p.value};return a(e)??a(i)??i}function Jke(n,e,i){const a=Array.isArray(e)?e:[e],l=Array.isArray(i)?i:[i];return d=>{const p=l.filter(Boolean),y=a.map((v,b)=>{const w=`${n}.${v}`;return Xke(d,w,p[b]??v)});return Array.isArray(e)?y:y[0]}}function tte(n,e={}){const{styleConfig:i,...a}=e,{theme:l,colorMode:d}=ete(),p=n?OQ(l,`components.${n}`):void 0,y=i||p,v=zh({theme:l,colorMode:d},(y==null?void 0:y.defaultProps)??{},u1(A0(a,["children"])),(w,A)=>w?void 0:A),b=D.useRef({});if(y){const A=vve(y)(v);Yke(b.current,A)||(b.current=A)}return b.current}function Ul(n,e={}){return tte(n,e)}function lc(n,e={}){return tte(n,e)}const tY={path:C.jsxs("g",{stroke:"currentColor",strokeWidth:"1.5",children:[C.jsx("path",{strokeLinecap:"round",fill:"none",d:"M9,9a3,3,0,1,1,4,2.829,1.5,1.5,0,0,0-1,1.415V14.25"}),C.jsx("path",{fill:"currentColor",strokeLinecap:"round",d:"M12,17.25a.375.375,0,1,0,.375.375A.375.375,0,0,0,12,17.25h0"}),C.jsx("circle",{fill:"none",strokeMiterlimit:"10",cx:"12",cy:"12",r:"11.25"})]}),viewBox:"0 0 24 24"},Dn=Bt((n,e)=>{const{as:i,viewBox:a,color:l="currentColor",focusable:d=!1,children:p,className:y,__css:v,...b}=n,w=un("chakra-icon",y),A=Ul("Icon",n),N={w:"1em",h:"1em",display:"inline-block",lineHeight:"1em",flexShrink:0,color:l,...v,...A},V={ref:e,focusable:d,className:w,__css:N},j=a??tY.viewBox;if(i&&typeof i!="string")return C.jsx(Nt.svg,{as:i,...V,...b});const B=p??tY.path;return C.jsx(Nt.svg,{verticalAlign:"middle",viewBox:j,...V,...b,children:B})});Dn.displayName="Icon";function Qke(n){return C.jsx(Dn,{viewBox:"0 0 24 24",...n,children:C.jsx("path",{fill:"currentColor",d:"M12,0A12,12,0,1,0,24,12,12.014,12.014,0,0,0,12,0Zm6.927,8.2-6.845,9.289a1.011,1.011,0,0,1-1.43.188L5.764,13.769a1,1,0,1,1,1.25-1.562l4.076,3.261,6.227-8.451A1,1,0,1,1,18.927,8.2Z"})})}function Zke(n){return C.jsx(Dn,{viewBox:"0 0 24 24",...n,children:C.jsx("path",{fill:"currentColor",d:"M12,0A12,12,0,1,0,24,12,12.013,12.013,0,0,0,12,0Zm.25,5a1.5,1.5,0,1,1-1.5,1.5A1.5,1.5,0,0,1,12.25,5ZM14.5,18.5h-4a1,1,0,0,1,0-2h.75a.25.25,0,0,0,.25-.25v-4.5a.25.25,0,0,0-.25-.25H10.5a1,1,0,0,1,0-2h1a2,2,0,0,1,2,2v4.75a.25.25,0,0,0,.25.25h.75a1,1,0,1,1,0,2Z"})})}function nY(n){return C.jsx(Dn,{viewBox:"0 0 24 24",...n,children:C.jsx("path",{fill:"currentColor",d:"M11.983,0a12.206,12.206,0,0,0-8.51,3.653A11.8,11.8,0,0,0,0,12.207,11.779,11.779,0,0,0,11.8,24h.214A12.111,12.111,0,0,0,24,11.791h0A11.766,11.766,0,0,0,11.983,0ZM10.5,16.542a1.476,1.476,0,0,1,1.449-1.53h.027a1.527,1.527,0,0,1,1.523,1.47,1.475,1.475,0,0,1-1.449,1.53h-.027A1.529,1.529,0,0,1,10.5,16.542ZM11,12.5v-6a1,1,0,0,1,2,0v6a1,1,0,1,1-2,0Z"})})}const e1e=$R({"0%":{transform:"rotate(0deg)"},"100%":{transform:"rotate(360deg)"}}),lf=Bt((n,e)=>{const i=Ul("Spinner",n),{label:a="Loading...",thickness:l="2px",speed:d="0.45s",emptyColor:p="transparent",className:y,...v}=Fi(n),b=un("chakra-spinner",y),w={display:"inline-block",borderColor:"currentColor",borderStyle:"solid",borderRadius:"99999px",borderWidth:l,borderBottomColor:p,borderLeftColor:p,animation:`${e1e} ${d} linear infinite`,...i};return C.jsx(Nt.div,{ref:e,__css:w,className:b,...v,children:a&&C.jsx(Nt.span,{srOnly:!0,children:a})})});lf.displayName="Spinner";const[t1e,tj]=Ui({name:"AlertContext",hookName:"useAlertContext",providerName:"<Alert />"}),[n1e,nj]=Ui({name:"AlertStylesContext",hookName:"useAlertStyles",providerName:"<Alert />"}),nte={info:{icon:Zke,colorScheme:"blue"},warning:{icon:nY,colorScheme:"orange"},success:{icon:Qke,colorScheme:"green"},error:{icon:nY,colorScheme:"red"},loading:{icon:lf,colorScheme:"blue"}};function r1e(n){return nte[n].colorScheme}function i1e(n){return nte[n].icon}const lg=Bt(function(e,i){const{status:a="info",addRole:l=!0,...d}=Fi(e),p=e.colorScheme??r1e(a),y=lc("Alert",{...e,colorScheme:p}),v={width:"100%",display:"flex",alignItems:"center",position:"relative",overflow:"hidden",...y.container};return C.jsx(t1e,{value:{status:a},children:C.jsx(n1e,{value:y,children:C.jsx(Nt.div,{"data-status":a,role:l?"alert":void 0,ref:i,...d,className:un("chakra-alert",e.className),__css:v})})})});lg.displayName="Alert";function ug(n){const{status:e}=tj(),i=i1e(e),a=nj(),l=e==="loading"?a.spinner:a.icon;return C.jsx(Nt.span,{display:"inherit","data-status":e,...n,className:un("chakra-alert__icon",n.className),__css:l,children:n.children||C.jsx(i,{h:"100%",w:"100%"})})}ug.displayName="AlertIcon";const eR=Bt(function(e,i){const a=nj(),{status:l}=tj();return C.jsx(Nt.div,{ref:i,"data-status":l,...e,className:un("chakra-alert__title",e.className),__css:a.title})});eR.displayName="AlertTitle";const tR=Bt(function(e,i){const{status:a}=tj(),l=nj(),d={display:"inline",...l.description};return C.jsx(Nt.div,{ref:i,"data-status":a,...e,className:un("chakra-alert__desc",e.className),__css:d})});tR.displayName="AlertDescription";function s1e(n){return C.jsx(Dn,{focusable:"false","aria-hidden":!0,...n,children:C.jsx("path",{fill:"currentColor",d:"M.439,21.44a1.5,1.5,0,0,0,2.122,2.121L11.823,14.3a.25.25,0,0,1,.354,0l9.262,9.263a1.5,1.5,0,1,0,2.122-2.121L14.3,12.177a.25.25,0,0,1,0-.354l9.263-9.262A1.5,1.5,0,0,0,21.439.44L12.177,9.7a.25.25,0,0,1-.354,0L2.561.44A1.5,1.5,0,0,0,.439,2.561L9.7,11.823a.25.25,0,0,1,0,.354Z"})})}const rj=Bt(function(e,i){const a=Ul("CloseButton",e),{children:l,isDisabled:d,__css:p,...y}=Fi(e),v={outline:0,display:"flex",alignItems:"center",justifyContent:"center",flexShrink:0};return C.jsx(Nt.button,{type:"button","aria-label":"Close",ref:i,disabled:d,__css:{...v,...a,...p},...y,children:l||C.jsx(s1e,{width:"1em",height:"1em"})})});rj.displayName="CloseButton";const o1e=n=>{const{status:e,variant:i="solid",id:a,title:l,isClosable:d,onClose:p,description:y,colorScheme:v,icon:b}=n,w=a?{root:`toast-${a}`,title:`toast-${a}-title`,description:`toast-${a}-description`}:void 0;return C.jsxs(lg,{addRole:!1,status:e,variant:i,id:w==null?void 0:w.root,alignItems:"start",borderRadius:"md",boxShadow:"lg",paddingEnd:8,textAlign:"start",width:"auto",colorScheme:v,children:[C.jsx(ug,{children:b}),C.jsxs(Nt.div,{flex:"1",maxWidth:"100%",children:[l&&C.jsx(eR,{id:w==null?void 0:w.title,children:l}),y&&C.jsx(tR,{id:w==null?void 0:w.description,display:"block",children:y})]}),d&&C.jsx(rj,{size:"sm",onClick:p,position:"absolute",insetEnd:1,top:1})]})};function rte(n={}){const{render:e,toastComponent:i=o1e}=n;return l=>typeof e=="function"?e({...l,...n}):C.jsx(i,{...l,...n})}const a1e={top:[],"top-left":[],"top-right":[],"bottom-left":[],bottom:[],"bottom-right":[]},jh=c1e(a1e);function c1e(n){let e=n;const i=new Set,a=l=>{e=l(e),i.forEach(d=>d())};return{getState:()=>e,subscribe:l=>(i.add(l),()=>{a(()=>n),i.delete(l)}),removeToast:(l,d)=>{a(p=>({...p,[d]:p[d].filter(y=>y.id!=l)}))},notify:(l,d)=>{const p=l1e(l,d),{position:y,id:v}=p;return a(b=>{const A=y.includes("top")?[p,...b[y]??[]]:[...b[y]??[],p];return{...b,[y]:A}}),v},update:(l,d)=>{l&&a(p=>{const y={...p},{position:v,index:b}=Jq(y,l);return v&&b!==-1&&(y[v][b]={...y[v][b],...d,message:rte(d)}),y})},closeAll:({positions:l}={})=>{a(d=>(l??["bottom","bottom-right","bottom-left","top","top-left","top-right"]).reduce((v,b)=>(v[b]=d[b].map(w=>({...w,requestClose:!0})),v),{...d}))},close:l=>{a(d=>{const p=Qee(d,l);return p?{...d,[p]:d[p].map(y=>y.id==l?{...y,requestClose:!0}:y)}:d})},isActive:l=>!!Jq(jh.getState(),l).position}}let rY=0;function l1e(n,e={}){rY+=1;const i=e.id??rY,a=e.position??"bottom";return{id:i,message:n,position:a,duration:e.duration,onCloseComplete:e.onCloseComplete,onRequestRemove:()=>jh.removeToast(String(i),a),status:e.status,requestClose:!1,containerStyle:e.containerStyle}}var ite=SQ();const[ste,u1e]=Ui({strict:!1,name:"PortalContext"}),ij="chakra-portal",d1e=".chakra-portal",h1e=n=>C.jsx("div",{className:"chakra-portal-zIndex",style:{position:"absolute",zIndex:n.zIndex,top:0,left:0,right:0},children:n.children}),f1e=n=>{const{appendToParentPortal:e,children:i}=n,[a,l]=D.useState(null),d=D.useRef(null),[,p]=D.useState({});D.useEffect(()=>p({}),[]);const y=u1e(),v=ZCe();bp(()=>{if(!a)return;const w=a.ownerDocument,A=e?y??w.body:w.body;if(!A)return;d.current=w.createElement("div"),d.current.className=ij,A.appendChild(d.current),p({});const N=d.current;return()=>{A.contains(N)&&A.removeChild(N)}},[a]);const b=v!=null&&v.zIndex?C.jsx(h1e,{zIndex:v==null?void 0:v.zIndex,children:i}):i;return d.current?ite.createPortal(C.jsx(ste,{value:d.current,children:b}),d.current):C.jsx("span",{ref:w=>{w&&l(w)}})},p1e=n=>{const{children:e,containerRef:i,appendToParentPortal:a}=n,l=i.current,d=l??(typeof window<"u"?document.body:void 0),p=D.useMemo(()=>{const v=l==null?void 0:l.ownerDocument.createElement("div");return v&&(v.className=ij),v},[l]),[,y]=D.useState({});return bp(()=>y({}),[]),bp(()=>{if(!(!p||!d))return d.appendChild(p),()=>{d.removeChild(p)}},[p,d]),d&&p?ite.createPortal(C.jsx(ste,{value:a?p:null,children:e}),p):null};function Vl(n){const e={appendToParentPortal:!0,...n},{containerRef:i,...a}=e;return i?C.jsx(p1e,{containerRef:i,...a}):C.jsx(f1e,{...a})}Vl.className=ij;Vl.selector=d1e;Vl.displayName="Portal";const[m1e,g1e]=Ui({name:"ToastOptionsContext",strict:!1}),_1e=n=>{const e=D.useSyncExternalStore(jh.subscribe,jh.getState,jh.getState),{motionVariants:i,component:a=Zee,portalProps:l,animatePresenceProps:d}=n,y=Object.keys(e).map(v=>{const b=e[v];return C.jsx("div",{role:"region","aria-live":"polite","aria-label":`Notifications-${v}`,id:`chakra-toast-manager-${v}`,style:Nke(v),children:C.jsx(O0,{...d,initial:!1,children:b.map(w=>C.jsx(a,{motionVariants:i,...w},w.id))})},v)});return C.jsx(Vl,{...l,children:y})},y1e=n=>function({children:i,theme:a=n,toastOptions:l,...d}){return C.jsxs(tIe,{theme:a,...d,children:[C.jsx(m1e,{value:l==null?void 0:l.defaultOptions,children:i}),C.jsx(_1e,{...l})]})},I1=y1e($Re);function iY(n){return n.sort((e,i)=>{const a=e.compareDocumentPosition(i);if(a&Node.DOCUMENT_POSITION_FOLLOWING||a&Node.DOCUMENT_POSITION_CONTAINED_BY)return-1;if(a&Node.DOCUMENT_POSITION_PRECEDING||a&Node.DOCUMENT_POSITION_CONTAINS)return 1;if(a&Node.DOCUMENT_POSITION_DISCONNECTED||a&Node.DOCUMENT_POSITION_IMPLEMENTATION_SPECIFIC)throw Error("Cannot sort the given nodes.");return 0})}const E1e=n=>typeof n=="object"&&"nodeType"in n&&n.nodeType===Node.ELEMENT_NODE;function sY(n,e,i){let a=n+1;return i&&a>=e&&(a=0),a}function oY(n,e,i){let a=n-1;return i&&a<0&&(a=e),a}const k2=typeof window<"u"?D.useLayoutEffect:D.useEffect,aY=n=>n;var v1e=Object.defineProperty,S1e=(n,e,i)=>e in n?v1e(n,e,{enumerable:!0,configurable:!0,writable:!0,value:i}):n[e]=i,Cs=(n,e,i)=>(S1e(n,typeof e!="symbol"?e+"":e,i),i);class b1e{constructor(){Cs(this,"descendants",new Map),Cs(this,"register",e=>{if(e!=null)return E1e(e)?this.registerNode(e):i=>{this.registerNode(i,e)}}),Cs(this,"unregister",e=>{this.descendants.delete(e);const i=iY(Array.from(this.descendants.keys()));this.assignIndex(i)}),Cs(this,"destroy",()=>{this.descendants.clear()}),Cs(this,"assignIndex",e=>{this.descendants.forEach(i=>{const a=e.indexOf(i.node);i.index=a,i.node.dataset.index=i.index.toString()})}),Cs(this,"count",()=>this.descendants.size),Cs(this,"enabledCount",()=>this.enabledValues().length),Cs(this,"values",()=>Array.from(this.descendants.values()).sort((i,a)=>i.index-a.index)),Cs(this,"enabledValues",()=>this.values().filter(e=>!e.disabled)),Cs(this,"item",e=>{if(this.count()!==0)return this.values()[e]}),Cs(this,"enabledItem",e=>{if(this.enabledCount()!==0)return this.enabledValues()[e]}),Cs(this,"first",()=>this.item(0)),Cs(this,"firstEnabled",()=>this.enabledItem(0)),Cs(this,"last",()=>this.item(this.descendants.size-1)),Cs(this,"lastEnabled",()=>{const e=this.enabledValues().length-1;return this.enabledItem(e)}),Cs(this,"indexOf",e=>{var i;return e?((i=this.descendants.get(e))==null?void 0:i.index)??-1:-1}),Cs(this,"enabledIndexOf",e=>e==null?-1:this.enabledValues().findIndex(i=>i.node.isSameNode(e))),Cs(this,"next",(e,i=!0)=>{const a=sY(e,this.count(),i);return this.item(a)}),Cs(this,"nextEnabled",(e,i=!0)=>{const a=this.item(e);if(!a)return;const l=this.enabledIndexOf(a.node),d=sY(l,this.enabledCount(),i);return this.enabledItem(d)}),Cs(this,"prev",(e,i=!0)=>{const a=oY(e,this.count()-1,i);return this.item(a)}),Cs(this,"prevEnabled",(e,i=!0)=>{const a=this.item(e);if(!a)return;const l=this.enabledIndexOf(a.node),d=oY(l,this.enabledCount()-1,i);return this.enabledItem(d)}),Cs(this,"registerNode",(e,i)=>{if(!e||this.descendants.has(e))return;const a=Array.from(this.descendants.keys()).concat(e),l=iY(a);i!=null&&i.disabled&&(i.disabled=!!i.disabled);const d={node:e,index:-1,...i};this.descendants.set(e,d),this.assignIndex(l)})}}function ote(){const[n,e]=Ui({name:"DescendantsProvider",errorMessage:"useDescendantsContext must be used within DescendantsProvider"});return[n,e,()=>{const l=D.useRef(new b1e);return k2(()=>()=>l.current.destroy()),l.current},l=>{const d=e(),[p,y]=D.useState(-1),v=D.useRef(null);k2(()=>()=>{v.current&&d.unregister(v.current)},[]),k2(()=>{if(!v.current)return;const w=Number(v.current.dataset.index);p!=w&&!Number.isNaN(w)&&y(w)});const b=aY(l?d.register(l):d.register);return{descendants:d,index:p,enabledIndex:d.enabledIndexOf(v.current),register:rs(b,v)}}]}const cY={easeIn:[.4,0,1,1],easeOut:[0,0,.2,1]},wy={enter:{duration:.2,ease:cY.easeOut},exit:{duration:.1,ease:cY.easeIn}},Ry={enter:(n,e)=>({...n,delay:typeof e=="number"?e:e==null?void 0:e.enter}),exit:(n,e)=>({...n,delay:typeof e=="number"?e:e==null?void 0:e.exit})},ate=Bt(function(n,e){const{ratio:i=4/3,children:a,className:l,...d}=n,p=D.Children.only(a),y=un("chakra-aspect-ratio",l);return C.jsx(Nt.div,{ref:e,position:"relative",className:y,_before:{height:0,content:'""',display:"block",paddingBottom:d1(i,v=>`${1/v*100}%`)},__css:{"& > *:not(style)":{overflow:"hidden",position:"absolute",top:"0",right:"0",bottom:"0",left:"0",display:"flex",justifyContent:"center",alignItems:"center",width:"100%",height:"100%"},"& > img, & > video":{objectFit:"cover"}},...d,children:p})});ate.displayName="AspectRatio";const[T1e,w1e]=Ui({name:"AvatarStylesContext",hookName:"useAvatarStyles",providerName:"<Avatar/>"});function R1e(n){const e=n.trim().split(" "),i=e[0]??"",a=e.length>1?e[e.length-1]:"";return i&&a?`${i.charAt(0)}${a.charAt(0)}`:i.charAt(0)}function cte(n){const{name:e,getInitials:i,...a}=n,l=w1e();return C.jsx(Nt.div,{role:"img","aria-label":e,...a,__css:l.label,children:e?i==null?void 0:i(e):null})}cte.displayName="AvatarName";const lte=n=>C.jsxs(Nt.svg,{viewBox:"0 0 128 128",color:"#fff",width:"100%",height:"100%",className:"chakra-avatar__svg",...n,children:[C.jsx("path",{fill:"currentColor",d:"M103,102.1388 C93.094,111.92 79.3504,118 64.1638,118 C48.8056,118 34.9294,111.768 25,101.7892 L25,95.2 C25,86.8096 31.981,80 40.6,80 L87.4,80 C96.019,80 103,86.8096 103,95.2 L103,102.1388 Z"}),C.jsx("path",{fill:"currentColor",d:"M63.9961647,24 C51.2938136,24 41,34.2938136 41,46.9961647 C41,59.7061864 51.2938136,70 63.9961647,70 C76.6985159,70 87,59.7061864 87,46.9961647 C87,34.2938136 76.6985159,24 63.9961647,24"})]});function ute(n){const{loading:e,src:i,srcSet:a,onLoad:l,onError:d,crossOrigin:p,sizes:y,ignoreFallback:v}=n,[b,w]=D.useState("pending");D.useEffect(()=>{w(i?"loading":"pending")},[i]);const A=D.useRef(null),N=D.useCallback(()=>{if(!i)return;V();const j=new Image;j.src=i,p&&(j.crossOrigin=p),a&&(j.srcset=a),y&&(j.sizes=y),e&&(j.loading=e),j.onload=B=>{V(),w("loaded"),l==null||l(B)},j.onerror=B=>{V(),w("failed"),d==null||d(B)},A.current=j},[i,p,a,y,l,d,e]),V=()=>{A.current&&(A.current.onload=null,A.current.onerror=null,A.current=null)};return bp(()=>{if(!v)return b==="loading"&&N(),()=>{V()}},[b,N,v]),v?"loaded":b}const C1e=(n,e)=>n!=="loaded"&&e==="beforeLoadOrError"||n==="failed"&&e==="onError";function dte(n){const{src:e,srcSet:i,onError:a,onLoad:l,getInitials:d,name:p,borderRadius:y,loading:v,iconLabel:b,icon:w=C.jsx(lte,{}),ignoreFallback:A,referrerPolicy:N,crossOrigin:V}=n,B=ute({src:e,onError:a,crossOrigin:V,ignoreFallback:A})==="loaded";return!e||!B?p?C.jsx(cte,{className:"chakra-avatar__initials",getInitials:d,name:p}):D.cloneElement(w,{role:"img","aria-label":b}):C.jsx(Nt.img,{src:e,srcSet:i,alt:p??b,onLoad:l,referrerPolicy:N,crossOrigin:V??void 0,className:"chakra-avatar__img",loading:v,__css:{width:"100%",height:"100%",objectFit:"cover",borderRadius:y}})}dte.displayName="AvatarImage";const I1e={display:"inline-flex",alignItems:"center",justifyContent:"center",textAlign:"center",textTransform:"uppercase",fontWeight:"medium",position:"relative",flexShrink:0},ku=Bt((n,e)=>{const i=lc("Avatar",n),[a,l]=D.useState(!1),{src:d,srcSet:p,name:y,showBorder:v,borderRadius:b="full",onError:w,onLoad:A,getInitials:N=R1e,icon:V=C.jsx(lte,{}),iconLabel:j=" avatar",loading:B,children:G,borderColor:ee,ignoreFallback:K,crossOrigin:ne,referrerPolicy:ce,...oe}=Fi(n),ge={borderRadius:b,borderWidth:v?"2px":void 0,...I1e,...i.container};return ee&&(ge.borderColor=ee),C.jsx(Nt.span,{ref:e,...oe,className:un("chakra-avatar",n.className),"data-loaded":Kn(a),__css:ge,children:C.jsxs(T1e,{value:i,children:[C.jsx(dte,{src:d,srcSet:p,loading:B,onLoad:Qn(A,()=>{l(!0)}),onError:w,getInitials:N,name:y,borderRadius:b,icon:V,iconLabel:j,ignoreFallback:K,crossOrigin:ne,referrerPolicy:ce}),G]})})});ku.displayName="Avatar";const _p=Bt(function(e,i){const a=Ul("Badge",e),{className:l,...d}=Fi(e);return C.jsx(Nt.span,{ref:i,className:un("chakra-badge",e.className),...d,__css:{display:"inline-block",whiteSpace:"nowrap",verticalAlign:"middle",...a}})});_p.displayName="Badge";const St=Nt("div");St.displayName="Box";const[tze,A1e]=Ui({strict:!1,name:"ButtonGroupContext"});function xw(n){const{children:e,className:i,...a}=n,l=D.isValidElement(e)?D.cloneElement(e,{"aria-hidden":!0,focusable:!1}):e,d=un("chakra-button__icon",i);return C.jsx(Nt.span,{display:"inline-flex",alignSelf:"center",flexShrink:0,...a,className:d,children:l})}xw.displayName="ButtonIcon";function KU(n){const{label:e,placement:i,spacing:a="0.5rem",children:l=C.jsx(lf,{color:"currentColor",width:"1em",height:"1em"}),className:d,__css:p,...y}=n,v=un("chakra-button__spinner",d),b=i==="start"?"marginEnd":"marginStart",w=D.useMemo(()=>({display:"flex",alignItems:"center",position:e?"relative":"absolute",[b]:e?a:0,fontSize:"1em",lineHeight:"normal",...p}),[p,e,b,a]);return C.jsx(Nt.div,{className:v,...y,__css:w,children:l})}KU.displayName="ButtonSpinner";function P1e(n){const[e,i]=D.useState(!n);return{ref:D.useCallback(d=>{d&&i(d.tagName==="BUTTON")},[]),type:e?"button":void 0}}const zr=Bt((n,e)=>{const i=A1e(),a=Ul("Button",{...i,...n}),{isDisabled:l=i==null?void 0:i.isDisabled,isLoading:d,isActive:p,children:y,leftIcon:v,rightIcon:b,loadingText:w,iconSpacing:A="0.5rem",type:N,spinner:V,spinnerPlacement:j="start",className:B,as:G,shouldWrapChildren:ee,...K}=Fi(n),ne=D.useMemo(()=>{const te={...a==null?void 0:a._focus,zIndex:1};return{display:"inline-flex",appearance:"none",alignItems:"center",justifyContent:"center",userSelect:"none",position:"relative",whiteSpace:"nowrap",verticalAlign:"middle",outline:"none",...a,...!!i&&{_focus:te}}},[a,i]),{ref:ce,type:oe}=P1e(G),ge={rightIcon:b,leftIcon:v,iconSpacing:A,children:y,shouldWrapChildren:ee};return C.jsxs(Nt.button,{disabled:l||d,ref:uEe(e,ce),as:G,type:N??oe,"data-active":Kn(p),"data-loading":Kn(d),__css:ne,className:un("chakra-button",B),...K,children:[d&&j==="start"&&C.jsx(KU,{className:"chakra-button__spinner--start",label:w,placement:"start",spacing:A,children:V}),d?w||C.jsx(Nt.span,{opacity:0,children:C.jsx(lY,{...ge})}):C.jsx(lY,{...ge}),d&&j==="end"&&C.jsx(KU,{className:"chakra-button__spinner--end",label:w,placement:"end",spacing:A,children:V})]})});zr.displayName="Button";function lY(n){const{leftIcon:e,rightIcon:i,children:a,iconSpacing:l,shouldWrapChildren:d}=n;return d?C.jsxs("span",{style:{display:"contents"},children:[e&&C.jsx(xw,{marginEnd:l,children:e}),a,i&&C.jsx(xw,{marginStart:l,children:i})]}):C.jsxs(C.Fragment,{children:[e&&C.jsx(xw,{marginEnd:l,children:e}),a,i&&C.jsx(xw,{marginStart:l,children:i})]})}const Ma=Bt((n,e)=>{const{icon:i,children:a,isRound:l,"aria-label":d,...p}=n,y=i||a,v=D.isValidElement(y)?D.cloneElement(y,{"aria-hidden":!0,focusable:!1}):null;return C.jsx(zr,{px:"0",py:"0",borderRadius:l?"full":void 0,ref:e,"aria-label":d,...p,children:v})});Ma.displayName="IconButton";const hte=Nt("div",{baseStyle:{display:"flex",alignItems:"center",justifyContent:"center"}});hte.displayName="Center";const O1e={horizontal:{insetStart:"50%",transform:"translateX(-50%)"},vertical:{top:"50%",transform:"translateY(-50%)"},both:{insetStart:"50%",top:"50%",transform:"translate(-50%, -50%)"}};Bt(function(e,i){const{axis:a="both",...l}=e;return C.jsx(Nt.div,{ref:i,__css:O1e[a],...l,position:"absolute"})});var k1e=()=>typeof document<"u",uY=!1,QR=null,ky=!1,qU=!1,YU=new Set;function sj(n,e){YU.forEach(i=>i(n,e))}var N1e=typeof window<"u"&&window.navigator!=null?/^Mac/.test(window.navigator.platform):!1;function D1e(n){return!(n.metaKey||!N1e&&n.altKey||n.ctrlKey||n.key==="Control"||n.key==="Shift"||n.key==="Meta")}function dY(n){ky=!0,D1e(n)&&(QR="keyboard",sj("keyboard",n))}function pS(n){if(QR="pointer",n.type==="mousedown"||n.type==="pointerdown"){ky=!0;const e=n.composedPath?n.composedPath()[0]:n.target;let i=!1;try{i=e.matches(":focus-visible")}catch{}if(i)return;sj("pointer",n)}}function L1e(n){return n.mozInputSource===0&&n.isTrusted?!0:n.detail===0&&!n.pointerType}function x1e(n){L1e(n)&&(ky=!0,QR="virtual")}function M1e(n){n.target===window||n.target===document||n.target instanceof Element&&n.target.hasAttribute("tabindex")||(!ky&&!qU&&(QR="virtual",sj("virtual",n)),ky=!1,qU=!1)}function U1e(){ky=!1,qU=!0}function hY(){return QR!=="pointer"}function V1e(){if(!k1e()||uY)return;const{focus:n}=HTMLElement.prototype;HTMLElement.prototype.focus=function(...i){ky=!0,n.apply(this,i)},document.addEventListener("keydown",dY,!0),document.addEventListener("keyup",dY,!0),document.addEventListener("click",x1e,!0),window.addEventListener("focus",M1e,!0),window.addEventListener("blur",U1e,!1),typeof PointerEvent<"u"?(document.addEventListener("pointerdown",pS,!0),document.addEventListener("pointermove",pS,!0),document.addEventListener("pointerup",pS,!0)):(document.addEventListener("mousedown",pS,!0),document.addEventListener("mousemove",pS,!0),document.addEventListener("mouseup",pS,!0)),uY=!0}function F1e(n){V1e(),n(hY());const e=()=>n(hY());return YU.add(e),()=>{YU.delete(e)}}const[j1e,fte]=Ui({name:"FormControlStylesContext",errorMessage:`useFormControlStyles returned is 'undefined'. Seems you forgot to wrap the components in "<FormControl />" `}),[B1e,L0]=Ui({strict:!1,name:"FormControlContext"});function W1e(n){const{id:e,isRequired:i,isInvalid:a,isDisabled:l,isReadOnly:d,...p}=n,y=D.useId(),v=e||`field-${y}`,b=`${v}-label`,w=`${v}-feedback`,A=`${v}-helptext`,[N,V]=D.useState(!1),[j,B]=D.useState(!1),[G,ee]=D.useState(!1),K=D.useCallback((te={},Z=null)=>({id:A,...te,ref:rs(Z,J=>{J&&B(!0)})}),[A]),ne=D.useCallback((te={},Z=null)=>({...te,ref:Z,"data-focus":Kn(G),"data-disabled":Kn(l),"data-invalid":Kn(a),"data-readonly":Kn(d),id:te.id!==void 0?te.id:b,htmlFor:te.htmlFor!==void 0?te.htmlFor:v}),[v,l,G,a,d,b]),ce=D.useCallback((te={},Z=null)=>({id:w,...te,ref:rs(Z,J=>{J&&V(!0)}),"aria-live":"polite"}),[w]),oe=D.useCallback((te={},Z=null)=>({...te,...p,ref:Z,role:"group","data-focus":Kn(G),"data-disabled":Kn(l),"data-invalid":Kn(a),"data-readonly":Kn(d)}),[p,l,G,a,d]),ge=D.useCallback((te={},Z=null)=>({...te,ref:Z,role:"presentation","aria-hidden":!0,children:te.children||"*"}),[]);return{isRequired:!!i,isInvalid:!!a,isReadOnly:!!d,isDisabled:!!l,isFocused:!!G,onFocus:()=>ee(!0),onBlur:()=>ee(!1),hasFeedbackText:N,setHasFeedbackText:V,hasHelpText:j,setHasHelpText:B,id:v,labelId:b,feedbackId:w,helpTextId:A,htmlProps:p,getHelpTextProps:K,getErrorMessageProps:ce,getRootProps:oe,getLabelProps:ne,getRequiredIndicatorProps:ge}}const pi=Bt(function(e,i){const a=lc("Form",e),l=Fi(e),{getRootProps:d,htmlProps:p,...y}=W1e(l),v=un("chakra-form-control",e.className);return C.jsx(B1e,{value:y,children:C.jsx(j1e,{value:a,children:C.jsx(Nt.div,{...d({},i),className:v,__css:a.container})})})});pi.displayName="FormControl";const XU=Bt(function(e,i){const a=L0(),l=fte(),d=un("chakra-form__helper-text",e.className);return C.jsx(Nt.div,{...a==null?void 0:a.getHelpTextProps(e,i),__css:l.helperText,className:d})});XU.displayName="FormHelperText";function oj(n){const{isDisabled:e,isInvalid:i,isReadOnly:a,isRequired:l,...d}=pte(n);return{...d,disabled:e,readOnly:a,required:l,"aria-invalid":FS(i),"aria-required":FS(l),"aria-readonly":FS(a)}}function pte(n){const e=L0(),{id:i,disabled:a,readOnly:l,required:d,isRequired:p,isInvalid:y,isReadOnly:v,isDisabled:b,onFocus:w,onBlur:A,...N}=n,V=n["aria-describedby"]?[n["aria-describedby"]]:[];return e!=null&&e.hasFeedbackText&&(e!=null&&e.isInvalid)&&V.push(e.feedbackId),e!=null&&e.hasHelpText&&V.push(e.helpTextId),{...N,"aria-describedby":V.join(" ")||void 0,id:i??(e==null?void 0:e.id),isDisabled:a??b??(e==null?void 0:e.isDisabled),isReadOnly:l??v??(e==null?void 0:e.isReadOnly),isRequired:d??p??(e==null?void 0:e.isRequired),isInvalid:y??(e==null?void 0:e.isInvalid),onFocus:Qn(e==null?void 0:e.onFocus,w),onBlur:Qn(e==null?void 0:e.onBlur,A)}}const z1e={border:"0",clip:"rect(0, 0, 0, 0)",height:"1px",width:"1px",margin:"-1px",padding:"0",overflow:"hidden",whiteSpace:"nowrap",position:"absolute"};function G1e(n={}){const e=pte(n),{isDisabled:i,isReadOnly:a,isRequired:l,isInvalid:d,id:p,onBlur:y,onFocus:v,"aria-describedby":b}=e,{defaultChecked:w,isChecked:A,isFocusable:N,onChange:V,isIndeterminate:j,name:B,value:G,tabIndex:ee=void 0,"aria-label":K,"aria-labelledby":ne,"aria-invalid":ce,...oe}=n,ge=A0(oe,["isDisabled","isReadOnly","isRequired","isInvalid","id","onBlur","onFocus","aria-describedby"]),te=Jc(V),Z=Jc(y),J=Jc(v),[se,he]=D.useState(!1),[fe,ue]=D.useState(!1),[Me,He]=D.useState(!1),[rt,we]=D.useState(!1);D.useEffect(()=>F1e(he),[]);const Ce=D.useRef(null),[ve,Ne]=D.useState(!0),[Te,be]=D.useState(!!w),Ae=A!==void 0,Ue=Ae?A:Te,ze=D.useCallback(Xt=>{if(a||i){Xt.preventDefault();return}Ae||be(Ue?Xt.currentTarget.checked:j?!0:Xt.currentTarget.checked),te==null||te(Xt)},[a,i,Ue,Ae,j,te]);bp(()=>{Ce.current&&(Ce.current.indeterminate=!!j)},[j]),Eg(()=>{i&&ue(!1)},[i,ue]),bp(()=>{const Xt=Ce.current;if(!(Xt!=null&&Xt.form))return;const Yn=()=>{be(!!w)};return Xt.form.addEventListener("reset",Yn),()=>{var qt;return(qt=Xt.form)==null?void 0:qt.removeEventListener("reset",Yn)}},[]);const et=i&&!N,nt=D.useCallback(Xt=>{Xt.key===" "&&we(!0)},[we]),dt=D.useCallback(Xt=>{Xt.key===" "&&we(!1)},[we]);bp(()=>{if(!Ce.current)return;Ce.current.checked!==Ue&&be(Ce.current.checked)},[Ce.current]);const Xe=D.useCallback((Xt={},Yn=null)=>{const qt=Re=>{fe&&Re.preventDefault(),we(!0)};return{...Xt,ref:Yn,"data-active":Kn(rt),"data-hover":Kn(Me),"data-checked":Kn(Ue),"data-focus":Kn(fe),"data-focus-visible":Kn(fe&&se),"data-indeterminate":Kn(j),"data-disabled":Kn(i),"data-invalid":Kn(d),"data-readonly":Kn(a),"aria-hidden":!0,onMouseDown:Qn(Xt.onMouseDown,qt),onMouseUp:Qn(Xt.onMouseUp,()=>we(!1)),onMouseEnter:Qn(Xt.onMouseEnter,()=>He(!0)),onMouseLeave:Qn(Xt.onMouseLeave,()=>He(!1))}},[rt,Ue,i,fe,se,Me,j,d,a]),It=D.useCallback((Xt={},Yn=null)=>({...Xt,ref:Yn,"data-active":Kn(rt),"data-hover":Kn(Me),"data-checked":Kn(Ue),"data-focus":Kn(fe),"data-focus-visible":Kn(fe&&se),"data-indeterminate":Kn(j),"data-disabled":Kn(i),"data-invalid":Kn(d),"data-readonly":Kn(a)}),[rt,Ue,i,fe,se,Me,j,d,a]),hn=D.useCallback((Xt={},Yn=null)=>({...ge,htmlFor:ve?p:void 0,...Xt,ref:rs(Yn,qt=>{qt&&Ne(qt.tagName==="LABEL")}),onClick:Qn(Xt.onClick,()=>{var qt;ve||((qt=Ce.current)==null||qt.click(),requestAnimationFrame(()=>{var Re;(Re=Ce.current)==null||Re.focus({preventScroll:!0})}))}),"data-disabled":Kn(i),"data-checked":Kn(Ue),"data-invalid":Kn(d)}),[ge,i,Ue,d,ve,p]),Ut=D.useCallback((Xt={},Yn=null)=>({...Xt,ref:rs(Ce,Yn),type:"checkbox",name:B,value:G,id:p,tabIndex:ee,onChange:Qn(Xt.onChange,ze),onBlur:Qn(Xt.onBlur,Z,()=>ue(!1)),onFocus:Qn(Xt.onFocus,J,()=>ue(!0)),onKeyDown:Qn(Xt.onKeyDown,nt),onKeyUp:Qn(Xt.onKeyUp,dt),required:l,checked:Ue,disabled:et,readOnly:a,"aria-label":K,"aria-labelledby":ne,"aria-invalid":ce?!!ce:d,"aria-describedby":b,"aria-disabled":i,"aria-checked":j?"mixed":Ue,style:z1e}),[B,G,p,ee,ze,Z,J,nt,dt,l,Ue,et,a,K,ne,ce,d,b,i,j]),ln=D.useCallback((Xt={},Yn=null)=>({...Xt,ref:Yn,onMouseDown:Qn(Xt.onMouseDown,H1e),"data-disabled":Kn(i),"data-checked":Kn(Ue),"data-invalid":Kn(d)}),[Ue,i,d]);return{state:{isInvalid:d,isFocused:fe,isChecked:Ue,isActive:rt,isHovered:Me,isIndeterminate:j,isDisabled:i,isReadOnly:a,isRequired:l},getRootProps:hn,getCheckboxProps:Xe,getIndicatorProps:It,getInputProps:Ut,getLabelProps:ln,htmlProps:ge}}function H1e(n){n.preventDefault(),n.stopPropagation()}const JU=Bt(function(e,i){const{className:a,centerContent:l,...d}=Fi(e),p=Ul("Container",e);return C.jsx(Nt.div,{ref:i,className:un("chakra-container",a),...d,__css:{...p,...l&&{display:"flex",flexDirection:"column",alignItems:"center"}}})});JU.displayName="Container";const Cp=Bt(function(e,i){const{borderLeftWidth:a,borderBottomWidth:l,borderTopWidth:d,borderRightWidth:p,borderWidth:y,borderStyle:v,borderColor:b,...w}=Ul("Divider",e),{className:A,orientation:N="horizontal",__css:V,...j}=Fi(e),B={vertical:{borderLeftWidth:a||p||y||"1px",height:"100%"},horizontal:{borderBottomWidth:l||d||y||"1px",width:"100%"}};return C.jsx(Nt.hr,{ref:i,"aria-orientation":N,...j,__css:{...w,border:"0",borderColor:b,borderStyle:v,...B[N],...V},className:un("chakra-divider",A)})});Cp.displayName="Divider";const mi=Bt(function(e,i){const{direction:a,align:l,justify:d,wrap:p,basis:y,grow:v,shrink:b,...w}=e,A={display:"flex",flexDirection:a,alignItems:l,justifyContent:d,flexWrap:p,flexBasis:y,flexGrow:v,flexShrink:b};return C.jsx(Nt.div,{ref:i,__css:A,...w})});mi.displayName="Flex";function $1e(n,e){if(n==null)return{};var i={};for(var a in n)if({}.hasOwnProperty.call(n,a)){if(e.indexOf(a)!==-1)continue;i[a]=n[a]}return i}var N2={exports:{}},D2,fY;function K1e(){if(fY)return D2;fY=1;var n="SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED";return D2=n,D2}var L2,pY;function q1e(){if(pY)return L2;pY=1;var n=K1e();function e(){}function i(){}return i.resetWarningCache=e,L2=function(){function a(p,y,v,b,w,A){if(A!==n){var N=new Error("Calling PropTypes validators directly is not supported by the `prop-types` package. Use PropTypes.checkPropTypes() to call them. Read more at http://fb.me/use-check-prop-types");throw N.name="Invariant Violation",N}}a.isRequired=a;function l(){return a}var d={array:a,bigint:a,bool:a,func:a,number:a,object:a,string:a,symbol:a,any:a,arrayOf:l,element:a,elementType:a,instanceOf:l,node:a,objectOf:l,oneOf:l,oneOfType:l,shape:l,exact:l,checkPropTypes:i,resetWarningCache:e};return d.PropTypes=d,d},L2}var mY;function Y1e(){return mY||(mY=1,N2.exports=q1e()()),N2.exports}var X1e=Y1e();const mr=I0(X1e);var QU="data-focus-lock",mte="data-focus-lock-disabled",J1e="data-no-focus-lock",Q1e="data-autofocus-inside",Z1e="data-no-autofocus";function x2(n,e){return typeof n=="function"?n(e):n&&(n.current=e),n}function eNe(n,e){var i=D.useState(function(){return{value:n,callback:e,facade:{get current(){return i.value},set current(a){var l=i.value;l!==a&&(i.value=a,i.callback(a,l))}}}})[0];return i.callback=e,i.facade}var tNe=typeof window<"u"?D.useLayoutEffect:D.useEffect,gY=new WeakMap;function gte(n,e){var i=eNe(null,function(a){return n.forEach(function(l){return x2(l,a)})});return tNe(function(){var a=gY.get(i);if(a){var l=new Set(a),d=new Set(n),p=i.current;l.forEach(function(y){d.has(y)||x2(y,null)}),d.forEach(function(y){l.has(y)||x2(y,p)})}gY.set(i,n)},[n]),i}var M2={width:"1px",height:"0px",padding:0,overflow:"hidden",position:"fixed",top:"1px",left:"1px"},Bh=function(){return Bh=Object.assign||function(e){for(var i,a=1,l=arguments.length;a<l;a++){i=arguments[a];for(var d in i)Object.prototype.hasOwnProperty.call(i,d)&&(e[d]=i[d])}return e},Bh.apply(this,arguments)};function ZR(n,e){var i={};for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&e.indexOf(a)<0&&(i[a]=n[a]);if(n!=null&&typeof Object.getOwnPropertySymbols=="function")for(var l=0,a=Object.getOwnPropertySymbols(n);l<a.length;l++)e.indexOf(a[l])<0&&Object.prototype.propertyIsEnumerable.call(n,a[l])&&(i[a[l]]=n[a[l]]);return i}function nNe(n,e,i){if(i||arguments.length===2)for(var a=0,l=e.length,d;a<l;a++)(d||!(a in e))&&(d||(d=Array.prototype.slice.call(e,0,a)),d[a]=e[a]);return n.concat(d||Array.prototype.slice.call(e))}function _te(n){return n}function yte(n,e){e===void 0&&(e=_te);var i=[],a=!1,l={read:function(){if(a)throw new Error("Sidecar: could not `read` from an `assigned` medium. `read` could be used only with `useMedium`.");return i.length?i[i.length-1]:n},useMedium:function(d){var p=e(d,a);return i.push(p),function(){i=i.filter(function(y){return y!==p})}},assignSyncMedium:function(d){for(a=!0;i.length;){var p=i;i=[],p.forEach(d)}i={push:function(y){return d(y)},filter:function(){return i}}},assignMedium:function(d){a=!0;var p=[];if(i.length){var y=i;i=[],y.forEach(d),p=i}var v=function(){var w=p;p=[],w.forEach(d)},b=function(){return Promise.resolve().then(v)};b(),i={push:function(w){p.push(w),b()},filter:function(w){return p=p.filter(w),i}}}};return l}function aj(n,e){return e===void 0&&(e=_te),yte(n,e)}function Ete(n){n===void 0&&(n={});var e=yte(null);return e.options=Bh({async:!0,ssr:!1},n),e}var vte=function(n){var e=n.sideCar,i=ZR(n,["sideCar"]);if(!e)throw new Error("Sidecar: please provide `sideCar` property to import the right car");var a=e.read();if(!a)throw new Error("Sidecar medium not found");return D.createElement(a,Bh({},i))};vte.isSideCarExport=!0;function rNe(n,e){return n.useMedium(e),vte}var Ste=aj({},function(n){var e=n.target,i=n.currentTarget;return{target:e,currentTarget:i}}),bte=aj(),iNe=aj(),sNe=Ete({async:!0,ssr:typeof document<"u"}),oNe=D.createContext(void 0),aNe=[],cj=D.forwardRef(function(e,i){var a,l=D.useState(),d=l[0],p=l[1],y=D.useRef(),v=D.useRef(!1),b=D.useRef(null),w=D.useState({}),A=w[1],N=e.children,V=e.disabled,j=V===void 0?!1:V,B=e.noFocusGuards,G=B===void 0?!1:B,ee=e.persistentFocus,K=ee===void 0?!1:ee,ne=e.crossFrame,ce=ne===void 0?!0:ne,oe=e.autoFocus,ge=oe===void 0?!0:oe;e.allowTextSelection;var te=e.group,Z=e.className,J=e.whiteList,se=e.hasPositiveIndices,he=e.shards,fe=he===void 0?aNe:he,ue=e.as,Me=ue===void 0?"div":ue,He=e.lockProps,rt=He===void 0?{}:He,we=e.sideCar,Ce=e.returnFocus,ve=Ce===void 0?!1:Ce,Ne=e.focusOptions,Te=e.onActivation,be=e.onDeactivation,Ae=D.useState({}),Ue=Ae[0],ze=D.useCallback(function(Yn){var qt=Yn.captureFocusRestore;if(!b.current){var Re,Fe=(Re=document)==null?void 0:Re.activeElement;b.current=Fe,Fe!==document.body&&(b.current=qt(Fe))}y.current&&Te&&Te(y.current),v.current=!0,A()},[Te]),et=D.useCallback(function(){v.current=!1,be&&be(y.current),A()},[be]),nt=D.useCallback(function(Yn){var qt=b.current;if(qt){var Re=(typeof qt=="function"?qt():qt)||document.body,Fe=typeof ve=="function"?ve(Re):ve;if(Fe){var Ke=typeof Fe=="object"?Fe:void 0;b.current=null,Yn?Promise.resolve().then(function(){return Re.focus(Ke)}):Re.focus(Ke)}}},[ve]),dt=D.useCallback(function(Yn){v.current&&Ste.useMedium(Yn)},[]),Xe=bte.useMedium,It=D.useCallback(function(Yn){y.current!==Yn&&(y.current=Yn,p(Yn))},[]),hn=Oy((a={},a[mte]=j&&"disabled",a[QU]=te,a),rt),Ut=G!==!0,ln=Ut&&G!=="tail",xn=gte([i,It]),Xt=D.useMemo(function(){return{observed:y,shards:fe,enabled:!j,active:v.current}},[j,v.current,fe,d]);return ri.createElement(D.Fragment,null,Ut&&[ri.createElement("div",{key:"guard-first","data-focus-guard":!0,tabIndex:j?-1:0,style:M2}),se?ri.createElement("div",{key:"guard-nearest","data-focus-guard":!0,tabIndex:j?-1:1,style:M2}):null],!j&&ri.createElement(we,{id:Ue,sideCar:sNe,observed:d,disabled:j,persistentFocus:K,crossFrame:ce,autoFocus:ge,whiteList:J,shards:fe,onActivation:ze,onDeactivation:et,returnFocus:nt,focusOptions:Ne,noFocusGuards:G}),ri.createElement(Me,Oy({ref:xn},hn,{className:Z,onBlur:Xe,onFocus:dt}),ri.createElement(oNe.Provider,{value:Xt},N)),ln&&ri.createElement("div",{"data-focus-guard":!0,tabIndex:j?-1:0,style:M2}))});cj.propTypes={};function ZU(n,e){return ZU=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(i,a){return i.__proto__=a,i},ZU(n,e)}function cNe(n,e){n.prototype=Object.create(e.prototype),n.prototype.constructor=n,ZU(n,e)}function wR(n){"@babel/helpers - typeof";return wR=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},wR(n)}function lNe(n,e){if(wR(n)!="object"||!n)return n;var i=n[Symbol.toPrimitive];if(i!==void 0){var a=i.call(n,e);if(wR(a)!="object")return a;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(n)}function uNe(n){var e=lNe(n,"string");return wR(e)=="symbol"?e:e+""}function dNe(n,e,i){return(e=uNe(e))in n?Object.defineProperty(n,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):n[e]=i,n}function hNe(n,e){function i(a){return a.displayName||a.name||"Component"}return function(l){var d=[],p;function y(){p=n(d.map(function(b){return b.props})),e(p)}var v=function(b){cNe(w,b);function w(){return b.apply(this,arguments)||this}w.peek=function(){return p};var A=w.prototype;return A.componentDidMount=function(){d.push(this),y()},A.componentDidUpdate=function(){y()},A.componentWillUnmount=function(){var V=d.indexOf(this);d.splice(V,1),y()},A.render=function(){return ri.createElement(l,this.props)},w}(D.PureComponent);return dNe(v,"displayName","SideEffect("+i(l)+")"),v}}var uf=function(n){for(var e=Array(n.length),i=0;i<n.length;++i)e[i]=n[i];return e},Ny=function(n){return Array.isArray(n)?n:[n]},Tte=function(n){return Array.isArray(n)?n[0]:n},fNe=function(n){if(n.nodeType!==Node.ELEMENT_NODE)return!1;var e=window.getComputedStyle(n,null);return!e||!e.getPropertyValue?!1:e.getPropertyValue("display")==="none"||e.getPropertyValue("visibility")==="hidden"},wte=function(n){return n.parentNode&&n.parentNode.nodeType===Node.DOCUMENT_FRAGMENT_NODE?n.parentNode.host:n.parentNode},Rte=function(n){return n===document||n&&n.nodeType===Node.DOCUMENT_NODE},pNe=function(n){return n.hasAttribute("inert")},mNe=function(n,e){return!n||Rte(n)||!fNe(n)&&!pNe(n)&&e(wte(n))},Cte=function(n,e){var i=n.get(e);if(i!==void 0)return i;var a=mNe(e,Cte.bind(void 0,n));return n.set(e,a),a},gNe=function(n,e){return n&&!Rte(n)?ENe(n)?e(wte(n)):!1:!0},Ite=function(n,e){var i=n.get(e);if(i!==void 0)return i;var a=gNe(e,Ite.bind(void 0,n));return n.set(e,a),a},Ate=function(n){return n.dataset},_Ne=function(n){return n.tagName==="BUTTON"},Pte=function(n){return n.tagName==="INPUT"},Ote=function(n){return Pte(n)&&n.type==="radio"},yNe=function(n){return!((Pte(n)||_Ne(n))&&(n.type==="hidden"||n.disabled))},ENe=function(n){var e=n.getAttribute(Z1e);return![!0,"true",""].includes(e)},lj=function(n){var e;return!!(n&&(!((e=Ate(n))===null||e===void 0)&&e.focusGuard))},eV=function(n){return!lj(n)},vNe=function(n){return!!n},SNe=function(n,e){var i=Math.max(0,n.tabIndex),a=Math.max(0,e.tabIndex),l=i-a,d=n.index-e.index;if(l){if(!i)return 1;if(!a)return-1}return l||d},bNe=function(n){return n.tabIndex<0&&!n.hasAttribute("tabindex")?0:n.tabIndex},uj=function(n,e,i){return uf(n).map(function(a,l){var d=bNe(a);return{node:a,index:l,tabIndex:i&&d===-1?(a.dataset||{}).focusGuard?0:-1:d}}).filter(function(a){return!e||a.tabIndex>=0}).sort(SNe)},TNe=["button:enabled","select:enabled","textarea:enabled","input:enabled","a[href]","area[href]","summary","iframe","object","embed","audio[controls]","video[controls]","[tabindex]","[contenteditable]","[autofocus]"],dj=TNe.join(","),wNe="".concat(dj,", [data-focus-guard]"),kte=function(n,e){return uf((n.shadowRoot||n).children).reduce(function(i,a){return i.concat(a.matches(e?wNe:dj)?[a]:[],kte(a))},[])},RNe=function(n,e){var i;return n instanceof HTMLIFrameElement&&(!((i=n.contentDocument)===null||i===void 0)&&i.body)?u0([n.contentDocument.body],e):[n]},u0=function(n,e){return n.reduce(function(i,a){var l,d=kte(a,e),p=(l=[]).concat.apply(l,d.map(function(y){return RNe(y,e)}));return i.concat(p,a.parentNode?uf(a.parentNode.querySelectorAll(dj)).filter(function(y){return y===a}):[])},[])},CNe=function(n){var e=n.querySelectorAll("[".concat(Q1e,"]"));return uf(e).map(function(i){return u0([i])}).reduce(function(i,a){return i.concat(a)},[])},hj=function(n,e){return uf(n).filter(function(i){return Cte(e,i)}).filter(function(i){return yNe(i)})},_Y=function(n,e){return e===void 0&&(e=new Map),uf(n).filter(function(i){return Ite(e,i)})},fj=function(n,e,i){return uj(hj(u0(n,i),e),!0,i)},RR=function(n,e){return uj(hj(u0(n),e),!1)},INe=function(n,e){return hj(CNe(n),e)},Cy=function(n,e){return n.shadowRoot?Cy(n.shadowRoot,e):Object.getPrototypeOf(n).contains!==void 0&&Object.getPrototypeOf(n).contains.call(n,e)?!0:uf(n.children).some(function(i){var a;if(i instanceof HTMLIFrameElement){var l=(a=i.contentDocument)===null||a===void 0?void 0:a.body;return l?Cy(l,e):!1}return Cy(i,e)})},ANe=function(n){for(var e=new Set,i=n.length,a=0;a<i;a+=1)for(var l=a+1;l<i;l+=1){var d=n[a].compareDocumentPosition(n[l]);(d&Node.DOCUMENT_POSITION_CONTAINED_BY)>0&&e.add(l),(d&Node.DOCUMENT_POSITION_CONTAINS)>0&&e.add(a)}return n.filter(function(p,y){return!e.has(y)})},Nte=function(n){return n.parentNode?Nte(n.parentNode):n},pj=function(n){var e=Ny(n);return e.filter(Boolean).reduce(function(i,a){var l=a.getAttribute(QU);return i.push.apply(i,l?ANe(uf(Nte(a).querySelectorAll("[".concat(QU,'="').concat(l,'"]:not([').concat(mte,'="disabled"])')))):[a]),i},[])},PNe=function(n){try{return n()}catch{return}},CR=function(n){if(n===void 0&&(n=document),!(!n||!n.activeElement)){var e=n.activeElement;return e.shadowRoot?CR(e.shadowRoot):e instanceof HTMLIFrameElement&&PNe(function(){return e.contentWindow.document})?CR(e.contentWindow.document):e}},ONe=function(n,e){return n===e},kNe=function(n,e){return!!uf(n.querySelectorAll("iframe")).some(function(i){return ONe(i,e)})},Dte=function(n,e){return e===void 0&&(e=CR(Tte(n).ownerDocument)),!e||e.dataset&&e.dataset.focusGuard?!1:pj(n).some(function(i){return Cy(i,e)||kNe(i,e)})},NNe=function(n){n===void 0&&(n=document);var e=CR(n);return e?uf(n.querySelectorAll("[".concat(J1e,"]"))).some(function(i){return Cy(i,e)}):!1},DNe=function(n,e){return e.filter(Ote).filter(function(i){return i.name===n.name}).filter(function(i){return i.checked})[0]||n},mj=function(n,e){return Ote(n)&&n.name?DNe(n,e):n},LNe=function(n){var e=new Set;return n.forEach(function(i){return e.add(mj(i,n))}),n.filter(function(i){return e.has(i)})},yY=function(n){return n[0]&&n.length>1?mj(n[0],n):n[0]},EY=function(n,e){return n.indexOf(mj(e,n))},tV="NEW_FOCUS",xNe=function(n,e,i,a,l){var d=n.length,p=n[0],y=n[d-1],v=lj(a);if(!(a&&n.indexOf(a)>=0)){var b=a!==void 0?i.indexOf(a):-1,w=l?i.indexOf(l):b,A=l?n.indexOf(l):-1;if(b===-1)return A!==-1?A:tV;if(A===-1)return tV;var N=b-w,V=i.indexOf(p),j=i.indexOf(y),B=LNe(i),G=a!==void 0?B.indexOf(a):-1,ee=l?B.indexOf(l):G,K=B.filter(function(Z){return Z.tabIndex>=0}),ne=a!==void 0?K.indexOf(a):-1,ce=l?K.indexOf(l):ne,oe=ne>=0&&ce>=0?ce-ne:ee-G;if(!N&&A>=0||e.length===0)return A;var ge=EY(n,e[0]),te=EY(n,e[e.length-1]);if(b<=V&&v&&Math.abs(N)>1)return te;if(b>=j&&v&&Math.abs(N)>1)return ge;if(N&&Math.abs(oe)>1)return A;if(b<=V)return te;if(b>j)return ge;if(N)return Math.abs(N)>1?A:(d+A+N)%d}},MNe=function(n){return function(e){var i,a=(i=Ate(e))===null||i===void 0?void 0:i.autofocus;return e.autofocus||a!==void 0&&a!=="false"||n.indexOf(e)>=0}},vY=function(n,e,i){var a=n.map(function(d){var p=d.node;return p}),l=_Y(a.filter(MNe(i)));return l&&l.length?yY(l):yY(_Y(e))},nV=function(n,e){return e===void 0&&(e=[]),e.push(n),n.parentNode&&nV(n.parentNode.host||n.parentNode,e),e},U2=function(n,e){for(var i=nV(n),a=nV(e),l=0;l<i.length;l+=1){var d=i[l];if(a.indexOf(d)>=0)return d}return!1},Lte=function(n,e,i){var a=Ny(n),l=Ny(e),d=a[0],p=!1;return l.filter(Boolean).forEach(function(y){p=U2(p||y,y)||p,i.filter(Boolean).forEach(function(v){var b=U2(d,v);b&&(!p||Cy(b,p)?p=b:p=U2(b,p))})}),p},SY=function(n,e){return n.reduce(function(i,a){return i.concat(INe(a,e))},[])},UNe=function(n,e){var i=new Map;return e.forEach(function(a){return i.set(a.node,a)}),n.map(function(a){return i.get(a)}).filter(vNe)},VNe=function(n,e){var i=CR(Ny(n).length>0?document:Tte(n).ownerDocument),a=pj(n).filter(eV),l=Lte(i||n,n,a),d=new Map,p=RR(a,d),y=p.filter(function(j){var B=j.node;return eV(B)});if(y[0]){var v=RR([l],d).map(function(j){var B=j.node;return B}),b=UNe(v,y),w=b.map(function(j){var B=j.node;return B}),A=b.filter(function(j){var B=j.tabIndex;return B>=0}).map(function(j){var B=j.node;return B}),N=xNe(w,A,v,i,e);if(N===tV){var V=vY(p,A,SY(a,d))||vY(p,w,SY(a,d));if(V)return{node:V};console.warn("focus-lock: cannot find any node to move focus into");return}return N===void 0?N:b[N]}},FNe=function(n){var e=pj(n).filter(eV),i=Lte(n,n,e),a=uj(u0([i],!0),!0,!0),l=u0(e,!1);return a.map(function(d){var p=d.node,y=d.index;return{node:p,index:y,lockItem:l.indexOf(p)>=0,guard:lj(p)}})},gj=function(n,e){n&&("focus"in n&&n.focus(e),"contentWindow"in n&&n.contentWindow&&n.contentWindow.focus())},V2=0,F2=!1,xte=function(n,e,i){i===void 0&&(i={});var a=VNe(n,e);if(!F2&&a){if(V2>2){console.error("FocusLock: focus-fighting detected. Only one focus management system could be active. See https://github.com/theKashey/focus-lock/#focus-fighting"),F2=!0,setTimeout(function(){F2=!1},1);return}V2++,gj(a.node,i.focusOptions),V2--}};function uw(n){if(!n)return null;if(typeof WeakRef>"u")return function(){return n||null};var e=n?new WeakRef(n):null;return function(){return(e==null?void 0:e.deref())||null}}var jNe=function(n){if(!n)return null;for(var e=[],i=n;i&&i!==document.body;)e.push({current:uw(i),parent:uw(i.parentElement),left:uw(i.previousElementSibling),right:uw(i.nextElementSibling)}),i=i.parentElement;return{element:uw(n),stack:e,ownerDocument:n.ownerDocument}},BNe=function(n){var e,i,a,l,d;if(n)for(var p=n.stack,y=n.ownerDocument,v=new Map,b=0,w=p;b<w.length;b++){var A=w[b],N=(e=A.parent)===null||e===void 0?void 0:e.call(A);if(N&&y.contains(N)){for(var V=(i=A.left)===null||i===void 0?void 0:i.call(A),j=A.current(),B=N.contains(j)?j:void 0,G=(a=A.right)===null||a===void 0?void 0:a.call(A),ee=fj([N],v),K=(d=(l=B??(V==null?void 0:V.nextElementSibling))!==null&&l!==void 0?l:G)!==null&&d!==void 0?d:V;K;){for(var ne=0,ce=ee;ne<ce.length;ne++){var oe=ce[ne];if(K!=null&&K.contains(oe.node))return oe.node}K=K.nextElementSibling}if(ee.length)return ee[0].node}}},Mte=function(n){var e=jNe(n);return function(){return BNe(e)}},WNe=function(n,e,i){if(!n||!e)return console.error("no element or scope given"),{};var a=Ny(e);if(a.every(function(p){return!Cy(p,n)}))return console.error("Active element is not contained in the scope"),{};var l=i?fj(a,new Map):RR(a,new Map),d=l.findIndex(function(p){var y=p.node;return y===n});if(d!==-1)return{prev:l[d-1],next:l[d+1],first:l[0],last:l[l.length-1]}},zNe=function(n,e){var i=e?fj(Ny(n),new Map):RR(Ny(n),new Map);return{first:i[0],last:i[i.length-1]}},GNe=function(n){return Object.assign({scope:document.body,cycle:!0,onlyTabbable:!0},n)},Ute=function(n,e,i){e===void 0&&(e={});var a=GNe(e),l=WNe(n,a.scope,a.onlyTabbable);if(l){var d=i(l,a.cycle);d&&gj(d.node,a.focusOptions)}},HNe=function(n,e){e===void 0&&(e={}),Ute(n,e,function(i,a){var l=i.next,d=i.first;return l||a&&d})},$Ne=function(n,e){e===void 0&&(e={}),Ute(n,e,function(i,a){var l=i.prev,d=i.last;return l||a&&d})},Vte=function(n,e,i){var a,l=zNe(n,(a=e.onlyTabbable)!==null&&a!==void 0?a:!0),d=l[i];d&&gj(d.node,e.focusOptions)},KNe=function(n,e){e===void 0&&(e={}),Vte(n,e,"first")},qNe=function(n,e){e===void 0&&(e={}),Vte(n,e,"last")};function _j(n){setTimeout(n,1)}var YNe=function(e){return e&&"current"in e?e.current:e},Fte=function(){return document&&document.activeElement===document.body},XNe=function(){return Fte()||NNe()},qS=null,Gc=null,bY=function(){return null},YS=null,IR=!1,yj=!1,JNe=function(){return!0},QNe=function(e){return(qS.whiteList||JNe)(e)},ZNe=function(e,i){YS={observerNode:e,portaledElement:i}},eDe=function(e){return YS&&YS.portaledElement===e};function TY(n,e,i,a){var l=null,d=n;do{var p=a[d];if(p.guard)p.node.dataset.focusAutoGuard&&(l=p);else if(p.lockItem){if(d!==n)return;l=null}else break}while((d+=i)!==e);l&&(l.node.tabIndex=0)}var tDe=function(e){return e?!!IR:IR==="meanwhile"},nDe=function n(e,i,a){return i&&(i.host===e&&(!i.activeElement||a.contains(i.activeElement))||i.parentNode&&n(e,i.parentNode,a))},rDe=function(e,i){return i.some(function(a){return nDe(e,a,a)})},jte=function(e){return RR(e,new Map)},iDe=function(e){return!jte([e.parentNode]).some(function(i){return i.node===e})},Nk=function(){var e=!1;if(qS){var i=qS,a=i.observed,l=i.persistentFocus,d=i.autoFocus,p=i.shards,y=i.crossFrame,v=i.focusOptions,b=i.noFocusGuards,w=a||YS&&YS.portaledElement;if(Fte()&&Gc&&Gc!==document.body&&(!document.body.contains(Gc)||iDe(Gc))){var A=bY();A&&A.focus()}var N=document&&document.activeElement;if(w){var V=[w].concat(p.map(YNe).filter(Boolean)),j=function(){if(!tDe(y)||!b||!Gc||yj)return!1;var ne=jte(V),ce=ne.findIndex(function(oe){var ge=oe.node;return ge===Gc});return ce===0||ce===ne.length-1};if((!N||QNe(N))&&(l||j()||!XNe()||!Gc&&d)&&(w&&!(Dte(V)||N&&rDe(N,V)||eDe(N))&&(document&&!Gc&&N&&!d?(N.blur&&N.blur(),document.body.focus()):(e=xte(V,Gc,{focusOptions:v}),YS={})),Gc=document&&document.activeElement,Gc!==document.body&&(bY=Mte(Gc)),IR=!1),document&&N!==document.activeElement&&document.querySelector("[data-focus-auto-guard]")){var B=document&&document.activeElement,G=FNe(V),ee=G.map(function(K){var ne=K.node;return ne}).indexOf(B);ee>-1&&(G.filter(function(K){var ne=K.guard,ce=K.node;return ne&&ce.dataset.focusAutoGuard}).forEach(function(K){var ne=K.node;return ne.removeAttribute("tabIndex")}),TY(ee,G.length,1,G),TY(ee,-1,-1,G))}}}return e},Bte=function(e){Nk()&&e&&(e.stopPropagation(),e.preventDefault())},Ej=function(){return _j(Nk)},sDe=function(e){var i=e.target,a=e.currentTarget;a.contains(i)||ZNe(a,i)},oDe=function(){return null},Wte=function(){yj=!0},zte=function(){yj=!1,IR="just",_j(function(){IR="meanwhile"})},aDe=function(){document.addEventListener("focusin",Bte),document.addEventListener("focusout",Ej),window.addEventListener("focus",Wte),window.addEventListener("blur",zte)},cDe=function(){document.removeEventListener("focusin",Bte),document.removeEventListener("focusout",Ej),window.removeEventListener("focus",Wte),window.removeEventListener("blur",zte)};function lDe(n){return n.filter(function(e){var i=e.disabled;return!i})}var Gte={moveFocusInside:xte,focusInside:Dte,focusNextElement:HNe,focusPrevElement:$Ne,focusFirstElement:KNe,focusLastElement:qNe,captureFocusRestore:Mte};function uDe(n){var e=n.slice(-1)[0];e&&!qS&&aDe();var i=qS,a=i&&e&&e.id===i.id;qS=e,i&&!a&&(i.onDeactivation(),n.filter(function(l){var d=l.id;return d===i.id}).length||i.returnFocus(!e)),e?(Gc=null,(!a||i.observed!==e.observed)&&e.onActivation(Gte),Nk(),_j(Nk)):(cDe(),Gc=null)}Ste.assignSyncMedium(sDe);bte.assignMedium(Ej);iNe.assignMedium(function(n){return n(Gte)});const dDe=hNe(lDe,uDe)(oDe);var rV=D.forwardRef(function(e,i){return ri.createElement(cj,Oy({sideCar:dDe,ref:i},e))}),Hte=cj.propTypes||{};Hte.sideCar;$1e(Hte,["sideCar"]);rV.propTypes={};const hDe=rV.default??rV,$te=n=>{const{initialFocusRef:e,finalFocusRef:i,contentRef:a,restoreFocus:l,children:d,isDisabled:p,autoFocus:y,persistentFocus:v,lockFocusAcrossFrames:b}=n,w=D.useCallback(()=>{e!=null&&e.current?e.current.focus():a!=null&&a.current&&PQ(a.current).length===0&&requestAnimationFrame(()=>{var j;(j=a.current)==null||j.focus()})},[e,a]),A=D.useCallback(()=>{var V;(V=i==null?void 0:i.current)==null||V.focus()},[i]),N=l&&!i;return C.jsx(hDe,{crossFrame:b,persistentFocus:v,autoFocus:y,disabled:p,onActivation:w,onDeactivation:A,returnFocus:N,children:d})};$te.displayName="FocusLock";const[fDe,pDe]=Ui({name:"FormErrorStylesContext",errorMessage:`useFormErrorStyles returned is 'undefined'. Seems you forgot to wrap the components in "<FormError />" `}),hp=Bt((n,e)=>{const i=lc("FormError",n),a=Fi(n),l=L0();return l!=null&&l.isInvalid?C.jsx(fDe,{value:i,children:C.jsx(Nt.div,{...l==null?void 0:l.getErrorMessageProps(a,e),className:un("chakra-form__error-message",n.className),__css:{display:"flex",alignItems:"center",...i.text}})}):null});hp.displayName="FormErrorMessage";const mDe=Bt((n,e)=>{const i=pDe(),a=L0();if(!(a!=null&&a.isInvalid))return null;const l=un("chakra-form__error-icon",n.className);return C.jsx(Dn,{ref:e,"aria-hidden":!0,...n,__css:i.icon,className:l,children:C.jsx("path",{fill:"currentColor",d:"M11.983,0a12.206,12.206,0,0,0-8.51,3.653A11.8,11.8,0,0,0,0,12.207,11.779,11.779,0,0,0,11.8,24h.214A12.111,12.111,0,0,0,24,11.791h0A11.766,11.766,0,0,0,11.983,0ZM10.5,16.542a1.476,1.476,0,0,1,1.449-1.53h.027a1.527,1.527,0,0,1,1.523,1.47,1.475,1.475,0,0,1-1.449,1.53h-.027A1.529,1.529,0,0,1,10.5,16.542ZM11,12.5v-6a1,1,0,0,1,2,0v6a1,1,0,1,1-2,0Z"})})});mDe.displayName="FormErrorIcon";const Io=Bt(function(e,i){const a=Ul("FormLabel",e),l=Fi(e),{className:d,children:p,requiredIndicator:y=C.jsx(Kte,{}),optionalIndicator:v=null,...b}=l,w=L0(),A=(w==null?void 0:w.getLabelProps(b,i))??{ref:i,...b};return C.jsxs(Nt.label,{...A,className:un("chakra-form__label",l.className),__css:{display:"block",textAlign:"start",...a},children:[p,w!=null&&w.isRequired?y:v]})});Io.displayName="FormLabel";const Kte=Bt(function(e,i){const a=L0(),l=fte();if(!(a!=null&&a.isRequired))return null;const d=un("chakra-form__required-indicator",e.className);return C.jsx(Nt.span,{...a==null?void 0:a.getRequiredIndicatorProps(e,i),__css:l.requiredIndicator,className:d})});Kte.displayName="RequiredIndicator";const qte=Bt(function(e,i){const{templateAreas:a,gap:l,rowGap:d,columnGap:p,column:y,row:v,autoFlow:b,autoRows:w,templateRows:A,autoColumns:N,templateColumns:V,...j}=e,B={display:"grid",gridTemplateAreas:a,gridGap:l,gridRowGap:d,gridColumnGap:p,gridAutoColumns:N,gridColumn:y,gridRow:v,gridAutoFlow:b,gridAutoRows:w,gridTemplateRows:A,gridTemplateColumns:V};return C.jsx(Nt.div,{ref:i,__css:B,...j})});qte.displayName="Grid";const Yte=Bt(function(e,i){const{columns:a,spacingX:l,spacingY:d,spacing:p,minChildWidth:y,...v}=e,b=D0(),w=y?_De(y,b):yDe(a);return C.jsx(qte,{ref:i,gap:p,columnGap:l,rowGap:d,templateColumns:w,...v})});Yte.displayName="SimpleGrid";function gDe(n){return typeof n=="number"?`${n}px`:n}function _De(n,e){return d1(n,i=>{const a=Jke("sizes",i,gDe(i))(e);return i===null?null:`repeat(auto-fit, minmax(${a}, 1fr))`})}function yDe(n){return d1(n,e=>e===null?null:`repeat(${e}, minmax(0, 1fr))`)}function Ng(n){const{viewBox:e="0 0 24 24",d:i,displayName:a,defaultProps:l={}}=n,d=D.Children.toArray(n.path),p=Bt((y,v)=>C.jsx(Dn,{ref:v,viewBox:e,...l,...y,children:d.length?d:C.jsx("path",{fill:"currentColor",d:i})}));return p.displayName=a,p}const iV=Bt(function(e,i){const{htmlWidth:a,htmlHeight:l,alt:d,...p}=e;return C.jsx("img",{width:a,height:l,ref:i,alt:d,...p})});iV.displayName="NativeImage";const Gh=Bt(function(e,i){const{fallbackSrc:a,fallback:l,src:d,srcSet:p,align:y,fit:v,loading:b,ignoreFallback:w,crossOrigin:A,fallbackStrategy:N="beforeLoadOrError",referrerPolicy:V,...j}=e,B=a!==void 0||l!==void 0,G=b!=null||w||!B,ee=ute({...e,crossOrigin:A,ignoreFallback:G}),K=C1e(ee,N),ne={ref:i,objectFit:v,objectPosition:y,...G?j:A0(j,["onError","onLoad"])};return K?l||C.jsx(Nt.img,{as:iV,className:"chakra-image__placeholder",src:a,...ne}):C.jsx(Nt.img,{as:iV,src:d,srcSet:p,crossOrigin:A,loading:b,referrerPolicy:V,className:"chakra-image",...ne})});Gh.displayName="Image";const ls=Bt(function(e,i){const{htmlSize:a,...l}=e,d=lc("Input",l),p=Fi(l),y=oj(p),v=un("chakra-input",e.className);return C.jsx(Nt.input,{size:a,...y,__css:d.field,ref:i,className:v})});ls.displayName="Input";ls.id="Input";const[EDe,vDe]=Ui({name:"InputGroupStylesContext",errorMessage:`useInputGroupStyles returned is 'undefined'. Seems you forgot to wrap the components in "<InputGroup />" `}),tk=Bt(function(e,i){const a=lc("Input",e),{children:l,className:d,...p}=Fi(e),y=un("chakra-input__group",d),v={},b=eF(l),w=a.field;b.forEach(N=>{a&&(w&&N.type.id==="InputLeftElement"&&(v.paddingStart=w.height??w.h),w&&N.type.id==="InputRightElement"&&(v.paddingEnd=w.height??w.h),N.type.id==="InputRightAddon"&&(v.borderEndRadius=0),N.type.id==="InputLeftAddon"&&(v.borderStartRadius=0))});const A=b.map(N=>{var j,B;const V=u1({size:((j=N.props)==null?void 0:j.size)||e.size,variant:((B=N.props)==null?void 0:B.variant)||e.variant});return N.type.id!=="Input"?D.cloneElement(N,V):D.cloneElement(N,Object.assign(V,v,N.props))});return C.jsx(Nt.div,{className:y,ref:i,__css:{width:"100%",display:"flex",position:"relative",isolation:"isolate",...a.group},"data-group":!0,...p,children:C.jsx(EDe,{value:a,children:A})})});tk.displayName="InputGroup";const SDe=Nt("div",{baseStyle:{display:"flex",alignItems:"center",justifyContent:"center",position:"absolute",top:"0",zIndex:2}}),A1=Bt(function(e,i){const{placement:a="left",...l}=e,d=vDe(),p=d.field,v={[a==="left"?"insetStart":"insetEnd"]:"0",width:(p==null?void 0:p.height)??(p==null?void 0:p.h),height:(p==null?void 0:p.height)??(p==null?void 0:p.h),fontSize:p==null?void 0:p.fontSize,...d.element};return C.jsx(SDe,{ref:i,__css:v,...l})});A1.id="InputElement";A1.displayName="InputElement";const nR=Bt(function(e,i){const{className:a,...l}=e,d=un("chakra-input__left-element",a);return C.jsx(A1,{ref:i,placement:"left",className:d,...l})});nR.id="InputLeftElement";nR.displayName="InputLeftElement";const Xte=Bt(function(e,i){const{className:a,...l}=e,d=un("chakra-input__right-element",a);return C.jsx(A1,{ref:i,placement:"right",className:d,...l})});Xte.id="InputRightElement";Xte.displayName="InputRightElement";const Iu=Bt(function(e,i){const a=Ul("Link",e),{className:l,isExternal:d,...p}=Fi(e);return C.jsx(Nt.a,{target:d?"_blank":void 0,rel:d?"noopener":void 0,ref:i,className:un("chakra-link",l),...p,__css:a})});Iu.displayName="Link";function bDe(n,e={}){const{ssr:i=!0,fallback:a}=e,{getWindow:l}=eIe(),d=Array.isArray(n)?n:[n];let p=Array.isArray(a)?a:[a];p=p.filter(b=>b!=null);const[y,v]=D.useState(()=>d.map((b,w)=>({media:b,matches:i?!!p[w]:l().matchMedia(b).matches})));return D.useEffect(()=>{const b=l();v(d.map(N=>({media:N,matches:b.matchMedia(N).matches})));const w=d.map(N=>b.matchMedia(N)),A=N=>{v(V=>V.slice().map(j=>j.media===N.media?{...j,matches:N.matches}:j))};return w.forEach(N=>{typeof N.addListener=="function"?N.addListener(A):N.addEventListener("change",A)}),()=>{w.forEach(N=>{typeof N.removeListener=="function"?N.removeListener(A):N.removeEventListener("change",A)})}},[l]),y.map(b=>b.matches)}function TDe(n,e,i,a){if(e==null)return a;if(!a)return n.find(p=>i(p).toLowerCase().startsWith(e.toLowerCase()));const l=n.filter(d=>i(d).toLowerCase().startsWith(e.toLowerCase()));if(l.length>0){let d;return l.includes(a)?(d=l.indexOf(a)+1,d===l.length&&(d=0),l[d]):(d=n.indexOf(l[0]),n[d])}return a}function wDe(n){const{key:e}=n;return e.length===1||e.length>1&&/[^a-zA-Z0-9]/.test(e)}function RDe(n={}){const{timeout:e=300,preventDefault:i=()=>!0}=n,[a,l]=D.useState([]),d=D.useRef(void 0),p=()=>{d.current&&(clearTimeout(d.current),d.current=null)},y=()=>{p(),d.current=setTimeout(()=>{l([]),d.current=null},e)};D.useEffect(()=>p,[]);function v(b){return w=>{if(w.key==="Backspace"){const A=[...a];A.pop(),l(A);return}if(wDe(w)){const A=a.concat(w.key);i(w)&&(w.preventDefault(),w.stopPropagation()),l(A),b(A.join("")),y()}}}return v}var Qc="top",Nu="bottom",Du="right",Zc="left",vj="auto",eC=[Qc,Nu,Du,Zc],d0="start",AR="end",CDe="clippingParents",Jte="viewport",dw="popper",IDe="reference",wY=eC.reduce(function(n,e){return n.concat([e+"-"+d0,e+"-"+AR])},[]),Qte=[].concat(eC,[vj]).reduce(function(n,e){return n.concat([e,e+"-"+d0,e+"-"+AR])},[]),ADe="beforeRead",PDe="read",ODe="afterRead",kDe="beforeMain",NDe="main",DDe="afterMain",LDe="beforeWrite",xDe="write",MDe="afterWrite",UDe=[ADe,PDe,ODe,kDe,NDe,DDe,LDe,xDe,MDe];function sf(n){return n?(n.nodeName||"").toLowerCase():null}function Ml(n){if(n==null)return window;if(n.toString()!=="[object Window]"){var e=n.ownerDocument;return e&&e.defaultView||window}return n}function Dy(n){var e=Ml(n).Element;return n instanceof e||n instanceof Element}function Pu(n){var e=Ml(n).HTMLElement;return n instanceof e||n instanceof HTMLElement}function Sj(n){if(typeof ShadowRoot>"u")return!1;var e=Ml(n).ShadowRoot;return n instanceof e||n instanceof ShadowRoot}function VDe(n){var e=n.state;Object.keys(e.elements).forEach(function(i){var a=e.styles[i]||{},l=e.attributes[i]||{},d=e.elements[i];!Pu(d)||!sf(d)||(Object.assign(d.style,a),Object.keys(l).forEach(function(p){var y=l[p];y===!1?d.removeAttribute(p):d.setAttribute(p,y===!0?"":y)}))})}function FDe(n){var e=n.state,i={popper:{position:e.options.strategy,left:"0",top:"0",margin:"0"},arrow:{position:"absolute"},reference:{}};return Object.assign(e.elements.popper.style,i.popper),e.styles=i,e.elements.arrow&&Object.assign(e.elements.arrow.style,i.arrow),function(){Object.keys(e.elements).forEach(function(a){var l=e.elements[a],d=e.attributes[a]||{},p=Object.keys(e.styles.hasOwnProperty(a)?e.styles[a]:i[a]),y=p.reduce(function(v,b){return v[b]="",v},{});!Pu(l)||!sf(l)||(Object.assign(l.style,y),Object.keys(d).forEach(function(v){l.removeAttribute(v)}))})}}const jDe={name:"applyStyles",enabled:!0,phase:"write",fn:VDe,effect:FDe,requires:["computeStyles"]};function Jh(n){return n.split("-")[0]}var Iy=Math.max,Dk=Math.min,h0=Math.round;function sV(){var n=navigator.userAgentData;return n!=null&&n.brands&&Array.isArray(n.brands)?n.brands.map(function(e){return e.brand+"/"+e.version}).join(" "):navigator.userAgent}function Zte(){return!/^((?!chrome|android).)*safari/i.test(sV())}function f0(n,e,i){e===void 0&&(e=!1),i===void 0&&(i=!1);var a=n.getBoundingClientRect(),l=1,d=1;e&&Pu(n)&&(l=n.offsetWidth>0&&h0(a.width)/n.offsetWidth||1,d=n.offsetHeight>0&&h0(a.height)/n.offsetHeight||1);var p=Dy(n)?Ml(n):window,y=p.visualViewport,v=!Zte()&&i,b=(a.left+(v&&y?y.offsetLeft:0))/l,w=(a.top+(v&&y?y.offsetTop:0))/d,A=a.width/l,N=a.height/d;return{width:A,height:N,top:w,right:b+A,bottom:w+N,left:b,x:b,y:w}}function bj(n){var e=f0(n),i=n.offsetWidth,a=n.offsetHeight;return Math.abs(e.width-i)<=1&&(i=e.width),Math.abs(e.height-a)<=1&&(a=e.height),{x:n.offsetLeft,y:n.offsetTop,width:i,height:a}}function ene(n,e){var i=e.getRootNode&&e.getRootNode();if(n.contains(e))return!0;if(i&&Sj(i)){var a=e;do{if(a&&n.isSameNode(a))return!0;a=a.parentNode||a.host}while(a)}return!1}function kp(n){return Ml(n).getComputedStyle(n)}function BDe(n){return["table","td","th"].indexOf(sf(n))>=0}function Dg(n){return((Dy(n)?n.ownerDocument:n.document)||window.document).documentElement}function P1(n){return sf(n)==="html"?n:n.assignedSlot||n.parentNode||(Sj(n)?n.host:null)||Dg(n)}function RY(n){return!Pu(n)||kp(n).position==="fixed"?null:n.offsetParent}function WDe(n){var e=/firefox/i.test(sV()),i=/Trident/i.test(sV());if(i&&Pu(n)){var a=kp(n);if(a.position==="fixed")return null}var l=P1(n);for(Sj(l)&&(l=l.host);Pu(l)&&["html","body"].indexOf(sf(l))<0;){var d=kp(l);if(d.transform!=="none"||d.perspective!=="none"||d.contain==="paint"||["transform","perspective"].indexOf(d.willChange)!==-1||e&&d.willChange==="filter"||e&&d.filter&&d.filter!=="none")return l;l=l.parentNode}return null}function tC(n){for(var e=Ml(n),i=RY(n);i&&BDe(i)&&kp(i).position==="static";)i=RY(i);return i&&(sf(i)==="html"||sf(i)==="body"&&kp(i).position==="static")?e:i||WDe(n)||e}function Tj(n){return["top","bottom"].indexOf(n)>=0?"x":"y"}function rR(n,e,i){return Iy(n,Dk(e,i))}function zDe(n,e,i){var a=rR(n,e,i);return a>i?i:a}function tne(){return{top:0,right:0,bottom:0,left:0}}function nne(n){return Object.assign({},tne(),n)}function rne(n,e){return e.reduce(function(i,a){return i[a]=n,i},{})}var GDe=function(e,i){return e=typeof e=="function"?e(Object.assign({},i.rects,{placement:i.placement})):e,nne(typeof e!="number"?e:rne(e,eC))};function HDe(n){var e,i=n.state,a=n.name,l=n.options,d=i.elements.arrow,p=i.modifiersData.popperOffsets,y=Jh(i.placement),v=Tj(y),b=[Zc,Du].indexOf(y)>=0,w=b?"height":"width";if(!(!d||!p)){var A=GDe(l.padding,i),N=bj(d),V=v==="y"?Qc:Zc,j=v==="y"?Nu:Du,B=i.rects.reference[w]+i.rects.reference[v]-p[v]-i.rects.popper[w],G=p[v]-i.rects.reference[v],ee=tC(d),K=ee?v==="y"?ee.clientHeight||0:ee.clientWidth||0:0,ne=B/2-G/2,ce=A[V],oe=K-N[w]-A[j],ge=K/2-N[w]/2+ne,te=rR(ce,ge,oe),Z=v;i.modifiersData[a]=(e={},e[Z]=te,e.centerOffset=te-ge,e)}}function $De(n){var e=n.state,i=n.options,a=i.element,l=a===void 0?"[data-popper-arrow]":a;l!=null&&(typeof l=="string"&&(l=e.elements.popper.querySelector(l),!l)||ene(e.elements.popper,l)&&(e.elements.arrow=l))}const KDe={name:"arrow",enabled:!0,phase:"main",fn:HDe,effect:$De,requires:["popperOffsets"],requiresIfExists:["preventOverflow"]};function p0(n){return n.split("-")[1]}var qDe={top:"auto",right:"auto",bottom:"auto",left:"auto"};function YDe(n,e){var i=n.x,a=n.y,l=e.devicePixelRatio||1;return{x:h0(i*l)/l||0,y:h0(a*l)/l||0}}function CY(n){var e,i=n.popper,a=n.popperRect,l=n.placement,d=n.variation,p=n.offsets,y=n.position,v=n.gpuAcceleration,b=n.adaptive,w=n.roundOffsets,A=n.isFixed,N=p.x,V=N===void 0?0:N,j=p.y,B=j===void 0?0:j,G=typeof w=="function"?w({x:V,y:B}):{x:V,y:B};V=G.x,B=G.y;var ee=p.hasOwnProperty("x"),K=p.hasOwnProperty("y"),ne=Zc,ce=Qc,oe=window;if(b){var ge=tC(i),te="clientHeight",Z="clientWidth";if(ge===Ml(i)&&(ge=Dg(i),kp(ge).position!=="static"&&y==="absolute"&&(te="scrollHeight",Z="scrollWidth")),ge=ge,l===Qc||(l===Zc||l===Du)&&d===AR){ce=Nu;var J=A&&ge===oe&&oe.visualViewport?oe.visualViewport.height:ge[te];B-=J-a.height,B*=v?1:-1}if(l===Zc||(l===Qc||l===Nu)&&d===AR){ne=Du;var se=A&&ge===oe&&oe.visualViewport?oe.visualViewport.width:ge[Z];V-=se-a.width,V*=v?1:-1}}var he=Object.assign({position:y},b&&qDe),fe=w===!0?YDe({x:V,y:B},Ml(i)):{x:V,y:B};if(V=fe.x,B=fe.y,v){var ue;return Object.assign({},he,(ue={},ue[ce]=K?"0":"",ue[ne]=ee?"0":"",ue.transform=(oe.devicePixelRatio||1)<=1?"translate("+V+"px, "+B+"px)":"translate3d("+V+"px, "+B+"px, 0)",ue))}return Object.assign({},he,(e={},e[ce]=K?B+"px":"",e[ne]=ee?V+"px":"",e.transform="",e))}function XDe(n){var e=n.state,i=n.options,a=i.gpuAcceleration,l=a===void 0?!0:a,d=i.adaptive,p=d===void 0?!0:d,y=i.roundOffsets,v=y===void 0?!0:y,b={placement:Jh(e.placement),variation:p0(e.placement),popper:e.elements.popper,popperRect:e.rects.popper,gpuAcceleration:l,isFixed:e.options.strategy==="fixed"};e.modifiersData.popperOffsets!=null&&(e.styles.popper=Object.assign({},e.styles.popper,CY(Object.assign({},b,{offsets:e.modifiersData.popperOffsets,position:e.options.strategy,adaptive:p,roundOffsets:v})))),e.modifiersData.arrow!=null&&(e.styles.arrow=Object.assign({},e.styles.arrow,CY(Object.assign({},b,{offsets:e.modifiersData.arrow,position:"absolute",adaptive:!1,roundOffsets:v})))),e.attributes.popper=Object.assign({},e.attributes.popper,{"data-popper-placement":e.placement})}const JDe={name:"computeStyles",enabled:!0,phase:"beforeWrite",fn:XDe,data:{}};var vO={passive:!0};function QDe(n){var e=n.state,i=n.instance,a=n.options,l=a.scroll,d=l===void 0?!0:l,p=a.resize,y=p===void 0?!0:p,v=Ml(e.elements.popper),b=[].concat(e.scrollParents.reference,e.scrollParents.popper);return d&&b.forEach(function(w){w.addEventListener("scroll",i.update,vO)}),y&&v.addEventListener("resize",i.update,vO),function(){d&&b.forEach(function(w){w.removeEventListener("scroll",i.update,vO)}),y&&v.removeEventListener("resize",i.update,vO)}}const ZDe={name:"eventListeners",enabled:!0,phase:"write",fn:function(){},effect:QDe,data:{}};var eLe={left:"right",right:"left",bottom:"top",top:"bottom"};function nk(n){return n.replace(/left|right|bottom|top/g,function(e){return eLe[e]})}var tLe={start:"end",end:"start"};function IY(n){return n.replace(/start|end/g,function(e){return tLe[e]})}function wj(n){var e=Ml(n),i=e.pageXOffset,a=e.pageYOffset;return{scrollLeft:i,scrollTop:a}}function Rj(n){return f0(Dg(n)).left+wj(n).scrollLeft}function nLe(n,e){var i=Ml(n),a=Dg(n),l=i.visualViewport,d=a.clientWidth,p=a.clientHeight,y=0,v=0;if(l){d=l.width,p=l.height;var b=Zte();(b||!b&&e==="fixed")&&(y=l.offsetLeft,v=l.offsetTop)}return{width:d,height:p,x:y+Rj(n),y:v}}function rLe(n){var e,i=Dg(n),a=wj(n),l=(e=n.ownerDocument)==null?void 0:e.body,d=Iy(i.scrollWidth,i.clientWidth,l?l.scrollWidth:0,l?l.clientWidth:0),p=Iy(i.scrollHeight,i.clientHeight,l?l.scrollHeight:0,l?l.clientHeight:0),y=-a.scrollLeft+Rj(n),v=-a.scrollTop;return kp(l||i).direction==="rtl"&&(y+=Iy(i.clientWidth,l?l.clientWidth:0)-d),{width:d,height:p,x:y,y:v}}function Cj(n){var e=kp(n),i=e.overflow,a=e.overflowX,l=e.overflowY;return/auto|scroll|overlay|hidden/.test(i+l+a)}function ine(n){return["html","body","#document"].indexOf(sf(n))>=0?n.ownerDocument.body:Pu(n)&&Cj(n)?n:ine(P1(n))}function iR(n,e){var i;e===void 0&&(e=[]);var a=ine(n),l=a===((i=n.ownerDocument)==null?void 0:i.body),d=Ml(a),p=l?[d].concat(d.visualViewport||[],Cj(a)?a:[]):a,y=e.concat(p);return l?y:y.concat(iR(P1(p)))}function oV(n){return Object.assign({},n,{left:n.x,top:n.y,right:n.x+n.width,bottom:n.y+n.height})}function iLe(n,e){var i=f0(n,!1,e==="fixed");return i.top=i.top+n.clientTop,i.left=i.left+n.clientLeft,i.bottom=i.top+n.clientHeight,i.right=i.left+n.clientWidth,i.width=n.clientWidth,i.height=n.clientHeight,i.x=i.left,i.y=i.top,i}function AY(n,e,i){return e===Jte?oV(nLe(n,i)):Dy(e)?iLe(e,i):oV(rLe(Dg(n)))}function sLe(n){var e=iR(P1(n)),i=["absolute","fixed"].indexOf(kp(n).position)>=0,a=i&&Pu(n)?tC(n):n;return Dy(a)?e.filter(function(l){return Dy(l)&&ene(l,a)&&sf(l)!=="body"}):[]}function oLe(n,e,i,a){var l=e==="clippingParents"?sLe(n):[].concat(e),d=[].concat(l,[i]),p=d[0],y=d.reduce(function(v,b){var w=AY(n,b,a);return v.top=Iy(w.top,v.top),v.right=Dk(w.right,v.right),v.bottom=Dk(w.bottom,v.bottom),v.left=Iy(w.left,v.left),v},AY(n,p,a));return y.width=y.right-y.left,y.height=y.bottom-y.top,y.x=y.left,y.y=y.top,y}function sne(n){var e=n.reference,i=n.element,a=n.placement,l=a?Jh(a):null,d=a?p0(a):null,p=e.x+e.width/2-i.width/2,y=e.y+e.height/2-i.height/2,v;switch(l){case Qc:v={x:p,y:e.y-i.height};break;case Nu:v={x:p,y:e.y+e.height};break;case Du:v={x:e.x+e.width,y};break;case Zc:v={x:e.x-i.width,y};break;default:v={x:e.x,y:e.y}}var b=l?Tj(l):null;if(b!=null){var w=b==="y"?"height":"width";switch(d){case d0:v[b]=v[b]-(e[w]/2-i[w]/2);break;case AR:v[b]=v[b]+(e[w]/2-i[w]/2);break}}return v}function PR(n,e){e===void 0&&(e={});var i=e,a=i.placement,l=a===void 0?n.placement:a,d=i.strategy,p=d===void 0?n.strategy:d,y=i.boundary,v=y===void 0?CDe:y,b=i.rootBoundary,w=b===void 0?Jte:b,A=i.elementContext,N=A===void 0?dw:A,V=i.altBoundary,j=V===void 0?!1:V,B=i.padding,G=B===void 0?0:B,ee=nne(typeof G!="number"?G:rne(G,eC)),K=N===dw?IDe:dw,ne=n.rects.popper,ce=n.elements[j?K:N],oe=oLe(Dy(ce)?ce:ce.contextElement||Dg(n.elements.popper),v,w,p),ge=f0(n.elements.reference),te=sne({reference:ge,element:ne,placement:l}),Z=oV(Object.assign({},ne,te)),J=N===dw?Z:ge,se={top:oe.top-J.top+ee.top,bottom:J.bottom-oe.bottom+ee.bottom,left:oe.left-J.left+ee.left,right:J.right-oe.right+ee.right},he=n.modifiersData.offset;if(N===dw&&he){var fe=he[l];Object.keys(se).forEach(function(ue){var Me=[Du,Nu].indexOf(ue)>=0?1:-1,He=[Qc,Nu].indexOf(ue)>=0?"y":"x";se[ue]+=fe[He]*Me})}return se}function aLe(n,e){e===void 0&&(e={});var i=e,a=i.placement,l=i.boundary,d=i.rootBoundary,p=i.padding,y=i.flipVariations,v=i.allowedAutoPlacements,b=v===void 0?Qte:v,w=p0(a),A=w?y?wY:wY.filter(function(j){return p0(j)===w}):eC,N=A.filter(function(j){return b.indexOf(j)>=0});N.length===0&&(N=A);var V=N.reduce(function(j,B){return j[B]=PR(n,{placement:B,boundary:l,rootBoundary:d,padding:p})[Jh(B)],j},{});return Object.keys(V).sort(function(j,B){return V[j]-V[B]})}function cLe(n){if(Jh(n)===vj)return[];var e=nk(n);return[IY(n),e,IY(e)]}function lLe(n){var e=n.state,i=n.options,a=n.name;if(!e.modifiersData[a]._skip){for(var l=i.mainAxis,d=l===void 0?!0:l,p=i.altAxis,y=p===void 0?!0:p,v=i.fallbackPlacements,b=i.padding,w=i.boundary,A=i.rootBoundary,N=i.altBoundary,V=i.flipVariations,j=V===void 0?!0:V,B=i.allowedAutoPlacements,G=e.options.placement,ee=Jh(G),K=ee===G,ne=v||(K||!j?[nk(G)]:cLe(G)),ce=[G].concat(ne).reduce(function(Ue,ze){return Ue.concat(Jh(ze)===vj?aLe(e,{placement:ze,boundary:w,rootBoundary:A,padding:b,flipVariations:j,allowedAutoPlacements:B}):ze)},[]),oe=e.rects.reference,ge=e.rects.popper,te=new Map,Z=!0,J=ce[0],se=0;se<ce.length;se++){var he=ce[se],fe=Jh(he),ue=p0(he)===d0,Me=[Qc,Nu].indexOf(fe)>=0,He=Me?"width":"height",rt=PR(e,{placement:he,boundary:w,rootBoundary:A,altBoundary:N,padding:b}),we=Me?ue?Du:Zc:ue?Nu:Qc;oe[He]>ge[He]&&(we=nk(we));var Ce=nk(we),ve=[];if(d&&ve.push(rt[fe]<=0),y&&ve.push(rt[we]<=0,rt[Ce]<=0),ve.every(function(Ue){return Ue})){J=he,Z=!1;break}te.set(he,ve)}if(Z)for(var Ne=j?3:1,Te=function(ze){var et=ce.find(function(nt){var dt=te.get(nt);if(dt)return dt.slice(0,ze).every(function(Xe){return Xe})});if(et)return J=et,"break"},be=Ne;be>0;be--){var Ae=Te(be);if(Ae==="break")break}e.placement!==J&&(e.modifiersData[a]._skip=!0,e.placement=J,e.reset=!0)}}const uLe={name:"flip",enabled:!0,phase:"main",fn:lLe,requiresIfExists:["offset"],data:{_skip:!1}};function PY(n,e,i){return i===void 0&&(i={x:0,y:0}),{top:n.top-e.height-i.y,right:n.right-e.width+i.x,bottom:n.bottom-e.height+i.y,left:n.left-e.width-i.x}}function OY(n){return[Qc,Du,Nu,Zc].some(function(e){return n[e]>=0})}function dLe(n){var e=n.state,i=n.name,a=e.rects.reference,l=e.rects.popper,d=e.modifiersData.preventOverflow,p=PR(e,{elementContext:"reference"}),y=PR(e,{altBoundary:!0}),v=PY(p,a),b=PY(y,l,d),w=OY(v),A=OY(b);e.modifiersData[i]={referenceClippingOffsets:v,popperEscapeOffsets:b,isReferenceHidden:w,hasPopperEscaped:A},e.attributes.popper=Object.assign({},e.attributes.popper,{"data-popper-reference-hidden":w,"data-popper-escaped":A})}const hLe={name:"hide",enabled:!0,phase:"main",requiresIfExists:["preventOverflow"],fn:dLe};function fLe(n,e,i){var a=Jh(n),l=[Zc,Qc].indexOf(a)>=0?-1:1,d=typeof i=="function"?i(Object.assign({},e,{placement:n})):i,p=d[0],y=d[1];return p=p||0,y=(y||0)*l,[Zc,Du].indexOf(a)>=0?{x:y,y:p}:{x:p,y}}function pLe(n){var e=n.state,i=n.options,a=n.name,l=i.offset,d=l===void 0?[0,0]:l,p=Qte.reduce(function(w,A){return w[A]=fLe(A,e.rects,d),w},{}),y=p[e.placement],v=y.x,b=y.y;e.modifiersData.popperOffsets!=null&&(e.modifiersData.popperOffsets.x+=v,e.modifiersData.popperOffsets.y+=b),e.modifiersData[a]=p}const mLe={name:"offset",enabled:!0,phase:"main",requires:["popperOffsets"],fn:pLe};function gLe(n){var e=n.state,i=n.name;e.modifiersData[i]=sne({reference:e.rects.reference,element:e.rects.popper,placement:e.placement})}const _Le={name:"popperOffsets",enabled:!0,phase:"read",fn:gLe,data:{}};function yLe(n){return n==="x"?"y":"x"}function ELe(n){var e=n.state,i=n.options,a=n.name,l=i.mainAxis,d=l===void 0?!0:l,p=i.altAxis,y=p===void 0?!1:p,v=i.boundary,b=i.rootBoundary,w=i.altBoundary,A=i.padding,N=i.tether,V=N===void 0?!0:N,j=i.tetherOffset,B=j===void 0?0:j,G=PR(e,{boundary:v,rootBoundary:b,padding:A,altBoundary:w}),ee=Jh(e.placement),K=p0(e.placement),ne=!K,ce=Tj(ee),oe=yLe(ce),ge=e.modifiersData.popperOffsets,te=e.rects.reference,Z=e.rects.popper,J=typeof B=="function"?B(Object.assign({},e.rects,{placement:e.placement})):B,se=typeof J=="number"?{mainAxis:J,altAxis:J}:Object.assign({mainAxis:0,altAxis:0},J),he=e.modifiersData.offset?e.modifiersData.offset[e.placement]:null,fe={x:0,y:0};if(ge){if(d){var ue,Me=ce==="y"?Qc:Zc,He=ce==="y"?Nu:Du,rt=ce==="y"?"height":"width",we=ge[ce],Ce=we+G[Me],ve=we-G[He],Ne=V?-Z[rt]/2:0,Te=K===d0?te[rt]:Z[rt],be=K===d0?-Z[rt]:-te[rt],Ae=e.elements.arrow,Ue=V&&Ae?bj(Ae):{width:0,height:0},ze=e.modifiersData["arrow#persistent"]?e.modifiersData["arrow#persistent"].padding:tne(),et=ze[Me],nt=ze[He],dt=rR(0,te[rt],Ue[rt]),Xe=ne?te[rt]/2-Ne-dt-et-se.mainAxis:Te-dt-et-se.mainAxis,It=ne?-te[rt]/2+Ne+dt+nt+se.mainAxis:be+dt+nt+se.mainAxis,hn=e.elements.arrow&&tC(e.elements.arrow),Ut=hn?ce==="y"?hn.clientTop||0:hn.clientLeft||0:0,ln=(ue=he==null?void 0:he[ce])!=null?ue:0,xn=we+Xe-ln-Ut,Xt=we+It-ln,Yn=rR(V?Dk(Ce,xn):Ce,we,V?Iy(ve,Xt):ve);ge[ce]=Yn,fe[ce]=Yn-we}if(y){var qt,Re=ce==="x"?Qc:Zc,Fe=ce==="x"?Nu:Du,Ke=ge[oe],Et=oe==="y"?"height":"width",bt=Ke+G[Re],Ge=Ke-G[Fe],Ot=[Qc,Zc].indexOf(ee)!==-1,Jt=(qt=he==null?void 0:he[oe])!=null?qt:0,fn=Ot?bt:Ke-te[Et]-Z[Et]-Jt+se.altAxis,an=Ot?Ke+te[Et]+Z[Et]-Jt-se.altAxis:Ge,ir=V&&Ot?zDe(fn,Ke,an):rR(V?fn:bt,Ke,V?an:Ge);ge[oe]=ir,fe[oe]=ir-Ke}e.modifiersData[a]=fe}}const vLe={name:"preventOverflow",enabled:!0,phase:"main",fn:ELe,requiresIfExists:["offset"]};function SLe(n){return{scrollLeft:n.scrollLeft,scrollTop:n.scrollTop}}function bLe(n){return n===Ml(n)||!Pu(n)?wj(n):SLe(n)}function TLe(n){var e=n.getBoundingClientRect(),i=h0(e.width)/n.offsetWidth||1,a=h0(e.height)/n.offsetHeight||1;return i!==1||a!==1}function wLe(n,e,i){i===void 0&&(i=!1);var a=Pu(e),l=Pu(e)&&TLe(e),d=Dg(e),p=f0(n,l,i),y={scrollLeft:0,scrollTop:0},v={x:0,y:0};return(a||!a&&!i)&&((sf(e)!=="body"||Cj(d))&&(y=bLe(e)),Pu(e)?(v=f0(e,!0),v.x+=e.clientLeft,v.y+=e.clientTop):d&&(v.x=Rj(d))),{x:p.left+y.scrollLeft-v.x,y:p.top+y.scrollTop-v.y,width:p.width,height:p.height}}function RLe(n){var e=new Map,i=new Set,a=[];n.forEach(function(d){e.set(d.name,d)});function l(d){i.add(d.name);var p=[].concat(d.requires||[],d.requiresIfExists||[]);p.forEach(function(y){if(!i.has(y)){var v=e.get(y);v&&l(v)}}),a.push(d)}return n.forEach(function(d){i.has(d.name)||l(d)}),a}function CLe(n){var e=RLe(n);return UDe.reduce(function(i,a){return i.concat(e.filter(function(l){return l.phase===a}))},[])}function ILe(n){var e;return function(){return e||(e=new Promise(function(i){Promise.resolve().then(function(){e=void 0,i(n())})})),e}}function ALe(n){var e=n.reduce(function(i,a){var l=i[a.name];return i[a.name]=l?Object.assign({},l,a,{options:Object.assign({},l.options,a.options),data:Object.assign({},l.data,a.data)}):a,i},{});return Object.keys(e).map(function(i){return e[i]})}var kY={placement:"bottom",modifiers:[],strategy:"absolute"};function NY(){for(var n=arguments.length,e=new Array(n),i=0;i<n;i++)e[i]=arguments[i];return!e.some(function(a){return!(a&&typeof a.getBoundingClientRect=="function")})}function PLe(n){n===void 0&&(n={});var e=n,i=e.defaultModifiers,a=i===void 0?[]:i,l=e.defaultOptions,d=l===void 0?kY:l;return function(y,v,b){b===void 0&&(b=d);var w={placement:"bottom",orderedModifiers:[],options:Object.assign({},kY,d),modifiersData:{},elements:{reference:y,popper:v},attributes:{},styles:{}},A=[],N=!1,V={state:w,setOptions:function(ee){var K=typeof ee=="function"?ee(w.options):ee;B(),w.options=Object.assign({},d,w.options,K),w.scrollParents={reference:Dy(y)?iR(y):y.contextElement?iR(y.contextElement):[],popper:iR(v)};var ne=CLe(ALe([].concat(a,w.options.modifiers)));return w.orderedModifiers=ne.filter(function(ce){return ce.enabled}),j(),V.update()},forceUpdate:function(){if(!N){var ee=w.elements,K=ee.reference,ne=ee.popper;if(NY(K,ne)){w.rects={reference:wLe(K,tC(ne),w.options.strategy==="fixed"),popper:bj(ne)},w.reset=!1,w.placement=w.options.placement,w.orderedModifiers.forEach(function(se){return w.modifiersData[se.name]=Object.assign({},se.data)});for(var ce=0;ce<w.orderedModifiers.length;ce++){if(w.reset===!0){w.reset=!1,ce=-1;continue}var oe=w.orderedModifiers[ce],ge=oe.fn,te=oe.options,Z=te===void 0?{}:te,J=oe.name;typeof ge=="function"&&(w=ge({state:w,options:Z,name:J,instance:V})||w)}}}},update:ILe(function(){return new Promise(function(G){V.forceUpdate(),G(w)})}),destroy:function(){B(),N=!0}};if(!NY(y,v))return V;V.setOptions(b).then(function(G){!N&&b.onFirstUpdate&&b.onFirstUpdate(G)});function j(){w.orderedModifiers.forEach(function(G){var ee=G.name,K=G.options,ne=K===void 0?{}:K,ce=G.effect;if(typeof ce=="function"){var oe=ce({state:w,name:ee,instance:V,options:ne}),ge=function(){};A.push(oe||ge)}})}function B(){A.forEach(function(G){return G()}),A=[]}return V}}var OLe=[ZDe,_Le,JDe,jDe,mLe,uLe,vLe,KDe,hLe],kLe=PLe({defaultModifiers:OLe});const mS=(n,e)=>({var:n,varRef:e?`var(${n}, ${e})`:`var(${n})`}),qs={arrowShadowColor:mS("--popper-arrow-shadow-color"),arrowSize:mS("--popper-arrow-size","8px"),arrowSizeHalf:mS("--popper-arrow-size-half"),arrowBg:mS("--popper-arrow-bg"),transformOrigin:mS("--popper-transform-origin"),arrowOffset:mS("--popper-arrow-offset")};function NLe(n){if(n.includes("top"))return"1px 1px 0px 0 var(--popper-arrow-shadow-color)";if(n.includes("bottom"))return"-1px -1px 0px 0 var(--popper-arrow-shadow-color)";if(n.includes("right"))return"-1px 1px 0px 0 var(--popper-arrow-shadow-color)";if(n.includes("left"))return"1px -1px 0px 0 var(--popper-arrow-shadow-color)"}const DLe={top:"bottom center","top-start":"bottom left","top-end":"bottom right",bottom:"top center","bottom-start":"top left","bottom-end":"top right",left:"right center","left-start":"right top","left-end":"right bottom",right:"left center","right-start":"left top","right-end":"left bottom"},LLe=n=>DLe[n],DY={scroll:!0,resize:!0};function xLe(n){let e;return typeof n=="object"?e={enabled:!0,options:{...DY,...n}}:e={enabled:n,options:DY},e}const MLe={name:"matchWidth",enabled:!0,phase:"beforeWrite",requires:["computeStyles"],fn:({state:n})=>{n.styles.popper.width=`${n.rects.reference.width}px`},effect:({state:n})=>()=>{const e=n.elements.reference;n.elements.popper.style.width=`${e.offsetWidth}px`}},ULe={name:"transformOrigin",enabled:!0,phase:"write",fn:({state:n})=>{LY(n)},effect:({state:n})=>()=>{LY(n)}},LY=n=>{n.elements.popper.style.setProperty(qs.transformOrigin.var,LLe(n.placement))},VLe={name:"positionArrow",enabled:!0,phase:"afterWrite",fn:({state:n})=>{FLe(n)}},FLe=n=>{var i;if(!n.placement)return;const e=jLe(n.placement);if((i=n.elements)!=null&&i.arrow&&e){Object.assign(n.elements.arrow.style,{[e.property]:e.value,width:qs.arrowSize.varRef,height:qs.arrowSize.varRef,zIndex:-1});const a={[qs.arrowSizeHalf.var]:`calc(${qs.arrowSize.varRef} / 2 - 1px)`,[qs.arrowOffset.var]:`calc(${qs.arrowSizeHalf.varRef} * -1)`};for(const l in a)n.elements.arrow.style.setProperty(l,a[l])}},jLe=n=>{if(n.startsWith("top"))return{property:"bottom",value:qs.arrowOffset.varRef};if(n.startsWith("bottom"))return{property:"top",value:qs.arrowOffset.varRef};if(n.startsWith("left"))return{property:"right",value:qs.arrowOffset.varRef};if(n.startsWith("right"))return{property:"left",value:qs.arrowOffset.varRef}},BLe={name:"innerArrow",enabled:!0,phase:"main",requires:["arrow"],fn:({state:n})=>{xY(n)},effect:({state:n})=>()=>{xY(n)}},xY=n=>{if(!n.elements.arrow)return;const e=n.elements.arrow.querySelector("[data-popper-arrow-inner]");if(!e)return;const i=NLe(n.placement);i&&e.style.setProperty("--popper-arrow-default-shadow",i),Object.assign(e.style,{transform:"rotate(45deg)",background:qs.arrowBg.varRef,top:0,left:0,width:"100%",height:"100%",position:"absolute",zIndex:"inherit",boxShadow:"var(--popper-arrow-shadow, var(--popper-arrow-default-shadow))"})},WLe={"start-start":{ltr:"left-start",rtl:"right-start"},"start-end":{ltr:"left-end",rtl:"right-end"},"end-start":{ltr:"right-start",rtl:"left-start"},"end-end":{ltr:"right-end",rtl:"left-end"},start:{ltr:"left",rtl:"right"},end:{ltr:"right",rtl:"left"}},zLe={"auto-start":"auto-end","auto-end":"auto-start","top-start":"top-end","top-end":"top-start","bottom-start":"bottom-end","bottom-end":"bottom-start"};function GLe(n,e="ltr"){var a;const i=((a=WLe[n])==null?void 0:a[e])||n;return e==="ltr"?i:zLe[n]??i}function Ij(n={}){const{enabled:e=!0,modifiers:i,placement:a="bottom",strategy:l="absolute",arrowPadding:d=8,eventListeners:p=!0,offset:y,gutter:v=8,flip:b=!0,boundary:w="clippingParents",preventOverflow:A=!0,matchWidth:N,direction:V="ltr"}=n,j=D.useRef(null),B=D.useRef(null),G=D.useRef(null),ee=GLe(a,V),K=D.useRef(()=>{}),ne=D.useCallback(()=>{var se;!e||!j.current||!B.current||((se=K.current)==null||se.call(K),G.current=kLe(j.current,B.current,{placement:ee,modifiers:[BLe,VLe,ULe,{...MLe,enabled:!!N},{name:"eventListeners",...xLe(p)},{name:"arrow",options:{padding:d}},{name:"offset",options:{offset:y??[0,v]}},{name:"flip",enabled:!!b,options:{padding:8}},{name:"preventOverflow",enabled:!!A,options:{boundary:w}},...i??[]],strategy:l}),G.current.forceUpdate(),K.current=G.current.destroy)},[ee,e,i,N,p,d,y,v,b,A,w,l]);D.useEffect(()=>()=>{var se;!j.current&&!B.current&&((se=G.current)==null||se.destroy(),G.current=null)},[]);const ce=D.useCallback(se=>{j.current=se,ne()},[ne]),oe=D.useCallback((se={},he=null)=>({...se,ref:rs(ce,he)}),[ce]),ge=D.useCallback(se=>{B.current=se,ne()},[ne]),te=D.useCallback((se={},he=null)=>({...se,ref:rs(ge,he),style:{...se.style,position:l,minWidth:N?void 0:"max-content",inset:"0 auto auto 0"}}),[l,ge,N]),Z=D.useCallback((se={},he=null)=>{const{size:fe,shadowColor:ue,bg:Me,style:He,...rt}=se;return{...rt,ref:he,"data-popper-arrow":"",style:HLe(se)}},[]),J=D.useCallback((se={},he=null)=>({...se,ref:he,"data-popper-arrow-inner":""}),[]);return{update(){var se;(se=G.current)==null||se.update()},forceUpdate(){var se;(se=G.current)==null||se.forceUpdate()},transformOrigin:qs.transformOrigin.varRef,referenceRef:ce,popperRef:ge,getPopperProps:te,getArrowProps:Z,getArrowInnerProps:J,getReferenceProps:oe}}function HLe(n){const{size:e,shadowColor:i,bg:a,style:l}=n,d={...l,position:"absolute"};return e&&(d["--popper-arrow-size"]=e),i&&(d["--popper-arrow-shadow-color"]=i),a&&(d["--popper-arrow-bg"]=a),d}function $Le(){const n=D.useRef(new Map),e=n.current,i=D.useCallback((l,d,p,y)=>{n.current.set(p,{type:d,el:l,options:y}),l.addEventListener(d,p,y)},[]),a=D.useCallback((l,d,p,y)=>{l.removeEventListener(d,p,y),n.current.delete(p)},[]);return D.useEffect(()=>()=>{e.forEach((l,d)=>{a(l.el,l.type,d,l.options)})},[a,e]),{add:i,remove:a}}function j2(n){var l,d;const e=((d=(l=n.composedPath)==null?void 0:l.call(n))==null?void 0:d[0])??n.target,{tagName:i,isContentEditable:a}=e;return i!=="INPUT"&&i!=="TEXTAREA"&&a!==!0}function one(n={}){const{ref:e,isDisabled:i,isFocusable:a,clickOnEnter:l=!0,clickOnSpace:d=!0,onMouseDown:p,onMouseUp:y,onClick:v,onKeyDown:b,onKeyUp:w,tabIndex:A,onMouseOver:N,onMouseLeave:V,...j}=n,[B,G]=D.useState(!0),[ee,K]=D.useState(!1),ne=$Le(),ce=we=>{we&&we.tagName!=="BUTTON"&&G(!1)},oe=B?A:A||0,ge=i&&!a,te=D.useCallback(we=>{if(i){we.stopPropagation(),we.preventDefault();return}we.currentTarget.focus(),v==null||v(we)},[i,v]),Z=D.useCallback(we=>{ee&&j2(we)&&(we.preventDefault(),we.stopPropagation(),K(!1),ne.remove(document,"keyup",Z,!1))},[ee,ne]),J=D.useCallback(we=>{if(b==null||b(we),i||we.defaultPrevented||we.metaKey||!j2(we.nativeEvent)||B)return;const Ce=l&&we.key==="Enter";d&&we.key===" "&&(we.preventDefault(),K(!0)),Ce&&(we.preventDefault(),we.currentTarget.click()),ne.add(document,"keyup",Z,!1)},[i,B,b,l,d,ne,Z]),se=D.useCallback(we=>{if(w==null||w(we),i||we.defaultPrevented||we.metaKey||!j2(we.nativeEvent)||B)return;d&&we.key===" "&&(we.preventDefault(),K(!1),we.currentTarget.click())},[d,B,i,w]),he=D.useCallback(we=>{we.button===0&&(K(!1),ne.remove(document,"mouseup",he,!1))},[ne]),fe=D.useCallback(we=>{if(we.button!==0)return;if(i){we.stopPropagation(),we.preventDefault();return}B||K(!0),we.currentTarget.focus({preventScroll:!0}),ne.add(document,"mouseup",he,!1),p==null||p(we)},[i,B,p,ne,he]),ue=D.useCallback(we=>{we.button===0&&(B||K(!1),y==null||y(we))},[y,B]),Me=D.useCallback(we=>{if(i){we.preventDefault();return}N==null||N(we)},[i,N]),He=D.useCallback(we=>{ee&&(we.preventDefault(),K(!1)),V==null||V(we)},[ee,V]),rt=rs(e,ce);return B?{...j,ref:rt,type:"button","aria-disabled":ge?void 0:i,disabled:ge,onClick:te,onMouseDown:p,onMouseUp:y,onKeyUp:w,onKeyDown:b,onMouseOver:N,onMouseLeave:V}:{...j,ref:rt,role:"button","data-active":Kn(ee),"aria-disabled":i?"true":void 0,tabIndex:ge?void 0:oe,onClick:te,onMouseDown:fe,onMouseUp:ue,onKeyUp:se,onKeyDown:J,onMouseOver:Me,onMouseLeave:He}}const[KLe,qLe,YLe,XLe]=ote(),[JLe,nC]=Ui({strict:!1,name:"MenuContext"});function ane(n){return(n==null?void 0:n.ownerDocument)??document}function QLe(n){return ane(n).activeElement===n}function ZLe(n={}){const{id:e,closeOnSelect:i=!0,closeOnBlur:a=!0,initialFocusRef:l,autoSelect:d=!0,isLazy:p,isOpen:y,defaultIsOpen:v,onClose:b,onOpen:w,placement:A="bottom-start",lazyBehavior:N="unmount",direction:V,computePositionOnMount:j=!1,...B}=n,G=D.useRef(null),ee=D.useRef(null),K=D.useRef(!0),ne=YLe(),ce=D.useCallback(()=>{requestAnimationFrame(()=>{var Ae;(Ae=G.current)==null||Ae.focus({preventScroll:!1})})},[]),oe=D.useCallback(()=>{const Ae=setTimeout(()=>{var Ue,ze;if(l)(Ue=l.current)==null||Ue.focus();else if(!ne.count())(ze=G.current)==null||ze.focus({preventScroll:!1});else{const et=ne.firstEnabled();et&&Me(et.index)}});ve.current.add(Ae)},[ne,l]),ge=D.useCallback(()=>{const Ae=setTimeout(()=>{var Ue;if(!ne.count())(Ue=G.current)==null||Ue.focus({preventScroll:!1});else{const ze=ne.lastEnabled();ze&&Me(ze.index)}});ve.current.add(Ae)},[ne]),te=D.useCallback(()=>{w==null||w(),d?oe():ce()},[d,oe,ce,w]),{isOpen:Z,onOpen:J,onClose:se,onToggle:he}=rf({isOpen:y,defaultIsOpen:v,onClose:b,onOpen:te});VQ({enabled:Z&&a,ref:G,handler:Ae=>{var ze,et,nt;const Ue=((et=(ze=Ae.composedPath)==null?void 0:ze.call(Ae))==null?void 0:et[0])??Ae.target;(nt=ee.current)!=null&&nt.contains(Ue)||se()}});const fe=Ij({...B,enabled:Z||j,placement:A,direction:V}),[ue,Me]=D.useState(-1);xQ(G,{focusRef:ee,visible:Z,shouldFocus:!0});const He=DQ({isOpen:Z,ref:G}),[rt,we]=cEe(e,"menu-button","menu-list"),Ce=D.useCallback(()=>{J(),ce()},[J,ce]),ve=D.useRef(new Set([]));D.useEffect(()=>{const Ae=ve.current;return()=>{Ae.forEach(Ue=>clearTimeout(Ue)),Ae.clear()}},[]),Eg(()=>{var Ae;Z||(Me(-1),(Ae=G.current)==null||Ae.scrollTo(0,0))},[Z]),Eg(()=>{Z&&ue===-1&&ce()},[ue,Z]),D.useEffect(()=>{var Ue;if(!Z)return;const Ae=ne.item(ue);(Ue=Ae==null?void 0:Ae.node)==null||Ue.focus({preventScroll:!K.current})},[ne,ue,Z]);const Ne=D.useCallback(()=>{J(),oe()},[oe,J]),Te=D.useCallback(()=>{K.current=!0,J(),ge()},[J,ge]),be=D.useCallback(()=>{var nt,dt;const Ae=ane(G.current),Ue=(nt=G.current)==null?void 0:nt.contains(Ae.activeElement);if(!(Z&&!Ue))return;const et=(dt=ne.item(ue))==null?void 0:dt.node;et==null||et.focus({preventScroll:!K.current})},[Z,ue,ne]);return{openAndFocusMenu:Ce,openAndFocusFirstItem:Ne,openAndFocusLastItem:Te,onTransitionEnd:be,unstable__animationState:He,descendants:ne,popper:fe,buttonId:rt,menuId:we,forceUpdate:fe.forceUpdate,orientation:"vertical",isOpen:Z,onToggle:he,onOpen:J,onClose:se,menuRef:G,buttonRef:ee,focusedIndex:ue,closeOnSelect:i,closeOnBlur:a,autoSelect:d,setFocusedIndex:Me,isLazy:p,lazyBehavior:N,initialFocusRef:l,scrollIntoViewRef:K}}function exe(n={},e=null){const i=nC(),{onToggle:a,popper:l,openAndFocusFirstItem:d,openAndFocusLastItem:p,scrollIntoViewRef:y}=i,v=D.useCallback(b=>{const w=b.key,N={Enter:d,ArrowDown:d,ArrowUp:p}[w];N&&(y.current=!0,b.preventDefault(),b.stopPropagation(),N(b))},[d,p,y]);return{...n,ref:rs(i.buttonRef,e,l.referenceRef),id:i.buttonId,"data-active":Kn(i.isOpen),"aria-expanded":i.isOpen,"aria-haspopup":"menu","aria-controls":i.menuId,onClick:Qn(n.onClick,a),onKeyDown:Qn(n.onKeyDown,v)}}function aV(n){var e;return ixe(n)&&!!((e=n==null?void 0:n.getAttribute("role"))!=null&&e.startsWith("menuitem"))}function txe(n={},e=null){const i=nC();if(!i)throw new Error("useMenuContext: context is undefined. Seems you forgot to wrap component within <Menu>");const{focusedIndex:a,setFocusedIndex:l,menuRef:d,isOpen:p,onClose:y,menuId:v,isLazy:b,lazyBehavior:w,scrollIntoViewRef:A,unstable__animationState:N}=i,V=qLe(),j=RDe({preventDefault:K=>K.key!==" "&&aV(K.target)}),B=D.useCallback(K=>{if(!K.currentTarget.contains(K.target))return;const ne=K.key,oe={Tab:te=>te.preventDefault(),Escape:te=>{te.stopPropagation(),y()},ArrowDown:()=>{A.current=!0;const te=V.nextEnabled(a)??V.firstEnabled();te&&l(te.index)},ArrowUp:()=>{A.current=!0;const te=V.prevEnabled(a)??V.firstEnabled();te&&l(te.index)}}[ne];if(oe){K.preventDefault(),oe(K);return}const ge=j(te=>{const Z=TDe(V.values(),te,J=>{var se;return((se=J==null?void 0:J.node)==null?void 0:se.textContent)??""},V.item(a));if(Z){const J=V.indexOf(Z.node);l(J)}});aV(K.target)&&ge(K)},[V,a,j,y,l,A]),G=D.useRef(!1);p&&(G.current=!0);const ee=tF({wasSelected:G.current,enabled:b,mode:w,isSelected:N.present});return{...n,ref:rs(d,e),children:ee?n.children:null,tabIndex:-1,role:"menu",id:v,style:{...n.style,transformOrigin:"var(--popper-transform-origin)"},"aria-orientation":"vertical",onKeyDown:Qn(n.onKeyDown,B)}}function nxe(n={}){const{popper:e,isOpen:i}=nC();return e.getPopperProps({...n,style:{visibility:i?"visible":"hidden",...n.style}})}function rxe(n={},e=null){const{onMouseEnter:i,onMouseMove:a,onMouseLeave:l,onClick:d,onFocus:p,isDisabled:y,isFocusable:v,closeOnSelect:b,type:w,...A}=n,N=nC(),{setFocusedIndex:V,focusedIndex:j,closeOnSelect:B,onClose:G,menuId:ee,scrollIntoViewRef:K}=N,ne=D.useRef(null),ce=`${ee}-menuitem-${D.useId()}`,{index:oe,register:ge}=XLe({disabled:y&&!v}),te=D.useCallback(Me=>{i==null||i(Me),!y&&(K.current=!1,V(oe))},[V,oe,y,i,K]),Z=D.useCallback(Me=>{a==null||a(Me),ne.current&&!QLe(ne.current)&&te(Me)},[te,a]),J=D.useCallback(Me=>{l==null||l(Me),!y&&V(-1)},[V,y,l]),se=D.useCallback(Me=>{d==null||d(Me),aV(Me.currentTarget)&&(b??B)&&G()},[G,d,B,b]),he=D.useCallback(Me=>{p==null||p(Me),V(oe)},[V,p,oe]),fe=oe===j,ue=one({onClick:se,onFocus:he,onMouseEnter:te,onMouseMove:Z,onMouseLeave:J,ref:rs(ge,ne,e),isDisabled:y,isFocusable:v});return{...A,...ue,type:w??ue.type,id:ce,role:"menuitem",tabIndex:fe?0:-1}}function ixe(n){if(!sxe(n))return!1;const e=n.ownerDocument.defaultView??window;return n instanceof e.HTMLElement}function sxe(n){return n!=null&&typeof n=="object"&&"nodeType"in n&&n.nodeType===Node.ELEMENT_NODE}const[oxe,x0]=Ui({name:"MenuStylesContext",errorMessage:`useMenuStyles returned is 'undefined'. Seems you forgot to wrap the components in "<Menu />" `}),rC=n=>{const{children:e}=n,i=lc("Menu",n),a=Fi(n),{direction:l}=D0(),{descendants:d,...p}=ZLe({...a,direction:l}),y=D.useMemo(()=>p,[p]),{isOpen:v,onClose:b,forceUpdate:w}=y;return C.jsx(KLe,{value:d,children:C.jsx(JLe,{value:y,children:C.jsx(oxe,{value:i,children:Xc(e,{isOpen:v,onClose:b,forceUpdate:w})})})})};rC.displayName="Menu";const axe=Bt((n,e)=>{const i=x0();return C.jsx(Nt.button,{ref:e,...n,__css:{display:"inline-flex",appearance:"none",alignItems:"center",outline:0,...i.button}})}),iC=Bt((n,e)=>{const{children:i,as:a,...l}=n,d=exe(l,e),p=a||axe;return C.jsx(p,{...d,className:un("chakra-menu__menu-button",n.className),children:C.jsx(Nt.span,{__css:{pointerEvents:"none",flex:"1 1 auto",minW:0},children:n.children})})});iC.displayName="MenuButton";const cne=Bt((n,e)=>{const i=x0();return C.jsx(Nt.span,{ref:e,...n,__css:i.command,className:"chakra-menu__command"})});cne.displayName="MenuCommand";const lne=n=>{const{className:e,...i}=n,a=x0();return C.jsx(Nt.hr,{"aria-orientation":"horizontal",className:un("chakra-menu__divider",e),...i,__css:a.divider})};lne.displayName="MenuDivider";const une=n=>{const{className:e,children:i,...a}=n,l=x0(),d=D.Children.only(i),p=D.isValidElement(d)?D.cloneElement(d,{focusable:"false","aria-hidden":!0,className:un("chakra-menu__icon",d.props.className)}):null,y=un("chakra-menu__icon-wrapper",e);return C.jsx(Nt.span,{className:y,...a,__css:l.icon,children:p})};une.displayName="MenuIcon";const cxe=Bt((n,e)=>{const{type:i,...a}=n,l=x0(),d=a.as||i?i??void 0:"button",p=D.useMemo(()=>({textDecoration:"none",color:"inherit",userSelect:"none",display:"flex",width:"100%",alignItems:"center",textAlign:"start",flex:"0 0 auto",outline:0,...l.item}),[l.item]);return C.jsx(Nt.button,{ref:e,type:d,...a,__css:p})}),Pd=Bt((n,e)=>{const{icon:i,iconSpacing:a="0.75rem",command:l,commandSpacing:d="0.75rem",children:p,...y}=n,v=rxe(y,e),w=i||l?C.jsx("span",{style:{pointerEvents:"none",flex:1},children:p}):p;return C.jsxs(cxe,{...v,className:un("chakra-menu__menuitem",v.className),children:[i&&C.jsx(une,{fontSize:"0.8em",marginEnd:a,children:i}),w,l&&C.jsx(cne,{marginStart:d,children:l})]})});Pd.displayName="MenuItem";const lxe={enter:{visibility:"visible",opacity:1,scale:1,transition:{duration:.2,ease:[.4,0,.2,1]}},exit:{transitionEnd:{visibility:"hidden"},opacity:0,scale:.8,transition:{duration:.1,easings:"easeOut"}}},uxe=Nt(cf.div),sC=Bt(function(e,i){var N;const{rootProps:a,motionProps:l,...d}=e,{isOpen:p,onTransitionEnd:y,unstable__animationState:v}=nC(),b=txe(d,i),w=nxe(a),A=x0();return C.jsx(Nt.div,{...w,__css:{zIndex:e.zIndex??((N=A.list)==null?void 0:N.zIndex)},children:C.jsx(uxe,{variants:lxe,initial:!1,animate:p?"enter":"exit",__css:{outline:0,...A.list},...l,...b,className:un("chakra-menu__menu-list",b.className),onUpdate:y,onAnimationComplete:IQ(v.onComplete,b.onAnimationComplete)})})});sC.displayName="MenuList";var dxe=function(n){if(typeof document>"u")return null;var e=Array.isArray(n)?n[0]:n;return e.ownerDocument.body},gS=new WeakMap,SO=new WeakMap,bO={},B2=0,dne=function(n){return n&&(n.host||dne(n.parentNode))},hxe=function(n,e){return e.map(function(i){if(n.contains(i))return i;var a=dne(i);return a&&n.contains(a)?a:(console.error("aria-hidden",i,"in not contained inside",n,". Doing nothing"),null)}).filter(function(i){return!!i})},fxe=function(n,e,i,a){var l=hxe(e,Array.isArray(n)?n:[n]);bO[i]||(bO[i]=new WeakMap);var d=bO[i],p=[],y=new Set,v=new Set(l),b=function(A){!A||y.has(A)||(y.add(A),b(A.parentNode))};l.forEach(b);var w=function(A){!A||v.has(A)||Array.prototype.forEach.call(A.children,function(N){if(y.has(N))w(N);else try{var V=N.getAttribute(a),j=V!==null&&V!=="false",B=(gS.get(N)||0)+1,G=(d.get(N)||0)+1;gS.set(N,B),d.set(N,G),p.push(N),B===1&&j&&SO.set(N,!0),G===1&&N.setAttribute(i,"true"),j||N.setAttribute(a,"true")}catch(ee){console.error("aria-hidden: cannot operate on ",N,ee)}})};return w(e),y.clear(),B2++,function(){p.forEach(function(A){var N=gS.get(A)-1,V=d.get(A)-1;gS.set(A,N),d.set(A,V),N||(SO.has(A)||A.removeAttribute(a),SO.delete(A)),V||A.removeAttribute(i)}),B2--,B2||(gS=new WeakMap,gS=new WeakMap,SO=new WeakMap,bO={})}},pxe=function(n,e,i){i===void 0&&(i="data-aria-hidden");var a=Array.from(Array.isArray(n)?n:[n]),l=dxe(n);return l?(a.push.apply(a,Array.from(l.querySelectorAll("[aria-live]"))),fxe(a,l,i,"aria-hidden")):function(){return null}},mxe=Object.defineProperty,gxe=(n,e,i)=>e in n?mxe(n,e,{enumerable:!0,configurable:!0,writable:!0,value:i}):n[e]=i,_xe=(n,e,i)=>(gxe(n,e+"",i),i);class yxe{constructor(){_xe(this,"modals"),this.modals=new Set}add(e){return this.modals.add(e),this.modals.size}remove(e){this.modals.delete(e)}isTopModal(e){if(!e)return!1;const i=Array.from(this.modals)[this.modals.size-1];return e===i}}const cV=new yxe;function hne(n,e){const[i,a]=D.useState(0);return D.useEffect(()=>{const l=n.current;if(l){if(e){const d=cV.add(l);a(d)}return()=>{cV.remove(l),a(0)}}},[e,n]),i}function Exe(n){const{isOpen:e,onClose:i,id:a,closeOnOverlayClick:l=!0,closeOnEsc:d=!0,useInert:p=!0,onOverlayClick:y,onEsc:v}=n,b=D.useRef(null),w=D.useRef(null),[A,N,V]=Sxe(a,"chakra-modal","chakra-modal--header","chakra-modal--body");vxe(b,e&&p);const j=hne(b,e),B=D.useRef(null),G=D.useCallback(J=>{B.current=J.target},[]),ee=D.useCallback(J=>{J.key==="Escape"&&(J.stopPropagation(),d&&(i==null||i()),v==null||v())},[d,i,v]),[K,ne]=D.useState(!1),[ce,oe]=D.useState(!1),ge=D.useCallback((J={},se=null)=>({role:"dialog",...J,ref:rs(se,b),id:A,tabIndex:-1,"aria-modal":!0,"aria-labelledby":K?N:void 0,"aria-describedby":ce?V:void 0,onClick:Qn(J.onClick,he=>he.stopPropagation())}),[V,ce,A,N,K]),te=D.useCallback(J=>{J.stopPropagation(),B.current===J.target&&cV.isTopModal(b.current)&&(l&&(i==null||i()),y==null||y())},[i,l,y]),Z=D.useCallback((J={},se=null)=>({...J,ref:rs(se,w),onClick:Qn(J.onClick,te),onKeyDown:Qn(J.onKeyDown,ee),onMouseDown:Qn(J.onMouseDown,G)}),[ee,G,te]);return{isOpen:e,onClose:i,headerId:N,bodyId:V,setBodyMounted:oe,setHeaderMounted:ne,dialogRef:b,overlayRef:w,getDialogProps:ge,getDialogContainerProps:Z,index:j}}function vxe(n,e){const i=n.current;D.useEffect(()=>{if(!(!n.current||!e))return pxe(n.current)},[e,n,i])}function Sxe(n,...e){const i=D.useId(),a=n||i;return D.useMemo(()=>e.map(l=>`${l}-${a}`),[a,e])}const[bxe,M0]=Ui({name:"ModalStylesContext",errorMessage:`useModalStyles returned is 'undefined'. Seems you forgot to wrap the components in "<Modal />" `}),[Txe,Ly]=Ui({strict:!0,name:"ModalContext",errorMessage:"useModalContext: `context` is undefined. Seems you forgot to wrap modal components in `<Modal />`"}),ra=n=>{const e={scrollBehavior:"outside",autoFocus:!0,trapFocus:!0,returnFocusOnClose:!0,blockScrollOnMount:!0,allowPinchZoom:!1,preserveScrollBarGap:!0,motionPreset:"scale",...n,lockFocusAcrossFrames:n.lockFocusAcrossFrames||!0},{portalProps:i,children:a,autoFocus:l,trapFocus:d,initialFocusRef:p,finalFocusRef:y,returnFocusOnClose:v,blockScrollOnMount:b,allowPinchZoom:w,preserveScrollBarGap:A,motionPreset:N,lockFocusAcrossFrames:V,animatePresenceProps:j,onCloseComplete:B}=e,G=lc("Modal",e),K={...Exe(e),autoFocus:l,trapFocus:d,initialFocusRef:p,finalFocusRef:y,returnFocusOnClose:v,blockScrollOnMount:b,allowPinchZoom:w,preserveScrollBarGap:A,motionPreset:N,lockFocusAcrossFrames:V};return C.jsx(Txe,{value:K,children:C.jsx(bxe,{value:G,children:C.jsx(O0,{...j,onExitComplete:B,children:K.isOpen&&C.jsx(Vl,{...i,children:a})})})})};ra.displayName="Modal";var rk="right-scroll-bar-position",ik="width-before-scroll-bar",wxe="with-scroll-bars-hidden",Rxe="--removed-body-scroll-bar-size",fne=Ete(),W2=function(){},O1=D.forwardRef(function(n,e){var i=D.useRef(null),a=D.useState({onScrollCapture:W2,onWheelCapture:W2,onTouchMoveCapture:W2}),l=a[0],d=a[1],p=n.forwardProps,y=n.children,v=n.className,b=n.removeScrollBar,w=n.enabled,A=n.shards,N=n.sideCar,V=n.noIsolation,j=n.inert,B=n.allowPinchZoom,G=n.as,ee=G===void 0?"div":G,K=n.gapMode,ne=ZR(n,["forwardProps","children","className","removeScrollBar","enabled","shards","sideCar","noIsolation","inert","allowPinchZoom","as","gapMode"]),ce=N,oe=gte([i,e]),ge=Bh(Bh({},ne),l);return D.createElement(D.Fragment,null,w&&D.createElement(ce,{sideCar:fne,removeScrollBar:b,shards:A,noIsolation:V,inert:j,setCallbacks:d,allowPinchZoom:!!B,lockRef:i,gapMode:K}),p?D.cloneElement(D.Children.only(y),Bh(Bh({},ge),{ref:oe})):D.createElement(ee,Bh({},ge,{className:v,ref:oe}),y))});O1.defaultProps={enabled:!0,removeScrollBar:!0,inert:!1};O1.classNames={fullWidth:ik,zeroRight:rk};var Cxe=function(){if(typeof __webpack_nonce__<"u")return __webpack_nonce__};function Ixe(){if(!document)return null;var n=document.createElement("style");n.type="text/css";var e=Cxe();return e&&n.setAttribute("nonce",e),n}function Axe(n,e){n.styleSheet?n.styleSheet.cssText=e:n.appendChild(document.createTextNode(e))}function Pxe(n){var e=document.head||document.getElementsByTagName("head")[0];e.appendChild(n)}var Oxe=function(){var n=0,e=null;return{add:function(i){n==0&&(e=Ixe())&&(Axe(e,i),Pxe(e)),n++},remove:function(){n--,!n&&e&&(e.parentNode&&e.parentNode.removeChild(e),e=null)}}},kxe=function(){var n=Oxe();return function(e,i){D.useEffect(function(){return n.add(e),function(){n.remove()}},[e&&i])}},pne=function(){var n=kxe(),e=function(i){var a=i.styles,l=i.dynamic;return n(a,l),null};return e},Nxe={left:0,top:0,right:0,gap:0},z2=function(n){return parseInt(n||"",10)||0},Dxe=function(n){var e=window.getComputedStyle(document.body),i=e[n==="padding"?"paddingLeft":"marginLeft"],a=e[n==="padding"?"paddingTop":"marginTop"],l=e[n==="padding"?"paddingRight":"marginRight"];return[z2(i),z2(a),z2(l)]},Lxe=function(n){if(n===void 0&&(n="margin"),typeof window>"u")return Nxe;var e=Dxe(n),i=document.documentElement.clientWidth,a=window.innerWidth;return{left:e[0],top:e[1],right:e[2],gap:Math.max(0,a-i+e[2]-e[0])}},xxe=pne(),XS="data-scroll-locked",Mxe=function(n,e,i,a){var l=n.left,d=n.top,p=n.right,y=n.gap;return i===void 0&&(i="margin"),`
  .`.concat(wxe,` {
   overflow: hidden `).concat(a,`;
   padding-right: `).concat(y,"px ").concat(a,`;
  }
  body[`).concat(XS,`] {
    overflow: hidden `).concat(a,`;
    overscroll-behavior: contain;
    `).concat([e&&"position: relative ".concat(a,";"),i==="margin"&&`
    padding-left: `.concat(l,`px;
    padding-top: `).concat(d,`px;
    padding-right: `).concat(p,`px;
    margin-left:0;
    margin-top:0;
    margin-right: `).concat(y,"px ").concat(a,`;
    `),i==="padding"&&"padding-right: ".concat(y,"px ").concat(a,";")].filter(Boolean).join(""),`
  }
  
  .`).concat(rk,` {
    right: `).concat(y,"px ").concat(a,`;
  }
  
  .`).concat(ik,` {
    margin-right: `).concat(y,"px ").concat(a,`;
  }
  
  .`).concat(rk," .").concat(rk,` {
    right: 0 `).concat(a,`;
  }
  
  .`).concat(ik," .").concat(ik,` {
    margin-right: 0 `).concat(a,`;
  }
  
  body[`).concat(XS,`] {
    `).concat(Rxe,": ").concat(y,`px;
  }
`)},MY=function(){var n=parseInt(document.body.getAttribute(XS)||"0",10);return isFinite(n)?n:0},Uxe=function(){D.useEffect(function(){return document.body.setAttribute(XS,(MY()+1).toString()),function(){var n=MY()-1;n<=0?document.body.removeAttribute(XS):document.body.setAttribute(XS,n.toString())}},[])},Vxe=function(n){var e=n.noRelative,i=n.noImportant,a=n.gapMode,l=a===void 0?"margin":a;Uxe();var d=D.useMemo(function(){return Lxe(l)},[l]);return D.createElement(xxe,{styles:Mxe(d,!e,l,i?"":"!important")})},lV=!1;if(typeof window<"u")try{var TO=Object.defineProperty({},"passive",{get:function(){return lV=!0,!0}});window.addEventListener("test",TO,TO),window.removeEventListener("test",TO,TO)}catch{lV=!1}var _S=lV?{passive:!1}:!1,Fxe=function(n){return n.tagName==="TEXTAREA"},mne=function(n,e){if(!(n instanceof Element))return!1;var i=window.getComputedStyle(n);return i[e]!=="hidden"&&!(i.overflowY===i.overflowX&&!Fxe(n)&&i[e]==="visible")},jxe=function(n){return mne(n,"overflowY")},Bxe=function(n){return mne(n,"overflowX")},UY=function(n,e){var i=e.ownerDocument,a=e;do{typeof ShadowRoot<"u"&&a instanceof ShadowRoot&&(a=a.host);var l=gne(n,a);if(l){var d=_ne(n,a),p=d[1],y=d[2];if(p>y)return!0}a=a.parentNode}while(a&&a!==i.body);return!1},Wxe=function(n){var e=n.scrollTop,i=n.scrollHeight,a=n.clientHeight;return[e,i,a]},zxe=function(n){var e=n.scrollLeft,i=n.scrollWidth,a=n.clientWidth;return[e,i,a]},gne=function(n,e){return n==="v"?jxe(e):Bxe(e)},_ne=function(n,e){return n==="v"?Wxe(e):zxe(e)},Gxe=function(n,e){return n==="h"&&e==="rtl"?-1:1},Hxe=function(n,e,i,a,l){var d=Gxe(n,window.getComputedStyle(e).direction),p=d*a,y=i.target,v=e.contains(y),b=!1,w=p>0,A=0,N=0;do{var V=_ne(n,y),j=V[0],B=V[1],G=V[2],ee=B-G-d*j;(j||ee)&&gne(n,y)&&(A+=ee,N+=j),y instanceof ShadowRoot?y=y.host:y=y.parentNode}while(!v&&y!==document.body||v&&(e.contains(y)||e===y));return(w&&Math.abs(A)<1||!w&&Math.abs(N)<1)&&(b=!0),b},wO=function(n){return"changedTouches"in n?[n.changedTouches[0].clientX,n.changedTouches[0].clientY]:[0,0]},VY=function(n){return[n.deltaX,n.deltaY]},FY=function(n){return n&&"current"in n?n.current:n},$xe=function(n,e){return n[0]===e[0]&&n[1]===e[1]},Kxe=function(n){return`
  .block-interactivity-`.concat(n,` {pointer-events: none;}
  .allow-interactivity-`).concat(n,` {pointer-events: all;}
`)},qxe=0,yS=[];function Yxe(n){var e=D.useRef([]),i=D.useRef([0,0]),a=D.useRef(),l=D.useState(qxe++)[0],d=D.useState(pne)[0],p=D.useRef(n);D.useEffect(function(){p.current=n},[n]),D.useEffect(function(){if(n.inert){document.body.classList.add("block-interactivity-".concat(l));var B=nNe([n.lockRef.current],(n.shards||[]).map(FY),!0).filter(Boolean);return B.forEach(function(G){return G.classList.add("allow-interactivity-".concat(l))}),function(){document.body.classList.remove("block-interactivity-".concat(l)),B.forEach(function(G){return G.classList.remove("allow-interactivity-".concat(l))})}}},[n.inert,n.lockRef.current,n.shards]);var y=D.useCallback(function(B,G){if("touches"in B&&B.touches.length===2||B.type==="wheel"&&B.ctrlKey)return!p.current.allowPinchZoom;var ee=wO(B),K=i.current,ne="deltaX"in B?B.deltaX:K[0]-ee[0],ce="deltaY"in B?B.deltaY:K[1]-ee[1],oe,ge=B.target,te=Math.abs(ne)>Math.abs(ce)?"h":"v";if("touches"in B&&te==="h"&&ge.type==="range")return!1;var Z=UY(te,ge);if(!Z)return!0;if(Z?oe=te:(oe=te==="v"?"h":"v",Z=UY(te,ge)),!Z)return!1;if(!a.current&&"changedTouches"in B&&(ne||ce)&&(a.current=oe),!oe)return!0;var J=a.current||oe;return Hxe(J,G,B,J==="h"?ne:ce)},[]),v=D.useCallback(function(B){var G=B;if(!(!yS.length||yS[yS.length-1]!==d)){var ee="deltaY"in G?VY(G):wO(G),K=e.current.filter(function(oe){return oe.name===G.type&&(oe.target===G.target||G.target===oe.shadowParent)&&$xe(oe.delta,ee)})[0];if(K&&K.should){G.cancelable&&G.preventDefault();return}if(!K){var ne=(p.current.shards||[]).map(FY).filter(Boolean).filter(function(oe){return oe.contains(G.target)}),ce=ne.length>0?y(G,ne[0]):!p.current.noIsolation;ce&&G.cancelable&&G.preventDefault()}}},[]),b=D.useCallback(function(B,G,ee,K){var ne={name:B,delta:G,target:ee,should:K,shadowParent:Xxe(ee)};e.current.push(ne),setTimeout(function(){e.current=e.current.filter(function(ce){return ce!==ne})},1)},[]),w=D.useCallback(function(B){i.current=wO(B),a.current=void 0},[]),A=D.useCallback(function(B){b(B.type,VY(B),B.target,y(B,n.lockRef.current))},[]),N=D.useCallback(function(B){b(B.type,wO(B),B.target,y(B,n.lockRef.current))},[]);D.useEffect(function(){return yS.push(d),n.setCallbacks({onScrollCapture:A,onWheelCapture:A,onTouchMoveCapture:N}),document.addEventListener("wheel",v,_S),document.addEventListener("touchmove",v,_S),document.addEventListener("touchstart",w,_S),function(){yS=yS.filter(function(B){return B!==d}),document.removeEventListener("wheel",v,_S),document.removeEventListener("touchmove",v,_S),document.removeEventListener("touchstart",w,_S)}},[]);var V=n.removeScrollBar,j=n.inert;return D.createElement(D.Fragment,null,j?D.createElement(d,{styles:Kxe(l)}):null,V?D.createElement(Vxe,{gapMode:n.gapMode}):null)}function Xxe(n){for(var e=null;n!==null;)n instanceof ShadowRoot&&(e=n.host,n=n.host),n=n.parentNode;return e}const Jxe=rNe(fne,Yxe);var yne=D.forwardRef(function(n,e){return D.createElement(O1,Bh({},n,{ref:e,sideCar:Jxe}))});yne.classNames=O1.classNames;function Qxe(n){const{autoFocus:e,trapFocus:i,dialogRef:a,initialFocusRef:l,blockScrollOnMount:d,allowPinchZoom:p,finalFocusRef:y,returnFocusOnClose:v,preserveScrollBarGap:b,lockFocusAcrossFrames:w,isOpen:A}=Ly(),[N,V]=TF();D.useEffect(()=>{!N&&V&&setTimeout(V)},[N,V]);const j=hne(a,A);return C.jsx($te,{autoFocus:e,isDisabled:!i,initialFocusRef:l,finalFocusRef:y,restoreFocus:v,contentRef:a,lockFocusAcrossFrames:w,children:C.jsx(yne,{removeScrollBar:!b,allowPinchZoom:p,enabled:j===1&&d,forwardProps:!0,children:n.children})})}const Zxe={initial:({offsetX:n,offsetY:e,transition:i,transitionEnd:a,delay:l})=>({opacity:0,x:n,y:e,transition:(i==null?void 0:i.exit)??Ry.exit(wy.exit,l),transitionEnd:a==null?void 0:a.exit}),enter:({transition:n,transitionEnd:e,delay:i})=>({opacity:1,x:0,y:0,transition:(n==null?void 0:n.enter)??Ry.enter(wy.enter,i),transitionEnd:e==null?void 0:e.enter}),exit:({offsetY:n,offsetX:e,transition:i,transitionEnd:a,reverse:l,delay:d})=>{const p={x:e,y:n};return{opacity:0,transition:(i==null?void 0:i.exit)??Ry.exit(wy.exit,d),...l?{...p,transitionEnd:a==null?void 0:a.exit}:{transitionEnd:{...p,...a==null?void 0:a.exit}}}}},Mw={initial:"initial",animate:"enter",exit:"exit",variants:Zxe},eMe=D.forwardRef(function(e,i){const{unmountOnExit:a,in:l,reverse:d=!0,className:p,offsetX:y=0,offsetY:v=8,transition:b,transitionEnd:w,delay:A,animatePresenceProps:N,...V}=e,j=a?l&&a:!0,B=l||a?"enter":"exit",G={offsetX:y,offsetY:v,reverse:d,transition:b,transitionEnd:w,delay:A};return C.jsx(O0,{...N,custom:G,children:j&&C.jsx(cf.div,{ref:i,className:un("chakra-offset-slide",p),custom:G,...Mw,animate:B,...V})})});eMe.displayName="SlideFade";const tMe={exit:({reverse:n,initialScale:e,transition:i,transitionEnd:a,delay:l})=>({opacity:0,...n?{scale:e,transitionEnd:a==null?void 0:a.exit}:{transitionEnd:{scale:e,...a==null?void 0:a.exit}},transition:(i==null?void 0:i.exit)??Ry.exit(wy.exit,l)}),enter:({transitionEnd:n,transition:e,delay:i})=>({opacity:1,scale:1,transition:(e==null?void 0:e.enter)??Ry.enter(wy.enter,i),transitionEnd:n==null?void 0:n.enter})},Ene={initial:"exit",animate:"enter",exit:"exit",variants:tMe},nMe=D.forwardRef(function(e,i){const{unmountOnExit:a,in:l,reverse:d=!0,initialScale:p=.95,className:y,transition:v,transitionEnd:b,delay:w,animatePresenceProps:A,...N}=e,V=a?l&&a:!0,j=l||a?"enter":"exit",B={initialScale:p,reverse:d,transition:v,transitionEnd:b,delay:w};return C.jsx(O0,{...A,custom:B,children:V&&C.jsx(cf.div,{ref:i,className:un("chakra-offset-slide",y),...Ene,animate:j,custom:B,...N})})});nMe.displayName="ScaleFade";const rMe={slideInBottom:{...Mw,custom:{offsetY:16,reverse:!0}},slideInRight:{...Mw,custom:{offsetX:16,reverse:!0}},slideInTop:{...Mw,custom:{offsetY:-16,reverse:!0}},slideInLeft:{...Mw,custom:{offsetX:-16,reverse:!0}},scale:{...Ene,custom:{initialScale:.95,reverse:!0}},none:{}},iMe=Nt(cf.section),sMe=n=>rMe[n||"none"],vne=D.forwardRef((n,e)=>{const{preset:i,motionProps:a=sMe(i),...l}=n;return C.jsx(iMe,{ref:e,...a,...l})});vne.displayName="ModalTransition";const ia=Bt((n,e)=>{const{className:i,children:a,containerProps:l,motionProps:d,...p}=n,{getDialogProps:y,getDialogContainerProps:v}=Ly(),b=y(p,e),w=v(l),A=un("chakra-modal__content",i),N=M0(),V={display:"flex",flexDirection:"column",position:"relative",width:"100%",outline:0,...N.dialog},j={display:"flex",width:"100vw",height:"$100vh",position:"fixed",left:0,top:0,...N.dialogContainer},{motionPreset:B}=Ly();return C.jsx(Qxe,{children:C.jsx(Nt.div,{...w,className:"chakra-modal__content-container",tabIndex:-1,__css:j,children:C.jsx(vne,{preset:B,motionProps:d,className:A,...b,__css:V,children:a})})})});ia.displayName="ModalContent";const sa=Bt((n,e)=>{const{className:i,...a}=n,{bodyId:l,setBodyMounted:d}=Ly();D.useEffect(()=>(d(!0),()=>d(!1)),[d]);const p=un("chakra-modal__body",i),y=M0();return C.jsx(Nt.div,{ref:e,className:p,id:l,...a,__css:y.body})});sa.displayName="ModalBody";const ja=Bt((n,e)=>{const{onClick:i,className:a,...l}=n,{onClose:d}=Ly(),p=un("chakra-modal__close-btn",a),y=M0();return C.jsx(rj,{ref:e,__css:y.closeButton,className:p,onClick:Qn(i,v=>{v.stopPropagation(),d()}),...l})});ja.displayName="ModalCloseButton";const bg=Bt((n,e)=>{const{className:i,...a}=n,l=un("chakra-modal__footer",i),d=M0(),p={display:"flex",alignItems:"center",justifyContent:"flex-end",...d.footer};return C.jsx(Nt.footer,{ref:e,...a,__css:p,className:l})});bg.displayName="ModalFooter";const tl=Bt((n,e)=>{const{className:i,...a}=n,{headerId:l,setHeaderMounted:d}=Ly();D.useEffect(()=>(d(!0),()=>d(!1)),[d]);const p=un("chakra-modal__header",i),y=M0(),v={flex:0,...y.header};return C.jsx(Nt.header,{ref:e,className:p,id:l,...a,__css:v})});tl.displayName="ModalHeader";const oMe={enter:({transition:n,transitionEnd:e,delay:i}={})=>({opacity:1,transition:(n==null?void 0:n.enter)??Ry.enter(wy.enter,i),transitionEnd:e==null?void 0:e.enter}),exit:({transition:n,transitionEnd:e,delay:i}={})=>({opacity:0,transition:(n==null?void 0:n.exit)??Ry.exit(wy.exit,i),transitionEnd:e==null?void 0:e.exit})},Sne={initial:"exit",animate:"enter",exit:"exit",variants:oMe},aMe=D.forwardRef(function(e,i){const{unmountOnExit:a,in:l,className:d,transition:p,transitionEnd:y,delay:v,animatePresenceProps:b,...w}=e,A=l||a?"enter":"exit",N=a?l&&a:!0,V={transition:p,transitionEnd:y,delay:v};return C.jsx(O0,{...b,custom:V,children:N&&C.jsx(cf.div,{ref:i,className:un("chakra-fade",d),custom:V,...Sne,animate:A,...w})})});aMe.displayName="Fade";const cMe=Nt(cf.div),oa=Bt((n,e)=>{const{className:i,transition:a,motionProps:l,...d}=n,p=un("chakra-modal__overlay",i),v={pos:"fixed",left:"0",top:"0",w:"100vw",h:"100vh",...M0().overlay},{motionPreset:b}=Ly(),A=l||(b==="none"?{}:Sne);return C.jsx(cMe,{...A,__css:v,ref:e,className:p,...d})});oa.displayName="ModalOverlay";function lMe(n){const{leastDestructiveRef:e,...i}=n;return C.jsx(ra,{...i,initialFocusRef:e})}const uMe=Bt((n,e)=>C.jsx(ia,{ref:e,role:"alertdialog",...n})),[dMe,k1]=Ui({name:"PopoverContext",errorMessage:"usePopoverContext: `context` is undefined. Seems you forgot to wrap all popover components within `<Popover />`"}),[hMe,bne]=Ui({name:"PopoverStylesContext",errorMessage:`usePopoverStyles returned is 'undefined'. Seems you forgot to wrap the components in "<Popover />" `}),ES={click:"click",hover:"hover"};function fMe(n={}){const{closeOnBlur:e=!0,closeOnEsc:i=!0,initialFocusRef:a,id:l,returnFocusOnClose:d=!0,autoFocus:p=!0,arrowSize:y,arrowShadowColor:v,trigger:b=ES.click,openDelay:w=200,closeDelay:A=200,isLazy:N,lazyBehavior:V="unmount",computePositionOnMount:j,...B}=n,{isOpen:G,onClose:ee,onOpen:K,onToggle:ne}=rf(n),[ce,oe]=D.useState(d);D.useEffect(()=>oe(d),[d]);const ge=D.useRef(null),te=D.useRef(null),Z=D.useRef(null),J=D.useRef(!1),se=D.useRef(!1);G&&(se.current=!0);const[he,fe]=D.useState(!1),[ue,Me]=D.useState(!1),He=D.useId(),rt=l??He,[we,Ce,ve,Ne]=["popover-trigger","popover-content","popover-header","popover-body"].map(qt=>`${qt}-${rt}`),{referenceRef:Te,getArrowProps:be,getPopperProps:Ae,getArrowInnerProps:Ue,forceUpdate:ze}=Ij({...B,enabled:G||!!j}),et=DQ({isOpen:G,ref:Z});oEe({enabled:G,ref:te}),xQ(Z,{focusRef:te,visible:G,shouldFocus:ce&&b===ES.click}),Qye(Z,{focusRef:a,visible:G,shouldFocus:p&&b===ES.click}),VQ({enabled:G&&e,ref:Z,handler(qt){var Fe;const Re=((Fe=qt.composedPath)==null?void 0:Fe.call(qt)[0])??[qt.target];RO(te.current,Re)||(Re&&oe(!vk(Re)),ee())}});const nt=tF({wasSelected:se.current,enabled:N,mode:V,isSelected:et.present}),dt=D.useCallback((qt={},Re=null)=>{const Fe={...qt,style:{...qt.style,transformOrigin:qs.transformOrigin.varRef,[qs.arrowSize.var]:y?`${y}px`:void 0,[qs.arrowShadowColor.var]:v},ref:rs(Z,Re),children:nt?qt.children:null,id:Ce,tabIndex:-1,role:"dialog",onKeyDown:Qn(qt.onKeyDown,Ke=>{Ke.nativeEvent.isComposing||i&&Ke.key==="Escape"&&(Ke.preventDefault(),Ke.stopPropagation(),ee())}),onBlur:Qn(qt.onBlur,Ke=>{const Et=jY(Ke),bt=RO(Z.current,Et),Ge=RO(te.current,Et),Ot=!bt&&!Ge;Et&&oe(!vk(Et)),G&&e&&Ot&&ee()}),"aria-labelledby":he?ve:void 0,"aria-describedby":ue?Ne:void 0};return b===ES.hover&&(Fe.role="tooltip",Fe.onMouseEnter=Qn(qt.onMouseEnter,()=>{J.current=!0}),Fe.onMouseLeave=Qn(qt.onMouseLeave,Ke=>{Ke.nativeEvent.relatedTarget!==null&&(J.current=!1,setTimeout(()=>ee(),A))})),Fe},[nt,Ce,he,ve,ue,Ne,b,i,ee,G,e,A,v,y]),Xe=D.useCallback((qt={},Re=null)=>Ae({...qt,style:{visibility:G?"visible":"hidden",...qt.style}},Re),[G,Ae]),It=D.useCallback((qt,Re=null)=>({...qt,ref:rs(Re,ge,Te)}),[ge,Te]),hn=D.useRef(void 0),Ut=D.useRef(void 0),ln=D.useCallback(qt=>{ge.current==null&&Te(qt)},[Te]),xn=D.useCallback((qt={},Re=null)=>{const Fe={...qt,ref:rs(te,Re,ln),id:we,"aria-haspopup":"dialog","aria-expanded":G,"aria-controls":Ce};return b===ES.click&&(Fe.onClick=Qn(qt.onClick,ne)),b===ES.hover&&(Fe.onFocus=Qn(qt.onFocus,()=>{hn.current===void 0&&K()}),Fe.onBlur=Qn(qt.onBlur,Ke=>{const Et=jY(Ke),bt=!RO(Z.current,Et);G&&e&&bt&&ee()}),Fe.onKeyDown=Qn(qt.onKeyDown,Ke=>{Ke.key==="Escape"&&ee()}),Fe.onMouseEnter=Qn(qt.onMouseEnter,()=>{J.current=!0,hn.current=window.setTimeout(()=>K(),w)}),Fe.onMouseLeave=Qn(qt.onMouseLeave,()=>{J.current=!1,hn.current&&(clearTimeout(hn.current),hn.current=void 0),Ut.current=window.setTimeout(()=>{J.current===!1&&ee()},A)})),Fe},[we,G,Ce,b,ln,ne,K,e,ee,w,A]);D.useEffect(()=>()=>{hn.current&&clearTimeout(hn.current),Ut.current&&clearTimeout(Ut.current)},[]);const Xt=D.useCallback((qt={},Re=null)=>({...qt,id:ve,ref:rs(Re,Fe=>{fe(!!Fe)})}),[ve]),Yn=D.useCallback((qt={},Re=null)=>({...qt,id:Ne,ref:rs(Re,Fe=>{Me(!!Fe)})}),[Ne]);return{forceUpdate:ze,isOpen:G,onAnimationComplete:et.onComplete,onClose:ee,getAnchorProps:It,getArrowProps:be,getArrowInnerProps:Ue,getPopoverPositionerProps:Xe,getPopoverProps:dt,getTriggerProps:xn,getHeaderProps:Xt,getBodyProps:Yn}}function RO(n,e){return n===e||(n==null?void 0:n.contains(e))}function jY(n){const e=n.currentTarget.ownerDocument.activeElement;return n.relatedTarget??e}function Tne(n){const e=lc("Popover",n),{children:i,...a}=Fi(n),l=D0(),d=fMe({...a,direction:l.direction});return C.jsx(dMe,{value:d,children:C.jsx(hMe,{value:e,children:Xc(i,{isOpen:d.isOpen,onClose:d.onClose,forceUpdate:d.forceUpdate})})})}Tne.displayName="Popover";function wne(n){var i;const e=D.version;return typeof e!="string"||e.startsWith("18.")?n==null?void 0:n.ref:(i=n==null?void 0:n.props)==null?void 0:i.ref}const Rne=Bt(function(e,i){const{getBodyProps:a}=k1(),l=bne();return C.jsx(Nt.div,{...a(e,i),className:un("chakra-popover__body",e.className),__css:l.body})});Rne.displayName="PopoverBody";function pMe(n){if(n)return{enter:{...n.enter,visibility:"visible"},exit:{...n.exit,transitionEnd:{visibility:"hidden"}}}}const mMe={exit:{opacity:0,scale:.95,transition:{duration:.1,ease:[.4,0,1,1]}},enter:{scale:1,opacity:1,transition:{duration:.15,ease:[0,0,.2,1]}}},gMe=Nt(cf.section),Cne=Bt(function(e,i){const{variants:a=mMe,...l}=e,{isOpen:d}=k1();return C.jsx(gMe,{ref:i,variants:pMe(a),initial:!1,animate:d?"enter":"exit",...l})});Cne.displayName="PopoverTransition";const Ine=Bt(function(e,i){const{rootProps:a,motionProps:l,...d}=e,{getPopoverProps:p,getPopoverPositionerProps:y,onAnimationComplete:v}=k1(),b=bne(),w={position:"relative",display:"flex",flexDirection:"column",...b.content};return C.jsx(Nt.div,{...y(a),__css:b.popper,className:"chakra-popover__popper",children:C.jsx(Cne,{...l,...p(d,i),onAnimationComplete:IQ(v,d.onAnimationComplete),className:un("chakra-popover__content",e.className),__css:w})})});Ine.displayName="PopoverContent";function Ane(n){const e=D.Children.only(n.children),{getTriggerProps:i}=k1();return C.jsx(C.Fragment,{children:D.cloneElement(e,i(e.props,wne(e)))})}Ane.displayName="PopoverTrigger";function _Me(n,e,i){return(n-e)*100/(i-e)}$R({"0%":{strokeDasharray:"1, 400",strokeDashoffset:"0"},"50%":{strokeDasharray:"400, 400",strokeDashoffset:"-100"},"100%":{strokeDasharray:"400, 400",strokeDashoffset:"-260"}});$R({"0%":{transform:"rotate(0deg)"},"100%":{transform:"rotate(360deg)"}});const yMe=$R({"0%":{left:"-40%"},"100%":{left:"100%"}}),EMe=$R({from:{backgroundPosition:"1rem 0"},to:{backgroundPosition:"0 0"}});function vMe(n){const{value:e=0,min:i,max:a,valueText:l,getValueText:d,isIndeterminate:p,role:y="progressbar"}=n,v=_Me(e,i,a);return{bind:{"data-indeterminate":p?"":void 0,"aria-valuemax":a,"aria-valuemin":i,"aria-valuenow":p?void 0:e,"aria-valuetext":(()=>{if(e!=null)return typeof d=="function"?d(e,v):l})(),role:y},percent:v,value:e}}const[SMe,bMe]=Ui({name:"ProgressStylesContext",errorMessage:`useProgressStyles returned is 'undefined'. Seems you forgot to wrap the components in "<Progress />" `}),TMe=Bt((n,e)=>{const{min:i,max:a,value:l,isIndeterminate:d,role:p,...y}=n,v=vMe({value:l,min:i,max:a,isIndeterminate:d,role:p}),w={height:"100%",...bMe().filledTrack};return C.jsx(Nt.div,{ref:e,style:{width:`${v.percent}%`,...y.style},...v.bind,...y,__css:w})}),m0=Bt((n,e)=>{var te;const{value:i,min:a=0,max:l=100,hasStripe:d,isAnimated:p,children:y,borderRadius:v,isIndeterminate:b,"aria-label":w,"aria-labelledby":A,"aria-valuetext":N,title:V,role:j,...B}=Fi(n),G=lc("Progress",n),ee=v??((te=G.track)==null?void 0:te.borderRadius),K={animation:`${EMe} 1s linear infinite`},oe={...!b&&d&&p&&K,...b&&{position:"absolute",willChange:"left",minWidth:"50%",animation:`${yMe} 1s ease infinite normal none running`}},ge={overflow:"hidden",position:"relative",...G.track};return C.jsx(Nt.div,{ref:e,borderRadius:ee,__css:ge,...B,children:C.jsxs(SMe,{value:G,children:[C.jsx(TMe,{"aria-label":w,"aria-labelledby":A,"aria-valuetext":N,min:a,max:l,value:i,isIndeterminate:b,css:oe,borderRadius:ee,title:V,role:j}),y]})})});m0.displayName="Progress";const Pne=Bt(function(e,i){const{children:a,placeholder:l,className:d,...p}=e;return C.jsxs(Nt.select,{...p,ref:i,className:un("chakra-select",d),children:[l&&C.jsx("option",{value:"",children:l}),a]})});Pne.displayName="SelectField";const One=Bt((n,e)=>{var ne;const i=lc("Select",n),{rootProps:a,placeholder:l,icon:d,color:p,height:y,h:v,minH:b,minHeight:w,iconColor:A,iconSize:N,...V}=Fi(n),[j,B]=$ye(V,ove),G=oj(B),ee={width:"100%",height:"fit-content",position:"relative",color:p},K={paddingEnd:"2rem",...i.field,_focus:{zIndex:"unset",...(ne=i.field)==null?void 0:ne._focus}};return C.jsxs(Nt.div,{className:"chakra-select__wrapper",__css:ee,...j,...a,children:[C.jsx(Pne,{ref:e,height:v??y,minH:b??w,placeholder:l,...G,__css:K,children:n.children}),C.jsx(kne,{"data-disabled":Kn(G.disabled),...(A||p)&&{color:A||p},__css:i.icon,...N&&{fontSize:N},children:d})]})});One.displayName="Select";const wMe=n=>C.jsx("svg",{viewBox:"0 0 24 24",...n,children:C.jsx("path",{fill:"currentColor",d:"M16.59 8.59L12 13.17 7.41 8.59 6 10l6 6 6-6z"})}),RMe=Nt("div",{baseStyle:{position:"absolute",display:"inline-flex",alignItems:"center",justifyContent:"center",pointerEvents:"none",top:"50%",transform:"translateY(-50%)"}}),kne=n=>{const{children:e=C.jsx(wMe,{}),...i}=n,a=D.cloneElement(e,{role:"presentation",className:"chakra-select__icon",focusable:!1,"aria-hidden":!0,style:{width:"1em",height:"1em",color:"currentColor"}});return C.jsx(RMe,{...i,className:"chakra-select__icon-wrapper",children:D.isValidElement(e)?a:null})};kne.displayName="SelectIcon";function G2(n){const{orientation:e,vertical:i,horizontal:a}=n;return e==="vertical"?i:a}function CMe(n){const{orientation:e,thumbPercents:i,isReversed:a}=n,l=V=>({position:"absolute",userSelect:"none",WebkitUserSelect:"none",MozUserSelect:"none",msUserSelect:"none",touchAction:"none",...G2({orientation:e,vertical:{bottom:`calc(${i[V]}% - var(--slider-thumb-size) / 2)`},horizontal:{left:`calc(${i[V]}% - var(--slider-thumb-size) / 2)`}})}),d={position:"relative",touchAction:"none",WebkitTapHighlightColor:"rgba(0,0,0,0)",userSelect:"none",outline:0},p={position:"absolute",...G2({orientation:e,vertical:{left:"50%",transform:"translateX(-50%)",height:"100%"},horizontal:{top:"50%",transform:"translateY(-50%)",width:"100%"}})},y=i.length===1,v=[0,a?100-i[0]:i[0]],b=y?v:i;let w=b[0];!y&&a&&(w=100-w);const A=Math.abs(b[b.length-1]-b[0]),N={...p,...G2({orientation:e,vertical:a?{height:`${A}%`,top:`${w}%`}:{height:`${A}%`,bottom:`${w}%`},horizontal:a?{width:`${A}%`,right:`${w}%`}:{width:`${A}%`,left:`${w}%`}})};return{trackStyle:p,innerTrackStyle:N,rootStyle:d,getThumbStyle:l}}function IMe(n){const{isReversed:e,direction:i,orientation:a}=n;return i==="ltr"||a==="vertical"?e:!e}function AMe(n){const{min:e=0,max:i=100,onChange:a,value:l,defaultValue:d,isReversed:p,direction:y="ltr",orientation:v="horizontal",id:b,isDisabled:w,isReadOnly:A,onChangeStart:N,onChangeEnd:V,step:j=1,getAriaValueText:B,"aria-valuetext":G,"aria-label":ee,"aria-labelledby":K,name:ne,focusThumbOnChange:ce=!0,...oe}=n,ge=Jc(N),te=Jc(V),Z=Jc(B),J=IMe({isReversed:p,direction:y,orientation:v}),[se,he]=LQ({value:l,defaultValue:d??OMe(e,i),onChange:a}),[fe,ue]=D.useState(!1),[Me,He]=D.useState(!1),rt=!(w||A),we=(i-e)/10,Ce=j||(i-e)/100,ve=KM(se,e,i),Ne=i-ve+e,be=Q$(J?Ne:ve,e,i),Ae=v==="vertical",Ue=UQ({min:e,max:i,step:j,isDisabled:w,value:ve,isInteractive:rt,isReversed:J,isVertical:Ae,eventSource:null,focusThumbOnChange:ce,orientation:v}),ze=D.useRef(null),et=D.useRef(null),nt=D.useRef(null),dt=D.useId(),Xe=b??dt,[It,hn]=[`slider-thumb-${Xe}`,`slider-track-${Xe}`],Ut=D.useCallback(Vt=>{var ho;if(!ze.current)return;const sn=Ue.current;sn.eventSource="pointer";const ki=ze.current.getBoundingClientRect(),{clientX:_i,clientY:Ri}=((ho=Vt.touches)==null?void 0:ho[0])??Vt,dr=Ae?ki.bottom-Ri:_i-ki.left,Wa=Ae?ki.height:ki.width;let il=dr/Wa;J&&(il=1-il);let uo=Wye(il,sn.min,sn.max);return sn.step&&(uo=parseFloat(Z$(uo,sn.min,sn.step))),uo=KM(uo,sn.min,sn.max),uo},[Ae,J,Ue]),ln=D.useCallback(Vt=>{const sn=Ue.current;sn.isInteractive&&(Vt=parseFloat(Z$(Vt,sn.min,Ce)),Vt=KM(Vt,sn.min,sn.max),he(Vt))},[Ce,he,Ue]),xn=D.useMemo(()=>({stepUp(Vt=Ce){const sn=J?ve-Vt:ve+Vt;ln(sn)},stepDown(Vt=Ce){const sn=J?ve+Vt:ve-Vt;ln(sn)},reset(){ln(d||0)},stepTo(Vt){ln(Vt)}}),[ln,J,ve,Ce,d]),Xt=D.useCallback(Vt=>{const sn=Ue.current,_i={ArrowRight:()=>xn.stepUp(),ArrowUp:()=>xn.stepUp(),ArrowLeft:()=>xn.stepDown(),ArrowDown:()=>xn.stepDown(),PageUp:()=>xn.stepUp(we),PageDown:()=>xn.stepDown(we),Home:()=>ln(sn.min),End:()=>ln(sn.max)}[Vt.key];_i&&(Vt.preventDefault(),Vt.stopPropagation(),_i(Vt),sn.eventSource="keyboard")},[xn,ln,we,Ue]),Yn=(Z==null?void 0:Z(ve))??G,{getThumbStyle:qt,rootStyle:Re,trackStyle:Fe,innerTrackStyle:Ke}=D.useMemo(()=>{const Vt=Ue.current;return CMe({isReversed:J,orientation:Vt.orientation,thumbPercents:[be]})},[J,be,Ue]),Et=D.useCallback(()=>{Ue.current.focusThumbOnChange&&setTimeout(()=>{var sn;return(sn=et.current)==null?void 0:sn.focus()})},[Ue]);Eg(()=>{const Vt=Ue.current;Et(),Vt.eventSource==="keyboard"&&(te==null||te(Vt.value))},[ve,te]);function bt(Vt){const sn=Ut(Vt);sn!=null&&sn!==Ue.current.value&&he(sn)}CEe(nt,{onPanSessionStart(Vt){const sn=Ue.current;sn.isInteractive&&(ue(!0),Et(),bt(Vt),ge==null||ge(sn.value))},onPanSessionEnd(){const Vt=Ue.current;Vt.isInteractive&&(ue(!1),te==null||te(Vt.value))},onPan(Vt){Ue.current.isInteractive&&bt(Vt)}});const Ge=D.useCallback((Vt={},sn=null)=>({...Vt,...oe,ref:rs(sn,nt),tabIndex:-1,"aria-disabled":FS(w),"data-focused":Kn(Me),style:{...Vt.style,...Re}}),[oe,w,Me,Re]),Ot=D.useCallback((Vt={},sn=null)=>({...Vt,ref:rs(sn,ze),id:hn,"data-disabled":Kn(w),style:{...Vt.style,...Fe}}),[w,hn,Fe]),Jt=D.useCallback((Vt={},sn=null)=>({...Vt,ref:sn,style:{...Vt.style,...Ke}}),[Ke]),fn=D.useCallback((Vt={},sn=null)=>({...Vt,ref:rs(sn,et),role:"slider",tabIndex:rt?0:void 0,id:It,"data-active":Kn(fe),"aria-valuetext":Yn,"aria-valuemin":e,"aria-valuemax":i,"aria-valuenow":ve,"aria-orientation":v,"aria-disabled":FS(w),"aria-readonly":FS(A),"aria-label":ee,"aria-labelledby":ee?void 0:K,style:{...Vt.style,...qt(0)},onKeyDown:Qn(Vt.onKeyDown,Xt),onFocus:Qn(Vt.onFocus,()=>He(!0)),onBlur:Qn(Vt.onBlur,()=>He(!1))}),[rt,It,fe,Yn,e,i,ve,v,w,A,ee,K,qt,Xt]),an=D.useCallback((Vt,sn=null)=>{const ki=!(Vt.value<e||Vt.value>i),_i=ve>=Vt.value,Ri=Q$(Vt.value,e,i),dr={position:"absolute",pointerEvents:"none",...PMe({orientation:v,vertical:{bottom:J?`${100-Ri}%`:`${Ri}%`},horizontal:{left:J?`${100-Ri}%`:`${Ri}%`}})};return{...Vt,ref:sn,role:"presentation","aria-hidden":!0,"data-disabled":Kn(w),"data-invalid":Kn(!ki),"data-highlighted":Kn(_i),style:{...Vt.style,...dr}}},[w,J,i,e,v,ve]),ir=D.useCallback((Vt={},sn=null)=>({...Vt,ref:sn,type:"hidden",value:ve,name:ne}),[ne,ve]);return{state:{value:ve,isFocused:Me,isDragging:fe},actions:xn,getRootProps:Ge,getTrackProps:Ot,getInnerTrackProps:Jt,getThumbProps:fn,getMarkerProps:an,getInputProps:ir}}function PMe(n){const{orientation:e,vertical:i,horizontal:a}=n;return e==="vertical"?i:a}function OMe(n,e){return e<n?n:n+(e-n)/2}const[kMe,N1]=Ui({name:"SliderContext",hookName:"useSliderContext",providerName:"<Slider />"}),[NMe,D1]=Ui({name:"SliderStylesContext",hookName:"useSliderStyles",providerName:"<Slider />"}),uV=Bt((n,e)=>{const i={...n,orientation:(n==null?void 0:n.orientation)??"horizontal"},a=lc("Slider",i),l=Fi(i),{direction:d}=D0();l.direction=d;const{getInputProps:p,getRootProps:y,...v}=AMe(l),b=y(),w=p({},e);return C.jsx(kMe,{value:v,children:C.jsx(NMe,{value:a,children:C.jsxs(Nt.div,{...b,className:un("chakra-slider",i.className),__css:a.container,children:[i.children,C.jsx("input",{...w})]})})})});uV.displayName="Slider";const dV=Bt((n,e)=>{const{getThumbProps:i}=N1(),a=D1(),l=i(n,e);return C.jsx(Nt.div,{...l,className:un("chakra-slider__thumb",n.className),__css:a.thumb})});dV.displayName="SliderThumb";const hV=Bt((n,e)=>{const{getTrackProps:i}=N1(),a=D1(),l=i(n,e);return C.jsx(Nt.div,{...l,className:un("chakra-slider__track",n.className),__css:a.track})});hV.displayName="SliderTrack";const fV=Bt((n,e)=>{const{getInnerTrackProps:i}=N1(),a=D1(),l=i(n,e);return C.jsx(Nt.div,{...l,className:un("chakra-slider__filled-track",n.className),__css:a.filledTrack})});fV.displayName="SliderFilledTrack";const DMe=Bt((n,e)=>{const{getMarkerProps:i}=N1(),a=D1(),l=i(n,e);return C.jsx(Nt.div,{...l,className:un("chakra-slider__marker",n.className),__css:a.mark})});DMe.displayName="SliderMark";const Lk=Nt("div",{baseStyle:{flex:1,justifySelf:"stretch",alignSelf:"stretch"}});Lk.displayName="Spacer";const Nne=n=>C.jsx(Nt.div,{className:"chakra-stack__item",...n,__css:{display:"inline-block",flex:"0 0 auto",minWidth:0,...n.__css}});Nne.displayName="StackItem";function LMe(n){const{spacing:e,direction:i}=n,a={column:{my:e,mx:0,borderLeftWidth:0,borderBottomWidth:"1px"},"column-reverse":{my:e,mx:0,borderLeftWidth:0,borderBottomWidth:"1px"},row:{mx:e,my:0,borderLeftWidth:"1px",borderBottomWidth:0},"row-reverse":{mx:e,my:0,borderLeftWidth:"1px",borderBottomWidth:0}};return{"&":d1(i,l=>a[l])}}const Aj=Bt((n,e)=>{const{isInline:i,direction:a,align:l,justify:d,spacing:p="0.5rem",wrap:y,children:v,divider:b,className:w,shouldWrapChildren:A,...N}=n,V=i?"row":a??"column",j=D.useMemo(()=>LMe({spacing:p,direction:V}),[p,V]),B=!!b,G=!A&&!B,ee=D.useMemo(()=>{const ne=eF(v);return G?ne:ne.map((ce,oe)=>{const ge=typeof ce.key<"u"?ce.key:oe,te=oe+1===ne.length,J=A?C.jsx(Nne,{children:ce},ge):ce;if(!B)return J;const se=D.cloneElement(b,{__css:j}),he=te?null:se;return C.jsxs(D.Fragment,{children:[J,he]},ge)})},[b,j,B,G,A,v]),K=un("chakra-stack",w);return C.jsx(Nt.div,{ref:e,display:"flex",alignItems:l,justifyContent:d,flexDirection:V,flexWrap:y,gap:B?void 0:p,className:K,...N,children:ee})});Aj.displayName="Stack";const Oi=Bt((n,e)=>C.jsx(Aj,{align:"center",...n,direction:"row",ref:e}));Oi.displayName="HStack";const ii=Bt((n,e)=>C.jsx(Aj,{align:"center",...n,direction:"column",ref:e}));ii.displayName="VStack";const dg=Bt(function(e,i){const a=lc("Switch",e),{spacing:l="0.5rem",children:d,...p}=Fi(e),{getIndicatorProps:y,getInputProps:v,getCheckboxProps:b,getRootProps:w,getLabelProps:A}=G1e(p),N=D.useMemo(()=>({display:"inline-block",position:"relative",verticalAlign:"middle",lineHeight:0,...a.container}),[a.container]),V=D.useMemo(()=>({display:"inline-flex",flexShrink:0,justifyContent:"flex-start",boxSizing:"content-box",cursor:"pointer",...a.track}),[a.track]),j=D.useMemo(()=>({userSelect:"none",marginStart:l,...a.label}),[l,a.label]);return C.jsxs(Nt.label,{...w(),className:un("chakra-switch",e.className),__css:N,children:[C.jsx("input",{className:"chakra-switch__input",...v({},i)}),C.jsx(Nt.span,{...b(),className:"chakra-switch__track",__css:V,children:C.jsx(Nt.span,{__css:a.thumb,className:"chakra-switch__thumb",...y()})}),d&&C.jsx(Nt.span,{className:"chakra-switch__label",...A(),__css:j,children:d})]})});dg.displayName="Switch";const[xMe,MMe,UMe,VMe]=ote();function FMe(n){const{defaultIndex:e,onChange:i,index:a,isManual:l,isLazy:d,lazyBehavior:p="unmount",orientation:y="horizontal",direction:v="ltr",...b}=n,[w,A]=D.useState(e??0),[N,V]=LQ({defaultValue:e??0,value:a,onChange:i});D.useEffect(()=>{a!=null&&A(a)},[a]);const j=UMe(),B=D.useId();return{id:`tabs-${n.id??B}`,selectedIndex:N,focusedIndex:w,setSelectedIndex:V,setFocusedIndex:A,isManual:l,isLazy:d,lazyBehavior:p,orientation:y,descendants:j,direction:v,htmlProps:b}}const[jMe,L1]=Ui({name:"TabsContext",errorMessage:"useTabsContext: `context` is undefined. Seems you forgot to wrap all tabs components within <Tabs />"});function BMe(n){const{focusedIndex:e,orientation:i,direction:a}=L1(),l=MMe(),d=D.useCallback(p=>{const y=()=>{var ne;const K=l.nextEnabled(e);K&&((ne=K.node)==null||ne.focus())},v=()=>{var ne;const K=l.prevEnabled(e);K&&((ne=K.node)==null||ne.focus())},b=()=>{var ne;const K=l.firstEnabled();K&&((ne=K.node)==null||ne.focus())},w=()=>{var ne;const K=l.lastEnabled();K&&((ne=K.node)==null||ne.focus())},A=i==="horizontal",N=i==="vertical",V=p.key,j=a==="ltr"?"ArrowLeft":"ArrowRight",B=a==="ltr"?"ArrowRight":"ArrowLeft",ee={[j]:()=>A&&v(),[B]:()=>A&&y(),ArrowDown:()=>N&&y(),ArrowUp:()=>N&&v(),Home:b,End:w}[V];ee&&(p.preventDefault(),ee(p))},[l,e,i,a]);return{...n,role:"tablist","aria-orientation":i,onKeyDown:Qn(n.onKeyDown,d)}}function WMe(n){const{isDisabled:e=!1,isFocusable:i=!1,...a}=n,{setSelectedIndex:l,isManual:d,id:p,setFocusedIndex:y,selectedIndex:v}=L1(),{index:b,register:w}=VMe({disabled:e&&!i}),A=b===v,N=()=>{l(b)},V=()=>{y(b),!d&&!(e&&i)&&l(b)};return{...one({...a,ref:rs(w,n.ref),isDisabled:e,isFocusable:i,onClick:Qn(n.onClick,N)}),id:Dne(p,b),role:"tab",tabIndex:A?0:-1,type:"button","aria-selected":A,"aria-controls":Lne(p,b),onFocus:e?void 0:Qn(n.onFocus,V)}}const[zMe,GMe]=Ui({});function HMe(n){const e=L1(),{id:i,selectedIndex:a}=e,d=eF(n.children).map((p,y)=>D.createElement(zMe,{key:p.key??y,value:{isSelected:y===a,id:Lne(i,y),tabId:Dne(i,y),selectedIndex:a}},p));return{...n,children:d}}function $Me(n){const{children:e,...i}=n,{isLazy:a,lazyBehavior:l}=L1(),{isSelected:d,id:p,tabId:y}=GMe(),v=D.useRef(!1);d&&(v.current=!0);const b=tF({wasSelected:v.current,isSelected:d,enabled:a,mode:l});return{tabIndex:0,...i,children:b?e:null,role:"tabpanel","aria-labelledby":y,hidden:!d,id:p}}function Dne(n,e){return`${n}--tab-${e}`}function Lne(n,e){return`${n}--tabpanel-${e}`}const[KMe,x1]=Ui({name:"TabsStylesContext",errorMessage:`useTabsStyles returned is 'undefined'. Seems you forgot to wrap the components in "<Tabs />" `}),oC=Bt(function(e,i){const a=lc("Tabs",e),{children:l,className:d,...p}=Fi(e),{htmlProps:y,descendants:v,...b}=FMe(p),w=D.useMemo(()=>b,[b]),{isFitted:A,...N}=y,V={position:"relative",...a.root};return C.jsx(xMe,{value:v,children:C.jsx(jMe,{value:w,children:C.jsx(KMe,{value:a,children:C.jsx(Nt.div,{className:un("chakra-tabs",d),ref:i,...N,__css:V,children:l})})})})});oC.displayName="Tabs";const qc=Bt(function(e,i){const a=x1(),l=WMe({...e,ref:i}),d={outline:"0",display:"flex",alignItems:"center",justifyContent:"center",...a.tab};return C.jsx(Nt.button,{...l,className:un("chakra-tabs__tab",e.className),__css:d})});qc.displayName="Tab";const aC=Bt(function(e,i){const a=BMe({...e,ref:i}),l=x1(),d={display:"flex",...l.tablist};return C.jsx(Nt.div,{...a,className:un("chakra-tabs__tablist",e.className),__css:d})});aC.displayName="TabList";const Cu=Bt(function(e,i){const a=$Me({...e,ref:i}),l=x1();return C.jsx(Nt.div,{outline:"0",...a,className:un("chakra-tabs__tab-panel",e.className),__css:l.tabpanel})});Cu.displayName="TabPanel";const M1=Bt(function(e,i){const a=HMe(e),l=x1();return C.jsx(Nt.div,{...a,width:"100%",ref:i,className:un("chakra-tabs__tab-panels",e.className),__css:l.tabpanels})});M1.displayName="TabPanels";const[qMe,xne]=Ui({name:"TagStylesContext",errorMessage:`useTagStyles returned is 'undefined'. Seems you forgot to wrap the components in "<Tag />" `}),Mne=Bt((n,e)=>{const i=lc("Tag",n),a=Fi(n),l={display:"inline-flex",verticalAlign:"top",alignItems:"center",maxWidth:"100%",...i.container};return C.jsx(qMe,{value:i,children:C.jsx(Nt.span,{ref:e,...a,__css:l})})});Mne.displayName="Tag";const Une=Bt((n,e)=>{const i=xne();return C.jsx(Nt.span,{ref:e,noOfLines:1,...n,__css:i.label})});Une.displayName="TagLabel";const YMe=Bt((n,e)=>C.jsx(Dn,{ref:e,verticalAlign:"top",marginEnd:"0.5rem",...n}));YMe.displayName="TagLeftIcon";const XMe=Bt((n,e)=>C.jsx(Dn,{ref:e,verticalAlign:"top",marginStart:"0.5rem",...n}));XMe.displayName="TagRightIcon";const Vne=n=>C.jsx(Dn,{verticalAlign:"inherit",viewBox:"0 0 512 512",...n,children:C.jsx("path",{fill:"currentColor",d:"M289.94 256l95-95A24 24 0 00351 127l-95 95-95-95a24 24 0 00-34 34l95 95-95 95a24 24 0 1034 34l95-95 95 95a24 24 0 0034-34z"})});Vne.displayName="TagCloseIcon";const Fne=Bt((n,e)=>{const{isDisabled:i,children:a,...l}=n,p={display:"flex",alignItems:"center",justifyContent:"center",outline:"0",...xne().closeButton};return C.jsx(Nt.button,{ref:e,"aria-label":"close",...l,type:"button",disabled:i,__css:p,children:a||C.jsx(Vne,{})})});Fne.displayName="TagCloseButton";const JMe=["h","minH","height","minHeight"],jne=Bt((n,e)=>{const i=Ul("Textarea",n),{className:a,rows:l,...d}=Fi(n),p=oj(d),y=l?A0(i,JMe):i;return C.jsx(Nt.textarea,{ref:e,rows:l,...p,className:un("chakra-textarea",a),__css:y})});jne.displayName="Textarea";function QMe(n,e){const i=n??"bottom",l={"top-start":{ltr:"top-left",rtl:"top-right"},"top-end":{ltr:"top-right",rtl:"top-left"},"bottom-start":{ltr:"bottom-left",rtl:"bottom-right"},"bottom-end":{ltr:"bottom-right",rtl:"bottom-left"}}[i];return(l==null?void 0:l[e])??i}function ZMe(n,e){const i=l=>({...e,...l,position:QMe((l==null?void 0:l.position)??(e==null?void 0:e.position),n)}),a=l=>{const d=i(l),p=rte(d);return jh.notify(p,d)};return a.update=(l,d)=>{jh.update(l,i(d))},a.promise=(l,d)=>{const p=a({...d.loading,status:"loading",duration:null});l.then(y=>a.update(p,{status:"success",duration:5e3,...Xc(d.success,y)})).catch(y=>a.update(p,{status:"error",duration:5e3,...Xc(d.error,y)}))},a.closeAll=jh.closeAll,a.close=jh.close,a.isActive=jh.isActive,a}function xu(n){const{theme:e}=ete(),i=g1e();return D.useMemo(()=>ZMe(e.direction,{...i,...n}),[n,e.direction,i])}const e2e={exit:{scale:.85,opacity:0,transition:{opacity:{duration:.15,easings:"easeInOut"},scale:{duration:.2,easings:"easeInOut"}}},enter:{scale:1,opacity:1,transition:{opacity:{easings:"easeOut",duration:.2},scale:{duration:.2,ease:[.175,.885,.4,1.1]}}}},pV=n=>{var e;return((e=n.current)==null?void 0:e.ownerDocument)||document},sk=n=>{var e,i;return((i=(e=n.current)==null?void 0:e.ownerDocument)==null?void 0:i.defaultView)||window};function t2e(n={}){const{openDelay:e=0,closeDelay:i=0,closeOnClick:a=!0,closeOnMouseDown:l,closeOnScroll:d,closeOnPointerDown:p=l,closeOnEsc:y=!0,onOpen:v,onClose:b,placement:w,id:A,isOpen:N,defaultIsOpen:V,arrowSize:j=10,arrowShadowColor:B,arrowPadding:G,modifiers:ee,isDisabled:K,gutter:ne,offset:ce,direction:oe,...ge}=n,{isOpen:te,onOpen:Z,onClose:J}=rf({isOpen:N,defaultIsOpen:V,onOpen:v,onClose:b}),{referenceRef:se,getPopperProps:he,getArrowInnerProps:fe,getArrowProps:ue}=Ij({enabled:te,placement:w,arrowPadding:G,modifiers:ee,gutter:ne,offset:ce,direction:oe}),Me=D.useId(),rt=`tooltip-${A??Me}`,we=D.useRef(null),Ce=D.useRef(void 0),ve=D.useCallback(()=>{Ce.current&&(clearTimeout(Ce.current),Ce.current=void 0)},[]),Ne=D.useRef(void 0),Te=D.useCallback(()=>{Ne.current&&(clearTimeout(Ne.current),Ne.current=void 0)},[]),be=D.useCallback(()=>{Te(),J()},[J,Te]),Ae=n2e(we,be),Ue=D.useCallback(()=>{if(!K&&!Ce.current){te&&Ae();const Ut=sk(we);Ce.current=Ut.setTimeout(Z,e)}},[Ae,K,te,Z,e]),ze=D.useCallback(()=>{ve();const Ut=sk(we);Ne.current=Ut.setTimeout(be,i)},[i,be,ve]),et=D.useCallback(()=>{te&&a&&ze()},[a,ze,te]),nt=D.useCallback(()=>{te&&p&&ze()},[p,ze,te]),dt=D.useCallback(Ut=>{te&&Ut.key==="Escape"&&ze()},[te,ze]);jS(()=>pV(we),"keydown",y?dt:void 0),jS(()=>{if(!d)return null;const Ut=we.current;if(!Ut)return null;const ln=NQ(Ut);return ln.localName==="body"?sk(we):ln},"scroll",()=>{te&&d&&be()},{passive:!0,capture:!0}),D.useEffect(()=>{K&&(ve(),te&&J())},[K,te,J,ve]),D.useEffect(()=>()=>{ve(),Te()},[ve,Te]),jS(()=>we.current,"pointerleave",ze);const Xe=D.useCallback((Ut={},ln=null)=>({...Ut,ref:rs(we,ln,se),onPointerEnter:Qn(Ut.onPointerEnter,Xt=>{Xt.pointerType!=="touch"&&Ue()}),onClick:Qn(Ut.onClick,et),onPointerDown:Qn(Ut.onPointerDown,nt),onFocus:Qn(Ut.onFocus,Ue),onBlur:Qn(Ut.onBlur,ze),"aria-describedby":te?rt:void 0}),[Ue,ze,nt,te,rt,et,se]),It=D.useCallback((Ut={},ln=null)=>he({...Ut,style:{...Ut.style,[qs.arrowSize.var]:j?`${j}px`:void 0,[qs.arrowShadowColor.var]:B}},ln),[he,j,B]),hn=D.useCallback((Ut={},ln=null)=>{const xn={...Ut.style,position:"relative",transformOrigin:qs.transformOrigin.varRef};return{ref:ln,...ge,...Ut,id:rt,role:"tooltip",style:xn}},[ge,rt]);return{isOpen:te,show:Ue,hide:ze,getTriggerProps:Xe,getTooltipProps:hn,getTooltipPositionerProps:It,getArrowProps:ue,getArrowInnerProps:fe}}const H2="chakra-ui:close-tooltip";function n2e(n,e){return D.useEffect(()=>{const i=pV(n);return i.addEventListener(H2,e),()=>i.removeEventListener(H2,e)},[e,n]),()=>{const i=pV(n),a=sk(n);i.dispatchEvent(new a.CustomEvent(H2))}}const r2e=Nt(cf.div),hg=Bt((n,e)=>{const i=Ul("Tooltip",n),a=Fi(n),l=D0(),{children:d,label:p,shouldWrapChildren:y,"aria-label":v,hasArrow:b,bg:w,portalProps:A,background:N,backgroundColor:V,bgColor:j,motionProps:B,animatePresenceProps:G,...ee}=a,K=N??V??w??j;if(K){i.bg=K;const se=gve(l,"colors",K);i[qs.arrowBg.var]=se}const ne=t2e({...ee,direction:l.direction}),ce=!D.isValidElement(d)||y;let oe;if(ce)oe=C.jsx(Nt.span,{display:"inline-block",tabIndex:0,...ne.getTriggerProps(),children:d});else{const se=D.Children.only(d);oe=D.cloneElement(se,ne.getTriggerProps(se.props,wne(se)))}const ge=!!v,te=ne.getTooltipProps({},e),Z=ge?A0(te,["role","id"]):te,J=kQ(te,["role","id"]);return p?C.jsxs(C.Fragment,{children:[oe,C.jsx(O0,{...G,children:ne.isOpen&&C.jsx(Vl,{...A,children:C.jsx(Nt.div,{...ne.getTooltipPositionerProps(),__css:{zIndex:i.zIndex,pointerEvents:"none"},children:C.jsxs(r2e,{variants:e2e,initial:"exit",animate:"enter",exit:"exit",...B,...Z,__css:i,children:[p,ge&&C.jsx(Nt.span,{srOnly:!0,...J,children:v}),b&&C.jsx(Nt.div,{"data-popper-arrow":!0,className:"chakra-tooltip__arrow-wrapper",children:C.jsx(Nt.div,{"data-popper-arrow-inner":!0,className:"chakra-tooltip__arrow",__css:{bg:i.bg}})})]})})})})]}):C.jsx(C.Fragment,{children:d})});hg.displayName="Tooltip";const xk=Bt(function(e,i){const a=Ul("Heading",e),{className:l,...d}=Fi(e);return C.jsx(Nt.h2,{ref:i,className:un("chakra-heading",e.className),...d,__css:a})});xk.displayName="Heading";const ht=Bt(function(e,i){const a=Ul("Text",e),{className:l,align:d,decoration:p,casing:y,...v}=Fi(e),b=u1({textAlign:e.align,textDecoration:e.decoration,textTransform:e.casing});return C.jsx(Nt.p,{ref:i,className:un("chakra-text",e.className),...b,...v,__css:a})});ht.displayName="Text";const Bne=Bt(function(e,i){const{spacing:a="0.5rem",spacingX:l,spacingY:d,children:p,justify:y,direction:v,align:b,className:w,shouldWrapChildren:A,...N}=e,V=D.useMemo(()=>A?D.Children.map(p,(j,B)=>C.jsx(Pj,{children:j},B)):p,[p,A]);return C.jsx(Nt.div,{ref:i,className:un("chakra-wrap",w),...N,children:C.jsx(Nt.ul,{className:"chakra-wrap__list",__css:{display:"flex",flexWrap:"wrap",justifyContent:y,alignItems:b,flexDirection:v,listStyleType:"none",gap:a,columnGap:l,rowGap:d,padding:"0"},children:V})})});Bne.displayName="Wrap";const Pj=Bt(function(e,i){const{className:a,...l}=e;return C.jsx(Nt.li,{ref:i,__css:{display:"flex",alignItems:"flex-start"},className:un("chakra-wrap__listitem",a),...l})});Pj.displayName="WrapItem";const i2e="modulepreload",s2e=function(n,e){return new URL(n,e).href},BY={},$2=function(e,i,a){let l=Promise.resolve();if(i&&i.length>0){const p=document.getElementsByTagName("link"),y=document.querySelector("meta[property=csp-nonce]"),v=(y==null?void 0:y.nonce)||(y==null?void 0:y.getAttribute("nonce"));l=Promise.allSettled(i.map(b=>{if(b=s2e(b,a),b in BY)return;BY[b]=!0;const w=b.endsWith(".css"),A=w?'[rel="stylesheet"]':"";if(!!a)for(let j=p.length-1;j>=0;j--){const B=p[j];if(B.href===b&&(!w||B.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${b}"]${A}`))return;const V=document.createElement("link");if(V.rel=w?"stylesheet":i2e,w||(V.as="script"),V.crossOrigin="",V.href=b,v&&V.setAttribute("nonce",v),document.head.appendChild(V),w)return new Promise((j,B)=>{V.addEventListener("load",j),V.addEventListener("error",()=>B(new Error(`Unable to preload CSS for ${b}`)))})}))}function d(p){const y=new Event("vite:preloadError",{cancelable:!0});if(y.payload=p,window.dispatchEvent(y),!y.defaultPrevented)throw p}return l.then(p=>{for(const y of p||[])y.status==="rejected"&&d(y.reason);return e().catch(d)})},CO=()=>{const n=new Date,e=n.getHours().toString().padStart(2,"0"),i=n.getMinutes().toString().padStart(2,"0"),a=n.getSeconds().toString().padStart(2,"0"),l=n.getMilliseconds().toString().padStart(3,"0");return`${e}:${i}:${a}.${l}`},_e={log:(...n)=>{{const e=n.map((i,a)=>a===0&&typeof i=="string"?`
${i}`:i);console.log(`[LOG] [${CO()}] `,...e)}},error:(...n)=>{{const e=n.map((i,a)=>a===0&&typeof i=="string"?`
${i}`:i);console.error(`[ERROR] [${CO()}] `,...e)}},warn:(...n)=>{{const e=n.map((i,a)=>a===0&&typeof i=="string"?`
${i}`:i);console.warn(`[WARN] [${CO()}]`,...e)}},trace:n=>{console.trace(`[TRACE] [${CO()}] ${n}`)}};async function OR(n){let e;try{switch(n){case"default":e=await $2(()=>import("./index.v0.1.5.js"),[],import.meta.url);break;default:e=await $2(()=>import("./index.v0.1.5.js"),[],import.meta.url)}return e.default}catch(i){return _e.error("Failed to load theme:",i),e=await $2(()=>import("./index.v0.1.5.js"),[],import.meta.url),e.default}}const o2e=()=>{};var WY={};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Wne=function(n){const e=[];let i=0;for(let a=0;a<n.length;a++){let l=n.charCodeAt(a);l<128?e[i++]=l:l<2048?(e[i++]=l>>6|192,e[i++]=l&63|128):(l&64512)===55296&&a+1<n.length&&(n.charCodeAt(a+1)&64512)===56320?(l=65536+((l&1023)<<10)+(n.charCodeAt(++a)&1023),e[i++]=l>>18|240,e[i++]=l>>12&63|128,e[i++]=l>>6&63|128,e[i++]=l&63|128):(e[i++]=l>>12|224,e[i++]=l>>6&63|128,e[i++]=l&63|128)}return e},a2e=function(n){const e=[];let i=0,a=0;for(;i<n.length;){const l=n[i++];if(l<128)e[a++]=String.fromCharCode(l);else if(l>191&&l<224){const d=n[i++];e[a++]=String.fromCharCode((l&31)<<6|d&63)}else if(l>239&&l<365){const d=n[i++],p=n[i++],y=n[i++],v=((l&7)<<18|(d&63)<<12|(p&63)<<6|y&63)-65536;e[a++]=String.fromCharCode(55296+(v>>10)),e[a++]=String.fromCharCode(56320+(v&1023))}else{const d=n[i++],p=n[i++];e[a++]=String.fromCharCode((l&15)<<12|(d&63)<<6|p&63)}}return e.join("")},zne={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:typeof atob=="function",encodeByteArray(n,e){if(!Array.isArray(n))throw Error("encodeByteArray takes an array as a parameter");this.init_();const i=e?this.byteToCharMapWebSafe_:this.byteToCharMap_,a=[];for(let l=0;l<n.length;l+=3){const d=n[l],p=l+1<n.length,y=p?n[l+1]:0,v=l+2<n.length,b=v?n[l+2]:0,w=d>>2,A=(d&3)<<4|y>>4;let N=(y&15)<<2|b>>6,V=b&63;v||(V=64,p||(N=64)),a.push(i[w],i[A],i[N],i[V])}return a.join("")},encodeString(n,e){return this.HAS_NATIVE_SUPPORT&&!e?btoa(n):this.encodeByteArray(Wne(n),e)},decodeString(n,e){return this.HAS_NATIVE_SUPPORT&&!e?atob(n):a2e(this.decodeStringToByteArray(n,e))},decodeStringToByteArray(n,e){this.init_();const i=e?this.charToByteMapWebSafe_:this.charToByteMap_,a=[];for(let l=0;l<n.length;){const d=i[n.charAt(l++)],y=l<n.length?i[n.charAt(l)]:0;++l;const b=l<n.length?i[n.charAt(l)]:64;++l;const A=l<n.length?i[n.charAt(l)]:64;if(++l,d==null||y==null||b==null||A==null)throw new c2e;const N=d<<2|y>>4;if(a.push(N),b!==64){const V=y<<4&240|b>>2;if(a.push(V),A!==64){const j=b<<6&192|A;a.push(j)}}}return a},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let n=0;n<this.ENCODED_VALS.length;n++)this.byteToCharMap_[n]=this.ENCODED_VALS.charAt(n),this.charToByteMap_[this.byteToCharMap_[n]]=n,this.byteToCharMapWebSafe_[n]=this.ENCODED_VALS_WEBSAFE.charAt(n),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[n]]=n,n>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(n)]=n,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(n)]=n)}}};class c2e extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}const l2e=function(n){const e=Wne(n);return zne.encodeByteArray(e,!0)},Mk=function(n){return l2e(n).replace(/\./g,"")},Gne=function(n){try{return zne.decodeString(n,!0)}catch(e){console.error("base64Decode failed: ",e)}return null};/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function u2e(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("Unable to locate global object.")}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const d2e=()=>u2e().__FIREBASE_DEFAULTS__,h2e=()=>{if(typeof process>"u"||typeof WY>"u")return;const n=WY.__FIREBASE_DEFAULTS__;if(n)return JSON.parse(n)},f2e=()=>{if(typeof document>"u")return;let n;try{n=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch{return}const e=n&&Gne(n[1]);return e&&JSON.parse(e)},U1=()=>{try{return o2e()||d2e()||h2e()||f2e()}catch(n){console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${n}`);return}},Hne=n=>{var e,i;return(i=(e=U1())===null||e===void 0?void 0:e.emulatorHosts)===null||i===void 0?void 0:i[n]},$ne=n=>{const e=Hne(n);if(!e)return;const i=e.lastIndexOf(":");if(i<=0||i+1===e.length)throw new Error(`Invalid host ${e} with no separate hostname and port!`);const a=parseInt(e.substring(i+1),10);return e[0]==="["?[e.substring(1,i-1),a]:[e.substring(0,i),a]},Kne=()=>{var n;return(n=U1())===null||n===void 0?void 0:n.config},qne=n=>{var e;return(e=U1())===null||e===void 0?void 0:e[`_${n}`]};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class p2e{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((e,i)=>{this.resolve=e,this.reject=i})}wrapCallback(e){return(i,a)=>{i?this.reject(i):this.resolve(a),typeof e=="function"&&(this.promise.catch(()=>{}),e.length===1?e(i):e(i,a))}}}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Yne(n,e){if(n.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');const i={alg:"none",type:"JWT"},a=e||"demo-project",l=n.iat||0,d=n.sub||n.user_id;if(!d)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");const p=Object.assign({iss:`https://securetoken.google.com/${a}`,aud:a,iat:l,exp:l+3600,auth_time:l,sub:d,user_id:d,firebase:{sign_in_provider:"custom",identities:{}}},n);return[Mk(JSON.stringify(i)),Mk(JSON.stringify(p)),""].join(".")}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ba(){return typeof navigator<"u"&&typeof navigator.userAgent=="string"?navigator.userAgent:""}function m2e(){return typeof window<"u"&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(Ba())}function g2e(){var n;const e=(n=U1())===null||n===void 0?void 0:n.forceEnvironment;if(e==="node")return!0;if(e==="browser")return!1;try{return Object.prototype.toString.call(global.process)==="[object process]"}catch{return!1}}function _2e(){return typeof navigator<"u"&&navigator.userAgent==="Cloudflare-Workers"}function y2e(){const n=typeof chrome=="object"?chrome.runtime:typeof browser=="object"?browser.runtime:void 0;return typeof n=="object"&&n.id!==void 0}function E2e(){return typeof navigator=="object"&&navigator.product==="ReactNative"}function v2e(){const n=Ba();return n.indexOf("MSIE ")>=0||n.indexOf("Trident/")>=0}function S2e(){return!g2e()&&!!navigator.userAgent&&navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome")}function b2e(){try{return typeof indexedDB=="object"}catch{return!1}}function T2e(){return new Promise((n,e)=>{try{let i=!0;const a="validate-browser-context-for-indexeddb-analytics-module",l=self.indexedDB.open(a);l.onsuccess=()=>{l.result.close(),i||self.indexedDB.deleteDatabase(a),n(!0)},l.onupgradeneeded=()=>{i=!1},l.onerror=()=>{var d;e(((d=l.error)===null||d===void 0?void 0:d.message)||"")}}catch(i){e(i)}})}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const w2e="FirebaseError";class df extends Error{constructor(e,i,a){super(i),this.code=e,this.customData=a,this.name=w2e,Object.setPrototypeOf(this,df.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,cC.prototype.create)}}class cC{constructor(e,i,a){this.service=e,this.serviceName=i,this.errors=a}create(e,...i){const a=i[0]||{},l=`${this.service}/${e}`,d=this.errors[e],p=d?R2e(d,a):"Error",y=`${this.serviceName}: ${p} (${l}).`;return new df(l,y,a)}}function R2e(n,e){return n.replace(C2e,(i,a)=>{const l=e[a];return l!=null?String(l):`<${a}?>`})}const C2e=/\{\$([^}]+)}/g;function I2e(n){for(const e in n)if(Object.prototype.hasOwnProperty.call(n,e))return!1;return!0}function Np(n,e){if(n===e)return!0;const i=Object.keys(n),a=Object.keys(e);for(const l of i){if(!a.includes(l))return!1;const d=n[l],p=e[l];if(zY(d)&&zY(p)){if(!Np(d,p))return!1}else if(d!==p)return!1}for(const l of a)if(!i.includes(l))return!1;return!0}function zY(n){return n!==null&&typeof n=="object"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function lC(n){const e=[];for(const[i,a]of Object.entries(n))Array.isArray(a)?a.forEach(l=>{e.push(encodeURIComponent(i)+"="+encodeURIComponent(l))}):e.push(encodeURIComponent(i)+"="+encodeURIComponent(a));return e.length?"&"+e.join("&"):""}function Uw(n){const e={};return n.replace(/^\?/,"").split("&").forEach(a=>{if(a){const[l,d]=a.split("=");e[decodeURIComponent(l)]=decodeURIComponent(d)}}),e}function Vw(n){const e=n.indexOf("?");if(!e)return"";const i=n.indexOf("#",e);return n.substring(e,i>0?i:void 0)}function A2e(n,e){const i=new P2e(n,e);return i.subscribe.bind(i)}class P2e{constructor(e,i){this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=i,this.task.then(()=>{e(this)}).catch(a=>{this.error(a)})}next(e){this.forEachObserver(i=>{i.next(e)})}error(e){this.forEachObserver(i=>{i.error(e)}),this.close(e)}complete(){this.forEachObserver(e=>{e.complete()}),this.close()}subscribe(e,i,a){let l;if(e===void 0&&i===void 0&&a===void 0)throw new Error("Missing Observer.");O2e(e,["next","error","complete"])?l=e:l={next:e,error:i,complete:a},l.next===void 0&&(l.next=K2),l.error===void 0&&(l.error=K2),l.complete===void 0&&(l.complete=K2);const d=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then(()=>{try{this.finalError?l.error(this.finalError):l.complete()}catch{}}),this.observers.push(l),d}unsubscribeOne(e){this.observers===void 0||this.observers[e]===void 0||(delete this.observers[e],this.observerCount-=1,this.observerCount===0&&this.onNoObservers!==void 0&&this.onNoObservers(this))}forEachObserver(e){if(!this.finalized)for(let i=0;i<this.observers.length;i++)this.sendOne(i,e)}sendOne(e,i){this.task.then(()=>{if(this.observers!==void 0&&this.observers[e]!==void 0)try{i(this.observers[e])}catch(a){typeof console<"u"&&console.error&&console.error(a)}})}close(e){this.finalized||(this.finalized=!0,e!==void 0&&(this.finalError=e),this.task.then(()=>{this.observers=void 0,this.onNoObservers=void 0}))}}function O2e(n,e){if(typeof n!="object"||n===null)return!1;for(const i of e)if(i in n&&typeof n[i]=="function")return!0;return!1}function K2(){}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function xi(n){return n&&n._delegate?n._delegate:n}class Tg{constructor(e,i,a){this.name=e,this.instanceFactory=i,this.type=a,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(e){return this.instantiationMode=e,this}setMultipleInstances(e){return this.multipleInstances=e,this}setServiceProps(e){return this.serviceProps=e,this}setInstanceCreatedCallback(e){return this.onInstanceCreated=e,this}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const uy="[DEFAULT]";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class k2e{constructor(e,i){this.name=e,this.container=i,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(e){const i=this.normalizeInstanceIdentifier(e);if(!this.instancesDeferred.has(i)){const a=new p2e;if(this.instancesDeferred.set(i,a),this.isInitialized(i)||this.shouldAutoInitialize())try{const l=this.getOrInitializeService({instanceIdentifier:i});l&&a.resolve(l)}catch{}}return this.instancesDeferred.get(i).promise}getImmediate(e){var i;const a=this.normalizeInstanceIdentifier(e==null?void 0:e.identifier),l=(i=e==null?void 0:e.optional)!==null&&i!==void 0?i:!1;if(this.isInitialized(a)||this.shouldAutoInitialize())try{return this.getOrInitializeService({instanceIdentifier:a})}catch(d){if(l)return null;throw d}else{if(l)return null;throw Error(`Service ${this.name} is not available`)}}getComponent(){return this.component}setComponent(e){if(e.name!==this.name)throw Error(`Mismatching Component ${e.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=e,!!this.shouldAutoInitialize()){if(D2e(e))try{this.getOrInitializeService({instanceIdentifier:uy})}catch{}for(const[i,a]of this.instancesDeferred.entries()){const l=this.normalizeInstanceIdentifier(i);try{const d=this.getOrInitializeService({instanceIdentifier:l});a.resolve(d)}catch{}}}}clearInstance(e=uy){this.instancesDeferred.delete(e),this.instancesOptions.delete(e),this.instances.delete(e)}async delete(){const e=Array.from(this.instances.values());await Promise.all([...e.filter(i=>"INTERNAL"in i).map(i=>i.INTERNAL.delete()),...e.filter(i=>"_delete"in i).map(i=>i._delete())])}isComponentSet(){return this.component!=null}isInitialized(e=uy){return this.instances.has(e)}getOptions(e=uy){return this.instancesOptions.get(e)||{}}initialize(e={}){const{options:i={}}=e,a=this.normalizeInstanceIdentifier(e.instanceIdentifier);if(this.isInitialized(a))throw Error(`${this.name}(${a}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);const l=this.getOrInitializeService({instanceIdentifier:a,options:i});for(const[d,p]of this.instancesDeferred.entries()){const y=this.normalizeInstanceIdentifier(d);a===y&&p.resolve(l)}return l}onInit(e,i){var a;const l=this.normalizeInstanceIdentifier(i),d=(a=this.onInitCallbacks.get(l))!==null&&a!==void 0?a:new Set;d.add(e),this.onInitCallbacks.set(l,d);const p=this.instances.get(l);return p&&e(p,l),()=>{d.delete(e)}}invokeOnInitCallbacks(e,i){const a=this.onInitCallbacks.get(i);if(a)for(const l of a)try{l(e,i)}catch{}}getOrInitializeService({instanceIdentifier:e,options:i={}}){let a=this.instances.get(e);if(!a&&this.component&&(a=this.component.instanceFactory(this.container,{instanceIdentifier:N2e(e),options:i}),this.instances.set(e,a),this.instancesOptions.set(e,i),this.invokeOnInitCallbacks(a,e),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,e,a)}catch{}return a||null}normalizeInstanceIdentifier(e=uy){return this.component?this.component.multipleInstances?e:uy:e}shouldAutoInitialize(){return!!this.component&&this.component.instantiationMode!=="EXPLICIT"}}function N2e(n){return n===uy?void 0:n}function D2e(n){return n.instantiationMode==="EAGER"}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class L2e{constructor(e){this.name=e,this.providers=new Map}addComponent(e){const i=this.getProvider(e.name);if(i.isComponentSet())throw new Error(`Component ${e.name} has already been registered with ${this.name}`);i.setComponent(e)}addOrOverwriteComponent(e){this.getProvider(e.name).isComponentSet()&&this.providers.delete(e.name),this.addComponent(e)}getProvider(e){if(this.providers.has(e))return this.providers.get(e);const i=new k2e(e,this);return this.providers.set(e,i),i}getProviders(){return Array.from(this.providers.values())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var br;(function(n){n[n.DEBUG=0]="DEBUG",n[n.VERBOSE=1]="VERBOSE",n[n.INFO=2]="INFO",n[n.WARN=3]="WARN",n[n.ERROR=4]="ERROR",n[n.SILENT=5]="SILENT"})(br||(br={}));const x2e={debug:br.DEBUG,verbose:br.VERBOSE,info:br.INFO,warn:br.WARN,error:br.ERROR,silent:br.SILENT},M2e=br.INFO,U2e={[br.DEBUG]:"log",[br.VERBOSE]:"log",[br.INFO]:"info",[br.WARN]:"warn",[br.ERROR]:"error"},V2e=(n,e,...i)=>{if(e<n.logLevel)return;const a=new Date().toISOString(),l=U2e[e];if(l)console[l](`[${a}]  ${n.name}:`,...i);else throw new Error(`Attempted to log a message with an invalid logType (value: ${e})`)};class Oj{constructor(e){this.name=e,this._logLevel=M2e,this._logHandler=V2e,this._userLogHandler=null}get logLevel(){return this._logLevel}set logLevel(e){if(!(e in br))throw new TypeError(`Invalid value "${e}" assigned to \`logLevel\``);this._logLevel=e}setLogLevel(e){this._logLevel=typeof e=="string"?x2e[e]:e}get logHandler(){return this._logHandler}set logHandler(e){if(typeof e!="function")throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e}get userLogHandler(){return this._userLogHandler}set userLogHandler(e){this._userLogHandler=e}debug(...e){this._userLogHandler&&this._userLogHandler(this,br.DEBUG,...e),this._logHandler(this,br.DEBUG,...e)}log(...e){this._userLogHandler&&this._userLogHandler(this,br.VERBOSE,...e),this._logHandler(this,br.VERBOSE,...e)}info(...e){this._userLogHandler&&this._userLogHandler(this,br.INFO,...e),this._logHandler(this,br.INFO,...e)}warn(...e){this._userLogHandler&&this._userLogHandler(this,br.WARN,...e),this._logHandler(this,br.WARN,...e)}error(...e){this._userLogHandler&&this._userLogHandler(this,br.ERROR,...e),this._logHandler(this,br.ERROR,...e)}}const F2e=(n,e)=>e.some(i=>n instanceof i);let GY,HY;function j2e(){return GY||(GY=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function B2e(){return HY||(HY=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}const Xne=new WeakMap,mV=new WeakMap,Jne=new WeakMap,q2=new WeakMap,kj=new WeakMap;function W2e(n){const e=new Promise((i,a)=>{const l=()=>{n.removeEventListener("success",d),n.removeEventListener("error",p)},d=()=>{i(fg(n.result)),l()},p=()=>{a(n.error),l()};n.addEventListener("success",d),n.addEventListener("error",p)});return e.then(i=>{i instanceof IDBCursor&&Xne.set(i,n)}).catch(()=>{}),kj.set(e,n),e}function z2e(n){if(mV.has(n))return;const e=new Promise((i,a)=>{const l=()=>{n.removeEventListener("complete",d),n.removeEventListener("error",p),n.removeEventListener("abort",p)},d=()=>{i(),l()},p=()=>{a(n.error||new DOMException("AbortError","AbortError")),l()};n.addEventListener("complete",d),n.addEventListener("error",p),n.addEventListener("abort",p)});mV.set(n,e)}let gV={get(n,e,i){if(n instanceof IDBTransaction){if(e==="done")return mV.get(n);if(e==="objectStoreNames")return n.objectStoreNames||Jne.get(n);if(e==="store")return i.objectStoreNames[1]?void 0:i.objectStore(i.objectStoreNames[0])}return fg(n[e])},set(n,e,i){return n[e]=i,!0},has(n,e){return n instanceof IDBTransaction&&(e==="done"||e==="store")?!0:e in n}};function G2e(n){gV=n(gV)}function H2e(n){return n===IDBDatabase.prototype.transaction&&!("objectStoreNames"in IDBTransaction.prototype)?function(e,...i){const a=n.call(Y2(this),e,...i);return Jne.set(a,e.sort?e.sort():[e]),fg(a)}:B2e().includes(n)?function(...e){return n.apply(Y2(this),e),fg(Xne.get(this))}:function(...e){return fg(n.apply(Y2(this),e))}}function $2e(n){return typeof n=="function"?H2e(n):(n instanceof IDBTransaction&&z2e(n),F2e(n,j2e())?new Proxy(n,gV):n)}function fg(n){if(n instanceof IDBRequest)return W2e(n);if(q2.has(n))return q2.get(n);const e=$2e(n);return e!==n&&(q2.set(n,e),kj.set(e,n)),e}const Y2=n=>kj.get(n);function K2e(n,e,{blocked:i,upgrade:a,blocking:l,terminated:d}={}){const p=indexedDB.open(n,e),y=fg(p);return a&&p.addEventListener("upgradeneeded",v=>{a(fg(p.result),v.oldVersion,v.newVersion,fg(p.transaction),v)}),i&&p.addEventListener("blocked",v=>i(v.oldVersion,v.newVersion,v)),y.then(v=>{d&&v.addEventListener("close",()=>d()),l&&v.addEventListener("versionchange",b=>l(b.oldVersion,b.newVersion,b))}).catch(()=>{}),y}const q2e=["get","getKey","getAll","getAllKeys","count"],Y2e=["put","add","delete","clear"],X2=new Map;function $Y(n,e){if(!(n instanceof IDBDatabase&&!(e in n)&&typeof e=="string"))return;if(X2.get(e))return X2.get(e);const i=e.replace(/FromIndex$/,""),a=e!==i,l=Y2e.includes(i);if(!(i in(a?IDBIndex:IDBObjectStore).prototype)||!(l||q2e.includes(i)))return;const d=async function(p,...y){const v=this.transaction(p,l?"readwrite":"readonly");let b=v.store;return a&&(b=b.index(y.shift())),(await Promise.all([b[i](...y),l&&v.done]))[0]};return X2.set(e,d),d}G2e(n=>({...n,get:(e,i,a)=>$Y(e,i)||n.get(e,i,a),has:(e,i)=>!!$Y(e,i)||n.has(e,i)}));/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class X2e{constructor(e){this.container=e}getPlatformInfoString(){return this.container.getProviders().map(i=>{if(J2e(i)){const a=i.getImmediate();return`${a.library}/${a.version}`}else return null}).filter(i=>i).join(" ")}}function J2e(n){const e=n.getComponent();return(e==null?void 0:e.type)==="VERSION"}const _V="@firebase/app",KY="0.11.3";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Dp=new Oj("@firebase/app"),Q2e="@firebase/app-compat",Z2e="@firebase/analytics-compat",eUe="@firebase/analytics",tUe="@firebase/app-check-compat",nUe="@firebase/app-check",rUe="@firebase/auth",iUe="@firebase/auth-compat",sUe="@firebase/database",oUe="@firebase/data-connect",aUe="@firebase/database-compat",cUe="@firebase/functions",lUe="@firebase/functions-compat",uUe="@firebase/installations",dUe="@firebase/installations-compat",hUe="@firebase/messaging",fUe="@firebase/messaging-compat",pUe="@firebase/performance",mUe="@firebase/performance-compat",gUe="@firebase/remote-config",_Ue="@firebase/remote-config-compat",yUe="@firebase/storage",EUe="@firebase/storage-compat",vUe="@firebase/firestore",SUe="@firebase/vertexai",bUe="@firebase/firestore-compat",TUe="firebase",wUe="11.5.0";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const yV="[DEFAULT]",RUe={[_V]:"fire-core",[Q2e]:"fire-core-compat",[eUe]:"fire-analytics",[Z2e]:"fire-analytics-compat",[nUe]:"fire-app-check",[tUe]:"fire-app-check-compat",[rUe]:"fire-auth",[iUe]:"fire-auth-compat",[sUe]:"fire-rtdb",[oUe]:"fire-data-connect",[aUe]:"fire-rtdb-compat",[cUe]:"fire-fn",[lUe]:"fire-fn-compat",[uUe]:"fire-iid",[dUe]:"fire-iid-compat",[hUe]:"fire-fcm",[fUe]:"fire-fcm-compat",[pUe]:"fire-perf",[mUe]:"fire-perf-compat",[gUe]:"fire-rc",[_Ue]:"fire-rc-compat",[yUe]:"fire-gcs",[EUe]:"fire-gcs-compat",[vUe]:"fire-fst",[bUe]:"fire-fst-compat",[SUe]:"fire-vertex","fire-js":"fire-js",[TUe]:"fire-js-all"};/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Uk=new Map,CUe=new Map,EV=new Map;function qY(n,e){try{n.container.addComponent(e)}catch(i){Dp.debug(`Component ${e.name} failed to register with FirebaseApp ${n.name}`,i)}}function xy(n){const e=n.name;if(EV.has(e))return Dp.debug(`There were multiple attempts to register component ${e}.`),!1;EV.set(e,n);for(const i of Uk.values())qY(i,n);for(const i of CUe.values())qY(i,n);return!0}function V1(n,e){const i=n.container.getProvider("heartbeat").getImmediate({optional:!0});return i&&i.triggerHeartbeat(),n.container.getProvider(e)}function Al(n){return n==null?!1:n.settings!==void 0}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const IUe={"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}'","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","server-app-deleted":"Firebase Server App has been deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}.","finalization-registry-not-supported":"FirebaseServerApp deleteOnDeref field defined but the JS runtime does not support FinalizationRegistry.","invalid-server-app-environment":"FirebaseServerApp is not for use in browser environments."},pg=new cC("app","Firebase",IUe);/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class AUe{constructor(e,i,a){this._isDeleted=!1,this._options=Object.assign({},e),this._config=Object.assign({},i),this._name=i.name,this._automaticDataCollectionEnabled=i.automaticDataCollectionEnabled,this._container=a,this.container.addComponent(new Tg("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this.checkDestroyed(),this._automaticDataCollectionEnabled=e}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(e){this._isDeleted=e}checkDestroyed(){if(this.isDeleted)throw pg.create("app-deleted",{appName:this._name})}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Gy=wUe;function Qne(n,e={}){let i=n;typeof e!="object"&&(e={name:e});const a=Object.assign({name:yV,automaticDataCollectionEnabled:!1},e),l=a.name;if(typeof l!="string"||!l)throw pg.create("bad-app-name",{appName:String(l)});if(i||(i=Kne()),!i)throw pg.create("no-options");const d=Uk.get(l);if(d){if(Np(i,d.options)&&Np(a,d.config))return d;throw pg.create("duplicate-app",{appName:l})}const p=new L2e(l);for(const v of EV.values())p.addComponent(v);const y=new AUe(i,a,p);return Uk.set(l,y),y}function Nj(n=yV){const e=Uk.get(n);if(!e&&n===yV&&Kne())return Qne();if(!e)throw pg.create("no-app",{appName:n});return e}function Qh(n,e,i){var a;let l=(a=RUe[n])!==null&&a!==void 0?a:n;i&&(l+=`-${i}`);const d=l.match(/\s|\//),p=e.match(/\s|\//);if(d||p){const y=[`Unable to register library "${l}" with version "${e}":`];d&&y.push(`library name "${l}" contains illegal characters (whitespace or "/")`),d&&p&&y.push("and"),p&&y.push(`version name "${e}" contains illegal characters (whitespace or "/")`),Dp.warn(y.join(" "));return}xy(new Tg(`${l}-version`,()=>({library:l,version:e}),"VERSION"))}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const PUe="firebase-heartbeat-database",OUe=1,kR="firebase-heartbeat-store";let J2=null;function Zne(){return J2||(J2=K2e(PUe,OUe,{upgrade:(n,e)=>{switch(e){case 0:try{n.createObjectStore(kR)}catch(i){console.warn(i)}}}}).catch(n=>{throw pg.create("idb-open",{originalErrorMessage:n.message})})),J2}async function kUe(n){try{const i=(await Zne()).transaction(kR),a=await i.objectStore(kR).get(ere(n));return await i.done,a}catch(e){if(e instanceof df)Dp.warn(e.message);else{const i=pg.create("idb-get",{originalErrorMessage:e==null?void 0:e.message});Dp.warn(i.message)}}}async function YY(n,e){try{const a=(await Zne()).transaction(kR,"readwrite");await a.objectStore(kR).put(e,ere(n)),await a.done}catch(i){if(i instanceof df)Dp.warn(i.message);else{const a=pg.create("idb-set",{originalErrorMessage:i==null?void 0:i.message});Dp.warn(a.message)}}}function ere(n){return`${n.name}!${n.options.appId}`}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const NUe=1024,DUe=30;class LUe{constructor(e){this.container=e,this._heartbeatsCache=null;const i=this.container.getProvider("app").getImmediate();this._storage=new MUe(i),this._heartbeatsCachePromise=this._storage.read().then(a=>(this._heartbeatsCache=a,a))}async triggerHeartbeat(){var e,i;try{const l=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),d=XY();if(((e=this._heartbeatsCache)===null||e===void 0?void 0:e.heartbeats)==null&&(this._heartbeatsCache=await this._heartbeatsCachePromise,((i=this._heartbeatsCache)===null||i===void 0?void 0:i.heartbeats)==null)||this._heartbeatsCache.lastSentHeartbeatDate===d||this._heartbeatsCache.heartbeats.some(p=>p.date===d))return;if(this._heartbeatsCache.heartbeats.push({date:d,agent:l}),this._heartbeatsCache.heartbeats.length>DUe){const p=UUe(this._heartbeatsCache.heartbeats);this._heartbeatsCache.heartbeats.splice(p,1)}return this._storage.overwrite(this._heartbeatsCache)}catch(a){Dp.warn(a)}}async getHeartbeatsHeader(){var e;try{if(this._heartbeatsCache===null&&await this._heartbeatsCachePromise,((e=this._heartbeatsCache)===null||e===void 0?void 0:e.heartbeats)==null||this._heartbeatsCache.heartbeats.length===0)return"";const i=XY(),{heartbeatsToSend:a,unsentEntries:l}=xUe(this._heartbeatsCache.heartbeats),d=Mk(JSON.stringify({version:2,heartbeats:a}));return this._heartbeatsCache.lastSentHeartbeatDate=i,l.length>0?(this._heartbeatsCache.heartbeats=l,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),d}catch(i){return Dp.warn(i),""}}}function XY(){return new Date().toISOString().substring(0,10)}function xUe(n,e=NUe){const i=[];let a=n.slice();for(const l of n){const d=i.find(p=>p.agent===l.agent);if(d){if(d.dates.push(l.date),JY(i)>e){d.dates.pop();break}}else if(i.push({agent:l.agent,dates:[l.date]}),JY(i)>e){i.pop();break}a=a.slice(1)}return{heartbeatsToSend:i,unsentEntries:a}}class MUe{constructor(e){this.app=e,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return b2e()?T2e().then(()=>!0).catch(()=>!1):!1}async read(){if(await this._canUseIndexedDBPromise){const i=await kUe(this.app);return i!=null&&i.heartbeats?i:{heartbeats:[]}}else return{heartbeats:[]}}async overwrite(e){var i;if(await this._canUseIndexedDBPromise){const l=await this.read();return YY(this.app,{lastSentHeartbeatDate:(i=e.lastSentHeartbeatDate)!==null&&i!==void 0?i:l.lastSentHeartbeatDate,heartbeats:e.heartbeats})}else return}async add(e){var i;if(await this._canUseIndexedDBPromise){const l=await this.read();return YY(this.app,{lastSentHeartbeatDate:(i=e.lastSentHeartbeatDate)!==null&&i!==void 0?i:l.lastSentHeartbeatDate,heartbeats:[...l.heartbeats,...e.heartbeats]})}else return}}function JY(n){return Mk(JSON.stringify({version:2,heartbeats:n})).length}function UUe(n){if(n.length===0)return-1;let e=0,i=n[0].date;for(let a=1;a<n.length;a++)n[a].date<i&&(i=n[a].date,e=a);return e}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function VUe(n){xy(new Tg("platform-logger",e=>new X2e(e),"PRIVATE")),xy(new Tg("heartbeat",e=>new LUe(e),"PRIVATE")),Qh(_V,KY,n),Qh(_V,KY,"esm2017"),Qh("fire-js","")}VUe("");function tre(){return{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}}const FUe=tre,nre=new cC("auth","Firebase",tre());/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Vk=new Oj("@firebase/auth");function jUe(n,...e){Vk.logLevel<=br.WARN&&Vk.warn(`Auth (${Gy}): ${n}`,...e)}function ok(n,...e){Vk.logLevel<=br.ERROR&&Vk.error(`Auth (${Gy}): ${n}`,...e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function xd(n,...e){throw Dj(n,...e)}function Zh(n,...e){return Dj(n,...e)}function rre(n,e,i){const a=Object.assign(Object.assign({},FUe()),{[e]:i});return new cC("auth","Firebase",a).create(e,{appName:n.name})}function Ip(n){return rre(n,"operation-not-supported-in-this-environment","Operations that alter the current user are not supported in conjunction with FirebaseServerApp")}function Dj(n,...e){if(typeof n!="string"){const i=e[0],a=[...e.slice(1)];return a[0]&&(a[0].appName=n.name),n._errorFactory.create(i,...a)}return nre.create(n,...e)}function Ln(n,e,...i){if(!n)throw Dj(e,...i)}function yp(n){const e="INTERNAL ASSERTION FAILED: "+n;throw ok(e),new Error(e)}function Lp(n,e){n||yp(e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function vV(){var n;return typeof self<"u"&&((n=self.location)===null||n===void 0?void 0:n.href)||""}function BUe(){return QY()==="http:"||QY()==="https:"}function QY(){var n;return typeof self<"u"&&((n=self.location)===null||n===void 0?void 0:n.protocol)||null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function WUe(){return typeof navigator<"u"&&navigator&&"onLine"in navigator&&typeof navigator.onLine=="boolean"&&(BUe()||y2e()||"connection"in navigator)?navigator.onLine:!0}function zUe(){if(typeof navigator>"u")return null;const n=navigator;return n.languages&&n.languages[0]||n.language||null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class uC{constructor(e,i){this.shortDelay=e,this.longDelay=i,Lp(i>e,"Short delay should be less than long delay!"),this.isMobile=m2e()||E2e()}get(){return WUe()?this.isMobile?this.longDelay:this.shortDelay:Math.min(5e3,this.shortDelay)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Lj(n,e){Lp(n.emulator,"Emulator should always be set here");const{url:i}=n.emulator;return e?`${i}${e.startsWith("/")?e.slice(1):e}`:i}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ire{static initialize(e,i,a){this.fetchImpl=e,i&&(this.headersImpl=i),a&&(this.responseImpl=a)}static fetch(){if(this.fetchImpl)return this.fetchImpl;if(typeof self<"u"&&"fetch"in self)return self.fetch;if(typeof globalThis<"u"&&globalThis.fetch)return globalThis.fetch;if(typeof fetch<"u")return fetch;yp("Could not find fetch implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static headers(){if(this.headersImpl)return this.headersImpl;if(typeof self<"u"&&"Headers"in self)return self.Headers;if(typeof globalThis<"u"&&globalThis.Headers)return globalThis.Headers;if(typeof Headers<"u")return Headers;yp("Could not find Headers implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static response(){if(this.responseImpl)return this.responseImpl;if(typeof self<"u"&&"Response"in self)return self.Response;if(typeof globalThis<"u"&&globalThis.Response)return globalThis.Response;if(typeof Response<"u")return Response;yp("Could not find Response implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const GUe={CREDENTIAL_MISMATCH:"custom-token-mismatch",MISSING_CUSTOM_TOKEN:"internal-error",INVALID_IDENTIFIER:"invalid-email",MISSING_CONTINUE_URI:"internal-error",INVALID_PASSWORD:"wrong-password",MISSING_PASSWORD:"missing-password",INVALID_LOGIN_CREDENTIALS:"invalid-credential",EMAIL_EXISTS:"email-already-in-use",PASSWORD_LOGIN_DISABLED:"operation-not-allowed",INVALID_IDP_RESPONSE:"invalid-credential",INVALID_PENDING_TOKEN:"invalid-credential",FEDERATED_USER_ID_ALREADY_LINKED:"credential-already-in-use",MISSING_REQ_TYPE:"internal-error",EMAIL_NOT_FOUND:"user-not-found",RESET_PASSWORD_EXCEED_LIMIT:"too-many-requests",EXPIRED_OOB_CODE:"expired-action-code",INVALID_OOB_CODE:"invalid-action-code",MISSING_OOB_CODE:"internal-error",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"requires-recent-login",INVALID_ID_TOKEN:"invalid-user-token",TOKEN_EXPIRED:"user-token-expired",USER_NOT_FOUND:"user-token-expired",TOO_MANY_ATTEMPTS_TRY_LATER:"too-many-requests",PASSWORD_DOES_NOT_MEET_REQUIREMENTS:"password-does-not-meet-requirements",INVALID_CODE:"invalid-verification-code",INVALID_SESSION_INFO:"invalid-verification-id",INVALID_TEMPORARY_PROOF:"invalid-credential",MISSING_SESSION_INFO:"missing-verification-id",SESSION_EXPIRED:"code-expired",MISSING_ANDROID_PACKAGE_NAME:"missing-android-pkg-name",UNAUTHORIZED_DOMAIN:"unauthorized-continue-uri",INVALID_OAUTH_CLIENT_ID:"invalid-oauth-client-id",ADMIN_ONLY_OPERATION:"admin-restricted-operation",INVALID_MFA_PENDING_CREDENTIAL:"invalid-multi-factor-session",MFA_ENROLLMENT_NOT_FOUND:"multi-factor-info-not-found",MISSING_MFA_ENROLLMENT_ID:"missing-multi-factor-info",MISSING_MFA_PENDING_CREDENTIAL:"missing-multi-factor-session",SECOND_FACTOR_EXISTS:"second-factor-already-in-use",SECOND_FACTOR_LIMIT_EXCEEDED:"maximum-second-factor-count-exceeded",BLOCKING_FUNCTION_ERROR_RESPONSE:"internal-error",RECAPTCHA_NOT_ENABLED:"recaptcha-not-enabled",MISSING_RECAPTCHA_TOKEN:"missing-recaptcha-token",INVALID_RECAPTCHA_TOKEN:"invalid-recaptcha-token",INVALID_RECAPTCHA_ACTION:"invalid-recaptcha-action",MISSING_CLIENT_TYPE:"missing-client-type",MISSING_RECAPTCHA_VERSION:"missing-recaptcha-version",INVALID_RECAPTCHA_VERSION:"invalid-recaptcha-version",INVALID_REQ_TYPE:"invalid-req-type"};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const HUe=new uC(3e4,6e4);function Up(n,e){return n.tenantId&&!e.tenantId?Object.assign(Object.assign({},e),{tenantId:n.tenantId}):e}async function Vp(n,e,i,a,l={}){return sre(n,l,async()=>{let d={},p={};a&&(e==="GET"?p=a:d={body:JSON.stringify(a)});const y=lC(Object.assign({key:n.config.apiKey},p)).slice(1),v=await n._getAdditionalHeaders();v["Content-Type"]="application/json",n.languageCode&&(v["X-Firebase-Locale"]=n.languageCode);const b=Object.assign({method:e,headers:v},d);return _2e()||(b.referrerPolicy="no-referrer"),ire.fetch()(ore(n,n.config.apiHost,i,y),b)})}async function sre(n,e,i){n._canInitEmulator=!1;const a=Object.assign(Object.assign({},GUe),e);try{const l=new KUe(n),d=await Promise.race([i(),l.promise]);l.clearNetworkTimeout();const p=await d.json();if("needConfirmation"in p)throw IO(n,"account-exists-with-different-credential",p);if(d.ok&&!("errorMessage"in p))return p;{const y=d.ok?p.errorMessage:p.error.message,[v,b]=y.split(" : ");if(v==="FEDERATED_USER_ID_ALREADY_LINKED")throw IO(n,"credential-already-in-use",p);if(v==="EMAIL_EXISTS")throw IO(n,"email-already-in-use",p);if(v==="USER_DISABLED")throw IO(n,"user-disabled",p);const w=a[v]||v.toLowerCase().replace(/[_\s]+/g,"-");if(b)throw rre(n,w,b);xd(n,w)}}catch(l){if(l instanceof df)throw l;xd(n,"network-request-failed",{message:String(l)})}}async function dC(n,e,i,a,l={}){const d=await Vp(n,e,i,a,l);return"mfaPendingCredential"in d&&xd(n,"multi-factor-auth-required",{_serverResponse:d}),d}function ore(n,e,i,a){const l=`${e}${i}?${a}`;return n.config.emulator?Lj(n.config,l):`${n.config.apiScheme}://${l}`}function $Ue(n){switch(n){case"ENFORCE":return"ENFORCE";case"AUDIT":return"AUDIT";case"OFF":return"OFF";default:return"ENFORCEMENT_STATE_UNSPECIFIED"}}class KUe{clearNetworkTimeout(){clearTimeout(this.timer)}constructor(e){this.auth=e,this.timer=null,this.promise=new Promise((i,a)=>{this.timer=setTimeout(()=>a(Zh(this.auth,"network-request-failed")),HUe.get())})}}function IO(n,e,i){const a={appName:n.name};i.email&&(a.email=i.email),i.phoneNumber&&(a.phoneNumber=i.phoneNumber);const l=Zh(n,e,a);return l.customData._tokenResponse=i,l}function ZY(n){return n!==void 0&&n.enterprise!==void 0}class qUe{constructor(e){if(this.siteKey="",this.recaptchaEnforcementState=[],e.recaptchaKey===void 0)throw new Error("recaptchaKey undefined");this.siteKey=e.recaptchaKey.split("/")[3],this.recaptchaEnforcementState=e.recaptchaEnforcementState}getProviderEnforcementState(e){if(!this.recaptchaEnforcementState||this.recaptchaEnforcementState.length===0)return null;for(const i of this.recaptchaEnforcementState)if(i.provider&&i.provider===e)return $Ue(i.enforcementState);return null}isProviderEnabled(e){return this.getProviderEnforcementState(e)==="ENFORCE"||this.getProviderEnforcementState(e)==="AUDIT"}isAnyProviderEnabled(){return this.isProviderEnabled("EMAIL_PASSWORD_PROVIDER")||this.isProviderEnabled("PHONE_PROVIDER")}}async function YUe(n,e){return Vp(n,"GET","/v2/recaptchaConfig",Up(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function XUe(n,e){return Vp(n,"POST","/v1/accounts:delete",e)}async function are(n,e){return Vp(n,"POST","/v1/accounts:lookup",e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function sR(n){if(n)try{const e=new Date(Number(n));if(!isNaN(e.getTime()))return e.toUTCString()}catch{}}async function JUe(n,e=!1){const i=xi(n),a=await i.getIdToken(e),l=xj(a);Ln(l&&l.exp&&l.auth_time&&l.iat,i.auth,"internal-error");const d=typeof l.firebase=="object"?l.firebase:void 0,p=d==null?void 0:d.sign_in_provider;return{claims:l,token:a,authTime:sR(Q2(l.auth_time)),issuedAtTime:sR(Q2(l.iat)),expirationTime:sR(Q2(l.exp)),signInProvider:p||null,signInSecondFactor:(d==null?void 0:d.sign_in_second_factor)||null}}function Q2(n){return Number(n)*1e3}function xj(n){const[e,i,a]=n.split(".");if(e===void 0||i===void 0||a===void 0)return ok("JWT malformed, contained fewer than 3 sections"),null;try{const l=Gne(i);return l?JSON.parse(l):(ok("Failed to decode base64 JWT payload"),null)}catch(l){return ok("Caught error parsing JWT payload as JSON",l==null?void 0:l.toString()),null}}function eX(n){const e=xj(n);return Ln(e,"internal-error"),Ln(typeof e.exp<"u","internal-error"),Ln(typeof e.iat<"u","internal-error"),Number(e.exp)-Number(e.iat)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function NR(n,e,i=!1){if(i)return e;try{return await e}catch(a){throw a instanceof df&&QUe(a)&&n.auth.currentUser===n&&await n.auth.signOut(),a}}function QUe({code:n}){return n==="auth/user-disabled"||n==="auth/user-token-expired"}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ZUe{constructor(e){this.user=e,this.isRunning=!1,this.timerId=null,this.errorBackoff=3e4}_start(){this.isRunning||(this.isRunning=!0,this.schedule())}_stop(){this.isRunning&&(this.isRunning=!1,this.timerId!==null&&clearTimeout(this.timerId))}getInterval(e){var i;if(e){const a=this.errorBackoff;return this.errorBackoff=Math.min(this.errorBackoff*2,96e4),a}else{this.errorBackoff=3e4;const l=((i=this.user.stsTokenManager.expirationTime)!==null&&i!==void 0?i:0)-Date.now()-3e5;return Math.max(0,l)}}schedule(e=!1){if(!this.isRunning)return;const i=this.getInterval(e);this.timerId=setTimeout(async()=>{await this.iteration()},i)}async iteration(){try{await this.user.getIdToken(!0)}catch(e){(e==null?void 0:e.code)==="auth/network-request-failed"&&this.schedule(!0);return}this.schedule()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class SV{constructor(e,i){this.createdAt=e,this.lastLoginAt=i,this._initializeTime()}_initializeTime(){this.lastSignInTime=sR(this.lastLoginAt),this.creationTime=sR(this.createdAt)}_copy(e){this.createdAt=e.createdAt,this.lastLoginAt=e.lastLoginAt,this._initializeTime()}toJSON(){return{createdAt:this.createdAt,lastLoginAt:this.lastLoginAt}}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Fk(n){var e;const i=n.auth,a=await n.getIdToken(),l=await NR(n,are(i,{idToken:a}));Ln(l==null?void 0:l.users.length,i,"internal-error");const d=l.users[0];n._notifyReloadListener(d);const p=!((e=d.providerUserInfo)===null||e===void 0)&&e.length?cre(d.providerUserInfo):[],y=tVe(n.providerData,p),v=n.isAnonymous,b=!(n.email&&d.passwordHash)&&!(y!=null&&y.length),w=v?b:!1,A={uid:d.localId,displayName:d.displayName||null,photoURL:d.photoUrl||null,email:d.email||null,emailVerified:d.emailVerified||!1,phoneNumber:d.phoneNumber||null,tenantId:d.tenantId||null,providerData:y,metadata:new SV(d.createdAt,d.lastLoginAt),isAnonymous:w};Object.assign(n,A)}async function eVe(n){const e=xi(n);await Fk(e),await e.auth._persistUserIfCurrent(e),e.auth._notifyListenersIfCurrent(e)}function tVe(n,e){return[...n.filter(a=>!e.some(l=>l.providerId===a.providerId)),...e]}function cre(n){return n.map(e=>{var{providerId:i}=e,a=ZR(e,["providerId"]);return{providerId:i,uid:a.rawId||"",displayName:a.displayName||null,email:a.email||null,phoneNumber:a.phoneNumber||null,photoURL:a.photoUrl||null}})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function nVe(n,e){const i=await sre(n,{},async()=>{const a=lC({grant_type:"refresh_token",refresh_token:e}).slice(1),{tokenApiHost:l,apiKey:d}=n.config,p=ore(n,l,"/v1/token",`key=${d}`),y=await n._getAdditionalHeaders();return y["Content-Type"]="application/x-www-form-urlencoded",ire.fetch()(p,{method:"POST",headers:y,body:a})});return{accessToken:i.access_token,expiresIn:i.expires_in,refreshToken:i.refresh_token}}async function rVe(n,e){return Vp(n,"POST","/v2/accounts:revokeToken",Up(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class JS{constructor(){this.refreshToken=null,this.accessToken=null,this.expirationTime=null}get isExpired(){return!this.expirationTime||Date.now()>this.expirationTime-3e4}updateFromServerResponse(e){Ln(e.idToken,"internal-error"),Ln(typeof e.idToken<"u","internal-error"),Ln(typeof e.refreshToken<"u","internal-error");const i="expiresIn"in e&&typeof e.expiresIn<"u"?Number(e.expiresIn):eX(e.idToken);this.updateTokensAndExpiration(e.idToken,e.refreshToken,i)}updateFromIdToken(e){Ln(e.length!==0,"internal-error");const i=eX(e);this.updateTokensAndExpiration(e,null,i)}async getToken(e,i=!1){return!i&&this.accessToken&&!this.isExpired?this.accessToken:(Ln(this.refreshToken,e,"user-token-expired"),this.refreshToken?(await this.refresh(e,this.refreshToken),this.accessToken):null)}clearRefreshToken(){this.refreshToken=null}async refresh(e,i){const{accessToken:a,refreshToken:l,expiresIn:d}=await nVe(e,i);this.updateTokensAndExpiration(a,l,Number(d))}updateTokensAndExpiration(e,i,a){this.refreshToken=i||null,this.accessToken=e||null,this.expirationTime=Date.now()+a*1e3}static fromJSON(e,i){const{refreshToken:a,accessToken:l,expirationTime:d}=i,p=new JS;return a&&(Ln(typeof a=="string","internal-error",{appName:e}),p.refreshToken=a),l&&(Ln(typeof l=="string","internal-error",{appName:e}),p.accessToken=l),d&&(Ln(typeof d=="number","internal-error",{appName:e}),p.expirationTime=d),p}toJSON(){return{refreshToken:this.refreshToken,accessToken:this.accessToken,expirationTime:this.expirationTime}}_assign(e){this.accessToken=e.accessToken,this.refreshToken=e.refreshToken,this.expirationTime=e.expirationTime}_clone(){return Object.assign(new JS,this.toJSON())}_performRefresh(){return yp("not implemented")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Xm(n,e){Ln(typeof n=="string"||typeof n>"u","internal-error",{appName:e})}class Ep{constructor(e){var{uid:i,auth:a,stsTokenManager:l}=e,d=ZR(e,["uid","auth","stsTokenManager"]);this.providerId="firebase",this.proactiveRefresh=new ZUe(this),this.reloadUserInfo=null,this.reloadListener=null,this.uid=i,this.auth=a,this.stsTokenManager=l,this.accessToken=l.accessToken,this.displayName=d.displayName||null,this.email=d.email||null,this.emailVerified=d.emailVerified||!1,this.phoneNumber=d.phoneNumber||null,this.photoURL=d.photoURL||null,this.isAnonymous=d.isAnonymous||!1,this.tenantId=d.tenantId||null,this.providerData=d.providerData?[...d.providerData]:[],this.metadata=new SV(d.createdAt||void 0,d.lastLoginAt||void 0)}async getIdToken(e){const i=await NR(this,this.stsTokenManager.getToken(this.auth,e));return Ln(i,this.auth,"internal-error"),this.accessToken!==i&&(this.accessToken=i,await this.auth._persistUserIfCurrent(this),this.auth._notifyListenersIfCurrent(this)),i}getIdTokenResult(e){return JUe(this,e)}reload(){return eVe(this)}_assign(e){this!==e&&(Ln(this.uid===e.uid,this.auth,"internal-error"),this.displayName=e.displayName,this.photoURL=e.photoURL,this.email=e.email,this.emailVerified=e.emailVerified,this.phoneNumber=e.phoneNumber,this.isAnonymous=e.isAnonymous,this.tenantId=e.tenantId,this.providerData=e.providerData.map(i=>Object.assign({},i)),this.metadata._copy(e.metadata),this.stsTokenManager._assign(e.stsTokenManager))}_clone(e){const i=new Ep(Object.assign(Object.assign({},this),{auth:e,stsTokenManager:this.stsTokenManager._clone()}));return i.metadata._copy(this.metadata),i}_onReload(e){Ln(!this.reloadListener,this.auth,"internal-error"),this.reloadListener=e,this.reloadUserInfo&&(this._notifyReloadListener(this.reloadUserInfo),this.reloadUserInfo=null)}_notifyReloadListener(e){this.reloadListener?this.reloadListener(e):this.reloadUserInfo=e}_startProactiveRefresh(){this.proactiveRefresh._start()}_stopProactiveRefresh(){this.proactiveRefresh._stop()}async _updateTokensIfNecessary(e,i=!1){let a=!1;e.idToken&&e.idToken!==this.stsTokenManager.accessToken&&(this.stsTokenManager.updateFromServerResponse(e),a=!0),i&&await Fk(this),await this.auth._persistUserIfCurrent(this),a&&this.auth._notifyListenersIfCurrent(this)}async delete(){if(Al(this.auth.app))return Promise.reject(Ip(this.auth));const e=await this.getIdToken();return await NR(this,XUe(this.auth,{idToken:e})),this.stsTokenManager.clearRefreshToken(),this.auth.signOut()}toJSON(){return Object.assign(Object.assign({uid:this.uid,email:this.email||void 0,emailVerified:this.emailVerified,displayName:this.displayName||void 0,isAnonymous:this.isAnonymous,photoURL:this.photoURL||void 0,phoneNumber:this.phoneNumber||void 0,tenantId:this.tenantId||void 0,providerData:this.providerData.map(e=>Object.assign({},e)),stsTokenManager:this.stsTokenManager.toJSON(),_redirectEventId:this._redirectEventId},this.metadata.toJSON()),{apiKey:this.auth.config.apiKey,appName:this.auth.name})}get refreshToken(){return this.stsTokenManager.refreshToken||""}static _fromJSON(e,i){var a,l,d,p,y,v,b,w;const A=(a=i.displayName)!==null&&a!==void 0?a:void 0,N=(l=i.email)!==null&&l!==void 0?l:void 0,V=(d=i.phoneNumber)!==null&&d!==void 0?d:void 0,j=(p=i.photoURL)!==null&&p!==void 0?p:void 0,B=(y=i.tenantId)!==null&&y!==void 0?y:void 0,G=(v=i._redirectEventId)!==null&&v!==void 0?v:void 0,ee=(b=i.createdAt)!==null&&b!==void 0?b:void 0,K=(w=i.lastLoginAt)!==null&&w!==void 0?w:void 0,{uid:ne,emailVerified:ce,isAnonymous:oe,providerData:ge,stsTokenManager:te}=i;Ln(ne&&te,e,"internal-error");const Z=JS.fromJSON(this.name,te);Ln(typeof ne=="string",e,"internal-error"),Xm(A,e.name),Xm(N,e.name),Ln(typeof ce=="boolean",e,"internal-error"),Ln(typeof oe=="boolean",e,"internal-error"),Xm(V,e.name),Xm(j,e.name),Xm(B,e.name),Xm(G,e.name),Xm(ee,e.name),Xm(K,e.name);const J=new Ep({uid:ne,auth:e,email:N,emailVerified:ce,displayName:A,isAnonymous:oe,photoURL:j,phoneNumber:V,tenantId:B,stsTokenManager:Z,createdAt:ee,lastLoginAt:K});return ge&&Array.isArray(ge)&&(J.providerData=ge.map(se=>Object.assign({},se))),G&&(J._redirectEventId=G),J}static async _fromIdTokenResponse(e,i,a=!1){const l=new JS;l.updateFromServerResponse(i);const d=new Ep({uid:i.localId,auth:e,stsTokenManager:l,isAnonymous:a});return await Fk(d),d}static async _fromGetAccountInfoResponse(e,i,a){const l=i.users[0];Ln(l.localId!==void 0,"internal-error");const d=l.providerUserInfo!==void 0?cre(l.providerUserInfo):[],p=!(l.email&&l.passwordHash)&&!(d!=null&&d.length),y=new JS;y.updateFromIdToken(a);const v=new Ep({uid:l.localId,auth:e,stsTokenManager:y,isAnonymous:p}),b={uid:l.localId,displayName:l.displayName||null,photoURL:l.photoUrl||null,email:l.email||null,emailVerified:l.emailVerified||!1,phoneNumber:l.phoneNumber||null,tenantId:l.tenantId||null,providerData:d,metadata:new SV(l.createdAt,l.lastLoginAt),isAnonymous:!(l.email&&l.passwordHash)&&!(d!=null&&d.length)};return Object.assign(v,b),v}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const tX=new Map;function vp(n){Lp(n instanceof Function,"Expected a class definition");let e=tX.get(n);return e?(Lp(e instanceof n,"Instance stored in cache mismatched with class"),e):(e=new n,tX.set(n,e),e)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class lre{constructor(){this.type="NONE",this.storage={}}async _isAvailable(){return!0}async _set(e,i){this.storage[e]=i}async _get(e){const i=this.storage[e];return i===void 0?null:i}async _remove(e){delete this.storage[e]}_addListener(e,i){}_removeListener(e,i){}}lre.type="NONE";const nX=lre;/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ak(n,e,i){return`firebase:${n}:${e}:${i}`}class QS{constructor(e,i,a){this.persistence=e,this.auth=i,this.userKey=a;const{config:l,name:d}=this.auth;this.fullUserKey=ak(this.userKey,l.apiKey,d),this.fullPersistenceKey=ak("persistence",l.apiKey,d),this.boundEventHandler=i._onStorageEvent.bind(i),this.persistence._addListener(this.fullUserKey,this.boundEventHandler)}setCurrentUser(e){return this.persistence._set(this.fullUserKey,e.toJSON())}async getCurrentUser(){const e=await this.persistence._get(this.fullUserKey);return e?Ep._fromJSON(this.auth,e):null}removeCurrentUser(){return this.persistence._remove(this.fullUserKey)}savePersistenceForRedirect(){return this.persistence._set(this.fullPersistenceKey,this.persistence.type)}async setPersistence(e){if(this.persistence===e)return;const i=await this.getCurrentUser();if(await this.removeCurrentUser(),this.persistence=e,i)return this.setCurrentUser(i)}delete(){this.persistence._removeListener(this.fullUserKey,this.boundEventHandler)}static async create(e,i,a="authUser"){if(!i.length)return new QS(vp(nX),e,a);const l=(await Promise.all(i.map(async b=>{if(await b._isAvailable())return b}))).filter(b=>b);let d=l[0]||vp(nX);const p=ak(a,e.config.apiKey,e.name);let y=null;for(const b of i)try{const w=await b._get(p);if(w){const A=Ep._fromJSON(e,w);b!==d&&(y=A),d=b;break}}catch{}const v=l.filter(b=>b._shouldAllowMigration);return!d._shouldAllowMigration||!v.length?new QS(d,e,a):(d=v[0],y&&await d._set(p,y.toJSON()),await Promise.all(i.map(async b=>{if(b!==d)try{await b._remove(p)}catch{}})),new QS(d,e,a))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function rX(n){const e=n.toLowerCase();if(e.includes("opera/")||e.includes("opr/")||e.includes("opios/"))return"Opera";if(fre(e))return"IEMobile";if(e.includes("msie")||e.includes("trident/"))return"IE";if(e.includes("edge/"))return"Edge";if(ure(e))return"Firefox";if(e.includes("silk/"))return"Silk";if(mre(e))return"Blackberry";if(gre(e))return"Webos";if(dre(e))return"Safari";if((e.includes("chrome/")||hre(e))&&!e.includes("edge/"))return"Chrome";if(pre(e))return"Android";{const i=/([a-zA-Z\d\.]+)\/[a-zA-Z\d\.]*$/,a=n.match(i);if((a==null?void 0:a.length)===2)return a[1]}return"Other"}function ure(n=Ba()){return/firefox\//i.test(n)}function dre(n=Ba()){const e=n.toLowerCase();return e.includes("safari/")&&!e.includes("chrome/")&&!e.includes("crios/")&&!e.includes("android")}function hre(n=Ba()){return/crios\//i.test(n)}function fre(n=Ba()){return/iemobile/i.test(n)}function pre(n=Ba()){return/android/i.test(n)}function mre(n=Ba()){return/blackberry/i.test(n)}function gre(n=Ba()){return/webos/i.test(n)}function Mj(n=Ba()){return/iphone|ipad|ipod/i.test(n)||/macintosh/i.test(n)&&/mobile/i.test(n)}function iVe(n=Ba()){var e;return Mj(n)&&!!(!((e=window.navigator)===null||e===void 0)&&e.standalone)}function sVe(){return v2e()&&document.documentMode===10}function _re(n=Ba()){return Mj(n)||pre(n)||gre(n)||mre(n)||/windows phone/i.test(n)||fre(n)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function yre(n,e=[]){let i;switch(n){case"Browser":i=rX(Ba());break;case"Worker":i=`${rX(Ba())}-${n}`;break;default:i=n}const a=e.length?e.join(","):"FirebaseCore-web";return`${i}/JsCore/${Gy}/${a}`}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class oVe{constructor(e){this.auth=e,this.queue=[]}pushCallback(e,i){const a=d=>new Promise((p,y)=>{try{const v=e(d);p(v)}catch(v){y(v)}});a.onAbort=i,this.queue.push(a);const l=this.queue.length-1;return()=>{this.queue[l]=()=>Promise.resolve()}}async runMiddleware(e){if(this.auth.currentUser===e)return;const i=[];try{for(const a of this.queue)await a(e),a.onAbort&&i.push(a.onAbort)}catch(a){i.reverse();for(const l of i)try{l()}catch{}throw this.auth._errorFactory.create("login-blocked",{originalMessage:a==null?void 0:a.message})}}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function aVe(n,e={}){return Vp(n,"GET","/v2/passwordPolicy",Up(n,e))}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const cVe=6;class lVe{constructor(e){var i,a,l,d;const p=e.customStrengthOptions;this.customStrengthOptions={},this.customStrengthOptions.minPasswordLength=(i=p.minPasswordLength)!==null&&i!==void 0?i:cVe,p.maxPasswordLength&&(this.customStrengthOptions.maxPasswordLength=p.maxPasswordLength),p.containsLowercaseCharacter!==void 0&&(this.customStrengthOptions.containsLowercaseLetter=p.containsLowercaseCharacter),p.containsUppercaseCharacter!==void 0&&(this.customStrengthOptions.containsUppercaseLetter=p.containsUppercaseCharacter),p.containsNumericCharacter!==void 0&&(this.customStrengthOptions.containsNumericCharacter=p.containsNumericCharacter),p.containsNonAlphanumericCharacter!==void 0&&(this.customStrengthOptions.containsNonAlphanumericCharacter=p.containsNonAlphanumericCharacter),this.enforcementState=e.enforcementState,this.enforcementState==="ENFORCEMENT_STATE_UNSPECIFIED"&&(this.enforcementState="OFF"),this.allowedNonAlphanumericCharacters=(l=(a=e.allowedNonAlphanumericCharacters)===null||a===void 0?void 0:a.join(""))!==null&&l!==void 0?l:"",this.forceUpgradeOnSignin=(d=e.forceUpgradeOnSignin)!==null&&d!==void 0?d:!1,this.schemaVersion=e.schemaVersion}validatePassword(e){var i,a,l,d,p,y;const v={isValid:!0,passwordPolicy:this};return this.validatePasswordLengthOptions(e,v),this.validatePasswordCharacterOptions(e,v),v.isValid&&(v.isValid=(i=v.meetsMinPasswordLength)!==null&&i!==void 0?i:!0),v.isValid&&(v.isValid=(a=v.meetsMaxPasswordLength)!==null&&a!==void 0?a:!0),v.isValid&&(v.isValid=(l=v.containsLowercaseLetter)!==null&&l!==void 0?l:!0),v.isValid&&(v.isValid=(d=v.containsUppercaseLetter)!==null&&d!==void 0?d:!0),v.isValid&&(v.isValid=(p=v.containsNumericCharacter)!==null&&p!==void 0?p:!0),v.isValid&&(v.isValid=(y=v.containsNonAlphanumericCharacter)!==null&&y!==void 0?y:!0),v}validatePasswordLengthOptions(e,i){const a=this.customStrengthOptions.minPasswordLength,l=this.customStrengthOptions.maxPasswordLength;a&&(i.meetsMinPasswordLength=e.length>=a),l&&(i.meetsMaxPasswordLength=e.length<=l)}validatePasswordCharacterOptions(e,i){this.updatePasswordCharacterOptionsStatuses(i,!1,!1,!1,!1);let a;for(let l=0;l<e.length;l++)a=e.charAt(l),this.updatePasswordCharacterOptionsStatuses(i,a>="a"&&a<="z",a>="A"&&a<="Z",a>="0"&&a<="9",this.allowedNonAlphanumericCharacters.includes(a))}updatePasswordCharacterOptionsStatuses(e,i,a,l,d){this.customStrengthOptions.containsLowercaseLetter&&(e.containsLowercaseLetter||(e.containsLowercaseLetter=i)),this.customStrengthOptions.containsUppercaseLetter&&(e.containsUppercaseLetter||(e.containsUppercaseLetter=a)),this.customStrengthOptions.containsNumericCharacter&&(e.containsNumericCharacter||(e.containsNumericCharacter=l)),this.customStrengthOptions.containsNonAlphanumericCharacter&&(e.containsNonAlphanumericCharacter||(e.containsNonAlphanumericCharacter=d))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class uVe{constructor(e,i,a,l){this.app=e,this.heartbeatServiceProvider=i,this.appCheckServiceProvider=a,this.config=l,this.currentUser=null,this.emulatorConfig=null,this.operations=Promise.resolve(),this.authStateSubscription=new iX(this),this.idTokenSubscription=new iX(this),this.beforeStateQueue=new oVe(this),this.redirectUser=null,this.isProactiveRefreshEnabled=!1,this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION=1,this._canInitEmulator=!0,this._isInitialized=!1,this._deleted=!1,this._initializationPromise=null,this._popupRedirectResolver=null,this._errorFactory=nre,this._agentRecaptchaConfig=null,this._tenantRecaptchaConfigs={},this._projectPasswordPolicy=null,this._tenantPasswordPolicies={},this.lastNotifiedUid=void 0,this.languageCode=null,this.tenantId=null,this.settings={appVerificationDisabledForTesting:!1},this.frameworks=[],this.name=e.name,this.clientVersion=l.sdkClientVersion}_initializeWithPersistence(e,i){return i&&(this._popupRedirectResolver=vp(i)),this._initializationPromise=this.queue(async()=>{var a,l;if(!this._deleted&&(this.persistenceManager=await QS.create(this,e),!this._deleted)){if(!((a=this._popupRedirectResolver)===null||a===void 0)&&a._shouldInitProactively)try{await this._popupRedirectResolver._initialize(this)}catch{}await this.initializeCurrentUser(i),this.lastNotifiedUid=((l=this.currentUser)===null||l===void 0?void 0:l.uid)||null,!this._deleted&&(this._isInitialized=!0)}}),this._initializationPromise}async _onStorageEvent(){if(this._deleted)return;const e=await this.assertedPersistence.getCurrentUser();if(!(!this.currentUser&&!e)){if(this.currentUser&&e&&this.currentUser.uid===e.uid){this._currentUser._assign(e),await this.currentUser.getIdToken();return}await this._updateCurrentUser(e,!0)}}async initializeCurrentUserFromIdToken(e){try{const i=await are(this,{idToken:e}),a=await Ep._fromGetAccountInfoResponse(this,i,e);await this.directlySetCurrentUser(a)}catch(i){console.warn("FirebaseServerApp could not login user with provided authIdToken: ",i),await this.directlySetCurrentUser(null)}}async initializeCurrentUser(e){var i;if(Al(this.app)){const p=this.app.settings.authIdToken;return p?new Promise(y=>{setTimeout(()=>this.initializeCurrentUserFromIdToken(p).then(y,y))}):this.directlySetCurrentUser(null)}const a=await this.assertedPersistence.getCurrentUser();let l=a,d=!1;if(e&&this.config.authDomain){await this.getOrInitRedirectPersistenceManager();const p=(i=this.redirectUser)===null||i===void 0?void 0:i._redirectEventId,y=l==null?void 0:l._redirectEventId,v=await this.tryRedirectSignIn(e);(!p||p===y)&&(v!=null&&v.user)&&(l=v.user,d=!0)}if(!l)return this.directlySetCurrentUser(null);if(!l._redirectEventId){if(d)try{await this.beforeStateQueue.runMiddleware(l)}catch(p){l=a,this._popupRedirectResolver._overrideRedirectResult(this,()=>Promise.reject(p))}return l?this.reloadAndSetCurrentUserOrClear(l):this.directlySetCurrentUser(null)}return Ln(this._popupRedirectResolver,this,"argument-error"),await this.getOrInitRedirectPersistenceManager(),this.redirectUser&&this.redirectUser._redirectEventId===l._redirectEventId?this.directlySetCurrentUser(l):this.reloadAndSetCurrentUserOrClear(l)}async tryRedirectSignIn(e){let i=null;try{i=await this._popupRedirectResolver._completeRedirectFn(this,e,!0)}catch{await this._setRedirectUser(null)}return i}async reloadAndSetCurrentUserOrClear(e){try{await Fk(e)}catch(i){if((i==null?void 0:i.code)!=="auth/network-request-failed")return this.directlySetCurrentUser(null)}return this.directlySetCurrentUser(e)}useDeviceLanguage(){this.languageCode=zUe()}async _delete(){this._deleted=!0}async updateCurrentUser(e){if(Al(this.app))return Promise.reject(Ip(this));const i=e?xi(e):null;return i&&Ln(i.auth.config.apiKey===this.config.apiKey,this,"invalid-user-token"),this._updateCurrentUser(i&&i._clone(this))}async _updateCurrentUser(e,i=!1){if(!this._deleted)return e&&Ln(this.tenantId===e.tenantId,this,"tenant-id-mismatch"),i||await this.beforeStateQueue.runMiddleware(e),this.queue(async()=>{await this.directlySetCurrentUser(e),this.notifyAuthListeners()})}async signOut(){return Al(this.app)?Promise.reject(Ip(this)):(await this.beforeStateQueue.runMiddleware(null),(this.redirectPersistenceManager||this._popupRedirectResolver)&&await this._setRedirectUser(null),this._updateCurrentUser(null,!0))}setPersistence(e){return Al(this.app)?Promise.reject(Ip(this)):this.queue(async()=>{await this.assertedPersistence.setPersistence(vp(e))})}_getRecaptchaConfig(){return this.tenantId==null?this._agentRecaptchaConfig:this._tenantRecaptchaConfigs[this.tenantId]}async validatePassword(e){this._getPasswordPolicyInternal()||await this._updatePasswordPolicy();const i=this._getPasswordPolicyInternal();return i.schemaVersion!==this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION?Promise.reject(this._errorFactory.create("unsupported-password-policy-schema-version",{})):i.validatePassword(e)}_getPasswordPolicyInternal(){return this.tenantId===null?this._projectPasswordPolicy:this._tenantPasswordPolicies[this.tenantId]}async _updatePasswordPolicy(){const e=await aVe(this),i=new lVe(e);this.tenantId===null?this._projectPasswordPolicy=i:this._tenantPasswordPolicies[this.tenantId]=i}_getPersistence(){return this.assertedPersistence.persistence.type}_updateErrorMap(e){this._errorFactory=new cC("auth","Firebase",e())}onAuthStateChanged(e,i,a){return this.registerStateListener(this.authStateSubscription,e,i,a)}beforeAuthStateChanged(e,i){return this.beforeStateQueue.pushCallback(e,i)}onIdTokenChanged(e,i,a){return this.registerStateListener(this.idTokenSubscription,e,i,a)}authStateReady(){return new Promise((e,i)=>{if(this.currentUser)e();else{const a=this.onAuthStateChanged(()=>{a(),e()},i)}})}async revokeAccessToken(e){if(this.currentUser){const i=await this.currentUser.getIdToken(),a={providerId:"apple.com",tokenType:"ACCESS_TOKEN",token:e,idToken:i};this.tenantId!=null&&(a.tenantId=this.tenantId),await rVe(this,a)}}toJSON(){var e;return{apiKey:this.config.apiKey,authDomain:this.config.authDomain,appName:this.name,currentUser:(e=this._currentUser)===null||e===void 0?void 0:e.toJSON()}}async _setRedirectUser(e,i){const a=await this.getOrInitRedirectPersistenceManager(i);return e===null?a.removeCurrentUser():a.setCurrentUser(e)}async getOrInitRedirectPersistenceManager(e){if(!this.redirectPersistenceManager){const i=e&&vp(e)||this._popupRedirectResolver;Ln(i,this,"argument-error"),this.redirectPersistenceManager=await QS.create(this,[vp(i._redirectPersistence)],"redirectUser"),this.redirectUser=await this.redirectPersistenceManager.getCurrentUser()}return this.redirectPersistenceManager}async _redirectUserForId(e){var i,a;return this._isInitialized&&await this.queue(async()=>{}),((i=this._currentUser)===null||i===void 0?void 0:i._redirectEventId)===e?this._currentUser:((a=this.redirectUser)===null||a===void 0?void 0:a._redirectEventId)===e?this.redirectUser:null}async _persistUserIfCurrent(e){if(e===this.currentUser)return this.queue(async()=>this.directlySetCurrentUser(e))}_notifyListenersIfCurrent(e){e===this.currentUser&&this.notifyAuthListeners()}_key(){return`${this.config.authDomain}:${this.config.apiKey}:${this.name}`}_startProactiveRefresh(){this.isProactiveRefreshEnabled=!0,this.currentUser&&this._currentUser._startProactiveRefresh()}_stopProactiveRefresh(){this.isProactiveRefreshEnabled=!1,this.currentUser&&this._currentUser._stopProactiveRefresh()}get _currentUser(){return this.currentUser}notifyAuthListeners(){var e,i;if(!this._isInitialized)return;this.idTokenSubscription.next(this.currentUser);const a=(i=(e=this.currentUser)===null||e===void 0?void 0:e.uid)!==null&&i!==void 0?i:null;this.lastNotifiedUid!==a&&(this.lastNotifiedUid=a,this.authStateSubscription.next(this.currentUser))}registerStateListener(e,i,a,l){if(this._deleted)return()=>{};const d=typeof i=="function"?i:i.next.bind(i);let p=!1;const y=this._isInitialized?Promise.resolve():this._initializationPromise;if(Ln(y,this,"internal-error"),y.then(()=>{p||d(this.currentUser)}),typeof i=="function"){const v=e.addObserver(i,a,l);return()=>{p=!0,v()}}else{const v=e.addObserver(i);return()=>{p=!0,v()}}}async directlySetCurrentUser(e){this.currentUser&&this.currentUser!==e&&this._currentUser._stopProactiveRefresh(),e&&this.isProactiveRefreshEnabled&&e._startProactiveRefresh(),this.currentUser=e,e?await this.assertedPersistence.setCurrentUser(e):await this.assertedPersistence.removeCurrentUser()}queue(e){return this.operations=this.operations.then(e,e),this.operations}get assertedPersistence(){return Ln(this.persistenceManager,this,"internal-error"),this.persistenceManager}_logFramework(e){!e||this.frameworks.includes(e)||(this.frameworks.push(e),this.frameworks.sort(),this.clientVersion=yre(this.config.clientPlatform,this._getFrameworks()))}_getFrameworks(){return this.frameworks}async _getAdditionalHeaders(){var e;const i={"X-Client-Version":this.clientVersion};this.app.options.appId&&(i["X-Firebase-gmpid"]=this.app.options.appId);const a=await((e=this.heartbeatServiceProvider.getImmediate({optional:!0}))===null||e===void 0?void 0:e.getHeartbeatsHeader());a&&(i["X-Firebase-Client"]=a);const l=await this._getAppCheckToken();return l&&(i["X-Firebase-AppCheck"]=l),i}async _getAppCheckToken(){var e;if(Al(this.app)&&this.app.settings.appCheckToken)return this.app.settings.appCheckToken;const i=await((e=this.appCheckServiceProvider.getImmediate({optional:!0}))===null||e===void 0?void 0:e.getToken());return i!=null&&i.error&&jUe(`Error while retrieving App Check token: ${i.error}`),i==null?void 0:i.token}}function Lg(n){return xi(n)}class iX{constructor(e){this.auth=e,this.observer=null,this.addObserver=A2e(i=>this.observer=i)}get next(){return Ln(this.observer,this.auth,"internal-error"),this.observer.next.bind(this.observer)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let F1={async loadJS(){throw new Error("Unable to load external scripts")},recaptchaV2Script:"",recaptchaEnterpriseScript:"",gapiScript:""};function dVe(n){F1=n}function Ere(n){return F1.loadJS(n)}function hVe(){return F1.recaptchaEnterpriseScript}function fVe(){return F1.gapiScript}function pVe(n){return`__${n}${Math.floor(Math.random()*1e6)}`}class mVe{constructor(){this.enterprise=new gVe}ready(e){e()}execute(e,i){return Promise.resolve("token")}render(e,i){return""}}class gVe{ready(e){e()}execute(e,i){return Promise.resolve("token")}render(e,i){return""}}const _Ve="recaptcha-enterprise",vre="NO_RECAPTCHA";class yVe{constructor(e){this.type=_Ve,this.auth=Lg(e)}async verify(e="verify",i=!1){async function a(d){if(!i){if(d.tenantId==null&&d._agentRecaptchaConfig!=null)return d._agentRecaptchaConfig.siteKey;if(d.tenantId!=null&&d._tenantRecaptchaConfigs[d.tenantId]!==void 0)return d._tenantRecaptchaConfigs[d.tenantId].siteKey}return new Promise(async(p,y)=>{YUe(d,{clientType:"CLIENT_TYPE_WEB",version:"RECAPTCHA_ENTERPRISE"}).then(v=>{if(v.recaptchaKey===void 0)y(new Error("recaptcha Enterprise site key undefined"));else{const b=new qUe(v);return d.tenantId==null?d._agentRecaptchaConfig=b:d._tenantRecaptchaConfigs[d.tenantId]=b,p(b.siteKey)}}).catch(v=>{y(v)})})}function l(d,p,y){const v=window.grecaptcha;ZY(v)?v.enterprise.ready(()=>{v.enterprise.execute(d,{action:e}).then(b=>{p(b)}).catch(()=>{p(vre)})}):y(Error("No reCAPTCHA enterprise script loaded."))}return this.auth.settings.appVerificationDisabledForTesting?new mVe().execute("siteKey",{action:"verify"}):new Promise((d,p)=>{a(this.auth).then(y=>{if(!i&&ZY(window.grecaptcha))l(y,d,p);else{if(typeof window>"u"){p(new Error("RecaptchaVerifier is only supported in browser"));return}let v=hVe();v.length!==0&&(v+=y),Ere(v).then(()=>{l(y,d,p)}).catch(b=>{p(b)})}}).catch(y=>{p(y)})})}}async function sX(n,e,i,a=!1,l=!1){const d=new yVe(n);let p;if(l)p=vre;else try{p=await d.verify(i)}catch{p=await d.verify(i,!0)}const y=Object.assign({},e);if(i==="mfaSmsEnrollment"||i==="mfaSmsSignIn"){if("phoneEnrollmentInfo"in y){const v=y.phoneEnrollmentInfo.phoneNumber,b=y.phoneEnrollmentInfo.recaptchaToken;Object.assign(y,{phoneEnrollmentInfo:{phoneNumber:v,recaptchaToken:b,captchaResponse:p,clientType:"CLIENT_TYPE_WEB",recaptchaVersion:"RECAPTCHA_ENTERPRISE"}})}else if("phoneSignInInfo"in y){const v=y.phoneSignInInfo.recaptchaToken;Object.assign(y,{phoneSignInInfo:{recaptchaToken:v,captchaResponse:p,clientType:"CLIENT_TYPE_WEB",recaptchaVersion:"RECAPTCHA_ENTERPRISE"}})}return y}return a?Object.assign(y,{captchaResp:p}):Object.assign(y,{captchaResponse:p}),Object.assign(y,{clientType:"CLIENT_TYPE_WEB"}),Object.assign(y,{recaptchaVersion:"RECAPTCHA_ENTERPRISE"}),y}async function jk(n,e,i,a,l){var d;if(!((d=n._getRecaptchaConfig())===null||d===void 0)&&d.isProviderEnabled("EMAIL_PASSWORD_PROVIDER")){const p=await sX(n,e,i,i==="getOobCode");return a(n,p)}else return a(n,e).catch(async p=>{if(p.code==="auth/missing-recaptcha-token"){console.log(`${i} is protected by reCAPTCHA Enterprise for this project. Automatically triggering the reCAPTCHA flow and restarting the flow.`);const y=await sX(n,e,i,i==="getOobCode");return a(n,y)}else return Promise.reject(p)})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function EVe(n,e){const i=V1(n,"auth");if(i.isInitialized()){const l=i.getImmediate(),d=i.getOptions();if(Np(d,e??{}))return l;xd(l,"already-initialized")}return i.initialize({options:e})}function vVe(n,e){const i=(e==null?void 0:e.persistence)||[],a=(Array.isArray(i)?i:[i]).map(vp);e!=null&&e.errorMap&&n._updateErrorMap(e.errorMap),n._initializeWithPersistence(a,e==null?void 0:e.popupRedirectResolver)}function SVe(n,e,i){const a=Lg(n);Ln(/^https?:\/\//.test(e),a,"invalid-emulator-scheme");const l=!1,d=Sre(e),{host:p,port:y}=bVe(e),v=y===null?"":`:${y}`,b={url:`${d}//${p}${v}/`},w=Object.freeze({host:p,port:y,protocol:d.replace(":",""),options:Object.freeze({disableWarnings:l})});if(!a._canInitEmulator){Ln(a.config.emulator&&a.emulatorConfig,a,"emulator-config-failed"),Ln(Np(b,a.config.emulator)&&Np(w,a.emulatorConfig),a,"emulator-config-failed");return}a.config.emulator=b,a.emulatorConfig=w,a.settings.appVerificationDisabledForTesting=!0,TVe()}function Sre(n){const e=n.indexOf(":");return e<0?"":n.substr(0,e+1)}function bVe(n){const e=Sre(n),i=/(\/\/)?([^?#/]+)/.exec(n.substr(e.length));if(!i)return{host:"",port:null};const a=i[2].split("@").pop()||"",l=/^(\[[^\]]+\])(:|$)/.exec(a);if(l){const d=l[1];return{host:d,port:oX(a.substr(d.length+1))}}else{const[d,p]=a.split(":");return{host:d,port:oX(p)}}}function oX(n){if(!n)return null;const e=Number(n);return isNaN(e)?null:e}function TVe(){function n(){const e=document.createElement("p"),i=e.style;e.innerText="Running in emulator mode. Do not use with production credentials.",i.position="fixed",i.width="100%",i.backgroundColor="#ffffff",i.border=".1em solid #000000",i.color="#b50000",i.bottom="0px",i.left="0px",i.margin="0px",i.zIndex="10000",i.textAlign="center",e.classList.add("firebase-emulator-warning"),document.body.appendChild(e)}typeof console<"u"&&typeof console.info=="function"&&console.info("WARNING: You are using the Auth Emulator, which is intended for local testing only.  Do not use with production credentials."),typeof window<"u"&&typeof document<"u"&&(document.readyState==="loading"?window.addEventListener("DOMContentLoaded",n):n())}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Uj{constructor(e,i){this.providerId=e,this.signInMethod=i}toJSON(){return yp("not implemented")}_getIdTokenResponse(e){return yp("not implemented")}_linkToIdToken(e,i){return yp("not implemented")}_getReauthenticationResolver(e){return yp("not implemented")}}async function wVe(n,e){return Vp(n,"POST","/v1/accounts:signUp",e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function RVe(n,e){return dC(n,"POST","/v1/accounts:signInWithPassword",Up(n,e))}async function bre(n,e){return Vp(n,"POST","/v1/accounts:sendOobCode",Up(n,e))}async function CVe(n,e){return bre(n,e)}async function IVe(n,e){return bre(n,e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function AVe(n,e){return dC(n,"POST","/v1/accounts:signInWithEmailLink",Up(n,e))}async function PVe(n,e){return dC(n,"POST","/v1/accounts:signInWithEmailLink",Up(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class DR extends Uj{constructor(e,i,a,l=null){super("password",a),this._email=e,this._password=i,this._tenantId=l}static _fromEmailAndPassword(e,i){return new DR(e,i,"password")}static _fromEmailAndCode(e,i,a=null){return new DR(e,i,"emailLink",a)}toJSON(){return{email:this._email,password:this._password,signInMethod:this.signInMethod,tenantId:this._tenantId}}static fromJSON(e){const i=typeof e=="string"?JSON.parse(e):e;if(i!=null&&i.email&&(i!=null&&i.password)){if(i.signInMethod==="password")return this._fromEmailAndPassword(i.email,i.password);if(i.signInMethod==="emailLink")return this._fromEmailAndCode(i.email,i.password,i.tenantId)}return null}async _getIdTokenResponse(e){switch(this.signInMethod){case"password":const i={returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"};return jk(e,i,"signInWithPassword",RVe);case"emailLink":return AVe(e,{email:this._email,oobCode:this._password});default:xd(e,"internal-error")}}async _linkToIdToken(e,i){switch(this.signInMethod){case"password":const a={idToken:i,returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"};return jk(e,a,"signUpPassword",wVe);case"emailLink":return PVe(e,{idToken:i,email:this._email,oobCode:this._password});default:xd(e,"internal-error")}}_getReauthenticationResolver(e){return this._getIdTokenResponse(e)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function ZS(n,e){return dC(n,"POST","/v1/accounts:signInWithIdp",Up(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const OVe="http://localhost";class My extends Uj{constructor(){super(...arguments),this.pendingToken=null}static _fromParams(e){const i=new My(e.providerId,e.signInMethod);return e.idToken||e.accessToken?(e.idToken&&(i.idToken=e.idToken),e.accessToken&&(i.accessToken=e.accessToken),e.nonce&&!e.pendingToken&&(i.nonce=e.nonce),e.pendingToken&&(i.pendingToken=e.pendingToken)):e.oauthToken&&e.oauthTokenSecret?(i.accessToken=e.oauthToken,i.secret=e.oauthTokenSecret):xd("argument-error"),i}toJSON(){return{idToken:this.idToken,accessToken:this.accessToken,secret:this.secret,nonce:this.nonce,pendingToken:this.pendingToken,providerId:this.providerId,signInMethod:this.signInMethod}}static fromJSON(e){const i=typeof e=="string"?JSON.parse(e):e,{providerId:a,signInMethod:l}=i,d=ZR(i,["providerId","signInMethod"]);if(!a||!l)return null;const p=new My(a,l);return p.idToken=d.idToken||void 0,p.accessToken=d.accessToken||void 0,p.secret=d.secret,p.nonce=d.nonce,p.pendingToken=d.pendingToken||null,p}_getIdTokenResponse(e){const i=this.buildRequest();return ZS(e,i)}_linkToIdToken(e,i){const a=this.buildRequest();return a.idToken=i,ZS(e,a)}_getReauthenticationResolver(e){const i=this.buildRequest();return i.autoCreate=!1,ZS(e,i)}buildRequest(){const e={requestUri:OVe,returnSecureToken:!0};if(this.pendingToken)e.pendingToken=this.pendingToken;else{const i={};this.idToken&&(i.id_token=this.idToken),this.accessToken&&(i.access_token=this.accessToken),this.secret&&(i.oauth_token_secret=this.secret),i.providerId=this.providerId,this.nonce&&!this.pendingToken&&(i.nonce=this.nonce),e.postBody=lC(i)}return e}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function kVe(n){switch(n){case"recoverEmail":return"RECOVER_EMAIL";case"resetPassword":return"PASSWORD_RESET";case"signIn":return"EMAIL_SIGNIN";case"verifyEmail":return"VERIFY_EMAIL";case"verifyAndChangeEmail":return"VERIFY_AND_CHANGE_EMAIL";case"revertSecondFactorAddition":return"REVERT_SECOND_FACTOR_ADDITION";default:return null}}function NVe(n){const e=Uw(Vw(n)).link,i=e?Uw(Vw(e)).deep_link_id:null,a=Uw(Vw(n)).deep_link_id;return(a?Uw(Vw(a)).link:null)||a||i||e||n}class Vj{constructor(e){var i,a,l,d,p,y;const v=Uw(Vw(e)),b=(i=v.apiKey)!==null&&i!==void 0?i:null,w=(a=v.oobCode)!==null&&a!==void 0?a:null,A=kVe((l=v.mode)!==null&&l!==void 0?l:null);Ln(b&&w&&A,"argument-error"),this.apiKey=b,this.operation=A,this.code=w,this.continueUrl=(d=v.continueUrl)!==null&&d!==void 0?d:null,this.languageCode=(p=v.languageCode)!==null&&p!==void 0?p:null,this.tenantId=(y=v.tenantId)!==null&&y!==void 0?y:null}static parseLink(e){const i=NVe(e);try{return new Vj(i)}catch{return null}}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class U0{constructor(){this.providerId=U0.PROVIDER_ID}static credential(e,i){return DR._fromEmailAndPassword(e,i)}static credentialWithLink(e,i){const a=Vj.parseLink(i);return Ln(a,"argument-error"),DR._fromEmailAndCode(e,a.code,a.tenantId)}}U0.PROVIDER_ID="password";U0.EMAIL_PASSWORD_SIGN_IN_METHOD="password";U0.EMAIL_LINK_SIGN_IN_METHOD="emailLink";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Tre{constructor(e){this.providerId=e,this.defaultLanguageCode=null,this.customParameters={}}setDefaultLanguage(e){this.defaultLanguageCode=e}setCustomParameters(e){return this.customParameters=e,this}getCustomParameters(){return this.customParameters}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class hC extends Tre{constructor(){super(...arguments),this.scopes=[]}addScope(e){return this.scopes.includes(e)||this.scopes.push(e),this}getScopes(){return[...this.scopes]}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ng extends hC{constructor(){super("facebook.com")}static credential(e){return My._fromParams({providerId:ng.PROVIDER_ID,signInMethod:ng.FACEBOOK_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return ng.credentialFromTaggedObject(e)}static credentialFromError(e){return ng.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e)||!e.oauthAccessToken)return null;try{return ng.credential(e.oauthAccessToken)}catch{return null}}}ng.FACEBOOK_SIGN_IN_METHOD="facebook.com";ng.PROVIDER_ID="facebook.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class rg extends hC{constructor(){super("google.com"),this.addScope("profile")}static credential(e,i){return My._fromParams({providerId:rg.PROVIDER_ID,signInMethod:rg.GOOGLE_SIGN_IN_METHOD,idToken:e,accessToken:i})}static credentialFromResult(e){return rg.credentialFromTaggedObject(e)}static credentialFromError(e){return rg.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthIdToken:i,oauthAccessToken:a}=e;if(!i&&!a)return null;try{return rg.credential(i,a)}catch{return null}}}rg.GOOGLE_SIGN_IN_METHOD="google.com";rg.PROVIDER_ID="google.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ig extends hC{constructor(){super("github.com")}static credential(e){return My._fromParams({providerId:ig.PROVIDER_ID,signInMethod:ig.GITHUB_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return ig.credentialFromTaggedObject(e)}static credentialFromError(e){return ig.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e)||!e.oauthAccessToken)return null;try{return ig.credential(e.oauthAccessToken)}catch{return null}}}ig.GITHUB_SIGN_IN_METHOD="github.com";ig.PROVIDER_ID="github.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class sg extends hC{constructor(){super("twitter.com")}static credential(e,i){return My._fromParams({providerId:sg.PROVIDER_ID,signInMethod:sg.TWITTER_SIGN_IN_METHOD,oauthToken:e,oauthTokenSecret:i})}static credentialFromResult(e){return sg.credentialFromTaggedObject(e)}static credentialFromError(e){return sg.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthAccessToken:i,oauthTokenSecret:a}=e;if(!i||!a)return null;try{return sg.credential(i,a)}catch{return null}}}sg.TWITTER_SIGN_IN_METHOD="twitter.com";sg.PROVIDER_ID="twitter.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function DVe(n,e){return dC(n,"POST","/v1/accounts:signUp",Up(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Uy{constructor(e){this.user=e.user,this.providerId=e.providerId,this._tokenResponse=e._tokenResponse,this.operationType=e.operationType}static async _fromIdTokenResponse(e,i,a,l=!1){const d=await Ep._fromIdTokenResponse(e,a,l),p=aX(a);return new Uy({user:d,providerId:p,_tokenResponse:a,operationType:i})}static async _forOperation(e,i,a){await e._updateTokensIfNecessary(a,!0);const l=aX(a);return new Uy({user:e,providerId:l,_tokenResponse:a,operationType:i})}}function aX(n){return n.providerId?n.providerId:"phoneNumber"in n?"phone":null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Bk extends df{constructor(e,i,a,l){var d;super(i.code,i.message),this.operationType=a,this.user=l,Object.setPrototypeOf(this,Bk.prototype),this.customData={appName:e.name,tenantId:(d=e.tenantId)!==null&&d!==void 0?d:void 0,_serverResponse:i.customData._serverResponse,operationType:a}}static _fromErrorAndOperation(e,i,a,l){return new Bk(e,i,a,l)}}function wre(n,e,i,a){return(e==="reauthenticate"?i._getReauthenticationResolver(n):i._getIdTokenResponse(n)).catch(d=>{throw d.code==="auth/multi-factor-auth-required"?Bk._fromErrorAndOperation(n,d,e,a):d})}async function LVe(n,e,i=!1){const a=await NR(n,e._linkToIdToken(n.auth,await n.getIdToken()),i);return Uy._forOperation(n,"link",a)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function xVe(n,e,i=!1){const{auth:a}=n;if(Al(a.app))return Promise.reject(Ip(a));const l="reauthenticate";try{const d=await NR(n,wre(a,l,e,n),i);Ln(d.idToken,a,"internal-error");const p=xj(d.idToken);Ln(p,a,"internal-error");const{sub:y}=p;return Ln(n.uid===y,a,"user-mismatch"),Uy._forOperation(n,l,d)}catch(d){throw(d==null?void 0:d.code)==="auth/user-not-found"&&xd(a,"user-mismatch"),d}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Rre(n,e,i=!1){if(Al(n.app))return Promise.reject(Ip(n));const a="signIn",l=await wre(n,a,e),d=await Uy._fromIdTokenResponse(n,a,l);return i||await n._updateCurrentUser(d.user),d}async function MVe(n,e){return Rre(Lg(n),e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Cre(n){const e=Lg(n);e._getPasswordPolicyInternal()&&await e._updatePasswordPolicy()}async function UVe(n,e,i){const a=Lg(n);await jk(a,{requestType:"PASSWORD_RESET",email:e,clientType:"CLIENT_TYPE_WEB"},"getOobCode",IVe)}async function VVe(n,e,i){if(Al(n.app))return Promise.reject(Ip(n));const a=Lg(n),p=await jk(a,{returnSecureToken:!0,email:e,password:i,clientType:"CLIENT_TYPE_WEB"},"signUpPassword",DVe).catch(v=>{throw v.code==="auth/password-does-not-meet-requirements"&&Cre(n),v}),y=await Uy._fromIdTokenResponse(a,"signIn",p);return await a._updateCurrentUser(y.user),y}function FVe(n,e,i){return Al(n.app)?Promise.reject(Ip(n)):MVe(xi(n),U0.credential(e,i)).catch(async a=>{throw a.code==="auth/password-does-not-meet-requirements"&&Cre(n),a})}async function bV(n,e){const i=xi(n),l={requestType:"VERIFY_EMAIL",idToken:await n.getIdToken()},{email:d}=await CVe(i.auth,l);d!==n.email&&await n.reload()}function jVe(n,e,i,a){return xi(n).onIdTokenChanged(e,i,a)}function BVe(n,e,i){return xi(n).beforeAuthStateChanged(e,i)}function WVe(n,e,i,a){return xi(n).onAuthStateChanged(e,i,a)}function zVe(n){return xi(n).signOut()}const Wk="__sak";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ire{constructor(e,i){this.storageRetriever=e,this.type=i}_isAvailable(){try{return this.storage?(this.storage.setItem(Wk,"1"),this.storage.removeItem(Wk),Promise.resolve(!0)):Promise.resolve(!1)}catch{return Promise.resolve(!1)}}_set(e,i){return this.storage.setItem(e,JSON.stringify(i)),Promise.resolve()}_get(e){const i=this.storage.getItem(e);return Promise.resolve(i?JSON.parse(i):null)}_remove(e){return this.storage.removeItem(e),Promise.resolve()}get storage(){return this.storageRetriever()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const GVe=1e3,HVe=10;class Are extends Ire{constructor(){super(()=>window.localStorage,"LOCAL"),this.boundEventHandler=(e,i)=>this.onStorageEvent(e,i),this.listeners={},this.localCache={},this.pollTimer=null,this.fallbackToPolling=_re(),this._shouldAllowMigration=!0}forAllChangedKeys(e){for(const i of Object.keys(this.listeners)){const a=this.storage.getItem(i),l=this.localCache[i];a!==l&&e(i,l,a)}}onStorageEvent(e,i=!1){if(!e.key){this.forAllChangedKeys((p,y,v)=>{this.notifyListeners(p,v)});return}const a=e.key;i?this.detachListener():this.stopPolling();const l=()=>{const p=this.storage.getItem(a);!i&&this.localCache[a]===p||this.notifyListeners(a,p)},d=this.storage.getItem(a);sVe()&&d!==e.newValue&&e.newValue!==e.oldValue?setTimeout(l,HVe):l()}notifyListeners(e,i){this.localCache[e]=i;const a=this.listeners[e];if(a)for(const l of Array.from(a))l(i&&JSON.parse(i))}startPolling(){this.stopPolling(),this.pollTimer=setInterval(()=>{this.forAllChangedKeys((e,i,a)=>{this.onStorageEvent(new StorageEvent("storage",{key:e,oldValue:i,newValue:a}),!0)})},GVe)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}attachListener(){window.addEventListener("storage",this.boundEventHandler)}detachListener(){window.removeEventListener("storage",this.boundEventHandler)}_addListener(e,i){Object.keys(this.listeners).length===0&&(this.fallbackToPolling?this.startPolling():this.attachListener()),this.listeners[e]||(this.listeners[e]=new Set,this.localCache[e]=this.storage.getItem(e)),this.listeners[e].add(i)}_removeListener(e,i){this.listeners[e]&&(this.listeners[e].delete(i),this.listeners[e].size===0&&delete this.listeners[e]),Object.keys(this.listeners).length===0&&(this.detachListener(),this.stopPolling())}async _set(e,i){await super._set(e,i),this.localCache[e]=JSON.stringify(i)}async _get(e){const i=await super._get(e);return this.localCache[e]=JSON.stringify(i),i}async _remove(e){await super._remove(e),delete this.localCache[e]}}Are.type="LOCAL";const $Ve=Are;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Pre extends Ire{constructor(){super(()=>window.sessionStorage,"SESSION")}_addListener(e,i){}_removeListener(e,i){}}Pre.type="SESSION";const Ore=Pre;/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function KVe(n){return Promise.all(n.map(async e=>{try{return{fulfilled:!0,value:await e}}catch(i){return{fulfilled:!1,reason:i}}}))}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class j1{constructor(e){this.eventTarget=e,this.handlersMap={},this.boundEventHandler=this.handleEvent.bind(this)}static _getInstance(e){const i=this.receivers.find(l=>l.isListeningto(e));if(i)return i;const a=new j1(e);return this.receivers.push(a),a}isListeningto(e){return this.eventTarget===e}async handleEvent(e){const i=e,{eventId:a,eventType:l,data:d}=i.data,p=this.handlersMap[l];if(!(p!=null&&p.size))return;i.ports[0].postMessage({status:"ack",eventId:a,eventType:l});const y=Array.from(p).map(async b=>b(i.origin,d)),v=await KVe(y);i.ports[0].postMessage({status:"done",eventId:a,eventType:l,response:v})}_subscribe(e,i){Object.keys(this.handlersMap).length===0&&this.eventTarget.addEventListener("message",this.boundEventHandler),this.handlersMap[e]||(this.handlersMap[e]=new Set),this.handlersMap[e].add(i)}_unsubscribe(e,i){this.handlersMap[e]&&i&&this.handlersMap[e].delete(i),(!i||this.handlersMap[e].size===0)&&delete this.handlersMap[e],Object.keys(this.handlersMap).length===0&&this.eventTarget.removeEventListener("message",this.boundEventHandler)}}j1.receivers=[];/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Fj(n="",e=10){let i="";for(let a=0;a<e;a++)i+=Math.floor(Math.random()*10);return n+i}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class qVe{constructor(e){this.target=e,this.handlers=new Set}removeMessageHandler(e){e.messageChannel&&(e.messageChannel.port1.removeEventListener("message",e.onMessage),e.messageChannel.port1.close()),this.handlers.delete(e)}async _send(e,i,a=50){const l=typeof MessageChannel<"u"?new MessageChannel:null;if(!l)throw new Error("connection_unavailable");let d,p;return new Promise((y,v)=>{const b=Fj("",20);l.port1.start();const w=setTimeout(()=>{v(new Error("unsupported_event"))},a);p={messageChannel:l,onMessage(A){const N=A;if(N.data.eventId===b)switch(N.data.status){case"ack":clearTimeout(w),d=setTimeout(()=>{v(new Error("timeout"))},3e3);break;case"done":clearTimeout(d),y(N.data.response);break;default:clearTimeout(w),clearTimeout(d),v(new Error("invalid_response"));break}}},this.handlers.add(p),l.port1.addEventListener("message",p.onMessage),this.target.postMessage({eventType:e,eventId:b,data:i},[l.port2])}).finally(()=>{p&&this.removeMessageHandler(p)})}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ef(){return window}function YVe(n){ef().location.href=n}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function kre(){return typeof ef().WorkerGlobalScope<"u"&&typeof ef().importScripts=="function"}async function XVe(){if(!(navigator!=null&&navigator.serviceWorker))return null;try{return(await navigator.serviceWorker.ready).active}catch{return null}}function JVe(){var n;return((n=navigator==null?void 0:navigator.serviceWorker)===null||n===void 0?void 0:n.controller)||null}function QVe(){return kre()?self:null}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Nre="firebaseLocalStorageDb",ZVe=1,zk="firebaseLocalStorage",Dre="fbase_key";class fC{constructor(e){this.request=e}toPromise(){return new Promise((e,i)=>{this.request.addEventListener("success",()=>{e(this.request.result)}),this.request.addEventListener("error",()=>{i(this.request.error)})})}}function B1(n,e){return n.transaction([zk],e?"readwrite":"readonly").objectStore(zk)}function eFe(){const n=indexedDB.deleteDatabase(Nre);return new fC(n).toPromise()}function TV(){const n=indexedDB.open(Nre,ZVe);return new Promise((e,i)=>{n.addEventListener("error",()=>{i(n.error)}),n.addEventListener("upgradeneeded",()=>{const a=n.result;try{a.createObjectStore(zk,{keyPath:Dre})}catch(l){i(l)}}),n.addEventListener("success",async()=>{const a=n.result;a.objectStoreNames.contains(zk)?e(a):(a.close(),await eFe(),e(await TV()))})})}async function cX(n,e,i){const a=B1(n,!0).put({[Dre]:e,value:i});return new fC(a).toPromise()}async function tFe(n,e){const i=B1(n,!1).get(e),a=await new fC(i).toPromise();return a===void 0?null:a.value}function lX(n,e){const i=B1(n,!0).delete(e);return new fC(i).toPromise()}const nFe=800,rFe=3;class Lre{constructor(){this.type="LOCAL",this._shouldAllowMigration=!0,this.listeners={},this.localCache={},this.pollTimer=null,this.pendingWrites=0,this.receiver=null,this.sender=null,this.serviceWorkerReceiverAvailable=!1,this.activeServiceWorker=null,this._workerInitializationPromise=this.initializeServiceWorkerMessaging().then(()=>{},()=>{})}async _openDb(){return this.db?this.db:(this.db=await TV(),this.db)}async _withRetries(e){let i=0;for(;;)try{const a=await this._openDb();return await e(a)}catch(a){if(i++>rFe)throw a;this.db&&(this.db.close(),this.db=void 0)}}async initializeServiceWorkerMessaging(){return kre()?this.initializeReceiver():this.initializeSender()}async initializeReceiver(){this.receiver=j1._getInstance(QVe()),this.receiver._subscribe("keyChanged",async(e,i)=>({keyProcessed:(await this._poll()).includes(i.key)})),this.receiver._subscribe("ping",async(e,i)=>["keyChanged"])}async initializeSender(){var e,i;if(this.activeServiceWorker=await XVe(),!this.activeServiceWorker)return;this.sender=new qVe(this.activeServiceWorker);const a=await this.sender._send("ping",{},800);a&&!((e=a[0])===null||e===void 0)&&e.fulfilled&&!((i=a[0])===null||i===void 0)&&i.value.includes("keyChanged")&&(this.serviceWorkerReceiverAvailable=!0)}async notifyServiceWorker(e){if(!(!this.sender||!this.activeServiceWorker||JVe()!==this.activeServiceWorker))try{await this.sender._send("keyChanged",{key:e},this.serviceWorkerReceiverAvailable?800:50)}catch{}}async _isAvailable(){try{if(!indexedDB)return!1;const e=await TV();return await cX(e,Wk,"1"),await lX(e,Wk),!0}catch{}return!1}async _withPendingWrite(e){this.pendingWrites++;try{await e()}finally{this.pendingWrites--}}async _set(e,i){return this._withPendingWrite(async()=>(await this._withRetries(a=>cX(a,e,i)),this.localCache[e]=i,this.notifyServiceWorker(e)))}async _get(e){const i=await this._withRetries(a=>tFe(a,e));return this.localCache[e]=i,i}async _remove(e){return this._withPendingWrite(async()=>(await this._withRetries(i=>lX(i,e)),delete this.localCache[e],this.notifyServiceWorker(e)))}async _poll(){const e=await this._withRetries(l=>{const d=B1(l,!1).getAll();return new fC(d).toPromise()});if(!e)return[];if(this.pendingWrites!==0)return[];const i=[],a=new Set;if(e.length!==0)for(const{fbase_key:l,value:d}of e)a.add(l),JSON.stringify(this.localCache[l])!==JSON.stringify(d)&&(this.notifyListeners(l,d),i.push(l));for(const l of Object.keys(this.localCache))this.localCache[l]&&!a.has(l)&&(this.notifyListeners(l,null),i.push(l));return i}notifyListeners(e,i){this.localCache[e]=i;const a=this.listeners[e];if(a)for(const l of Array.from(a))l(i)}startPolling(){this.stopPolling(),this.pollTimer=setInterval(async()=>this._poll(),nFe)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}_addListener(e,i){Object.keys(this.listeners).length===0&&this.startPolling(),this.listeners[e]||(this.listeners[e]=new Set,this._get(e)),this.listeners[e].add(i)}_removeListener(e,i){this.listeners[e]&&(this.listeners[e].delete(i),this.listeners[e].size===0&&delete this.listeners[e]),Object.keys(this.listeners).length===0&&this.stopPolling()}}Lre.type="LOCAL";const iFe=Lre;new uC(3e4,6e4);/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function sFe(n,e){return e?vp(e):(Ln(n._popupRedirectResolver,n,"argument-error"),n._popupRedirectResolver)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class jj extends Uj{constructor(e){super("custom","custom"),this.params=e}_getIdTokenResponse(e){return ZS(e,this._buildIdpRequest())}_linkToIdToken(e,i){return ZS(e,this._buildIdpRequest(i))}_getReauthenticationResolver(e){return ZS(e,this._buildIdpRequest())}_buildIdpRequest(e){const i={requestUri:this.params.requestUri,sessionId:this.params.sessionId,postBody:this.params.postBody,tenantId:this.params.tenantId,pendingToken:this.params.pendingToken,returnSecureToken:!0,returnIdpCredential:!0};return e&&(i.idToken=e),i}}function oFe(n){return Rre(n.auth,new jj(n),n.bypassAuthState)}function aFe(n){const{auth:e,user:i}=n;return Ln(i,e,"internal-error"),xVe(i,new jj(n),n.bypassAuthState)}async function cFe(n){const{auth:e,user:i}=n;return Ln(i,e,"internal-error"),LVe(i,new jj(n),n.bypassAuthState)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class xre{constructor(e,i,a,l,d=!1){this.auth=e,this.resolver=a,this.user=l,this.bypassAuthState=d,this.pendingPromise=null,this.eventManager=null,this.filter=Array.isArray(i)?i:[i]}execute(){return new Promise(async(e,i)=>{this.pendingPromise={resolve:e,reject:i};try{this.eventManager=await this.resolver._initialize(this.auth),await this.onExecution(),this.eventManager.registerConsumer(this)}catch(a){this.reject(a)}})}async onAuthEvent(e){const{urlResponse:i,sessionId:a,postBody:l,tenantId:d,error:p,type:y}=e;if(p){this.reject(p);return}const v={auth:this.auth,requestUri:i,sessionId:a,tenantId:d||void 0,postBody:l||void 0,user:this.user,bypassAuthState:this.bypassAuthState};try{this.resolve(await this.getIdpTask(y)(v))}catch(b){this.reject(b)}}onError(e){this.reject(e)}getIdpTask(e){switch(e){case"signInViaPopup":case"signInViaRedirect":return oFe;case"linkViaPopup":case"linkViaRedirect":return cFe;case"reauthViaPopup":case"reauthViaRedirect":return aFe;default:xd(this.auth,"internal-error")}}resolve(e){Lp(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.resolve(e),this.unregisterAndCleanUp()}reject(e){Lp(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.reject(e),this.unregisterAndCleanUp()}unregisterAndCleanUp(){this.eventManager&&this.eventManager.unregisterConsumer(this),this.pendingPromise=null,this.cleanUp()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const lFe=new uC(2e3,1e4);class VS extends xre{constructor(e,i,a,l,d){super(e,i,l,d),this.provider=a,this.authWindow=null,this.pollId=null,VS.currentPopupAction&&VS.currentPopupAction.cancel(),VS.currentPopupAction=this}async executeNotNull(){const e=await this.execute();return Ln(e,this.auth,"internal-error"),e}async onExecution(){Lp(this.filter.length===1,"Popup operations only handle one event");const e=Fj();this.authWindow=await this.resolver._openPopup(this.auth,this.provider,this.filter[0],e),this.authWindow.associatedEvent=e,this.resolver._originValidation(this.auth).catch(i=>{this.reject(i)}),this.resolver._isIframeWebStorageSupported(this.auth,i=>{i||this.reject(Zh(this.auth,"web-storage-unsupported"))}),this.pollUserCancellation()}get eventId(){var e;return((e=this.authWindow)===null||e===void 0?void 0:e.associatedEvent)||null}cancel(){this.reject(Zh(this.auth,"cancelled-popup-request"))}cleanUp(){this.authWindow&&this.authWindow.close(),this.pollId&&window.clearTimeout(this.pollId),this.authWindow=null,this.pollId=null,VS.currentPopupAction=null}pollUserCancellation(){const e=()=>{var i,a;if(!((a=(i=this.authWindow)===null||i===void 0?void 0:i.window)===null||a===void 0)&&a.closed){this.pollId=window.setTimeout(()=>{this.pollId=null,this.reject(Zh(this.auth,"popup-closed-by-user"))},8e3);return}this.pollId=window.setTimeout(e,lFe.get())};e()}}VS.currentPopupAction=null;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const uFe="pendingRedirect",ck=new Map;class dFe extends xre{constructor(e,i,a=!1){super(e,["signInViaRedirect","linkViaRedirect","reauthViaRedirect","unknown"],i,void 0,a),this.eventId=null}async execute(){let e=ck.get(this.auth._key());if(!e){try{const a=await hFe(this.resolver,this.auth)?await super.execute():null;e=()=>Promise.resolve(a)}catch(i){e=()=>Promise.reject(i)}ck.set(this.auth._key(),e)}return this.bypassAuthState||ck.set(this.auth._key(),()=>Promise.resolve(null)),e()}async onAuthEvent(e){if(e.type==="signInViaRedirect")return super.onAuthEvent(e);if(e.type==="unknown"){this.resolve(null);return}if(e.eventId){const i=await this.auth._redirectUserForId(e.eventId);if(i)return this.user=i,super.onAuthEvent(e);this.resolve(null)}}async onExecution(){}cleanUp(){}}async function hFe(n,e){const i=mFe(e),a=pFe(n);if(!await a._isAvailable())return!1;const l=await a._get(i)==="true";return await a._remove(i),l}function fFe(n,e){ck.set(n._key(),e)}function pFe(n){return vp(n._redirectPersistence)}function mFe(n){return ak(uFe,n.config.apiKey,n.name)}async function gFe(n,e,i=!1){if(Al(n.app))return Promise.reject(Ip(n));const a=Lg(n),l=sFe(a,e),p=await new dFe(a,l,i).execute();return p&&!i&&(delete p.user._redirectEventId,await a._persistUserIfCurrent(p.user),await a._setRedirectUser(null,e)),p}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const _Fe=10*60*1e3;class yFe{constructor(e){this.auth=e,this.cachedEventUids=new Set,this.consumers=new Set,this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1,this.lastProcessedEventTime=Date.now()}registerConsumer(e){this.consumers.add(e),this.queuedRedirectEvent&&this.isEventForConsumer(this.queuedRedirectEvent,e)&&(this.sendToConsumer(this.queuedRedirectEvent,e),this.saveEventToCache(this.queuedRedirectEvent),this.queuedRedirectEvent=null)}unregisterConsumer(e){this.consumers.delete(e)}onEvent(e){if(this.hasEventBeenHandled(e))return!1;let i=!1;return this.consumers.forEach(a=>{this.isEventForConsumer(e,a)&&(i=!0,this.sendToConsumer(e,a),this.saveEventToCache(e))}),this.hasHandledPotentialRedirect||!EFe(e)||(this.hasHandledPotentialRedirect=!0,i||(this.queuedRedirectEvent=e,i=!0)),i}sendToConsumer(e,i){var a;if(e.error&&!Mre(e)){const l=((a=e.error.code)===null||a===void 0?void 0:a.split("auth/")[1])||"internal-error";i.onError(Zh(this.auth,l))}else i.onAuthEvent(e)}isEventForConsumer(e,i){const a=i.eventId===null||!!e.eventId&&e.eventId===i.eventId;return i.filter.includes(e.type)&&a}hasEventBeenHandled(e){return Date.now()-this.lastProcessedEventTime>=_Fe&&this.cachedEventUids.clear(),this.cachedEventUids.has(uX(e))}saveEventToCache(e){this.cachedEventUids.add(uX(e)),this.lastProcessedEventTime=Date.now()}}function uX(n){return[n.type,n.eventId,n.sessionId,n.tenantId].filter(e=>e).join("-")}function Mre({type:n,error:e}){return n==="unknown"&&(e==null?void 0:e.code)==="auth/no-auth-event"}function EFe(n){switch(n.type){case"signInViaRedirect":case"linkViaRedirect":case"reauthViaRedirect":return!0;case"unknown":return Mre(n);default:return!1}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function vFe(n,e={}){return Vp(n,"GET","/v1/projects",e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const SFe=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,bFe=/^https?/;async function TFe(n){if(n.config.emulator)return;const{authorizedDomains:e}=await vFe(n);for(const i of e)try{if(wFe(i))return}catch{}xd(n,"unauthorized-domain")}function wFe(n){const e=vV(),{protocol:i,hostname:a}=new URL(e);if(n.startsWith("chrome-extension://")){const p=new URL(n);return p.hostname===""&&a===""?i==="chrome-extension:"&&n.replace("chrome-extension://","")===e.replace("chrome-extension://",""):i==="chrome-extension:"&&p.hostname===a}if(!bFe.test(i))return!1;if(SFe.test(n))return a===n;const l=n.replace(/\./g,"\\.");return new RegExp("^(.+\\."+l+"|"+l+")$","i").test(a)}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const RFe=new uC(3e4,6e4);function dX(){const n=ef().___jsl;if(n!=null&&n.H){for(const e of Object.keys(n.H))if(n.H[e].r=n.H[e].r||[],n.H[e].L=n.H[e].L||[],n.H[e].r=[...n.H[e].L],n.CP)for(let i=0;i<n.CP.length;i++)n.CP[i]=null}}function CFe(n){return new Promise((e,i)=>{var a,l,d;function p(){dX(),gapi.load("gapi.iframes",{callback:()=>{e(gapi.iframes.getContext())},ontimeout:()=>{dX(),i(Zh(n,"network-request-failed"))},timeout:RFe.get()})}if(!((l=(a=ef().gapi)===null||a===void 0?void 0:a.iframes)===null||l===void 0)&&l.Iframe)e(gapi.iframes.getContext());else if(!((d=ef().gapi)===null||d===void 0)&&d.load)p();else{const y=pVe("iframefcb");return ef()[y]=()=>{gapi.load?p():i(Zh(n,"network-request-failed"))},Ere(`${fVe()}?onload=${y}`).catch(v=>i(v))}}).catch(e=>{throw lk=null,e})}let lk=null;function IFe(n){return lk=lk||CFe(n),lk}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const AFe=new uC(5e3,15e3),PFe="__/auth/iframe",OFe="emulator/auth/iframe",kFe={style:{position:"absolute",top:"-100px",width:"1px",height:"1px"},"aria-hidden":"true",tabindex:"-1"},NFe=new Map([["identitytoolkit.googleapis.com","p"],["staging-identitytoolkit.sandbox.googleapis.com","s"],["test-identitytoolkit.sandbox.googleapis.com","t"]]);function DFe(n){const e=n.config;Ln(e.authDomain,n,"auth-domain-config-required");const i=e.emulator?Lj(e,OFe):`https://${n.config.authDomain}/${PFe}`,a={apiKey:e.apiKey,appName:n.name,v:Gy},l=NFe.get(n.config.apiHost);l&&(a.eid=l);const d=n._getFrameworks();return d.length&&(a.fw=d.join(",")),`${i}?${lC(a).slice(1)}`}async function LFe(n){const e=await IFe(n),i=ef().gapi;return Ln(i,n,"internal-error"),e.open({where:document.body,url:DFe(n),messageHandlersFilter:i.iframes.CROSS_ORIGIN_IFRAMES_FILTER,attributes:kFe,dontclear:!0},a=>new Promise(async(l,d)=>{await a.restyle({setHideOnLeave:!1});const p=Zh(n,"network-request-failed"),y=ef().setTimeout(()=>{d(p)},AFe.get());function v(){ef().clearTimeout(y),l(a)}a.ping(v).then(v,()=>{d(p)})}))}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const xFe={location:"yes",resizable:"yes",statusbar:"yes",toolbar:"no"},MFe=500,UFe=600,VFe="_blank",FFe="http://localhost";class hX{constructor(e){this.window=e,this.associatedEvent=null}close(){if(this.window)try{this.window.close()}catch{}}}function jFe(n,e,i,a=MFe,l=UFe){const d=Math.max((window.screen.availHeight-l)/2,0).toString(),p=Math.max((window.screen.availWidth-a)/2,0).toString();let y="";const v=Object.assign(Object.assign({},xFe),{width:a.toString(),height:l.toString(),top:d,left:p}),b=Ba().toLowerCase();i&&(y=hre(b)?VFe:i),ure(b)&&(e=e||FFe,v.scrollbars="yes");const w=Object.entries(v).reduce((N,[V,j])=>`${N}${V}=${j},`,"");if(iVe(b)&&y!=="_self")return BFe(e||"",y),new hX(null);const A=window.open(e||"",y,w);Ln(A,n,"popup-blocked");try{A.focus()}catch{}return new hX(A)}function BFe(n,e){const i=document.createElement("a");i.href=n,i.target=e;const a=document.createEvent("MouseEvent");a.initMouseEvent("click",!0,!0,window,1,0,0,0,0,!1,!1,!1,!1,1,null),i.dispatchEvent(a)}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const WFe="__/auth/handler",zFe="emulator/auth/handler",GFe=encodeURIComponent("fac");async function fX(n,e,i,a,l,d){Ln(n.config.authDomain,n,"auth-domain-config-required"),Ln(n.config.apiKey,n,"invalid-api-key");const p={apiKey:n.config.apiKey,appName:n.name,authType:i,redirectUrl:a,v:Gy,eventId:l};if(e instanceof Tre){e.setDefaultLanguage(n.languageCode),p.providerId=e.providerId||"",I2e(e.getCustomParameters())||(p.customParameters=JSON.stringify(e.getCustomParameters()));for(const[w,A]of Object.entries({}))p[w]=A}if(e instanceof hC){const w=e.getScopes().filter(A=>A!=="");w.length>0&&(p.scopes=w.join(","))}n.tenantId&&(p.tid=n.tenantId);const y=p;for(const w of Object.keys(y))y[w]===void 0&&delete y[w];const v=await n._getAppCheckToken(),b=v?`#${GFe}=${encodeURIComponent(v)}`:"";return`${HFe(n)}?${lC(y).slice(1)}${b}`}function HFe({config:n}){return n.emulator?Lj(n,zFe):`https://${n.authDomain}/${WFe}`}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Z2="webStorageSupport";class $Fe{constructor(){this.eventManagers={},this.iframes={},this.originValidationPromises={},this._redirectPersistence=Ore,this._completeRedirectFn=gFe,this._overrideRedirectResult=fFe}async _openPopup(e,i,a,l){var d;Lp((d=this.eventManagers[e._key()])===null||d===void 0?void 0:d.manager,"_initialize() not called before _openPopup()");const p=await fX(e,i,a,vV(),l);return jFe(e,p,Fj())}async _openRedirect(e,i,a,l){await this._originValidation(e);const d=await fX(e,i,a,vV(),l);return YVe(d),new Promise(()=>{})}_initialize(e){const i=e._key();if(this.eventManagers[i]){const{manager:l,promise:d}=this.eventManagers[i];return l?Promise.resolve(l):(Lp(d,"If manager is not set, promise should be"),d)}const a=this.initAndGetManager(e);return this.eventManagers[i]={promise:a},a.catch(()=>{delete this.eventManagers[i]}),a}async initAndGetManager(e){const i=await LFe(e),a=new yFe(e);return i.register("authEvent",l=>(Ln(l==null?void 0:l.authEvent,e,"invalid-auth-event"),{status:a.onEvent(l.authEvent)?"ACK":"ERROR"}),gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER),this.eventManagers[e._key()]={manager:a},this.iframes[e._key()]=i,a}_isIframeWebStorageSupported(e,i){this.iframes[e._key()].send(Z2,{type:Z2},l=>{var d;const p=(d=l==null?void 0:l[0])===null||d===void 0?void 0:d[Z2];p!==void 0&&i(!!p),xd(e,"internal-error")},gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER)}_originValidation(e){const i=e._key();return this.originValidationPromises[i]||(this.originValidationPromises[i]=TFe(e)),this.originValidationPromises[i]}get _shouldInitProactively(){return _re()||dre()||Mj()}}const KFe=$Fe;var pX="@firebase/auth",mX="1.9.1";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class qFe{constructor(e){this.auth=e,this.internalListeners=new Map}getUid(){var e;return this.assertAuthConfigured(),((e=this.auth.currentUser)===null||e===void 0?void 0:e.uid)||null}async getToken(e){return this.assertAuthConfigured(),await this.auth._initializationPromise,this.auth.currentUser?{accessToken:await this.auth.currentUser.getIdToken(e)}:null}addAuthTokenListener(e){if(this.assertAuthConfigured(),this.internalListeners.has(e))return;const i=this.auth.onIdTokenChanged(a=>{e((a==null?void 0:a.stsTokenManager.accessToken)||null)});this.internalListeners.set(e,i),this.updateProactiveRefresh()}removeAuthTokenListener(e){this.assertAuthConfigured();const i=this.internalListeners.get(e);i&&(this.internalListeners.delete(e),i(),this.updateProactiveRefresh())}assertAuthConfigured(){Ln(this.auth._initializationPromise,"dependent-sdk-initialized-before-auth")}updateProactiveRefresh(){this.internalListeners.size>0?this.auth._startProactiveRefresh():this.auth._stopProactiveRefresh()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function YFe(n){switch(n){case"Node":return"node";case"ReactNative":return"rn";case"Worker":return"webworker";case"Cordova":return"cordova";case"WebExtension":return"web-extension";default:return}}function XFe(n){xy(new Tg("auth",(e,{options:i})=>{const a=e.getProvider("app").getImmediate(),l=e.getProvider("heartbeat"),d=e.getProvider("app-check-internal"),{apiKey:p,authDomain:y}=a.options;Ln(p&&!p.includes(":"),"invalid-api-key",{appName:a.name});const v={apiKey:p,authDomain:y,clientPlatform:n,apiHost:"identitytoolkit.googleapis.com",tokenApiHost:"securetoken.googleapis.com",apiScheme:"https",sdkClientVersion:yre(n)},b=new uVe(a,l,d,v);return vVe(b,i),b},"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((e,i,a)=>{e.getProvider("auth-internal").initialize()})),xy(new Tg("auth-internal",e=>{const i=Lg(e.getProvider("auth").getImmediate());return(a=>new qFe(a))(i)},"PRIVATE").setInstantiationMode("EXPLICIT")),Qh(pX,mX,YFe(n)),Qh(pX,mX,"esm2017")}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const JFe=5*60,QFe=qne("authIdTokenMaxAge")||JFe;let gX=null;const ZFe=n=>async e=>{const i=e&&await e.getIdTokenResult(),a=i&&(new Date().getTime()-Date.parse(i.issuedAtTime))/1e3;if(a&&a>QFe)return;const l=i==null?void 0:i.token;gX!==l&&(gX=l,await fetch(n,{method:l?"POST":"DELETE",headers:l?{Authorization:`Bearer ${l}`}:{}}))};function Ure(n=Nj()){const e=V1(n,"auth");if(e.isInitialized())return e.getImmediate();const i=EVe(n,{popupRedirectResolver:KFe,persistence:[iFe,$Ve,Ore]}),a=qne("authTokenSyncURL");if(a&&typeof isSecureContext=="boolean"&&isSecureContext){const d=new URL(a,location.origin);if(location.origin===d.origin){const p=ZFe(d.toString());BVe(i,p,()=>p(i.currentUser)),jVe(i,y=>p(y))}}const l=Hne("auth");return l&&SVe(i,`http://${l}`),i}function eje(){var n,e;return(e=(n=document.getElementsByTagName("head"))===null||n===void 0?void 0:n[0])!==null&&e!==void 0?e:document}dVe({loadJS(n){return new Promise((e,i)=>{const a=document.createElement("script");a.setAttribute("src",n),a.onload=e,a.onerror=l=>{const d=Zh("internal-error");d.customData=l,i(d)},a.type="text/javascript",a.charset="UTF-8",eje().appendChild(a)})},gapiScript:"https://apis.google.com/js/api.js",recaptchaV2Script:"https://www.google.com/recaptcha/api.js",recaptchaEnterpriseScript:"https://www.google.com/recaptcha/enterprise.js?render="});XFe("Browser");var _X=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};/** @license
Copyright The Closure Library Authors.
SPDX-License-Identifier: Apache-2.0
*/var mg,Vre;(function(){var n;/** @license

 Copyright The Closure Library Authors.
 SPDX-License-Identifier: Apache-2.0
*/function e(te,Z){function J(){}J.prototype=Z.prototype,te.D=Z.prototype,te.prototype=new J,te.prototype.constructor=te,te.C=function(se,he,fe){for(var ue=Array(arguments.length-2),Me=2;Me<arguments.length;Me++)ue[Me-2]=arguments[Me];return Z.prototype[he].apply(se,ue)}}function i(){this.blockSize=-1}function a(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.B=Array(this.blockSize),this.o=this.h=0,this.s()}e(a,i),a.prototype.s=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.o=this.h=0};function l(te,Z,J){J||(J=0);var se=Array(16);if(typeof Z=="string")for(var he=0;16>he;++he)se[he]=Z.charCodeAt(J++)|Z.charCodeAt(J++)<<8|Z.charCodeAt(J++)<<16|Z.charCodeAt(J++)<<24;else for(he=0;16>he;++he)se[he]=Z[J++]|Z[J++]<<8|Z[J++]<<16|Z[J++]<<24;Z=te.g[0],J=te.g[1],he=te.g[2];var fe=te.g[3],ue=Z+(fe^J&(he^fe))+se[0]+3614090360&4294967295;Z=J+(ue<<7&4294967295|ue>>>25),ue=fe+(he^Z&(J^he))+se[1]+3905402710&4294967295,fe=Z+(ue<<12&4294967295|ue>>>20),ue=he+(J^fe&(Z^J))+se[2]+606105819&4294967295,he=fe+(ue<<17&4294967295|ue>>>15),ue=J+(Z^he&(fe^Z))+se[3]+3250441966&4294967295,J=he+(ue<<22&4294967295|ue>>>10),ue=Z+(fe^J&(he^fe))+se[4]+4118548399&4294967295,Z=J+(ue<<7&4294967295|ue>>>25),ue=fe+(he^Z&(J^he))+se[5]+1200080426&4294967295,fe=Z+(ue<<12&4294967295|ue>>>20),ue=he+(J^fe&(Z^J))+se[6]+2821735955&4294967295,he=fe+(ue<<17&4294967295|ue>>>15),ue=J+(Z^he&(fe^Z))+se[7]+4249261313&4294967295,J=he+(ue<<22&4294967295|ue>>>10),ue=Z+(fe^J&(he^fe))+se[8]+1770035416&4294967295,Z=J+(ue<<7&4294967295|ue>>>25),ue=fe+(he^Z&(J^he))+se[9]+2336552879&4294967295,fe=Z+(ue<<12&4294967295|ue>>>20),ue=he+(J^fe&(Z^J))+se[10]+4294925233&4294967295,he=fe+(ue<<17&4294967295|ue>>>15),ue=J+(Z^he&(fe^Z))+se[11]+2304563134&4294967295,J=he+(ue<<22&4294967295|ue>>>10),ue=Z+(fe^J&(he^fe))+se[12]+1804603682&4294967295,Z=J+(ue<<7&4294967295|ue>>>25),ue=fe+(he^Z&(J^he))+se[13]+4254626195&4294967295,fe=Z+(ue<<12&4294967295|ue>>>20),ue=he+(J^fe&(Z^J))+se[14]+2792965006&4294967295,he=fe+(ue<<17&4294967295|ue>>>15),ue=J+(Z^he&(fe^Z))+se[15]+1236535329&4294967295,J=he+(ue<<22&4294967295|ue>>>10),ue=Z+(he^fe&(J^he))+se[1]+4129170786&4294967295,Z=J+(ue<<5&4294967295|ue>>>27),ue=fe+(J^he&(Z^J))+se[6]+3225465664&4294967295,fe=Z+(ue<<9&4294967295|ue>>>23),ue=he+(Z^J&(fe^Z))+se[11]+643717713&4294967295,he=fe+(ue<<14&4294967295|ue>>>18),ue=J+(fe^Z&(he^fe))+se[0]+3921069994&4294967295,J=he+(ue<<20&4294967295|ue>>>12),ue=Z+(he^fe&(J^he))+se[5]+3593408605&4294967295,Z=J+(ue<<5&4294967295|ue>>>27),ue=fe+(J^he&(Z^J))+se[10]+38016083&4294967295,fe=Z+(ue<<9&4294967295|ue>>>23),ue=he+(Z^J&(fe^Z))+se[15]+3634488961&4294967295,he=fe+(ue<<14&4294967295|ue>>>18),ue=J+(fe^Z&(he^fe))+se[4]+3889429448&4294967295,J=he+(ue<<20&4294967295|ue>>>12),ue=Z+(he^fe&(J^he))+se[9]+568446438&4294967295,Z=J+(ue<<5&4294967295|ue>>>27),ue=fe+(J^he&(Z^J))+se[14]+3275163606&4294967295,fe=Z+(ue<<9&4294967295|ue>>>23),ue=he+(Z^J&(fe^Z))+se[3]+4107603335&4294967295,he=fe+(ue<<14&4294967295|ue>>>18),ue=J+(fe^Z&(he^fe))+se[8]+1163531501&4294967295,J=he+(ue<<20&4294967295|ue>>>12),ue=Z+(he^fe&(J^he))+se[13]+2850285829&4294967295,Z=J+(ue<<5&4294967295|ue>>>27),ue=fe+(J^he&(Z^J))+se[2]+4243563512&4294967295,fe=Z+(ue<<9&4294967295|ue>>>23),ue=he+(Z^J&(fe^Z))+se[7]+1735328473&4294967295,he=fe+(ue<<14&4294967295|ue>>>18),ue=J+(fe^Z&(he^fe))+se[12]+2368359562&4294967295,J=he+(ue<<20&4294967295|ue>>>12),ue=Z+(J^he^fe)+se[5]+4294588738&4294967295,Z=J+(ue<<4&4294967295|ue>>>28),ue=fe+(Z^J^he)+se[8]+2272392833&4294967295,fe=Z+(ue<<11&4294967295|ue>>>21),ue=he+(fe^Z^J)+se[11]+1839030562&4294967295,he=fe+(ue<<16&4294967295|ue>>>16),ue=J+(he^fe^Z)+se[14]+4259657740&4294967295,J=he+(ue<<23&4294967295|ue>>>9),ue=Z+(J^he^fe)+se[1]+2763975236&4294967295,Z=J+(ue<<4&4294967295|ue>>>28),ue=fe+(Z^J^he)+se[4]+1272893353&4294967295,fe=Z+(ue<<11&4294967295|ue>>>21),ue=he+(fe^Z^J)+se[7]+4139469664&4294967295,he=fe+(ue<<16&4294967295|ue>>>16),ue=J+(he^fe^Z)+se[10]+3200236656&4294967295,J=he+(ue<<23&4294967295|ue>>>9),ue=Z+(J^he^fe)+se[13]+681279174&4294967295,Z=J+(ue<<4&4294967295|ue>>>28),ue=fe+(Z^J^he)+se[0]+3936430074&4294967295,fe=Z+(ue<<11&4294967295|ue>>>21),ue=he+(fe^Z^J)+se[3]+3572445317&4294967295,he=fe+(ue<<16&4294967295|ue>>>16),ue=J+(he^fe^Z)+se[6]+76029189&4294967295,J=he+(ue<<23&4294967295|ue>>>9),ue=Z+(J^he^fe)+se[9]+3654602809&4294967295,Z=J+(ue<<4&4294967295|ue>>>28),ue=fe+(Z^J^he)+se[12]+3873151461&4294967295,fe=Z+(ue<<11&4294967295|ue>>>21),ue=he+(fe^Z^J)+se[15]+530742520&4294967295,he=fe+(ue<<16&4294967295|ue>>>16),ue=J+(he^fe^Z)+se[2]+3299628645&4294967295,J=he+(ue<<23&4294967295|ue>>>9),ue=Z+(he^(J|~fe))+se[0]+4096336452&4294967295,Z=J+(ue<<6&4294967295|ue>>>26),ue=fe+(J^(Z|~he))+se[7]+1126891415&4294967295,fe=Z+(ue<<10&4294967295|ue>>>22),ue=he+(Z^(fe|~J))+se[14]+2878612391&4294967295,he=fe+(ue<<15&4294967295|ue>>>17),ue=J+(fe^(he|~Z))+se[5]+4237533241&4294967295,J=he+(ue<<21&4294967295|ue>>>11),ue=Z+(he^(J|~fe))+se[12]+1700485571&4294967295,Z=J+(ue<<6&4294967295|ue>>>26),ue=fe+(J^(Z|~he))+se[3]+2399980690&4294967295,fe=Z+(ue<<10&4294967295|ue>>>22),ue=he+(Z^(fe|~J))+se[10]+4293915773&4294967295,he=fe+(ue<<15&4294967295|ue>>>17),ue=J+(fe^(he|~Z))+se[1]+2240044497&4294967295,J=he+(ue<<21&4294967295|ue>>>11),ue=Z+(he^(J|~fe))+se[8]+1873313359&4294967295,Z=J+(ue<<6&4294967295|ue>>>26),ue=fe+(J^(Z|~he))+se[15]+4264355552&4294967295,fe=Z+(ue<<10&4294967295|ue>>>22),ue=he+(Z^(fe|~J))+se[6]+2734768916&4294967295,he=fe+(ue<<15&4294967295|ue>>>17),ue=J+(fe^(he|~Z))+se[13]+1309151649&4294967295,J=he+(ue<<21&4294967295|ue>>>11),ue=Z+(he^(J|~fe))+se[4]+4149444226&4294967295,Z=J+(ue<<6&4294967295|ue>>>26),ue=fe+(J^(Z|~he))+se[11]+3174756917&4294967295,fe=Z+(ue<<10&4294967295|ue>>>22),ue=he+(Z^(fe|~J))+se[2]+718787259&4294967295,he=fe+(ue<<15&4294967295|ue>>>17),ue=J+(fe^(he|~Z))+se[9]+3951481745&4294967295,te.g[0]=te.g[0]+Z&4294967295,te.g[1]=te.g[1]+(he+(ue<<21&4294967295|ue>>>11))&4294967295,te.g[2]=te.g[2]+he&4294967295,te.g[3]=te.g[3]+fe&4294967295}a.prototype.u=function(te,Z){Z===void 0&&(Z=te.length);for(var J=Z-this.blockSize,se=this.B,he=this.h,fe=0;fe<Z;){if(he==0)for(;fe<=J;)l(this,te,fe),fe+=this.blockSize;if(typeof te=="string"){for(;fe<Z;)if(se[he++]=te.charCodeAt(fe++),he==this.blockSize){l(this,se),he=0;break}}else for(;fe<Z;)if(se[he++]=te[fe++],he==this.blockSize){l(this,se),he=0;break}}this.h=he,this.o+=Z},a.prototype.v=function(){var te=Array((56>this.h?this.blockSize:2*this.blockSize)-this.h);te[0]=128;for(var Z=1;Z<te.length-8;++Z)te[Z]=0;var J=8*this.o;for(Z=te.length-8;Z<te.length;++Z)te[Z]=J&255,J/=256;for(this.u(te),te=Array(16),Z=J=0;4>Z;++Z)for(var se=0;32>se;se+=8)te[J++]=this.g[Z]>>>se&255;return te};function d(te,Z){var J=y;return Object.prototype.hasOwnProperty.call(J,te)?J[te]:J[te]=Z(te)}function p(te,Z){this.h=Z;for(var J=[],se=!0,he=te.length-1;0<=he;he--){var fe=te[he]|0;se&&fe==Z||(J[he]=fe,se=!1)}this.g=J}var y={};function v(te){return-128<=te&&128>te?d(te,function(Z){return new p([Z|0],0>Z?-1:0)}):new p([te|0],0>te?-1:0)}function b(te){if(isNaN(te)||!isFinite(te))return A;if(0>te)return G(b(-te));for(var Z=[],J=1,se=0;te>=J;se++)Z[se]=te/J|0,J*=4294967296;return new p(Z,0)}function w(te,Z){if(te.length==0)throw Error("number format error: empty string");if(Z=Z||10,2>Z||36<Z)throw Error("radix out of range: "+Z);if(te.charAt(0)=="-")return G(w(te.substring(1),Z));if(0<=te.indexOf("-"))throw Error('number format error: interior "-" character');for(var J=b(Math.pow(Z,8)),se=A,he=0;he<te.length;he+=8){var fe=Math.min(8,te.length-he),ue=parseInt(te.substring(he,he+fe),Z);8>fe?(fe=b(Math.pow(Z,fe)),se=se.j(fe).add(b(ue))):(se=se.j(J),se=se.add(b(ue)))}return se}var A=v(0),N=v(1),V=v(16777216);n=p.prototype,n.m=function(){if(B(this))return-G(this).m();for(var te=0,Z=1,J=0;J<this.g.length;J++){var se=this.i(J);te+=(0<=se?se:4294967296+se)*Z,Z*=4294967296}return te},n.toString=function(te){if(te=te||10,2>te||36<te)throw Error("radix out of range: "+te);if(j(this))return"0";if(B(this))return"-"+G(this).toString(te);for(var Z=b(Math.pow(te,6)),J=this,se="";;){var he=ce(J,Z).g;J=ee(J,he.j(Z));var fe=((0<J.g.length?J.g[0]:J.h)>>>0).toString(te);if(J=he,j(J))return fe+se;for(;6>fe.length;)fe="0"+fe;se=fe+se}},n.i=function(te){return 0>te?0:te<this.g.length?this.g[te]:this.h};function j(te){if(te.h!=0)return!1;for(var Z=0;Z<te.g.length;Z++)if(te.g[Z]!=0)return!1;return!0}function B(te){return te.h==-1}n.l=function(te){return te=ee(this,te),B(te)?-1:j(te)?0:1};function G(te){for(var Z=te.g.length,J=[],se=0;se<Z;se++)J[se]=~te.g[se];return new p(J,~te.h).add(N)}n.abs=function(){return B(this)?G(this):this},n.add=function(te){for(var Z=Math.max(this.g.length,te.g.length),J=[],se=0,he=0;he<=Z;he++){var fe=se+(this.i(he)&65535)+(te.i(he)&65535),ue=(fe>>>16)+(this.i(he)>>>16)+(te.i(he)>>>16);se=ue>>>16,fe&=65535,ue&=65535,J[he]=ue<<16|fe}return new p(J,J[J.length-1]&-2147483648?-1:0)};function ee(te,Z){return te.add(G(Z))}n.j=function(te){if(j(this)||j(te))return A;if(B(this))return B(te)?G(this).j(G(te)):G(G(this).j(te));if(B(te))return G(this.j(G(te)));if(0>this.l(V)&&0>te.l(V))return b(this.m()*te.m());for(var Z=this.g.length+te.g.length,J=[],se=0;se<2*Z;se++)J[se]=0;for(se=0;se<this.g.length;se++)for(var he=0;he<te.g.length;he++){var fe=this.i(se)>>>16,ue=this.i(se)&65535,Me=te.i(he)>>>16,He=te.i(he)&65535;J[2*se+2*he]+=ue*He,K(J,2*se+2*he),J[2*se+2*he+1]+=fe*He,K(J,2*se+2*he+1),J[2*se+2*he+1]+=ue*Me,K(J,2*se+2*he+1),J[2*se+2*he+2]+=fe*Me,K(J,2*se+2*he+2)}for(se=0;se<Z;se++)J[se]=J[2*se+1]<<16|J[2*se];for(se=Z;se<2*Z;se++)J[se]=0;return new p(J,0)};function K(te,Z){for(;(te[Z]&65535)!=te[Z];)te[Z+1]+=te[Z]>>>16,te[Z]&=65535,Z++}function ne(te,Z){this.g=te,this.h=Z}function ce(te,Z){if(j(Z))throw Error("division by zero");if(j(te))return new ne(A,A);if(B(te))return Z=ce(G(te),Z),new ne(G(Z.g),G(Z.h));if(B(Z))return Z=ce(te,G(Z)),new ne(G(Z.g),Z.h);if(30<te.g.length){if(B(te)||B(Z))throw Error("slowDivide_ only works with positive integers.");for(var J=N,se=Z;0>=se.l(te);)J=oe(J),se=oe(se);var he=ge(J,1),fe=ge(se,1);for(se=ge(se,2),J=ge(J,2);!j(se);){var ue=fe.add(se);0>=ue.l(te)&&(he=he.add(J),fe=ue),se=ge(se,1),J=ge(J,1)}return Z=ee(te,he.j(Z)),new ne(he,Z)}for(he=A;0<=te.l(Z);){for(J=Math.max(1,Math.floor(te.m()/Z.m())),se=Math.ceil(Math.log(J)/Math.LN2),se=48>=se?1:Math.pow(2,se-48),fe=b(J),ue=fe.j(Z);B(ue)||0<ue.l(te);)J-=se,fe=b(J),ue=fe.j(Z);j(fe)&&(fe=N),he=he.add(fe),te=ee(te,ue)}return new ne(he,te)}n.A=function(te){return ce(this,te).h},n.and=function(te){for(var Z=Math.max(this.g.length,te.g.length),J=[],se=0;se<Z;se++)J[se]=this.i(se)&te.i(se);return new p(J,this.h&te.h)},n.or=function(te){for(var Z=Math.max(this.g.length,te.g.length),J=[],se=0;se<Z;se++)J[se]=this.i(se)|te.i(se);return new p(J,this.h|te.h)},n.xor=function(te){for(var Z=Math.max(this.g.length,te.g.length),J=[],se=0;se<Z;se++)J[se]=this.i(se)^te.i(se);return new p(J,this.h^te.h)};function oe(te){for(var Z=te.g.length+1,J=[],se=0;se<Z;se++)J[se]=te.i(se)<<1|te.i(se-1)>>>31;return new p(J,te.h)}function ge(te,Z){var J=Z>>5;Z%=32;for(var se=te.g.length-J,he=[],fe=0;fe<se;fe++)he[fe]=0<Z?te.i(fe+J)>>>Z|te.i(fe+J+1)<<32-Z:te.i(fe+J);return new p(he,te.h)}a.prototype.digest=a.prototype.v,a.prototype.reset=a.prototype.s,a.prototype.update=a.prototype.u,Vre=a,p.prototype.add=p.prototype.add,p.prototype.multiply=p.prototype.j,p.prototype.modulo=p.prototype.A,p.prototype.compare=p.prototype.l,p.prototype.toNumber=p.prototype.m,p.prototype.toString=p.prototype.toString,p.prototype.getBits=p.prototype.i,p.fromNumber=b,p.fromString=w,mg=p}).apply(typeof _X<"u"?_X:typeof self<"u"?self:typeof window<"u"?window:{});var AO=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};/** @license
Copyright The Closure Library Authors.
SPDX-License-Identifier: Apache-2.0
*/var Fre,Fw,jre,uk,wV,Bre,Wre,zre;(function(){var n,e=typeof Object.defineProperties=="function"?Object.defineProperty:function(I,W,Q){return I==Array.prototype||I==Object.prototype||(I[W]=Q.value),I};function i(I){I=[typeof globalThis=="object"&&globalThis,I,typeof window=="object"&&window,typeof self=="object"&&self,typeof AO=="object"&&AO];for(var W=0;W<I.length;++W){var Q=I[W];if(Q&&Q.Math==Math)return Q}throw Error("Cannot find global object")}var a=i(this);function l(I,W){if(W)e:{var Q=a;I=I.split(".");for(var pe=0;pe<I.length-1;pe++){var qe=I[pe];if(!(qe in Q))break e;Q=Q[qe]}I=I[I.length-1],pe=Q[I],W=W(pe),W!=pe&&W!=null&&e(Q,I,{configurable:!0,writable:!0,value:W})}}function d(I,W){I instanceof String&&(I+="");var Q=0,pe=!1,qe={next:function(){if(!pe&&Q<I.length){var at=Q++;return{value:W(at,I[at]),done:!1}}return pe=!0,{done:!0,value:void 0}}};return qe[Symbol.iterator]=function(){return qe},qe}l("Array.prototype.values",function(I){return I||function(){return d(this,function(W,Q){return Q})}});/** @license

 Copyright The Closure Library Authors.
 SPDX-License-Identifier: Apache-2.0
*/var p=p||{},y=this||self;function v(I){var W=typeof I;return W=W!="object"?W:I?Array.isArray(I)?"array":W:"null",W=="array"||W=="object"&&typeof I.length=="number"}function b(I){var W=typeof I;return W=="object"&&I!=null||W=="function"}function w(I,W,Q){return I.call.apply(I.bind,arguments)}function A(I,W,Q){if(!I)throw Error();if(2<arguments.length){var pe=Array.prototype.slice.call(arguments,2);return function(){var qe=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(qe,pe),I.apply(W,qe)}}return function(){return I.apply(W,arguments)}}function N(I,W,Q){return N=Function.prototype.bind&&Function.prototype.bind.toString().indexOf("native code")!=-1?w:A,N.apply(null,arguments)}function V(I,W){var Q=Array.prototype.slice.call(arguments,1);return function(){var pe=Q.slice();return pe.push.apply(pe,arguments),I.apply(this,pe)}}function j(I,W){function Q(){}Q.prototype=W.prototype,I.aa=W.prototype,I.prototype=new Q,I.prototype.constructor=I,I.Qb=function(pe,qe,at){for(var xt=Array(arguments.length-2),Hr=2;Hr<arguments.length;Hr++)xt[Hr-2]=arguments[Hr];return W.prototype[qe].apply(pe,xt)}}function B(I){const W=I.length;if(0<W){const Q=Array(W);for(let pe=0;pe<W;pe++)Q[pe]=I[pe];return Q}return[]}function G(I,W){for(let Q=1;Q<arguments.length;Q++){const pe=arguments[Q];if(v(pe)){const qe=I.length||0,at=pe.length||0;I.length=qe+at;for(let xt=0;xt<at;xt++)I[qe+xt]=pe[xt]}else I.push(pe)}}class ee{constructor(W,Q){this.i=W,this.j=Q,this.h=0,this.g=null}get(){let W;return 0<this.h?(this.h--,W=this.g,this.g=W.next,W.next=null):W=this.i(),W}}function K(I){return/^[\s\xa0]*$/.test(I)}function ne(){var I=y.navigator;return I&&(I=I.userAgent)?I:""}function ce(I){return ce[" "](I),I}ce[" "]=function(){};var oe=ne().indexOf("Gecko")!=-1&&!(ne().toLowerCase().indexOf("webkit")!=-1&&ne().indexOf("Edge")==-1)&&!(ne().indexOf("Trident")!=-1||ne().indexOf("MSIE")!=-1)&&ne().indexOf("Edge")==-1;function ge(I,W,Q){for(const pe in I)W.call(Q,I[pe],pe,I)}function te(I,W){for(const Q in I)W.call(void 0,I[Q],Q,I)}function Z(I){const W={};for(const Q in I)W[Q]=I[Q];return W}const J="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function se(I,W){let Q,pe;for(let qe=1;qe<arguments.length;qe++){pe=arguments[qe];for(Q in pe)I[Q]=pe[Q];for(let at=0;at<J.length;at++)Q=J[at],Object.prototype.hasOwnProperty.call(pe,Q)&&(I[Q]=pe[Q])}}function he(I){var W=1;I=I.split(":");const Q=[];for(;0<W&&I.length;)Q.push(I.shift()),W--;return I.length&&Q.push(I.join(":")),Q}function fe(I){y.setTimeout(()=>{throw I},0)}function ue(){var I=ve;let W=null;return I.g&&(W=I.g,I.g=I.g.next,I.g||(I.h=null),W.next=null),W}class Me{constructor(){this.h=this.g=null}add(W,Q){const pe=He.get();pe.set(W,Q),this.h?this.h.next=pe:this.g=pe,this.h=pe}}var He=new ee(()=>new rt,I=>I.reset());class rt{constructor(){this.next=this.g=this.h=null}set(W,Q){this.h=W,this.g=Q,this.next=null}reset(){this.next=this.g=this.h=null}}let we,Ce=!1,ve=new Me,Ne=()=>{const I=y.Promise.resolve(void 0);we=()=>{I.then(Te)}};var Te=()=>{for(var I;I=ue();){try{I.h.call(I.g)}catch(Q){fe(Q)}var W=He;W.j(I),100>W.h&&(W.h++,I.next=W.g,W.g=I)}Ce=!1};function be(){this.s=this.s,this.C=this.C}be.prototype.s=!1,be.prototype.ma=function(){this.s||(this.s=!0,this.N())},be.prototype.N=function(){if(this.C)for(;this.C.length;)this.C.shift()()};function Ae(I,W){this.type=I,this.g=this.target=W,this.defaultPrevented=!1}Ae.prototype.h=function(){this.defaultPrevented=!0};var Ue=function(){if(!y.addEventListener||!Object.defineProperty)return!1;var I=!1,W=Object.defineProperty({},"passive",{get:function(){I=!0}});try{const Q=()=>{};y.addEventListener("test",Q,W),y.removeEventListener("test",Q,W)}catch{}return I}();function ze(I,W){if(Ae.call(this,I?I.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,I){var Q=this.type=I.type,pe=I.changedTouches&&I.changedTouches.length?I.changedTouches[0]:null;if(this.target=I.target||I.srcElement,this.g=W,W=I.relatedTarget){if(oe){e:{try{ce(W.nodeName);var qe=!0;break e}catch{}qe=!1}qe||(W=null)}}else Q=="mouseover"?W=I.fromElement:Q=="mouseout"&&(W=I.toElement);this.relatedTarget=W,pe?(this.clientX=pe.clientX!==void 0?pe.clientX:pe.pageX,this.clientY=pe.clientY!==void 0?pe.clientY:pe.pageY,this.screenX=pe.screenX||0,this.screenY=pe.screenY||0):(this.clientX=I.clientX!==void 0?I.clientX:I.pageX,this.clientY=I.clientY!==void 0?I.clientY:I.pageY,this.screenX=I.screenX||0,this.screenY=I.screenY||0),this.button=I.button,this.key=I.key||"",this.ctrlKey=I.ctrlKey,this.altKey=I.altKey,this.shiftKey=I.shiftKey,this.metaKey=I.metaKey,this.pointerId=I.pointerId||0,this.pointerType=typeof I.pointerType=="string"?I.pointerType:et[I.pointerType]||"",this.state=I.state,this.i=I,I.defaultPrevented&&ze.aa.h.call(this)}}j(ze,Ae);var et={2:"touch",3:"pen",4:"mouse"};ze.prototype.h=function(){ze.aa.h.call(this);var I=this.i;I.preventDefault?I.preventDefault():I.returnValue=!1};var nt="closure_listenable_"+(1e6*Math.random()|0),dt=0;function Xe(I,W,Q,pe,qe){this.listener=I,this.proxy=null,this.src=W,this.type=Q,this.capture=!!pe,this.ha=qe,this.key=++dt,this.da=this.fa=!1}function It(I){I.da=!0,I.listener=null,I.proxy=null,I.src=null,I.ha=null}function hn(I){this.src=I,this.g={},this.h=0}hn.prototype.add=function(I,W,Q,pe,qe){var at=I.toString();I=this.g[at],I||(I=this.g[at]=[],this.h++);var xt=ln(I,W,pe,qe);return-1<xt?(W=I[xt],Q||(W.fa=!1)):(W=new Xe(W,this.src,at,!!pe,qe),W.fa=Q,I.push(W)),W};function Ut(I,W){var Q=W.type;if(Q in I.g){var pe=I.g[Q],qe=Array.prototype.indexOf.call(pe,W,void 0),at;(at=0<=qe)&&Array.prototype.splice.call(pe,qe,1),at&&(It(W),I.g[Q].length==0&&(delete I.g[Q],I.h--))}}function ln(I,W,Q,pe){for(var qe=0;qe<I.length;++qe){var at=I[qe];if(!at.da&&at.listener==W&&at.capture==!!Q&&at.ha==pe)return qe}return-1}var xn="closure_lm_"+(1e6*Math.random()|0),Xt={};function Yn(I,W,Q,pe,qe){if(Array.isArray(W)){for(var at=0;at<W.length;at++)Yn(I,W[at],Q,pe,qe);return null}return Q=Jt(Q),I&&I[nt]?I.K(W,Q,b(pe)?!!pe.capture:!1,qe):qt(I,W,Q,!1,pe,qe)}function qt(I,W,Q,pe,qe,at){if(!W)throw Error("Invalid event type");var xt=b(qe)?!!qe.capture:!!qe,Hr=Ge(I);if(Hr||(I[xn]=Hr=new hn(I)),Q=Hr.add(W,Q,pe,xt,at),Q.proxy)return Q;if(pe=Re(),Q.proxy=pe,pe.src=I,pe.listener=Q,I.addEventListener)Ue||(qe=xt),qe===void 0&&(qe=!1),I.addEventListener(W.toString(),pe,qe);else if(I.attachEvent)I.attachEvent(Et(W.toString()),pe);else if(I.addListener&&I.removeListener)I.addListener(pe);else throw Error("addEventListener and attachEvent are unavailable.");return Q}function Re(){function I(Q){return W.call(I.src,I.listener,Q)}const W=bt;return I}function Fe(I,W,Q,pe,qe){if(Array.isArray(W))for(var at=0;at<W.length;at++)Fe(I,W[at],Q,pe,qe);else pe=b(pe)?!!pe.capture:!!pe,Q=Jt(Q),I&&I[nt]?(I=I.i,W=String(W).toString(),W in I.g&&(at=I.g[W],Q=ln(at,Q,pe,qe),-1<Q&&(It(at[Q]),Array.prototype.splice.call(at,Q,1),at.length==0&&(delete I.g[W],I.h--)))):I&&(I=Ge(I))&&(W=I.g[W.toString()],I=-1,W&&(I=ln(W,Q,pe,qe)),(Q=-1<I?W[I]:null)&&Ke(Q))}function Ke(I){if(typeof I!="number"&&I&&!I.da){var W=I.src;if(W&&W[nt])Ut(W.i,I);else{var Q=I.type,pe=I.proxy;W.removeEventListener?W.removeEventListener(Q,pe,I.capture):W.detachEvent?W.detachEvent(Et(Q),pe):W.addListener&&W.removeListener&&W.removeListener(pe),(Q=Ge(W))?(Ut(Q,I),Q.h==0&&(Q.src=null,W[xn]=null)):It(I)}}}function Et(I){return I in Xt?Xt[I]:Xt[I]="on"+I}function bt(I,W){if(I.da)I=!0;else{W=new ze(W,this);var Q=I.listener,pe=I.ha||I.src;I.fa&&Ke(I),I=Q.call(pe,W)}return I}function Ge(I){return I=I[xn],I instanceof hn?I:null}var Ot="__closure_events_fn_"+(1e9*Math.random()>>>0);function Jt(I){return typeof I=="function"?I:(I[Ot]||(I[Ot]=function(W){return I.handleEvent(W)}),I[Ot])}function fn(){be.call(this),this.i=new hn(this),this.M=this,this.F=null}j(fn,be),fn.prototype[nt]=!0,fn.prototype.removeEventListener=function(I,W,Q,pe){Fe(this,I,W,Q,pe)};function an(I,W){var Q,pe=I.F;if(pe)for(Q=[];pe;pe=pe.F)Q.push(pe);if(I=I.M,pe=W.type||W,typeof W=="string")W=new Ae(W,I);else if(W instanceof Ae)W.target=W.target||I;else{var qe=W;W=new Ae(pe,I),se(W,qe)}if(qe=!0,Q)for(var at=Q.length-1;0<=at;at--){var xt=W.g=Q[at];qe=ir(xt,pe,!0,W)&&qe}if(xt=W.g=I,qe=ir(xt,pe,!0,W)&&qe,qe=ir(xt,pe,!1,W)&&qe,Q)for(at=0;at<Q.length;at++)xt=W.g=Q[at],qe=ir(xt,pe,!1,W)&&qe}fn.prototype.N=function(){if(fn.aa.N.call(this),this.i){var I=this.i,W;for(W in I.g){for(var Q=I.g[W],pe=0;pe<Q.length;pe++)It(Q[pe]);delete I.g[W],I.h--}}this.F=null},fn.prototype.K=function(I,W,Q,pe){return this.i.add(String(I),W,!1,Q,pe)},fn.prototype.L=function(I,W,Q,pe){return this.i.add(String(I),W,!0,Q,pe)};function ir(I,W,Q,pe){if(W=I.i.g[String(W)],!W)return!0;W=W.concat();for(var qe=!0,at=0;at<W.length;++at){var xt=W[at];if(xt&&!xt.da&&xt.capture==Q){var Hr=xt.listener,oi=xt.ha||xt.src;xt.fa&&Ut(I.i,xt),qe=Hr.call(oi,pe)!==!1&&qe}}return qe&&!pe.defaultPrevented}function la(I,W,Q){if(typeof I=="function")Q&&(I=N(I,Q));else if(I&&typeof I.handleEvent=="function")I=N(I.handleEvent,I);else throw Error("Invalid listener argument");return 2147483647<Number(W)?-1:y.setTimeout(I,W||0)}function Vt(I){I.g=la(()=>{I.g=null,I.i&&(I.i=!1,Vt(I))},I.l);const W=I.h;I.h=null,I.m.apply(null,W)}class sn extends be{constructor(W,Q){super(),this.m=W,this.l=Q,this.h=null,this.i=!1,this.g=null}j(W){this.h=arguments,this.g?this.i=!0:Vt(this)}N(){super.N(),this.g&&(y.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function ki(I){be.call(this),this.h=I,this.g={}}j(ki,be);var _i=[];function Ri(I){ge(I.g,function(W,Q){this.g.hasOwnProperty(Q)&&Ke(W)},I),I.g={}}ki.prototype.N=function(){ki.aa.N.call(this),Ri(this)},ki.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};var dr=y.JSON.stringify,Wa=y.JSON.parse,il=class{stringify(I){return y.JSON.stringify(I,void 0)}parse(I){return y.JSON.parse(I,void 0)}};function uo(){}uo.prototype.h=null;function ho(I){return I.h||(I.h=I.i())}function Fl(){}var js={OPEN:"a",kb:"b",Ja:"c",wb:"d"};function uc(){Ae.call(this,"d")}j(uc,Ae);function ua(){Ae.call(this,"c")}j(ua,Ae);var dc={},sl=null;function Mu(){return sl=sl||new fn}dc.La="serverreachability";function hc(I){Ae.call(this,dc.La,I)}j(hc,Ae);function ol(I){const W=Mu();an(W,new hc(W))}dc.STAT_EVENT="statevent";function Ao(I,W){Ae.call(this,dc.STAT_EVENT,I),this.stat=W}j(Ao,Ae);function ji(I){const W=Mu();an(W,new Ao(W,I))}dc.Ma="timingevent";function hs(I,W){Ae.call(this,dc.Ma,I),this.size=W}j(hs,Ae);function za(I,W){if(typeof I!="function")throw Error("Fn must not be null and must be a function");return y.setTimeout(function(){I()},W)}function Uu(){this.g=!0}Uu.prototype.xa=function(){this.g=!1};function fc(I,W,Q,pe,qe,at){I.info(function(){if(I.g)if(at)for(var xt="",Hr=at.split("&"),oi=0;oi<Hr.length;oi++){var Er=Hr[oi].split("=");if(1<Er.length){var Ws=Er[0];Er=Er[1];var ps=Ws.split("_");xt=2<=ps.length&&ps[1]=="type"?xt+(Ws+"="+Er+"&"):xt+(Ws+"=redacted&")}}else xt=null;else xt=at;return"XMLHTTP REQ ("+pe+") [attempt "+qe+"]: "+W+`
`+Q+`
`+xt})}function da(I,W,Q,pe,qe,at,xt){I.info(function(){return"XMLHTTP RESP ("+pe+") [ attempt "+qe+"]: "+W+`
`+Q+`
`+at+" "+xt})}function ha(I,W,Q,pe){I.info(function(){return"XMLHTTP TEXT ("+W+"): "+Vg(I,Q)+(pe?" "+pe:"")})}function Fd(I,W){I.info(function(){return"TIMEOUT: "+W})}Uu.prototype.info=function(){};function Vg(I,W){if(!I.g)return W;if(!W)return null;try{var Q=JSON.parse(W);if(Q){for(I=0;I<Q.length;I++)if(Array.isArray(Q[I])){var pe=Q[I];if(!(2>pe.length)){var qe=pe[1];if(Array.isArray(qe)&&!(1>qe.length)){var at=qe[0];if(at!="noop"&&at!="stop"&&at!="close")for(var xt=1;xt<qe.length;xt++)qe[xt]=""}}}}return dr(Q)}catch{return W}}var Vu={NO_ERROR:0,gb:1,tb:2,sb:3,nb:4,rb:5,ub:6,Ia:7,TIMEOUT:8,xb:9},hf={lb:"complete",Hb:"success",Ja:"error",Ia:"abort",zb:"ready",Ab:"readystatechange",TIMEOUT:"timeout",vb:"incrementaldata",yb:"progress",ob:"downloadprogress",Pb:"uploadprogress"},Bs;function Fu(){}j(Fu,uo),Fu.prototype.g=function(){return new XMLHttpRequest},Fu.prototype.i=function(){return{}},Bs=new Fu;function fa(I,W,Q,pe){this.j=I,this.i=W,this.l=Q,this.R=pe||1,this.U=new ki(this),this.I=45e3,this.H=null,this.o=!1,this.m=this.A=this.v=this.L=this.F=this.S=this.B=null,this.D=[],this.g=null,this.C=0,this.s=this.u=null,this.X=-1,this.J=!1,this.O=0,this.M=null,this.W=this.K=this.T=this.P=!1,this.h=new jd}function jd(){this.i=null,this.g="",this.h=!1}var Bd={},Ga={};function Wd(I,W,Q){I.L=1,I.v=$a(Oo(W)),I.m=Q,I.P=!0,ju(I,null)}function ju(I,W){I.F=Date.now(),Fr(I),I.A=Oo(I.v);var Q=I.A,pe=I.R;Array.isArray(pe)||(pe=[String(pe)]),Hl(Q.i,"t",pe),I.C=0,Q=I.j.J,I.h=new jd,I.g=Qy(I.j,Q?W:null,!I.m),0<I.O&&(I.M=new sn(N(I.Y,I,I.g),I.O)),W=I.U,Q=I.g,pe=I.ca;var qe="readystatechange";Array.isArray(qe)||(qe&&(_i[0]=qe.toString()),qe=_i);for(var at=0;at<qe.length;at++){var xt=Yn(Q,qe[at],pe||W.handleEvent,!1,W.h||W);if(!xt)break;W.g[xt.key]=xt}W=I.H?Z(I.H):{},I.m?(I.u||(I.u="POST"),W["Content-Type"]="application/x-www-form-urlencoded",I.g.ea(I.A,I.u,I.m,W)):(I.u="GET",I.g.ea(I.A,I.u,null,W)),ol(),fc(I.i,I.u,I.A,I.l,I.R,I.m)}fa.prototype.ca=function(I){I=I.target;const W=this.M;W&&Ei(I)==3?W.j():this.Y(I)},fa.prototype.Y=function(I){try{if(I==this.g)e:{const ps=Ei(this.g);var W=this.g.Ba();const Ka=this.g.Z();if(!(3>ps)&&(ps!=3||this.g&&(this.h.h||this.g.oa()||Os(this.g)))){this.J||ps!=4||W==7||(W==8||0>=Ka?ol(3):ol(2)),pc(this);var Q=this.g.Z();this.X=Q;t:if(Po(this)){var pe=Os(this.g);I="";var qe=pe.length,at=Ei(this.g)==4;if(!this.h.i){if(typeof TextDecoder>"u"){pa(this),al(this);var xt="";break t}this.h.i=new y.TextDecoder}for(W=0;W<qe;W++)this.h.h=!0,I+=this.h.i.decode(pe[W],{stream:!(at&&W==qe-1)});pe.length=0,this.h.g+=I,this.C=0,xt=this.h.g}else xt=this.g.oa();if(this.o=Q==200,da(this.i,this.u,this.A,this.l,this.R,ps,Q),this.o){if(this.T&&!this.K){t:{if(this.g){var Hr,oi=this.g;if((Hr=oi.g?oi.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!K(Hr)){var Er=Hr;break t}}Er=null}if(Q=Er)ha(this.i,this.l,Q,"Initial handshake response via X-HTTP-Initial-Response"),this.K=!0,ff(this,Q);else{this.o=!1,this.s=3,ji(12),pa(this),al(this);break e}}if(this.P){Q=!0;let jo;for(;!this.J&&this.C<xt.length;)if(jo=zd(this,xt),jo==Ga){ps==4&&(this.s=4,ji(14),Q=!1),ha(this.i,this.l,null,"[Incomplete Response]");break}else if(jo==Bd){this.s=4,ji(15),ha(this.i,this.l,xt,"[Invalid Chunk]"),Q=!1;break}else ha(this.i,this.l,jo,null),ff(this,jo);if(Po(this)&&this.C!=0&&(this.h.g=this.h.g.slice(this.C),this.C=0),ps!=4||xt.length!=0||this.h.h||(this.s=1,ji(16),Q=!1),this.o=this.o&&Q,!Q)ha(this.i,this.l,xt,"[Invalid Chunked Response]"),pa(this),al(this);else if(0<xt.length&&!this.W){this.W=!0;var Ws=this.j;Ws.g==this&&Ws.ba&&!Ws.M&&(Ws.j.info("Great, no buffering proxy detected. Bytes received: "+xt.length),jg(Ws),Ws.M=!0,ji(11))}}else ha(this.i,this.l,xt,null),ff(this,xt);ps==4&&pa(this),this.o&&!this.J&&(ps==4?Yp(this.j,this):(this.o=!1,Fr(this)))}else Mo(this.g),Q==400&&0<xt.indexOf("Unknown SID")?(this.s=3,ji(12)):(this.s=0,ji(13)),pa(this),al(this)}}}catch{}finally{}};function Po(I){return I.g?I.u=="GET"&&I.L!=2&&I.j.Ca:!1}function zd(I,W){var Q=I.C,pe=W.indexOf(`
`,Q);return pe==-1?Ga:(Q=Number(W.substring(Q,pe)),isNaN(Q)?Bd:(pe+=1,pe+Q>W.length?Ga:(W=W.slice(pe,pe+Q),I.C=pe+Q,W)))}fa.prototype.cancel=function(){this.J=!0,pa(this)};function Fr(I){I.S=Date.now()+I.I,yi(I,I.I)}function yi(I,W){if(I.B!=null)throw Error("WatchDog timer not null");I.B=za(N(I.ba,I),W)}function pc(I){I.B&&(y.clearTimeout(I.B),I.B=null)}fa.prototype.ba=function(){this.B=null;const I=Date.now();0<=I-this.S?(Fd(this.i,this.A),this.L!=2&&(ol(),ji(17)),pa(this),this.s=2,al(this)):yi(this,this.S-I)};function al(I){I.j.G==0||I.J||Yp(I.j,I)}function pa(I){pc(I);var W=I.M;W&&typeof W.ma=="function"&&W.ma(),I.M=null,Ri(I.U),I.g&&(W=I.g,I.g=null,W.abort(),W.ma())}function ff(I,W){try{var Q=I.j;if(Q.G!=0&&(Q.g==I||Xs(Q.h,I))){if(!I.K&&Xs(Q.h,I)&&Q.G==3){try{var pe=Q.Da.g.parse(W)}catch{pe=null}if(Array.isArray(pe)&&pe.length==3){var qe=pe;if(qe[0]==0){e:if(!Q.u){if(Q.g)if(Q.g.F+3e3<I.F)qp(Q),hl(Q);else break e;Kp(Q),ji(18)}}else Q.za=qe[1],0<Q.za-Q.T&&37500>qe[2]&&Q.F&&Q.v==0&&!Q.C&&(Q.C=za(N(Q.Za,Q),6e3));if(1>=Bp(Q.h)&&Q.ca){try{Q.ca()}catch{}Q.ca=void 0}}else Ku(Q,11)}else if((I.K||Q.g==I)&&qp(Q),!K(W))for(qe=Q.Da.g.parse(W),W=0;W<qe.length;W++){let Er=qe[W];if(Q.T=Er[0],Er=Er[1],Q.G==2)if(Er[0]=="c"){Q.K=Er[1],Q.ia=Er[2];const Ws=Er[3];Ws!=null&&(Q.la=Ws,Q.j.info("VER="+Q.la));const ps=Er[4];ps!=null&&(Q.Aa=ps,Q.j.info("SVER="+Q.Aa));const Ka=Er[5];Ka!=null&&typeof Ka=="number"&&0<Ka&&(pe=1.5*Ka,Q.L=pe,Q.j.info("backChannelRequestTimeoutMs_="+pe)),pe=Q;const jo=I.g;if(jo){const yf=jo.g?jo.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(yf){var at=pe.h;at.g||yf.indexOf("spdy")==-1&&yf.indexOf("quic")==-1&&yf.indexOf("h2")==-1||(at.j=at.l,at.g=new Set,at.h&&(pf(at,at.h),at.h=null))}if(pe.D){const Jp=jo.g?jo.g.getResponseHeader("X-HTTP-Session-Id"):null;Jp&&(pe.ya=Jp,Gr(pe.I,pe.D,Jp))}}Q.G=3,Q.l&&Q.l.ua(),Q.ba&&(Q.R=Date.now()-I.F,Q.j.info("Handshake RTT: "+Q.R+"ms")),pe=Q;var xt=I;if(pe.qa=Bg(pe,pe.J?pe.ia:null,pe.W),xt.K){cl(pe.h,xt);var Hr=xt,oi=pe.L;oi&&(Hr.I=oi),Hr.B&&(pc(Hr),Fr(Hr)),pe.g=xt}else Kl(pe);0<Q.i.length&&_c(Q)}else Er[0]!="stop"&&Er[0]!="close"||Ku(Q,7);else Q.G==3&&(Er[0]=="stop"||Er[0]=="close"?Er[0]=="stop"?Ku(Q,7):Ji(Q):Er[0]!="noop"&&Q.l&&Q.l.ta(Er),Q.v=0)}}ol(4)}catch{}}var Gd=class{constructor(I,W){this.g=I,this.map=W}};function jl(I){this.l=I||10,y.PerformanceNavigationTiming?(I=y.performance.getEntriesByType("navigation"),I=0<I.length&&(I[0].nextHopProtocol=="hq"||I[0].nextHopProtocol=="h2")):I=!!(y.chrome&&y.chrome.loadTimes&&y.chrome.loadTimes()&&y.chrome.loadTimes().wasFetchedViaSpdy),this.j=I?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}function fo(I){return I.h?!0:I.g?I.g.size>=I.j:!1}function Bp(I){return I.h?1:I.g?I.g.size:0}function Xs(I,W){return I.h?I.h==W:I.g?I.g.has(W):!1}function pf(I,W){I.g?I.g.add(W):I.h=W}function cl(I,W){I.h&&I.h==W?I.h=null:I.g&&I.g.has(W)&&I.g.delete(W)}jl.prototype.cancel=function(){if(this.i=Hd(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&this.g.size!==0){for(const I of this.g.values())I.cancel();this.g.clear()}};function Hd(I){if(I.h!=null)return I.i.concat(I.h.D);if(I.g!=null&&I.g.size!==0){let W=I.i;for(const Q of I.g.values())W=W.concat(Q.D);return W}return B(I.i)}function $d(I){if(I.V&&typeof I.V=="function")return I.V();if(typeof Map<"u"&&I instanceof Map||typeof Set<"u"&&I instanceof Set)return Array.from(I.values());if(typeof I=="string")return I.split("");if(v(I)){for(var W=[],Q=I.length,pe=0;pe<Q;pe++)W.push(I[pe]);return W}W=[],Q=0;for(pe in I)W[Q++]=I[pe];return W}function hr(I){if(I.na&&typeof I.na=="function")return I.na();if(!I.V||typeof I.V!="function"){if(typeof Map<"u"&&I instanceof Map)return Array.from(I.keys());if(!(typeof Set<"u"&&I instanceof Set)){if(v(I)||typeof I=="string"){var W=[];I=I.length;for(var Q=0;Q<I;Q++)W.push(Q);return W}W=[],Q=0;for(const pe in I)W[Q++]=pe;return W}}}function Bl(I,W){if(I.forEach&&typeof I.forEach=="function")I.forEach(W,void 0);else if(v(I)||typeof I=="string")Array.prototype.forEach.call(I,W,void 0);else for(var Q=hr(I),pe=$d(I),qe=pe.length,at=0;at<qe;at++)W.call(void 0,pe[at],Q&&Q[at],I)}var Wl=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function Bu(I,W){if(I){I=I.split("&");for(var Q=0;Q<I.length;Q++){var pe=I[Q].indexOf("="),qe=null;if(0<=pe){var at=I[Q].substring(0,pe);qe=I[Q].substring(pe+1)}else at=I[Q];W(at,qe?decodeURIComponent(qe.replace(/\+/g," ")):"")}}}function Ha(I){if(this.g=this.o=this.j="",this.s=null,this.m=this.l="",this.h=!1,I instanceof Ha){this.h=I.h,Wu(this,I.j),this.o=I.o,this.g=I.g,ll(this,I.s),this.l=I.l;var W=I.i,Q=new ko;Q.i=W.i,W.g&&(Q.g=new Map(W.g),Q.h=W.h),zl(this,Q),this.m=I.m}else I&&(W=String(I).match(Wl))?(this.h=!1,Wu(this,W[1]||"",!0),this.o=nr(W[2]||""),this.g=nr(W[3]||"",!0),ll(this,W[4]),this.l=nr(W[5]||"",!0),zl(this,W[6]||"",!0),this.m=nr(W[7]||"")):(this.h=!1,this.i=new ko(null,this.h))}Ha.prototype.toString=function(){var I=[],W=this.j;W&&I.push(mc(W,Gl,!0),":");var Q=this.g;return(Q||W=="file")&&(I.push("//"),(W=this.o)&&I.push(mc(W,Gl,!0),"@"),I.push(encodeURIComponent(String(Q)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),Q=this.s,Q!=null&&I.push(":",String(Q))),(Q=this.l)&&(this.g&&Q.charAt(0)!="/"&&I.push("/"),I.push(mc(Q,Q.charAt(0)=="/"?mf:Kd,!0))),(Q=this.i.toString())&&I.push("?",Q),(Q=this.m)&&I.push("#",mc(Q,gf)),I.join("")};function Oo(I){return new Ha(I)}function Wu(I,W,Q){I.j=Q?nr(W,!0):W,I.j&&(I.j=I.j.replace(/:$/,""))}function ll(I,W){if(W){if(W=Number(W),isNaN(W)||0>W)throw Error("Bad port number "+W);I.s=W}else I.s=null}function zl(I,W,Q){W instanceof ko?(I.i=W,xo(I.i,I.h)):(Q||(W=mc(W,zp)),I.i=new ko(W,I.h))}function Gr(I,W,Q){I.i.set(W,Q)}function $a(I){return Gr(I,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),I}function nr(I,W){return I?W?decodeURI(I.replace(/%25/g,"%2525")):decodeURIComponent(I):""}function mc(I,W,Q){return typeof I=="string"?(I=encodeURI(I).replace(W,Wp),Q&&(I=I.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),I):null}function Wp(I){return I=I.charCodeAt(0),"%"+(I>>4&15).toString(16)+(I&15).toString(16)}var Gl=/[#\/\?@]/g,Kd=/[#\?:]/g,mf=/[#\?]/g,zp=/[#\?@]/g,gf=/#/g;function ko(I,W){this.h=this.g=null,this.i=I||null,this.j=!!W}function is(I){I.g||(I.g=new Map,I.h=0,I.i&&Bu(I.i,function(W,Q){I.add(decodeURIComponent(W.replace(/\+/g," ")),Q)}))}n=ko.prototype,n.add=function(I,W){is(this),this.i=null,I=Lo(this,I);var Q=this.g.get(I);return Q||this.g.set(I,Q=[]),Q.push(W),this.h+=1,this};function No(I,W){is(I),W=Lo(I,W),I.g.has(W)&&(I.i=null,I.h-=I.g.get(W).length,I.g.delete(W))}function Do(I,W){return is(I),W=Lo(I,W),I.g.has(W)}n.forEach=function(I,W){is(this),this.g.forEach(function(Q,pe){Q.forEach(function(qe){I.call(W,qe,pe,this)},this)},this)},n.na=function(){is(this);const I=Array.from(this.g.values()),W=Array.from(this.g.keys()),Q=[];for(let pe=0;pe<W.length;pe++){const qe=I[pe];for(let at=0;at<qe.length;at++)Q.push(W[pe])}return Q},n.V=function(I){is(this);let W=[];if(typeof I=="string")Do(this,I)&&(W=W.concat(this.g.get(Lo(this,I))));else{I=Array.from(this.g.values());for(let Q=0;Q<I.length;Q++)W=W.concat(I[Q])}return W},n.set=function(I,W){return is(this),this.i=null,I=Lo(this,I),Do(this,I)&&(this.h-=this.g.get(I).length),this.g.set(I,[W]),this.h+=1,this},n.get=function(I,W){return I?(I=this.V(I),0<I.length?String(I[0]):W):W};function Hl(I,W,Q){No(I,W),0<Q.length&&(I.i=null,I.g.set(Lo(I,W),B(Q)),I.h+=Q.length)}n.toString=function(){if(this.i)return this.i;if(!this.g)return"";const I=[],W=Array.from(this.g.keys());for(var Q=0;Q<W.length;Q++){var pe=W[Q];const at=encodeURIComponent(String(pe)),xt=this.V(pe);for(pe=0;pe<xt.length;pe++){var qe=at;xt[pe]!==""&&(qe+="="+encodeURIComponent(String(xt[pe]))),I.push(qe)}}return this.i=I.join("&")};function Lo(I,W){return W=String(W),I.j&&(W=W.toLowerCase()),W}function xo(I,W){W&&!I.j&&(is(I),I.i=null,I.g.forEach(function(Q,pe){var qe=pe.toLowerCase();pe!=qe&&(No(this,pe),Hl(this,qe,Q))},I)),I.j=W}function Gp(I,W){const Q=new Uu;if(y.Image){const pe=new Image;pe.onload=V(fs,Q,"TestLoadImage: loaded",!0,W,pe),pe.onerror=V(fs,Q,"TestLoadImage: error",!1,W,pe),pe.onabort=V(fs,Q,"TestLoadImage: abort",!1,W,pe),pe.ontimeout=V(fs,Q,"TestLoadImage: timeout",!1,W,pe),y.setTimeout(function(){pe.ontimeout&&pe.ontimeout()},1e4),pe.src=I}else W(!1)}function gc(I,W){const Q=new Uu,pe=new AbortController,qe=setTimeout(()=>{pe.abort(),fs(Q,"TestPingServer: timeout",!1,W)},1e4);fetch(I,{signal:pe.signal}).then(at=>{clearTimeout(qe),at.ok?fs(Q,"TestPingServer: ok",!0,W):fs(Q,"TestPingServer: server error",!1,W)}).catch(()=>{clearTimeout(qe),fs(Q,"TestPingServer: error",!1,W)})}function fs(I,W,Q,pe,qe){try{qe&&(qe.onload=null,qe.onerror=null,qe.onabort=null,qe.ontimeout=null),pe(Q)}catch{}}function zu(){this.g=new il}function _f(I,W,Q){const pe=Q||"";try{Bl(I,function(qe,at){let xt=qe;b(qe)&&(xt=dr(qe)),W.push(pe+at+"="+encodeURIComponent(xt))})}catch(qe){throw W.push(pe+"type="+encodeURIComponent("_badmap")),qe}}function ul(I){this.l=I.Ub||null,this.j=I.eb||!1}j(ul,uo),ul.prototype.g=function(){return new $l(this.l,this.j)},ul.prototype.i=function(I){return function(){return I}}({});function $l(I,W){fn.call(this),this.D=I,this.o=W,this.m=void 0,this.status=this.readyState=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.u=new Headers,this.h=null,this.B="GET",this.A="",this.g=!1,this.v=this.j=this.l=null}j($l,fn),n=$l.prototype,n.open=function(I,W){if(this.readyState!=0)throw this.abort(),Error("Error reopening a connection");this.B=I,this.A=W,this.readyState=1,ga(this)},n.send=function(I){if(this.readyState!=1)throw this.abort(),Error("need to call open() first. ");this.g=!0;const W={headers:this.u,method:this.B,credentials:this.m,cache:void 0};I&&(W.body=I),(this.D||y).fetch(new Request(this.A,W)).then(this.Sa.bind(this),this.ga.bind(this))},n.abort=function(){this.response=this.responseText="",this.u=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),1<=this.readyState&&this.g&&this.readyState!=4&&(this.g=!1,ma(this)),this.readyState=0},n.Sa=function(I){if(this.g&&(this.l=I,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=I.headers,this.readyState=2,ga(this)),this.g&&(this.readyState=3,ga(this),this.g)))if(this.responseType==="arraybuffer")I.arrayBuffer().then(this.Qa.bind(this),this.ga.bind(this));else if(typeof y.ReadableStream<"u"&&"body"in I){if(this.j=I.body.getReader(),this.o){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.v=new TextDecoder;Hp(this)}else I.text().then(this.Ra.bind(this),this.ga.bind(this))};function Hp(I){I.j.read().then(I.Pa.bind(I)).catch(I.ga.bind(I))}n.Pa=function(I){if(this.g){if(this.o&&I.value)this.response.push(I.value);else if(!this.o){var W=I.value?I.value:new Uint8Array(0);(W=this.v.decode(W,{stream:!I.done}))&&(this.response=this.responseText+=W)}I.done?ma(this):ga(this),this.readyState==3&&Hp(this)}},n.Ra=function(I){this.g&&(this.response=this.responseText=I,ma(this))},n.Qa=function(I){this.g&&(this.response=I,ma(this))},n.ga=function(){this.g&&ma(this)};function ma(I){I.readyState=4,I.l=null,I.j=null,I.v=null,ga(I)}n.setRequestHeader=function(I,W){this.u.append(I,W)},n.getResponseHeader=function(I){return this.h&&this.h.get(I.toLowerCase())||""},n.getAllResponseHeaders=function(){if(!this.h)return"";const I=[],W=this.h.entries();for(var Q=W.next();!Q.done;)Q=Q.value,I.push(Q[0]+": "+Q[1]),Q=W.next();return I.join(`\r
`)};function ga(I){I.onreadystatechange&&I.onreadystatechange.call(I)}Object.defineProperty($l.prototype,"withCredentials",{get:function(){return this.m==="include"},set:function(I){this.m=I?"include":"same-origin"}});function dl(I){let W="";return ge(I,function(Q,pe){W+=pe,W+=":",W+=Q,W+=`\r
`}),W}function Se(I,W,Q){e:{for(pe in Q){var pe=!1;break e}pe=!0}pe||(Q=dl(Q),typeof I=="string"?Q!=null&&encodeURIComponent(String(Q)):Gr(I,W,Q))}function De(I){fn.call(this),this.headers=new Map,this.o=I||null,this.h=!1,this.v=this.g=null,this.D="",this.m=0,this.l="",this.j=this.B=this.u=this.A=!1,this.I=null,this.H="",this.J=!1}j(De,fn);var tt=/^https?$/i,Kt=["POST","PUT"];n=De.prototype,n.Ha=function(I){this.J=I},n.ea=function(I,W,Q,pe){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.D+"; newUri="+I);W=W?W.toUpperCase():"GET",this.D=I,this.l="",this.m=0,this.A=!1,this.h=!0,this.g=this.o?this.o.g():Bs.g(),this.v=this.o?ho(this.o):ho(Bs),this.g.onreadystatechange=N(this.Ea,this);try{this.B=!0,this.g.open(W,String(I),!0),this.B=!1}catch(at){Hn(this,at);return}if(I=Q||"",Q=new Map(this.headers),pe)if(Object.getPrototypeOf(pe)===Object.prototype)for(var qe in pe)Q.set(qe,pe[qe]);else if(typeof pe.keys=="function"&&typeof pe.get=="function")for(const at of pe.keys())Q.set(at,pe.get(at));else throw Error("Unknown input type for opt_headers: "+String(pe));pe=Array.from(Q.keys()).find(at=>at.toLowerCase()=="content-type"),qe=y.FormData&&I instanceof y.FormData,!(0<=Array.prototype.indexOf.call(Kt,W,void 0))||pe||qe||Q.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(const[at,xt]of Q)this.g.setRequestHeader(at,xt);this.H&&(this.g.responseType=this.H),"withCredentials"in this.g&&this.g.withCredentials!==this.J&&(this.g.withCredentials=this.J);try{Nr(this),this.u=!0,this.g.send(I),this.u=!1}catch(at){Hn(this,at)}};function Hn(I,W){I.h=!1,I.g&&(I.j=!0,I.g.abort(),I.j=!1),I.l=W,I.m=5,yr(I),cn(I)}function yr(I){I.A||(I.A=!0,an(I,"complete"),an(I,"error"))}n.abort=function(I){this.g&&this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1,this.m=I||7,an(this,"complete"),an(this,"abort"),cn(this))},n.N=function(){this.g&&(this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1),cn(this,!0)),De.aa.N.call(this)},n.Ea=function(){this.s||(this.B||this.u||this.j?jr(this):this.bb())},n.bb=function(){jr(this)};function jr(I){if(I.h&&typeof p<"u"&&(!I.v[1]||Ei(I)!=4||I.Z()!=2)){if(I.u&&Ei(I)==4)la(I.Ea,0,I);else if(an(I,"readystatechange"),Ei(I)==4){I.h=!1;try{const xt=I.Z();e:switch(xt){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var W=!0;break e;default:W=!1}var Q;if(!(Q=W)){var pe;if(pe=xt===0){var qe=String(I.D).match(Wl)[1]||null;!qe&&y.self&&y.self.location&&(qe=y.self.location.protocol.slice(0,-1)),pe=!tt.test(qe?qe.toLowerCase():"")}Q=pe}if(Q)an(I,"complete"),an(I,"success");else{I.m=6;try{var at=2<Ei(I)?I.g.statusText:""}catch{at=""}I.l=at+" ["+I.Z()+"]",yr(I)}}finally{cn(I)}}}}function cn(I,W){if(I.g){Nr(I);const Q=I.g,pe=I.v[0]?()=>{}:null;I.g=null,I.v=null,W||an(I,"ready");try{Q.onreadystatechange=pe}catch{}}}function Nr(I){I.I&&(y.clearTimeout(I.I),I.I=null)}n.isActive=function(){return!!this.g};function Ei(I){return I.g?I.g.readyState:0}n.Z=function(){try{return 2<Ei(this)?this.g.status:-1}catch{return-1}},n.oa=function(){try{return this.g?this.g.responseText:""}catch{return""}},n.Oa=function(I){if(this.g){var W=this.g.responseText;return I&&W.indexOf(I)==0&&(W=W.substring(I.length)),Wa(W)}};function Os(I){try{if(!I.g)return null;if("response"in I.g)return I.g.response;switch(I.H){case"":case"text":return I.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in I.g)return I.g.mozResponseArrayBuffer}return null}catch{return null}}function Mo(I){const W={};I=(I.g&&2<=Ei(I)&&I.g.getAllResponseHeaders()||"").split(`\r
`);for(let pe=0;pe<I.length;pe++){if(K(I[pe]))continue;var Q=he(I[pe]);const qe=Q[0];if(Q=Q[1],typeof Q!="string")continue;Q=Q.trim();const at=W[qe]||[];W[qe]=at,at.push(Q)}te(W,function(pe){return pe.join(", ")})}n.Ba=function(){return this.m},n.Ka=function(){return typeof this.l=="string"?this.l:String(this.l)};function Uo(I,W,Q){return Q&&Q.internalChannelParams&&Q.internalChannelParams[I]||W}function Gu(I){this.Aa=0,this.i=[],this.j=new Uu,this.ia=this.qa=this.I=this.W=this.g=this.ya=this.D=this.H=this.m=this.S=this.o=null,this.Ya=this.U=0,this.Va=Uo("failFast",!1,I),this.F=this.C=this.u=this.s=this.l=null,this.X=!0,this.za=this.T=-1,this.Y=this.v=this.B=0,this.Ta=Uo("baseRetryDelayMs",5e3,I),this.cb=Uo("retryDelaySeedMs",1e4,I),this.Wa=Uo("forwardChannelMaxRetries",2,I),this.wa=Uo("forwardChannelRequestTimeoutMs",2e4,I),this.pa=I&&I.xmlHttpFactory||void 0,this.Xa=I&&I.Tb||void 0,this.Ca=I&&I.useFetchStreams||!1,this.L=void 0,this.J=I&&I.supportsCrossDomainXhr||!1,this.K="",this.h=new jl(I&&I.concurrentRequestLimit),this.Da=new zu,this.P=I&&I.fastHandshake||!1,this.O=I&&I.encodeInitMessageHeaders||!1,this.P&&this.O&&(this.O=!1),this.Ua=I&&I.Rb||!1,I&&I.xa&&this.j.xa(),I&&I.forceLongPolling&&(this.X=!1),this.ba=!this.P&&this.X&&I&&I.detectBufferingProxy||!1,this.ja=void 0,I&&I.longPollingTimeout&&0<I.longPollingTimeout&&(this.ja=I.longPollingTimeout),this.ca=void 0,this.R=0,this.M=!1,this.ka=this.A=null}n=Gu.prototype,n.la=8,n.G=1,n.connect=function(I,W,Q,pe){ji(0),this.W=I,this.H=W||{},Q&&pe!==void 0&&(this.H.OSID=Q,this.H.OAID=pe),this.F=this.X,this.I=Bg(this,null,this.W),_c(this)};function Ji(I){if(qd(I),I.G==3){var W=I.U++,Q=Oo(I.I);if(Gr(Q,"SID",I.K),Gr(Q,"RID",W),Gr(Q,"TYPE","terminate"),Hu(I,Q),W=new fa(I,I.j,W),W.L=2,W.v=$a(Oo(Q)),Q=!1,y.navigator&&y.navigator.sendBeacon)try{Q=y.navigator.sendBeacon(W.v.toString(),"")}catch{}!Q&&y.Image&&(new Image().src=W.v,Q=!0),Q||(W.g=Qy(W.j,null),W.g.ea(W.v)),W.F=Date.now(),Fr(W)}qu(I)}function hl(I){I.g&&(jg(I),I.g.cancel(),I.g=null)}function qd(I){hl(I),I.u&&(y.clearTimeout(I.u),I.u=null),qp(I),I.h.cancel(),I.s&&(typeof I.s=="number"&&y.clearTimeout(I.s),I.s=null)}function _c(I){if(!fo(I.h)&&!I.s){I.s=!0;var W=I.Ga;we||Ne(),Ce||(we(),Ce=!0),ve.add(W,I),I.B=0}}function Fg(I,W){return Bp(I.h)>=I.h.j-(I.s?1:0)?!1:I.s?(I.i=W.D.concat(I.i),!0):I.G==1||I.G==2||I.B>=(I.Va?0:I.Wa)?!1:(I.s=za(N(I.Ga,I,W),$u(I,I.B)),I.B++,!0)}n.Ga=function(I){if(this.s)if(this.s=null,this.G==1){if(!I){this.U=Math.floor(1e5*Math.random()),I=this.U++;const qe=new fa(this,this.j,I);let at=this.o;if(this.S&&(at?(at=Z(at),se(at,this.S)):at=this.S),this.m!==null||this.O||(qe.H=at,at=null),this.P)e:{for(var W=0,Q=0;Q<this.i.length;Q++){t:{var pe=this.i[Q];if("__data__"in pe.map&&(pe=pe.map.__data__,typeof pe=="string")){pe=pe.length;break t}pe=void 0}if(pe===void 0)break;if(W+=pe,4096<W){W=Q;break e}if(W===4096||Q===this.i.length-1){W=Q+1;break e}}W=1e3}else W=1e3;W=Vo(this,qe,W),Q=Oo(this.I),Gr(Q,"RID",I),Gr(Q,"CVER",22),this.D&&Gr(Q,"X-HTTP-Session-Id",this.D),Hu(this,Q),at&&(this.O?W="headers="+encodeURIComponent(String(dl(at)))+"&"+W:this.m&&Se(Q,this.m,at)),pf(this.h,qe),this.Ua&&Gr(Q,"TYPE","init"),this.P?(Gr(Q,"$req",W),Gr(Q,"SID","null"),qe.T=!0,Wd(qe,Q,null)):Wd(qe,Q,W),this.G=2}}else this.G==3&&(I?$p(this,I):this.i.length==0||fo(this.h)||$p(this))};function $p(I,W){var Q;W?Q=W.l:Q=I.U++;const pe=Oo(I.I);Gr(pe,"SID",I.K),Gr(pe,"RID",Q),Gr(pe,"AID",I.T),Hu(I,pe),I.m&&I.o&&Se(pe,I.m,I.o),Q=new fa(I,I.j,Q,I.B+1),I.m===null&&(Q.H=I.o),W&&(I.i=W.D.concat(I.i)),W=Vo(I,Q,1e3),Q.I=Math.round(.5*I.wa)+Math.round(.5*I.wa*Math.random()),pf(I.h,Q),Wd(Q,pe,W)}function Hu(I,W){I.H&&ge(I.H,function(Q,pe){Gr(W,pe,Q)}),I.l&&Bl({},function(Q,pe){Gr(W,pe,Q)})}function Vo(I,W,Q){Q=Math.min(I.i.length,Q);var pe=I.l?N(I.l.Na,I.l,I):null;e:{var qe=I.i;let at=-1;for(;;){const xt=["count="+Q];at==-1?0<Q?(at=qe[0].g,xt.push("ofs="+at)):at=0:xt.push("ofs="+at);let Hr=!0;for(let oi=0;oi<Q;oi++){let Er=qe[oi].g;const Ws=qe[oi].map;if(Er-=at,0>Er)at=Math.max(0,qe[oi].g-100),Hr=!1;else try{_f(Ws,xt,"req"+Er+"_")}catch{pe&&pe(Ws)}}if(Hr){pe=xt.join("&");break e}}}return I=I.i.splice(0,Q),W.D=I,pe}function Kl(I){if(!I.g&&!I.u){I.Y=1;var W=I.Fa;we||Ne(),Ce||(we(),Ce=!0),ve.add(W,I),I.v=0}}function Kp(I){return I.g||I.u||3<=I.v?!1:(I.Y++,I.u=za(N(I.Fa,I),$u(I,I.v)),I.v++,!0)}n.Fa=function(){if(this.u=null,Jy(this),this.ba&&!(this.M||this.g==null||0>=this.R)){var I=2*this.R;this.j.info("BP detection timer enabled: "+I),this.A=za(N(this.ab,this),I)}},n.ab=function(){this.A&&(this.A=null,this.j.info("BP detection timeout reached."),this.j.info("Buffering proxy detected and switch to long-polling!"),this.F=!1,this.M=!0,ji(10),hl(this),Jy(this))};function jg(I){I.A!=null&&(y.clearTimeout(I.A),I.A=null)}function Jy(I){I.g=new fa(I,I.j,"rpc",I.Y),I.m===null&&(I.g.H=I.o),I.g.O=0;var W=Oo(I.qa);Gr(W,"RID","rpc"),Gr(W,"SID",I.K),Gr(W,"AID",I.T),Gr(W,"CI",I.F?"0":"1"),!I.F&&I.ja&&Gr(W,"TO",I.ja),Gr(W,"TYPE","xmlhttp"),Hu(I,W),I.m&&I.o&&Se(W,I.m,I.o),I.L&&(I.g.I=I.L);var Q=I.g;I=I.ia,Q.L=1,Q.v=$a(Oo(W)),Q.m=null,Q.P=!0,ju(Q,I)}n.Za=function(){this.C!=null&&(this.C=null,hl(this),Kp(this),ji(19))};function qp(I){I.C!=null&&(y.clearTimeout(I.C),I.C=null)}function Yp(I,W){var Q=null;if(I.g==W){qp(I),jg(I),I.g=null;var pe=2}else if(Xs(I.h,W))Q=W.D,cl(I.h,W),pe=1;else return;if(I.G!=0){if(W.o)if(pe==1){Q=W.m?W.m.length:0,W=Date.now()-W.F;var qe=I.B;pe=Mu(),an(pe,new hs(pe,Q)),_c(I)}else Kl(I);else if(qe=W.s,qe==3||qe==0&&0<W.X||!(pe==1&&Fg(I,W)||pe==2&&Kp(I)))switch(Q&&0<Q.length&&(W=I.h,W.i=W.i.concat(Q)),qe){case 1:Ku(I,5);break;case 4:Ku(I,10);break;case 3:Ku(I,6);break;default:Ku(I,2)}}}function $u(I,W){let Q=I.Ta+Math.floor(Math.random()*I.cb);return I.isActive()||(Q*=2),Q*W}function Ku(I,W){if(I.j.info("Error code "+W),W==2){var Q=N(I.fb,I),pe=I.Xa;const qe=!pe;pe=new Ha(pe||"//www.google.com/images/cleardot.gif"),y.location&&y.location.protocol=="http"||Wu(pe,"https"),$a(pe),qe?Gp(pe.toString(),Q):gc(pe.toString(),Q)}else ji(2);I.G=0,I.l&&I.l.sa(W),qu(I),qd(I)}n.fb=function(I){I?(this.j.info("Successfully pinged google.com"),ji(2)):(this.j.info("Failed to ping google.com"),ji(1))};function qu(I){if(I.G=0,I.ka=[],I.l){const W=Hd(I.h);(W.length!=0||I.i.length!=0)&&(G(I.ka,W),G(I.ka,I.i),I.h.i.length=0,B(I.i),I.i.length=0),I.l.ra()}}function Bg(I,W,Q){var pe=Q instanceof Ha?Oo(Q):new Ha(Q);if(pe.g!="")W&&(pe.g=W+"."+pe.g),ll(pe,pe.s);else{var qe=y.location;pe=qe.protocol,W=W?W+"."+qe.hostname:qe.hostname,qe=+qe.port;var at=new Ha(null);pe&&Wu(at,pe),W&&(at.g=W),qe&&ll(at,qe),Q&&(at.l=Q),pe=at}return Q=I.D,W=I.ya,Q&&W&&Gr(pe,Q,W),Gr(pe,"VER",I.la),Hu(I,pe),pe}function Qy(I,W,Q){if(W&&!I.J)throw Error("Can't create secondary domain capable XhrIo object.");return W=I.Ca&&!I.pa?new De(new ul({eb:Q})):new De(I.pa),W.Ha(I.J),W}n.isActive=function(){return!!this.l&&this.l.isActive(this)};function Mn(){}n=Mn.prototype,n.ua=function(){},n.ta=function(){},n.sa=function(){},n.ra=function(){},n.isActive=function(){return!0},n.Na=function(){};function Xp(){}Xp.prototype.g=function(I,W){return new Fo(I,W)};function Fo(I,W){fn.call(this),this.g=new Gu(W),this.l=I,this.h=W&&W.messageUrlParams||null,I=W&&W.messageHeaders||null,W&&W.clientProtocolHeaderRequired&&(I?I["X-Client-Protocol"]="webchannel":I={"X-Client-Protocol":"webchannel"}),this.g.o=I,I=W&&W.initMessageHeaders||null,W&&W.messageContentType&&(I?I["X-WebChannel-Content-Type"]=W.messageContentType:I={"X-WebChannel-Content-Type":W.messageContentType}),W&&W.va&&(I?I["X-WebChannel-Client-Profile"]=W.va:I={"X-WebChannel-Client-Profile":W.va}),this.g.S=I,(I=W&&W.Sb)&&!K(I)&&(this.g.m=I),this.v=W&&W.supportsCrossDomainXhr||!1,this.u=W&&W.sendRawJson||!1,(W=W&&W.httpSessionIdParam)&&!K(W)&&(this.g.D=W,I=this.h,I!==null&&W in I&&(I=this.h,W in I&&delete I[W])),this.j=new yc(this)}j(Fo,fn),Fo.prototype.m=function(){this.g.l=this.j,this.v&&(this.g.J=!0),this.g.connect(this.l,this.h||void 0)},Fo.prototype.close=function(){Ji(this.g)},Fo.prototype.o=function(I){var W=this.g;if(typeof I=="string"){var Q={};Q.__data__=I,I=Q}else this.u&&(Q={},Q.__data__=dr(I),I=Q);W.i.push(new Gd(W.Ya++,I)),W.G==3&&_c(W)},Fo.prototype.N=function(){this.g.l=null,delete this.j,Ji(this.g),delete this.g,Fo.aa.N.call(this)};function Zy(I){uc.call(this),I.__headers__&&(this.headers=I.__headers__,this.statusCode=I.__status__,delete I.__headers__,delete I.__status__);var W=I.__sm__;if(W){e:{for(const Q in W){I=Q;break e}I=void 0}(this.i=I)&&(I=this.i,W=W!==null&&I in W?W[I]:void 0),this.data=W}else this.data=I}j(Zy,uc);function eE(){ua.call(this),this.status=1}j(eE,ua);function yc(I){this.g=I}j(yc,Mn),yc.prototype.ua=function(){an(this.g,"a")},yc.prototype.ta=function(I){an(this.g,new Zy(I))},yc.prototype.sa=function(I){an(this.g,new eE)},yc.prototype.ra=function(){an(this.g,"b")},Xp.prototype.createWebChannel=Xp.prototype.g,Fo.prototype.send=Fo.prototype.o,Fo.prototype.open=Fo.prototype.m,Fo.prototype.close=Fo.prototype.close,zre=function(){return new Xp},Wre=function(){return Mu()},Bre=dc,wV={mb:0,pb:1,qb:2,Jb:3,Ob:4,Lb:5,Mb:6,Kb:7,Ib:8,Nb:9,PROXY:10,NOPROXY:11,Gb:12,Cb:13,Db:14,Bb:15,Eb:16,Fb:17,ib:18,hb:19,jb:20},Vu.NO_ERROR=0,Vu.TIMEOUT=8,Vu.HTTP_ERROR=6,uk=Vu,hf.COMPLETE="complete",jre=hf,Fl.EventType=js,js.OPEN="a",js.CLOSE="b",js.ERROR="c",js.MESSAGE="d",fn.prototype.listen=fn.prototype.K,Fw=Fl,De.prototype.listenOnce=De.prototype.L,De.prototype.getLastError=De.prototype.Ka,De.prototype.getLastErrorCode=De.prototype.Ba,De.prototype.getStatus=De.prototype.Z,De.prototype.getResponseJson=De.prototype.Oa,De.prototype.getResponseText=De.prototype.oa,De.prototype.send=De.prototype.ea,De.prototype.setWithCredentials=De.prototype.Ha,Fre=De}).apply(typeof AO<"u"?AO:typeof self<"u"?self:typeof window<"u"?window:{});const yX="@firebase/firestore",EX="4.7.10";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class xa{constructor(e){this.uid=e}isAuthenticated(){return this.uid!=null}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}}xa.UNAUTHENTICATED=new xa(null),xa.GOOGLE_CREDENTIALS=new xa("google-credentials-uid"),xa.FIRST_PARTY=new xa("first-party-uid"),xa.MOCK_USER=new xa("mock-user");/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let V0="11.5.0";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Vy=new Oj("@firebase/firestore");function bS(){return Vy.logLevel}function Zt(n,...e){if(Vy.logLevel<=br.DEBUG){const i=e.map(Bj);Vy.debug(`Firestore (${V0}): ${n}`,...i)}}function xp(n,...e){if(Vy.logLevel<=br.ERROR){const i=e.map(Bj);Vy.error(`Firestore (${V0}): ${n}`,...i)}}function g0(n,...e){if(Vy.logLevel<=br.WARN){const i=e.map(Bj);Vy.warn(`Firestore (${V0}): ${n}`,...i)}}function Bj(n){if(typeof n=="string")return n;try{/**
* @license
* Copyright 2020 Google LLC
*
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
*   http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
*/return function(i){return JSON.stringify(i)}(n)}catch{return n}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function jn(n="Unexpected state"){const e=`FIRESTORE (${V0}) INTERNAL ASSERTION FAILED: `+n;throw xp(e),new Error(e)}function si(n,e){n||jn()}function qn(n,e){return n}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const _t={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class zt extends df{constructor(e,i){super(e,i),this.code=e,this.message=i,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ap{constructor(){this.promise=new Promise((e,i)=>{this.resolve=e,this.reject=i})}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Gre{constructor(e,i){this.user=i,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${e}`)}}class tje{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,i){e.enqueueRetryable(()=>i(xa.UNAUTHENTICATED))}shutdown(){}}class nje{constructor(e){this.token=e,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(e,i){this.changeListener=i,e.enqueueRetryable(()=>i(this.token.user))}shutdown(){this.changeListener=null}}class rje{constructor(e){this.t=e,this.currentUser=xa.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(e,i){si(this.o===void 0);let a=this.i;const l=v=>this.i!==a?(a=this.i,i(v)):Promise.resolve();let d=new Ap;this.o=()=>{this.i++,this.currentUser=this.u(),d.resolve(),d=new Ap,e.enqueueRetryable(()=>l(this.currentUser))};const p=()=>{const v=d;e.enqueueRetryable(async()=>{await v.promise,await l(this.currentUser)})},y=v=>{Zt("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=v,this.o&&(this.auth.addAuthTokenListener(this.o),p())};this.t.onInit(v=>y(v)),setTimeout(()=>{if(!this.auth){const v=this.t.getImmediate({optional:!0});v?y(v):(Zt("FirebaseAuthCredentialsProvider","Auth not yet detected"),d.resolve(),d=new Ap)}},0),p()}getToken(){const e=this.i,i=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(i).then(a=>this.i!==e?(Zt("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):a?(si(typeof a.accessToken=="string"),new Gre(a.accessToken,this.currentUser)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.o&&this.auth.removeAuthTokenListener(this.o),this.o=void 0}u(){const e=this.auth&&this.auth.getUid();return si(e===null||typeof e=="string"),new xa(e)}}class ije{constructor(e,i,a){this.l=e,this.h=i,this.P=a,this.type="FirstParty",this.user=xa.FIRST_PARTY,this.T=new Map}I(){return this.P?this.P():null}get headers(){this.T.set("X-Goog-AuthUser",this.l);const e=this.I();return e&&this.T.set("Authorization",e),this.h&&this.T.set("X-Goog-Iam-Authorization-Token",this.h),this.T}}class sje{constructor(e,i,a){this.l=e,this.h=i,this.P=a}getToken(){return Promise.resolve(new ije(this.l,this.h,this.P))}start(e,i){e.enqueueRetryable(()=>i(xa.FIRST_PARTY))}shutdown(){}invalidateToken(){}}class vX{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&e.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class oje{constructor(e,i){this.A=i,this.forceRefresh=!1,this.appCheck=null,this.R=null,this.V=null,Al(e)&&e.settings.appCheckToken&&(this.V=e.settings.appCheckToken)}start(e,i){si(this.o===void 0);const a=d=>{d.error!=null&&Zt("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${d.error.message}`);const p=d.token!==this.R;return this.R=d.token,Zt("FirebaseAppCheckTokenProvider",`Received ${p?"new":"existing"} token.`),p?i(d.token):Promise.resolve()};this.o=d=>{e.enqueueRetryable(()=>a(d))};const l=d=>{Zt("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=d,this.o&&this.appCheck.addTokenListener(this.o)};this.A.onInit(d=>l(d)),setTimeout(()=>{if(!this.appCheck){const d=this.A.getImmediate({optional:!0});d?l(d):Zt("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}},0)}getToken(){if(this.V)return Promise.resolve(new vX(this.V));const e=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(e).then(i=>i?(si(typeof i.token=="string"),this.R=i.token,new vX(i.token)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.o&&this.appCheck.removeTokenListener(this.o),this.o=void 0}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function aje(n){const e=typeof self<"u"&&(self.crypto||self.msCrypto),i=new Uint8Array(n);if(e&&typeof e.getRandomValues=="function")e.getRandomValues(i);else for(let a=0;a<n;a++)i[a]=Math.floor(256*Math.random());return i}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Hre(){return new TextEncoder}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class $re{static newId(){const e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",i=62*Math.floor(4.129032258064516);let a="";for(;a.length<20;){const l=aje(40);for(let d=0;d<l.length;++d)a.length<20&&l[d]<i&&(a+=e.charAt(l[d]%62))}return a}}function ur(n,e){return n<e?-1:n>e?1:0}function RV(n,e){let i=0;for(;i<n.length&&i<e.length;){const a=n.codePointAt(i),l=e.codePointAt(i);if(a!==l){if(a<128&&l<128)return ur(a,l);{const d=Hre(),p=cje(d.encode(SX(n,i)),d.encode(SX(e,i)));return p!==0?p:ur(a,l)}}i+=a>65535?2:1}return ur(n.length,e.length)}function SX(n,e){return n.codePointAt(e)>65535?n.substring(e,e+2):n.substring(e,e+1)}function cje(n,e){for(let i=0;i<n.length&&i<e.length;++i)if(n[i]!==e[i])return ur(n[i],e[i]);return ur(n.length,e.length)}function _0(n,e,i){return n.length===e.length&&n.every((a,l)=>i(a,e[l]))}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const bX=-62135596800,TX=1e6;class ao{static now(){return ao.fromMillis(Date.now())}static fromDate(e){return ao.fromMillis(e.getTime())}static fromMillis(e){const i=Math.floor(e/1e3),a=Math.floor((e-1e3*i)*TX);return new ao(i,a)}constructor(e,i){if(this.seconds=e,this.nanoseconds=i,i<0)throw new zt(_t.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+i);if(i>=1e9)throw new zt(_t.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+i);if(e<bX)throw new zt(_t.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e);if(e>=253402300800)throw new zt(_t.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/TX}_compareTo(e){return this.seconds===e.seconds?ur(this.nanoseconds,e.nanoseconds):ur(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}}valueOf(){const e=this.seconds-bX;return String(e).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Gn{static fromTimestamp(e){return new Gn(e)}static min(){return new Gn(new ao(0,0))}static max(){return new Gn(new ao(253402300799,999999999))}constructor(e){this.timestamp=e}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const wX="__name__";class Mh{constructor(e,i,a){i===void 0?i=0:i>e.length&&jn(),a===void 0?a=e.length-i:a>e.length-i&&jn(),this.segments=e,this.offset=i,this.len=a}get length(){return this.len}isEqual(e){return Mh.comparator(this,e)===0}child(e){const i=this.segments.slice(this.offset,this.limit());return e instanceof Mh?e.forEach(a=>{i.push(a)}):i.push(e),this.construct(i)}limit(){return this.offset+this.length}popFirst(e){return e=e===void 0?1:e,this.construct(this.segments,this.offset+e,this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return this.length===0}isPrefixOf(e){if(e.length<this.length)return!1;for(let i=0;i<this.length;i++)if(this.get(i)!==e.get(i))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let i=0;i<this.length;i++)if(this.get(i)!==e.get(i))return!1;return!0}forEach(e){for(let i=this.offset,a=this.limit();i<a;i++)e(this.segments[i])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,i){const a=Math.min(e.length,i.length);for(let l=0;l<a;l++){const d=Mh.compareSegments(e.get(l),i.get(l));if(d!==0)return d}return ur(e.length,i.length)}static compareSegments(e,i){const a=Mh.isNumericId(e),l=Mh.isNumericId(i);return a&&!l?-1:!a&&l?1:a&&l?Mh.extractNumericId(e).compare(Mh.extractNumericId(i)):RV(e,i)}static isNumericId(e){return e.startsWith("__id")&&e.endsWith("__")}static extractNumericId(e){return mg.fromString(e.substring(4,e.length-2))}}class Li extends Mh{construct(e,i,a){return new Li(e,i,a)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(...e){const i=[];for(const a of e){if(a.indexOf("//")>=0)throw new zt(_t.INVALID_ARGUMENT,`Invalid segment (${a}). Paths must not contain // in them.`);i.push(...a.split("/").filter(l=>l.length>0))}return new Li(i)}static emptyPath(){return new Li([])}}const lje=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class na extends Mh{construct(e,i,a){return new na(e,i,a)}static isValidIdentifier(e){return lje.test(e)}canonicalString(){return this.toArray().map(e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),na.isValidIdentifier(e)||(e="`"+e+"`"),e)).join(".")}toString(){return this.canonicalString()}isKeyField(){return this.length===1&&this.get(0)===wX}static keyField(){return new na([wX])}static fromServerFormat(e){const i=[];let a="",l=0;const d=()=>{if(a.length===0)throw new zt(_t.INVALID_ARGUMENT,`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);i.push(a),a=""};let p=!1;for(;l<e.length;){const y=e[l];if(y==="\\"){if(l+1===e.length)throw new zt(_t.INVALID_ARGUMENT,"Path has trailing escape character: "+e);const v=e[l+1];if(v!=="\\"&&v!=="."&&v!=="`")throw new zt(_t.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);a+=v,l+=2}else y==="`"?(p=!p,l++):y!=="."||p?(a+=y,l++):(d(),l++)}if(d(),p)throw new zt(_t.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new na(i)}static emptyPath(){return new na([])}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class yn{constructor(e){this.path=e}static fromPath(e){return new yn(Li.fromString(e))}static fromName(e){return new yn(Li.fromString(e).popFirst(5))}static empty(){return new yn(Li.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(e){return e!==null&&Li.comparator(this.path,e.path)===0}toString(){return this.path.toString()}static comparator(e,i){return Li.comparator(e.path,i.path)}static isDocumentKey(e){return e.length%2==0}static fromSegments(e){return new yn(new Li(e.slice()))}}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const LR=-1;function uje(n,e){const i=n.toTimestamp().seconds,a=n.toTimestamp().nanoseconds+1,l=Gn.fromTimestamp(a===1e9?new ao(i+1,0):new ao(i,a));return new wg(l,yn.empty(),e)}function dje(n){return new wg(n.readTime,n.key,LR)}class wg{constructor(e,i,a){this.readTime=e,this.documentKey=i,this.largestBatchId=a}static min(){return new wg(Gn.min(),yn.empty(),LR)}static max(){return new wg(Gn.max(),yn.empty(),LR)}}function hje(n,e){let i=n.readTime.compareTo(e.readTime);return i!==0?i:(i=yn.comparator(n.documentKey,e.documentKey),i!==0?i:ur(n.largestBatchId,e.largestBatchId))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const fje="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.";class pje{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach(e=>e())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function F0(n){if(n.code!==_t.FAILED_PRECONDITION||n.message!==fje)throw n;Zt("LocalStore","Unexpectedly lost primary lease")}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class wt{constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e(i=>{this.isDone=!0,this.result=i,this.nextCallback&&this.nextCallback(i)},i=>{this.isDone=!0,this.error=i,this.catchCallback&&this.catchCallback(i)})}catch(e){return this.next(void 0,e)}next(e,i){return this.callbackAttached&&jn(),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(i,this.error):this.wrapSuccess(e,this.result):new wt((a,l)=>{this.nextCallback=d=>{this.wrapSuccess(e,d).next(a,l)},this.catchCallback=d=>{this.wrapFailure(i,d).next(a,l)}})}toPromise(){return new Promise((e,i)=>{this.next(e,i)})}wrapUserFunction(e){try{const i=e();return i instanceof wt?i:wt.resolve(i)}catch(i){return wt.reject(i)}}wrapSuccess(e,i){return e?this.wrapUserFunction(()=>e(i)):wt.resolve(i)}wrapFailure(e,i){return e?this.wrapUserFunction(()=>e(i)):wt.reject(i)}static resolve(e){return new wt((i,a)=>{i(e)})}static reject(e){return new wt((i,a)=>{a(e)})}static waitFor(e){return new wt((i,a)=>{let l=0,d=0,p=!1;e.forEach(y=>{++l,y.next(()=>{++d,p&&d===l&&i()},v=>a(v))}),p=!0,d===l&&i()})}static or(e){let i=wt.resolve(!1);for(const a of e)i=i.next(l=>l?wt.resolve(l):a());return i}static forEach(e,i){const a=[];return e.forEach((l,d)=>{a.push(i.call(this,l,d))}),this.waitFor(a)}static mapArray(e,i){return new wt((a,l)=>{const d=e.length,p=new Array(d);let y=0;for(let v=0;v<d;v++){const b=v;i(e[b]).next(w=>{p[b]=w,++y,y===d&&a(p)},w=>l(w))}})}static doWhile(e,i){return new wt((a,l)=>{const d=()=>{e()===!0?i().next(()=>{d()},l):a()};d()})}}function mje(n){const e=n.match(/Android ([\d.]+)/i),i=e?e[1].split(".").slice(0,2).join("."):"-1";return Number(i)}function j0(n){return n.name==="IndexedDbTransactionError"}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class W1{constructor(e,i){this.previousValue=e,i&&(i.sequenceNumberHandler=a=>this.oe(a),this._e=a=>i.writeSequenceNumber(a))}oe(e){return this.previousValue=Math.max(e,this.previousValue),this.previousValue}next(){const e=++this.previousValue;return this._e&&this._e(e),e}}W1.ae=-1;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Wj=-1;function z1(n){return n==null}function Gk(n){return n===0&&1/n==-1/0}function gje(n){return typeof n=="number"&&Number.isInteger(n)&&!Gk(n)&&n<=Number.MAX_SAFE_INTEGER&&n>=Number.MIN_SAFE_INTEGER}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Kre="";function _je(n){let e="";for(let i=0;i<n.length;i++)e.length>0&&(e=RX(e)),e=yje(n.get(i),e);return RX(e)}function yje(n,e){let i=e;const a=n.length;for(let l=0;l<a;l++){const d=n.charAt(l);switch(d){case"\0":i+="";break;case Kre:i+="";break;default:i+=d}}return i}function RX(n){return n+Kre+""}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function CX(n){let e=0;for(const i in n)Object.prototype.hasOwnProperty.call(n,i)&&e++;return e}function xg(n,e){for(const i in n)Object.prototype.hasOwnProperty.call(n,i)&&e(i,n[i])}function qre(n){for(const e in n)if(Object.prototype.hasOwnProperty.call(n,e))return!1;return!0}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ds{constructor(e,i){this.comparator=e,this.root=i||ea.EMPTY}insert(e,i){return new ds(this.comparator,this.root.insert(e,i,this.comparator).copy(null,null,ea.BLACK,null,null))}remove(e){return new ds(this.comparator,this.root.remove(e,this.comparator).copy(null,null,ea.BLACK,null,null))}get(e){let i=this.root;for(;!i.isEmpty();){const a=this.comparator(e,i.key);if(a===0)return i.value;a<0?i=i.left:a>0&&(i=i.right)}return null}indexOf(e){let i=0,a=this.root;for(;!a.isEmpty();){const l=this.comparator(e,a.key);if(l===0)return i+a.left.size;l<0?a=a.left:(i+=a.left.size+1,a=a.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(e){this.inorderTraversal((i,a)=>(e(i,a),!1))}toString(){const e=[];return this.inorderTraversal((i,a)=>(e.push(`${i}:${a}`),!1)),`{${e.join(", ")}}`}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new PO(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new PO(this.root,e,this.comparator,!1)}getReverseIterator(){return new PO(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new PO(this.root,e,this.comparator,!0)}}class PO{constructor(e,i,a,l){this.isReverse=l,this.nodeStack=[];let d=1;for(;!e.isEmpty();)if(d=i?a(e.key,i):1,i&&l&&(d*=-1),d<0)e=this.isReverse?e.left:e.right;else{if(d===0){this.nodeStack.push(e);break}this.nodeStack.push(e),e=this.isReverse?e.right:e.left}}getNext(){let e=this.nodeStack.pop();const i={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return i}hasNext(){return this.nodeStack.length>0}peek(){if(this.nodeStack.length===0)return null;const e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}}class ea{constructor(e,i,a,l,d){this.key=e,this.value=i,this.color=a??ea.RED,this.left=l??ea.EMPTY,this.right=d??ea.EMPTY,this.size=this.left.size+1+this.right.size}copy(e,i,a,l,d){return new ea(e??this.key,i??this.value,a??this.color,l??this.left,d??this.right)}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,i,a){let l=this;const d=a(e,l.key);return l=d<0?l.copy(null,null,null,l.left.insert(e,i,a),null):d===0?l.copy(null,i,null,null,null):l.copy(null,null,null,null,l.right.insert(e,i,a)),l.fixUp()}removeMin(){if(this.left.isEmpty())return ea.EMPTY;let e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),e=e.copy(null,null,null,e.left.removeMin(),null),e.fixUp()}remove(e,i){let a,l=this;if(i(e,l.key)<0)l.left.isEmpty()||l.left.isRed()||l.left.left.isRed()||(l=l.moveRedLeft()),l=l.copy(null,null,null,l.left.remove(e,i),null);else{if(l.left.isRed()&&(l=l.rotateRight()),l.right.isEmpty()||l.right.isRed()||l.right.left.isRed()||(l=l.moveRedRight()),i(e,l.key)===0){if(l.right.isEmpty())return ea.EMPTY;a=l.right.min(),l=l.copy(a.key,a.value,null,null,l.right.removeMin())}l=l.copy(null,null,null,null,l.right.remove(e,i))}return l.fixUp()}isRed(){return this.color}fixUp(){let e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e}moveRedLeft(){let e=this.colorFlip();return e.right.left.isRed()&&(e=e.copy(null,null,null,null,e.right.rotateRight()),e=e.rotateLeft(),e=e.colorFlip()),e}moveRedRight(){let e=this.colorFlip();return e.left.left.isRed()&&(e=e.rotateRight(),e=e.colorFlip()),e}rotateLeft(){const e=this.copy(null,null,ea.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight(){const e=this.copy(null,null,ea.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip(){const e=this.left.copy(null,null,!this.left.color,null,null),i=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,i)}checkMaxDepth(){const e=this.check();return Math.pow(2,e)<=this.size+1}check(){if(this.isRed()&&this.left.isRed()||this.right.isRed())throw jn();const e=this.left.check();if(e!==this.right.check())throw jn();return e+(this.isRed()?0:1)}}ea.EMPTY=null,ea.RED=!0,ea.BLACK=!1;ea.EMPTY=new class{constructor(){this.size=0}get key(){throw jn()}get value(){throw jn()}get color(){throw jn()}get left(){throw jn()}get right(){throw jn()}copy(e,i,a,l,d){return this}insert(e,i,a){return new ea(e,i)}remove(e,i){return this}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class co{constructor(e){this.comparator=e,this.data=new ds(this.comparator)}has(e){return this.data.get(e)!==null}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(e){this.data.inorderTraversal((i,a)=>(e(i),!1))}forEachInRange(e,i){const a=this.data.getIteratorFrom(e[0]);for(;a.hasNext();){const l=a.getNext();if(this.comparator(l.key,e[1])>=0)return;i(l.key)}}forEachWhile(e,i){let a;for(a=i!==void 0?this.data.getIteratorFrom(i):this.data.getIterator();a.hasNext();)if(!e(a.getNext().key))return}firstAfterOrEqual(e){const i=this.data.getIteratorFrom(e);return i.hasNext()?i.getNext().key:null}getIterator(){return new IX(this.data.getIterator())}getIteratorFrom(e){return new IX(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let i=this;return i.size<e.size&&(i=e,e=this),e.forEach(a=>{i=i.add(a)}),i}isEqual(e){if(!(e instanceof co)||this.size!==e.size)return!1;const i=this.data.getIterator(),a=e.data.getIterator();for(;i.hasNext();){const l=i.getNext().key,d=a.getNext().key;if(this.comparator(l,d)!==0)return!1}return!0}toArray(){const e=[];return this.forEach(i=>{e.push(i)}),e}toString(){const e=[];return this.forEach(i=>e.push(i)),"SortedSet("+e.toString()+")"}copy(e){const i=new co(this.comparator);return i.data=e,i}}class IX{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Pl{constructor(e){this.fields=e,e.sort(na.comparator)}static empty(){return new Pl([])}unionWith(e){let i=new co(na.comparator);for(const a of this.fields)i=i.add(a);for(const a of e)i=i.add(a);return new Pl(i.toArray())}covers(e){for(const i of this.fields)if(i.isPrefixOf(e))return!0;return!1}isEqual(e){return _0(this.fields,e.fields,(i,a)=>i.isEqual(a))}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Yre extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class aa{constructor(e){this.binaryString=e}static fromBase64String(e){const i=function(l){try{return atob(l)}catch(d){throw typeof DOMException<"u"&&d instanceof DOMException?new Yre("Invalid base64 string: "+d):d}}(e);return new aa(i)}static fromUint8Array(e){const i=function(l){let d="";for(let p=0;p<l.length;++p)d+=String.fromCharCode(l[p]);return d}(e);return new aa(i)}[Symbol.iterator](){let e=0;return{next:()=>e<this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return function(i){return btoa(i)}(this.binaryString)}toUint8Array(){return function(i){const a=new Uint8Array(i.length);for(let l=0;l<i.length;l++)a[l]=i.charCodeAt(l);return a}(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(e){return ur(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}}aa.EMPTY_BYTE_STRING=new aa("");const Eje=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function Rg(n){if(si(!!n),typeof n=="string"){let e=0;const i=Eje.exec(n);if(si(!!i),i[1]){let l=i[1];l=(l+"000000000").substr(0,9),e=Number(l)}const a=new Date(n);return{seconds:Math.floor(a.getTime()/1e3),nanos:e}}return{seconds:Us(n.seconds),nanos:Us(n.nanos)}}function Us(n){return typeof n=="number"?n:typeof n=="string"?Number(n):0}function Cg(n){return typeof n=="string"?aa.fromBase64String(n):aa.fromUint8Array(n)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Xre="server_timestamp",Jre="__type__",Qre="__previous_value__",Zre="__local_write_time__";function G1(n){var e,i;return((i=(((e=n==null?void 0:n.mapValue)===null||e===void 0?void 0:e.fields)||{})[Jre])===null||i===void 0?void 0:i.stringValue)===Xre}function H1(n){const e=n.mapValue.fields[Qre];return G1(e)?H1(e):e}function xR(n){const e=Rg(n.mapValue.fields[Zre].timestampValue);return new ao(e.seconds,e.nanos)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class vje{constructor(e,i,a,l,d,p,y,v,b){this.databaseId=e,this.appId=i,this.persistenceKey=a,this.host=l,this.ssl=d,this.forceLongPolling=p,this.autoDetectLongPolling=y,this.longPollingOptions=v,this.useFetchStreams=b}}const Hk="(default)";class MR{constructor(e,i){this.projectId=e,this.database=i||Hk}static empty(){return new MR("","")}get isDefaultDatabase(){return this.database===Hk}isEqual(e){return e instanceof MR&&e.projectId===this.projectId&&e.database===this.database}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const eie="__type__",Sje="__max__",OO={mapValue:{}},tie="__vector__",$k="value";function Ig(n){return"nullValue"in n?0:"booleanValue"in n?1:"integerValue"in n||"doubleValue"in n?2:"timestampValue"in n?3:"stringValue"in n?5:"bytesValue"in n?6:"referenceValue"in n?7:"geoPointValue"in n?8:"arrayValue"in n?9:"mapValue"in n?G1(n)?4:Tje(n)?9007199254740991:bje(n)?10:11:jn()}function of(n,e){if(n===e)return!0;const i=Ig(n);if(i!==Ig(e))return!1;switch(i){case 0:case 9007199254740991:return!0;case 1:return n.booleanValue===e.booleanValue;case 4:return xR(n).isEqual(xR(e));case 3:return function(l,d){if(typeof l.timestampValue=="string"&&typeof d.timestampValue=="string"&&l.timestampValue.length===d.timestampValue.length)return l.timestampValue===d.timestampValue;const p=Rg(l.timestampValue),y=Rg(d.timestampValue);return p.seconds===y.seconds&&p.nanos===y.nanos}(n,e);case 5:return n.stringValue===e.stringValue;case 6:return function(l,d){return Cg(l.bytesValue).isEqual(Cg(d.bytesValue))}(n,e);case 7:return n.referenceValue===e.referenceValue;case 8:return function(l,d){return Us(l.geoPointValue.latitude)===Us(d.geoPointValue.latitude)&&Us(l.geoPointValue.longitude)===Us(d.geoPointValue.longitude)}(n,e);case 2:return function(l,d){if("integerValue"in l&&"integerValue"in d)return Us(l.integerValue)===Us(d.integerValue);if("doubleValue"in l&&"doubleValue"in d){const p=Us(l.doubleValue),y=Us(d.doubleValue);return p===y?Gk(p)===Gk(y):isNaN(p)&&isNaN(y)}return!1}(n,e);case 9:return _0(n.arrayValue.values||[],e.arrayValue.values||[],of);case 10:case 11:return function(l,d){const p=l.mapValue.fields||{},y=d.mapValue.fields||{};if(CX(p)!==CX(y))return!1;for(const v in p)if(p.hasOwnProperty(v)&&(y[v]===void 0||!of(p[v],y[v])))return!1;return!0}(n,e);default:return jn()}}function UR(n,e){return(n.values||[]).find(i=>of(i,e))!==void 0}function y0(n,e){if(n===e)return 0;const i=Ig(n),a=Ig(e);if(i!==a)return ur(i,a);switch(i){case 0:case 9007199254740991:return 0;case 1:return ur(n.booleanValue,e.booleanValue);case 2:return function(d,p){const y=Us(d.integerValue||d.doubleValue),v=Us(p.integerValue||p.doubleValue);return y<v?-1:y>v?1:y===v?0:isNaN(y)?isNaN(v)?0:-1:1}(n,e);case 3:return AX(n.timestampValue,e.timestampValue);case 4:return AX(xR(n),xR(e));case 5:return RV(n.stringValue,e.stringValue);case 6:return function(d,p){const y=Cg(d),v=Cg(p);return y.compareTo(v)}(n.bytesValue,e.bytesValue);case 7:return function(d,p){const y=d.split("/"),v=p.split("/");for(let b=0;b<y.length&&b<v.length;b++){const w=ur(y[b],v[b]);if(w!==0)return w}return ur(y.length,v.length)}(n.referenceValue,e.referenceValue);case 8:return function(d,p){const y=ur(Us(d.latitude),Us(p.latitude));return y!==0?y:ur(Us(d.longitude),Us(p.longitude))}(n.geoPointValue,e.geoPointValue);case 9:return PX(n.arrayValue,e.arrayValue);case 10:return function(d,p){var y,v,b,w;const A=d.fields||{},N=p.fields||{},V=(y=A[$k])===null||y===void 0?void 0:y.arrayValue,j=(v=N[$k])===null||v===void 0?void 0:v.arrayValue,B=ur(((b=V==null?void 0:V.values)===null||b===void 0?void 0:b.length)||0,((w=j==null?void 0:j.values)===null||w===void 0?void 0:w.length)||0);return B!==0?B:PX(V,j)}(n.mapValue,e.mapValue);case 11:return function(d,p){if(d===OO.mapValue&&p===OO.mapValue)return 0;if(d===OO.mapValue)return 1;if(p===OO.mapValue)return-1;const y=d.fields||{},v=Object.keys(y),b=p.fields||{},w=Object.keys(b);v.sort(),w.sort();for(let A=0;A<v.length&&A<w.length;++A){const N=RV(v[A],w[A]);if(N!==0)return N;const V=y0(y[v[A]],b[w[A]]);if(V!==0)return V}return ur(v.length,w.length)}(n.mapValue,e.mapValue);default:throw jn()}}function AX(n,e){if(typeof n=="string"&&typeof e=="string"&&n.length===e.length)return ur(n,e);const i=Rg(n),a=Rg(e),l=ur(i.seconds,a.seconds);return l!==0?l:ur(i.nanos,a.nanos)}function PX(n,e){const i=n.values||[],a=e.values||[];for(let l=0;l<i.length&&l<a.length;++l){const d=y0(i[l],a[l]);if(d)return d}return ur(i.length,a.length)}function E0(n){return CV(n)}function CV(n){return"nullValue"in n?"null":"booleanValue"in n?""+n.booleanValue:"integerValue"in n?""+n.integerValue:"doubleValue"in n?""+n.doubleValue:"timestampValue"in n?function(i){const a=Rg(i);return`time(${a.seconds},${a.nanos})`}(n.timestampValue):"stringValue"in n?n.stringValue:"bytesValue"in n?function(i){return Cg(i).toBase64()}(n.bytesValue):"referenceValue"in n?function(i){return yn.fromName(i).toString()}(n.referenceValue):"geoPointValue"in n?function(i){return`geo(${i.latitude},${i.longitude})`}(n.geoPointValue):"arrayValue"in n?function(i){let a="[",l=!0;for(const d of i.values||[])l?l=!1:a+=",",a+=CV(d);return a+"]"}(n.arrayValue):"mapValue"in n?function(i){const a=Object.keys(i.fields||{}).sort();let l="{",d=!0;for(const p of a)d?d=!1:l+=",",l+=`${p}:${CV(i.fields[p])}`;return l+"}"}(n.mapValue):jn()}function dk(n){switch(Ig(n)){case 0:case 1:return 4;case 2:return 8;case 3:case 8:return 16;case 4:const e=H1(n);return e?16+dk(e):16;case 5:return 2*n.stringValue.length;case 6:return Cg(n.bytesValue).approximateByteSize();case 7:return n.referenceValue.length;case 9:return function(a){return(a.values||[]).reduce((l,d)=>l+dk(d),0)}(n.arrayValue);case 10:case 11:return function(a){let l=0;return xg(a.fields,(d,p)=>{l+=d.length+dk(p)}),l}(n.mapValue);default:throw jn()}}function Kk(n,e){return{referenceValue:`projects/${n.projectId}/databases/${n.database}/documents/${e.path.canonicalString()}`}}function IV(n){return!!n&&"integerValue"in n}function zj(n){return!!n&&"arrayValue"in n}function OX(n){return!!n&&"nullValue"in n}function kX(n){return!!n&&"doubleValue"in n&&isNaN(Number(n.doubleValue))}function hk(n){return!!n&&"mapValue"in n}function bje(n){var e,i;return((i=(((e=n==null?void 0:n.mapValue)===null||e===void 0?void 0:e.fields)||{})[eie])===null||i===void 0?void 0:i.stringValue)===tie}function oR(n){if(n.geoPointValue)return{geoPointValue:Object.assign({},n.geoPointValue)};if(n.timestampValue&&typeof n.timestampValue=="object")return{timestampValue:Object.assign({},n.timestampValue)};if(n.mapValue){const e={mapValue:{fields:{}}};return xg(n.mapValue.fields,(i,a)=>e.mapValue.fields[i]=oR(a)),e}if(n.arrayValue){const e={arrayValue:{values:[]}};for(let i=0;i<(n.arrayValue.values||[]).length;++i)e.arrayValue.values[i]=oR(n.arrayValue.values[i]);return e}return Object.assign({},n)}function Tje(n){return(((n.mapValue||{}).fields||{}).__type__||{}).stringValue===Sje}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Yc{constructor(e){this.value=e}static empty(){return new Yc({mapValue:{}})}field(e){if(e.isEmpty())return this.value;{let i=this.value;for(let a=0;a<e.length-1;++a)if(i=(i.mapValue.fields||{})[e.get(a)],!hk(i))return null;return i=(i.mapValue.fields||{})[e.lastSegment()],i||null}}set(e,i){this.getFieldsMap(e.popLast())[e.lastSegment()]=oR(i)}setAll(e){let i=na.emptyPath(),a={},l=[];e.forEach((p,y)=>{if(!i.isImmediateParentOf(y)){const v=this.getFieldsMap(i);this.applyChanges(v,a,l),a={},l=[],i=y.popLast()}p?a[y.lastSegment()]=oR(p):l.push(y.lastSegment())});const d=this.getFieldsMap(i);this.applyChanges(d,a,l)}delete(e){const i=this.field(e.popLast());hk(i)&&i.mapValue.fields&&delete i.mapValue.fields[e.lastSegment()]}isEqual(e){return of(this.value,e.value)}getFieldsMap(e){let i=this.value;i.mapValue.fields||(i.mapValue={fields:{}});for(let a=0;a<e.length;++a){let l=i.mapValue.fields[e.get(a)];hk(l)&&l.mapValue.fields||(l={mapValue:{fields:{}}},i.mapValue.fields[e.get(a)]=l),i=l}return i.mapValue.fields}applyChanges(e,i,a){xg(i,(l,d)=>e[l]=d);for(const l of a)delete e[l]}clone(){return new Yc(oR(this.value))}}function nie(n){const e=[];return xg(n.fields,(i,a)=>{const l=new na([i]);if(hk(a)){const d=nie(a.mapValue).fields;if(d.length===0)e.push(l);else for(const p of d)e.push(l.child(p))}else e.push(l)}),new Pl(e)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ua{constructor(e,i,a,l,d,p,y){this.key=e,this.documentType=i,this.version=a,this.readTime=l,this.createTime=d,this.data=p,this.documentState=y}static newInvalidDocument(e){return new Ua(e,0,Gn.min(),Gn.min(),Gn.min(),Yc.empty(),0)}static newFoundDocument(e,i,a,l){return new Ua(e,1,i,Gn.min(),a,l,0)}static newNoDocument(e,i){return new Ua(e,2,i,Gn.min(),Gn.min(),Yc.empty(),0)}static newUnknownDocument(e,i){return new Ua(e,3,i,Gn.min(),Gn.min(),Yc.empty(),2)}convertToFoundDocument(e,i){return!this.createTime.isEqual(Gn.min())||this.documentType!==2&&this.documentType!==0||(this.createTime=e),this.version=e,this.documentType=1,this.data=i,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=Yc.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=Yc.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=Gn.min(),this}setReadTime(e){return this.readTime=e,this}get hasLocalMutations(){return this.documentState===1}get hasCommittedMutations(){return this.documentState===2}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return this.documentType!==0}isFoundDocument(){return this.documentType===1}isNoDocument(){return this.documentType===2}isUnknownDocument(){return this.documentType===3}isEqual(e){return e instanceof Ua&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}mutableCopy(){return new Ua(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class v0{constructor(e,i){this.position=e,this.inclusive=i}}function NX(n,e,i){let a=0;for(let l=0;l<n.position.length;l++){const d=e[l],p=n.position[l];if(d.field.isKeyField()?a=yn.comparator(yn.fromName(p.referenceValue),i.key):a=y0(p,i.data.field(d.field)),d.dir==="desc"&&(a*=-1),a!==0)break}return a}function DX(n,e){if(n===null)return e===null;if(e===null||n.inclusive!==e.inclusive||n.position.length!==e.position.length)return!1;for(let i=0;i<n.position.length;i++)if(!of(n.position[i],e.position[i]))return!1;return!0}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class VR{constructor(e,i="asc"){this.field=e,this.dir=i}}function wje(n,e){return n.dir===e.dir&&n.field.isEqual(e.field)}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class rie{}class Ys extends rie{constructor(e,i,a){super(),this.field=e,this.op=i,this.value=a}static create(e,i,a){return e.isKeyField()?i==="in"||i==="not-in"?this.createKeyFieldInFilter(e,i,a):new Cje(e,i,a):i==="array-contains"?new Pje(e,a):i==="in"?new Oje(e,a):i==="not-in"?new kje(e,a):i==="array-contains-any"?new Nje(e,a):new Ys(e,i,a)}static createKeyFieldInFilter(e,i,a){return i==="in"?new Ije(e,a):new Aje(e,a)}matches(e){const i=e.data.field(this.field);return this.op==="!="?i!==null&&this.matchesComparison(y0(i,this.value)):i!==null&&Ig(this.value)===Ig(i)&&this.matchesComparison(y0(i,this.value))}matchesComparison(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return e===0;case"!=":return e!==0;case">":return e>0;case">=":return e>=0;default:return jn()}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}}class Md extends rie{constructor(e,i){super(),this.filters=e,this.op=i,this.ce=null}static create(e,i){return new Md(e,i)}matches(e){return iie(this)?this.filters.find(i=>!i.matches(e))===void 0:this.filters.find(i=>i.matches(e))!==void 0}getFlattenedFilters(){return this.ce!==null||(this.ce=this.filters.reduce((e,i)=>e.concat(i.getFlattenedFilters()),[])),this.ce}getFilters(){return Object.assign([],this.filters)}}function iie(n){return n.op==="and"}function sie(n){return Rje(n)&&iie(n)}function Rje(n){for(const e of n.filters)if(e instanceof Md)return!1;return!0}function AV(n){if(n instanceof Ys)return n.field.canonicalString()+n.op.toString()+E0(n.value);if(sie(n))return n.filters.map(e=>AV(e)).join(",");{const e=n.filters.map(i=>AV(i)).join(",");return`${n.op}(${e})`}}function oie(n,e){return n instanceof Ys?function(a,l){return l instanceof Ys&&a.op===l.op&&a.field.isEqual(l.field)&&of(a.value,l.value)}(n,e):n instanceof Md?function(a,l){return l instanceof Md&&a.op===l.op&&a.filters.length===l.filters.length?a.filters.reduce((d,p,y)=>d&&oie(p,l.filters[y]),!0):!1}(n,e):void jn()}function aie(n){return n instanceof Ys?function(i){return`${i.field.canonicalString()} ${i.op} ${E0(i.value)}`}(n):n instanceof Md?function(i){return i.op.toString()+" {"+i.getFilters().map(aie).join(" ,")+"}"}(n):"Filter"}class Cje extends Ys{constructor(e,i,a){super(e,i,a),this.key=yn.fromName(a.referenceValue)}matches(e){const i=yn.comparator(e.key,this.key);return this.matchesComparison(i)}}class Ije extends Ys{constructor(e,i){super(e,"in",i),this.keys=cie("in",i)}matches(e){return this.keys.some(i=>i.isEqual(e.key))}}class Aje extends Ys{constructor(e,i){super(e,"not-in",i),this.keys=cie("not-in",i)}matches(e){return!this.keys.some(i=>i.isEqual(e.key))}}function cie(n,e){var i;return(((i=e.arrayValue)===null||i===void 0?void 0:i.values)||[]).map(a=>yn.fromName(a.referenceValue))}class Pje extends Ys{constructor(e,i){super(e,"array-contains",i)}matches(e){const i=e.data.field(this.field);return zj(i)&&UR(i.arrayValue,this.value)}}class Oje extends Ys{constructor(e,i){super(e,"in",i)}matches(e){const i=e.data.field(this.field);return i!==null&&UR(this.value.arrayValue,i)}}class kje extends Ys{constructor(e,i){super(e,"not-in",i)}matches(e){if(UR(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;const i=e.data.field(this.field);return i!==null&&!UR(this.value.arrayValue,i)}}class Nje extends Ys{constructor(e,i){super(e,"array-contains-any",i)}matches(e){const i=e.data.field(this.field);return!(!zj(i)||!i.arrayValue.values)&&i.arrayValue.values.some(a=>UR(this.value.arrayValue,a))}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Dje{constructor(e,i=null,a=[],l=[],d=null,p=null,y=null){this.path=e,this.collectionGroup=i,this.orderBy=a,this.filters=l,this.limit=d,this.startAt=p,this.endAt=y,this.le=null}}function LX(n,e=null,i=[],a=[],l=null,d=null,p=null){return new Dje(n,e,i,a,l,d,p)}function Gj(n){const e=qn(n);if(e.le===null){let i=e.path.canonicalString();e.collectionGroup!==null&&(i+="|cg:"+e.collectionGroup),i+="|f:",i+=e.filters.map(a=>AV(a)).join(","),i+="|ob:",i+=e.orderBy.map(a=>function(d){return d.field.canonicalString()+d.dir}(a)).join(","),z1(e.limit)||(i+="|l:",i+=e.limit),e.startAt&&(i+="|lb:",i+=e.startAt.inclusive?"b:":"a:",i+=e.startAt.position.map(a=>E0(a)).join(",")),e.endAt&&(i+="|ub:",i+=e.endAt.inclusive?"a:":"b:",i+=e.endAt.position.map(a=>E0(a)).join(",")),e.le=i}return e.le}function Hj(n,e){if(n.limit!==e.limit||n.orderBy.length!==e.orderBy.length)return!1;for(let i=0;i<n.orderBy.length;i++)if(!wje(n.orderBy[i],e.orderBy[i]))return!1;if(n.filters.length!==e.filters.length)return!1;for(let i=0;i<n.filters.length;i++)if(!oie(n.filters[i],e.filters[i]))return!1;return n.collectionGroup===e.collectionGroup&&!!n.path.isEqual(e.path)&&!!DX(n.startAt,e.startAt)&&DX(n.endAt,e.endAt)}function PV(n){return yn.isDocumentKey(n.path)&&n.collectionGroup===null&&n.filters.length===0}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Hy{constructor(e,i=null,a=[],l=[],d=null,p="F",y=null,v=null){this.path=e,this.collectionGroup=i,this.explicitOrderBy=a,this.filters=l,this.limit=d,this.limitType=p,this.startAt=y,this.endAt=v,this.he=null,this.Pe=null,this.Te=null,this.startAt,this.endAt}}function Lje(n,e,i,a,l,d,p,y){return new Hy(n,e,i,a,l,d,p,y)}function $1(n){return new Hy(n)}function xX(n){return n.filters.length===0&&n.limit===null&&n.startAt==null&&n.endAt==null&&(n.explicitOrderBy.length===0||n.explicitOrderBy.length===1&&n.explicitOrderBy[0].field.isKeyField())}function $j(n){return n.collectionGroup!==null}function e0(n){const e=qn(n);if(e.he===null){e.he=[];const i=new Set;for(const d of e.explicitOrderBy)e.he.push(d),i.add(d.field.canonicalString());const a=e.explicitOrderBy.length>0?e.explicitOrderBy[e.explicitOrderBy.length-1].dir:"asc";(function(p){let y=new co(na.comparator);return p.filters.forEach(v=>{v.getFlattenedFilters().forEach(b=>{b.isInequality()&&(y=y.add(b.field))})}),y})(e).forEach(d=>{i.has(d.canonicalString())||d.isKeyField()||e.he.push(new VR(d,a))}),i.has(na.keyField().canonicalString())||e.he.push(new VR(na.keyField(),a))}return e.he}function tf(n){const e=qn(n);return e.Pe||(e.Pe=xje(e,e0(n))),e.Pe}function xje(n,e){if(n.limitType==="F")return LX(n.path,n.collectionGroup,e,n.filters,n.limit,n.startAt,n.endAt);{e=e.map(l=>{const d=l.dir==="desc"?"asc":"desc";return new VR(l.field,d)});const i=n.endAt?new v0(n.endAt.position,n.endAt.inclusive):null,a=n.startAt?new v0(n.startAt.position,n.startAt.inclusive):null;return LX(n.path,n.collectionGroup,e,n.filters,n.limit,i,a)}}function OV(n,e){const i=n.filters.concat([e]);return new Hy(n.path,n.collectionGroup,n.explicitOrderBy.slice(),i,n.limit,n.limitType,n.startAt,n.endAt)}function kV(n,e,i){return new Hy(n.path,n.collectionGroup,n.explicitOrderBy.slice(),n.filters.slice(),e,i,n.startAt,n.endAt)}function K1(n,e){return Hj(tf(n),tf(e))&&n.limitType===e.limitType}function lie(n){return`${Gj(tf(n))}|lt:${n.limitType}`}function TS(n){return`Query(target=${function(i){let a=i.path.canonicalString();return i.collectionGroup!==null&&(a+=" collectionGroup="+i.collectionGroup),i.filters.length>0&&(a+=`, filters: [${i.filters.map(l=>aie(l)).join(", ")}]`),z1(i.limit)||(a+=", limit: "+i.limit),i.orderBy.length>0&&(a+=`, orderBy: [${i.orderBy.map(l=>function(p){return`${p.field.canonicalString()} (${p.dir})`}(l)).join(", ")}]`),i.startAt&&(a+=", startAt: ",a+=i.startAt.inclusive?"b:":"a:",a+=i.startAt.position.map(l=>E0(l)).join(",")),i.endAt&&(a+=", endAt: ",a+=i.endAt.inclusive?"a:":"b:",a+=i.endAt.position.map(l=>E0(l)).join(",")),`Target(${a})`}(tf(n))}; limitType=${n.limitType})`}function q1(n,e){return e.isFoundDocument()&&function(a,l){const d=l.key.path;return a.collectionGroup!==null?l.key.hasCollectionId(a.collectionGroup)&&a.path.isPrefixOf(d):yn.isDocumentKey(a.path)?a.path.isEqual(d):a.path.isImmediateParentOf(d)}(n,e)&&function(a,l){for(const d of e0(a))if(!d.field.isKeyField()&&l.data.field(d.field)===null)return!1;return!0}(n,e)&&function(a,l){for(const d of a.filters)if(!d.matches(l))return!1;return!0}(n,e)&&function(a,l){return!(a.startAt&&!function(p,y,v){const b=NX(p,y,v);return p.inclusive?b<=0:b<0}(a.startAt,e0(a),l)||a.endAt&&!function(p,y,v){const b=NX(p,y,v);return p.inclusive?b>=0:b>0}(a.endAt,e0(a),l))}(n,e)}function Mje(n){return n.collectionGroup||(n.path.length%2==1?n.path.lastSegment():n.path.get(n.path.length-2))}function uie(n){return(e,i)=>{let a=!1;for(const l of e0(n)){const d=Uje(l,e,i);if(d!==0)return d;a=a||l.field.isKeyField()}return 0}}function Uje(n,e,i){const a=n.field.isKeyField()?yn.comparator(e.key,i.key):function(d,p,y){const v=p.data.field(d),b=y.data.field(d);return v!==null&&b!==null?y0(v,b):jn()}(n.field,e,i);switch(n.dir){case"asc":return a;case"desc":return-1*a;default:return jn()}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class $y{constructor(e,i){this.mapKeyFn=e,this.equalsFn=i,this.inner={},this.innerSize=0}get(e){const i=this.mapKeyFn(e),a=this.inner[i];if(a!==void 0){for(const[l,d]of a)if(this.equalsFn(l,e))return d}}has(e){return this.get(e)!==void 0}set(e,i){const a=this.mapKeyFn(e),l=this.inner[a];if(l===void 0)return this.inner[a]=[[e,i]],void this.innerSize++;for(let d=0;d<l.length;d++)if(this.equalsFn(l[d][0],e))return void(l[d]=[e,i]);l.push([e,i]),this.innerSize++}delete(e){const i=this.mapKeyFn(e),a=this.inner[i];if(a===void 0)return!1;for(let l=0;l<a.length;l++)if(this.equalsFn(a[l][0],e))return a.length===1?delete this.inner[i]:a.splice(l,1),this.innerSize--,!0;return!1}forEach(e){xg(this.inner,(i,a)=>{for(const[l,d]of a)e(l,d)})}isEmpty(){return qre(this.inner)}size(){return this.innerSize}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Vje=new ds(yn.comparator);function Mp(){return Vje}const die=new ds(yn.comparator);function jw(...n){let e=die;for(const i of n)e=e.insert(i.key,i);return e}function hie(n){let e=die;return n.forEach((i,a)=>e=e.insert(i,a.overlayedDocument)),e}function yy(){return aR()}function fie(){return aR()}function aR(){return new $y(n=>n.toString(),(n,e)=>n.isEqual(e))}const Fje=new ds(yn.comparator),jje=new co(yn.comparator);function Tr(...n){let e=jje;for(const i of n)e=e.add(i);return e}const Bje=new co(ur);function Wje(){return Bje}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Kj(n,e){if(n.useProto3Json){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:Gk(e)?"-0":e}}function pie(n){return{integerValue:""+n}}function zje(n,e){return gje(e)?pie(e):Kj(n,e)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Y1{constructor(){this._=void 0}}function Gje(n,e,i){return n instanceof qk?function(l,d){const p={fields:{[Jre]:{stringValue:Xre},[Zre]:{timestampValue:{seconds:l.seconds,nanos:l.nanoseconds}}}};return d&&G1(d)&&(d=H1(d)),d&&(p.fields[Qre]=d),{mapValue:p}}(i,e):n instanceof S0?gie(n,e):n instanceof b0?_ie(n,e):function(l,d){const p=mie(l,d),y=MX(p)+MX(l.Ie);return IV(p)&&IV(l.Ie)?pie(y):Kj(l.serializer,y)}(n,e)}function Hje(n,e,i){return n instanceof S0?gie(n,e):n instanceof b0?_ie(n,e):i}function mie(n,e){return n instanceof Yk?function(a){return IV(a)||function(d){return!!d&&"doubleValue"in d}(a)}(e)?e:{integerValue:0}:null}class qk extends Y1{}class S0 extends Y1{constructor(e){super(),this.elements=e}}function gie(n,e){const i=yie(e);for(const a of n.elements)i.some(l=>of(l,a))||i.push(a);return{arrayValue:{values:i}}}class b0 extends Y1{constructor(e){super(),this.elements=e}}function _ie(n,e){let i=yie(e);for(const a of n.elements)i=i.filter(l=>!of(l,a));return{arrayValue:{values:i}}}class Yk extends Y1{constructor(e,i){super(),this.serializer=e,this.Ie=i}}function MX(n){return Us(n.integerValue||n.doubleValue)}function yie(n){return zj(n)&&n.arrayValue.values?n.arrayValue.values.slice():[]}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Eie{constructor(e,i){this.field=e,this.transform=i}}function $je(n,e){return n.field.isEqual(e.field)&&function(a,l){return a instanceof S0&&l instanceof S0||a instanceof b0&&l instanceof b0?_0(a.elements,l.elements,of):a instanceof Yk&&l instanceof Yk?of(a.Ie,l.Ie):a instanceof qk&&l instanceof qk}(n.transform,e.transform)}class Kje{constructor(e,i){this.version=e,this.transformResults=i}}class Ld{constructor(e,i){this.updateTime=e,this.exists=i}static none(){return new Ld}static exists(e){return new Ld(void 0,e)}static updateTime(e){return new Ld(e)}get isNone(){return this.updateTime===void 0&&this.exists===void 0}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}}function fk(n,e){return n.updateTime!==void 0?e.isFoundDocument()&&e.version.isEqual(n.updateTime):n.exists===void 0||n.exists===e.isFoundDocument()}class X1{}function vie(n,e){if(!n.hasLocalMutations||e&&e.fields.length===0)return null;if(e===null)return n.isNoDocument()?new bie(n.key,Ld.none()):new pC(n.key,n.data,Ld.none());{const i=n.data,a=Yc.empty();let l=new co(na.comparator);for(let d of e.fields)if(!l.has(d)){let p=i.field(d);p===null&&d.length>1&&(d=d.popLast(),p=i.field(d)),p===null?a.delete(d):a.set(d,p),l=l.add(d)}return new Mg(n.key,a,new Pl(l.toArray()),Ld.none())}}function qje(n,e,i){n instanceof pC?function(l,d,p){const y=l.value.clone(),v=VX(l.fieldTransforms,d,p.transformResults);y.setAll(v),d.convertToFoundDocument(p.version,y).setHasCommittedMutations()}(n,e,i):n instanceof Mg?function(l,d,p){if(!fk(l.precondition,d))return void d.convertToUnknownDocument(p.version);const y=VX(l.fieldTransforms,d,p.transformResults),v=d.data;v.setAll(Sie(l)),v.setAll(y),d.convertToFoundDocument(p.version,v).setHasCommittedMutations()}(n,e,i):function(l,d,p){d.convertToNoDocument(p.version).setHasCommittedMutations()}(0,e,i)}function cR(n,e,i,a){return n instanceof pC?function(d,p,y,v){if(!fk(d.precondition,p))return y;const b=d.value.clone(),w=FX(d.fieldTransforms,v,p);return b.setAll(w),p.convertToFoundDocument(p.version,b).setHasLocalMutations(),null}(n,e,i,a):n instanceof Mg?function(d,p,y,v){if(!fk(d.precondition,p))return y;const b=FX(d.fieldTransforms,v,p),w=p.data;return w.setAll(Sie(d)),w.setAll(b),p.convertToFoundDocument(p.version,w).setHasLocalMutations(),y===null?null:y.unionWith(d.fieldMask.fields).unionWith(d.fieldTransforms.map(A=>A.field))}(n,e,i,a):function(d,p,y){return fk(d.precondition,p)?(p.convertToNoDocument(p.version).setHasLocalMutations(),null):y}(n,e,i)}function Yje(n,e){let i=null;for(const a of n.fieldTransforms){const l=e.data.field(a.field),d=mie(a.transform,l||null);d!=null&&(i===null&&(i=Yc.empty()),i.set(a.field,d))}return i||null}function UX(n,e){return n.type===e.type&&!!n.key.isEqual(e.key)&&!!n.precondition.isEqual(e.precondition)&&!!function(a,l){return a===void 0&&l===void 0||!(!a||!l)&&_0(a,l,(d,p)=>$je(d,p))}(n.fieldTransforms,e.fieldTransforms)&&(n.type===0?n.value.isEqual(e.value):n.type!==1||n.data.isEqual(e.data)&&n.fieldMask.isEqual(e.fieldMask))}class pC extends X1{constructor(e,i,a,l=[]){super(),this.key=e,this.value=i,this.precondition=a,this.fieldTransforms=l,this.type=0}getFieldMask(){return null}}class Mg extends X1{constructor(e,i,a,l,d=[]){super(),this.key=e,this.data=i,this.fieldMask=a,this.precondition=l,this.fieldTransforms=d,this.type=1}getFieldMask(){return this.fieldMask}}function Sie(n){const e=new Map;return n.fieldMask.fields.forEach(i=>{if(!i.isEmpty()){const a=n.data.field(i);e.set(i,a)}}),e}function VX(n,e,i){const a=new Map;si(n.length===i.length);for(let l=0;l<i.length;l++){const d=n[l],p=d.transform,y=e.data.field(d.field);a.set(d.field,Hje(p,y,i[l]))}return a}function FX(n,e,i){const a=new Map;for(const l of n){const d=l.transform,p=i.data.field(l.field);a.set(l.field,Gje(d,p,e))}return a}class bie extends X1{constructor(e,i){super(),this.key=e,this.precondition=i,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}}class Xje extends X1{constructor(e,i){super(),this.key=e,this.precondition=i,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Jje{constructor(e,i,a,l){this.batchId=e,this.localWriteTime=i,this.baseMutations=a,this.mutations=l}applyToRemoteDocument(e,i){const a=i.mutationResults;for(let l=0;l<this.mutations.length;l++){const d=this.mutations[l];d.key.isEqual(e.key)&&qje(d,e,a[l])}}applyToLocalView(e,i){for(const a of this.baseMutations)a.key.isEqual(e.key)&&(i=cR(a,e,i,this.localWriteTime));for(const a of this.mutations)a.key.isEqual(e.key)&&(i=cR(a,e,i,this.localWriteTime));return i}applyToLocalDocumentSet(e,i){const a=fie();return this.mutations.forEach(l=>{const d=e.get(l.key),p=d.overlayedDocument;let y=this.applyToLocalView(p,d.mutatedFields);y=i.has(l.key)?null:y;const v=vie(p,y);v!==null&&a.set(l.key,v),p.isValidDocument()||p.convertToNoDocument(Gn.min())}),a}keys(){return this.mutations.reduce((e,i)=>e.add(i.key),Tr())}isEqual(e){return this.batchId===e.batchId&&_0(this.mutations,e.mutations,(i,a)=>UX(i,a))&&_0(this.baseMutations,e.baseMutations,(i,a)=>UX(i,a))}}class qj{constructor(e,i,a,l){this.batch=e,this.commitVersion=i,this.mutationResults=a,this.docVersions=l}static from(e,i,a){si(e.mutations.length===a.length);let l=function(){return Fje}();const d=e.mutations;for(let p=0;p<d.length;p++)l=l.insert(d[p].key,a[p].version);return new qj(e,i,a,l)}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Qje{constructor(e,i){this.largestBatchId=e,this.mutation=i}getKey(){return this.mutation.key}isEqual(e){return e!==null&&this.mutation===e.mutation}toString(){return`Overlay{
      largestBatchId: ${this.largestBatchId},
      mutation: ${this.mutation.toString()}
    }`}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Zje{constructor(e,i){this.count=e,this.unchangedNames=i}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Hs,kr;function e4e(n){switch(n){case _t.OK:return jn();case _t.CANCELLED:case _t.UNKNOWN:case _t.DEADLINE_EXCEEDED:case _t.RESOURCE_EXHAUSTED:case _t.INTERNAL:case _t.UNAVAILABLE:case _t.UNAUTHENTICATED:return!1;case _t.INVALID_ARGUMENT:case _t.NOT_FOUND:case _t.ALREADY_EXISTS:case _t.PERMISSION_DENIED:case _t.FAILED_PRECONDITION:case _t.ABORTED:case _t.OUT_OF_RANGE:case _t.UNIMPLEMENTED:case _t.DATA_LOSS:return!0;default:return jn()}}function Tie(n){if(n===void 0)return xp("GRPC error has no .code"),_t.UNKNOWN;switch(n){case Hs.OK:return _t.OK;case Hs.CANCELLED:return _t.CANCELLED;case Hs.UNKNOWN:return _t.UNKNOWN;case Hs.DEADLINE_EXCEEDED:return _t.DEADLINE_EXCEEDED;case Hs.RESOURCE_EXHAUSTED:return _t.RESOURCE_EXHAUSTED;case Hs.INTERNAL:return _t.INTERNAL;case Hs.UNAVAILABLE:return _t.UNAVAILABLE;case Hs.UNAUTHENTICATED:return _t.UNAUTHENTICATED;case Hs.INVALID_ARGUMENT:return _t.INVALID_ARGUMENT;case Hs.NOT_FOUND:return _t.NOT_FOUND;case Hs.ALREADY_EXISTS:return _t.ALREADY_EXISTS;case Hs.PERMISSION_DENIED:return _t.PERMISSION_DENIED;case Hs.FAILED_PRECONDITION:return _t.FAILED_PRECONDITION;case Hs.ABORTED:return _t.ABORTED;case Hs.OUT_OF_RANGE:return _t.OUT_OF_RANGE;case Hs.UNIMPLEMENTED:return _t.UNIMPLEMENTED;case Hs.DATA_LOSS:return _t.DATA_LOSS;default:return jn()}}(kr=Hs||(Hs={}))[kr.OK=0]="OK",kr[kr.CANCELLED=1]="CANCELLED",kr[kr.UNKNOWN=2]="UNKNOWN",kr[kr.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",kr[kr.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",kr[kr.NOT_FOUND=5]="NOT_FOUND",kr[kr.ALREADY_EXISTS=6]="ALREADY_EXISTS",kr[kr.PERMISSION_DENIED=7]="PERMISSION_DENIED",kr[kr.UNAUTHENTICATED=16]="UNAUTHENTICATED",kr[kr.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",kr[kr.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",kr[kr.ABORTED=10]="ABORTED",kr[kr.OUT_OF_RANGE=11]="OUT_OF_RANGE",kr[kr.UNIMPLEMENTED=12]="UNIMPLEMENTED",kr[kr.INTERNAL=13]="INTERNAL",kr[kr.UNAVAILABLE=14]="UNAVAILABLE",kr[kr.DATA_LOSS=15]="DATA_LOSS";/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const t4e=new mg([4294967295,4294967295],0);function jX(n){const e=Hre().encode(n),i=new Vre;return i.update(e),new Uint8Array(i.digest())}function BX(n){const e=new DataView(n.buffer),i=e.getUint32(0,!0),a=e.getUint32(4,!0),l=e.getUint32(8,!0),d=e.getUint32(12,!0);return[new mg([i,a],0),new mg([l,d],0)]}class Yj{constructor(e,i,a){if(this.bitmap=e,this.padding=i,this.hashCount=a,i<0||i>=8)throw new Bw(`Invalid padding: ${i}`);if(a<0)throw new Bw(`Invalid hash count: ${a}`);if(e.length>0&&this.hashCount===0)throw new Bw(`Invalid hash count: ${a}`);if(e.length===0&&i!==0)throw new Bw(`Invalid padding when bitmap length is 0: ${i}`);this.Ee=8*e.length-i,this.de=mg.fromNumber(this.Ee)}Ae(e,i,a){let l=e.add(i.multiply(mg.fromNumber(a)));return l.compare(t4e)===1&&(l=new mg([l.getBits(0),l.getBits(1)],0)),l.modulo(this.de).toNumber()}Re(e){return!!(this.bitmap[Math.floor(e/8)]&1<<e%8)}mightContain(e){if(this.Ee===0)return!1;const i=jX(e),[a,l]=BX(i);for(let d=0;d<this.hashCount;d++){const p=this.Ae(a,l,d);if(!this.Re(p))return!1}return!0}static create(e,i,a){const l=e%8==0?0:8-e%8,d=new Uint8Array(Math.ceil(e/8)),p=new Yj(d,l,i);return a.forEach(y=>p.insert(y)),p}insert(e){if(this.Ee===0)return;const i=jX(e),[a,l]=BX(i);for(let d=0;d<this.hashCount;d++){const p=this.Ae(a,l,d);this.Ve(p)}}Ve(e){const i=Math.floor(e/8),a=e%8;this.bitmap[i]|=1<<a}}class Bw extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class J1{constructor(e,i,a,l,d){this.snapshotVersion=e,this.targetChanges=i,this.targetMismatches=a,this.documentUpdates=l,this.resolvedLimboDocuments=d}static createSynthesizedRemoteEventForCurrentChange(e,i,a){const l=new Map;return l.set(e,mC.createSynthesizedTargetChangeForCurrentChange(e,i,a)),new J1(Gn.min(),l,new ds(ur),Mp(),Tr())}}class mC{constructor(e,i,a,l,d){this.resumeToken=e,this.current=i,this.addedDocuments=a,this.modifiedDocuments=l,this.removedDocuments=d}static createSynthesizedTargetChangeForCurrentChange(e,i,a){return new mC(a,i,Tr(),Tr(),Tr())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class pk{constructor(e,i,a,l){this.me=e,this.removedTargetIds=i,this.key=a,this.fe=l}}class wie{constructor(e,i){this.targetId=e,this.ge=i}}class Rie{constructor(e,i,a=aa.EMPTY_BYTE_STRING,l=null){this.state=e,this.targetIds=i,this.resumeToken=a,this.cause=l}}class WX{constructor(){this.pe=0,this.ye=zX(),this.we=aa.EMPTY_BYTE_STRING,this.Se=!1,this.be=!0}get current(){return this.Se}get resumeToken(){return this.we}get De(){return this.pe!==0}get ve(){return this.be}Ce(e){e.approximateByteSize()>0&&(this.be=!0,this.we=e)}Fe(){let e=Tr(),i=Tr(),a=Tr();return this.ye.forEach((l,d)=>{switch(d){case 0:e=e.add(l);break;case 2:i=i.add(l);break;case 1:a=a.add(l);break;default:jn()}}),new mC(this.we,this.Se,e,i,a)}Me(){this.be=!1,this.ye=zX()}xe(e,i){this.be=!0,this.ye=this.ye.insert(e,i)}Oe(e){this.be=!0,this.ye=this.ye.remove(e)}Ne(){this.pe+=1}Be(){this.pe-=1,si(this.pe>=0)}Le(){this.be=!0,this.Se=!0}}class n4e{constructor(e){this.ke=e,this.qe=new Map,this.Qe=Mp(),this.$e=kO(),this.Ue=kO(),this.Ke=new ds(ur)}We(e){for(const i of e.me)e.fe&&e.fe.isFoundDocument()?this.Ge(i,e.fe):this.ze(i,e.key,e.fe);for(const i of e.removedTargetIds)this.ze(i,e.key,e.fe)}je(e){this.forEachTarget(e,i=>{const a=this.He(i);switch(e.state){case 0:this.Je(i)&&a.Ce(e.resumeToken);break;case 1:a.Be(),a.De||a.Me(),a.Ce(e.resumeToken);break;case 2:a.Be(),a.De||this.removeTarget(i);break;case 3:this.Je(i)&&(a.Le(),a.Ce(e.resumeToken));break;case 4:this.Je(i)&&(this.Ye(i),a.Ce(e.resumeToken));break;default:jn()}})}forEachTarget(e,i){e.targetIds.length>0?e.targetIds.forEach(i):this.qe.forEach((a,l)=>{this.Je(l)&&i(l)})}Ze(e){const i=e.targetId,a=e.ge.count,l=this.Xe(i);if(l){const d=l.target;if(PV(d))if(a===0){const p=new yn(d.path);this.ze(i,p,Ua.newNoDocument(p,Gn.min()))}else si(a===1);else{const p=this.et(i);if(p!==a){const y=this.tt(e),v=y?this.nt(y,e,p):1;if(v!==0){this.Ye(i);const b=v===2?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch";this.Ke=this.Ke.insert(i,b)}}}}}tt(e){const i=e.ge.unchangedNames;if(!i||!i.bits)return null;const{bits:{bitmap:a="",padding:l=0},hashCount:d=0}=i;let p,y;try{p=Cg(a).toUint8Array()}catch(v){if(v instanceof Yre)return g0("Decoding the base64 bloom filter in existence filter failed ("+v.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw v}try{y=new Yj(p,l,d)}catch(v){return g0(v instanceof Bw?"BloomFilter error: ":"Applying bloom filter failed: ",v),null}return y.Ee===0?null:y}nt(e,i,a){return i.ge.count===a-this.st(e,i.targetId)?0:2}st(e,i){const a=this.ke.getRemoteKeysForTarget(i);let l=0;return a.forEach(d=>{const p=this.ke.it(),y=`projects/${p.projectId}/databases/${p.database}/documents/${d.path.canonicalString()}`;e.mightContain(y)||(this.ze(i,d,null),l++)}),l}ot(e){const i=new Map;this.qe.forEach((d,p)=>{const y=this.Xe(p);if(y){if(d.current&&PV(y.target)){const v=new yn(y.target.path);this._t(v).has(p)||this.ut(p,v)||this.ze(p,v,Ua.newNoDocument(v,e))}d.ve&&(i.set(p,d.Fe()),d.Me())}});let a=Tr();this.Ue.forEach((d,p)=>{let y=!0;p.forEachWhile(v=>{const b=this.Xe(v);return!b||b.purpose==="TargetPurposeLimboResolution"||(y=!1,!1)}),y&&(a=a.add(d))}),this.Qe.forEach((d,p)=>p.setReadTime(e));const l=new J1(e,i,this.Ke,this.Qe,a);return this.Qe=Mp(),this.$e=kO(),this.Ue=kO(),this.Ke=new ds(ur),l}Ge(e,i){if(!this.Je(e))return;const a=this.ut(e,i.key)?2:0;this.He(e).xe(i.key,a),this.Qe=this.Qe.insert(i.key,i),this.$e=this.$e.insert(i.key,this._t(i.key).add(e)),this.Ue=this.Ue.insert(i.key,this.ct(i.key).add(e))}ze(e,i,a){if(!this.Je(e))return;const l=this.He(e);this.ut(e,i)?l.xe(i,1):l.Oe(i),this.Ue=this.Ue.insert(i,this.ct(i).delete(e)),this.Ue=this.Ue.insert(i,this.ct(i).add(e)),a&&(this.Qe=this.Qe.insert(i,a))}removeTarget(e){this.qe.delete(e)}et(e){const i=this.He(e).Fe();return this.ke.getRemoteKeysForTarget(e).size+i.addedDocuments.size-i.removedDocuments.size}Ne(e){this.He(e).Ne()}He(e){let i=this.qe.get(e);return i||(i=new WX,this.qe.set(e,i)),i}ct(e){let i=this.Ue.get(e);return i||(i=new co(ur),this.Ue=this.Ue.insert(e,i)),i}_t(e){let i=this.$e.get(e);return i||(i=new co(ur),this.$e=this.$e.insert(e,i)),i}Je(e){const i=this.Xe(e)!==null;return i||Zt("WatchChangeAggregator","Detected inactive target",e),i}Xe(e){const i=this.qe.get(e);return i&&i.De?null:this.ke.lt(e)}Ye(e){this.qe.set(e,new WX),this.ke.getRemoteKeysForTarget(e).forEach(i=>{this.ze(e,i,null)})}ut(e,i){return this.ke.getRemoteKeysForTarget(e).has(i)}}function kO(){return new ds(yn.comparator)}function zX(){return new ds(yn.comparator)}const r4e={asc:"ASCENDING",desc:"DESCENDING"},i4e={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},s4e={and:"AND",or:"OR"};class o4e{constructor(e,i){this.databaseId=e,this.useProto3Json=i}}function NV(n,e){return n.useProto3Json||z1(e)?e:{value:e}}function Xk(n,e){return n.useProto3Json?`${new Date(1e3*e.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+e.nanoseconds).slice(-9)}Z`:{seconds:""+e.seconds,nanos:e.nanoseconds}}function Cie(n,e){return n.useProto3Json?e.toBase64():e.toUint8Array()}function a4e(n,e){return Xk(n,e.toTimestamp())}function nf(n){return si(!!n),Gn.fromTimestamp(function(i){const a=Rg(i);return new ao(a.seconds,a.nanos)}(n))}function Xj(n,e){return DV(n,e).canonicalString()}function DV(n,e){const i=function(l){return new Li(["projects",l.projectId,"databases",l.database])}(n).child("documents");return e===void 0?i:i.child(e)}function Iie(n){const e=Li.fromString(n);return si(Nie(e)),e}function LV(n,e){return Xj(n.databaseId,e.path)}function eU(n,e){const i=Iie(e);if(i.get(1)!==n.databaseId.projectId)throw new zt(_t.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+i.get(1)+" vs "+n.databaseId.projectId);if(i.get(3)!==n.databaseId.database)throw new zt(_t.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+i.get(3)+" vs "+n.databaseId.database);return new yn(Pie(i))}function Aie(n,e){return Xj(n.databaseId,e)}function c4e(n){const e=Iie(n);return e.length===4?Li.emptyPath():Pie(e)}function xV(n){return new Li(["projects",n.databaseId.projectId,"databases",n.databaseId.database]).canonicalString()}function Pie(n){return si(n.length>4&&n.get(4)==="documents"),n.popFirst(5)}function GX(n,e,i){return{name:LV(n,e),fields:i.value.mapValue.fields}}function l4e(n,e){let i;if("targetChange"in e){e.targetChange;const a=function(b){return b==="NO_CHANGE"?0:b==="ADD"?1:b==="REMOVE"?2:b==="CURRENT"?3:b==="RESET"?4:jn()}(e.targetChange.targetChangeType||"NO_CHANGE"),l=e.targetChange.targetIds||[],d=function(b,w){return b.useProto3Json?(si(w===void 0||typeof w=="string"),aa.fromBase64String(w||"")):(si(w===void 0||w instanceof Buffer||w instanceof Uint8Array),aa.fromUint8Array(w||new Uint8Array))}(n,e.targetChange.resumeToken),p=e.targetChange.cause,y=p&&function(b){const w=b.code===void 0?_t.UNKNOWN:Tie(b.code);return new zt(w,b.message||"")}(p);i=new Rie(a,l,d,y||null)}else if("documentChange"in e){e.documentChange;const a=e.documentChange;a.document,a.document.name,a.document.updateTime;const l=eU(n,a.document.name),d=nf(a.document.updateTime),p=a.document.createTime?nf(a.document.createTime):Gn.min(),y=new Yc({mapValue:{fields:a.document.fields}}),v=Ua.newFoundDocument(l,d,p,y),b=a.targetIds||[],w=a.removedTargetIds||[];i=new pk(b,w,v.key,v)}else if("documentDelete"in e){e.documentDelete;const a=e.documentDelete;a.document;const l=eU(n,a.document),d=a.readTime?nf(a.readTime):Gn.min(),p=Ua.newNoDocument(l,d),y=a.removedTargetIds||[];i=new pk([],y,p.key,p)}else if("documentRemove"in e){e.documentRemove;const a=e.documentRemove;a.document;const l=eU(n,a.document),d=a.removedTargetIds||[];i=new pk([],d,l,null)}else{if(!("filter"in e))return jn();{e.filter;const a=e.filter;a.targetId;const{count:l=0,unchangedNames:d}=a,p=new Zje(l,d),y=a.targetId;i=new wie(y,p)}}return i}function u4e(n,e){let i;if(e instanceof pC)i={update:GX(n,e.key,e.value)};else if(e instanceof bie)i={delete:LV(n,e.key)};else if(e instanceof Mg)i={update:GX(n,e.key,e.data),updateMask:E4e(e.fieldMask)};else{if(!(e instanceof Xje))return jn();i={verify:LV(n,e.key)}}return e.fieldTransforms.length>0&&(i.updateTransforms=e.fieldTransforms.map(a=>function(d,p){const y=p.transform;if(y instanceof qk)return{fieldPath:p.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(y instanceof S0)return{fieldPath:p.field.canonicalString(),appendMissingElements:{values:y.elements}};if(y instanceof b0)return{fieldPath:p.field.canonicalString(),removeAllFromArray:{values:y.elements}};if(y instanceof Yk)return{fieldPath:p.field.canonicalString(),increment:y.Ie};throw jn()}(0,a))),e.precondition.isNone||(i.currentDocument=function(l,d){return d.updateTime!==void 0?{updateTime:a4e(l,d.updateTime)}:d.exists!==void 0?{exists:d.exists}:jn()}(n,e.precondition)),i}function d4e(n,e){return n&&n.length>0?(si(e!==void 0),n.map(i=>function(l,d){let p=l.updateTime?nf(l.updateTime):nf(d);return p.isEqual(Gn.min())&&(p=nf(d)),new Kje(p,l.transformResults||[])}(i,e))):[]}function h4e(n,e){return{documents:[Aie(n,e.path)]}}function f4e(n,e){const i={structuredQuery:{}},a=e.path;let l;e.collectionGroup!==null?(l=a,i.structuredQuery.from=[{collectionId:e.collectionGroup,allDescendants:!0}]):(l=a.popLast(),i.structuredQuery.from=[{collectionId:a.lastSegment()}]),i.parent=Aie(n,l);const d=function(b){if(b.length!==0)return kie(Md.create(b,"and"))}(e.filters);d&&(i.structuredQuery.where=d);const p=function(b){if(b.length!==0)return b.map(w=>function(N){return{field:wS(N.field),direction:g4e(N.dir)}}(w))}(e.orderBy);p&&(i.structuredQuery.orderBy=p);const y=NV(n,e.limit);return y!==null&&(i.structuredQuery.limit=y),e.startAt&&(i.structuredQuery.startAt=function(b){return{before:b.inclusive,values:b.position}}(e.startAt)),e.endAt&&(i.structuredQuery.endAt=function(b){return{before:!b.inclusive,values:b.position}}(e.endAt)),{ht:i,parent:l}}function p4e(n){let e=c4e(n.parent);const i=n.structuredQuery,a=i.from?i.from.length:0;let l=null;if(a>0){si(a===1);const w=i.from[0];w.allDescendants?l=w.collectionId:e=e.child(w.collectionId)}let d=[];i.where&&(d=function(A){const N=Oie(A);return N instanceof Md&&sie(N)?N.getFilters():[N]}(i.where));let p=[];i.orderBy&&(p=function(A){return A.map(N=>function(j){return new VR(RS(j.field),function(G){switch(G){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(j.direction))}(N))}(i.orderBy));let y=null;i.limit&&(y=function(A){let N;return N=typeof A=="object"?A.value:A,z1(N)?null:N}(i.limit));let v=null;i.startAt&&(v=function(A){const N=!!A.before,V=A.values||[];return new v0(V,N)}(i.startAt));let b=null;return i.endAt&&(b=function(A){const N=!A.before,V=A.values||[];return new v0(V,N)}(i.endAt)),Lje(e,l,p,d,y,"F",v,b)}function m4e(n,e){const i=function(l){switch(l){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return jn()}}(e.purpose);return i==null?null:{"goog-listen-tags":i}}function Oie(n){return n.unaryFilter!==void 0?function(i){switch(i.unaryFilter.op){case"IS_NAN":const a=RS(i.unaryFilter.field);return Ys.create(a,"==",{doubleValue:NaN});case"IS_NULL":const l=RS(i.unaryFilter.field);return Ys.create(l,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":const d=RS(i.unaryFilter.field);return Ys.create(d,"!=",{doubleValue:NaN});case"IS_NOT_NULL":const p=RS(i.unaryFilter.field);return Ys.create(p,"!=",{nullValue:"NULL_VALUE"});default:return jn()}}(n):n.fieldFilter!==void 0?function(i){return Ys.create(RS(i.fieldFilter.field),function(l){switch(l){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";default:return jn()}}(i.fieldFilter.op),i.fieldFilter.value)}(n):n.compositeFilter!==void 0?function(i){return Md.create(i.compositeFilter.filters.map(a=>Oie(a)),function(l){switch(l){case"AND":return"and";case"OR":return"or";default:return jn()}}(i.compositeFilter.op))}(n):jn()}function g4e(n){return r4e[n]}function _4e(n){return i4e[n]}function y4e(n){return s4e[n]}function wS(n){return{fieldPath:n.canonicalString()}}function RS(n){return na.fromServerFormat(n.fieldPath)}function kie(n){return n instanceof Ys?function(i){if(i.op==="=="){if(kX(i.value))return{unaryFilter:{field:wS(i.field),op:"IS_NAN"}};if(OX(i.value))return{unaryFilter:{field:wS(i.field),op:"IS_NULL"}}}else if(i.op==="!="){if(kX(i.value))return{unaryFilter:{field:wS(i.field),op:"IS_NOT_NAN"}};if(OX(i.value))return{unaryFilter:{field:wS(i.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:wS(i.field),op:_4e(i.op),value:i.value}}}(n):n instanceof Md?function(i){const a=i.getFilters().map(l=>kie(l));return a.length===1?a[0]:{compositeFilter:{op:y4e(i.op),filters:a}}}(n):jn()}function E4e(n){const e=[];return n.fields.forEach(i=>e.push(i.canonicalString())),{fieldPaths:e}}function Nie(n){return n.length>=4&&n.get(0)==="projects"&&n.get(2)==="databases"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class cg{constructor(e,i,a,l,d=Gn.min(),p=Gn.min(),y=aa.EMPTY_BYTE_STRING,v=null){this.target=e,this.targetId=i,this.purpose=a,this.sequenceNumber=l,this.snapshotVersion=d,this.lastLimboFreeSnapshotVersion=p,this.resumeToken=y,this.expectedCount=v}withSequenceNumber(e){return new cg(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(e,i){return new cg(this.target,this.targetId,this.purpose,this.sequenceNumber,i,this.lastLimboFreeSnapshotVersion,e,null)}withExpectedCount(e){return new cg(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,e)}withLastLimboFreeSnapshotVersion(e){return new cg(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken,this.expectedCount)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class v4e{constructor(e){this.Tt=e}}function S4e(n){const e=p4e({parent:n.parent,structuredQuery:n.structuredQuery});return n.limitType==="LAST"?kV(e,e.limit,"L"):e}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class b4e{constructor(){this.Tn=new T4e}addToCollectionParentIndex(e,i){return this.Tn.add(i),wt.resolve()}getCollectionParents(e,i){return wt.resolve(this.Tn.getEntries(i))}addFieldIndex(e,i){return wt.resolve()}deleteFieldIndex(e,i){return wt.resolve()}deleteAllFieldIndexes(e){return wt.resolve()}createTargetIndexes(e,i){return wt.resolve()}getDocumentsMatchingTarget(e,i){return wt.resolve(null)}getIndexType(e,i){return wt.resolve(0)}getFieldIndexes(e,i){return wt.resolve([])}getNextCollectionGroupToUpdate(e){return wt.resolve(null)}getMinOffset(e,i){return wt.resolve(wg.min())}getMinOffsetFromCollectionGroup(e,i){return wt.resolve(wg.min())}updateCollectionGroup(e,i,a){return wt.resolve()}updateIndexEntries(e,i){return wt.resolve()}}class T4e{constructor(){this.index={}}add(e){const i=e.lastSegment(),a=e.popLast(),l=this.index[i]||new co(Li.comparator),d=!l.has(a);return this.index[i]=l.add(a),d}has(e){const i=e.lastSegment(),a=e.popLast(),l=this.index[i];return l&&l.has(a)}getEntries(e){return(this.index[e]||new co(Li.comparator)).toArray()}}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const HX={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0},Die=41943040;class $c{static withCacheSize(e){return new $c(e,$c.DEFAULT_COLLECTION_PERCENTILE,$c.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}constructor(e,i,a){this.cacheSizeCollectionThreshold=e,this.percentileToCollect=i,this.maximumSequenceNumbersToCollect=a}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */$c.DEFAULT_COLLECTION_PERCENTILE=10,$c.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,$c.DEFAULT=new $c(Die,$c.DEFAULT_COLLECTION_PERCENTILE,$c.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),$c.DISABLED=new $c(-1,0,0);/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class T0{constructor(e){this.$n=e}next(){return this.$n+=2,this.$n}static Un(){return new T0(0)}static Kn(){return new T0(-1)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const $X="LruGarbageCollector",w4e=1048576;function KX([n,e],[i,a]){const l=ur(n,i);return l===0?ur(e,a):l}class R4e{constructor(e){this.Hn=e,this.buffer=new co(KX),this.Jn=0}Yn(){return++this.Jn}Zn(e){const i=[e,this.Yn()];if(this.buffer.size<this.Hn)this.buffer=this.buffer.add(i);else{const a=this.buffer.last();KX(i,a)<0&&(this.buffer=this.buffer.delete(a).add(i))}}get maxValue(){return this.buffer.last()[0]}}class C4e{constructor(e,i,a){this.garbageCollector=e,this.asyncQueue=i,this.localStore=a,this.Xn=null}start(){this.garbageCollector.params.cacheSizeCollectionThreshold!==-1&&this.er(6e4)}stop(){this.Xn&&(this.Xn.cancel(),this.Xn=null)}get started(){return this.Xn!==null}er(e){Zt($X,`Garbage collection scheduled in ${e}ms`),this.Xn=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",e,async()=>{this.Xn=null;try{await this.localStore.collectGarbage(this.garbageCollector)}catch(i){j0(i)?Zt($X,"Ignoring IndexedDB error during garbage collection: ",i):await F0(i)}await this.er(3e5)})}}class I4e{constructor(e,i){this.tr=e,this.params=i}calculateTargetCount(e,i){return this.tr.nr(e).next(a=>Math.floor(i/100*a))}nthSequenceNumber(e,i){if(i===0)return wt.resolve(W1.ae);const a=new R4e(i);return this.tr.forEachTarget(e,l=>a.Zn(l.sequenceNumber)).next(()=>this.tr.rr(e,l=>a.Zn(l))).next(()=>a.maxValue)}removeTargets(e,i,a){return this.tr.removeTargets(e,i,a)}removeOrphanedDocuments(e,i){return this.tr.removeOrphanedDocuments(e,i)}collect(e,i){return this.params.cacheSizeCollectionThreshold===-1?(Zt("LruGarbageCollector","Garbage collection skipped; disabled"),wt.resolve(HX)):this.getCacheSize(e).next(a=>a<this.params.cacheSizeCollectionThreshold?(Zt("LruGarbageCollector",`Garbage collection skipped; Cache size ${a} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),HX):this.ir(e,i))}getCacheSize(e){return this.tr.getCacheSize(e)}ir(e,i){let a,l,d,p,y,v,b;const w=Date.now();return this.calculateTargetCount(e,this.params.percentileToCollect).next(A=>(A>this.params.maximumSequenceNumbersToCollect?(Zt("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${A}`),l=this.params.maximumSequenceNumbersToCollect):l=A,p=Date.now(),this.nthSequenceNumber(e,l))).next(A=>(a=A,y=Date.now(),this.removeTargets(e,a,i))).next(A=>(d=A,v=Date.now(),this.removeOrphanedDocuments(e,a))).next(A=>(b=Date.now(),bS()<=br.DEBUG&&Zt("LruGarbageCollector",`LRU Garbage Collection
	Counted targets in ${p-w}ms
	Determined least recently used ${l} in `+(y-p)+`ms
	Removed ${d} targets in `+(v-y)+`ms
	Removed ${A} documents in `+(b-v)+`ms
Total Duration: ${b-w}ms`),wt.resolve({didRun:!0,sequenceNumbersCollected:l,targetsRemoved:d,documentsRemoved:A})))}}function A4e(n,e){return new I4e(n,e)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class P4e{constructor(){this.changes=new $y(e=>e.toString(),(e,i)=>e.isEqual(i)),this.changesApplied=!1}addEntry(e){this.assertNotApplied(),this.changes.set(e.key,e)}removeEntry(e,i){this.assertNotApplied(),this.changes.set(e,Ua.newInvalidDocument(e).setReadTime(i))}getEntry(e,i){this.assertNotApplied();const a=this.changes.get(i);return a!==void 0?wt.resolve(a):this.getFromCache(e,i)}getEntries(e,i){return this.getAllFromCache(e,i)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class O4e{constructor(e,i){this.overlayedDocument=e,this.mutatedFields=i}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class k4e{constructor(e,i,a,l){this.remoteDocumentCache=e,this.mutationQueue=i,this.documentOverlayCache=a,this.indexManager=l}getDocument(e,i){let a=null;return this.documentOverlayCache.getOverlay(e,i).next(l=>(a=l,this.remoteDocumentCache.getEntry(e,i))).next(l=>(a!==null&&cR(a.mutation,l,Pl.empty(),ao.now()),l))}getDocuments(e,i){return this.remoteDocumentCache.getEntries(e,i).next(a=>this.getLocalViewOfDocuments(e,a,Tr()).next(()=>a))}getLocalViewOfDocuments(e,i,a=Tr()){const l=yy();return this.populateOverlays(e,l,i).next(()=>this.computeViews(e,i,l,a).next(d=>{let p=jw();return d.forEach((y,v)=>{p=p.insert(y,v.overlayedDocument)}),p}))}getOverlayedDocuments(e,i){const a=yy();return this.populateOverlays(e,a,i).next(()=>this.computeViews(e,i,a,Tr()))}populateOverlays(e,i,a){const l=[];return a.forEach(d=>{i.has(d)||l.push(d)}),this.documentOverlayCache.getOverlays(e,l).next(d=>{d.forEach((p,y)=>{i.set(p,y)})})}computeViews(e,i,a,l){let d=Mp();const p=aR(),y=function(){return aR()}();return i.forEach((v,b)=>{const w=a.get(b.key);l.has(b.key)&&(w===void 0||w.mutation instanceof Mg)?d=d.insert(b.key,b):w!==void 0?(p.set(b.key,w.mutation.getFieldMask()),cR(w.mutation,b,w.mutation.getFieldMask(),ao.now())):p.set(b.key,Pl.empty())}),this.recalculateAndSaveOverlays(e,d).next(v=>(v.forEach((b,w)=>p.set(b,w)),i.forEach((b,w)=>{var A;return y.set(b,new O4e(w,(A=p.get(b))!==null&&A!==void 0?A:null))}),y))}recalculateAndSaveOverlays(e,i){const a=aR();let l=new ds((p,y)=>p-y),d=Tr();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(e,i).next(p=>{for(const y of p)y.keys().forEach(v=>{const b=i.get(v);if(b===null)return;let w=a.get(v)||Pl.empty();w=y.applyToLocalView(b,w),a.set(v,w);const A=(l.get(y.batchId)||Tr()).add(v);l=l.insert(y.batchId,A)})}).next(()=>{const p=[],y=l.getReverseIterator();for(;y.hasNext();){const v=y.getNext(),b=v.key,w=v.value,A=fie();w.forEach(N=>{if(!d.has(N)){const V=vie(i.get(N),a.get(N));V!==null&&A.set(N,V),d=d.add(N)}}),p.push(this.documentOverlayCache.saveOverlays(e,b,A))}return wt.waitFor(p)}).next(()=>a)}recalculateAndSaveOverlaysForDocumentKeys(e,i){return this.remoteDocumentCache.getEntries(e,i).next(a=>this.recalculateAndSaveOverlays(e,a))}getDocumentsMatchingQuery(e,i,a,l){return function(p){return yn.isDocumentKey(p.path)&&p.collectionGroup===null&&p.filters.length===0}(i)?this.getDocumentsMatchingDocumentQuery(e,i.path):$j(i)?this.getDocumentsMatchingCollectionGroupQuery(e,i,a,l):this.getDocumentsMatchingCollectionQuery(e,i,a,l)}getNextDocuments(e,i,a,l){return this.remoteDocumentCache.getAllFromCollectionGroup(e,i,a,l).next(d=>{const p=l-d.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(e,i,a.largestBatchId,l-d.size):wt.resolve(yy());let y=LR,v=d;return p.next(b=>wt.forEach(b,(w,A)=>(y<A.largestBatchId&&(y=A.largestBatchId),d.get(w)?wt.resolve():this.remoteDocumentCache.getEntry(e,w).next(N=>{v=v.insert(w,N)}))).next(()=>this.populateOverlays(e,b,d)).next(()=>this.computeViews(e,v,b,Tr())).next(w=>({batchId:y,changes:hie(w)})))})}getDocumentsMatchingDocumentQuery(e,i){return this.getDocument(e,new yn(i)).next(a=>{let l=jw();return a.isFoundDocument()&&(l=l.insert(a.key,a)),l})}getDocumentsMatchingCollectionGroupQuery(e,i,a,l){const d=i.collectionGroup;let p=jw();return this.indexManager.getCollectionParents(e,d).next(y=>wt.forEach(y,v=>{const b=function(A,N){return new Hy(N,null,A.explicitOrderBy.slice(),A.filters.slice(),A.limit,A.limitType,A.startAt,A.endAt)}(i,v.child(d));return this.getDocumentsMatchingCollectionQuery(e,b,a,l).next(w=>{w.forEach((A,N)=>{p=p.insert(A,N)})})}).next(()=>p))}getDocumentsMatchingCollectionQuery(e,i,a,l){let d;return this.documentOverlayCache.getOverlaysForCollection(e,i.path,a.largestBatchId).next(p=>(d=p,this.remoteDocumentCache.getDocumentsMatchingQuery(e,i,a,d,l))).next(p=>{d.forEach((v,b)=>{const w=b.getKey();p.get(w)===null&&(p=p.insert(w,Ua.newInvalidDocument(w)))});let y=jw();return p.forEach((v,b)=>{const w=d.get(v);w!==void 0&&cR(w.mutation,b,Pl.empty(),ao.now()),q1(i,b)&&(y=y.insert(v,b))}),y})}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class N4e{constructor(e){this.serializer=e,this.dr=new Map,this.Ar=new Map}getBundleMetadata(e,i){return wt.resolve(this.dr.get(i))}saveBundleMetadata(e,i){return this.dr.set(i.id,function(l){return{id:l.id,version:l.version,createTime:nf(l.createTime)}}(i)),wt.resolve()}getNamedQuery(e,i){return wt.resolve(this.Ar.get(i))}saveNamedQuery(e,i){return this.Ar.set(i.name,function(l){return{name:l.name,query:S4e(l.bundledQuery),readTime:nf(l.readTime)}}(i)),wt.resolve()}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class D4e{constructor(){this.overlays=new ds(yn.comparator),this.Rr=new Map}getOverlay(e,i){return wt.resolve(this.overlays.get(i))}getOverlays(e,i){const a=yy();return wt.forEach(i,l=>this.getOverlay(e,l).next(d=>{d!==null&&a.set(l,d)})).next(()=>a)}saveOverlays(e,i,a){return a.forEach((l,d)=>{this.Et(e,i,d)}),wt.resolve()}removeOverlaysForBatchId(e,i,a){const l=this.Rr.get(a);return l!==void 0&&(l.forEach(d=>this.overlays=this.overlays.remove(d)),this.Rr.delete(a)),wt.resolve()}getOverlaysForCollection(e,i,a){const l=yy(),d=i.length+1,p=new yn(i.child("")),y=this.overlays.getIteratorFrom(p);for(;y.hasNext();){const v=y.getNext().value,b=v.getKey();if(!i.isPrefixOf(b.path))break;b.path.length===d&&v.largestBatchId>a&&l.set(v.getKey(),v)}return wt.resolve(l)}getOverlaysForCollectionGroup(e,i,a,l){let d=new ds((b,w)=>b-w);const p=this.overlays.getIterator();for(;p.hasNext();){const b=p.getNext().value;if(b.getKey().getCollectionGroup()===i&&b.largestBatchId>a){let w=d.get(b.largestBatchId);w===null&&(w=yy(),d=d.insert(b.largestBatchId,w)),w.set(b.getKey(),b)}}const y=yy(),v=d.getIterator();for(;v.hasNext()&&(v.getNext().value.forEach((b,w)=>y.set(b,w)),!(y.size()>=l)););return wt.resolve(y)}Et(e,i,a){const l=this.overlays.get(a.key);if(l!==null){const p=this.Rr.get(l.largestBatchId).delete(a.key);this.Rr.set(l.largestBatchId,p)}this.overlays=this.overlays.insert(a.key,new Qje(i,a));let d=this.Rr.get(i);d===void 0&&(d=Tr(),this.Rr.set(i,d)),this.Rr.set(i,d.add(a.key))}}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class L4e{constructor(){this.sessionToken=aa.EMPTY_BYTE_STRING}getSessionToken(e){return wt.resolve(this.sessionToken)}setSessionToken(e,i){return this.sessionToken=i,wt.resolve()}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Jj{constructor(){this.Vr=new co(Co.mr),this.gr=new co(Co.pr)}isEmpty(){return this.Vr.isEmpty()}addReference(e,i){const a=new Co(e,i);this.Vr=this.Vr.add(a),this.gr=this.gr.add(a)}yr(e,i){e.forEach(a=>this.addReference(a,i))}removeReference(e,i){this.wr(new Co(e,i))}Sr(e,i){e.forEach(a=>this.removeReference(a,i))}br(e){const i=new yn(new Li([])),a=new Co(i,e),l=new Co(i,e+1),d=[];return this.gr.forEachInRange([a,l],p=>{this.wr(p),d.push(p.key)}),d}Dr(){this.Vr.forEach(e=>this.wr(e))}wr(e){this.Vr=this.Vr.delete(e),this.gr=this.gr.delete(e)}vr(e){const i=new yn(new Li([])),a=new Co(i,e),l=new Co(i,e+1);let d=Tr();return this.gr.forEachInRange([a,l],p=>{d=d.add(p.key)}),d}containsKey(e){const i=new Co(e,0),a=this.Vr.firstAfterOrEqual(i);return a!==null&&e.isEqual(a.key)}}class Co{constructor(e,i){this.key=e,this.Cr=i}static mr(e,i){return yn.comparator(e.key,i.key)||ur(e.Cr,i.Cr)}static pr(e,i){return ur(e.Cr,i.Cr)||yn.comparator(e.key,i.key)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class x4e{constructor(e,i){this.indexManager=e,this.referenceDelegate=i,this.mutationQueue=[],this.Fr=1,this.Mr=new co(Co.mr)}checkEmpty(e){return wt.resolve(this.mutationQueue.length===0)}addMutationBatch(e,i,a,l){const d=this.Fr;this.Fr++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];const p=new Jje(d,i,a,l);this.mutationQueue.push(p);for(const y of l)this.Mr=this.Mr.add(new Co(y.key,d)),this.indexManager.addToCollectionParentIndex(e,y.key.path.popLast());return wt.resolve(p)}lookupMutationBatch(e,i){return wt.resolve(this.Or(i))}getNextMutationBatchAfterBatchId(e,i){const a=i+1,l=this.Nr(a),d=l<0?0:l;return wt.resolve(this.mutationQueue.length>d?this.mutationQueue[d]:null)}getHighestUnacknowledgedBatchId(){return wt.resolve(this.mutationQueue.length===0?Wj:this.Fr-1)}getAllMutationBatches(e){return wt.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(e,i){const a=new Co(i,0),l=new Co(i,Number.POSITIVE_INFINITY),d=[];return this.Mr.forEachInRange([a,l],p=>{const y=this.Or(p.Cr);d.push(y)}),wt.resolve(d)}getAllMutationBatchesAffectingDocumentKeys(e,i){let a=new co(ur);return i.forEach(l=>{const d=new Co(l,0),p=new Co(l,Number.POSITIVE_INFINITY);this.Mr.forEachInRange([d,p],y=>{a=a.add(y.Cr)})}),wt.resolve(this.Br(a))}getAllMutationBatchesAffectingQuery(e,i){const a=i.path,l=a.length+1;let d=a;yn.isDocumentKey(d)||(d=d.child(""));const p=new Co(new yn(d),0);let y=new co(ur);return this.Mr.forEachWhile(v=>{const b=v.key.path;return!!a.isPrefixOf(b)&&(b.length===l&&(y=y.add(v.Cr)),!0)},p),wt.resolve(this.Br(y))}Br(e){const i=[];return e.forEach(a=>{const l=this.Or(a);l!==null&&i.push(l)}),i}removeMutationBatch(e,i){si(this.Lr(i.batchId,"removed")===0),this.mutationQueue.shift();let a=this.Mr;return wt.forEach(i.mutations,l=>{const d=new Co(l.key,i.batchId);return a=a.delete(d),this.referenceDelegate.markPotentiallyOrphaned(e,l.key)}).next(()=>{this.Mr=a})}qn(e){}containsKey(e,i){const a=new Co(i,0),l=this.Mr.firstAfterOrEqual(a);return wt.resolve(i.isEqual(l&&l.key))}performConsistencyCheck(e){return this.mutationQueue.length,wt.resolve()}Lr(e,i){return this.Nr(e)}Nr(e){return this.mutationQueue.length===0?0:e-this.mutationQueue[0].batchId}Or(e){const i=this.Nr(e);return i<0||i>=this.mutationQueue.length?null:this.mutationQueue[i]}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class M4e{constructor(e){this.kr=e,this.docs=function(){return new ds(yn.comparator)}(),this.size=0}setIndexManager(e){this.indexManager=e}addEntry(e,i){const a=i.key,l=this.docs.get(a),d=l?l.size:0,p=this.kr(i);return this.docs=this.docs.insert(a,{document:i.mutableCopy(),size:p}),this.size+=p-d,this.indexManager.addToCollectionParentIndex(e,a.path.popLast())}removeEntry(e){const i=this.docs.get(e);i&&(this.docs=this.docs.remove(e),this.size-=i.size)}getEntry(e,i){const a=this.docs.get(i);return wt.resolve(a?a.document.mutableCopy():Ua.newInvalidDocument(i))}getEntries(e,i){let a=Mp();return i.forEach(l=>{const d=this.docs.get(l);a=a.insert(l,d?d.document.mutableCopy():Ua.newInvalidDocument(l))}),wt.resolve(a)}getDocumentsMatchingQuery(e,i,a,l){let d=Mp();const p=i.path,y=new yn(p.child("__id-9223372036854775808__")),v=this.docs.getIteratorFrom(y);for(;v.hasNext();){const{key:b,value:{document:w}}=v.getNext();if(!p.isPrefixOf(b.path))break;b.path.length>p.length+1||hje(dje(w),a)<=0||(l.has(w.key)||q1(i,w))&&(d=d.insert(w.key,w.mutableCopy()))}return wt.resolve(d)}getAllFromCollectionGroup(e,i,a,l){jn()}qr(e,i){return wt.forEach(this.docs,a=>i(a))}newChangeBuffer(e){return new U4e(this)}getSize(e){return wt.resolve(this.size)}}class U4e extends P4e{constructor(e){super(),this.Ir=e}applyChanges(e){const i=[];return this.changes.forEach((a,l)=>{l.isValidDocument()?i.push(this.Ir.addEntry(e,l)):this.Ir.removeEntry(a)}),wt.waitFor(i)}getFromCache(e,i){return this.Ir.getEntry(e,i)}getAllFromCache(e,i){return this.Ir.getEntries(e,i)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class V4e{constructor(e){this.persistence=e,this.Qr=new $y(i=>Gj(i),Hj),this.lastRemoteSnapshotVersion=Gn.min(),this.highestTargetId=0,this.$r=0,this.Ur=new Jj,this.targetCount=0,this.Kr=T0.Un()}forEachTarget(e,i){return this.Qr.forEach((a,l)=>i(l)),wt.resolve()}getLastRemoteSnapshotVersion(e){return wt.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return wt.resolve(this.$r)}allocateTargetId(e){return this.highestTargetId=this.Kr.next(),wt.resolve(this.highestTargetId)}setTargetsMetadata(e,i,a){return a&&(this.lastRemoteSnapshotVersion=a),i>this.$r&&(this.$r=i),wt.resolve()}zn(e){this.Qr.set(e.target,e);const i=e.targetId;i>this.highestTargetId&&(this.Kr=new T0(i),this.highestTargetId=i),e.sequenceNumber>this.$r&&(this.$r=e.sequenceNumber)}addTargetData(e,i){return this.zn(i),this.targetCount+=1,wt.resolve()}updateTargetData(e,i){return this.zn(i),wt.resolve()}removeTargetData(e,i){return this.Qr.delete(i.target),this.Ur.br(i.targetId),this.targetCount-=1,wt.resolve()}removeTargets(e,i,a){let l=0;const d=[];return this.Qr.forEach((p,y)=>{y.sequenceNumber<=i&&a.get(y.targetId)===null&&(this.Qr.delete(p),d.push(this.removeMatchingKeysForTargetId(e,y.targetId)),l++)}),wt.waitFor(d).next(()=>l)}getTargetCount(e){return wt.resolve(this.targetCount)}getTargetData(e,i){const a=this.Qr.get(i)||null;return wt.resolve(a)}addMatchingKeys(e,i,a){return this.Ur.yr(i,a),wt.resolve()}removeMatchingKeys(e,i,a){this.Ur.Sr(i,a);const l=this.persistence.referenceDelegate,d=[];return l&&i.forEach(p=>{d.push(l.markPotentiallyOrphaned(e,p))}),wt.waitFor(d)}removeMatchingKeysForTargetId(e,i){return this.Ur.br(i),wt.resolve()}getMatchingKeysForTargetId(e,i){const a=this.Ur.vr(i);return wt.resolve(a)}containsKey(e,i){return wt.resolve(this.Ur.containsKey(i))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Lie{constructor(e,i){this.Wr={},this.overlays={},this.Gr=new W1(0),this.zr=!1,this.zr=!0,this.jr=new L4e,this.referenceDelegate=e(this),this.Hr=new V4e(this),this.indexManager=new b4e,this.remoteDocumentCache=function(l){return new M4e(l)}(a=>this.referenceDelegate.Jr(a)),this.serializer=new v4e(i),this.Yr=new N4e(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.zr=!1,Promise.resolve()}get started(){return this.zr}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(e){return this.indexManager}getDocumentOverlayCache(e){let i=this.overlays[e.toKey()];return i||(i=new D4e,this.overlays[e.toKey()]=i),i}getMutationQueue(e,i){let a=this.Wr[e.toKey()];return a||(a=new x4e(i,this.referenceDelegate),this.Wr[e.toKey()]=a),a}getGlobalsCache(){return this.jr}getTargetCache(){return this.Hr}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.Yr}runTransaction(e,i,a){Zt("MemoryPersistence","Starting transaction:",e);const l=new F4e(this.Gr.next());return this.referenceDelegate.Zr(),a(l).next(d=>this.referenceDelegate.Xr(l).next(()=>d)).toPromise().then(d=>(l.raiseOnCommittedEvent(),d))}ei(e,i){return wt.or(Object.values(this.Wr).map(a=>()=>a.containsKey(e,i)))}}class F4e extends pje{constructor(e){super(),this.currentSequenceNumber=e}}class Qj{constructor(e){this.persistence=e,this.ti=new Jj,this.ni=null}static ri(e){return new Qj(e)}get ii(){if(this.ni)return this.ni;throw jn()}addReference(e,i,a){return this.ti.addReference(a,i),this.ii.delete(a.toString()),wt.resolve()}removeReference(e,i,a){return this.ti.removeReference(a,i),this.ii.add(a.toString()),wt.resolve()}markPotentiallyOrphaned(e,i){return this.ii.add(i.toString()),wt.resolve()}removeTarget(e,i){this.ti.br(i.targetId).forEach(l=>this.ii.add(l.toString()));const a=this.persistence.getTargetCache();return a.getMatchingKeysForTargetId(e,i.targetId).next(l=>{l.forEach(d=>this.ii.add(d.toString()))}).next(()=>a.removeTargetData(e,i))}Zr(){this.ni=new Set}Xr(e){const i=this.persistence.getRemoteDocumentCache().newChangeBuffer();return wt.forEach(this.ii,a=>{const l=yn.fromPath(a);return this.si(e,l).next(d=>{d||i.removeEntry(l,Gn.min())})}).next(()=>(this.ni=null,i.apply(e)))}updateLimboDocument(e,i){return this.si(e,i).next(a=>{a?this.ii.delete(i.toString()):this.ii.add(i.toString())})}Jr(e){return 0}si(e,i){return wt.or([()=>wt.resolve(this.ti.containsKey(i)),()=>this.persistence.getTargetCache().containsKey(e,i),()=>this.persistence.ei(e,i)])}}class Jk{constructor(e,i){this.persistence=e,this.oi=new $y(a=>_je(a.path),(a,l)=>a.isEqual(l)),this.garbageCollector=A4e(this,i)}static ri(e,i){return new Jk(e,i)}Zr(){}Xr(e){return wt.resolve()}forEachTarget(e,i){return this.persistence.getTargetCache().forEachTarget(e,i)}nr(e){const i=this.sr(e);return this.persistence.getTargetCache().getTargetCount(e).next(a=>i.next(l=>a+l))}sr(e){let i=0;return this.rr(e,a=>{i++}).next(()=>i)}rr(e,i){return wt.forEach(this.oi,(a,l)=>this.ar(e,a,l).next(d=>d?wt.resolve():i(l)))}removeTargets(e,i,a){return this.persistence.getTargetCache().removeTargets(e,i,a)}removeOrphanedDocuments(e,i){let a=0;const l=this.persistence.getRemoteDocumentCache(),d=l.newChangeBuffer();return l.qr(e,p=>this.ar(e,p,i).next(y=>{y||(a++,d.removeEntry(p,Gn.min()))})).next(()=>d.apply(e)).next(()=>a)}markPotentiallyOrphaned(e,i){return this.oi.set(i,e.currentSequenceNumber),wt.resolve()}removeTarget(e,i){const a=i.withSequenceNumber(e.currentSequenceNumber);return this.persistence.getTargetCache().updateTargetData(e,a)}addReference(e,i,a){return this.oi.set(a,e.currentSequenceNumber),wt.resolve()}removeReference(e,i,a){return this.oi.set(a,e.currentSequenceNumber),wt.resolve()}updateLimboDocument(e,i){return this.oi.set(i,e.currentSequenceNumber),wt.resolve()}Jr(e){let i=e.key.toString().length;return e.isFoundDocument()&&(i+=dk(e.data.value)),i}ar(e,i,a){return wt.or([()=>this.persistence.ei(e,i),()=>this.persistence.getTargetCache().containsKey(e,i),()=>{const l=this.oi.get(i);return wt.resolve(l!==void 0&&l>a)}])}getCacheSize(e){return this.persistence.getRemoteDocumentCache().getSize(e)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Zj{constructor(e,i,a,l){this.targetId=e,this.fromCache=i,this.Hi=a,this.Ji=l}static Yi(e,i){let a=Tr(),l=Tr();for(const d of i.docChanges)switch(d.type){case 0:a=a.add(d.doc.key);break;case 1:l=l.add(d.doc.key)}return new Zj(e,i.fromCache,a,l)}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class j4e{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(e){this._documentReadCount+=e}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class B4e{constructor(){this.Zi=!1,this.Xi=!1,this.es=100,this.ts=function(){return S2e()?8:mje(Ba())>0?6:4}()}initialize(e,i){this.ns=e,this.indexManager=i,this.Zi=!0}getDocumentsMatchingQuery(e,i,a,l){const d={result:null};return this.rs(e,i).next(p=>{d.result=p}).next(()=>{if(!d.result)return this.ss(e,i,l,a).next(p=>{d.result=p})}).next(()=>{if(d.result)return;const p=new j4e;return this._s(e,i,p).next(y=>{if(d.result=y,this.Xi)return this.us(e,i,p,y.size)})}).next(()=>d.result)}us(e,i,a,l){return a.documentReadCount<this.es?(bS()<=br.DEBUG&&Zt("QueryEngine","SDK will not create cache indexes for query:",TS(i),"since it only creates cache indexes for collection contains","more than or equal to",this.es,"documents"),wt.resolve()):(bS()<=br.DEBUG&&Zt("QueryEngine","Query:",TS(i),"scans",a.documentReadCount,"local documents and returns",l,"documents as results."),a.documentReadCount>this.ts*l?(bS()<=br.DEBUG&&Zt("QueryEngine","The SDK decides to create cache indexes for query:",TS(i),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(e,tf(i))):wt.resolve())}rs(e,i){if(xX(i))return wt.resolve(null);let a=tf(i);return this.indexManager.getIndexType(e,a).next(l=>l===0?null:(i.limit!==null&&l===1&&(i=kV(i,null,"F"),a=tf(i)),this.indexManager.getDocumentsMatchingTarget(e,a).next(d=>{const p=Tr(...d);return this.ns.getDocuments(e,p).next(y=>this.indexManager.getMinOffset(e,a).next(v=>{const b=this.cs(i,y);return this.ls(i,b,p,v.readTime)?this.rs(e,kV(i,null,"F")):this.hs(e,b,i,v)}))})))}ss(e,i,a,l){return xX(i)||l.isEqual(Gn.min())?wt.resolve(null):this.ns.getDocuments(e,a).next(d=>{const p=this.cs(i,d);return this.ls(i,p,a,l)?wt.resolve(null):(bS()<=br.DEBUG&&Zt("QueryEngine","Re-using previous result from %s to execute query: %s",l.toString(),TS(i)),this.hs(e,p,i,uje(l,LR)).next(y=>y))})}cs(e,i){let a=new co(uie(e));return i.forEach((l,d)=>{q1(e,d)&&(a=a.add(d))}),a}ls(e,i,a,l){if(e.limit===null)return!1;if(a.size!==i.size)return!0;const d=e.limitType==="F"?i.last():i.first();return!!d&&(d.hasPendingWrites||d.version.compareTo(l)>0)}_s(e,i,a){return bS()<=br.DEBUG&&Zt("QueryEngine","Using full collection scan to execute query:",TS(i)),this.ns.getDocumentsMatchingQuery(e,i,wg.min(),a)}hs(e,i,a,l){return this.ns.getDocumentsMatchingQuery(e,a,l).next(d=>(i.forEach(p=>{d=d.insert(p.key,p)}),d))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const e4="LocalStore",W4e=3e8;class z4e{constructor(e,i,a,l){this.persistence=e,this.Ps=i,this.serializer=l,this.Ts=new ds(ur),this.Is=new $y(d=>Gj(d),Hj),this.Es=new Map,this.ds=e.getRemoteDocumentCache(),this.Hr=e.getTargetCache(),this.Yr=e.getBundleCache(),this.As(a)}As(e){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(e),this.indexManager=this.persistence.getIndexManager(e),this.mutationQueue=this.persistence.getMutationQueue(e,this.indexManager),this.localDocuments=new k4e(this.ds,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.ds.setIndexManager(this.indexManager),this.Ps.initialize(this.localDocuments,this.indexManager)}collectGarbage(e){return this.persistence.runTransaction("Collect garbage","readwrite-primary",i=>e.collect(i,this.Ts))}}function G4e(n,e,i,a){return new z4e(n,e,i,a)}async function xie(n,e){const i=qn(n);return await i.persistence.runTransaction("Handle user change","readonly",a=>{let l;return i.mutationQueue.getAllMutationBatches(a).next(d=>(l=d,i.As(e),i.mutationQueue.getAllMutationBatches(a))).next(d=>{const p=[],y=[];let v=Tr();for(const b of l){p.push(b.batchId);for(const w of b.mutations)v=v.add(w.key)}for(const b of d){y.push(b.batchId);for(const w of b.mutations)v=v.add(w.key)}return i.localDocuments.getDocuments(a,v).next(b=>({Rs:b,removedBatchIds:p,addedBatchIds:y}))})})}function H4e(n,e){const i=qn(n);return i.persistence.runTransaction("Acknowledge batch","readwrite-primary",a=>{const l=e.batch.keys(),d=i.ds.newChangeBuffer({trackRemovals:!0});return function(y,v,b,w){const A=b.batch,N=A.keys();let V=wt.resolve();return N.forEach(j=>{V=V.next(()=>w.getEntry(v,j)).next(B=>{const G=b.docVersions.get(j);si(G!==null),B.version.compareTo(G)<0&&(A.applyToRemoteDocument(B,b),B.isValidDocument()&&(B.setReadTime(b.commitVersion),w.addEntry(B)))})}),V.next(()=>y.mutationQueue.removeMutationBatch(v,A))}(i,a,e,d).next(()=>d.apply(a)).next(()=>i.mutationQueue.performConsistencyCheck(a)).next(()=>i.documentOverlayCache.removeOverlaysForBatchId(a,l,e.batch.batchId)).next(()=>i.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(a,function(y){let v=Tr();for(let b=0;b<y.mutationResults.length;++b)y.mutationResults[b].transformResults.length>0&&(v=v.add(y.batch.mutations[b].key));return v}(e))).next(()=>i.localDocuments.getDocuments(a,l))})}function Mie(n){const e=qn(n);return e.persistence.runTransaction("Get last remote snapshot version","readonly",i=>e.Hr.getLastRemoteSnapshotVersion(i))}function $4e(n,e){const i=qn(n),a=e.snapshotVersion;let l=i.Ts;return i.persistence.runTransaction("Apply remote event","readwrite-primary",d=>{const p=i.ds.newChangeBuffer({trackRemovals:!0});l=i.Ts;const y=[];e.targetChanges.forEach((w,A)=>{const N=l.get(A);if(!N)return;y.push(i.Hr.removeMatchingKeys(d,w.removedDocuments,A).next(()=>i.Hr.addMatchingKeys(d,w.addedDocuments,A)));let V=N.withSequenceNumber(d.currentSequenceNumber);e.targetMismatches.get(A)!==null?V=V.withResumeToken(aa.EMPTY_BYTE_STRING,Gn.min()).withLastLimboFreeSnapshotVersion(Gn.min()):w.resumeToken.approximateByteSize()>0&&(V=V.withResumeToken(w.resumeToken,a)),l=l.insert(A,V),function(B,G,ee){return B.resumeToken.approximateByteSize()===0||G.snapshotVersion.toMicroseconds()-B.snapshotVersion.toMicroseconds()>=W4e?!0:ee.addedDocuments.size+ee.modifiedDocuments.size+ee.removedDocuments.size>0}(N,V,w)&&y.push(i.Hr.updateTargetData(d,V))});let v=Mp(),b=Tr();if(e.documentUpdates.forEach(w=>{e.resolvedLimboDocuments.has(w)&&y.push(i.persistence.referenceDelegate.updateLimboDocument(d,w))}),y.push(K4e(d,p,e.documentUpdates).next(w=>{v=w.Vs,b=w.fs})),!a.isEqual(Gn.min())){const w=i.Hr.getLastRemoteSnapshotVersion(d).next(A=>i.Hr.setTargetsMetadata(d,d.currentSequenceNumber,a));y.push(w)}return wt.waitFor(y).next(()=>p.apply(d)).next(()=>i.localDocuments.getLocalViewOfDocuments(d,v,b)).next(()=>v)}).then(d=>(i.Ts=l,d))}function K4e(n,e,i){let a=Tr(),l=Tr();return i.forEach(d=>a=a.add(d)),e.getEntries(n,a).next(d=>{let p=Mp();return i.forEach((y,v)=>{const b=d.get(y);v.isFoundDocument()!==b.isFoundDocument()&&(l=l.add(y)),v.isNoDocument()&&v.version.isEqual(Gn.min())?(e.removeEntry(y,v.readTime),p=p.insert(y,v)):!b.isValidDocument()||v.version.compareTo(b.version)>0||v.version.compareTo(b.version)===0&&b.hasPendingWrites?(e.addEntry(v),p=p.insert(y,v)):Zt(e4,"Ignoring outdated watch update for ",y,". Current version:",b.version," Watch version:",v.version)}),{Vs:p,fs:l}})}function q4e(n,e){const i=qn(n);return i.persistence.runTransaction("Get next mutation batch","readonly",a=>(e===void 0&&(e=Wj),i.mutationQueue.getNextMutationBatchAfterBatchId(a,e)))}function Y4e(n,e){const i=qn(n);return i.persistence.runTransaction("Allocate target","readwrite",a=>{let l;return i.Hr.getTargetData(a,e).next(d=>d?(l=d,wt.resolve(l)):i.Hr.allocateTargetId(a).next(p=>(l=new cg(e,p,"TargetPurposeListen",a.currentSequenceNumber),i.Hr.addTargetData(a,l).next(()=>l))))}).then(a=>{const l=i.Ts.get(a.targetId);return(l===null||a.snapshotVersion.compareTo(l.snapshotVersion)>0)&&(i.Ts=i.Ts.insert(a.targetId,a),i.Is.set(e,a.targetId)),a})}async function MV(n,e,i){const a=qn(n),l=a.Ts.get(e),d=i?"readwrite":"readwrite-primary";try{i||await a.persistence.runTransaction("Release target",d,p=>a.persistence.referenceDelegate.removeTarget(p,l))}catch(p){if(!j0(p))throw p;Zt(e4,`Failed to update sequence numbers for target ${e}: ${p}`)}a.Ts=a.Ts.remove(e),a.Is.delete(l.target)}function qX(n,e,i){const a=qn(n);let l=Gn.min(),d=Tr();return a.persistence.runTransaction("Execute query","readwrite",p=>function(v,b,w){const A=qn(v),N=A.Is.get(w);return N!==void 0?wt.resolve(A.Ts.get(N)):A.Hr.getTargetData(b,w)}(a,p,tf(e)).next(y=>{if(y)return l=y.lastLimboFreeSnapshotVersion,a.Hr.getMatchingKeysForTargetId(p,y.targetId).next(v=>{d=v})}).next(()=>a.Ps.getDocumentsMatchingQuery(p,e,i?l:Gn.min(),i?d:Tr())).next(y=>(X4e(a,Mje(e),y),{documents:y,gs:d})))}function X4e(n,e,i){let a=n.Es.get(e)||Gn.min();i.forEach((l,d)=>{d.readTime.compareTo(a)>0&&(a=d.readTime)}),n.Es.set(e,a)}class YX{constructor(){this.activeTargetIds=Wje()}Ds(e){this.activeTargetIds=this.activeTargetIds.add(e)}vs(e){this.activeTargetIds=this.activeTargetIds.delete(e)}bs(){const e={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(e)}}class J4e{constructor(){this.ho=new YX,this.Po={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,i,a){}addLocalQueryTarget(e,i=!0){return i&&this.ho.Ds(e),this.Po[e]||"not-current"}updateQueryState(e,i,a){this.Po[e]=i}removeLocalQueryTarget(e){this.ho.vs(e)}isLocalQueryTarget(e){return this.ho.activeTargetIds.has(e)}clearQueryState(e){delete this.Po[e]}getAllActiveQueryTargets(){return this.ho.activeTargetIds}isActiveQueryTarget(e){return this.ho.activeTargetIds.has(e)}start(){return this.ho=new YX,Promise.resolve()}handleUserChange(e,i,a){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(e){}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Q4e{To(e){}shutdown(){}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const XX="ConnectivityMonitor";class JX{constructor(){this.Io=()=>this.Eo(),this.Ao=()=>this.Ro(),this.Vo=[],this.mo()}To(e){this.Vo.push(e)}shutdown(){window.removeEventListener("online",this.Io),window.removeEventListener("offline",this.Ao)}mo(){window.addEventListener("online",this.Io),window.addEventListener("offline",this.Ao)}Eo(){Zt(XX,"Network connectivity changed: AVAILABLE");for(const e of this.Vo)e(0)}Ro(){Zt(XX,"Network connectivity changed: UNAVAILABLE");for(const e of this.Vo)e(1)}static D(){return typeof window<"u"&&window.addEventListener!==void 0&&window.removeEventListener!==void 0}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let NO=null;function UV(){return NO===null?NO=function(){return 268435456+Math.round(2147483648*Math.random())}():NO++,"0x"+NO.toString(16)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const tU="RestConnection",Z4e={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"};class e3e{get fo(){return!1}constructor(e){this.databaseInfo=e,this.databaseId=e.databaseId;const i=e.ssl?"https":"http",a=encodeURIComponent(this.databaseId.projectId),l=encodeURIComponent(this.databaseId.database);this.po=i+"://"+e.host,this.yo=`projects/${a}/databases/${l}`,this.wo=this.databaseId.database===Hk?`project_id=${a}`:`project_id=${a}&database_id=${l}`}So(e,i,a,l,d){const p=UV(),y=this.bo(e,i.toUriEncodedString());Zt(tU,`Sending RPC '${e}' ${p}:`,y,a);const v={"google-cloud-resource-prefix":this.yo,"x-goog-request-params":this.wo};return this.Do(v,l,d),this.vo(e,y,v,a).then(b=>(Zt(tU,`Received RPC '${e}' ${p}: `,b),b),b=>{throw g0(tU,`RPC '${e}' ${p} failed with error: `,b,"url: ",y,"request:",a),b})}Co(e,i,a,l,d,p){return this.So(e,i,a,l,d)}Do(e,i,a){e["X-Goog-Api-Client"]=function(){return"gl-js/ fire/"+V0}(),e["Content-Type"]="text/plain",this.databaseInfo.appId&&(e["X-Firebase-GMPID"]=this.databaseInfo.appId),i&&i.headers.forEach((l,d)=>e[d]=l),a&&a.headers.forEach((l,d)=>e[d]=l)}bo(e,i){const a=Z4e[e];return`${this.po}/v1/${i}:${a}`}terminate(){}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class t3e{constructor(e){this.Fo=e.Fo,this.Mo=e.Mo}xo(e){this.Oo=e}No(e){this.Bo=e}Lo(e){this.ko=e}onMessage(e){this.qo=e}close(){this.Mo()}send(e){this.Fo(e)}Qo(){this.Oo()}$o(){this.Bo()}Uo(e){this.ko(e)}Ko(e){this.qo(e)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Na="WebChannelConnection";class n3e extends e3e{constructor(e){super(e),this.forceLongPolling=e.forceLongPolling,this.autoDetectLongPolling=e.autoDetectLongPolling,this.useFetchStreams=e.useFetchStreams,this.longPollingOptions=e.longPollingOptions}vo(e,i,a,l){const d=UV();return new Promise((p,y)=>{const v=new Fre;v.setWithCredentials(!0),v.listenOnce(jre.COMPLETE,()=>{try{switch(v.getLastErrorCode()){case uk.NO_ERROR:const w=v.getResponseJson();Zt(Na,`XHR for RPC '${e}' ${d} received:`,JSON.stringify(w)),p(w);break;case uk.TIMEOUT:Zt(Na,`RPC '${e}' ${d} timed out`),y(new zt(_t.DEADLINE_EXCEEDED,"Request time out"));break;case uk.HTTP_ERROR:const A=v.getStatus();if(Zt(Na,`RPC '${e}' ${d} failed with status:`,A,"response text:",v.getResponseText()),A>0){let N=v.getResponseJson();Array.isArray(N)&&(N=N[0]);const V=N==null?void 0:N.error;if(V&&V.status&&V.message){const j=function(G){const ee=G.toLowerCase().replace(/_/g,"-");return Object.values(_t).indexOf(ee)>=0?ee:_t.UNKNOWN}(V.status);y(new zt(j,V.message))}else y(new zt(_t.UNKNOWN,"Server responded with status "+v.getStatus()))}else y(new zt(_t.UNAVAILABLE,"Connection failed."));break;default:jn()}}finally{Zt(Na,`RPC '${e}' ${d} completed.`)}});const b=JSON.stringify(l);Zt(Na,`RPC '${e}' ${d} sending request:`,l),v.send(i,"POST",b,a,15)})}Wo(e,i,a){const l=UV(),d=[this.po,"/","google.firestore.v1.Firestore","/",e,"/channel"],p=zre(),y=Wre(),v={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},b=this.longPollingOptions.timeoutSeconds;b!==void 0&&(v.longPollingTimeout=Math.round(1e3*b)),this.useFetchStreams&&(v.useFetchStreams=!0),this.Do(v.initMessageHeaders,i,a),v.encodeInitMessageHeaders=!0;const w=d.join("");Zt(Na,`Creating RPC '${e}' stream ${l}: ${w}`,v);const A=p.createWebChannel(w,v);let N=!1,V=!1;const j=new t3e({Fo:G=>{V?Zt(Na,`Not sending because RPC '${e}' stream ${l} is closed:`,G):(N||(Zt(Na,`Opening RPC '${e}' stream ${l} transport.`),A.open(),N=!0),Zt(Na,`RPC '${e}' stream ${l} sending:`,G),A.send(G))},Mo:()=>A.close()}),B=(G,ee,K)=>{G.listen(ee,ne=>{try{K(ne)}catch(ce){setTimeout(()=>{throw ce},0)}})};return B(A,Fw.EventType.OPEN,()=>{V||(Zt(Na,`RPC '${e}' stream ${l} transport opened.`),j.Qo())}),B(A,Fw.EventType.CLOSE,()=>{V||(V=!0,Zt(Na,`RPC '${e}' stream ${l} transport closed`),j.Uo())}),B(A,Fw.EventType.ERROR,G=>{V||(V=!0,g0(Na,`RPC '${e}' stream ${l} transport errored:`,G),j.Uo(new zt(_t.UNAVAILABLE,"The operation could not be completed")))}),B(A,Fw.EventType.MESSAGE,G=>{var ee;if(!V){const K=G.data[0];si(!!K);const ne=K,ce=(ne==null?void 0:ne.error)||((ee=ne[0])===null||ee===void 0?void 0:ee.error);if(ce){Zt(Na,`RPC '${e}' stream ${l} received error:`,ce);const oe=ce.status;let ge=function(J){const se=Hs[J];if(se!==void 0)return Tie(se)}(oe),te=ce.message;ge===void 0&&(ge=_t.INTERNAL,te="Unknown error status: "+oe+" with message "+ce.message),V=!0,j.Uo(new zt(ge,te)),A.close()}else Zt(Na,`RPC '${e}' stream ${l} received:`,K),j.Ko(K)}}),B(y,Bre.STAT_EVENT,G=>{G.stat===wV.PROXY?Zt(Na,`RPC '${e}' stream ${l} detected buffering proxy`):G.stat===wV.NOPROXY&&Zt(Na,`RPC '${e}' stream ${l} detected no buffering proxy`)}),setTimeout(()=>{j.$o()},0),j}}function nU(){return typeof document<"u"?document:null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Q1(n){return new o4e(n,!0)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Uie{constructor(e,i,a=1e3,l=1.5,d=6e4){this.Ti=e,this.timerId=i,this.Go=a,this.zo=l,this.jo=d,this.Ho=0,this.Jo=null,this.Yo=Date.now(),this.reset()}reset(){this.Ho=0}Zo(){this.Ho=this.jo}Xo(e){this.cancel();const i=Math.floor(this.Ho+this.e_()),a=Math.max(0,Date.now()-this.Yo),l=Math.max(0,i-a);l>0&&Zt("ExponentialBackoff",`Backing off for ${l} ms (base delay: ${this.Ho} ms, delay with jitter: ${i} ms, last attempt: ${a} ms ago)`),this.Jo=this.Ti.enqueueAfterDelay(this.timerId,l,()=>(this.Yo=Date.now(),e())),this.Ho*=this.zo,this.Ho<this.Go&&(this.Ho=this.Go),this.Ho>this.jo&&(this.Ho=this.jo)}t_(){this.Jo!==null&&(this.Jo.skipDelay(),this.Jo=null)}cancel(){this.Jo!==null&&(this.Jo.cancel(),this.Jo=null)}e_(){return(Math.random()-.5)*this.Ho}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const QX="PersistentStream";class Vie{constructor(e,i,a,l,d,p,y,v){this.Ti=e,this.n_=a,this.r_=l,this.connection=d,this.authCredentialsProvider=p,this.appCheckCredentialsProvider=y,this.listener=v,this.state=0,this.i_=0,this.s_=null,this.o_=null,this.stream=null,this.__=0,this.a_=new Uie(e,i)}u_(){return this.state===1||this.state===5||this.c_()}c_(){return this.state===2||this.state===3}start(){this.__=0,this.state!==4?this.auth():this.l_()}async stop(){this.u_()&&await this.close(0)}h_(){this.state=0,this.a_.reset()}P_(){this.c_()&&this.s_===null&&(this.s_=this.Ti.enqueueAfterDelay(this.n_,6e4,()=>this.T_()))}I_(e){this.E_(),this.stream.send(e)}async T_(){if(this.c_())return this.close(0)}E_(){this.s_&&(this.s_.cancel(),this.s_=null)}d_(){this.o_&&(this.o_.cancel(),this.o_=null)}async close(e,i){this.E_(),this.d_(),this.a_.cancel(),this.i_++,e!==4?this.a_.reset():i&&i.code===_t.RESOURCE_EXHAUSTED?(xp(i.toString()),xp("Using maximum backoff delay to prevent overloading the backend."),this.a_.Zo()):i&&i.code===_t.UNAUTHENTICATED&&this.state!==3&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),this.stream!==null&&(this.A_(),this.stream.close(),this.stream=null),this.state=e,await this.listener.Lo(i)}A_(){}auth(){this.state=1;const e=this.R_(this.i_),i=this.i_;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then(([a,l])=>{this.i_===i&&this.V_(a,l)},a=>{e(()=>{const l=new zt(_t.UNKNOWN,"Fetching auth token failed: "+a.message);return this.m_(l)})})}V_(e,i){const a=this.R_(this.i_);this.stream=this.f_(e,i),this.stream.xo(()=>{a(()=>this.listener.xo())}),this.stream.No(()=>{a(()=>(this.state=2,this.o_=this.Ti.enqueueAfterDelay(this.r_,1e4,()=>(this.c_()&&(this.state=3),Promise.resolve())),this.listener.No()))}),this.stream.Lo(l=>{a(()=>this.m_(l))}),this.stream.onMessage(l=>{a(()=>++this.__==1?this.g_(l):this.onNext(l))})}l_(){this.state=5,this.a_.Xo(async()=>{this.state=0,this.start()})}m_(e){return Zt(QX,`close with error: ${e}`),this.stream=null,this.close(4,e)}R_(e){return i=>{this.Ti.enqueueAndForget(()=>this.i_===e?i():(Zt(QX,"stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve()))}}}class r3e extends Vie{constructor(e,i,a,l,d,p){super(e,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",i,a,l,p),this.serializer=d}f_(e,i){return this.connection.Wo("Listen",e,i)}g_(e){return this.onNext(e)}onNext(e){this.a_.reset();const i=l4e(this.serializer,e),a=function(d){if(!("targetChange"in d))return Gn.min();const p=d.targetChange;return p.targetIds&&p.targetIds.length?Gn.min():p.readTime?nf(p.readTime):Gn.min()}(e);return this.listener.p_(i,a)}y_(e){const i={};i.database=xV(this.serializer),i.addTarget=function(d,p){let y;const v=p.target;if(y=PV(v)?{documents:h4e(d,v)}:{query:f4e(d,v).ht},y.targetId=p.targetId,p.resumeToken.approximateByteSize()>0){y.resumeToken=Cie(d,p.resumeToken);const b=NV(d,p.expectedCount);b!==null&&(y.expectedCount=b)}else if(p.snapshotVersion.compareTo(Gn.min())>0){y.readTime=Xk(d,p.snapshotVersion.toTimestamp());const b=NV(d,p.expectedCount);b!==null&&(y.expectedCount=b)}return y}(this.serializer,e);const a=m4e(this.serializer,e);a&&(i.labels=a),this.I_(i)}w_(e){const i={};i.database=xV(this.serializer),i.removeTarget=e,this.I_(i)}}class i3e extends Vie{constructor(e,i,a,l,d,p){super(e,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",i,a,l,p),this.serializer=d}get S_(){return this.__>0}start(){this.lastStreamToken=void 0,super.start()}A_(){this.S_&&this.b_([])}f_(e,i){return this.connection.Wo("Write",e,i)}g_(e){return si(!!e.streamToken),this.lastStreamToken=e.streamToken,si(!e.writeResults||e.writeResults.length===0),this.listener.D_()}onNext(e){si(!!e.streamToken),this.lastStreamToken=e.streamToken,this.a_.reset();const i=d4e(e.writeResults,e.commitTime),a=nf(e.commitTime);return this.listener.v_(a,i)}C_(){const e={};e.database=xV(this.serializer),this.I_(e)}b_(e){const i={streamToken:this.lastStreamToken,writes:e.map(a=>u4e(this.serializer,a))};this.I_(i)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class s3e{}class o3e extends s3e{constructor(e,i,a,l){super(),this.authCredentials=e,this.appCheckCredentials=i,this.connection=a,this.serializer=l,this.F_=!1}M_(){if(this.F_)throw new zt(_t.FAILED_PRECONDITION,"The client has already been terminated.")}So(e,i,a,l){return this.M_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([d,p])=>this.connection.So(e,DV(i,a),l,d,p)).catch(d=>{throw d.name==="FirebaseError"?(d.code===_t.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),d):new zt(_t.UNKNOWN,d.toString())})}Co(e,i,a,l,d){return this.M_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([p,y])=>this.connection.Co(e,DV(i,a),l,p,y,d)).catch(p=>{throw p.name==="FirebaseError"?(p.code===_t.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),p):new zt(_t.UNKNOWN,p.toString())})}terminate(){this.F_=!0,this.connection.terminate()}}class a3e{constructor(e,i){this.asyncQueue=e,this.onlineStateHandler=i,this.state="Unknown",this.x_=0,this.O_=null,this.N_=!0}B_(){this.x_===0&&(this.L_("Unknown"),this.O_=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,()=>(this.O_=null,this.k_("Backend didn't respond within 10 seconds."),this.L_("Offline"),Promise.resolve())))}q_(e){this.state==="Online"?this.L_("Unknown"):(this.x_++,this.x_>=1&&(this.Q_(),this.k_(`Connection failed 1 times. Most recent error: ${e.toString()}`),this.L_("Offline")))}set(e){this.Q_(),this.x_=0,e==="Online"&&(this.N_=!1),this.L_(e)}L_(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}k_(e){const i=`Could not reach Cloud Firestore backend. ${e}
This typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.N_?(xp(i),this.N_=!1):Zt("OnlineStateTracker",i)}Q_(){this.O_!==null&&(this.O_.cancel(),this.O_=null)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Fy="RemoteStore";class c3e{constructor(e,i,a,l,d){this.localStore=e,this.datastore=i,this.asyncQueue=a,this.remoteSyncer={},this.U_=[],this.K_=new Map,this.W_=new Set,this.G_=[],this.z_=d,this.z_.To(p=>{a.enqueueAndForget(async()=>{Ky(this)&&(Zt(Fy,"Restarting streams for network reachability change."),await async function(v){const b=qn(v);b.W_.add(4),await gC(b),b.j_.set("Unknown"),b.W_.delete(4),await Z1(b)}(this))})}),this.j_=new a3e(a,l)}}async function Z1(n){if(Ky(n))for(const e of n.G_)await e(!0)}async function gC(n){for(const e of n.G_)await e(!1)}function Fie(n,e){const i=qn(n);i.K_.has(e.targetId)||(i.K_.set(e.targetId,e),i4(i)?r4(i):B0(i).c_()&&n4(i,e))}function t4(n,e){const i=qn(n),a=B0(i);i.K_.delete(e),a.c_()&&jie(i,e),i.K_.size===0&&(a.c_()?a.P_():Ky(i)&&i.j_.set("Unknown"))}function n4(n,e){if(n.H_.Ne(e.targetId),e.resumeToken.approximateByteSize()>0||e.snapshotVersion.compareTo(Gn.min())>0){const i=n.remoteSyncer.getRemoteKeysForTarget(e.targetId).size;e=e.withExpectedCount(i)}B0(n).y_(e)}function jie(n,e){n.H_.Ne(e),B0(n).w_(e)}function r4(n){n.H_=new n4e({getRemoteKeysForTarget:e=>n.remoteSyncer.getRemoteKeysForTarget(e),lt:e=>n.K_.get(e)||null,it:()=>n.datastore.serializer.databaseId}),B0(n).start(),n.j_.B_()}function i4(n){return Ky(n)&&!B0(n).u_()&&n.K_.size>0}function Ky(n){return qn(n).W_.size===0}function Bie(n){n.H_=void 0}async function l3e(n){n.j_.set("Online")}async function u3e(n){n.K_.forEach((e,i)=>{n4(n,e)})}async function d3e(n,e){Bie(n),i4(n)?(n.j_.q_(e),r4(n)):n.j_.set("Unknown")}async function h3e(n,e,i){if(n.j_.set("Online"),e instanceof Rie&&e.state===2&&e.cause)try{await async function(l,d){const p=d.cause;for(const y of d.targetIds)l.K_.has(y)&&(await l.remoteSyncer.rejectListen(y,p),l.K_.delete(y),l.H_.removeTarget(y))}(n,e)}catch(a){Zt(Fy,"Failed to remove targets %s: %s ",e.targetIds.join(","),a),await Qk(n,a)}else if(e instanceof pk?n.H_.We(e):e instanceof wie?n.H_.Ze(e):n.H_.je(e),!i.isEqual(Gn.min()))try{const a=await Mie(n.localStore);i.compareTo(a)>=0&&await function(d,p){const y=d.H_.ot(p);return y.targetChanges.forEach((v,b)=>{if(v.resumeToken.approximateByteSize()>0){const w=d.K_.get(b);w&&d.K_.set(b,w.withResumeToken(v.resumeToken,p))}}),y.targetMismatches.forEach((v,b)=>{const w=d.K_.get(v);if(!w)return;d.K_.set(v,w.withResumeToken(aa.EMPTY_BYTE_STRING,w.snapshotVersion)),jie(d,v);const A=new cg(w.target,v,b,w.sequenceNumber);n4(d,A)}),d.remoteSyncer.applyRemoteEvent(y)}(n,i)}catch(a){Zt(Fy,"Failed to raise snapshot:",a),await Qk(n,a)}}async function Qk(n,e,i){if(!j0(e))throw e;n.W_.add(1),await gC(n),n.j_.set("Offline"),i||(i=()=>Mie(n.localStore)),n.asyncQueue.enqueueRetryable(async()=>{Zt(Fy,"Retrying IndexedDB access"),await i(),n.W_.delete(1),await Z1(n)})}function Wie(n,e){return e().catch(i=>Qk(n,i,e))}async function eN(n){const e=qn(n),i=Ag(e);let a=e.U_.length>0?e.U_[e.U_.length-1].batchId:Wj;for(;f3e(e);)try{const l=await q4e(e.localStore,a);if(l===null){e.U_.length===0&&i.P_();break}a=l.batchId,p3e(e,l)}catch(l){await Qk(e,l)}zie(e)&&Gie(e)}function f3e(n){return Ky(n)&&n.U_.length<10}function p3e(n,e){n.U_.push(e);const i=Ag(n);i.c_()&&i.S_&&i.b_(e.mutations)}function zie(n){return Ky(n)&&!Ag(n).u_()&&n.U_.length>0}function Gie(n){Ag(n).start()}async function m3e(n){Ag(n).C_()}async function g3e(n){const e=Ag(n);for(const i of n.U_)e.b_(i.mutations)}async function _3e(n,e,i){const a=n.U_.shift(),l=qj.from(a,e,i);await Wie(n,()=>n.remoteSyncer.applySuccessfulWrite(l)),await eN(n)}async function y3e(n,e){e&&Ag(n).S_&&await async function(a,l){if(function(p){return e4e(p)&&p!==_t.ABORTED}(l.code)){const d=a.U_.shift();Ag(a).h_(),await Wie(a,()=>a.remoteSyncer.rejectFailedWrite(d.batchId,l)),await eN(a)}}(n,e),zie(n)&&Gie(n)}async function ZX(n,e){const i=qn(n);i.asyncQueue.verifyOperationInProgress(),Zt(Fy,"RemoteStore received new credentials");const a=Ky(i);i.W_.add(3),await gC(i),a&&i.j_.set("Unknown"),await i.remoteSyncer.handleCredentialChange(e),i.W_.delete(3),await Z1(i)}async function E3e(n,e){const i=qn(n);e?(i.W_.delete(2),await Z1(i)):e||(i.W_.add(2),await gC(i),i.j_.set("Unknown"))}function B0(n){return n.J_||(n.J_=function(i,a,l){const d=qn(i);return d.M_(),new r3e(a,d.connection,d.authCredentials,d.appCheckCredentials,d.serializer,l)}(n.datastore,n.asyncQueue,{xo:l3e.bind(null,n),No:u3e.bind(null,n),Lo:d3e.bind(null,n),p_:h3e.bind(null,n)}),n.G_.push(async e=>{e?(n.J_.h_(),i4(n)?r4(n):n.j_.set("Unknown")):(await n.J_.stop(),Bie(n))})),n.J_}function Ag(n){return n.Y_||(n.Y_=function(i,a,l){const d=qn(i);return d.M_(),new i3e(a,d.connection,d.authCredentials,d.appCheckCredentials,d.serializer,l)}(n.datastore,n.asyncQueue,{xo:()=>Promise.resolve(),No:m3e.bind(null,n),Lo:y3e.bind(null,n),D_:g3e.bind(null,n),v_:_3e.bind(null,n)}),n.G_.push(async e=>{e?(n.Y_.h_(),await eN(n)):(await n.Y_.stop(),n.U_.length>0&&(Zt(Fy,`Stopping write stream with ${n.U_.length} pending writes`),n.U_=[]))})),n.Y_}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class s4{constructor(e,i,a,l,d){this.asyncQueue=e,this.timerId=i,this.targetTimeMs=a,this.op=l,this.removalCallback=d,this.deferred=new Ap,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(p=>{})}get promise(){return this.deferred.promise}static createAndSchedule(e,i,a,l,d){const p=Date.now()+a,y=new s4(e,i,p,l,d);return y.start(a),y}start(e){this.timerHandle=setTimeout(()=>this.handleDelayElapsed(),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){this.timerHandle!==null&&(this.clearTimeout(),this.deferred.reject(new zt(_t.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget(()=>this.timerHandle!==null?(this.clearTimeout(),this.op().then(e=>this.deferred.resolve(e))):Promise.resolve())}clearTimeout(){this.timerHandle!==null&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function o4(n,e){if(xp("AsyncQueue",`${e}: ${n}`),j0(n))return new zt(_t.UNAVAILABLE,`${e}: ${n}`);throw n}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class t0{static emptySet(e){return new t0(e.comparator)}constructor(e){this.comparator=e?(i,a)=>e(i,a)||yn.comparator(i.key,a.key):(i,a)=>yn.comparator(i.key,a.key),this.keyedMap=jw(),this.sortedSet=new ds(this.comparator)}has(e){return this.keyedMap.get(e)!=null}get(e){return this.keyedMap.get(e)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(e){const i=this.keyedMap.get(e);return i?this.sortedSet.indexOf(i):-1}get size(){return this.sortedSet.size}forEach(e){this.sortedSet.inorderTraversal((i,a)=>(e(i),!1))}add(e){const i=this.delete(e.key);return i.copy(i.keyedMap.insert(e.key,e),i.sortedSet.insert(e,null))}delete(e){const i=this.get(e);return i?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(i)):this}isEqual(e){if(!(e instanceof t0)||this.size!==e.size)return!1;const i=this.sortedSet.getIterator(),a=e.sortedSet.getIterator();for(;i.hasNext();){const l=i.getNext().key,d=a.getNext().key;if(!l.isEqual(d))return!1}return!0}toString(){const e=[];return this.forEach(i=>{e.push(i.toString())}),e.length===0?"DocumentSet ()":`DocumentSet (
  `+e.join(`  
`)+`
)`}copy(e,i){const a=new t0;return a.comparator=this.comparator,a.keyedMap=e,a.sortedSet=i,a}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class eJ{constructor(){this.Z_=new ds(yn.comparator)}track(e){const i=e.doc.key,a=this.Z_.get(i);a?e.type!==0&&a.type===3?this.Z_=this.Z_.insert(i,e):e.type===3&&a.type!==1?this.Z_=this.Z_.insert(i,{type:a.type,doc:e.doc}):e.type===2&&a.type===2?this.Z_=this.Z_.insert(i,{type:2,doc:e.doc}):e.type===2&&a.type===0?this.Z_=this.Z_.insert(i,{type:0,doc:e.doc}):e.type===1&&a.type===0?this.Z_=this.Z_.remove(i):e.type===1&&a.type===2?this.Z_=this.Z_.insert(i,{type:1,doc:a.doc}):e.type===0&&a.type===1?this.Z_=this.Z_.insert(i,{type:2,doc:e.doc}):jn():this.Z_=this.Z_.insert(i,e)}X_(){const e=[];return this.Z_.inorderTraversal((i,a)=>{e.push(a)}),e}}class w0{constructor(e,i,a,l,d,p,y,v,b){this.query=e,this.docs=i,this.oldDocs=a,this.docChanges=l,this.mutatedKeys=d,this.fromCache=p,this.syncStateChanged=y,this.excludesMetadataChanges=v,this.hasCachedResults=b}static fromInitialDocuments(e,i,a,l,d){const p=[];return i.forEach(y=>{p.push({type:0,doc:y})}),new w0(e,i,t0.emptySet(i),p,a,l,!0,!1,d)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(e){if(!(this.fromCache===e.fromCache&&this.hasCachedResults===e.hasCachedResults&&this.syncStateChanged===e.syncStateChanged&&this.mutatedKeys.isEqual(e.mutatedKeys)&&K1(this.query,e.query)&&this.docs.isEqual(e.docs)&&this.oldDocs.isEqual(e.oldDocs)))return!1;const i=this.docChanges,a=e.docChanges;if(i.length!==a.length)return!1;for(let l=0;l<i.length;l++)if(i[l].type!==a[l].type||!i[l].doc.isEqual(a[l].doc))return!1;return!0}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class v3e{constructor(){this.ea=void 0,this.ta=[]}na(){return this.ta.some(e=>e.ra())}}class S3e{constructor(){this.queries=tJ(),this.onlineState="Unknown",this.ia=new Set}terminate(){(function(i,a){const l=qn(i),d=l.queries;l.queries=tJ(),d.forEach((p,y)=>{for(const v of y.ta)v.onError(a)})})(this,new zt(_t.ABORTED,"Firestore shutting down"))}}function tJ(){return new $y(n=>lie(n),K1)}async function a4(n,e){const i=qn(n);let a=3;const l=e.query;let d=i.queries.get(l);d?!d.na()&&e.ra()&&(a=2):(d=new v3e,a=e.ra()?0:1);try{switch(a){case 0:d.ea=await i.onListen(l,!0);break;case 1:d.ea=await i.onListen(l,!1);break;case 2:await i.onFirstRemoteStoreListen(l)}}catch(p){const y=o4(p,`Initialization of query '${TS(e.query)}' failed`);return void e.onError(y)}i.queries.set(l,d),d.ta.push(e),e.sa(i.onlineState),d.ea&&e.oa(d.ea)&&l4(i)}async function c4(n,e){const i=qn(n),a=e.query;let l=3;const d=i.queries.get(a);if(d){const p=d.ta.indexOf(e);p>=0&&(d.ta.splice(p,1),d.ta.length===0?l=e.ra()?0:1:!d.na()&&e.ra()&&(l=2))}switch(l){case 0:return i.queries.delete(a),i.onUnlisten(a,!0);case 1:return i.queries.delete(a),i.onUnlisten(a,!1);case 2:return i.onLastRemoteStoreUnlisten(a);default:return}}function b3e(n,e){const i=qn(n);let a=!1;for(const l of e){const d=l.query,p=i.queries.get(d);if(p){for(const y of p.ta)y.oa(l)&&(a=!0);p.ea=l}}a&&l4(i)}function T3e(n,e,i){const a=qn(n),l=a.queries.get(e);if(l)for(const d of l.ta)d.onError(i);a.queries.delete(e)}function l4(n){n.ia.forEach(e=>{e.next()})}var VV,nJ;(nJ=VV||(VV={}))._a="default",nJ.Cache="cache";class u4{constructor(e,i,a){this.query=e,this.aa=i,this.ua=!1,this.ca=null,this.onlineState="Unknown",this.options=a||{}}oa(e){if(!this.options.includeMetadataChanges){const a=[];for(const l of e.docChanges)l.type!==3&&a.push(l);e=new w0(e.query,e.docs,e.oldDocs,a,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0,e.hasCachedResults)}let i=!1;return this.ua?this.la(e)&&(this.aa.next(e),i=!0):this.ha(e,this.onlineState)&&(this.Pa(e),i=!0),this.ca=e,i}onError(e){this.aa.error(e)}sa(e){this.onlineState=e;let i=!1;return this.ca&&!this.ua&&this.ha(this.ca,e)&&(this.Pa(this.ca),i=!0),i}ha(e,i){if(!e.fromCache||!this.ra())return!0;const a=i!=="Offline";return(!this.options.Ta||!a)&&(!e.docs.isEmpty()||e.hasCachedResults||i==="Offline")}la(e){if(e.docChanges.length>0)return!0;const i=this.ca&&this.ca.hasPendingWrites!==e.hasPendingWrites;return!(!e.syncStateChanged&&!i)&&this.options.includeMetadataChanges===!0}Pa(e){e=w0.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache,e.hasCachedResults),this.ua=!0,this.aa.next(e)}ra(){return this.options.source!==VV.Cache}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Hie{constructor(e){this.key=e}}class $ie{constructor(e){this.key=e}}class w3e{constructor(e,i){this.query=e,this.fa=i,this.ga=null,this.hasCachedResults=!1,this.current=!1,this.pa=Tr(),this.mutatedKeys=Tr(),this.ya=uie(e),this.wa=new t0(this.ya)}get Sa(){return this.fa}ba(e,i){const a=i?i.Da:new eJ,l=i?i.wa:this.wa;let d=i?i.mutatedKeys:this.mutatedKeys,p=l,y=!1;const v=this.query.limitType==="F"&&l.size===this.query.limit?l.last():null,b=this.query.limitType==="L"&&l.size===this.query.limit?l.first():null;if(e.inorderTraversal((w,A)=>{const N=l.get(w),V=q1(this.query,A)?A:null,j=!!N&&this.mutatedKeys.has(N.key),B=!!V&&(V.hasLocalMutations||this.mutatedKeys.has(V.key)&&V.hasCommittedMutations);let G=!1;N&&V?N.data.isEqual(V.data)?j!==B&&(a.track({type:3,doc:V}),G=!0):this.va(N,V)||(a.track({type:2,doc:V}),G=!0,(v&&this.ya(V,v)>0||b&&this.ya(V,b)<0)&&(y=!0)):!N&&V?(a.track({type:0,doc:V}),G=!0):N&&!V&&(a.track({type:1,doc:N}),G=!0,(v||b)&&(y=!0)),G&&(V?(p=p.add(V),d=B?d.add(w):d.delete(w)):(p=p.delete(w),d=d.delete(w)))}),this.query.limit!==null)for(;p.size>this.query.limit;){const w=this.query.limitType==="F"?p.last():p.first();p=p.delete(w.key),d=d.delete(w.key),a.track({type:1,doc:w})}return{wa:p,Da:a,ls:y,mutatedKeys:d}}va(e,i){return e.hasLocalMutations&&i.hasCommittedMutations&&!i.hasLocalMutations}applyChanges(e,i,a,l){const d=this.wa;this.wa=e.wa,this.mutatedKeys=e.mutatedKeys;const p=e.Da.X_();p.sort((w,A)=>function(V,j){const B=G=>{switch(G){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return jn()}};return B(V)-B(j)}(w.type,A.type)||this.ya(w.doc,A.doc)),this.Ca(a),l=l!=null&&l;const y=i&&!l?this.Fa():[],v=this.pa.size===0&&this.current&&!l?1:0,b=v!==this.ga;return this.ga=v,p.length!==0||b?{snapshot:new w0(this.query,e.wa,d,p,e.mutatedKeys,v===0,b,!1,!!a&&a.resumeToken.approximateByteSize()>0),Ma:y}:{Ma:y}}sa(e){return this.current&&e==="Offline"?(this.current=!1,this.applyChanges({wa:this.wa,Da:new eJ,mutatedKeys:this.mutatedKeys,ls:!1},!1)):{Ma:[]}}xa(e){return!this.fa.has(e)&&!!this.wa.has(e)&&!this.wa.get(e).hasLocalMutations}Ca(e){e&&(e.addedDocuments.forEach(i=>this.fa=this.fa.add(i)),e.modifiedDocuments.forEach(i=>{}),e.removedDocuments.forEach(i=>this.fa=this.fa.delete(i)),this.current=e.current)}Fa(){if(!this.current)return[];const e=this.pa;this.pa=Tr(),this.wa.forEach(a=>{this.xa(a.key)&&(this.pa=this.pa.add(a.key))});const i=[];return e.forEach(a=>{this.pa.has(a)||i.push(new $ie(a))}),this.pa.forEach(a=>{e.has(a)||i.push(new Hie(a))}),i}Oa(e){this.fa=e.gs,this.pa=Tr();const i=this.ba(e.documents);return this.applyChanges(i,!0)}Na(){return w0.fromInitialDocuments(this.query,this.wa,this.mutatedKeys,this.ga===0,this.hasCachedResults)}}const d4="SyncEngine";class R3e{constructor(e,i,a){this.query=e,this.targetId=i,this.view=a}}class C3e{constructor(e){this.key=e,this.Ba=!1}}class I3e{constructor(e,i,a,l,d,p){this.localStore=e,this.remoteStore=i,this.eventManager=a,this.sharedClientState=l,this.currentUser=d,this.maxConcurrentLimboResolutions=p,this.La={},this.ka=new $y(y=>lie(y),K1),this.qa=new Map,this.Qa=new Set,this.$a=new ds(yn.comparator),this.Ua=new Map,this.Ka=new Jj,this.Wa={},this.Ga=new Map,this.za=T0.Kn(),this.onlineState="Unknown",this.ja=void 0}get isPrimaryClient(){return this.ja===!0}}async function A3e(n,e,i=!0){const a=Qie(n);let l;const d=a.ka.get(e);return d?(a.sharedClientState.addLocalQueryTarget(d.targetId),l=d.view.Na()):l=await Kie(a,e,i,!0),l}async function P3e(n,e){const i=Qie(n);await Kie(i,e,!0,!1)}async function Kie(n,e,i,a){const l=await Y4e(n.localStore,tf(e)),d=l.targetId,p=n.sharedClientState.addLocalQueryTarget(d,i);let y;return a&&(y=await O3e(n,e,d,p==="current",l.resumeToken)),n.isPrimaryClient&&i&&Fie(n.remoteStore,l),y}async function O3e(n,e,i,a,l){n.Ha=(A,N,V)=>async function(B,G,ee,K){let ne=G.view.ba(ee);ne.ls&&(ne=await qX(B.localStore,G.query,!1).then(({documents:te})=>G.view.ba(te,ne)));const ce=K&&K.targetChanges.get(G.targetId),oe=K&&K.targetMismatches.get(G.targetId)!=null,ge=G.view.applyChanges(ne,B.isPrimaryClient,ce,oe);return iJ(B,G.targetId,ge.Ma),ge.snapshot}(n,A,N,V);const d=await qX(n.localStore,e,!0),p=new w3e(e,d.gs),y=p.ba(d.documents),v=mC.createSynthesizedTargetChangeForCurrentChange(i,a&&n.onlineState!=="Offline",l),b=p.applyChanges(y,n.isPrimaryClient,v);iJ(n,i,b.Ma);const w=new R3e(e,i,p);return n.ka.set(e,w),n.qa.has(i)?n.qa.get(i).push(e):n.qa.set(i,[e]),b.snapshot}async function k3e(n,e,i){const a=qn(n),l=a.ka.get(e),d=a.qa.get(l.targetId);if(d.length>1)return a.qa.set(l.targetId,d.filter(p=>!K1(p,e))),void a.ka.delete(e);a.isPrimaryClient?(a.sharedClientState.removeLocalQueryTarget(l.targetId),a.sharedClientState.isActiveQueryTarget(l.targetId)||await MV(a.localStore,l.targetId,!1).then(()=>{a.sharedClientState.clearQueryState(l.targetId),i&&t4(a.remoteStore,l.targetId),FV(a,l.targetId)}).catch(F0)):(FV(a,l.targetId),await MV(a.localStore,l.targetId,!0))}async function N3e(n,e){const i=qn(n),a=i.ka.get(e),l=i.qa.get(a.targetId);i.isPrimaryClient&&l.length===1&&(i.sharedClientState.removeLocalQueryTarget(a.targetId),t4(i.remoteStore,a.targetId))}async function D3e(n,e,i){const a=j3e(n);try{const l=await function(p,y){const v=qn(p),b=ao.now(),w=y.reduce((V,j)=>V.add(j.key),Tr());let A,N;return v.persistence.runTransaction("Locally write mutations","readwrite",V=>{let j=Mp(),B=Tr();return v.ds.getEntries(V,w).next(G=>{j=G,j.forEach((ee,K)=>{K.isValidDocument()||(B=B.add(ee))})}).next(()=>v.localDocuments.getOverlayedDocuments(V,j)).next(G=>{A=G;const ee=[];for(const K of y){const ne=Yje(K,A.get(K.key).overlayedDocument);ne!=null&&ee.push(new Mg(K.key,ne,nie(ne.value.mapValue),Ld.exists(!0)))}return v.mutationQueue.addMutationBatch(V,b,ee,y)}).next(G=>{N=G;const ee=G.applyToLocalDocumentSet(A,B);return v.documentOverlayCache.saveOverlays(V,G.batchId,ee)})}).then(()=>({batchId:N.batchId,changes:hie(A)}))}(a.localStore,e);a.sharedClientState.addPendingMutation(l.batchId),function(p,y,v){let b=p.Wa[p.currentUser.toKey()];b||(b=new ds(ur)),b=b.insert(y,v),p.Wa[p.currentUser.toKey()]=b}(a,l.batchId,i),await _C(a,l.changes),await eN(a.remoteStore)}catch(l){const d=o4(l,"Failed to persist write");i.reject(d)}}async function qie(n,e){const i=qn(n);try{const a=await $4e(i.localStore,e);e.targetChanges.forEach((l,d)=>{const p=i.Ua.get(d);p&&(si(l.addedDocuments.size+l.modifiedDocuments.size+l.removedDocuments.size<=1),l.addedDocuments.size>0?p.Ba=!0:l.modifiedDocuments.size>0?si(p.Ba):l.removedDocuments.size>0&&(si(p.Ba),p.Ba=!1))}),await _C(i,a,e)}catch(a){await F0(a)}}function rJ(n,e,i){const a=qn(n);if(a.isPrimaryClient&&i===0||!a.isPrimaryClient&&i===1){const l=[];a.ka.forEach((d,p)=>{const y=p.view.sa(e);y.snapshot&&l.push(y.snapshot)}),function(p,y){const v=qn(p);v.onlineState=y;let b=!1;v.queries.forEach((w,A)=>{for(const N of A.ta)N.sa(y)&&(b=!0)}),b&&l4(v)}(a.eventManager,e),l.length&&a.La.p_(l),a.onlineState=e,a.isPrimaryClient&&a.sharedClientState.setOnlineState(e)}}async function L3e(n,e,i){const a=qn(n);a.sharedClientState.updateQueryState(e,"rejected",i);const l=a.Ua.get(e),d=l&&l.key;if(d){let p=new ds(yn.comparator);p=p.insert(d,Ua.newNoDocument(d,Gn.min()));const y=Tr().add(d),v=new J1(Gn.min(),new Map,new ds(ur),p,y);await qie(a,v),a.$a=a.$a.remove(d),a.Ua.delete(e),h4(a)}else await MV(a.localStore,e,!1).then(()=>FV(a,e,i)).catch(F0)}async function x3e(n,e){const i=qn(n),a=e.batch.batchId;try{const l=await H4e(i.localStore,e);Xie(i,a,null),Yie(i,a),i.sharedClientState.updateMutationState(a,"acknowledged"),await _C(i,l)}catch(l){await F0(l)}}async function M3e(n,e,i){const a=qn(n);try{const l=await function(p,y){const v=qn(p);return v.persistence.runTransaction("Reject batch","readwrite-primary",b=>{let w;return v.mutationQueue.lookupMutationBatch(b,y).next(A=>(si(A!==null),w=A.keys(),v.mutationQueue.removeMutationBatch(b,A))).next(()=>v.mutationQueue.performConsistencyCheck(b)).next(()=>v.documentOverlayCache.removeOverlaysForBatchId(b,w,y)).next(()=>v.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(b,w)).next(()=>v.localDocuments.getDocuments(b,w))})}(a.localStore,e);Xie(a,e,i),Yie(a,e),a.sharedClientState.updateMutationState(e,"rejected",i),await _C(a,l)}catch(l){await F0(l)}}function Yie(n,e){(n.Ga.get(e)||[]).forEach(i=>{i.resolve()}),n.Ga.delete(e)}function Xie(n,e,i){const a=qn(n);let l=a.Wa[a.currentUser.toKey()];if(l){const d=l.get(e);d&&(i?d.reject(i):d.resolve(),l=l.remove(e)),a.Wa[a.currentUser.toKey()]=l}}function FV(n,e,i=null){n.sharedClientState.removeLocalQueryTarget(e);for(const a of n.qa.get(e))n.ka.delete(a),i&&n.La.Ja(a,i);n.qa.delete(e),n.isPrimaryClient&&n.Ka.br(e).forEach(a=>{n.Ka.containsKey(a)||Jie(n,a)})}function Jie(n,e){n.Qa.delete(e.path.canonicalString());const i=n.$a.get(e);i!==null&&(t4(n.remoteStore,i),n.$a=n.$a.remove(e),n.Ua.delete(i),h4(n))}function iJ(n,e,i){for(const a of i)a instanceof Hie?(n.Ka.addReference(a.key,e),U3e(n,a)):a instanceof $ie?(Zt(d4,"Document no longer in limbo: "+a.key),n.Ka.removeReference(a.key,e),n.Ka.containsKey(a.key)||Jie(n,a.key)):jn()}function U3e(n,e){const i=e.key,a=i.path.canonicalString();n.$a.get(i)||n.Qa.has(a)||(Zt(d4,"New document in limbo: "+i),n.Qa.add(a),h4(n))}function h4(n){for(;n.Qa.size>0&&n.$a.size<n.maxConcurrentLimboResolutions;){const e=n.Qa.values().next().value;n.Qa.delete(e);const i=new yn(Li.fromString(e)),a=n.za.next();n.Ua.set(a,new C3e(i)),n.$a=n.$a.insert(i,a),Fie(n.remoteStore,new cg(tf($1(i.path)),a,"TargetPurposeLimboResolution",W1.ae))}}async function _C(n,e,i){const a=qn(n),l=[],d=[],p=[];a.ka.isEmpty()||(a.ka.forEach((y,v)=>{p.push(a.Ha(v,e,i).then(b=>{var w;if((b||i)&&a.isPrimaryClient){const A=b?!b.fromCache:(w=i==null?void 0:i.targetChanges.get(v.targetId))===null||w===void 0?void 0:w.current;a.sharedClientState.updateQueryState(v.targetId,A?"current":"not-current")}if(b){l.push(b);const A=Zj.Yi(v.targetId,b);d.push(A)}}))}),await Promise.all(p),a.La.p_(l),await async function(v,b){const w=qn(v);try{await w.persistence.runTransaction("notifyLocalViewChanges","readwrite",A=>wt.forEach(b,N=>wt.forEach(N.Hi,V=>w.persistence.referenceDelegate.addReference(A,N.targetId,V)).next(()=>wt.forEach(N.Ji,V=>w.persistence.referenceDelegate.removeReference(A,N.targetId,V)))))}catch(A){if(!j0(A))throw A;Zt(e4,"Failed to update sequence numbers: "+A)}for(const A of b){const N=A.targetId;if(!A.fromCache){const V=w.Ts.get(N),j=V.snapshotVersion,B=V.withLastLimboFreeSnapshotVersion(j);w.Ts=w.Ts.insert(N,B)}}}(a.localStore,d))}async function V3e(n,e){const i=qn(n);if(!i.currentUser.isEqual(e)){Zt(d4,"User change. New user:",e.toKey());const a=await xie(i.localStore,e);i.currentUser=e,function(d,p){d.Ga.forEach(y=>{y.forEach(v=>{v.reject(new zt(_t.CANCELLED,p))})}),d.Ga.clear()}(i,"'waitForPendingWrites' promise is rejected due to a user change."),i.sharedClientState.handleUserChange(e,a.removedBatchIds,a.addedBatchIds),await _C(i,a.Rs)}}function F3e(n,e){const i=qn(n),a=i.Ua.get(e);if(a&&a.Ba)return Tr().add(a.key);{let l=Tr();const d=i.qa.get(e);if(!d)return l;for(const p of d){const y=i.ka.get(p);l=l.unionWith(y.view.Sa)}return l}}function Qie(n){const e=qn(n);return e.remoteStore.remoteSyncer.applyRemoteEvent=qie.bind(null,e),e.remoteStore.remoteSyncer.getRemoteKeysForTarget=F3e.bind(null,e),e.remoteStore.remoteSyncer.rejectListen=L3e.bind(null,e),e.La.p_=b3e.bind(null,e.eventManager),e.La.Ja=T3e.bind(null,e.eventManager),e}function j3e(n){const e=qn(n);return e.remoteStore.remoteSyncer.applySuccessfulWrite=x3e.bind(null,e),e.remoteStore.remoteSyncer.rejectFailedWrite=M3e.bind(null,e),e}class Zk{constructor(){this.kind="memory",this.synchronizeTabs=!1}async initialize(e){this.serializer=Q1(e.databaseInfo.databaseId),this.sharedClientState=this.Za(e),this.persistence=this.Xa(e),await this.persistence.start(),this.localStore=this.eu(e),this.gcScheduler=this.tu(e,this.localStore),this.indexBackfillerScheduler=this.nu(e,this.localStore)}tu(e,i){return null}nu(e,i){return null}eu(e){return G4e(this.persistence,new B4e,e.initialUser,this.serializer)}Xa(e){return new Lie(Qj.ri,this.serializer)}Za(e){return new J4e}async terminate(){var e,i;(e=this.gcScheduler)===null||e===void 0||e.stop(),(i=this.indexBackfillerScheduler)===null||i===void 0||i.stop(),this.sharedClientState.shutdown(),await this.persistence.shutdown()}}Zk.provider={build:()=>new Zk};class B3e extends Zk{constructor(e){super(),this.cacheSizeBytes=e}tu(e,i){si(this.persistence.referenceDelegate instanceof Jk);const a=this.persistence.referenceDelegate.garbageCollector;return new C4e(a,e.asyncQueue,i)}Xa(e){const i=this.cacheSizeBytes!==void 0?$c.withCacheSize(this.cacheSizeBytes):$c.DEFAULT;return new Lie(a=>Jk.ri(a,i),this.serializer)}}class jV{async initialize(e,i){this.localStore||(this.localStore=e.localStore,this.sharedClientState=e.sharedClientState,this.datastore=this.createDatastore(i),this.remoteStore=this.createRemoteStore(i),this.eventManager=this.createEventManager(i),this.syncEngine=this.createSyncEngine(i,!e.synchronizeTabs),this.sharedClientState.onlineStateHandler=a=>rJ(this.syncEngine,a,1),this.remoteStore.remoteSyncer.handleCredentialChange=V3e.bind(null,this.syncEngine),await E3e(this.remoteStore,this.syncEngine.isPrimaryClient))}createEventManager(e){return function(){return new S3e}()}createDatastore(e){const i=Q1(e.databaseInfo.databaseId),a=function(d){return new n3e(d)}(e.databaseInfo);return function(d,p,y,v){return new o3e(d,p,y,v)}(e.authCredentials,e.appCheckCredentials,a,i)}createRemoteStore(e){return function(a,l,d,p,y){return new c3e(a,l,d,p,y)}(this.localStore,this.datastore,e.asyncQueue,i=>rJ(this.syncEngine,i,0),function(){return JX.D()?new JX:new Q4e}())}createSyncEngine(e,i){return function(l,d,p,y,v,b,w){const A=new I3e(l,d,p,y,v,b);return w&&(A.ja=!0),A}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,e.initialUser,e.maxConcurrentLimboResolutions,i)}async terminate(){var e,i;await async function(l){const d=qn(l);Zt(Fy,"RemoteStore shutting down."),d.W_.add(5),await gC(d),d.z_.shutdown(),d.j_.set("Unknown")}(this.remoteStore),(e=this.datastore)===null||e===void 0||e.terminate(),(i=this.eventManager)===null||i===void 0||i.terminate()}}jV.provider={build:()=>new jV};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class f4{constructor(e){this.observer=e,this.muted=!1}next(e){this.muted||this.observer.next&&this.iu(this.observer.next,e)}error(e){this.muted||(this.observer.error?this.iu(this.observer.error,e):xp("Uncaught Error in snapshot listener:",e.toString()))}su(){this.muted=!0}iu(e,i){setTimeout(()=>{this.muted||e(i)},0)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Pg="FirestoreClient";class W3e{constructor(e,i,a,l,d){this.authCredentials=e,this.appCheckCredentials=i,this.asyncQueue=a,this.databaseInfo=l,this.user=xa.UNAUTHENTICATED,this.clientId=$re.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this._uninitializedComponentsProvider=d,this.authCredentials.start(a,async p=>{Zt(Pg,"Received user=",p.uid),await this.authCredentialListener(p),this.user=p}),this.appCheckCredentials.start(a,p=>(Zt(Pg,"Received new app check token=",p),this.appCheckCredentialListener(p,this.user)))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(e){this.authCredentialListener=e}setAppCheckTokenChangeListener(e){this.appCheckCredentialListener=e}terminate(){this.asyncQueue.enterRestrictedMode();const e=new Ap;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted(async()=>{try{this._onlineComponents&&await this._onlineComponents.terminate(),this._offlineComponents&&await this._offlineComponents.terminate(),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),e.resolve()}catch(i){const a=o4(i,"Failed to shutdown persistence");e.reject(a)}}),e.promise}}async function rU(n,e){n.asyncQueue.verifyOperationInProgress(),Zt(Pg,"Initializing OfflineComponentProvider");const i=n.configuration;await e.initialize(i);let a=i.initialUser;n.setCredentialChangeListener(async l=>{a.isEqual(l)||(await xie(e.localStore,l),a=l)}),e.persistence.setDatabaseDeletedListener(()=>n.terminate()),n._offlineComponents=e}async function sJ(n,e){n.asyncQueue.verifyOperationInProgress();const i=await z3e(n);Zt(Pg,"Initializing OnlineComponentProvider"),await e.initialize(i,n.configuration),n.setCredentialChangeListener(a=>ZX(e.remoteStore,a)),n.setAppCheckTokenChangeListener((a,l)=>ZX(e.remoteStore,l)),n._onlineComponents=e}async function z3e(n){if(!n._offlineComponents)if(n._uninitializedComponentsProvider){Zt(Pg,"Using user provided OfflineComponentProvider");try{await rU(n,n._uninitializedComponentsProvider._offline)}catch(e){const i=e;if(!function(l){return l.name==="FirebaseError"?l.code===_t.FAILED_PRECONDITION||l.code===_t.UNIMPLEMENTED:!(typeof DOMException<"u"&&l instanceof DOMException)||l.code===22||l.code===20||l.code===11}(i))throw i;g0("Error using user provided cache. Falling back to memory cache: "+i),await rU(n,new Zk)}}else Zt(Pg,"Using default OfflineComponentProvider"),await rU(n,new B3e(void 0));return n._offlineComponents}async function Zie(n){return n._onlineComponents||(n._uninitializedComponentsProvider?(Zt(Pg,"Using user provided OnlineComponentProvider"),await sJ(n,n._uninitializedComponentsProvider._online)):(Zt(Pg,"Using default OnlineComponentProvider"),await sJ(n,new jV))),n._onlineComponents}function G3e(n){return Zie(n).then(e=>e.syncEngine)}async function e1(n){const e=await Zie(n),i=e.eventManager;return i.onListen=A3e.bind(null,e.syncEngine),i.onUnlisten=k3e.bind(null,e.syncEngine),i.onFirstRemoteStoreListen=P3e.bind(null,e.syncEngine),i.onLastRemoteStoreUnlisten=N3e.bind(null,e.syncEngine),i}function H3e(n,e,i={}){const a=new Ap;return n.asyncQueue.enqueueAndForget(async()=>function(d,p,y,v,b){const w=new f4({next:N=>{w.su(),p.enqueueAndForget(()=>c4(d,A));const V=N.docs.has(y);!V&&N.fromCache?b.reject(new zt(_t.UNAVAILABLE,"Failed to get document because the client is offline.")):V&&N.fromCache&&v&&v.source==="server"?b.reject(new zt(_t.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):b.resolve(N)},error:N=>b.reject(N)}),A=new u4($1(y.path),w,{includeMetadataChanges:!0,Ta:!0});return a4(d,A)}(await e1(n),n.asyncQueue,e,i,a)),a.promise}function $3e(n,e,i={}){const a=new Ap;return n.asyncQueue.enqueueAndForget(async()=>function(d,p,y,v,b){const w=new f4({next:N=>{w.su(),p.enqueueAndForget(()=>c4(d,A)),N.fromCache&&v.source==="server"?b.reject(new zt(_t.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):b.resolve(N)},error:N=>b.reject(N)}),A=new u4(y,w,{includeMetadataChanges:!0,Ta:!0});return a4(d,A)}(await e1(n),n.asyncQueue,e,i,a)),a.promise}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ese(n){const e={};return n.timeoutSeconds!==void 0&&(e.timeoutSeconds=n.timeoutSeconds),e}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const oJ=new Map;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function tse(n,e,i){if(!i)throw new zt(_t.INVALID_ARGUMENT,`Function ${n}() cannot be called with an empty ${e}.`)}function K3e(n,e,i,a){if(e===!0&&a===!0)throw new zt(_t.INVALID_ARGUMENT,`${n} and ${i} cannot be used together.`)}function aJ(n){if(!yn.isDocumentKey(n))throw new zt(_t.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${n} has ${n.length}.`)}function cJ(n){if(yn.isDocumentKey(n))throw new zt(_t.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${n} has ${n.length}.`)}function tN(n){if(n===void 0)return"undefined";if(n===null)return"null";if(typeof n=="string")return n.length>20&&(n=`${n.substring(0,20)}...`),JSON.stringify(n);if(typeof n=="number"||typeof n=="boolean")return""+n;if(typeof n=="object"){if(n instanceof Array)return"an array";{const e=function(a){return a.constructor?a.constructor.name:null}(n);return e?`a custom ${e} object`:"an object"}}return typeof n=="function"?"a function":jn()}function Ll(n,e){if("_delegate"in n&&(n=n._delegate),!(n instanceof e)){if(e.name===n.constructor.name)throw new zt(_t.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{const i=tN(n);throw new zt(_t.INVALID_ARGUMENT,`Expected type '${e.name}', but it was: ${i}`)}}return n}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const nse="firestore.googleapis.com",lJ=!0;class uJ{constructor(e){var i,a;if(e.host===void 0){if(e.ssl!==void 0)throw new zt(_t.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host=nse,this.ssl=lJ}else this.host=e.host,this.ssl=(i=e.ssl)!==null&&i!==void 0?i:lJ;if(this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,this.localCache=e.localCache,e.cacheSizeBytes===void 0)this.cacheSizeBytes=Die;else{if(e.cacheSizeBytes!==-1&&e.cacheSizeBytes<w4e)throw new zt(_t.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=e.cacheSizeBytes}K3e("experimentalForceLongPolling",e.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",e.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:e.experimentalAutoDetectLongPolling===void 0?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!e.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=ese((a=e.experimentalLongPollingOptions)!==null&&a!==void 0?a:{}),function(d){if(d.timeoutSeconds!==void 0){if(isNaN(d.timeoutSeconds))throw new zt(_t.INVALID_ARGUMENT,`invalid long polling timeout: ${d.timeoutSeconds} (must not be NaN)`);if(d.timeoutSeconds<5)throw new zt(_t.INVALID_ARGUMENT,`invalid long polling timeout: ${d.timeoutSeconds} (minimum allowed value is 5)`);if(d.timeoutSeconds>30)throw new zt(_t.INVALID_ARGUMENT,`invalid long polling timeout: ${d.timeoutSeconds} (maximum allowed value is 30)`)}}(this.experimentalLongPollingOptions),this.useFetchStreams=!!e.useFetchStreams}isEqual(e){return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&function(a,l){return a.timeoutSeconds===l.timeoutSeconds}(this.experimentalLongPollingOptions,e.experimentalLongPollingOptions)&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}}class nN{constructor(e,i,a,l){this._authCredentials=e,this._appCheckCredentials=i,this._databaseId=a,this._app=l,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new uJ({}),this._settingsFrozen=!1,this._emulatorOptions={},this._terminateTask="notTerminated"}get app(){if(!this._app)throw new zt(_t.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return this._terminateTask!=="notTerminated"}_setSettings(e){if(this._settingsFrozen)throw new zt(_t.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new uJ(e),this._emulatorOptions=e.emulatorOptions||{},e.credentials!==void 0&&(this._authCredentials=function(a){if(!a)return new tje;switch(a.type){case"firstParty":return new sje(a.sessionIndex||"0",a.iamToken||null,a.authTokenFactory||null);case"provider":return a.client;default:throw new zt(_t.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(e.credentials))}_getSettings(){return this._settings}_getEmulatorOptions(){return this._emulatorOptions}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask==="notTerminated"&&(this._terminateTask=this._terminate()),this._terminateTask}async _restart(){this._terminateTask==="notTerminated"?await this._terminate():this._terminateTask="notTerminated"}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return function(i){const a=oJ.get(i);a&&(Zt("ComponentProvider","Removing Datastore"),oJ.delete(i),a.terminate())}(this),Promise.resolve()}}function q3e(n,e,i,a={}){var l;const d=(n=Ll(n,nN))._getSettings(),p=Object.assign(Object.assign({},d),{emulatorOptions:n._getEmulatorOptions()}),y=`${e}:${i}`;d.host!==nse&&d.host!==y&&g0("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used.");const v=Object.assign(Object.assign({},d),{host:y,ssl:!1,emulatorOptions:a});if(!Np(v,p)&&(n._setSettings(v),a.mockUserToken)){let b,w;if(typeof a.mockUserToken=="string")b=a.mockUserToken,w=xa.MOCK_USER;else{b=Yne(a.mockUserToken,(l=n._app)===null||l===void 0?void 0:l.options.projectId);const A=a.mockUserToken.sub||a.mockUserToken.user_id;if(!A)throw new zt(_t.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");w=new xa(A)}n._authCredentials=new nje(new Gre(b,w))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Fp{constructor(e,i,a){this.converter=i,this._query=a,this.type="query",this.firestore=e}withConverter(e){return new Fp(this.firestore,e,this._query)}}class Fa{constructor(e,i,a){this.converter=i,this._key=a,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new gg(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new Fa(this.firestore,e,this._key)}}class gg extends Fp{constructor(e,i,a){super(e,i,$1(a)),this._path=a,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){const e=this._path.popLast();return e.isEmpty()?null:new Fa(this.firestore,null,new yn(e))}withConverter(e){return new gg(this.firestore,e,this._path)}}function jy(n,e,...i){if(n=xi(n),tse("collection","path",e),n instanceof nN){const a=Li.fromString(e,...i);return cJ(a),new gg(n,null,a)}{if(!(n instanceof Fa||n instanceof gg))throw new zt(_t.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const a=n._path.child(Li.fromString(e,...i));return cJ(a),new gg(n.firestore,null,a)}}function Mi(n,e,...i){if(n=xi(n),arguments.length===1&&(e=$re.newId()),tse("doc","path",e),n instanceof nN){const a=Li.fromString(e,...i);return aJ(a),new Fa(n,null,new yn(a))}{if(!(n instanceof Fa||n instanceof gg))throw new zt(_t.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const a=n._path.child(Li.fromString(e,...i));return aJ(a),new Fa(n.firestore,n instanceof gg?n.converter:null,new yn(a))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const dJ="AsyncQueue";class hJ{constructor(e=Promise.resolve()){this.Vu=[],this.mu=!1,this.fu=[],this.gu=null,this.pu=!1,this.yu=!1,this.wu=[],this.a_=new Uie(this,"async_queue_retry"),this.Su=()=>{const a=nU();a&&Zt(dJ,"Visibility state changed to "+a.visibilityState),this.a_.t_()},this.bu=e;const i=nU();i&&typeof i.addEventListener=="function"&&i.addEventListener("visibilitychange",this.Su)}get isShuttingDown(){return this.mu}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.Du(),this.vu(e)}enterRestrictedMode(e){if(!this.mu){this.mu=!0,this.yu=e||!1;const i=nU();i&&typeof i.removeEventListener=="function"&&i.removeEventListener("visibilitychange",this.Su)}}enqueue(e){if(this.Du(),this.mu)return new Promise(()=>{});const i=new Ap;return this.vu(()=>this.mu&&this.yu?Promise.resolve():(e().then(i.resolve,i.reject),i.promise)).then(()=>i.promise)}enqueueRetryable(e){this.enqueueAndForget(()=>(this.Vu.push(e),this.Cu()))}async Cu(){if(this.Vu.length!==0){try{await this.Vu[0](),this.Vu.shift(),this.a_.reset()}catch(e){if(!j0(e))throw e;Zt(dJ,"Operation failed with retryable error: "+e)}this.Vu.length>0&&this.a_.Xo(()=>this.Cu())}}vu(e){const i=this.bu.then(()=>(this.pu=!0,e().catch(a=>{this.gu=a,this.pu=!1;const l=function(p){let y=p.message||"";return p.stack&&(y=p.stack.includes(p.message)?p.stack:p.message+`
`+p.stack),y}(a);throw xp("INTERNAL UNHANDLED ERROR: ",l),a}).then(a=>(this.pu=!1,a))));return this.bu=i,i}enqueueAfterDelay(e,i,a){this.Du(),this.wu.indexOf(e)>-1&&(i=0);const l=s4.createAndSchedule(this,e,i,a,d=>this.Fu(d));return this.fu.push(l),l}Du(){this.gu&&jn()}verifyOperationInProgress(){}async Mu(){let e;do e=this.bu,await e;while(e!==this.bu)}xu(e){for(const i of this.fu)if(i.timerId===e)return!0;return!1}Ou(e){return this.Mu().then(()=>{this.fu.sort((i,a)=>i.targetTimeMs-a.targetTimeMs);for(const i of this.fu)if(i.skipDelay(),e!=="all"&&i.timerId===e)break;return this.Mu()})}Nu(e){this.wu.push(e)}Fu(e){const i=this.fu.indexOf(e);this.fu.splice(i,1)}}function fJ(n){return function(i,a){if(typeof i!="object"||i===null)return!1;const l=i;for(const d of a)if(d in l&&typeof l[d]=="function")return!0;return!1}(n,["next","error","complete"])}class Og extends nN{constructor(e,i,a,l){super(e,i,a,l),this.type="firestore",this._queue=new hJ,this._persistenceKey=(l==null?void 0:l.name)||"[DEFAULT]"}async _terminate(){if(this._firestoreClient){const e=this._firestoreClient.terminate();this._queue=new hJ(e),this._firestoreClient=void 0,await e}}}function BV(n,e){const i=typeof n=="object"?n:Nj(),a=typeof n=="string"?n:Hk,l=V1(i,"firestore").getImmediate({identifier:a});if(!l._initialized){const d=$ne("firestore");d&&q3e(l,...d)}return l}function rN(n){if(n._terminated)throw new zt(_t.FAILED_PRECONDITION,"The client has already been terminated.");return n._firestoreClient||Y3e(n),n._firestoreClient}function Y3e(n){var e,i,a;const l=n._freezeSettings(),d=function(y,v,b,w){return new vje(y,v,b,w.host,w.ssl,w.experimentalForceLongPolling,w.experimentalAutoDetectLongPolling,ese(w.experimentalLongPollingOptions),w.useFetchStreams)}(n._databaseId,((e=n._app)===null||e===void 0?void 0:e.options.appId)||"",n._persistenceKey,l);n._componentsProvider||!((i=l.localCache)===null||i===void 0)&&i._offlineComponentProvider&&(!((a=l.localCache)===null||a===void 0)&&a._onlineComponentProvider)&&(n._componentsProvider={_offline:l.localCache._offlineComponentProvider,_online:l.localCache._onlineComponentProvider}),n._firestoreClient=new W3e(n._authCredentials,n._appCheckCredentials,n._queue,d,n._componentsProvider&&function(y){const v=y==null?void 0:y._online.build();return{_offline:y==null?void 0:y._offline.build(v),_online:v}}(n._componentsProvider))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class R0{constructor(e){this._byteString=e}static fromBase64String(e){try{return new R0(aa.fromBase64String(e))}catch(i){throw new zt(_t.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+i)}}static fromUint8Array(e){return new R0(aa.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class iN{constructor(...e){for(let i=0;i<e.length;++i)if(e[i].length===0)throw new zt(_t.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new na(e)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class yC{constructor(e){this._methodName=e}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class p4{constructor(e,i){if(!isFinite(e)||e<-90||e>90)throw new zt(_t.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(i)||i<-180||i>180)throw new zt(_t.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+i);this._lat=e,this._long=i}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}toJSON(){return{latitude:this._lat,longitude:this._long}}_compareTo(e){return ur(this._lat,e._lat)||ur(this._long,e._long)}}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class m4{constructor(e){this._values=(e||[]).map(i=>i)}toArray(){return this._values.map(e=>e)}isEqual(e){return function(a,l){if(a.length!==l.length)return!1;for(let d=0;d<a.length;++d)if(a[d]!==l[d])return!1;return!0}(this._values,e._values)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const X3e=/^__.*__$/;class J3e{constructor(e,i,a){this.data=e,this.fieldMask=i,this.fieldTransforms=a}toMutation(e,i){return this.fieldMask!==null?new Mg(e,this.data,this.fieldMask,i,this.fieldTransforms):new pC(e,this.data,i,this.fieldTransforms)}}class rse{constructor(e,i,a){this.data=e,this.fieldMask=i,this.fieldTransforms=a}toMutation(e,i){return new Mg(e,this.data,this.fieldMask,i,this.fieldTransforms)}}function ise(n){switch(n){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw jn()}}class sN{constructor(e,i,a,l,d,p){this.settings=e,this.databaseId=i,this.serializer=a,this.ignoreUndefinedProperties=l,d===void 0&&this.Bu(),this.fieldTransforms=d||[],this.fieldMask=p||[]}get path(){return this.settings.path}get Lu(){return this.settings.Lu}ku(e){return new sN(Object.assign(Object.assign({},this.settings),e),this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}qu(e){var i;const a=(i=this.path)===null||i===void 0?void 0:i.child(e),l=this.ku({path:a,Qu:!1});return l.$u(e),l}Uu(e){var i;const a=(i=this.path)===null||i===void 0?void 0:i.child(e),l=this.ku({path:a,Qu:!1});return l.Bu(),l}Ku(e){return this.ku({path:void 0,Qu:!0})}Wu(e){return t1(e,this.settings.methodName,this.settings.Gu||!1,this.path,this.settings.zu)}contains(e){return this.fieldMask.find(i=>e.isPrefixOf(i))!==void 0||this.fieldTransforms.find(i=>e.isPrefixOf(i.field))!==void 0}Bu(){if(this.path)for(let e=0;e<this.path.length;e++)this.$u(this.path.get(e))}$u(e){if(e.length===0)throw this.Wu("Document fields must not be empty");if(ise(this.Lu)&&X3e.test(e))throw this.Wu('Document fields cannot begin and end with "__"')}}class Q3e{constructor(e,i,a){this.databaseId=e,this.ignoreUndefinedProperties=i,this.serializer=a||Q1(e)}ju(e,i,a,l=!1){return new sN({Lu:e,methodName:i,zu:a,path:na.emptyPath(),Qu:!1,Gu:l},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}}function EC(n){const e=n._freezeSettings(),i=Q1(n._databaseId);return new Q3e(n._databaseId,!!e.ignoreUndefinedProperties,i)}function sse(n,e,i,a,l,d={}){const p=n.ju(d.merge||d.mergeFields?2:0,e,i,l);y4("Data must be an object, but it was:",p,a);const y=cse(a,p);let v,b;if(d.merge)v=new Pl(p.fieldMask),b=p.fieldTransforms;else if(d.mergeFields){const w=[];for(const A of d.mergeFields){const N=WV(e,A,i);if(!p.contains(N))throw new zt(_t.INVALID_ARGUMENT,`Field '${N}' is specified in your field mask but missing from your input data.`);use(w,N)||w.push(N)}v=new Pl(w),b=p.fieldTransforms.filter(A=>v.covers(A.field))}else v=null,b=p.fieldTransforms;return new J3e(new Yc(y),v,b)}class oN extends yC{_toFieldTransform(e){if(e.Lu!==2)throw e.Lu===1?e.Wu(`${this._methodName}() can only appear at the top level of your update data`):e.Wu(`${this._methodName}() cannot be used with set() unless you pass {merge:true}`);return e.fieldMask.push(e.path),null}isEqual(e){return e instanceof oN}}function ose(n,e,i){return new sN({Lu:3,zu:e.settings.zu,methodName:n._methodName,Qu:i},e.databaseId,e.serializer,e.ignoreUndefinedProperties)}class g4 extends yC{constructor(e,i){super(e),this.Hu=i}_toFieldTransform(e){const i=ose(this,e,!0),a=this.Hu.map(d=>qy(d,i)),l=new S0(a);return new Eie(e.path,l)}isEqual(e){return e instanceof g4&&Np(this.Hu,e.Hu)}}class _4 extends yC{constructor(e,i){super(e),this.Hu=i}_toFieldTransform(e){const i=ose(this,e,!0),a=this.Hu.map(d=>qy(d,i)),l=new b0(a);return new Eie(e.path,l)}isEqual(e){return e instanceof _4&&Np(this.Hu,e.Hu)}}function Z3e(n,e,i,a){const l=n.ju(1,e,i);y4("Data must be an object, but it was:",l,a);const d=[],p=Yc.empty();xg(a,(v,b)=>{const w=E4(e,v,i);b=xi(b);const A=l.Uu(w);if(b instanceof oN)d.push(w);else{const N=qy(b,A);N!=null&&(d.push(w),p.set(w,N))}});const y=new Pl(d);return new rse(p,y,l.fieldTransforms)}function e5e(n,e,i,a,l,d){const p=n.ju(1,e,i),y=[WV(e,a,i)],v=[l];if(d.length%2!=0)throw new zt(_t.INVALID_ARGUMENT,`Function ${e}() needs to be called with an even number of arguments that alternate between field names and values.`);for(let N=0;N<d.length;N+=2)y.push(WV(e,d[N])),v.push(d[N+1]);const b=[],w=Yc.empty();for(let N=y.length-1;N>=0;--N)if(!use(b,y[N])){const V=y[N];let j=v[N];j=xi(j);const B=p.Uu(V);if(j instanceof oN)b.push(V);else{const G=qy(j,B);G!=null&&(b.push(V),w.set(V,G))}}const A=new Pl(b);return new rse(w,A,p.fieldTransforms)}function ase(n,e,i,a=!1){return qy(i,n.ju(a?4:3,e))}function qy(n,e){if(lse(n=xi(n)))return y4("Unsupported field value:",e,n),cse(n,e);if(n instanceof yC)return function(a,l){if(!ise(l.Lu))throw l.Wu(`${a._methodName}() can only be used with update() and set()`);if(!l.path)throw l.Wu(`${a._methodName}() is not currently supported inside arrays`);const d=a._toFieldTransform(l);d&&l.fieldTransforms.push(d)}(n,e),null;if(n===void 0&&e.ignoreUndefinedProperties)return null;if(e.path&&e.fieldMask.push(e.path),n instanceof Array){if(e.settings.Qu&&e.Lu!==4)throw e.Wu("Nested arrays are not supported");return function(a,l){const d=[];let p=0;for(const y of a){let v=qy(y,l.Ku(p));v==null&&(v={nullValue:"NULL_VALUE"}),d.push(v),p++}return{arrayValue:{values:d}}}(n,e)}return function(a,l){if((a=xi(a))===null)return{nullValue:"NULL_VALUE"};if(typeof a=="number")return zje(l.serializer,a);if(typeof a=="boolean")return{booleanValue:a};if(typeof a=="string")return{stringValue:a};if(a instanceof Date){const d=ao.fromDate(a);return{timestampValue:Xk(l.serializer,d)}}if(a instanceof ao){const d=new ao(a.seconds,1e3*Math.floor(a.nanoseconds/1e3));return{timestampValue:Xk(l.serializer,d)}}if(a instanceof p4)return{geoPointValue:{latitude:a.latitude,longitude:a.longitude}};if(a instanceof R0)return{bytesValue:Cie(l.serializer,a._byteString)};if(a instanceof Fa){const d=l.databaseId,p=a.firestore._databaseId;if(!p.isEqual(d))throw l.Wu(`Document reference is for database ${p.projectId}/${p.database} but should be for database ${d.projectId}/${d.database}`);return{referenceValue:Xj(a.firestore._databaseId||l.databaseId,a._key.path)}}if(a instanceof m4)return function(p,y){return{mapValue:{fields:{[eie]:{stringValue:tie},[$k]:{arrayValue:{values:p.toArray().map(b=>{if(typeof b!="number")throw y.Wu("VectorValues must only contain numeric values.");return Kj(y.serializer,b)})}}}}}}(a,l);throw l.Wu(`Unsupported field value: ${tN(a)}`)}(n,e)}function cse(n,e){const i={};return qre(n)?e.path&&e.path.length>0&&e.fieldMask.push(e.path):xg(n,(a,l)=>{const d=qy(l,e.qu(a));d!=null&&(i[a]=d)}),{mapValue:{fields:i}}}function lse(n){return!(typeof n!="object"||n===null||n instanceof Array||n instanceof Date||n instanceof ao||n instanceof p4||n instanceof R0||n instanceof Fa||n instanceof yC||n instanceof m4)}function y4(n,e,i){if(!lse(i)||!function(l){return typeof l=="object"&&l!==null&&(Object.getPrototypeOf(l)===Object.prototype||Object.getPrototypeOf(l)===null)}(i)){const a=tN(i);throw a==="an object"?e.Wu(n+" a custom object"):e.Wu(n+" "+a)}}function WV(n,e,i){if((e=xi(e))instanceof iN)return e._internalPath;if(typeof e=="string")return E4(n,e);throw t1("Field path arguments must be of type string or ",n,!1,void 0,i)}const t5e=new RegExp("[~\\*/\\[\\]]");function E4(n,e,i){if(e.search(t5e)>=0)throw t1(`Invalid field path (${e}). Paths must not contain '~', '*', '/', '[', or ']'`,n,!1,void 0,i);try{return new iN(...e.split("."))._internalPath}catch{throw t1(`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,n,!1,void 0,i)}}function t1(n,e,i,a,l){const d=a&&!a.isEmpty(),p=l!==void 0;let y=`Function ${e}() called with invalid data`;i&&(y+=" (via `toFirestore()`)"),y+=". ";let v="";return(d||p)&&(v+=" (found",d&&(v+=` in field ${a}`),p&&(v+=` in document ${l}`),v+=")"),new zt(_t.INVALID_ARGUMENT,y+n+v)}function use(n,e){return n.some(i=>i.isEqual(e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class v4{constructor(e,i,a,l,d){this._firestore=e,this._userDataWriter=i,this._key=a,this._document=l,this._converter=d}get id(){return this._key.path.lastSegment()}get ref(){return new Fa(this._firestore,this._converter,this._key)}exists(){return this._document!==null}data(){if(this._document){if(this._converter){const e=new n5e(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}return this._userDataWriter.convertValue(this._document.data.value)}}get(e){if(this._document){const i=this._document.data.field(aN("DocumentSnapshot.get",e));if(i!==null)return this._userDataWriter.convertValue(i)}}}class n5e extends v4{data(){return super.data()}}function aN(n,e){return typeof e=="string"?E4(n,e):e instanceof iN?e._internalPath:e._delegate._internalPath}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function dse(n){if(n.limitType==="L"&&n.explicitOrderBy.length===0)throw new zt(_t.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}class S4{}class b4 extends S4{}function zV(n,e,...i){let a=[];e instanceof S4&&a.push(e),a=a.concat(i),function(d){const p=d.filter(v=>v instanceof T4).length,y=d.filter(v=>v instanceof cN).length;if(p>1||p>0&&y>0)throw new zt(_t.INVALID_ARGUMENT,"InvalidQuery. When using composite filters, you cannot use more than one filter at the top level. Consider nesting the multiple filters within an `and(...)` statement. For example: change `query(query, where(...), or(...))` to `query(query, and(where(...), or(...)))`.")}(a);for(const l of a)n=l._apply(n);return n}class cN extends b4{constructor(e,i,a){super(),this._field=e,this._op=i,this._value=a,this.type="where"}static _create(e,i,a){return new cN(e,i,a)}_apply(e){const i=this._parse(e);return hse(e._query,i),new Fp(e.firestore,e.converter,OV(e._query,i))}_parse(e){const i=EC(e.firestore);return function(d,p,y,v,b,w,A){let N;if(b.isKeyField()){if(w==="array-contains"||w==="array-contains-any")throw new zt(_t.INVALID_ARGUMENT,`Invalid Query. You can't perform '${w}' queries on documentId().`);if(w==="in"||w==="not-in"){gJ(A,w);const j=[];for(const B of A)j.push(mJ(v,d,B));N={arrayValue:{values:j}}}else N=mJ(v,d,A)}else w!=="in"&&w!=="not-in"&&w!=="array-contains-any"||gJ(A,w),N=ase(y,p,A,w==="in"||w==="not-in");return Ys.create(b,w,N)}(e._query,"where",i,e.firestore._databaseId,this._field,this._op,this._value)}}function pJ(n,e,i){const a=e,l=aN("where",n);return cN._create(l,a,i)}class T4 extends S4{constructor(e,i){super(),this.type=e,this._queryConstraints=i}static _create(e,i){return new T4(e,i)}_parse(e){const i=this._queryConstraints.map(a=>a._parse(e)).filter(a=>a.getFilters().length>0);return i.length===1?i[0]:Md.create(i,this._getOperator())}_apply(e){const i=this._parse(e);return i.getFilters().length===0?e:(function(l,d){let p=l;const y=d.getFlattenedFilters();for(const v of y)hse(p,v),p=OV(p,v)}(e._query,i),new Fp(e.firestore,e.converter,OV(e._query,i)))}_getQueryConstraints(){return this._queryConstraints}_getOperator(){return this.type==="and"?"and":"or"}}class w4 extends b4{constructor(e,i){super(),this._field=e,this._direction=i,this.type="orderBy"}static _create(e,i){return new w4(e,i)}_apply(e){const i=function(l,d,p){if(l.startAt!==null)throw new zt(_t.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(l.endAt!==null)throw new zt(_t.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");return new VR(d,p)}(e._query,this._field,this._direction);return new Fp(e.firestore,e.converter,function(l,d){const p=l.explicitOrderBy.concat([d]);return new Hy(l.path,l.collectionGroup,p,l.filters.slice(),l.limit,l.limitType,l.startAt,l.endAt)}(e._query,i))}}function r5e(n,e="asc"){const i=e,a=aN("orderBy",n);return w4._create(a,i)}class R4 extends b4{constructor(e,i,a){super(),this.type=e,this._docOrFields=i,this._inclusive=a}static _create(e,i,a){return new R4(e,i,a)}_apply(e){const i=s5e(e,this.type,this._docOrFields,this._inclusive);return new Fp(e.firestore,e.converter,function(l,d){return new Hy(l.path,l.collectionGroup,l.explicitOrderBy.slice(),l.filters.slice(),l.limit,l.limitType,d,l.endAt)}(e._query,i))}}function i5e(...n){return R4._create("startAt",n,!0)}function s5e(n,e,i,a){if(i[0]=xi(i[0]),i[0]instanceof v4)return function(d,p,y,v,b){if(!v)throw new zt(_t.NOT_FOUND,`Can't use a DocumentSnapshot that doesn't exist for ${y}().`);const w=[];for(const A of e0(d))if(A.field.isKeyField())w.push(Kk(p,v.key));else{const N=v.data.field(A.field);if(G1(N))throw new zt(_t.INVALID_ARGUMENT,'Invalid query. You are trying to start or end a query using a document for which the field "'+A.field+'" is an uncommitted server timestamp. (Since the value of this field is unknown, you cannot start/end a query with it.)');if(N===null){const V=A.field.canonicalString();throw new zt(_t.INVALID_ARGUMENT,`Invalid query. You are trying to start or end a query using a document for which the field '${V}' (used as the orderBy) does not exist.`)}w.push(N)}return new v0(w,b)}(n._query,n.firestore._databaseId,e,i[0]._document,a);{const l=EC(n.firestore);return function(p,y,v,b,w,A){const N=p.explicitOrderBy;if(w.length>N.length)throw new zt(_t.INVALID_ARGUMENT,`Too many arguments provided to ${b}(). The number of arguments must be less than or equal to the number of orderBy() clauses`);const V=[];for(let j=0;j<w.length;j++){const B=w[j];if(N[j].field.isKeyField()){if(typeof B!="string")throw new zt(_t.INVALID_ARGUMENT,`Invalid query. Expected a string for document ID in ${b}(), but got a ${typeof B}`);if(!$j(p)&&B.indexOf("/")!==-1)throw new zt(_t.INVALID_ARGUMENT,`Invalid query. When querying a collection and ordering by documentId(), the value passed to ${b}() must be a plain document ID, but '${B}' contains a slash.`);const G=p.path.child(Li.fromString(B));if(!yn.isDocumentKey(G))throw new zt(_t.INVALID_ARGUMENT,`Invalid query. When querying a collection group and ordering by documentId(), the value passed to ${b}() must result in a valid document path, but '${G}' is not because it contains an odd number of segments.`);const ee=new yn(G);V.push(Kk(y,ee))}else{const G=ase(v,b,B);V.push(G)}}return new v0(V,A)}(n._query,n.firestore._databaseId,l,e,i,a)}}function mJ(n,e,i){if(typeof(i=xi(i))=="string"){if(i==="")throw new zt(_t.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!$j(e)&&i.indexOf("/")!==-1)throw new zt(_t.INVALID_ARGUMENT,`Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '${i}' contains a '/' character.`);const a=e.path.child(Li.fromString(i));if(!yn.isDocumentKey(a))throw new zt(_t.INVALID_ARGUMENT,`Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '${a}' is not because it has an odd number of segments (${a.length}).`);return Kk(n,new yn(a))}if(i instanceof Fa)return Kk(n,i._key);throw new zt(_t.INVALID_ARGUMENT,`Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ${tN(i)}.`)}function gJ(n,e){if(!Array.isArray(n)||n.length===0)throw new zt(_t.INVALID_ARGUMENT,`Invalid Query. A non-empty array is required for '${e.toString()}' filters.`)}function hse(n,e){const i=function(l,d){for(const p of l)for(const y of p.getFlattenedFilters())if(d.indexOf(y.op)>=0)return y.op;return null}(n.filters,function(l){switch(l){case"!=":return["!=","not-in"];case"array-contains-any":case"in":return["not-in"];case"not-in":return["array-contains-any","in","not-in","!="];default:return[]}}(e.op));if(i!==null)throw i===e.op?new zt(_t.INVALID_ARGUMENT,`Invalid query. You cannot use more than one '${e.op.toString()}' filter.`):new zt(_t.INVALID_ARGUMENT,`Invalid query. You cannot use '${e.op.toString()}' filters with '${i.toString()}' filters.`)}class o5e{convertValue(e,i="none"){switch(Ig(e)){case 0:return null;case 1:return e.booleanValue;case 2:return Us(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,i);case 5:return e.stringValue;case 6:return this.convertBytes(Cg(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,i);case 11:return this.convertObject(e.mapValue,i);case 10:return this.convertVectorValue(e.mapValue);default:throw jn()}}convertObject(e,i){return this.convertObjectMap(e.fields,i)}convertObjectMap(e,i="none"){const a={};return xg(e,(l,d)=>{a[l]=this.convertValue(d,i)}),a}convertVectorValue(e){var i,a,l;const d=(l=(a=(i=e.fields)===null||i===void 0?void 0:i[$k].arrayValue)===null||a===void 0?void 0:a.values)===null||l===void 0?void 0:l.map(p=>Us(p.doubleValue));return new m4(d)}convertGeoPoint(e){return new p4(Us(e.latitude),Us(e.longitude))}convertArray(e,i){return(e.values||[]).map(a=>this.convertValue(a,i))}convertServerTimestamp(e,i){switch(i){case"previous":const a=H1(e);return a==null?null:this.convertValue(a,i);case"estimate":return this.convertTimestamp(xR(e));default:return null}}convertTimestamp(e){const i=Rg(e);return new ao(i.seconds,i.nanos)}convertDocumentKey(e,i){const a=Li.fromString(e);si(Nie(a));const l=new MR(a.get(1),a.get(3)),d=new yn(a.popFirst(5));return l.isEqual(i)||xp(`Document ${d} contains a document reference within a different database (${l.projectId}/${l.database}) which is not supported. It will be treated as a reference in the current database (${i.projectId}/${i.database}) instead.`),d}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function fse(n,e,i){let a;return a=n?i&&(i.merge||i.mergeFields)?n.toFirestore(e,i):n.toFirestore(e):e,a}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ww{constructor(e,i){this.hasPendingWrites=e,this.fromCache=i}isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}}class pse extends v4{constructor(e,i,a,l,d,p){super(e,i,a,l,p),this._firestore=e,this._firestoreImpl=e,this.metadata=d}exists(){return super.exists()}data(e={}){if(this._document){if(this._converter){const i=new mk(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(i,e)}return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps)}}get(e,i={}){if(this._document){const a=this._document.data.field(aN("DocumentSnapshot.get",e));if(a!==null)return this._userDataWriter.convertValue(a,i.serverTimestamps)}}}class mk extends pse{data(e={}){return super.data(e)}}class mse{constructor(e,i,a,l){this._firestore=e,this._userDataWriter=i,this._snapshot=l,this.metadata=new Ww(l.hasPendingWrites,l.fromCache),this.query=a}get docs(){const e=[];return this.forEach(i=>e.push(i)),e}get size(){return this._snapshot.docs.size}get empty(){return this.size===0}forEach(e,i){this._snapshot.docs.forEach(a=>{e.call(i,new mk(this._firestore,this._userDataWriter,a.key,a,new Ww(this._snapshot.mutatedKeys.has(a.key),this._snapshot.fromCache),this.query.converter))})}docChanges(e={}){const i=!!e.includeMetadataChanges;if(i&&this._snapshot.excludesMetadataChanges)throw new zt(_t.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===i||(this._cachedChanges=function(l,d){if(l._snapshot.oldDocs.isEmpty()){let p=0;return l._snapshot.docChanges.map(y=>{const v=new mk(l._firestore,l._userDataWriter,y.doc.key,y.doc,new Ww(l._snapshot.mutatedKeys.has(y.doc.key),l._snapshot.fromCache),l.query.converter);return y.doc,{type:"added",doc:v,oldIndex:-1,newIndex:p++}})}{let p=l._snapshot.oldDocs;return l._snapshot.docChanges.filter(y=>d||y.type!==3).map(y=>{const v=new mk(l._firestore,l._userDataWriter,y.doc.key,y.doc,new Ww(l._snapshot.mutatedKeys.has(y.doc.key),l._snapshot.fromCache),l.query.converter);let b=-1,w=-1;return y.type!==0&&(b=p.indexOf(y.doc.key),p=p.delete(y.doc.key)),y.type!==1&&(p=p.add(y.doc),w=p.indexOf(y.doc.key)),{type:a5e(y.type),doc:v,oldIndex:b,newIndex:w}})}}(this,i),this._cachedChangesIncludeMetadataChanges=i),this._cachedChanges}}function a5e(n){switch(n){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return jn()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Lu(n){n=Ll(n,Fa);const e=Ll(n.firestore,Og);return H3e(rN(e),n._key).then(i=>_se(e,n,i))}class C4 extends o5e{constructor(e){super(),this.firestore=e}convertBytes(e){return new R0(e)}convertReference(e){const i=this.convertDocumentKey(e,this.firestore._databaseId);return new Fa(this.firestore,null,i)}}function FR(n){n=Ll(n,Fp);const e=Ll(n.firestore,Og),i=rN(e),a=new C4(e);return dse(n._query),$3e(i,n._query).then(l=>new mse(e,a,n,l))}function n1(n,e,i){n=Ll(n,Fa);const a=Ll(n.firestore,Og),l=fse(n.converter,e,i);return I4(a,[sse(EC(a),"setDoc",n._key,l,n.converter!==null,i).toMutation(n._key,Ld.none())])}function nl(n,e,i,...a){n=Ll(n,Fa);const l=Ll(n.firestore,Og),d=EC(l);let p;return p=typeof(e=xi(e))=="string"||e instanceof iN?e5e(d,"updateDoc",n._key,e,i,a):Z3e(d,"updateDoc",n._key,e),I4(l,[p.toMutation(n._key,Ld.exists(!0))])}function c5e(n,e){const i=Ll(n.firestore,Og),a=Mi(n),l=fse(n.converter,e);return I4(i,[sse(EC(n.firestore),"addDoc",a._key,l,n.converter!==null,{}).toMutation(a._key,Ld.exists(!1))]).then(()=>a)}function gse(n,...e){var i,a,l;n=xi(n);let d={includeMetadataChanges:!1,source:"default"},p=0;typeof e[p]!="object"||fJ(e[p])||(d=e[p],p++);const y={includeMetadataChanges:d.includeMetadataChanges,source:d.source};if(fJ(e[p])){const A=e[p];e[p]=(i=A.next)===null||i===void 0?void 0:i.bind(A),e[p+1]=(a=A.error)===null||a===void 0?void 0:a.bind(A),e[p+2]=(l=A.complete)===null||l===void 0?void 0:l.bind(A)}let v,b,w;if(n instanceof Fa)b=Ll(n.firestore,Og),w=$1(n._key.path),v={next:A=>{e[p]&&e[p](_se(b,n,A))},error:e[p+1],complete:e[p+2]};else{const A=Ll(n,Fp);b=Ll(A.firestore,Og),w=A._query;const N=new C4(b);v={next:V=>{e[p]&&e[p](new mse(b,N,A,V))},error:e[p+1],complete:e[p+2]},dse(n._query)}return function(N,V,j,B){const G=new f4(B),ee=new u4(V,G,j);return N.asyncQueue.enqueueAndForget(async()=>a4(await e1(N),ee)),()=>{G.su(),N.asyncQueue.enqueueAndForget(async()=>c4(await e1(N),ee))}}(rN(b),w,y,v)}function I4(n,e){return function(a,l){const d=new Ap;return a.asyncQueue.enqueueAndForget(async()=>D3e(await G3e(a),l,d)),d.promise}(rN(n),e)}function _se(n,e,i){const a=i.docs.get(e._key),l=new C4(n);return new pse(n,l,e._key,a,new Ww(i.hasPendingWrites,i.fromCache),e.converter)}function l5e(...n){return new g4("arrayUnion",n)}function u5e(...n){return new _4("arrayRemove",n)}(function(e,i=!0){(function(l){V0=l})(Gy),xy(new Tg("firestore",(a,{instanceIdentifier:l,options:d})=>{const p=a.getProvider("app").getImmediate(),y=new Og(new rje(a.getProvider("auth-internal")),new oje(p,a.getProvider("app-check-internal")),function(b,w){if(!Object.prototype.hasOwnProperty.apply(b.options,["projectId"]))throw new zt(_t.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new MR(b.options.projectId,w)}(p,l),p);return d=Object.assign({useFetchStreams:i},d),y._setSettings(d),y},"PUBLIC").setMultipleInstances(!0)),Qh(yX,EX,e),Qh(yX,EX,"esm2017")})();var d5e="firebase",h5e="11.5.0";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */Qh(d5e,h5e,"app");const f5e={BASE_URL:"./",DEV:!1,MODE:"production",PROD:!0,SSR:!1,VITE_AGORA_APP_ID:"a2a7f4eb05284449b1063eb71d8301dc"};console.log("Environment variables check:");console.log("VITE_FIREBASE_API_KEY exists:",!1);console.log("import.meta.env:",f5e);const Zm={apiKey:"AIzaSyCaxoNKRIMaXhotGzdAjXc5gkARoqtS3bU",authDomain:"disruptive-metaverse.firebaseapp.com",projectId:"disruptive-metaverse",storageBucket:"disruptive-metaverse.appspot.com",messagingSenderId:"294433070603",appId:"1:294433070603:web:136cddd196eea9614fb10e"};console.log("Firebase config being used:",{apiKey:Zm.apiKey?`${Zm.apiKey.substring(0,5)}...`:"missing",authDomain:Zm.authDomain,projectId:Zm.projectId,storageBucket:Zm.storageBucket,messagingSenderId:Zm.messagingSenderId?"present":"missing",appId:Zm.appId?"present":"missing"});const yse=Qne(Zm),Ese=Ure(yse),gi=BV(yse),af=async n=>{try{_e.log("userFirestore: Get user Profile data for user ID: "+n);const e=Mi(gi,"users",n),i=await Lu(e);return i.exists()?(_e.log("userFirestore: Found Profile for : "+i.data().Nickname),i.data()):(_e.error("userFirestore: user profile document not found"),null)}catch(e){throw _e.error("userFirestore: Error fetching user profile data:",e),e}},p5e=async(n,e,i)=>{try{_e.log("userFirestore: Registering new user with email:",n);const l=(await VVe(Ese,n,e)).user;await bV(l),_e.log("userFirestore: Verification email sent to:",n);const d={email:l.email,createdAt:new Date,groups:["users"],emailVerified:!1,...i};_e.log("userFirestore: Creating user document with data:",d);const p=Mi(gi,"users",l.uid);return await n1(p,d),_e.log("userFirestore: User created successfully with groups:",d.groups),{...l,...d}}catch(a){throw _e.error("userFirestore: Error creating user:",a),a}},vse=async(n,e)=>{try{_e.log(`userFirestore: Updating rpmURL for user ID: ${n}`);const i=Mi(gi,"users",n);await nl(i,{rpmURL:e,lastUpdated:new Date().toISOString()}),_e.log("userFirestore: rpmURL updated successfully.")}catch(i){throw _e.error("userFirestore: Error updating rpmURL:",i),i}},m5e=(n,e)=>{if(e==="users")return console.log(`OVERRIDE: userBelongsToGroup check for user ${n} and group ${e} - Returning true`),!0;if(e==="disruptiveAdmin"){const a=["lppDQiMb3hhloApQ7llOtk5tckY2","XutdlDmDSncMBUw6vwlQGdkpjNr2","aMhQYu0ArucoNCc6pJJtyfRbn8k2","fJVBogzjtTQqUHnYCYLhTt6jBW13","9NrbbBoc2rOYQC3xAkRBDkig8eg1"].includes(n);return console.log(`OVERRIDE: userBelongsToGroup check for user ${n} and admin group ${e} - Returning ${a}`),a}return console.log(`OVERRIDE: userBelongsToGroup check for user ${n} and group ${e} - Returning false`),!1},Sse=async(n,e)=>m5e(n,e),g5e=["email","name","rpmURL","Nickname","created_on","height_cm","companyName","firstName","lastName","linkedInProfile","groups"],Nd={sendUserToUnity:"sendUserToUnity"};class _5e{constructor(){this.events={}}subscribe(e,i){this.events[e]||(this.events[e]=[]),this.events[e].push(i)}publish(e,i){const a=this.events[e];a?(a.forEach(l=>{l(i)}),_e.log(`EventBus: Published event '${e}'`)):_e.log(`EventBus: No subscribers for event '${e}'`)}unsubscribe(e,i){var l;const a=(l=this.events[e])==null?void 0:l.indexOf(i);a>-1&&this.events[e].splice(a,1)}}const Dd=new _5e;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const bse="firebasestorage.googleapis.com",Tse="storageBucket",y5e=2*60*1e3,E5e=10*60*1e3;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ps extends df{constructor(e,i,a=0){super(iU(e),`Firebase Storage: ${i} (${iU(e)})`),this.status_=a,this.customData={serverResponse:null},this._baseMessage=this.message,Object.setPrototypeOf(this,Ps.prototype)}get status(){return this.status_}set status(e){this.status_=e}_codeEquals(e){return iU(e)===this.code}get serverResponse(){return this.customData.serverResponse}set serverResponse(e){this.customData.serverResponse=e,this.customData.serverResponse?this.message=`${this._baseMessage}
${this.customData.serverResponse}`:this.message=this._baseMessage}}var As;(function(n){n.UNKNOWN="unknown",n.OBJECT_NOT_FOUND="object-not-found",n.BUCKET_NOT_FOUND="bucket-not-found",n.PROJECT_NOT_FOUND="project-not-found",n.QUOTA_EXCEEDED="quota-exceeded",n.UNAUTHENTICATED="unauthenticated",n.UNAUTHORIZED="unauthorized",n.UNAUTHORIZED_APP="unauthorized-app",n.RETRY_LIMIT_EXCEEDED="retry-limit-exceeded",n.INVALID_CHECKSUM="invalid-checksum",n.CANCELED="canceled",n.INVALID_EVENT_NAME="invalid-event-name",n.INVALID_URL="invalid-url",n.INVALID_DEFAULT_BUCKET="invalid-default-bucket",n.NO_DEFAULT_BUCKET="no-default-bucket",n.CANNOT_SLICE_BLOB="cannot-slice-blob",n.SERVER_FILE_WRONG_SIZE="server-file-wrong-size",n.NO_DOWNLOAD_URL="no-download-url",n.INVALID_ARGUMENT="invalid-argument",n.INVALID_ARGUMENT_COUNT="invalid-argument-count",n.APP_DELETED="app-deleted",n.INVALID_ROOT_OPERATION="invalid-root-operation",n.INVALID_FORMAT="invalid-format",n.INTERNAL_ERROR="internal-error",n.UNSUPPORTED_ENVIRONMENT="unsupported-environment"})(As||(As={}));function iU(n){return"storage/"+n}function A4(){const n="An unknown error occurred, please check the error payload for server response.";return new Ps(As.UNKNOWN,n)}function v5e(n){return new Ps(As.OBJECT_NOT_FOUND,"Object '"+n+"' does not exist.")}function S5e(n){return new Ps(As.QUOTA_EXCEEDED,"Quota for bucket '"+n+"' exceeded, please view quota on https://firebase.google.com/pricing/.")}function b5e(){const n="User is not authenticated, please authenticate using Firebase Authentication and try again.";return new Ps(As.UNAUTHENTICATED,n)}function T5e(){return new Ps(As.UNAUTHORIZED_APP,"This app does not have permission to access Firebase Storage on this project.")}function w5e(n){return new Ps(As.UNAUTHORIZED,"User does not have permission to access '"+n+"'.")}function R5e(){return new Ps(As.RETRY_LIMIT_EXCEEDED,"Max retry time for operation exceeded, please try again.")}function C5e(){return new Ps(As.CANCELED,"User canceled the upload/download.")}function I5e(n){return new Ps(As.INVALID_URL,"Invalid URL '"+n+"'.")}function A5e(n){return new Ps(As.INVALID_DEFAULT_BUCKET,"Invalid default bucket '"+n+"'.")}function P5e(){return new Ps(As.NO_DEFAULT_BUCKET,"No default bucket found. Did you set the '"+Tse+"' property when initializing the app?")}function O5e(){return new Ps(As.CANNOT_SLICE_BLOB,"Cannot slice blob for upload. Please retry the upload.")}function k5e(){return new Ps(As.NO_DOWNLOAD_URL,"The given file does not have any download URLs.")}function N5e(n){return new Ps(As.UNSUPPORTED_ENVIRONMENT,`${n} is missing. Make sure to install the required polyfills. See https://firebase.google.com/docs/web/environments-js-sdk#polyfills for more information.`)}function GV(n){return new Ps(As.INVALID_ARGUMENT,n)}function wse(){return new Ps(As.APP_DELETED,"The Firebase app was deleted.")}function D5e(n){return new Ps(As.INVALID_ROOT_OPERATION,"The operation '"+n+"' cannot be performed on a root reference, create a non-root reference using child, such as .child('file.png').")}function lR(n,e){return new Ps(As.INVALID_FORMAT,"String does not match format '"+n+"': "+e)}function hw(n){throw new Ps(As.INTERNAL_ERROR,"Internal error: "+n)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ol{constructor(e,i){this.bucket=e,this.path_=i}get path(){return this.path_}get isRoot(){return this.path.length===0}fullServerUrl(){const e=encodeURIComponent;return"/b/"+e(this.bucket)+"/o/"+e(this.path)}bucketOnlyServerUrl(){return"/b/"+encodeURIComponent(this.bucket)+"/o"}static makeFromBucketSpec(e,i){let a;try{a=Ol.makeFromUrl(e,i)}catch{return new Ol(e,"")}if(a.path==="")return a;throw A5e(e)}static makeFromUrl(e,i){let a=null;const l="([A-Za-z0-9.\\-_]+)";function d(ce){ce.path.charAt(ce.path.length-1)==="/"&&(ce.path_=ce.path_.slice(0,-1))}const p="(/(.*))?$",y=new RegExp("^gs://"+l+p,"i"),v={bucket:1,path:3};function b(ce){ce.path_=decodeURIComponent(ce.path)}const w="v[A-Za-z0-9_]+",A=i.replace(/[.]/g,"\\."),N="(/([^?#]*).*)?$",V=new RegExp(`^https?://${A}/${w}/b/${l}/o${N}`,"i"),j={bucket:1,path:3},B=i===bse?"(?:storage.googleapis.com|storage.cloud.google.com)":i,G="([^?#]*)",ee=new RegExp(`^https?://${B}/${l}/${G}`,"i"),ne=[{regex:y,indices:v,postModify:d},{regex:V,indices:j,postModify:b},{regex:ee,indices:{bucket:1,path:2},postModify:b}];for(let ce=0;ce<ne.length;ce++){const oe=ne[ce],ge=oe.regex.exec(e);if(ge){const te=ge[oe.indices.bucket];let Z=ge[oe.indices.path];Z||(Z=""),a=new Ol(te,Z),oe.postModify(a);break}}if(a==null)throw I5e(e);return a}}class L5e{constructor(e){this.promise_=Promise.reject(e)}getPromise(){return this.promise_}cancel(e=!1){}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function x5e(n,e,i){let a=1,l=null,d=null,p=!1,y=0;function v(){return y===2}let b=!1;function w(...G){b||(b=!0,e.apply(null,G))}function A(G){l=setTimeout(()=>{l=null,n(V,v())},G)}function N(){d&&clearTimeout(d)}function V(G,...ee){if(b){N();return}if(G){N(),w.call(null,G,...ee);return}if(v()||p){N(),w.call(null,G,...ee);return}a<64&&(a*=2);let ne;y===1?(y=2,ne=0):ne=(a+Math.random())*1e3,A(ne)}let j=!1;function B(G){j||(j=!0,N(),!b&&(l!==null?(G||(y=2),clearTimeout(l),A(0)):G||(y=1)))}return A(0),d=setTimeout(()=>{p=!0,B(!0)},i),B}function M5e(n){n(!1)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function U5e(n){return n!==void 0}function V5e(n){return typeof n=="object"&&!Array.isArray(n)}function P4(n){return typeof n=="string"||n instanceof String}function _J(n){return O4()&&n instanceof Blob}function O4(){return typeof Blob<"u"}function yJ(n,e,i,a){if(a<e)throw GV(`Invalid value for '${n}'. Expected ${e} or greater.`);if(a>i)throw GV(`Invalid value for '${n}'. Expected ${i} or less.`)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function lN(n,e,i){let a=e;return i==null&&(a=`https://${e}`),`${i}://${a}/v0${n}`}function Rse(n){const e=encodeURIComponent;let i="?";for(const a in n)if(n.hasOwnProperty(a)){const l=e(a)+"="+e(n[a]);i=i+l+"&"}return i=i.slice(0,-1),i}var Ay;(function(n){n[n.NO_ERROR=0]="NO_ERROR",n[n.NETWORK_ERROR=1]="NETWORK_ERROR",n[n.ABORT=2]="ABORT"})(Ay||(Ay={}));/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function F5e(n,e){const i=n>=500&&n<600,l=[408,429].indexOf(n)!==-1,d=e.indexOf(n)!==-1;return i||l||d}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class j5e{constructor(e,i,a,l,d,p,y,v,b,w,A,N=!0){this.url_=e,this.method_=i,this.headers_=a,this.body_=l,this.successCodes_=d,this.additionalRetryCodes_=p,this.callback_=y,this.errorCallback_=v,this.timeout_=b,this.progressCallback_=w,this.connectionFactory_=A,this.retry=N,this.pendingConnection_=null,this.backoffId_=null,this.canceled_=!1,this.appDelete_=!1,this.promise_=new Promise((V,j)=>{this.resolve_=V,this.reject_=j,this.start_()})}start_(){const e=(a,l)=>{if(l){a(!1,new DO(!1,null,!0));return}const d=this.connectionFactory_();this.pendingConnection_=d;const p=y=>{const v=y.loaded,b=y.lengthComputable?y.total:-1;this.progressCallback_!==null&&this.progressCallback_(v,b)};this.progressCallback_!==null&&d.addUploadProgressListener(p),d.send(this.url_,this.method_,this.body_,this.headers_).then(()=>{this.progressCallback_!==null&&d.removeUploadProgressListener(p),this.pendingConnection_=null;const y=d.getErrorCode()===Ay.NO_ERROR,v=d.getStatus();if(!y||F5e(v,this.additionalRetryCodes_)&&this.retry){const w=d.getErrorCode()===Ay.ABORT;a(!1,new DO(!1,null,w));return}const b=this.successCodes_.indexOf(v)!==-1;a(!0,new DO(b,d))})},i=(a,l)=>{const d=this.resolve_,p=this.reject_,y=l.connection;if(l.wasSuccessCode)try{const v=this.callback_(y,y.getResponse());U5e(v)?d(v):d()}catch(v){p(v)}else if(y!==null){const v=A4();v.serverResponse=y.getErrorText(),this.errorCallback_?p(this.errorCallback_(y,v)):p(v)}else if(l.canceled){const v=this.appDelete_?wse():C5e();p(v)}else{const v=R5e();p(v)}};this.canceled_?i(!1,new DO(!1,null,!0)):this.backoffId_=x5e(e,i,this.timeout_)}getPromise(){return this.promise_}cancel(e){this.canceled_=!0,this.appDelete_=e||!1,this.backoffId_!==null&&M5e(this.backoffId_),this.pendingConnection_!==null&&this.pendingConnection_.abort()}}class DO{constructor(e,i,a){this.wasSuccessCode=e,this.connection=i,this.canceled=!!a}}function B5e(n,e){e!==null&&e.length>0&&(n.Authorization="Firebase "+e)}function W5e(n,e){n["X-Firebase-Storage-Version"]="webjs/"+(e??"AppManager")}function z5e(n,e){e&&(n["X-Firebase-GMPID"]=e)}function G5e(n,e){e!==null&&(n["X-Firebase-AppCheck"]=e)}function H5e(n,e,i,a,l,d,p=!0){const y=Rse(n.urlParams),v=n.url+y,b=Object.assign({},n.headers);return z5e(b,e),B5e(b,i),W5e(b,d),G5e(b,a),new j5e(v,n.method,b,n.body,n.successCodes,n.additionalRetryCodes,n.handler,n.errorHandler,n.timeout,n.progressCallback,l,p)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function $5e(){return typeof BlobBuilder<"u"?BlobBuilder:typeof WebKitBlobBuilder<"u"?WebKitBlobBuilder:void 0}function K5e(...n){const e=$5e();if(e!==void 0){const i=new e;for(let a=0;a<n.length;a++)i.append(n[a]);return i.getBlob()}else{if(O4())return new Blob(n);throw new Ps(As.UNSUPPORTED_ENVIRONMENT,"This browser doesn't seem to support creating Blobs")}}function q5e(n,e,i){return n.webkitSlice?n.webkitSlice(e,i):n.mozSlice?n.mozSlice(e,i):n.slice?n.slice(e,i):null}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Y5e(n){if(typeof atob>"u")throw N5e("base-64");return atob(n)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Hh={RAW:"raw",BASE64:"base64",BASE64URL:"base64url",DATA_URL:"data_url"};class sU{constructor(e,i){this.data=e,this.contentType=i||null}}function X5e(n,e){switch(n){case Hh.RAW:return new sU(Cse(e));case Hh.BASE64:case Hh.BASE64URL:return new sU(Ise(n,e));case Hh.DATA_URL:return new sU(Q5e(e),Z5e(e))}throw A4()}function Cse(n){const e=[];for(let i=0;i<n.length;i++){let a=n.charCodeAt(i);if(a<=127)e.push(a);else if(a<=2047)e.push(192|a>>6,128|a&63);else if((a&64512)===55296)if(!(i<n.length-1&&(n.charCodeAt(i+1)&64512)===56320))e.push(239,191,189);else{const d=a,p=n.charCodeAt(++i);a=65536|(d&1023)<<10|p&1023,e.push(240|a>>18,128|a>>12&63,128|a>>6&63,128|a&63)}else(a&64512)===56320?e.push(239,191,189):e.push(224|a>>12,128|a>>6&63,128|a&63)}return new Uint8Array(e)}function J5e(n){let e;try{e=decodeURIComponent(n)}catch{throw lR(Hh.DATA_URL,"Malformed data URL.")}return Cse(e)}function Ise(n,e){switch(n){case Hh.BASE64:{const l=e.indexOf("-")!==-1,d=e.indexOf("_")!==-1;if(l||d)throw lR(n,"Invalid character '"+(l?"-":"_")+"' found: is it base64url encoded?");break}case Hh.BASE64URL:{const l=e.indexOf("+")!==-1,d=e.indexOf("/")!==-1;if(l||d)throw lR(n,"Invalid character '"+(l?"+":"/")+"' found: is it base64 encoded?");e=e.replace(/-/g,"+").replace(/_/g,"/");break}}let i;try{i=Y5e(e)}catch(l){throw l.message.includes("polyfill")?l:lR(n,"Invalid character found")}const a=new Uint8Array(i.length);for(let l=0;l<i.length;l++)a[l]=i.charCodeAt(l);return a}class Ase{constructor(e){this.base64=!1,this.contentType=null;const i=e.match(/^data:([^,]+)?,/);if(i===null)throw lR(Hh.DATA_URL,"Must be formatted 'data:[<mediatype>][;base64],<data>");const a=i[1]||null;a!=null&&(this.base64=eBe(a,";base64"),this.contentType=this.base64?a.substring(0,a.length-7):a),this.rest=e.substring(e.indexOf(",")+1)}}function Q5e(n){const e=new Ase(n);return e.base64?Ise(Hh.BASE64,e.rest):J5e(e.rest)}function Z5e(n){return new Ase(n).contentType}function eBe(n,e){return n.length>=e.length?n.substring(n.length-e.length)===e:!1}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class og{constructor(e,i){let a=0,l="";_J(e)?(this.data_=e,a=e.size,l=e.type):e instanceof ArrayBuffer?(i?this.data_=new Uint8Array(e):(this.data_=new Uint8Array(e.byteLength),this.data_.set(new Uint8Array(e))),a=this.data_.length):e instanceof Uint8Array&&(i?this.data_=e:(this.data_=new Uint8Array(e.length),this.data_.set(e)),a=e.length),this.size_=a,this.type_=l}size(){return this.size_}type(){return this.type_}slice(e,i){if(_J(this.data_)){const a=this.data_,l=q5e(a,e,i);return l===null?null:new og(l)}else{const a=new Uint8Array(this.data_.buffer,e,i-e);return new og(a,!0)}}static getBlob(...e){if(O4()){const i=e.map(a=>a instanceof og?a.data_:a);return new og(K5e.apply(null,i))}else{const i=e.map(p=>P4(p)?X5e(Hh.RAW,p).data:p.data_);let a=0;i.forEach(p=>{a+=p.byteLength});const l=new Uint8Array(a);let d=0;return i.forEach(p=>{for(let y=0;y<p.length;y++)l[d++]=p[y]}),new og(l,!0)}}uploadData(){return this.data_}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Pse(n){let e;try{e=JSON.parse(n)}catch{return null}return V5e(e)?e:null}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function tBe(n){if(n.length===0)return null;const e=n.lastIndexOf("/");return e===-1?"":n.slice(0,e)}function nBe(n,e){const i=e.split("/").filter(a=>a.length>0).join("/");return n.length===0?i:n+"/"+i}function Ose(n){const e=n.lastIndexOf("/",n.length-2);return e===-1?n:n.slice(e+1)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function rBe(n,e){return e}class sc{constructor(e,i,a,l){this.server=e,this.local=i||e,this.writable=!!a,this.xform=l||rBe}}let LO=null;function iBe(n){return!P4(n)||n.length<2?n:Ose(n)}function kse(){if(LO)return LO;const n=[];n.push(new sc("bucket")),n.push(new sc("generation")),n.push(new sc("metageneration")),n.push(new sc("name","fullPath",!0));function e(d,p){return iBe(p)}const i=new sc("name");i.xform=e,n.push(i);function a(d,p){return p!==void 0?Number(p):p}const l=new sc("size");return l.xform=a,n.push(l),n.push(new sc("timeCreated")),n.push(new sc("updated")),n.push(new sc("md5Hash",null,!0)),n.push(new sc("cacheControl",null,!0)),n.push(new sc("contentDisposition",null,!0)),n.push(new sc("contentEncoding",null,!0)),n.push(new sc("contentLanguage",null,!0)),n.push(new sc("contentType",null,!0)),n.push(new sc("metadata","customMetadata",!0)),LO=n,LO}function sBe(n,e){function i(){const a=n.bucket,l=n.fullPath,d=new Ol(a,l);return e._makeStorageReference(d)}Object.defineProperty(n,"ref",{get:i})}function oBe(n,e,i){const a={};a.type="file";const l=i.length;for(let d=0;d<l;d++){const p=i[d];a[p.local]=p.xform(a,e[p.server])}return sBe(a,n),a}function Nse(n,e,i){const a=Pse(e);return a===null?null:oBe(n,a,i)}function aBe(n,e,i,a){const l=Pse(e);if(l===null||!P4(l.downloadTokens))return null;const d=l.downloadTokens;if(d.length===0)return null;const p=encodeURIComponent;return d.split(",").map(b=>{const w=n.bucket,A=n.fullPath,N="/b/"+p(w)+"/o/"+p(A),V=lN(N,i,a),j=Rse({alt:"media",token:b});return V+j})[0]}function cBe(n,e){const i={},a=e.length;for(let l=0;l<a;l++){const d=e[l];d.writable&&(i[d.server]=n[d.local])}return JSON.stringify(i)}class k4{constructor(e,i,a,l){this.url=e,this.method=i,this.handler=a,this.timeout=l,this.urlParams={},this.headers={},this.body=null,this.errorHandler=null,this.progressCallback=null,this.successCodes=[200],this.additionalRetryCodes=[]}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Dse(n){if(!n)throw A4()}function lBe(n,e){function i(a,l){const d=Nse(n,l,e);return Dse(d!==null),d}return i}function uBe(n,e){function i(a,l){const d=Nse(n,l,e);return Dse(d!==null),aBe(d,l,n.host,n._protocol)}return i}function Lse(n){function e(i,a){let l;return i.getStatus()===401?i.getErrorText().includes("Firebase App Check token is invalid")?l=T5e():l=b5e():i.getStatus()===402?l=S5e(n.bucket):i.getStatus()===403?l=w5e(n.path):l=a,l.status=i.getStatus(),l.serverResponse=a.serverResponse,l}return e}function xse(n){const e=Lse(n);function i(a,l){let d=e(a,l);return a.getStatus()===404&&(d=v5e(n.path)),d.serverResponse=l.serverResponse,d}return i}function dBe(n,e,i){const a=e.fullServerUrl(),l=lN(a,n.host,n._protocol),d="GET",p=n.maxOperationRetryTime,y=new k4(l,d,uBe(n,i),p);return y.errorHandler=xse(e),y}function hBe(n,e){const i=e.fullServerUrl(),a=lN(i,n.host,n._protocol),l="DELETE",d=n.maxOperationRetryTime;function p(v,b){}const y=new k4(a,l,p,d);return y.successCodes=[200,204],y.errorHandler=xse(e),y}function fBe(n,e){return n&&n.contentType||e&&e.type()||"application/octet-stream"}function pBe(n,e,i){const a=Object.assign({},i);return a.fullPath=n.path,a.size=e.size(),a.contentType||(a.contentType=fBe(null,e)),a}function mBe(n,e,i,a,l){const d=e.bucketOnlyServerUrl(),p={"X-Goog-Upload-Protocol":"multipart"};function y(){let ne="";for(let ce=0;ce<2;ce++)ne=ne+Math.random().toString().slice(2);return ne}const v=y();p["Content-Type"]="multipart/related; boundary="+v;const b=pBe(e,a,l),w=cBe(b,i),A="--"+v+`\r
Content-Type: application/json; charset=utf-8\r
\r
`+w+`\r
--`+v+`\r
Content-Type: `+b.contentType+`\r
\r
`,N=`\r
--`+v+"--",V=og.getBlob(A,a,N);if(V===null)throw O5e();const j={name:b.fullPath},B=lN(d,n.host,n._protocol),G="POST",ee=n.maxUploadRetryTime,K=new k4(B,G,lBe(n,i),ee);return K.urlParams=j,K.headers=p,K.body=V.uploadData(),K.errorHandler=Lse(e),K}class gBe{constructor(){this.sent_=!1,this.xhr_=new XMLHttpRequest,this.initXhr(),this.errorCode_=Ay.NO_ERROR,this.sendPromise_=new Promise(e=>{this.xhr_.addEventListener("abort",()=>{this.errorCode_=Ay.ABORT,e()}),this.xhr_.addEventListener("error",()=>{this.errorCode_=Ay.NETWORK_ERROR,e()}),this.xhr_.addEventListener("load",()=>{e()})})}send(e,i,a,l){if(this.sent_)throw hw("cannot .send() more than once");if(this.sent_=!0,this.xhr_.open(i,e,!0),l!==void 0)for(const d in l)l.hasOwnProperty(d)&&this.xhr_.setRequestHeader(d,l[d].toString());return a!==void 0?this.xhr_.send(a):this.xhr_.send(),this.sendPromise_}getErrorCode(){if(!this.sent_)throw hw("cannot .getErrorCode() before sending");return this.errorCode_}getStatus(){if(!this.sent_)throw hw("cannot .getStatus() before sending");try{return this.xhr_.status}catch{return-1}}getResponse(){if(!this.sent_)throw hw("cannot .getResponse() before sending");return this.xhr_.response}getErrorText(){if(!this.sent_)throw hw("cannot .getErrorText() before sending");return this.xhr_.statusText}abort(){this.xhr_.abort()}getResponseHeader(e){return this.xhr_.getResponseHeader(e)}addUploadProgressListener(e){this.xhr_.upload!=null&&this.xhr_.upload.addEventListener("progress",e)}removeUploadProgressListener(e){this.xhr_.upload!=null&&this.xhr_.upload.removeEventListener("progress",e)}}class _Be extends gBe{initXhr(){this.xhr_.responseType="text"}}function N4(){return new _Be}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class By{constructor(e,i){this._service=e,i instanceof Ol?this._location=i:this._location=Ol.makeFromUrl(i,e.host)}toString(){return"gs://"+this._location.bucket+"/"+this._location.path}_newRef(e,i){return new By(e,i)}get root(){const e=new Ol(this._location.bucket,"");return this._newRef(this._service,e)}get bucket(){return this._location.bucket}get fullPath(){return this._location.path}get name(){return Ose(this._location.path)}get storage(){return this._service}get parent(){const e=tBe(this._location.path);if(e===null)return null;const i=new Ol(this._location.bucket,e);return new By(this._service,i)}_throwIfRoot(e){if(this._location.path==="")throw D5e(e)}}function yBe(n,e,i){n._throwIfRoot("uploadBytes");const a=mBe(n.storage,n._location,kse(),new og(e,!0),i);return n.storage.makeRequestWithTokens(a,N4).then(l=>({metadata:l,ref:n}))}function EBe(n){n._throwIfRoot("getDownloadURL");const e=dBe(n.storage,n._location,kse());return n.storage.makeRequestWithTokens(e,N4).then(i=>{if(i===null)throw k5e();return i})}function vBe(n){n._throwIfRoot("deleteObject");const e=hBe(n.storage,n._location);return n.storage.makeRequestWithTokens(e,N4)}function SBe(n,e){const i=nBe(n._location.path,e),a=new Ol(n._location.bucket,i);return new By(n.storage,a)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function bBe(n){return/^[A-Za-z]+:\/\//.test(n)}function TBe(n,e){return new By(n,e)}function Mse(n,e){if(n instanceof D4){const i=n;if(i._bucket==null)throw P5e();const a=new By(i,i._bucket);return e!=null?Mse(a,e):a}else return e!==void 0?SBe(n,e):n}function wBe(n,e){if(e&&bBe(e)){if(n instanceof D4)return TBe(n,e);throw GV("To use ref(service, url), the first argument must be a Storage instance.")}else return Mse(n,e)}function EJ(n,e){const i=e==null?void 0:e[Tse];return i==null?null:Ol.makeFromBucketSpec(i,n)}function RBe(n,e,i,a={}){n.host=`${e}:${i}`,n._protocol="http";const{mockUserToken:l}=a;l&&(n._overrideAuthToken=typeof l=="string"?l:Yne(l,n.app.options.projectId))}class D4{constructor(e,i,a,l,d){this.app=e,this._authProvider=i,this._appCheckProvider=a,this._url=l,this._firebaseVersion=d,this._bucket=null,this._host=bse,this._protocol="https",this._appId=null,this._deleted=!1,this._maxOperationRetryTime=y5e,this._maxUploadRetryTime=E5e,this._requests=new Set,l!=null?this._bucket=Ol.makeFromBucketSpec(l,this._host):this._bucket=EJ(this._host,this.app.options)}get host(){return this._host}set host(e){this._host=e,this._url!=null?this._bucket=Ol.makeFromBucketSpec(this._url,e):this._bucket=EJ(e,this.app.options)}get maxUploadRetryTime(){return this._maxUploadRetryTime}set maxUploadRetryTime(e){yJ("time",0,Number.POSITIVE_INFINITY,e),this._maxUploadRetryTime=e}get maxOperationRetryTime(){return this._maxOperationRetryTime}set maxOperationRetryTime(e){yJ("time",0,Number.POSITIVE_INFINITY,e),this._maxOperationRetryTime=e}async _getAuthToken(){if(this._overrideAuthToken)return this._overrideAuthToken;const e=this._authProvider.getImmediate({optional:!0});if(e){const i=await e.getToken();if(i!==null)return i.accessToken}return null}async _getAppCheckToken(){if(Al(this.app)&&this.app.settings.appCheckToken)return this.app.settings.appCheckToken;const e=this._appCheckProvider.getImmediate({optional:!0});return e?(await e.getToken()).token:null}_delete(){return this._deleted||(this._deleted=!0,this._requests.forEach(e=>e.cancel()),this._requests.clear()),Promise.resolve()}_makeStorageReference(e){return new By(this,e)}_makeRequest(e,i,a,l,d=!0){if(this._deleted)return new L5e(wse());{const p=H5e(e,this._appId,a,l,i,this._firebaseVersion,d);return this._requests.add(p),p.getPromise().then(()=>this._requests.delete(p),()=>this._requests.delete(p)),p}}async makeRequestWithTokens(e,i){const[a,l]=await Promise.all([this._getAuthToken(),this._getAppCheckToken()]);return this._makeRequest(e,i,a,l).getPromise()}}const vJ="@firebase/storage",SJ="0.13.7";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Use="storage";function L4(n,e,i){return n=xi(n),yBe(n,e,i)}function uN(n){return n=xi(n),EBe(n)}function x4(n){return n=xi(n),vBe(n)}function Yy(n,e){return n=xi(n),wBe(n,e)}function Xy(n=Nj(),e){n=xi(n);const a=V1(n,Use).getImmediate({identifier:e}),l=$ne("storage");return l&&CBe(a,...l),a}function CBe(n,e,i,a={}){RBe(n,e,i,a)}function IBe(n,{instanceIdentifier:e}){const i=n.getProvider("app").getImmediate(),a=n.getProvider("auth-internal"),l=n.getProvider("app-check-internal");return new D4(i,a,l,e,Gy)}function ABe(){xy(new Tg(Use,IBe,"PUBLIC").setMultipleInstances(!0)),Qh(vJ,SJ,""),Qh(vJ,SJ,"esm2017")}ABe();const gk=async n=>{const e=Xy(),i=Yy(e,n);try{return await uN(i)}catch(a){throw _e.error("Failed to fetch HTTP URL from gs:// URL:","/src/packages/shared/firebase/firebaseStorage.js",a),a}};let jR={};const _g=async n=>{try{const e=Mi(gi,"spaces",n),i=await Lu(e);if(i.exists()){let a=i.data();const l=a.name,d=a.description;if(a.webglBuildId){const p=Mi(gi,"webglBuilds",a.webglBuildId),y=await Lu(p);if(y.exists()){const v=y.data();a={...a,...v,name:l||v.name,description:d||v.description}}else _e.warn(`spacesFirestore: No document found for webglBuildId: ${a.webglBuildId}`)}return a=await PBe(a),a=OBe(a),console.log("Space data:",a),_e.log(`spacesFirestore: Caching space data for: ${n}`),jR[n]=a,a}else return _e.warn(`spacesFirestore: No document found for item ID: ${n}`),null}catch(e){throw _e.error("spacesFirestore: Error fetching item data:",e),e}},PBe=async n=>{const i=["gsUrlCode","gsUrlData","gsUrlFramework","gsUrlLoader","gsUrlLoadingBackground"].map(async a=>{const l=n[a];l&&l.startsWith("gs://")&&(n[a]=await gk(l))});return await Promise.all(i),n},OBe=n=>{const{gsUrlCode:e,gsUrlData:i,gsUrlFramework:a,gsUrlLoader:l,...d}=n;return{...d,codeUrl:e,dataUrl:i,frameworkUrl:a,loaderUrl:l}};let oU={};const Vse=async n=>{_e.log("spacesFirestore: Get Videos from Firestore for space: ",n);try{if(oU[n])return _e.log("spacesFirestore: Returning cached videos for space:",n),oU[n];const e=jy(gi,`spaces/${n}/videos`),i=await FR(e),a=[];return i.forEach(l=>{a.push({id:l.id,...l.data()})}),oU[n]=a,a}catch(e){throw _e.error("spacesFirestore: Error fetching Space videos from Firestore:",e),e}},kBe=async(n,e)=>{try{if(!n||!e)throw new Error("Missing required parameters: spaceId and logoFile");if(!e.type.startsWith("image/"))throw new Error("File must be an image");const i=Xy(),a=Date.now(),l=e.name.split(".").pop(),d=`logo_${a}.${l}`,p=Yy(i,`spaces/${n}/logo/${d}`);_e.log(`Uploading logo for space ${n}`);const y=await L4(p,e),v=await uN(y.ref),b=Mi(gi,"spaces",n);return await nl(b,{logoUrl:v,logoGsUrl:`gs://${y.ref.bucket}/${y.ref.fullPath}`,logoFileName:d,updatedAt:new Date().toISOString()}),_e.log(`Successfully uploaded logo for space ${n}`),v}catch(i){throw _e.error("Error uploading space logo:",i),i}},NBe=async n=>{try{const e=Mi(gi,"spaces",n),i=await Lu(e);if(!i.exists())return _e.warn(`No space found with ID: ${n}`),!1;const a=i.data();if(a.logoGsUrl){const l=Xy(),d=Yy(l,a.logoGsUrl);try{await x4(d),_e.log(`Deleted logo file from storage: ${a.logoGsUrl}`)}catch(p){_e.warn(`Could not delete logo file from storage: ${p.message}`)}}return await nl(e,{logoUrl:null,logoGsUrl:null,logoFileName:null,updatedAt:new Date().toISOString()}),_e.log(`Successfully removed logo for space ${n}`),!0}catch(e){throw _e.error("Error deleting space logo:",e),e}},DBe=async(n,e)=>{try{if(!n||!e)throw new Error("Missing required parameters: spaceId and backgroundFile");if(!e.type.startsWith("image/"))throw new Error("File must be an image");const i=Xy(),a=Date.now(),l=e.name.split(".").pop(),d=`background_${a}.${l}`,p=Yy(i,`spaces/${n}/background/${d}`);_e.log(`Uploading background for space ${n}`);const y=await L4(p,e),v=await uN(y.ref),b=Mi(gi,"spaces",n);return await nl(b,{backgroundUrl:v,backgroundGsUrl:`gs://${y.ref.bucket}/${y.ref.fullPath}`,backgroundFileName:d,gsUrlLoadingBackground:`gs://${y.ref.bucket}/${y.ref.fullPath}`,updatedAt:new Date().toISOString()}),_e.log(`Successfully uploaded background for space ${n}`),v}catch(i){throw _e.error("Error uploading space background:",i),i}},LBe=async n=>{try{const e=Mi(gi,"spaces",n),i=await Lu(e);if(!i.exists())return _e.warn(`No space found with ID: ${n}`),!1;const a=i.data();if(a.backgroundGsUrl){const l=Xy(),d=Yy(l,a.backgroundGsUrl);try{await x4(d),_e.log(`Deleted background file from storage: ${a.backgroundGsUrl}`)}catch(p){_e.warn(`Could not delete background file from storage: ${p.message}`)}}return await nl(e,{backgroundUrl:null,backgroundGsUrl:null,backgroundFileName:null,gsUrlLoadingBackground:null,updatedAt:new Date().toISOString()}),_e.log(`Successfully removed background references for space ${n}`),!0}catch(e){throw _e.error("Error deleting space background:",e),e}},xBe=async(n,e)=>{try{_e.log(`spacesFirestore: Updating settings for space: ${n}`,e);const i=Mi(gi,"spaces",n),a=await Lu(i);if(!a.exists())throw new Error(`Space with ID ${n} not found`);const l=a.data(),d={...e,accessibleToAllUsers:e.accessibleToAllUsers!==void 0?e.accessibleToAllUsers:l.accessibleToAllUsers!==void 0?l.accessibleToAllUsers:!0,updatedAt:new Date().toISOString()};await nl(i,d),jR[n]&&delete jR[n],_e.log(`spacesFirestore: Successfully updated settings for space: ${n}`)}catch(i){throw _e.error(`spacesFirestore: Error updating settings for space: ${n}`,i),i}},MBe=async(n,e)=>{try{_e.log(`spacesFirestore: Setting accessibleToAllUsers=${e} for space: ${n}`);const i=Mi(gi,"spaces",n);if(!(await Lu(i)).exists())throw new Error(`Space with ID ${n} not found`);await nl(i,{accessibleToAllUsers:e,updatedAt:new Date().toISOString()}),jR[n]&&delete jR[n],typeof window<"u"&&window.dispatchEvent(new CustomEvent("SpaceAccessibilityChanged",{detail:{spaceId:n,accessibleToAllUsers:e}})),_e.log(`spacesFirestore: Successfully updated accessibleToAllUsers for space: ${n}`)}catch(i){throw _e.error(`spacesFirestore: Error updating accessibleToAllUsers for space: ${n}`,i),i}},ca=D.createContext(null),dN=({children:n})=>{const[e,i]=D.useState(null),a=D.useRef(null),[l,d]=D.useState(!0),p=Ure(),y=K=>K?K.Nickname?K.Nickname:`${K.firstName} ${K.lastName}`:"Anon";D.useEffect(()=>{const K=WVe(p,async ne=>{if(_e.log("UserProvider: Firebase onAuthStateChanged() fired"),ne)try{const ce=await af(ne.uid),oe=y(ce),ge={uid:ne.uid,email:ne.email,emailVerified:ne.emailVerified,...ce,displayName:oe};console.log(ge),i(ge),a.current=ge,A(ge)}catch(ce){_e.error("UserProvider: Error fetching user profile data:",ce)}else i(null),a.current=null;d(!1)});return()=>{K&&K()}},[]);const v=async(K,ne,ce)=>{try{const{firstName:oe,lastName:ge}=ce,te=`${oe}${ge.charAt(0).toUpperCase()}`,Z={...ce,Nickname:te,rpmURL:"https://models.readyplayer.me/67c8408d38f7924e15a8bd0a.glb",groups:["users"]},J=await p5e(K,ne,Z),se=y(Z),he={uid:J.uid,email:J.email,...Z,displayName:se};return i(he),a.current=he,_e.log("UserProvider: User registered successfully with groups:",Z.groups),he}catch(oe){throw _e.error("UserProvider: Error creating user:",oe),oe}},b=async(K,ne)=>{try{const ce=await FVe(p,K,ne);if(!ce.user.emailVerified)throw await bV(ce.user),_e.log("UserProvider: Verification email sent again to:",K),new Error("Please verify your email before signing in. A new verification email has been sent.");const oe=await af(ce.user.uid),ge=y(oe),te={uid:ce.user.uid,email:ce.user.email,emailVerified:ce.user.emailVerified,...oe,displayName:ge};i(te),A(te)}catch(ce){throw _e.error("UserProvider: Error signing in:",ce),ce}},w=async()=>{try{await zVe(p),i(null),_e.log("UserProvider: User signed out.")}catch(K){throw _e.error("UserProvider: Error signing out:",K),K}},A=()=>{const K=a.current;if(K){const ne=N(K);_e.log("UserProvider: sendUserToUnity() using the eventBus",ne),Dd.publish(Nd.sendUserToUnity,ne)}else _e.log("UserProvider: No current user to send to Unity.")},N=K=>{const ne={};return[...g5e,"uid"].forEach(oe=>{K.hasOwnProperty(oe)&&(ne[oe]=K[oe])}),ne},V=async K=>!e||!e.uid?!1:await Sse(e.uid,K),j=async K=>{if(!e||!e.uid)return!1;try{const ne=await _g(K);if(ne.usersAllowed.includes(e.uid)||ne.userAdmin.includes(e.uid)||ne.usersModerators.includes(e.uid))return!0;if(e.groups&&Array.isArray(e.groups)){const oe=`space_${K}_owners`,ge=`space_${K}_hosts`;if(e.groups.includes(oe)||e.groups.includes(ge))return _e.log(`UserProvider: User ${e.uid} has access to space ${K} as owner/host`),!0}return ne.accessibleToAllUsers===!0&&e.groups?e.groups.includes("users"):!1}catch(ne){return _e.error("UserProvider: Error verifying user access to space:",ne),!1}},B=async K=>{if(!e||!e.uid)return!1;try{return(await _g(K)).userAdmin.includes(e.uid)}catch(ne){return _e.error("UserProvider: Error verifying user admin status for space:",ne),!1}},G=async K=>{if(!e||!e.uid)return!1;try{return(await _g(K)).usersModerators.includes(e.uid)}catch(ne){return _e.error("UserProvider: Error verifying user moderator status for space:",ne),!1}},ee=async()=>{try{const K=p.currentUser;return K&&!K.emailVerified?(await bV(K),_e.log("UserProvider: Verification email resent to:",K.email),!0):!1}catch(K){throw _e.error("UserProvider: Error resending verification email:",K),K}};return C.jsx(ca.Provider,{value:{user:e,loading:l,register:v,signIn:b,signOut:w,sendUserToUnity:A,isUserInGroup:V,userHasAccessToSpace:j,userIsAdminOfSpace:B,userIsModeratorOfSpace:G,resendVerificationEmail:ee},children:n})},Fse=D.createContext(),Ud=()=>D.useContext(Fse),M4=({children:n})=>{const[e,i]=D.useState(!1),a=D.useRef(null),[l,d]=D.useState(!1);D.useEffect(()=>{const v=()=>{const b=/iPhone|iPad|iPod|Android/i.test(navigator.userAgent);d(b)};return v(),window.addEventListener("resize",v),()=>window.removeEventListener("resize",v)},[]);const p=D.useCallback(v=>{a.current=v},[]),y=D.useCallback(()=>{const v=a.current;if(!v)return;const b=document.fullscreenElement||document.webkitFullscreenElement||document.mozFullScreenElement||document.msFullscreenElement;if(l){console.log("Attempting mobile fullscreen...");const w=v.querySelector("video")||v;if(/iPhone|iPad|iPod/i.test(navigator.userAgent)){if(w.webkitEnterFullscreen)try{w.webkitEnterFullscreen(),i(!0);return}catch(A){console.error("iOS fullscreen error:",A)}try{if(w.webkitRequestFullscreen){w.webkitRequestFullscreen(),i(!0);return}}catch(A){console.error("iOS fallback fullscreen error:",A)}}if(/Android/i.test(navigator.userAgent))try{b?(document.exitFullscreen?document.exitFullscreen():document.webkitExitFullscreen?document.webkitExitFullscreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.msExitFullscreen&&document.msExitFullscreen(),i(!1)):(v.requestFullscreen?v.requestFullscreen():v.webkitRequestFullscreen?v.webkitRequestFullscreen():v.mozRequestFullScreen?v.mozRequestFullScreen():v.msRequestFullscreen&&v.msRequestFullscreen(),i(!0));return}catch(A){console.error("Android fullscreen error:",A)}}try{b?document.exitFullscreen?document.exitFullscreen().then(()=>{i(!1)}).catch(w=>console.error("Error exiting fullscreen:",w)):document.webkitExitFullscreen?(document.webkitExitFullscreen(),i(!1)):document.mozCancelFullScreen?(document.mozCancelFullScreen(),i(!1)):document.msExitFullscreen&&(document.msExitFullscreen(),i(!1)):v.requestFullscreen?v.requestFullscreen().then(()=>{i(!0)}).catch(w=>console.error("Error entering fullscreen:",w)):v.webkitRequestFullscreen?(v.webkitRequestFullscreen(),i(!0)):v.mozRequestFullScreen?(v.mozRequestFullScreen(),i(!0)):v.msRequestFullscreen&&(v.msRequestFullscreen(),i(!0))}catch(w){console.error("Fullscreen error:",w)}},[l]);return D.useEffect(()=>{const v=()=>{const b=document.fullscreenElement||document.webkitFullscreenElement||document.mozFullScreenElement||document.msFullscreenElement;i(!!b)};return document.addEventListener("fullscreenchange",v),document.addEventListener("webkitfullscreenchange",v),document.addEventListener("mozfullscreenchange",v),document.addEventListener("MSFullscreenChange",v),()=>{document.removeEventListener("fullscreenchange",v),document.removeEventListener("webkitfullscreenchange",v),document.removeEventListener("mozfullscreenchange",v),document.removeEventListener("MSFullscreenChange",v)}},[]),C.jsx(Fse.Provider,{value:{isFullscreen:e,toggleFullscreen:y,fullscreenRef:a,setFullscreenRef:p,isMobile:l},children:C.jsx("div",{ref:p,style:{position:"relative",zIndex:1,width:"100%",height:"100%",overflow:"hidden"},children:n})})},UBe=Ng({d:"M0,12a1.5,1.5,0,0,0,1.5,1.5h8.75a.25.25,0,0,1,.25.25V22.5a1.5,1.5,0,0,0,3,0V13.75a.25.25,0,0,1,.25-.25H22.5a1.5,1.5,0,0,0,0-3H13.75a.25.25,0,0,1-.25-.25V1.5a1.5,1.5,0,0,0-3,0v8.75a.25.25,0,0,1-.25.25H1.5A1.5,1.5,0,0,0,0,12Z",displayName:"AddIcon"}),VBe=Ng({viewBox:"0 0 14 14",d:"M14,7.77 L14,6.17 L12.06,5.53 L11.61,4.44 L12.49,2.6 L11.36,1.47 L9.55,2.38 L8.46,1.93 L7.77,0.01 L6.17,0.01 L5.54,1.95 L4.43,2.4 L2.59,1.52 L1.46,2.65 L2.37,4.46 L1.92,5.55 L0,6.23 L0,7.82 L1.94,8.46 L2.39,9.55 L1.51,11.39 L2.64,12.52 L4.45,11.61 L5.54,12.06 L6.23,13.98 L7.82,13.98 L8.45,12.04 L9.56,11.59 L11.4,12.47 L12.53,11.34 L11.61,9.53 L12.08,8.44 L14,7.75 L14,7.77 Z M7,10 C5.34,10 4,8.66 4,7 C4,5.34 5.34,4 7,4 C8.66,4 10,5.34 10,7 C10,8.66 8.66,10 7,10 Z",displayName:"SettingsIcon"}),FBe=Ng({d:"M19.5,9.5h-.75V6.75a6.75,6.75,0,0,0-13.5,0V9.5H4.5a2,2,0,0,0-2,2V22a2,2,0,0,0,2,2h15a2,2,0,0,0,2-2V11.5A2,2,0,0,0,19.5,9.5Zm-9.5,6a2,2,0,1,1,3,1.723V19.5a1,1,0,0,1-2,0V17.223A1.994,1.994,0,0,1,10,15.5ZM7.75,6.75a4.25,4.25,0,0,1,8.5,0V9a.5.5,0,0,1-.5.5H8.25a.5.5,0,0,1-.5-.5Z",displayName:"LockIcon"}),jse=Ng({displayName:"ChevronDownIcon",d:"M16.59 8.59L12 13.17 7.41 8.59 6 10l6 6 6-6z"}),bJ=Ng({displayName:"EmailIcon",path:C.jsxs("g",{fill:"currentColor",children:[C.jsx("path",{d:"M11.114,14.556a1.252,1.252,0,0,0,1.768,0L22.568,4.87a.5.5,0,0,0-.281-.849A1.966,1.966,0,0,0,22,4H2a1.966,1.966,0,0,0-.289.021.5.5,0,0,0-.281.849Z"}),C.jsx("path",{d:"M23.888,5.832a.182.182,0,0,0-.2.039l-6.2,6.2a.251.251,0,0,0,0,.354l5.043,5.043a.75.75,0,1,1-1.06,1.061l-5.043-5.043a.25.25,0,0,0-.354,0l-2.129,2.129a2.75,2.75,0,0,1-3.888,0L7.926,13.488a.251.251,0,0,0-.354,0L2.529,18.531a.75.75,0,0,1-1.06-1.061l5.043-5.043a.251.251,0,0,0,0-.354l-6.2-6.2a.18.18,0,0,0-.2-.039A.182.182,0,0,0,0,6V18a2,2,0,0,0,2,2H22a2,2,0,0,0,2-2V6A.181.181,0,0,0,23.888,5.832Z"})]})}),jBe=Ng({displayName:"CloseIcon",d:"M.439,21.44a1.5,1.5,0,0,0,2.122,2.121L11.823,14.3a.25.25,0,0,1,.354,0l9.262,9.263a1.5,1.5,0,1,0,2.122-2.121L14.3,12.177a.25.25,0,0,1,0-.354l9.263-9.262A1.5,1.5,0,0,0,21.439.44L12.177,9.7a.25.25,0,0,1-.354,0L2.561.44A1.5,1.5,0,0,0,.439,2.561L9.7,11.823a.25.25,0,0,1,0,.354Z"}),BBe=Ng({displayName:"QuestionOutlineIcon",path:C.jsxs("g",{stroke:"currentColor",strokeWidth:"1.5",children:[C.jsx("path",{strokeLinecap:"round",fill:"none",d:"M9,9a3,3,0,1,1,4,2.829,1.5,1.5,0,0,0-1,1.415V14.25"}),C.jsx("path",{fill:"none",strokeLinecap:"round",d:"M12,17.25a.375.375,0,1,0,.375.375A.375.375,0,0,0,12,17.25h0"}),C.jsx("circle",{fill:"none",strokeMiterlimit:"10",cx:"12",cy:"12",r:"11.25"})]})}),WBe=Ng({displayName:"HamburgerIcon",viewBox:"0 0 24 24",d:"M 3 5 A 1.0001 1.0001 0 1 0 3 7 L 21 7 A 1.0001 1.0001 0 1 0 21 5 L 3 5 z M 3 11 A 1.0001 1.0001 0 1 0 3 13 L 21 13 A 1.0001 1.0001 0 1 0 21 11 L 3 11 z M 3 17 A 1.0001 1.0001 0 1 0 3 19 L 21 19 A 1.0001 1.0001 0 1 0 21 17 L 3 17 z"});var vC=n=>n.type==="checkbox",Ey=n=>n instanceof Date,oc=n=>n==null;const Bse=n=>typeof n=="object";var Fs=n=>!oc(n)&&!Array.isArray(n)&&Bse(n)&&!Ey(n),zBe=n=>Fs(n)&&n.target?vC(n.target)?n.target.checked:n.target.value:n,GBe=n=>n.substring(0,n.search(/\.\d+(\.|$)/))||n,HBe=(n,e)=>n.has(GBe(e)),$Be=n=>{const e=n.constructor&&n.constructor.prototype;return Fs(e)&&e.hasOwnProperty("isPrototypeOf")},U4=typeof window<"u"&&typeof window.HTMLElement<"u"&&typeof document<"u";function Tu(n){let e;const i=Array.isArray(n),a=typeof FileList<"u"?n instanceof FileList:!1;if(n instanceof Date)e=new Date(n);else if(n instanceof Set)e=new Set(n);else if(!(U4&&(n instanceof Blob||a))&&(i||Fs(n)))if(e=i?[]:{},!i&&!$Be(n))e=n;else for(const l in n)n.hasOwnProperty(l)&&(e[l]=Tu(n[l]));else return n;return e}var hN=n=>Array.isArray(n)?n.filter(Boolean):[],$s=n=>n===void 0,on=(n,e,i)=>{if(!e||!Fs(n))return i;const a=hN(e.split(/[,[\].]+?/)).reduce((l,d)=>oc(l)?l:l[d],n);return $s(a)||a===n?$s(n[e])?i:n[e]:a},Uh=n=>typeof n=="boolean",V4=n=>/^\w*$/.test(n),Wse=n=>hN(n.replace(/["|']|\]/g,"").split(/\.|\[/)),Yi=(n,e,i)=>{let a=-1;const l=V4(e)?[e]:Wse(e),d=l.length,p=d-1;for(;++a<d;){const y=l[a];let v=i;if(a!==p){const b=n[y];v=Fs(b)||Array.isArray(b)?b:isNaN(+l[a+1])?{}:[]}if(y==="__proto__"||y==="constructor"||y==="prototype")return;n[y]=v,n=n[y]}return n};const TJ={BLUR:"blur",FOCUS_OUT:"focusout"},Od={onBlur:"onBlur",onChange:"onChange",onSubmit:"onSubmit",onTouched:"onTouched",all:"all"},lp={max:"max",min:"min",maxLength:"maxLength",minLength:"minLength",pattern:"pattern",required:"required",validate:"validate"};ri.createContext(null);var KBe=(n,e,i,a=!0)=>{const l={defaultValues:e._defaultValues};for(const d in n)Object.defineProperty(l,d,{get:()=>{const p=d;return e._proxyFormState[p]!==Od.all&&(e._proxyFormState[p]=!a||Od.all),n[p]}});return l},Hc=n=>Fs(n)&&!Object.keys(n).length,qBe=(n,e,i,a)=>{i(n);const{name:l,...d}=n;return Hc(d)||Object.keys(d).length>=Object.keys(e).length||Object.keys(d).find(p=>e[p]===Od.all)},_k=n=>Array.isArray(n)?n:[n];function YBe(n){const e=ri.useRef(n);e.current=n,ri.useEffect(()=>{const i=!n.disabled&&e.current.subject&&e.current.subject.subscribe({next:e.current.next});return()=>{i&&i.unsubscribe()}},[n.disabled])}var $h=n=>typeof n=="string",XBe=(n,e,i,a,l)=>$h(n)?(a&&e.watch.add(n),on(i,n,l)):Array.isArray(n)?n.map(d=>(a&&e.watch.add(d),on(i,d))):(a&&(e.watchAll=!0),i),JBe=(n,e,i,a,l)=>e?{...i[n],types:{...i[n]&&i[n].types?i[n].types:{},[a]:l||!0}}:{},wJ=n=>({isOnSubmit:!n||n===Od.onSubmit,isOnBlur:n===Od.onBlur,isOnChange:n===Od.onChange,isOnAll:n===Od.all,isOnTouch:n===Od.onTouched}),RJ=(n,e,i)=>!i&&(e.watchAll||e.watch.has(n)||[...e.watch].some(a=>n.startsWith(a)&&/^\.\w+/.test(n.slice(a.length))));const uR=(n,e,i,a)=>{for(const l of i||Object.keys(n)){const d=on(n,l);if(d){const{_f:p,...y}=d;if(p){if(p.refs&&p.refs[0]&&e(p.refs[0],l)&&!a)return!0;if(p.ref&&e(p.ref,p.name)&&!a)return!0;if(uR(y,e))break}else if(Fs(y)&&uR(y,e))break}}};var QBe=(n,e,i)=>{const a=_k(on(n,i));return Yi(a,"root",e[i]),Yi(n,i,a),n},F4=n=>n.type==="file",Wh=n=>typeof n=="function",r1=n=>{if(!U4)return!1;const e=n?n.ownerDocument:0;return n instanceof(e&&e.defaultView?e.defaultView.HTMLElement:HTMLElement)},yk=n=>$h(n),j4=n=>n.type==="radio",i1=n=>n instanceof RegExp;const CJ={value:!1,isValid:!1},IJ={value:!0,isValid:!0};var zse=n=>{if(Array.isArray(n)){if(n.length>1){const e=n.filter(i=>i&&i.checked&&!i.disabled).map(i=>i.value);return{value:e,isValid:!!e.length}}return n[0].checked&&!n[0].disabled?n[0].attributes&&!$s(n[0].attributes.value)?$s(n[0].value)||n[0].value===""?IJ:{value:n[0].value,isValid:!0}:IJ:CJ}return CJ};const AJ={isValid:!1,value:null};var Gse=n=>Array.isArray(n)?n.reduce((e,i)=>i&&i.checked&&!i.disabled?{isValid:!0,value:i.value}:e,AJ):AJ;function PJ(n,e,i="validate"){if(yk(n)||Array.isArray(n)&&n.every(yk)||Uh(n)&&!n)return{type:i,message:yk(n)?n:"",ref:e}}var vS=n=>Fs(n)&&!i1(n)?n:{value:n,message:""},OJ=async(n,e,i,a,l,d)=>{const{ref:p,refs:y,required:v,maxLength:b,minLength:w,min:A,max:N,pattern:V,validate:j,name:B,valueAsNumber:G,mount:ee}=n._f,K=on(i,B);if(!ee||e.has(B))return{};const ne=y?y[0]:p,ce=fe=>{l&&ne.reportValidity&&(ne.setCustomValidity(Uh(fe)?"":fe||""),ne.reportValidity())},oe={},ge=j4(p),te=vC(p),Z=ge||te,J=(G||F4(p))&&$s(p.value)&&$s(K)||r1(p)&&p.value===""||K===""||Array.isArray(K)&&!K.length,se=JBe.bind(null,B,a,oe),he=(fe,ue,Me,He=lp.maxLength,rt=lp.minLength)=>{const we=fe?ue:Me;oe[B]={type:fe?He:rt,message:we,ref:p,...se(fe?He:rt,we)}};if(d?!Array.isArray(K)||!K.length:v&&(!Z&&(J||oc(K))||Uh(K)&&!K||te&&!zse(y).isValid||ge&&!Gse(y).isValid)){const{value:fe,message:ue}=yk(v)?{value:!!v,message:v}:vS(v);if(fe&&(oe[B]={type:lp.required,message:ue,ref:ne,...se(lp.required,ue)},!a))return ce(ue),oe}if(!J&&(!oc(A)||!oc(N))){let fe,ue;const Me=vS(N),He=vS(A);if(!oc(K)&&!isNaN(K)){const rt=p.valueAsNumber||K&&+K;oc(Me.value)||(fe=rt>Me.value),oc(He.value)||(ue=rt<He.value)}else{const rt=p.valueAsDate||new Date(K),we=Ne=>new Date(new Date().toDateString()+" "+Ne),Ce=p.type=="time",ve=p.type=="week";$h(Me.value)&&K&&(fe=Ce?we(K)>we(Me.value):ve?K>Me.value:rt>new Date(Me.value)),$h(He.value)&&K&&(ue=Ce?we(K)<we(He.value):ve?K<He.value:rt<new Date(He.value))}if((fe||ue)&&(he(!!fe,Me.message,He.message,lp.max,lp.min),!a))return ce(oe[B].message),oe}if((b||w)&&!J&&($h(K)||d&&Array.isArray(K))){const fe=vS(b),ue=vS(w),Me=!oc(fe.value)&&K.length>+fe.value,He=!oc(ue.value)&&K.length<+ue.value;if((Me||He)&&(he(Me,fe.message,ue.message),!a))return ce(oe[B].message),oe}if(V&&!J&&$h(K)){const{value:fe,message:ue}=vS(V);if(i1(fe)&&!K.match(fe)&&(oe[B]={type:lp.pattern,message:ue,ref:p,...se(lp.pattern,ue)},!a))return ce(ue),oe}if(j){if(Wh(j)){const fe=await j(K,i),ue=PJ(fe,ne);if(ue&&(oe[B]={...ue,...se(lp.validate,ue.message)},!a))return ce(ue.message),oe}else if(Fs(j)){let fe={};for(const ue in j){if(!Hc(fe)&&!a)break;const Me=PJ(await j[ue](K,i),ne,ue);Me&&(fe={...Me,...se(ue,Me.message)},ce(Me.message),a&&(oe[B]=fe))}if(!Hc(fe)&&(oe[B]={ref:ne,...fe},!a))return oe}}return ce(!0),oe};function ZBe(n,e){const i=e.slice(0,-1).length;let a=0;for(;a<i;)n=$s(n)?a++:n[e[a++]];return n}function e6e(n){for(const e in n)if(n.hasOwnProperty(e)&&!$s(n[e]))return!1;return!0}function oo(n,e){const i=Array.isArray(e)?e:V4(e)?[e]:Wse(e),a=i.length===1?n:ZBe(n,i),l=i.length-1,d=i[l];return a&&delete a[d],l!==0&&(Fs(a)&&Hc(a)||Array.isArray(a)&&e6e(a))&&oo(n,i.slice(0,-1)),n}var aU=()=>{let n=[];return{get observers(){return n},next:l=>{for(const d of n)d.next&&d.next(l)},subscribe:l=>(n.push(l),{unsubscribe:()=>{n=n.filter(d=>d!==l)}}),unsubscribe:()=>{n=[]}}},HV=n=>oc(n)||!Bse(n);function ag(n,e){if(HV(n)||HV(e))return n===e;if(Ey(n)&&Ey(e))return n.getTime()===e.getTime();const i=Object.keys(n),a=Object.keys(e);if(i.length!==a.length)return!1;for(const l of i){const d=n[l];if(!a.includes(l))return!1;if(l!=="ref"){const p=e[l];if(Ey(d)&&Ey(p)||Fs(d)&&Fs(p)||Array.isArray(d)&&Array.isArray(p)?!ag(d,p):d!==p)return!1}}return!0}var Hse=n=>n.type==="select-multiple",t6e=n=>j4(n)||vC(n),cU=n=>r1(n)&&n.isConnected,$se=n=>{for(const e in n)if(Wh(n[e]))return!0;return!1};function s1(n,e={}){const i=Array.isArray(n);if(Fs(n)||i)for(const a in n)Array.isArray(n[a])||Fs(n[a])&&!$se(n[a])?(e[a]=Array.isArray(n[a])?[]:{},s1(n[a],e[a])):oc(n[a])||(e[a]=!0);return e}function Kse(n,e,i){const a=Array.isArray(n);if(Fs(n)||a)for(const l in n)Array.isArray(n[l])||Fs(n[l])&&!$se(n[l])?$s(e)||HV(i[l])?i[l]=Array.isArray(n[l])?s1(n[l],[]):{...s1(n[l])}:Kse(n[l],oc(e)?{}:e[l],i[l]):i[l]=!ag(n[l],e[l]);return i}var fw=(n,e)=>Kse(n,e,s1(e)),qse=(n,{valueAsNumber:e,valueAsDate:i,setValueAs:a})=>$s(n)?n:e?n===""?NaN:n&&+n:i&&$h(n)?new Date(n):a?a(n):n;function lU(n){const e=n.ref;return F4(e)?e.files:j4(e)?Gse(n.refs).value:Hse(e)?[...e.selectedOptions].map(({value:i})=>i):vC(e)?zse(n.refs).value:qse($s(e.value)?n.ref.value:e.value,n)}var n6e=(n,e,i,a)=>{const l={};for(const d of n){const p=on(e,d);p&&Yi(l,d,p._f)}return{criteriaMode:i,names:[...n],fields:l,shouldUseNativeValidation:a}},pw=n=>$s(n)?n:i1(n)?n.source:Fs(n)?i1(n.value)?n.value.source:n.value:n;const kJ="AsyncFunction";var r6e=n=>!!n&&!!n.validate&&!!(Wh(n.validate)&&n.validate.constructor.name===kJ||Fs(n.validate)&&Object.values(n.validate).find(e=>e.constructor.name===kJ)),i6e=n=>n.mount&&(n.required||n.min||n.max||n.maxLength||n.minLength||n.pattern||n.validate);function NJ(n,e,i){const a=on(n,i);if(a||V4(i))return{error:a,name:i};const l=i.split(".");for(;l.length;){const d=l.join("."),p=on(e,d),y=on(n,d);if(p&&!Array.isArray(p)&&i!==d)return{name:i};if(y&&y.type)return{name:d,error:y};l.pop()}return{name:i}}var s6e=(n,e,i,a,l)=>l.isOnAll?!1:!i&&l.isOnTouch?!(e||n):(i?a.isOnBlur:l.isOnBlur)?!n:(i?a.isOnChange:l.isOnChange)?n:!0,o6e=(n,e)=>!hN(on(n,e)).length&&oo(n,e);const a6e={mode:Od.onSubmit,reValidateMode:Od.onChange,shouldFocusError:!0};function c6e(n={}){let e={...a6e,...n},i={submitCount:0,isDirty:!1,isLoading:Wh(e.defaultValues),isValidating:!1,isSubmitted:!1,isSubmitting:!1,isSubmitSuccessful:!1,isValid:!1,touchedFields:{},dirtyFields:{},validatingFields:{},errors:e.errors||{},disabled:e.disabled||!1},a={},l=Fs(e.defaultValues)||Fs(e.values)?Tu(e.defaultValues||e.values)||{}:{},d=e.shouldUnregister?{}:Tu(l),p={action:!1,mount:!1,watch:!1},y={mount:new Set,disabled:new Set,unMount:new Set,array:new Set,watch:new Set},v,b=0;const w={isDirty:!1,dirtyFields:!1,validatingFields:!1,touchedFields:!1,isValidating:!1,isValid:!1,errors:!1},A={values:aU(),array:aU(),state:aU()},N=wJ(e.mode),V=wJ(e.reValidateMode),j=e.criteriaMode===Od.all,B=Re=>Fe=>{clearTimeout(b),b=setTimeout(Re,Fe)},G=async Re=>{if(!e.disabled&&(w.isValid||Re)){const Fe=e.resolver?Hc((await Z()).errors):await se(a,!0);Fe!==i.isValid&&A.state.next({isValid:Fe})}},ee=(Re,Fe)=>{!e.disabled&&(w.isValidating||w.validatingFields)&&((Re||Array.from(y.mount)).forEach(Ke=>{Ke&&(Fe?Yi(i.validatingFields,Ke,Fe):oo(i.validatingFields,Ke))}),A.state.next({validatingFields:i.validatingFields,isValidating:!Hc(i.validatingFields)}))},K=(Re,Fe=[],Ke,Et,bt=!0,Ge=!0)=>{if(Et&&Ke&&!e.disabled){if(p.action=!0,Ge&&Array.isArray(on(a,Re))){const Ot=Ke(on(a,Re),Et.argA,Et.argB);bt&&Yi(a,Re,Ot)}if(Ge&&Array.isArray(on(i.errors,Re))){const Ot=Ke(on(i.errors,Re),Et.argA,Et.argB);bt&&Yi(i.errors,Re,Ot),o6e(i.errors,Re)}if(w.touchedFields&&Ge&&Array.isArray(on(i.touchedFields,Re))){const Ot=Ke(on(i.touchedFields,Re),Et.argA,Et.argB);bt&&Yi(i.touchedFields,Re,Ot)}w.dirtyFields&&(i.dirtyFields=fw(l,d)),A.state.next({name:Re,isDirty:fe(Re,Fe),dirtyFields:i.dirtyFields,errors:i.errors,isValid:i.isValid})}else Yi(d,Re,Fe)},ne=(Re,Fe)=>{Yi(i.errors,Re,Fe),A.state.next({errors:i.errors})},ce=Re=>{i.errors=Re,A.state.next({errors:i.errors,isValid:!1})},oe=(Re,Fe,Ke,Et)=>{const bt=on(a,Re);if(bt){const Ge=on(d,Re,$s(Ke)?on(l,Re):Ke);$s(Ge)||Et&&Et.defaultChecked||Fe?Yi(d,Re,Fe?Ge:lU(bt._f)):He(Re,Ge),p.mount&&G()}},ge=(Re,Fe,Ke,Et,bt)=>{let Ge=!1,Ot=!1;const Jt={name:Re};if(!e.disabled){const fn=!!(on(a,Re)&&on(a,Re)._f&&on(a,Re)._f.disabled);if(!Ke||Et){w.isDirty&&(Ot=i.isDirty,i.isDirty=Jt.isDirty=fe(),Ge=Ot!==Jt.isDirty);const an=fn||ag(on(l,Re),Fe);Ot=!!(!fn&&on(i.dirtyFields,Re)),an||fn?oo(i.dirtyFields,Re):Yi(i.dirtyFields,Re,!0),Jt.dirtyFields=i.dirtyFields,Ge=Ge||w.dirtyFields&&Ot!==!an}if(Ke){const an=on(i.touchedFields,Re);an||(Yi(i.touchedFields,Re,Ke),Jt.touchedFields=i.touchedFields,Ge=Ge||w.touchedFields&&an!==Ke)}Ge&&bt&&A.state.next(Jt)}return Ge?Jt:{}},te=(Re,Fe,Ke,Et)=>{const bt=on(i.errors,Re),Ge=w.isValid&&Uh(Fe)&&i.isValid!==Fe;if(e.delayError&&Ke?(v=B(()=>ne(Re,Ke)),v(e.delayError)):(clearTimeout(b),v=null,Ke?Yi(i.errors,Re,Ke):oo(i.errors,Re)),(Ke?!ag(bt,Ke):bt)||!Hc(Et)||Ge){const Ot={...Et,...Ge&&Uh(Fe)?{isValid:Fe}:{},errors:i.errors,name:Re};i={...i,...Ot},A.state.next(Ot)}},Z=async Re=>{ee(Re,!0);const Fe=await e.resolver(d,e.context,n6e(Re||y.mount,a,e.criteriaMode,e.shouldUseNativeValidation));return ee(Re),Fe},J=async Re=>{const{errors:Fe}=await Z(Re);if(Re)for(const Ke of Re){const Et=on(Fe,Ke);Et?Yi(i.errors,Ke,Et):oo(i.errors,Ke)}else i.errors=Fe;return Fe},se=async(Re,Fe,Ke={valid:!0})=>{for(const Et in Re){const bt=Re[Et];if(bt){const{_f:Ge,...Ot}=bt;if(Ge){const Jt=y.array.has(Ge.name),fn=bt._f&&r6e(bt._f);fn&&w.validatingFields&&ee([Et],!0);const an=await OJ(bt,y.disabled,d,j,e.shouldUseNativeValidation&&!Fe,Jt);if(fn&&w.validatingFields&&ee([Et]),an[Ge.name]&&(Ke.valid=!1,Fe))break;!Fe&&(on(an,Ge.name)?Jt?QBe(i.errors,an,Ge.name):Yi(i.errors,Ge.name,an[Ge.name]):oo(i.errors,Ge.name))}!Hc(Ot)&&await se(Ot,Fe,Ke)}}return Ke.valid},he=()=>{for(const Re of y.unMount){const Fe=on(a,Re);Fe&&(Fe._f.refs?Fe._f.refs.every(Ke=>!cU(Ke)):!cU(Fe._f.ref))&&et(Re)}y.unMount=new Set},fe=(Re,Fe)=>!e.disabled&&(Re&&Fe&&Yi(d,Re,Fe),!ag(Te(),l)),ue=(Re,Fe,Ke)=>XBe(Re,y,{...p.mount?d:$s(Fe)?l:$h(Re)?{[Re]:Fe}:Fe},Ke,Fe),Me=Re=>hN(on(p.mount?d:l,Re,e.shouldUnregister?on(l,Re,[]):[])),He=(Re,Fe,Ke={})=>{const Et=on(a,Re);let bt=Fe;if(Et){const Ge=Et._f;Ge&&(!Ge.disabled&&Yi(d,Re,qse(Fe,Ge)),bt=r1(Ge.ref)&&oc(Fe)?"":Fe,Hse(Ge.ref)?[...Ge.ref.options].forEach(Ot=>Ot.selected=bt.includes(Ot.value)):Ge.refs?vC(Ge.ref)?Ge.refs.length>1?Ge.refs.forEach(Ot=>(!Ot.defaultChecked||!Ot.disabled)&&(Ot.checked=Array.isArray(bt)?!!bt.find(Jt=>Jt===Ot.value):bt===Ot.value)):Ge.refs[0]&&(Ge.refs[0].checked=!!bt):Ge.refs.forEach(Ot=>Ot.checked=Ot.value===bt):F4(Ge.ref)?Ge.ref.value="":(Ge.ref.value=bt,Ge.ref.type||A.values.next({name:Re,values:{...d}})))}(Ke.shouldDirty||Ke.shouldTouch)&&ge(Re,bt,Ke.shouldTouch,Ke.shouldDirty,!0),Ke.shouldValidate&&Ne(Re)},rt=(Re,Fe,Ke)=>{for(const Et in Fe){const bt=Fe[Et],Ge=`${Re}.${Et}`,Ot=on(a,Ge);(y.array.has(Re)||Fs(bt)||Ot&&!Ot._f)&&!Ey(bt)?rt(Ge,bt,Ke):He(Ge,bt,Ke)}},we=(Re,Fe,Ke={})=>{const Et=on(a,Re),bt=y.array.has(Re),Ge=Tu(Fe);Yi(d,Re,Ge),bt?(A.array.next({name:Re,values:{...d}}),(w.isDirty||w.dirtyFields)&&Ke.shouldDirty&&A.state.next({name:Re,dirtyFields:fw(l,d),isDirty:fe(Re,Ge)})):Et&&!Et._f&&!oc(Ge)?rt(Re,Ge,Ke):He(Re,Ge,Ke),RJ(Re,y)&&A.state.next({...i}),A.values.next({name:p.mount?Re:void 0,values:{...d}})},Ce=async Re=>{p.mount=!0;const Fe=Re.target;let Ke=Fe.name,Et=!0;const bt=on(a,Ke),Ge=()=>Fe.type?lU(bt._f):zBe(Re),Ot=Jt=>{Et=Number.isNaN(Jt)||Ey(Jt)&&isNaN(Jt.getTime())||ag(Jt,on(d,Ke,Jt))};if(bt){let Jt,fn;const an=Ge(),ir=Re.type===TJ.BLUR||Re.type===TJ.FOCUS_OUT,la=!i6e(bt._f)&&!e.resolver&&!on(i.errors,Ke)&&!bt._f.deps||s6e(ir,on(i.touchedFields,Ke),i.isSubmitted,V,N),Vt=RJ(Ke,y,ir);Yi(d,Ke,an),ir?(bt._f.onBlur&&bt._f.onBlur(Re),v&&v(0)):bt._f.onChange&&bt._f.onChange(Re);const sn=ge(Ke,an,ir,!1),ki=!Hc(sn)||Vt;if(!ir&&A.values.next({name:Ke,type:Re.type,values:{...d}}),la)return w.isValid&&(e.mode==="onBlur"&&ir?G():ir||G()),ki&&A.state.next({name:Ke,...Vt?{}:sn});if(!ir&&Vt&&A.state.next({...i}),e.resolver){const{errors:_i}=await Z([Ke]);if(Ot(an),Et){const Ri=NJ(i.errors,a,Ke),dr=NJ(_i,a,Ri.name||Ke);Jt=dr.error,Ke=dr.name,fn=Hc(_i)}}else ee([Ke],!0),Jt=(await OJ(bt,y.disabled,d,j,e.shouldUseNativeValidation))[Ke],ee([Ke]),Ot(an),Et&&(Jt?fn=!1:w.isValid&&(fn=await se(a,!0)));Et&&(bt._f.deps&&Ne(bt._f.deps),te(Ke,fn,Jt,sn))}},ve=(Re,Fe)=>{if(on(i.errors,Fe)&&Re.focus)return Re.focus(),1},Ne=async(Re,Fe={})=>{let Ke,Et;const bt=_k(Re);if(e.resolver){const Ge=await J($s(Re)?Re:bt);Ke=Hc(Ge),Et=Re?!bt.some(Ot=>on(Ge,Ot)):Ke}else Re?(Et=(await Promise.all(bt.map(async Ge=>{const Ot=on(a,Ge);return await se(Ot&&Ot._f?{[Ge]:Ot}:Ot)}))).every(Boolean),!(!Et&&!i.isValid)&&G()):Et=Ke=await se(a);return A.state.next({...!$h(Re)||w.isValid&&Ke!==i.isValid?{}:{name:Re},...e.resolver||!Re?{isValid:Ke}:{},errors:i.errors}),Fe.shouldFocus&&!Et&&uR(a,ve,Re?bt:y.mount),Et},Te=Re=>{const Fe={...p.mount?d:l};return $s(Re)?Fe:$h(Re)?on(Fe,Re):Re.map(Ke=>on(Fe,Ke))},be=(Re,Fe)=>({invalid:!!on((Fe||i).errors,Re),isDirty:!!on((Fe||i).dirtyFields,Re),error:on((Fe||i).errors,Re),isValidating:!!on(i.validatingFields,Re),isTouched:!!on((Fe||i).touchedFields,Re)}),Ae=Re=>{Re&&_k(Re).forEach(Fe=>oo(i.errors,Fe)),A.state.next({errors:Re?i.errors:{}})},Ue=(Re,Fe,Ke)=>{const Et=(on(a,Re,{_f:{}})._f||{}).ref,bt=on(i.errors,Re)||{},{ref:Ge,message:Ot,type:Jt,...fn}=bt;Yi(i.errors,Re,{...fn,...Fe,ref:Et}),A.state.next({name:Re,errors:i.errors,isValid:!1}),Ke&&Ke.shouldFocus&&Et&&Et.focus&&Et.focus()},ze=(Re,Fe)=>Wh(Re)?A.values.subscribe({next:Ke=>Re(ue(void 0,Fe),Ke)}):ue(Re,Fe,!0),et=(Re,Fe={})=>{for(const Ke of Re?_k(Re):y.mount)y.mount.delete(Ke),y.array.delete(Ke),Fe.keepValue||(oo(a,Ke),oo(d,Ke)),!Fe.keepError&&oo(i.errors,Ke),!Fe.keepDirty&&oo(i.dirtyFields,Ke),!Fe.keepTouched&&oo(i.touchedFields,Ke),!Fe.keepIsValidating&&oo(i.validatingFields,Ke),!e.shouldUnregister&&!Fe.keepDefaultValue&&oo(l,Ke);A.values.next({values:{...d}}),A.state.next({...i,...Fe.keepDirty?{isDirty:fe()}:{}}),!Fe.keepIsValid&&G()},nt=({disabled:Re,name:Fe,field:Ke,fields:Et})=>{(Uh(Re)&&p.mount||Re||y.disabled.has(Fe))&&(Re?y.disabled.add(Fe):y.disabled.delete(Fe),ge(Fe,lU(Ke?Ke._f:on(Et,Fe)._f),!1,!1,!0))},dt=(Re,Fe={})=>{let Ke=on(a,Re);const Et=Uh(Fe.disabled)||Uh(e.disabled);return Yi(a,Re,{...Ke||{},_f:{...Ke&&Ke._f?Ke._f:{ref:{name:Re}},name:Re,mount:!0,...Fe}}),y.mount.add(Re),Ke?nt({field:Ke,disabled:Uh(Fe.disabled)?Fe.disabled:e.disabled,name:Re}):oe(Re,!0,Fe.value),{...Et?{disabled:Fe.disabled||e.disabled}:{},...e.progressive?{required:!!Fe.required,min:pw(Fe.min),max:pw(Fe.max),minLength:pw(Fe.minLength),maxLength:pw(Fe.maxLength),pattern:pw(Fe.pattern)}:{},name:Re,onChange:Ce,onBlur:Ce,ref:bt=>{if(bt){dt(Re,Fe),Ke=on(a,Re);const Ge=$s(bt.value)&&bt.querySelectorAll&&bt.querySelectorAll("input,select,textarea")[0]||bt,Ot=t6e(Ge),Jt=Ke._f.refs||[];if(Ot?Jt.find(fn=>fn===Ge):Ge===Ke._f.ref)return;Yi(a,Re,{_f:{...Ke._f,...Ot?{refs:[...Jt.filter(cU),Ge,...Array.isArray(on(l,Re))?[{}]:[]],ref:{type:Ge.type,name:Re}}:{ref:Ge}}}),oe(Re,!1,void 0,Ge)}else Ke=on(a,Re,{}),Ke._f&&(Ke._f.mount=!1),(e.shouldUnregister||Fe.shouldUnregister)&&!(HBe(y.array,Re)&&p.action)&&y.unMount.add(Re)}}},Xe=()=>e.shouldFocusError&&uR(a,ve,y.mount),It=Re=>{Uh(Re)&&(A.state.next({disabled:Re}),uR(a,(Fe,Ke)=>{const Et=on(a,Ke);Et&&(Fe.disabled=Et._f.disabled||Re,Array.isArray(Et._f.refs)&&Et._f.refs.forEach(bt=>{bt.disabled=Et._f.disabled||Re}))},0,!1))},hn=(Re,Fe)=>async Ke=>{let Et;Ke&&(Ke.preventDefault&&Ke.preventDefault(),Ke.persist&&Ke.persist());let bt=Tu(d);if(y.disabled.size)for(const Ge of y.disabled)Yi(bt,Ge,void 0);if(A.state.next({isSubmitting:!0}),e.resolver){const{errors:Ge,values:Ot}=await Z();i.errors=Ge,bt=Ot}else await se(a);if(oo(i.errors,"root"),Hc(i.errors)){A.state.next({errors:{}});try{await Re(bt,Ke)}catch(Ge){Et=Ge}}else Fe&&await Fe({...i.errors},Ke),Xe(),setTimeout(Xe);if(A.state.next({isSubmitted:!0,isSubmitting:!1,isSubmitSuccessful:Hc(i.errors)&&!Et,submitCount:i.submitCount+1,errors:i.errors}),Et)throw Et},Ut=(Re,Fe={})=>{on(a,Re)&&($s(Fe.defaultValue)?we(Re,Tu(on(l,Re))):(we(Re,Fe.defaultValue),Yi(l,Re,Tu(Fe.defaultValue))),Fe.keepTouched||oo(i.touchedFields,Re),Fe.keepDirty||(oo(i.dirtyFields,Re),i.isDirty=Fe.defaultValue?fe(Re,Tu(on(l,Re))):fe()),Fe.keepError||(oo(i.errors,Re),w.isValid&&G()),A.state.next({...i}))},ln=(Re,Fe={})=>{const Ke=Re?Tu(Re):l,Et=Tu(Ke),bt=Hc(Re),Ge=bt?l:Et;if(Fe.keepDefaultValues||(l=Ke),!Fe.keepValues){if(Fe.keepDirtyValues){const Ot=new Set([...y.mount,...Object.keys(fw(l,d))]);for(const Jt of Array.from(Ot))on(i.dirtyFields,Jt)?Yi(Ge,Jt,on(d,Jt)):we(Jt,on(Ge,Jt))}else{if(U4&&$s(Re))for(const Ot of y.mount){const Jt=on(a,Ot);if(Jt&&Jt._f){const fn=Array.isArray(Jt._f.refs)?Jt._f.refs[0]:Jt._f.ref;if(r1(fn)){const an=fn.closest("form");if(an){an.reset();break}}}}a={}}d=e.shouldUnregister?Fe.keepDefaultValues?Tu(l):{}:Tu(Ge),A.array.next({values:{...Ge}}),A.values.next({values:{...Ge}})}y={mount:Fe.keepDirtyValues?y.mount:new Set,unMount:new Set,array:new Set,disabled:new Set,watch:new Set,watchAll:!1,focus:""},p.mount=!w.isValid||!!Fe.keepIsValid||!!Fe.keepDirtyValues,p.watch=!!e.shouldUnregister,A.state.next({submitCount:Fe.keepSubmitCount?i.submitCount:0,isDirty:bt?!1:Fe.keepDirty?i.isDirty:!!(Fe.keepDefaultValues&&!ag(Re,l)),isSubmitted:Fe.keepIsSubmitted?i.isSubmitted:!1,dirtyFields:bt?{}:Fe.keepDirtyValues?Fe.keepDefaultValues&&d?fw(l,d):i.dirtyFields:Fe.keepDefaultValues&&Re?fw(l,Re):Fe.keepDirty?i.dirtyFields:{},touchedFields:Fe.keepTouched?i.touchedFields:{},errors:Fe.keepErrors?i.errors:{},isSubmitSuccessful:Fe.keepIsSubmitSuccessful?i.isSubmitSuccessful:!1,isSubmitting:!1})},xn=(Re,Fe)=>ln(Wh(Re)?Re(d):Re,Fe);return{control:{register:dt,unregister:et,getFieldState:be,handleSubmit:hn,setError:Ue,_executeSchema:Z,_getWatch:ue,_getDirty:fe,_updateValid:G,_removeUnmounted:he,_updateFieldArray:K,_updateDisabledField:nt,_getFieldArray:Me,_reset:ln,_resetDefaultValues:()=>Wh(e.defaultValues)&&e.defaultValues().then(Re=>{xn(Re,e.resetOptions),A.state.next({isLoading:!1})}),_updateFormState:Re=>{i={...i,...Re}},_disableForm:It,_subjects:A,_proxyFormState:w,_setErrors:ce,get _fields(){return a},get _formValues(){return d},get _state(){return p},set _state(Re){p=Re},get _defaultValues(){return l},get _names(){return y},set _names(Re){y=Re},get _formState(){return i},set _formState(Re){i=Re},get _options(){return e},set _options(Re){e={...e,...Re}}},trigger:Ne,register:dt,handleSubmit:hn,watch:ze,setValue:we,getValues:Te,reset:xn,resetField:Ut,clearErrors:Ae,unregister:et,setError:Ue,setFocus:(Re,Fe={})=>{const Ke=on(a,Re),Et=Ke&&Ke._f;if(Et){const bt=Et.refs?Et.refs[0]:Et.ref;bt.focus&&(bt.focus(),Fe.shouldSelect&&Wh(bt.select)&&bt.select())}},getFieldState:be}}function Yse(n={}){const e=ri.useRef(void 0),i=ri.useRef(void 0),[a,l]=ri.useState({isDirty:!1,isValidating:!1,isLoading:Wh(n.defaultValues),isSubmitted:!1,isSubmitting:!1,isSubmitSuccessful:!1,isValid:!1,submitCount:0,dirtyFields:{},touchedFields:{},validatingFields:{},errors:n.errors||{},disabled:n.disabled||!1,defaultValues:Wh(n.defaultValues)?void 0:n.defaultValues});e.current||(e.current={...c6e(n),formState:a});const d=e.current.control;return d._options=n,YBe({subject:d._subjects.state,next:p=>{qBe(p,d._proxyFormState,d._updateFormState)&&l({...d._formState})}}),ri.useEffect(()=>d._disableForm(n.disabled),[d,n.disabled]),ri.useEffect(()=>{if(d._proxyFormState.isDirty){const p=d._getDirty();p!==a.isDirty&&d._subjects.state.next({isDirty:p})}},[d,a.isDirty]),ri.useEffect(()=>{n.values&&!ag(n.values,i.current)?(d._reset(n.values,d._options.resetOptions),i.current=n.values,l(p=>({...p}))):d._resetDefaultValues()},[n.values,d]),ri.useEffect(()=>{n.errors&&d._setErrors(n.errors)},[n.errors,d]),ri.useEffect(()=>{d._state.mount||(d._updateValid(),d._state.mount=!0),d._state.watch&&(d._state.watch=!1,d._subjects.state.next({...d._formState})),d._removeUnmounted()}),ri.useEffect(()=>{n.shouldUnregister&&d._subjects.values.next({values:d._getWatch()})},[n.shouldUnregister,d]),e.current.formState=KBe(a,d),e.current}const fN=(n,e="generic-modal")=>{D.useEffect(()=>{if(!window.unityInstance)return;const i=()=>{try{window.unityInstance.SendMessage("WebGLInputManager","Disable"),_e.log(`Unity input disabled for ${e}`),document.body.classList.add("unity-input-disabled"),window.unityInputDisabled=!0,window.unityInputDisabledBy=e}catch(l){_e.error(`Failed to disable Unity input for ${e}:`,l)}},a=()=>{try{window.unityInputDisabledBy===e?(window.unityInstance.SendMessage("WebGLInputManager","Enable"),_e.log(`Unity input re-enabled (was disabled by ${e})`),document.body.classList.remove("unity-input-disabled"),window.unityInputDisabled=!1,window.unityInputDisabledBy=null):_e.log(`Not re-enabling Unity input for ${e} because it was disabled by ${window.unityInputDisabledBy}`)}catch(l){_e.error(`Failed to enable Unity input for ${e}:`,l)}};return n?i():a(),()=>{n&&a()}},[n,e])};function pN({mode:n,label:e,buttonProps:i={},isOpen:a,onClose:l}){const{register:d,handleSubmit:p,formState:{errors:y}}=Yse(),{register:v}=D.useContext(ca),b=xu(),{fullscreenRef:w}=Ud(),[A,N]=D.useState(!1),[V,j]=D.useState(!1),B=a!==void 0?a:A,G=l||(()=>N(!1));fN(B);const ee=async ce=>{const{email:oe,password:ge,confirmPassword:te,...Z}=ce;if(ge!==te){b({title:"Error",description:"Passwords do not match.",status:"error",duration:3e3,isClosable:!0,position:"top"});return}j(!0);try{const J=await v(oe,ge,Z);_e.log("User: Registration process complete."),G(),b({title:"Registration Successful",description:"Your account has been created. Please check your email to verify your account before signing in.",status:"success",duration:7e3,isClosable:!0,position:"top"})}catch(J){_e.error("User: Registration Error:",J),b({title:"Error",description:"An error occurred during registration. Please try again.",status:"error",duration:3e3,isClosable:!0,position:"top"})}finally{j(!1)}},K=()=>{l?l():N(!A)},ne=n==="link"?C.jsx(Iu,{variant:"header",onClick:K,children:e}):C.jsx(zr,{onClick:K,...i,children:e});return C.jsxs(C.Fragment,{children:[!a&&ne,C.jsxs(ra,{isOpen:B,onClose:G,size:"md",portalProps:{containerRef:w},isCentered:!0,motionPreset:"slideInBottom",blockScrollOnMount:!1,children:[C.jsx(oa,{bg:"blackAlpha.800",backdropFilter:"blur(5px)"}),C.jsxs(ia,{bg:"gray.800",borderRadius:"xl",boxShadow:"xl",color:"white",maxW:"md",mx:4,position:"relative",zIndex:9999,sx:{isolation:"isolate","& input":{position:"relative",zIndex:1e4,isolation:"isolate"},"& *":{pointerEvents:"auto !important"}},onKeyDown:ce=>{ce.stopPropagation()},children:[C.jsxs(tl,{p:8,textAlign:"center",children:[C.jsx(xk,{size:"lg",mb:2,children:"Create Account"}),C.jsx(ht,{fontSize:"sm",color:"gray.400",children:"Fill in your details to get started"})]}),C.jsx(ja,{color:"gray.400"}),C.jsx(sa,{px:8,children:C.jsx("form",{onSubmit:p(ee),children:C.jsxs(ii,{spacing:4,children:[C.jsxs(pi,{isInvalid:y.companyName,isRequired:!0,children:[C.jsx(ls,{placeholder:"Company Name",bg:"gray.700",border:"none",color:"white",_placeholder:{color:"gray.500"},_hover:{bg:"gray.600"},_focus:{bg:"gray.600",boxShadow:"0 0 0 1px var(--chakra-colors-blue-400)"},...d("companyName",{required:"Company name is required"})}),C.jsx(hp,{children:y.companyName&&y.companyName.message})]}),C.jsxs(mi,{gap:4,w:"100%",children:[C.jsxs(pi,{isInvalid:y.firstName,isRequired:!0,children:[C.jsx(ls,{placeholder:"First Name",bg:"gray.700",border:"none",color:"white",_placeholder:{color:"gray.500"},_hover:{bg:"gray.600"},_focus:{bg:"gray.600",boxShadow:"0 0 0 1px var(--chakra-colors-blue-400)"},...d("firstName",{required:"First name is required"})}),C.jsx(hp,{children:y.firstName&&y.firstName.message})]}),C.jsxs(pi,{isInvalid:y.lastName,isRequired:!0,children:[C.jsx(ls,{placeholder:"Last Name",bg:"gray.700",border:"none",color:"white",_placeholder:{color:"gray.500"},_hover:{bg:"gray.600"},_focus:{bg:"gray.600",boxShadow:"0 0 0 1px var(--chakra-colors-blue-400)"},...d("lastName",{required:"Last name is required"})}),C.jsx(hp,{children:y.lastName&&y.lastName.message})]})]}),C.jsxs(pi,{isInvalid:y.email,isRequired:!0,children:[C.jsx(ls,{type:"email",placeholder:"Work Email Address",bg:"gray.700",border:"none",color:"white",_placeholder:{color:"gray.500"},_hover:{bg:"gray.600"},_focus:{bg:"gray.600",boxShadow:"0 0 0 1px var(--chakra-colors-blue-400)"},...d("email",{required:"Email is required",pattern:{value:/^[^@ \t\r\n]+@[^@ \t\r\n]+\.[^@ \t\r\n]+$/,message:"Invalid email address"}})}),C.jsx(hp,{children:y.email&&y.email.message})]}),C.jsxs(mi,{gap:4,w:"100%",children:[C.jsxs(pi,{isInvalid:y.password,isRequired:!0,children:[C.jsx(ls,{type:"password",placeholder:"Password",bg:"gray.700",border:"none",color:"white",_placeholder:{color:"gray.500"},_hover:{bg:"gray.600"},_focus:{bg:"gray.600",boxShadow:"0 0 0 1px var(--chakra-colors-blue-400)"},...d("password",{required:"Password is required",minLength:{value:8,message:"Password must be at least 8 characters long"}})}),C.jsx(hp,{children:y.password&&y.password.message})]}),C.jsxs(pi,{isInvalid:y.confirmPassword,isRequired:!0,children:[C.jsx(ls,{type:"password",placeholder:"Confirm Password",bg:"gray.700",border:"none",color:"white",_placeholder:{color:"gray.500"},_hover:{bg:"gray.600"},_focus:{bg:"gray.600",boxShadow:"0 0 0 1px var(--chakra-colors-blue-400)"},...d("confirmPassword",{required:"Confirm password is required"})}),C.jsx(hp,{children:y.confirmPassword&&y.confirmPassword.message})]})]}),C.jsx(pi,{children:C.jsx(ls,{placeholder:"Access Code",bg:"gray.700",border:"none",color:"white",_placeholder:{color:"gray.500"},_hover:{bg:"gray.600"},_focus:{bg:"gray.600",boxShadow:"0 0 0 1px var(--chakra-colors-blue-400)"},...d("accessCode")})}),C.jsx(pi,{children:C.jsx(ls,{placeholder:"LinkedIn Profile (optional)",bg:"gray.700",border:"none",color:"white",_placeholder:{color:"gray.500"},_hover:{bg:"gray.600"},_focus:{bg:"gray.600",boxShadow:"0 0 0 1px var(--chakra-colors-blue-400)"},...d("linkedInProfile")})})]})})}),C.jsxs(bg,{px:8,pb:8,flexDirection:"column",gap:4,children:[C.jsx(zr,{type:"submit",colorScheme:"blue",size:"lg",width:"100%",onClick:p(ee),isLoading:V,loadingText:"Creating Account",children:"Create Account"}),C.jsxs(ht,{fontSize:"sm",color:"gray.400",textAlign:"center",children:["Already have an account?"," ",C.jsx(Iu,{color:"blue.400",onClick:()=>{G(),window.dispatchEvent(new CustomEvent("openSignInModal"))},children:"Sign In"})]})]})]})]})]})}pN.propTypes={mode:mr.oneOf(["button","link"]),label:mr.string,buttonProps:mr.object,isOpen:mr.bool,onClose:mr.func};function mN({mode:n="button",label:e="Sign In",buttonProps:i={},initialIsOpen:a=!1}){const{signIn:l}=D.useContext(ca),{fullscreenRef:d}=Ud(),p=xu(),{register:y,handleSubmit:v,formState:{errors:b,isSubmitting:w}}=Yse({defaultValues:{email:"neil@pursey.net",password:"123456"}}),[A,N]=D.useState(a),[V,j]=D.useState(!1),[B,G]=D.useState(!1),[ee,K]=D.useState(""),[ne,ce]=D.useState(!1);fN(A||B),D.useEffect(()=>{const he=()=>{N(!0)};return window.addEventListener("openSignInModal",he),()=>{window.removeEventListener("openSignInModal",he)}},[]);const oe=async he=>{try{await l(he.email,he.password),_e.log("User: Sign-in process complete."),N(!1),window.location.reload()}catch(fe){_e.error("User: SignIn Error:",fe);const ue=fe.message||"An error occurred while logging in. Please check your credentials.",Me=ue.includes("verify your email");p({title:Me?"Email Verification Required":"Error",description:ue,status:Me?"warning":"error",duration:1e4,isClosable:!0,position:"top",container:d.current})}},ge=async()=>{if(!ee){p({title:"Email Required",description:"Please enter your email address to reset your password.",status:"warning",duration:3e3,isClosable:!0,position:"top",container:d.current});return}try{ce(!0),await UVe(Ese,ee),p({title:"Password Reset Email Sent",description:"Check your email for instructions to reset your password.",status:"success",duration:5e3,isClosable:!0,position:"top",container:d.current}),G(!1)}catch(he){_e.error("User: Reset Password Error:",he),p({title:"Error",description:he.message||"Failed to send password reset email. Please try again.",status:"error",duration:5e3,isClosable:!0,position:"top",container:d.current})}finally{ce(!1)}},te=()=>N(he=>!he),Z=()=>{N(!1),j(!0)},J=()=>{G(!0)},se=n==="link"?C.jsx(Iu,{variant:"header",onClick:te,children:e}):C.jsx(zr,{onClick:te,...i,children:e});return C.jsxs(C.Fragment,{children:[se,C.jsxs(ra,{isOpen:A,onClose:te,size:"md",portalProps:{containerRef:d},isCentered:!0,motionPreset:"slideInBottom",blockScrollOnMount:!1,children:[C.jsx(oa,{bg:"blackAlpha.800",backdropFilter:"blur(5px)"}),C.jsx("form",{onSubmit:v(oe),children:C.jsxs(ia,{bg:"gray.800",borderRadius:"xl",boxShadow:"xl",color:"white",maxW:"md",mx:4,position:"relative",zIndex:9999,sx:{isolation:"isolate","& input":{position:"relative",zIndex:1e4,isolation:"isolate"},"& *":{pointerEvents:"auto !important"}},onKeyDown:he=>{he.stopPropagation()},children:[C.jsxs(tl,{p:8,textAlign:"center",children:[C.jsx(xk,{size:"lg",mb:2,children:"Welcome Back"}),C.jsx(ht,{fontSize:"sm",color:"gray.400",children:"Enter your credentials to access your account"})]}),C.jsx(ja,{color:"gray.400"}),C.jsx(sa,{px:8,pb:8,children:C.jsxs(ii,{spacing:4,children:[C.jsxs(pi,{isInvalid:b.email,children:[C.jsxs(tk,{children:[C.jsx(nR,{pointerEvents:"none",children:C.jsx(bJ,{color:"gray.500"})}),C.jsx(ls,{type:"email",placeholder:"Email",bg:"gray.700",border:"none",color:"white",_placeholder:{color:"gray.500"},_hover:{bg:"gray.600"},_focus:{bg:"gray.600",boxShadow:"0 0 0 1px var(--chakra-colors-blue-400)"},...y("email",{required:"Email is required."})})]}),C.jsx(hp,{children:b.email&&b.email.message})]}),C.jsxs(pi,{isInvalid:b.password,children:[C.jsxs(tk,{children:[C.jsx(nR,{pointerEvents:"none",children:C.jsx(FBe,{color:"gray.500"})}),C.jsx(ls,{type:"password",placeholder:"Password",bg:"gray.700",border:"none",color:"white",_placeholder:{color:"gray.500"},_hover:{bg:"gray.600"},_focus:{bg:"gray.600",boxShadow:"0 0 0 1px var(--chakra-colors-blue-400)"},...y("password",{required:"Password is required."})})]}),C.jsx(hp,{children:b.password&&b.password.message})]}),C.jsx(St,{alignSelf:"flex-end",children:C.jsx(Iu,{color:"blue.400",fontSize:"sm",onClick:J,children:"Forgot Password?"})})]})}),C.jsxs(bg,{px:8,pb:8,flexDirection:"column",gap:4,children:[C.jsx(zr,{type:"submit",colorScheme:"blue",size:"lg",width:"100%",isLoading:w,loadingText:"Signing In",children:"Sign In"}),C.jsxs(ht,{fontSize:"sm",color:"gray.400",textAlign:"center",children:["Don't have an account?"," ",C.jsx(Iu,{color:"blue.400",onClick:Z,children:"Sign Up"})]})]})]})})]}),C.jsxs(ra,{isOpen:B,onClose:()=>G(!1),size:"md",portalProps:{containerRef:d},isCentered:!0,motionPreset:"slideInBottom",blockScrollOnMount:!1,children:[C.jsx(oa,{bg:"blackAlpha.800",backdropFilter:"blur(5px)"}),C.jsxs(ia,{bg:"gray.800",borderRadius:"xl",boxShadow:"xl",color:"white",maxW:"md",mx:4,position:"relative",zIndex:9999,sx:{isolation:"isolate","& input":{position:"relative",zIndex:1e4,isolation:"isolate"},"& *":{pointerEvents:"auto !important"}},onKeyDown:he=>{he.stopPropagation()},children:[C.jsxs(tl,{p:8,textAlign:"center",children:[C.jsx(xk,{size:"lg",mb:2,children:"Reset Password"}),C.jsx(ht,{fontSize:"sm",color:"gray.400",children:"Enter your email to receive password reset instructions"})]}),C.jsx(ja,{color:"gray.400"}),C.jsx(sa,{px:8,pb:4,children:C.jsx(pi,{children:C.jsxs(tk,{children:[C.jsx(nR,{pointerEvents:"none",children:C.jsx(bJ,{color:"gray.500"})}),C.jsx(ls,{type:"email",placeholder:"Email",bg:"gray.700",border:"none",color:"white",_placeholder:{color:"gray.500"},_hover:{bg:"gray.600"},_focus:{bg:"gray.600",boxShadow:"0 0 0 1px var(--chakra-colors-blue-400)"},value:ee,onChange:he=>K(he.target.value)})]})})}),C.jsxs(bg,{px:8,pb:8,flexDirection:"column",gap:4,children:[C.jsx(zr,{colorScheme:"blue",size:"lg",width:"100%",onClick:ge,isLoading:ne,loadingText:"Sending",children:"Send Reset Link"}),C.jsxs(ht,{fontSize:"sm",color:"gray.400",textAlign:"center",children:["Remember your password?"," ",C.jsx(Iu,{color:"blue.400",onClick:()=>G(!1),children:"Back to Sign In"})]})]})]})]}),C.jsx(pN,{mode:"link",isOpen:V,onClose:()=>j(!1)})]})}mN.propTypes={mode:mr.oneOf(["button","link"]),label:mr.string,buttonProps:mr.object,initialIsOpen:mr.bool};function B4({mode:n="button",label:e="Sign Out"}){const i=xu(),{signOut:a}=D.useContext(ca),{fullscreenRef:l}=Ud(),d=async()=>{try{await a(),i({title:"Logged Out",description:"You have been successfully logged out.",status:"success",duration:3e3,isClosable:!0,position:"top",container:l.current}),window.location.href="/"}catch(y){console.error("SignOut Error:",y),i({title:"Error",description:"An error occurred while logging out.",status:"error",duration:3e3,isClosable:!0,position:"top",container:l.current})}},p=n==="link"?C.jsx(Iu,{variant:"header",onClick:d,style:{cursor:"pointer"},children:e}):null;return C.jsx(C.Fragment,{children:p})}B4.propTypes={mode:mr.oneOf(["button","link"]),label:mr.string};const C0=()=>window.unityInstance||window.gameInstance||window.reactUnityInstance,W4=()=>{document.body.classList.add("unity-focused");const n=["ArrowUp","ArrowDown","ArrowLeft","ArrowRight","Space","PageUp","PageDown","Home","End"],e=a=>{if(n.includes(a.key)){const l=a.target.tagName==="INPUT"||a.target.tagName==="TEXTAREA"||a.target.isContentEditable,d=document.querySelector("canvas")||document.getElementById("unity-canvas"),p=a.target.closest("canvas")||a.target.closest("#webgl-root"),y=document.activeElement===d;!l&&(p||y)&&a.preventDefault()}},i=a=>{document.querySelector("canvas")||document.getElementById("unity-canvas"),document.getElementById("unity-container")||document.getElementById("webgl-root"),a.target.closest("canvas")||a.target.closest("#webgl-root")?document.body.classList.add("unity-focused"):document.body.classList.remove("unity-focused")};return document.addEventListener("keydown",e),document.addEventListener("click",i),()=>{document.body.classList.remove("unity-focused"),document.removeEventListener("keydown",e),document.removeEventListener("click",i)}},Xse=()=>{document.body.classList.remove("unity-focused")};function o1(n){return console.log(`Setting Unity keyboard capture: ${n}`),n?(document.body.classList.add("unity-focused"),window.unityKeyboardEnabled=!0):(document.body.classList.remove("unity-focused"),window.unityKeyboardEnabled=!1),n?W4():Xse(),new Promise(e=>{try{const i=C0();if(i){try{n?i.SendMessage("WebGLInput","EnableKeyboardCapture"):i.SendMessage("WebGLInput","DisableKeyboardCapture"),console.log(`Unity keyboard capture ${n?"enabled":"disabled"} (using Unity preferred method)`),e(!0);return}catch(a){console.warn("Failed to use Unity preferred keyboard method, falling back to SetCaptureAllKeyboardInput",a)}try{i.SendMessage("WebGLInput","SetCaptureAllKeyboardInput",n),console.log(`Unity keyboard capture ${n?"enabled":"disabled"} (using fallback method)`),e(!0);return}catch(a){console.warn("Failed to use SetCaptureAllKeyboardInput, trying module method",a)}if(i.Module){!n&&i.Module.WebGLInputHandler&&!window._originalWebGLInputHandler&&(window._originalWebGLInputHandler=i.Module.WebGLInputHandler),n&&window._originalWebGLInputHandler?(i.Module.WebGLInputHandler=window._originalWebGLInputHandler,window._originalWebGLInputHandler=null):n||(i.Module.WebGLInputHandler=null),console.log(`Unity keyboard capture ${n?"enabled":"disabled"} (using Module method)`),e(!0);return}}else console.warn("Unity instance not available, cannot set keyboard capture"),window.__pendingKeyboardCaptureState=n,document.getElementById("webgl-root")&&(console.log("webgl-root detected, will poll for Unity instance"),$V(n)),e(!1)}catch(i){console.error("Error setting Unity keyboard capture:",i),e(!1)}})}function $V(n){window.__unityInstancePoller&&clearTimeout(window.__unityInstancePoller);const e=20;let i=0;const a=()=>{i++;const l=C0();if(l){console.log(`Unity instance found after ${i} attempts`);try{n?l.SendMessage("WebGLInput","EnableKeyboardCapture"):l.SendMessage("WebGLInput","DisableKeyboardCapture"),console.log(`Applied pending keyboard state: ${n}`),window.__pendingKeyboardCaptureState=null}catch(d){console.warn("Failed to apply pending keyboard state with preferred method, trying fallback",d);try{l.SendMessage("WebGLInput","SetCaptureAllKeyboardInput",n),console.log(`Applied pending keyboard state: ${n} (fallback method)`),window.__pendingKeyboardCaptureState=null}catch(p){console.error("Failed to apply pending keyboard state with fallback method",p)}}}else if(i<e){const d=Math.min(500*Math.pow(1.2,i),5e3);console.log(`Unity instance not found (attempt ${i}/${e}), retrying in ${d}ms`),window.__unityInstancePoller=setTimeout(a,d)}else console.warn(`Unity instance still not found after ${e} attempts, giving up`)};window.__unityInstancePoller=setTimeout(a,500)}function l6e(){const n=C0();if(!n)return!1;const e=document.querySelector("canvas")||document.getElementById("unity-canvas");return!!(e&&document.activeElement===e||n.Module&&n.Module.WebGLInputHandler)}function py(n=!0){return console.log("Focusing Unity canvas"),n?W4():Xse(),new Promise(e=>{try{const i=document.querySelector("canvas")||document.getElementById("unity-canvas");if(i){try{i.focus({preventScroll:!0})}catch{i.focus()}if(i.style.pointerEvents="auto",n){o1(!0).then(e);return}e(!0)}else console.warn("Unity canvas not found"),e(!1)}catch(i){console.error("Error focusing Unity canvas:",i),e(!1)}})}function kd(n=!0){return console.log(`${n?"Blocking":"Unblocking"} Unity keyboard input`),W4(),new Promise(e=>{try{if(n)o1(!1).then(i=>{var d;i&&console.log("Successfully disabled Unity keyboard capture");const a=document.querySelector("canvas")||document.getElementById("unity-canvas");a&&(a.blur(),a.style.pointerEvents="none"),window.__keyEventHandler||(window.__keyEventHandler=p=>{window.__blockKeyboardInput&&!["INPUT","TEXTAREA","SELECT"].includes(p.target.tagName)&&p.stopPropagation()},document.addEventListener("keydown",window.__keyEventHandler,!0),document.addEventListener("keyup",window.__keyEventHandler,!0),document.addEventListener("keypress",window.__keyEventHandler,!0)),window.__blockKeyboardInput=!0;const l=C0();(d=l==null?void 0:l.Module)!=null&&d.WebGLInputHandler&&(window._savedWebGLInputHandler=l.Module.WebGLInputHandler,l.Module.WebGLInputHandler=null),e(!0)});else{window.__blockKeyboardInput=!1,window.__keyEventHandler&&(document.removeEventListener("keydown",window.__keyEventHandler,!0),document.removeEventListener("keyup",window.__keyEventHandler,!0),document.removeEventListener("keypress",window.__keyEventHandler,!0),window.__keyEventHandler=null);const i=C0();i!=null&&i.Module&&window._savedWebGLInputHandler&&(i.Module.WebGLInputHandler=window._savedWebGLInputHandler,window._savedWebGLInputHandler=null);const a=document.querySelector("canvas")||document.getElementById("unity-canvas");a&&(a.style.pointerEvents="auto"),o1(!0).then(l=>{l&&console.log("Successfully re-enabled Unity keyboard capture"),e(!0)})}}catch(i){console.error("Error in blockUnityKeyboardInput:",i),e(!1)}})}function u6e(n){if(n){if(console.log("Registering Unity instance"),window.unityInstance=n,typeof window.__pendingKeyboardCaptureState=="boolean")try{const e=window.__pendingKeyboardCaptureState;console.log(`Applying pending keyboard state: ${e}`);try{e?n.SendMessage("WebGLInput","EnableKeyboardCapture"):n.SendMessage("WebGLInput","DisableKeyboardCapture"),console.log(`Applied pending keyboard state: ${e} (Unity preferred method)`),window.__pendingKeyboardCaptureState=null}catch(i){console.warn("Failed to apply pending keyboard state with preferred method, trying fallback",i);try{n.SendMessage("WebGLInput","SetCaptureAllKeyboardInput",e),console.log(`Applied pending keyboard state: ${e} (fallback method)`),window.__pendingKeyboardCaptureState=null}catch(a){console.error("Failed to apply pending keyboard state with fallback method",a)}}}catch(e){console.error("Error applying pending keyboard state:",e)}window.__unityInstancePoller&&(clearTimeout(window.__unityInstancePoller),window.__unityInstancePoller=null)}}function d6e(){if(console.log("Initializing Unity keyboard helpers"),window.setUnityKeyboardCapture=o1,window.focusUnity=py,window.blockUnityKeyboardInput=kd,window.hasUnityKeyboardFocus=l6e,window.getUnityInstance=C0,window.registerUnityInstance=u6e,document.getElementById("webgl-root")){const n=new MutationObserver(e=>{for(const i of e)if(i.addedNodes.length)for(let a=0;a<i.addedNodes.length;a++){const l=i.addedNodes[a];if(l.nodeName==="CANVAS"||l.querySelector&&l.querySelector("canvas")){console.log("Canvas detected, Unity might be loading. Setting up instance detection."),$V(!0),n.disconnect();break}}});n.observe(document.body,{childList:!0,subtree:!0}),document.querySelector("canvas")&&(console.log("Canvas already exists, Unity might be loaded. Starting instance detection."),$V(!0))}if(typeof window<"u"&&typeof require=="function")try{const n=require("react");window.useUnityKeyboardFocus=function(){const[i,a]=n.useState(!1);return n.useEffect(()=>(i?(console.log("useUnityKeyboardFocus: Blocking Unity keyboard input"),kd(!0),window.dispatchEvent(new CustomEvent("modal-opened"))):(console.log("useUnityKeyboardFocus: Unblocking Unity keyboard input"),kd(!1),window.dispatchEvent(new CustomEvent("modal-closed"))),()=>{i&&(console.log("useUnityKeyboardFocus: Cleanup - unblocking Unity keyboard input"),kd(!1),window.dispatchEvent(new CustomEvent("modal-closed")))}),[i]),[i,a]},console.log("Created useUnityKeyboardFocus hook globally")}catch(n){console.warn("Could not create React hook, React might not be available yet:",n)}}typeof window<"u"&&setTimeout(d6e,0);const h6e=({isOpen:n,onClose:e,user:i,profileImageUrl:a})=>{const[l,d]=D.useState(!1),[p,y]=D.useState({Nickname:(i==null?void 0:i.Nickname)||"",companyName:(i==null?void 0:i.companyName)||"",firstName:(i==null?void 0:i.firstName)||"",lastName:(i==null?void 0:i.lastName)||"",linkedInProfile:(i==null?void 0:i.linkedInProfile)||""}),[v,b]=D.useState(!1),[w,A]=D.useState(!1),N=xu(),{sendUserToUnity:V}=D.useContext(ca),j=D.useRef(null);D.useEffect(()=>{y({Nickname:(i==null?void 0:i.Nickname)||"",companyName:(i==null?void 0:i.companyName)||"",firstName:(i==null?void 0:i.firstName)||"",lastName:(i==null?void 0:i.lastName)||"",linkedInProfile:(i==null?void 0:i.linkedInProfile)||""})},[i]),D.useEffect(()=>(n?(console.log("ProfileModal: Modal opened, blocking Unity keyboard input"),kd(!0),window.dispatchEvent(new CustomEvent("modal-opened"))):(console.log("ProfileModal: Modal closed, unblocking Unity keyboard input"),kd(!1).then(()=>{setTimeout(()=>{py(!0)},100)}),window.dispatchEvent(new CustomEvent("modal-closed"))),()=>{n&&(console.log("ProfileModal: Cleanup on unmount, unblocking Unity keyboard input"),kd(!1),window.dispatchEvent(new CustomEvent("modal-closed")))}),[n]),D.useEffect(()=>{if(l&&j.current){const ce=()=>{j.current.focus(),A(!0),kd(!0)};ce();const oe=setTimeout(ce,100),ge=setTimeout(ce,300);return()=>{clearTimeout(oe),clearTimeout(ge)}}else A(!1)},[l]);const B=()=>{d(!1),A(!1),e()},G=ce=>{const{name:oe,value:ge}=ce.target;y(te=>({...te,[oe]:ge}))},ee=async()=>{if(p.Nickname.trim()===""){N({title:"Error",description:"Nickname cannot be empty",status:"error",duration:3e3,isClosable:!0});return}b(!0);try{const ce=Mi(gi,"users",i.uid),oe=gse(ce,ge=>{ge.exists()&&ge.data().Nickname===p.Nickname&&(V(),oe())});await nl(ce,{...p,lastUpdated:new Date().toISOString()}),await updateUser(),y({Nickname:p.Nickname,companyName:p.companyName,firstName:p.firstName,lastName:p.lastName,linkedInProfile:p.linkedInProfile}),N({title:"Success",description:"Profile updated successfully",status:"success",duration:3e3,isClosable:!0}),d(!1)}catch(ce){N({title:"Error",description:"Failed to update profile",status:"error",duration:3e3,isClosable:!0}),console.error("Error updating profile:",ce)}finally{b(!1)}},K=()=>C.jsxs(ii,{spacing:4,align:"stretch",w:"100%",children:[C.jsx(mi,{direction:"column",align:"center",gap:2,children:C.jsx(ht,{fontSize:"2xl",fontWeight:"bold",children:i.Nickname})}),C.jsxs(ii,{spacing:3,align:"stretch",bg:"gray.700",p:4,borderRadius:"md",children:[C.jsxs(mi,{direction:"column",children:[C.jsx(ht,{color:"gray.400",fontSize:"sm",children:"Company"}),C.jsx(ht,{children:i.companyName||"Not specified"})]}),C.jsxs(mi,{direction:"column",children:[C.jsx(ht,{color:"gray.400",fontSize:"sm",children:"Full Name"}),C.jsx(ht,{children:`${i.firstName||""} ${i.lastName||""}`.trim()||"Not specified"})]}),C.jsxs(mi,{direction:"column",children:[C.jsx(ht,{color:"gray.400",fontSize:"sm",children:"LinkedIn"}),C.jsx(ht,{children:i.linkedInProfile||"Not specified"})]})]}),C.jsx(zr,{onClick:()=>d(!0),size:"sm",variant:"outline",_hover:{bg:"gray.700"},color:"white",borderColor:"gray.600",children:"Edit Profile"})]}),ne=()=>C.jsxs(ii,{spacing:4,align:"stretch",w:"100%",children:[C.jsxs(pi,{children:[C.jsx(Io,{color:"gray.400",fontSize:"sm",children:"Nickname"}),C.jsx(ls,{ref:j,name:"Nickname",value:p.Nickname,onChange:G,onFocus:()=>{A(!0),kd(!0)},placeholder:"Enter nickname",bg:"gray.700",border:"none",color:"white",_placeholder:{color:"gray.500"},_hover:{bg:"gray.600"},_focus:{bg:"gray.600",boxShadow:"0 0 0 1px var(--chakra-colors-blue-400)"}})]}),C.jsxs(pi,{children:[C.jsx(Io,{color:"gray.400",fontSize:"sm",children:"Company Name"}),C.jsx(ls,{name:"companyName",value:p.companyName,onChange:G,placeholder:"Enter company name",bg:"gray.700",border:"none",color:"white",_placeholder:{color:"gray.500"},_hover:{bg:"gray.600"},_focus:{bg:"gray.600",boxShadow:"0 0 0 1px var(--chakra-colors-blue-400)"}})]}),C.jsxs(mi,{gap:4,children:[C.jsxs(pi,{children:[C.jsx(Io,{color:"gray.400",fontSize:"sm",children:"First Name"}),C.jsx(ls,{name:"firstName",value:p.firstName,onChange:G,placeholder:"Enter first name",bg:"gray.700",border:"none",color:"white",_placeholder:{color:"gray.500"},_hover:{bg:"gray.600"},_focus:{bg:"gray.600",boxShadow:"0 0 0 1px var(--chakra-colors-blue-400)"}})]}),C.jsxs(pi,{children:[C.jsx(Io,{color:"gray.400",fontSize:"sm",children:"Last Name"}),C.jsx(ls,{name:"lastName",value:p.lastName,onChange:G,placeholder:"Enter last name",bg:"gray.700",border:"none",color:"white",_placeholder:{color:"gray.500"},_hover:{bg:"gray.600"},_focus:{bg:"gray.600",boxShadow:"0 0 0 1px var(--chakra-colors-blue-400)"}})]})]}),C.jsxs(pi,{children:[C.jsx(Io,{color:"gray.400",fontSize:"sm",children:"LinkedIn Profile"}),C.jsx(ls,{name:"linkedInProfile",value:p.linkedInProfile,onChange:G,placeholder:"Enter LinkedIn profile URL",bg:"gray.700",border:"none",color:"white",_placeholder:{color:"gray.500"},_hover:{bg:"gray.600"},_focus:{bg:"gray.600",boxShadow:"0 0 0 1px var(--chakra-colors-blue-400)"}})]}),C.jsxs(mi,{gap:2,justify:"flex-end",mt:2,children:[C.jsx(zr,{onClick:()=>{y({Nickname:(i==null?void 0:i.Nickname)||"",companyName:(i==null?void 0:i.companyName)||"",firstName:(i==null?void 0:i.firstName)||"",lastName:(i==null?void 0:i.lastName)||"",linkedInProfile:(i==null?void 0:i.linkedInProfile)||""}),d(!1)},variant:"outline",size:"sm",isDisabled:v,color:"white",borderColor:"gray.600",_hover:{bg:"gray.700"},children:"Cancel"}),C.jsx(zr,{onClick:ee,colorScheme:"blue",size:"sm",isLoading:v,children:"Save Changes"})]})]});return C.jsxs(ra,{isOpen:n,onClose:B,isCentered:!0,closeOnOverlayClick:!l,trapFocus:!0,blockScrollOnMount:!1,size:"md",children:[C.jsx(oa,{backdropFilter:"blur(10px)"}),C.jsxs(ia,{bg:"gray.800",color:"white",children:[C.jsx(tl,{children:"Profile"}),C.jsx(ja,{}),C.jsx(sa,{pb:6,children:C.jsxs(ii,{spacing:6,children:[C.jsx(ku,{src:a,size:"2xl",borderRadius:"full"}),l?ne():K()]})})]})]})},xO={bg:"white",color:"black",borderRadius:"full",px:"6",py:"2",height:"auto",fontSize:"md",fontWeight:"medium",_hover:{bg:"gray.100"},display:"flex",alignItems:"center",gap:2},Jse=()=>{var w;const{user:n,updateUser:e}=D.useContext(ca),[i,a]=D.useState(!0),{isOpen:l,onOpen:d,onClose:p}=rf();D.useEffect(()=>{const A=setTimeout(()=>{a(!1)},500);return()=>clearTimeout(A)},[]);const y=()=>{p(),e()},v=n!=null&&n.rpmURL?n.rpmURL.replace(".glb",".png?scene=fullbody-portrait-closeupfront&w=640&q=75"):null,b=(w=n==null?void 0:n.groups)==null?void 0:w.includes("disruptiveAdmin");return i?null:C.jsx(mi,{align:"center",gap:"4",children:n?C.jsxs(C.Fragment,{children:[C.jsx(h6e,{isOpen:l,onClose:y,user:n,profileImageUrl:v}),C.jsxs(rC,{children:[C.jsx(iC,{as:St,cursor:"pointer",children:C.jsx(mi,{align:"center",height:"40px",px:4,borderRadius:"full",border:"1px solid rgba(255, 255, 255, 0.3)",transition:"all 0.2s",sx:{"&:hover":{border:"2px solid white"}},children:C.jsxs(mi,{align:"center",gap:"3",children:[C.jsx(St,{width:"28px",height:"28px",borderRadius:"full",overflow:"hidden",bg:"white",display:"flex",alignItems:"center",justifyContent:"center",children:C.jsx(ku,{src:v,width:"100%",height:"100%",borderRadius:"full"})}),C.jsx(ht,{color:"white",fontWeight:"medium",children:n.Nickname}),C.jsx(St,{display:"flex",alignItems:"center",height:"28px",children:C.jsx(jse,{color:"white",w:4,h:4})})]})})}),C.jsx(Vl,{children:C.jsxs(sC,{bg:"gray.800",borderColor:"gray.700",zIndex:9999,children:[C.jsxs(St,{p:4,display:"flex",alignItems:"center",gap:3,children:[C.jsx(ku,{src:v,size:"md",borderRadius:"full"}),C.jsx(ht,{fontSize:"xl",fontWeight:"bold",color:"white",children:n.Nickname})]}),C.jsx(Cp,{borderColor:"gray.700"}),b&&C.jsx(Pd,{as:"a",href:"/myadmin",_hover:{bg:"gray.700"},color:"white",bg:"gray.800",children:"My Admin"}),C.jsx(Pd,{_hover:{bg:"gray.700"},color:"white",bg:"gray.800",children:"My Spaces"}),C.jsx(Pd,{onClick:d,_hover:{bg:"gray.700"},color:"white",bg:"gray.800",children:"View Profile"}),C.jsx(Cp,{borderColor:"gray.700"}),C.jsx(Pd,{_hover:{bg:"gray.700"},color:"white",bg:"gray.800",children:"Support"}),C.jsx(Pd,{_hover:{bg:"gray.700"},color:"white",bg:"gray.800",children:C.jsx(B4,{mode:"link",label:"Log out",linkProps:{color:"white",_hover:{textDecoration:"none"}}})})]})})]})]}):C.jsxs(C.Fragment,{children:[C.jsx(pN,{mode:"button",label:"Register",buttonProps:{...xO,width:["100%","auto"]},customButton:C.jsxs(zr,{...xO,children:[C.jsx(St,{as:"span",fontSize:"xl",children:""}),"Register"]})}),C.jsx(mN,{mode:"button",label:"Sign In",buttonProps:{...xO,width:["100%","auto"]},customButton:C.jsxs(zr,{...xO,children:[C.jsx(St,{as:"span",fontSize:"xl",children:""}),"Sign In"]})})]})})},uU=document.getElementById("header-auth-root");if(uU){const n=uU.getAttribute("data-theme")||"default",e=()=>{const[i,a]=D.useState(null);return D.useEffect(()=>{OR(n).then(a)},[]),i?C.jsx(I1,{theme:i,children:C.jsx(dN,{children:C.jsx(M4,{children:C.jsx(Jse,{})})})}):C.jsx("div",{children:"Loading theme..."})};c1.createRoot(uU).render(C.jsx(e,{}))}else console.error("Root element 'header-auth-root' not found.");var dU={},mw={},gw={},DJ;function f6e(){if(DJ)return gw;DJ=1,Object.defineProperty(gw,"__esModule",{value:!0}),gw.useUnityCanvasId=void 0;var n=Ou(),e=0,i="react-unity-webgl-canvas",a=function(l){if(l.id!==void 0)return l.id;var d=(0,n.useMemo)(function(){return[i,++e].join("-")},[]);return d};return gw.useUnityCanvasId=a,gw}var up={},_w={},LJ;function Qse(){if(LJ)return _w;LJ=1,Object.defineProperty(_w,"__esModule",{value:!0}),_w.UnityLoaderStatus=void 0;var n;return function(e){e.Idle="Idle",e.Loading="Loading",e.Loaded="Loaded",e.Error="Error"}(n||(_w.UnityLoaderStatus=n={})),_w}var yw={},xJ;function z4(){return xJ||(xJ=1,Object.defineProperty(yw,"__esModule",{value:!0}),yw.isBrowserEnvironment=void 0,yw.isBrowserEnvironment=typeof window<"u"&&typeof document<"u"),yw}var MJ;function p6e(){if(MJ)return up;MJ=1;var n=up&&up.__awaiter||function(p,y,v,b){function w(A){return A instanceof v?A:new v(function(N){N(A)})}return new(v||(v=Promise))(function(A,N){function V(G){try{B(b.next(G))}catch(ee){N(ee)}}function j(G){try{B(b.throw(G))}catch(ee){N(ee)}}function B(G){G.done?A(G.value):w(G.value).then(V,j)}B((b=b.apply(p,y||[])).next())})},e=up&&up.__generator||function(p,y){var v={label:0,sent:function(){if(A[0]&1)throw A[1];return A[1]},trys:[],ops:[]},b,w,A,N=Object.create((typeof Iterator=="function"?Iterator:Object).prototype);return N.next=V(0),N.throw=V(1),N.return=V(2),typeof Symbol=="function"&&(N[Symbol.iterator]=function(){return this}),N;function V(B){return function(G){return j([B,G])}}function j(B){if(b)throw new TypeError("Generator is already executing.");for(;N&&(N=0,B[0]&&(v=0)),v;)try{if(b=1,w&&(A=B[0]&2?w.return:B[0]?w.throw||((A=w.return)&&A.call(w),0):w.next)&&!(A=A.call(w,B[1])).done)return A;switch(w=0,A&&(B=[B[0]&2,A.value]),B[0]){case 0:case 1:A=B;break;case 4:return v.label++,{value:B[1],done:!1};case 5:v.label++,w=B[1],B=[0];continue;case 7:B=v.ops.pop(),v.trys.pop();continue;default:if(A=v.trys,!(A=A.length>0&&A[A.length-1])&&(B[0]===6||B[0]===2)){v=0;continue}if(B[0]===3&&(!A||B[1]>A[0]&&B[1]<A[3])){v.label=B[1];break}if(B[0]===6&&v.label<A[1]){v.label=A[1],A=B;break}if(A&&v.label<A[2]){v.label=A[2],v.ops.push(B);break}A[2]&&v.ops.pop(),v.trys.pop();continue}B=y.call(p,v)}catch(G){B=[6,G],w=0}finally{b=A=0}if(B[0]&5)throw B[1];return{value:B[0]?B[1]:void 0,done:!0}}};Object.defineProperty(up,"__esModule",{value:!0}),up.useUnityInstance=void 0;var i=Ou(),a=Qse(),l=z4(),d=function(p,y,v,b){(0,i.useEffect)(function(){(function(){return n(void 0,void 0,void 0,function(){var w,A;return e(this,function(N){switch(N.label){case 0:if(l.isBrowserEnvironment===!1)return[2];if(p!==a.UnityLoaderStatus.Loaded||y===null)return b.setUnityInstance(null),b.setInitialisationError(null),[2];N.label=1;case 1:return N.trys.push([1,3,,4]),[4,window.createUnityInstance(y,v,b.setLoadingProgression)];case 2:return w=N.sent(),b.setUnityInstance(w),b.setInitialisationError(null),[3,4];case 3:return A=N.sent(),b.setUnityInstance(null),b.setInitialisationError(A),[3,4];case 4:return[2]}})})})()},[p,y,v,b])};return up.useUnityInstance=d,up}var Ew={},UJ;function m6e(){if(UJ)return Ew;UJ=1,Object.defineProperty(Ew,"__esModule",{value:!0}),Ew.useUnityArguments=void 0;var n=Ou(),e=function(i){return(0,n.useMemo)(function(){return{dataUrl:i.unityProvider.unityConfig.dataUrl,frameworkUrl:i.unityProvider.unityConfig.frameworkUrl,codeUrl:i.unityProvider.unityConfig.codeUrl,streamingAssetsUrl:i.unityProvider.unityConfig.streamingAssetsUrl,memoryUrl:i.unityProvider.unityConfig.memoryUrl,symbolsUrl:i.unityProvider.unityConfig.symbolsUrl,workerUrl:i.unityProvider.unityConfig.workerUrl,companyName:i.unityProvider.unityConfig.companyName,productName:i.unityProvider.unityConfig.productName,productVersion:i.unityProvider.unityConfig.productVersion,webglContextAttributes:i.unityProvider.unityConfig.webglContextAttributes||{},cacheControl:i.unityProvider.unityConfig.cacheControl||function(){return"must-revalidate"},devicePixelRatio:i.devicePixelRatio||1,autoSyncPersistentDataPath:i.autoSyncPersistentDataPath,matchWebGLToCanvasSize:typeof i.matchWebGLToCanvasSize=="boolean"?i.matchWebGLToCanvasSize:!0,disabledCanvasEvents:i.disabledCanvasEvents||["contextmenu","dragstart"],print:function(a){},printErr:function(a){}}},[])};return Ew.useUnityArguments=e,Ew}var vw={},VJ;function g6e(){if(VJ)return vw;VJ=1,Object.defineProperty(vw,"__esModule",{value:!0}),vw.useUnityLoader=void 0;var n=Ou(),e=z4(),i=Qse(),a=function(l){var d=(0,n.useState)(i.UnityLoaderStatus.Loading),p=d[0],y=d[1];return(0,n.useEffect)(function(){if(e.isBrowserEnvironment!==!1){if(l.loaderUrl===null){y(i.UnityLoaderStatus.Idle);return}var v=window.document.querySelector('script[src="'.concat(l.loaderUrl,'"]'));v===null?(v=window.document.createElement("script"),v.type="text/javascript",v.src=l.loaderUrl,v.async=!0,v.setAttribute("data-status","loading"),window.document.body.appendChild(v),v.addEventListener("load",function(){return v==null?void 0:v.setAttribute("data-status","loaded")}),v.addEventListener("error",function(){return v==null?void 0:v.setAttribute("data-status","error")})):y(v.getAttribute("data-status")==="loaded"?i.UnityLoaderStatus.Loaded:i.UnityLoaderStatus.Error);var b=function(w){return y(w.type==="load"?i.UnityLoaderStatus.Loaded:i.UnityLoaderStatus.Error)};return v.addEventListener("load",b),v.addEventListener("error",b),function(){v!==null&&(v.removeEventListener("load",b),v.removeEventListener("error",b),window.document.body.removeChild(v))}}},[l.loaderUrl]),p};return vw.useUnityLoader=a,vw}var FJ;function _6e(){if(FJ)return mw;FJ=1,Object.defineProperty(mw,"__esModule",{value:!0}),mw.Unity=void 0;var n=Ou(),e=Ou(),i=f6e(),a=p6e(),l=m6e(),d=g6e(),p=(0,e.forwardRef)(function(y,v){var b=(0,e.useRef)(null),w=(0,i.useUnityCanvasId)(y),A=(0,l.useUnityArguments)(y),N=(0,d.useUnityLoader)(y.unityProvider.unityConfig);return(0,a.useUnityInstance)(N,b.current,A,y.unityProvider),(0,n.useImperativeHandle)(v,function(){return b.current}),(0,n.createElement)("canvas",{ref:b,id:w,style:y.style,className:y.className,tabIndex:y.tabIndex})});return mw.Unity=p,mw}var dp={},Sw={},jJ;function Zse(){if(jJ)return Sw;jJ=1,Object.defineProperty(Sw,"__esModule",{value:!0}),Sw.errorMessages=void 0;var n={genericNoUnityInstance:"No Unity Instance found.",requestFullscreenNoUnityInstance:"Unable to Set Fullscreen while Unity is not Instantiated.",requestPointerLockNoUnityInstanceOrCanvas:"Unable to Request Pointer Lock while Unity is not Instantiated or the Canvas is not found.",sendMessageNoUnityInstance:"Unable to Send Message while Unity is not Instantiated.",quitNoUnityInstance:"Unable to Quit Unity while Unity is not Instantiated.",screenshotNoUnityInstanceOrCanvas:"Unable to Take Screenshot while Unity is not Instantiated or Canvas is not available.",noEventListener:"Unable to find Event Listener in Event System for Event"};return Sw.errorMessages=n,Sw}var ay={},BJ;function y6e(){if(BJ)return ay;BJ=1;var n=ay&&ay.__spreadArray||function(y,v,b){if(b||arguments.length===2)for(var w=0,A=v.length,N;w<A;w++)(N||!(w in v))&&(N||(N=Array.prototype.slice.call(v,0,w)),N[w]=v[w]);return y.concat(N||Array.prototype.slice.call(v))};Object.defineProperty(ay,"__esModule",{value:!0}),ay.useEventSystem=void 0;var e=Ou(),i=Zse(),a=z4(),l=[],d=function(y){for(var v=[],b=1;b<arguments.length;b++)v[b-1]=arguments[b];var w=void 0;return l.forEach(function(A){w=A.apply(void 0,n([y],v,!1))}),w};a.isBrowserEnvironment===!0&&(window.dispatchReactUnityEvent=d);var p=function(){var y=(0,e.useRef)([]),v=(0,e.useCallback)(function(A,N){y.current=n(n([],y.current,!0),[{eventName:A,callback:N}],!1)},[y]),b=(0,e.useCallback)(function(A,N){y.current=y.current.filter(function(V){return V.eventName!==A&&V.callback!==N})},[y]),w=(0,e.useCallback)(function(A){for(var N=[],V=1;V<arguments.length;V++)N[V-1]=arguments[V];var j=y.current.find(function(B){return B.eventName===A});if(typeof j>"u"){console.warn(i.errorMessages.noEventListener,{eventName:A});return}return j.callback.apply(j,N)},[y]);return(0,e.useEffect)(function(){return l.push(w),function(){l.splice(l.indexOf(w),1)}},[w]),{addEventListener:v,removeEventListener:b}};return ay.useEventSystem=p,ay}var bw={},WJ;function E6e(){if(WJ)return bw;WJ=1,Object.defineProperty(bw,"__esModule",{value:!0}),bw.useNullableState=void 0;var n=Ou(),e=function(i){return(0,n.useState)(i||null)};return bw.useNullableState=e,bw}var zJ;function v6e(){if(zJ)return dp;zJ=1;var n=dp&&dp.__awaiter||function(y,v,b,w){function A(N){return N instanceof b?N:new b(function(V){V(N)})}return new(b||(b=Promise))(function(N,V){function j(ee){try{G(w.next(ee))}catch(K){V(K)}}function B(ee){try{G(w.throw(ee))}catch(K){V(K)}}function G(ee){ee.done?N(ee.value):A(ee.value).then(j,B)}G((w=w.apply(y,v||[])).next())})},e=dp&&dp.__generator||function(y,v){var b={label:0,sent:function(){if(N[0]&1)throw N[1];return N[1]},trys:[],ops:[]},w,A,N,V=Object.create((typeof Iterator=="function"?Iterator:Object).prototype);return V.next=j(0),V.throw=j(1),V.return=j(2),typeof Symbol=="function"&&(V[Symbol.iterator]=function(){return this}),V;function j(G){return function(ee){return B([G,ee])}}function B(G){if(w)throw new TypeError("Generator is already executing.");for(;V&&(V=0,G[0]&&(b=0)),b;)try{if(w=1,A&&(N=G[0]&2?A.return:G[0]?A.throw||((N=A.return)&&N.call(A),0):A.next)&&!(N=N.call(A,G[1])).done)return N;switch(A=0,N&&(G=[G[0]&2,N.value]),G[0]){case 0:case 1:N=G;break;case 4:return b.label++,{value:G[1],done:!1};case 5:b.label++,A=G[1],G=[0];continue;case 7:G=b.ops.pop(),b.trys.pop();continue;default:if(N=b.trys,!(N=N.length>0&&N[N.length-1])&&(G[0]===6||G[0]===2)){b=0;continue}if(G[0]===3&&(!N||G[1]>N[0]&&G[1]<N[3])){b.label=G[1];break}if(G[0]===6&&b.label<N[1]){b.label=N[1],N=G;break}if(N&&b.label<N[2]){b.label=N[2],b.ops.push(G);break}N[2]&&b.ops.pop(),b.trys.pop();continue}G=v.call(y,b)}catch(ee){G=[6,ee],A=0}finally{w=N=0}if(G[0]&5)throw G[1];return{value:G[0]?G[1]:void 0,done:!0}}};Object.defineProperty(dp,"__esModule",{value:!0}),dp.useUnityContext=void 0;var i=Ou(),a=Zse(),l=y6e(),d=E6e(),p=function(y){var v=(0,d.useNullableState)(),b=v[0],w=v[1],A=(0,i.useState)(0),N=A[0],V=A[1],j=(0,i.useState)(!1),B=j[0],G=j[1],ee=(0,d.useNullableState)(),K=ee[0],ne=ee[1],ce=(0,l.useEventSystem)(),oe=(0,i.useRef)({setLoadingProgression:V,setInitialisationError:ne,setUnityInstance:w,setIsLoaded:G,unityConfig:y}),ge=(0,i.useCallback)(function(fe){if(b===null){console.warn(a.errorMessages.requestFullscreenNoUnityInstance);return}b.SetFullscreen(fe===!0?1:0)},[b]),te=(0,i.useCallback)(function(){if(b===null||typeof b.Module.canvas>"u"){console.warn(a.errorMessages.requestPointerLockNoUnityInstanceOrCanvas);return}return b.Module.canvas.requestPointerLock()},[b]),Z=(0,i.useCallback)(function(fe,ue,Me){if(b===null){console.warn(a.errorMessages.sendMessageNoUnityInstance);return}b.SendMessage(fe,ue,Me)},[b]),J=(0,i.useCallback)(function(fe,ue){if(b===null||typeof b.Module.canvas>"u"){console.warn(a.errorMessages.screenshotNoUnityInstanceOrCanvas);return}return b.Module.canvas.toDataURL(fe,ue)},[b]),se=(0,i.useCallback)(function(){return b===null?(console.warn(a.errorMessages.quitNoUnityInstance),Promise.reject()):b.Quit()},[b]),he=(0,i.useCallback)(function(){return n(void 0,void 0,void 0,function(){var fe;return e(this,function(ue){switch(ue.label){case 0:return b===null||typeof b.Module.canvas>"u"?(console.warn(a.errorMessages.genericNoUnityInstance),[2,Promise.reject()]):(fe=b.Module.canvas,document.body.appendChild(fe),fe.style.display="none",[4,se()]);case 1:return ue.sent(),fe.remove(),[2]}})})},[b]);return(0,i.useEffect)(function(){G(N===1)},[N]),{unityProvider:oe.current,loadingProgression:N,initialisationError:K,isLoaded:B,UNSAFE__unityInstance:b,requestFullscreen:ge,requestPointerLock:te,sendMessage:Z,takeScreenshot:J,unload:se,UNSAFE__detachAndUnloadImmediate:he,addEventListener:ce.addEventListener,removeEventListener:ce.removeEventListener}};return dp.useUnityContext=p,dp}var GJ;function S6e(){return GJ||(GJ=1,function(n){Object.defineProperty(n,"__esModule",{value:!0}),n.useUnityContext=n.Unity=void 0;var e=_6e();Object.defineProperty(n,"Unity",{enumerable:!0,get:function(){return e.Unity}});var i=v6e();Object.defineProperty(n,"useUnityContext",{enumerable:!0,get:function(){return i.useUnityContext}})}(dU)),dU}var eoe=S6e();const Cd="[UnityProvider]",KV=D.createContext(),b6e=({spaceID:n,children:e,loaderUrl:i,dataUrl:a,frameworkUrl:l,codeUrl:d,loadingBackground:p,showLoginButton:y,showDisruptiveLogo:v})=>{_e.log(`${Cd} Initializing with spaceID:`,n),_e.log(`${Cd} Unity URLs:`,{loaderUrl:i,dataUrl:a,frameworkUrl:l,codeUrl:d});const{unityProvider:b,loadingProgression:w,isLoaded:A,sendMessage:N,addEventListener:V,removeEventListener:j,error:B}=eoe.useUnityContext({loaderUrl:i,dataUrl:a,frameworkUrl:l,codeUrl:d}),G={unityProvider:b,loadingProgression:w,isLoaded:A,sendMessage:N,addEventListener:V,removeEventListener:j,error:B,spaceID:n},ee=D.useRef(null),K=D.useRef(Date.now());D.useEffect(()=>{const ge=()=>{document.hidden?(_e.log(`${Cd} Page hidden, starting keep-alive`),ne()):(_e.log(`${Cd} Page visible, stopping keep-alive`),ce())};return document.addEventListener("visibilitychange",ge),()=>{document.removeEventListener("visibilitychange",ge),ce()}},[]),D.useEffect(()=>{const ge=()=>{K.current=Date.now(),document.hidden&&N("WebGLInputManager","KeepAlive")};return window.addEventListener("mousemove",ge),window.addEventListener("keydown",ge),window.addEventListener("touchstart",ge),()=>{window.removeEventListener("mousemove",ge),window.removeEventListener("keydown",ge),window.removeEventListener("touchstart",ge)}},[N]);const ne=()=>{ee.current||(ee.current=setInterval(()=>{A&&document.hidden&&(N("WebGLInputManager","KeepAlive"),_e.debug(`${Cd} Sent keep-alive message`))},1e4))},ce=()=>{ee.current&&(clearInterval(ee.current),ee.current=null)};D.useEffect(()=>(_e.log(`${Cd} Component mounted`),()=>{_e.log(`${Cd} Component unmounting`),ce()}),[]),D.useEffect(()=>{_e.log(`${Cd} Loading progress:`,w)},[w]),D.useEffect(()=>{A&&(_e.log(`${Cd} Unity instance loaded for:`,n),document.hidden&&ne())},[A,n]),D.useEffect(()=>{B&&_e.error(`${Cd} Unity error:`,B)},[B]),_e.log(`${Cd} Rendering provider with instance:`,G),D.useEffect(()=>{_e.log("UnityProvider: Unity build URLs:",{loaderUrl:i,dataUrl:a,frameworkUrl:l,codeUrl:d})},[i,a,l,d]);const oe=[];if(i||oe.push("loaderUrl"),a||oe.push("dataUrl"),l||oe.push("frameworkUrl"),d||oe.push("codeUrl"),oe.length>0)return _e.error(`UnityProvider: Missing required Unity build URLs: ${oe.join(", ")}`),C.jsx(KV.Provider,{value:{unityProvider:null,loadingProgression:0,isLoaded:!1,sendMessage:()=>{},addEventListener:()=>{},removeEventListener:()=>{},error:new Error(`Missing required Unity build URLs: ${oe.join(", ")}`),spaceID:n},children:e});try{return D.useEffect(()=>{_e.log("UnityProvider: Unity context created:",b),b?_e.log("UnityProvider: Unity provider is available"):_e.error("UnityProvider: Unity provider is not available"),A?_e.log("UnityProvider: Unity is loaded"):_e.log("UnityProvider: Unity is not loaded yet")},[b,A]),C.jsx(KV.Provider,{value:G,children:e})}catch(ge){return _e.error("UnityProvider: Error creating Unity context:",ge),C.jsxs("div",{style:{padding:"20px",color:"red",backgroundColor:"#ffeeee",border:"1px solid red",borderRadius:"5px"},children:[C.jsx("h3",{children:"Unity Error"}),C.jsxs("p",{children:["Error creating Unity context: ",ge.message]}),C.jsx("p",{children:"Please check the console for more details."})]})}},rl=()=>D.useContext(KV),Ug=()=>{const{sendMessage:n,isLoaded:e}=rl(),i=D.useRef([]),a=D.useCallback(()=>{if(e)for(;i.current.length>0;){const{eventName:d,data:p}=i.current.shift();_e.log("useSendUnityEvent: Processing queued event to Unity:",d,p);try{n("ReactIncomingEvent","HandleEvent",JSON.stringify({eventName:d,data:JSON.stringify(p)}))}catch(y){_e.error("useSendUnityEvent: Error sending event to Unity:",y),i.current.unshift({eventName:d,data:p});break}}},[n,e]);return D.useEffect(()=>{const d=setInterval(()=>{a()},1e3);return()=>clearInterval(d)},[a]),D.useCallback((d,p)=>{_e.log("useSendUnityEvent: Queuing event for Unity:",d),i.current.push({eventName:d,data:p}),a()},[a])},jp=()=>{const{addEventListener:n,removeEventListener:e}=rl();return D.useCallback((i,a)=>{const l=d=>{_e.log(i+" unity message received.");let p=null;if(d)try{p=JSON.parse(d)}catch(y){_e.warn("Failed to parse JSON data from Unity message:",y)}a(p)};return n(i,l),()=>{e(i,l)}},[n,e])},T6e=()=>{const[n,e]=D.useState(!1),i=jp();return D.useEffect(()=>{const l=i("FirstSceneLoaded",()=>{_e.log("FirstSceneLoaded unity message received."),e(!0)});return()=>{l()}},[i]),n},w6e=n=>{const[e,i]=D.useState(null),a=jp(),{spaceID:l}=rl();return D.useEffect(()=>{let p=!0;const v=a("PlayVideo",async b=>{try{const{gameObjectName:w}=b;if(!w){_e.error("Game object name is missing in Unity event data.");return}const A=await Vse(l);_e.log("SPACES VIDEOS",A);const N=A.find(V=>V.id===w);N&&p?(i(N.url),_e.log("Video URL set to:",N.url)):console.error("Video not found for game object:",w)}catch(w){console.error("Error fetching space videos:",w)}});return()=>{p=!1,v()}},[a,l,n]),[e,()=>{i(null)}]},R6e=()=>{const n=jp(),{sendUserToUnity:e}=D.useContext(ca);return D.useEffect(()=>{const a=n("RequestUserForUnity",()=>{_e.log("React: Request from Unity to send user data"),e()});return()=>{a()}},[n,e]),!0},C6e=()=>{const{spaceID:n}=rl(),e=Ug(),[i,a]=D.useState(!1);D.useEffect(()=>{if(window.isPlayerInstantiated){_e.log("useUnityThumbnails: Unity already ready (via window flag)"),a(!0);return}const l=()=>{_e.log("useUnityThumbnails: Unity is now ready (PlayerInstantiated event)"),a(!0)};return window.addEventListener("PlayerInstantiated",l),()=>{window.removeEventListener("PlayerInstantiated",l)}},[]),D.useEffect(()=>{if(!i){_e.log("useUnityThumbnails: Waiting for Unity to be ready before loading thumbnails");return}_e.log("useUnityThumbnails: Unity is ready, now loading thumbnails"),(async()=>{try{if(!n)throw new Error("spaceID is not defined.");const d=await Vse(n),p=async b=>{const w=`https://vimeo.com/api/oembed.json?url=${b}`,A=await fetch(w);if(!A.ok)throw new Error(`Failed to fetch thumbnail: ${A.statusText}`);const N=await A.json(),V=N.thumbnail_url.replace(/_\d+x\d+/,""),j=["640x360","295x166"];let B=null;for(let G of j){const ee=`https://i.vimeocdn.com/filter/overlay?src0=${encodeURIComponent(`${V}_${G}`)}&src1=http://f.vimeocdn.com/p/images/crawler_play.png`;try{if((await fetch(ee,{method:"HEAD"})).ok){B=ee;break}}catch(K){console.warn(`Failed to validate thumbnail URL: ${ee}`,K)}}return B||N.thumbnail_url},y=d.map(async b=>{const w=await p(b.url);return{gameObjectName:b.id,thumbnailUrl:w}}),v=await Promise.all(y);_e.log("Fetched Thumbnails",v),v.forEach(({gameObjectName:b,thumbnailUrl:w})=>{e("SetThumbnail",{gameObjectName:b,thumbnailUrl:w})})}catch(d){_e.error("Error fetching thumbnails:",d)}})()},[e,n,i])},I6e=()=>{const[n,e]=D.useState(null),i=jp();return console.log(" Nameplate click hook initialized"),D.useEffect(()=>{console.log(" Setting up nameplate click listener...");const d=i("OpenNameplateModal",p=>{if(console.log(" Nameplate click detected!",p),!p){console.warn(" Received empty data in nameplate click handler");return}try{const y=typeof p=="string"?JSON.parse(p):p;e({playerName:y.playerName,playerId:y.playerId,uid:y.uid,isLocalPlayer:y.isLocalPlayer}),console.log(" Processed nameplate data:",y)}catch(y){console.error(" Error processing nameplate data:",y)}});return()=>{console.log(" Cleaning up nameplate click listener"),typeof d=="function"&&d()}},[i]),[n,()=>{console.log(" Resetting nameplate data"),e(null)}]},toe=()=>{const[n,e]=D.useState([]),i=jp();return D.useEffect(()=>{let a=!0,l=null;const d=()=>{window.unityInstance&&(_e.log("Requesting fresh player list"),window.unityInstance.SendMessage("NetworkManager","RequestPlayerList"))},p=V=>{if(a){_e.log("UpdatePlayerList unity message received.");try{let j=[];if(typeof V=="object"&&V!==null?j=V.players||[]:j=JSON.parse(V).players||[],Array.isArray(j)){const B=Array.from(new Map(j.map(G=>[G.playerId,G])).values());e(B),l&&(clearTimeout(l),l=null)}}catch(j){_e.error("Error handling player list data:",j),l||(l=setTimeout(d,1e3))}}},y=()=>{_e.log("Player disconnected, requesting fresh player list"),d()},v=()=>{_e.log("Player left, requesting fresh player list"),d()};d();const b=i("UpdatePlayerList",p),w=i("PlayerDisconnected",y),A=i("PlayerLeft",v),N=setInterval(d,5e3);return()=>{a=!1,l&&clearTimeout(l),typeof b=="function"&&b(),typeof w=="function"&&w(),typeof A=="function"&&A(),clearInterval(N)}},[i]),n},HJ=async(n,e,i,a={})=>{try{const{mediaType:l="image",displayAsVideo:d=!1,directUrl:p=null}=a;if(!n||!e)throw new Error("Missing required parameters: spaceId and mediaScreenId");let y=null;if(i){if(!i.type.startsWith("image/"))throw new Error("File must be an image");const v=Xy(),b=Date.now(),w=i.name.split(".").pop(),A=`${e}_${b}.${w}`,N=Yy(v,`spaces/${n}/mediaScreens/${A}`);_e.log(`Uploading image for media screen ${e} in space ${n}`);const V=await L4(N,i);y=await uN(V.ref);const j=Mi(gi,`spaces/${n}/mediaScreens`,e);await n1(j,{imageUrl:y,gsUrl:`gs://${V.ref.bucket}/${V.ref.fullPath}`,fileName:A,mediaType:l,displayAsVideo:d,uploadedAt:new Date().toISOString(),updatedAt:new Date().toISOString()},{merge:!0})}else if(p){y=p;const v=Mi(gi,`spaces/${n}/mediaScreens`,e);await n1(v,{videoUrl:p,mediaType:l,displayAsVideo:d,uploadedAt:new Date().toISOString(),updatedAt:new Date().toISOString()},{merge:!0})}else throw new Error("Either imageFile or directUrl must be provided");return _e.log(`Successfully uploaded ${l} for media screen ${e} (display as video: ${d})`),y}catch(l){throw _e.error(`Error uploading media screen ${(a==null?void 0:a.mediaType)||"image"}:`,l),l}},G4=async n=>{_e.log(`Getting media screen images for space: ${n}`);try{const e=jy(gi,`spaces/${n}/mediaScreens`),i=await FR(e),a=[];return i.forEach(l=>{a.push({id:l.id,...l.data()})}),a}catch(e){throw _e.error("Error fetching media screen images from Firestore:",e),e}},Sp=async(n,e)=>{try{const i=Mi(gi,`spaces/${n}/mediaScreens`,e),a=await Lu(i);return a.exists()?{id:a.id,...a.data()}:(_e.warn(`No media screen found with ID: ${e}`),null)}catch(i){throw _e.error("Error fetching media screen image:",i),i}},A6e=async(n,e)=>{try{const i=await Sp(n,e);if(!i)return _e.warn(`No media screen found with ID: ${e} to delete`),!1;if(i.gsUrl){const l=Xy(),d=Yy(l,i.gsUrl);try{await x4(d),_e.log(`Deleted file from storage: ${i.gsUrl}`)}catch(p){_e.warn(`Could not delete file from storage: ${p.message}`)}}const a=Mi(gi,`spaces/${n}/mediaScreens`,e);return i.mediaType==="video"?(await nl(a,{videoUrl:null,mediaType:null,displayAsVideo:!1,deletedAt:new Date().toISOString(),updatedAt:new Date().toISOString()}),_e.log(`Successfully removed video for media screen ${e}`)):(await nl(a,{imageUrl:null,gsUrl:null,fileName:null,mediaType:null,displayAsVideo:!1,deletedAt:new Date().toISOString(),updatedAt:new Date().toISOString()}),_e.log(`Successfully removed image for media screen ${e}`)),!0}catch(i){throw _e.error("Error deleting media screen image:",i),i}},P6e=async(n,e,i)=>{try{if(!n||!e||typeof i!="boolean")throw new Error("Missing or invalid required parameters");const a=await Sp(n,e);if(!a||!a.imageUrl&&!a.videoUrl)return _e.warn(`No media screen content found with ID: ${e} to update`),!1;const l=Mi(gi,`spaces/${n}/mediaScreens`,e);return await nl(l,{displayAsVideo:i,updatedAt:new Date().toISOString()}),_e.log(`Successfully updated display mode for media screen ${e} to ${i?"video":"image"}`),!0}catch(a){throw _e.error("Error updating media screen display mode:",a),a}},O6e=n=>{if(!n)return null;try{if(n.includes("firebasestorage.googleapis.com")){const e=new URL(n),i=e.searchParams.get("alt"),a=e.searchParams.get("token");return e.search="",i&&e.searchParams.set("alt",i),a&&e.searchParams.set("token",a),console.log(`Cleaned Firebase URL from ${n} to ${e.toString()}`),e.toString()}return n}catch(e){return console.error("Error cleaning Firebase URL:",e),n}},noe=()=>{const{spaceID:n}=rl(),e=Ug(),[i,a]=D.useState(!1);D.useEffect(()=>{if(window.isPlayerInstantiated){_e.log("useUnityMediaScreenImages: Unity already ready (via window flag)"),a(!0);return}const l=()=>{_e.log("useUnityMediaScreenImages: Unity is now ready (PlayerInstantiated event)"),a(!0)};return window.addEventListener("PlayerInstantiated",l),()=>{window.removeEventListener("PlayerInstantiated",l)}},[]),D.useEffect(()=>{if(!i){_e.log("useUnityMediaScreenImages: Waiting for Unity to be ready before loading media screens");return}_e.log("useUnityMediaScreenImages: Unity is ready, now loading media screens"),(async()=>{try{if(!n)throw new Error("spaceID is not defined.");const d=await G4(n);_e.log("Fetched Media Screen Images",d),d.forEach(p=>{const{id:y,imageUrl:v,displayAsVideo:b,videoUrl:w}=p;let A=null;(!b||!w)&&(A=v?O6e(v):null),e("SetMediaScreenImage",{mediaScreenId:y,imageUrl:A,videoUrl:w||null,displayAsVideo:b||!1,timestamp:Date.now()}),_e.log(`Sent media screen data for ${y} to Unity (displayAsVideo: ${b})`),b&&w&&(e("SetMediaScreenDisplayMode",{mediaScreenId:y,displayAsVideo:!0,videoUrl:w,timestamp:Date.now()}),_e.log(`Set display mode to video for screen ${y}`))})}catch(d){_e.error("Error fetching media screen images:",d)}})()},[e,n,i])},k6e=n=>({opacity:1});function N6e(){const{loadingProgression:n,isLoaded:e,error:i}=rl(),{user:a}=D.useContext(ca),[l,d]=D.useState(!1),[p,y]=D.useState(!1),[v,b]=D.useState(!1),[w,A]=D.useState(!1),N=D.useRef(!1),V=D.useRef(!1),j=D.useRef(null),B=D.useRef(null),G=D.useRef(null),ee=jp(),K=D.useRef(null),ne=D.useRef(null),ce=D.useRef(null),oe=D.useRef(null);D.useEffect(()=>{d(!a&&n===0)},[a,n]),D.useEffect(()=>{const Z=document.createElement("style");return Z.textContent=`
      /* Set initial Unity canvas styles */
      #unity-canvas, #unity-container {
        opacity: 0 !important;
        transition: opacity 1s ease-in-out;
        z-index: 1 !important; /* Ensure Unity is below our loader */
      }
      
      /* Loader overlay styles */
      .loader-overlay {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(0, 0, 0, 0.5);
        z-index: 99999 !important; /* Extremely high z-index */
        display: flex;
        align-items: center;
        justify-content: center;
        transition: opacity 1.5s ease-in-out;
        pointer-events: auto !important;
        transform: translateZ(0); /* Create stacking context */
      }
      
      /* Loader content styles */
      .loader-content {
        background-color: rgba(0, 0, 0, 0.8);
        padding: 1rem;
        border-radius: 0.5rem;
        color: white;
        text-align: center;
        z-index: 100000 !important; /* Even higher z-index */
      }
    `,document.head.appendChild(Z),K.current=Z,()=>{K.current&&document.head.removeChild(K.current)}},[]),D.useEffect(()=>{const Z=()=>{const J=document.getElementById("unity-canvas"),se=document.getElementById("unity-container");J&&(j.current=J,console.log("LoaderProgress: Found Unity canvas"),J.style.zIndex="1"),se&&(B.current=se,console.log("LoaderProgress: Found Unity container"),se.style.zIndex="1"),J&&se&&ce.current&&(clearInterval(ce.current),ce.current=null)};return Z(),ce.current=setInterval(Z,100),()=>{ce.current&&(clearInterval(ce.current),ce.current=null)}},[]),D.useEffect(()=>{console.log("LoaderProgress: Setting up FirstSceneLoaded listener"),window.isFirstSceneLoaded&&(console.log("LoaderProgress: FirstSceneLoaded already set via window flag"),V.current=!0,A(!0));const J=ee("FirstSceneLoaded",()=>{console.log("LoaderProgress: FirstSceneLoaded event received"),V.current=!0,A(!0),window.isFirstSceneLoaded=!0}),se=setTimeout(()=>{V.current||(console.log("LoaderProgress: Forcing FirstSceneLoaded after timeout"),V.current=!0,A(!0),window.isFirstSceneLoaded=!0)},1e4);return()=>{J(),clearTimeout(se)}},[ee]),D.useEffect(()=>{console.log("LoaderProgress: Setting up PlayerInstantiated listener"),window.isPlayerInstantiated&&(console.log("LoaderProgress: Player already instantiated via window flag"),N.current=!0,b(!0),V.current||(console.log("LoaderProgress: Forcing FirstSceneLoaded because player is already instantiated"),V.current=!0,A(!0),window.isFirstSceneLoaded=!0));const Z=()=>{console.log("LoaderProgress: PlayerInstantiated event received"),N.current=!0,b(!0),V.current||(console.log("LoaderProgress: Forcing FirstSceneLoaded because player is instantiated"),V.current=!0,A(!0),window.isFirstSceneLoaded=!0)};window.addEventListener("PlayerInstantiated",Z);const J=ee("PlayerInstantiated",Z),se=setTimeout(()=>{N.current||(console.log("LoaderProgress: Forcing player instantiation after timeout"),N.current=!0,b(!0),V.current||(console.log("LoaderProgress: Forcing FirstSceneLoaded because of timeout"),V.current=!0,A(!0),window.isFirstSceneLoaded=!0))},2e4);return()=>{window.removeEventListener("PlayerInstantiated",Z),J(),clearTimeout(se)}},[ee]),D.useEffect(()=>(console.log("LoaderProgress: Handling visibility changes",{isFirstSceneLoaded:w,isPlayerInstantiated:v}),w&&v&&(console.log("LoaderProgress: Both conditions met, showing Unity canvas"),ne.current&&clearTimeout(ne.current),ne.current=setTimeout(()=>{console.log("LoaderProgress: Showing Unity canvas now"),j.current&&(j.current.style.opacity="1",j.current.style.removeProperty("opacity")),B.current&&(B.current.style.opacity="1",B.current.style.removeProperty("opacity")),G.current&&(G.current.style.opacity="0",G.current.style.pointerEvents="none",setTimeout(()=>{G.current&&(G.current.style.display="none")},1500))},2e3)),()=>{ne.current&&clearTimeout(ne.current)}),[w,v]),D.useEffect(()=>(oe.current=setInterval(()=>{var Z,J;console.log("LoaderProgress: Debug interval",{isLoaded:e,isFirstSceneLoaded:V.current,isPlayerInstantiated:N.current,windowFirstSceneLoaded:window.isFirstSceneLoaded,windowPlayerInstantiated:window.isPlayerInstantiated,unityCanvasZIndex:(Z=j.current)==null?void 0:Z.style.zIndex,loaderZIndex:(J=G.current)==null?void 0:J.style.zIndex})},5e3),()=>{oe.current&&clearInterval(oe.current)}),[e]),D.useEffect(()=>{console.log("LoaderProgress: State updated",{isLoaded:e,isFirstSceneLoaded:w,isPlayerInstantiated:v,loadingProgression:n})},[e,w,v,n]);const ge=()=>e?e&&!w&&!v?"Scene initializing":w&&!v?"Player initializing":"Ready":"World loading",te=()=>e?e&&!w&&!v?85:w&&!v?95:100:n*80;return C.jsx(C.Fragment,{children:l?C.jsx(St,{position:"absolute",zIndex:"99999",width:"100%",height:"100%",display:"flex",alignItems:"center",justifyContent:"center",style:{transform:"translateZ(0)"},children:C.jsxs(ii,{spacing:4,padding:6,borderRadius:"md",backgroundColor:"rgba(0, 0, 0, 0.8)",color:"white",children:[C.jsx(ht,{fontSize:"xl",fontWeight:"bold",children:"Sign In Required"}),C.jsx(ht,{textAlign:"center",children:"Please sign in to enter The Disruptive Spaces"}),C.jsx(zr,{colorScheme:"blue",size:"lg",width:"200px",onClick:()=>y(!0),children:"Sign In"})]})}):C.jsx(St,{ref:G,className:"loader-overlay",style:{transform:"translateZ(0)",zIndex:99999},children:C.jsxs(mi,{className:"loader-content",flexDirection:"column",alignItems:"center",width:"300px",style:{zIndex:1e5},children:[C.jsx(ht,{fontWeight:"bold",children:"Entering The Spaces Metaverse"}),C.jsx(ht,{fontSize:"sm",children:ge()}),C.jsx(m0,{value:te(),size:"lg",width:"100%",marginY:2})]})})})}function D6e(){const{user:n}=D.useContext(ca);return C.jsx("div",{children:n!==null?C.jsx("div",{children:C.jsx(B4,{})}):C.jsxs("div",{children:[C.jsx(pN,{}),C.jsx(mN,{})]})})}function L6e(){const{fullscreenRef:n}=Ud(),[e,i]=D.useState(!1),a=()=>{i(!e)};return C.jsxs(C.Fragment,{children:[C.jsx(hg,{label:"Help",hasArrow:!0,placement:"top",closeOnClick:!0,portalProps:{containerRef:n},children:C.jsx(Ma,{"aria-label":"Controller Help",icon:C.jsx(BBe,{}),onClick:a,variant:"iconButton"})}),C.jsxs(ra,{isOpen:e,onClose:a,size:"md",portalProps:{containerRef:n},children:[C.jsx(oa,{}),C.jsxs(ia,{children:[C.jsx(tl,{children:"Notes"}),C.jsx(ja,{}),C.jsx(sa,{children:C.jsx(ht,{variant:"formIntro",children:"The help button is showing so we can see the blur and transparency styles on the button."})}),C.jsx(bg,{children:C.jsx(zr,{variant:"primary",onClick:a,children:"Close"})})]})]})]})}var roe={color:void 0,size:void 0,className:void 0,style:void 0,attr:void 0},$J=ri.createContext&&ri.createContext(roe),yg=function(){return yg=Object.assign||function(n){for(var e,i=1,a=arguments.length;i<a;i++){e=arguments[i];for(var l in e)Object.prototype.hasOwnProperty.call(e,l)&&(n[l]=e[l])}return n},yg.apply(this,arguments)},x6e=function(n,e){var i={};for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&e.indexOf(a)<0&&(i[a]=n[a]);if(n!=null&&typeof Object.getOwnPropertySymbols=="function")for(var l=0,a=Object.getOwnPropertySymbols(n);l<a.length;l++)e.indexOf(a[l])<0&&Object.prototype.propertyIsEnumerable.call(n,a[l])&&(i[a[l]]=n[a[l]]);return i};function ioe(n){return n&&n.map(function(e,i){return ri.createElement(e.tag,yg({key:i},e.attr),ioe(e.child))})}function Vr(n){return function(e){return ri.createElement(M6e,yg({attr:yg({},n.attr)},e),ioe(n.child))}}function M6e(n){var e=function(i){var a=n.attr,l=n.size,d=n.title,p=x6e(n,["attr","size","title"]),y=l||i.size||"1em",v;return i.className&&(v=i.className),n.className&&(v=(v?v+" ":"")+n.className),ri.createElement("svg",yg({stroke:"currentColor",fill:"currentColor",strokeWidth:"0"},i.attr,a,p,{className:v,style:yg(yg({color:n.color||i.color},i.style),n.style),height:y,width:y,xmlns:"http://www.w3.org/2000/svg"}),d&&ri.createElement("title",null,d),n.children)};return $J!==void 0?ri.createElement($J.Consumer,null,function(i){return e(i)}):e(roe)}function soe(n){return Vr({attr:{viewBox:"0 0 448 512"},child:[{tag:"path",attr:{d:"M416 32H31.9C14.3 32 0 46.5 0 64.3v383.4C0 465.5 14.3 480 31.9 480H416c17.6 0 32-14.5 32-32.3V64.3c0-17.8-14.4-32.3-32-32.3zM135.4 416H69V202.2h66.5V416zm-33.2-243c-21.3 0-38.5-17.3-38.5-38.5S80.9 96 102.2 96c21.2 0 38.5 17.3 38.5 38.5 0 21.3-17.2 38.5-38.5 38.5zm282.1 243h-66.4V312c0-24.8-.5-56.7-34.5-56.7-34.6 0-39.9 27-39.9 54.9V416h-66.4V202.2h63.7v29.2h.9c8.9-16.8 30.6-34.5 62.9-34.5 67.2 0 79.7 44.3 79.7 101.9V416z"}}]})(n)}function U6e(n){return Vr({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M256 8C119.034 8 8 119.033 8 256s111.034 248 248 248 248-111.034 248-248S392.967 8 256 8zm130.108 117.892c65.448 65.448 70 165.481 20.677 235.637L150.47 105.216c70.204-49.356 170.226-44.735 235.638 20.676zM125.892 386.108c-65.448-65.448-70-165.481-20.677-235.637L361.53 406.784c-70.203 49.356-170.226 44.736-235.638-20.676z"}}]})(n)}function qV(n){return Vr({attr:{viewBox:"0 0 640 512"},child:[{tag:"path",attr:{d:"M528 448H112c-8.8 0-16 7.2-16 16v32c0 8.8 7.2 16 16 16h416c8.8 0 16-7.2 16-16v-32c0-8.8-7.2-16-16-16zm64-320c-26.5 0-48 21.5-48 48 0 7.1 1.6 13.7 4.4 19.8L476 239.2c-15.4 9.2-35.3 4-44.2-11.6L350.3 85C361 76.2 368 63 368 48c0-26.5-21.5-48-48-48s-48 21.5-48 48c0 15 7 28.2 17.7 37l-81.5 142.6c-8.9 15.6-28.9 20.8-44.2 11.6l-72.3-43.4c2.7-6 4.4-12.7 4.4-19.8 0-26.5-21.5-48-48-48S0 149.5 0 176s21.5 48 48 48c2.6 0 5.2-.4 7.7-.8L128 416h384l72.3-192.8c2.5.4 5.1.8 7.7.8 26.5 0 48-21.5 48-48s-21.5-48-48-48z"}}]})(n)}function V6e(n){return Vr({attr:{viewBox:"0 0 576 512"},child:[{tag:"path",attr:{d:"M402.6 83.2l90.2 90.2c3.8 3.8 3.8 10 0 13.8L274.4 405.6l-92.8 10.3c-12.4 1.4-22.9-9.1-21.5-21.5l10.3-92.8L388.8 83.2c3.8-3.8 10-3.8 13.8 0zm162-22.9l-48.8-48.8c-15.2-15.2-39.9-15.2-55.2 0l-35.4 35.4c-3.8 3.8-3.8 10 0 13.8l90.2 90.2c3.8 3.8 10 3.8 13.8 0l35.4-35.4c15.2-15.3 15.2-40 0-55.2zM384 346.2V448H64V128h229.8c3.2 0 6.2-1.3 8.5-3.5l40-40c7.6-7.6 2.2-20.5-8.5-20.5H48C21.5 64 0 85.5 0 112v352c0 26.5 21.5 48 48 48h352c26.5 0 48-21.5 48-48V306.2c0-10.7-12.9-16-20.5-8.5l-40 40c-2.2 2.3-3.5 5.3-3.5 8.5z"}}]})(n)}function F6e(n){return Vr({attr:{viewBox:"0 0 192 512"},child:[{tag:"path",attr:{d:"M96 184c39.8 0 72 32.2 72 72s-32.2 72-72 72-72-32.2-72-72 32.2-72 72-72zM24 80c0 39.8 32.2 72 72 72s72-32.2 72-72S135.8 8 96 8 24 40.2 24 80zm0 352c0 39.8 32.2 72 72 72s72-32.2 72-72-32.2-72-72-72-72 32.2-72 72z"}}]})(n)}function j6e(n){return Vr({attr:{viewBox:"0 0 640 512"},child:[{tag:"path",attr:{d:"M480.07 96H160a160 160 0 1 0 114.24 272h91.52A160 160 0 1 0 480.07 96zM248 268a12 12 0 0 1-12 12h-52v52a12 12 0 0 1-12 12h-24a12 12 0 0 1-12-12v-52H84a12 12 0 0 1-12-12v-24a12 12 0 0 1 12-12h52v-52a12 12 0 0 1 12-12h24a12 12 0 0 1 12 12v52h52a12 12 0 0 1 12 12zm216 76a40 40 0 1 1 40-40 40 40 0 0 1-40 40zm64-96a40 40 0 1 1 40-40 40 40 0 0 1-40 40z"}}]})(n)}function ooe(n){return Vr({attr:{viewBox:"0 0 496 512"},child:[{tag:"path",attr:{d:"M336.5 160C322 70.7 287.8 8 248 8s-74 62.7-88.5 152h177zM152 256c0 22.2 1.2 43.5 3.3 64h185.3c2.1-20.5 3.3-41.8 3.3-64s-1.2-43.5-3.3-64H155.3c-2.1 20.5-3.3 41.8-3.3 64zm324.7-96c-28.6-67.9-86.5-120.4-158-141.6 24.4 33.8 41.2 84.7 50 141.6h108zM177.2 18.4C105.8 39.6 47.8 92.1 19.3 160h108c8.7-56.9 25.5-107.8 49.9-141.6zM487.4 192H372.7c2.1 21 3.3 42.5 3.3 64s-1.2 43-3.3 64h114.6c5.5-20.5 8.6-41.8 8.6-64s-3.1-43.5-8.5-64zM120 256c0-21.5 1.2-43 3.3-64H8.6C3.2 212.5 0 233.8 0 256s3.2 43.5 8.6 64h114.6c-2-21-3.2-42.5-3.2-64zm39.5 96c14.5 89.3 48.7 152 88.5 152s74-62.7 88.5-152h-177zm159.3 141.6c71.4-21.2 129.4-73.7 158-141.6h-108c-8.8 56.9-25.6 107.8-50 141.6zM19.3 352c28.6 67.9 86.5 120.4 158 141.6-24.4-33.8-41.2-84.7-50-141.6h-108z"}}]})(n)}function B6e(n){return Vr({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M256 8C119.043 8 8 119.083 8 256c0 136.997 111.043 248 248 248s248-111.003 248-248C504 119.083 392.957 8 256 8zm0 110c23.196 0 42 18.804 42 42s-18.804 42-42 42-42-18.804-42-42 18.804-42 42-42zm56 254c0 6.627-5.373 12-12 12h-88c-6.627 0-12-5.373-12-12v-24c0-6.627 5.373-12 12-12h12v-64h-12c-6.627 0-12-5.373-12-12v-24c0-6.627 5.373-12 12-12h64c6.627 0 12 5.373 12 12v100h12c6.627 0 12 5.373 12 12v24z"}}]})(n)}function W6e(n){return Vr({attr:{viewBox:"0 0 576 512"},child:[{tag:"path",attr:{d:"M528 448H48c-26.51 0-48-21.49-48-48V112c0-26.51 21.49-48 48-48h480c26.51 0 48 21.49 48 48v288c0 26.51-21.49 48-48 48zM128 180v-40c0-6.627-5.373-12-12-12H76c-6.627 0-12 5.373-12 12v40c0 6.627 5.373 12 12 12h40c6.627 0 12-5.373 12-12zm96 0v-40c0-6.627-5.373-12-12-12h-40c-6.627 0-12 5.373-12 12v40c0 6.627 5.373 12 12 12h40c6.627 0 12-5.373 12-12zm96 0v-40c0-6.627-5.373-12-12-12h-40c-6.627 0-12 5.373-12 12v40c0 6.627 5.373 12 12 12h40c6.627 0 12-5.373 12-12zm96 0v-40c0-6.627-5.373-12-12-12h-40c-6.627 0-12 5.373-12 12v40c0 6.627 5.373 12 12 12h40c6.627 0 12-5.373 12-12zm96 0v-40c0-6.627-5.373-12-12-12h-40c-6.627 0-12 5.373-12 12v40c0 6.627 5.373 12 12 12h40c6.627 0 12-5.373 12-12zm-336 96v-40c0-6.627-5.373-12-12-12h-40c-6.627 0-12 5.373-12 12v40c0 6.627 5.373 12 12 12h40c6.627 0 12-5.373 12-12zm96 0v-40c0-6.627-5.373-12-12-12h-40c-6.627 0-12 5.373-12 12v40c0 6.627 5.373 12 12 12h40c6.627 0 12-5.373 12-12zm96 0v-40c0-6.627-5.373-12-12-12h-40c-6.627 0-12 5.373-12 12v40c0 6.627 5.373 12 12 12h40c6.627 0 12-5.373 12-12zm96 0v-40c0-6.627-5.373-12-12-12h-40c-6.627 0-12 5.373-12 12v40c0 6.627 5.373 12 12 12h40c6.627 0 12-5.373 12-12zm-336 96v-40c0-6.627-5.373-12-12-12H76c-6.627 0-12 5.373-12 12v40c0 6.627 5.373 12 12 12h40c6.627 0 12-5.373 12-12zm288 0v-40c0-6.627-5.373-12-12-12H172c-6.627 0-12 5.373-12 12v40c0 6.627 5.373 12 12 12h232c6.627 0 12-5.373 12-12zm96 0v-40c0-6.627-5.373-12-12-12h-40c-6.627 0-12 5.373-12 12v40c0 6.627 5.373 12 12 12h40c6.627 0 12-5.373 12-12z"}}]})(n)}function YV(n){return Vr({attr:{viewBox:"0 0 640 512"},child:[{tag:"path",attr:{d:"M633.82 458.1l-157.8-121.96C488.61 312.13 496 285.01 496 256v-48c0-8.84-7.16-16-16-16h-16c-8.84 0-16 7.16-16 16v48c0 17.92-3.96 34.8-10.72 50.2l-26.55-20.52c3.1-9.4 5.28-19.22 5.28-29.67V96c0-53.02-42.98-96-96-96s-96 42.98-96 96v45.36L45.47 3.37C38.49-2.05 28.43-.8 23.01 6.18L3.37 31.45C-2.05 38.42-.8 48.47 6.18 53.9l588.36 454.73c6.98 5.43 17.03 4.17 22.46-2.81l19.64-25.27c5.41-6.97 4.16-17.02-2.82-22.45zM400 464h-56v-33.77c11.66-1.6 22.85-4.54 33.67-8.31l-50.11-38.73c-6.71.4-13.41.87-20.35.2-55.85-5.45-98.74-48.63-111.18-101.85L144 241.31v6.85c0 89.64 63.97 169.55 152 181.69V464h-56c-8.84 0-16 7.16-16 16v16c0 8.84 7.16 16 16 16h160c8.84 0 16-7.16 16-16v-16c0-8.84-7.16-16-16-16z"}}]})(n)}function XV(n){return Vr({attr:{viewBox:"0 0 352 512"},child:[{tag:"path",attr:{d:"M176 352c53.02 0 96-42.98 96-96V96c0-53.02-42.98-96-96-96S80 42.98 80 96v160c0 53.02 42.98 96 96 96zm160-160h-16c-8.84 0-16 7.16-16 16v48c0 74.8-64.49 134.82-140.79 127.38C96.71 376.89 48 317.11 48 250.3V208c0-8.84-7.16-16-16-16H16c-8.84 0-16 7.16-16 16v40.16c0 89.64 63.97 169.55 152 181.69V464H96c-8.84 0-16 7.16-16 16v16c0 8.84 7.16 16 16 16h160c8.84 0 16-7.16 16-16v-16c0-8.84-7.16-16-16-16h-56v-33.77C285.71 418.47 352 344.9 352 256v-48c0-8.84-7.16-16-16-16z"}}]})(n)}function z6e(n){return Vr({attr:{viewBox:"0 0 384 512"},child:[{tag:"path",attr:{d:"M0 352a160 160 0 0 0 160 160h64a160 160 0 0 0 160-160V224H0zM176 0h-16A160 160 0 0 0 0 160v32h176zm48 0h-16v192h176v-32A160 160 0 0 0 224 0z"}}]})(n)}function G6e(n){return Vr({attr:{viewBox:"0 0 448 512"},child:[{tag:"path",attr:{d:"M416 208H272V64c0-17.67-14.33-32-32-32h-32c-17.67 0-32 14.33-32 32v144H32c-17.67 0-32 14.33-32 32v32c0 17.67 14.33 32 32 32h144v144c0 17.67 14.33 32 32 32h32c17.67 0 32-14.33 32-32V304h144c17.67 0 32-14.33 32-32v-32c0-17.67-14.33-32-32-32z"}}]})(n)}function H6e(n){return Vr({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M466.5 83.7l-192-80a48.15 48.15 0 0 0-36.9 0l-192 80C27.7 91.1 16 108.6 16 128c0 198.5 114.5 335.7 221.5 380.3 11.8 4.9 25.1 4.9 36.9 0C360.1 472.6 496 349.3 496 128c0-19.4-11.7-36.9-29.5-44.3zM256.1 446.3l-.1-381 175.9 73.3c-3.3 151.4-82.1 261.1-175.8 307.7z"}}]})(n)}function JV(n){return Vr({attr:{viewBox:"0 0 576 512"},child:[{tag:"path",attr:{d:"M259.3 17.8L194 150.2 47.9 171.5c-26.2 3.8-36.7 36.1-17.7 54.6l105.7 103-25 145.5c-4.5 26.3 23.2 46 46.4 33.7L288 439.6l130.7 68.7c23.2 12.2 50.9-7.4 46.4-33.7l-25-145.5 105.7-103c19-18.5 8.5-50.8-17.7-54.6L382 150.2 316.7 17.8c-11.7-23.6-45.6-23.9-57.4 0z"}}]})(n)}function $6e(n){return Vr({attr:{viewBox:"0 0 640 512"},child:[{tag:"path",attr:{d:"M624 208h-64v-64c0-8.8-7.2-16-16-16h-32c-8.8 0-16 7.2-16 16v64h-64c-8.8 0-16 7.2-16 16v32c0 8.8 7.2 16 16 16h64v64c0 8.8 7.2 16 16 16h32c8.8 0 16-7.2 16-16v-64h64c8.8 0 16-7.2 16-16v-32c0-8.8-7.2-16-16-16zm-400 48c70.7 0 128-57.3 128-128S294.7 0 224 0 96 57.3 96 128s57.3 128 128 128zm89.6 32h-16.7c-22.2 10.2-46.9 16-72.9 16s-50.6-5.8-72.9-16h-16.7C60.2 288 0 348.2 0 422.4V464c0 26.5 21.5 48 48 48h352c26.5 0 48-21.5 48-48v-41.6c0-74.2-60.2-134.4-134.4-134.4z"}}]})(n)}function K6e(n){return Vr({attr:{viewBox:"0 0 640 512"},child:[{tag:"path",attr:{d:"M96 224c35.3 0 64-28.7 64-64s-28.7-64-64-64-64 28.7-64 64 28.7 64 64 64zm448 0c35.3 0 64-28.7 64-64s-28.7-64-64-64-64 28.7-64 64 28.7 64 64 64zm32 32h-64c-17.6 0-33.5 7.1-45.1 18.6 40.3 22.1 68.9 62 75.1 109.4h66c17.7 0 32-14.3 32-32v-32c0-35.3-28.7-64-64-64zm-256 0c61.9 0 112-50.1 112-112S381.9 32 320 32 208 82.1 208 144s50.1 112 112 112zm76.8 32h-8.3c-20.8 10-43.9 16-68.5 16s-47.6-6-68.5-16h-8.3C179.6 288 128 339.6 128 403.2V432c0 26.5 21.5 48 48 48h288c26.5 0 48-21.5 48-48v-28.8c0-63.6-51.6-115.2-115.2-115.2zm-223.7-13.4C161.5 263.1 145.6 256 128 256H64c-35.3 0-64 28.7-64 64v32c0 17.7 14.3 32 32 32h65.9c6.3-47.4 34.9-87.3 75.2-109.4z"}}]})(n)}function q6e(n){return Vr({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M215.03 71.05L126.06 160H24c-13.26 0-24 10.74-24 24v144c0 13.25 10.74 24 24 24h102.06l88.97 88.95c15.03 15.03 40.97 4.47 40.97-16.97V88.02c0-21.46-25.96-31.98-40.97-16.97zM461.64 256l45.64-45.64c6.3-6.3 6.3-16.52 0-22.82l-22.82-22.82c-6.3-6.3-16.52-6.3-22.82 0L416 210.36l-45.64-45.64c-6.3-6.3-16.52-6.3-22.82 0l-22.82 22.82c-6.3 6.3-6.3 16.52 0 22.82L370.36 256l-45.63 45.63c-6.3 6.3-6.3 16.52 0 22.82l22.82 22.82c6.3 6.3 16.52 6.3 22.82 0L416 301.64l45.64 45.64c6.3 6.3 16.52 6.3 22.82 0l22.82-22.82c6.3-6.3 6.3-16.52 0-22.82L461.64 256z"}}]})(n)}function Y6e(n){return Vr({attr:{viewBox:"0 0 576 512"},child:[{tag:"path",attr:{d:"M215.03 71.05L126.06 160H24c-13.26 0-24 10.74-24 24v144c0 13.25 10.74 24 24 24h102.06l88.97 88.95c15.03 15.03 40.97 4.47 40.97-16.97V88.02c0-21.46-25.96-31.98-40.97-16.97zm233.32-51.08c-11.17-7.33-26.18-4.24-33.51 6.95-7.34 11.17-4.22 26.18 6.95 33.51 66.27 43.49 105.82 116.6 105.82 195.58 0 78.98-39.55 152.09-105.82 195.58-11.17 7.32-14.29 22.34-6.95 33.5 7.04 10.71 21.93 14.56 33.51 6.95C528.27 439.58 576 351.33 576 256S528.27 72.43 448.35 19.97zM480 256c0-63.53-32.06-121.94-85.77-156.24-11.19-7.14-26.03-3.82-33.12 7.46s-3.78 26.21 7.41 33.36C408.27 165.97 432 209.11 432 256s-23.73 90.03-63.48 115.42c-11.19 7.14-14.5 22.07-7.41 33.36 6.51 10.36 21.12 15.14 33.12 7.46C447.94 377.94 480 319.54 480 256zm-141.77-76.87c-11.58-6.33-26.19-2.16-32.61 9.45-6.39 11.61-2.16 26.2 9.45 32.61C327.98 228.28 336 241.63 336 256c0 14.38-8.02 27.72-20.92 34.81-11.61 6.41-15.84 21-9.45 32.61 6.43 11.66 21.05 15.8 32.61 9.45 28.23-15.55 45.77-45 45.77-76.88s-17.54-61.32-45.78-76.86z"}}]})(n)}function aoe({open:n,onClose:e}){const i=D.useRef(null),a=Ug(),{user:l}=D.useContext(ca),d=v=>{i.current&&!i.current.contains(v.target)&&e()},p=async v=>{const b=y(v);if((b==null?void 0:b.source)==="readyplayerme"&&(b.eventName==="v1.frame.ready"&&i.current.contentWindow.postMessage(JSON.stringify({target:"readyplayerme",type:"subscribe",eventName:"v1.**"}),"*"),b.eventName==="v1.avatar.exported")){const w=b.data.url;if(console.log(`Avatar URL: ${w}`),a("AvatarUrlFromReact",{url:w}),l&&l.uid)try{await vse(l.uid,w),e()}catch(A){console.error("Error updating RPM URL:",A)}else console.error("No authenticated user found to update rpmURL.")}},y=v=>{try{return JSON.parse(v.data)}catch{return null}};return D.useEffect(()=>(n&&(document.addEventListener("mousedown",d),window.addEventListener("message",p)),()=>{document.removeEventListener("mousedown",d),window.removeEventListener("message",p)}),[n]),n&&C.jsx(Vl,{children:C.jsx(St,{position:"fixed",top:"0",left:"0",width:"100%",height:"100%",bg:"rgba(0, 0, 0, 0.8)",zIndex:1e4,display:"flex",justifyContent:"center",alignItems:"center",onClick:v=>v.stopPropagation(),children:C.jsx(St,{position:"relative",maxWidth:"1080px",maxHeight:"800px",width:"90%",height:"90%",children:C.jsx("iframe",{ref:i,src:"https://spacesmetaverse.readyplayer.me/avatar?frameApi",title:"Ready Player Me",width:"100%",height:"100%",style:{border:"none",borderRadius:"8px"},allow:"camera *; microphone *; clipboard-write"})})})})}function X6e({isOpen:n,onClose:e}){const[i,a]=D.useState(!1),[l,d]=D.useState(null),{user:p}=D.useContext(ca),y=Ug(),v=j=>{j.stopPropagation(),a(!0)},b=()=>{a(!1),e()},w=async j=>{if(d(j),p&&p.uid)try{await vse(p.uid,j.url),y("AvatarUrlFromReact",{url:j.url}),e()}catch(B){console.error("Error updating RPM URL:",B)}else console.error("No authenticated user found to update rpmURL.")},A=BCe("gray.200","whiteAlpha.300"),N="rgba(0, 0, 0, 0.3)",V=[{id:1,url:"https://models.readyplayer.me/67c8408d38f7924e15a8bd0a.glb",name:"Default Avatar 1"},{id:2,url:"https://models.readyplayer.me/67c8576838e3cf57cc697c15.glb",name:"Default Avatar 2"},{id:3,url:"https://models.readyplayer.me/67c884144c4878c55e515ff5.glb",name:"Default Avatar 3"},{id:4,url:"https://models.readyplayer.me/67c885af25f4d62e75c0ff1e.glb",name:"Default Avatar 4"},{id:5,url:"https://models.readyplayer.me/67c8860f4c4878c55e5189b6.glb",name:"Default Avatar 5"},{id:6,url:"https://models.readyplayer.me/67c8869db6d0b438b7abd822.glb",name:"Default Avatar 6"},{id:7,url:"https://models.readyplayer.me/67c886ed28ee0e0bfac89688.glb",name:"Default Avatar 7"},{id:8,url:"https://models.readyplayer.me/67c88731795ea3e2e6ea84db.glb",name:"Default Avatar 8"},{id:9,url:"https://models.readyplayer.me/67c8878b0cdc0f22383f0f8f.glb",name:"Default Avatar 9"}];return C.jsxs(C.Fragment,{children:[C.jsx(Vl,{children:C.jsxs(ra,{isOpen:n,onClose:e,isCentered:!0,size:"xl",zIndex:9999,children:[C.jsx(oa,{bg:"rgba(0, 0, 0, 0.7)"}),C.jsxs(ia,{bg:"gray.800",color:"white",maxW:"900px",children:[C.jsx(tl,{fontSize:"lg",children:"Customise Your Avatar"}),C.jsx(ja,{color:"white",_hover:{bg:"transparent",color:"whiteAlpha.800"},_focus:{boxShadow:"none"},size:"lg",position:"absolute",right:2,top:2}),C.jsx(sa,{pb:4,children:C.jsxs(ii,{spacing:4,align:"stretch",children:[C.jsx(ht,{fontSize:"sm",children:"Choose from our collection or create your own unique avatar"}),C.jsxs(Yte,{columns:5,spacing:2,children:[C.jsx(St,{position:"relative",cursor:"pointer",borderWidth:"2px",borderStyle:"dashed",borderColor:A,borderRadius:"lg",overflow:"hidden",onClick:v,_hover:{bg:N},transition:"all 0.2s",display:"flex",alignItems:"center",justifyContent:"center",aspectRatio:"1",children:C.jsxs(ii,{spacing:1,children:[C.jsx(Dn,{as:G6e,boxSize:4}),C.jsx(ht,{fontSize:"xs",children:"Create Custom Avatar"})]})}),V.map(j=>C.jsxs(St,{position:"relative",cursor:"pointer",borderWidth:"2px",borderColor:(l==null?void 0:l.id)===j.id?"blue.400":A,borderRadius:"lg",overflow:"hidden",onClick:()=>w(j),_hover:{bg:N},transition:"all 0.2s",aspectRatio:"1",children:[C.jsx(Gh,{src:j.url.replace(".glb",".png?scene=fullbody-portrait-closeupfront&w=640&q=75"),alt:j.name,width:"100%",height:"100%",objectFit:"cover"}),C.jsx(St,{position:"absolute",bottom:"0",left:"0",right:"0",p:1,bg:"rgba(0, 0, 0, 0.7)",children:C.jsx(ht,{fontSize:"xs",children:j.name})})]},j.id))]})]})})]})]})}),i&&C.jsx(aoe,{open:i,onClose:b})]})}function J6e(){const{fullscreenRef:n}=Ud(),[e,i]=D.useState(!1),[a,l]=D.useState(!1),[d,p]=D.useState(!1),[y,v]=D.useState(!1),{user:b}=D.useContext(ca),[w,A]=D.useState(null),[N,V]=D.useState(!0),j=(K,ne)=>!K||!ne?"?":`${K.charAt(0)}${ne.charAt(0)}`.toUpperCase(),B=async()=>{if(b!=null&&b.uid){V(!0);try{const K=await af(b.uid);A({rpmURL:K.rpmURL?K.rpmURL.replace(".glb",".png?scene=fullbody-portrait-closeupfront&w=640&q=75"):null,firstName:K.firstName,lastName:K.lastName})}catch(K){console.error("Error fetching profile data:",K)}finally{V(!1)}}};D.useEffect(()=>{B()},[b==null?void 0:b.uid]),D.useEffect(()=>{const K=()=>{i(!0)};return window.addEventListener("PlayerInstantiated",K),()=>{window.removeEventListener("PlayerInstantiated",K)}},[]);const G=()=>l(!a),ee=()=>{l(!1),B()};return e?C.jsxs(C.Fragment,{children:[C.jsx(hg,{label:"Edit Avatar",hasArrow:!0,placement:"top",closeOnClick:!0,isOpen:y,portalProps:{containerRef:n},children:C.jsxs(St,{position:"relative",onMouseEnter:()=>{p(!0),v(!0)},onMouseLeave:()=>{p(!1),v(!1)},cursor:"pointer",onClick:G,children:[C.jsx(ku,{src:N||w==null?void 0:w.rpmURL,size:"md",borderRadius:"full",bg:"white",name:N?j(w==null?void 0:w.firstName,w==null?void 0:w.lastName):" ",borderWidth:"1px",borderColor:"whiteAlpha.300"}),d&&C.jsx(St,{position:"absolute",top:"0",left:"0",right:"0",bottom:"0",display:"flex",alignItems:"center",justifyContent:"center",bg:"rgba(0, 0, 0, 0.4)",borderRadius:"full",children:C.jsx(ht,{fontSize:"xs",fontWeight:"bold",color:"white",children:"Edit"})})]})}),C.jsx(X6e,{isOpen:a,onClose:ee})]}):null}function Q6e(n){return Vr({attr:{viewBox:"0 0 1024 1024"},child:[{tag:"path",attr:{d:"M391 240.9c-.8-6.6-8.9-9.4-13.6-4.7l-43.7 43.7L200 146.3a8.03 8.03 0 0 0-11.3 0l-42.4 42.3a8.03 8.03 0 0 0 0 11.3L280 333.6l-43.9 43.9a8.01 8.01 0 0 0 4.7 13.6L401 410c5.1.6 9.5-3.7 8.9-8.9L391 240.9zm10.1 373.2L240.8 633c-6.6.8-9.4 8.9-4.7 13.6l43.9 43.9L146.3 824a8.03 8.03 0 0 0 0 11.3l42.4 42.3c3.1 3.1 8.2 3.1 11.3 0L333.7 744l43.7 43.7A8.01 8.01 0 0 0 391 783l18.9-160.1c.6-5.1-3.7-9.4-8.8-8.8zm221.8-204.2L783.2 391c6.6-.8 9.4-8.9 4.7-13.6L744 333.6 877.7 200c3.1-3.1 3.1-8.2 0-11.3l-42.4-42.3a8.03 8.03 0 0 0-11.3 0L690.3 279.9l-43.7-43.7a8.01 8.01 0 0 0-13.6 4.7L614.1 401c-.6 5.2 3.7 9.5 8.8 8.9zM744 690.4l43.9-43.9a8.01 8.01 0 0 0-4.7-13.6L623 614c-5.1-.6-9.5 3.7-8.9 8.9L633 783.1c.8 6.6 8.9 9.4 13.6 4.7l43.7-43.7L824 877.7c3.1 3.1 8.2 3.1 11.3 0l42.4-42.3c3.1-3.1 3.1-8.2 0-11.3L744 690.4z"}}]})(n)}function Z6e(n){return Vr({attr:{viewBox:"0 0 1024 1024"},child:[{tag:"path",attr:{d:"M290 236.4l43.9-43.9a8.01 8.01 0 0 0-4.7-13.6L169 160c-5.1-.6-9.5 3.7-8.9 8.9L179 329.1c.8 6.6 8.9 9.4 13.6 4.7l43.7-43.7L370 423.7c3.1 3.1 8.2 3.1 11.3 0l42.4-42.3c3.1-3.1 3.1-8.2 0-11.3L290 236.4zm352.7 187.3c3.1 3.1 8.2 3.1 11.3 0l133.7-133.6 43.7 43.7a8.01 8.01 0 0 0 13.6-4.7L863.9 169c.6-5.1-3.7-9.5-8.9-8.9L694.8 179c-6.6.8-9.4 8.9-4.7 13.6l43.9 43.9L600.3 370a8.03 8.03 0 0 0 0 11.3l42.4 42.4zM845 694.9c-.8-6.6-8.9-9.4-13.6-4.7l-43.7 43.7L654 600.3a8.03 8.03 0 0 0-11.3 0l-42.4 42.3a8.03 8.03 0 0 0 0 11.3L734 787.6l-43.9 43.9a8.01 8.01 0 0 0 4.7 13.6L855 864c5.1.6 9.5-3.7 8.9-8.9L845 694.9zm-463.7-94.6a8.03 8.03 0 0 0-11.3 0L236.3 733.9l-43.7-43.7a8.01 8.01 0 0 0-13.6 4.7L160.1 855c-.6 5.1 3.7 9.5 8.9 8.9L329.2 845c6.6-.8 9.4-8.9 4.7-13.6L290 787.6 423.7 654c3.1-3.1 3.1-8.2 0-11.3l-42.4-42.4z"}}]})(n)}function eWe(){const{isFullscreen:n,toggleFullscreen:e,fullscreenRef:i,isMobile:a}=Ud(),l=xu();D.useEffect(()=>{const p=y=>{console.error("Fullscreen error:",y),l({title:"Fullscreen Error",description:"Could not enter fullscreen mode. Try tapping the button again or use the browser's fullscreen option.",status:"error",duration:5e3,isClosable:!0,position:"top"})};return document.addEventListener("fullscreenerror",p),document.addEventListener("webkitfullscreenerror",p),document.addEventListener("mozfullscreenerror",p),document.addEventListener("MSFullscreenError",p),()=>{document.removeEventListener("fullscreenerror",p),document.removeEventListener("webkitfullscreenerror",p),document.removeEventListener("mozfullscreenerror",p),document.removeEventListener("MSFullscreenError",p)}},[l]);const d=()=>{i.current?(a&&/iPhone|iPad|iPod/i.test(navigator.userAgent)&&!n&&l({title:"Mobile Fullscreen",description:"Tap the button again if fullscreen doesn't activate. For iOS, you may need to use the browser's share button and 'Add to Home Screen' for the best experience.",status:"info",duration:5e3,isClosable:!0,position:"top"}),e()):(console.error("Fullscreen target not set"),l({title:"Fullscreen Error",description:"Could not find fullscreen target element.",status:"error",duration:3e3,isClosable:!0,position:"top"}))};return C.jsx(hg,{label:n?"Exit Fullscreen":"Enter Fullscreen",hasArrow:!0,placement:"bottom",closeOnClick:!0,portalProps:{containerRef:i},children:C.jsx(Ma,{"aria-label":n?"Exit Fullscreen":"Enter Fullscreen",icon:n?C.jsx(Q6e,{}):C.jsx(Z6e,{}),onClick:d,variant:"iconButton",size:a?"lg":"md"})})}const KJ={iframeContainer:{position:"relative",paddingBottom:"56.25%",height:0,overflow:"hidden",width:"100%"},iframe:{position:"absolute",top:0,left:0,width:"100%",height:"100%",border:"none"}};function tWe(){const{isOpen:n,onOpen:e,onClose:i}=rf(),{fullscreenRef:a}=Ud(),[l,d]=w6e(!1);D.useEffect(()=>{_e.log("VideoPlayer: Current video URL:",l),l&&(_e.log("VideoPlayer: Opening modal for video URL:",l),e())},[l,e]);const p=()=>{_e.log("VideoPlayer: Closing modal"),d(),i()};return C.jsx(Vl,{containerRef:a,children:C.jsxs(ra,{isOpen:n,onClose:p,size:"lg",isCentered:!0,portalProps:{containerRef:a},children:[C.jsx(oa,{bg:"rgba(0, 0, 0, 0.8)"}),C.jsxs(ia,{bg:"gray.900",color:"white",borderRadius:"lg",overflow:"hidden",maxWidth:"80vw",maxHeight:"80vh",display:"flex",justifyContent:"center",alignItems:"center",position:"relative",zIndex:"modal",children:[C.jsx(ja,{size:"lg",bg:"gray.700",color:"white",borderRadius:"full",zIndex:"modal",_hover:{bg:"gray.600"},_focus:{boxShadow:"none"},position:"absolute",top:"10px",right:"10px"}),C.jsx(sa,{p:0,width:"100%",children:l&&C.jsx(St,{style:KJ.iframeContainer,children:C.jsx("iframe",{src:l,style:KJ.iframe,allow:"autoplay; fullscreen",allowFullScreen:!0,title:"Video Player"})})})]})]})})}function nWe({isOpen:n,onClose:e,playerName:i,playerId:a,uid:l}){const[d,p]=D.useState(null),[y,v]=D.useState(!0),[b,w]=D.useState(null);return D.useEffect(()=>{n&&(async()=>{if(v(!0),w(null),!l){_e.warn("NameplateModal: No UID provided for player:",i),w("No user ID available for this player"),v(!1);return}try{_e.log("NameplateModal: Fetching profile for UID:",l);const N=await af(l);N?p({firstName:N.firstName,lastName:N.lastName,linkedinUrl:N.linkedinUrl,websiteUrl:N.websiteUrl,rpmURL:N.rpmURL?N.rpmURL.replace(".glb",".png?scene=fullbody-portrait-closeupfront&w=640&q=75"):null}):w("Could not find profile data for this player")}catch(N){_e.error("Error fetching profile data:",N),w("Error loading profile data")}finally{v(!1)}})()},[l,n,i]),C.jsxs(ra,{isOpen:n,onClose:e,isCentered:!0,size:"md",children:[C.jsx(oa,{backdropFilter:"blur(10px)"}),C.jsxs(ia,{bg:"gray.900",color:"white",borderRadius:"xl",children:[C.jsx(tl,{children:"Player Info"}),C.jsx(ja,{}),C.jsx(sa,{pb:6,children:y?C.jsx(hte,{py:8,children:C.jsx(lf,{size:"xl",color:"blue.400"})}):b?C.jsxs(lg,{status:"warning",variant:"solid",borderRadius:"md",children:[C.jsx(ug,{}),b]}):C.jsxs(ii,{spacing:4,align:"center",children:[C.jsx(ku,{size:"2xl",src:d==null?void 0:d.rpmURL,bg:"whiteAlpha.300",name:i,borderWidth:"2px",borderColor:"whiteAlpha.300"}),C.jsxs(ii,{spacing:1,children:[C.jsx(ht,{fontSize:"2xl",fontWeight:"bold",children:i}),(d==null?void 0:d.firstName)&&C.jsxs(ht,{fontSize:"md",color:"gray.400",children:[d.firstName," ",d.lastName]}),C.jsxs(ht,{fontSize:"xs",color:"gray.500",mt:1,children:["ID: ",a]})]}),((d==null?void 0:d.linkedinUrl)||(d==null?void 0:d.websiteUrl))&&C.jsxs(C.Fragment,{children:[C.jsx(Cp,{borderColor:"whiteAlpha.300"}),C.jsxs(Oi,{spacing:4,pt:2,children:[(d==null?void 0:d.linkedinUrl)&&C.jsx(Iu,{href:d.linkedinUrl,isExternal:!0,children:C.jsx(Ma,{icon:C.jsx(soe,{}),variant:"ghost",colorScheme:"linkedin",size:"lg","aria-label":"LinkedIn profile",_hover:{bg:"whiteAlpha.200"}})}),(d==null?void 0:d.websiteUrl)&&C.jsx(Iu,{href:d.websiteUrl,isExternal:!0,children:C.jsx(Ma,{icon:C.jsx(ooe,{}),variant:"ghost",colorScheme:"blue",size:"lg","aria-label":"Personal website",_hover:{bg:"whiteAlpha.200"}})})]})]})]})})]})]})}const rWe=({isVisible:n,onToggleVisibility:e,spaceID:i})=>{const[a]=bDe("(max-width: 768px)"),[l,d]=D.useState(!1);D.useEffect(()=>{(()=>{const Ce=navigator.userAgent||navigator.vendor||window.opera,Ne=/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(Ce);d(Ne),Ne&&_e.log("UnityPlayerList: Mobile browser detected, component will not render")})()},[]);const p=a||l,y=toe(),[v,b]=D.useState(!1),[w,A]=D.useState([]),[N,V]=D.useState(!1),[j,B]=D.useState({}),[G,ee]=D.useState({}),[K,ne]=D.useState(null),[ce,oe]=D.useState(!1),ge=xu(),te=window.currentUser||{},J=(()=>{if(i)return i;if(window.spaceID)return window.spaceID;const Ce=(window.location.pathname||"").split("/"),ve=Ce[Ce.length-1];if(ve&&ve.length>5)return ve;const Ne=document.body.getAttribute("data-space-id");if(Ne)return Ne;const Te=localStorage.getItem("currentSpaceId");return Te||"fallback-space-id"})();D.useEffect(()=>{(async()=>{try{const ve=await _g(J);ve&&ve.voiceDisabled?(console.log("UnityPlayerList: Voice is disabled for this space"),oe(!0)):oe(!1)}catch(ve){console.error("UnityPlayerList: Error checking if voice is disabled:",ve)}})();const Ce=ve=>{ve.detail&&typeof ve.detail.voiceDisabled=="boolean"&&(console.log("UnityPlayerList: Voice setting changed:",ve.detail.voiceDisabled),oe(ve.detail.voiceDisabled))};return window.addEventListener("SpaceVoiceSettingChanged",Ce),()=>{window.removeEventListener("SpaceVoiceSettingChanged",Ce)}},[J]),D.useEffect(()=>{const we={};y.forEach(Ce=>{if(Ce.uid){if(Ce.isLocalPlayer&&window.agoraClient&&window.agoraClient.client)we[Ce.uid]=window.agoraClient.client.uid;else if(window.agoraClient&&window.agoraClient.client&&window.agoraClient.client.remoteUsers){const ve=window.agoraClient.client.remoteUsers,Ne=ve.find(Te=>String(Te.uid)===String(Ce.uid));if(Ne)we[Ce.uid]=Ne.uid;else{const Te=ve.find(be=>typeof be.uid=="string"&&be.uid.includes(Ce.uid));if(Te)we[Ce.uid]=Te.uid;else{const be=ve.find(Ae=>typeof Ce.uid=="string"&&Ce.uid.includes(String(Ae.uid)));if(be)we[Ce.uid]=be.uid;else{const Ae=ve.filter(Ue=>!(typeof Ue.uid=="string"&&Ue.uid.startsWith("screen-")));Ae.length===1&&!Ce.isLocalPlayer&&(we[Ce.uid]=Ae[0].uid)}}}}}}),ee(we)},[y]);const se=()=>{if(window.agoraClient&&typeof window.agoraClient.isVoiceEnabled=="boolean"){const we=window.agoraClient.isVoiceEnabled;we!==N&&V(we)}if(window.agoraClient&&window.agoraClient.client&&window.agoraClient.client.remoteUsers){const we=window.agoraClient.client.remoteUsers,Ce={};we.forEach(ve=>{typeof ve.uid=="string"&&ve.uid.startsWith("screen-")||(Ce[ve.uid]=!!ve.audioTrack&&!ve.audioTrack.muted)}),JSON.stringify(Ce)!==JSON.stringify(j)&&B(Ce)}};D.useEffect(()=>{const we=setInterval(se,500),Ce=ve=>{ve.detail&&typeof ve.detail.enabled=="boolean"&&V(ve.detail.enabled)};return window.addEventListener("VoiceToggled",Ce),se(),()=>{clearInterval(we),window.removeEventListener("VoiceToggled",Ce)}},[]),D.useEffect(()=>{const we=()=>{_e.log("UnityPlayerList: Player instantiated, showing list"),b(!0)};return window.addEventListener("PlayerInstantiated",we),window.isPlayerInstantiated&&(_e.log("UnityPlayerList: Player was already instantiated"),b(!0)),()=>{window.removeEventListener("PlayerInstantiated",we)}},[]),D.useEffect(()=>{(async()=>{const Ce=await Promise.all(y.map(async ve=>{if(ve.uid)try{const Ne=await af(ve.uid);let Te=null;if(Ne.groups){const be=`space_${J}_owners`,Ae=`space_${J}_hosts`;Ne.groups.includes(be)?Te="owner":Ne.groups.includes(Ae)&&(Te="host")}return ue({uid:ve.uid})&&ne(Te),{...ve,firstName:Ne.firstName,lastName:Ne.lastName,linkedInProfile:Ne.linkedInProfile,websiteUrl:Ne.websiteUrl,rpmURL:Ne.rpmURL?Ne.rpmURL.replace(".glb",".png?scene=fullbody-portrait-closeupfront&w=640&q=75"):null,role:Te}}catch(Ne){return _e.error(`Error fetching data for player ${ve.playerName}:`,Ne),ve}return ve}));A(Ce)})()},[y,J]);const he=[...w].sort((we,Ce)=>we.isLocalPlayer?-1:Ce.isLocalPlayer?1:0),fe=()=>{_e.log("UnityPlayerList: Toggling visibility"),e&&e()},ue=we=>!!(we.isLocalPlayer||te&&te.uid&&we.uid===te.uid),Me=we=>{try{if(ue(we))return window.agoraClient&&typeof window.agoraClient.isVoiceEnabled=="boolean"?window.agoraClient.isVoiceEnabled:N;if(we.uid){if(j[we.uid])return!0;const Ce=G[we.uid];if(Ce&&j[Ce])return!0;const ve=parseInt(we.uid);if(!isNaN(ve)&&j[ve])return!0}return!1}catch(Ce){return console.error("Error in hasActiveMic:",Ce),!1}},He=({player:we})=>{const Ce=we.role;return Ce==="owner"?C.jsxs(Oi,{spacing:1,bg:"green.900",p:2,borderRadius:"md",px:3,boxShadow:"0 0 10px rgba(72, 187, 120, 0.5)",border:"1px solid",borderColor:"green.400",children:[C.jsx(Dn,{as:qV,color:"green.400",boxSize:5}),C.jsx(_p,{colorScheme:"green",variant:"solid",fontSize:"md",px:2,children:"Owner"})]}):Ce==="host"?C.jsxs(Oi,{spacing:1,bg:"purple.900",p:2,borderRadius:"md",px:3,boxShadow:"0 0 10px rgba(159, 122, 234, 0.5)",border:"1px solid",borderColor:"purple.400",children:[C.jsx(Dn,{as:JV,color:"purple.400",boxSize:5}),C.jsx(_p,{colorScheme:"purple",variant:"solid",fontSize:"md",px:2,children:"Host"})]}):null},rt=(we,Ce)=>{switch(console.log(`Action "${we}" performed on player: ${Ce.playerName}`),we){case"mute":ge({title:"Player Muted",description:`${Ce.playerName} has been muted.`,status:"info",duration:3e3,isClosable:!0});break;case"kick":ge({title:"Player Kicked",description:`${Ce.playerName} has been kicked from the space.`,status:"warning",duration:3e3,isClosable:!0});break;case"promote":ge({title:"Player Promoted",description:`${Ce.playerName} has been promoted to host.`,status:"success",duration:3e3,isClosable:!0});break}};return C.jsxs(St,{position:"absolute",top:"100px",right:"20px",zIndex:"1",bg:"rgba(0,0,0,0.4)",p:4,borderRadius:"md",color:"white",minWidth:"200px",maxHeight:"300px",visibility:v&&n&&!p?"visible":"hidden",role:"group",children:[C.jsx(St,{position:"absolute",top:2,right:2,opacity:0,_groupHover:{opacity:1},transition:"opacity 0.2s",children:C.jsx(Ma,{icon:C.jsx(jBe,{boxSize:3}),size:"xs","aria-label":"Close list",variant:"unstyled",color:"white",onClick:fe,_hover:{opacity:.8}})}),C.jsxs(ht,{fontWeight:"bold",mb:2,fontSize:"sm",children:["People Online: ",y.length]}),C.jsx(St,{maxHeight:"200px",overflowY:"auto",css:{"&::-webkit-scrollbar":{width:"4px"},"&::-webkit-scrollbar-track":{background:"rgba(0,0,0,0.1)"},"&::-webkit-scrollbar-thumb":{background:"rgba(255,255,255,0.3)",borderRadius:"2px"}},children:C.jsx(ii,{align:"stretch",spacing:1,width:"100%",children:he.map((we,Ce)=>{const ve=ue(we),Ne=!ce&&Me(we);return C.jsx(St,{children:C.jsxs(Tne,{placement:"left",trigger:"hover",children:[C.jsx(Ane,{children:C.jsxs(Oi,{width:"100%",spacing:2,p:1,borderRadius:"md",_hover:{bg:"whiteAlpha.200"},transition:"background 0.2s",children:[C.jsx(ku,{size:"xs",src:we.rpmURL,bg:"whiteAlpha.400",name:" ",borderWidth:"1px",borderColor:"whiteAlpha.300"}),C.jsx(ht,{fontSize:"xs",children:we.playerName}),we.role==="owner"&&C.jsx(Dn,{as:qV,color:"green.400",boxSize:2.5}),we.role==="host"&&C.jsx(Dn,{as:JV,color:"purple.400",boxSize:2.5}),C.jsx(Lk,{}),K==="owner"&&C.jsxs(rC,{closeOnSelect:!0,placement:"bottom-end",children:[C.jsx(iC,{as:Ma,"aria-label":"Options",icon:C.jsx(F6e,{}),variant:"ghost",size:"xs",color:"whiteAlpha.700",_hover:{color:"white",bg:"whiteAlpha.300"},onClick:Te=>Te.stopPropagation()}),C.jsxs(sC,{bg:"rgba(0,0,0,0.8)",borderColor:"whiteAlpha.300",minW:"120px",zIndex:10001,children:[C.jsx(Pd,{icon:C.jsx(Y6e,{}),onClick:()=>rt("mute",we),_hover:{bg:"whiteAlpha.200"},fontSize:"sm",isDisabled:ce,children:"Mute Player"}),C.jsx(Pd,{icon:C.jsx($6e,{}),onClick:()=>rt("promote",we),_hover:{bg:"whiteAlpha.200"},fontSize:"sm",children:"Promote to Host"}),C.jsx(lne,{borderColor:"whiteAlpha.300"}),C.jsx(Pd,{icon:C.jsx(U6e,{}),onClick:()=>rt("kick",we),_hover:{bg:"red.800"},color:"red.300",fontSize:"sm",children:"Kick from Space"})]})]}),!ce&&(Ne?C.jsx(St,{color:"green.400",children:C.jsx(XV,{})}):C.jsx(St,{color:"red.400",children:C.jsx(YV,{})})),ve&&C.jsx(ht,{fontSize:"xs",color:"gray.300",ml:1,children:"(you)"})]})}),C.jsx(Ine,{bg:"rgba(0,0,0,0.8)",border:"none",boxShadow:"dark-lg",color:"white",p:4,width:"auto",minWidth:"250px",ml:"-20px",position:"absolute",left:"-250px",top:"-100px",transform:"none !important",zIndex:1e4,children:C.jsx(Rne,{children:C.jsxs(ii,{align:"center",spacing:3,children:[C.jsx(ku,{size:"xl",src:we.rpmURL,bg:"whiteAlpha.400",name:" ",borderWidth:"2px",borderColor:"whiteAlpha.300"}),C.jsx(ht,{fontSize:"xl",fontWeight:"bold",children:we.playerName}),C.jsx(He,{player:we}),we.firstName&&C.jsxs(ht,{fontSize:"sm",color:"gray.300",children:[we.firstName," ",we.lastName]}),C.jsxs(Oi,{spacing:4,pt:2,children:[we.linkedInProfile&&C.jsx(Iu,{href:we.linkedInProfile,isExternal:!0,children:C.jsx(Ma,{icon:C.jsx(soe,{}),variant:"ghost",colorScheme:"whiteAlpha",size:"md","aria-label":"LinkedIn profile",_hover:{bg:"whiteAlpha.200"}})}),we.websiteUrl&&C.jsx(Iu,{href:we.websiteUrl,isExternal:!0,children:C.jsx(Ma,{icon:C.jsx(ooe,{}),variant:"ghost",colorScheme:"whiteAlpha",size:"md","aria-label":"Personal website",_hover:{bg:"whiteAlpha.200"}})}),!ce&&C.jsx(Ma,{icon:Ne?C.jsx(XV,{}):C.jsx(YV,{}),variant:"ghost",colorScheme:Ne?"green":"red",size:"md","aria-label":"Microphone status",isDisabled:!0}),ce&&C.jsx(Ma,{icon:C.jsx(q6e,{}),variant:"ghost",colorScheme:"red",size:"md","aria-label":"Voice chat disabled",isDisabled:!0,title:"Voice chat is disabled for this space"})]})]})})})]})},Ce)})})})]})};var Ek={exports:{}},iWe=Ek.exports,qJ;function sWe(){return qJ||(qJ=1,function(n,e){(function(i,a){n.exports=a()})(iWe,function(){function i(t,r){return r.forEach(function(s){s&&typeof s!="string"&&!Array.isArray(s)&&Object.keys(s).forEach(function(o){if(o!=="default"&&!(o in t)){var c=Object.getOwnPropertyDescriptor(s,o);Object.defineProperty(t,o,c.get?c:{enumerable:!0,get:function(){return s[o]}})}})}),Object.freeze(t)}var a=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof my<"u"?my:typeof self<"u"?self:{};function l(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var d=function(t){try{return!!t()}catch{return!0}},p=!d(function(){var t=(function(){}).bind();return typeof t!="function"||t.hasOwnProperty("prototype")}),y=p,v=Function.prototype,b=v.call,w=y&&v.bind.bind(b,b),A=y?w:function(t){return function(){return b.apply(t,arguments)}},N=A({}.isPrototypeOf),V=function(t){return t&&t.Math==Math&&t},j=V(typeof globalThis=="object"&&globalThis)||V(typeof window=="object"&&window)||V(typeof self=="object"&&self)||V(typeof a=="object"&&a)||function(){return this}()||a||Function("return this")(),B=p,G=Function.prototype,ee=G.apply,K=G.call,ne=typeof Reflect=="object"&&Reflect.apply||(B?K.bind(ee):function(){return K.apply(ee,arguments)}),ce=A,oe=ce({}.toString),ge=ce("".slice),te=function(t){return ge(oe(t),8,-1)},Z=te,J=A,se=function(t){if(Z(t)==="Function")return J(t)},he=typeof document=="object"&&document.all,fe={all:he,IS_HTMLDDA:he===void 0&&he!==void 0},ue=fe.all,Me=fe.IS_HTMLDDA?function(t){return typeof t=="function"||t===ue}:function(t){return typeof t=="function"},He={},rt=!d(function(){return Object.defineProperty({},1,{get:function(){return 7}})[1]!=7}),we=p,Ce=Function.prototype.call,ve=we?Ce.bind(Ce):function(){return Ce.apply(Ce,arguments)},Ne={},Te={}.propertyIsEnumerable,be=Object.getOwnPropertyDescriptor,Ae=be&&!Te.call({1:2},1);Ne.f=Ae?function(t){var r=be(this,t);return!!r&&r.enumerable}:Te;var Ue,ze,et=function(t,r){return{enumerable:!(1&t),configurable:!(2&t),writable:!(4&t),value:r}},nt=d,dt=te,Xe=Object,It=A("".split),hn=nt(function(){return!Xe("z").propertyIsEnumerable(0)})?function(t){return dt(t)=="String"?It(t,""):Xe(t)}:Xe,Ut=function(t){return t==null},ln=Ut,xn=TypeError,Xt=function(t){if(ln(t))throw xn("Can't call method on "+t);return t},Yn=hn,qt=Xt,Re=function(t){return Yn(qt(t))},Fe=Me,Ke=fe.all,Et=fe.IS_HTMLDDA?function(t){return typeof t=="object"?t!==null:Fe(t)||t===Ke}:function(t){return typeof t=="object"?t!==null:Fe(t)},bt={},Ge=bt,Ot=j,Jt=Me,fn=function(t){return Jt(t)?t:void 0},an=function(t,r){return arguments.length<2?fn(Ge[t])||fn(Ot[t]):Ge[t]&&Ge[t][r]||Ot[t]&&Ot[t][r]},ir=typeof navigator<"u"&&String(navigator.userAgent)||"",la=j,Vt=ir,sn=la.process,ki=la.Deno,_i=sn&&sn.versions||ki&&ki.version,Ri=_i&&_i.v8;Ri&&(ze=(Ue=Ri.split("."))[0]>0&&Ue[0]<4?1:+(Ue[0]+Ue[1])),!ze&&Vt&&(!(Ue=Vt.match(/Edge\/(\d+)/))||Ue[1]>=74)&&(Ue=Vt.match(/Chrome\/(\d+)/))&&(ze=+Ue[1]);var dr=ze,Wa=dr,il=d,uo=j.String,ho=!!Object.getOwnPropertySymbols&&!il(function(){var t=Symbol();return!uo(t)||!(Object(t)instanceof Symbol)||!Symbol.sham&&Wa&&Wa<41}),Fl=ho&&!Symbol.sham&&typeof Symbol.iterator=="symbol",js=an,uc=Me,ua=N,dc=Object,sl=Fl?function(t){return typeof t=="symbol"}:function(t){var r=js("Symbol");return uc(r)&&ua(r.prototype,dc(t))},Mu=String,hc=function(t){try{return Mu(t)}catch{return"Object"}},ol=Me,Ao=hc,ji=TypeError,hs=function(t){if(ol(t))return t;throw ji(Ao(t)+" is not a function")},za=hs,Uu=Ut,fc=function(t,r){var s=t[r];return Uu(s)?void 0:za(s)},da=ve,ha=Me,Fd=Et,Vg=TypeError,Vu={exports:{}},hf=j,Bs=Object.defineProperty,Fu=function(t,r){try{Bs(hf,t,{value:r,configurable:!0,writable:!0})}catch{hf[t]=r}return r},fa="__core-js_shared__",jd=j[fa]||Fu(fa,{}),Bd=jd;(Vu.exports=function(t,r){return Bd[t]||(Bd[t]=r!==void 0?r:{})})("versions",[]).push({version:"3.31.1",mode:"pure",copyright:" 2014-2023 Denis Pushkarev (zloirock.ru)",license:"https://github.com/zloirock/core-js/blob/v3.31.1/LICENSE",source:"https://github.com/zloirock/core-js"});var Ga=Vu.exports,Wd=Xt,ju=Object,Po=function(t){return ju(Wd(t))},zd=Po,Fr=A({}.hasOwnProperty),yi=Object.hasOwn||function(t,r){return Fr(zd(t),r)},pc=A,al=0,pa=Math.random(),ff=pc(1 .toString),Gd=function(t){return"Symbol("+(t===void 0?"":t)+")_"+ff(++al+pa,36)},jl=Ga,fo=yi,Bp=Gd,Xs=ho,pf=Fl,cl=j.Symbol,Hd=jl("wks"),$d=pf?cl.for||cl:cl&&cl.withoutSetter||Bp,hr=function(t){return fo(Hd,t)||(Hd[t]=Xs&&fo(cl,t)?cl[t]:$d("Symbol."+t)),Hd[t]},Bl=ve,Wl=Et,Bu=sl,Ha=fc,Oo=function(t,r){var s,o;if(ha(s=t.toString)&&!Fd(o=da(s,t))||ha(s=t.valueOf)&&!Fd(o=da(s,t)))return o;throw Vg("Can't convert object to primitive value")},Wu=TypeError,ll=hr("toPrimitive"),zl=function(t,r){if(!Wl(t)||Bu(t))return t;var s,o=Ha(t,ll);if(o){if(s=Bl(o,t,r),!Wl(s)||Bu(s))return s;throw Wu("Can't convert object to primitive value")}return Oo(t)},Gr=sl,$a=function(t){var r=zl(t,"string");return Gr(r)?r:r+""},nr=Et,mc=j.document,Wp=nr(mc)&&nr(mc.createElement),Gl=function(t){return Wp?mc.createElement(t):{}},Kd=Gl,mf=!rt&&!d(function(){return Object.defineProperty(Kd("div"),"a",{get:function(){return 7}}).a!=7}),zp=rt,gf=ve,ko=Ne,is=et,No=Re,Do=$a,Hl=yi,Lo=mf,xo=Object.getOwnPropertyDescriptor;He.f=zp?xo:function(t,r){if(t=No(t),r=Do(r),Lo)try{return xo(t,r)}catch{}if(Hl(t,r))return is(!gf(ko.f,t,r),t[r])};var Gp=d,gc=Me,fs=/#|\.prototype\./,zu=function(t,r){var s=ul[_f(t)];return s==Hp||s!=$l&&(gc(r)?Gp(r):!!r)},_f=zu.normalize=function(t){return String(t).replace(fs,".").toLowerCase()},ul=zu.data={},$l=zu.NATIVE="N",Hp=zu.POLYFILL="P",ma=zu,ga=hs,dl=p,Se=se(se.bind),De=function(t,r){return ga(t),r===void 0?t:dl?Se(t,r):function(){return t.apply(r,arguments)}},tt={},Kt=rt&&d(function(){return Object.defineProperty(function(){},"prototype",{value:42,writable:!1}).prototype!=42}),Hn=Et,yr=String,jr=TypeError,cn=function(t){if(Hn(t))return t;throw jr(yr(t)+" is not an object")},Nr=rt,Ei=mf,Os=Kt,Mo=cn,Uo=$a,Gu=TypeError,Ji=Object.defineProperty,hl=Object.getOwnPropertyDescriptor,qd="enumerable",_c="configurable",Fg="writable";tt.f=Nr?Os?function(t,r,s){if(Mo(t),r=Uo(r),Mo(s),typeof t=="function"&&r==="prototype"&&"value"in s&&Fg in s&&!s[Fg]){var o=hl(t,r);o&&o[Fg]&&(t[r]=s.value,s={configurable:_c in s?s[_c]:o[_c],enumerable:qd in s?s[qd]:o[qd],writable:!1})}return Ji(t,r,s)}:Ji:function(t,r,s){if(Mo(t),r=Uo(r),Mo(s),Ei)try{return Ji(t,r,s)}catch{}if("get"in s||"set"in s)throw Gu("Accessors not supported");return"value"in s&&(t[r]=s.value),t};var $p=tt,Hu=et,Vo=rt?function(t,r,s){return $p.f(t,r,Hu(1,s))}:function(t,r,s){return t[r]=s,t},Kl=j,Kp=ne,jg=se,Jy=Me,qp=He.f,Yp=ma,$u=bt,Ku=De,qu=Vo,Bg=yi,Qy=function(t){var r=function(s,o,c){if(this instanceof r){switch(arguments.length){case 0:return new t;case 1:return new t(s);case 2:return new t(s,o)}return new t(s,o,c)}return Kp(t,this,arguments)};return r.prototype=t.prototype,r},Mn=function(t,r){var s,o,c,u,h,m,_,E,S,R=t.target,P=t.global,k=t.stat,z=t.proto,U=P?Kl:k?Kl[R]:(Kl[R]||{}).prototype,F=P?$u:$u[R]||qu($u,R,{})[R],q=F.prototype;for(u in r)o=!(s=Yp(P?u:R+(k?".":"#")+u,t.forced))&&U&&Bg(U,u),m=F[u],o&&(_=t.dontCallGetSet?(S=qp(U,u))&&S.value:U[u]),h=o&&_?_:r[u],o&&typeof m==typeof h||(E=t.bind&&o?Ku(h,Kl):t.wrap&&o?Qy(h):z&&Jy(h)?jg(h):h,(t.sham||h&&h.sham||m&&m.sham)&&qu(E,"sham",!0),qu(F,u,E),z&&(Bg($u,c=R+"Prototype")||qu($u,c,{}),qu($u[c],u,h),t.real&&q&&(s||!q[u])&&qu(q,u,h)))},Xp=Math.ceil,Fo=Math.floor,Zy=Math.trunc||function(t){var r=+t;return(r>0?Fo:Xp)(r)},eE=Zy,yc=function(t){var r=+t;return r!=r||r===0?0:eE(r)},I=yc,W=Math.max,Q=Math.min,pe=function(t,r){var s=I(t);return s<0?W(s+r,0):Q(s,r)},qe=yc,at=Math.min,xt=function(t){return t>0?at(qe(t),9007199254740991):0},Hr=xt,oi=function(t){return Hr(t.length)},Er=Re,Ws=pe,ps=oi,Ka=function(t){return function(r,s,o){var c,u=Er(r),h=ps(u),m=Ws(o,h);if(t&&s!=s){for(;h>m;)if((c=u[m++])!=c)return!0}else for(;h>m;m++)if((t||m in u)&&u[m]===s)return t||m||0;return!t&&-1}},jo={includes:Ka(!0),indexOf:Ka(!1)},yf=jo.includes;Mn({target:"Array",proto:!0,forced:d(function(){return!Array(1).includes()})},{includes:function(t){return yf(this,t,arguments.length>1?arguments[1]:void 0)}});var Jp=bt,qa=function(t){return Jp[t+"Prototype"]},SC=qa("Array").includes,bC=Et,Qp=te,_N=hr("match"),TC=function(t){var r;return bC(t)&&((r=t[_N])!==void 0?!!r:Qp(t)=="RegExp")},yN=TC,wC=TypeError,W0={};W0[hr("toStringTag")]="z";var Ef=String(W0)==="[object z]",Wg=Ef,EN=Me,vf=te,vN=hr("toStringTag"),RC=Object,z0=vf(function(){return arguments}())=="Arguments",Ec=Wg?vf:function(t){var r,s,o;return t===void 0?"Undefined":t===null?"Null":typeof(s=function(c,u){try{return c[u]}catch{}}(r=RC(t),vN))=="string"?s:z0?vf(r):(o=vf(r))=="Object"&&EN(r.callee)?"Arguments":o},CC=Ec,IC=String,_a=function(t){if(CC(t)==="Symbol")throw TypeError("Cannot convert a Symbol value to a string");return IC(t)},SN=hr("match"),bN=Mn,TN=function(t){if(yN(t))throw wC("The method doesn't accept regular expressions");return t},wN=Xt,AC=_a,fl=function(t){var r=/./;try{"/./"[t](r)}catch{try{return r[SN]=!1,"/./"[t](r)}catch{}}return!1},zg=A("".indexOf);bN({target:"String",proto:!0,forced:!fl("includes")},{includes:function(t){return!!~zg(AC(wN(this)),AC(TN(t)),arguments.length>1?arguments[1]:void 0)}});var PC=qa("String").includes,G0=N,OC=SC,kC=PC,Gg=Array.prototype,H0=String.prototype,RN=function(t){var r=t.includes;return t===Gg||G0(Gg,t)&&r===Gg.includes?OC:typeof t=="string"||t===H0||G0(H0,t)&&r===H0.includes?kC:r},ot=l(RN),$0=hs,Hg=Po,K0=hn,NC=oi,tE=TypeError,Zp=function(t){return function(r,s,o,c){$0(s);var u=Hg(r),h=K0(u),m=NC(u),_=t?m-1:0,E=t?-1:1;if(o<2)for(;;){if(_ in h){c=h[_],_+=E;break}if(_+=E,t?_<0:m<=_)throw tE("Reduce of empty array with no initial value")}for(;t?_>=0:m>_;_+=E)_ in h&&(c=s(c,h[_],_,u));return c}},q0={left:Zp(!1)},DC=d,Sf=function(t,r){var s=[][t];return!!s&&DC(function(){s.call(null,r||function(){return 1},1)})},bf=typeof process<"u"&&te(process)=="process",LC=q0.left;Mn({target:"Array",proto:!0,forced:!bf&&dr>79&&dr<83||!Sf("reduce")},{reduce:function(t){var r=arguments.length;return LC(this,t,r,r>1?arguments[1]:void 0)}});var xC=qa("Array").reduce,MC=N,UC=xC,nE=Array.prototype,Yd=function(t){var r=t.reduce;return t===nE||MC(nE,t)&&r===nE.reduce?UC:r},rE=Yd,Ya=l(rE),CN=te,$g=Array.isArray||function(t){return CN(t)=="Array"},Kg=Mn,IN=$g,VC=A([].reverse),Y0=[1,2];Kg({target:"Array",proto:!0,forced:String(Y0)===String(Y0.reverse())},{reverse:function(){return IN(this)&&(this.length=this.length),VC(this)}});var Ci=qa("Array").reverse,X0=N,iE=Ci,Tf=Array.prototype,FC=function(t){var r=t.reverse;return t===Tf||X0(Tf,t)&&r===Tf.reverse?iE:r},sE=FC,em=l(sE),oE=Gd,wf=Ga("keys"),qg=function(t){return wf[t]||(wf[t]=oE(t))},AN=!d(function(){function t(){}return t.prototype.constructor=null,Object.getPrototypeOf(new t)!==t.prototype}),PN=yi,jC=Me,aE=Po,cE=AN,lE=qg("IE_PROTO"),Yg=Object,J0=Yg.prototype,Xg=cE?Yg.getPrototypeOf:function(t){var r=aE(t);if(PN(r,lE))return r[lE];var s=r.constructor;return jC(s)&&r instanceof s?s.prototype:r instanceof Yg?J0:null},ON=A,BC=hs,kN=Me,NN=String,Q0=TypeError,Xd=function(t,r,s){try{return ON(BC(Object.getOwnPropertyDescriptor(t,r)[s]))}catch{}},WC=cn,tm=function(t){if(typeof t=="object"||kN(t))return t;throw Q0("Can't set "+NN(t)+" as a prototype")},ql=Object.setPrototypeOf||("__proto__"in{}?function(){var t,r=!1,s={};try{(t=Xd(Object.prototype,"__proto__","set"))(s,[]),r=s instanceof Array}catch{}return function(o,c){return WC(o),tm(c),r?t(o,c):o.__proto__=c,o}}():void 0),Jd={},vc={},Jg=yi,DN=Re,LN=jo.indexOf,Rf=vc,nm=A([].push),Cf=function(t,r){var s,o=DN(t),c=0,u=[];for(s in o)!Jg(Rf,s)&&Jg(o,s)&&nm(u,s);for(;r.length>c;)Jg(o,s=r[c++])&&(~LN(u,s)||nm(u,s));return u},rm=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"],Z0=Cf,im=rm.concat("length","prototype");Jd.f=Object.getOwnPropertyNames||function(t){return Z0(t,im)};var Sc={};Sc.f=Object.getOwnPropertySymbols;var Ii=an,vi=Jd,Qd=Sc,po=cn,ya=A([].concat),If=Ii("Reflect","ownKeys")||function(t){var r=vi.f(po(t)),s=Qd.f;return s?ya(r,s(t)):r},Af=yi,Ea=If,uE=He,zC=tt,dE={},hE=Cf,GC=rm,bc=Object.keys||function(t){return hE(t,GC)},fE=rt,eb=Kt,HC=tt,xN=cn,Zd=Re,sm=bc;dE.f=fE&&!eb?Object.defineProperties:function(t,r){xN(t);for(var s,o=Zd(r),c=sm(r),u=c.length,h=0;u>h;)HC.f(t,s=c[h++],o[s]);return t};var Yu,Qg=an("document","documentElement"),pE=cn,Tc=dE,Xa=rm,Pf=vc,Xu=Qg,Ju=Gl,Qu="prototype",mE="script",gE=qg("IE_PROTO"),Zg=function(){},va=function(t){return"<"+mE+">"+t+"</"+mE+">"},Sa=function(t){t.write(va("")),t.close();var r=t.parentWindow.Object;return t=null,r},ai=function(){try{Yu=new ActiveXObject("htmlfile")}catch{}var t,r,s;ai=typeof document<"u"?document.domain&&Yu?Sa(Yu):(r=Ju("iframe"),s="java"+mE+":",r.style.display="none",Xu.appendChild(r),r.src=String(s),(t=r.contentWindow.document).open(),t.write(va("document.F=Object")),t.close(),t.F):Sa(Yu);for(var o=Xa.length;o--;)delete ai[Qu][Xa[o]];return ai()};Pf[gE]=!0;var Bo=Object.create||function(t,r){var s;return t!==null?(Zg[Qu]=pE(t),s=new Zg,Zg[Qu]=null,s[gE]=t):s=ai(),r===void 0?s:Tc.f(s,r)},$C=Et,KC=Vo,_E=Error,tb=A("".replace),qC=String(_E("zxcasd").stack),e_=/\n\s*at [^:]*:[^\n]*/,YC=e_.test(qC),om=et,nb=!d(function(){var t=Error("a");return!("stack"in t)||(Object.defineProperty(t,"stack",om(1,7)),t.stack!==7)}),MN=Vo,t_=function(t,r){if(YC&&typeof t=="string"&&!_E.prepareStackTrace)for(;r--;)t=tb(t,e_,"");return t},yE=nb,rb=Error.captureStackTrace,eh={},am=eh,XC=hr("iterator"),EE=Array.prototype,n_=function(t){return t!==void 0&&(am.Array===t||EE[XC]===t)},cm=Ec,vE=fc,ib=Ut,sb=eh,ob=hr("iterator"),Zu=function(t){if(!ib(t))return vE(t,ob)||vE(t,"@@iterator")||sb[cm(t)]},wc=ve,Of=hs,ab=cn,JC=hc,ed=Zu,th=TypeError,r_=function(t,r){var s=arguments.length<2?ed(t):r;if(Of(s))return ab(wc(s,t));throw th(JC(t)+" is not iterable")},QC=ve,Yl=cn,nh=fc,i_=function(t,r,s){var o,c;Yl(t);try{if(!(o=nh(t,"return"))){if(r==="throw")throw s;return s}o=QC(o,t)}catch(u){c=!0,o=u}if(r==="throw")throw s;if(c)throw o;return Yl(o),s},ZC=De,SE=ve,eI=cn,s_=hc,Xl=n_,o_=oi,lm=N,kf=r_,cb=Zu,Nf=i_,tI=TypeError,um=function(t,r){this.stopped=t,this.result=r},Ni=um.prototype,rh=function(t,r,s){var o,c,u,h,m,_,E,S=s&&s.that,R=!(!s||!s.AS_ENTRIES),P=!(!s||!s.IS_RECORD),k=!(!s||!s.IS_ITERATOR),z=!(!s||!s.INTERRUPTED),U=ZC(r,S),F=function(Y){return o&&Nf(o,"normal",Y),new um(!0,Y)},q=function(Y){return R?(eI(Y),z?U(Y[0],Y[1],F):U(Y[0],Y[1])):z?U(Y,F):U(Y)};if(P)o=t.iterator;else if(k)o=t;else{if(!(c=cb(t)))throw tI(s_(t)+" is not iterable");if(Xl(c)){for(u=0,h=o_(t);h>u;u++)if((m=q(t[u]))&&lm(Ni,m))return m;return new um(!1)}o=kf(t,c)}for(_=P?t.next:o.next;!(E=SE(_,o)).done;){try{m=q(E.value)}catch(Y){Nf(o,"throw",Y)}if(typeof m=="object"&&m&&lm(Ni,m))return m}return new um(!1)},lb=_a,ub=Mn,bE=N,db=Xg,Jl=ql,Bi=function(t,r,s){for(var o=Ea(r),c=zC.f,u=uE.f,h=0;h<o.length;h++){var m=o[h];Af(t,m)||s&&Af(s,m)||c(t,m,u(r,m))}},ms=Bo,gs=Vo,dm=et,a_=function(t,r){$C(r)&&"cause"in r&&KC(t,"cause",r.cause)},c_=function(t,r,s,o){yE&&(rb?rb(t,r):MN(t,"stack",t_(s,o)))},UN=rh,mo=function(t,r){return t===void 0?arguments.length<2?"":r:lb(t)},hb=hr("toStringTag"),hm=Error,fb=[].push,Wo=function(t,r){var s,o=bE(ba,this);Jl?s=Jl(hm(),o?db(this):ba):(s=o?this:ms(ba),gs(s,hb,"Error")),r!==void 0&&gs(s,"message",mo(r)),c_(s,Wo,s.stack,1),arguments.length>2&&a_(s,arguments[2]);var c=[];return UN(t,fb,{that:c}),gs(s,"errors",c),s};Jl?Jl(Wo,hm):Bi(Wo,hm,{name:!0});var ba=Wo.prototype=ms(hm.prototype,{constructor:dm(1,Wo),message:dm(1,""),name:dm(1,"AggregateError")});ub({global:!0},{AggregateError:Wo});var ih,Df,fm,nI=Me,pb=j.WeakMap,rI=nI(pb)&&/native code/.test(String(pb)),mb=j,iI=Et,sI=Vo,TE=yi,wE=jd,l_=qg,oI=vc,u_="Object already initialized",pm=mb.TypeError,aI=mb.WeakMap;if(rI||wE.state){var Rc=wE.state||(wE.state=new aI);Rc.get=Rc.get,Rc.has=Rc.has,Rc.set=Rc.set,ih=function(t,r){if(Rc.has(t))throw pm(u_);return r.facade=t,Rc.set(t,r),r},Df=function(t){return Rc.get(t)||{}},fm=function(t){return Rc.has(t)}}else{var Lf=l_("state");oI[Lf]=!0,ih=function(t,r){if(TE(t,Lf))throw pm(u_);return r.facade=t,sI(t,Lf,r),r},Df=function(t){return TE(t,Lf)?t[Lf]:{}},fm=function(t){return TE(t,Lf)}}var sh,gb,_b,td={set:ih,get:Df,has:fm,enforce:function(t){return fm(t)?Df(t):ih(t,{})},getterFor:function(t){return function(r){var s;if(!iI(r)||(s=Df(r)).type!==t)throw pm("Incompatible receiver, "+t+" required");return s}}},RE=rt,cI=yi,yb=Function.prototype,VN=RE&&Object.getOwnPropertyDescriptor,Eb=cI(yb,"name"),lI={PROPER:Eb&&(function(){}).name==="something",CONFIGURABLE:Eb&&(!RE||RE&&VN(yb,"name").configurable)},FN=Vo,nd=function(t,r,s,o){return o&&o.enumerable?t[r]=s:FN(t,r,s),t},uI=d,dI=Me,CE=Et,jN=Bo,hI=Xg,BN=nd,Ja=hr("iterator"),IE=!1;[].keys&&("next"in(_b=[].keys())?(gb=hI(hI(_b)))!==Object.prototype&&(sh=gb):IE=!0);var AE=!CE(sh)||uI(function(){var t={};return sh[Ja].call(t)!==t});dI((sh=AE?{}:jN(sh))[Ja])||BN(sh,Ja,function(){return this});var vb={IteratorPrototype:sh,BUGGY_SAFARI_ITERATORS:IE},fI=Ec,pI=Ef?{}.toString:function(){return"[object "+fI(this)+"]"},Sb=Ef,mm=tt.f,bb=Vo,Tb=yi,WN=pI,wb=hr("toStringTag"),rd=function(t,r,s,o){if(t){var c=s?t:t.prototype;Tb(c,wb)||mm(c,wb,{configurable:!0,value:r}),o&&!Sb&&bb(c,"toString",WN)}},mI=vb.IteratorPrototype,gI=Bo,_I=et,zN=rd,Ta=eh,zo=function(){return this},PE=function(t,r,s,o){var c=r+" Iterator";return t.prototype=gI(mI,{next:_I(+!o,s)}),zN(t,c,!1,!0),Ta[c]=zo,t},yI=Mn,EI=ve,vI=lI,SI=PE,Rb=Xg,bI=rd,OE=nd,Cb=eh,TI=vb,Ib=vI.PROPER,gm=TI.BUGGY_SAFARI_ITERATORS,kE=hr("iterator"),NE="keys",xf="values",wI="entries",RI=function(){return this},DE=function(t,r,s,o,c,u,h){SI(s,r,o);var m,_,E,S=function(q){if(q===c&&U)return U;if(!gm&&q in k)return k[q];switch(q){case NE:case xf:case wI:return function(){return new s(this,q)}}return function(){return new s(this)}},R=r+" Iterator",P=!1,k=t.prototype,z=k[kE]||k["@@iterator"]||c&&k[c],U=!gm&&z||S(c),F=r=="Array"&&k.entries||z;if(F&&(m=Rb(F.call(new t)))!==Object.prototype&&m.next&&(bI(m,R,!0,!0),Cb[R]=RI),Ib&&c==xf&&z&&z.name!==xf&&(P=!0,U=function(){return EI(z,this)}),c)if(_={values:S(xf),keys:u?U:S(NE),entries:S(wI)},h)for(E in _)(gm||P||!(E in k))&&OE(k,E,_[E]);else yI({target:r,proto:!0,forced:gm||P},_);return h&&k[kE]!==U&&OE(k,kE,U,{}),Cb[r]=U,_},LE=function(t,r){return{value:t,done:r}},xE=Re,Ql=eh,CI=td;tt.f;var II=DE,ME=LE,Ab="Array Iterator",AI=CI.set,d_=CI.getterFor(Ab);II(Array,"Array",function(t,r){AI(this,{type:Ab,target:xE(t),index:0,kind:r})},function(){var t=d_(this),r=t.target,s=t.kind,o=t.index++;return!r||o>=r.length?(t.target=void 0,ME(void 0,!0)):ME(s=="keys"?o:s=="values"?r[o]:[o,r[o]],!1)},"values"),Ql.Arguments=Ql.Array;var go=tt,UE=function(t,r,s){return go.f(t,r,s)},GN=an,VE=UE,_o=rt,PI=hr("species"),Qt=N,_m=TypeError,h_=function(t,r){if(Qt(r,t))return t;throw _m("Incorrect invocation")},OI=Me,Pb=jd,f_=A(Function.toString);OI(Pb.inspectSource)||(Pb.inspectSource=function(t){return f_(t)});var p_=Pb.inspectSource,Ob=A,kI=d,kb=Me,NI=Ec,Nb=p_,FE=function(){},Js=[],Cc=an("Reflect","construct"),Zl=/^\s*(?:class|function)\b/,DI=Ob(Zl.exec),LI=!Zl.exec(FE),Go=function(t){if(!kb(t))return!1;try{return Cc(FE,Js,t),!0}catch{return!1}},Db=function(t){if(!kb(t))return!1;switch(NI(t)){case"AsyncFunction":case"GeneratorFunction":case"AsyncGeneratorFunction":return!1}try{return LI||!!DI(Zl,Nb(t))}catch{return!0}};Db.sham=!0;var wa,ym,Lb,jE,m_=!Cc||kI(function(){var t;return Go(Go.call)||!Go(Object)||!Go(function(){t=!0})||t})?Db:Go,xI=m_,HN=hc,BE=TypeError,WE=cn,Ic=function(t){if(xI(t))return t;throw BE(HN(t)+" is not a constructor")},wr=Ut,zs=hr("species"),Qi=function(t,r){var s,o=WE(t).constructor;return o===void 0||wr(s=WE(o)[zs])?r:Ic(s)},_s=A([].slice),Qa=TypeError,pl=function(t,r){if(t<r)throw Qa("Not enough arguments");return t},ys=/(?:ipad|iphone|ipod).*applewebkit/i.test(ir),Qs=j,Mf=ne,zE=De,GE=Me,g_=yi,Ho=d,HE=Qg,Em=_s,eu=Gl,$E=pl,xb=ys,oh=bf,vm=Qs.setImmediate,tu=Qs.clearImmediate,KE=Qs.process,Uf=Qs.Dispatch,Mb=Qs.Function,__=Qs.MessageChannel,qE=Qs.String,Zs=0,Ac={},Pc="onreadystatechange";Ho(function(){wa=Qs.location});var yo=function(t){if(g_(Ac,t)){var r=Ac[t];delete Ac[t],r()}},YE=function(t){return function(){yo(t)}},XE=function(t){yo(t.data)},JE=function(t){Qs.postMessage(qE(t),wa.protocol+"//"+wa.host)};vm&&tu||(vm=function(t){$E(arguments.length,1);var r=GE(t)?t:Mb(t),s=Em(arguments,1);return Ac[++Zs]=function(){Mf(r,void 0,s)},ym(Zs),Zs},tu=function(t){delete Ac[t]},oh?ym=function(t){KE.nextTick(YE(t))}:Uf&&Uf.now?ym=function(t){Uf.now(YE(t))}:__&&!xb?(jE=(Lb=new __).port2,Lb.port1.onmessage=XE,ym=zE(jE.postMessage,jE)):Qs.addEventListener&&GE(Qs.postMessage)&&!Qs.importScripts&&wa&&wa.protocol!=="file:"&&!Ho(JE)?(ym=JE,Qs.addEventListener("message",XE,!1)):ym=Pc in eu("script")?function(t){HE.appendChild(eu("script"))[Pc]=function(){HE.removeChild(this),yo(t)}}:function(t){setTimeout(YE(t),0)});var QE={set:vm,clear:tu},id=function(){this.head=null,this.tail=null};id.prototype={add:function(t){var r={item:t,next:null},s=this.tail;s?s.next=r:this.head=r,this.tail=r},get:function(){var t=this.head;if(t)return(this.head=t.next)===null&&(this.tail=null),t.item}};var Vf,y_,sd,E_,ah,Ub=id,MI=/ipad|iphone|ipod/i.test(ir)&&typeof Pebble<"u",Vb=/web0s(?!.*chrome)/i.test(ir),nu=j,UI=De,$N=He.f,ZE=QE.set,VI=Ub,Ff=ys,KN=MI,Sm=Vb,ev=bf,Wi=nu.MutationObserver||nu.WebKitMutationObserver,FI=nu.document,Fb=nu.process,tv=nu.Promise,jI=$N(nu,"queueMicrotask"),nv=jI&&jI.value;if(!nv){var v_=new VI,rv=function(){var t,r;for(ev&&(t=Fb.domain)&&t.exit();r=v_.get();)try{r()}catch(s){throw v_.head&&Vf(),s}t&&t.enter()};Ff||ev||Sm||!Wi||!FI?!KN&&tv&&tv.resolve?((E_=tv.resolve(void 0)).constructor=tv,ah=UI(E_.then,E_),Vf=function(){ah(rv)}):ev?Vf=function(){Fb.nextTick(rv)}:(ZE=UI(ZE,nu),Vf=function(){ZE(rv)}):(y_=!0,sd=FI.createTextNode(""),new Wi(rv).observe(sd,{characterData:!0}),Vf=function(){sd.data=y_=!y_}),nv=function(t){v_.head||Vf(),v_.add(t)}}var Za=nv,ch=function(t){try{return{error:!1,value:t()}}catch(r){return{error:!0,value:r}}},jf=j.Promise,od=typeof Deno=="object"&&Deno&&typeof Deno.version=="object",iv=!od&&!bf&&typeof window=="object"&&typeof document=="object",Bf=j,lh=jf,jb=Me,Bb=ma,qN=p_,Wb=hr,YN=iv,BI=od,sv=dr,S_=lh&&lh.prototype,ov=Wb("species"),zb=jb(Bf.PromiseRejectionEvent),Gb=Bb("Promise",function(){var t=qN(lh),r=t!==String(lh);if(!r&&sv===66||!S_.catch||!S_.finally)return!0;if(!sv||sv<51||!/native code/.test(t)){var s=new lh(function(c){c(1)}),o=function(c){c(function(){},function(){})};if((s.constructor={})[ov]=o,!(s.then(function(){})instanceof o))return!0}return!r&&(YN||BI)&&!zb}),b_={CONSTRUCTOR:Gb,REJECTION_EVENT:zb},ml={},av=hs,cv=TypeError,Hb=function(t){var r,s;this.promise=new t(function(o,c){if(r!==void 0||s!==void 0)throw cv("Bad Promise constructor");r=o,s=c}),this.resolve=av(r),this.reject=av(s)};ml.f=function(t){return new Hb(t)};var bm,$b,XN=Mn,Wf=bf,uh=j,ad=ve,JN=nd,lv=rd,f=function(t){var r=GN(t);_o&&r&&!r[PI]&&VE(r,PI,{configurable:!0,get:function(){return this}})},g=hs,T=Me,O=Et,M=h_,H=Qi,ae=QE.set,Ie=Za,xe=function(t,r){try{arguments.length==1?console.error(t):console.error(t,r)}catch{}},it=ch,At=Ub,Pt=td,Ct=jf,Ht=b_,en=ml,tn="Promise",Zi=Ht.CONSTRUCTOR,Je=Ht.REJECTION_EVENT,Ve=Pt.getterFor(tn),Ze=Pt.set,Dt=Ct&&Ct.prototype,nn=Ct,pn=Dt,En=uh.TypeError,On=uh.document,Es=uh.process,vr=en.f,dh=vr,QN=!!(On&&On.createEvent&&uh.dispatchEvent),K4="unhandledrejection",q4=function(t){var r;return!(!O(t)||!T(r=t.then))&&r},Y4=function(t,r){var s,o,c,u=r.value,h=r.state==1,m=h?t.ok:t.fail,_=t.resolve,E=t.reject,S=t.domain;try{m?(h||(r.rejection===2&&Roe(r),r.rejection=1),m===!0?s=u:(S&&S.enter(),s=m(u),S&&(S.exit(),c=!0)),s===t.promise?E(En("Promise-chain cycle")):(o=q4(s))?ad(o,s,_,E):_(s)):E(u)}catch(R){S&&!c&&S.exit(),E(R)}},X4=function(t,r){t.notified||(t.notified=!0,Ie(function(){for(var s,o=t.reactions;s=o.get();)Y4(s,t);t.notified=!1,r&&!t.rejection&&woe(t)}))},J4=function(t,r,s){var o,c;QN?((o=On.createEvent("Event")).promise=r,o.reason=s,o.initEvent(t,!1,!0),uh.dispatchEvent(o)):o={promise:r,reason:s},!Je&&(c=uh["on"+t])?c(o):t===K4&&xe("Unhandled promise rejection",s)},woe=function(t){ad(ae,uh,function(){var r,s=t.facade,o=t.value;if(Q4(t)&&(r=it(function(){Wf?Es.emit("unhandledRejection",o,s):J4(K4,s,o)}),t.rejection=Wf||Q4(t)?2:1,r.error))throw r.value})},Q4=function(t){return t.rejection!==1&&!t.parent},Roe=function(t){ad(ae,uh,function(){var r=t.facade;Wf?Es.emit("rejectionHandled",r):J4("rejectionhandled",r,t.value)})},uv=function(t,r,s){return function(o){t(r,o,s)}},dv=function(t,r,s){t.done||(t.done=!0,s&&(t=s),t.value=r,t.state=2,X4(t,!0))},ZN=function(t,r,s){if(!t.done){t.done=!0,s&&(t=s);try{if(t.facade===r)throw En("Promise can't be resolved itself");var o=q4(r);o?Ie(function(){var c={done:!1};try{ad(o,r,uv(ZN,c,t),uv(dv,c,t))}catch(u){dv(c,u,t)}}):(t.value=r,t.state=1,X4(t,!1))}catch(c){dv({done:!1},c,t)}}};Zi&&(pn=(nn=function(t){M(this,pn),g(t),ad(bm,this);var r=Ve(this);try{t(uv(ZN,r),uv(dv,r))}catch(s){dv(r,s)}}).prototype,(bm=function(t){Ze(this,{type:tn,done:!1,notified:!1,parent:!1,reactions:new At,rejection:!1,state:0,value:void 0})}).prototype=JN(pn,"then",function(t,r){var s=Ve(this),o=vr(H(this,nn));return s.parent=!0,o.ok=!T(t)||t,o.fail=T(r)&&r,o.domain=Wf?Es.domain:void 0,s.state==0?s.reactions.add(o):Ie(function(){Y4(o,s)}),o.promise}),$b=function(){var t=new bm,r=Ve(t);this.promise=t,this.resolve=uv(ZN,r),this.reject=uv(dv,r)},en.f=vr=function(t){return t===nn||t===void 0?new $b(t):dh(t)}),XN({global:!0,wrap:!0,forced:Zi},{Promise:nn}),lv(nn,tn,!1,!0),f(tn);var Z4=hr("iterator"),e3=!1;try{var Coe=0,t3={next:function(){return{done:!!Coe++}},return:function(){e3=!0}};t3[Z4]=function(){return this},Array.from(t3,function(){throw 2})}catch{}var Ioe=jf,Aoe=function(t,r){if(!e3)return!1;var s=!1;try{var o={};o[Z4]=function(){return{next:function(){return{done:s=!0}}}},t(o)}catch{}return s},WI=b_.CONSTRUCTOR||!Aoe(function(t){Ioe.all(t).then(void 0,function(){})}),Poe=ve,Ooe=hs,koe=ml,Noe=ch,Doe=rh;Mn({target:"Promise",stat:!0,forced:WI},{all:function(t){var r=this,s=koe.f(r),o=s.resolve,c=s.reject,u=Noe(function(){var h=Ooe(r.resolve),m=[],_=0,E=1;Doe(t,function(S){var R=_++,P=!1;E++,Poe(h,r,S).then(function(k){P||(P=!0,m[R]=k,--E||o(m))},c)}),--E||o(m)});return u.error&&c(u.value),s.promise}});var Loe=Mn,xoe=b_.CONSTRUCTOR;jf&&jf.prototype,Loe({target:"Promise",proto:!0,forced:xoe,real:!0},{catch:function(t){return this.then(void 0,t)}});var Moe=ve,Uoe=hs,Voe=ml,Foe=ch,joe=rh;Mn({target:"Promise",stat:!0,forced:WI},{race:function(t){var r=this,s=Voe.f(r),o=s.reject,c=Foe(function(){var u=Uoe(r.resolve);joe(t,function(h){Moe(u,r,h).then(s.resolve,o)})});return c.error&&o(c.value),s.promise}});var Boe=ve,Woe=ml;Mn({target:"Promise",stat:!0,forced:b_.CONSTRUCTOR},{reject:function(t){var r=Woe.f(this);return Boe(r.reject,void 0,t),r.promise}});var zoe=cn,Goe=Et,Hoe=ml,n3=function(t,r){if(zoe(t),Goe(r)&&r.constructor===t)return r;var s=Hoe.f(t);return(0,s.resolve)(r),s.promise},$oe=Mn,Koe=jf,qoe=b_.CONSTRUCTOR,Yoe=n3,Xoe=an("Promise"),Joe=!qoe;$oe({target:"Promise",stat:!0,forced:!0},{resolve:function(t){return Yoe(Joe&&this===Xoe?Koe:this,t)}});var Qoe=ve,Zoe=hs,eae=ml,tae=ch,nae=rh;Mn({target:"Promise",stat:!0,forced:WI},{allSettled:function(t){var r=this,s=eae.f(r),o=s.resolve,c=s.reject,u=tae(function(){var h=Zoe(r.resolve),m=[],_=0,E=1;nae(t,function(S){var R=_++,P=!1;E++,Qoe(h,r,S).then(function(k){P||(P=!0,m[R]={status:"fulfilled",value:k},--E||o(m))},function(k){P||(P=!0,m[R]={status:"rejected",reason:k},--E||o(m))})}),--E||o(m)});return u.error&&c(u.value),s.promise}});var rae=ve,iae=hs,sae=an,oae=ml,aae=ch,cae=rh,r3="No one promise resolved";Mn({target:"Promise",stat:!0,forced:WI},{any:function(t){var r=this,s=sae("AggregateError"),o=oae.f(r),c=o.resolve,u=o.reject,h=aae(function(){var m=iae(r.resolve),_=[],E=0,S=1,R=!1;cae(t,function(P){var k=E++,z=!1;S++,rae(m,r,P).then(function(U){z||R||(R=!0,c(U))},function(U){z||R||(z=!0,_[k]=U,--S||u(new s(_,r3)))})}),--S||u(new s(_,r3))});return h.error&&u(h.value),o.promise}});var lae=Mn,eD=jf,uae=d,dae=an,hae=Me,fae=Qi,i3=n3,pae=eD&&eD.prototype;lae({target:"Promise",proto:!0,real:!0,forced:!!eD&&uae(function(){pae.finally.call({then:function(){}},function(){})})},{finally:function(t){var r=fae(this,dae("Promise")),s=hae(t);return this.then(s?function(o){return i3(r,t()).then(function(){return o})}:t,s?function(o){return i3(r,t()).then(function(){throw o})}:t)}});var tD=A,mae=yc,gae=_a,_ae=Xt,yae=tD("".charAt),s3=tD("".charCodeAt),Eae=tD("".slice),o3=function(t){return function(r,s){var o,c,u=gae(_ae(r)),h=mae(s),m=u.length;return h<0||h>=m?t?"":void 0:(o=s3(u,h))<55296||o>56319||h+1===m||(c=s3(u,h+1))<56320||c>57343?t?yae(u,h):o:t?Eae(u,h,h+2):c-56320+(o-55296<<10)+65536}},nD={codeAt:o3(!1),charAt:o3(!0)},vae=nD.charAt,Sae=_a,a3=td,bae=DE,c3=LE,l3="String Iterator",Tae=a3.set,wae=a3.getterFor(l3);bae(String,"String",function(t){Tae(this,{type:l3,string:Sae(t),index:0})},function(){var t,r=wae(this),s=r.string,o=r.index;return o>=s.length?c3(void 0,!0):(t=vae(s,o),r.index+=t.length,c3(t,!1))});var Rae=bt.Promise,Cae={CSSRuleList:0,CSSStyleDeclaration:0,CSSValueList:0,ClientRectList:0,DOMRectList:0,DOMStringList:0,DOMTokenList:1,DataTransferItemList:0,FileList:0,HTMLAllCollection:0,HTMLCollection:0,HTMLFormElement:0,HTMLSelectElement:0,MediaList:0,MimeTypeArray:0,NamedNodeMap:0,NodeList:1,PaintRequestList:0,Plugin:0,PluginArray:0,SVGLengthList:0,SVGNumberList:0,SVGPathSegList:0,SVGPointList:0,SVGStringList:0,SVGTransformList:0,SourceBufferList:0,StyleSheetList:0,TextTrackCueList:0,TextTrackList:0,TouchList:0},Iae=j,Aae=Ec,Pae=Vo,u3=eh,d3=hr("toStringTag");for(var rD in Cae){var h3=Iae[rD],iD=h3&&h3.prototype;iD&&Aae(iD)!==d3&&Pae(iD,d3,rD),u3[rD]=u3.Array}var f3=Rae,lt=l(f3),Oae=qa("Array").values,kae=Ec,Nae=yi,Dae=N,Lae=Oae,sD=Array.prototype,xae={DOMTokenList:!0,NodeList:!0},Mae=function(t){var r=t.values;return t===sD||Dae(sD,t)&&r===sD.values||Nae(xae,kae(t))?Lae:r},Oc=l(Mae),Uae=d,Vae=hr("iterator"),oD=!Uae(function(){var t=new URL("b?a=1&b=2&c=3","http://a"),r=t.searchParams,s=new URLSearchParams("a=1&a=2"),o="";return t.pathname="c%20d",r.forEach(function(c,u){r.delete("b"),o+=u+c}),s.delete("a",2),!t.toJSON||!s.has("a",1)||s.has("a",2)||!r.size&&!0||!r.sort||t.href!=="http://a/c%20d?a=1&c=3"||r.get("c")!=="3"||String(new URLSearchParams("?a=1"))!=="a=1"||!r[Vae]||new URL("https://a@b").username!=="a"||new URLSearchParams(new URLSearchParams("a=b")).get("a")!=="b"||new URL("http://").host!=="xn--e1aybc"||new URL("http://a#").hash!=="#%D0%B1"||o!=="a1c3"||new URL("http://x",void 0).host!=="x"}),Fae=nd,jae=$a,Bae=tt,Wae=et,zI=function(t,r,s){var o=jae(r);o in t?Bae.f(t,o,Wae(0,s)):t[o]=s},p3=pe,zae=oi,Gae=zI,Hae=Array,$ae=Math.max,aD=function(t,r,s){for(var o=zae(t),c=p3(r,o),u=p3(s===void 0?o:s,o),h=Hae($ae(u-c,0)),m=0;c<u;c++,m++)Gae(h,m,t[c]);return h.length=m,h},m3=aD,Kae=Math.floor,cD=function(t,r){var s=t.length,o=Kae(s/2);return s<8?qae(t,r):Yae(t,cD(m3(t,0,o),r),cD(m3(t,o),r),r)},qae=function(t,r){for(var s,o,c=t.length,u=1;u<c;){for(o=u,s=t[u];o&&r(t[o-1],s)>0;)t[o]=t[--o];o!==u++&&(t[o]=s)}return t},Yae=function(t,r,s,o){for(var c=r.length,u=s.length,h=0,m=0;h<c||m<u;)t[h+m]=h<c&&m<u?o(r[h],s[m])<=0?r[h++]:s[m++]:h<c?r[h++]:s[m++];return t},g3=cD,lD=Mn,hv=j,GI=ve,hh=A,fv=rt,_3=oD,y3=nd,Xae=UE,Jae=function(t,r,s){for(var o in r)s&&s.unsafe&&t[o]?t[o]=r[o]:Fae(t,o,r[o],s);return t},Qae=rd,Zae=PE,uD=td,E3=h_,dD=Me,ece=yi,tce=De,nce=Ec,rce=cn,v3=Et,ec=_a,ice=Bo,S3=et,hD=r_,sce=Zu,pv=pl,oce=g3,ace=hr("iterator"),Kb="URLSearchParams",b3=Kb+"Iterator",T3=uD.set,ru=uD.getterFor(Kb),cce=uD.getterFor(b3),lce=Object.getOwnPropertyDescriptor,fD=function(t){if(!fv)return hv[t];var r=lce(hv,t);return r&&r.value},w3=fD("fetch"),HI=fD("Request"),qb=fD("Headers"),pD=HI&&HI.prototype,R3=qb&&qb.prototype,uce=hv.RegExp,dce=hv.TypeError,C3=hv.decodeURIComponent,hce=hv.encodeURIComponent,fce=hh("".charAt),I3=hh([].join),T_=hh([].push),mD=hh("".replace),pce=hh([].shift),A3=hh([].splice),P3=hh("".split),mce=hh("".slice),gce=/\+/g,O3=Array(4),_ce=function(t){return O3[t-1]||(O3[t-1]=uce("((?:%[\\da-f]{2}){"+t+"})","gi"))},yce=function(t){try{return C3(t)}catch{return t}},k3=function(t){var r=mD(t,gce," "),s=4;try{return C3(r)}catch{for(;s;)r=mD(r,_ce(s--),yce);return r}},Ece=/[!'()~]|%20/g,vce={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+"},Sce=function(t){return vce[t]},N3=function(t){return mD(hce(t),Ece,Sce)},gD=Zae(function(t,r){T3(this,{type:b3,iterator:hD(ru(t).entries),kind:r})},"Iterator",function(){var t=cce(this),r=t.kind,s=t.iterator.next(),o=s.value;return s.done||(s.value=r==="keys"?o.key:r==="values"?o.value:[o.key,o.value]),s},!0),D3=function(t){this.entries=[],this.url=null,t!==void 0&&(v3(t)?this.parseObject(t):this.parseQuery(typeof t=="string"?fce(t,0)==="?"?mce(t,1):t:ec(t)))};D3.prototype={type:Kb,bindURL:function(t){this.url=t,this.update()},parseObject:function(t){var r,s,o,c,u,h,m,_=sce(t);if(_)for(s=(r=hD(t,_)).next;!(o=GI(s,r)).done;){if(u=(c=hD(rce(o.value))).next,(h=GI(u,c)).done||(m=GI(u,c)).done||!GI(u,c).done)throw dce("Expected sequence with length 2");T_(this.entries,{key:ec(h.value),value:ec(m.value)})}else for(var E in t)ece(t,E)&&T_(this.entries,{key:E,value:ec(t[E])})},parseQuery:function(t){if(t)for(var r,s,o=P3(t,"&"),c=0;c<o.length;)(r=o[c++]).length&&(s=P3(r,"="),T_(this.entries,{key:k3(pce(s)),value:k3(I3(s,"="))}))},serialize:function(){for(var t,r=this.entries,s=[],o=0;o<r.length;)t=r[o++],T_(s,N3(t.key)+"="+N3(t.value));return I3(s,"&")},update:function(){this.entries.length=0,this.parseQuery(this.url.query)},updateURL:function(){this.url&&this.url.update()}};var $I=function(){E3(this,mv);var t=T3(this,new D3(arguments.length>0?arguments[0]:void 0));fv||(this.size=t.entries.length)},mv=$I.prototype;if(Jae(mv,{append:function(t,r){var s=ru(this);pv(arguments.length,2),T_(s.entries,{key:ec(t),value:ec(r)}),fv||this.length++,s.updateURL()},delete:function(t){for(var r=ru(this),s=pv(arguments.length,1),o=r.entries,c=ec(t),u=s<2?void 0:arguments[1],h=u===void 0?u:ec(u),m=0;m<o.length;){var _=o[m];if(_.key!==c||h!==void 0&&_.value!==h)m++;else if(A3(o,m,1),h!==void 0)break}fv||(this.size=o.length),r.updateURL()},get:function(t){var r=ru(this).entries;pv(arguments.length,1);for(var s=ec(t),o=0;o<r.length;o++)if(r[o].key===s)return r[o].value;return null},getAll:function(t){var r=ru(this).entries;pv(arguments.length,1);for(var s=ec(t),o=[],c=0;c<r.length;c++)r[c].key===s&&T_(o,r[c].value);return o},has:function(t){for(var r=ru(this).entries,s=pv(arguments.length,1),o=ec(t),c=s<2?void 0:arguments[1],u=c===void 0?c:ec(c),h=0;h<r.length;){var m=r[h++];if(m.key===o&&(u===void 0||m.value===u))return!0}return!1},set:function(t,r){var s=ru(this);pv(arguments.length,1);for(var o,c=s.entries,u=!1,h=ec(t),m=ec(r),_=0;_<c.length;_++)(o=c[_]).key===h&&(u?A3(c,_--,1):(u=!0,o.value=m));u||T_(c,{key:h,value:m}),fv||(this.size=c.length),s.updateURL()},sort:function(){var t=ru(this);oce(t.entries,function(r,s){return r.key>s.key?1:-1}),t.updateURL()},forEach:function(t){for(var r,s=ru(this).entries,o=tce(t,arguments.length>1?arguments[1]:void 0),c=0;c<s.length;)o((r=s[c++]).value,r.key,this)},keys:function(){return new gD(this,"keys")},values:function(){return new gD(this,"values")},entries:function(){return new gD(this,"entries")}},{enumerable:!0}),y3(mv,ace,mv.entries,{}),y3(mv,"toString",function(){return ru(this).serialize()},{enumerable:!0}),fv&&Xae(mv,"size",{get:function(){return ru(this).entries.length},configurable:!0,enumerable:!0}),Qae($I,Kb),lD({global:!0,forced:!_3},{URLSearchParams:$I}),!_3&&dD(qb)){var bce=hh(R3.has),Tce=hh(R3.set),L3=function(t){if(v3(t)){var r,s=t.body;if(nce(s)===Kb)return r=t.headers?new qb(t.headers):new qb,bce(r,"content-type")||Tce(r,"content-type","application/x-www-form-urlencoded;charset=UTF-8"),ice(t,{body:S3(0,ec(s)),headers:S3(0,r)})}return t};if(dD(w3)&&lD({global:!0,dontCallGetSet:!0,forced:!0},{fetch:function(t){return w3(t,arguments.length>1?L3(arguments[1]):{})}}),dD(HI)){var _D=function(t){return E3(this,pD),new HI(t,arguments.length>1?L3(arguments[1]):{})};pD.constructor=_D,_D.prototype=pD,lD({global:!0,dontCallGetSet:!0,forced:!0},{Request:_D})}}var iu,wce={URLSearchParams:$I,getState:ru},Rce=bt.URLSearchParams,x3=rt,Cce=A,Ice=ve,Ace=d,yD=bc,Pce=Sc,Oce=Ne,kce=Po,Nce=hn,gv=Object.assign,M3=Object.defineProperty,Dce=Cce([].concat),Lce=!gv||Ace(function(){if(x3&&gv({b:1},gv(M3({},"a",{enumerable:!0,get:function(){M3(this,"b",{value:3,enumerable:!1})}}),{b:2})).b!==1)return!0;var t={},r={},s=Symbol(),o="abcdefghijklmnopqrst";return t[s]=7,o.split("").forEach(function(c){r[c]=c}),gv({},t)[s]!=7||yD(gv({},r)).join("")!=o})?function(t,r){for(var s=kce(t),o=arguments.length,c=1,u=Pce.f,h=Oce.f;o>c;)for(var m,_=Nce(arguments[c++]),E=u?Dce(yD(_),u(_)):yD(_),S=E.length,R=0;S>R;)m=E[R++],x3&&!Ice(h,_,m)||(s[m]=_[m]);return s}:gv,xce=cn,Mce=i_,Uce=De,Vce=ve,Fce=Po,jce=function(t,r,s,o){try{return o?r(xce(s)[0],s[1]):r(s)}catch(c){Mce(t,"throw",c)}},Bce=n_,Wce=m_,zce=oi,U3=zI,Gce=r_,Hce=Zu,V3=Array,w_=A,ED=2147483647,$ce=/[^\0-\u007E]/,F3=/[.\u3002\uFF0E\uFF61]/g,j3="Overflow: input needs wider integers to process",B3=RangeError,Kce=w_(F3.exec),_v=Math.floor,vD=String.fromCharCode,W3=w_("".charCodeAt),z3=w_([].join),Tm=w_([].push),qce=w_("".replace),Yce=w_("".split),Xce=w_("".toLowerCase),G3=function(t){return t+22+75*(t<26)},Jce=function(t,r,s){var o=0;for(t=s?_v(t/700):t>>1,t+=_v(t/r);t>455;)t=_v(t/35),o+=36;return _v(o+36*t/(t+38))},Qce=function(t){var r=[];t=function(q){for(var Y=[],le=0,ye=q.length;le<ye;){var Ee=W3(q,le++);if(Ee>=55296&&Ee<=56319&&le<ye){var me=W3(q,le++);(64512&me)==56320?Tm(Y,((1023&Ee)<<10)+(1023&me)+65536):(Tm(Y,Ee),le--)}else Tm(Y,Ee)}return Y}(t);var s,o,c=t.length,u=128,h=0,m=72;for(s=0;s<t.length;s++)(o=t[s])<128&&Tm(r,vD(o));var _=r.length,E=_;for(_&&Tm(r,"-");E<c;){var S=ED;for(s=0;s<t.length;s++)(o=t[s])>=u&&o<S&&(S=o);var R=E+1;if(S-u>_v((ED-h)/R))throw B3(j3);for(h+=(S-u)*R,u=S,s=0;s<t.length;s++){if((o=t[s])<u&&++h>ED)throw B3(j3);if(o==u){for(var P=h,k=36;;){var z=k<=m?1:k>=m+26?26:k-m;if(P<z)break;var U=P-z,F=36-z;Tm(r,vD(G3(z+U%F))),P=_v(U/F),k+=36}Tm(r,vD(G3(P))),m=Jce(h,R,E==_),h=0,E++}}h++,u++}return z3(r,"")},Zce=Mn,SD=rt,ele=oD,bD=j,H3=De,su=A,KI=nd,ou=UE,tle=h_,TD=yi,wD=Lce,yv=function(t){var r=Fce(t),s=Wce(this),o=arguments.length,c=o>1?arguments[1]:void 0,u=c!==void 0;u&&(c=Uce(c,o>2?arguments[2]:void 0));var h,m,_,E,S,R,P=Hce(r),k=0;if(!P||this===V3&&Bce(P))for(h=zce(r),m=s?new this(h):V3(h);h>k;k++)R=u?c(r[k],k):r[k],U3(m,k,R);else for(S=(E=Gce(r,P)).next,m=s?new this:[];!(_=Vce(S,E)).done;k++)R=u?jce(E,c,[_.value,k],!0):_.value,U3(m,k,R);return m.length=k,m},cd=aD,nle=nD.codeAt,rle=function(t){var r,s,o=[],c=Yce(qce(Xce(t),F3,"."),".");for(r=0;r<c.length;r++)s=c[r],Tm(o,Kce($ce,s)?"xn--"+Qce(s):s);return z3(o,".")},zf=_a,ile=rd,sle=pl,$3=wce,K3=td,ole=K3.set,qI=K3.getterFor("URL"),ale=$3.URLSearchParams,cle=$3.getState,Yb=bD.URL,RD=bD.TypeError,YI=bD.parseInt,lle=Math.floor,q3=Math.pow,au=su("".charAt),ld=su(/./.exec),Xb=su([].join),ule=su(1 .toString),dle=su([].pop),Ev=su([].push),CD=su("".replace),hle=su([].shift),fle=su("".split),Jb=su("".slice),XI=su("".toLowerCase),ple=su([].unshift),ID="Invalid scheme",R_="Invalid host",Y3="Invalid port",X3=/[a-z]/i,mle=/[\d+-.a-z]/i,AD=/\d/,gle=/^0x/i,_le=/^[0-7]+$/,yle=/^\d+$/,J3=/^[\da-f]+$/i,Ele=/[\0\t\n\r #%/:<>?@[\\\]^|]/,vle=/[\0\t\n\r #/:<>?@[\\\]^|]/,Sle=/^[\u0000-\u0020]+/,ble=/(^|[^\u0000-\u0020])[\u0000-\u0020]+$/,Tle=/[\t\n\r]/g,Qb=function(t){var r,s,o,c;if(typeof t=="number"){for(r=[],s=0;s<4;s++)ple(r,t%256),t=lle(t/256);return Xb(r,".")}if(typeof t=="object"){for(r="",o=function(u){for(var h=null,m=1,_=null,E=0,S=0;S<8;S++)u[S]!==0?(E>m&&(h=_,m=E),_=null,E=0):(_===null&&(_=S),++E);return E>m&&(h=_,m=E),h}(t),s=0;s<8;s++)c&&t[s]===0||(c&&(c=!1),o===s?(r+=s?":":"::",c=!0):(r+=ule(t[s],16),s<7&&(r+=":")));return"["+r+"]"}return t},JI={},Q3=wD({},JI,{" ":1,'"':1,"<":1,">":1,"`":1}),Z3=wD({},Q3,{"#":1,"?":1,"{":1,"}":1}),PD=wD({},Z3,{"/":1,":":1,";":1,"=":1,"@":1,"[":1,"\\":1,"]":1,"^":1,"|":1}),wm=function(t,r){var s=nle(t,0);return s>32&&s<127&&!TD(r,t)?t:encodeURIComponent(t)},QI={ftp:21,file:null,http:80,https:443,ws:80,wss:443},Zb=function(t,r){var s;return t.length==2&&ld(X3,au(t,0))&&((s=au(t,1))==":"||!r&&s=="|")},e5=function(t){var r;return t.length>1&&Zb(Jb(t,0,2))&&(t.length==2||(r=au(t,2))==="/"||r==="\\"||r==="?"||r==="#")},wle=function(t){return t==="."||XI(t)==="%2e"},OD={},t5={},kD={},n5={},r5={},ND={},i5={},s5={},ZI={},eA={},DD={},LD={},xD={},MD={},o5={},UD={},vv={},fh={},a5={},C_={},Gf={},VD=function(t,r,s){var o,c,u,h=zf(t);if(r){if(c=this.parse(h))throw RD(c);this.searchParams=null}else{if(s!==void 0&&(o=new VD(s,!0)),c=this.parse(h,null,o))throw RD(c);(u=cle(new ale)).bindURL(this),this.searchParams=u}};VD.prototype={type:"URL",parse:function(t,r,s){var o,c,u,h,m,_=this,E=r||OD,S=0,R="",P=!1,k=!1,z=!1;for(t=zf(t),r||(_.scheme="",_.username="",_.password="",_.host=null,_.port=null,_.path=[],_.query=null,_.fragment=null,_.cannotBeABaseURL=!1,t=CD(t,Sle,""),t=CD(t,ble,"$1")),t=CD(t,Tle,""),o=yv(t);S<=o.length;){switch(c=o[S],E){case OD:if(!c||!ld(X3,c)){if(r)return ID;E=kD;continue}R+=XI(c),E=t5;break;case t5:if(c&&(ld(mle,c)||c=="+"||c=="-"||c=="."))R+=XI(c);else{if(c!=":"){if(r)return ID;R="",E=kD,S=0;continue}if(r&&(_.isSpecial()!=TD(QI,R)||R=="file"&&(_.includesCredentials()||_.port!==null)||_.scheme=="file"&&!_.host))return;if(_.scheme=R,r)return void(_.isSpecial()&&QI[_.scheme]==_.port&&(_.port=null));R="",_.scheme=="file"?E=MD:_.isSpecial()&&s&&s.scheme==_.scheme?E=n5:_.isSpecial()?E=s5:o[S+1]=="/"?(E=r5,S++):(_.cannotBeABaseURL=!0,Ev(_.path,""),E=a5)}break;case kD:if(!s||s.cannotBeABaseURL&&c!="#")return ID;if(s.cannotBeABaseURL&&c=="#"){_.scheme=s.scheme,_.path=cd(s.path),_.query=s.query,_.fragment="",_.cannotBeABaseURL=!0,E=Gf;break}E=s.scheme=="file"?MD:ND;continue;case n5:if(c!="/"||o[S+1]!="/"){E=ND;continue}E=ZI,S++;break;case r5:if(c=="/"){E=eA;break}E=fh;continue;case ND:if(_.scheme=s.scheme,c==iu)_.username=s.username,_.password=s.password,_.host=s.host,_.port=s.port,_.path=cd(s.path),_.query=s.query;else if(c=="/"||c=="\\"&&_.isSpecial())E=i5;else if(c=="?")_.username=s.username,_.password=s.password,_.host=s.host,_.port=s.port,_.path=cd(s.path),_.query="",E=C_;else{if(c!="#"){_.username=s.username,_.password=s.password,_.host=s.host,_.port=s.port,_.path=cd(s.path),_.path.length--,E=fh;continue}_.username=s.username,_.password=s.password,_.host=s.host,_.port=s.port,_.path=cd(s.path),_.query=s.query,_.fragment="",E=Gf}break;case i5:if(!_.isSpecial()||c!="/"&&c!="\\"){if(c!="/"){_.username=s.username,_.password=s.password,_.host=s.host,_.port=s.port,E=fh;continue}E=eA}else E=ZI;break;case s5:if(E=ZI,c!="/"||au(R,S+1)!="/")continue;S++;break;case ZI:if(c!="/"&&c!="\\"){E=eA;continue}break;case eA:if(c=="@"){P&&(R="%40"+R),P=!0,u=yv(R);for(var U=0;U<u.length;U++){var F=u[U];if(F!=":"||z){var q=wm(F,PD);z?_.password+=q:_.username+=q}else z=!0}R=""}else if(c==iu||c=="/"||c=="?"||c=="#"||c=="\\"&&_.isSpecial()){if(P&&R=="")return"Invalid authority";S-=yv(R).length+1,R="",E=DD}else R+=c;break;case DD:case LD:if(r&&_.scheme=="file"){E=UD;continue}if(c!=":"||k){if(c==iu||c=="/"||c=="?"||c=="#"||c=="\\"&&_.isSpecial()){if(_.isSpecial()&&R=="")return R_;if(r&&R==""&&(_.includesCredentials()||_.port!==null))return;if(h=_.parseHost(R))return h;if(R="",E=vv,r)return;continue}c=="["?k=!0:c=="]"&&(k=!1),R+=c}else{if(R=="")return R_;if(h=_.parseHost(R))return h;if(R="",E=xD,r==LD)return}break;case xD:if(!ld(AD,c)){if(c==iu||c=="/"||c=="?"||c=="#"||c=="\\"&&_.isSpecial()||r){if(R!=""){var Y=YI(R,10);if(Y>65535)return Y3;_.port=_.isSpecial()&&Y===QI[_.scheme]?null:Y,R=""}if(r)return;E=vv;continue}return Y3}R+=c;break;case MD:if(_.scheme="file",c=="/"||c=="\\")E=o5;else{if(!s||s.scheme!="file"){E=fh;continue}if(c==iu)_.host=s.host,_.path=cd(s.path),_.query=s.query;else if(c=="?")_.host=s.host,_.path=cd(s.path),_.query="",E=C_;else{if(c!="#"){e5(Xb(cd(o,S),""))||(_.host=s.host,_.path=cd(s.path),_.shortenPath()),E=fh;continue}_.host=s.host,_.path=cd(s.path),_.query=s.query,_.fragment="",E=Gf}}break;case o5:if(c=="/"||c=="\\"){E=UD;break}s&&s.scheme=="file"&&!e5(Xb(cd(o,S),""))&&(Zb(s.path[0],!0)?Ev(_.path,s.path[0]):_.host=s.host),E=fh;continue;case UD:if(c==iu||c=="/"||c=="\\"||c=="?"||c=="#"){if(!r&&Zb(R))E=fh;else if(R==""){if(_.host="",r)return;E=vv}else{if(h=_.parseHost(R))return h;if(_.host=="localhost"&&(_.host=""),r)return;R="",E=vv}continue}R+=c;break;case vv:if(_.isSpecial()){if(E=fh,c!="/"&&c!="\\")continue}else if(r||c!="?")if(r||c!="#"){if(c!=iu&&(E=fh,c!="/"))continue}else _.fragment="",E=Gf;else _.query="",E=C_;break;case fh:if(c==iu||c=="/"||c=="\\"&&_.isSpecial()||!r&&(c=="?"||c=="#")){if((m=XI(m=R))===".."||m==="%2e."||m===".%2e"||m==="%2e%2e"?(_.shortenPath(),c=="/"||c=="\\"&&_.isSpecial()||Ev(_.path,"")):wle(R)?c=="/"||c=="\\"&&_.isSpecial()||Ev(_.path,""):(_.scheme=="file"&&!_.path.length&&Zb(R)&&(_.host&&(_.host=""),R=au(R,0)+":"),Ev(_.path,R)),R="",_.scheme=="file"&&(c==iu||c=="?"||c=="#"))for(;_.path.length>1&&_.path[0]==="";)hle(_.path);c=="?"?(_.query="",E=C_):c=="#"&&(_.fragment="",E=Gf)}else R+=wm(c,Z3);break;case a5:c=="?"?(_.query="",E=C_):c=="#"?(_.fragment="",E=Gf):c!=iu&&(_.path[0]+=wm(c,JI));break;case C_:r||c!="#"?c!=iu&&(c=="'"&&_.isSpecial()?_.query+="%27":_.query+=c=="#"?"%23":wm(c,JI)):(_.fragment="",E=Gf);break;case Gf:c!=iu&&(_.fragment+=wm(c,Q3))}S++}},parseHost:function(t){var r,s,o;if(au(t,0)=="["){if(au(t,t.length-1)!="]"||(r=function(c){var u,h,m,_,E,S,R,P=[0,0,0,0,0,0,0,0],k=0,z=null,U=0,F=function(){return au(c,U)};if(F()==":"){if(au(c,1)!=":")return;U+=2,z=++k}for(;F();){if(k==8)return;if(F()!=":"){for(u=h=0;h<4&&ld(J3,F());)u=16*u+YI(F(),16),U++,h++;if(F()=="."){if(h==0||(U-=h,k>6))return;for(m=0;F();){if(_=null,m>0){if(!(F()=="."&&m<4))return;U++}if(!ld(AD,F()))return;for(;ld(AD,F());){if(E=YI(F(),10),_===null)_=E;else{if(_==0)return;_=10*_+E}if(_>255)return;U++}P[k]=256*P[k]+_,++m!=2&&m!=4||k++}if(m!=4)return;break}if(F()==":"){if(U++,!F())return}else if(F())return;P[k++]=u}else{if(z!==null)return;U++,z=++k}}if(z!==null)for(S=k-z,k=7;k!=0&&S>0;)R=P[k],P[k--]=P[z+S-1],P[z+--S]=R;else if(k!=8)return;return P}(Jb(t,1,-1)),!r))return R_;this.host=r}else if(this.isSpecial()){if(t=rle(t),ld(Ele,t)||(r=function(c){var u,h,m,_,E,S,R,P=fle(c,".");if(P.length&&P[P.length-1]==""&&P.length--,(u=P.length)>4)return c;for(h=[],m=0;m<u;m++){if((_=P[m])=="")return c;if(E=10,_.length>1&&au(_,0)=="0"&&(E=ld(gle,_)?16:8,_=Jb(_,E==8?1:2)),_==="")S=0;else{if(!ld(E==10?yle:E==8?_le:J3,_))return c;S=YI(_,E)}Ev(h,S)}for(m=0;m<u;m++)if(S=h[m],m==u-1){if(S>=q3(256,5-u))return null}else if(S>255)return null;for(R=dle(h),m=0;m<h.length;m++)R+=h[m]*q3(256,3-m);return R}(t),r===null))return R_;this.host=r}else{if(ld(vle,t))return R_;for(r="",s=yv(t),o=0;o<s.length;o++)r+=wm(s[o],JI);this.host=r}},cannotHaveUsernamePasswordPort:function(){return!this.host||this.cannotBeABaseURL||this.scheme=="file"},includesCredentials:function(){return this.username!=""||this.password!=""},isSpecial:function(){return TD(QI,this.scheme)},shortenPath:function(){var t=this.path,r=t.length;!r||this.scheme=="file"&&r==1&&Zb(t[0],!0)||t.length--},serialize:function(){var t=this,r=t.scheme,s=t.username,o=t.password,c=t.host,u=t.port,h=t.path,m=t.query,_=t.fragment,E=r+":";return c!==null?(E+="//",t.includesCredentials()&&(E+=s+(o?":"+o:"")+"@"),E+=Qb(c),u!==null&&(E+=":"+u)):r=="file"&&(E+="//"),E+=t.cannotBeABaseURL?h[0]:h.length?"/"+Xb(h,"/"):"",m!==null&&(E+="?"+m),_!==null&&(E+="#"+_),E},setHref:function(t){var r=this.parse(t);if(r)throw RD(r);this.searchParams.update()},getOrigin:function(){var t=this.scheme,r=this.port;if(t=="blob")try{return new Sv(t.path[0]).origin}catch{return"null"}return t!="file"&&this.isSpecial()?t+"://"+Qb(this.host)+(r!==null?":"+r:""):"null"},getProtocol:function(){return this.scheme+":"},setProtocol:function(t){this.parse(zf(t)+":",OD)},getUsername:function(){return this.username},setUsername:function(t){var r=yv(zf(t));if(!this.cannotHaveUsernamePasswordPort()){this.username="";for(var s=0;s<r.length;s++)this.username+=wm(r[s],PD)}},getPassword:function(){return this.password},setPassword:function(t){var r=yv(zf(t));if(!this.cannotHaveUsernamePasswordPort()){this.password="";for(var s=0;s<r.length;s++)this.password+=wm(r[s],PD)}},getHost:function(){var t=this.host,r=this.port;return t===null?"":r===null?Qb(t):Qb(t)+":"+r},setHost:function(t){this.cannotBeABaseURL||this.parse(t,DD)},getHostname:function(){var t=this.host;return t===null?"":Qb(t)},setHostname:function(t){this.cannotBeABaseURL||this.parse(t,LD)},getPort:function(){var t=this.port;return t===null?"":zf(t)},setPort:function(t){this.cannotHaveUsernamePasswordPort()||((t=zf(t))==""?this.port=null:this.parse(t,xD))},getPathname:function(){var t=this.path;return this.cannotBeABaseURL?t[0]:t.length?"/"+Xb(t,"/"):""},setPathname:function(t){this.cannotBeABaseURL||(this.path=[],this.parse(t,vv))},getSearch:function(){var t=this.query;return t?"?"+t:""},setSearch:function(t){(t=zf(t))==""?this.query=null:(au(t,0)=="?"&&(t=Jb(t,1)),this.query="",this.parse(t,C_)),this.searchParams.update()},getSearchParams:function(){return this.searchParams.facade},getHash:function(){var t=this.fragment;return t?"#"+t:""},setHash:function(t){(t=zf(t))!=""?(au(t,0)=="#"&&(t=Jb(t,1)),this.fragment="",this.parse(t,Gf)):this.fragment=null},update:function(){this.query=this.searchParams.serialize()||null}};var Sv=function(t){var r=tle(this,tc),s=sle(arguments.length,1)>1?arguments[1]:void 0,o=ole(r,new VD(t,!1,s));SD||(r.href=o.serialize(),r.origin=o.getOrigin(),r.protocol=o.getProtocol(),r.username=o.getUsername(),r.password=o.getPassword(),r.host=o.getHost(),r.hostname=o.getHostname(),r.port=o.getPort(),r.pathname=o.getPathname(),r.search=o.getSearch(),r.searchParams=o.getSearchParams(),r.hash=o.getHash())},tc=Sv.prototype,cu=function(t,r){return{get:function(){return qI(this)[t]()},set:r&&function(s){return qI(this)[r](s)},configurable:!0,enumerable:!0}};if(SD&&(ou(tc,"href",cu("serialize","setHref")),ou(tc,"origin",cu("getOrigin")),ou(tc,"protocol",cu("getProtocol","setProtocol")),ou(tc,"username",cu("getUsername","setUsername")),ou(tc,"password",cu("getPassword","setPassword")),ou(tc,"host",cu("getHost","setHost")),ou(tc,"hostname",cu("getHostname","setHostname")),ou(tc,"port",cu("getPort","setPort")),ou(tc,"pathname",cu("getPathname","setPathname")),ou(tc,"search",cu("getSearch","setSearch")),ou(tc,"searchParams",cu("getSearchParams")),ou(tc,"hash",cu("getHash","setHash"))),KI(tc,"toJSON",function(){return qI(this).serialize()},{enumerable:!0}),KI(tc,"toString",function(){return qI(this).serialize()},{enumerable:!0}),Yb){var c5=Yb.createObjectURL,l5=Yb.revokeObjectURL;c5&&KI(Sv,"createObjectURL",H3(c5,Yb)),l5&&KI(Sv,"revokeObjectURL",H3(l5,Yb))}ile(Sv,"URL"),Zce({global:!0,forced:!ele,sham:!SD},{URL:Sv});var Rle=Mn,Cle=d,Ile=pl,u5=_a,Ale=oD,d5=an("URL");Rle({target:"URL",stat:!0,forced:!(Ale&&Cle(function(){d5.canParse()}))},{canParse:function(t){var r=Ile(arguments.length,1),s=u5(t),o=r<2||arguments[1]===void 0?void 0:u5(arguments[1]);try{return!!new d5(s,o)}catch{return!1}}});var tA=l(bt.URL);let h5=!0,f5=!0;function nA(t,r,s){const o=t.match(r);return o&&o.length>=s&&parseInt(o[s],10)}function I_(t,r,s){if(!t.RTCPeerConnection)return;const o=t.RTCPeerConnection.prototype,c=o.addEventListener;o.addEventListener=function(h,m){if(h!==r)return c.apply(this,arguments);const _=E=>{const S=s(E);S&&(m.handleEvent?m.handleEvent(S):m(S))};return this._eventMap=this._eventMap||{},this._eventMap[r]||(this._eventMap[r]=new Map),this._eventMap[r].set(m,_),c.apply(this,[h,_])};const u=o.removeEventListener;o.removeEventListener=function(h,m){if(h!==r||!this._eventMap||!this._eventMap[r])return u.apply(this,arguments);if(!this._eventMap[r].has(m))return u.apply(this,arguments);const _=this._eventMap[r].get(m);return this._eventMap[r].delete(m),this._eventMap[r].size===0&&delete this._eventMap[r],Object.keys(this._eventMap).length===0&&delete this._eventMap,u.apply(this,[h,_])},Object.defineProperty(o,"on"+r,{get(){return this["_on"+r]},set(h){this["_on"+r]&&(this.removeEventListener(r,this["_on"+r]),delete this["_on"+r]),h&&this.addEventListener(r,this["_on"+r]=h)},enumerable:!0,configurable:!0})}function Ple(t){return typeof t!="boolean"?new Error("Argument type: "+typeof t+". Please use a boolean."):(h5=t,t?"adapter.js logging disabled":"adapter.js logging enabled")}function Ole(t){return typeof t!="boolean"?new Error("Argument type: "+typeof t+". Please use a boolean."):(f5=!t,"adapter.js deprecation warnings "+(t?"disabled":"enabled"))}function p5(){if(typeof window=="object"){if(h5)return;typeof console<"u"&&typeof console.log=="function"&&console.log.apply(console,arguments)}}function FD(t,r){f5&&console.warn(t+" is deprecated, please use "+r+" instead.")}function m5(t){return Object.prototype.toString.call(t)==="[object Object]"}function g5(t){var r;return m5(t)?Ya(r=Object.keys(t)).call(r,function(s,o){const c=m5(t[o]),u=c?g5(t[o]):t[o],h=c&&!Object.keys(u).length;return u===void 0||h?s:Object.assign(s,{[o]:u})},{}):t}function jD(t,r,s){r&&!s.has(r.id)&&(s.set(r.id,r),Object.keys(r).forEach(o=>{o.endsWith("Id")?jD(t,t.get(r[o]),s):o.endsWith("Ids")&&r[o].forEach(c=>{jD(t,t.get(c),s)})}))}function _5(t,r,s){const o=s?"outbound-rtp":"inbound-rtp",c=new Map;if(r===null)return c;const u=[];return t.forEach(h=>{h.type==="track"&&h.trackIdentifier===r.id&&u.push(h)}),u.forEach(h=>{t.forEach(m=>{m.type===o&&m.trackId===h.id&&jD(t,m,c)})}),c}const y5=p5;function E5(t,r){const s=t&&t.navigator;if(!s.mediaDevices)return;const o=function(h){if(typeof h!="object"||h.mandatory||h.optional)return h;const m={};return Object.keys(h).forEach(_=>{if(_==="require"||_==="advanced"||_==="mediaSource")return;const E=typeof h[_]=="object"?h[_]:{ideal:h[_]};E.exact!==void 0&&typeof E.exact=="number"&&(E.min=E.max=E.exact);const S=function(R,P){return R?R+P.charAt(0).toUpperCase()+P.slice(1):P==="deviceId"?"sourceId":P};if(E.ideal!==void 0){m.optional=m.optional||[];let R={};typeof E.ideal=="number"?(R[S("min",_)]=E.ideal,m.optional.push(R),R={},R[S("max",_)]=E.ideal,m.optional.push(R)):(R[S("",_)]=E.ideal,m.optional.push(R))}E.exact!==void 0&&typeof E.exact!="number"?(m.mandatory=m.mandatory||{},m.mandatory[S("",_)]=E.exact):["min","max"].forEach(R=>{E[R]!==void 0&&(m.mandatory=m.mandatory||{},m.mandatory[S(R,_)]=E[R])})}),h.advanced&&(m.optional=(m.optional||[]).concat(h.advanced)),m},c=function(h,m){if(r.version>=61)return m(h);if((h=JSON.parse(JSON.stringify(h)))&&typeof h.audio=="object"){const _=function(E,S,R){S in E&&!(R in E)&&(E[R]=E[S],delete E[S])};_((h=JSON.parse(JSON.stringify(h))).audio,"autoGainControl","googAutoGainControl"),_(h.audio,"noiseSuppression","googNoiseSuppression"),h.audio=o(h.audio)}if(h&&typeof h.video=="object"){let _=h.video.facingMode;_=_&&(typeof _=="object"?_:{ideal:_});const E=r.version<66;if(_&&(_.exact==="user"||_.exact==="environment"||_.ideal==="user"||_.ideal==="environment")&&(!s.mediaDevices.getSupportedConstraints||!s.mediaDevices.getSupportedConstraints().facingMode||E)){let S;if(delete h.video.facingMode,_.exact==="environment"||_.ideal==="environment"?S=["back","rear"]:_.exact!=="user"&&_.ideal!=="user"||(S=["front"]),S)return s.mediaDevices.enumerateDevices().then(R=>{let P=(R=R.filter(k=>k.kind==="videoinput")).find(k=>S.some(z=>{var U;return ot(U=k.label.toLowerCase()).call(U,z)}));return!P&&R.length&&ot(S).call(S,"back")&&(P=R[R.length-1]),P&&(h.video.deviceId=_.exact?{exact:P.deviceId}:{ideal:P.deviceId}),h.video=o(h.video),y5("chrome: "+JSON.stringify(h)),m(h)})}h.video=o(h.video)}return y5("chrome: "+JSON.stringify(h)),m(h)},u=function(h){return r.version>=64?h:{name:{PermissionDeniedError:"NotAllowedError",PermissionDismissedError:"NotAllowedError",InvalidStateError:"NotAllowedError",DevicesNotFoundError:"NotFoundError",ConstraintNotSatisfiedError:"OverconstrainedError",TrackStartError:"NotReadableError",MediaDeviceFailedDueToShutdown:"NotAllowedError",MediaDeviceKillSwitchOn:"NotAllowedError",TabCaptureError:"AbortError",ScreenCaptureError:"AbortError",DeviceCaptureError:"AbortError"}[h.name]||h.name,message:h.message,constraint:h.constraint||h.constraintName,toString(){return this.name+(this.message&&": ")+this.message}}};if(s.getUserMedia=(function(h,m,_){c(h,E=>{s.webkitGetUserMedia(E,m,S=>{_&&_(u(S))})})}).bind(s),s.mediaDevices.getUserMedia){const h=s.mediaDevices.getUserMedia.bind(s.mediaDevices);s.mediaDevices.getUserMedia=function(m){return c(m,_=>h(_).then(E=>{if(_.audio&&!E.getAudioTracks().length||_.video&&!E.getVideoTracks().length)throw E.getTracks().forEach(S=>{S.stop()}),new DOMException("","NotFoundError");return E},E=>lt.reject(u(E))))}}}function v5(t){t.MediaStream=t.MediaStream||t.webkitMediaStream}function S5(t){if(typeof t=="object"&&t.RTCPeerConnection&&!("ontrack"in t.RTCPeerConnection.prototype)){Object.defineProperty(t.RTCPeerConnection.prototype,"ontrack",{get(){return this._ontrack},set(s){this._ontrack&&this.removeEventListener("track",this._ontrack),this.addEventListener("track",this._ontrack=s)},enumerable:!0,configurable:!0});const r=t.RTCPeerConnection.prototype.setRemoteDescription;t.RTCPeerConnection.prototype.setRemoteDescription=function(){return this._ontrackpoly||(this._ontrackpoly=s=>{s.stream.addEventListener("addtrack",o=>{let c;c=t.RTCPeerConnection.prototype.getReceivers?this.getReceivers().find(h=>h.track&&h.track.id===o.track.id):{track:o.track};const u=new Event("track");u.track=o.track,u.receiver=c,u.transceiver={receiver:c},u.streams=[s.stream],this.dispatchEvent(u)}),s.stream.getTracks().forEach(o=>{let c;c=t.RTCPeerConnection.prototype.getReceivers?this.getReceivers().find(h=>h.track&&h.track.id===o.id):{track:o};const u=new Event("track");u.track=o,u.receiver=c,u.transceiver={receiver:c},u.streams=[s.stream],this.dispatchEvent(u)})},this.addEventListener("addstream",this._ontrackpoly)),r.apply(this,arguments)}}else I_(t,"track",r=>(r.transceiver||Object.defineProperty(r,"transceiver",{value:{receiver:r.receiver}}),r))}function b5(t){if(typeof t=="object"&&t.RTCPeerConnection&&!("getSenders"in t.RTCPeerConnection.prototype)&&"createDTMFSender"in t.RTCPeerConnection.prototype){const r=function(c,u){return{track:u,get dtmf(){return this._dtmf===void 0&&(u.kind==="audio"?this._dtmf=c.createDTMFSender(u):this._dtmf=null),this._dtmf},_pc:c}};if(!t.RTCPeerConnection.prototype.getSenders){t.RTCPeerConnection.prototype.getSenders=function(){return this._senders=this._senders||[],this._senders.slice()};const c=t.RTCPeerConnection.prototype.addTrack;t.RTCPeerConnection.prototype.addTrack=function(h,m){let _=c.apply(this,arguments);return _||(_=r(this,h),this._senders.push(_)),_};const u=t.RTCPeerConnection.prototype.removeTrack;t.RTCPeerConnection.prototype.removeTrack=function(h){u.apply(this,arguments);const m=this._senders.indexOf(h);m!==-1&&this._senders.splice(m,1)}}const s=t.RTCPeerConnection.prototype.addStream;t.RTCPeerConnection.prototype.addStream=function(c){this._senders=this._senders||[],s.apply(this,[c]),c.getTracks().forEach(u=>{this._senders.push(r(this,u))})};const o=t.RTCPeerConnection.prototype.removeStream;t.RTCPeerConnection.prototype.removeStream=function(c){this._senders=this._senders||[],o.apply(this,[c]),c.getTracks().forEach(u=>{const h=this._senders.find(m=>m.track===u);h&&this._senders.splice(this._senders.indexOf(h),1)})}}else if(typeof t=="object"&&t.RTCPeerConnection&&"getSenders"in t.RTCPeerConnection.prototype&&"createDTMFSender"in t.RTCPeerConnection.prototype&&t.RTCRtpSender&&!("dtmf"in t.RTCRtpSender.prototype)){const r=t.RTCPeerConnection.prototype.getSenders;t.RTCPeerConnection.prototype.getSenders=function(){const s=r.apply(this,[]);return s.forEach(o=>o._pc=this),s},Object.defineProperty(t.RTCRtpSender.prototype,"dtmf",{get(){return this._dtmf===void 0&&(this.track.kind==="audio"?this._dtmf=this._pc.createDTMFSender(this.track):this._dtmf=null),this._dtmf}})}}function T5(t){if(!t.RTCPeerConnection)return;const r=t.RTCPeerConnection.prototype.getStats;t.RTCPeerConnection.prototype.getStats=function(){const[s,o,c]=arguments;if(arguments.length>0&&typeof s=="function")return r.apply(this,arguments);if(r.length===0&&(arguments.length===0||typeof s!="function"))return r.apply(this,[]);const u=function(m){const _={};return m.result().forEach(E=>{const S={id:E.id,timestamp:E.timestamp,type:{localcandidate:"local-candidate",remotecandidate:"remote-candidate"}[E.type]||E.type};E.names().forEach(R=>{S[R]=E.stat(R)}),_[S.id]=S}),_},h=function(m){return new Map(Object.keys(m).map(_=>[_,m[_]]))};if(arguments.length>=2){const m=function(_){o(h(u(_)))};return r.apply(this,[m,s])}return new lt((m,_)=>{r.apply(this,[function(E){m(h(u(E)))},_])}).then(o,c)}}function w5(t){if(!(typeof t=="object"&&t.RTCPeerConnection&&t.RTCRtpSender&&t.RTCRtpReceiver))return;if(!("getStats"in t.RTCRtpSender.prototype)){const s=t.RTCPeerConnection.prototype.getSenders;s&&(t.RTCPeerConnection.prototype.getSenders=function(){const c=s.apply(this,[]);return c.forEach(u=>u._pc=this),c});const o=t.RTCPeerConnection.prototype.addTrack;o&&(t.RTCPeerConnection.prototype.addTrack=function(){const c=o.apply(this,arguments);return c._pc=this,c}),t.RTCRtpSender.prototype.getStats=function(){const c=this;return this._pc.getStats().then(u=>_5(u,c.track,!0))}}if(!("getStats"in t.RTCRtpReceiver.prototype)){const s=t.RTCPeerConnection.prototype.getReceivers;s&&(t.RTCPeerConnection.prototype.getReceivers=function(){const o=s.apply(this,[]);return o.forEach(c=>c._pc=this),o}),I_(t,"track",o=>(o.receiver._pc=o.srcElement,o)),t.RTCRtpReceiver.prototype.getStats=function(){const o=this;return this._pc.getStats().then(c=>_5(c,o.track,!1))}}if(!("getStats"in t.RTCRtpSender.prototype)||!("getStats"in t.RTCRtpReceiver.prototype))return;const r=t.RTCPeerConnection.prototype.getStats;t.RTCPeerConnection.prototype.getStats=function(){if(arguments.length>0&&arguments[0]instanceof t.MediaStreamTrack){const s=arguments[0];let o,c,u;return this.getSenders().forEach(h=>{h.track===s&&(o?u=!0:o=h)}),this.getReceivers().forEach(h=>(h.track===s&&(c?u=!0:c=h),h.track===s)),u||o&&c?lt.reject(new DOMException("There are more than one sender or receiver for the track.","InvalidAccessError")):o?o.getStats():c?c.getStats():lt.reject(new DOMException("There is no sender or receiver for the track.","InvalidAccessError"))}return r.apply(this,arguments)}}function R5(t){t.RTCPeerConnection.prototype.getLocalStreams=function(){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},Object.keys(this._shimmedLocalStreams).map(u=>this._shimmedLocalStreams[u][0])};const r=t.RTCPeerConnection.prototype.addTrack;t.RTCPeerConnection.prototype.addTrack=function(u,h){if(!h)return r.apply(this,arguments);this._shimmedLocalStreams=this._shimmedLocalStreams||{};const m=r.apply(this,arguments);return this._shimmedLocalStreams[h.id]?this._shimmedLocalStreams[h.id].indexOf(m)===-1&&this._shimmedLocalStreams[h.id].push(m):this._shimmedLocalStreams[h.id]=[h,m],m};const s=t.RTCPeerConnection.prototype.addStream;t.RTCPeerConnection.prototype.addStream=function(u){this._shimmedLocalStreams=this._shimmedLocalStreams||{},u.getTracks().forEach(_=>{if(this.getSenders().find(S=>S.track===_))throw new DOMException("Track already exists.","InvalidAccessError")});const h=this.getSenders();s.apply(this,arguments);const m=this.getSenders().filter(_=>h.indexOf(_)===-1);this._shimmedLocalStreams[u.id]=[u].concat(m)};const o=t.RTCPeerConnection.prototype.removeStream;t.RTCPeerConnection.prototype.removeStream=function(u){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},delete this._shimmedLocalStreams[u.id],o.apply(this,arguments)};const c=t.RTCPeerConnection.prototype.removeTrack;t.RTCPeerConnection.prototype.removeTrack=function(u){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},u&&Object.keys(this._shimmedLocalStreams).forEach(h=>{const m=this._shimmedLocalStreams[h].indexOf(u);m!==-1&&this._shimmedLocalStreams[h].splice(m,1),this._shimmedLocalStreams[h].length===1&&delete this._shimmedLocalStreams[h]}),c.apply(this,arguments)}}function C5(t,r){if(!t.RTCPeerConnection)return;if(t.RTCPeerConnection.prototype.addTrack&&r.version>=65)return R5(t);const s=t.RTCPeerConnection.prototype.getLocalStreams;t.RTCPeerConnection.prototype.getLocalStreams=function(){const _=s.apply(this);return this._reverseStreams=this._reverseStreams||{},_.map(E=>this._reverseStreams[E.id])};const o=t.RTCPeerConnection.prototype.addStream;t.RTCPeerConnection.prototype.addStream=function(_){if(this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},_.getTracks().forEach(E=>{if(this.getSenders().find(R=>R.track===E))throw new DOMException("Track already exists.","InvalidAccessError")}),!this._reverseStreams[_.id]){const E=new t.MediaStream(_.getTracks());this._streams[_.id]=E,this._reverseStreams[E.id]=_,_=E}o.apply(this,[_])};const c=t.RTCPeerConnection.prototype.removeStream;function u(_,E){let S=E.sdp;return Object.keys(_._reverseStreams||[]).forEach(R=>{const P=_._reverseStreams[R],k=_._streams[P.id];S=S.replace(new RegExp(k.id,"g"),P.id)}),new RTCSessionDescription({type:E.type,sdp:S})}t.RTCPeerConnection.prototype.removeStream=function(_){this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},c.apply(this,[this._streams[_.id]||_]),delete this._reverseStreams[this._streams[_.id]?this._streams[_.id].id:_.id],delete this._streams[_.id]},t.RTCPeerConnection.prototype.addTrack=function(_,E){if(this.signalingState==="closed")throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");const S=[].slice.call(arguments,1);if(S.length!==1||!S[0].getTracks().find(k=>k===_))throw new DOMException("The adapter.js addTrack polyfill only supports a single  stream which is associated with the specified track.","NotSupportedError");if(this.getSenders().find(k=>k.track===_))throw new DOMException("Track already exists.","InvalidAccessError");this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{};const P=this._streams[E.id];if(P)P.addTrack(_),lt.resolve().then(()=>{this.dispatchEvent(new Event("negotiationneeded"))});else{const k=new t.MediaStream([_]);this._streams[E.id]=k,this._reverseStreams[k.id]=E,this.addStream(k)}return this.getSenders().find(k=>k.track===_)},["createOffer","createAnswer"].forEach(function(_){const E=t.RTCPeerConnection.prototype[_],S={[_](){const R=arguments;return arguments.length&&typeof arguments[0]=="function"?E.apply(this,[P=>{const k=u(this,P);R[0].apply(null,[k])},P=>{R[1]&&R[1].apply(null,P)},arguments[2]]):E.apply(this,arguments).then(P=>u(this,P))}};t.RTCPeerConnection.prototype[_]=S[_]});const h=t.RTCPeerConnection.prototype.setLocalDescription;t.RTCPeerConnection.prototype.setLocalDescription=function(){return arguments.length&&arguments[0].type?(arguments[0]=function(_,E){let S=E.sdp;return Object.keys(_._reverseStreams||[]).forEach(R=>{const P=_._reverseStreams[R],k=_._streams[P.id];S=S.replace(new RegExp(P.id,"g"),k.id)}),new RTCSessionDescription({type:E.type,sdp:S})}(this,arguments[0]),h.apply(this,arguments)):h.apply(this,arguments)};const m=Object.getOwnPropertyDescriptor(t.RTCPeerConnection.prototype,"localDescription");Object.defineProperty(t.RTCPeerConnection.prototype,"localDescription",{get(){const _=m.get.apply(this);return _.type===""?_:u(this,_)}}),t.RTCPeerConnection.prototype.removeTrack=function(_){if(this.signalingState==="closed")throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");if(!_._pc)throw new DOMException("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.","TypeError");if(_._pc!==this)throw new DOMException("Sender was not created by this connection.","InvalidAccessError");let E;this._streams=this._streams||{},Object.keys(this._streams).forEach(S=>{this._streams[S].getTracks().find(R=>_.track===R)&&(E=this._streams[S])}),E&&(E.getTracks().length===1?this.removeStream(this._reverseStreams[E.id]):E.removeTrack(_.track),this.dispatchEvent(new Event("negotiationneeded")))}}function BD(t,r){!t.RTCPeerConnection&&t.webkitRTCPeerConnection&&(t.RTCPeerConnection=t.webkitRTCPeerConnection),t.RTCPeerConnection&&r.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(s){const o=t.RTCPeerConnection.prototype[s],c={[s](){return arguments[0]=new(s==="addIceCandidate"?t.RTCIceCandidate:t.RTCSessionDescription)(arguments[0]),o.apply(this,arguments)}};t.RTCPeerConnection.prototype[s]=c[s]})}function I5(t,r){I_(t,"negotiationneeded",s=>{const o=s.target;if(!(r.version<72||o.getConfiguration&&o.getConfiguration().sdpSemantics==="plan-b")||o.signalingState==="stable")return s})}var A5=Object.freeze({__proto__:null,fixNegotiationNeeded:I5,shimAddTrackRemoveTrack:C5,shimAddTrackRemoveTrackWithNative:R5,shimGetDisplayMedia:function(t,r){t.navigator.mediaDevices&&"getDisplayMedia"in t.navigator.mediaDevices||t.navigator.mediaDevices&&(typeof r=="function"?t.navigator.mediaDevices.getDisplayMedia=function(s){return r(s).then(o=>{const c=s.video&&s.video.width,u=s.video&&s.video.height,h=s.video&&s.video.frameRate;return s.video={mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:o,maxFrameRate:h||3}},c&&(s.video.mandatory.maxWidth=c),u&&(s.video.mandatory.maxHeight=u),t.navigator.mediaDevices.getUserMedia(s)})}:console.error("shimGetDisplayMedia: getSourceId argument is not a function"))},shimGetSendersWithDtmf:b5,shimGetStats:T5,shimGetUserMedia:E5,shimMediaStream:v5,shimOnTrack:S5,shimPeerConnection:BD,shimSenderReceiverGetStats:w5});function P5(t,r){const s=t&&t.navigator,o=t&&t.MediaStreamTrack;if(s.getUserMedia=function(c,u,h){FD("navigator.getUserMedia","navigator.mediaDevices.getUserMedia"),s.mediaDevices.getUserMedia(c).then(u,h)},!(r.version>55&&"autoGainControl"in s.mediaDevices.getSupportedConstraints())){const c=function(h,m,_){m in h&&!(_ in h)&&(h[_]=h[m],delete h[m])},u=s.mediaDevices.getUserMedia.bind(s.mediaDevices);if(s.mediaDevices.getUserMedia=function(h){return typeof h=="object"&&typeof h.audio=="object"&&(h=JSON.parse(JSON.stringify(h)),c(h.audio,"autoGainControl","mozAutoGainControl"),c(h.audio,"noiseSuppression","mozNoiseSuppression")),u(h)},o&&o.prototype.getSettings){const h=o.prototype.getSettings;o.prototype.getSettings=function(){const m=h.apply(this,arguments);return c(m,"mozAutoGainControl","autoGainControl"),c(m,"mozNoiseSuppression","noiseSuppression"),m}}if(o&&o.prototype.applyConstraints){const h=o.prototype.applyConstraints;o.prototype.applyConstraints=function(m){return this.kind==="audio"&&typeof m=="object"&&(m=JSON.parse(JSON.stringify(m)),c(m,"autoGainControl","mozAutoGainControl"),c(m,"noiseSuppression","mozNoiseSuppression")),h.apply(this,[m])}}}}function O5(t){typeof t=="object"&&t.RTCTrackEvent&&"receiver"in t.RTCTrackEvent.prototype&&!("transceiver"in t.RTCTrackEvent.prototype)&&Object.defineProperty(t.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function WD(t,r){if(typeof t!="object"||!t.RTCPeerConnection&&!t.mozRTCPeerConnection)return;!t.RTCPeerConnection&&t.mozRTCPeerConnection&&(t.RTCPeerConnection=t.mozRTCPeerConnection),r.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(c){const u=t.RTCPeerConnection.prototype[c],h={[c](){return arguments[0]=new(c==="addIceCandidate"?t.RTCIceCandidate:t.RTCSessionDescription)(arguments[0]),u.apply(this,arguments)}};t.RTCPeerConnection.prototype[c]=h[c]});const s={inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"},o=t.RTCPeerConnection.prototype.getStats;t.RTCPeerConnection.prototype.getStats=function(){const[c,u,h]=arguments;return o.apply(this,[c||null]).then(m=>{if(r.version<53&&!u)try{m.forEach(_=>{_.type=s[_.type]||_.type})}catch(_){if(_.name!=="TypeError")throw _;m.forEach((E,S)=>{m.set(S,Object.assign({},E,{type:s[E.type]||E.type}))})}return m}).then(u,h)}}function k5(t){if(typeof t!="object"||!t.RTCPeerConnection||!t.RTCRtpSender||t.RTCRtpSender&&"getStats"in t.RTCRtpSender.prototype)return;const r=t.RTCPeerConnection.prototype.getSenders;r&&(t.RTCPeerConnection.prototype.getSenders=function(){const o=r.apply(this,[]);return o.forEach(c=>c._pc=this),o});const s=t.RTCPeerConnection.prototype.addTrack;s&&(t.RTCPeerConnection.prototype.addTrack=function(){const o=s.apply(this,arguments);return o._pc=this,o}),t.RTCRtpSender.prototype.getStats=function(){return this.track?this._pc.getStats(this.track):lt.resolve(new Map)}}function N5(t){if(typeof t!="object"||!t.RTCPeerConnection||!t.RTCRtpSender||t.RTCRtpSender&&"getStats"in t.RTCRtpReceiver.prototype)return;const r=t.RTCPeerConnection.prototype.getReceivers;r&&(t.RTCPeerConnection.prototype.getReceivers=function(){const s=r.apply(this,[]);return s.forEach(o=>o._pc=this),s}),I_(t,"track",s=>(s.receiver._pc=s.srcElement,s)),t.RTCRtpReceiver.prototype.getStats=function(){return this._pc.getStats(this.track)}}function D5(t){t.RTCPeerConnection&&!("removeStream"in t.RTCPeerConnection.prototype)&&(t.RTCPeerConnection.prototype.removeStream=function(r){FD("removeStream","removeTrack"),this.getSenders().forEach(s=>{var o;s.track&&ot(o=r.getTracks()).call(o,s.track)&&this.removeTrack(s)})})}function L5(t){t.DataChannel&&!t.RTCDataChannel&&(t.RTCDataChannel=t.DataChannel)}function x5(t){if(typeof t!="object"||!t.RTCPeerConnection)return;const r=t.RTCPeerConnection.prototype.addTransceiver;r&&(t.RTCPeerConnection.prototype.addTransceiver=function(){this.setParametersPromises=[];let s=arguments[1]&&arguments[1].sendEncodings;s===void 0&&(s=[]),s=[...s];const o=s.length>0;o&&s.forEach(u=>{if("rid"in u&&!/^[a-z0-9]{0,16}$/i.test(u.rid))throw new TypeError("Invalid RID value provided.");if("scaleResolutionDownBy"in u&&!(parseFloat(u.scaleResolutionDownBy)>=1))throw new RangeError("scale_resolution_down_by must be >= 1.0");if("maxFramerate"in u&&!(parseFloat(u.maxFramerate)>=0))throw new RangeError("max_framerate must be >= 0.0")});const c=r.apply(this,arguments);if(o){const{sender:u}=c,h=u.getParameters();(!("encodings"in h)||h.encodings.length===1&&Object.keys(h.encodings[0]).length===0)&&(h.encodings=s,u.sendEncodings=s,this.setParametersPromises.push(u.setParameters(h).then(()=>{delete u.sendEncodings}).catch(()=>{delete u.sendEncodings})))}return c})}function M5(t){if(typeof t!="object"||!t.RTCRtpSender)return;const r=t.RTCRtpSender.prototype.getParameters;r&&(t.RTCRtpSender.prototype.getParameters=function(){const s=r.apply(this,arguments);return"encodings"in s||(s.encodings=[].concat(this.sendEncodings||[{}])),s})}function U5(t){if(typeof t!="object"||!t.RTCPeerConnection)return;const r=t.RTCPeerConnection.prototype.createOffer;t.RTCPeerConnection.prototype.createOffer=function(){return this.setParametersPromises&&this.setParametersPromises.length?lt.all(this.setParametersPromises).then(()=>r.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):r.apply(this,arguments)}}function V5(t){if(typeof t!="object"||!t.RTCPeerConnection)return;const r=t.RTCPeerConnection.prototype.createAnswer;t.RTCPeerConnection.prototype.createAnswer=function(){return this.setParametersPromises&&this.setParametersPromises.length?lt.all(this.setParametersPromises).then(()=>r.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):r.apply(this,arguments)}}var F5=Object.freeze({__proto__:null,shimAddTransceiver:x5,shimCreateAnswer:V5,shimCreateOffer:U5,shimGetDisplayMedia:function(t,r){t.navigator.mediaDevices&&"getDisplayMedia"in t.navigator.mediaDevices||t.navigator.mediaDevices&&(t.navigator.mediaDevices.getDisplayMedia=function(s){if(!s||!s.video){const o=new DOMException("getDisplayMedia without video constraints is undefined");return o.name="NotFoundError",o.code=8,lt.reject(o)}return s.video===!0?s.video={mediaSource:r}:s.video.mediaSource=r,t.navigator.mediaDevices.getUserMedia(s)})},shimGetParameters:M5,shimGetUserMedia:P5,shimOnTrack:O5,shimPeerConnection:WD,shimRTCDataChannel:L5,shimReceiverGetStats:N5,shimRemoveStream:D5,shimSenderGetStats:k5});function j5(t){if(typeof t=="object"&&t.RTCPeerConnection){if("getLocalStreams"in t.RTCPeerConnection.prototype||(t.RTCPeerConnection.prototype.getLocalStreams=function(){return this._localStreams||(this._localStreams=[]),this._localStreams}),!("addStream"in t.RTCPeerConnection.prototype)){const r=t.RTCPeerConnection.prototype.addTrack;t.RTCPeerConnection.prototype.addStream=function(s){var o;this._localStreams||(this._localStreams=[]),ot(o=this._localStreams).call(o,s)||this._localStreams.push(s),s.getAudioTracks().forEach(c=>r.call(this,c,s)),s.getVideoTracks().forEach(c=>r.call(this,c,s))},t.RTCPeerConnection.prototype.addTrack=function(s){for(var o=arguments.length,c=new Array(o>1?o-1:0),u=1;u<o;u++)c[u-1]=arguments[u];return c&&c.forEach(h=>{var m;this._localStreams?ot(m=this._localStreams).call(m,h)||this._localStreams.push(h):this._localStreams=[h]}),r.apply(this,arguments)}}"removeStream"in t.RTCPeerConnection.prototype||(t.RTCPeerConnection.prototype.removeStream=function(r){this._localStreams||(this._localStreams=[]);const s=this._localStreams.indexOf(r);if(s===-1)return;this._localStreams.splice(s,1);const o=r.getTracks();this.getSenders().forEach(c=>{ot(o).call(o,c.track)&&this.removeTrack(c)})})}}function B5(t){if(typeof t=="object"&&t.RTCPeerConnection&&("getRemoteStreams"in t.RTCPeerConnection.prototype||(t.RTCPeerConnection.prototype.getRemoteStreams=function(){return this._remoteStreams?this._remoteStreams:[]}),!("onaddstream"in t.RTCPeerConnection.prototype))){Object.defineProperty(t.RTCPeerConnection.prototype,"onaddstream",{get(){return this._onaddstream},set(s){this._onaddstream&&(this.removeEventListener("addstream",this._onaddstream),this.removeEventListener("track",this._onaddstreampoly)),this.addEventListener("addstream",this._onaddstream=s),this.addEventListener("track",this._onaddstreampoly=o=>{o.streams.forEach(c=>{var u;if(this._remoteStreams||(this._remoteStreams=[]),ot(u=this._remoteStreams).call(u,c))return;this._remoteStreams.push(c);const h=new Event("addstream");h.stream=c,this.dispatchEvent(h)})})}});const r=t.RTCPeerConnection.prototype.setRemoteDescription;t.RTCPeerConnection.prototype.setRemoteDescription=function(){const s=this;return this._onaddstreampoly||this.addEventListener("track",this._onaddstreampoly=function(o){o.streams.forEach(c=>{if(s._remoteStreams||(s._remoteStreams=[]),s._remoteStreams.indexOf(c)>=0)return;s._remoteStreams.push(c);const u=new Event("addstream");u.stream=c,s.dispatchEvent(u)})}),r.apply(s,arguments)}}}function W5(t){if(typeof t!="object"||!t.RTCPeerConnection)return;const r=t.RTCPeerConnection.prototype,s=r.createOffer,o=r.createAnswer,c=r.setLocalDescription,u=r.setRemoteDescription,h=r.addIceCandidate;r.createOffer=function(_,E){const S=arguments.length>=2?arguments[2]:arguments[0],R=s.apply(this,[S]);return E?(R.then(_,E),lt.resolve()):R},r.createAnswer=function(_,E){const S=arguments.length>=2?arguments[2]:arguments[0],R=o.apply(this,[S]);return E?(R.then(_,E),lt.resolve()):R};let m=function(_,E,S){const R=c.apply(this,[_]);return S?(R.then(E,S),lt.resolve()):R};r.setLocalDescription=m,m=function(_,E,S){const R=u.apply(this,[_]);return S?(R.then(E,S),lt.resolve()):R},r.setRemoteDescription=m,m=function(_,E,S){const R=h.apply(this,[_]);return S?(R.then(E,S),lt.resolve()):R},r.addIceCandidate=m}function z5(t){const r=t&&t.navigator;if(r.mediaDevices&&r.mediaDevices.getUserMedia){const s=r.mediaDevices,o=s.getUserMedia.bind(s);r.mediaDevices.getUserMedia=c=>o(G5(c))}!r.getUserMedia&&r.mediaDevices&&r.mediaDevices.getUserMedia&&(r.getUserMedia=(function(s,o,c){r.mediaDevices.getUserMedia(s).then(o,c)}).bind(r))}function G5(t){return t&&t.video!==void 0?Object.assign({},t,{video:g5(t.video)}):t}function H5(t){if(!t.RTCPeerConnection)return;const r=t.RTCPeerConnection;t.RTCPeerConnection=function(s,o){if(s&&s.iceServers){const c=[];for(let u=0;u<s.iceServers.length;u++){let h=s.iceServers[u];!h.hasOwnProperty("urls")&&h.hasOwnProperty("url")?(FD("RTCIceServer.url","RTCIceServer.urls"),h=JSON.parse(JSON.stringify(h)),h.urls=h.url,delete h.url,c.push(h)):c.push(s.iceServers[u])}s.iceServers=c}return new r(s,o)},t.RTCPeerConnection.prototype=r.prototype,"generateCertificate"in r&&Object.defineProperty(t.RTCPeerConnection,"generateCertificate",{get:()=>r.generateCertificate})}function $5(t){typeof t=="object"&&t.RTCTrackEvent&&"receiver"in t.RTCTrackEvent.prototype&&!("transceiver"in t.RTCTrackEvent.prototype)&&Object.defineProperty(t.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function K5(t){const r=t.RTCPeerConnection.prototype.createOffer;t.RTCPeerConnection.prototype.createOffer=function(s){if(s){s.offerToReceiveAudio!==void 0&&(s.offerToReceiveAudio=!!s.offerToReceiveAudio);const o=this.getTransceivers().find(u=>u.receiver.track.kind==="audio");s.offerToReceiveAudio===!1&&o?o.direction==="sendrecv"?o.setDirection?o.setDirection("sendonly"):o.direction="sendonly":o.direction==="recvonly"&&(o.setDirection?o.setDirection("inactive"):o.direction="inactive"):s.offerToReceiveAudio!==!0||o||this.addTransceiver("audio",{direction:"recvonly"}),s.offerToReceiveVideo!==void 0&&(s.offerToReceiveVideo=!!s.offerToReceiveVideo);const c=this.getTransceivers().find(u=>u.receiver.track.kind==="video");s.offerToReceiveVideo===!1&&c?c.direction==="sendrecv"?c.setDirection?c.setDirection("sendonly"):c.direction="sendonly":c.direction==="recvonly"&&(c.setDirection?c.setDirection("inactive"):c.direction="inactive"):s.offerToReceiveVideo!==!0||c||this.addTransceiver("video",{direction:"recvonly"})}return r.apply(this,arguments)}}function q5(t){typeof t!="object"||t.AudioContext||(t.AudioContext=t.webkitAudioContext)}var Y5=Object.freeze({__proto__:null,shimAudioContext:q5,shimCallbacksAPI:W5,shimConstraints:G5,shimCreateOfferLegacy:K5,shimGetUserMedia:z5,shimLocalStreamsAPI:j5,shimRTCIceServerUrls:H5,shimRemoteStreamsAPI:B5,shimTrackEventTransceiver:$5}),X5=`	
\v\f\r \u2028\u2029\uFEFF`,kle=Xt,Nle=_a,zD=X5,J5=A("".replace),Dle=RegExp("^["+zD+"]+"),Lle=RegExp("(^|[^"+zD+"])["+zD+"]+$"),xle=function(t){return function(r){var s=Nle(kle(r));return 1&t&&(s=J5(s,Dle,"")),2&t&&(s=J5(s,Lle,"$1")),s}},Mle={trim:xle(3)},Ule=lI.PROPER,Vle=d,Q5=X5,Fle=Mle.trim;Mn({target:"String",proto:!0,forced:function(t){return Vle(function(){return!!Q5[t]()||""[t]()!==""||Ule&&Q5[t].name!==t})}("trim")},{trim:function(){return Fle(this)}});var jle=qa("String").trim,Ble=N,Wle=jle,GD=String.prototype,zle=function(t){var r=t.trim;return typeof t=="string"||t===GD||Ble(GD,t)&&r===GD.trim?Wle:r},eo=l(zle),Z5={exports:{}};(function(t){const r={generateIdentifier:function(){return Math.random().toString(36).substring(2,12)}};r.localCName=r.generateIdentifier(),r.splitLines=function(s){return s.trim().split(`
`).map(o=>o.trim())},r.splitSections=function(s){return s.split(`
m=`).map((o,c)=>(c>0?"m="+o:o).trim()+`\r
`)},r.getDescription=function(s){const o=r.splitSections(s);return o&&o[0]},r.getMediaSections=function(s){const o=r.splitSections(s);return o.shift(),o},r.matchPrefix=function(s,o){return r.splitLines(s).filter(c=>c.indexOf(o)===0)},r.parseCandidate=function(s){let o;o=s.indexOf("a=candidate:")===0?s.substring(12).split(" "):s.substring(10).split(" ");const c={foundation:o[0],component:{1:"rtp",2:"rtcp"}[o[1]]||o[1],protocol:o[2].toLowerCase(),priority:parseInt(o[3],10),ip:o[4],address:o[4],port:parseInt(o[5],10),type:o[7]};for(let u=8;u<o.length;u+=2)switch(o[u]){case"raddr":c.relatedAddress=o[u+1];break;case"rport":c.relatedPort=parseInt(o[u+1],10);break;case"tcptype":c.tcpType=o[u+1];break;case"ufrag":c.ufrag=o[u+1],c.usernameFragment=o[u+1];break;default:c[o[u]]===void 0&&(c[o[u]]=o[u+1])}return c},r.writeCandidate=function(s){const o=[];o.push(s.foundation);const c=s.component;c==="rtp"?o.push(1):c==="rtcp"?o.push(2):o.push(c),o.push(s.protocol.toUpperCase()),o.push(s.priority),o.push(s.address||s.ip),o.push(s.port);const u=s.type;return o.push("typ"),o.push(u),u!=="host"&&s.relatedAddress&&s.relatedPort&&(o.push("raddr"),o.push(s.relatedAddress),o.push("rport"),o.push(s.relatedPort)),s.tcpType&&s.protocol.toLowerCase()==="tcp"&&(o.push("tcptype"),o.push(s.tcpType)),(s.usernameFragment||s.ufrag)&&(o.push("ufrag"),o.push(s.usernameFragment||s.ufrag)),"candidate:"+o.join(" ")},r.parseIceOptions=function(s){return s.substring(14).split(" ")},r.parseRtpMap=function(s){let o=s.substring(9).split(" ");const c={payloadType:parseInt(o.shift(),10)};return o=o[0].split("/"),c.name=o[0],c.clockRate=parseInt(o[1],10),c.channels=o.length===3?parseInt(o[2],10):1,c.numChannels=c.channels,c},r.writeRtpMap=function(s){let o=s.payloadType;s.preferredPayloadType!==void 0&&(o=s.preferredPayloadType);const c=s.channels||s.numChannels||1;return"a=rtpmap:"+o+" "+s.name+"/"+s.clockRate+(c!==1?"/"+c:"")+`\r
`},r.parseExtmap=function(s){const o=s.substring(9).split(" ");return{id:parseInt(o[0],10),direction:o[0].indexOf("/")>0?o[0].split("/")[1]:"sendrecv",uri:o[1],attributes:o.slice(2).join(" ")}},r.writeExtmap=function(s){return"a=extmap:"+(s.id||s.preferredId)+(s.direction&&s.direction!=="sendrecv"?"/"+s.direction:"")+" "+s.uri+(s.attributes?" "+s.attributes:"")+`\r
`},r.parseFmtp=function(s){const o={};let c;const u=s.substring(s.indexOf(" ")+1).split(";");for(let h=0;h<u.length;h++)c=u[h].trim().split("="),o[c[0].trim()]=c[1];return o},r.writeFmtp=function(s){let o="",c=s.payloadType;if(s.preferredPayloadType!==void 0&&(c=s.preferredPayloadType),s.parameters&&Object.keys(s.parameters).length){const u=[];Object.keys(s.parameters).forEach(h=>{s.parameters[h]!==void 0?u.push(h+"="+s.parameters[h]):u.push(h)}),o+="a=fmtp:"+c+" "+u.join(";")+`\r
`}return o},r.parseRtcpFb=function(s){const o=s.substring(s.indexOf(" ")+1).split(" ");return{type:o.shift(),parameter:o.join(" ")}},r.writeRtcpFb=function(s){let o="",c=s.payloadType;return s.preferredPayloadType!==void 0&&(c=s.preferredPayloadType),s.rtcpFeedback&&s.rtcpFeedback.length&&s.rtcpFeedback.forEach(u=>{o+="a=rtcp-fb:"+c+" "+u.type+(u.parameter&&u.parameter.length?" "+u.parameter:"")+`\r
`}),o},r.parseSsrcMedia=function(s){const o=s.indexOf(" "),c={ssrc:parseInt(s.substring(7,o),10)},u=s.indexOf(":",o);return u>-1?(c.attribute=s.substring(o+1,u),c.value=s.substring(u+1)):c.attribute=s.substring(o+1),c},r.parseSsrcGroup=function(s){const o=s.substring(13).split(" ");return{semantics:o.shift(),ssrcs:o.map(c=>parseInt(c,10))}},r.getMid=function(s){const o=r.matchPrefix(s,"a=mid:")[0];if(o)return o.substring(6)},r.parseFingerprint=function(s){const o=s.substring(14).split(" ");return{algorithm:o[0].toLowerCase(),value:o[1].toUpperCase()}},r.getDtlsParameters=function(s,o){return{role:"auto",fingerprints:r.matchPrefix(s+o,"a=fingerprint:").map(r.parseFingerprint)}},r.writeDtlsParameters=function(s,o){let c="a=setup:"+o+`\r
`;return s.fingerprints.forEach(u=>{c+="a=fingerprint:"+u.algorithm+" "+u.value+`\r
`}),c},r.parseCryptoLine=function(s){const o=s.substring(9).split(" ");return{tag:parseInt(o[0],10),cryptoSuite:o[1],keyParams:o[2],sessionParams:o.slice(3)}},r.writeCryptoLine=function(s){return"a=crypto:"+s.tag+" "+s.cryptoSuite+" "+(typeof s.keyParams=="object"?r.writeCryptoKeyParams(s.keyParams):s.keyParams)+(s.sessionParams?" "+s.sessionParams.join(" "):"")+`\r
`},r.parseCryptoKeyParams=function(s){if(s.indexOf("inline:")!==0)return null;const o=s.substring(7).split("|");return{keyMethod:"inline",keySalt:o[0],lifeTime:o[1],mkiValue:o[2]?o[2].split(":")[0]:void 0,mkiLength:o[2]?o[2].split(":")[1]:void 0}},r.writeCryptoKeyParams=function(s){return s.keyMethod+":"+s.keySalt+(s.lifeTime?"|"+s.lifeTime:"")+(s.mkiValue&&s.mkiLength?"|"+s.mkiValue+":"+s.mkiLength:"")},r.getCryptoParameters=function(s,o){return r.matchPrefix(s+o,"a=crypto:").map(r.parseCryptoLine)},r.getIceParameters=function(s,o){const c=r.matchPrefix(s+o,"a=ice-ufrag:")[0],u=r.matchPrefix(s+o,"a=ice-pwd:")[0];return c&&u?{usernameFragment:c.substring(12),password:u.substring(10)}:null},r.writeIceParameters=function(s){let o="a=ice-ufrag:"+s.usernameFragment+`\r
a=ice-pwd:`+s.password+`\r
`;return s.iceLite&&(o+=`a=ice-lite\r
`),o},r.parseRtpParameters=function(s){const o={codecs:[],headerExtensions:[],fecMechanisms:[],rtcp:[]},c=r.splitLines(s)[0].split(" ");o.profile=c[2];for(let h=3;h<c.length;h++){const m=c[h],_=r.matchPrefix(s,"a=rtpmap:"+m+" ")[0];if(_){const E=r.parseRtpMap(_),S=r.matchPrefix(s,"a=fmtp:"+m+" ");switch(E.parameters=S.length?r.parseFmtp(S[0]):{},E.rtcpFeedback=r.matchPrefix(s,"a=rtcp-fb:"+m+" ").map(r.parseRtcpFb),o.codecs.push(E),E.name.toUpperCase()){case"RED":case"ULPFEC":o.fecMechanisms.push(E.name.toUpperCase())}}}r.matchPrefix(s,"a=extmap:").forEach(h=>{o.headerExtensions.push(r.parseExtmap(h))});const u=r.matchPrefix(s,"a=rtcp-fb:* ").map(r.parseRtcpFb);return o.codecs.forEach(h=>{u.forEach(m=>{h.rtcpFeedback.find(_=>_.type===m.type&&_.parameter===m.parameter)||h.rtcpFeedback.push(m)})}),o},r.writeRtpDescription=function(s,o){let c="";c+="m="+s+" ",c+=o.codecs.length>0?"9":"0",c+=" "+(o.profile||"UDP/TLS/RTP/SAVPF")+" ",c+=o.codecs.map(h=>h.preferredPayloadType!==void 0?h.preferredPayloadType:h.payloadType).join(" ")+`\r
`,c+=`c=IN IP4 0.0.0.0\r
`,c+=`a=rtcp:9 IN IP4 0.0.0.0\r
`,o.codecs.forEach(h=>{c+=r.writeRtpMap(h),c+=r.writeFmtp(h),c+=r.writeRtcpFb(h)});let u=0;return o.codecs.forEach(h=>{h.maxptime>u&&(u=h.maxptime)}),u>0&&(c+="a=maxptime:"+u+`\r
`),o.headerExtensions&&o.headerExtensions.forEach(h=>{c+=r.writeExtmap(h)}),c},r.parseRtpEncodingParameters=function(s){const o=[],c=r.parseRtpParameters(s),u=c.fecMechanisms.indexOf("RED")!==-1,h=c.fecMechanisms.indexOf("ULPFEC")!==-1,m=r.matchPrefix(s,"a=ssrc:").map(P=>r.parseSsrcMedia(P)).filter(P=>P.attribute==="cname"),_=m.length>0&&m[0].ssrc;let E;const S=r.matchPrefix(s,"a=ssrc-group:FID").map(P=>P.substring(17).split(" ").map(k=>parseInt(k,10)));S.length>0&&S[0].length>1&&S[0][0]===_&&(E=S[0][1]),c.codecs.forEach(P=>{if(P.name.toUpperCase()==="RTX"&&P.parameters.apt){let k={ssrc:_,codecPayloadType:parseInt(P.parameters.apt,10)};_&&E&&(k.rtx={ssrc:E}),o.push(k),u&&(k=JSON.parse(JSON.stringify(k)),k.fec={ssrc:_,mechanism:h?"red+ulpfec":"red"},o.push(k))}}),o.length===0&&_&&o.push({ssrc:_});let R=r.matchPrefix(s,"b=");return R.length&&(R=R[0].indexOf("b=TIAS:")===0?parseInt(R[0].substring(7),10):R[0].indexOf("b=AS:")===0?1e3*parseInt(R[0].substring(5),10)*.95-16e3:void 0,o.forEach(P=>{P.maxBitrate=R})),o},r.parseRtcpParameters=function(s){const o={},c=r.matchPrefix(s,"a=ssrc:").map(m=>r.parseSsrcMedia(m)).filter(m=>m.attribute==="cname")[0];c&&(o.cname=c.value,o.ssrc=c.ssrc);const u=r.matchPrefix(s,"a=rtcp-rsize");o.reducedSize=u.length>0,o.compound=u.length===0;const h=r.matchPrefix(s,"a=rtcp-mux");return o.mux=h.length>0,o},r.writeRtcpParameters=function(s){let o="";return s.reducedSize&&(o+=`a=rtcp-rsize\r
`),s.mux&&(o+=`a=rtcp-mux\r
`),s.ssrc!==void 0&&s.cname&&(o+="a=ssrc:"+s.ssrc+" cname:"+s.cname+`\r
`),o},r.parseMsid=function(s){let o;const c=r.matchPrefix(s,"a=msid:");if(c.length===1)return o=c[0].substring(7).split(" "),{stream:o[0],track:o[1]};const u=r.matchPrefix(s,"a=ssrc:").map(h=>r.parseSsrcMedia(h)).filter(h=>h.attribute==="msid");return u.length>0?(o=u[0].value.split(" "),{stream:o[0],track:o[1]}):void 0},r.parseSctpDescription=function(s){const o=r.parseMLine(s),c=r.matchPrefix(s,"a=max-message-size:");let u;c.length>0&&(u=parseInt(c[0].substring(19),10)),isNaN(u)&&(u=65536);const h=r.matchPrefix(s,"a=sctp-port:");if(h.length>0)return{port:parseInt(h[0].substring(12),10),protocol:o.fmt,maxMessageSize:u};const m=r.matchPrefix(s,"a=sctpmap:");if(m.length>0){const _=m[0].substring(10).split(" ");return{port:parseInt(_[0],10),protocol:_[1],maxMessageSize:u}}},r.writeSctpDescription=function(s,o){let c=[];return c=s.protocol!=="DTLS/SCTP"?["m="+s.kind+" 9 "+s.protocol+" "+o.protocol+`\r
`,`c=IN IP4 0.0.0.0\r
`,"a=sctp-port:"+o.port+`\r
`]:["m="+s.kind+" 9 "+s.protocol+" "+o.port+`\r
`,`c=IN IP4 0.0.0.0\r
`,"a=sctpmap:"+o.port+" "+o.protocol+` 65535\r
`],o.maxMessageSize!==void 0&&c.push("a=max-message-size:"+o.maxMessageSize+`\r
`),c.join("")},r.generateSessionId=function(){return Math.random().toString().substr(2,22)},r.writeSessionBoilerplate=function(s,o,c){let u;const h=o!==void 0?o:2;return u=s||r.generateSessionId(),`v=0\r
o=`+(c||"thisisadapterortc")+" "+u+" "+h+` IN IP4 127.0.0.1\r
s=-\r
t=0 0\r
`},r.getDirection=function(s,o){const c=r.splitLines(s);for(let u=0;u<c.length;u++)switch(c[u]){case"a=sendrecv":case"a=sendonly":case"a=recvonly":case"a=inactive":return c[u].substring(2)}return o?r.getDirection(o):"sendrecv"},r.getKind=function(s){return r.splitLines(s)[0].split(" ")[0].substring(2)},r.isRejected=function(s){return s.split(" ",2)[1]==="0"},r.parseMLine=function(s){const o=r.splitLines(s)[0].substring(2).split(" ");return{kind:o[0],port:parseInt(o[1],10),protocol:o[2],fmt:o.slice(3).join(" ")}},r.parseOLine=function(s){const o=r.matchPrefix(s,"o=")[0].substring(2).split(" ");return{username:o[0],sessionId:o[1],sessionVersion:parseInt(o[2],10),netType:o[3],addressType:o[4],address:o[5]}},r.isValidSDP=function(s){if(typeof s!="string"||s.length===0)return!1;const o=r.splitLines(s);for(let c=0;c<o.length;c++)if(o[c].length<2||o[c].charAt(1)!=="=")return!1;return!0},t.exports=r})(Z5);var eB=Z5.exports,bv=l(eB),Gle=i({__proto__:null,default:bv},[eB]);function rA(t){if(!t.RTCIceCandidate||t.RTCIceCandidate&&"foundation"in t.RTCIceCandidate.prototype)return;const r=t.RTCIceCandidate;t.RTCIceCandidate=function(s){if(typeof s=="object"&&s.candidate&&s.candidate.indexOf("a=")===0&&((s=JSON.parse(JSON.stringify(s))).candidate=s.candidate.substr(2)),s.candidate&&s.candidate.length){const o=new r(s),c=bv.parseCandidate(s.candidate),u=Object.assign(o,c);return u.toJSON=function(){return{candidate:u.candidate,sdpMid:u.sdpMid,sdpMLineIndex:u.sdpMLineIndex,usernameFragment:u.usernameFragment}},u}return new r(s)},t.RTCIceCandidate.prototype=r.prototype,I_(t,"icecandidate",s=>(s.candidate&&Object.defineProperty(s,"candidate",{value:new t.RTCIceCandidate(s.candidate),writable:"false"}),s))}function HD(t){!t.RTCIceCandidate||t.RTCIceCandidate&&"relayProtocol"in t.RTCIceCandidate.prototype||I_(t,"icecandidate",r=>{if(r.candidate){const s=bv.parseCandidate(r.candidate.candidate);s.type==="relay"&&(r.candidate.relayProtocol={0:"tls",1:"tcp",2:"udp"}[s.priority>>24])}return r})}function iA(t,r){if(!t.RTCPeerConnection)return;"sctp"in t.RTCPeerConnection.prototype||Object.defineProperty(t.RTCPeerConnection.prototype,"sctp",{get(){return this._sctp===void 0?null:this._sctp}});const s=function(m){if(!m||!m.sdp)return!1;const _=bv.splitSections(m.sdp);return _.shift(),_.some(E=>{const S=bv.parseMLine(E);return S&&S.kind==="application"&&S.protocol.indexOf("SCTP")!==-1})},o=function(m){const _=m.sdp.match(/mozilla...THIS_IS_SDPARTA-(\d+)/);if(_===null||_.length<2)return-1;const E=parseInt(_[1],10);return E!=E?-1:E},c=function(m){let _=65536;return r.browser==="firefox"&&(_=r.version<57?m===-1?16384:2147483637:r.version<60?r.version===57?65535:65536:2147483637),_},u=function(m,_){let E=65536;r.browser==="firefox"&&r.version===57&&(E=65535);const S=bv.matchPrefix(m.sdp,"a=max-message-size:");return S.length>0?E=parseInt(S[0].substr(19),10):r.browser==="firefox"&&_!==-1&&(E=2147483637),E},h=t.RTCPeerConnection.prototype.setRemoteDescription;t.RTCPeerConnection.prototype.setRemoteDescription=function(){if(this._sctp=null,r.browser==="chrome"&&r.version>=76){const{sdpSemantics:m}=this.getConfiguration();m==="plan-b"&&Object.defineProperty(this,"sctp",{get(){return this._sctp===void 0?null:this._sctp},enumerable:!0,configurable:!0})}if(s(arguments[0])){const m=o(arguments[0]),_=c(m),E=u(arguments[0],m);let S;S=_===0&&E===0?Number.POSITIVE_INFINITY:_===0||E===0?Math.max(_,E):Math.min(_,E);const R={};Object.defineProperty(R,"maxMessageSize",{get:()=>S}),this._sctp=R}return h.apply(this,arguments)}}function sA(t){if(!t.RTCPeerConnection||!("createDataChannel"in t.RTCPeerConnection.prototype))return;function r(o,c){const u=o.send;o.send=function(){const h=arguments[0],m=h.length||h.size||h.byteLength;if(o.readyState==="open"&&c.sctp&&m>c.sctp.maxMessageSize)throw new TypeError("Message too large (can send a maximum of "+c.sctp.maxMessageSize+" bytes)");return u.apply(o,arguments)}}const s=t.RTCPeerConnection.prototype.createDataChannel;t.RTCPeerConnection.prototype.createDataChannel=function(){const o=s.apply(this,arguments);return r(o,this),o},I_(t,"datachannel",o=>(r(o.channel,o.target),o))}function $D(t){if(!t.RTCPeerConnection||"connectionState"in t.RTCPeerConnection.prototype)return;const r=t.RTCPeerConnection.prototype;Object.defineProperty(r,"connectionState",{get(){return{completed:"connected",checking:"connecting"}[this.iceConnectionState]||this.iceConnectionState},enumerable:!0,configurable:!0}),Object.defineProperty(r,"onconnectionstatechange",{get(){return this._onconnectionstatechange||null},set(s){this._onconnectionstatechange&&(this.removeEventListener("connectionstatechange",this._onconnectionstatechange),delete this._onconnectionstatechange),s&&this.addEventListener("connectionstatechange",this._onconnectionstatechange=s)},enumerable:!0,configurable:!0}),["setLocalDescription","setRemoteDescription"].forEach(s=>{const o=r[s];r[s]=function(){return this._connectionstatechangepoly||(this._connectionstatechangepoly=c=>{const u=c.target;if(u._lastConnectionState!==u.connectionState){u._lastConnectionState=u.connectionState;const h=new Event("connectionstatechange",c);u.dispatchEvent(h)}return c},this.addEventListener("iceconnectionstatechange",this._connectionstatechangepoly)),o.apply(this,arguments)}})}function KD(t,r){if(!t.RTCPeerConnection||r.browser==="chrome"&&r.version>=71||r.browser==="safari"&&r.version>=605)return;const s=t.RTCPeerConnection.prototype.setRemoteDescription;t.RTCPeerConnection.prototype.setRemoteDescription=function(o){if(o&&o.sdp&&o.sdp.indexOf(`
a=extmap-allow-mixed`)!==-1){const c=o.sdp.split(`
`).filter(u=>eo(u).call(u)!=="a=extmap-allow-mixed").join(`
`);t.RTCSessionDescription&&o instanceof t.RTCSessionDescription?arguments[0]=new t.RTCSessionDescription({type:o.type,sdp:c}):o.sdp=c}return s.apply(this,arguments)}}function oA(t,r){if(!t.RTCPeerConnection||!t.RTCPeerConnection.prototype)return;const s=t.RTCPeerConnection.prototype.addIceCandidate;s&&s.length!==0&&(t.RTCPeerConnection.prototype.addIceCandidate=function(){return arguments[0]?(r.browser==="chrome"&&r.version<78||r.browser==="firefox"&&r.version<68||r.browser==="safari")&&arguments[0]&&arguments[0].candidate===""?lt.resolve():s.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),lt.resolve())})}function aA(t,r){if(!t.RTCPeerConnection||!t.RTCPeerConnection.prototype)return;const s=t.RTCPeerConnection.prototype.setLocalDescription;s&&s.length!==0&&(t.RTCPeerConnection.prototype.setLocalDescription=function(){let o=arguments[0]||{};if(typeof o!="object"||o.type&&o.sdp)return s.apply(this,arguments);if(o={type:o.type,sdp:o.sdp},!o.type)switch(this.signalingState){case"stable":case"have-local-offer":case"have-remote-pranswer":o.type="offer";break;default:o.type="answer"}return o.sdp||o.type!=="offer"&&o.type!=="answer"?s.apply(this,[o]):(o.type==="offer"?this.createOffer:this.createAnswer).apply(this).then(c=>s.apply(this,[c]))})}var Hle=Object.freeze({__proto__:null,removeExtmapAllowMixed:KD,shimAddIceCandidateNullOrEmpty:oA,shimConnectionState:$D,shimMaxMessageSize:iA,shimParameterlessSetLocalDescription:aA,shimRTCIceCandidate:rA,shimRTCIceCandidateRelayProtocol:HD,shimSendThrowTypeError:sA});(function(){let{window:t}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{shimChrome:!0,shimFirefox:!0,shimSafari:!0};const s=p5,o=function(u){const h={browser:null,version:null};if(u===void 0||!u.navigator)return h.browser="Not a browser.",h;const{navigator:m}=u;if(m.mozGetUserMedia)h.browser="firefox",h.version=nA(m.userAgent,/Firefox\/(\d+)\./,1);else if(m.webkitGetUserMedia||u.isSecureContext===!1&&u.webkitRTCPeerConnection)h.browser="chrome",h.version=nA(m.userAgent,/Chrom(e|ium)\/(\d+)\./,2);else{if(!u.RTCPeerConnection||!m.userAgent.match(/AppleWebKit\/(\d+)\./))return h.browser="Not a supported browser.",h;h.browser="safari",h.version=nA(m.userAgent,/AppleWebKit\/(\d+)\./,1),h.supportsUnifiedPlan=u.RTCRtpTransceiver&&"currentDirection"in u.RTCRtpTransceiver.prototype}return h}(t),c={browserDetails:o,commonShim:Hle,extractVersion:nA,disableLog:Ple,disableWarnings:Ole,sdp:Gle};switch(o.browser){case"chrome":if(!A5||!BD||!r.shimChrome)return s("Chrome shim is not included in this adapter release."),c;if(o.version===null)return s("Chrome shim can not determine version, not shimming."),c;s("adapter.js shimming chrome."),c.browserShim=A5,oA(t,o),aA(t),E5(t,o),v5(t),BD(t,o),S5(t),C5(t,o),b5(t),T5(t),w5(t),I5(t,o),rA(t),HD(t),$D(t),iA(t,o),sA(t),KD(t,o);break;case"firefox":if(!F5||!WD||!r.shimFirefox)return s("Firefox shim is not included in this adapter release."),c;s("adapter.js shimming firefox."),c.browserShim=F5,oA(t,o),aA(t),P5(t,o),WD(t,o),O5(t),D5(t),k5(t),N5(t),L5(t),x5(t),M5(t),U5(t),V5(t),rA(t),$D(t),iA(t,o),sA(t);break;case"safari":if(!Y5||!r.shimSafari)return s("Safari shim is not included in this adapter release."),c;s("adapter.js shimming safari."),c.browserShim=Y5,oA(t,o),aA(t),H5(t),K5(t),W5(t),j5(t),B5(t),$5(t),z5(t),q5(t),rA(t),HD(t),iA(t,o),sA(t),KD(t,o);break;default:s("Unsupported browser!")}})({window:typeof window>"u"?void 0:window});var tB=hc,$le=TypeError,nB=ir.match(/firefox\/(\d+)/i),Kle=!!nB&&+nB[1],qle=/MSIE|Trident/.test(ir),rB=ir.match(/AppleWebKit\/(\d+)\./),Yle=!!rB&&+rB[1],Xle=Mn,iB=A,Jle=hs,Qle=Po,sB=oi,Zle=function(t,r){if(!delete t[r])throw $le("Cannot delete property "+tB(r)+" of "+tB(t))},oB=_a,qD=d,eue=g3,tue=Sf,aB=Kle,nue=qle,cB=dr,lB=Yle,Rm=[],uB=iB(Rm.sort),rue=iB(Rm.push),iue=qD(function(){Rm.sort(void 0)}),sue=qD(function(){Rm.sort(null)}),oue=tue("sort"),dB=!qD(function(){if(cB)return cB<70;if(!(aB&&aB>3)){if(nue)return!0;if(lB)return lB<603;var t,r,s,o,c="";for(t=65;t<76;t++){switch(r=String.fromCharCode(t),t){case 66:case 69:case 70:case 72:s=3;break;case 68:case 71:s=4;break;default:s=2}for(o=0;o<47;o++)Rm.push({k:r+o,v:s})}for(Rm.sort(function(u,h){return h.v-u.v}),o=0;o<Rm.length;o++)r=Rm[o].k.charAt(0),c.charAt(c.length-1)!==r&&(c+=r);return c!=="DGBEFHACIJK"}});Xle({target:"Array",proto:!0,forced:iue||!sue||!oue||!dB},{sort:function(t){t!==void 0&&Jle(t);var r=Qle(this);if(dB)return t===void 0?uB(r):uB(r,t);var s,o,c=[],u=sB(r);for(o=0;o<u;o++)o in r&&rue(c,r[o]);for(eue(c,function(h){return function(m,_){return _===void 0?-1:m===void 0?1:h!==void 0?+h(m,_)||0:oB(m)>oB(_)?1:-1}}(t)),s=sB(c),o=0;o<s;)r[o]=c[o++];for(;o<u;)Zle(r,o++);return r}});var aue=qa("Array").sort,cue=N,lue=aue,YD=Array.prototype,uue=function(t){var r=t.sort;return t===YD||cue(YD,t)&&r===YD.sort?lue:r},eT=l(uue),XD=j;Mn({global:!0,forced:XD.globalThis!==XD},{globalThis:XD});var hB=l(j),JD={exports:{}};(function(t,r){(function(s,o){var c="function",u="undefined",h="object",m="string",_="major",E="model",S="name",R="type",P="vendor",k="version",z="architecture",U="console",F="mobile",q="tablet",Y="smarttv",le="wearable",ye="embedded",Ee="Amazon",me="Apple",ke="ASUS",Ye="BlackBerry",ut="Browser",pt="Chrome",vn="Firefox",Sn="Google",cr="Huawei",ei="LG",Wr="Microsoft",Qo="Motorola",je="Opera",st="Samsung",Tt="Sharp",We="Sony",x="Xiaomi",ie="Zebra",de="Facebook",Qe="Chromium OS",$t="Mac OS",tr=function(wi){for(var Ki={},Sr=0;Sr<wi.length;Sr++)Ki[wi[Sr].toUpperCase()]=wi[Sr];return Ki},$i=function(wi,Ki){return typeof wi===m&&Oa(Ki).indexOf(Oa(wi))!==-1},Oa=function(wi){return wi.toLowerCase()},ap=function(wi,Ki){if(typeof wi===m)return wi=wi.replace(/^\s\s*/,""),typeof Ki===u?wi:wi.substring(0,350)},iy=function(wi,Ki){for(var Sr,ic,Nh,ti,Fn,ka,Km=0;Km<Ki.length&&!Fn;){var Td=Ki[Km],F$=Ki[Km+1];for(Sr=ic=0;Sr<Td.length&&!Fn&&Td[Sr];)if(Fn=Td[Sr++].exec(wi))for(Nh=0;Nh<F$.length;Nh++)ka=Fn[++ic],typeof(ti=F$[Nh])===h&&ti.length>0?ti.length===2?typeof ti[1]==c?this[ti[0]]=ti[1].call(this,ka):this[ti[0]]=ti[1]:ti.length===3?typeof ti[1]!==c||ti[1].exec&&ti[1].test?this[ti[0]]=ka?ka.replace(ti[1],ti[2]):o:this[ti[0]]=ka?ti[1].call(this,ka,ti[2]):o:ti.length===4&&(this[ti[0]]=ka?ti[3].call(this,ka.replace(ti[1],ti[2])):o):this[ti]=ka||o;Km+=2}},rw=function(wi,Ki){for(var Sr in Ki)if(typeof Ki[Sr]===h&&Ki[Sr].length>0){for(var ic=0;ic<Ki[Sr].length;ic++)if($i(Ki[Sr][ic],wi))return Sr==="?"?o:Sr}else if($i(Ki[Sr],wi))return Sr==="?"?o:Sr;return wi},iO={ME:"4.90","NT 3.11":"NT3.51","NT 4.0":"NT4.0",2e3:"NT 5.0",XP:["NT 5.1","NT 5.2"],Vista:"NT 6.0",7:"NT 6.1",8:"NT 6.2",8.1:"NT 6.3",10:["NT 6.4","NT 10.0"],RT:"ARM"},sO={browser:[[/\b(?:crmo|crios)\/([\w\.]+)/i],[k,[S,"Chrome"]],[/edg(?:e|ios|a)?\/([\w\.]+)/i],[k,[S,"Edge"]],[/(opera mini)\/([-\w\.]+)/i,/(opera [mobiletab]{3,6})\b.+version\/([-\w\.]+)/i,/(opera)(?:.+version\/|[\/ ]+)([\w\.]+)/i],[S,k],[/opios[\/ ]+([\w\.]+)/i],[k,[S,je+" Mini"]],[/\bopr\/([\w\.]+)/i],[k,[S,je]],[/(kindle)\/([\w\.]+)/i,/(lunascape|maxthon|netfront|jasmine|blazer)[\/ ]?([\w\.]*)/i,/(avant |iemobile|slim)(?:browser)?[\/ ]?([\w\.]*)/i,/(ba?idubrowser)[\/ ]?([\w\.]+)/i,/(?:ms|\()(ie) ([\w\.]+)/i,/(flock|rockmelt|midori|epiphany|silk|skyfire|ovibrowser|bolt|iron|vivaldi|iridium|phantomjs|bowser|quark|qupzilla|falkon|rekonq|puffin|brave|whale(?!.+naver)|qqbrowserlite|qq|duckduckgo)\/([-\w\.]+)/i,/(weibo)__([\d\.]+)/i],[S,k],[/(?:\buc? ?browser|(?:juc.+)ucweb)[\/ ]?([\w\.]+)/i],[k,[S,"UC"+ut]],[/microm.+\bqbcore\/([\w\.]+)/i,/\bqbcore\/([\w\.]+).+microm/i],[k,[S,"WeChat(Win) Desktop"]],[/micromessenger\/([\w\.]+)/i],[k,[S,"WeChat"]],[/konqueror\/([\w\.]+)/i],[k,[S,"Konqueror"]],[/trident.+rv[: ]([\w\.]{1,9})\b.+like gecko/i],[k,[S,"IE"]],[/yabrowser\/([\w\.]+)/i],[k,[S,"Yandex"]],[/(avast|avg)\/([\w\.]+)/i],[[S,/(.+)/,"$1 Secure "+ut],k],[/\bfocus\/([\w\.]+)/i],[k,[S,vn+" Focus"]],[/\bopt\/([\w\.]+)/i],[k,[S,je+" Touch"]],[/coc_coc\w+\/([\w\.]+)/i],[k,[S,"Coc Coc"]],[/dolfin\/([\w\.]+)/i],[k,[S,"Dolphin"]],[/coast\/([\w\.]+)/i],[k,[S,je+" Coast"]],[/miuibrowser\/([\w\.]+)/i],[k,[S,"MIUI "+ut]],[/fxios\/([-\w\.]+)/i],[k,[S,vn]],[/\bqihu|(qi?ho?o?|360)browser/i],[[S,"360 "+ut]],[/(oculus|samsung|sailfish|huawei)browser\/([\w\.]+)/i],[[S,/(.+)/,"$1 "+ut],k],[/(comodo_dragon)\/([\w\.]+)/i],[[S,/_/g," "],k],[/(electron)\/([\w\.]+) safari/i,/(tesla)(?: qtcarbrowser|\/(20\d\d\.[-\w\.]+))/i,/m?(qqbrowser|baiduboxapp|2345Explorer)[\/ ]?([\w\.]+)/i],[S,k],[/(metasr)[\/ ]?([\w\.]+)/i,/(lbbrowser)/i,/\[(linkedin)app\]/i],[S],[/((?:fban\/fbios|fb_iab\/fb4a)(?!.+fbav)|;fbav\/([\w\.]+);)/i],[[S,de],k],[/(kakao(?:talk|story))[\/ ]([\w\.]+)/i,/(naver)\(.*?(\d+\.[\w\.]+).*\)/i,/safari (line)\/([\w\.]+)/i,/\b(line)\/([\w\.]+)\/iab/i,/(chromium|instagram)[\/ ]([-\w\.]+)/i],[S,k],[/\bgsa\/([\w\.]+) .*safari\//i],[k,[S,"GSA"]],[/headlesschrome(?:\/([\w\.]+)| )/i],[k,[S,pt+" Headless"]],[/ wv\).+(chrome)\/([\w\.]+)/i],[[S,pt+" WebView"],k],[/droid.+ version\/([\w\.]+)\b.+(?:mobile safari|safari)/i],[k,[S,"Android "+ut]],[/(chrome|omniweb|arora|[tizenoka]{5} ?browser)\/v?([\w\.]+)/i],[S,k],[/version\/([\w\.\,]+) .*mobile\/\w+ (safari)/i],[k,[S,"Mobile Safari"]],[/version\/([\w(\.|\,)]+) .*(mobile ?safari|safari)/i],[k,S],[/webkit.+?(mobile ?safari|safari)(\/[\w\.]+)/i],[S,[k,rw,{"1.0":"/8",1.2:"/1",1.3:"/3","2.0":"/412","2.0.2":"/416","2.0.3":"/417","2.0.4":"/419","?":"/"}]],[/(webkit|khtml)\/([\w\.]+)/i],[S,k],[/(navigator|netscape\d?)\/([-\w\.]+)/i],[[S,"Netscape"],k],[/mobile vr; rv:([\w\.]+)\).+firefox/i],[k,[S,vn+" Reality"]],[/ekiohf.+(flow)\/([\w\.]+)/i,/(swiftfox)/i,/(icedragon|iceweasel|camino|chimera|fennec|maemo browser|minimo|conkeror|klar)[\/ ]?([\w\.\+]+)/i,/(seamonkey|k-meleon|icecat|iceape|firebird|phoenix|palemoon|basilisk|waterfox)\/([-\w\.]+)$/i,/(firefox)\/([\w\.]+)/i,/(mozilla)\/([\w\.]+) .+rv\:.+gecko\/\d+/i,/(polaris|lynx|dillo|icab|doris|amaya|w3m|netsurf|sleipnir|obigo|mosaic|(?:go|ice|up)[\. ]?browser)[-\/ ]?v?([\w\.]+)/i,/(links) \(([\w\.]+)/i,/panasonic;(viera)/i],[S,k],[/(cobalt)\/([\w\.]+)/i],[S,[k,/master.|lts./,""]]],cpu:[[/(?:(amd|x(?:(?:86|64)[-_])?|wow|win)64)[;\)]/i],[[z,"amd64"]],[/(ia32(?=;))/i],[[z,Oa]],[/((?:i[346]|x)86)[;\)]/i],[[z,"ia32"]],[/\b(aarch64|arm(v?8e?l?|_?64))\b/i],[[z,"arm64"]],[/\b(arm(?:v[67])?ht?n?[fl]p?)\b/i],[[z,"armhf"]],[/windows (ce|mobile); ppc;/i],[[z,"arm"]],[/((?:ppc|powerpc)(?:64)?)(?: mac|;|\))/i],[[z,/ower/,"",Oa]],[/(sun4\w)[;\)]/i],[[z,"sparc"]],[/((?:avr32|ia64(?=;))|68k(?=\))|\barm(?=v(?:[1-7]|[5-7]1)l?|;|eabi)|(?=atmel )avr|(?:irix|mips|sparc)(?:64)?\b|pa-risc)/i],[[z,Oa]]],device:[[/\b(sch-i[89]0\d|shw-m380s|sm-[ptx]\w{2,4}|gt-[pn]\d{2,4}|sgh-t8[56]9|nexus 10)/i],[E,[P,st],[R,q]],[/\b((?:s[cgp]h|gt|sm)-\w+|sc[g-]?[\d]+a?|galaxy nexus)/i,/samsung[- ]([-\w]+)/i,/sec-(sgh\w+)/i],[E,[P,st],[R,F]],[/\((ip(?:hone|od)[\w ]*);/i],[E,[P,me],[R,F]],[/\((ipad);[-\w\),; ]+apple/i,/applecoremedia\/[\w\.]+ \((ipad)/i,/\b(ipad)\d\d?,\d\d?[;\]].+ios/i],[E,[P,me],[R,q]],[/(macintosh);/i],[E,[P,me]],[/\b(sh-?[altvz]?\d\d[a-ekm]?)/i],[E,[P,Tt],[R,F]],[/\b((?:ag[rs][23]?|bah2?|sht?|btv)-a?[lw]\d{2})\b(?!.+d\/s)/i],[E,[P,cr],[R,q]],[/(?:huawei|honor)([-\w ]+)[;\)]/i,/\b(nexus 6p|\w{2,4}e?-[atu]?[ln][\dx][012359c][adn]?)\b(?!.+d\/s)/i],[E,[P,cr],[R,F]],[/\b(poco[\w ]+)(?: bui|\))/i,/\b; (\w+) build\/hm\1/i,/\b(hm[-_ ]?note?[_ ]?(?:\d\w)?) bui/i,/\b(redmi[\-_ ]?(?:note|k)?[\w_ ]+)(?: bui|\))/i,/\b(mi[-_ ]?(?:a\d|one|one[_ ]plus|note lte|max|cc)?[_ ]?(?:\d?\w?)[_ ]?(?:plus|se|lite)?)(?: bui|\))/i],[[E,/_/g," "],[P,x],[R,F]],[/\b(mi[-_ ]?(?:pad)(?:[\w_ ]+))(?: bui|\))/i],[[E,/_/g," "],[P,x],[R,q]],[/; (\w+) bui.+ oppo/i,/\b(cph[12]\d{3}|p(?:af|c[al]|d\w|e[ar])[mt]\d0|x9007|a101op)\b/i],[E,[P,"OPPO"],[R,F]],[/vivo (\w+)(?: bui|\))/i,/\b(v[12]\d{3}\w?[at])(?: bui|;)/i],[E,[P,"Vivo"],[R,F]],[/\b(rmx[12]\d{3})(?: bui|;|\))/i],[E,[P,"Realme"],[R,F]],[/\b(milestone|droid(?:[2-4x]| (?:bionic|x2|pro|razr))?:?( 4g)?)\b[\w ]+build\//i,/\bmot(?:orola)?[- ](\w*)/i,/((?:moto[\w\(\) ]+|xt\d{3,4}|nexus 6)(?= bui|\)))/i],[E,[P,Qo],[R,F]],[/\b(mz60\d|xoom[2 ]{0,2}) build\//i],[E,[P,Qo],[R,q]],[/((?=lg)?[vl]k\-?\d{3}) bui| 3\.[-\w; ]{10}lg?-([06cv9]{3,4})/i],[E,[P,ei],[R,q]],[/(lm(?:-?f100[nv]?|-[\w\.]+)(?= bui|\))|nexus [45])/i,/\blg[-e;\/ ]+((?!browser|netcast|android tv)\w+)/i,/\blg-?([\d\w]+) bui/i],[E,[P,ei],[R,F]],[/(ideatab[-\w ]+)/i,/lenovo ?(s[56]000[-\w]+|tab(?:[\w ]+)|yt[-\d\w]{6}|tb[-\d\w]{6})/i],[E,[P,"Lenovo"],[R,q]],[/(?:maemo|nokia).*(n900|lumia \d+)/i,/nokia[-_ ]?([-\w\.]*)/i],[[E,/_/g," "],[P,"Nokia"],[R,F]],[/(pixel c)\b/i],[E,[P,Sn],[R,q]],[/droid.+; (pixel[\daxl ]{0,6})(?: bui|\))/i],[E,[P,Sn],[R,F]],[/droid.+ (a?\d[0-2]{2}so|[c-g]\d{4}|so[-gl]\w+|xq-a\w[4-7][12])(?= bui|\).+chrome\/(?![1-6]{0,1}\d\.))/i],[E,[P,We],[R,F]],[/sony tablet [ps]/i,/\b(?:sony)?sgp\w+(?: bui|\))/i],[[E,"Xperia Tablet"],[P,We],[R,q]],[/ (kb2005|in20[12]5|be20[12][59])\b/i,/(?:one)?(?:plus)? (a\d0\d\d)(?: b|\))/i],[E,[P,"OnePlus"],[R,F]],[/(alexa)webm/i,/(kf[a-z]{2}wi)( bui|\))/i,/(kf[a-z]+)( bui|\)).+silk\//i],[E,[P,Ee],[R,q]],[/((?:sd|kf)[0349hijorstuw]+)( bui|\)).+silk\//i],[[E,/(.+)/g,"Fire Phone $1"],[P,Ee],[R,F]],[/(playbook);[-\w\),; ]+(rim)/i],[E,P,[R,q]],[/\b((?:bb[a-f]|st[hv])100-\d)/i,/\(bb10; (\w+)/i],[E,[P,Ye],[R,F]],[/(?:\b|asus_)(transfo[prime ]{4,10} \w+|eeepc|slider \w+|nexus 7|padfone|p00[cj])/i],[E,[P,ke],[R,q]],[/ (z[bes]6[027][012][km][ls]|zenfone \d\w?)\b/i],[E,[P,ke],[R,F]],[/(nexus 9)/i],[E,[P,"HTC"],[R,q]],[/(htc)[-;_ ]{1,2}([\w ]+(?=\)| bui)|\w+)/i,/(zte)[- ]([\w ]+?)(?: bui|\/|\))/i,/(alcatel|geeksphone|nexian|panasonic(?!(?:;|\.))|sony(?!-bra))[-_ ]?([-\w]*)/i],[P,[E,/_/g," "],[R,F]],[/droid.+; ([ab][1-7]-?[0178a]\d\d?)/i],[E,[P,"Acer"],[R,q]],[/droid.+; (m[1-5] note) bui/i,/\bmz-([-\w]{2,})/i],[E,[P,"Meizu"],[R,F]],[/(blackberry|benq|palm(?=\-)|sonyericsson|acer|asus|dell|meizu|motorola|polytron)[-_ ]?([-\w]*)/i,/(hp) ([\w ]+\w)/i,/(asus)-?(\w+)/i,/(microsoft); (lumia[\w ]+)/i,/(lenovo)[-_ ]?([-\w]+)/i,/(jolla)/i,/(oppo) ?([\w ]+) bui/i],[P,E,[R,F]],[/(kobo)\s(ereader|touch)/i,/(archos) (gamepad2?)/i,/(hp).+(touchpad(?!.+tablet)|tablet)/i,/(kindle)\/([\w\.]+)/i,/(nook)[\w ]+build\/(\w+)/i,/(dell) (strea[kpr\d ]*[\dko])/i,/(le[- ]+pan)[- ]+(\w{1,9}) bui/i,/(trinity)[- ]*(t\d{3}) bui/i,/(gigaset)[- ]+(q\w{1,9}) bui/i,/(vodafone) ([\w ]+)(?:\)| bui)/i],[P,E,[R,q]],[/(surface duo)/i],[E,[P,Wr],[R,q]],[/droid [\d\.]+; (fp\du?)(?: b|\))/i],[E,[P,"Fairphone"],[R,F]],[/(u304aa)/i],[E,[P,"AT&T"],[R,F]],[/\bsie-(\w*)/i],[E,[P,"Siemens"],[R,F]],[/\b(rct\w+) b/i],[E,[P,"RCA"],[R,q]],[/\b(venue[\d ]{2,7}) b/i],[E,[P,"Dell"],[R,q]],[/\b(q(?:mv|ta)\w+) b/i],[E,[P,"Verizon"],[R,q]],[/\b(?:barnes[& ]+noble |bn[rt])([\w\+ ]*) b/i],[E,[P,"Barnes & Noble"],[R,q]],[/\b(tm\d{3}\w+) b/i],[E,[P,"NuVision"],[R,q]],[/\b(k88) b/i],[E,[P,"ZTE"],[R,q]],[/\b(nx\d{3}j) b/i],[E,[P,"ZTE"],[R,F]],[/\b(gen\d{3}) b.+49h/i],[E,[P,"Swiss"],[R,F]],[/\b(zur\d{3}) b/i],[E,[P,"Swiss"],[R,q]],[/\b((zeki)?tb.*\b) b/i],[E,[P,"Zeki"],[R,q]],[/\b([yr]\d{2}) b/i,/\b(dragon[- ]+touch |dt)(\w{5}) b/i],[[P,"Dragon Touch"],E,[R,q]],[/\b(ns-?\w{0,9}) b/i],[E,[P,"Insignia"],[R,q]],[/\b((nxa|next)-?\w{0,9}) b/i],[E,[P,"NextBook"],[R,q]],[/\b(xtreme\_)?(v(1[045]|2[015]|[3469]0|7[05])) b/i],[[P,"Voice"],E,[R,F]],[/\b(lvtel\-)?(v1[12]) b/i],[[P,"LvTel"],E,[R,F]],[/\b(ph-1) /i],[E,[P,"Essential"],[R,F]],[/\b(v(100md|700na|7011|917g).*\b) b/i],[E,[P,"Envizen"],[R,q]],[/\b(trio[-\w\. ]+) b/i],[E,[P,"MachSpeed"],[R,q]],[/\btu_(1491) b/i],[E,[P,"Rotor"],[R,q]],[/(shield[\w ]+) b/i],[E,[P,"Nvidia"],[R,q]],[/(sprint) (\w+)/i],[P,E,[R,F]],[/(kin\.[onetw]{3})/i],[[E,/\./g," "],[P,Wr],[R,F]],[/droid.+; (cc6666?|et5[16]|mc[239][23]x?|vc8[03]x?)\)/i],[E,[P,ie],[R,q]],[/droid.+; (ec30|ps20|tc[2-8]\d[kx])\)/i],[E,[P,ie],[R,F]],[/smart-tv.+(samsung)/i],[P,[R,Y]],[/hbbtv.+maple;(\d+)/i],[[E,/^/,"SmartTV"],[P,st],[R,Y]],[/(nux; netcast.+smarttv|lg (netcast\.tv-201\d|android tv))/i],[[P,ei],[R,Y]],[/(apple) ?tv/i],[P,[E,me+" TV"],[R,Y]],[/crkey/i],[[E,pt+"cast"],[P,Sn],[R,Y]],[/droid.+aft(\w)( bui|\))/i],[E,[P,Ee],[R,Y]],[/\(dtv[\);].+(aquos)/i,/(aquos-tv[\w ]+)\)/i],[E,[P,Tt],[R,Y]],[/(bravia[\w ]+)( bui|\))/i],[E,[P,We],[R,Y]],[/(mitv-\w{5}) bui/i],[E,[P,x],[R,Y]],[/Hbbtv.*(technisat) (.*);/i],[P,E,[R,Y]],[/\b(roku)[\dx]*[\)\/]((?:dvp-)?[\d\.]*)/i,/hbbtv\/\d+\.\d+\.\d+ +\([\w\+ ]*; *([\w\d][^;]*);([^;]*)/i],[[P,ap],[E,ap],[R,Y]],[/\b(android tv|smart[- ]?tv|opera tv|tv; rv:)\b/i],[[R,Y]],[/(ouya)/i,/(nintendo) ([wids3utch]+)/i],[P,E,[R,U]],[/droid.+; (shield) bui/i],[E,[P,"Nvidia"],[R,U]],[/(playstation [345portablevi]+)/i],[E,[P,We],[R,U]],[/\b(xbox(?: one)?(?!; xbox))[\); ]/i],[E,[P,Wr],[R,U]],[/((pebble))app/i],[P,E,[R,le]],[/(watch)(?: ?os[,\/]|\d,\d\/)[\d\.]+/i],[E,[P,me],[R,le]],[/droid.+; (glass) \d/i],[E,[P,Sn],[R,le]],[/droid.+; (wt63?0{2,3})\)/i],[E,[P,ie],[R,le]],[/(quest( 2| pro)?)/i],[E,[P,de],[R,le]],[/(tesla)(?: qtcarbrowser|\/[-\w\.]+)/i],[P,[R,ye]],[/droid .+?; ([^;]+?)(?: bui|\) applew).+? mobile safari/i],[E,[R,F]],[/droid .+?; ([^;]+?)(?: bui|\) applew).+?(?! mobile) safari/i],[E,[R,q]],[/\b((tablet|tab)[;\/]|focus\/\d(?!.+mobile))/i],[[R,q]],[/(phone|mobile(?:[;\/]| [ \w\/\.]*safari)|pda(?=.+windows ce))/i],[[R,F]],[/(android[-\w\. ]{0,9});.+buil/i],[E,[P,"Generic"]]],engine:[[/windows.+ edge\/([\w\.]+)/i],[k,[S,"EdgeHTML"]],[/webkit\/537\.36.+chrome\/(?!27)([\w\.]+)/i],[k,[S,"Blink"]],[/(presto)\/([\w\.]+)/i,/(webkit|trident|netfront|netsurf|amaya|lynx|w3m|goanna)\/([\w\.]+)/i,/ekioh(flow)\/([\w\.]+)/i,/(khtml|tasman|links)[\/ ]\(?([\w\.]+)/i,/(icab)[\/ ]([23]\.[\d\.]+)/i],[S,k],[/rv\:([\w\.]{1,9})\b.+(gecko)/i],[k,S]],os:[[/microsoft (windows) (vista|xp)/i],[S,k],[/(windows) nt 6\.2; (arm)/i,/(windows (?:phone(?: os)?|mobile))[\/ ]?([\d\.\w ]*)/i,/(windows)[\/ ]?([ntce\d\. ]+\w)(?!.+xbox)/i],[S,[k,rw,iO]],[/(win(?=3|9|n)|win 9x )([nt\d\.]+)/i],[[S,"Windows"],[k,rw,iO]],[/ip[honead]{2,4}\b(?:.*os ([\w]+) like mac|; opera)/i,/cfnetwork\/.+darwin/i],[[k,/_/g,"."],[S,"iOS"]],[/(mac os x) ?([\w\. ]*)/i,/(macintosh|mac_powerpc\b)(?!.+haiku)/i],[[S,$t],[k,/_/g,"."]],[/droid ([\w\.]+)\b.+(android[- ]x86|harmonyos)/i],[k,S],[/(android|webos|qnx|bada|rim tablet os|maemo|meego|sailfish)[-\/ ]?([\w\.]*)/i,/(blackberry)\w*\/([\w\.]*)/i,/(tizen|kaios)[\/ ]([\w\.]+)/i,/\((series40);/i],[S,k],[/\(bb(10);/i],[k,[S,Ye]],[/(?:symbian ?os|symbos|s60(?=;)|series60)[-\/ ]?([\w\.]*)/i],[k,[S,"Symbian"]],[/mozilla\/[\d\.]+ \((?:mobile|tablet|tv|mobile; [\w ]+); rv:.+ gecko\/([\w\.]+)/i],[k,[S,vn+" OS"]],[/web0s;.+rt(tv)/i,/\b(?:hp)?wos(?:browser)?\/([\w\.]+)/i],[k,[S,"webOS"]],[/watch(?: ?os[,\/]|\d,\d\/)([\d\.]+)/i],[k,[S,"watchOS"]],[/crkey\/([\d\.]+)/i],[k,[S,pt+"cast"]],[/(cros) [\w]+(?:\)| ([\w\.]+)\b)/i],[[S,Qe],k],[/panasonic;(viera)/i,/(netrange)mmh/i,/(nettv)\/(\d+\.[\w\.]+)/i,/(nintendo|playstation) ([wids345portablevuch]+)/i,/(xbox); +xbox ([^\);]+)/i,/\b(joli|palm)\b ?(?:os)?\/?([\w\.]*)/i,/(mint)[\/\(\) ]?(\w*)/i,/(mageia|vectorlinux)[; ]/i,/([kxln]?ubuntu|debian|suse|opensuse|gentoo|arch(?= linux)|slackware|fedora|mandriva|centos|pclinuxos|red ?hat|zenwalk|linpus|raspbian|plan 9|minix|risc os|contiki|deepin|manjaro|elementary os|sabayon|linspire)(?: gnu\/linux)?(?: enterprise)?(?:[- ]linux)?(?:-gnu)?[-\/ ]?(?!chrom|package)([-\w\.]*)/i,/(hurd|linux) ?([\w\.]*)/i,/(gnu) ?([\w\.]*)/i,/\b([-frentopcghs]{0,5}bsd|dragonfly)[\/ ]?(?!amd|[ix346]{1,2}86)([\w\.]*)/i,/(haiku) (\w+)/i],[S,k],[/(sunos) ?([\w\.\d]*)/i],[[S,"Solaris"],k],[/((?:open)?solaris)[-\/ ]?([\w\.]*)/i,/(aix) ((\d)(?=\.|\)| )[\w\.])*/i,/\b(beos|os\/2|amigaos|morphos|openvms|fuchsia|hp-ux)/i,/(unix) ?([\w\.]*)/i],[S,k]]},Cl=function(wi,Ki){if(typeof wi===h&&(Ki=wi,wi=o),!(this instanceof Cl))return new Cl(wi,Ki).getResult();var Sr=typeof s!==u&&s.navigator?s.navigator:o,ic=wi||(Sr&&Sr.userAgent?Sr.userAgent:""),Nh=Sr&&Sr.userAgentData?Sr.userAgentData:o,ti=Ki?function(Fn,ka){var Km={};for(var Td in Fn)ka[Td]&&ka[Td].length%2==0?Km[Td]=ka[Td].concat(Fn[Td]):Km[Td]=Fn[Td];return Km}(sO,Ki):sO;return this.getBrowser=function(){var Fn={};return Fn[S]=o,Fn[k]=o,iy.call(Fn,ic,ti.browser),Fn[_]=function(ka){return typeof ka===m?ka.replace(/[^\d\.]/g,"").split(".")[0]:o}(Fn[k]),Sr&&Sr.brave&&typeof Sr.brave.isBrave==c&&(Fn[S]="Brave"),Fn},this.getCPU=function(){var Fn={};return Fn[z]=o,iy.call(Fn,ic,ti.cpu),Fn},this.getDevice=function(){var Fn={};return Fn[P]=o,Fn[E]=o,Fn[R]=o,iy.call(Fn,ic,ti.device),!Fn[R]&&Nh&&Nh.mobile&&(Fn[R]=F),Fn[E]=="Macintosh"&&Sr&&typeof Sr.standalone!==u&&Sr.maxTouchPoints&&Sr.maxTouchPoints>2&&(Fn[E]="iPad",Fn[R]=q),Fn},this.getEngine=function(){var Fn={};return Fn[S]=o,Fn[k]=o,iy.call(Fn,ic,ti.engine),Fn},this.getOS=function(){var Fn={};return Fn[S]=o,Fn[k]=o,iy.call(Fn,ic,ti.os),!Fn[S]&&Nh&&Nh.platform!="Unknown"&&(Fn[S]=Nh.platform.replace(/chrome os/i,Qe).replace(/macos/i,$t)),Fn},this.getResult=function(){return{ua:this.getUA(),browser:this.getBrowser(),engine:this.getEngine(),os:this.getOS(),device:this.getDevice(),cpu:this.getCPU()}},this.getUA=function(){return ic},this.setUA=function(Fn){return ic=typeof Fn===m&&Fn.length>350?ap(Fn,350):Fn,this},this.setUA(ic),this};Cl.VERSION="0.7.34",Cl.BROWSER=tr([S,k,_]),Cl.CPU=tr([z]),Cl.DEVICE=tr([E,P,R,U,F,Y,q,le,ye]),Cl.ENGINE=Cl.OS=tr([S,k]),t.exports&&(r=t.exports=Cl),r.UAParser=Cl;var $m=typeof s!==u&&(s.jQuery||s.Zepto);if($m&&!$m.ua){var sy=new Cl;$m.ua=sy.getResult(),$m.ua.get=function(){return sy.getUA()},$m.ua.set=function(wi){sy.setUA(wi);var Ki=sy.getResult();for(var Sr in Ki)$m.ua[Sr]=Ki[Sr]}}})(typeof window=="object"?window:a)})(JD,JD.exports);var due=l(JD.exports),hue=Ec,fue=yi,pue=Ut,mue=eh,gue=hr("iterator"),_ue=Object,yue=function(t){if(pue(t))return!1;var r=_ue(t);return r[gue]!==void 0||"@@iterator"in r||fue(mue,hue(r))},Eue=l(yue),fB=QE.clear;Mn({global:!0,bind:!0,forced:j.clearImmediate!==fB},{clearImmediate:fB});var vue=typeof Bun=="function"&&Bun&&typeof Bun.version=="string",pB=j,Sue=ne,bue=Me,Tue=vue,wue=ir,Rue=_s,Cue=pl,Iue=pB.Function,Aue=/MSIE .\./.test(wue)||Tue&&function(){var t=pB.Bun.version.split(".");return t.length<3||t[0]==0&&(t[1]<3||t[1]==3&&t[2]==0)}(),Pue=Mn,mB=j,gB=QE.set,Oue=function(t,r){var s=1;return Aue?function(o,c){var u=Cue(arguments.length,1)>s,h=bue(o)?o:Iue(o),m=u?Rue(arguments,s):[],_=u?function(){Sue(h,this,m)}:h;return t(_)}:t},_B=mB.setImmediate?Oue(gB):gB;Pue({global:!0,bind:!0,forced:mB.setImmediate!==_B},{setImmediate:_B});var yB=l(bt.setImmediate),kue=Mn,Nue=Za,Due=hs,Lue=pl,xue=bf,Mue=j.process;kue({global:!0,dontCallGetSet:!0},{queueMicrotask:function(t){Lue(arguments.length,1),Due(t);var r=xue&&Mue.domain;Nue(r?r.bind(t):t)}});var EB=l(bt.queueMicrotask);function vB(t,r){return function(){return t.apply(r,arguments)}}const{toString:Uue}=Object.prototype,{getPrototypeOf:QD}=Object,cA=(ZD=Object.create(null),t=>{const r=Uue.call(t);return ZD[r]||(ZD[r]=r.slice(8,-1).toLowerCase())});var ZD;const ud=t=>(t=t.toLowerCase(),r=>cA(r)===t),lA=t=>r=>typeof r===t,{isArray:Tv}=Array,tT=lA("undefined"),SB=ud("ArrayBuffer"),Vue=lA("string"),gl=lA("function"),bB=lA("number"),uA=t=>t!==null&&typeof t=="object",dA=t=>{if(cA(t)!=="object")return!1;const r=QD(t);return!(r!==null&&r!==Object.prototype&&Object.getPrototypeOf(r)!==null||Symbol.toStringTag in t||Eue(t))},Fue=ud("Date"),jue=ud("File"),Bue=ud("Blob"),Wue=ud("FileList"),zue=ud("URLSearchParams"),[Gue,Hue,$ue,Kue]=["ReadableStream","Request","Response","Headers"].map(ud);function nT(t,r){let s,o,{allOwnKeys:c=!1}=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};if(t!=null)if(typeof t!="object"&&(t=[t]),Tv(t))for(s=0,o=t.length;s<o;s++)r.call(null,t[s],s,t);else{const u=c?Object.getOwnPropertyNames(t):Object.keys(t),h=u.length;let m;for(s=0;s<h;s++)m=u[s],r.call(null,t[m],m,t)}}function TB(t,r){r=r.toLowerCase();const s=Object.keys(t);let o,c=s.length;for(;c-- >0;)if(o=s[c],r===o.toLowerCase())return o;return null}const A_=hB!==void 0?hB:typeof self<"u"?self:typeof window<"u"?window:my,wB=t=>!tT(t)&&t!==A_,que=(eL=typeof Uint8Array<"u"&&QD(Uint8Array),t=>eL&&t instanceof eL);var eL;const Yue=ud("HTMLFormElement"),RB=(t=>{let{hasOwnProperty:r}=t;return(s,o)=>r.call(s,o)})(Object.prototype),Xue=ud("RegExp"),CB=(t,r)=>{const s=Object.getOwnPropertyDescriptors(t),o={};nT(s,(c,u)=>{let h;(h=r(c,u,t))!==!1&&(o[u]=h||c)}),Object.defineProperties(t,o)},tL="abcdefghijklmnopqrstuvwxyz",IB="0123456789",AB={DIGIT:IB,ALPHA:tL,ALPHA_DIGIT:tL+tL.toUpperCase()+IB},Jue=ud("AsyncFunction"),PB=(OB=typeof yB=="function",kB=gl(A_.postMessage),OB?yB:kB?(nL="axios@".concat(Math.random()),hA=[],A_.addEventListener("message",t=>{let{source:r,data:s}=t;r===A_&&s===nL&&hA.length&&hA.shift()()},!1),t=>{hA.push(t),A_.postMessage(nL,"*")}):t=>setTimeout(t));var OB,kB,nL,hA;const Que=EB!==void 0?EB.bind(A_):typeof process<"u"&&process.nextTick||PB;var ct={isArray:Tv,isArrayBuffer:SB,isBuffer:function(t){return t!==null&&!tT(t)&&t.constructor!==null&&!tT(t.constructor)&&gl(t.constructor.isBuffer)&&t.constructor.isBuffer(t)},isFormData:t=>{let r;return t&&(typeof FormData=="function"&&t instanceof FormData||gl(t.append)&&((r=cA(t))==="formdata"||r==="object"&&gl(t.toString)&&t.toString()==="[object FormData]"))},isArrayBufferView:function(t){let r;return r=typeof ArrayBuffer<"u"&&ArrayBuffer.isView?ArrayBuffer.isView(t):t&&t.buffer&&SB(t.buffer),r},isString:Vue,isNumber:bB,isBoolean:t=>t===!0||t===!1,isObject:uA,isPlainObject:dA,isReadableStream:Gue,isRequest:Hue,isResponse:$ue,isHeaders:Kue,isUndefined:tT,isDate:Fue,isFile:jue,isBlob:Bue,isRegExp:Xue,isFunction:gl,isStream:t=>uA(t)&&gl(t.pipe),isURLSearchParams:zue,isTypedArray:que,isFileList:Wue,forEach:nT,merge:function t(){const{caseless:r}=wB(this)&&this||{},s={},o=(c,u)=>{const h=r&&TB(s,u)||u;dA(s[h])&&dA(c)?s[h]=t(s[h],c):dA(c)?s[h]=t({},c):Tv(c)?s[h]=c.slice():s[h]=c};for(let c=0,u=arguments.length;c<u;c++)arguments[c]&&nT(arguments[c],o);return s},extend:function(t,r,s){let{allOwnKeys:o}=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{};return nT(r,(c,u)=>{s&&gl(c)?t[u]=vB(c,s):t[u]=c},{allOwnKeys:o}),t},trim:t=>eo(t)?eo(t).call(t):t.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,""),stripBOM:t=>(t.charCodeAt(0)===65279&&(t=t.slice(1)),t),inherits:(t,r,s,o)=>{t.prototype=Object.create(r.prototype,o),t.prototype.constructor=t,Object.defineProperty(t,"super",{value:r.prototype}),s&&Object.assign(t.prototype,s)},toFlatObject:(t,r,s,o)=>{let c,u,h;const m={};if(r=r||{},t==null)return r;do{for(c=Object.getOwnPropertyNames(t),u=c.length;u-- >0;)h=c[u],o&&!o(h,t,r)||m[h]||(r[h]=t[h],m[h]=!0);t=s!==!1&&QD(t)}while(t&&(!s||s(t,r))&&t!==Object.prototype);return r},kindOf:cA,kindOfTest:ud,endsWith:(t,r,s)=>{t=String(t),(s===void 0||s>t.length)&&(s=t.length),s-=r.length;const o=t.indexOf(r,s);return o!==-1&&o===s},toArray:t=>{if(!t)return null;if(Tv(t))return t;let r=t.length;if(!bB(r))return null;const s=new Array(r);for(;r-- >0;)s[r]=t[r];return s},forEachEntry:(t,r)=>{const s=(t&&t[Symbol.iterator]).call(t);let o;for(;(o=s.next())&&!o.done;){const c=o.value;r.call(t,c[0],c[1])}},matchAll:(t,r)=>{let s;const o=[];for(;(s=t.exec(r))!==null;)o.push(s);return o},isHTMLForm:Yue,hasOwnProperty:RB,hasOwnProp:RB,reduceDescriptors:CB,freezeMethods:t=>{CB(t,(r,s)=>{if(gl(t)&&["arguments","caller","callee"].indexOf(s)!==-1)return!1;const o=t[s];gl(o)&&(r.enumerable=!1,"writable"in r?r.writable=!1:r.set||(r.set=()=>{throw Error("Can not rewrite read-only method '"+s+"'")}))})},toObjectSet:(t,r)=>{const s={},o=c=>{c.forEach(u=>{s[u]=!0})};return Tv(t)?o(t):o(String(t).split(r)),s},toCamelCase:t=>t.toLowerCase().replace(/[-_\s]([a-z\d])(\w*)/g,function(r,s,o){return s.toUpperCase()+o}),noop:()=>{},toFiniteNumber:(t,r)=>t!=null&&Number.isFinite(t=+t)?t:r,findKey:TB,global:A_,isContextDefined:wB,ALPHABET:AB,generateString:function(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:16,r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:AB.ALPHA_DIGIT,s="";const{length:o}=r;for(;t--;)s+=r[Math.random()*o|0];return s},isSpecCompliantForm:function(t){return!!(t&&gl(t.append)&&t[Symbol.toStringTag]==="FormData"&&t[Symbol.iterator])},toJSONObject:t=>{const r=new Array(10),s=(o,c)=>{if(uA(o)){if(r.indexOf(o)>=0)return;if(!("toJSON"in o)){r[c]=o;const u=Tv(o)?[]:{};return nT(o,(h,m)=>{const _=s(h,c+1);!tT(_)&&(u[m]=_)}),r[c]=void 0,u}}return o};return s(t,0)},isAsyncFn:Jue,isThenable:t=>t&&(uA(t)||gl(t))&&gl(t.then)&&gl(t.catch),setImmediate:PB,asap:Que};function Zn(t,r,s,o,c){Error.call(this),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=new Error().stack,this.message=t,this.name="AxiosError",r&&(this.code=r),s&&(this.config=s),o&&(this.request=o),c&&(this.response=c,this.status=c.status?c.status:null)}ct.inherits(Zn,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:ct.toJSONObject(this.config),code:this.code,status:this.status}}});const NB=Zn.prototype,DB={};["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED","ERR_NOT_SUPPORT","ERR_INVALID_URL"].forEach(t=>{DB[t]={value:t}}),Object.defineProperties(Zn,DB),Object.defineProperty(NB,"isAxiosError",{value:!0}),Zn.from=(t,r,s,o,c,u)=>{const h=Object.create(NB);return ct.toFlatObject(t,h,function(m){return m!==Error.prototype},m=>m!=="isAxiosError"),Zn.call(h,t.message,r,s,o,c),h.cause=t,h.name=t.name,u&&Object.assign(h,u),h};function rL(t){return ct.isPlainObject(t)||ct.isArray(t)}function LB(t){return ct.endsWith(t,"[]")?t.slice(0,-2):t}function xB(t,r,s){return t?t.concat(r).map(function(o,c){return o=LB(o),!s&&c?"["+o+"]":o}).join(s?".":""):r}const Zue=ct.toFlatObject(ct,{},null,function(t){return/^is[A-Z]/.test(t)});function fA(t,r,s){if(!ct.isObject(t))throw new TypeError("target must be an object");r=r||new FormData;const o=(s=ct.toFlatObject(s,{metaTokens:!0,dots:!1,indexes:!1},!1,function(P,k){return!ct.isUndefined(k[P])})).metaTokens,c=s.visitor||E,u=s.dots,h=s.indexes,m=(s.Blob||typeof Blob<"u"&&Blob)&&ct.isSpecCompliantForm(r);if(!ct.isFunction(c))throw new TypeError("visitor must be a function");function _(P){if(P===null)return"";if(ct.isDate(P))return P.toISOString();if(!m&&ct.isBlob(P))throw new Zn("Blob is not supported. Use a Buffer instead.");return ct.isArrayBuffer(P)||ct.isTypedArray(P)?m&&typeof Blob=="function"?new Blob([P]):Buffer.from(P):P}function E(P,k,z){let U=P;if(P&&!z&&typeof P=="object"){if(ct.endsWith(k,"{}"))k=o?k:k.slice(0,-2),P=JSON.stringify(P);else if(ct.isArray(P)&&function(F){return ct.isArray(F)&&!F.some(rL)}(P)||(ct.isFileList(P)||ct.endsWith(k,"[]"))&&(U=ct.toArray(P)))return k=LB(k),U.forEach(function(F,q){!ct.isUndefined(F)&&F!==null&&r.append(h===!0?xB([k],q,u):h===null?k:k+"[]",_(F))}),!1}return!!rL(P)||(r.append(xB(z,k,u),_(P)),!1)}const S=[],R=Object.assign(Zue,{defaultVisitor:E,convertValue:_,isVisitable:rL});if(!ct.isObject(t))throw new TypeError("data must be an object");return function P(k,z){if(!ct.isUndefined(k)){if(S.indexOf(k)!==-1)throw Error("Circular reference detected in "+z.join("."));S.push(k),ct.forEach(k,function(U,F){(!(ct.isUndefined(U)||U===null)&&c.call(r,U,ct.isString(F)?eo(F).call(F):F,z,R))===!0&&P(U,z?z.concat(F):[F])}),S.pop()}}(t),r}function MB(t){const r={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+","%00":"\0"};return encodeURIComponent(t).replace(/[!'()~]|%20|%00/g,function(s){return r[s]})}function iL(t,r){this._pairs=[],t&&fA(t,this,r)}const UB=iL.prototype;function ede(t){return encodeURIComponent(t).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}function VB(t,r,s){if(!r)return t;const o=s&&s.encode||ede;ct.isFunction(s)&&(s={serialize:s});const c=s&&s.serialize;let u;if(u=c?c(r,s):ct.isURLSearchParams(r)?r.toString():new iL(r,s).toString(o),u){const h=t.indexOf("#");h!==-1&&(t=t.slice(0,h)),t+=(t.indexOf("?")===-1?"?":"&")+u}return t}UB.append=function(t,r){this._pairs.push([t,r])},UB.toString=function(t){const r=t?function(s){return t.call(this,s,MB)}:MB;return this._pairs.map(function(s){return r(s[0])+"="+r(s[1])},"").join("&")};var FB=class{constructor(){this.handlers=[]}use(t,r,s){return this.handlers.push({fulfilled:t,rejected:r,synchronous:!!s&&s.synchronous,runWhen:s?s.runWhen:null}),this.handlers.length-1}eject(t){this.handlers[t]&&(this.handlers[t]=null)}clear(){this.handlers&&(this.handlers=[])}forEach(t){ct.forEach(this.handlers,function(r){r!==null&&t(r)})}},jB={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},BB={exports:{}},tde=Mn,nde=rt,WB=tt.f;tde({target:"Object",stat:!0,forced:Object.defineProperty!==WB,sham:!nde},{defineProperty:WB});var zB=bt.Object,rde=BB.exports=function(t,r,s){return zB.defineProperty(t,r,s)};zB.defineProperty.sham&&(rde.sham=!0);var GB=l(BB.exports),ide=TypeError,HB=$g,sde=m_,ode=Et,ade=hr("species"),$B=Array,cde=function(t){var r;return HB(t)&&(r=t.constructor,(sde(r)&&(r===$B||HB(r.prototype))||ode(r)&&(r=r[ade])===null)&&(r=void 0)),r===void 0?$B:r},KB=function(t,r){return new(cde(t))(r===0?0:r)},lde=d,ude=dr,dde=hr("species"),qB=function(t){return ude>=51||!lde(function(){var r=[];return(r.constructor={})[dde]=function(){return{foo:1}},r[t](Boolean).foo!==1})},hde=Mn,fde=d,pde=$g,mde=Et,gde=Po,_de=oi,YB=function(t){if(t>9007199254740991)throw ide("Maximum allowed index exceeded");return t},XB=zI,yde=KB,Ede=qB,vde=dr,JB=hr("isConcatSpreadable"),Sde=vde>=51||!fde(function(){var t=[];return t[JB]=!1,t.concat()[0]!==t}),bde=function(t){if(!mde(t))return!1;var r=t[JB];return r!==void 0?!!r:pde(t)};hde({target:"Array",proto:!0,forced:!Sde||!Ede("concat")},{concat:function(t){var r,s,o,c,u,h=gde(this),m=yde(h,0),_=0;for(r=-1,o=arguments.length;r<o;r++)if(bde(u=r===-1?h:arguments[r]))for(c=_de(u),YB(_+c),s=0;s<c;s++,_++)s in u&&XB(m,_,u[s]);else YB(_+1),XB(m,_++,u);return m.length=_,m}});var QB={},Tde=te,wde=Re,ZB=Jd.f,Rde=aD,e6=typeof window=="object"&&window&&Object.getOwnPropertyNames?Object.getOwnPropertyNames(window):[];QB.f=function(t){return e6&&Tde(t)=="Window"?function(r){try{return ZB(r)}catch{return Rde(e6)}}(t):ZB(wde(t))};var wv={},Cde=hr;wv.f=Cde;var t6=bt,Ide=yi,Ade=wv,Pde=tt.f,vs=function(t){var r=t6.Symbol||(t6.Symbol={});Ide(r,t)||Pde(r,t,{value:Ade.f(t)})},Ode=ve,kde=an,Nde=hr,Dde=nd,n6=function(){var t=kde("Symbol"),r=t&&t.prototype,s=r&&r.valueOf,o=Nde("toPrimitive");r&&!r[o]&&Dde(r,o,function(c){return Ode(s,this)},{})},Lde=De,xde=hn,Mde=Po,Ude=oi,Vde=KB,r6=A([].push),Fde=function(t){var r=t==1,s=t==2,o=t==3,c=t==4,u=t==6,h=t==7,m=t==5||u;return function(_,E,S,R){for(var P,k,z=Mde(_),U=xde(z),F=Lde(E,S),q=Ude(U),Y=0,le=R||Vde,ye=r?le(_,q):s||h?le(_,0):void 0;q>Y;Y++)if((m||Y in U)&&(k=F(P=U[Y],Y,z),t))if(r)ye[Y]=k;else if(k)switch(t){case 3:return!0;case 5:return P;case 6:return Y;case 2:r6(ye,P)}else switch(t){case 4:return!1;case 7:r6(ye,P)}return u?-1:o||c?c:ye}},i6={forEach:Fde(0)},pA=Mn,sL=j,oL=ve,jde=A,Rv=rt,Cv=ho,Bde=d,Eo=yi,Wde=N,aL=cn,mA=Re,cL=$a,zde=_a,lL=et,rT=Bo,s6=bc,Gde=Jd,o6=QB,Hde=Sc,a6=He,c6=tt,$de=dE,l6=Ne,u6=nd,Kde=UE,uL=Ga,d6=vc,h6=Gd,qde=hr,Yde=wv,Xde=vs,Jde=n6,Qde=rd,f6=td,gA=i6.forEach,kc=qg("hidden"),_A="Symbol",iT="prototype",Zde=f6.set,p6=f6.getterFor(_A),dd=Object[iT],P_=sL.Symbol,yA=P_&&P_[iT],ehe=sL.TypeError,dL=sL.QObject,m6=a6.f,O_=c6.f,g6=o6.f,the=l6.f,_6=jde([].push),Hf=uL("symbols"),sT=uL("op-symbols"),nhe=uL("wks"),hL=!dL||!dL[iT]||!dL[iT].findChild,fL=Rv&&Bde(function(){return rT(O_({},"a",{get:function(){return O_(this,"a",{value:7}).a}})).a!=7})?function(t,r,s){var o=m6(dd,r);o&&delete dd[r],O_(t,r,s),o&&t!==dd&&O_(dd,r,o)}:O_,pL=function(t,r){var s=Hf[t]=rT(yA);return Zde(s,{type:_A,tag:t,description:r}),Rv||(s.description=r),s},EA=function(t,r,s){t===dd&&EA(sT,r,s),aL(t);var o=cL(r);return aL(s),Eo(Hf,o)?(s.enumerable?(Eo(t,kc)&&t[kc][o]&&(t[kc][o]=!1),s=rT(s,{enumerable:lL(0,!1)})):(Eo(t,kc)||O_(t,kc,lL(1,{})),t[kc][o]=!0),fL(t,o,s)):O_(t,o,s)},mL=function(t,r){aL(t);var s=mA(r),o=s6(s).concat(S6(s));return gA(o,function(c){Rv&&!oL(y6,s,c)||EA(t,c,s[c])}),t},y6=function(t){var r=cL(t),s=oL(the,this,r);return!(this===dd&&Eo(Hf,r)&&!Eo(sT,r))&&(!(s||!Eo(this,r)||!Eo(Hf,r)||Eo(this,kc)&&this[kc][r])||s)},E6=function(t,r){var s=mA(t),o=cL(r);if(s!==dd||!Eo(Hf,o)||Eo(sT,o)){var c=m6(s,o);return!c||!Eo(Hf,o)||Eo(s,kc)&&s[kc][o]||(c.enumerable=!0),c}},v6=function(t){var r=g6(mA(t)),s=[];return gA(r,function(o){Eo(Hf,o)||Eo(d6,o)||_6(s,o)}),s},S6=function(t){var r=t===dd,s=g6(r?sT:mA(t)),o=[];return gA(s,function(c){!Eo(Hf,c)||r&&!Eo(dd,c)||_6(o,Hf[c])}),o};Cv||(P_=function(){if(Wde(yA,this))throw ehe("Symbol is not a constructor");var t=arguments.length&&arguments[0]!==void 0?zde(arguments[0]):void 0,r=h6(t),s=function(o){this===dd&&oL(s,sT,o),Eo(this,kc)&&Eo(this[kc],r)&&(this[kc][r]=!1),fL(this,r,lL(1,o))};return Rv&&hL&&fL(dd,r,{configurable:!0,set:s}),pL(r,t)},u6(yA=P_[iT],"toString",function(){return p6(this).tag}),u6(P_,"withoutSetter",function(t){return pL(h6(t),t)}),l6.f=y6,c6.f=EA,$de.f=mL,a6.f=E6,Gde.f=o6.f=v6,Hde.f=S6,Yde.f=function(t){return pL(qde(t),t)},Rv&&Kde(yA,"description",{configurable:!0,get:function(){return p6(this).description}})),pA({global:!0,wrap:!0,forced:!Cv,sham:!Cv},{Symbol:P_}),gA(s6(nhe),function(t){Xde(t)}),pA({target:_A,stat:!0,forced:!Cv},{useSetter:function(){hL=!0},useSimple:function(){hL=!1}}),pA({target:"Object",stat:!0,forced:!Cv,sham:!Rv},{create:function(t,r){return r===void 0?rT(t):mL(rT(t),r)},defineProperty:EA,defineProperties:mL,getOwnPropertyDescriptor:E6}),pA({target:"Object",stat:!0,forced:!Cv},{getOwnPropertyNames:v6}),Jde(),Qde(P_,_A),d6[kc]=!0;var b6=ho&&!!Symbol.for&&!!Symbol.keyFor,rhe=Mn,ihe=an,she=yi,ohe=_a,T6=Ga,ahe=b6,gL=T6("string-to-symbol-registry"),che=T6("symbol-to-string-registry");rhe({target:"Symbol",stat:!0,forced:!ahe},{for:function(t){var r=ohe(t);if(she(gL,r))return gL[r];var s=ihe("Symbol")(r);return gL[r]=s,che[s]=r,s}});var lhe=Mn,uhe=yi,dhe=sl,hhe=hc,fhe=b6,w6=Ga("symbol-to-string-registry");lhe({target:"Symbol",stat:!0,forced:!fhe},{keyFor:function(t){if(!dhe(t))throw TypeError(hhe(t)+" is not a symbol");if(uhe(w6,t))return w6[t]}});var R6=$g,phe=Me,C6=te,mhe=_a,I6=A([].push),ghe=Mn,A6=an,P6=ne,_he=ve,oT=A,O6=d,k6=Me,N6=sl,D6=_s,yhe=function(t){if(phe(t))return t;if(R6(t)){for(var r=t.length,s=[],o=0;o<r;o++){var c=t[o];typeof c=="string"?I6(s,c):typeof c!="number"&&C6(c)!="Number"&&C6(c)!="String"||I6(s,mhe(c))}var u=s.length,h=!0;return function(m,_){if(h)return h=!1,_;if(R6(this))return _;for(var E=0;E<u;E++)if(s[E]===m)return _}}},Ehe=ho,vhe=String,Cm=A6("JSON","stringify"),vA=oT(/./.exec),L6=oT("".charAt),She=oT("".charCodeAt),bhe=oT("".replace),The=oT(1 .toString),whe=/[\uD800-\uDFFF]/g,x6=/^[\uD800-\uDBFF]$/,M6=/^[\uDC00-\uDFFF]$/,U6=!Ehe||O6(function(){var t=A6("Symbol")();return Cm([t])!="[null]"||Cm({a:t})!="{}"||Cm(Object(t))!="{}"}),V6=O6(function(){return Cm("\uDF06\uD834")!=='"\\udf06\\ud834"'||Cm("\uDEAD")!=='"\\udead"'}),Rhe=function(t,r){var s=D6(arguments),o=yhe(r);if(k6(o)||t!==void 0&&!N6(t))return s[1]=function(c,u){if(k6(o)&&(u=_he(o,this,vhe(c),u)),!N6(u))return u},P6(Cm,null,s)},Che=function(t,r,s){var o=L6(s,r-1),c=L6(s,r+1);return vA(x6,t)&&!vA(M6,c)||vA(M6,t)&&!vA(x6,o)?"\\u"+The(She(t,0),16):t};Cm&&ghe({target:"JSON",stat:!0,forced:U6||V6},{stringify:function(t,r,s){var o=D6(arguments),c=P6(U6?Rhe:Cm,null,o);return V6&&typeof c=="string"?bhe(c,whe,Che):c}});var F6=Sc,Ihe=Po;Mn({target:"Object",stat:!0,forced:!ho||d(function(){F6.f(1)})},{getOwnPropertySymbols:function(t){var r=F6.f;return r?r(Ihe(t)):[]}}),vs("asyncIterator"),vs("hasInstance"),vs("isConcatSpreadable"),vs("iterator"),vs("match"),vs("matchAll"),vs("replace"),vs("search"),vs("species"),vs("split");var Ahe=n6;vs("toPrimitive"),Ahe();var Phe=an,Ohe=rd;vs("toStringTag"),Ohe(Phe("Symbol"),"Symbol"),vs("unscopables"),rd(j.JSON,"JSON",!0);var khe=bt.Symbol,Nhe=hr,Dhe=tt.f,j6=Nhe("metadata"),B6=Function.prototype;B6[j6]===void 0&&Dhe(B6,j6,{value:null}),vs("dispose"),vs("metadata");var Lhe=khe;vs("asyncDispose");var xhe=A,_L=an("Symbol"),Mhe=_L.keyFor,Uhe=xhe(_L.prototype.valueOf),W6=_L.isRegisteredSymbol||function(t){try{return Mhe(Uhe(t))!==void 0}catch{return!1}};Mn({target:"Symbol",stat:!0},{isRegisteredSymbol:W6});for(var Vhe=Ga,z6=an,Fhe=A,jhe=sl,Bhe=hr,SA=z6("Symbol"),G6=SA.isWellKnownSymbol,H6=z6("Object","getOwnPropertyNames"),Whe=Fhe(SA.prototype.valueOf),$6=Vhe("wks"),yL=0,K6=H6(SA),zhe=K6.length;yL<zhe;yL++)try{var q6=K6[yL];jhe(SA[q6])&&Bhe(q6)}catch{}var Y6=function(t){if(G6&&G6(t))return!0;try{for(var r=Whe(t),s=0,o=H6($6),c=o.length;s<c;s++)if($6[o[s]]==r)return!0}catch{}return!1};Mn({target:"Symbol",stat:!0,forced:!0},{isWellKnownSymbol:Y6}),vs("matcher"),vs("observable"),Mn({target:"Symbol",stat:!0},{isRegistered:W6}),Mn({target:"Symbol",stat:!0,forced:!0},{isWellKnown:Y6}),vs("metadataKey"),vs("patternMatch"),vs("replaceAll");var Iv=l(Lhe),X6=l(wv.f("iterator"));function aT(t){return aT=typeof Iv=="function"&&typeof X6=="symbol"?function(r){return typeof r}:function(r){return r&&typeof Iv=="function"&&r.constructor===Iv&&r!==Iv.prototype?"symbol":typeof r},aT(t)}var Ghe=l(wv.f("toPrimitive"));function Hhe(t){var r=function(s,o){if(aT(s)!=="object"||s===null)return s;var c=s[Ghe];if(c!==void 0){var u=c.call(s,o);if(aT(u)!=="object")return u;throw new TypeError("@@toPrimitive must return a primitive value.")}return(o==="string"?String:Number)(s)}(t,"string");return aT(r)==="symbol"?r:String(r)}function $(t,r,s){return(r=Hhe(r))in t?GB(t,r,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[r]=s,t}var J6=l(Rce),$he={isBrowser:!0,classes:{URLSearchParams:J6!==void 0?J6:iL,FormData:typeof FormData<"u"?FormData:null,Blob:typeof Blob<"u"?Blob:null},protocols:["http","https","file","blob","url","data"]};const EL=typeof window<"u"&&typeof document<"u",vL=typeof navigator=="object"&&navigator||void 0,Khe=EL&&(!vL||["ReactNative","NativeScript","NS"].indexOf(vL.product)<0),qhe=typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope&&typeof self.importScripts=="function",Yhe=EL&&window.location.href||"http://localhost";function Q6(t,r){var s=Object.keys(t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);r&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(t,c).enumerable})),s.push.apply(s,o)}return s}function Z6(t){for(var r=1;r<arguments.length;r++){var s=arguments[r]!=null?arguments[r]:{};r%2?Q6(Object(s),!0).forEach(function(o){$(t,o,s[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(s)):Q6(Object(s)).forEach(function(o){Object.defineProperty(t,o,Object.getOwnPropertyDescriptor(s,o))})}return t}var Ra=Z6(Z6({},Object.freeze({__proto__:null,hasBrowserEnv:EL,hasStandardBrowserEnv:Khe,hasStandardBrowserWebWorkerEnv:qhe,navigator:vL,origin:Yhe})),$he),Xhe=cn,Jhe=ve,Qhe=yi,Zhe=N,efe=function(){var t=Xhe(this),r="";return t.hasIndices&&(r+="d"),t.global&&(r+="g"),t.ignoreCase&&(r+="i"),t.multiline&&(r+="m"),t.dotAll&&(r+="s"),t.unicode&&(r+="u"),t.unicodeSets&&(r+="v"),t.sticky&&(r+="y"),r},eW=RegExp.prototype,tW=function(t){var r=t.flags;return r!==void 0||"flags"in eW||Qhe(t,"flags")||!Zhe(eW,t)?r:Jhe(efe,t)},tfe=nD.charAt,nW=ve,nfe=cn,rfe=Me,ife=te,sfe=/./.exec,ofe=TypeError,afe=Mn,rW=ve,iW=se,cfe=PE,bA=LE,sW=Xt,oW=xt,cT=_a,lfe=cn,ufe=Ut,dfe=te,hfe=TC,aW=tW,ffe=fc,pfe=d,mfe=Qi,gfe=function(t,r,s){return r+(s?tfe(t,r).length:1)},_fe=function(t,r){var s=t.exec;if(rfe(s)){var o=nW(s,t,r);return o!==null&&nfe(o),o}if(ife(t)==="RegExp")return nW(sfe,t,r);throw ofe("RegExp#exec called on incompatible receiver")},cW=td,yfe=hr("matchAll"),lW="RegExp String",uW=lW+" Iterator",Efe=cW.set,vfe=cW.getterFor(uW),Sfe=TypeError,SL=iW("".indexOf),TA=iW("".matchAll),bL=!!TA&&!pfe(function(){TA("a",/./)}),bfe=cfe(function(t,r,s,o){Efe(this,{type:uW,regexp:t,string:r,global:s,unicode:o,done:!1})},lW,function(){var t=vfe(this);if(t.done)return bA(void 0,!0);var r=t.regexp,s=t.string,o=_fe(r,s);return o===null?(t.done=!0,bA(void 0,!0)):t.global?(cT(o[0])===""&&(r.lastIndex=gfe(s,oW(r.lastIndex),t.unicode)),bA(o,!1)):(t.done=!0,bA(o,!1))}),dW=function(t){var r,s,o,c=lfe(this),u=cT(t),h=mfe(c,RegExp),m=cT(aW(c));return r=new h(h===RegExp?c.source:c,m),s=!!~SL(m,"g"),o=!!~SL(m,"u"),r.lastIndex=oW(c.lastIndex),new bfe(r,u,s,o)};afe({target:"String",proto:!0,forced:bL},{matchAll:function(t){var r,s,o,c,u=sW(this);if(ufe(t)){if(bL)return TA(u,t)}else{if(hfe(t)&&(r=cT(sW(aW(t))),!~SL(r,"g")))throw Sfe("`.matchAll` does not allow non-global regexes");if(bL)return TA(u,t);if((o=ffe(t,yfe))===void 0&&dfe(t)=="RegExp"&&(o=dW),o)return rW(o,t,u)}return s=cT(u),c=new RegExp(t,"g"),rW(dW,c,s)}});var Tfe=qa("String").matchAll,wfe=N,Rfe=Tfe,TL=String.prototype,Cfe=function(t){var r=t.matchAll;return typeof t=="string"||t===TL||wfe(TL,t)&&r===TL.matchAll?Rfe:r},Ife=l(Cfe);function hW(t){function r(s,o,c,u){let h=s[u++];if(h==="__proto__")return!0;const m=Number.isFinite(+h),_=u>=s.length;return h=!h&&ct.isArray(c)?c.length:h,_?(ct.hasOwnProp(c,h)?c[h]=[c[h],o]:c[h]=o,!m):(c[h]&&ct.isObject(c[h])||(c[h]=[]),r(s,o,c[h],u)&&ct.isArray(c[h])&&(c[h]=function(E){const S={},R=Object.keys(E);let P;const k=R.length;let z;for(P=0;P<k;P++)z=R[P],S[z]=E[z];return S}(c[h])),!m)}if(ct.isFormData(t)&&ct.isFunction(t.entries)){const s={};return ct.forEachEntry(t,(o,c)=>{r(function(u){return Ife(ct).call(ct,/\w+|\[(\w*)]/g,u).map(h=>h[0]==="[]"?"":h[1]||h[0])}(o),c,s,0)}),s}return null}const wL={transitional:jB,adapter:["xhr","http","fetch"],transformRequest:[function(t,r){const s=r.getContentType()||"",o=s.indexOf("application/json")>-1,c=ct.isObject(t);if(c&&ct.isHTMLForm(t)&&(t=new FormData(t)),ct.isFormData(t))return o?JSON.stringify(hW(t)):t;if(ct.isArrayBuffer(t)||ct.isBuffer(t)||ct.isStream(t)||ct.isFile(t)||ct.isBlob(t)||ct.isReadableStream(t))return t;if(ct.isArrayBufferView(t))return t.buffer;if(ct.isURLSearchParams(t))return r.setContentType("application/x-www-form-urlencoded;charset=utf-8",!1),t.toString();let u;if(c){if(s.indexOf("application/x-www-form-urlencoded")>-1)return function(h,m){return fA(h,new Ra.classes.URLSearchParams,Object.assign({visitor:function(_,E,S,R){return Ra.isNode&&ct.isBuffer(_)?(this.append(E,_.toString("base64")),!1):R.defaultVisitor.apply(this,arguments)}},m))}(t,this.formSerializer).toString();if((u=ct.isFileList(t))||s.indexOf("multipart/form-data")>-1){const h=this.env&&this.env.FormData;return fA(u?{"files[]":t}:t,h&&new h,this.formSerializer)}}return c||o?(r.setContentType("application/json",!1),function(h,m,_){if(ct.isString(h))try{return(m||JSON.parse)(h),eo(ct).call(ct,h)}catch(E){if(E.name!=="SyntaxError")throw E}return(_||JSON.stringify)(h)}(t)):t}],transformResponse:[function(t){const r=this.transitional||wL.transitional,s=r&&r.forcedJSONParsing,o=this.responseType==="json";if(ct.isResponse(t)||ct.isReadableStream(t))return t;if(t&&ct.isString(t)&&(s&&!this.responseType||o)){const c=!(r&&r.silentJSONParsing)&&o;try{return JSON.parse(t)}catch(u){if(c)throw u.name==="SyntaxError"?Zn.from(u,Zn.ERR_BAD_RESPONSE,this,null,this.response):u}}return t}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:Ra.classes.FormData,Blob:Ra.classes.Blob},validateStatus:function(t){return t>=200&&t<300},headers:{common:{Accept:"application/json, text/plain, */*","Content-Type":void 0}}};ct.forEach(["delete","get","head","post","put","patch"],t=>{wL.headers[t]={}});var RL=wL;const Afe=ct.toObjectSet(["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"]),fW=Symbol("internals");function lT(t){var r;return t&&eo(r=String(t)).call(r).toLowerCase()}function wA(t){return t===!1||t==null?t:ct.isArray(t)?t.map(wA):String(t)}function CL(t,r,s,o,c){return ct.isFunction(o)?o.call(this,r,s):(c&&(r=s),ct.isString(r)?ct.isString(o)?r.indexOf(o)!==-1:ct.isRegExp(o)?o.test(r):void 0:void 0)}class RA{constructor(r){r&&this.set(r)}set(r,s,o){const c=this;function u(_,E,S){const R=lT(E);if(!R)throw new Error("header name must be a non-empty string");const P=ct.findKey(c,R);(!P||c[P]===void 0||S===!0||S===void 0&&c[P]!==!1)&&(c[P||E]=wA(_))}const h=(_,E)=>ct.forEach(_,(S,R)=>u(S,R,E));if(ct.isPlainObject(r)||r instanceof this.constructor)h(r,s);else if(ct.isString(r)&&(r=eo(r).call(r))&&!/^[-_a-zA-Z0-9^`|~,!#$%&'*+.]+$/.test(eo(m=r).call(m)))h((_=>{const E={};let S,R,P;return _&&_.split(`
`).forEach(function(k){var z,U;P=k.indexOf(":"),S=eo(z=k.substring(0,P)).call(z).toLowerCase(),R=eo(U=k.substring(P+1)).call(U),!S||E[S]&&Afe[S]||(S==="set-cookie"?E[S]?E[S].push(R):E[S]=[R]:E[S]=E[S]?E[S]+", "+R:R)}),E})(r),s);else if(ct.isHeaders(r))for(const[_,E]of r.entries())u(E,_,o);else r!=null&&u(s,r,o);var m;return this}get(r,s){if(r=lT(r)){const o=ct.findKey(this,r);if(o){const c=this[o];if(!s)return c;if(s===!0)return function(u){const h=Object.create(null),m=/([^\s,;=]+)\s*(?:=\s*([^,;]+))?/g;let _;for(;_=m.exec(u);)h[_[1]]=_[2];return h}(c);if(ct.isFunction(s))return s.call(this,c,o);if(ct.isRegExp(s))return s.exec(c);throw new TypeError("parser must be boolean|regexp|function")}}}has(r,s){if(r=lT(r)){const o=ct.findKey(this,r);return!(!o||this[o]===void 0||s&&!CL(0,this[o],o,s))}return!1}delete(r,s){const o=this;let c=!1;function u(h){if(h=lT(h)){const m=ct.findKey(o,h);!m||s&&!CL(0,o[m],m,s)||(delete o[m],c=!0)}}return ct.isArray(r)?r.forEach(u):u(r),c}clear(r){const s=Object.keys(this);let o=s.length,c=!1;for(;o--;){const u=s[o];r&&!CL(0,this[u],u,r,!0)||(delete this[u],c=!0)}return c}normalize(r){const s=this,o={};return ct.forEach(this,(c,u)=>{var h;const m=ct.findKey(o,u);if(m)return s[m]=wA(c),void delete s[u];const _=r?function(E){return eo(E).call(E).toLowerCase().replace(/([a-z\d])(\w*)/g,(S,R,P)=>R.toUpperCase()+P)}(u):eo(h=String(u)).call(h);_!==u&&delete s[u],s[_]=wA(c),o[_]=!0}),this}concat(){for(var r=arguments.length,s=new Array(r),o=0;o<r;o++)s[o]=arguments[o];return this.constructor.concat(this,...s)}toJSON(r){const s=Object.create(null);return ct.forEach(this,(o,c)=>{o!=null&&o!==!1&&(s[c]=r&&ct.isArray(o)?o.join(", "):o)}),s}[Symbol.iterator](){return Object.entries(this.toJSON())[Symbol.iterator]()}toString(){return Object.entries(this.toJSON()).map(r=>{let[s,o]=r;return s+": "+o}).join(`
`)}get[Symbol.toStringTag](){return"AxiosHeaders"}static from(r){return r instanceof this?r:new this(r)}static concat(r){const s=new this(r);for(var o=arguments.length,c=new Array(o>1?o-1:0),u=1;u<o;u++)c[u-1]=arguments[u];return c.forEach(h=>s.set(h)),s}static accessor(r){const s=(this[fW]=this[fW]={accessors:{}}).accessors,o=this.prototype;function c(u){const h=lT(u);s[h]||(function(m,_){const E=ct.toCamelCase(" "+_);["get","set","has"].forEach(S=>{Object.defineProperty(m,S+E,{value:function(R,P,k){return this[S].call(this,_,R,P,k)},configurable:!0})})}(o,u),s[h]=!0)}return ct.isArray(r)?r.forEach(c):c(r),this}}RA.accessor(["Content-Type","Content-Length","Accept","Accept-Encoding","User-Agent","Authorization"]),ct.reduceDescriptors(RA.prototype,(t,r)=>{let{value:s}=t,o=r[0].toUpperCase()+r.slice(1);return{get:()=>s,set(c){this[o]=c}}}),ct.freezeMethods(RA);var hd=RA;function IL(t,r){const s=this||RL,o=r||s,c=hd.from(o.headers);let u=o.data;return ct.forEach(t,function(h){u=h.call(s,u,c.normalize(),r?r.status:void 0)}),c.normalize(),u}function pW(t){return!(!t||!t.__CANCEL__)}function Av(t,r,s){Zn.call(this,t??"canceled",Zn.ERR_CANCELED,r,s),this.name="CanceledError"}function mW(t,r,s){const o=s.config.validateStatus;s.status&&o&&!o(s.status)?r(new Zn("Request failed with status code "+s.status,[Zn.ERR_BAD_REQUEST,Zn.ERR_BAD_RESPONSE][Math.floor(s.status/100)-4],s.config,s.request,s)):t(s)}ct.inherits(Av,Zn,{__CANCEL__:!0});const CA=function(t,r){let s=arguments.length>2&&arguments[2]!==void 0?arguments[2]:3,o=0;const c=function(u,h){u=u||10;const m=new Array(u),_=new Array(u);let E,S=0,R=0;return h=h!==void 0?h:1e3,function(P){const k=Date.now(),z=_[R];E||(E=k),m[S]=P,_[S]=k;let U=R,F=0;for(;U!==S;)F+=m[U++],U%=u;if(S=(S+1)%u,S===R&&(R=(R+1)%u),k-E<h)return;const q=z&&k-z;return q?Math.round(1e3*F/q):void 0}}(50,250);return function(u,h){let m,_,E=0,S=1e3/h;const R=function(P){E=arguments.length>1&&arguments[1]!==void 0?arguments[1]:Date.now(),m=null,_&&(clearTimeout(_),_=null),u.apply(null,P)};return[function(){const P=Date.now(),k=P-E;for(var z=arguments.length,U=new Array(z),F=0;F<z;F++)U[F]=arguments[F];k>=S?R(U,P):(m=U,_||(_=setTimeout(()=>{_=null,R(m)},S-k)))},()=>m&&R(m)]}(u=>{const h=u.loaded,m=u.lengthComputable?u.total:void 0,_=h-o,E=c(_);o=h,t({loaded:h,total:m,progress:m?h/m:void 0,bytes:_,rate:E||void 0,estimated:E&&m&&h<=m?(m-h)/E:void 0,event:u,lengthComputable:m!=null,[r?"download":"upload"]:!0})},s)},gW=(t,r)=>{const s=t!=null;return[o=>r[0]({lengthComputable:s,total:t,loaded:o}),r[1]]},_W=t=>function(){for(var r=arguments.length,s=new Array(r),o=0;o<r;o++)s[o]=arguments[o];return ct.asap(()=>t(...s))};var Pfe=Ra.hasStandardBrowserEnv?((t,r)=>s=>(s=new tA(s,Ra.origin),t.protocol===s.protocol&&t.host===s.host&&(r||t.port===s.port)))(new tA(Ra.origin),Ra.navigator&&/(msie|trident)/i.test(Ra.navigator.userAgent)):()=>!0,Ofe=Ra.hasStandardBrowserEnv?{write(t,r,s,o,c,u){const h=[t+"="+encodeURIComponent(r)];ct.isNumber(s)&&h.push("expires="+new Date(s).toGMTString()),ct.isString(o)&&h.push("path="+o),ct.isString(c)&&h.push("domain="+c),u===!0&&h.push("secure"),document.cookie=h.join("; ")},read(t){const r=document.cookie.match(new RegExp("(^|;\\s*)("+t+")=([^;]*)"));return r?decodeURIComponent(r[3]):null},remove(t){this.write(t,"",Date.now()-864e5)}}:{write(){},read:()=>null,remove(){}};function yW(t,r){return t&&!function(s){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(s)}(r)?function(s,o){return o?s.replace(/\/?\/$/,"")+"/"+o.replace(/^\/+/,""):s}(t,r):r}function EW(t,r){var s=Object.keys(t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);r&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(t,c).enumerable})),s.push.apply(s,o)}return s}const vW=t=>t instanceof hd?function(r){for(var s=1;s<arguments.length;s++){var o=arguments[s]!=null?arguments[s]:{};s%2?EW(Object(o),!0).forEach(function(c){$(r,c,o[c])}):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(o)):EW(Object(o)).forEach(function(c){Object.defineProperty(r,c,Object.getOwnPropertyDescriptor(o,c))})}return r}({},t):t;function k_(t,r){r=r||{};const s={};function o(E,S,R,P){return ct.isPlainObject(E)&&ct.isPlainObject(S)?ct.merge.call({caseless:P},E,S):ct.isPlainObject(S)?ct.merge({},S):ct.isArray(S)?S.slice():S}function c(E,S,R,P){return ct.isUndefined(S)?ct.isUndefined(E)?void 0:o(void 0,E,0,P):o(E,S,0,P)}function u(E,S){if(!ct.isUndefined(S))return o(void 0,S)}function h(E,S){return ct.isUndefined(S)?ct.isUndefined(E)?void 0:o(void 0,E):o(void 0,S)}function m(E,S,R){return R in r?o(E,S):R in t?o(void 0,E):void 0}const _={url:u,method:u,data:u,baseURL:h,transformRequest:h,transformResponse:h,paramsSerializer:h,timeout:h,timeoutMessage:h,withCredentials:h,withXSRFToken:h,adapter:h,responseType:h,xsrfCookieName:h,xsrfHeaderName:h,onUploadProgress:h,onDownloadProgress:h,decompress:h,maxContentLength:h,maxBodyLength:h,beforeRedirect:h,transport:h,httpAgent:h,httpsAgent:h,cancelToken:h,socketPath:h,responseEncoding:h,validateStatus:m,headers:(E,S,R)=>c(vW(E),vW(S),0,!0)};return ct.forEach(Object.keys(Object.assign({},t,r)),function(E){const S=_[E]||c,R=S(t[E],r[E],E);ct.isUndefined(R)&&S!==m||(s[E]=R)}),s}var SW=t=>{const r=k_({},t);let s,{data:o,withXSRFToken:c,xsrfHeaderName:u,xsrfCookieName:h,headers:m,auth:_}=r;if(r.headers=m=hd.from(m),r.url=VB(yW(r.baseURL,r.url),t.params,t.paramsSerializer),_&&m.set("Authorization","Basic "+btoa((_.username||"")+":"+(_.password?unescape(encodeURIComponent(_.password)):""))),ct.isFormData(o)){if(Ra.hasStandardBrowserEnv||Ra.hasStandardBrowserWebWorkerEnv)m.setContentType(void 0);else if((s=m.getContentType())!==!1){const[E,...S]=s?s.split(";").map(R=>eo(R).call(R)).filter(Boolean):[];m.setContentType([E||"multipart/form-data",...S].join("; "))}}if(Ra.hasStandardBrowserEnv&&(c&&ct.isFunction(c)&&(c=c(r)),c||c!==!1&&Pfe(r.url))){const E=u&&h&&Ofe.read(h);E&&m.set(u,E)}return r},kfe=typeof XMLHttpRequest<"u"&&function(t){return new lt(function(r,s){const o=SW(t);let c=o.data;const u=hd.from(o.headers).normalize();let h,m,_,E,S,{responseType:R,onUploadProgress:P,onDownloadProgress:k}=o;function z(){E&&E(),S&&S(),o.cancelToken&&o.cancelToken.unsubscribe(h),o.signal&&o.signal.removeEventListener("abort",h)}let U=new XMLHttpRequest;function F(){if(!U)return;const Y=hd.from("getAllResponseHeaders"in U&&U.getAllResponseHeaders());mW(function(le){r(le),z()},function(le){s(le),z()},{data:R&&R!=="text"&&R!=="json"?U.response:U.responseText,status:U.status,statusText:U.statusText,headers:Y,config:t,request:U}),U=null}U.open(o.method.toUpperCase(),o.url,!0),U.timeout=o.timeout,"onloadend"in U?U.onloadend=F:U.onreadystatechange=function(){U&&U.readyState===4&&(U.status!==0||U.responseURL&&U.responseURL.indexOf("file:")===0)&&setTimeout(F)},U.onabort=function(){U&&(s(new Zn("Request aborted",Zn.ECONNABORTED,t,U)),U=null)},U.onerror=function(){s(new Zn("Network Error",Zn.ERR_NETWORK,t,U)),U=null},U.ontimeout=function(){let Y=o.timeout?"timeout of "+o.timeout+"ms exceeded":"timeout exceeded";const le=o.transitional||jB;o.timeoutErrorMessage&&(Y=o.timeoutErrorMessage),s(new Zn(Y,le.clarifyTimeoutError?Zn.ETIMEDOUT:Zn.ECONNABORTED,t,U)),U=null},c===void 0&&u.setContentType(null),"setRequestHeader"in U&&ct.forEach(u.toJSON(),function(Y,le){U.setRequestHeader(le,Y)}),ct.isUndefined(o.withCredentials)||(U.withCredentials=!!o.withCredentials),R&&R!=="json"&&(U.responseType=o.responseType),k&&([_,S]=CA(k,!0),U.addEventListener("progress",_)),P&&U.upload&&([m,E]=CA(P),U.upload.addEventListener("progress",m),U.upload.addEventListener("loadend",E)),(o.cancelToken||o.signal)&&(h=Y=>{U&&(s(!Y||Y.type?new Av(null,t,U):Y),U.abort(),U=null)},o.cancelToken&&o.cancelToken.subscribe(h),o.signal&&(o.signal.aborted?h():o.signal.addEventListener("abort",h)));const q=function(Y){const le=/^([-+\w]{1,25})(:?\/\/|:)/.exec(Y);return le&&le[1]||""}(o.url);q&&Ra.protocols.indexOf(q)===-1?s(new Zn("Unsupported protocol "+q+":",Zn.ERR_BAD_REQUEST,t)):U.send(c||null)})},Nfe=(t,r)=>{const{length:s}=t=t?t.filter(Boolean):[];if(r||s){let o,c=new AbortController;const u=function(E){if(!o){o=!0,m();const S=E instanceof Error?E:this.reason;c.abort(S instanceof Zn?S:new Av(S instanceof Error?S.message:S))}};let h=r&&setTimeout(()=>{h=null,u(new Zn("timeout ".concat(r," of ms exceeded"),Zn.ETIMEDOUT))},r);const m=()=>{t&&(h&&clearTimeout(h),h=null,t.forEach(E=>{E.unsubscribe?E.unsubscribe(u):E.removeEventListener("abort",u)}),t=null)};t.forEach(E=>E.addEventListener("abort",u));const{signal:_}=c;return _.unsubscribe=()=>ct.asap(m),_}},Dfe=f3,Lfe=ml;Mn({target:"Promise",stat:!0,forced:!0},{withResolvers:function(){var t=Lfe.f(this);return{promise:t.promise,resolve:t.resolve,reject:t.reject}}});var xfe=ml,Mfe=ch;Mn({target:"Promise",stat:!0,forced:!0},{try:function(t){var r=xfe.f(this),s=Mfe(t);return(s.error?r.reject:r.resolve)(s.value),r.promise}});var AL=l(Dfe),bW=wv.f("asyncIterator"),Ufe=l(bW);function PL(t,r){this.v=t,this.k=r}function uT(t){var r,s;function o(u,h){try{var m=t[u](h),_=m.value,E=_ instanceof PL;AL.resolve(E?_.v:_).then(function(S){if(E){var R=u==="return"?"return":"next";if(!_.k||S.done)return o(R,S);S=t[R](S).value}c(m.done?"return":"normal",S)},function(S){o("throw",S)})}catch(S){c("throw",S)}}function c(u,h){switch(u){case"return":r.resolve({value:h,done:!0});break;case"throw":r.reject(h);break;default:r.resolve({value:h,done:!1})}(r=r.next)?o(r.key,r.arg):s=null}this._invoke=function(u,h){return new AL(function(m,_){var E={key:u,arg:h,resolve:m,reject:_,next:null};s?s=s.next=E:(r=s=E,o(u,h))})},typeof t.return!="function"&&(this.return=void 0)}function _l(t){return function(){return new uT(t.apply(this,arguments))}}function wn(t){return new PL(t,0)}function IA(t){var r={},s=!1;function o(c,u){return s=!0,{done:!1,value:new PL(u=new AL(function(h){h(t[c](u))}),1)}}return r[Iv!==void 0&&X6||"@@iterator"]=function(){return this},r.next=function(c){return s?(s=!1,c):o("next",c)},typeof t.throw=="function"&&(r.throw=function(c){if(s)throw s=!1,c;return o("throw",c)}),typeof t.return=="function"&&(r.return=function(c){return s?(s=!1,c):o("return",c)}),r}uT.prototype[typeof Iv=="function"&&Ufe||"@@asyncIterator"]=function(){return this},uT.prototype.next=function(t){return this._invoke("next",t)},uT.prototype.throw=function(t){return this._invoke("throw",t)},uT.prototype.return=function(t){return this._invoke("return",t)};var OL=l(bW);function kL(t){var r,s,o,c=2;for(typeof Symbol<"u"&&(s=OL,o=Symbol.iterator);c--;){if(s&&(r=t[s])!=null)return r.call(t);if(o&&(r=t[o])!=null)return new AA(r.call(t));s="@@asyncIterator",o="@@iterator"}throw new TypeError("Object is not async iterable")}function AA(t){function r(s){if(Object(s)!==s)return lt.reject(new TypeError(s+" is not an object."));var o=s.done;return lt.resolve(s.value).then(function(c){return{value:c,done:o}})}return AA=function(s){this.s=s,this.n=s.next},AA.prototype={s:null,n:null,next:function(){return r(this.n.apply(this.s,arguments))},return:function(s){var o=this.s.return;return o===void 0?lt.resolve({value:s,done:!0}):r(o.apply(this.s,arguments))},throw:function(s){var o=this.s.return;return o===void 0?lt.reject(s):r(o.apply(this.s,arguments))}},new AA(t)}const Vfe=function*(t,r){let s=t.byteLength;if(!r||s<r)return void(yield t);let o,c=0;for(;c<s;)o=c+r,yield t.slice(c,o),c=o},Ffe=function(){var t=_l(function*(r,s){var o,c=!1,u=!1;try{for(var h,m=kL(jfe(r));c=!(h=yield wn(m.next())).done;c=!1){const _=h.value;yield*IA(kL(Vfe(_,s)))}}catch(_){u=!0,o=_}finally{try{c&&m.return!=null&&(yield wn(m.return()))}finally{if(u)throw o}}});return function(r,s){return t.apply(this,arguments)}}(),jfe=function(){var t=_l(function*(r){if(r[OL])return void(yield*IA(kL(r)));const s=r.getReader();try{for(;;){const{done:o,value:c}=yield wn(s.read());if(o)break;yield c}}finally{yield wn(s.cancel())}});return function(r){return t.apply(this,arguments)}}(),TW=(t,r,s,o)=>{const c=Ffe(t,r);let u,h=0,m=_=>{u||(u=!0,o&&o(_))};return new ReadableStream({async pull(_){try{const{done:E,value:S}=await c.next();if(E)return m(),void _.close();let R=S.byteLength;if(s){let P=h+=R;s(P)}_.enqueue(new Uint8Array(S))}catch(E){throw m(E),E}},cancel:_=>(m(_),c.return())},{highWaterMark:2})};function wW(t,r){var s=Object.keys(t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);r&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(t,c).enumerable})),s.push.apply(s,o)}return s}function RW(t){for(var r=1;r<arguments.length;r++){var s=arguments[r]!=null?arguments[r]:{};r%2?wW(Object(s),!0).forEach(function(o){$(t,o,s[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(s)):wW(Object(s)).forEach(function(o){Object.defineProperty(t,o,Object.getOwnPropertyDescriptor(s,o))})}return t}const PA=typeof fetch=="function"&&typeof Request=="function"&&typeof Response=="function",CW=PA&&typeof ReadableStream=="function",Bfe=PA&&(typeof TextEncoder=="function"?(IW=new TextEncoder,t=>IW.encode(t)):async t=>new Uint8Array(await new Response(t).arrayBuffer()));var IW;const AW=function(t){try{for(var r=arguments.length,s=new Array(r>1?r-1:0),o=1;o<r;o++)s[o-1]=arguments[o];return!!t(...s)}catch{return!1}},Wfe=CW&&AW(()=>{let t=!1;const r=new Request(Ra.origin,{body:new ReadableStream,method:"POST",get duplex(){return t=!0,"half"}}).headers.has("Content-Type");return t&&!r}),NL=CW&&AW(()=>ct.isReadableStream(new Response("").body)),OA={stream:NL&&(t=>t.body)};var PW;PA&&(PW=new Response,["text","arrayBuffer","blob","formData","stream"].forEach(t=>{!OA[t]&&(OA[t]=ct.isFunction(PW[t])?r=>r[t]():(r,s)=>{throw new Zn("Response type '".concat(t,"' is not supported"),Zn.ERR_NOT_SUPPORT,s)})}));const zfe=async(t,r)=>{const s=ct.toFiniteNumber(t.getContentLength());return s??(async o=>o==null?0:ct.isBlob(o)?o.size:ct.isSpecCompliantForm(o)?(await new Request(Ra.origin,{method:"POST",body:o}).arrayBuffer()).byteLength:ct.isArrayBufferView(o)||ct.isArrayBuffer(o)?o.byteLength:(ct.isURLSearchParams(o)&&(o+=""),ct.isString(o)?(await Bfe(o)).byteLength:void 0))(r)};var Gfe=PA&&(async t=>{let{url:r,method:s,data:o,signal:c,cancelToken:u,timeout:h,onDownloadProgress:m,onUploadProgress:_,responseType:E,headers:S,withCredentials:R="same-origin",fetchOptions:P}=SW(t);E=E?(E+"").toLowerCase():"text";let k,z=Nfe([c,u&&u.toAbortSignal()],h);const U=z&&z.unsubscribe&&(()=>{z.unsubscribe()});let F;try{if(_&&Wfe&&s!=="get"&&s!=="head"&&(F=await zfe(S,o))!==0){let Ee,me=new Request(r,{method:"POST",body:o,duplex:"half"});if(ct.isFormData(o)&&(Ee=me.headers.get("content-type"))&&S.setContentType(Ee),me.body){const[ke,Ye]=gW(F,CA(_W(_)));o=TW(me.body,65536,ke,Ye)}}ct.isString(R)||(R=R?"include":"omit");const q="credentials"in Request.prototype;k=new Request(r,RW(RW({},P),{},{signal:z,method:s.toUpperCase(),headers:S.normalize().toJSON(),body:o,duplex:"half",credentials:q?R:void 0}));let Y=await fetch(k);const le=NL&&(E==="stream"||E==="response");if(NL&&(m||le&&U)){const Ee={};["status","statusText","headers"].forEach(ut=>{Ee[ut]=Y[ut]});const me=ct.toFiniteNumber(Y.headers.get("content-length")),[ke,Ye]=m&&gW(me,CA(_W(m),!0))||[];Y=new Response(TW(Y.body,65536,ke,()=>{Ye&&Ye(),U&&U()}),Ee)}E=E||"text";let ye=await OA[ct.findKey(OA,E)||"text"](Y,t);return!le&&U&&U(),await new lt((Ee,me)=>{mW(Ee,me,{data:ye,headers:hd.from(Y.headers),status:Y.status,statusText:Y.statusText,config:t,request:k})})}catch(q){throw U&&U(),q&&q.name==="TypeError"&&/fetch/i.test(q.message)?Object.assign(new Zn("Network Error",Zn.ERR_NETWORK,t,k),{cause:q.cause||q}):Zn.from(q,q&&q.code,t,k)}});const DL={http:null,xhr:kfe,fetch:Gfe};ct.forEach(DL,(t,r)=>{if(t){try{Object.defineProperty(t,"name",{value:r})}catch{}Object.defineProperty(t,"adapterName",{value:r})}});const OW=t=>"- ".concat(t),Hfe=t=>ct.isFunction(t)||t===null||t===!1;var kW={getAdapter:t=>{t=ct.isArray(t)?t:[t];const{length:r}=t;let s,o;const c={};for(let u=0;u<r;u++){let h;if(s=t[u],o=s,!Hfe(s)&&(o=DL[(h=String(s)).toLowerCase()],o===void 0))throw new Zn("Unknown adapter '".concat(h,"'"));if(o)break;c[h||"#"+u]=o}if(!o){const u=Object.entries(c).map(h=>{let[m,_]=h;return"adapter ".concat(m," ")+(_===!1?"is not supported by the environment":"is not available in the build")});throw new Zn("There is no suitable adapter to dispatch the request "+(r?u.length>1?`since :
`+u.map(OW).join(`
`):" "+OW(u[0]):"as no adapter specified"),"ERR_NOT_SUPPORT")}return o},adapters:DL};function LL(t){if(t.cancelToken&&t.cancelToken.throwIfRequested(),t.signal&&t.signal.aborted)throw new Av(null,t)}function NW(t){return LL(t),t.headers=hd.from(t.headers),t.data=IL.call(t,t.transformRequest),["post","put","patch"].indexOf(t.method)!==-1&&t.headers.setContentType("application/x-www-form-urlencoded",!1),kW.getAdapter(t.adapter||RL.adapter)(t).then(function(r){return LL(t),r.data=IL.call(t,t.transformResponse,r),r.headers=hd.from(r.headers),r},function(r){return pW(r)||(LL(t),r&&r.response&&(r.response.data=IL.call(t,t.transformResponse,r.response),r.response.headers=hd.from(r.response.headers))),lt.reject(r)})}const DW="1.7.9",kA={};["object","boolean","number","function","string","symbol"].forEach((t,r)=>{kA[t]=function(s){return typeof s===t||"a"+(r<1?"n ":" ")+t}});const LW={};kA.transitional=function(t,r,s){function o(c,u){return"[Axios v"+DW+"] Transitional option '"+c+"'"+u+(s?". "+s:"")}return(c,u,h)=>{if(t===!1)throw new Zn(o(u," has been removed"+(r?" in "+r:"")),Zn.ERR_DEPRECATED);return r&&!LW[u]&&(LW[u]=!0,console.warn(o(u," has been deprecated since v"+r+" and will be removed in the near future"))),!t||t(c,u,h)}},kA.spelling=function(t){return(r,s)=>(console.warn("".concat(s," is likely a misspelling of ").concat(t)),!0)};var NA={assertOptions:function(t,r,s){if(typeof t!="object")throw new Zn("options must be an object",Zn.ERR_BAD_OPTION_VALUE);const o=Object.keys(t);let c=o.length;for(;c-- >0;){const u=o[c],h=r[u];if(h){const m=t[u],_=m===void 0||h(m,u,t);if(_!==!0)throw new Zn("option "+u+" must be "+_,Zn.ERR_BAD_OPTION_VALUE)}else if(s!==!0)throw new Zn("Unknown option "+u,Zn.ERR_BAD_OPTION)}},validators:kA};const ph=NA.validators;let DA=class{constructor(t){this.defaults=t,this.interceptors={request:new FB,response:new FB}}async request(t,r){try{return await this._request(t,r)}catch(s){if(s instanceof Error){let o={};Error.captureStackTrace?Error.captureStackTrace(o):o=new Error;const c=o.stack?o.stack.replace(/^.+\n/,""):"";try{s.stack?c&&!String(s.stack).endsWith(c.replace(/^.+\n.+\n/,""))&&(s.stack+=`
`+c):s.stack=c}catch{}}throw s}}_request(t,r){typeof t=="string"?(r=r||{}).url=t:r=t||{},r=k_(this.defaults,r);const{transitional:s,paramsSerializer:o,headers:c}=r;s!==void 0&&NA.assertOptions(s,{silentJSONParsing:ph.transitional(ph.boolean),forcedJSONParsing:ph.transitional(ph.boolean),clarifyTimeoutError:ph.transitional(ph.boolean)},!1),o!=null&&(ct.isFunction(o)?r.paramsSerializer={serialize:o}:NA.assertOptions(o,{encode:ph.function,serialize:ph.function},!0)),NA.assertOptions(r,{baseUrl:ph.spelling("baseURL"),withXsrfToken:ph.spelling("withXSRFToken")},!0),r.method=(r.method||this.defaults.method||"get").toLowerCase();let u=c&&ct.merge(c.common,c[r.method]);c&&ct.forEach(["delete","get","head","post","put","patch","common"],k=>{delete c[k]}),r.headers=hd.concat(u,c);const h=[];let m=!0;this.interceptors.request.forEach(function(k){typeof k.runWhen=="function"&&k.runWhen(r)===!1||(m=m&&k.synchronous,h.unshift(k.fulfilled,k.rejected))});const _=[];let E;this.interceptors.response.forEach(function(k){_.push(k.fulfilled,k.rejected)});let S,R=0;if(!m){const k=[NW.bind(this),void 0];for(k.unshift.apply(k,h),k.push.apply(k,_),S=k.length,E=lt.resolve(r);R<S;)E=E.then(k[R++],k[R++]);return E}S=h.length;let P=r;for(R=0;R<S;){const k=h[R++],z=h[R++];try{P=k(P)}catch(U){z.call(this,U);break}}try{E=NW.call(this,P)}catch(k){return lt.reject(k)}for(R=0,S=_.length;R<S;)E=E.then(_[R++],_[R++]);return E}getUri(t){return VB(yW((t=k_(this.defaults,t)).baseURL,t.url),t.params,t.paramsSerializer)}};ct.forEach(["delete","get","head","options"],function(t){DA.prototype[t]=function(r,s){return this.request(k_(s||{},{method:t,url:r,data:(s||{}).data}))}}),ct.forEach(["post","put","patch"],function(t){function r(s){return function(o,c,u){return this.request(k_(u||{},{method:t,headers:s?{"Content-Type":"multipart/form-data"}:{},url:o,data:c}))}}DA.prototype[t]=r(),DA.prototype[t+"Form"]=r(!0)});var LA=DA;class xL{constructor(r){if(typeof r!="function")throw new TypeError("executor must be a function.");let s;this.promise=new lt(function(c){s=c});const o=this;this.promise.then(c=>{if(!o._listeners)return;let u=o._listeners.length;for(;u-- >0;)o._listeners[u](c);o._listeners=null}),this.promise.then=c=>{let u;const h=new lt(m=>{o.subscribe(m),u=m}).then(c);return h.cancel=function(){o.unsubscribe(u)},h},r(function(c,u,h){o.reason||(o.reason=new Av(c,u,h),s(o.reason))})}throwIfRequested(){if(this.reason)throw this.reason}subscribe(r){this.reason?r(this.reason):this._listeners?this._listeners.push(r):this._listeners=[r]}unsubscribe(r){if(!this._listeners)return;const s=this._listeners.indexOf(r);s!==-1&&this._listeners.splice(s,1)}toAbortSignal(){const r=new AbortController,s=o=>{r.abort(o)};return this.subscribe(s),r.signal.unsubscribe=()=>this.unsubscribe(s),r.signal}static source(){let r;return{token:new xL(function(o){r=o}),cancel:r}}}var $fe=xL;const ML={Continue:100,SwitchingProtocols:101,Processing:102,EarlyHints:103,Ok:200,Created:201,Accepted:202,NonAuthoritativeInformation:203,NoContent:204,ResetContent:205,PartialContent:206,MultiStatus:207,AlreadyReported:208,ImUsed:226,MultipleChoices:300,MovedPermanently:301,Found:302,SeeOther:303,NotModified:304,UseProxy:305,Unused:306,TemporaryRedirect:307,PermanentRedirect:308,BadRequest:400,Unauthorized:401,PaymentRequired:402,Forbidden:403,NotFound:404,MethodNotAllowed:405,NotAcceptable:406,ProxyAuthenticationRequired:407,RequestTimeout:408,Conflict:409,Gone:410,LengthRequired:411,PreconditionFailed:412,PayloadTooLarge:413,UriTooLong:414,UnsupportedMediaType:415,RangeNotSatisfiable:416,ExpectationFailed:417,ImATeapot:418,MisdirectedRequest:421,UnprocessableEntity:422,Locked:423,FailedDependency:424,TooEarly:425,UpgradeRequired:426,PreconditionRequired:428,TooManyRequests:429,RequestHeaderFieldsTooLarge:431,UnavailableForLegalReasons:451,InternalServerError:500,NotImplemented:501,BadGateway:502,ServiceUnavailable:503,GatewayTimeout:504,HttpVersionNotSupported:505,VariantAlsoNegotiates:506,InsufficientStorage:507,LoopDetected:508,NotExtended:510,NetworkAuthenticationRequired:511};Object.entries(ML).forEach(t=>{let[r,s]=t;ML[s]=r});var Kfe=ML;const Gs=function t(r){const s=new LA(r),o=vB(LA.prototype.request,s);return ct.extend(o,LA.prototype,s,{allOwnKeys:!0}),ct.extend(o,s,null,{allOwnKeys:!0}),o.create=function(c){return t(k_(r,c))},o}(RL);Gs.Axios=LA,Gs.CanceledError=Av,Gs.CancelToken=$fe,Gs.isCancel=pW,Gs.VERSION=DW,Gs.toFormData=fA,Gs.AxiosError=Zn,Gs.Cancel=Gs.CanceledError,Gs.all=function(t){return lt.all(t)},Gs.spread=function(t){return function(r){return t.apply(null,r)}},Gs.isAxiosError=function(t){return ct.isObject(t)&&t.isAxiosError===!0},Gs.mergeConfig=k_,Gs.AxiosHeaders=hd,Gs.formToJSON=t=>hW(ct.isHTMLForm(t)?new FormData(t):t),Gs.getAdapter=kW.getAdapter,Gs.HttpStatusCode=Kfe,Gs.default=Gs;var $o=Gs;const qfe=()=>{};function dT(){const t={promise:void 0,isResolved:!1,isRejected:!1,isFinished:!1,resolve:void 0,reject:void 0,cancel:qfe};return t.promise=new lt((r,s)=>{t.resolve=o=>{t.isFinished||(t.isResolved=!0,t.isFinished=!0,r(o),t.value=o)},t.reject=o=>{t.isFinished||(t.isRejected=!0,t.isFinished=!0,s(o))}}),t}const xA=new Map,MA=new Map,mh=new Map;let zi=function(t){return t.WIN_10="Windows 10",t.WIN_81="Windows 8.1",t.WIN_8="Windows 8",t.WIN_7="Windows 7",t.WIN_VISTA="Windows Vista",t.WIN_SERVER_2003="Windows Server 2003",t.WIN_XP="Windows XP",t.WIN_2000="Windows 2000",t.ANDROID="Android",t.HARMONY_OS="HarmonyOS",t.OPEN_BSD="Open BSD",t.SUN_OS="Sun OS",t.LINUX="Linux",t.IOS="iOS",t.MAC_OS="Mac OS",t.CHROMIUM_OS="Chromium OS",t.QNX="QNX",t.UNIX="UNIX",t.BEOS="BeOS",t.OS_2="OS/2",t.SEARCH_BOT="Search Bot",t}({}),Un=function(t){return t.CHROME="Chrome",t.SAFARI="Safari",t.EDGE="Edge",t.FIREFOX="Firefox",t.OPERA="OPR",t.QQ="QQBrowser",t.WECHAT="MicroMessenger",t}({});const xW=new due;let fd=xW.getResult(),UL=null;function Rn(t){if(!UL){fd=xW.getResult();const r=function(m){if(m.engine.name==="Blink"&&m.browser.name!=="WeChat")return Un.CHROME;switch(m.browser.name){case"Chrome Headless":case"Chrome":case"Chromium":return Un.CHROME;case"Safari":case"Mobile Safari":return Un.SAFARI;case"Edge":return Un.EDGE;case"Firefox":return Un.FIREFOX;case"QQ":case"QQBrowser":return Un.QQ;case"Opera":return Un.OPERA;case"WeChat":return Un.WECHAT;default:return m.browser.name||""}}(fd),s=MW(fd),o=function(m){return m.os.name==="Windows"?m.os.version?m.os.name+" "+m.os.version:m.os.name:m.os.name||""}(fd),c=fd.os.version,u=MW(fd,!1),h=fd.device.type;if(!(r&&s&&o&&c))return{name:r,version:s,os:o,osVersion:c,browserVersion:u,deviceType:h};UL={name:r,version:s,os:o,osVersion:c,browserVersion:u,deviceType:h}}return UL}function MW(t){let r,s=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1];return r=t.engine.name==="Blink"?t.engine.version||"":t.browser.version||"",s?r.split(".")[0]:r}function UA(){return Rn().os}function UW(){const t=Rn();return"".concat(t.os," ").concat(t.osVersion)}function VA(){const t=Rn();return!!(fd.engine.name==="WebKit"&&t.os===zi.MAC_OS&&navigator.maxTouchPoints&&navigator.maxTouchPoints>0&&t.name!==Un.SAFARI||vo()&&t.name!==Un.SAFARI)}function $f(){return Rn().name===Un.CHROME}function Ss(){return Rn().name===Un.SAFARI}function VW(){return Rn().name===Un.EDGE}function Dr(){return Rn().name===Un.FIREFOX}function vo(){return Rn().os===zi.IOS}function hT(t){const r=Rn();return!(r.name!==Un.CHROME||!r.osVersion)&&Number(r.version)>=t}function FW(t){const r=Rn();return!(r.name!==Un.CHROME||!r.osVersion)&&Number(r.version)<t}function VL(t,r,s){const o=Rn();return!(o.name!==t||!o.osVersion)&&(s?Number(o.version)>=r&&Number(o.version)<=s:Number(o.version)===r)}function FL(t){const r=Rn();return!(r.name!==Un.EDGE||!r.osVersion)&&Number(r.version)>=t}function jW(t){const r=Rn();return!(r.name!==Un.SAFARI||!r.osVersion)&&Number(r.version)>=t}function BW(t,r,s){const o=Rn();if(o.os!==zi.IOS||!o.osVersion)return!1;const c=o.osVersion.split(".");return r&&Number(c[0])===t&&Number(c[1])<r||Number(c[0])<t}function WW(t,r,s){const o=Rn();if(o.name!==Un.SAFARI||!o.osVersion||!o.browserVersion)return!1;const c=o.browserVersion.split(".");return s?r&&Number(c[0])===t&&Number(c[1])<r||Number(c[0])<t:r?Number(c[0])===t&&Number(c[1])<=r||Number(c[0])<t:Number(c[0])<=t}function jL(t){const r=Rn();return!(r.name!==Un.OPERA||!r.osVersion)&&Number(r.version)>=t}function zW(){const t=Rn();if(t.os!==zi.IOS||!t.osVersion)return!1;const r=t.osVersion.split(".");return Number(r[0])<14||Number(r[0])===14&&Number(r[1])<=6}function Pv(){const t=Rn();if(t.os!==zi.IOS||!t.osVersion)return!1;const r=t.osVersion.split(".");return Number(r[0])===15}function BL(){const t=Rn();if(t.os!==zi.IOS||!t.osVersion)return!1;const r=t.osVersion.split(".");return Number(r[0])===16}function GW(){const t=Rn();if(t.os!==zi.IOS||!t.osVersion)return!1;const r=t.osVersion.split(".");return Number(r[0])===15&&Number(r[1])>=1}function lu(){return Ss()&&navigator.maxTouchPoints>0}function HW(){return Rn().name===Un.WECHAT}function $W(){return window.navigator.appVersion&&window.navigator.appVersion.match(/Chrome\/([\w\W]*?)\./)!==null&&window.navigator.appVersion.match(/Chrome\/([\w\W]*?)\./)[1]<=35}function WL(){const t=UA();return function(){const{deviceType:r}=Rn();return r==="mobile"||r==="tablet"}()||t===zi.ANDROID||t===zi.IOS||t===zi.HARMONY_OS}function Kf(){const t=Rn();return t.name!==Un.EDGE&&t.name!==Un.SAFARI&&!!navigator.userAgent.toLocaleLowerCase().match(/chrome\/[\d]./i)}function FA(){return UA()===zi.ANDROID}function fT(){const t=Rn();return FA()&&(t.name===Un.CHROME||t.name===Un.WECHAT||/chrome|chromium/i.test(navigator.userAgent))}function KW(t,r){var s=Object.keys(t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);r&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(t,c).enumerable})),s.push.apply(s,o)}return s}function mt(t){for(var r=1;r<arguments.length;r++){var s=arguments[r]!=null?arguments[r]:{};r%2?KW(Object(s),!0).forEach(function(o){Gt(t,o,s[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(s)):KW(Object(s)).forEach(function(o){Object.defineProperty(t,o,Object.getOwnPropertyDescriptor(s,o))})}return t}function Gt(t,r,s){return(r=function(o){var c=function(u,h){if(typeof u!="object"||u===null)return u;var m=u[Symbol.toPrimitive];if(m!==void 0){var _=m.call(u,"string");if(typeof _!="object")return _;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(u)}(o);return typeof c=="symbol"?c:String(c)}(r))in t?Object.defineProperty(t,r,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[r]=s,t}let X=function(t){return t.UNEXPECTED_ERROR="UNEXPECTED_ERROR",t.UNEXPECTED_RESPONSE="UNEXPECTED_RESPONSE",t.TIMEOUT="TIMEOUT",t.INVALID_PARAMS="INVALID_PARAMS",t.NOT_READABLE="NOT_READABLE",t.NOT_SUPPORTED="NOT_SUPPORTED",t.INVALID_OPERATION="INVALID_OPERATION",t.OPERATION_ABORTED="OPERATION_ABORTED",t.WEB_SECURITY_RESTRICT="WEB_SECURITY_RESTRICT",t.EXCHANGE_SDP_FAILED="EXCHANGE_SDP_FAILED",t.ADD_CANDIDATE_FAILED="ADD_CANDIDATE_FAILED",t.DATACHANNEL_FAILED="DATACHANNEL_FAILED",t.NETWORK_ERROR="NETWORK_ERROR",t.NETWORK_TIMEOUT="NETWORK_TIMEOUT",t.NETWORK_RESPONSE_ERROR="NETWORK_RESPONSE_ERROR",t.API_INVOKE_TIMEOUT="API_INVOKE_TIMEOUT",t.ENUMERATE_DEVICES_FAILED="ENUMERATE_DEVICES_FAILED",t.DEVICE_NOT_FOUND="DEVICE_NOT_FOUND",t.ELECTRON_IS_NULL="ELECTRON_IS_NULL",t.ELECTRON_DESKTOP_CAPTURER_GET_SOURCES_ERROR="ELECTRON_DESKTOP_CAPTURER_GET_SOURCES_ERROR",t.CHROME_PLUGIN_NO_RESPONSE="CHROME_PLUGIN_NO_RESPONSE",t.CHROME_PLUGIN_NOT_INSTALL="CHROME_PLUGIN_NOT_INSTALL",t.MEDIA_OPTION_INVALID="MEDIA_OPTION_INVALID",t.PERMISSION_DENIED="PERMISSION_DENIED",t.CONSTRAINT_NOT_SATISFIED="CONSTRAINT_NOT_SATISFIED",t.TRACK_IS_DISABLED="TRACK_IS_DISABLED",t.GET_VIDEO_ELEMENT_VISIBLE_ERROR="GET_VIDEO_ELEMENT_VISIBLE_ERROR",t.SHARE_AUDIO_NOT_ALLOWED="SHARE_AUDIO_NOT_ALLOWED",t.LOW_STREAM_ENCODING_ERROR="LOW_STREAM_ENCODING_ERROR",t.SET_ENCODING_PARAMETER_ERROR="SET_ENCODING_PARAMETER_ERROR",t.TRACK_STATE_UNREACHABLE="TRACK_STATE_UNREACHABLE",t.INVALID_UINT_UID_FROM_STRING_UID="INVALID_UINT_UID_FROM_STRING_UID",t.CAN_NOT_GET_PROXY_SERVER="CAN_NOT_GET_PROXY_SERVER",t.CAN_NOT_GET_GATEWAY_SERVER="CAN_NOT_GET_GATEWAY_SERVER",t.VOID_GATEWAY_ADDRESS="VOID_GATEWAY_ADDRESS",t.UID_CONFLICT="UID_CONFLICT",t.MULTI_UNILBS_RESPONSE_ERROR="MULTI_UNILBS_RESPONSE_ERROR",t.UPDATE_TICKET_FAILED="UPDATE_TICKET_FAILED",t.TOKEN_EXPIRE="TOKEN_EXPIRE",t.INVALID_LOCAL_TRACK="INVALID_LOCAL_TRACK",t.INVALID_TRACK="INVALID_TRACK",t.SENDER_NOT_FOUND="SENDER_NOT_FOUND",t.CREATE_OFFER_FAILED="CREATE_OFFER_FAILED",t.SET_ANSWER_FAILED="SET_ANSWER_FAILED",t.ICE_FAILED="ICE_FAILED",t.PC_CLOSED="PC_CLOSED",t.SENDER_REPLACE_FAILED="SENDER_REPLACE_FAILED",t.GET_LOCAL_CAPABILITIES_FAILED="GET_LOCAL_CAPABILITIES_FAILED",t.GET_LOCAL_CONNECTION_PARAMS_FAILED="GET_LOCAL_CONNECTION_PARAMS_FAILED",t.SUBSCRIBE_FAILED="SUBSCRIBE_FAILED",t.UNSUBSCRIBE_FAILED="UNSUBSCRIBE_FAILED",t.GATEWAY_P2P_LOST="GATEWAY_P2P_LOST",t.NO_ICE_CANDIDATE="NO_ICE_CANDIDATE",t.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS="CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS",t.EXIST_DISABLED_VIDEO_TRACK="EXIST_DISABLED_VIDEO_TRACK",t.INVALID_REMOTE_USER="INVALID_REMOTE_USER",t.REMOTE_USER_IS_NOT_PUBLISHED="REMOTE_USER_IS_NOT_PUBLISHED",t.CUSTOM_REPORT_SEND_FAILED="CUSTOM_REPORT_SEND_FAILED",t.CUSTOM_REPORT_FREQUENCY_TOO_HIGH="CUSTOM_REPORT_FREQUENCY_TOO_HIGH",t.FETCH_AUDIO_FILE_FAILED="FETCH_AUDIO_FILE_FAILED",t.READ_LOCAL_AUDIO_FILE_ERROR="READ_LOCAL_AUDIO_FILE_ERROR",t.DECODE_AUDIO_FILE_FAILED="DECODE_AUDIO_FILE_FAILED",t.WS_ABORT="WS_ABORT",t.WS_DISCONNECT="WS_DISCONNECT",t.WS_ERR="WS_ERR",t.EXTERNAL_SIGNAL_ABORT="EXTERNAL_SIGNAL_ABORT",t.LIVE_STREAMING_TASK_CONFLICT="LIVE_STREAMING_TASK_CONFLICT",t.LIVE_STREAMING_INVALID_ARGUMENT="LIVE_STREAMING_INVALID_ARGUMENT",t.LIVE_STREAMING_INTERNAL_SERVER_ERROR="LIVE_STREAMING_INTERNAL_SERVER_ERROR",t.LIVE_STREAMING_PUBLISH_STREAM_NOT_AUTHORIZED="LIVE_STREAMING_PUBLISH_STREAM_NOT_AUTHORIZED",t.LIVE_STREAMING_TRANSCODING_NOT_SUPPORTED="LIVE_STREAMING_TRANSCODING_NOT_SUPPORTED",t.LIVE_STREAMING_CDN_ERROR="LIVE_STREAMING_CDN_ERROR",t.LIVE_STREAMING_INVALID_RAW_STREAM="LIVE_STREAMING_INVALID_RAW_STREAM",t.LIVE_STREAMING_WARN_STREAM_NUM_REACH_LIMIT="LIVE_STREAMING_WARN_STREAM_NUM_REACH_LIMIT",t.LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE="LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE",t.LIVE_STREAMING_WARN_FREQUENT_REQUEST="LIVE_STREAMING_WARN_FREQUENT_REQUEST",t.WEBGL_INTERNAL_ERROR="WEBGL_INTERNAL_ERROR",t.BEAUTY_PROCESSOR_INTERNAL_ERROR="BEAUTY_PROCESSOR_INTERNAL_ERROR",t.CROSS_CHANNEL_WAIT_STATUS_ERROR="CROSS_CHANNEL_WAIT_STATUS_ERROR",t.CROSS_CHANNEL_FAILED_JOIN_SRC="CROSS_CHANNEL_FAILED_JOIN_SEC",t.CROSS_CHANNEL_FAILED_JOIN_DEST="CROSS_CHANNEL_FAILED_JOIN_DEST",t.CROSS_CHANNEL_FAILED_PACKET_SENT_TO_DEST="CROSS_CHANNEL_FAILED_PACKET_SENT_TO_DEST",t.CROSS_CHANNEL_SERVER_ERROR_RESPONSE="CROSS_CHANNEL_SERVER_ERROR_RESPONSE",t.METADATA_OUT_OF_RANGE="METADATA_OUT_OF_RANGE",t.LOCAL_AEC_ERROR="LOCAL_AEC_ERROR",t.INVALID_PLUGIN="INVALID_PLUGIN",t.DISCONNECT_P2P="DISCONNECT_P2P",t.CONVERTING_IMAGEDATA_TO_BLOB_FAILED="CONVERTING_IMAGEDATA_TO_BLOB_FAILED",t.CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED="CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED",t.INIT_DATACHANNEL_TIMEOUT="INIT_DATACHANNEL_TIMEOUT",t.CREATE_DATACHANNEL_ERROR="CREATE_DATACHANNEL_ERROR",t.DATACHANNEL_CONNECTION_TIMEOUT="DATACHANNEL_CONNECTION_TIMEOUT",t.PROHIBITED_OPERATION="PROHIBITED_OPERATION",t.IMAGE_MODERATION_UPLOAD_FAILED="IMAGE_MODERATION_UPLOAD_FAILED",t.P2P_MESSAGE_FAILED="P2P_MESSAGE_FAILED",t}({}),Le=class extends Error{constructor(t){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"",s=arguments.length>2?arguments[2]:void 0;super(r),Gt(this,"code",void 0),Gt(this,"message",void 0),Gt(this,"data",void 0),Gt(this,"name","AgoraRTCException"),this.code=t,this.message="AgoraRTCError ".concat(this.code,": ").concat(r),this.data=s}toString(){return this.data?"".concat(this.message,`
data: `).concat(JSON.stringify(this.data)):this.message}print(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"error",r=arguments.length>1?arguments[1]:void 0;return t==="error"&&(r||console).error(this.toString()),t==="warning"&&(r||console).warn(this.toString()),this}throw(t){throw this.print("error",t),this}};function qf(t,r){if(typeof t!="boolean")throw new Le(X.INVALID_PARAMS,"Invalid ".concat(r,": The value is of the boolean type."))}function Di(t,r,s){if(!ot(s).call(s,t))throw new Le(X.INVALID_PARAMS,"".concat(r," can only be set as ").concat(JSON.stringify(s)))}function er(t,r){let s=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1,o=arguments.length>3&&arguments[3]!==void 0?arguments[3]:1e4;if(t<s||t>o||(!(arguments.length>4&&arguments[4]!==void 0)||arguments[4])&&!function(c){return typeof c=="number"&&c%1==0}(t))throw new Le(X.INVALID_PARAMS,"invalid ".concat(r,": the value range is [").concat(s,", ").concat(o,"]. integer only"))}function zL(t,r){if(typeof t!="number"){if(!(t.min||t.max||t.ideal||t.exact))throw new Le(X.INVALID_PARAMS,"".concat(r," is not a valid ConstrainLong"));t.min!==void 0&&er(t.min,"".concat(r,".min"),0,1/0),t.max!==void 0&&er(t.max,"".concat(r,".max"),1,1/0),t.exact!==void 0&&er(t.exact,"".concat(r,".exact"),1,1/0),t.ideal!==void 0&&er(t.ideal,"".concat(r,".ideal"),1,1/0)}else er(t,r,1,1/0)}function ss(t,r){let s=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1,o=arguments.length>3&&arguments[3]!==void 0?arguments[3]:255,c=!(arguments.length>4&&arguments[4]!==void 0)||arguments[4];if(t==null)throw new Le(X.INVALID_PARAMS,"".concat(r||"param"," cannot be empty"));if(!qW(t,s,o,c))throw new Le(X.INVALID_PARAMS,"Invalid ".concat(r||"string param",": Length of the string: [").concat(s,",").concat(o,"].").concat(c?" ASCII characters only.":""))}function Yf(t,r){if(!Array.isArray(t))throw new Le(X.INVALID_PARAMS,"".concat(r," should be an array"))}function Lr(t){return t==null}function qW(t){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1,s=arguments.length>2&&arguments[2]!==void 0?arguments[2]:255,o=!(arguments.length>3&&arguments[3]!==void 0)||arguments[3];return typeof t=="string"&&t.length<=s&&t.length>=r&&(!o||function(c){if(typeof c!="string")return!1;for(let u=0;u<c.length;u+=1){const h=c.charCodeAt(u);if(h<0||h>255)return!1}return!0}(t))}var pT=function(t){return t.COVERED="COVERED",t.POSITION="POSITION",t.SIZE="SIZE",t.STYLE="STYLE",t}(pT||{}),GL=function(t){return t.UNMOUNTED="UNMOUNTED",t.INVALID_HTML_ELEMENT="INVALID_HTML_ELEMENT",t}(GL||{});const YW=new class{constructor(){Gt(this,"_clientSize",null),Gt(this,"getClientWidth",()=>document.documentElement?document.documentElement.clientWidth:document.body.clientWidth),Gt(this,"getClientHeight",()=>document.documentElement?document.documentElement.clientHeight:document.body.clientHeight),Gt(this,"getStyle",t=>window.getComputedStyle(t,null)),Gt(this,"checkCssVisibleProperty",t=>{var r;let s=!0;const o=this.getStyle(t),{display:c,visibility:u,opacity:h,filter:m}=o;return(c==="none"||ot(r=["hidden","collapse"]).call(r,u)||Number(h)<.1)&&(s=!1),!!s&&(m&&m.split(" ").filter(_=>{var E;const S=_.split("(")[0];return ot(E=["brightness","blur","opacity"]).call(E,S)}).map(_=>{const[E,S]=_.split(/\(|\)/);return[E,Number(S.match(/^[0-9\.]+/))]}).forEach(_=>{const[E,S]=_;switch(E){case"brightness":(S<.1||S>3)&&(s=!1);break;case"blur":S>3&&(s=!1);break;case"opacity":S<.1&&(s=!1)}}),s)}),Gt(this,"checkPropertyUpToAllParentNodes",(t,r)=>{let s=!0,o=!0;const c=h=>r(h);let u=t;for(;u&&o;)c(u)||(s=!1,o=!1),u=u.parentElement,u||(o=!1);return s}),Gt(this,"checkActualCssVisibleIncludeInherit",t=>this.checkPropertyUpToAllParentNodes(t,this.checkCssVisibleProperty)),Gt(this,"getSizeAboutClient",t=>{const{width:r,height:s,left:o,right:c,top:u,bottom:h}=t.getBoundingClientRect(),m=this.getClientWidth(),_=this.getClientHeight();return{width:r,height:s,left:o,right:c,top:u,bottom:h,clientWidth:m,clientHeight:_,clientMin:Math.min(m,_)}}),Gt(this,"checkActualSize",()=>{const{width:t,height:r,clientMin:s}=this._clientSize;return this.checkSizeIsVisible(t,r,s)}),Gt(this,"elementFromPoint",(t,r)=>document.elementFromPoint?document.elementFromPoint(t,r):null),Gt(this,"checkCoverForAPoint",(t,r,s)=>{const o=this.elementFromPoint(t,r);return o!==null&&o!==s}),Gt(this,"getPointPositionList",()=>{const{width:t,height:r,left:s,top:o}=this._clientSize,c=t/6,u=r/6,h=[],m=10**6;for(let _=0;_<5;_++)for(let E=0;E<5;E++){const S=(s*m+(_===0?.1:_===4?(c*_*m-1e5)/m:c*_)*m)/m,R=(o*m+(E===0?.1:E===4?(u*E*m-1e5)/m:u*E)*m)/m;h.push({x:S,y:R})}return[...h]}),Gt(this,"checkElementCover",t=>this.getPointPositionList().map(r=>this.checkCoverForAPoint(r.x,r.y,t)).filter(r=>!!r).length>6),Gt(this,"checkSizeIsVisible",(t,r,s)=>(t>50||s/t<=10)&&(r>50||s/r<=10)),Gt(this,"checkSizeOfPartInClient",()=>{const{left:t,right:r,top:s,bottom:o,clientHeight:c,clientWidth:u,clientMin:h}=this._clientSize;let m,_,E,S;if(t<0)m=0;else{if(!(t<u))return!1;m=t}if(r<0)return!1;if(_=r<u?r:u,s<0)E=0;else{if(!(s<c))return!1;E=s}if(o<0)return!1;S=o<c?o:c;const R=_-m,P=S-E;return this.checkSizeIsVisible(R,P,h)}),Gt(this,"returnHiddenResult",t=>(this._clientSize=null,{visible:!1,reason:t})),Gt(this,"checkOneElementVisible",t=>{if(t instanceof HTMLElement){if(this.checkElementIsMountedOnDom(t)){if(this.checkActualCssVisibleIncludeInherit(t)){if(this._clientSize=this.getSizeAboutClient(t),this.checkElementCover(t))return this.returnHiddenResult(pT.COVERED);{const r=this.checkActualSize(),s=this.checkSizeOfPartInClient();return r&&!s?this.returnHiddenResult(pT.POSITION):r?(this._clientSize=null,{visible:!0}):this.returnHiddenResult(pT.SIZE)}}return this.returnHiddenResult(pT.STYLE)}return this.returnHiddenResult(GL.UNMOUNTED)}return this.returnHiddenResult(GL.INVALID_HTML_ELEMENT)}),Gt(this,"checkElementIsMountedOnDom",t=>this.checkPropertyUpToAllParentNodes(t,r=>r.nodeName.toUpperCase()!=="HTML"?r.parentElement!==null:!!document.documentElement))}};function HL(t){return new TextEncoder().encode(t)}const XW=function(t,r){const s=new Uint8Array(t.byteLength+r.byteLength);return s.set(new Uint8Array(t),0),s.set(new Uint8Array(r),t.byteLength),s},$L=async t=>function(r,s){let o="";return new Uint8Array(r).forEach(c=>{o+=c.toString(s).padStart(2,"0")}),o}(await crypto.subtle.digest("SHA-256",HL(t)),16);let Pr=class{constructor(){Gt(this,"_events",{}),Gt(this,"addListener",this.on)}getListeners(t){return this._events[t]?this._events[t].map(r=>r.listener):[]}on(t,r){this._events[t]||(this._events[t]=[]);const s=this._events[t];this._indexOfListener(s,r)===-1&&s.push({listener:r,once:!1})}once(t,r){this._events[t]||(this._events[t]=[]);const s=this._events[t];this._indexOfListener(s,r)===-1&&s.push({listener:r,once:!0})}off(t,r){if(!this._events[t])return;const s=this._events[t],o=this._indexOfListener(s,r);o!==-1&&s.splice(o,1),this._events[t].length===0&&delete this._events[t]}removeAllListeners(t){t?delete this._events[t]:this._events={}}emit(t){this._events[t]||(this._events[t]=[]);const r=this._events[t].map(u=>u);for(var s=arguments.length,o=new Array(s>1?s-1:0),c=1;c<s;c++)o[c-1]=arguments[c];for(let u=0;u<r.length;u+=1){const h=r[u];h.once&&this.off(t,h.listener),h.listener.apply(this,o||[])}}safeEmit(t){for(var r=arguments.length,s=new Array(r>1?r-1:0),o=1;o<r;o++)s[o-1]=arguments[o];[...this._events[t]||[]].forEach(c=>{c.once&&this.off(t,c.listener);try{c.listener.apply(this,s)}catch(u){console.error("safeEmit event:".concat(t," error ").concat(u==null?void 0:u.toString()))}})}_indexOfListener(t,r){let s=t.length;for(;s--;)if(t[s].listener===r)return s;return-1}},mT=null;function JW(){if(mT)return mT;if(window.electron)return mT=window.electron;if(!window.require)return null;try{return mT=window.require("electron"),mT}catch{return null}}let Si=function(t){return t.CREATE_CLIENT="createClient",t.CHECK_SYSTEM_REQUIREMENTS="checkSystemRequirements",t.SET_AREA="setArea",t.PRELOAD="PRELOAD",t.CHECK_VIDEO_TRACK_IS_ACTIVE="checkVideoTrackIsActive",t.CHECK_AUDIO_TRACK_IS_ACTIVE="checkAudioTrackIsActive",t.CREATE_MIC_AUDIO_TRACK="createMicrophoneAudioTrack",t.CREATE_CUSTOM_AUDIO_TRACK="createCustomAudioTrack",t.CREATE_BUFFER_AUDIO_TRACK="createBufferSourceAudioTrack",t.CREATE_CAM_VIDEO_TRACK="createCameraVideoTrack",t.CREATE_CUSTOM_VIDEO_TRACK="createCustomVideoTrack",t.CREATE_MIC_AND_CAM_TRACKS="createMicrophoneAndCameraTracks",t.CREATE_SCREEN_VIDEO_TRACK="createScreenVideoTrack",t.SET_ENCRYPTION_CONFIG="Client.setEncryptionConfig",t.START_PROXY_SERVER="Client.startProxyServer",t.STOP_PROXY_SERVER="Client.stopProxyServer",t.SET_PROXY_SERVER="Client.setProxyServer",t.SET_TURN_SERVER="Client.setTurnServer",t.SET_CLIENT_ROLE="Client.setClientRole",t.SET_LOW_STREAM_PARAMETER="Client.setLowStreamParameter",t.ENABLE_DUAL_STREAM="Client.enableDualStream",t.DISABLE_DUAL_STREAM="Client.disableDualStream",t.JOIN="Client.join",t.LEAVE="Client.leave",t.PUBLISH="Client.publish",t.UNPUBLISH="Client.unpublish",t.SUBSCRIBE="Client.subscribe",t.MASS_SUBSCRIBE="Client.massSubscribe",t.MASS_UNSUBSCRIBE="Client.massUnsubscribe",t.UNSUBSCRIBE="Client.unsubscribe",t.RENEW_TOKEN="Client.renewToken",t.SET_REMOTE_VIDEO_STREAM_TYPE="Client.setRemoteVideoStreamType",t.SET_STREAM_FALLBACK_OPTION="Client.setStreamFallbackOption",t.ENABLE_AUDIO_VOLUME_INDICATOR="Client.enableAudioVolumeIndicator",t.SEND_CUSTOM_REPORT_MESSAGE="Client.sendCustomReportMessage",t.INSPECT_VIDEO_CONTENT="Client.inspectVideoContent",t.STOP_INSPECT_VIDEO_CONTENT="Client.stopInspectVideoContent",t.JOIN_FALLBACK_TO_PROXY="Client._joinFallbackToProxy",t.ON_LIVE_STREAM_WARNING="Client.onLiveStreamWarning",t.ON_LIVE_STREAM_ERROR="Client.onLiveStreamingError",t.START_LIVE_STREAMING="Client.startLiveStreaming",t.SET_LIVE_TRANSCODING="Client.setLiveTranscoding",t.STOP_LIVE_STREAMING="Client.stopLiveStreaming",t.START_CHANNEL_MEDIA_RELAY="Client.startChannelMediaRelay",t.UPDATE_CHANNEL_MEDIA_RELAY="Client.updateChannelMediaRelay",t.STOP_CHANNEL_MEDIA_RELAY="Client.stopChannelMediaRelay",t.REQUEST_CONFIG_DISTRIBUTE="_config-distribute-request",t.SET_CONFIG_DISTRIBUTE="_configDistribute",t.LOCAL_TRACK_SET_MUTED="LocalTrack.setMute",t.LOCAL_AUDIO_TRACK_PLAY="LocalAudioTrack.play",t.LOCAL_AUDIO_TRACK_PLAY_IN_ELEMENT="LocalAudioTrack.playInElement",t.LOCAL_AUDIO_TRACK_STOP="LocalAudioTrack.stop",t.LOCAL_AUDIO_TRACK_SET_VOLUME="LocalAudioTrack.setVolume",t.MIC_AUDIO_TRACK_SET_DEVICE="MicrophoneAudioTrack.setDevice",t.BUFFER_AUDIO_TRACK_START="BufferSourceAudioTrack.startProcessAudioBuffer",t.BUFFER_AUDIO_TRACK_STOP="BufferSourceAudioTrack.stopProcessAudioBuffer",t.BUFFER_AUDIO_TRACK_PAUSE="BufferSourceAudioTrack.pauseProcessAudioBuffer",t.BUFFER_AUDIO_TRACK_RESUME="BufferSourceAudioTrack.resumeProcessAudioBuffer",t.BUFFER_AUDIO_TRACK_SEEK="BufferSourceAudioTrack.seekAudioBuffer",t.LOCAL_VIDEO_TRACK_PLAY="LocalVideoTrack.play",t.LOCAL_VIDEO_TRACK_STOP="LocalVideoTrack.stop",t.LOCAL_VIDEO_TRACK_GET_VIDEO_VISIBLE="LocalVideoTrack.getVideoElementVisibleStatus",t.LOCAL_VIDEO_TRACK_BEAUTY="LocalVideoTrack.setBeautyEffect",t.LOCAL_VIDEO_SEND_SEI_DATA="LocalVideoTrack.sendSeiData",t.CAM_VIDEO_TRACK_SET_DEVICE="CameraVideoTrack.setDevice",t.CAM_VIDEO_TRACK_SET_ENCODER_CONFIG="CameraVideoTrack.setEncoderConfiguration",t.REMOTE_VIDEO_TRACK_PLAY="RemoteVideoTrack.play",t.REMOTE_VIDEO_TRACK_STOP="RemoteVideoTrack.stop",t.REMOTE_VIDEO_TRACK_GET_VIDEO_VISIBLE="RemoteVideoTrack.getVideoElementVisibleStatus",t.REMOTE_AUDIO_TRACK_PLAY="RemoteAudioTrack.play",t.REMOTE_AUDIO_TRACK_STOP="RemoteAudioTrack.stop",t.REMOTE_AUDIO_SET_VOLUME="RemoteAudioTrack.setVolume",t.REMOTE_AUDIO_SET_OUTPUT_DEVICE="RemoteAudioTrack.setOutputDevice",t.GET_MEDIA_STREAM_TRACK="Track.getMediaStreamTrack",t.STREAM_TYPE_CHANGE="streamTypeChange",t.CONNECTION_STATE_CHANGE="connectionStateChange",t.LOAD_CONFIG_FROM_LOCALSTORAGE="loadConfigFromLocalStorage",t.IMAGE_MODERATION_UPLOAD="imageModerationUpload",t.REPUB_AFTER_PC_CONNECTED="repubAfterPCConnected",t}({}),xr=function(t){return t.TRACER="tracer",t}({});function QW(t){return er(t.timeout,"config.timeout",0,1e5),er(t.timeoutFactor,"config.timeoutFactor",0,100,!1),er(t.maxRetryCount,"config.maxRetryConfig",0,1/0),er(t.maxRetryTimeout,"config.maxRetryTimeout",0,1/0),!0}let Yfe=function(t){return t[t.AUDIENCE_LEVEL_LOW_LATENCY=1]="AUDIENCE_LEVEL_LOW_LATENCY",t[t.AUDIENCE_LEVEL_ULTRA_LOW_LATENCY=2]="AUDIENCE_LEVEL_ULTRA_LOW_LATENCY",t[t.AUDIENCE_LEVEL_SYNC_LATENCY=3]="AUDIENCE_LEVEL_SYNC_LATENCY",t}({}),Bn=function(t){return t.LEAVE="LEAVE",t.NETWORK_ERROR="NETWORK_ERROR",t.SERVER_ERROR="SERVER_ERROR",t.UID_BANNED="UID_BANNED",t.FALLBACK="FALLBACK",t.IP_BANNED="IP_BANNED",t.CHANNEL_BANNED="CHANNEL_BANNED",t.LICENSE_MISSING="LICENSE_MISSING",t.LICENSE_EXPIRED="LICENSE_EXPIRED",t.LICENSE_MINUTES_EXCEEDED="LICENSE_MINUTES_EXCEEDED",t.LICENSE_PERIOD_INVALID="LICENSE_PERIOD_INVALID",t.LICENSE_MULTIPLE_SDK_SERVICE="LICENSE_MULTIPLE_SDK_SERVICE",t.LICENSE_ILLEGAL="LICENSE_ILLEGAL",t.TOKEN_EXPIRE="TOKEN_EXPIRE",t}({});function gT(t){if(!Array.isArray(t)||t.length<1)return!1;try{t.forEach(r=>{if(!r.urls)throw Error()})}catch{return!1}return!0}function ZW(t){return ss(t.turnServerURL,"turnServerURL"),ss(t.username,"username"),ss(t.password,"password"),t.udpport&&er(t.udpport,"udpport",1,99999,!0),t.forceturn&&qf(t.forceturn,"forceturn"),t.security&&qf(t.security,"security"),t.tcpport&&er(t.tcpport,"tcpport",1,99999,!0),!0}function KL(t){return t.level!==void 0&&Di(t.level,"level",[1,2,3]),t.delay!==void 0&&er(t.delay,"delay",0,3e3,!0),!0}let mn=function(t){return t.PEERCONNECTION_STATE_CHANGE="peerconnection-state-change",t.AUDIO_METADATA="audio-metadata",t.CONNECTION_STATE_CHANGE="connection-state-change",t.MEDIA_RECONNECT_START="media-reconnect-start",t.MEDIA_RECONNECT_END="media-reconnect-end",t.IS_USING_CLOUD_PROXY="is-using-cloud-proxy",t.USER_JOINED="user-joined",t.USER_LEAVED="user-left",t.USER_PUBLISHED="user-published",t.USER_UNPUBLISHED="user-unpublished",t.USER_INFO_UPDATED="user-info-updated",t.CLIENT_BANNED="client-banned",t.CHANNEL_MEDIA_RELAY_STATE="channel-media-relay-state",t.CHANNEL_MEDIA_RELAY_EVENT="channel-media-relay-event",t.VOLUME_INDICATOR="volume-indicator",t.CRYPT_ERROR="crypt-error",t.ON_TOKEN_PRIVILEGE_WILL_EXPIRE="token-privilege-will-expire",t.ON_TOKEN_PRIVILEGE_DID_EXPIRE="token-privilege-did-expire",t.NETWORK_QUALITY="network-quality",t.STREAM_TYPE_CHANGED="stream-type-changed",t.STREAM_FALLBACK="stream-fallback",t.RECEIVE_METADATA="receive-metadata",t.STREAM_MESSAGE="stream-message",t.LIVE_STREAMING_ERROR="live-streaming-error",t.LIVE_STREAMING_WARNING="live-streaming-warning",t.EXCEPTION="exception",t.ERROR="error",t.P2P_LOST="p2p_lost",t.JOIN_FALLBACK_TO_PROXY="join-fallback-to-proxy",t.CHANNEL_FALLBACK_TO_WEBSOCKET="channel-fallback-to-websocket",t.MEDIA_CONNECTION_TYPE_CHANGE="media-connection-type-change",t.PUBLISHED_USER_LIST="published-user-list",t.CONTENT_INSPECT_CONNECTION_STATE_CHANGE="content-inspect-connection-state-change",t.CONTENT_INSPECT_ERROR="content-inspect-error",t.CONTENT_INSPECT_RESULT="content-inspect-result",t.IMAGE_MODERATION_CONNECTION_STATE_CHANGE="image-moderation-connection-state-change",t}({}),bs=function(t){return t.NETWORK_ERROR="NETWORK_ERROR",t.SERVER_ERROR="SERVER_ERROR",t.MULTI_IP="MULTI_IP",t.TIMEOUT="TIMEOUT",t.OFFLINE="OFFLINE",t.LEAVE="LEAVE",t.P2P_FAILED="P2P_FAILED",t.FALLBACK="FALLBACK",t.REGIONAL_DISTRIBUTION="REGIONAL_DISTRIBUTION",t}({}),nc=function(t){return t.ONLINE="ONLINE",t.OFFLINE="OFFLINE",t}({}),Ov=function(t){return t.NETWORK_STATE_CHANGE="NETWORK_STATE_CHANGE",t.ONLINE="ONLINE",t.OFFLINE="OFFLINE",t}({});function Ts(t,r){for(var s=arguments.length,o=new Array(s>2?s-2:0),c=2;c<s;c++)o[c-2]=arguments[c];return t.getListeners(r).length===0?lt.reject(new Le(X.UNEXPECTED_ERROR,"can not emit promise")):new lt((u,h)=>{t.emit(r,...o,u,h)})}function sr(t,r){if(t.getListeners(r).length===0)return lt.resolve();for(var s=arguments.length,o=new Array(s>2?s-2:0),c=2;c<s;c++)o[c-2]=arguments[c];return Ts(t,r,...o)}function Nc(t,r){if(t.getListeners(r).length===0)return null;for(var s=arguments.length,o=new Array(s>2?s-2:0),c=2;c<s;c++)o[c-2]=arguments[c];return _T(t,r,...o)}function _T(t,r){let s=null,o=null;for(var c=arguments.length,u=new Array(c>2?c-2:0),h=2;h<c;h++)u[h-2]=arguments[h];if(t.emit(r,...u,m=>{s=m},m=>{o=m}),o!==null)throw o;if(s===null)throw new Le(X.UNEXPECTED_ERROR,"handler is not sync");return s}const ci=new class extends Pr{set networkState(t){this.emit(Ov.NETWORK_STATE_CHANGE,t,this._networkState),t===nc.ONLINE?this.emit(Ov.ONLINE):t===nc.OFFLINE&&(this.onlineWaiter=new lt(r=>{this.once(Ov.ONLINE,()=>{this.onlineWaiter=void 0,r(nc.ONLINE)})}),this.emit(Ov.OFFLINE)),this._networkState=t}get networkState(){return this._networkState}get isOnline(){return this._networkState===nc.ONLINE}constructor(){super(),Gt(this,"_moduleName","network-indicator"),Gt(this,"_networkState",nc.ONLINE),Gt(this,"onlineWaiter",void 0),window.addEventListener("online",()=>{this.networkState=nc.ONLINE}),window.addEventListener("offline",()=>{this.networkState=nc.OFFLINE})}};function jA(t,r){const s=t.indexOf(r);s!==-1&&t.splice(s,1)}function kv(t){const r=[];return t.forEach(s=>{r.indexOf(s)===-1&&r.push(s)}),r}function BA(t){lt!==void 0?lt.resolve().then(t):setTimeout(t,0)}function Mr(t){return JSON.parse(JSON.stringify(t))}function N_(t){try{return Mr(t)}catch{return t}}const e8={};function Im(t,r){e8[r]||(e8[r]=!0,t())}function D_(t){const r=window.atob(t),s=new Uint8Array(new ArrayBuffer(r.length));for(let o=0;o<r.length;o+=1)s[o]=r.charCodeAt(o);return s}function Am(t){let r="";for(let s=0;s<t.length;s+=1)r+=String.fromCharCode(t[s]);return window.btoa(r)}function t8(t){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:16,s=new TextEncoder().encode(t);if(s.length>r)s=s.slice(0,r);else if(s.length<r){const o=new Uint8Array(r);o.set(s),s=o}return s}function n8(){for(var t=arguments.length,r=new Array(t),s=0;s<t;s++)r[s]=arguments[s];const o=Ya(r).call(r,(h,m)=>h+m.length,0),c=new Uint8Array(new ArrayBuffer(o));let u=0;return r.forEach(h=>{c.set(h,u),u+=h.length}),c}function gh(t){return window.TextEncoder?new TextEncoder().encode(t).length:t.length}function r8(t){let r=0;return(/DingTalk/i.test(navigator.userAgent)||/AliApp/i.test(navigator.userAgent))&&t.realFormData&&(t=t.realFormData),t.forEach(s=>{r+=typeof s=="string"?gh(s):s.size}),r+138}function Xfe(t){const r=new Le(X.TIMEOUT,"timeout");return new lt((s,o)=>{window.setTimeout(()=>o(r),t)})}function os(t){return new lt(r=>{window.setTimeout(r,t)})}function or(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:7,r=arguments.length>1?arguments[1]:void 0;const s=Math.random().toString(16).substr(2,t).toLowerCase();return s.length===t?"".concat(r).concat(s):"".concat(r).concat(s)+or(t-s.length,"")}function L_(){return or(32,"").toUpperCase()}const WA=()=>{},i8=new class{constructor(){Gt(this,"fnMap",new Map)}throttleByKey(t,r,s,o){for(var c=arguments.length,u=new Array(c>4?c-4:0),h=4;h<c;h++)u[h-4]=arguments[h];if(this.fnMap.has(r)){const m=this.fnMap.get(r);if(m.threshold!==s){m.fn(...m.args),clearTimeout(m.timer);const _=window.setTimeout(()=>{const E=this.fnMap.get(r);E&&E.fn(...E.args),this.fnMap.delete(r)},s);this.fnMap.set(r,{fn:t,threshold:s,timer:_,args:u,skipFn:o})}else m.skipFn&&m.skipFn(...m.args),this.fnMap.set(r,mt(mt({},m),{},{fn:t,args:u,skipFn:o}))}else{const m=window.setTimeout(()=>{const _=this.fnMap.get(r);_&&_.fn(..._.args),this.fnMap.delete(r)},s);this.fnMap.set(r,{fn:t,threshold:s,timer:m,args:u,skipFn:o})}}},s8=i8.throttleByKey.bind(i8);function o8(t){return typeof t=="object"&&t!==null&&!(t instanceof RegExp)}function qL(t,r){if(!o8(t)||!o8(r)||Array.isArray(t)&&!Array.isArray(r)||!Array.isArray(t)&&Array.isArray(r))return r;if(Array.isArray(r)&&Array.isArray(t)){const s=[...t];for(let o=0;o<r.length;o++)s[o]=qL(t[o],r[o]);return s}{const s=mt({},t);for(const o in r)Object.prototype.hasOwnProperty.call(r,o)&&(Object.prototype.hasOwnProperty.call(t,o)?s[o]=qL(t[o],r[o]):s[o]=r[o]);return s}}function a8(t,r){let s=[0];if(s=new Array(r).fill(0),t===0)return s;let o=0;for(;t>0&&(s[o]=255&t,t>>=8,o++,o!==r););return s}function YL(t){return typeof t=="number"?t:t.exact||t.ideal||t.max||t.min||0}function c8(t){const r="0123456789abcdef";function s(le){let ye,Ee="";for(ye=0;ye<=3;ye++)Ee+=r.charAt(le>>8*ye+4&15)+r.charAt(le>>8*ye&15);return Ee}function o(le,ye){const Ee=(65535&le)+(65535&ye);return(le>>16)+(ye>>16)+(Ee>>16)<<16|65535&Ee}function c(le,ye,Ee,me,ke,Ye){return o(function(ut,pt){return ut<<pt|ut>>>32-pt}(o(o(ye,le),o(me,Ye)),ke),Ee)}function u(le,ye,Ee,me,ke,Ye,ut){return c(ye&Ee|~ye&me,le,ye,ke,Ye,ut)}function h(le,ye,Ee,me,ke,Ye,ut){return c(ye&me|Ee&~me,le,ye,ke,Ye,ut)}function m(le,ye,Ee,me,ke,Ye,ut){return c(ye^Ee^me,le,ye,ke,Ye,ut)}function _(le,ye,Ee,me,ke,Ye,ut){return c(Ee^(ye|~me),le,ye,ke,Ye,ut)}const E=function(le){let ye;const Ee=1+(le.length+8>>6),me=new Array(16*Ee);for(ye=0;ye<16*Ee;ye++)me[ye]=0;for(ye=0;ye<le.length;ye++)me[ye>>2]|=le.charCodeAt(ye)<<ye%4*8;return me[ye>>2]|=128<<ye%4*8,me[16*Ee-2]=8*le.length,me}(t);let S,R,P,k,z,U=1732584193,F=-271733879,q=-1732584194,Y=271733878;for(S=0;S<E.length;S+=16)R=U,P=F,k=q,z=Y,U=u(U,F,q,Y,E[S+0],7,-680876936),Y=u(Y,U,F,q,E[S+1],12,-389564586),q=u(q,Y,U,F,E[S+2],17,606105819),F=u(F,q,Y,U,E[S+3],22,-1044525330),U=u(U,F,q,Y,E[S+4],7,-176418897),Y=u(Y,U,F,q,E[S+5],12,1200080426),q=u(q,Y,U,F,E[S+6],17,-1473231341),F=u(F,q,Y,U,E[S+7],22,-45705983),U=u(U,F,q,Y,E[S+8],7,1770035416),Y=u(Y,U,F,q,E[S+9],12,-1958414417),q=u(q,Y,U,F,E[S+10],17,-42063),F=u(F,q,Y,U,E[S+11],22,-1990404162),U=u(U,F,q,Y,E[S+12],7,1804603682),Y=u(Y,U,F,q,E[S+13],12,-40341101),q=u(q,Y,U,F,E[S+14],17,-1502002290),F=u(F,q,Y,U,E[S+15],22,1236535329),U=h(U,F,q,Y,E[S+1],5,-165796510),Y=h(Y,U,F,q,E[S+6],9,-1069501632),q=h(q,Y,U,F,E[S+11],14,643717713),F=h(F,q,Y,U,E[S+0],20,-373897302),U=h(U,F,q,Y,E[S+5],5,-701558691),Y=h(Y,U,F,q,E[S+10],9,38016083),q=h(q,Y,U,F,E[S+15],14,-660478335),F=h(F,q,Y,U,E[S+4],20,-405537848),U=h(U,F,q,Y,E[S+9],5,568446438),Y=h(Y,U,F,q,E[S+14],9,-1019803690),q=h(q,Y,U,F,E[S+3],14,-187363961),F=h(F,q,Y,U,E[S+8],20,1163531501),U=h(U,F,q,Y,E[S+13],5,-1444681467),Y=h(Y,U,F,q,E[S+2],9,-51403784),q=h(q,Y,U,F,E[S+7],14,1735328473),F=h(F,q,Y,U,E[S+12],20,-1926607734),U=m(U,F,q,Y,E[S+5],4,-378558),Y=m(Y,U,F,q,E[S+8],11,-2022574463),q=m(q,Y,U,F,E[S+11],16,1839030562),F=m(F,q,Y,U,E[S+14],23,-35309556),U=m(U,F,q,Y,E[S+1],4,-1530992060),Y=m(Y,U,F,q,E[S+4],11,1272893353),q=m(q,Y,U,F,E[S+7],16,-155497632),F=m(F,q,Y,U,E[S+10],23,-1094730640),U=m(U,F,q,Y,E[S+13],4,681279174),Y=m(Y,U,F,q,E[S+0],11,-358537222),q=m(q,Y,U,F,E[S+3],16,-722521979),F=m(F,q,Y,U,E[S+6],23,76029189),U=m(U,F,q,Y,E[S+9],4,-640364487),Y=m(Y,U,F,q,E[S+12],11,-421815835),q=m(q,Y,U,F,E[S+15],16,530742520),F=m(F,q,Y,U,E[S+2],23,-995338651),U=_(U,F,q,Y,E[S+0],6,-198630844),Y=_(Y,U,F,q,E[S+7],10,1126891415),q=_(q,Y,U,F,E[S+14],15,-1416354905),F=_(F,q,Y,U,E[S+5],21,-57434055),U=_(U,F,q,Y,E[S+12],6,1700485571),Y=_(Y,U,F,q,E[S+3],10,-1894986606),q=_(q,Y,U,F,E[S+10],15,-1051523),F=_(F,q,Y,U,E[S+1],21,-2054922799),U=_(U,F,q,Y,E[S+8],6,1873313359),Y=_(Y,U,F,q,E[S+15],10,-30611744),q=_(q,Y,U,F,E[S+6],15,-1560198380),F=_(F,q,Y,U,E[S+13],21,1309151649),U=_(U,F,q,Y,E[S+4],6,-145523070),Y=_(Y,U,F,q,E[S+11],10,-1120210379),q=_(q,Y,U,F,E[S+2],15,718787259),F=_(F,q,Y,U,E[S+9],21,-343485551),U=o(U,R),F=o(F,P),q=o(q,k),Y=o(Y,z);return s(U)+s(F)+s(q)+s(Y)}let Jfe=1,l8=console,ks=class{static setLogger(t){l8=t}constructor(t,r){Gt(this,"id",void 0),Gt(this,"lockingPromise",lt.resolve()),Gt(this,"locks",0),Gt(this,"name",""),Gt(this,"lockId",void 0),this.lockId=Jfe++,t&&(this.name=t),r&&(this.id=r),this.logger("created")}logger(t,r){const s=(this.id?"[".concat(this.id,"]"):"")+"[lock-".concat(this.name,"-").concat(this.lockId,"]"),o=t==="created"?"is ".concat(t,"."):"is ".concat(t,", current queue ").concat(this.locks,". ").concat(r??"");l8.debug("".concat(s," ").concat(o))}setId(t){this.id=t}get isLocked(){return this.locks>0}lock(t){let r;this.locks+=1,this.logger("locked",t);const s=new lt(c=>{r=()=>{this.locks-=1,this.logger("unlocked",t),c()}}),o=this.lockingPromise.then(()=>r);return this.lockingPromise=this.lockingPromise.then(()=>s),o}};function Nv(t,r){return function(s,o,c){const u=c.value;if(typeof u!="function")throw new Error("Cannot use mutex on object property.");return c.value=async function(){const h=this[r];if(!h)throw new Error("mutex property key ".concat(r," doesn't exist on ").concat(t));const m=await h.lock("From ".concat(t,".").concat(o));try{for(var _=arguments.length,E=new Array(_),S=0;S<_;S++)E[S]=arguments[S];return await u.apply(this,E)}finally{m()}},c}}const bi={timeout:500,timeoutFactor:1.5,maxRetryCount:1/0,maxRetryTimeout:1e4};function XL(t,r){const s=Math.floor(r.timeout*Math.pow(r.timeoutFactor,t));return Math.min(r.maxRetryTimeout,s)}function pd(t,r,s,o){const c=Object.assign({},bi,o);let u=c.timeout;const h=async()=>{await function(E){return new lt(S=>{window.setTimeout(S,E)})}(u),u*=c.timeoutFactor,u=Math.min(c.maxRetryTimeout,u)};let m=!1;const _=new lt(async(E,S)=>{r=r||(()=>!1),s=s||(()=>!0);for(let R=0;R<c.maxRetryCount;R+=1){if(m)return S(new Le(X.OPERATION_ABORTED));try{const P=await t();if(!r(P,R)||R+1===c.maxRetryCount)return E(P);await h()}catch(P){if(!s(P,R)||R+1===c.maxRetryCount)return S(P);await h()}}});return _.cancel=()=>m=!0,_}let zA,u8=class{constructor(t){Gt(this,"input",[]),Gt(this,"size",void 0),this.size=t}add(t){this.input.push(t),this.input.length>this.size&&this.input.splice(0,1)}mean(){var t;return this.input.length===0?0:Ya(t=this.input).call(t,(r,s)=>r+s)/this.input.length}},GA=0,JL=0;function QL(t,r,s,o){return new lt((c,u)=>{r.responseType=r.responseType||"json",r.data&&!s?(r.data=JSON.stringify(r.data),GA+=gh(r.data)):s&&(r.data.size?GA+=r.data.size:r.data instanceof FormData?GA+=r8(r.data):GA+=gh(JSON.stringify(r.data))),r.headers=r.headers||{},r.headers["Content-Type"]=r.headers["Content-Type"]||"application/json",r.method="POST",r.url=t,$o.request(r).then(h=>{typeof h.data=="string"?JL+=gh(h.data):h.data instanceof ArrayBuffer||h.data instanceof Uint8Array?JL+=h.data.byteLength:JL+=gh(JSON.stringify(h.data)),c(h.data)}).catch(h=>{$o.isCancel(h)?u(new Le(X.OPERATION_ABORTED,"cancel token canceled")):h.code==="ECONNABORTED"?u(new Le(X.NETWORK_TIMEOUT,h.message)):h.response?u(new Le(X.NETWORK_RESPONSE_ERROR,h.response.status)):u(new Le(X.NETWORK_ERROR,h.message))})})}async function Qfe(t,r){const s=new Blob([r.data],{type:"buffer"});return await QL(t,mt(mt({},r),{},{data:s,headers:{"Content-Type":"application/octet-stream"}}),!0)}const d8=()=>window.isSecureContext!==void 0;function uu(t){if(Array.isArray(t))return t.map(s=>s);if(!h8(t))return t;const r={};for(const s in t){const o=t[s];h8(o)||Array.isArray(o)?r[s]=uu(o):r[s]=o}return r}function h8(t){return!(typeof t!="object"||Array.isArray(t)||!t)}let ZL=class{constructor(t){Gt(this,"input",[]),Gt(this,"size",void 0),this.size=t}add(t){this.input.push(t),this.input.length>this.size&&this.input.splice(0,1)}diffMean(){return this.input.length===0?0:(this.input[this.input.length-1]-this.input[0])/this.input.length}};const _h={address:"unknown",candidateType:"unknown",id:"unknown",port:0,priority:0,protocol:"unknown",type:"unknown"},yT={timestamp:0,bitrate:{actualEncoded:0,transmit:0},sendPacketLossRate:0,recvPacketLossRate:0,videoRecv:[],videoSend:[],audioRecv:[],audioSend:[],selectedCandidatePair:{id:"unknown",localCandidate:_h,remoteCandidate:_h},updateInterval:0},f8={firsCount:0,nacksCount:0,plisCount:0,framesDecodeCount:0,framesDecodeInterval:0,framesDecodeFreezeTime:0,decodeFrameRate:0,bytes:0,packetsLost:0,packetLostRate:0,packets:0,ssrc:0,qpSumPerFrame:0,framesDroppedCount:0,outputFrameRate:0,packetsDiscarded:0,framesAssembledFromMultiplePackets:0,totalProcessingDelay:0,avgDecodeMs:0,avgFramesAssembledFromMultiplePacketsMs:0,avgProcessingDelayMs:0,avgInterFrameDelayMs:0,totalAssemblyTime:0},p8={firsCount:0,nacksCount:0,plisCount:0,frameCount:0,bytes:0,packets:0,packetsLost:0,packetLostRate:0,ssrc:0,rttMs:0,jitterMs:0,qpSumPerFrame:0},m8={bytes:0,packets:0,packetsLost:0,packetLostRate:0,ssrc:0,rttMs:0,jitterMs:0},g8={jitterBufferMs:0,jitterMs:0,bytes:0,packetsLost:0,packetLostRate:0,packetsDiscarded:0,packets:0,ssrc:0,receivedFrames:0,droppedFrames:0,concealedSamples:0,totalSamplesReceived:0};let ex=class{constructor(t,r){Gt(this,"onFirstVideoReceived",void 0),Gt(this,"onFirstVideoDecoded",void 0),Gt(this,"onFirstAudioReceived",void 0),Gt(this,"onFirstVideoDecodedTimeout",void 0),Gt(this,"onFirstAudioDecoded",void 0),Gt(this,"onSelectedLocalCandidateChanged",void 0),Gt(this,"onSelectedRemoteCandidateChanged",void 0),Gt(this,"videoIsReady",!1),Gt(this,"videoIsReady2",{}),Gt(this,"pc",void 0),Gt(this,"options",void 0),Gt(this,"intervalTimer",void 0),Gt(this,"stats",uu(yT)),Gt(this,"isFirstVideoReceived",{}),Gt(this,"isFirstVideoDecoded",{}),Gt(this,"isFirstAudioReceived",{}),Gt(this,"isFirstAudioDecoded",{}),Gt(this,"isFirstVideoDecodedTimeout",{}),Gt(this,"lossRateWindowStats",[]),this.pc=t,this.options=r,this.intervalTimer=window.setInterval(async()=>{this.updateStats()},this.options.updateInterval)}getStats(){return this.stats}getSelectedCandidatePair(){return new lt(t=>{t({local:mt({},_h),remote:mt({},_h)})})}setVideoIsReady(t){this.videoIsReady=t}setVideoIsReady2(t,r){this.videoIsReady2[t]=r}getVideoIsReady(t){return this.videoIsReady2[t]||!1}setIsFirstAudioDecoded(t){}destroy(){window.clearInterval(this.intervalTimer),this.pc=void 0}calcLossRate(t){this.lossRateWindowStats.push(t),this.lossRateWindowStats.length>this.options.lossRateInterval&&this.lossRateWindowStats.splice(0,1);const r=this.lossRateWindowStats.length,s=["videoSend","audioSend","videoRecv","audioRecv"];let o=0,c=0,u=0,h=0;for(const m of s)t[m].forEach((_,E)=>{if(!this.lossRateWindowStats[r-1][m][E]||!this.lossRateWindowStats[0][m][E])return;const S=this.lossRateWindowStats[r-1][m][E].packets-this.lossRateWindowStats[0][m][E].packets,R=this.lossRateWindowStats[r-1][m][E].packetsLost-this.lossRateWindowStats[0][m][E].packetsLost;m==="videoSend"||m==="audioSend"?(o+=S,u+=R):(c+=S,h+=R),Number.isNaN(S)||Number.isNaN(S)?_.packetLostRate=0:_.packetLostRate=S<=0||R<=0?0:R/(S+R)});t.sendPacketLossRate=o<=0||u<=0?0:u/(o+u),t.recvPacketLossRate=c<=0||h<=0?0:h/(c+h)}},Zfe=class extends ex{constructor(){super(...arguments),Gt(this,"_stats",yT),Gt(this,"lastDecodeVideoReceiverStats",new Map)}async updateStats(){const t=await this._getStats(),r=this.statsResponsesToObjects(t);this._stats=uu(yT);const s=r.filter(c=>c.type==="ssrc");this.processSSRCStats(s);const o=r.find(c=>c.type==="VideoBwe");o&&this.processBandwidthStats(o),this._stats.timestamp=Date.now(),this.calcLossRate(this._stats),this.stats=this._stats}processBandwidthStats(t){this._stats.bitrate={actualEncoded:Number(t.googActualEncBitrate),targetEncoded:Number(t.googTargetEncBitrate),retransmit:Number(t.googRetransmitBitrate),transmit:Number(t.googTransmitBitrate)},this._stats.sendBandwidth=Number(t.googAvailableSendBandwidth)}processSSRCStats(t){t.forEach(r=>{var s;const o=ot(s=r.id).call(s,"send");switch("".concat(r.mediaType,"_").concat(o?"send":"recv")){case"video_send":{const c=uu(p8);c.codec=r.googCodecName,c.adaptionChangeReason="none",r.googCpuLimitedResolution&&(c.adaptionChangeReason="cpu"),r.googBandwidthLimitedResolution&&(c.adaptionChangeReason="bandwidth"),c.avgEncodeMs=Number(r.googAvgEncodeMs),c.inputFrame={width:Number(r.googFrameWidthInput)||Number(r.googFrameWidthSent),height:Number(r.googFrameHeightInput)||Number(r.googFrameHeightSent),frameRate:Number(r.googFrameRateInput)},c.sentFrame={width:Number(r.googFrameWidthSent),height:Number(r.googFrameHeightSent),frameRate:Number(r.googFrameRateInput)},c.firsCount=Number(r.googFirReceived),c.nacksCount=Number(r.googNacksReceived),c.plisCount=Number(r.googPlisReceived),c.frameCount=Number(r.framesEncoded),c.bytes=Number(r.bytesSent),c.packets=Number(r.packetsSent),c.packetsLost=Number(r.packetsLost),c.ssrc=Number(r.ssrc),c.rttMs=Number(r.googRtt||0),this._stats.videoSend.push(c),this._stats.rtt=c.rttMs;break}case"video_recv":{const c=uu(f8),u=this.lastDecodeVideoReceiverStats.get(Number(r.ssrc));if(c.codec=r.googCodecName,c.targetDelayMs=Number(r.googTargetDelayMs),c.renderDelayMs=Number(r.googRenderDelayMs),c.currentDelayMs=Number(r.googCurrentDelayMs),c.minPlayoutDelayMs=Number(r.googMinPlayoutDelayMs),c.decodeMs=Number(r.googDecodeMs),c.maxDecodeMs=Number(r.googMaxDecodeMs),c.receivedFrame={width:Number(r.googFrameWidthReceived),height:Number(r.googFrameHeightReceived),frameRate:Number(r.googFrameRateReceived)},c.decodedFrame={width:Number(r.googFrameWidthReceived),height:Number(r.googFrameHeightReceived),frameRate:Number(r.googFrameRateDecoded)},c.decodeFrameRate=Number(r.googFrameRateDecoded),c.outputFrame={width:Number(r.googFrameWidthReceived),height:Number(r.googFrameHeightReceived),frameRate:Number(r.googFrameRateOutput)},c.jitterBufferMs=Number(r.googJitterBufferMs),c.firsCount=Number(r.googFirsSent),c.nacksCount=Number(r.googNacksSent),c.plisCount=Number(r.googPlisSent),c.framesDecodeCount=Number(r.framesDecoded),c.bytes=Number(r.bytesReceived),c.packets=Number(r.packetsReceived),c.packetsLost=Number(r.packetsLost),c.ssrc=Number(r.ssrc),c.packets>0&&!this.isFirstVideoReceived[c.ssrc]&&(this.onFirstVideoReceived&&this.onFirstVideoReceived(c.ssrc),this.isFirstVideoReceived[c.ssrc]=!0),c.framesDecodeCount>0&&!this.isFirstVideoDecoded[c.ssrc]&&(this.onFirstVideoDecoded&&this.onFirstVideoDecoded(c.ssrc,c.decodedFrame.width,c.decodedFrame.height),this.isFirstVideoDecoded[c.ssrc]=!0),u){const h=u.stats,m=Date.now()-u.lts;c.framesDecodeFreezeTime=h.framesDecodeFreezeTime,c.framesDecodeInterval=h.framesDecodeInterval,c.framesDecodeCount>h.framesDecodeCount&&this.isFirstVideoDecoded[c.ssrc]?(u.lts=Date.now(),c.framesDecodeInterval=m,c.framesDecodeInterval>=this.options.freezeRateLimit&&(this.getVideoIsReady(parseInt(r.ssrc,10))?c.framesDecodeFreezeTime+=c.framesDecodeInterval:this.setVideoIsReady2(parseInt(r.ssrc,10),!0))):c.framesDecodeCount<u.stats.framesDecodeCount&&(c.framesDecodeInterval=0)}this.lastDecodeVideoReceiverStats.set(c.ssrc,{stats:mt({},c),lts:Date.now()}),this._stats.videoRecv.push(c);break}case"audio_recv":{const c=uu(g8);c.codec=r.googCodecName,c.outputLevel=Math.abs(Number(r.audioOutputLevel))/32767,c.decodingCNG=Number(r.googDecodingCNG),c.decodingCTN=Number(r.googDecodingCTN),c.decodingCTSG=Number(r.googDecodingCTSG),c.decodingNormal=Number(r.googDecodingNormal),c.decodingPLC=Number(r.googDecodingPLC),c.decodingPLCCNG=Number(r.googDecodingPLCCNG),c.expandRate=Number(r.googExpandRate),c.accelerateRate=Number(r.googAccelerateRate),c.preemptiveExpandRate=Number(r.googPreemptiveExpandRate),c.secondaryDecodedRate=Number(r.googSecondaryDecodedRate),c.speechExpandRate=Number(r.googSpeechExpandRate),c.preferredJitterBufferMs=Number(r.googPreferredJitterBufferMs),c.jitterBufferMs=Number(r.googJitterBufferMs),c.jitterMs=Number(r.googJitterReceived),c.bytes=Number(r.bytesReceived),c.packets=Number(r.packetsReceived),c.packetsLost=Number(r.packetsLost),c.ssrc=Number(r.ssrc),c.receivedFrames=Number(r.googDecodingCTN)||Number(r.packetsReceived),c.droppedFrames=Number(r.googDecodingPLC)+Number(r.googDecodingPLCCNG)||Number(r.packetsLost),c.receivedFrames>0&&!this.isFirstAudioReceived[c.ssrc]&&(this.onFirstAudioReceived&&this.onFirstAudioReceived(c.ssrc),this.isFirstAudioReceived[c.ssrc]=!0),c.decodingNormal>0&&!this.isFirstAudioDecoded[c.ssrc]&&(this.onFirstAudioDecoded&&this.onFirstAudioDecoded(c.ssrc),this.isFirstAudioDecoded[c.ssrc]=!0),this._stats.audioRecv.push(c);break}case"audio_send":{const c=uu(m8);c.codec=r.googCodecName,c.inputLevel=Math.abs(Number(r.audioInputLevel))/32767,c.aecReturnLoss=Number(r.googEchoCancellationReturnLoss||0),c.aecReturnLossEnhancement=Number(r.googEchoCancellationReturnLossEnhancement||0),c.residualEchoLikelihood=Number(r.googResidualEchoLikelihood||0),c.residualEchoLikelihoodRecentMax=Number(r.googResidualEchoLikelihoodRecentMax||0),c.bytes=Number(r.bytesSent),c.packets=Number(r.packetsSent),c.packetsLost=Number(r.packetsLost),c.ssrc=Number(r.ssrc),c.rttMs=Number(r.googRtt||0),this._stats.rtt=c.rttMs,this._stats.audioSend.push(c);break}}})}_getStats(){return new lt((t,r)=>{this.pc.getStats(t,r)})}statsResponsesToObjects(t){const r=[];return t.result().forEach(s=>{const o={id:s.id,timestamp:s.timestamp.valueOf().toString(),type:s.type};s.names().forEach(c=>{o[c]=s.stat(c)}),r.push(o)}),r}},ET=function(t){return t.BANDWIDTH="bandwidth",t.CPU="cpu",t.NONE="none",t.OTHER="other",t}({}),HA=function(t){return t.L1T1="L1T1",t.L1T2="L1T2",t.L1T3="L1T3",t.L1T3_KEY="L1T3_KEY",t.L2T1_KEY="L2T1_KEY",t.L2T2_KEY="L2T2_KEY",t.L2T3_KEY="L2T3_KEY",t.L3T1_KEY="L3T1_KEY",t.L3T2_KEY="L3T2_KEY",t.L3T3_KEY="L3T3_KEY",t}({}),tx=function(t){return t[t.new=0]="new",t[t.connecting=1]="connecting",t[t.connected=2]="connected",t[t.disconnected=3]="disconnected",t[t.failed=4]="failed",t[t.closed=5]="closed",t}({}),Dc=function(t){return t.CERTIFICATE="certificate",t.CODEC="codec",t.CANDIDATE_PAIR="candidate-pair",t.LOCAL_CANDIDATE="local-candidate",t.REMOTE_CANDIDATE="remote-candidate",t.INBOUND="inbound-rtp",t.TRACK="track",t.OUTBOUND="outbound-rtp",t.PC="peer-connection",t.REMOTE_INBOUND="remote-inbound-rtp",t.REMOTE_OUTBOUND="remote-outbound-rtp",t.TRANSPORT="transport",t.CSRC="csrc",t.DATA_CHANNEL="data-channel",t.STREAM="stream",t.SENDER="sender",t.RECEIVER="receiver",t}({});var Dv=function(t){return t[t.kNone=1]="kNone",t[t.kMillisecondsFromSeconds=1e3]="kMillisecondsFromSeconds",t[t.kBytesToBits=8]="kBytesToBits",t}(Dv||{});function vT(t,r,s,o){let c=arguments.length>4&&arguments[4]!==void 0?arguments[4]:Dv.kNone;if(!r)return;const u=Number(r[s]);if(typeof u!="number")return;const h=Number(r[o]);if(typeof h!="number")return;if(!t)return h?u/h*c:void 0;const m=Number(t[s]);if(typeof m!="number")return;const _=Number(t[o]);if(typeof _!="number")return;const E=h-_;return E?(u-m)/E*c:void 0}let _8=class extends ex{constructor(){super(...arguments),Gt(this,"_stats",yT),Gt(this,"report",void 0),Gt(this,"lastDecodeVideoReceiverStats",new Map),Gt(this,"lastVideoFramesRecv",new Map),Gt(this,"lastVideoFramesSent",new Map),Gt(this,"lastVideoFramesDecode",new Map),Gt(this,"lastVideoFramesOutput",new Map),Gt(this,"lastVideoJBDelay",new Map),Gt(this,"lastAudioJBDelay",new Map),Gt(this,"mediaBytesSent",new Map),Gt(this,"mediaBytesRetransmit",new Map),Gt(this,"mediaBytesTargetEncode",new Map),Gt(this,"lastDecodeAudioReceiverStats",new Map),Gt(this,"lastEncoderMs",new Map)}async updateStats(){this.report=await this.pc.getStats(),this._stats=uu(yT),this.report.forEach(t=>{switch(t.type){case Dc.OUTBOUND:case Dc.INBOUND:{const r=t.mediaType||t.kind,s=!r&&"frameWidth"in t,o=!r&&!("frameWidth"in t);t.type===Dc.OUTBOUND?r==="audio"||o?this.processAudioOutboundStats(t):(r==="video"||s)&&this.processVideoOutboundStats(t):t.type===Dc.INBOUND&&(r==="audio"||o?this.processAudioInboundStats(t):(r==="video"||s)&&this.processVideoInboundStats(t));break}case Dc.TRANSPORT:{const r=this.report.get(t.selectedCandidatePairId);r&&this.processCandidatePairStats(r);break}case Dc.CANDIDATE_PAIR:t.selected&&this.processCandidatePairStats(t)}}),this.updateSendBitrate(),this._stats.updateInterval=Date.now()-this.stats.timestamp,this._stats.timestamp=Date.now(),this.calcLossRate(this._stats),this.stats=this._stats}async getSelectedCandidatePair(){const t=await this.pc.getStats(),r={local:mt({},_h),remote:mt({},_h)};return t.forEach(s=>{let o;if(s.type===Dc.TRANSPORT&&(o=t.get(s.selectedCandidatePairId)),s.type===Dc.CANDIDATE_PAIR&&s.selected&&(o=s),o){const c=(u,h)=>{u.type=h.type,u.id=h.id,h.address&&(u.address=h.address),h.candidateType&&(u.candidateType=h.candidateType),h.port&&(u.port=h.port),h.priority&&(u.priority=h.priority),h.protocol&&(u.protocol=h.protocol),h.relayProtocol&&(u.relayProtocol=h.relayProtocol)};if(o.localCandidateId){const u=t.get(o.localCandidateId);u&&c(r.local,u)}if(o.remoteCandidateId){const u=t.get(o.remoteCandidateId);u&&c(r.remote,u)}}}),r}processCandidatePairStats(t){if(this._stats.sendBandwidth=t.availableOutgoingBitrate||0,t.currentRoundTripTime&&(this._stats.rtt=1e3*t.currentRoundTripTime),this._stats.videoSend.forEach(r=>{t.currentRoundTripTime&&(r.rttMs=1e3*t.currentRoundTripTime)}),this._stats.audioSend.forEach(r=>{t.currentRoundTripTime&&(r.rttMs=1e3*t.currentRoundTripTime)}),this._stats.selectedCandidatePair.id=t.id,t.localCandidateId){const r=this.report.get(t.localCandidateId);r&&this.processCandidateStats(r)}if(t.remoteCandidateId){const r=this.report.get(t.remoteCandidateId);r&&this.processCandidateStats(r)}}processCandidateStats(t){let r;t.type===Dc.LOCAL_CANDIDATE&&(r=this._stats.selectedCandidatePair.localCandidate),t.type===Dc.REMOTE_CANDIDATE&&(r=this._stats.selectedCandidatePair.remoteCandidate),r&&(r.type=t.type,r.id=t.id,t.address&&(r.address=t.address),t.candidateType&&(r.candidateType=t.candidateType),t.port&&(r.port=t.port),t.priority&&(r.priority=t.priority),t.protocol&&(r.protocol=t.protocol),t.relayProtocol&&(r.relayProtocol=t.relayProtocol),t.type===Dc.LOCAL_CANDIDATE&&this.stats.selectedCandidatePair.localCandidate.id!==r.id&&this.onSelectedLocalCandidateChanged&&this.onSelectedLocalCandidateChanged(mt({},r),mt({},this.stats.selectedCandidatePair.localCandidate)),t.type===Dc.REMOTE_CANDIDATE&&this.stats.selectedCandidatePair.remoteCandidate.id!==r.id&&this.onSelectedRemoteCandidateChanged&&this.onSelectedRemoteCandidateChanged(mt({},r),mt({},this.stats.selectedCandidatePair.remoteCandidate)))}processAudioInboundStats(t){let r=this._stats.audioRecv.find(o=>o.ssrc===t.ssrc);r||(r=uu(g8),this._stats.audioRecv.push(r)),r.ssrc=t.ssrc,r.packets=t.packetsReceived,r.packetsLost=t.packetsLost,r.packetsDiscarded=t.packetsDiscarded,r.bytes=t.bytesReceived,r.jitterMs=1e3*t.jitter,r.retransmittedBytesReceived=t.retransmittedBytesReceived,r.retransmittedPacketsReceived=t.retransmittedPacketsReceived,r.totalProcessingDelay=t.totalProcessingDelay,r.jitterBufferEmittedCount=t.jitterBufferEmittedCount;const s=this.lastDecodeAudioReceiverStats.get(r.ssrc);r.avgProcessingDelayMs=vT(s,r,"totalProcessingDelay","jitterBufferEmittedCount",Dv.kMillisecondsFromSeconds),this.processAudioTrackReceiverStats(t,t.trackId,r),t.codecId&&(r.codec=this.getCodecFromCodecStats(t.codecId)),r.receivedFrames||(r.receivedFrames=t.packetsReceived),r.droppedFrames||(r.droppedFrames=t.packetsLost),r.receivedFrames>0&&!this.isFirstAudioReceived[r.ssrc]&&(this.onFirstAudioReceived&&this.onFirstAudioReceived(r.ssrc),this.isFirstAudioReceived[r.ssrc]=!0),r.outputLevel&&r.outputLevel>0&&!this.isFirstAudioDecoded[r.ssrc]&&(this.onFirstAudioDecoded&&this.onFirstAudioDecoded(r.ssrc),this.isFirstAudioDecoded[r.ssrc]=!0),typeof t.concealedSamples=="number"&&(r.concealedSamples=t.concealedSamples),this.lastDecodeAudioReceiverStats.set(r.ssrc,mt({},r))}processVideoInboundStats(t){let r=this._stats.videoRecv.find(h=>h.ssrc===t.ssrc);r||(r=uu(f8),this._stats.videoRecv.push(r)),r.ssrc=t.ssrc,r.packets=t.packetsReceived,r.packetsLost=t.packetsLost,r.bytes=t.bytesReceived,r.firsCount=t.firCount,r.nacksCount=t.nackCount,r.plisCount=t.pliCount,r.framesDecodeCount=t.framesDecoded,r.framesDroppedCount=t.framesDropped,r.totalInterFrameDelay=t.totalInterFrameDelay,r.totalSquaredInterFrameDelay=t.totalSquaredInterFrameDelay,r.totalFreezesDuration=t.totalFreezesDuration,r.totalProcessingDelay=t.totalProcessingDelay,r.packetsDiscarded=t.packetsDiscarded,r.framesAssembledFromMultiplePackets=t.framesAssembledFromMultiplePackets,r.totalAssemblyTime=t.totalAssemblyTime,r.keyFramesDecoded=t.keyFramesDecoded,r.retransmittedBytesReceived=t.retransmittedBytesReceived,r.retransmittedPacketsReceived=t.retransmittedPacketsReceived;const s=this.lastDecodeVideoReceiverStats.get(r.ssrc),o=this.lastVideoFramesDecode.get(r.ssrc),c=this.lastVideoFramesOutput.get(r.ssrc),u=Date.now();if(r.framesDecodeCount>0&&!this.isFirstVideoDecoded[r.ssrc]){const h=r.decodedFrame?r.decodedFrame.width:0,m=r.decodedFrame?r.decodedFrame.height:0;this.onFirstVideoDecoded&&this.onFirstVideoDecoded(r.ssrc,h,m),this.isFirstVideoDecoded[r.ssrc]=!0}if(s){const h=s.stats,m=u-s.lts;r.framesDecodeFreezeTime=h.framesDecodeFreezeTime,r.framesDecodeInterval=h.framesDecodeInterval,!this.isFirstVideoDecoded[r.ssrc]&&m>this.options.firstVideoDecodedTimeout&&!this.isFirstVideoDecodedTimeout[r.ssrc]&&(this.onFirstVideoDecodedTimeout&&this.onFirstVideoDecodedTimeout(r.ssrc),this.isFirstVideoDecodedTimeout[r.ssrc]=!0),r.framesDecodeCount>h.framesDecodeCount&&this.isFirstVideoDecoded[r.ssrc]?(s.lts=Date.now(),r.framesDecodeInterval=m,r.framesDecodeInterval>=this.options.freezeRateLimit&&(this.getVideoIsReady(parseInt(t.ssrc))?r.framesDecodeFreezeTime+=r.framesDecodeInterval:this.setVideoIsReady2(parseInt(t.ssrc,10),!0))):r.framesDecodeCount<h.framesDecodeCount&&(r.framesDecodeInterval=0),t.framesDecoded&&t.qpSum&&(s.stats.framesDecodeCount>t.framesDecoded?r.qpSumPerFrame=t.qpSum/t.framesDecoded:r.qpSumPerFrame=(t.qpSum-s.qpSum)/(t.framesDecoded-s.stats.framesDecodeCount))}t.totalDecodeTime&&(r.decodeMs=1e3*t.totalDecodeTime,r.avgDecodeMs=vT(s==null?void 0:s.stats,r,"decodeMs","framesDecodeCount")),r.avgProcessingDelayMs=vT(s==null?void 0:s.stats,r,"totalProcessingDelay","framesDecodeCount",Dv.kMillisecondsFromSeconds),r.avgFramesAssembledFromMultiplePacketsMs=vT(s==null?void 0:s.stats,r,"totalAssemblyTime","framesAssembledFromMultiplePackets",Dv.kMillisecondsFromSeconds),r.avgInterFrameDelayMs=vT(s==null?void 0:s.stats,r,"totalInterFrameDelay","framesDecodeCount",Dv.kMillisecondsFromSeconds),o&&u-o.lts>=800?(r.decodeFrameRate=Math.round((r.framesDecodeCount-o.count)/((u-o.lts)/1e3)),this.lastVideoFramesDecode.set(r.ssrc,{count:r.framesDecodeCount,lts:u,rate:r.decodeFrameRate})):o?r.decodeFrameRate=o.rate:this.lastVideoFramesDecode.set(r.ssrc,{count:r.framesDecodeCount,lts:u,rate:0}),r.framesDroppedCount&&t.framesReceived&&(c&&u-c.lts>=800?(r.outputFrameRate=Math.round((t.framesReceived-r.framesDroppedCount-c.count)/((u-c.lts)/1e3)),this.lastVideoFramesOutput.set(r.ssrc,{count:t.framesReceived-r.framesDroppedCount,lts:u,rate:Math.max(r.outputFrameRate,0)})):c?r.outputFrameRate=c.rate:this.lastVideoFramesOutput.set(r.ssrc,{count:t.framesReceived-r.framesDroppedCount,lts:u,rate:0})),this.processVideoTrackReceiverStats(t,t.trackId,r),t.codecId&&(r.codec=this.getCodecFromCodecStats(t.codecId)),t.framerateMean&&(r.framesRateFirefox=t.framerateMean),r.packets>0&&!this.isFirstVideoReceived[r.ssrc]&&(this.onFirstVideoReceived&&this.onFirstVideoReceived(r.ssrc),this.isFirstVideoReceived[r.ssrc]=!0),this.lastDecodeVideoReceiverStats.set(r.ssrc,{stats:mt({},r),lts:s?s.lts:Date.now(),qpSum:t.qpSum})}processVideoOutboundStats(t){let r=this._stats.videoSend.find(o=>o.ssrc===t.ssrc);r||(r=uu(p8),this._stats.videoSend.push(r));const s=this.mediaBytesSent.get(t.ssrc);if(s)s.add(t.bytesSent);else{const o=new ZL(10);o.add(t.bytesSent),this.mediaBytesSent.set(t.ssrc,o)}if(t.retransmittedBytesSent!==void 0){const o=this.mediaBytesRetransmit.get(t.ssrc);if(o)o.add(t.retransmittedBytesSent);else{const c=new ZL(10);c.add(t.retransmittedBytesSent),this.mediaBytesRetransmit.set(t.ssrc,c)}}if(t.totalEncodedBytesTarget){const o=this.mediaBytesTargetEncode.get(t.ssrc);if(o)o.add(t.totalEncodedBytesTarget);else{const c=new ZL(10);c.add(t.totalEncodedBytesTarget),this.mediaBytesTargetEncode.set(t.ssrc,c)}}if(r.ssrc=t.ssrc,r.bytes=t.bytesSent,r.packets=t.packetsSent,r.firsCount=t.firCount,r.nacksCount=t.nackCount,r.plisCount=t.pliCount,r.frameCount=t.framesEncoded,r.adaptionChangeReason=t.qualityLimitationReason,r.scalabilityMode=t.scalabilityMode,r.retransmittedBytesSent=t.retransmittedBytesSent,r.retransmittedPacketsSent=t.retransmittedPacketsSent,r.hugeFramesSent=t.hugeFramesSent,r.keyFramesEncoded=t.keyFramesEncoded,t.totalEncodeTime&&t.framesEncoded){const o=this.lastEncoderMs.get(t.ssrc);if(!o||o.lastFrameCount>t.framesEncoded)r.avgEncodeMs=1e3*t.totalEncodeTime/t.framesEncoded;else{const c=t.framesEncoded-o.lastFrameCount,u=t.totalEncodeTime-o.lastEncoderTime;r.avgEncodeMs=1e3*u/c}}if(t.framesEncoded&&t.qpSum){const o=this.lastEncoderMs.get(t.ssrc);!o||o.lastFrameCount>t.framesEncoded?r.qpSumPerFrame=t.qpSum/t.framesEncoded:r.qpSumPerFrame=(t.qpSum-o.lastQpSum)/(t.framesEncoded-o.lastFrameCount)}if(this.lastEncoderMs.set(t.ssrc,{lastFrameCount:t.framesEncoded,lastEncoderTime:t.totalEncodeTime,lastQpSum:t.qpSum,lts:Date.now()}),t.codecId&&(r.codec=this.getCodecFromCodecStats(t.codecId)),t.mediaSourceId&&this.processVideoMediaSource(t.mediaSourceId,r),this.processVideoTrackSenderStats(t,t.trackId,r),t.remoteId)this.processRemoteInboundStats(t.remoteId,r);else{const o=this.findRemoteStatsId(t.ssrc,Dc.REMOTE_INBOUND);o&&this.processRemoteInboundStats(o,r)}}processAudioOutboundStats(t){let r=this._stats.audioSend.find(s=>s.ssrc===t.ssrc);if(r||(r=uu(m8),this._stats.audioSend.push(r)),r.ssrc=t.ssrc,r.packets=t.packetsSent,r.bytes=t.bytesSent,r.retransmittedBytesSent=t.retransmittedBytesSent,r.retransmittedPacketsSent=t.retransmittedPacketsSent,t.mediaSourceId&&this.processAudioMediaSource(t.mediaSourceId,r),t.codecId&&(r.codec=this.getCodecFromCodecStats(t.codecId)),this.processAudioTrackSenderStats(t,t.trackId,r),t.remoteId)this.processRemoteInboundStats(t.remoteId,r);else{const s=this.findRemoteStatsId(t.ssrc,Dc.REMOTE_INBOUND);s&&this.processRemoteInboundStats(s,r)}}findRemoteStatsId(t,r){var s;const o=Array.from(Oc(s=this.report).call(s)).find(c=>c.type===r&&c.ssrc===t);return o?o.id:null}processVideoMediaSource(t,r){const s=this.report.get(t);s&&s.width&&s.height&&s.framesPerSecond&&(r.inputFrame={width:s.width,height:s.height,frameRate:s.framesPerSecond})}processAudioMediaSource(t,r){const s=this.report.get(t);s&&(r.inputLevel=s.audioLevel)}processVideoTrackSenderStats(t,r,s){var o,c,u,h;const m=r?this.report.get(r):void 0,_=(o=m==null?void 0:m.framesSent)!==null&&o!==void 0?o:t.framesSent;if(typeof _!="number")return;let E=(c=m==null?void 0:m.frameWidth)!==null&&c!==void 0?c:t.frameWidth,S=(u=m==null?void 0:m.frameHeight)!==null&&u!==void 0?u:t.frameHeight,R=(h=m==null?void 0:m.framesPerSecond)!==null&&h!==void 0?h:t.framesPerSecond;if(typeof E=="number"&&typeof S=="number"||(E=0,S=0),R==null){const P=Date.now(),k=this.lastVideoFramesSent.get(s.ssrc);k&&P-k.lts>=800?(R=Math.round((_-k.count)/((P-k.lts)/1e3)),this.lastVideoFramesSent.set(s.ssrc,{count:_,lts:P,rate:R})):k?R=k.rate:this.lastVideoFramesSent.set(s.ssrc,{count:_,lts:P,rate:0})}s.sentFrame={width:E,height:S,frameRate:Math.max(0,R)}}processVideoTrackReceiverStats(t,r,s){var o,c,u,h,m;const _=r?this.report.get(r):void 0,E=(o=_==null?void 0:_.framesReceived)!==null&&o!==void 0?o:t.framesReceived,S=(c=_==null?void 0:_.frameWidth)!==null&&c!==void 0?c:t.frameWidth,R=(u=_==null?void 0:_.frameHeight)!==null&&u!==void 0?u:t.frameHeight,P=(h=_==null?void 0:_.jitterBufferDelay)!==null&&h!==void 0?h:t.jitterBufferDelay,k=(m=_==null?void 0:_.jitterBufferEmittedCount)!==null&&m!==void 0?m:t.jitterBufferEmittedCount;if(typeof E=="number"){const z=this.lastVideoFramesRecv.get(s.ssrc),U=Date.now();s.framesReceivedCount=E;let F=0;z&&U-z.lts>=800?(F=Math.round((E-z.count)/((U-z.lts)/1e3)),this.lastVideoFramesRecv.set(s.ssrc,{count:E,lts:U,rate:F})):z?F=z.rate:this.lastVideoFramesRecv.set(s.ssrc,{count:E,lts:U,rate:0}),s.receivedFrame={width:S||0,height:R||0,frameRate:F||0},s.decodedFrame={width:S||0,height:R||0,frameRate:s.decodeFrameRate||0},s.outputFrame={width:S||0,height:R||0,frameRate:s.outputFrameRate||s.decodeFrameRate||0}}if(P&&k){const z=this.lastVideoJBDelay.get(s.ssrc)||{jitterBufferDelay:0,jitterBufferEmittedCount:0,jitterBufferMs:0};let U=z.jitterBufferMs;const F=k-z.jitterBufferEmittedCount;F>0&&(U=1e3*(P-z.jitterBufferDelay)/F),s.jitterBufferMs=U,s.currentDelayMs=Math.round(U),this.lastVideoJBDelay.set(s.ssrc,{jitterBufferDelay:P,jitterBufferEmittedCount:k,jitterBufferMs:s.currentDelayMs})}}processAudioTrackSenderStats(t,r,s){var o,c,u,h;const m=r?this.report.get(r):void 0,_=(o=(c=m==null?void 0:m.echoReturnLoss)!==null&&c!==void 0?c:t.echoReturnLoss)!==null&&o!==void 0?o:0,E=(u=(h=m==null?void 0:m.echoReturnLossEnhancement)!==null&&h!==void 0?h:t.echoReturnLossEnhancement)!==null&&u!==void 0?u:0;s.aecReturnLoss=_,s.aecReturnLossEnhancement=E}processAudioTrackReceiverStats(t,r,s){var o,c,u,h,m,_,E;const S=r?this.report.get(r):void 0,R=(o=S==null?void 0:S.removedSamplesForAcceleration)!==null&&o!==void 0?o:t.removedSamplesForAcceleration,P=(c=S==null?void 0:S.totalSamplesReceived)!==null&&c!==void 0?c:t.totalSamplesReceived,k=(u=S==null?void 0:S.jitterBufferDelay)!==null&&u!==void 0?u:t.jitterBufferDelay,z=(h=S==null?void 0:S.jitterBufferEmittedCount)!==null&&h!==void 0?h:t.jitterBufferEmittedCount,U=(m=S==null?void 0:S.audioLevel)!==null&&m!==void 0?m:t==null?void 0:t.audioLevel,F=(_=S==null?void 0:S.totalSamplesDuration)!==null&&_!==void 0?_:t==null?void 0:t.totalSamplesDuration,q=(E=S==null?void 0:S.concealedSamples)!==null&&E!==void 0?E:t.concealedSamples;if(typeof P=="number"&&(s.totalSamplesReceived=P),R&&P&&(s.accelerateRate=R/P),k&&z){const le=this.lastAudioJBDelay.get(s.ssrc)||{jitterBufferDelay:0,jitterBufferEmittedCount:0,jitterBufferMs:0};let ye=le.jitterBufferMs;const Ee=z-le.jitterBufferEmittedCount;Ee>0&&(ye=1e3*(k-le.jitterBufferDelay)/Ee),s.jitterBufferMs=Math.round(ye),this.lastAudioJBDelay.set(s.ssrc,{jitterBufferDelay:k,jitterBufferEmittedCount:z,jitterBufferMs:s.jitterBufferMs})}s.outputLevel=U;let Y=1920;F&&P&&(Y=P/F/50,s.receivedFrames=Math.round(P/Y)),q&&(s.droppedFrames=Math.round(q/Y))}processRemoteInboundStats(t,r){const s=this.report.get(t);s&&(r.packetsLost=s.packetsLost,s.roundTripTime&&(r.rttMs=1e3*s.roundTripTime),s.jitter&&(r.jitterMs=1e3*s.jitter),s.timestamp&&(r.timestamp=s.timestamp))}getCodecFromCodecStats(t){const r=this.report.get(t);if(!r)return"";const s=r.mimeType.match(/\/(.*)$/);return s&&s[1]?s[1]:""}updateSendBitrate(){let t=0,r=null,s=null;this.mediaBytesSent.forEach(c=>{t+=c.diffMean()}),this.mediaBytesRetransmit.forEach(c=>{r=r===null?c.diffMean():r+c.diffMean()}),this.mediaBytesTargetEncode.forEach(c=>{s=s===null?c.diffMean():s+c.diffMean()});const o=r!==null?t-r:t;this._stats.bitrate={actualEncoded:8*o/(this.options.updateInterval/1e3),transmit:8*t/(this.options.updateInterval/1e3)},r!==null&&(this._stats.bitrate.retransmit=8*r/(this.options.updateInterval/1e3)),s!==null&&(this._stats.bitrate.targetEncoded=8*s/(this.options.updateInterval/1e3))}},epe=class extends ex{updateStats(){return lt.resolve()}};function nx(t){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:250,s=arguments.length>2&&arguments[2]!==void 0?arguments[2]:8,o=arguments.length>3&&arguments[3]!==void 0?arguments[3]:500,c=arguments.length>4&&arguments[4]!==void 0?arguments[4]:1e4;const u=function(){const h=navigator.userAgent.toLocaleLowerCase().match(/chrome\/[\d]*/i);return h&&h[0]?Number(h[0].split("/")[1]):null}();return u?u<76?new Zfe(t,{updateInterval:r,lossRateInterval:s,freezeRateLimit:o,firstVideoDecodedTimeout:c}):new _8(t,{updateInterval:r,lossRateInterval:s,freezeRateLimit:o,firstVideoDecodedTimeout:c}):function(h){if(!window.RTCStatsReport)return!1;const m=h.getStats();return!!(m instanceof lt||function(_){return!!_&&(typeof _=="object"||typeof _=="function")&&typeof _.then=="function"}(m))}(t)?new _8(t,{updateInterval:r,lossRateInterval:s,freezeRateLimit:o,firstVideoDecodedTimeout:c}):new epe(t,{updateInterval:r,lossRateInterval:s,freezeRateLimit:o,firstVideoDecodedTimeout:c})}const y8="websdk_ng_install_id";function rx(){try{if(re("INSTALL_ID"))return re("INSTALL_ID");let t=window.localStorage.getItem(y8);return t||(t=L_(),window.localStorage.setItem(y8,t)),Xn("INSTALL_ID",t),t}catch{return}}const yl=function(t){if(t.match(/[0-9]+\.[0-9]+\.[0-9]+$/))return t;const r=t.match(/([0-9]+\.[0-9]+\.[0-9]+)\-([0-9]+)/);if(r&&r[1]&&r[2]){const s=r[1],o=r[2];return"".concat(s,".").concat(o)}return"4.0.0.999"}("4.23.2"),ix=function(){try{return JSON.parse("true")===!0}catch{return!0}}();let x_=function(t){return t.Default="default",t.Auto="auto",t.Relay="relay",t.SdRtn="sd-rtn",t}({});const ws=function(){const t="us".concat("erna","me"),r="pa".concat("sswo","rd"),s=["t","s","t"];s.splice(1,0,"e");const o=s.join(""),c=[];for(let m=0;m<6;m++)c.push("1");const u=c.join(""),h={};return h[t]=o,h[r]=u,Object.assign(h,{turnServerURL:"",tcpport:3433,udpport:3478,forceturn:!1})}();window.DEFAULT_TURN_CONFIG=ws;const $A={ENABLE_PUBLISHED_USER_LIST:!0,MAX_SUBSCRIPTION:50,SUBSCRIBE_AUDIO_FILTER_TOPN:void 0,ENABLE_PUBLISH_AUDIO_FILTER:void 0,ENABLE_USER_LICENSE_CHECK:!0,DISABLE_FEC:void 0,ENABLE_NTP_REPORT:!1,ENABLE_INSTANT_VIDEO:!1,ENABLE_USER_AUTO_REBALANCE_CHECK:!0,ENABLE_LOSSBASED_BWE:!0,ENABLE_AUT_CC:!1,ENABLE_CC_FALLBACK:void 0,SUBSCRIBE_TWCC:!0,PUBLISH_TWCC:!1,ENABLE_SVC_DEFAULT_CODECS:["H264","VP8","VP9","AV1"],SVC:[],ENABLE_FULL_LINK_AV_SYNC:!1,SVC_MODE:null,PRE_SUB_NUM:2,ENABLE_AUT_FEEDBACK:!1,SVC_EXTENDED:["VP9"]},sx={MIN_FRAME_RATE:1,MAX_FRAME_RATE:30,MAX_THRESHOLD_FRAMERATE:30,BITRATE_MIN_THRESHOLD:100,BITRATE_MAX_THRESHOLD:100,MAX_SCALE:5,BWE_SCALE_UP_THRESHOLD:.6,BWE_SCALE_DOWN_THRESHOLD:.6,PERF_SCALE_UP_THRESHOLD:.7,PERF_SCALE_DOWN_THRESHOLD:.6,MOTION_RESOLUTION_FACTOR:.8,MOTION_BITRATE_FACTOR:.6,DETAIL_FRAMERATE_FACTOR:.8,DETAIL_BITRATE_FACTOR:.6,BALANCE_RESOLUTION_FACTOR:.9,BALANCE_FRAMERATE_FACTOR:.9,BALANCE_BITRATE_FACTOR:.6,OVERUSE_TIMES_THRESHOLD:10,UNDERUSE_TIMES_THRESHOLD:40},ox="v4.23.2-0-g1599fdac-dirty(3/4/2025, 5:13:36 PM)",ax={ENABLE_EVENT_REPORT:!0,UPLOAD_LOG:!1,ENABLE_AG_ADAPTATION:!0,FORCE_AG_HIGH_FRAMERATE:!1,FORCE_SUPPORT_AG_ADAPTATION:!1,ENCODER_CONFIG_LIMIT:{},CAMERA_CAPTURE_CONFIG:void 0,ENABLE_PRELOAD:!0,NEW_ICE_RESTART:!1,ICE_RESTART_INTERVAL:1e4,RESTART_SEQUENCE:["udp_tcp_relay","relay"],FIRST_TCP_CANDIDATE:!1,FIRST_TCP_CANDIDATE_INTERVAL:1e3,TURN_DOMAIN:"edge.agora.io",USE_TURN_IP:!1,NEW_TURN_MODE:void 0,NEW_FORCE_TURN:!1},gr=mt(mt(mt({},ax),{},{PROCESS_ID:"",ENCRYPT_AES:!0,AREAS:["CHINA","GLOBAL"],WEBCS_DOMAIN:["webrtc2-ap-web-1.agora.io","webrtc2-2.ap.sd-rtn.com"],WEBCS_DOMAIN_BACKUP_LIST:["webrtc2-ap-web-3.agora.io","webrtc2-4.ap.sd-rtn.com"],PROXY_CS:["ap-proxy-1.agora.io","ap-proxy-2.agora.io"],CDS_AP:["cds-ap-web-1.agora.io","cds-web-2.ap.sd-rtn.com","cds-ap-web-3.agora.io","cds-web-4.ap.sd-rtn.com"],ACCOUNT_REGISTER:["sua-ap-web-1.agora.io","sua-web-2.ap.sd-rtn.com","sua-ap-web-3.agora.io","sua-web-4.ap.sd-rtn.com"],UAP_AP:["uap-ap-web-1.agora.io","uap-web-2.ap.sd-rtn.com","uap-ap-web-3.agora.io","uap-web-4.ap.sd-rtn.com"],LOG_UPLOAD_SERVER:"logservice.agora.io",EVENT_REPORT_DOMAIN:"statscollector-1.agora.io",EVENT_REPORT_BACKUP_DOMAIN:"web-2.statscollector.sd-rtn.com",GATEWAY_ADDRESS:[],GATEWAY_WSS_ADDRESS:"",LIVE_STREAMING_ADDRESS:"",HTTP_CONNECT_TIMEOUT:5e3,SIGNAL_REQUEST_TIMEOUT:1e4,REPORT_STATS:!0,NOT_REPORT_EVENT:[],PING_PONG_TIME_OUT:10,WEBSOCKET_TIMEOUT_MIN:1e4,EVENT_REPORT_SEND_INTERVAL:3e3,CONFIG_DISTRIBUTE_INTERVAL:3e5,ENABLE_CONFIG_DISTRIBUTE:!0,CANDIDATE_TIMEOUT:5e3,SHOW_REPORT_INVOKER_LOG:!1,SHOW_REPORT_USER_INVOKER_LOG:!0,JOIN_EXTEND:"",PUB_EXTEND:"",SUB_EXTEND:"",FORCE_TURN:!1,TURN_ENABLE_TCP:!0,TURN_ENABLE_UDP:!0,MAX_UPLOAD_CACHE:50,UPLOAD_CACHE_INTERVAL:2e3,AJAX_REQUEST_CONCURRENT:3,REPORT_APP_SCENARIO:void 0,GATEWAY_DOMAINS:["edge.agora.io","edge.sd-rtn.com"],CONNECT_GATEWAY_WITHOUT_DOMAIN:!1,WORKER_DOMAIN:"edge.agora.io",EVENT_REPORT_RETRY:!0,CHROME_FORCE_PLAN_B:!1,AUDIO_SOURCE_VOLUME_UPDATE_INTERVAL:400,AUDIO_SOURCE_AVG_VOLUME_DURATION:3e3,AUDIO_VOLUME_INDICATION_INTERVAL:2e3,VOLUME_VOICE_WEIGHT:10,GET_VOLUME_OF_MUTED_AUDIO_TRACK:!1,STATS_UPDATE_INTERVAL:250,NORMAL_EVENT_QUEUE_CAPACITY:100,CUSTOM_REPORT:!0,CUSTOM_REPORT_LIMIT:20,PROXY_SERVER_TYPE2:"webnginx-proxy.agora.io",PROXY_SERVER_TYPE3:["webrtc-cloud-proxy.sd-rtn.com","webrtc-cloud-proxy.agora.io"],CUSTOM_PUB_ANSWER_MODIFIER:null,CUSTOM_SUB_ANSWER_MODIFIER:null,CUSTOM_PUB_OFFER_MODIFIER:null,CUSTOM_SUB_OFFER_MODIFIER:null,DSCP_TYPE:"high",REMOVE_NEW_CODECS:!0,FRAGEMENT_LENGTH:3,WEBSOCKET_COMPRESS:!1,SIMULCAST:!1,PRELOAD_MEDIA_COUNT:0,CHECK_VIDEO_VISIBLE_INTERVAL:3e4,CHECK_LOCAL_STATS_INTERVAL:250,PROFILE_SWITCH_INTERVAL:2e3,UNSUPPORTED_VIDEO_CODEC:[],ENUMERATE_DEVICES_INTERVAL:!1,ENUMERATE_DEVICES_INTERVAL_TIME:1e4,USE_NEW_TOKEN:!1,CLOSE_AFB_FOR_LOCAL_AP:!0,JOIN_MAX_CONCURRENCY:6,JOIN_WITH_FALLBACK_SIGNAL_PROXY:!0,JOIN_WITH_FALLBACK_MEDIA_PROXY:!0,JOIN_WITH_FALLBACK_MEDIA_PROXY_FORCE:!1,JOIN_GATEWAY_TRY_443PORT_DURATION:2e3,JOIN_GATEWAY_USE_443PORT_ONLY:!1,JOIN_GATEWAY_USE_DUAL_DOMAIN:!0,JOIN_GATEWAY_FALLBACK_PORT:443,USE_TURN_SERVER_OF_GATEWAY:!1,H264_PROFILE_LEVEL_ID:"",USE_NEW_LOG:!1,LOG_VERSION:3,MEDIA_DEVICE_CONSTRAINTS:null,ENCRYPT_PROXY_USERNAME_AND_PSW:!0,SDP_LOGGING:!1,CSP_DETECTED_HOSTNAME_LIST:["agora.io","sd-rtn.com"],REMOTE_AUDIO_TRACK_USES_WEB_AUDIO:!1,LOCAL_AUDIO_TRACK_USES_WEB_AUDIO:!1,BITRATE_ADAPTER_TYPE:"STANDARD_BITRATE",AI_DENOISER_PARAMETERS:{excludedLinks:[]},ADJUST_3A_FROM_PLUGINS:!0,RAISE_H264_BASELINE_PRIORITY:!0,FILTER_SEND_H264_BASELINE:!1,FIRST_H264_PROFILE_LEVEL_ID:"42001f",FIRST_PACKETIZATION_MODE:"",X_GOOGLE_START_BITRATE:void 0,NEW_REPORT_SERVER:!1,NEW_REPORT_SERVER_DOMAINS:["data-reporting.agora.io","data-reporting.agora.io"],VIDEO_INSPECT_WORKER_MESSAGE_LENGTH_LIMIT:3e5,VIDEO_INSPECT_INTERVAL_MINIMUM:1e3,VIDEO_INSPECT_QUALITY_RATIO:.9,VIDEO_INSPECT_WORKER_MANAGER_HOST:"edge.agora.io",VIDEO_INSPECT_WORKER_MANAGER_PORT:"",VIDEO_INSPECT_WORKER_PORT:"",SHOW_VIDEO_INSPECT_WORKER_MESSAGE:!1,STATS_COLLECTOR_PORT:443,FORCE_TURN_TCP:!1,WEBAUDIO_INIT_OPTIONS:void 0,FILTER_VIDEO_FEC:!0,FILTER_AUDIO_FEC:!1,CHROME_DUAL_STREAM_USE_ENCODING:!0,DISABLE_DUAL_STREAM_USE_ENCODING:!1,EXTENSION_USAGE_UPLOAD_INTERVAL:1e4,ICE_RESTART:!0,FINGERPRINT:null,ENABLE_VIDEO_FRAME_CALLBACK:!0,VIDEO_FREEZE_DURATION:500,SPATIALIZER_PARAMETERS:{},UPLOAD_LOG_INTERVAL:3e3,UPLOAD_LOG_REQUEST_RETRY_INTERVAL:2e3,UPLOAD_LOG_REQUEST_MAX_RETRY_INTERVAL:2e4,UPLOAD_LOG_TRY_INTERVAL_WHILE_OFF:5e3,UPLOAD_LOG_RETRY_INTERVAL_V1:1e4,UPLOAD_LOG_TWICE_RETRY_INTERVAL_V1:200,UPLOAD_LOG_LENGTH_EACH_TIME:10,APP_TYPE:0,DISABLE_WEBAUDIO:!1,CHANNEL_MEDIA_RELAY_SERVERS:void 0,KEEP_LAST_FRAME:!0,FORWARD_P2P_CREATION:!0,SYNC_GROUP:!0,BLOCK_LOCAL_CLIENT:!1,ENABLE_AUDIO_TOPN:!1,ENABLE_AUDIO_METADATA:!1,ENABLE_AUDIO_PTS_METADATA:!1,TOPN_SMOOTH_LEVEL:void 0,TOPN_NEW_SPEAKER_DELAY:void 0,TOPN_SWITCH_HOLD_MS:void 0,TOPN_AUDIO_GAIN:void 0,TOPN_SILENCE_THRESHOLD:250,AP_AREA:!0,ENABLE_ENCODED_TRANSFORM:!1,ENABLE_VIDEO_SEI:!1,IMAGE_MODERATION_WORKER_HOST:"edge.agora.io",IMAGE_MODERATION_WORKER_MESSAGE_LENGTH_LIMIT:3e5,IMAGE_MODERATION_INTERVAL_MINIMUM:1e3,SHOW_IMAGE_MODERATION_WORKER_MESSAGE:!1,IMAGE_MODERATION_QUALITY_RATIO:.9,IMAGE_MODERATION_UPLOAD_REPORT_INTERVAL:5e3,SHOW_GLOBAL_CLIENT_LIST:!1,DATASTREAM_MAX_RETRANSMITS:10,TCP_CANDIDATE_ONLY:!1,EXTERNAL_SIGNAL_REQUEST_TIMEOUT:3e3,SHOW_P2P_LOG:!1,MAX_P2P_TIMEOUT:3e4,P2P_TOKEN_INTERVAL:1e3,SHOW_DATASTREAM2_LOG:!1,RESTRICTION_SET_PLAYBACK_DEVICE:!0,USE_PURE_ENCRYPTION_MASTER_KEY:!1,ACCOUNT_REGISTER_RETRY_TIMEOUT:1,ACCOUNT_REGISTER_RETRY_RATIO:2,ACCOUNT_REGISTER_RETRY_TIMEOUT_MAX:6e4,ACCOUNT_REGISTER_RETRY_COUNT_MAX:1e5,AUDIO_CONTEXT:null,WEBCS_BACKUP_CONNECT_TIMEOUT:6e3,PLAYER_STATE_DEFER:2e3,SIGNAL_REQUEST_WATCH_INTERVAL:1e3,FILEPATH_LENMAX:255,DUALSTREAM_OPERATION_CHECK:!0,MEDIA_ELEMENT_EXISTS_DEPTH:3,SHIM_CANDIDATE:!1,LEAVE_MSG_TIMEOUT:2e3,STATS_FILTER:{transportId:!0,googTrackId:!0},FILTER_VIDEO_CODEC:[],USE_NEW_NETWORK_CONFIG:!1,AUTO_RESET_AUDIO_ROUTE:!1,PLUGIN_INFO:[],OVERUSE_DETECTOR_PARAMS:sx,CUSTOM_ADAPTATION_DEFAULT_MODE:"",HIDE_NO_POSTER:!1,AP_CACHE_NUM:10,AP_UPDATE_INTERVAL:12e4,AP_CACHE_LIFETIME:12e4,MAX_PRELOAD_ASYNC_LENGTH:3,DISABLE_SCREEN_SHARE_REMB:!1},$A),{},{USE_CANDIDATE_FROM_AP_DETAIL:!1,AP_REQUEST_DETAIL:void 0,ENABLE_ROLE_SELECT_EDGE:!1,CLIENT_ROLE_OPTIONS:void 0,COMPATIBLE_SDP_EXTENSION:["gdpr_forbidden"],LIMIT_BITRATE:void 0,EXPERIMENTS:{},USE_PUB_RTX:!0,USE_SUB_RTX:!0,ENABLE_DATASTREAM_2:!1,USE_XR:!0,ENABLE_PREALLOC_PC:!1,ENABLE_PRE_SUB:!1,ENABLE_SVC:!1},{INSTALL_ID:""});function Xn(t,r,s){var o,c,u;ot(o=Object.keys(gr)).call(o,t)&&(!s&&ot(c=Object.keys(md)).call(c,t)||(gr[t]=r,t!=="ENABLE_VIDEO_SEI"&&t!=="ENABLE_AUDIO_TOPN"&&t!=="ENABLE_AUDIO_METADATA"&&t!=="ENABLE_AUDIO_PTS_METADATA"||r!==!0||(gr.ENABLE_ENCODED_TRANSFORM=!0,t==="ENABLE_AUDIO_PTS_METADATA"&&(gr.ENABLE_AUDIO_METADATA=!0)),t==="USE_NEW_NETWORK_CONFIG"&&r&&(u=!!r,gr.USE_NEW_NETWORK_CONFIG=u,u&&(gr.WEBCS_DOMAIN=["webrtc2-2.ap.sd-rtn.com"],gr.WEBCS_DOMAIN_BACKUP_LIST=["webrtc2-4.ap.sd-rtn.com"],gr.CDS_AP=["cds-web-2.ap.sd-rtn.com","cds-web-4.ap.sd-rtn.com"],gr.ACCOUNT_REGISTER=["sua-web-2.ap.sd-rtn.com","sua-web-4.ap.sd-rtn.com"],gr.EVENT_REPORT_DOMAIN="web-2.statscollector.sd-rtn.com",gr.EVENT_REPORT_BACKUP_DOMAIN="statscollector-1.agora.io",gr.GATEWAY_DOMAINS=["edge.sd-rtn.com"])),t==="ENABLE_PRE_SUB"&&r&&(gr.ENABLE_INSTANT_VIDEO=!0,gr.ENABLE_PREALLOC_PC=!0),t==="ENABLE_SVC"&&r&&(gr.ENABLE_AUT_CC=!0),t==="NEW_FORCE_TURN"&&r&&(gr.NEW_TURN_MODE||(gr.NEW_TURN_MODE=4))))}function re(t){return gr[t]}ix||(gr.WEBCS_DOMAIN=["ap-web-1-oversea.agora.io","ap-web-1-north-america.agora.io"],gr.WEBCS_DOMAIN_BACKUP_LIST=["ap-web-2-oversea.agora.io","ap-web-2-north-america.agora.io"],gr.PROXY_CS=["proxy-ap-web-oversea.agora.io","proxy-ap-web-america.agora.io"],gr.CDS_AP=["cds-ap-web-oversea.agora.io","cds-ap-web-america.agora.io","cds-ap-web-america2.agora.io"],gr.ACCOUNT_REGISTER=["sua-ap-web-oversea.agora.io","sua-ap-web-america.agora.io","sua-ap-web-america2.agora.io"],gr.UAP_AP=["uap-ap-web-oversea.agora.io","uap-ap-web-america.agora.io","uap-ap-web-america2.agora.io"],gr.LOG_UPLOAD_SERVER="logservice-oversea.agora.io",gr.EVENT_REPORT_DOMAIN="statscollector-1-oversea.agora.io",gr.EVENT_REPORT_BACKUP_DOMAIN="statscollector-2-oversea.agora.io",gr.PROXY_SERVER_TYPE3="webrtc-cloud-proxy.agora.io",gr.AREAS=["NORTH_AMERICA","OVERSEA"]);let E8=function(t){return t[t.REALTIME=1]="REALTIME",t}({});const md={};var gn=function(t){return t.SET_SESSION_ID="SET_SESSION_ID",t.SET_P2P_ID="SET_P2P_id",t.SET_DC_ID="SET_DC_id",t.SET_UID="SET_UID",t.SET_INT_UID="SET_INT_UID",t.SET_PUB_ID="SET_PUB_ID",t.SET_CLOUD_PROXY_SERVER_MODE="SET_CLOUD_PROXY_SERVER_MODE",t.KEY_METRIC_CLIENT_CREATED="KEY_METRIC_CLIENT_CREATED",t.KEY_METRIC_JOIN_START="KEY_METRIC_JOIN_START",t.AVOID_JOIN_START="AVOID_JOIN_START",t.KEY_METRIC_JOIN_END="KEY_METRIC_JOIN_END",t.KEY_METRIC_REQUEST_AP_START="KEY_METRIC_REQUEST_AP_START",t.KEY_METRIC_REQUEST_AP_END="KEY_METRIC_REQUEST_AP_END",t.KEY_METRIC_JOIN_GATEWAY_START="KEY_METRIC_JOIN_GATEWAY_START",t.KEY_METRIC_JOIN_GATEWAY_END="KEY_METRIC_JOIN_GATEWAY_END",t.KEY_METRIC_PEER_CONNECTION_START="KEY_METRIC_PEER_CONNECTION_START",t.KEY_METRIC_PEER_CONNECTION_END="KEY_METRIC_PEER_CONNECTION_END",t.KEY_METRIC_DESCRIPTION_START="KEY_METRIC_DESCRIPTION_START",t.KEY_METRIC_ICE_CONNECTION_END="KEY_METRIC_ICE_CONNECTION_END",t.KEY_METRIC_SIGNAL_CHANNEL_OPEN="KEY_METRIC_SIGNAL_CHANNEL_OPEN",t.KEY_METRIC_PUBLISH="KEY_METRIC_PUBLISH",t.KEY_METRIC_SUBSCRIBE="KEY_METRIC_SUBSCRIBE",t.RECORD_JOIN_CHANNEL_SERVICE="RECORD_JOIN_CHANNEL_SERVICE",t.RESET_JOIN_CHANNEL_SERVICE_RECORDS="RESET_JOIN_CHANNEL_SERVICE_RECORDS",t.RESET_KEY_METRICS="RESET_KEY_METRICS",t.SET_USE_P2P="SET_USE_P2P",t.SET_TRANSPORT_TYPE="SET_TRANSPORT_TYPE",t}(gn||{});let KA=function(t){return t.h264="h264",t.h265="h265",t.vp8="vp8",t.vp9="vp9",t.av1="av1",t}({});(function(t){t.opus="opus",t.pcma="pcma",t.pcmu="pcmu",t.g722="g722"})({});const v8=128,tpe=96,S8=1e3,Lv=10;let npe=0;var b8=(()=>{var t={8:(o,c,u)=>{u.r(c),u.d(c,{Parser:()=>ut,Printer:()=>ei,parse:()=>st,print:()=>Tt});const h=`
`,m="".concat("\r").concat(h),_=" ";let E;function S(We){return We>="0"&&We<="9"}function R(We){return We>="!"&&We<="~"}function P(We){return R(We)||We>=""&&We<=""}function k(We){return We==="!"||We>="#"&&We<="'"||We>="*"&&We<="+"||We>="-"&&We<="."||We>="0"&&We<="9"||We>="A"&&We<="Z"||We>="^"&&We<="~"}function z(We){return We>="1"&&We<="9"}function U(We){return We>="A"&&We<="Z"||We>="a"&&We<="z"}function F(We){return We==="d"||We==="h"||We==="m"||We==="s"}function q(We){return We>""&&We<"	"||We>"\v"&&We<"\f"||We>""&&We<""}function Y(We){return U(We)||S(We)||We==="+"||We==="/"}function le(We){return S(We)||U(We)||We==="+"||We==="/"||We==="-"||We==="_"}function ye(We){return U(We)||S(We)||We==="+"||We==="/"}function Ee(We,x){var ie=Object.keys(We);if(Object.getOwnPropertySymbols){var de=Object.getOwnPropertySymbols(We);x&&(de=de.filter(function(Qe){return Object.getOwnPropertyDescriptor(We,Qe).enumerable})),ie.push.apply(ie,de)}return ie}function me(We){for(var x=1;x<arguments.length;x++){var ie=arguments[x]!=null?arguments[x]:{};x%2?Ee(Object(ie),!0).forEach(function(de){ke(We,de,ie[de])}):Object.getOwnPropertyDescriptors?Object.defineProperties(We,Object.getOwnPropertyDescriptors(ie)):Ee(Object(ie)).forEach(function(de){Object.defineProperty(We,de,Object.getOwnPropertyDescriptor(ie,de))})}return We}function ke(We,x,ie){return x in We?Object.defineProperty(We,x,{value:ie,enumerable:!0,configurable:!0,writable:!0}):We[x]=ie,We}(function(We){We.VERSION="v",We.ORIGIN="o",We.SESSION_NAME="s",We.INFORMATION="i",We.URI="u",We.EMAIL="e",We.PHONE="p",We.CONNECTION="c",We.BANDWIDTH="b",We.TIME="t",We.REPEAT="r",We.ZONE_ADJUSTMENTS="z",We.KEY="k",We.ATTRIBUTE="a",We.MEDIA="m"})(E||(E={}));class Ye{consumeText(x,ie){let de=ie;for(;de<x.length;){const Qe=x[de];if(Qe==="\0"||Qe==="\r"||Qe===h)break;de+=1}if(de-ie==0)throw new Error("Invalid text, at ".concat(x));return de}consumeUnicastAddress(x,ie,de){return this.consumeTill(x,ie,_)}consumeOneOrMore(x,ie,de){let Qe=ie;for(;de(x[Qe]);)Qe++;if(Qe-ie==0)throw new Error("Invalid rule at ".concat(ie,"."));return Qe}consumeSpace(x,ie){if(x[ie]===_)return ie+1;throw new Error("Invalid space at ".concat(ie,"."))}consumeIP4Address(x,ie){let de=ie;for(let Qe=0;Qe<4;Qe++)if(de=this.consumeDecimalUChar(x,de),Qe!==3){if(x[de]!==".")throw new Error("Invalid IP4 address.");de++}return de}consumeDecimalUChar(x,ie){let de=ie;for(let $t=0;$t<3&&S(x[de]);$t++,de++);if(de-ie==0)throw new Error("Invalid decimal uchar.");const Qe=parseInt(x.slice(ie,de));if(Qe>=0&&Qe<=255)return de;throw new Error("Invalid decimal uchar")}consumeIP6Address(x,ie){let de=this.consumeHexpart(x,ie);return x[de]===":"&&(de+=1,de=this.consumeIP4Address(x,de)),de}consumeHexpart(x,ie){let de=ie;if(x[de]===":"&&x[de+1]===":"){de+=2;try{de=this.consumeHexseq(x,de)}catch{}return de}if(de=this.consumeHexseq(x,de),x[de]===":"&&x[de+1]===":"){de+=2;try{de=this.consumeHexseq(x,de)}catch{}return de}return de}consumeHexseq(x,ie){let de=ie;for(;de=this.consumeHex4(x,de),x[de]===":"&&x[de+1]!==":";)de+=1;return de}consumeHex4(x,ie){let de=0;for(;de<4;de++)if(!((Qe=x[ie+de])>="0"&&Qe<="9"||Qe>="a"&&Qe<="f"||Qe>="A"&&Qe<="F")){if(de===0)throw new Error("Invalid hex 4");break}var Qe;return ie+de}consumeFQDN(x,ie){let de=ie;for(;S(x[de])||U(x[de])||x[de]==="-"||x[de]===".";)de+=1;if(de-ie<4)throw new Error("Invalid FQDN");return de}consumeExtnAddr(x,ie){return this.consumeOneOrMore(x,ie,P)}consumeMulticastAddress(x,ie,de){switch(de){case"IP4":case"ip4":return this.consumeIP4MulticastAddress(x,ie);case"IP6":case"ip6":return this.consumeIP6MulticastAddress(x,ie);default:try{return this.consumeFQDN(x,ie)}catch{return this.consumeExtnAddr(x,ie)}}}consumeIP6MulticastAddress(x,ie){const de=this.consumeHexpart(x,ie);return x[de]==="/"?this.consumeInteger(x,de+1):de}consumeIP4MulticastAddress(x,ie){let de=ie+3;const Qe=x.slice(ie,de),$t=parseInt(Qe);if($t<224||$t>239)throw new Error("Invalid IP4 multicast address, IPv4 multicast addresses may be in the range 224.0.0.0 to 239.255.255.255.");for(let tr=0;tr<3;tr++){if(x[de]!==".")throw new Error("Invalid IP4 multicast address.");de+=1,de=this.consumeDecimalUChar(x,de)}return x[de]==="/"&&(de+=1),de=this.consumeTTL(x,de),x[de]==="/"&&(de=this.consumeInteger(x,de)),de}consumeInteger(x,ie){if(!z(x[ie]))throw new Error("Invalid integer.");for(ie+=1;S(x[ie]);)ie+=1;return ie}consumeTTL(x,ie){if(x[ie]==="0")return ie+1;if(!z(x[ie]))throw new Error("Invalid TTL.");ie+=1;for(let de=0;de<2&&S(x[ie]);de++)ie+=1;return ie}consumeToken(x,ie){return this.consumeOneOrMore(x,ie,k)}consumeTime(x,ie){let de=ie;if(x[de]==="0")return de+1;for(z(x[de])&&(de+=1);S(x[de]);)de++;if(de-ie<10)throw new Error("Invalid time");return de}consumeAddress(x,ie){return this.consumeTill(x,ie,_)}consumeTypedTime(x,ie){let de=ie;return de=this.consumeOneOrMore(x,de,S),F(x[de])?de+1:de}consumeRepeatInterval(x,ie){if(!z(x[ie]))throw new Error("Invalid repeat interval");for(ie+=1;S(x[ie]);)ie+=1;return F(x[ie])&&(ie+=1),ie}consumePort(x,ie){return this.consumeOneOrMore(x,ie,S)}consume(x,ie,de){for(let Qe=0;Qe<de.length;Qe++){if(ie+Qe>=x.length)throw new Error("consume exceeding value length");if(x[ie+Qe]!==de[Qe])throw new Error("consume ".concat(de," failed at ").concat(Qe))}return ie+de.length}consumeTill(x,ie,de){let Qe=ie;for(;Qe<x.length&&(typeof de!="string"||x[Qe]!==de)&&(typeof de!="function"||!de(x[Qe]));)Qe++;return Qe}}class ut extends Ye{constructor(){super(),ke(this,"records",[]),ke(this,"currentLine",0)}parse(x){const ie=this.probeEOL(x);this.records=x.split(ie).filter(sy=>!!eo(sy).call(sy)).map(this.parseLine),this.currentLine=0;const de=this.parseVersion(),Qe=this.parseOrigin(),$t=this.parseSessionName(),tr=this.parseInformation(),$i=this.parseUri(),Oa=this.parseEmail(),ap=this.parsePhone(),iy=this.parseConnection(),rw=this.parseBandWidth(),iO=this.parseTimeFields(),sO=this.parseKey(),Cl=this.parseSessionAttribute(),$m=this.parseMediaDescription();if(this.currentLine!==this.records.length)throw new Error("parsing failed, non exhaustive sdp lines.");return{version:de,origin:Qe,sessionName:$t,information:tr,uri:$i,emails:Oa,phones:ap,connection:iy,bandwidths:rw,timeFields:iO,key:sO,attributes:Cl,mediaDescriptions:$m}}getCurrentRecord(){const x=this.records[this.currentLine];if(!x)throw new Error("Record doesn't exit.");return x}probeEOL(x){for(let ie=0;ie<x.length;ie++)if(x[ie]===h)return x[ie-1]==="\r"?m:h;throw new Error("Invalid newline character.")}parseLine(x,ie){if(x.length<2)throw new Error("Invalid sdp line, sdp line should be of form <type>=<value>.");const de=x[0];if(x[1]!=="=")throw new Error('Invalid sdp line, <type> should be a single character followed by an "=" sign.');return{type:de,value:x.slice(2),line:ie,cur:0}}parseSessionAttribute(){const x=new vn;for(;this.currentLine<this.records.length;){const ie=this.getCurrentRecord();if(ie.type!==E.ATTRIBUTE)break;const de={attField:this.extractOneOrMore(ie,Qe=>k(Qe)&&Qe!==":"),_cur:0};ie.value[ie.cur]===":"&&(ie.cur+=1,de.attValue=this.extractOneOrMore(ie,q)),x.parse(de),this.currentLine++}return x.digest()}parseMediaAttributes(x){const ie=new Sn(x);for(;this.currentLine<this.records.length;){const de=this.getCurrentRecord();if(de.type!==E.ATTRIBUTE)break;const Qe={attField:this.extractOneOrMore(de,$t=>k($t)&&$t!==":"),_cur:0};de.value[de.cur]===":"&&(de.cur+=1,Qe.attValue=this.extractOneOrMore(de,q)),ie.parse(Qe),this.currentLine++}return ie.digest()}parseKey(){const x=this.getCurrentRecord();if(x.type===E.KEY){if(x.value==="prompt"||x.value==="clear:"||x.value==="base64:"||x.value==="uri:")return x.value;throw this.currentLine++,new Error("Invalid key.")}}parseZone(){const x=this.getCurrentRecord();if(x.type===E.ZONE_ADJUSTMENTS){const ie=[];for(;;)try{const de=this.extract(x,this.consumeTime);this.consumeSpaceForRecord(x);let Qe=!1;x.value[x.cur]==="-"&&(Qe=!0,x.cur+=1);const $t=this.extract(x,this.consumeTypedTime);ie.push({time:de,typedTime:$t,back:Qe})}catch{break}if(ie.length===0)throw new Error("Invalid zone adjustments");return this.currentLine++,ie}return[]}parseRepeat(){const x=[];for(;;){const ie=this.getCurrentRecord();if(ie.type!==E.REPEAT)break;{const de=this.extract(ie,this.consumeRepeatInterval),Qe=this.parseTypedTime(ie);x.push({repeatInterval:de,typedTimes:Qe}),this.currentLine++}}return x}parseTypedTime(x){const ie=[];for(;;)try{this.consumeSpaceForRecord(x),ie.push(this.extract(x,this.consumeTypedTime))}catch{break}if(ie.length===0)throw new Error("Invalid typed time.");return ie}parseTime(){const x=this.getCurrentRecord(),ie=this.extract(x,this.consumeTime);this.consumeSpaceForRecord(x);const de=this.extract(x,this.consumeTime);return this.currentLine++,{startTime:ie,stopTime:de}}parseBandWidth(){const x=[];for(;this.currentLine<this.records.length;){const ie=this.getCurrentRecord();if(ie.type!==E.BANDWIDTH)break;{const de=this.extractOneOrMore(ie,k);if(ie.value[ie.cur]!==":")throw new Error("Invalid bandwidth field.");ie.cur++;const Qe=this.extractOneOrMore(ie,S);x.push({bwtype:de,bandwidth:Qe}),this.currentLine++}}return x}parseVersion(){const x=this.getCurrentRecord();if(x.type!==E.VERSION)throw new Error("first sdp record must be version");const ie=x.value.slice(0,this.consumeOneOrMore(x.value,0,S));if(ie.length!==x.value.length)throw new Error('invalid proto version, "v='.concat(x.value,'"'));return this.currentLine++,ie}parseOrigin(){const x=this.getCurrentRecord();if(x.type!==E.ORIGIN)throw new Error("second line of sdp must be origin");const ie=this.extractOneOrMore(x,P);this.consumeSpaceForRecord(x);const de=this.extractOneOrMore(x,S);this.consumeSpaceForRecord(x);const Qe=this.extractOneOrMore(x,S);this.consumeSpaceForRecord(x);const $t=this.extractOneOrMore(x,k);this.consumeSpaceForRecord(x);const tr=this.extractOneOrMore(x,k);this.consumeSpaceForRecord(x);const $i=this.extract(x,this.consumeUnicastAddress);return this.currentLine++,{username:ie,sessId:de,sessVersion:Qe,nettype:$t,addrtype:tr,unicastAddress:$i}}parseSessionName(){const x=this.getCurrentRecord();if(x.type===E.SESSION_NAME){const ie=this.extract(x,this.consumeText);return this.currentLine++,ie}}parseInformation(){const x=this.getCurrentRecord();if(x.type!==E.INFORMATION)return;const ie=this.extract(x,this.consumeText);return this.currentLine++,ie}parseUri(){const x=this.getCurrentRecord();if(x.type===E.URI)return this.currentLine++,x.value}parseEmail(){const x=[];for(;;){const ie=this.getCurrentRecord();if(ie.type!==E.EMAIL)break;x.push(ie.value),this.currentLine++}return x}parsePhone(){const x=[];for(;;){const ie=this.getCurrentRecord();if(ie.type!==E.PHONE)break;x.push(ie.value),this.currentLine++}return x}parseConnection(){const x=this.getCurrentRecord();if(x.type===E.CONNECTION){const ie=this.extractOneOrMore(x,k);this.consumeSpaceForRecord(x);const de=this.extractOneOrMore(x,k);this.consumeSpaceForRecord(x);const Qe=this.extract(x,this.consumeAddress);return this.currentLine++,{nettype:ie,addrtype:de,address:Qe}}}parseMedia(){const x=this.getCurrentRecord(),ie=this.extract(x,this.consumeToken);this.consumeSpaceForRecord(x);let de=this.extract(x,this.consumePort);x.value[x.cur]==="/"&&(x.cur+=1,de+=this.extract(x,this.consumeInteger)),this.consumeSpaceForRecord(x);const Qe=[];for(Qe.push(this.extract(x,this.consumeToken));x.value[x.cur]==="/";)x.cur+=1,Qe.push(this.extract(x,this.consumeToken));if(Qe.length===0)throw new Error("Invalid proto");const $t=this.parseFmt(x);return this.currentLine++,{mediaType:ie,port:de,protos:Qe,fmts:$t}}parseTimeFields(){const x=[];for(;this.getCurrentRecord().type===E.TIME;){const ie=this.parseTime(),de=this.parseRepeat(),Qe=this.parseZone();x.push({time:ie,repeats:de,zones:Qe})}return x}parseMediaDescription(){const x=[];for(;this.currentLine<this.records.length&&this.getCurrentRecord().type===E.MEDIA;){const ie=this.parseMedia(),de=this.parseInformation(),Qe=this.parseConnections(),$t=this.parseBandWidth(),tr=this.parseKey(),$i=this.parseMediaAttributes(ie);x.push({media:ie,information:de,connections:Qe,bandwidths:$t,key:tr,attributes:$i})}return x}parseConnections(){const x=[];for(;this.currentLine<this.records.length&&this.getCurrentRecord().type===E.CONNECTION;)x.push(this.parseConnection());return x}parseFmt(x){const ie=[];for(;;)try{this.consumeSpaceForRecord(x),ie.push(this.extract(x,this.consumeToken))}catch{break}if(ie.length===0)throw new Error("Invalid fmts");return ie}extract(x,ie){for(var de=arguments.length,Qe=new Array(de>2?de-2:0),$t=2;$t<de;$t++)Qe[$t-2]=arguments[$t];const tr=ie.call(this,x.value,x.cur,...Qe),$i=x.value.slice(x.cur,tr);return x.cur=tr,$i}extractOneOrMore(x,ie){const de=this.consumeOneOrMore(x.value,x.cur,ie),Qe=x.value.slice(x.cur,de);return x.cur=de,Qe}consumeSpaceForRecord(x){if(x.value[x.cur]!==_)throw new Error("Invalid space at ".concat(x.cur,"."));x.cur+=1}}class pt extends Ye{constructor(){super(...arguments),ke(this,"attributes",void 0),ke(this,"digested",!1)}extractOneOrMore(x,ie,de){const Qe=this.consumeOneOrMore(x.attValue,x._cur,ie),$t=x.attValue.slice(x._cur,Qe),[tr,$i]=de||[];if(typeof tr=="number"&&$t.length<tr)throw new Error("error in length, should be more or equal than ".concat(tr," characters."));if(typeof $i=="number"&&$t.length>$i)throw new Error("error in length, should be less or equal than ".concat($i," characters."));return x._cur=Qe,$t}consumeAttributeSpace(x){if(x.attValue[x._cur]!==_)throw new Error("Invalid space at ".concat(x._cur,"."));x._cur+=1}extract(x,ie){if(!x.attValue)throw new Error("Nothing to extract from attValue.");for(var de=arguments.length,Qe=new Array(de>2?de-2:0),$t=2;$t<de;$t++)Qe[$t-2]=arguments[$t];const tr=ie.call(this,x.attValue,x._cur,...Qe),$i=x.attValue.slice(x._cur,tr);return x._cur=tr,$i}atEnd(x){if(!x.attValue)throw new Error;return x._cur>=x.attValue.length}peekChar(x){if(!x.attValue)throw new Error;return x.attValue[x._cur]}peek(x,ie){if(!x.attValue)throw new Error;for(let de=0;de<ie.length;de++)if(ie[de]!==x.attValue[x._cur+de])return!1;return!0}parseIceUfrag(x){if(this.attributes.iceUfrag)throw new Error("Invalid ice-ufrag, should be only a single line if 'a=ice-ufrag'");this.attributes.iceUfrag=this.extractOneOrMore(x,Y,[4,256])}parseIcePwd(x){if(this.attributes.icePwd)throw new Error("Invalid ice-pwd, should be only a single line if 'a=ice-pwd'");this.attributes.icePwd=this.extractOneOrMore(x,Y,[22,256])}parseIceOptions(x){if(this.attributes.iceOptions)throw new Error("Invalid ice-options, should be only one 'ice-options' line");const ie=[];for(;!this.atEnd(x);){ie.push(this.extractOneOrMore(x,Y));try{this.consumeAttributeSpace(x)}catch(de){if(this.atEnd(x))break;throw de}}this.attributes.iceOptions=ie}parseFingerprint(x){const ie=this.extract(x,this.consumeToken);this.consumeAttributeSpace(x);const de=this.extract(x,this.consumeTill);this.attributes.fingerprints.push({hashFunction:ie,fingerprint:de})}parseExtmap(x){const ie=this.extractOneOrMore(x,S);let de;this.peekChar(x)==="/"&&(this.extract(x,this.consume,"/"),de=this.extract(x,this.consumeToken)),this.consumeAttributeSpace(x);const Qe=this.extract(x,this.consumeTill,_),$t=me(me({entry:parseInt(ie,10)},de&&{direction:de}),{},{extensionName:Qe});this.peekChar(x)===_&&(this.consumeAttributeSpace(x),$t.extensionAttributes=this.extract(x,this.consumeTill)),this.attributes.extmaps.push($t)}parseSetup(x){if(this.attributes.setup)throw new Error("must only be one single 'a=setup' line.");const ie=this.extract(x,this.consumeTill);if(ie!=="active"&&ie!=="passive"&&ie!=="actpass"&&ie!=="holdconn")throw new Error("role must be one of 'active', 'passive', 'actpass', 'holdconn'.");this.attributes.setup=ie}}class vn extends pt{constructor(){super(...arguments),ke(this,"attributes",{unrecognized:[],groups:[],extmaps:[],fingerprints:[],identities:[]})}parse(x){if(this.digested)throw new Error("already digested");try{switch(x.attField){case"group":this.parseGroup(x);break;case"ice-lite":this.parseIceLite();break;case"ice-ufrag":this.parseIceUfrag(x);break;case"ice-pwd":this.parseIcePwd(x);break;case"ice-options":this.parseIceOptions(x);break;case"fingerprint":this.parseFingerprint(x);break;case"setup":this.parseSetup(x);break;case"tls-id":this.parseTlsId(x);break;case"identity":this.parseIdentity(x);break;case"extmap":this.parseExtmap(x);break;case"msid-semantic":this.parseMsidSemantic(x);break;default:x.ignored=!0,this.attributes.unrecognized.push(x)}}catch(ie){throw console.error("parsing session attribute ".concat(x.attField,' error, "a=').concat(x.attField,":").concat(x.attValue,'"')),ie}if(!x.ignored&&x.attValue&&!this.atEnd(x))throw new Error("attribute parsing error")}digest(){return this.digested=!0,this.attributes}parseGroup(x){const ie=this.extract(x,this.consumeToken),de=[];for(;!this.atEnd(x)&&this.peekChar(x)===_;)this.consumeAttributeSpace(x),de.push(this.extract(x,this.consumeToken));this.attributes.groups.push({semantic:ie,identificationTag:de})}parseIceLite(){if(this.attributes.iceLite)throw new Error("Invalid ice-lite, should be only a single line of 'a=ice-lite'");this.attributes.iceLite=!0}parseTlsId(x){if(this.attributes.tlsId)throw new Error("must be only one tld-id line");this.attributes.tlsId=this.extractOneOrMore(x,le)}parseIdentity(x){const ie=this.extractOneOrMore(x,ye),de=[];for(;!this.atEnd(x)&&this.peekChar(x)===_;){this.consumeAttributeSpace(x);const Qe=this.extract(x,this.consumeToken);this.extract(x,this.consume,"=");const $t=this.extractOneOrMore(x,tr=>tr!==_&&q(tr));de.push({name:Qe,value:$t})}this.attributes.identities.push({assertionValue:ie,extensions:de})}parseMsidSemantic(x){this.peekChar(x)===_&&this.consumeAttributeSpace(x);const ie={semantic:this.extract(x,this.consumeToken),identifierList:[]};for(;;){try{this.consumeAttributeSpace(x)}catch{break}if(this.peekChar(x)==="*"){this.extract(x,this.consume,"*"),ie.applyForAll=!0;break}{const de=this.extract(x,this.consumeTill,_);ie.identifierList.push(de)}}this.attributes.msidSemantic=ie}}class Sn extends pt{constructor(x){super(),ke(this,"attributes",void 0),x.protos.indexOf("RTP")!==-1||x.protos.indexOf("rtp"),this.attributes={unrecognized:[],candidates:[],extmaps:[],fingerprints:[],imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:[],ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:[]}}parse(x){if(this.digested)throw new Error("already digested");try{switch(x.attField){case"extmap":this.parseExtmap(x);break;case"setup":this.parseSetup(x);break;case"ice-ufrag":this.parseIceUfrag(x);break;case"ice-pwd":this.parseIcePwd(x);break;case"ice-options":this.parseIceOptions(x);break;case"candidate":this.parseCandidate(x);break;case"remote-candidate":this.parseRemoteCandidate(x);break;case"end-of-candidates":this.parseEndOfCandidates();break;case"fingerprint":this.parseFingerprint(x);break;case"rtpmap":this.parseRtpmap(x);break;case"ptime":this.parsePtime(x);break;case"maxptime":this.parseMaxPtime(x);break;case"sendrecv":case"recvonly":case"sendonly":case"inactive":this.parseDirection(x);break;case"ssrc":this.parseSSRC(x);break;case"fmtp":this.parseFmtp(x);break;case"rtcp-fb":this.parseRtcpFb(x);break;case"rtcp-mux":this.parseRTCPMux();break;case"rtcp-mux-only":this.parseRTCPMuxOnly();break;case"rtcp-rsize":this.parseRTCPRsize();break;case"rtcp":this.parseRTCP(x);break;case"mid":this.parseMid(x);break;case"msid":this.parseMsid(x);break;case"imageattr":this.parseImageAttr(x);break;case"rid":this.parseRid(x);break;case"simulcast":this.parseSimulcast(x);break;case"sctp-port":this.parseSctpPort(x);break;case"max-message-size":this.parseMaxMessageSize(x);break;case"ssrc-group":this.parseSSRCGroup(x);break;default:x.ignored=!0,this.attributes.unrecognized.push(x)}}catch(ie){throw console.error("parsing media attribute ".concat(x.attField,' error, "a=').concat(x.attField,":").concat(x.attValue,'"')),ie}if(!x.ignored&&x.attValue&&!this.atEnd(x))throw new Error("attribute parsing error")}parseCandidate(x){const ie=this.extractOneOrMore(x,Y,[1,32]);this.consumeAttributeSpace(x);const de=this.extractOneOrMore(x,S,[1,5]);this.consumeAttributeSpace(x);const Qe=this.extract(x,this.consumeToken);this.consumeAttributeSpace(x);const $t=this.extractOneOrMore(x,S,[1,10]);this.consumeAttributeSpace(x);const tr=this.extract(x,this.consumeAddress);this.consumeAttributeSpace(x);const $i=this.extract(x,this.consumePort);this.consumeAttributeSpace(x),this.extract(x,this.consume,"typ"),this.consumeAttributeSpace(x);const Oa={foundation:ie,componentId:de,transport:Qe,priority:$t,connectionAddress:tr,port:$i,type:this.extract(x,this.consumeToken),extension:{}};for(this.peek(x," raddr")&&(this.extract(x,this.consume," raddr"),this.consumeAttributeSpace(x),Oa.relAddr=this.extract(x,this.consumeAddress)),this.peek(x," rport")&&(this.extract(x,this.consume," rport"),this.consumeAttributeSpace(x),Oa.relPort=this.extract(x,this.consumePort));this.peekChar(x)===_;){this.consumeAttributeSpace(x);const ap=this.extract(x,this.consumeToken);this.consumeAttributeSpace(x),Oa.extension[ap]=this.extractOneOrMore(x,R)}this.attributes.candidates.push(Oa)}parseRemoteCandidate(x){const ie=[];for(;;){const de=this.extractOneOrMore(x,S,[1,5]);this.consumeAttributeSpace(x);const Qe=this.extract(x,this.consumeAddress);this.consumeAttributeSpace(x);const $t=this.extract(x,this.consumePort);ie.push({componentId:de,connectionAddress:Qe,port:$t});try{this.consumeAttributeSpace(x)}catch{break}}this.attributes.remoteCandidatesList.push(ie)}parseEndOfCandidates(){if(this.attributes.endOfCandidates)throw new Error("must be only one line of end-of-candidates");this.attributes.endOfCandidates=!0}parseRtpmap(x){const ie=this.extract(x,this.consumeToken);this.consumeAttributeSpace(x);const de=this.extract(x,this.consumeTill,"/");this.extract(x,this.consume,"/");const Qe={encodingName:de,clockRate:this.extractOneOrMore(x,S)};this.atEnd(x)||this.peekChar(x)!=="/"||(this.extract(x,this.consume,"/"),Qe.encodingParameters=parseInt(this.extract(x,this.consumeTill),10));const $t=this.attributes.payloads.find(tr=>tr.payloadType===parseInt(ie,10));$t?$t.rtpMap=Qe:this.attributes.payloads.push({payloadType:parseInt(ie,10),rtpMap:Qe,rtcpFeedbacks:[]})}parsePtime(x){if(this.attributes.ptime)throw new Error("must be only one line of ptime");this.attributes.ptime=this.extract(x,this.consumeTill)}parseMaxPtime(x){if(this.attributes.maxPtime)throw new Error("must be only one line of ptime");this.attributes.maxPtime=this.extract(x,this.consumeTill)}parseDirection(x){if(this.attributes.direction)throw new Error("must be only one line of direction info");this.attributes.direction=x.attField}parseSSRC(x){const ie=this.extractOneOrMore(x,S);this.consumeAttributeSpace(x);const de=this.extract(x,this.consumeTill,":");let Qe;this.peekChar(x)===":"&&(this.extract(x,this.consume,":"),Qe=this.extract(x,this.consumeTill));const $t=this.attributes.ssrcs.find(tr=>tr.ssrcId===parseInt(ie,10));$t?$t.attributes[de]=Qe:this.attributes.ssrcs.push({ssrcId:parseInt(ie,10),attributes:{[de]:Qe}})}parseFmtp(x){const ie=this.extract(x,this.consumeTill,_);this.consumeAttributeSpace(x);const de=this.extract(x,this.consumeTill),Qe={};de.split(";").forEach(tr=>{let[$i,Oa]=tr.split("=");$i=eo($i).call($i);const ap=typeof Oa=="string"?eo(Oa).call(Oa):null;typeof $i=="string"&&$i.length>0&&(Qe[$i]=ap)});const $t=this.attributes.payloads.find(tr=>tr.payloadType===parseInt(ie,10));$t?$t.fmtp={parameters:Qe}:this.attributes.payloads.push({payloadType:parseInt(ie,10),rtcpFeedbacks:[],fmtp:{parameters:Qe}})}parseFmtParameters(x){const ie={},de=this.extract(x,this.consumeTill,"=");x._cur++;const Qe=this.extract(x,this.consumeTill,";");for(ie[de]=Qe;x.attValue[x._cur]===";";){const $t=this.extract(x,this.consumeTill,"=");x._cur++;const tr=this.extract(x,this.consumeTill,";");ie[$t]=tr}return ie}parseRtcpFb(x){let ie="";ie=this.peekChar(x)==="*"?this.extract(x,this.consume,"*"):this.extract(x,this.consumeTill,_),this.consumeAttributeSpace(x);const de=this.extract(x,this.consumeTill,_);let Qe;if(de==="trr-int")Qe={type:de,interval:this.extract(x,this.consumeTill)};else{const $t={type:de};this.peekChar(x)===_&&(this.consumeAttributeSpace(x),$t.parameter=this.extract(x,this.consumeToken),this.peekChar(x)===_&&($t.additional=this.extract(x,this.consumeTill))),Qe=$t}if(ie==="*")this.attributes.rtcpFeedbackWildcards.push(Qe);else{const $t=this.attributes.payloads.find(tr=>tr.payloadType===parseInt(ie,10));$t?$t.rtcpFeedbacks.push(Qe):this.attributes.payloads.push({payloadType:parseInt(ie,10),rtcpFeedbacks:[Qe]})}}parseRTCPMux(){if(this.attributes.rtcpMux)throw new Error("must be single line of rtcp-mux");this.attributes.rtcpMux=!0}parseRTCPMuxOnly(){if(this.attributes.rtcpMuxOnly)throw new Error("must be single line of rtcp-only");this.attributes.rtcpMuxOnly=!0}parseRTCPRsize(){if(this.attributes.rtcpRsize)throw new Error("must be single line of rtcp-rsize");this.attributes.rtcpRsize=!0}parseRTCP(x){if(this.attributes.rtcp)throw new Error("must be single line of rtcp");const ie={port:this.extract(x,this.consumePort)};this.peekChar(x)===_&&(this.consumeAttributeSpace(x),ie.netType=this.extractOneOrMore(x,k),this.consumeAttributeSpace(x),ie.addressType=this.extractOneOrMore(x,k),this.consumeAttributeSpace(x),ie.address=this.extract(x,this.consumeAddress)),this.attributes.rtcp=ie}parseMsid(x){const ie={id:this.extractOneOrMore(x,k,[1,64])};this.peekChar(x)===_&&(this.consumeAttributeSpace(x),ie.appdata=this.extractOneOrMore(x,k,[1,64])),this.attributes.msids.push(ie)}parseImageAttr(x){this.attributes.imageattr.push(x.attValue)}parseRid(x){const ie=this.extractOneOrMore(x,Qe=>U(Qe)||S(Qe)||Qe==="_"||Qe==="-");this.consumeAttributeSpace(x);const de={id:ie,direction:this.extract(x,this.consumeToken),params:[]};if(this.peekChar(x)===_){if(this.consumeAttributeSpace(x),this.peek(x,"pt=")){this.extract(x,this.consume,"pt=");const Qe=[];for(;;){const $t=this.extract(x,this.consumeToken);Qe.push($t);try{this.extract(x,this.consume,",")}catch{break}}de.payloads=Qe,this.peekChar(x)===_&&this.extract(x,this.consume,_)}for(;;){const Qe=this.extract(x,this.consumeToken);switch(Qe){case"depend":{const $t={type:Qe,rids:this.extract(x,this.consume,"=").split(",")};de.params.push($t);break}default:{const $t={type:Qe};this.peekChar(x)==="="&&(this.extract(x,this.consume,"="),$t.val=this.extract(x,this.consumeTill,";")),de.params.push($t)}}try{this.extract(x,this.consume,";")}catch{break}}}this.attributes.rids.push(de)}parseSimulcast(x){if(this.attributes.simulcast)throw new Error("must be single line of simulcast");this.attributes.simulcast=x.attValue,this.extract(x,this.consumeTill)}parseSctpPort(x){this.attributes.sctpPort=this.extractOneOrMore(x,S,[1,5])}parseMaxMessageSize(x){this.attributes.maxMessageSize=this.extractOneOrMore(x,S,[1,void 0])}digest(){return this.digested=!0,this.attributes}parseMid(x){this.attributes.mid=this.extract(x,this.consumeToken)}parseSSRCGroup(x){const ie=this.extract(x,this.consumeToken),de=[];for(;;)try{this.consumeAttributeSpace(x);const Qe=this.extract(x,this.consumeInteger);de.push(parseInt(Qe,10))}catch{break}this.attributes.ssrcGroups.push({semantic:ie,ssrcIds:de})}}function cr(We,x,ie){return x in We?Object.defineProperty(We,x,{value:ie,enumerable:!0,configurable:!0,writable:!0}):We[x]=ie,We}class ei{constructor(){cr(this,"eol",m)}print(x,ie){let de="";return ie&&(this.eol=ie),de+=this.printVersion(x.version),de+=this.printOrigin(x.origin),de+=this.printSessionName(x.sessionName),de+=this.printInformation(x.information),de+=this.printUri(x.uri),de+=this.printEmail(x.emails),de+=this.printPhone(x.phones),de+=this.printConnection(x.connection),de+=this.printBandwidth(x.bandwidths),de+=this.printTimeFields(x.timeFields),de+=this.printKey(x.key),de+=this.printSessionAttributes(x.attributes),de+=this.printMediaDescription(x.mediaDescriptions),de}printVersion(x){return"v=".concat(x).concat(this.eol)}printOrigin(x){return"o=".concat(x.username," ").concat(x.sessId," ").concat(x.sessVersion," ").concat(x.nettype," ").concat(x.addrtype," ").concat(x.unicastAddress).concat(this.eol)}printSessionName(x){return x?"s=".concat(x).concat(this.eol):""}printInformation(x){return x?"i=".concat(x).concat(this.eol):""}printUri(x){return x?"u=".concat(x).concat(this.eol):""}printEmail(x){let ie="";for(const de of x)ie+="e=".concat(de).concat(this.eol);return ie}printPhone(x){let ie="";for(const de of x)ie+="e=".concat(de).concat(this.eol);return ie}printConnection(x){return x?"c=".concat(x.nettype," ").concat(x.addrtype," ").concat(x.address).concat(this.eol):""}printBandwidth(x){let ie="";for(const de of x)ie+="b=".concat(de.bwtype,":").concat(de.bandwidth).concat(this.eol);return ie}printTimeFields(x){let ie="";for(const de of x){ie+="t=".concat(de.time.startTime," ").concat(de.time.startTime).concat(this.eol);for(const Qe of de.repeats)ie+="r=".concat(Qe.repeatInterval," ").concat(Qe.typedTimes.join(" ")).concat(this.eol);de.zoneAdjustments&&(ie+="z=",ie+="z=".concat(de.zoneAdjustments.map(Qe=>"".concat(Qe.time," ").concat(Qe.back?"-":""," ").concat(Qe.typedTime)).join(" ")).concat(this.eol),ie+=this.eol)}return ie}printKey(x){return x?"k=".concat(x).concat(this.eol):""}printAttributes(x){let ie="";for(const de of x)ie+="a=".concat(de.attField).concat(de.attValue?":".concat(de.attValue):"").concat(this.eol);return ie}printMediaDescription(x){let ie="";for(const de of x)ie+=this.printMedia(de.media),ie+=this.printInformation(de.information),ie+=this.printConnections(de.connections),ie+=this.printBandwidth(de.bandwidths),ie+=this.printKey(de.key),ie+=this.printMediaAttributes(de);return ie}printConnections(x){let ie="";for(const de of x)ie+=this.printConnection(de);return ie}printMedia(x){return"m=".concat(x.mediaType," ").concat(x.port," ").concat(x.protos.join("/")," ").concat(x.fmts.join(" ")).concat(this.eol)}printSessionAttributes(x){return new Qo(this.eol).print(x)}printMediaAttributes(x){return new je(this.eol).print(x)}}class Wr{constructor(x){cr(this,"eol",void 0),this.eol=x}printIceUfrag(x){return x===void 0?"":"a=ice-ufrag:".concat(x).concat(this.eol)}printIcePwd(x){return x===void 0?"":"a=ice-pwd:".concat(x).concat(this.eol)}printIceOptions(x){return x===void 0?"":"a=ice-options:".concat(x.join(_)).concat(this.eol)}printFingerprints(x){return x.length>0?x.map(ie=>"a=fingerprint:".concat(ie.hashFunction).concat(_).concat(ie.fingerprint)).join(this.eol)+this.eol:""}printExtmap(x){return x.map(ie=>"a=extmap:".concat(ie.entry).concat(ie.direction?"/".concat(ie.direction):"").concat(_).concat(ie.extensionName).concat(ie.extensionAttributes?"".concat(_).concat(ie.extensionAttributes):"").concat(this.eol)).join("")}printSetup(x){return x===void 0?"":"a=setup:".concat(x).concat(this.eol)}printUnrecognized(x){return x.map(ie=>"a=".concat(ie.attField).concat(ie.attValue?":".concat(ie.attValue):"").concat(this.eol)).join("")}}class Qo extends Wr{print(x){let ie="";return ie+=this.printGroups(x.groups),ie+=this.printMsidSemantic(x.msidSemantic),ie+=this.printIceLite(x.iceLite),ie+=this.printIceUfrag(x.iceUfrag),ie+=this.printIcePwd(x.icePwd),ie+=this.printIceOptions(x.iceOptions),ie+=this.printFingerprints(x.fingerprints),ie+=this.printSetup(x.setup),ie+=this.printTlsId(x.tlsId),ie+=this.printIdentity(x.identities),ie+=this.printExtmap(x.extmaps),ie+=this.printUnrecognized(x.unrecognized),ie}printGroups(x){let ie="";return x.length>0&&(ie+=x.map(de=>"a=group:".concat(de.semantic).concat(de.identificationTag.map(Qe=>"".concat(_).concat(Qe)).join("")).concat(this.eol)).join("")),ie}printIceLite(x){return x===void 0?"":"a=ice-lite"+this.eol}printTlsId(x){return x?"a=tls-id:".concat(x).concat(this.eol):""}printIdentity(x){return x.length===0?"":x.map(ie=>"a=identity:".concat(ie.assertionValue).concat(ie.extensions.map(de=>"".concat(_).concat(de.name).concat(de.value?"=".concat(de.value):"")))).join(this.eol)+this.eol}printMsidSemantic(x){if(!x)return"";let ie="a=msid-semantic:".concat(x.semantic);return x.applyForAll?ie+="".concat(_,"*"):x.identifierList.length>0&&(ie+=x.identifierList.map(de=>"".concat(_).concat(de))),ie+this.eol}}class je extends Wr{print(x){const ie=x.attributes;let de="";return de+=this.printRTCP(ie.rtcp),de+=this.printIceUfrag(ie.iceUfrag),de+=this.printIcePwd(ie.icePwd),de+=this.printIceOptions(ie.iceOptions),de+=this.printCandidates(ie.candidates),de+=this.printRemoteCandidatesList(ie.remoteCandidatesList),de+=this.printEndOfCandidates(ie.endOfCandidates),de+=this.printFingerprints(ie.fingerprints),de+=this.printSetup(ie.setup),de+=this.printMid(ie.mid),de+=this.printExtmap(ie.extmaps),de+=this.printRTPRelated(ie),de+=this.printPtime(ie.ptime),de+=this.printMaxPtime(ie.maxPtime),de+=this.printDirection(ie.direction),de+=this.printSSRCGroups(ie.ssrcGroups),de+=this.printSSRC(ie.ssrcs),de+=this.printRTCPMux(ie.rtcpMux),de+=this.printRTCPMuxOnly(ie.rtcpMuxOnly),de+=this.printRTCPRsize(ie.rtcpRsize),de+=this.printMSId(ie.msids),de+=this.printImageattr(ie.imageattr),de+=this.printRid(ie.rids),de+=this.printSimulcast(ie.simulcast),de+=this.printSCTPPort(ie.sctpPort),de+=this.printMaxMessageSize(ie.maxMessageSize),de+=this.printUnrecognized(ie.unrecognized),de}printCandidates(x){return x.map(ie=>"a=candidate:".concat(ie.foundation).concat(_).concat(ie.componentId).concat(_).concat(ie.transport).concat(_).concat(ie.priority).concat(_).concat(ie.connectionAddress).concat(_).concat(ie.port).concat(_,"typ").concat(_).concat(ie.type).concat(ie.relAddr?"".concat(_,"raddr").concat(_).concat(ie.relAddr):"").concat(ie.relPort?"".concat(_,"rport").concat(_).concat(ie.relPort):"").concat(Object.keys(ie.extension).map(de=>"".concat(_).concat(de).concat(_).concat(ie.extension[de])).join("")).concat(this.eol)).join("")}printRemoteCandidatesList(x){return x.map(ie=>"a=remote-candidates:".concat(ie.join(_)).concat(this.eol)).join("")}printEndOfCandidates(x){return x===void 0?"":"a=end-of-candidates"+this.eol}printRTPRelated(x){if(!x.payloads)return"";const ie=x.payloads;let de="";de+=x.rtcpFeedbackWildcards.map(Qe=>this.printRTCPFeedback("*",Qe)).join("");for(const Qe of ie)de+=this.printRtpMap(Qe.payloadType,Qe.rtpMap),de+=this.printFmtp(Qe.payloadType,Qe.fmtp),de+=Qe.rtcpFeedbacks.map($t=>this.printRTCPFeedback(Qe.payloadType,$t)).join("");return de}printFmtp(x,ie){if(!ie)return"";const de=Object.keys(ie.parameters);return de.length===1&&ie.parameters[de[0]]===null?"a=fmtp:".concat(x).concat(_).concat(de[0]).concat(this.eol):"a=fmtp:".concat(x).concat(_).concat(Object.keys(ie.parameters).map(Qe=>"".concat(Qe,"=").concat(ie.parameters[Qe])).join(";")).concat(this.eol)}printRtpMap(x,ie){return ie?"a=rtpmap:".concat(x).concat(_).concat(ie.encodingName,"/").concat(ie.clockRate).concat(ie.encodingParameters?"/".concat(ie.encodingParameters):"").concat(this.eol):""}printRTCPFeedback(x,ie){let de="a=rtcp-fb:".concat(x).concat(_),Qe=ie;return Qe.type==="trr-int"?de+="ttr-int".concat(_).concat(Qe.interval):(de+="".concat(Qe.type),Qe.parameter&&(de+="".concat(_).concat(Qe.parameter),Qe.additional&&(de+="".concat(_).concat(Qe.additional)))),de+this.eol}printPtime(x){return x===void 0?"":"a=ptime:".concat(x).concat(this.eol)}printMaxPtime(x){return x===void 0?"":"a=maxptime:".concat(x).concat(this.eol)}printDirection(x){return x===void 0?"":"a=".concat(x).concat(this.eol)}printSSRC(x){return x.map(ie=>Object.keys(ie.attributes).map(de=>"a=ssrc:".concat(ie.ssrcId.toString(10)).concat(_).concat(de).concat(ie.attributes[de]?":".concat(ie.attributes[de]):"").concat(this.eol)).join("")).join("")}printRTCPMux(x){return x===void 0?"":"a=rtcp-mux".concat(this.eol)}printRTCPMuxOnly(x){return x===void 0?"":"a=rtcp-mux-only".concat(this.eol)}printRTCPRsize(x){return x===void 0?"":"a=rtcp-rsize".concat(this.eol)}printRTCP(x){if(x===void 0)return"";let ie="a=rtcp:".concat(x.port);return x.netType&&(ie+="".concat(_).concat(x.netType)),x.addressType&&(ie+="".concat(_).concat(x.addressType)),x.address&&(ie+="".concat(_).concat(x.address)),ie+this.eol}printMSId(x){return x.map(ie=>"a=msid:".concat(ie.id).concat(ie.appdata?"".concat(_).concat(ie.appdata):"").concat(this.eol)).join("")}printImageattr(x){return x.map(ie=>"a=imageattr:".concat(ie).concat(this.eol)).join("")}printRid(x){return x.map(ie=>{let de="a=rid:".concat(ie.id).concat(_).concat(ie.direction);return ie.payloads&&(de+="".concat(_,"pt=").concat(ie.payloads.join(","))),ie.params.length>0&&(de+="".concat(_).concat(ie.params.map(Qe=>Qe.type==="depend"?"depend=".concat(Qe.rids.join(",")):"".concat(Qe.type,"=").concat(Qe.val)).join(";"))),de+this.eol}).join("")}printSimulcast(x){return x===void 0?"":"a=simulcast:".concat(x).concat(this.eol)}printSCTPPort(x){return x===void 0?"":"a=sctp-port:".concat(x).concat(this.eol)}printMaxMessageSize(x){return x===void 0?"":"a=max-message-size:".concat(x).concat(this.eol)}printMid(x){return x===void 0?"":"a=mid:".concat(x).concat(this.eol)}printSSRCGroups(x){return x.map(ie=>"a=ssrc-group:".concat(ie.semantic).concat(ie.ssrcIds.map(de=>"".concat(_).concat(de.toString(10))).join("")).concat(this.eol)).join("")}}function st(We){return new ut().parse(We)}function Tt(We,x){return new ei().print(We,x)}}},r={};function s(o){if(r[o])return r[o].exports;var c=r[o]={exports:{}};return t[o](c,c.exports,s),c.exports}return s.d=(o,c)=>{for(var u in c)s.o(c,u)&&!s.o(o,u)&&Object.defineProperty(o,u,{enumerable:!0,get:c[u]})},s.o=(o,c)=>Object.prototype.hasOwnProperty.call(o,c),s.r=o=>{typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(o,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(o,"__esModule",{value:!0})},s(8)})();function Ca(t){return b8.parse(t)}function Pm(t,r){return b8.print(t,r)}var rpe=qa("Array").keys,ipe=Ec,spe=yi,ope=N,ape=rpe,cx=Array.prototype,cpe={DOMTokenList:!0,NodeList:!0},lpe=function(t){var r=t.keys;return t===cx||ope(cx,t)&&r===cx.keys||spe(cpe,ipe(t))?ape:r},Lc=l(lpe);function T8(t,r){var s=Object.keys(t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);r&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(t,c).enumerable})),s.push.apply(s,o)}return s}function rn(t){for(var r=1;r<arguments.length;r++){var s=arguments[r]!=null?arguments[r]:{};r%2?T8(Object(s),!0).forEach(function(o){Ur(t,o,s[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(s)):T8(Object(s)).forEach(function(o){Object.defineProperty(t,o,Object.getOwnPropertyDescriptor(s,o))})}return t}function Ur(t,r,s){return(r=function(o){var c=function(u,h){if(typeof u!="object"||u===null)return u;var m=u[Symbol.toPrimitive];if(m!==void 0){var _=m.call(u,"string");if(typeof _!="object")return _;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(u)}(o);return typeof c=="symbol"?c:String(c)}(r))in t?Object.defineProperty(t,r,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[r]=s,t}const w8=new class extends Pr{constructor(){super(...arguments),Ur(this,"currentUploadLogID",0)}reportLogUploadError(t){const{errorRange:r}=t;r[r.length-1]&&r[r.length-1]>this.currentUploadLogID&&(this.currentUploadLogID=r[r.length-1],this.emit("REPORT_LOG_UPLOAD",t))}};class upe{constructor(r){Ur(this,"logger",void 0),Ur(this,"prefixLists",[]),this.logger=r}debug(){for(var r=arguments.length,s=new Array(r),o=0;o<r;o++)s[o]=arguments[o];this.logger.debug(...this.prefixLists,...s)}info(){for(var r=arguments.length,s=new Array(r),o=0;o<r;o++)s[o]=arguments[o];this.logger.info(...this.prefixLists,...s)}warning(){for(var r=arguments.length,s=new Array(r),o=0;o<r;o++)s[o]=arguments[o];this.logger.warning(...this.prefixLists,...s)}error(){for(var r=arguments.length,s=new Array(r),o=0;o<r;o++)s[o]=arguments[o];this.logger.error(...this.prefixLists,...s)}prefix(r){return this.prefixLists.push(r),this}popPrefix(){return this.prefixLists.pop(),this}}function lx(){const t=new Date;return t.toTimeString().split(" ")[0]+":"+t.getMilliseconds()}function R8(){const t=new Date,r=/((\d+:){2}\d+)/.exec(new Date().toUTCString());return r?(r==null?void 0:r[0])+":"+t.getUTCMilliseconds():t.toTimeString().split(" ")[0]+":"+t.getMilliseconds()}const El={DEBUG:0,INFO:1,WARNING:2,ERROR:3,NONE:4},qA=Date.now(),ST=t=>{for(const r in El)if(Object.prototype.hasOwnProperty.call(El,r)&&El[r]===t)return r;return"DEFAULT"},L=new class{constructor(){Ur(this,"proxyServerURL",void 0),Ur(this,"logLevel",El.DEBUG),Ur(this,"uploadState","collecting"),Ur(this,"uploadLogWaitingList",[]),Ur(this,"uploadLogUploadingList",[]),Ur(this,"uploadErrorCount",0),Ur(this,"currentLogID",0),Ur(this,"url",void 0),Ur(this,"extLog",(t,r)=>{this.appendLogToWaitingList(t,...r)})}debug(){for(var t=arguments.length,r=new Array(t),s=0;s<t;s++)r[s]=arguments[s];const o=[El.DEBUG].concat(r);this.log.apply(this,o)}info(){for(var t=arguments.length,r=new Array(t),s=0;s<t;s++)r[s]=arguments[s];const o=[El.INFO].concat(r);this.log.apply(this,o)}warning(){for(var t=arguments.length,r=new Array(t),s=0;s<t;s++)r[s]=arguments[s];const o=[El.WARNING].concat(r);this.log.apply(this,o)}warn(){this.warning(...arguments)}error(){for(var t=arguments.length,r=new Array(t),s=0;s<t;s++)r[s]=arguments[s];const o=[El.ERROR].concat(r);this.log.apply(this,o)}upload(){for(var t=arguments.length,r=new Array(t),s=0;s<t;s++)r[s]=arguments[s];const o=[El.DEBUG].concat(r);this.uploadLog.apply(this,o)}setLogLevel(t){t=Math.min(Math.max(0,t),4),this.logLevel=t}enableLogUpload(){Xn("UPLOAD_LOG",!0)}disableLogUpload(){Xn("UPLOAD_LOG",!1),this.uploadLogUploadingList=[],this.uploadLogWaitingList=[]}setProxyServer(t){this.proxyServerURL=t}prefix(t){return new upe(this).prefix(t)}log(){for(var t=arguments.length,r=new Array(t),s=0;s<t;s++)r[s]=arguments[s];if(Date.now()-qA<100)return void setTimeout(()=>{this.log(...r)},Date.now()-qA);const o=Math.max(0,Math.min(4,r[0]));if(r[0]=lx()+" Agora-SDK [".concat(ST(o),"]:"),this.appendLogToWaitingList(o,...r),o<this.logLevel)return;const c=lx()+" %cAgora-SDK [".concat(ST(o),"]:");let u=[];if(!re("USE_NEW_LOG"))switch(o){case El.DEBUG:u=[c,"color: #64B5F6;"].concat(r.slice(1)),console.log.apply(console,u);break;case El.INFO:u=[c,"color: #1E88E5; font-weight: bold;"].concat(r.slice(1)),console.log.apply(console,u);break;case El.WARNING:u=[c,"color: #FB8C00; font-weight: bold;"].concat(r.slice(1)),console.warn.apply(console,u);break;case El.ERROR:u=[c,"color: #B00020; font-weight: bold;"].concat(r.slice(1)),console.error.apply(console,u)}}uploadLog(){for(var t=arguments.length,r=new Array(t),s=0;s<t;s++)r[s]=arguments[s];if(Date.now()-qA<100)return void setTimeout(()=>{this.uploadLog(...r)},Date.now()-qA);const o=Math.max(0,Math.min(4,r[0]));r[0]=lx()+" Agora-SDK [".concat(ST(o),"]:"),this.appendLogToWaitingList(o,...r)}appendLogToWaitingList(t){if(!re("UPLOAD_LOG"))return;for(var r=arguments.length,s=new Array(r>1?r-1:0),o=1;o<r;o++)s[o-1]=arguments[o];Array.isArray(s[0])?s[0][0]=R8()+" Agora-SDK [".concat(ST(t),"]:"):s[0]=R8()+" Agora-SDK [".concat(ST(t),"]:");let c="";s.forEach(u=>{typeof u=="object"&&(u=JSON.stringify(u)),c+="".concat(u," ")}),this.uploadLogWaitingList.push({payload_str:c,log_level:t,log_item_id:this.currentLogID++}),this.uploadState==="uploading"&&this.uploadLogUploadingList.length===0&&this.uploadLogInterval()}startUpload(){this.uploadState="uploading",this.uploadLogUploadingList.length===0&&this.uploadLogInterval()}async uploadLogs(){const t=this.uploadLogUploadingList,r={sdk_version:yl,process_id:re("PROCESS_ID"),payload:JSON.stringify(t)};return pd(async()=>{const s=await $o.post(this.url||(this.proxyServerURL?"https://".concat(this.proxyServerURL,"/ls/?h=").concat(re("LOG_UPLOAD_SERVER"),"&p=443&d=upload/v1"):"https://".concat(re("LOG_UPLOAD_SERVER"),"/upload/v1")),r,{responseType:"text"});if(s.data!=="OK"){const o=new Error("unexpected upload log response");throw o.response=s,o}},()=>(this.uploadLogUploadingList=[],!1),s=>{const o={status:-1,message:s.message,errorRange:t.map(c=>c.log_item_id)};return s.response?(o.status=s.response.status,o.data=s.response.data,o.headers=s.response.headers):s.request&&(o.status=s.request.status),w8.reportLogUploadError(o),!0},{timeout:re("UPLOAD_LOG_REQUEST_RETRY_INTERVAL"),maxRetryTimeout:re("UPLOAD_LOG_REQUEST_MAX_RETRY_INTERVAL")})}uploadLogInterval(){this.uploadLogUploadingList.length===0&&this.uploadLogWaitingList.length===0||(this.uploadLogUploadingList.length===0&&(this.uploadLogUploadingList=this.uploadLogWaitingList.splice(0,re("UPLOAD_LOG_LENGTH_EACH_TIME"))),this.uploadLogs().then(()=>{this.uploadErrorCount=0,this.uploadLogWaitingList.length>0&&window.setTimeout(()=>this.uploadLogInterval(),re("UPLOAD_LOG_INTERVAL"))}).catch(t=>{this.uploadErrorCount+=1,this.uploadErrorCount<2?window.setTimeout(()=>this.uploadLogInterval(),re("UPLOAD_LOG_TWICE_RETRY_INTERVAL_V1")):window.setTimeout(()=>this.uploadLogInterval(),re("UPLOAD_LOG_RETRY_INTERVAL_V1"))}))}};var C8;function dpe(t){return ss(t.reportId,"params.reportId",0,100,!1),ss(t.category,"params.category",0,100,!1),ss(t.event,"params.event",0,100,!1),ss(t.label,"params.label",0,100,!1),er(t.value,"params.value",Number.MIN_SAFE_INTEGER,Number.MAX_SAFE_INTEGER,!1),!0}(C8={}).FREE="free",C8.UPLOADING="uploading",function(t){t[t.MISC=0]="MISC",t[t.INTERNAL_EVENT=1]="INTERNAL_EVENT",t[t.PUBLIC_EVENT=2]="PUBLIC_EVENT",t[t.WEB_EVENT=3]="WEB_EVENT",t[t.INTERNAL_API=4]="INTERNAL_API",t[t.WEB_API=5]="WEB_API",t[t.PUBLIC_API=6]="PUBLIC_API"}({});const hpe={sid:"",lts:0,success:null,cname:null,uid:null,peer:null,cid:null,elapse:null,extend:null,vid:0};let Gi=function(t){return t.PUBLISH="publish",t.SUBSCRIBE="subscribe",t.WS_COMPRESSOR_INIT="ws_compressor_init",t.SESSION_INIT="session_init",t.JOIN_CHOOSE_SERVER="join_choose_server",t.REQ_USER_ACCOUNT="req_user_account",t.JOIN_GATEWAY="join_gateway",t.REJOIN_GATEWAY="rejoin_gateway",t.STREAM_SWITCH="stream_switch",t.REQUEST_PROXY_WORKER_MANAGER="request_proxy_worker_manager",t.REQUEST_PROXY_APPCENTER="request_proxy_appcenter",t.FIRST_VIDEO_RECEIVED="first_video_received",t.FIRST_AUDIO_RECEIVED="first_audio_received",t.FIRST_VIDEO_DECODE="first_video_decode",t.FIRST_AUDIO_DECODE="first_audio_decode",t.ON_ADD_AUDIO_STREAM="on_add_audio_stream",t.ON_ADD_VIDEO_STREAM="on_add_video_stream",t.ON_UPDATE_STREAM="on_update_stream",t.ON_REMOVE_STREAM="on_remove_stream",t.USER_ANALYTICS="req_user_analytics",t.PC_STATS="pc_stats",t.UPDATE_REMOTE_RTPCAPABILITIES="update_remote_rtpCapabilities",t.AB_TEST="ab_test",t}({}),Rr=function(t){return t.SESSION="io.agora.pb.Wrtc.Session",t.JOIN_CHOOSE_SERVER="io.agora.pb.Wrtc.JoinChooseServer",t.REQ_USER_ACCOUNT="io.agora.pb.Wrtc.ReqUserAccount",t.JOIN_GATEWAY="io.agora.pb.Wrtc.JoinGateway",t.RE_JOIN_GATEWAY="io.agora.pb.Wrtc.ReJoinGateway",t.PUBLISH="io.agora.pb.Wrtc.Publish",t.SUBSCRIBE="io.agora.pb.Wrtc.Subscribe",t.WS_COMPRESSOR_INIT="io.agora.pb.Wrtc.WsCompressorInit",t.STREAM_SWITCH="io.agora.pb.Wrtc.StreamSwitch",t.AUDIO_SENDING_STOPPED="io.agora.pb.Wrtc.AudioSendingStopped",t.VIDEO_SENDING_STOPPED="io.agora.pb.Wrtc.VideoSendingStopped",t.REQUEST_PROXY_APPCENTER="io.agora.pb.Wrtc.RequestProxyAppCenter",t.REQUEST_PROXY_WORKER_MANAGER="io.agora.pb.Wrtc.RequestProxyWorkerManager",t.API_INVOKE="io.agora.pb.Wrtc.ApiInvoke",t.FIRST_VIDEO_RECEIVED="io.agora.pb.Wrtc.FirstVideoReceived",t.FIRST_AUDIO_RECEIVED="io.agora.pb.Wrtc.FirstAudioReceived",t.FIRST_VIDEO_DECODE="io.agora.pb.Wrtc.FirstVideoDecode",t.FIRST_AUDIO_DECODE="io.agora.pb.Wrtc.FirstAudioDecode",t.ON_ADD_AUDIO_STREAM="io.agora.pb.Wrtc.OnAddAudioStream",t.ON_ADD_VIDEO_STREAM="io.agora.pb.Wrtc.OnAddVideoStream",t.ON_UPDATE_STREAM="io.agora.pb.Wrtc.OnUpdateStream",t.ON_REMOVE_STREAM="io.agora.pb.Wrtc.OnRemoveStream",t.JOIN_CHANNEL_TIMEOUT="io.agora.pb.Wrtc.JoinChannelTimeout",t.PEER_PUBLISH_STATUS="io.agora.pb.Wrtc.PeerPublishStatus",t.WORKER_EVENT="io.agora.pb.Wrtc.WorkerEvent",t.AP_WORKER_EVENT="io.agora.pb.Wrtc.APWorkerEvent",t.JOIN_WEB_PROXY_AP="io.agora.pb.Wrtc.JoinWebProxyAP",t.WEBSOCKET_QUIT="io.agora.pb.Wrtc.WebSocketQuit",t.USER_ANALYTICS="io.agora.pb.Wrtc.UserAnalytics",t.AUTOPLAY_FAILED="io.agora.pb.Wrtc.AutoplayFailed",t.PC_STATS="io.agora.pb.Wrtc.PCStats",t.UPDATE_REMOTE_RTPCAPABILITIES="io.agora.pb.Wrtc.UpdateRemoteRTPCapabilities",t.AB_TEST="io.agora.pb.Wrtc.ABTest",t}({});(function(t){t[t.WORKER_EVENT=156]="WORKER_EVENT",t[t.AP_WORKER_EVENT=160]="AP_WORKER_EVENT"})({});let fpe=function(t){return t[t.SESSION=26]="SESSION",t[t.JOIN_CHOOSE_SERVER=27]="JOIN_CHOOSE_SERVER",t[t.REQ_USER_ACCOUNT=196]="REQ_USER_ACCOUNT",t[t.JOIN_GATEWAY=28]="JOIN_GATEWAY",t[t.PUBLISH=30]="PUBLISH",t[t.SUBSCRIBE=29]="SUBSCRIBE",t[t.WS_COMPRESSOR_INIT=9430]="WS_COMPRESSOR_INIT",t[t.STREAM_SWITCH=32]="STREAM_SWITCH",t[t.AUDIO_SENDING_STOPPED=33]="AUDIO_SENDING_STOPPED",t[t.VIDEO_SENDING_STOPPED=34]="VIDEO_SENDING_STOPPED",t[t.REQUEST_PROXY_APPCENTER=35]="REQUEST_PROXY_APPCENTER",t[t.REQUEST_PROXY_WORKER_MANAGER=36]="REQUEST_PROXY_WORKER_MANAGER",t[t.API_INVOKE=41]="API_INVOKE",t[t.FIRST_VIDEO_RECEIVED=348]="FIRST_VIDEO_RECEIVED",t[t.FIRST_AUDIO_RECEIVED=349]="FIRST_AUDIO_RECEIVED",t[t.FIRST_VIDEO_DECODE=350]="FIRST_VIDEO_DECODE",t[t.FIRST_AUDIO_DECODE=351]="FIRST_AUDIO_DECODE",t[t.ON_ADD_AUDIO_STREAM=352]="ON_ADD_AUDIO_STREAM",t[t.ON_ADD_VIDEO_STREAM=353]="ON_ADD_VIDEO_STREAM",t[t.ON_UPDATE_STREAM=356]="ON_UPDATE_STREAM",t[t.ON_REMOVE_STREAM=355]="ON_REMOVE_STREAM",t[t.JOIN_CHANNEL_TIMEOUT=407]="JOIN_CHANNEL_TIMEOUT",t[t.PEER_PUBLISH_STATUS=408]="PEER_PUBLISH_STATUS",t[t.WORKER_EVENT=156]="WORKER_EVENT",t[t.AP_WORKER_EVENT=160]="AP_WORKER_EVENT",t[t.JOIN_WEB_PROXY_AP=700]="JOIN_WEB_PROXY_AP",t[t.WEBSOCKET_QUIT=671]="WEBSOCKET_QUIT",t[t.USER_ANALYTICS=1e4]="USER_ANALYTICS",t[t.AUTOPLAY_FAILED=9178]="AUTOPLAY_FAILED",t}({});function Mt(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return function(r,s,o){const c=o.value;if(typeof c=="function"){const u=t.className||r.__className__||(r.constructor.name==="AgoraRTCClient"?"Client":r.constructor.name);o.value=function(){for(var h,m=arguments.length,_=new Array(m),E=0;E<m;E++)_[E]=arguments[E];let S=_;if(t.argsMap)try{S=t.argsMap(this,..._)}catch(P){L.warning(P),S=[]}try{JSON.stringify(S)}catch{L.warning("arguments for method ".concat(u,".").concat(String(s)," not serializable for apiInvoke.")),S=[]}const R=(t.report||Rt).reportApiInvoke(this._sessionId||null,{id:this._clientId||((h=this.store)===null||h===void 0?void 0:h.clientId)||this._ID,name:"".concat(u,".").concat(String(s)),options:S,tag:xr.TRACER,reportResult:t.reportResult},t.throttleTime);try{const P=c.apply(this,_);return P instanceof lt?P.then(k=>(R.onSuccess(t.reportResult&&k),k)).catch(k=>{throw R.onError(k),k}):(R.onSuccess(t.reportResult&&P),P)}catch(P){throw R.onError(P),P}}}return o}}const Rt=new class{constructor(){Ur(this,"baseInfoMap",new Map),Ur(this,"proxyServer",void 0),Ur(this,"eventUploadTimer",void 0),Ur(this,"setSessionIdTimer",void 0),Ur(this,"url",void 0),Ur(this,"sids",new Set),Ur(this,"backupUrl",void 0),Ur(this,"_appId",void 0),Ur(this,"_aid",0),Ur(this,"keyEventUploadPendingItems",[]),Ur(this,"normalEventUploadPendingItems",[]),Ur(this,"apiInvokeUploadPendingItems",[]),Ur(this,"apiInvokeCount",0),Ur(this,"apiInvokeLoggedCount",0),Ur(this,"ltsList",[]),Ur(this,"lastSendNormalEventTime",Date.now()),Ur(this,"customReportCounterTimer",void 0),Ur(this,"customReportCount",0),Ur(this,"extApiInvoke",async t=>{for(const r of t){const s=rn(rn({},r),{},{sid:null,invokeId:++this.apiInvokeCount,tag:xr.TRACER});this.sendApiInvoke(s)}}),this.eventUploadTimer=window.setInterval(this.doSend.bind(this),re("EVENT_REPORT_SEND_INTERVAL")),this.setSessionIdTimer=window.setInterval(this.appendSessionId.bind(this),re("EVENT_REPORT_SEND_INTERVAL"))}getBaseInfoBySessionId(t){return this.baseInfoMap.get(t)}setAppId(t){this._appId=t,this._aid=parseInt(t.replace(/[a-fA-F0-9]{8}/g,r=>{let[s,o]=r;return s+o}),16)||0}reportApiInvoke(t,r,s){r.timeout=r.timeout||6e4,r.reportResult=r.reportResult===void 0||r.reportResult;const o=Date.now();this.apiInvokeCount+=1;const c=this.apiInvokeCount,u=!!re("SHOW_REPORT_INVOKER_LOG"),h=!!re("SHOW_REPORT_USER_INVOKER_LOG"),m=u||h&&r.id;m&&(this.apiInvokeLoggedCount+=1);const _=this.apiInvokeLoggedCount;function E(k,z){if(m){let U="[apiInvoke-".concat(_,"]");r.id&&(U+="[".concat(r.id,"]")),r.name&&(U+="[".concat(r.name,"]")),L.info("".concat(U," ").concat(k),k==="start"?r.options:z||"")}}const S=()=>({tag:r.tag,invokeId:c,sid:t,name:r.name,apiInvokeTime:o,options:r.options,states:r.states||null});E("start");let R=!1;os(r.timeout).then(()=>{R||(this.sendApiInvoke(rn(rn({},S()),{},{error:X.API_INVOKE_TIMEOUT,success:!1})),E("timeout"))});const P=new Le(X.UNEXPECTED_ERROR,"".concat(r.name,": this api invoke is end"));return{onSuccess:k=>{const z=()=>{if(R)throw P;return R=!0,this.sendApiInvoke(rn(rn({},S()),{},{success:!0},r.reportResult&&{result:k})),E("onSuccess"),k};return s?s8(z,r.name+"Success",s,()=>R=!0):z()},onError:k=>{const z=()=>{if(R)throw k;R=!0,this.sendApiInvoke(rn(rn({},S()),{},{success:!1,error:k})),E("onFailure",k.toString())};return s?s8(z,r.name+"Error",s,()=>R=!0):z()}}}sessionInit(t,r){if(this.baseInfoMap.has(t))return;const s=Date.now(),o=this.createBaseInfo(t,s);o.cname=r.cname;const c=Object.assign({},{willUploadConsoleLog:re("UPLOAD_LOG"),maxTouchPoints:navigator.maxTouchPoints,areaVersion:ix?"global":"oversea",areas:re("AREAS")&&re("AREAS").join(",")},r.extend),{stringUid:u,channelProfile:h,channelMode:m,isABTestSuccess:_,lsid:E,clientRole:S}=r,R=Date.now(),P=rn(rn({},o),{},{eventType:Gi.SESSION_INIT,appid:r.appid,browser:navigator.userAgent,buildFormat:r.buildFormat,build:ox,lts:R,elapse:R-s,extend:JSON.stringify(c),mode:r.mode,process:re("PROCESS_ID"),appType:re("APP_TYPE"),success:!0,version:yl,stringUid:u,channelProfile:h,channelMode:m,isABTestSuccess:_,lsid:E,clientType:ot(k=window.navigator.userAgent).call(k,"AgoraWebView")?42:20,clientRole:S,serviceId:re("PROCESS_ID"),extensionID:re("PLUGIN_INFO").join(",")||""});var k;this.send({type:Rr.SESSION,data:P},!0)}joinChooseServer(t,r){const s=this.baseInfoMap.get(t);if(!s)return;const o=s.info,c=Date.now(),u=rn(rn({},o),{},{role:r.role,eventType:Gi.JOIN_CHOOSE_SERVER,lts:c,eventElapse:r.elapse||c-r.lts,chooseServerAddr:r.csAddr,errorCode:r.ec,elapse:c-s.startTime,success:r.succ,chooseServerAddrList:JSON.stringify(r.serverList),uid:r.uid?parseInt(r.uid):null,cid:r.cid?parseInt(r.cid):null,chooseServerIp:r.csIp||"",opid:r.opid,unilbsServerIds:r.unilbsServerIds,extend:r.extend||void 0,isHttp3:r.isHttp3,corssRegionTagReq:r.corssRegionTagReq||void 0,corssRegionTagRes:r.corssRegionTagRes||void 0});this.send({type:Rr.JOIN_CHOOSE_SERVER,data:u},!0)}reqUserAccount(t,r){const s=this.baseInfoMap.get(t);if(!s)return;const o=s.info,c=Date.now(),u=rn(rn({},o),{},{eventType:Gi.REQ_USER_ACCOUNT,lts:c,success:r.success,serverAddress:r.serverAddr,stringUid:r.stringUid,uid:r.uid,errorCode:r.errorCode,elapse:r.elapse||c-s.startTime,eventElapse:c-r.lts,extend:JSON.stringify(r.extend)});this.send({type:Rr.REQ_USER_ACCOUNT,data:u},!0)}joinGateway(t,r){const s=this.baseInfoMap.get(t);if(!s)return;const o=s.info;r.vid&&(o.vid=r.vid),o.uid=r.uid,o.cid=r.cid;const c=Date.now(),{firstSuccess:u,avoidJoinStartTime:h,addr:m,isProxy:_}=r,E=c-(u&&h?h:s.startTime),S=rn(rn({},o),{},{eventType:Gi.JOIN_GATEWAY,lts:c,gatewayAddr:r.addr,success:r.succ,errorCode:r.ec,errorMsg:r.errorMsg||"",elapse:E,eventElapse:c-r.lts,firstSuccess:u,signalChannel:r.signalChannel,preload:r.preload?1:0,installId:rx(),isABTestSuccess:r.isABTestSuccess?1:0}),R=S.success?1:0;if(r.succ&&(s.lastJoinSuccessTime=c),u)this.send({type:Rr.JOIN_GATEWAY,data:S},!0);else{let P;if(m)if(_){const z=m.match(/h=(\d{1,3}-){3}\d{1,3}/g),U=m.match(/p=[0-9]{1,6}/g);P={isSuccess:R,gatewayIp:z&&z.length?z[0].split("=")[1].replace(/-/g,"."):"",port:U&&U.length?U[0].split("=")[1]:"",isProxy:_?1:0}}else{const z=m.match(/wss:\/\/(\d{1,3}-){3}\d{1,3}/g),U=m.match(/(:|p=)[0-9]{1,6}/g);P={isSuccess:R,gatewayIp:z&&z.length?z[0].split("//")[1].replace(/-/g,"."):"",port:U&&U.length?U[0].split(/:|p=/g)[1]:"",isProxy:_?1:0}}else P={isSuccess:R,gatewayIp:"",port:"",isProxy:_?1:0};delete S.success,delete S.eventType,delete S.firstSuccess,S.vid=Number(S.vid);const k=Object.assign({},S,P,{eventType:Gi.REJOIN_GATEWAY});this.send({type:Rr.RE_JOIN_GATEWAY,data:k},!0)}}joinChannelTimeout(t,r){const s=this.baseInfoMap.get(t);if(!s)return;const o=Date.now(),c=rn(rn({},s.info),{},{lts:o,timeout:r,elapse:o-s.startTime});this.send({type:Rr.JOIN_CHANNEL_TIMEOUT,data:c},!0)}publish(t,r){const s=this.baseInfoMap.get(t);if(!s)return;const o=s.info,c=Date.now(),u=rn(rn({},o),{},{eventType:Gi.PUBLISH,lts:c,eventElapse:r.eventElapse,elapse:c-s.startTime,success:r.succ,errorCode:r.ec,videoName:r.videoName,audioName:r.audioName,screenName:r.screenName,screenshare:r.screenshare,audio:r.audio,video:r.video,p2pid:r.p2pid,publishRequestid:r.publishRequestid});this.send({type:Rr.PUBLISH,data:u},!0)}subscribe(t,r,s){const o=this.baseInfoMap.get(t);if(!o)return;const c=o.info,u=Date.now(),h=rn(rn({},c),{},{eventType:Gi.SUBSCRIBE,lts:u,eventElapse:r.eventElapse,elapse:u-o.startTime,success:r.succ,errorCode:r.ec,video:r.video,audio:r.audio,subscribeRequestid:r.subscribeRequestid,p2pid:r.p2pid,preSsrc:r.preSsrc?1:0},s&&{extend:JSON.stringify({isMassSubscribe:!0})});typeof r.peerid=="string"?h.peerSuid=r.peerid:h.peer=r.peerid,this.send({type:Rr.SUBSCRIBE,data:h},!0)}wsCompressorInit(t){var r;const s=[...Lc(r=this.baseInfoMap).call(r)],o=s.length?s[0]:"UnableToGetSid",c=this.baseInfoMap.get(o);if(!c)return;const u=c.info,h=Date.now(),m=rn(rn({},u),{},{eventType:Gi.WS_COMPRESSOR_INIT,lts:h,eventElapse:t.eventElapse,elapse:h-c.startTime,status:t.status?1:2});this.send({type:Rr.WS_COMPRESSOR_INIT,data:m},!0)}firstRemoteVideoDecode(t,r,s,o){const c=this.baseInfoMap.get(t);if(!c)return;const u=c.info,h=Date.now(),m=rn(rn(rn({},u),o),{},{elapse:h-c.startTime,eventType:r,lts:h,firstDecodeFrame:Math.max((o.firstFrame||h)-c.startTime,0),apEnd:Math.max(o.apEnd-c.startTime,0),apStart:Math.max(o.apStart-c.startTime,0),joinGwEnd:Math.max(o.joinGwEnd-c.startTime,0),joinGwStart:Math.max(o.joinGwStart-c.startTime,0),pcEnd:Math.max(o.pcEnd-c.startTime,0),pcStart:Math.max(o.pcStart-c.startTime,0),subscriberEnd:Math.max(o.subscriberEnd-c.startTime,0),subscriberStart:Math.max(o.subscriberStart-c.startTime,0),videoAddNotify:Math.max(o.videoAddNotify-c.startTime,0)});this.send({type:s,data:m},!0)}firstRemoteFrame(t,r,s,o){const c=this.baseInfoMap.get(t);if(!c)return;const u=c.info,h=Date.now(),m=rn(rn(rn({},u),o),{},{elapse:h-c.startTime,eventType:r,lts:h});this.send({type:s,data:m},!0)}abTest(t,r){const s=this.baseInfoMap.get(t);if(!s)return;const o=s.info,c=Date.now(),u=rn(rn(rn({},o),r),{},{vid:o.vid===void 0?0:Number(o.vid),elapse:c-s.startTime,eventType:Gi.AB_TEST,lts:c});this.send({type:Rr.AB_TEST,data:u},!0)}pcStats(t,r){const s=this.baseInfoMap.get(t);if(!s)return;const o=s.info,c=Date.now(),u=rn(rn(rn({},o),r),{},{vid:o.vid===void 0?0:Number(o.vid),elapse:c-s.startTime,eventType:Gi.PC_STATS,lts:c,preallocation:r.preallocation?1:0});this.send({type:Rr.PC_STATS,data:u},!0)}updateRemoteRTPCapabilities(t,r){if(t){const s=this.baseInfoMap.get(t);if(!s)return;const o=s.info,c=Date.now(),u=rn(rn(rn({},o),r),{},{vid:o.vid===void 0?0:Number(o.vid),eventType:Gi.UPDATE_REMOTE_RTPCAPABILITIES,lts:c});this.send({type:Rr.UPDATE_REMOTE_RTPCAPABILITIES,data:u},!0)}}onGatewayStream(t,r,s,o){const c=this.baseInfoMap.get(t);if(!c)return;const u=c.info,h=Date.now(),m=rn(rn(rn({},u),o),{},{eventType:r,lts:h});this.send({type:s,data:m},!0)}streamSwitch(t,r){const s=this.baseInfoMap.get(t);if(!s)return;const o=s.info,c=Date.now(),u=rn(rn({},o),{},{eventType:Gi.STREAM_SWITCH,lts:c,isDual:r.isdual,elapse:c-s.startTime,success:r.succ});this.send({type:Rr.STREAM_SWITCH,data:u},!0)}requestProxyAppCenter(t,r){const s=this.baseInfoMap.get(t);if(!s)return;const o=s.info,c=Date.now(),u=rn(rn({},o),{},{eventType:Gi.REQUEST_PROXY_APPCENTER,lts:c,eventElapse:c-r.lts,elapse:c-s.startTime,APAddr:r.APAddr,workerManagerList:r.workerManagerList,response:r.response,errorCode:r.ec,success:r.succ});this.send({type:Rr.REQUEST_PROXY_APPCENTER,data:u},!0)}requestProxyWorkerManager(t,r){const s=this.baseInfoMap.get(t);if(!s)return;const o=s.info,c=Date.now(),u=rn(rn({},o),{},{eventType:Gi.REQUEST_PROXY_WORKER_MANAGER,lts:c,eventElapse:c-r.lts,elapse:c-s.startTime,workerManagerAddr:r.workerManagerAddr,response:r.response,errorCode:r.ec,success:r.succ});this.send({type:Rr.REQUEST_PROXY_WORKER_MANAGER,data:u},!0)}setProxyServer(t){this.proxyServer=t,t?L.debug("reportProxyServerurl: ".concat(t)):L.debug("disable reportProxyServerurl: ".concat(t))}peerPublishStatus(t,r){const s=this.baseInfoMap.get(t);if(!s)return;const o=s.info,c=Date.now(),u=rn(rn({},o),{},{subscribeElapse:r.subscribeElapse,peer:r.peer,peerPublishDuration:Math.max(r.audioPublishDuration,r.videoPublishDuration),audiotag:r.audioPublishDuration>0?1:-1,videotag:r.videoPublishDuration>0?1:-1,lts:c,elapse:c-s.startTime,joinChannelSuccessElapse:c-(s.lastJoinSuccessTime||c),peerPublishDurationVideo:r.videoPublishDuration,peerPublishDurationAudio:r.audioPublishDuration});this.send({type:Rr.PEER_PUBLISH_STATUS,data:u},!0)}workerEvent(t,r){const s=this.baseInfoMap.get(t);if(!s)return;const o=s.info,c=Date.now();(function(u,h,m){const _=u[h];if(!_||typeof _!="string")return[u];u[h]="";const E=gh(JSON.stringify(u));let S=0;const R=[];let P=0;for(let k=0;k<_.length;k++)P+=_.charCodeAt(k)<=127?1:3,P<=m-E||(R[R.length]=mt(mt({},u),{},{[h]:_.substring(S,k)}),S=k,P=_.charCodeAt(k)<=127?1:3);return S!==_.length-1&&(R[R.length]=mt(mt({},u),{},{[h]:_.substring(S)})),R})(rn(rn(rn({},o),r),{},{elapse:c-s.startTime,lts:c,productType:"WebRTC"}),"payload",1300).forEach(u=>this.send({type:Rr.WORKER_EVENT,data:u},!0))}apworkerEvent(t,r){const s=this.baseInfoMap.get(t);if(!s)return;const o=s.info,c=Date.now(),u=rn(rn(rn({},o),r),{},{elapse:c-s.startTime,lts:c});this.send({type:Rr.AP_WORKER_EVENT,data:u},!0)}joinWebProxyAP(t,r){const s=this.baseInfoMap.get(t);if(!s)return;const o=s.info,c=Date.now(),u=rn(rn(rn({},o),r),{},{elapse:c-s.startTime,lts:c,extend:r.extend||void 0});this.send({type:Rr.JOIN_WEB_PROXY_AP,data:u},!0)}WebSocketQuit(t,r){const s=this.baseInfoMap.get(t);if(!s)return;const o=s.info,c=Date.now(),u=rn(rn(rn({},o),r),{},{elapse:c-s.startTime,lts:c});this.send({type:Rr.WEBSOCKET_QUIT,data:u},!0)}async sendCustomReportMessage(t,r){if(this.customReportCount+=r.length,this.customReportCount>re("CUSTOM_REPORT_LIMIT"))throw new Le(X.CUSTOM_REPORT_FREQUENCY_TOO_HIGH);this.customReportCounterTimer||(this.customReportCounterTimer=window.setInterval(()=>{this.customReportCount=0},5e3));const s=Date.now(),o=r.map(c=>({type:Rr.USER_ANALYTICS,data:rn(rn({sid:t},c),{},{lts:s})}));try{re("NEW_REPORT_SERVER")?await this.postDataToStatsCollector2(o):await this.postDataToStatsCollector(o)}catch(c){throw L.error("send custom report message failed",c.toString()),new Le(X.CUSTOM_REPORT_SEND_FAILED,c.message)}}sendApiInvoke(t){const r=re("NOT_REPORT_EVENT");if(t.tag&&ot(r)&&ot(r).call(r,t.tag))return!1;if(t.sid===null)return this.apiInvokeUploadPendingItems.push(t),!1;const s=this.baseInfoMap.get(t.sid);if(!s)return this.apiInvokeUploadPendingItems.push(t),!1;const{cname:o,uid:c,cid:u}=s.info;let h;if(t.lts=t.lts||Date.now(),t.error)if(t.error instanceof Le){const{code:_,message:E}=t.error;h=_||E||t.error.toString()}else h=t.error.toString();const m={invokeId:t.invokeId,sid:t.sid,cname:o,cid:u,uid:c,lts:t.lts,success:t.success,elapse:t.lts-s.startTime,execElapse:t.lts-t.apiInvokeTime,apiName:t.name,options:t.options?JSON.stringify(t.options):void 0,execStates:t.states?JSON.stringify(t.states):void 0,execResult:t.result?JSON.stringify(t.result):void 0,errorCode:t.error?h:void 0,errorMsg:t.error?JSON.stringify(t.error):void 0};return this.send({type:Rr.API_INVOKE,data:m},!1),!0}addSid(t){this.sids.add(t)}removeSid(t){this.sids.delete(t)}appendSessionId(){const t=this.apiInvokeUploadPendingItems;if(t.length===0)return;const r=Array.from(this.sids).find(s=>s!==null);r&&t.forEach(s=>{s&&(s.sid=r,this.sendApiInvoke(Object.assign({},s)))}),t.length=0}send(t,r){if(r)return this.keyEventUploadPendingItems.push(t),void this.sendItems(this.keyEventUploadPendingItems,!0);this.normalEventUploadPendingItems.push(t),this.normalEventUploadPendingItems.length>re("NORMAL_EVENT_QUEUE_CAPACITY")&&this.normalEventUploadPendingItems.splice(0,1),this.normalEventUploadPendingItems.length>=10&&this.sendItems(this.normalEventUploadPendingItems,!1)}doSend(){this.keyEventUploadPendingItems.length>0&&this.sendItems(this.keyEventUploadPendingItems,!0),this.normalEventUploadPendingItems.length>0&&Date.now()-this.lastSendNormalEventTime>=5e3&&this.sendItems(this.normalEventUploadPendingItems,!1)}sendItems(t,r){const s=[],o=[];for(;t.length;){const u=t.shift();s.length<20?s.push(u):o.push(u)}t.push(...o);for(const u of[...s]){var c;this.ltsList.indexOf(u.data.lts)!==-1?(u.data.lts=this.ltsList[this.ltsList.length-1]+1,this.ltsList.push(u.data.lts)):(this.ltsList.push(u.data.lts),eT(c=this.ltsList).call(c,(h,m)=>h-m))}return r||(this.lastSendNormalEventTime=Date.now()),re("ENABLE_EVENT_REPORT")&&s.length&&(re("NEW_REPORT_SERVER")?this.postDataToStatsCollector2(s):this.postDataToStatsCollector(s)).catch((u=>h=>{re("EVENT_REPORT_RETRY")&&(r?this.keyEventUploadPendingItems=this.keyEventUploadPendingItems.concat(u):(this.normalEventUploadPendingItems=this.normalEventUploadPendingItems.concat(u),this.normalEventUploadPendingItems.length>re("NORMAL_EVENT_QUEUE_CAPACITY")&&(this.normalEventUploadPendingItems.splice(0,this.normalEventUploadPendingItems.length-re("NORMAL_EVENT_QUEUE_CAPACITY")),L.warning("report: drop normal events"))))})(s)),t}async postDataToStatsCollector2(t){ci.networkState===nc.OFFLINE&&await lt.race([ci.onlineWaiter,os(2*bi.maxRetryTimeout)]);const r=c=>{let u=new Uint8Array;return c.forEach(h=>{const m=HL(JSON.stringify(h.data)),_=new ArrayBuffer(5),E=(R=>{let P=0;return Object.entries(Rr).forEach(k=>{let[z,U]=k;U===R.type&&(P=fpe[z])}),P})(h),S=new DataView(_);S.setUint16(0,m.byteLength,!0),S.setUint8(2,255&E),S.setUint8(3,E>>>8&255),S.setUint8(4,E>>>16&255),u=XW(u,new Uint8Array(_)),u=XW(u,m)}),u},s="event";let o=this.proxyServer?"https://".concat(this.proxyServer,"/rs/?h=").concat(re("NEW_REPORT_SERVER_DOMAINS")[0],"&p=443&d=").concat(s):"https://".concat(re("NEW_REPORT_SERVER_DOMAINS")[0],"/").concat(s);for(let c=0;c<2;c+=1){c===1&&(o=this.proxyServer?"https://".concat(this.proxyServer,"/rs/?h=").concat(re("NEW_REPORT_SERVER_DOMAINS")[1],"&p=443&d=").concat(s):"https://".concat(re("NEW_REPORT_SERVER_DOMAINS")[1],"/").concat(s));try{await QL(o,{timeout:1e4,data:r(t),headers:rn(rn({biz:"webrtc",sendts:Math.round(Date.now()/1e3),debug:"false"},this._appId&&{appid:this._appId}),{},{"Content-Type":"application/octet-stream"})},!0)}catch(u){if(c===1)throw u;continue}return}}async postDataToStatsCollector(t){let r=arguments.length>1&&arguments[1]!==void 0&&arguments[1];const s=(m=>{const _=m&&m.data.sid&&this.baseInfoMap.get(m.data.sid);return _&&_.info.vid&&+_.info.vid||0})(t[0]),o=s?void 0:this._aid,c={msgType:"EventMessages",sentTs:Math.round(Date.now()/1e3),payloads:t.map(m=>JSON.stringify(m)),vid:s,aid:o};ci.networkState===nc.OFFLINE&&await lt.race([ci.onlineWaiter,os(2*bi.maxRetryTimeout)]);const u=r?"/events/proto-raws":"/events/messages";let h=this.url||(this.proxyServer?"https://".concat(this.proxyServer,"/rs/?h=").concat(re("EVENT_REPORT_DOMAIN"),"&p=").concat(re("STATS_COLLECTOR_PORT"),"&d=").concat(u):"https://".concat(re("EVENT_REPORT_DOMAIN"),":").concat(re("STATS_COLLECTOR_PORT")).concat(u));for(let m=0;m<2;m+=1){m===1&&(h=this.backupUrl||(this.proxyServer?"https://".concat(this.proxyServer,"/rs/?h=").concat(re("EVENT_REPORT_BACKUP_DOMAIN"),"&p=").concat(re("STATS_COLLECTOR_PORT"),"&d=").concat(u):"https://".concat(re("EVENT_REPORT_BACKUP_DOMAIN"),":").concat(re("STATS_COLLECTOR_PORT")).concat(u)));try{r?await Qfe(h,{timeout:1e4,data:c}):await QL(h,{timeout:1e4,data:c})}catch(_){if(m===1)throw _;continue}return}}createBaseInfo(t,r){const s=Object.assign({},hpe);return s.sid=t,this.baseInfoMap.set(t,{info:s,startTime:r}),s}reportResourceTiming(t,r){const s=performance.getEntriesByName(t),o=s[s.length-1];o&&this.reportApiInvoke(r,{name:"Client.resourceTiming",options:o,tag:xr.TRACER}).onSuccess()}};w8.on("REPORT_LOG_UPLOAD",t=>{t.networkState=ci.networkState,Rt.reportApiInvoke(null,{name:"logUploadError",options:t,tag:xr.TRACER}).onSuccess("logUploadError")});class Oe extends Le{constructor(r){super(r,arguments.length>1&&arguments[1]!==void 0?arguments[1]:"",arguments.length>2?arguments[2]:void 0),Ur(this,"name","AgoraRTCException")}print(){let r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"error";return super.print(r,L)}throw(){super.throw(L)}}const as={getDisplayMedia:!1,getStreamFromExtension:!1,supportUnifiedPlan:!1,supportMinBitrate:!1,supportSetRtpSenderParameters:!1,supportDualStream:!0,webAudioMediaStreamDest:!1,supportReplaceTrack:!1,supportWebGL:!1,webAudioWithAEC:!1,supportRequestFrame:!1,supportShareAudio:!1,supportDualStreamEncoding:!1,supportDataChannel:!1,supportPCSetConfiguration:!1,supportWebRTCEncodedTransform:!1,supportWebRTCInsertableStream:!1,supportRequestVideoFrameCallback:!1,supportWebCrypto:!1};function kn(){return as}function I8(){return"setSinkId"in HTMLAudioElement.prototype&&(!re("RESTRICTION_SET_PLAYBACK_DEVICE")||($f()||VW())&&!WL())}function A8(){return!as.supportUnifiedPlan||re("CHROME_FORCE_PLAN_B")&&Kf()}let cs=function(t){return t.IOS_15_16_INTERRUPTION_START="ios15_16-interruption-start",t.IOS_15_16_INTERRUPTION_END="ios15_16-interruption-end",t.IOS_INTERRUPTION_START="ios-interruption-start",t.IOS_INTERRUPTION_END="ios-interruption-end",t.STATE_CHANGE="state-change",t}({});function xv(t,r,s){return{sampleRate:t,stereo:r,bitrate:s}}function Cn(t,r,s,o,c){return{width:t,height:r,frameRate:s,bitrateMin:o,bitrateMax:c}}function du(t,r,s,o,c){return{width:{max:t},height:{max:r},frameRate:s,bitrateMin:o,bitrateMax:c}}function ux(t,r){return{numSpatialLayers:t,numTemporalLayers:r}}const ppe={"90p":Cn(160,90),"90p_1":Cn(160,90),"120p":Cn(160,120,15,30,65),"120p_1":Cn(160,120,15,30,65),"120p_3":Cn(120,120,15,30,50),"120p_4":Cn(212,120),"180p":Cn(320,180,15,30,140),"180p_1":Cn(320,180,15,30,140),"180p_3":Cn(180,180,15,30,100),"180p_4":Cn(240,180,15,30,120),"240p":Cn(320,240,15,40,200),"240p_1":Cn(320,240,15,40,200),"240p_3":Cn(240,240,15,40,140),"240p_4":Cn(424,240,15,40,220),"360p":Cn(640,360,15,80,400),"360p_1":Cn(640,360,15,80,400),"360p_3":Cn(360,360,15,80,260),"360p_4":Cn(640,360,30,80,600),"360p_6":Cn(360,360,30,80,400),"360p_7":Cn(480,360,15,80,320),"360p_8":Cn(480,360,30,80,490),"360p_9":Cn(640,360,15,80,800),"360p_10":Cn(640,360,24,80,800),"360p_11":Cn(640,360,24,80,1e3),"480p":Cn(640,480,15,100,500),"480p_1":Cn(640,480,15,100,500),"480p_2":Cn(640,480,30,100,1e3),"480p_3":Cn(480,480,15,100,400),"480p_4":Cn(640,480,30,100,750),"480p_6":Cn(480,480,30,100,600),"480p_8":Cn(848,480,15,100,610),"480p_9":Cn(848,480,30,100,930),"480p_10":Cn(640,480,10,100,400),"720p":Cn(1280,720,15,120,1130),"720p_auto":Cn(1280,720,30,900,3e3),"720p_1":Cn(1280,720,15,120,1130),"720p_2":Cn(1280,720,30,120,2e3),"720p_3":Cn(1280,720,30,120,1710),"720p_5":Cn(960,720,15,120,910),"720p_6":Cn(960,720,30,120,1380),"1080p":Cn(1920,1080,15,120,2080),"1080p_1":Cn(1920,1080,15,120,2080),"1080p_2":Cn(1920,1080,30,120,3e3),"1080p_3":Cn(1920,1080,30,120,3150),"1080p_5":Cn(1920,1080,60,120,4780),"1440p":Cn(2560,1440,30,120,4850),"1440p_1":Cn(2560,1440,30,120,4850),"1440p_2":Cn(2560,1440,60,120,7350),"4k":Cn(3840,2160,30,120,8910),"4k_1":Cn(3840,2160,30,120,8910),"4k_3":Cn(3840,2160,60,120,13500)},mpe={"480p":du(640,480,5),"480p_1":du(640,480,5),"480p_2":du(640,480,30),"480p_3":du(640,480,15),"720p":du(1280,720,5),"720p_auto":Cn(1280,720,30,900,3e3),"720p_1":du(1280,720,5),"720p_2":du(1280,720,30),"720p_3":du(1280,720,15),"1080p":du(1920,1080,5),"1080p_1":du(1920,1080,5),"1080p_2":du(1920,1080,30),"1080p_3":du(1920,1080,15)},gpe={"1SL1TL":ux(1,1),"3SL3TL":ux(3,3),"2SL3TL":ux(2,3)};function yh(t){return t||(t="480p_1"),typeof t=="string"?Object.assign({},ppe[t]):t}function dx(t){return typeof t=="string"?Object.assign({},mpe[t]):t}function YA(t){return typeof t=="string"?Object.assign({},gpe[t]):t}const _pe={speech_low_quality:xv(16e3,!1),speech_standard:xv(32e3,!1,18),music_standard:xv(48e3,!1),standard_stereo:xv(48e3,!0,56),high_quality:xv(48e3,!1,128),high_quality_stereo:xv(48e3,!0,192)};function XA(t){return typeof t=="string"?Object.assign({},_pe[t]):t}const Mv=[];function P8(t){return Di(t,"mediaSource",["screen","window","application"]),!0}let yt=function(t){return t.NEED_RENEGOTIATE="@need_renegotiate",t.NEED_REPLACE_TRACK="@need_replace_track",t.NEED_REPLACE_MIXING_TRACK="@need_replace_mixing_track",t.NEED_CLOSE="@need_close",t.NEED_ENABLE_TRACK="@need_enable_track",t.NEED_DISABLE_TRACK="@need_disable_track",t.NEED_SESSION_ID="@need_sid",t.SET_OPTIMIZATION_MODE="@set_optimization_mode",t.GET_STATS="@get_stats",t.GET_RTC_STATS="@get_rtc_stats",t.GET_LOW_VIDEO_TRACK="@get_low_video_track",t.NEED_RESET_REMOTE_SDP="@need_reset_remote_sdp",t.NEED_UPDATE_VIDEO_ENCODER="@need_update_video_encoder",t.NEED_UPDATE_VIDEO_SEND_PARAMETERS="@need_update_video_send_parameters",t.NEED_MUTE_TRACK="@need_mute_track",t.NEED_UNMUTE_TRACK="@need_unmute_track",t}({}),ar=function(t){return t.SCREEN_TRACK="screen_track",t.CUSTOM_TRACK="custome_track",t.LOW_STREAM="low_stream",t.SCREEN_LOW_TRACK="screen_low_track",t}({}),Uv=function(t){return t[t.HIGH_STREAM=0]="HIGH_STREAM",t[t.LOW_STREAM=1]="LOW_STREAM",t}({}),ype=function(t){return t[t.HIGH_STREAM=0]="HIGH_STREAM",t[t.LOW_STREAM=1]="LOW_STREAM",t[t.HIGH_STREAM_LAYER1=4]="HIGH_STREAM_LAYER1",t[t.HIGH_STREAM_LAYER2=5]="HIGH_STREAM_LAYER2",t[t.HIGH_STREAM_LAYER3=6]="HIGH_STREAM_LAYER3",t[t.HIGH_STREAM_LAYER4=7]="HIGH_STREAM_LAYER4",t[t.HIGH_STREAM_LAYER5=8]="HIGH_STREAM_LAYER5",t[t.HIGH_STREAM_LAYER6=9]="HIGH_STREAM_LAYER6",t}({}),Epe=function(t){return t[t.DISABLE=0]="DISABLE",t[t.LOW_STREAM=1]="LOW_STREAM",t[t.AUDIO_ONLY=2]="AUDIO_ONLY",t[t.HIGH_STREAM_LAYER1=3]="HIGH_STREAM_LAYER1",t[t.HIGH_STREAM_LAYER2=4]="HIGH_STREAM_LAYER2",t[t.HIGH_STREAM_LAYER3=5]="HIGH_STREAM_LAYER3",t[t.HIGH_STREAM_LAYER4=6]="HIGH_STREAM_LAYER4",t[t.HIGH_STREAM_LAYER5=7]="HIGH_STREAM_LAYER5",t[t.HIGH_STREAM_LAYER6=8]="HIGH_STREAM_LAYER6",t}({}),M_=function(t){return t.TRANSCEIVER_UPDATED="transceiver-updated",t.SEI_TO_SEND="sei-to-send",t.SEI_RECEIVED="sei-received",t.TRACK_UPDATED="track-updated",t}({}),Vv=function(t){return t.SOURCE_STATE_CHANGE="source-state-change",t.TRACK_ENDED="track-ended",t.BEAUTY_EFFECT_OVERLOAD="beauty-effect-overload",t.VIDEO_ELEMENT_VISIBLE_STATUS="video-element-visible-status",t.CLOSED="closed",t}({}),Fv=function(t){return t.FIRST_FRAME_DECODED="first-frame-decoded",t.VIDEO_ELEMENT_VISIBLE_STATUS="video-element-visible-status",t.VIDEO_STATE_CHANGED="video-state-changed",t}({}),jv=function(t){return t.AUDIO="audio",t.VIDEO="video",t.DATA="data",t}({}),xc=function(t){return t.AUDIO_SOURCE_STATE_CHANGE="audio_source_state_change",t.RECEIVE_TRACK_BUFFER="receive_track_buffer",t.ON_AUDIO_BUFFER="on_audio_buffer",t.UPDATE_SOURCE="update_source",t}({});(function(t){t.UPDATE_TRACK_SOURCE="update-track-source"})({});const hx={sendVolumeLevel:0,sendBitrate:0,sendBytes:0,sendPackets:0,sendPacketsLost:0,sendJitterMs:0,sendRttMs:0,currentPacketLossRate:0},fx={sendBytes:0,sendBitrate:0,sendPackets:0,sendPacketsLost:0,sendJitterMs:0,sendRttMs:0,sendResolutionHeight:0,sendResolutionWidth:0,captureResolutionHeight:0,captureResolutionWidth:0,targetSendBitrate:0,totalDuration:0,totalFreezeTime:0,currentPacketLossRate:0},O8={transportDelay:0,end2EndDelay:0,receiveBitrate:0,receiveLevel:0,receiveBytes:0,receiveDelay:0,receivePackets:0,receivePacketsLost:0,receivePacketsDiscarded:0,totalDuration:0,totalFreezeTime:0,freezeRate:0,packetLossRate:0,currentPacketLossRate:0,publishDuration:-1},vpe={uplinkNetworkQuality:0,downlinkNetworkQuality:0},k8={transportDelay:0,end2EndDelay:0,receiveBitrate:0,receiveBytes:0,receiveDelay:0,receivePackets:0,receivePacketsLost:0,receiveResolutionHeight:0,receiveResolutionWidth:0,totalDuration:0,totalFreezeTime:0,freezeRate:0,packetLossRate:0,currentPacketLossRate:0,publishDuration:-1};let So=function(t){return t.ON_TRACK="on_track",t.ON_NODE="on_node",t}({}),Mc=function(t){return t.REQUEST_UPDATE_CONSTRAINTS="request_update_constraints",t.REQUEST_CONSTRAINTS="request_constraints",t}({}),bT=function(t){return t.IDLE="IDLE",t.INITING="INITING",t.INITEND="INITEND",t}({}),U_=function(t){return t.STATE_CHANGE="state_change",t.RECORDING_DEVICE_CHANGED="recordingDeviceChanged",t.PLAYOUT_DEVICE_CHANGED="playoutDeviceChanged",t.CAMERA_DEVICE_CHANGED="cameraDeviceChanged",t}({}),to=function(t){return t.NONE="none",t.INIT="init",t.CANPLAY="canplay",t.PLAYING="playing",t.PAUSED="paused",t.SUSPEND="suspend",t.STALLED="stalled",t.WAITING="waiting",t.ERROR="error",t.DESTROYED="destroyed",t.ABORT="abort",t.ENDED="ended",t.EMPTIED="emptied",t.LOADEDDATA="loadeddata",t}({}),Eh=function(t){return t[t.VideoStateStopped=0]="VideoStateStopped",t[t.VideoStateStarting=1]="VideoStateStarting",t[t.VideoStateDecoding=2]="VideoStateDecoding",t[t.VideoStateFrozen=3]="VideoStateFrozen",t}({});const px={uninit:100,none:110,init:120,loadeddata:130,canplay:200,playing:210,paused:220,suspend:300,stalled:310,waiting:320,error:330,destroyed:340,abort:350,ended:360,emptied:370};let JA=function(t){return t.OPEN="open",t.MESSAGE="message",t.CLOSE="close",t.CLOSING="closing",t.ERROR="error",t}({});function N8(t,r){var s=Object.keys(t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);r&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(t,c).enumerable})),s.push.apply(s,o)}return s}function Cr(t){for(var r=1;r<arguments.length;r++){var s=arguments[r]!=null?arguments[r]:{};r%2?N8(Object(s),!0).forEach(function(o){Pe(t,o,s[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(s)):N8(Object(s)).forEach(function(o){Object.defineProperty(t,o,Object.getOwnPropertyDescriptor(s,o))})}return t}function Pe(t,r,s){return(r=function(o){var c=function(u,h){if(typeof u!="object"||u===null)return u;var m=u[Symbol.toPrimitive];if(m!==void 0){var _=m.call(u,"string");if(typeof _!="object")return _;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(u)}(o);return typeof c=="symbol"?c:String(c)}(r))in t?Object.defineProperty(t,r,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[r]=s,t}function In(t,r,s,o,c){var u,h,m={};return Object.keys(o).forEach(function(_){m[_]=o[_]}),m.enumerable=!!m.enumerable,m.configurable=!!m.configurable,("value"in m||m.initializer)&&(m.writable=!0),m=Ya(u=em(h=s.slice()).call(h)).call(u,function(_,E){return E(t,r,_)||_},m),c&&m.initializer!==void 0&&(m.value=m.initializer?m.initializer.call(c):void 0,m.initializer=void 0),m.initializer===void 0&&(Object.defineProperty(t,r,m),m=null),m}class D8 extends Pr{set _mediaStreamTrack(r){r!==this.mediaStreamTrack&&(this.safeEmit(M_.TRACK_UPDATED,r),this.mediaStreamTrack=r)}get _mediaStreamTrack(){return this.mediaStreamTrack}constructor(r,s){super(),Pe(this,"trackMediaType",void 0),Pe(this,"_ID",void 0),Pe(this,"_rtpTransceiver",void 0),Pe(this,"_lowRtpTransceiver",void 0),Pe(this,"_hints",[]),Pe(this,"_isClosed",!1),Pe(this,"_originMediaStreamTrack",void 0),Pe(this,"mediaStreamTrack",void 0),Pe(this,"_external",{}),this._ID=s||or(8,"track-"),this._originMediaStreamTrack=r,this.mediaStreamTrack=r,function(o){ot(Mv).call(Mv,o)||Mv.push(o)}(this)}toString(){return this._ID}getTrackId(){return this._ID}getMediaStreamTrack(r){return r||Im(()=>{var s;Rt.reportApiInvoke(null,{name:Si.GET_MEDIA_STREAM_TRACK,options:[],tag:xr.TRACER}).onSuccess(((s=this._mediaStreamTrack)===null||s===void 0?void 0:s.label)||"")},this.mediaStreamTrack.id||this.getTrackId()),this._mediaStreamTrack}getRTCRtpTransceiver(r){return r===Uv.LOW_STREAM?this._lowRtpTransceiver:this._rtpTransceiver}getMediaStreamTrackSettings(){return this.getMediaStreamTrack(!0).getSettings()}close(){this._isClosed=!0,this._lowRtpTransceiver=void 0,this._rtpTransceiver=void 0,function(r){const s=Mv.indexOf(r);s!==-1&&Mv.splice(s,1)}(this),this.emit(Vv.CLOSED),this.removeAllListeners(M_.SEI_RECEIVED)}_updateRtpTransceiver(r,s){if(s===Uv.LOW_STREAM){if(this._lowRtpTransceiver===r)return;this._lowRtpTransceiver=r}else{if(this._rtpTransceiver===r)return;this._rtpTransceiver=r}this.emit(M_.TRANSCEIVER_UPDATED,r,s)}}class Bv extends D8{get isExternalTrack(){return this._isExternalTrack}get muted(){return this._muted}get enabled(){return this._enabled}get processorContext(){return this._processorContext}constructor(r,s){super(r,s),Pe(this,"_enabled",!0),Pe(this,"_muted",!1),Pe(this,"_isExternalTrack",!1),Pe(this,"_isClosed",!1),Pe(this,"_enabledMutex",void 0),Pe(this,"processor",void 0),Pe(this,"_processorContext",void 0),Pe(this,"_handleTrackEnded",()=>{this.onTrackEnded()}),this._enabledMutex=new ks("".concat(this.getTrackId())),r.addEventListener("ended",this._handleTrackEnded)}getTrackLabel(){var r,s;return(r=(s=this._originMediaStreamTrack)===null||s===void 0?void 0:s.label)!==null&&r!==void 0?r:""}close(){this._isClosed||(this.stop(),this._originMediaStreamTrack.stop(),this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack.stop(),this._mediaStreamTrack=null),this._originMediaStreamTrack=null,this._enabledMutex=null,L.debug("[".concat(this.getTrackId(),"] close")),this.emit(yt.NEED_CLOSE),super.close())}async _updateOriginMediaStreamTrack(r,s){let o=arguments.length>2&&arguments[2]!==void 0&&arguments[2];this._isExternalTrack=o,r!==this._originMediaStreamTrack&&(this._originMediaStreamTrack&&(this._originMediaStreamTrack.removeEventListener("ended",this._handleTrackEnded),s&&this._originMediaStreamTrack.stop()),r.addEventListener("ended",this._handleTrackEnded),this._originMediaStreamTrack=r,this._muted&&(this._originMediaStreamTrack.enabled=!1),this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource(),await sr(this,yt.NEED_REPLACE_TRACK,this),this.processor&&this._processorContext&&this.processor.updateInput({track:this._originMediaStreamTrack,context:this._processorContext}))}_getDefaultPlayerConfig(){return{}}onTrackEnded(){L.debug("[".concat(this.getTrackId(),"] track ended")),this.safeEmit(Vv.TRACK_ENDED)}stateCheck(r,s){if(L.debug("check track state, [muted: ".concat(this._muted,", enabled: ").concat(this._enabled,"] to [").concat(r,": ").concat(s,"]")),qf(s,r),this._enabled&&this._muted&&r==="enabled"&&s===!1)throw new Le(X.TRACK_STATE_UNREACHABLE,"cannot set enabled while the track is muted").print("error",L);if(!this._enabled&&!this._muted&&r==="muted"&&s===!0)throw new Le(X.TRACK_STATE_UNREACHABLE,"cannot set muted while the track is disabled").print("error",L)}getProcessorStats(){return this._processorContext&&this._processorContext.gatherStats()||[]}getProcessorUsage(){return this._processorContext?this._processorContext.gatherUsage():lt.resolve([])}}const L8=window.AudioContext||window.webkitAudioContext;let Uc=null;const Jn=new class extends Pr{constructor(){super(...arguments),Pe(this,"prevState",void 0),Pe(this,"curState",void 0),Pe(this,"currentTime",void 0),Pe(this,"currentTimeStuckAt",void 0),Pe(this,"interruptDetectorTrack",void 0),Pe(this,"onLocalAudioTrackMute",()=>{L.info("ios15-interruption-start"),this.emit(cs.IOS_15_16_INTERRUPTION_START)}),Pe(this,"onLocalAudioTrackUnmute",async()=>{L.info("ios15-interruption-end"),this.curState!=="running"||this.duringInterruption?L.info("ios15-interruption-end-canceled"):(Uc&&await Uc.suspend(),this.emit(cs.IOS_15_16_INTERRUPTION_END))})}get duringInterruption(){return this.prevState==="running"&&this.curState==="interrupted"}bindInterruptDetectorTrack(t){L.debug("webaudio bindInterruptDetectorTrack ".concat(t.getTrackId())),this.interruptDetectorTrack||(this.interruptDetectorTrack=t,this.interruptDetectorTrack._mediaStreamTrack.onmute=this.onLocalAudioTrackMute,this.interruptDetectorTrack._mediaStreamTrack.onunmute=this.onLocalAudioTrackUnmute)}unbindInterruptDetectorTrack(t){L.debug("webaudio unbindInterruptDetectorTrack ".concat(t.getTrackId())),this.interruptDetectorTrack&&this.interruptDetectorTrack===t&&(this.interruptDetectorTrack._mediaStreamTrack&&(this.interruptDetectorTrack._mediaStreamTrack.onmute=null,this.interruptDetectorTrack._mediaStreamTrack.onunmute=null),this.interruptDetectorTrack=void 0)}};function Wv(){if(!Uc){if(function(){if(!L8)return void L.error("your browser is not support web audio");L.info("create audio context");const t=Cr({},re("WEBAUDIO_INIT_OPTIONS"));L.debug("audio context init option:",JSON.stringify(t)),Uc=new L8(t),Jn.curState=Uc.state,Uc.onstatechange=()=>{Jn.prevState=Jn.curState,Jn.curState=Uc?Uc.state:void 0;const{prevState:r,curState:s}=Jn,o=s==="running",c=s==="interrupted",u=r==="running",h=r==="suspended",m=r==="interrupted",_=Rn().osVersion;(vo()||lu())&&u&&c&&(L.info("ios".concat(_,"-interruption-start")),Jn.emit(cs.IOS_INTERRUPTION_START)),(vo()||lu())&&(h||m)&&o&&(L.info("ios".concat(_,"-interruption-end")),Jn.emit(cs.IOS_INTERRUPTION_END)),r!==s&&Jn.emit(cs.STATE_CHANGE,s,r)},setInterval(()=>{var r;const s=(r=Uc)===null||r===void 0?void 0:r.currentTime;Jn.currentTime!==s?(Jn.currentTimeStuckAt&&(L.debug("AudioContext current time resume at ".concat(s)),Jn.currentTimeStuckAt=void 0),Jn.currentTime=s):(s!==Jn.currentTimeStuckAt&&(Rt.reportApiInvoke(null,{name:"WEB_AUDIO_CURRENT_TIME_STUCK",options:{currentTime:s},tag:xr.TRACER}).onSuccess(),L.warning("AudioContext current time stuck at ".concat(s))),Jn.currentTimeStuckAt=s)},5e3),async function(r){const s=["click","contextmenu","auxclick","dblclick","mousedown","mouseup","touchend","keydown","keyup"];let o,c=!1,u=!1,h=!1;function m(U){r.state==="running"?_(!1):vo()||lu()?r.state==="suspended"&&(_(!0),U&&r.resume().then(E,E)):r.state!=="closed"&&(_(!0),U&&r.resume().then(E,E))}function _(U){if(c!==U){c=U;for(let F=0,q=s;F<q.length;F+=1){const Y=q[F];U?window.addEventListener(Y,S,{capture:!0,passive:!0}):window.removeEventListener(Y,S,{capture:!0,passive:!0})}}}function E(){m(!1)}function S(){m(!0)}function R(U){if(!h)if(o.paused)if(U){let F;P(!1),h=!0;try{F=o.play(),F?F.then(k,k):(o.addEventListener("playing",k),o.addEventListener("abort",k),o.addEventListener("error",k))}catch{k()}}else P(!0);else P(!1)}function P(U){if(u!==U){u=U;for(let F=0,q=s;F<q.length;F++){const Y=q[F];U?window.addEventListener(Y,z,{capture:!0,passive:!0}):window.removeEventListener(Y,z,{capture:!0,passive:!0})}}}function k(){o.removeEventListener("playing",k),o.removeEventListener("abort",k),o.removeEventListener("error",k),h=!1,R(!1)}function z(){R(!0)}if(vo()){const U=r.createMediaStreamDestination(),F=document.createElement("div");F.innerHTML="<audio x-webkit-airplay='deny'></audio>",o=F.children.item(0),o.controls=!1,o.disableRemotePlayback=!0,o.preload="auto",o.srcObject=U.stream,R(!0)}Jn.on(cs.STATE_CHANGE,function(){m(!0)}),m(!1)}(Uc)}(),!Uc)throw new Le(X.NOT_SUPPORTED,"can not create audio context");return Uc}return Uc}function V_(t){if(function(){if(mx!==null)return mx;const o=Wv(),c=o.createBufferSource(),u=o.createGain(),h=o.createGain();c.connect(u),c.connect(h),c.disconnect(u);let m=!1;try{c.disconnect(u)}catch{m=!0}return c.disconnect(),mx=m,m}())return;const r=t.connect,s=t.disconnect;t.connect=(o,c,u)=>{var h;return t._inputNodes||(t._inputNodes=[]),ot(h=t._inputNodes).call(h,o)||(o instanceof AudioNode?(t._inputNodes.push(o),r.call(t,o,c,u)):r.call(t,o,c)),t},t.disconnect=(o,c,u)=>{s.call(t),o?jA(t._inputNodes,o):t._inputNodes=[];for(const h of t._inputNodes)r.call(t,h)}}let mx=null;function gx(t,r){let s=!1;const o=1/r;if(re("DISABLE_WEBAUDIO")){const c=window.setInterval(()=>{s?window.clearInterval(c):t(performance.now()/1e3)},1e3*o)}else{const c=Wv();let u=c.createGain();u.gain.value=0,u.connect(c.destination);const h=()=>{if(s)return void(u=null);const m=c.createOscillator();m.onended=h,m.connect(u),m.start(0),m.stop(c.currentTime+o),t(c.currentTime)};h()}return()=>{s=!0}}class x8{constructor(){Pe(this,"context",void 0),Pe(this,"analyserNode",void 0),Pe(this,"sourceNode",void 0),this.context=Wv(),this.analyserNode=this.context.createAnalyser(),this.analyserNode.fftSize=2048,this.analyserNode.smoothingTimeConstant=.4}updateSource(r){if(r!==this.sourceNode){if(this.sourceNode)try{this.sourceNode.disconnect(this.analyserNode)}catch{}this.sourceNode=r,r==null||r.connect(this.analyserNode)}}getVolumeLevel(){if(!this.sourceNode||(!this.context||vo()||lu()||this.context.state!=="running"&&this.context.resume(),!this.analyserNode))return 0;const r=new Float32Array(this.analyserNode.fftSize);if(this.analyserNode.getFloatTimeDomainData)this.analyserNode.getFloatTimeDomainData(r);else{const o=new Uint8Array(this.analyserNode.fftSize);this.analyserNode.getByteTimeDomainData(o);for(let c=0;c<r.length;++c)r[c]=o[c]/128-1}const s=Ya(r).call(r,(o,c)=>o+c*c,0)/r.length;return Math.max(10*Math.log10(s)+100,0)/100}getAnalyserNode(){return this.analyserNode}rebuildAnalyser(){try{var r,s;(r=this.sourceNode)===null||r===void 0||r.disconnect(this.analyserNode),this.analyserNode=this.context.createAnalyser(),this.analyserNode.fftSize=2048,this.analyserNode.smoothingTimeConstant=.4,(s=this.sourceNode)===null||s===void 0||s.connect(this.analyserNode)}catch{L.warning("rebuild analyser node failed.")}}destroy(){this.updateSource(void 0)}}class M8 extends Pr{get processSourceNode(){return this.sourceNode}set processedNode(r){var s;if(!this.isDestroyed&&this._processedNode!==r){try{var o;(o=this.sourceNode)===null||o===void 0||o.disconnect(this.outputNode)}catch{}(s=this._processedNode)===null||s===void 0||s.disconnect(),this._processedNode=r,this.connect()}}get processedNode(){return this._processedNode}constructor(){super(),Pe(this,"outputNode",void 0),Pe(this,"outputTrack",void 0),Pe(this,"isPlayed",!1),Pe(this,"sourceNode",void 0),Pe(this,"context",void 0),Pe(this,"audioBufferNode",void 0),Pe(this,"destNode",void 0),Pe(this,"audioOutputLevel",0),Pe(this,"volumeLevelAnalyser",void 0),Pe(this,"_processedNode",void 0),Pe(this,"playNode",void 0),Pe(this,"isDestroyed",!1),Pe(this,"onNoAudioInput",void 0),Pe(this,"isNoAudioInput",!1),Pe(this,"_noAudioInputCount",0),this.context=Wv(),this.playNode=this.context.destination,this.outputNode=this.context.createGain(),V_(this.outputNode),this.volumeLevelAnalyser=new x8}startGetAudioBuffer(r){this.audioBufferNode||(this.audioBufferNode=this.context.createScriptProcessor(r),this.outputNode.connect(this.audioBufferNode),this.audioBufferNode.connect(this.context.destination),this.audioBufferNode.onaudioprocess=s=>{this.emit(xc.ON_AUDIO_BUFFER,function(o){for(let c=0;c<o.outputBuffer.numberOfChannels;c+=1){const u=o.outputBuffer.getChannelData(c);for(let h=0;h<u.length;h+=1)u[h]=0}return o.inputBuffer}(s))})}stopGetAudioBuffer(){this.audioBufferNode&&(this.audioBufferNode.onaudioprocess=null,this.outputNode.disconnect(this.audioBufferNode),this.audioBufferNode=void 0)}createOutputTrack(){if(!kn().webAudioMediaStreamDest)throw new Le(X.NOT_SUPPORTED,"your browser is not support audio processor");return this.destNode&&this.outputTrack||(this.destNode=this.context.createMediaStreamDestination(),this.outputNode.connect(this.destNode),this.outputTrack=this.destNode.stream.getAudioTracks()[0]),this.outputTrack}play(r){this.context.state!=="running"&&BA(()=>{Jn.emit("autoplay-failed")}),this.isPlayed=!0,this.playNode=r||this.context.destination,this.outputNode.connect(this.playNode)}stop(){if(this.isPlayed)try{this.outputNode.disconnect(this.playNode)}catch{}this.isPlayed=!1}getAccurateVolumeLevel(){return this.volumeLevelAnalyser.getVolumeLevel()}async checkHasAudioInput(){let r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;if(r>5)return this.isNoAudioInput=!0,this.onNoAudioInput&&this.onNoAudioInput(),!1;vo()||lu()?this.context.state==="suspended"&&this.context.resume():this.context.state!=="running"&&this.context.resume();const s=this.volumeLevelAnalyser.getAnalyserNode();let o;s.getFloatTimeDomainData?(o=new Float32Array(s.fftSize),s.getFloatTimeDomainData(o)):(o=new Uint8Array(s.fftSize),s.getByteTimeDomainData(o));let c=!1;for(let u=0;u<o.length;u++)o[u]!==0&&(c=!0);return c?(this.isNoAudioInput=!1,!0):(await os(200),await this.checkHasAudioInput(r?r+1:1)&&c)}getAudioVolume(){return this.outputNode.gain.value}setVolume(r){this.outputNode.gain.setValueAtTime(r,this.context.currentTime)}destroy(){this.disconnect(),this.stop(),this.isDestroyed=!0,this.onNoAudioInput=void 0}disconnect(){var r,s;(r=this.processedNode)===null||r===void 0||r.disconnect(),(s=this.sourceNode)===null||s===void 0||s.disconnect(),this.outputNode&&this.outputNode.disconnect()}connect(){var r;this.processedNode?(r=this.processedNode)===null||r===void 0||r.connect(this.outputNode):this.sourceNode&&this.sourceNode.connect(this.outputNode),this.volumeLevelAnalyser.updateSource(this.outputNode)}}class U8 extends M8{get isFreeze(){return!1}constructor(r,s,o){var c;if(super(),Pe(this,"sourceNode",void 0),Pe(this,"track",void 0),Pe(this,"clonedTrack",void 0),Pe(this,"audioElement",void 0),Pe(this,"isCurrentTrackCloned",!1),Pe(this,"isRemoteTrack",!1),Pe(this,"originVolumeLevelAnalyser",void 0),Pe(this,"rebuildWebAudio",async()=>{if(L.debug("ready to rebuild web audio, state:",this.context.state),this.isNoAudioInput&&await this.checkHasAudioInput(),!this.isNoAudioInput||this.isDestroyed)return document.body.removeEventListener("click",this.rebuildWebAudio,!0),void L.debug("rebuild web audio success, current volume status",this.getAccurateVolumeLevel());this.context.resume().then(()=>L.info("resume success")),L.debug("rebuild web audio because of ios 12 bugs"),this.disconnect();const m=this.track;this.track=this.track.clone(),this.isCurrentTrackCloned?m.stop():this.isCurrentTrackCloned=!0;const _=new MediaStream([this.track]);this.sourceNode=this.context.createMediaStreamSource(_),V_(this.sourceNode),this.volumeLevelAnalyser.rebuildAnalyser();const E=this.outputNode.gain.value;this.outputNode=this.context.createGain(),this.outputNode.gain.setValueAtTime(E,this.context.currentTime),V_(this.outputNode),this.emit(xc.UPDATE_SOURCE),this.connect(),this.audioElement.srcObject=_,this.isPlayed&&this.play(this.playNode),this.checkHasAudioInput()}),r.kind!=="audio")throw new Le(X.UNEXPECTED_ERROR);this.track=r;const u=new MediaStream([this.track]);if(this.isRemoteTrack=!!s,this.sourceNode=this.context.createMediaStreamSource(u),V_(this.sourceNode),o){const m=o.clone();m.enabled=!0,this.clonedTrack=m,L.debug("create an unmuted track ".concat(m.id," from the original track ").concat(o.id," to get the volume"));const _=this.context.createMediaStreamSource(new MediaStream([m]));V_(_),this.originVolumeLevelAnalyser=new x8,this.originVolumeLevelAnalyser.updateSource(_)}this.connect(),this.audioElement=document.createElement("audio"),this.audioElement.srcObject=u;const h=Rn();s&&h.os===zi.IOS&&Number((c=h.osVersion)===null||c===void 0?void 0:c.split(".")[0])<15&&(Jn.on(cs.STATE_CHANGE,()=>{this.context.state==="suspended"?document.body.addEventListener("click",this.rebuildWebAudio,!0):this.context.state==="running"&&this.rebuildWebAudio()}),this.checkHasAudioInput().then(m=>{m||document.body.addEventListener("click",this.rebuildWebAudio,!0)}))}updateTrack(r){this.sourceNode.disconnect(),this.track=r,this.isCurrentTrackCloned=!1;const s=new MediaStream([r]);this.sourceNode=this.context.createMediaStreamSource(s),V_(this.sourceNode),this.processedNode||this.sourceNode.connect(this.outputNode),this.emit(xc.UPDATE_SOURCE),this.audioElement.srcObject=s}destroy(){var r;this.audioElement.srcObject=null,this.audioElement.remove(),Jn.off("state-change",this.rebuildWebAudio),(r=this.originVolumeLevelAnalyser)===null||r===void 0||r.destroy(),this.clonedTrack=void 0,super.destroy()}createMediaStreamSourceNode(r){return this.context.createMediaStreamSource(new MediaStream([r]))}updateOriginTrack(r){const s=r.clone();s.enabled=!0,this.clonedTrack&&(this.clonedTrack.stop(),this.clonedTrack=s),L.debug("create an unmuted track ".concat(s.id," from the original track ").concat(r.id," to get the volume"));const o=this.context.createMediaStreamSource(new MediaStream([s]));V_(o),this.originVolumeLevelAnalyser&&this.originVolumeLevelAnalyser.updateSource(o)}getOriginVolumeLevel(){return this.originVolumeLevelAnalyser?this.originVolumeLevelAnalyser.getVolumeLevel():this.getAccurateVolumeLevel()}}async function V8(t,r,s){const o=(u,h)=>u?typeof u!="number"?u.max||u.exact||u.ideal||u.min||h:u:h,c={audio:!!s&&{mandatory:{chromeMediaSource:"desktop"}},video:{mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:t,maxHeight:o(r.height,1080),maxWidth:o(r.width,1920)}}};return r.frameRate&&typeof r.frameRate!="number"?(c.video.mandatory.maxFrameRate=r.frameRate.max,c.video.mandatory.minFrameRate=r.frameRate.min):typeof r.frameRate=="number"&&(c.video.mandatory.maxFrameRate=r.frameRate),await navigator.mediaDevices.getUserMedia(c)}async function Spe(t,r){const s=await F8(t.mediaSource),{sourceId:o,audio:c}=await function(u){let h=arguments.length>1&&arguments[1]!==void 0&&arguments[1];return new lt((m,_)=>{const E=document.createElement("div");E.innerText="share screen",E.setAttribute("style","text-align: center; height: 25px; line-height: 25px; border-radius: 4px 4px 0 0; background: #D4D2D4; border-bottom:  solid 1px #B9B8B9;");const S=document.createElement("div");S.setAttribute("style","width: 100%; height: 500px; padding: 15px 25px ; box-sizing: border-box;");const R=document.createElement("div");R.innerText="Agora Web Screensharing wants to share the contents of your screen with webdemo.agorabeckon.com. Choose what you'd like to share.",R.setAttribute("style","height: 12%;");const P=document.createElement("div");P.setAttribute("style","width: 100%; height: 80%; background: #FFF; border:  solid 1px #CBCBCB; display: flex; flex-wrap: wrap; justify-content: space-around; overflow-y: scroll; padding: 0 15px; box-sizing: border-box;");const k=document.createElement("div");k.setAttribute("style","display: flex; justify-content: space-between; padding: 16px 0;");const z=document.createElement("button");z.innerHTML="cancel",z.setAttribute("style","width: 85px;"),z.onclick=()=>{document.body.removeChild(q);const Y=new Error("NotAllowedError");Y.name="NotAllowedError",_(Y)};let U=h;const F=document.createElement("div");if(h){const Y=document.createElement("input");Y.setAttribute("type","checkbox");const le=document.createElement("span");Y.setAttribute("style","margin-right: 6px;"),le.innerText="Share audio",Y.checked=U,Y.onchange=()=>{U=Y.checked},F.appendChild(Y),F.appendChild(le)}k.appendChild(F),k.appendChild(z),S.appendChild(R),S.appendChild(P),S.appendChild(k);const q=document.createElement("div");q.setAttribute("style","position: fixed; z-index: 99999999; top: 50%; left: 50%; width: 620px; height: 525px; background: #ECECEC; border-radius: 4px; -webkit-transform: translate(-50%,-50%); transform: translate(-50%,-50%);"),q.appendChild(E),q.appendChild(S),document.body.appendChild(q),u.map(Y=>{if(Y.id){const le=document.createElement("div");le.setAttribute("style","width: 30%; height: 160px; padding: 20px 0; text-align: center;box-sizing: content-box;");let ye=Y.thumbnail;try{const{width:Ee}=ye.getSize();Ee>1920&&(ye=ye.resize({width:1920}))}catch(Ee){throw Ee&&Ee.message.startsWith("Illegal invocation")&&console.error("Operate thumbnail error, please try to set contextIsolation: false. (https://github.com/electron/electron/issues/34953)"),Ee}le.innerHTML='<div style="height: 120px; display: table-cell; vertical-align: middle;"><img style="width: 100%; background: #333333; box-shadow: 1px 1px 1px 1px rgba(0, 0, 0, 0.2);" src='+ye.toDataURL()+' /></div><span style="	height: 40px; line-height: 40px; display: inline-block; width: 70%; word-break: keep-all; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;">'+Y.name.replace(/[\u00A0-\u9999<>\&]/g,function(Ee){return"&#"+Ee.charCodeAt(0)+";"})+"</span>",le.onclick=()=>{document.body.removeChild(q),m({sourceId:Y.id,audio:U})},P.appendChild(le)}})})}(s,r);return await V8(o,t,c)}async function F8(t){let r=["window","screen"];t!=="application"&&t!=="window"||(r=["window"]),t==="screen"&&(r=["screen"]);const s=JW();if(!s)throw console.error("failed to fetch electron, please mount it to window"),new Le(X.ELECTRON_IS_NULL);let o=null;try{var c;o=((c=s.desktopCapturer)===null||c===void 0?void 0:c.getSources({types:r}))||s.ipcRenderer.invoke("DESKTOP_CAPTURER_GET_SOURCES",{types:r})}catch{o=null}o&&o.then||(o=new lt((u,h)=>{s.desktopCapturer.getSources({types:r},(m,_)=>{m?h(m):u(_)})}));try{return await o}catch(u){throw new Le(X.ELECTRON_DESKTOP_CAPTURER_GET_SOURCES_ERROR,u.toString())}}const _x=new ks("safari");let j8=!1,B8=!1;async function Vc(t,r){let s=0,o=null;for(;s<2;)try{o=await bpe(t,r,s>0);break}catch(c){if(c instanceof Le)throw L.error("[".concat(r,"] ").concat(c.toString())),c;const u=QA(c.name||c.code||c,c.message);if(u.code===X.MEDIA_OPTION_INVALID){L.debug("[".concat(r,"] detect media option invalid, retry")),s+=1,await os(500);continue}throw L.error("[".concat(r,"] ").concat(u.toString())),u}if(!o)throw new Le(X.UNEXPECTED_ERROR,"can not find stream after getUserMedia");return o}async function bpe(t,r,s){if(!navigator.mediaDevices||!navigator.mediaDevices.getUserMedia)throw new Le(X.NOT_SUPPORTED,"can not find getUserMedia");s&&(t.video&&(delete t.video.width,delete t.video.height),t.screen&&(delete t.screen.width,delete t.screen.height));const o=kn(),c=new MediaStream;if(t.audioSource&&c.addTrack(t.audioSource),t.videoSource&&c.addTrack(t.videoSource),!t.audio&&!t.video&&!t.screen)return L.debug("Using Video Source/ Audio Source"),c;if(t.screen)if(JW())t.screen.sourceId?zv(c,await V8(t.screen.sourceId,t.screen,!!t.screenAudio)):zv(c,await Spe(t.screen,!!t.screenAudio));else if($f()&&t.screen.extensionId&&t.screen.mandatory){if(!o.getStreamFromExtension)throw new Le(X.NOT_SUPPORTED,"This browser does not support screen sharing");L.debug("[".concat(r,'] Screen access on chrome stable, looking for extension"'));const P=await(h=t.screen.extensionId,m=r,new lt((k,z)=>{try{chrome.runtime.sendMessage(h,{getStream:!0},U=>{if(!U||!U.streamId)return L.error("[".concat(m,"] No response from Chrome Plugin. Plugin not installed properly"),U),void z(new Le(X.CHROME_PLUGIN_NO_RESPONSE,"No response from Chrome Plugin. Plugin not installed properly"));k(U.streamId)})}catch(U){L.error("[".concat(m,"] AgoraRTC screensharing plugin is not accessible(").concat(h,")"),U.toString()),z(new Le(X.CHROME_PLUGIN_NOT_INSTALL))}}));t.screen.mandatory.chromeMediaSourceId=P,zv(c,await navigator.mediaDevices.getUserMedia({video:{mandatory:t.screen.mandatory}}))}else if(o.getDisplayMedia){var u;t.screen.mediaSource&&P8(t.screen.mediaSource);const P={width:t.screen.width,height:t.screen.height,frameRate:t.screen.frameRate,displaySurface:(u=t.screen.displaySurface)!==null&&u!==void 0?u:t.screen.mediaSource==="screen"?"monitor":t.screen.mediaSource},{selfBrowserSurface:k,surfaceSwitching:z,systemAudio:U,preferCurrentTab:F}=t.screen,q={selfBrowserSurface:k,surfaceSwitching:z,systemAudio:U,preferCurrentTab:F};!k&&delete q.selfBrowserSurface,!z&&delete q.surfaceSwitching,!U&&delete q.systemAudio,!F&&delete q.preferCurrentTab,L.debug("[".concat(r,"] getDisplayMedia:"),JSON.stringify({video:P,audio:t.screenAudio,controls:q})),zv(c,await navigator.mediaDevices.getDisplayMedia(Cr({video:P,audio:t.screenAudio},q)))}else{if(!Dr())throw L.error("[".concat(r,"] This browser does not support screenSharing")),new Le(X.NOT_SUPPORTED,"This browser does not support screen sharing");{t.screen.mediaSource&&P8(t.screen.mediaSource);const P={video:{mediaSource:t.screen.mediaSource,width:t.screen.width,height:t.screen.height,frameRate:t.screen.frameRate}};L.debug("[".concat(r,"] getUserMedia: ").concat(JSON.stringify(P))),zv(c,await navigator.mediaDevices.getUserMedia(P))}}var h,m;if(!t.video&&!t.audio)return c;let _={video:t.video,audio:t.audio},E=re("MEDIA_DEVICE_CONSTRAINTS");if(E)try{typeof E=="string"&&(E=JSON.parse(E)),_=qL(_,E)}catch{}L.debug("[".concat(r,"] GetUserMedia"),JSON.stringify(_)),Rn();let S,R=null;(Ss()||vo()||VA())&&(R=await _x.lock());try{S=await navigator.mediaDevices.getUserMedia(_)}catch(P){throw R&&R(),P}return _.audio&&(j8=!0),_.video&&(B8=!0),zv(c,S),R&&R(),c}function QA(t,r){switch(t){case"Starting video failed":case"OverconstrainedError":case"TrackStartError":return new Le(X.MEDIA_OPTION_INVALID,"".concat(t,": ").concat(r));case"NotFoundError":case"DevicesNotFoundError":return new Le(X.DEVICE_NOT_FOUND,"".concat(t,": ").concat(r));case"NotSupportedError":return new Le(X.NOT_SUPPORTED,"".concat(t,": ").concat(r));case"NotReadableError":return new Le(X.NOT_READABLE,"".concat(t,": ").concat(r));case"InvalidStateError":case"NotAllowedError":case"PERMISSION_DENIED":case"PermissionDeniedError":return new Le(X.PERMISSION_DENIED,"".concat(t,": ").concat(r));case"ConstraintNotSatisfiedError":return new Le(X.CONSTRAINT_NOT_SATISFIED,"".concat(t,": ").concat(r));default:return L.error("getUserMedia unexpected error",t),new Le(X.UNEXPECTED_ERROR,"".concat(t,": ").concat(r))}}function zv(t,r){const s=t.getVideoTracks()[0],o=t.getAudioTracks()[0],c=r.getVideoTracks()[0],u=r.getAudioTracks()[0];u&&(o&&t.removeTrack(o),t.addTrack(u)),c&&(s&&t.removeTrack(s),t.addTrack(c))}const Fc=new class extends Pr{get state(){return this._state}set state(t){t!==this._state&&(this.emit(U_.STATE_CHANGE,t),this._state=t)}constructor(){super(),Pe(this,"_state",bT.IDLE),Pe(this,"isAccessMicrophonePermission",!1),Pe(this,"isAccessCameraPermission",!1),Pe(this,"lastAccessMicrophonePermission",!1),Pe(this,"lastAccessCameraPermission",!1),Pe(this,"checkdeviceMatched",!1),Pe(this,"deviceInfoMap",new Map),this.init().then(()=>{navigator.mediaDevices.addEventListener&&navigator.mediaDevices.addEventListener("devicechange",this.updateDevicesInfo.bind(this)),window.setInterval(()=>{(re("ENUMERATE_DEVICES_INTERVAL")||(FA()||UA()===zi.HARMONY_OS)&&Kf())&&this.updateDevicesInfo()},re("ENUMERATE_DEVICES_INTERVAL_TIME"))}).catch(t=>L.error(t.toString()))}async enumerateDevices(t,r){let s=arguments.length>2&&arguments[2]!==void 0&&arguments[2];if(!navigator.mediaDevices||!navigator.mediaDevices.enumerateDevices)return new Le(X.NOT_SUPPORTED,"enumerateDevices() not supported.").throw();const o=await navigator.mediaDevices.enumerateDevices(),c=this.checkMediaDeviceInfoIsOk(o);let u=!this.isAccessMicrophonePermission&&t,h=!this.isAccessCameraPermission&&r;c.audio&&(u=!1),c.video&&(h=!1);let m=null,_=null,E=null;if(!s&&(u||h)){if(_x.isLocked&&(L.debug("[device manager] wait GUM lock"),(await _x.lock())(),L.debug("[device manager] GUM unlock")),j8&&(u=!1,this.isAccessMicrophonePermission=!0),B8&&(h=!1,this.isAccessCameraPermission=!0),L.debug("[device manager] check media device permissions",t,r,u,h),u&&h){try{E=await navigator.mediaDevices.getUserMedia({audio:!0,video:!0})}catch(S){const R=QA(S.name||S.code||S,S.message);if(R.code===X.PERMISSION_DENIED)throw R;L.warning("getUserMedia failed in getDevices",R)}this.isAccessCameraPermission=!0,this.isAccessMicrophonePermission=!0}else if(u){try{m=await navigator.mediaDevices.getUserMedia({audio:t})}catch(S){const R=QA(S.name||S.code||S,S.message);if(R.code===X.PERMISSION_DENIED)throw R;L.warning("getUserMedia failed in getDevices",R)}this.isAccessMicrophonePermission=!0}else if(h){try{_=await navigator.mediaDevices.getUserMedia({video:r})}catch(S){const R=QA(S.name||S.code||S,S.message);if(R.code===X.PERMISSION_DENIED)throw R;L.warning("getUserMedia failed in getDevices",R)}this.isAccessCameraPermission=!0}L.debug("[device manager] mic permission",t,"cam permission",r)}try{const S=await navigator.mediaDevices.enumerateDevices();return m&&m.getTracks().forEach(R=>R.stop()),_&&_.getTracks().forEach(R=>R.stop()),E&&E.getTracks().forEach(R=>R.stop()),m=null,_=null,E=null,S}catch(S){return m&&m.getTracks().forEach(R=>R.stop()),_&&_.getTracks().forEach(R=>R.stop()),E&&E.getTracks().forEach(R=>R.stop()),m=null,_=null,E=null,new Le(X.ENUMERATE_DEVICES_FAILED,S.toString()).throw()}}async getRecordingDevices(){let t=arguments.length>0&&arguments[0]!==void 0&&arguments[0];return(await this.enumerateDevices(!0,!1,t)).filter(r=>r.kind==="audioinput")}async getCamerasDevices(){let t=arguments.length>0&&arguments[0]!==void 0&&arguments[0];return(await this.enumerateDevices(!1,!0,t)).filter(r=>r.kind==="videoinput")}async getSpeakers(){let t=arguments.length>0&&arguments[0]!==void 0&&arguments[0];return(await this.enumerateDevices(!0,!1,t)).filter(r=>r.kind==="audiooutput")}searchDeviceIdByName(t){let r=null;return this.deviceInfoMap.forEach(s=>{s.device.label===t&&(r=s.device.deviceId)}),r}async getDeviceById(t){const r=(await this.enumerateDevices(!0,!0,!0)).find(s=>s.deviceId===t);if(!r)throw new Le(X.DEVICE_NOT_FOUND,"deviceId: ".concat(t));return r}async init(){this.state=bT.INITING;try{await this.updateDevicesInfo(),this.state=bT.INITEND}catch(t){throw L.warning("Device Detection functionality cannot start properly.",t.toString()),this.state=bT.IDLE,(typeof isSecureContext=="boolean"?isSecureContext:location.protocol==="https:"||location.protocol==="file:"||location.hostname==="localhost"||location.hostname==="127.0.0.1"||location.hostname==="::1")||new Le(X.WEB_SECURITY_RESTRICT,"Your context is limited by web security, please try using https protocol or localhost.").throw(),t}}async updateDevicesInfo(){const t=await this.enumerateDevices(!0,!0,!0),r=Date.now(),s=[];if(t[0]&&t[0].label&&this.checkdeviceMatched===!1){this.checkdeviceMatched=!0;const c=t.find(h=>h.kind==="audioinput"&&h.deviceId==="default"),u=t.find(h=>h.kind==="audiooutput"&&h.deviceId==="default");c&&u?u.groupId===c.groupId?L.debug("[device-check] default input ".concat(c.label," and output ").concat(u.label," is the same group")):L.debug("[device-check] default input ".concat(c.label," and output ").concat(u.label," is not the same group")):L.debug("[device-check] default input or output not found")}const o=this.checkMediaDeviceInfoIsOk(t);if(t.forEach(c=>{if(!c.deviceId)return;const u=this.deviceInfoMap.get("".concat(c.kind,"_").concat(c.deviceId));if((u?u.state:"INACTIVE")!=="ACTIVE"){const h={initAt:r,updateAt:r,device:c,state:"ACTIVE"};this.deviceInfoMap.set("".concat(c.kind,"_").concat(c.deviceId),h),s.push(h)}u&&(u.updateAt=r)}),this.deviceInfoMap.forEach((c,u)=>{c.state==="ACTIVE"&&c.updateAt!==r&&(c.state="INACTIVE",s.push(c))}),this.state!==bT.INITEND)return o.audio&&(this.lastAccessMicrophonePermission=!0,this.isAccessMicrophonePermission=!0),void(o.video&&(this.lastAccessCameraPermission=!0,this.isAccessCameraPermission=!0));s.forEach(c=>{switch(c.device.kind){case"audioinput":this.lastAccessMicrophonePermission&&this.isAccessMicrophonePermission&&this.emit(U_.RECORDING_DEVICE_CHANGED,c);break;case"videoinput":this.lastAccessCameraPermission&&this.isAccessCameraPermission&&this.emit(U_.CAMERA_DEVICE_CHANGED,c);break;case"audiooutput":this.lastAccessMicrophonePermission&&this.isAccessMicrophonePermission&&this.emit(U_.PLAYOUT_DEVICE_CHANGED,c)}}),o.audio&&(this.lastAccessMicrophonePermission=!0,this.isAccessMicrophonePermission=!0),o.video&&(this.lastAccessCameraPermission=!0,this.isAccessCameraPermission=!0)}checkMediaDeviceInfoIsOk(t){const r=t.filter(c=>c.kind==="audioinput"),s=t.filter(c=>c.kind==="videoinput"),o={audio:!1,video:!1};for(const c of r)if(c.label&&c.deviceId){o.audio=!0;break}for(const c of s)if(c.label&&c.deviceId){o.video=!0;break}return o}};let yx=!1;const jc=new class extends Pr{constructor(){super(...arguments),Pe(this,"onAutoplayFailed",void 0),Pe(this,"onAudioAutoplayFailed",void 0)}};function W8(){if(Rn(),!yx){const t=r=>{r.preventDefault(),yx=!1,fT()?document.body.removeEventListener("click",t,!0):(document.body.removeEventListener("touchstart",t,!0),document.body.removeEventListener("mousedown",t,!0))};yx=!0,fT()?document.body.addEventListener("click",t,!0):(document.body.addEventListener("touchstart",t,!0),document.body.addEventListener("mousedown",t,!0)),L.info("detect media autoplay failed, document: https://docs.agora.io/cn/Voice/autoplay_policy_web_ng?platform=Web"),jc.onAutoplayFailed?jc.onAutoplayFailed():jc.onAudioAutoplayFailed?L.warning(`AgoraRTC.onAudioAutoplayFailed has been deprecated in favor of AgoraRTC.onAutoplayFailed.

  Please refer to the Agora document to migrate the newer API, https://docs.agora.io/en/Voice/autoplay_policy_web_ng?platform=Web .`):L.warning(`We have detected a media autoplay failed event, and found out that you haven't implemented AgoraRTC.onAutoplayFailed callback yet.

  It will cause audio/video element not playing automatically on some browsers without user interaction, possibly hurting user experiences.

  Please refer to the Agora document to properly handle autoplay failed event, https://docs.agora.io/en/Voice/autoplay_policy_web_ng?platform=Web .`),jc.emit("autoplay-failed")}}function z8(t,r,s,o){if(!t)return;const c=Rt.getBaseInfoBySessionId(t);if(!c)return;const u=c.info,h=Date.now(),m=Cr(Cr({},u),{},{vid:u.vid===void 0?0:Number(u.vid),lts:h,elapse:h-c.startTime,cbRegistered:jc.onAutoplayFailed||jc.onAudioAutoplayFailed?1:-1,errorMsg:s,mediaType:r,trackId:o,extend:void 0});Rt.send({type:Rr.AUTOPLAY_FAILED,data:m},!0)}const Tpe=["play","playing","loadeddata","canplay","pause","stalled","suspend","waiting","abort","emptied","ended","error"],Ko=new class{constructor(){Pe(this,"onAutoplayFailed",void 0),Pe(this,"elementMap",new Map),Pe(this,"elementStateMap",new Map),Pe(this,"elementsNeedToResume",[]),Pe(this,"sinkIdMap",new Map),Pe(this,"autoResumeAfterInterruption",t=>{Array.from(this.elementMap.entries()).forEach(r=>{let[s,o]=r;const c=this.elementStateMap.get(s),u=o.srcObject.getAudioTracks()[0],h=u&&u.readyState;if(L.debug("resume after interrupted, ele: ".concat(c," audio: ").concat(h," ").concat(t)),h==="live"){if(t)return o.pause(),void o.play();if(Jn.curState==="running")return Pv()?(o.pause(),void o.play()):void(c&&c==="paused"&&o.play())}})}),Pe(this,"autoResumeAfterInterruptionOnIOS15_16",()=>{Array.from(this.elementMap.entries()).forEach(t=>{let[r,s]=t;const o=s.srcObject.getAudioTracks()[0];o&&o.readyState==="live"&&(L.debug("auto resume after interruption inside autoResumeAfterInterruptionOnIOS15"),s.pause(),s.play())})}),this.autoResumeAudioElement(),Jn.on(cs.IOS_INTERRUPTION_END,this.autoResumeAfterInterruption),Jn.on(cs.IOS_15_16_INTERRUPTION_END,this.autoResumeAfterInterruptionOnIOS15_16),Jn.on(cs.STATE_CHANGE,()=>{vo()&&Jn.prevState==="suspended"&&Jn.curState==="running"&&this.autoResumeAfterInterruption()})}async setSinkID(t,r){const s=this.elementMap.get(t);if(this.sinkIdMap.set(t,r),s)try{await s.setSinkId(r)}catch(o){throw new Le(X.PERMISSION_DENIED,"can not set sink id: "+o.toString())}}play(t,r,s,o){if(this.elementMap.has(r))return;const c=document.createElement("audio");c.autoplay=!0,c.srcObject=new MediaStream([t]),this.bindAudioElementEvents(r,c),this.elementMap.set(r,c),this.elementStateMap.set(r,to.INIT),this.setVolume(r,s);const u=this.sinkIdMap.get(r);if(u)try{c.setSinkId(u).catch(m=>{L.warning("[".concat(r,"] set sink id failed"),m.toString())})}catch(m){L.warning("[".concat(r,"] set sink id failed"),m.toString())}const h=c.play();h&&h.then&&h.catch(m=>{o&&z8(o,"audio",m.message,r),L.warning("audio element play warning",m.toString()),this.elementMap.has(r)&&m.name==="NotAllowedError"&&(L.warning("detected audio element autoplay failed"),this.elementsNeedToResume.push(c),BA(()=>{this.onAutoplayFailed&&this.onAutoplayFailed(),W8()}))})}updateTrack(t,r){const s=this.elementMap.get(t);s&&(s.srcObject=new MediaStream([r]))}isPlaying(t){return this.elementMap.has(t)&&this.elementStateMap.get(t)==="playing"}setVolume(t,r){const s=this.elementMap.get(t);s&&(r=Math.max(0,Math.min(100,r)),s.volume=r/100)}stop(t){const r=this.elementMap.get(t);if(this.sinkIdMap.delete(t),!r)return;const s=this.elementsNeedToResume.indexOf(r);this.elementsNeedToResume.splice(s,1),r.srcObject=null,r.remove(),this.elementMap.delete(t),this.elementStateMap.delete(t)}bindAudioElementEvents(t,r){Tpe.forEach(s=>{r.addEventListener(s,o=>{const c=this.elementStateMap.get(t),u=o.type==="pause"?"paused":o.type;if(L.debug("[".concat(t,"] audio-element-status change ").concat(c," => ").concat(u)),o.type==="error"){const h=r==null?void 0:r.error;h&&L.error("[".concat(t,"] media error, code: ").concat(h.code,", message: ").concat(h.message))}this.elementStateMap.set(t,u)})})}getPlayerState(t){return this.elementStateMap.get(t)||"uninit"}autoResumeAudioElement(){const t=()=>{this.elementsNeedToResume.forEach(r=>{r.play().then(s=>{L.debug("Auto resume audio element success")}).catch(s=>{L.warning("Auto resume audio element failed!",s)})}),this.elementsNeedToResume=[]};new lt(r=>{document.body?r():window.addEventListener("load",()=>r())}).then(()=>{fT()?document.body.addEventListener("click",t,!0):(document.body.addEventListener("touchstart",t,!0),document.body.addEventListener("mousedown",t,!0))})}};function Qr(){return function(t,r,s){const o=s.value;return typeof o=="function"&&(s.value=function(){this._isClosed&&new Le(X.INVALID_OPERATION,"[".concat(this.getTrackId(),"] cannot operate a closed track")).print("warning",L);for(var c=arguments.length,u=new Array(c),h=0;h<c;h++)u[h]=arguments[h];const m=o.apply(this,u);return m instanceof lt?new lt((_,E)=>{m.then(_).catch(E)}):m}),s}}class G8 extends Pr{constructor(r){super(),Pe(this,"name","VideoProcessorDestination"),Pe(this,"ID","0"),Pe(this,"_source",void 0),Pe(this,"videoContext",void 0),Pe(this,"inputTrack",void 0),this.videoContext=r}get kind(){return"video"}get enabled(){return!0}pipe(){throw new Le(X.NOT_SUPPORTED,"VideoProcessor cannot pipe to any other Processor")}unpipe(){throw new Le(X.NOT_SUPPORTED,"VideoProcessor cannot unpipe to any other Processor")}enable(){}disable(){}updateInput(r){if(r.context!==this.videoContext)throw new Error(`ProcessorContext passed to VideoTrack.processorDestination doesn't match it's belonging VideoTrack's context.
Probably you are making pipeline like this:
videoTrack1.pipe(processor).pipe(videoTrack2.processorDestination).`);r.track&&r.track!==this.inputTrack&&(this.videoContext.chained=!0,this.inputTrack=r.track,this.emit(So.ON_TRACK,r.track))}reset(){this.inputTrack=void 0,this.videoContext.chained=!1,this.emit(So.ON_TRACK,void 0)}}class H8 extends Pr{set chained(r){this._chained=r}get chained(){return this._chained}constructor(r,s){super(),Pe(this,"constraintsMap",new Map),Pe(this,"statsRegistry",[]),Pe(this,"usageRegistry",[]),Pe(this,"trackId",void 0),Pe(this,"direction",void 0),Pe(this,"_chained",!1),this.trackId=r,this.direction=s}async getConstraints(){return await Ts(this,Mc.REQUEST_CONSTRAINTS)}async requestApplyConstraints(r,s){var o;return L.info("processor ".concat(s.name," requestApplyConstraints for ").concat(this.trackId)),r&&this.constraintsMap.set(s,r),sr(this,Mc.REQUEST_UPDATE_CONSTRAINTS,Array.from(Oc(o=this.constraintsMap).call(o)))}async requestRevertConstraints(r){var s;if(this.constraintsMap.has(r))return L.info("processor ".concat(r.name," requestRevertConstraints for ").concat(this.trackId)),this.constraintsMap.delete(r),sr(this,Mc.REQUEST_UPDATE_CONSTRAINTS,Array.from(Oc(s=this.constraintsMap).call(s)))}registerStats(r,s,o){this.statsRegistry.find(c=>c.processorID===r.ID&&c.processorName===r.name&&c.type===s)||this.statsRegistry.push({processorName:r.name,processorID:r.ID,type:s,cb:o})}unregisterStats(r,s){const o=this.statsRegistry.findIndex(c=>c.processorID===r.ID&&c.processorName===r.name&&c.type===s);o!==-1&&this.statsRegistry.splice(o,1)}gatherStats(){const r=[];for(const{processorID:s,processorName:o,type:c,cb:u}of this.statsRegistry)try{const h=u();r.push({processorID:s,processorName:o,type:c,stats:h})}catch(h){L.error(new Le(X.UNEXPECTED_ERROR,h.message))}return r}registerUsage(r,s){this.usageRegistry.find(o=>o.processorID===r.ID&&o.processorName===r.name)||this.usageRegistry.push({processorID:r.ID,processorName:r.name,cb:s})}unregisterUsage(r){const s=this.usageRegistry.findIndex(o=>o.processorID===r.ID&&o.processorName===r.name);s!==-1&&this.usageRegistry.splice(s,1)}async gatherUsage(){const r=[];if(!this.chained)return[];for(const{cb:s}of this.usageRegistry)try{let o=s();o instanceof lt&&(o=await o),r.push(Cr(Cr({},o),{},{direction:this.direction}))}catch(o){L.error("gather extension usage error",o)}return r}getDirection(){return this.direction}}class $8 extends Pr{constructor(r){super(),Pe(this,"name","AudioProcessorDestination"),Pe(this,"ID","0"),Pe(this,"inputTrack",void 0),Pe(this,"inputNode",void 0),Pe(this,"audioProcessorContext",void 0),Pe(this,"_source",void 0),this.audioProcessorContext=r}get kind(){return"audio"}get enabled(){return!0}pipe(){throw new Le(X.NOT_SUPPORTED,"AudioProcessorDestination cannot pipe to any other Processor")}unpipe(){throw new Le(X.NOT_SUPPORTED,"AudioProcessor cannot unpipe to any other Processor")}enable(){}disable(){}reset(){this.inputTrack=void 0,this.inputNode=void 0,this.audioProcessorContext.chained=!1,this.emit(So.ON_TRACK,void 0),this.emit(So.ON_NODE,void 0)}updateInput(r){if(r.context!==this.audioProcessorContext)throw new Error(`ProcessorContext passed to AudioTrack.processorDestination doesn't match it's belonging AudioTrack's context.
        Probably you are making pipeline like this: audioTrack1.pipe(processor).pipe(audioTrack2.processorDestination).`);r.track&&this.inputTrack!==r.track&&(this.audioProcessorContext.chained=!0,this.inputTrack=r.track,this.emit(So.ON_TRACK,this.inputTrack)),r.node&&this.inputNode!==r.node&&(this.audioProcessorContext.chained=!0,this.inputNode=r.node,this.emit(So.ON_NODE,this.inputNode))}}class K8 extends Pr{set chained(r){this._chained=r}get chained(){return this._chained}constructor(r,s,o){super(),Pe(this,"constraintsMap",new Map),Pe(this,"statsRegistry",[]),Pe(this,"audioContext",void 0),Pe(this,"trackId",void 0),Pe(this,"direction",void 0),Pe(this,"usageRegistry",[]),Pe(this,"_chained",!1),this.audioContext=r,this.trackId=s,this.direction=o}async getConstraints(){return Ts(this,Mc.REQUEST_CONSTRAINTS)}getAudioContext(){return this.audioContext}async requestApplyConstraints(r,s){var o;return L.info("processor ".concat(s.name," requestApplyConstraints for ").concat(this.trackId)),r&&this.constraintsMap.set(s,r),sr(this,Mc.REQUEST_UPDATE_CONSTRAINTS,Array.from(Oc(o=this.constraintsMap).call(o)))}async requestRevertConstraints(r){var s;if(this.constraintsMap.has(r))return this.constraintsMap.delete(r),sr(this,Mc.REQUEST_UPDATE_CONSTRAINTS,Array.from(Oc(s=this.constraintsMap).call(s)))}registerStats(r,s,o){this.statsRegistry.find(c=>c.processorID===r.ID&&c.processorName===r.name&&c.type===s)||this.statsRegistry.push({processorName:r.name,processorID:r.ID,type:s,cb:o})}unregisterStats(r,s){const o=this.statsRegistry.findIndex(c=>c.processorID===r.ID&&c.processorName===r.name&&c.type===s);o!==-1&&this.statsRegistry.splice(o,1)}gatherStats(){const r=[];for(const{processorID:s,processorName:o,type:c,cb:u}of this.statsRegistry)try{const h=u();r.push({processorID:s,processorName:o,type:c,stats:h})}catch(h){L.error(new Le(X.UNEXPECTED_ERROR,h.message))}return r}registerUsage(r,s){this.usageRegistry.find(o=>o.processorID===r.ID&&o.processorName===r.name)||this.usageRegistry.push({processorID:r.ID,processorName:r.name,cb:s})}unregisterUsage(r){const s=this.usageRegistry.findIndex(o=>o.processorID===r.ID&&o.processorName===r.name);s!==-1&&this.usageRegistry.splice(s,1)}async gatherUsage(){const r=[];if(!this.chained)return[];for(const{cb:s}of this.usageRegistry)try{let o=s();o instanceof lt&&(o=await o),r.push(Cr(Cr({},o),{},{direction:this.direction}))}catch(o){L.error("gather extension usage error",o)}return r}getDirection(){return this.direction}}class Ex extends Pr{get isPlayed(){return!0}get isFreeze(){return!1}constructor(){super(),Pe(this,"context",void 0),Pe(this,"processSourceNode",void 0),Pe(this,"outputTrack",void 0),Pe(this,"processedNode",void 0),Pe(this,"clonedTrack",void 0),Pe(this,"outputNode",void 0),this.outputNode=new wpe}setVolume(){}createOutputTrack(){throw new Le(X.NOT_SUPPORTED,"can not create output MediaStreamTrack when WebAudio disabled")}getOriginVolumeLevel(){return 0}getAccurateVolumeLevel(){return 0}stopGetAudioBuffer(){}startGetAudioBuffer(){}play(){}stop(){}destroy(){}updateTrack(){}updateOriginTrack(){}createMediaStreamSourceNode(){}}class wpe{disconnect(){}connect(){}}function q8(t){return new lt((r,s)=>{let o=!1;const c=document.createElement("video");c.setAttribute("autoplay",""),c.setAttribute("muted",""),c.muted=!0,c.autoplay=!0,c.setAttribute("playsinline",""),c.setAttribute("style","position: fixed; top: 0; left: 0; width: 1px; height: 1px"),document.body.appendChild(c);const u=vo()?"canplay":"playing";c.addEventListener(u,()=>{const h=c.videoWidth,m=c.videoHeight;!h&&Dr()||(o=!0,c.srcObject=null,c.remove(),r([h,m]))}),c.srcObject=new MediaStream([t]),c.play().catch(WA),setTimeout(()=>{o||(c.srcObject=null,c.remove(),r([c.videoWidth,c.videoHeight]))},4e3)})}function ZA(t){const r={};t.facingMode&&(r.facingMode=t.facingMode),t.cameraId&&(r.deviceId={exact:t.cameraId});const s=yh(t.encoderConfig);return s.width!=null&&(r.width=s.width),s.height!=null&&(r.height=s.height),!$W()&&s.frameRate&&(r.frameRate=s.frameRate),VW()&&typeof r.frameRate=="object"&&(r.frameRate.max=60),Dr()&&(r.frameRate={ideal:30,max:30}),r}function Y8(t){const r={};return $W()||(t.AGC!==void 0&&(r.autoGainControl=t.AGC),t.AEC!==void 0&&(r.echoCancellation=t.AEC),t.ANS!==void 0&&(r.noiseSuppression=t.ANS,$f()&&t.ANS&&(r.googHighpassFilter=t.ANS))),r}function X8(t){const r=Y8(t);if(t.encoderConfig){const s=XA(t.encoderConfig);r.channelCount=s.stereo?2:1,r.sampleRate=s.sampleRate,r.sampleSize=s.sampleSize}return t.microphoneId&&(r.deviceId={exact:t.microphoneId}),FA()&&(r.sampleRate=void 0),r}const Rpe=t=>{const r=t._encoderConfig;if(!r)return;const{frameRate:s,width:o,height:c}=t.getMediaStreamTrackSettings();let{frameRate:u=s,width:h=o,height:m=c}=r;if(!u||!h||!m)return;h=YL(h),m=YL(m),u=YL(u);const{max:_,min:E}=function(k,z,U){const F=200*Math.pow(U/15,.6)*Math.pow(k*z/640/360,.75);return{min:Math.floor(F),max:Math.floor(4*F)}}(h,m,u),{bitrateMax:S,bitrateMin:R}=r||{};S||L.debug("calculate bitrate: [w: ".concat(h,", h: ").concat(m,", fps: ").concat(u,"] => [brMax: ").concat(S,", brMin: ").concat(R,"]"));const{maxFramerate:P}=re("ENCODER_CONFIG_LIMIT");return P&&typeof P=="number"&&(u=Math.min(u,P)),{frameRate:u,bitrateMax:S||_,bitrateMin:R||E,scaleResolutionDownBy:1,scale:0}},J8=async(t,r,s)=>await(async(o,c,u)=>{const h=function(E){const S=[];for(let R=0;R<E.length;R+=2)S.push(parseInt(E.slice(R,R+2),16));return Uint8Array.from(S)}(c8(""+c+u)).slice(0,16),m=h.slice(0,12),_=await window.crypto.subtle.importKey("raw",h,"AES-GCM",!0,["encrypt"]);return new Uint8Array(await window.crypto.subtle.encrypt({name:"AES-GCM",iv:m},_,o))})(t.buffer,r,s),vx=t=>{const r=document.createElement("canvas");return r.width=2,r.height=2,new lt((s,o)=>{r.toBlob(async c=>{if(r.remove(),c){const u=await Q8(c);s({buffer:u,width:r.width,height:r.height})}else o(new Le(X.CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED))},t,1)})},Q8=async t=>{const r=await t.arrayBuffer();return new Uint8Array(r)};var Z8,ez,tz,nz,rz,iz,sz,oz,az,cz,lz,uz,dz,hz,fz,pz,mz,gz,Or,_z,yz,Ez,vz,Sz,bz,vh,Tz,wz,Rz,Cz,Iz,Az,Pz,Oz,kz,Nz,Dz,Lz,xz,Rs;let Br=(Z8=Mt({argsMap:(t,r)=>[t.getTrackId(),r],throttleTime:300}),ez=Mt({argsMap:(t,r)=>[t.getTrackId(),r]}),tz=Qr(),nz=Nv("LocalAudioTrack","_enabledMutex"),rz=Mt({argsMap:(t,r)=>[t.getTrackId(),r]}),iz=Qr(),sz=Nv("LocalAudioTrack","_enabledMutex"),oz=Mt({argsMap:(t,r)=>[t.getTrackId(),r]}),az=Qr(),cz=Qr(),lz=Qr(),uz=Mt({argsMap:t=>[t.getTrackId()]}),dz=Qr(),hz=Mt({argsMap:t=>[t.getTrackId()]}),fz=Qr(),pz=Mt({argsMap:t=>[t.getTrackId()]}),mz=Mt({argsMap:(t,r)=>[t.getTrackId(),r.name]}),gz=Mt({argsMap:t=>[t.getTrackId()]}),In((Or=class extends Bv{get _source(){return this.initWebAudio()}set _source(t){this._trackSource=t}get processorContext(){return this._processorContext||(this._processorContext=this.initProcessor().processorContext),this._processorContext}get processorDestination(){return this._processorDestination||(this._processorDestination=this.initProcessor().processorDestination),this._processorDestination}get isPlaying(){return this._useAudioElement?Ko.isPlaying(this.getTrackId()):this._source.isPlayed}get __className__(){return"LocalAudioTrack"}constructor(t,r,s,o){super(t,s),Pe(this,"trackMediaType",jv.AUDIO),Pe(this,"_encoderConfig",void 0),Pe(this,"_trackSource",void 0),Pe(this,"metadata",[]),Pe(this,"_enabled",!0),Pe(this,"_volume",100),Pe(this,"_useAudioElement",!0),Pe(this,"_bypassWebAudio",!1),Pe(this,"processor",void 0),Pe(this,"_processorContext",void 0),Pe(this,"_processorDestination",void 0),Pe(this,"_getOriginVolumeLevel",void 0),this._encoderConfig=r,this._getOriginVolumeLevel=!!o,this._trackSource=new Ex,re("DISABLE_WEBAUDIO")&&(this._bypassWebAudio=!0),re("LOCAL_AUDIO_TRACK_USES_WEB_AUDIO")&&(this._useAudioElement=!1),Ss()&&!Uc?setTimeout(()=>this.initWebAudio()):this.initWebAudio()}setVolume(t){er(t,"volume",0,1e3),this._volume=t,this._source.setVolume(t/100),this._useAudioElement&&Ko.setVolume(this.getTrackId(),t);try{if(this._bypassWebAudio)return void L.debug("[".concat(this.getTrackId(),"] setVolume returned because no pass through WebAudio."));const r=this._source.createOutputTrack();this._mediaStreamTrack!==r&&(this._mediaStreamTrack=r,sr(this,yt.NEED_REPLACE_TRACK,this).then(()=>{L.debug("[".concat(this.getTrackId(),"] replace web audio track success"))}).catch(s=>{L.warning("[".concat(this.getTrackId(),"] replace web audio track failed"),s)}))}catch{}}getVolumeLevel(){return this._muted&&this.enabled&&this._getOriginVolumeLevel?this._source.getOriginVolumeLevel():this._source.getAccurateVolumeLevel()}async setPlaybackDevice(t){if(!this._useAudioElement||!I8())throw new Le(X.NOT_SUPPORTED,"your browser does not support setting the audio output device");await Ko.setSinkID(this.getTrackId(),t)}async setEnabled(t,r,s){return this._setEnabled(t,r,s)}async _setEnabled(t,r,s){if(!s){if(t===this._enabled)return;this.stateCheck("enabled",t)}if(L.info("[".concat(this.getTrackId(),"] start setEnabled"),t),t){this._originMediaStreamTrack.enabled=!0;try{s||(this._enabled=!0),await sr(this,yt.NEED_ENABLE_TRACK,this),L.info("[".concat(this.getTrackId(),"] setEnabled to ").concat(t," success"))}catch(o){throw s||(this._enabled=!1),L.error("[".concat(this.getTrackId(),"] setEnabled to true error"),o.toString()),o}}else{this._originMediaStreamTrack.enabled=!1,s||(this._enabled=!1);try{await sr(this,yt.NEED_DISABLE_TRACK,this)}catch(o){throw s||(this._enabled=!0),L.error("[".concat(this.getTrackId(),"] setEnabled to false error"),o.toString()),o}}}async setMuted(t){t!==this._muted&&(this.stateCheck("muted",t),this._muted=t,this._originMediaStreamTrack.enabled=!t,L.debug("[".concat(this.getTrackId(),"] start set muted: ").concat(t)),t?await sr(this,yt.NEED_MUTE_TRACK,this):await sr(this,yt.NEED_UNMUTE_TRACK,this))}getStats(){return Im(()=>{L.warning("[deprecated] LocalAudioTrack.getStats will be removed in the future, use AgoraRTCClient.getLocalAudioStats instead")},"localAudioTrackGetStatsWarning"),Nc(this,yt.GET_STATS)||Cr({},hx)}setAudioFrameCallback(t){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:4096;if(!t)return this._source.removeAllListeners(xc.ON_AUDIO_BUFFER),void this._source.stopGetAudioBuffer();this._source.startGetAudioBuffer(r),this._source.removeAllListeners(xc.ON_AUDIO_BUFFER),this._source.on(xc.ON_AUDIO_BUFFER,s=>t(s))}play(){L.debug("[".concat(this.getTrackId(),"] start audio playback")),this._useAudioElement?(L.debug("[".concat(this.getTrackId(),"] start audio playback in element")),Ko.play(this._mediaStreamTrack,this.getTrackId(),this._volume)):this._source.play()}stop(){L.debug("[".concat(this.getTrackId(),"] stop audio playback")),this._useAudioElement?Ko.stop(this.getTrackId()):this._source.stop()}close(){super.close(),this._processorDestination&&this.unbindProcessorDestinationEvents(this._processorDestination),this._processorContext&&this.unbindProcessorContextEvents(this._processorContext),this.unpipe(),this._processorDestination&&this._processorDestination._source&&this._processorDestination._source.unpipe(),this._source.destroy()}_updatePlayerSource(){let t=!(arguments.length>0&&arguments[0]!==void 0)||arguments[0];L.debug("[".concat(this.getTrackId(),"] update player source track")),t&&this._source.updateTrack(this._mediaStreamTrack),this._useAudioElement&&Ko.updateTrack(this.getTrackId(),this._mediaStreamTrack)}async _updateOriginMediaStreamTrack(t,r){this._originMediaStreamTrack!==t&&(this._originMediaStreamTrack&&(this._originMediaStreamTrack.removeEventListener("ended",this._handleTrackEnded),r&&this._originMediaStreamTrack.stop()),t.addEventListener("ended",this._handleTrackEnded),this._originMediaStreamTrack=t,this._muted&&(this._originMediaStreamTrack.enabled=!1),this.processor&&this._processorContext&&this.processor.updateInput({track:t,context:this._processorContext}),this._mediaStreamTrack!==this._source.outputTrack?(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource(),await sr(this,yt.NEED_REPLACE_TRACK,this)):this._source.updateTrack(this._originMediaStreamTrack),this._getOriginVolumeLevel&&this._source.updateOriginTrack(t))}renewMediaStreamTrack(t){return lt.resolve(void 0)}pipe(t){if(this._bypassWebAudio)throw new Le(X.INVALID_OPERATION,"Can not process AudioTrack when bypassWebAudio set to true.");if(this.processor===t)return t;if(t._source)throw new Le(X.INVALID_OPERATION,"Processor ".concat(t.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=t,this.processor._source=this,t.updateInput({track:this._originMediaStreamTrack,node:this._source.processSourceNode,context:this.processorContext}),t}unpipe(){var t;if(!this.processor)return;const r=this.processor;(t=this._source.processSourceNode)===null||t===void 0||t.disconnect(),this.processor._source=!1,this.processor=void 0,r.reset()}bindProcessorDestinationEvents(t){t.on(So.ON_TRACK,async r=>{r?r!==this._mediaStreamTrack&&(this._mediaStreamTrack=r,this._updatePlayerSource(!1),this._source.processedNode=this._source.createMediaStreamSourceNode(r),await sr(this,yt.NEED_REPLACE_TRACK,this)):this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource(),await sr(this,yt.NEED_REPLACE_TRACK,this))}),t.on(So.ON_NODE,r=>{this._source.processedNode=r})}unbindProcessorDestinationEvents(t){t.removeAllListeners(So.ON_TRACK),t.removeAllListeners(So.ON_NODE)}bindProcessorContextEvents(t){t.on(Mc.REQUEST_CONSTRAINTS,async r=>{r(this._originMediaStreamTrack.getSettings())})}unbindProcessorContextEvents(t){t.removeAllListeners(Mc.REQUEST_CONSTRAINTS)}initWebAudio(){return this._trackSource instanceof Ex&&(this._trackSource=new U8(this._mediaStreamTrack,!1,this._getOriginVolumeLevel?this._mediaStreamTrack:void 0)),this._trackSource}initProcessor(){const t=new K8(this._source.context,this.getTrackId(),"local"),r=new $8(t);return this._processorContext=t,this._processorDestination=r,this.bindProcessorContextEvents(t),this.bindProcessorDestinationEvents(r),this._source.on(xc.UPDATE_SOURCE,()=>{this.processor&&this.processor.updateInput({node:this._source.processSourceNode,context:t})}),this._useAudioElement&&(this._useAudioElement=!1,this.isPlaying&&(Ko.stop(this.getTrackId()),this._source.play()),sr(this,yt.NEED_REPLACE_MIXING_TRACK,this).then(()=>{L.debug("[".concat(this.getTrackId(),"] replace from origin track to web audio track success"))}).catch(s=>{L.warning("[".concat(this.getTrackId(),"] replace from origin track to web audio track failed"),s)})),{processorContext:t,processorDestination:r}}}).prototype,"setVolume",[Z8],Object.getOwnPropertyDescriptor(Or.prototype,"setVolume"),Or.prototype),In(Or.prototype,"setPlaybackDevice",[ez,tz],Object.getOwnPropertyDescriptor(Or.prototype,"setPlaybackDevice"),Or.prototype),In(Or.prototype,"setEnabled",[nz,rz,iz],Object.getOwnPropertyDescriptor(Or.prototype,"setEnabled"),Or.prototype),In(Or.prototype,"setMuted",[sz,oz,az],Object.getOwnPropertyDescriptor(Or.prototype,"setMuted"),Or.prototype),In(Or.prototype,"getStats",[cz],Object.getOwnPropertyDescriptor(Or.prototype,"getStats"),Or.prototype),In(Or.prototype,"setAudioFrameCallback",[lz],Object.getOwnPropertyDescriptor(Or.prototype,"setAudioFrameCallback"),Or.prototype),In(Or.prototype,"play",[uz,dz],Object.getOwnPropertyDescriptor(Or.prototype,"play"),Or.prototype),In(Or.prototype,"stop",[hz,fz],Object.getOwnPropertyDescriptor(Or.prototype,"stop"),Or.prototype),In(Or.prototype,"close",[pz],Object.getOwnPropertyDescriptor(Or.prototype,"close"),Or.prototype),In(Or.prototype,"pipe",[mz],Object.getOwnPropertyDescriptor(Or.prototype,"pipe"),Or.prototype),In(Or.prototype,"unpipe",[gz],Object.getOwnPropertyDescriptor(Or.prototype,"unpipe"),Or.prototype),Or),eP=(_z=Mt({argsMap:(t,r)=>[t.getTrackId(),r]}),yz=Qr(),Ez=Nv("MicrophoneAudioTrack","_enabledMutex"),vz=Mt({argsMap:(t,r,s)=>[t.getTrackId(),r,s]}),Sz=Qr(),bz=Mt({argsMap:t=>[t.getTrackId()]}),In((vh=class extends Br{get __className__(){return"MicrophoneAudioTrack"}constructor(t,r,s,o){super(t,r.encoderConfig?XA(r.encoderConfig):{},o,re("GET_VOLUME_OF_MUTED_AUDIO_TRACK")),Pe(this,"_config",void 0),Pe(this,"_deviceName","default"),Pe(this,"_constraints",void 0),Pe(this,"_originalConstraints",void 0),Pe(this,"_enabled",!0),this._config=r,this._constraints=s,this._originalConstraints=s,this._deviceName=t.label,typeof r.bypassWebAudio=="boolean"&&(this._bypassWebAudio=r.bypassWebAudio),(Pv()||BL())&&Jn.bindInterruptDetectorTrack(this)}async setDevice(t){if(L.info("[".concat(this.getTrackId(),"] start set device to ").concat(t)),this._enabled)try{const r=await Fc.getDeviceById(t),s={};s.audio=Cr({},this._constraints),s.audio.deviceId={exact:t},this._originMediaStreamTrack.stop();let o=null;try{o=await Vc(s,this.getTrackId())}catch(c){throw L.error("[".concat(this.getTrackId(),"] setDevice failed"),c.toString()),o=await Vc({audio:this._constraints},this.getTrackId()),await this._updateOriginMediaStreamTrack(o.getAudioTracks()[0],!1),c}await this._updateOriginMediaStreamTrack(o.getAudioTracks()[0],!1),this._deviceName=r.label,this._config.microphoneId=t,this._constraints.deviceId={exact:t}}catch(r){throw L.error("[".concat(this.getTrackId(),"] setDevice error"),r.toString()),r}else try{const r=await Fc.getDeviceById(t);this._deviceName=r.label,this._config.microphoneId=t,this._constraints.deviceId={exact:t}}catch(r){throw L.error("[".concat(this.getTrackId(),"] setDevice error"),r.toString()),r}L.info("[".concat(this.getTrackId(),"] set device to ").concat(t," success"))}async setEnabled(t,r,s){if(r)return L.debug("[".concat(this.getTrackId(),"] setEnabled false (do not close microphone)")),await super._setEnabled(t);if(!s){if(t===this._enabled)return;this.stateCheck("enabled",t)}if(L.info("[".concat(this.getTrackId(),"] start setEnabled"),t),re("AUTO_RESET_AUDIO_ROUTE")&&(vo()||lu())){const h=navigator.audioSession;h&&(t||(h.type="playback"),h.type="auto")}if(!t){var o;this._originMediaStreamTrack.onended=null,this._originMediaStreamTrack.stop(),(o=this._source.clonedTrack)===null||o===void 0||o.stop(),s||(this._enabled=!1);try{await sr(this,yt.NEED_DISABLE_TRACK,this)}catch(h){throw L.error("[".concat(this.getTrackId(),"] setEnabled false failed"),h.toString()),h}return}const c=Cr({},this._constraints),u=Fc.searchDeviceIdByName(this._deviceName);u&&!c.deviceId&&(c.deviceId=u);try{s||(this._enabled=!0);const h=await Vc({audio:this._constraints},this.getTrackId());await this._updateOriginMediaStreamTrack(h.getAudioTracks()[0],!1),await sr(this,yt.NEED_ENABLE_TRACK,this)}catch(h){throw s||(this._enabled=!1),L.error("[".concat(this.getTrackId(),"] setEnabled true failed"),h.toString()),h}L.info("[".concat(this.getTrackId(),"] setEnabled success"))}close(){super.close(),(Pv()||BL())&&Jn.unbindInterruptDetectorTrack(this)}onTrackEnded(){if((vo()||lu())&&this._enabled&&!this._isClosed&&Jn.duringInterruption){const t=async()=>{Jn.off(cs.IOS_INTERRUPTION_END,t),this._enabled&&!this._isClosed&&(L.debug("[".concat(this.getTrackId(),"] try capture microphone media device for interrupted iOS device.")),await this.setEnabled(!1),await this.setEnabled(!0))};Jn.on(cs.IOS_INTERRUPTION_END,t)}else L.debug("[".concat(this.getTrackId(),"] track ended")),this.safeEmit(Vv.TRACK_ENDED)}async renewMediaStreamTrack(t){const r=t||this._constraints,s=Fc.searchDeviceIdByName(this._deviceName);if(s&&!r.deviceId&&(r.deviceId=s),this._constraints=r,this._enabled){this._originMediaStreamTrack.stop();const o=await Vc({audio:this._constraints},this.getTrackId());await this._updateOriginMediaStreamTrack(o.getAudioTracks()[0],!0)}}bindProcessorContextEvents(t){super.bindProcessorContextEvents(t),t.on(Mc.REQUEST_UPDATE_CONSTRAINTS,async(r,s,o)=>{try{const c=Object.assign({},this._originalConstraints,...r);await this.renewMediaStreamTrack(c),s()}catch(c){o(c)}})}unbindProcessorContextEvents(t){super.unbindProcessorContextEvents(t),t.removeAllListeners(Mc.REQUEST_UPDATE_CONSTRAINTS)}}).prototype,"setDevice",[_z,yz],Object.getOwnPropertyDescriptor(vh.prototype,"setDevice"),vh.prototype),In(vh.prototype,"setEnabled",[Ez,vz,Sz],Object.getOwnPropertyDescriptor(vh.prototype,"setEnabled"),vh.prototype),In(vh.prototype,"close",[bz],Object.getOwnPropertyDescriptor(vh.prototype,"close"),vh.prototype),vh),Cpe=(Tz=Mt({argsMap:(t,r)=>[t.getTrackId(),r,t.duration]}),wz=Qr(),Rz=Mt({argsMap:t=>[t.getTrackId()]}),Cz=Qr(),Iz=Mt({argsMap:t=>[t.getTrackId()]}),Az=Qr(),Pz=Mt({argsMap:t=>[t.getTrackId()]}),Oz=Qr(),kz=Mt({argsMap:t=>[t.getTrackId()]}),Nz=Qr(),Dz=Mt({argsMap:t=>[t.getTrackId()]}),Lz=Mt({argsMap:t=>[t.getTrackId()]}),xz=Qr(),In((Rs=class extends Br{get __className__(){return"BufferSourceAudioTrack"}constructor(t,r,s,o){super(r.createOutputTrack(),s,o),Pe(this,"source",void 0),Pe(this,"_bufferSource",void 0),this._useAudioElement=!1,this.source=t,this._bufferSource=r,this._bufferSource.on(xc.AUDIO_SOURCE_STATE_CHANGE,c=>{this.safeEmit(Vv.SOURCE_STATE_CHANGE,c)});try{this._mediaStreamTrack=this._source.createOutputTrack()}catch{}}get currentState(){return this._bufferSource.currentState}get duration(){return this._bufferSource.duration}get playbackSpeed(){return this._bufferSource.playbackSpeed}getCurrentTime(){return this._bufferSource.currentTime}startProcessAudioBuffer(t){t&&this._bufferSource.updateOptions(t),this._bufferSource.startProcessAudioBuffer()}pauseProcessAudioBuffer(){this._bufferSource.pauseProcessAudioBuffer()}seekAudioBuffer(t){this._bufferSource.seekAudioBuffer(t)}resumeProcessAudioBuffer(){this._bufferSource.resumeProcessAudioBuffer()}stopProcessAudioBuffer(){this._bufferSource.stopProcessAudioBuffer()}close(){this.source=null,this._bufferSource.destroy(),super.close()}setAudioBufferPlaybackSpeed(t){er(t,"speed",0),this._bufferSource.setAudioBufferPlaybackSpeed(t)}}).prototype,"startProcessAudioBuffer",[Tz,wz],Object.getOwnPropertyDescriptor(Rs.prototype,"startProcessAudioBuffer"),Rs.prototype),In(Rs.prototype,"pauseProcessAudioBuffer",[Rz,Cz],Object.getOwnPropertyDescriptor(Rs.prototype,"pauseProcessAudioBuffer"),Rs.prototype),In(Rs.prototype,"seekAudioBuffer",[Iz,Az],Object.getOwnPropertyDescriptor(Rs.prototype,"seekAudioBuffer"),Rs.prototype),In(Rs.prototype,"resumeProcessAudioBuffer",[Pz,Oz],Object.getOwnPropertyDescriptor(Rs.prototype,"resumeProcessAudioBuffer"),Rs.prototype),In(Rs.prototype,"stopProcessAudioBuffer",[kz,Nz],Object.getOwnPropertyDescriptor(Rs.prototype,"stopProcessAudioBuffer"),Rs.prototype),In(Rs.prototype,"close",[Dz],Object.getOwnPropertyDescriptor(Rs.prototype,"close"),Rs.prototype),In(Rs.prototype,"setAudioBufferPlaybackSpeed",[Lz,xz],Object.getOwnPropertyDescriptor(Rs.prototype,"setAudioBufferPlaybackSpeed"),Rs.prototype),Rs);class Ai extends Br{get __className__(){return"MixingAudioTrack"}get isActive(){for(const r of this.trackList)if(r._enabled&&!r._isClosed&&!r.muted)return!0;return!1}constructor(){const r=Wv().createMediaStreamDestination();super(r.stream.getAudioTracks()[0],void 0,or(8,"track-mix-")),Pe(this,"trackList",void 0),Pe(this,"destNode",void 0),this._useAudioElement=!1;try{this._mediaStreamTrack=this._source.createOutputTrack()}catch{}this.destNode=r,this.trackList=[]}hasAudioTrack(r){return this.trackList.indexOf(r)!==-1}addAudioTrack(r){this.trackList.indexOf(r)===-1?(L.debug("add ".concat(r.getTrackId()," to mixing track")),r._source.outputNode.connect(this.destNode),this.trackList.push(r),this.updateEncoderConfig()):L.debug("track ".concat(r.getTrackId()," is already added"))}removeAudioTrack(r){if(this.trackList.indexOf(r)!==-1){L.debug("remove ".concat(r.getTrackId()," from mixing track"));try{r._source.outputNode.disconnect(this.destNode)}catch{}jA(this.trackList,r),this.updateEncoderConfig()}}updateEncoderConfig(){const r={};this.trackList.forEach(s=>{s._encoderConfig&&((s._encoderConfig.bitrate||0)>(r.bitrate||0)&&(r.bitrate=s._encoderConfig.bitrate),(s._encoderConfig.sampleRate||0)>(r.sampleRate||0)&&(r.sampleRate=s._encoderConfig.sampleRate),(s._encoderConfig.sampleSize||0)>(r.sampleSize||0)&&(r.sampleSize=s._encoderConfig.sampleSize),s._encoderConfig.stereo&&(r.stereo=!0))}),this._encoderConfig=r}_updateRtpTransceiver(r){this._rtpTransceiver!==r&&(this._rtpTransceiver=r,this.trackList.forEach(s=>{s instanceof Ai?s.emit(M_.TRANSCEIVER_UPDATED,r):s._updateRtpTransceiver(r)}))}}class Ipe extends M8{set currentState(r){r!==this._currentState&&(this._currentState=r,this.safeEmit(xc.AUDIO_SOURCE_STATE_CHANGE,this._currentState))}get currentState(){return this._currentState}constructor(r){let s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};super(),Pe(this,"audioBuffer",void 0),Pe(this,"sourceNode",void 0),Pe(this,"startPlayTime",0),Pe(this,"startPlayOffset",0),Pe(this,"pausePlayTime",0),Pe(this,"options",void 0),Pe(this,"currentLoopCount",0),Pe(this,"currentPlaybackSpeed",100),Pe(this,"_currentState","stopped"),this.audioBuffer=r,this.options=s,this.startPlayOffset=this.options.startPlayTime||0}createWebAudioDiagram(){return this.context.createGain()}get duration(){return this.audioBuffer?this.audioBuffer.duration:0}get playbackSpeed(){return this.currentPlaybackSpeed}get currentTime(){return this.audioBuffer?this.currentState==="stopped"?0:this.currentState==="paused"?this.pausePlayTime:((this.context.currentTime-this.startPlayTime)*(this.playbackSpeed/100)+this.startPlayOffset)%this.audioBuffer.duration:0}updateOptions(r){this.currentState==="stopped"?(this.options=r,this.startPlayOffset=this.options.startPlayTime||0):L.warning("can not set audio source options")}startProcessAudioBuffer(){this.sourceNode&&this.stopProcessAudioBuffer(),this.sourceNode=this.createSourceNode(),this.startSourceNode(),this.currentState="playing"}pauseProcessAudioBuffer(){this.sourceNode&&this.currentState==="playing"&&(this.pausePlayTime=this.currentTime,this.sourceNode.onended=null,this.sourceNode.stop(),this.sourceNode.buffer=null,this.sourceNode=this.createSourceNode(),this.currentState="paused")}seekAudioBuffer(r){this.sourceNode&&(this.sourceNode.onended=null,this.currentState==="playing"&&this.sourceNode.stop(),this.sourceNode=this.createSourceNode(),this.currentState==="playing"?(this.startPlayOffset=r,this.startSourceNode()):this.currentState==="paused"&&(this.pausePlayTime=r))}resumeProcessAudioBuffer(){this.currentState==="paused"&&this.sourceNode&&(this.startPlayOffset=this.pausePlayTime,this.pausePlayTime=0,this.startSourceNode(),this.currentState="playing")}stopProcessAudioBuffer(){if(this.sourceNode){this.sourceNode.onended=null;try{this.sourceNode.stop()}catch{}this.reset()}}destroy(){this.audioBuffer=null,super.destroy()}setAudioBufferPlaybackSpeed(r){this.sourceNode&&(this.currentState==="playing"&&(this.startPlayOffset=this.currentTime,this.startPlayTime=this.context.currentTime),this.sourceNode.playbackRate.value=r/100),this.currentPlaybackSpeed=r}startSourceNode(){this.sourceNode&&this.sourceNode.buffer&&(this.sourceNode.start(0,this.startPlayOffset),this.startPlayTime=this.context.currentTime,this.sourceNode.onended=this.handleSourceNodeEnded.bind(this))}createSourceNode(){const r=this.context.createBufferSource();return r.buffer=this.audioBuffer,r.loop=!!this.options.loop,r.connect(this.outputNode),r.playbackRate.value=this.currentPlaybackSpeed/100,r}handleSourceNodeEnded(){if(this.currentLoopCount+=1,this.options.cycle&&this.options.cycle>this.currentLoopCount)return this.startPlayOffset=0,this.sourceNode=void 0,void this.startProcessAudioBuffer();this.reset()}reset(){this.startPlayOffset=this.options.startPlayTime||0,this.currentState="stopped",this.sourceNode&&(this.sourceNode.disconnect(),this.sourceNode=void 0),this.currentLoopCount=0}}const Mz=new Map;class Sx{get rendFrameRate(){if(this.renderStats&&this.renderStats.curTs!==this.renderStats.lastTs){const r=this.renderStats.curTs-this.renderStats.lastTs,s=(this.renderStats.renderNum-this.renderStats.lastRenderNum)/r;return this.renderStats.lastRenderNum=this.renderStats.renderNum,this.renderStats.lastTs=this.renderStats.curTs,s}return 0}get videoElementStatus(){return this._videoElementStatus}set videoElementStatus(r){r!==this._videoElementStatus&&(L.debug("[".concat(this.trackId,"] video-element-status change ").concat(this._videoElementStatus," => ").concat(r)),this._videoElementStatus=r)}get videoState(){return this._videoState}set videoState(r){var s;r!==this._videoState&&(this._videoState=r,(s=this.onVideoStateChanged)===null||s===void 0||s.call(this,this.videoState))}constructor(r){Pe(this,"trackId",void 0),Pe(this,"config",void 0),Pe(this,"onFirstVideoFrameDecoded",void 0),Pe(this,"onVideoStateChanged",void 0),Pe(this,"freezeTimeCounterList",[]),Pe(this,"renderFreezeAccTime",0),Pe(this,"isKeepLastFrame",!1),Pe(this,"timeUpdatedCount",0),Pe(this,"freezeTime",0),Pe(this,"playbackTime",0),Pe(this,"lastTimeUpdatedTime",0),Pe(this,"autoplayFailed",!1),Pe(this,"videoTrack",void 0),Pe(this,"videoElement",void 0),Pe(this,"cacheVideoElement",void 0),Pe(this,"renderStats",void 0),Pe(this,"_videoState",Eh.VideoStateStopped),Pe(this,"videoElementCheckInterval",void 0),Pe(this,"videoElementFreezeTimeout",void 0),Pe(this,"_videoElementStatus",to.NONE),Pe(this,"isGettingVideoDimensions",!1),Pe(this,"startGetVideoDimensions",()=>{const s=()=>{if(this.isGettingVideoDimensions=!0,this.videoElement.videoWidth*this.videoElement.videoHeight>4)return L.debug("[".concat(this.trackId,"] current video dimensions:"),this.videoElement.videoWidth,this.videoElement.videoHeight),void(this.isGettingVideoDimensions=!1);setTimeout(s,500)};!this.isGettingVideoDimensions&&s()}),Pe(this,"autoResumeAfterInterruption",()=>{this.videoTrack&&this.videoTrack.readyState==="live"&&Jn.curState==="running"&&(L.debug("[track-".concat(this.trackId,"] video element paused, auto resume for ").concat(UW())),GW()?(this.videoElement.srcObject=null,this.videoElement.srcObject=new MediaStream([this.videoTrack]),this.videoElement.play()):(this.videoElement.pause(),this.videoElement.play()))}),Pe(this,"handleVideoEvents",s=>{switch(s.type){case"play":case"playing":this.startGetVideoDimensions(),this.videoElementStatus=to.PLAYING;break;case"loadeddata":if(this.videoState=Eh.VideoStateStarting,this.onFirstVideoFrameDecoded&&this.onFirstVideoFrameDecoded(),this.cacheVideoElement){try{this.cacheVideoElement.srcObject=null,this.cacheVideoElement.remove()}catch{}this.cacheVideoElement=void 0}break;case"canplay":this.videoElementStatus=to.CANPLAY;break;case"stalled":this.videoElementStatus=to.STALLED;break;case"suspend":this.videoElementStatus=to.SUSPEND;break;case"pause":this.videoElementStatus=to.PAUSED,vo()||lu()||Ss()&&this.autoplayFailed||!this.videoTrack||this.videoTrack.readyState!=="live"||(L.debug("[track-".concat(this.trackId,"] video element paused, auto resume")),this.videoElement.play());break;case"waiting":this.videoElementStatus=to.WAITING;break;case"abort":this.videoElementStatus=to.ABORT;break;case"ended":this.videoElementStatus=to.ENDED;break;case"emptied":this.videoElementStatus=to.EMPTIED;break;case"error":{const o=this.videoElement.error;o&&(this.videoElementStatus=to.ERROR,L.error("[".concat(this.trackId,"] media error: ").concat(o.message," (").concat(o.code,")")));break}case"timeupdate":{const o=performance.now();if(this.timeUpdatedCount+=1,this.timeUpdatedCount<10)return void(this.lastTimeUpdatedTime=o);const c=o-this.lastTimeUpdatedTime,u=this.lastTimeUpdatedTime;if(this.lastTimeUpdatedTime=o,Xf.lastVisibleTime<Xf.lastHiddenTime||u<Xf.lastHiddenTime||u<Xf.lastVisibleTime)return;for(c>re("VIDEO_FREEZE_DURATION")&&(this.freezeTime+=c),this.playbackTime+=c;this.playbackTime>=6e3;){this.playbackTime-=6e3;const h=Math.min(6e3,this.freezeTime);this.freezeTimeCounterList.push(h),this.freezeTime=Math.max(0,this.freezeTime-6e3)}break}}}),Pe(this,"autoResumeAfterInterruptionOnIOS15_16",()=>{this.videoTrack&&this.videoTrack.readyState==="live"&&(L.debug("[track-".concat(this.trackId,"] video element paused, auto resume for ").concat(UW())),GW()?(this.videoElement.srcObject=null,this.videoElement.srcObject=new MediaStream([this.videoTrack]),this.videoElement.play()):(this.videoElement.pause(),this.videoElement.play()))}),this.trackId=r.trackId,this.config=r,r.element instanceof HTMLVideoElement?this.videoElement=r.element:this.videoElement=document.createElement("video"),Jn.on(cs.IOS_INTERRUPTION_END,this.autoResumeAfterInterruption),Jn.on(cs.IOS_15_16_INTERRUPTION_END,this.autoResumeAfterInterruptionOnIOS15_16)}getVideoElement(){return this.videoElement}getContainerElement(){var r;return(r=this.videoElement.parentElement)!==null&&r!==void 0?r:void 0}updateConfig(r){this.config=r,this.trackId=r.trackId,r.element!==this.videoElement&&(this.destroy(),this.videoElement=r.element),this.videoTrack&&this.initVideoElement()}updateVideoTrack(r){this.videoTrack!==r&&(this.videoTrack=r,this.initVideoElement())}play(r){const s=this.videoElement.play();s&&s.catch&&s.catch(c=>{r&&z8(r,"video",c.message,this.trackId),c.name==="NotAllowedError"?(L.warning("detected video element autoplay failed",c),this.autoplayFailed=!0,this.handleAutoPlayFailed()):L.warning("[".concat(this.trackId,"] play warning: "),c)});const o=Rn();if((o.name==="Safari"&&Number(o.version)===15||Pv())&&s&&s.then){const c=()=>{this.config.mirror&&(this.videoElement.style.transform="rotateY(180deg)")};s.then(c).catch(c)}}getCurrentFrame(){const r=document.createElement("canvas");r.width=this.videoElement.videoWidth,r.height=this.videoElement.videoHeight;const s=r.getContext("2d");if(!s)return L.error("create canvas context failed!"),new ImageData(2,2);s.drawImage(this.videoElement,0,0,r.width,r.height);const o=s.getImageData(0,0,r.width,r.height);return r.remove(),o}async getCurrentFrameToUint8Array(r){let s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1;const o=document.createElement("canvas");o.width=this.videoElement.videoWidth,o.height=this.videoElement.videoHeight;const c=o.getContext("2d");return c?(c.drawImage(this.videoElement,0,0,o.width,o.height),new lt((u,h)=>{o.toBlob(async m=>{if(o.remove(),m){const _=await Q8(m);u({buffer:_,width:o.width,height:o.height})}else h(new Le(X.CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED))},r,s<0?.1:s>1?1:s)})):await vx(r)}destroy(){this.renderStats=void 0,Jn.off(cs.IOS_INTERRUPTION_END,this.autoResumeAfterInterruption),Jn.off(cs.IOS_15_16_INTERRUPTION_END,this.autoResumeAfterInterruptionOnIOS15_16),this.videoElement.srcObject=null,this.resetVideoElement(),this.freezeTimeCounterList=[],this.videoState=Eh.VideoStateStopped}initVideoElement(){if(this.videoElementStatus=to.INIT,!this.videoElementCheckInterval&&(Uz.forEach(u=>{this.videoElement.addEventListener(u,this.handleVideoEvents)}),this.videoElementCheckInterval=window.setInterval(()=>{(function(u){return u!==document.body&&document.body.contains(u)})(this.videoElement)||(this.videoElementStatus=to.DESTROYED)},1e3),re("ENABLE_VIDEO_FRAME_CALLBACK"))){var r,s;let u;const h=()=>{document.visibilityState==="visible"&&(document.removeEventListener("visibilitychange",h),this.videoElementFreezeTimeout=window.setTimeout(m,re("VIDEO_FREEZE_DURATION")))},m=()=>{this.videoElementFreezeTimeout=void 0,this.videoState===Eh.VideoStateDecoding&&(document.visibilityState==="visible"?this.videoState=Eh.VideoStateFrozen:document.addEventListener("visibilitychange",h))},_=(E,S)=>{if(this.videoElementStatus===to.PLAYING){if(this.renderStats?(this.renderStats.renderNum++,this.renderStats.curTs=S.mediaTime):this.renderStats={lastTs:S.mediaTime,curTs:S.mediaTime,lastRenderNum:0,renderNum:0},u){const k=S.presentationTime-u.presentationTime;this.videoState===Eh.VideoStateStarting&&(this.videoState=Eh.VideoStateDecoding),this.videoState===Eh.VideoStateDecoding&&this.onVideoStateChanged&&(this.videoElementFreezeTimeout&&window.clearTimeout(this.videoElementFreezeTimeout),this.videoElementFreezeTimeout=window.setTimeout(m,re("VIDEO_FREEZE_DURATION"))),k<re("VIDEO_FREEZE_DURATION")&&this.videoState===Eh.VideoStateFrozen&&(this.videoState=Eh.VideoStateDecoding),k>re("VIDEO_FREEZE_DURATION")&&Xf.lastVisibleTime>=Xf.lastHiddenTime&&u.timestamp>Xf.lastVisibleTime&&u.timestamp>Xf.lastHiddenTime&&(this.renderFreezeAccTime+=k)}u=Cr(Cr({},S),{},{timestamp:E})}var R,P;re("ENABLE_VIDEO_FRAME_CALLBACK")&&((R=(P=this.videoElement).requestVideoFrameCallback)===null||R===void 0||R.call(P,_))};(r=(s=this.videoElement).requestVideoFrameCallback)===null||r===void 0||r.call(s,_)}this.videoElement.controls=!1,this.videoElement.setAttribute("playsinline",""),FA()&&!re("HIDE_NO_POSTER")&&(this.videoElement.poster="noposter");const o=Rn();o.name==="Safari"&&Number(o.version)===15||Pv()||!this.config.mirror||(this.videoElement.style.transform="rotateY(180deg)"),this.config.fit?this.videoElement.style.objectFit=this.config.fit:this.videoElement.style.objectFit="cover",this.videoElement.setAttribute("muted",""),this.videoElement.muted=!0,this.videoElement.srcObject&&this.videoElement.srcObject instanceof MediaStream?this.videoElement.srcObject.getVideoTracks()[0]!==this.videoTrack&&(this.videoElement.srcObject=this.videoTrack?new MediaStream([this.videoTrack]):null,Dr()&&this.videoElement.load()):(this.videoElement.srcObject=this.videoTrack?new MediaStream([this.videoTrack]):null,Dr()&&this.videoElement.load());const c=this.videoElement.play();c!==void 0&&c.catch(u=>{L.debug("[".concat(this.trackId,"] playback interrupted"),u.toString())})}resetVideoElement(){Uz.forEach(r=>{this.videoElement&&this.videoElement.removeEventListener(r,this.handleVideoEvents)}),this.videoElementCheckInterval&&(window.clearInterval(this.videoElementCheckInterval),this.videoElementCheckInterval=void 0),this.videoElementStatus=to.NONE}handleAutoPlayFailed(){const r=s=>{s.preventDefault(),this.videoElement.play().then(()=>{L.debug("[".concat(this.trackId,"] Video element for trackId:").concat(this.trackId," autoplay resumed."))}).catch(o=>{L.error(o)}),this.autoplayFailed=!1,fT()?document.body.removeEventListener("click",r,!0):(document.body.removeEventListener("touchstart",r,!0),document.body.removeEventListener("mousedown",r,!0))};fT()?document.body.addEventListener("click",r,!0):(document.body.addEventListener("touchstart",r,!0),document.body.addEventListener("mousedown",r,!0)),W8()}}const Uz=["play","playing","loadeddata","canplay","pause","stalled","suspend","waiting","abort","emptied","ended","timeupdate","error"];class Vz extends Sx{constructor(r){super(r),Pe(this,"container",void 0),Pe(this,"slot",void 0),this.slot=r.element,this.updateConfig(r)}updateConfig(r){this.config=r,this.trackId=r.trackId;const s=r.element;s!==this.slot&&(this.destroy(),this.slot=s),this.createElements()}updateVideoTrack(r){this.videoTrack!==r&&(this.videoTrack=r,this.createElements())}play(r){var s;(s=this.container)!==null&&s!==void 0&&s.contains(this.videoElement)&&super.play(r)}getCurrentFrame(){var r;return(r=this.container)!==null&&r!==void 0&&r.contains(this.videoElement)?super.getCurrentFrame():new ImageData(2,2)}async getCurrentFrameToUint8Array(r){var s;let o=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1;return(s=this.container)!==null&&s!==void 0&&s.contains(this.videoElement)?await super.getCurrentFrameToUint8Array(r,o):await vx(r)}destroy(){if(super.destroy(),this.videoElement.remove(),this.videoElement=document.createElement("video"),this.container){try{this.container.remove(),this.slot.removeChild(this.container)}catch{}this.container=void 0}}createElements(){this.container||(this.container=document.createElement("div")),this.container.id="agora-video-player-".concat(this.trackId),this.container.style.width="100%",this.container.style.height="100%",this.container.style.position="relative",this.container.style.overflow="hidden",this.videoTrack?(this.container.style.backgroundColor="black",re("KEEP_LAST_FRAME")&&this.isKeepLastFrame&&this.videoElement.paused&&this.resetVideoElement(),this.mountedVideoElement()):this.unmountedVideoElement(),this.slot.appendChild(this.container)}mountedVideoElement(){var r;!this.container||(r=this.container)!==null&&r!==void 0&&r.contains(this.videoElement)||this.container.appendChild(this.videoElement),super.initVideoElement(),this.videoElement.id="video_".concat(this.trackId),this.videoElement.className="agora_video_player",this.videoElement.style.width="100%",this.videoElement.style.height="100%",this.videoElement.style.position="absolute",this.videoElement.style.left="0",this.videoElement.style.top="0"}unmountedVideoElement(){var r;if((r=this.container)!==null&&r!==void 0&&r.contains(this.videoElement)){super.resetVideoElement();try{this.container&&this.container.removeChild(this.videoElement)}catch{}this.videoElement=document.createElement("video")}}resetVideoElement(){var r;(r=this.container)!==null&&r!==void 0&&r.contains(this.videoElement)&&(super.resetVideoElement(),this.cacheVideoElement=this.videoElement,this.videoElement=document.createElement("video"))}getContainerElement(){return this.container}}var Fz,jz,Bz,Wz,zz,Gz,Hz,$z,Kz,qz,Yz,Xz,Jz,Qz,Zz,eG,tG,nG,rG,iG,sG,oG,aG,cG,bn,lG,uG,dG,hG,fG,pG,mG,gG,Bc;let _r=(Fz=Mt({argsMap:(t,r,s)=>[t.getTrackId(),typeof r=="string"?r:r instanceof HTMLVideoElement?"HTMLVideoElement":"HTMLElement",s]}),jz=Qr(),Bz=Mt({argsMap:t=>[t.getTrackId()]}),Wz=Nv("LocalVideoTrack","_enabledMutex"),zz=Mt({argsMap:(t,r)=>[t.getTrackId(),r]}),Gz=Qr(),Hz=Nv("LocalVideoTrack","_enabledMutex"),$z=Mt({argsMap:(t,r)=>[t.getTrackId(),r]}),Kz=Qr(),qz=Mt({argsMap:(t,r)=>[t.getTrackId(),r]}),Yz=Qr(),Xz=Qr(),Jz=Mt({argsMap:(t,r,s)=>[t.getTrackId(),r,s]}),Qz=Qr(),Zz=Qr(),eG=Qr(),tG=Qr(),nG=Qr(),rG=Qr(),iG=Qr(),sG=Mt({argsMap:(t,r)=>[t.getTrackId(),r.name]}),oG=Mt({argsMap:t=>[t.getTrackId()]}),aG=Mt({argsMap:t=>[t.getTrackId()]}),cG=Mt({argsMap:(t,r,s)=>[t.getTrackId(),r.label,s]}),bn=class coe extends Bv{get videoHeight(){if(Ss()){const{height:r}=this._mediaStreamTrack.getSettings();return this._videoHeight=r,this._videoHeight}return this._videoHeight}get videoWidth(){if(Ss()){const{width:r}=this._mediaStreamTrack.getSettings();return this._videoWidth=r,this._videoWidth}return this._videoWidth}get isPlaying(){return!(!this._player||this._player.videoElementStatus!==to.PLAYING)}get processorDestination(){return this._processorDestination}get processorContext(){return this._processorContext}set processorContext(r){this._processorContext=r}get __className__(){return"LocalVideoTrack"}constructor(r,s,o,c,u,h){if(super(r,u),Pe(this,"trackMediaType",jv.VIDEO),Pe(this,"_player",void 0),Pe(this,"isUseScaleResolutionDownBy",!1),Pe(this,"_videoVisibleTimer",null),Pe(this,"_previousVideoVisibleStatus",void 0),Pe(this,"_clearPreviousVideoVisibleStatus",()=>this._previousVideoVisibleStatus=void 0),Pe(this,"_encoderConfig",void 0),Pe(this,"_scalabilityMode",{numSpatialLayers:1,numTemporalLayers:1}),Pe(this,"_optimizationMode",void 0),Pe(this,"_videoHeight",void 0),Pe(this,"_videoWidth",void 0),Pe(this,"_forceBitrateLimit",void 0),Pe(this,"_enabled",!0),Pe(this,"_processorDestination",void 0),Pe(this,"_processorContext",void 0),Ss()){const{width:m,height:_}=r.getSettings();this._videoWidth=m,this._videoHeight=_}else this.updateMediaStreamTrackResolution();if(this._encoderConfig=s,this._scalabilityMode=o,this._optimizationMode=c,this._hints=h||[],this._hints.indexOf(ar.SCREEN_TRACK)===-1)this.updateBitrateFromProfile();else if(VL(Un.CHROME,115)&&UA().indexOf("Windows")!==-1){const m=function(_,E){if("VideoFrame"in window&&"TransformStream"in window&&kn().supportWebRTCInsertableStream){const S=new MediaStreamTrackProcessor(_),R=new MediaStreamTrackGenerator({kind:"video"});let P,k,z=Date.now();const U=()=>{F&&(clearInterval(F),F=void 0),P&&(P.close(),P=void 0),_.stop(),k=void 0,R.removeEventListener("ended",U)};let F=window.setInterval(()=>{if(k&&P&&Date.now()-z>1e3)try{R.readyState==="live"?k.enqueue(P.clone()):U()}catch{U()}},1e3);const q=new TransformStream({transform:(Y,le)=>{R.readyState==="live"?(k=le,z=Date.now(),P===void 0?(P=Y,le.enqueue(Y.clone())):(le.enqueue(P),P=Y)):Y.close()}});return R.addEventListener("ended",U),S.readable.pipeThrough(q).pipeTo(R.writable),R}}(r);m&&(L.info("local screen video track begin to inject frame"),this._mediaStreamTrack=m)}s&&this._hints.indexOf(ar.CUSTOM_TRACK)!==-1&&this.setEncoderConfiguration(s),this._processorContext=new H8(this.getTrackId(),"local"),this._processorDestination=new G8(this.processorContext),this.bindProcessorDestinationEvents()}play(r){let s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(typeof r=="string"){const c=document.getElementById(r);c?r=c:(L.warning("[".concat(this.getTrackId(),'] can not find "#').concat(r,'" element, use document.body')),r=document.body)}L.debug("[".concat(this.getTrackId(),"] start video playback in ").concat(r instanceof HTMLVideoElement?"HTMLVideoElement":"HTMLElement"),JSON.stringify(s));const o=Cr(Cr(Cr({},this._getDefaultPlayerConfig()),s),{},{trackId:this.getTrackId(),element:r});this._player?this._player.updateConfig(o):(r instanceof HTMLVideoElement?this._player=new Sx(o):this._player=new Vz(o),this._player.updateVideoTrack(this._mediaStreamTrack)),this._player.play(),this._videoVisibleTimer&&window.clearInterval(this._videoVisibleTimer),this._clearPreviousVideoVisibleStatus(),this._videoVisibleTimer=window.setInterval(()=>{try{const c=this.getVideoElementVisibleStatus();this.safeEmit(Vv.VIDEO_ELEMENT_VISIBLE_STATUS,c)}catch{}},re("CHECK_VIDEO_VISIBLE_INTERVAL"))}stop(){this._player&&(this._videoVisibleTimer&&(window.clearInterval(this._videoVisibleTimer),this._videoVisibleTimer=null),this._clearPreviousVideoVisibleStatus(),this._player.destroy(),this._player=void 0,L.debug("[".concat(this.getTrackId(),"] stop video playback")))}async setEnabled(r,s){if(!s){if(r===this._enabled)return;this.stateCheck("enabled",r)}if(L.info("[".concat(this.getTrackId(),"] start setEnabled"),r),!r){this._originMediaStreamTrack.enabled=!1;try{await sr(this,yt.NEED_DISABLE_TRACK,this)}catch(o){throw L.error("[".concat(this.getTrackId(),"] setEnabled to false error"),o.toString()),o}return s||(this._enabled=!1),void L.info("[".concat(this.getTrackId(),"] setEnabled to false success"))}this._originMediaStreamTrack.enabled=!0;try{await sr(this,yt.NEED_ENABLE_TRACK,this)}catch(o){throw L.error("[".concat(this.getTrackId(),"] setEnabled to true error"),o.toString()),o}L.info("[".concat(this.getTrackId(),"] setEnabled to true success")),s||(this._enabled=!0)}async setMuted(r){r!==this._muted&&(this.stateCheck("muted",r),this._muted=r,this._originMediaStreamTrack.enabled=!r,L.debug("[".concat(this.getTrackId(),"] start set muted: ").concat(r)),r?await sr(this,yt.NEED_MUTE_TRACK,this):await sr(this,yt.NEED_UNMUTE_TRACK,this))}async setEncoderConfiguration(r,s){if(!this._enabled)throw new Le(X.TRACK_IS_DISABLED,"can not set encoder configuration when track is disabled");if(r=yh(r),this._forceBitrateLimit&&(r.bitrateMax=this._forceBitrateLimit.max_bitrate?this._forceBitrateLimit.max_bitrate:r.bitrateMax,r.bitrateMin=this._forceBitrateLimit.min_bitrate?this._forceBitrateLimit.min_bitrate:r.bitrateMin),r.width||r.height||r.frameRate){const o=ZA({encoderConfig:r});(Ss()||vo()||lu())&&(o.deviceId=void 0),L.debug("[".concat(this.getTrackId(),"] setEncoderConfiguration applyConstraints"),JSON.stringify(r),JSON.stringify(o));try{await this._originMediaStreamTrack.applyConstraints(o),this.updateMediaStreamTrackResolution()}catch(c){const u=new Le(X.UNEXPECTED_ERROR,c.toString());throw L.error("[".concat(this.getTrackId(),"] applyConstraints error"),u.toString()),u}}this._encoderConfig=r,this._hints.indexOf(ar.SCREEN_TRACK)===-1&&this.updateBitrateFromProfile();try{await sr(this,yt.NEED_UPDATE_VIDEO_ENCODER,this)}catch(o){return o.throw(L)}}getStats(){return Im(()=>{L.warning("[deprecated] LocalVideoTrack.getStats will be removed in the future, use AgoraRTCClient.getLocalVideoStats instead")},"localVideoTrackGetStatsWarning"),Nc(this,yt.GET_STATS)||Cr({},fx)}async setBeautyEffect(r){L.error("LocalVideoTrack.setBeautyEffect was deprecated, please migrate to agora-extension-beauty-effect")}getCurrentFrameData(){return this._player?this._player.getCurrentFrame():new ImageData(2,2)}async getCurrentFrameImage(r){let s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1;return this._player?this._player.getCurrentFrameToUint8Array(r,s):await vx(r)}async setBitrateLimit(r){L.debug("[".concat(this.getTrackId(),"] set bitrate limit, ").concat(JSON.stringify(r))),r&&(this._forceBitrateLimit=r,this._encoderConfig&&(this._encoderConfig.bitrateMax?this._encoderConfig.bitrateMax=this._encoderConfig.bitrateMax<r.max_bitrate?this._encoderConfig.bitrateMax:r.max_bitrate:this._encoderConfig.bitrateMax=r.max_bitrate,this._encoderConfig.bitrateMin,this._encoderConfig.bitrateMin=r.min_bitrate))}async setOptimizationMode(r){if(r!=="motion"&&r!=="detail"&&r!=="balanced")return void L.error(X.INVALID_PARAMS,"optimization mode must be motion, detail or balanced");const s=this._optimizationMode;try{this._optimizationMode=r,await sr(this,yt.NEED_UPDATE_VIDEO_SEND_PARAMETERS,this)}catch(o){throw this._optimizationMode=s,L.error("[".concat(this.getTrackId(),"] set optimization mode failed"),o.toString()),o}L.info("[".concat(this.getTrackId(),"] set optimization mode success (").concat(r,")"))}setScalabiltyMode(r){if(r.numSpatialLayers===1&&r.numTemporalLayers!==1)return L.error(X.INVALID_PARAMS,"scalability mode currently not supported, no SVC."),void(this._scalabilityMode={numSpatialLayers:1,numTemporalLayers:1});this._scalabilityMode=r,L.info("[".concat(this.getTrackId(),"] set scalability mode success (").concat(r,")"))}updateMediaStreamTrackResolution(){q8(this._originMediaStreamTrack).then(r=>{let[s,o]=r;this._videoHeight=o,this._videoWidth=s}).catch(WA)}_updatePlayerSource(){this._player&&this._player.updateVideoTrack(this._mediaStreamTrack)}_getDefaultPlayerConfig(){return{fit:"contain"}}async setSenderConfiguration(r){if(!this._enabled)throw new Le(X.TRACK_IS_DISABLED,"can not set encoder configuration when track is disabled");L.debug("[".concat(this.getTrackId(),"] setSenderConfiguration applyConstraints"),JSON.stringify(r)),r=yh(r),this._forceBitrateLimit&&(r.bitrateMax=this._forceBitrateLimit.max_bitrate?this._forceBitrateLimit.max_bitrate:r.bitrateMax,r.bitrateMin=this._forceBitrateLimit.min_bitrate?this._forceBitrateLimit.min_bitrate:r.bitrateMin),this._encoderConfig=r,this._hints.indexOf(ar.SCREEN_TRACK)===-1&&this.updateBitrateFromProfile();try{await sr(this,yt.NEED_UPDATE_VIDEO_ENCODER,this)}catch(s){return s.throw(L)}}updateBitrateFromProfile(){if(!this._encoderConfig)return;const{width:r,height:s,frameRate:o}=this.getMediaStreamTrackSettings();if(!r||!s||!o)return;const{bitrateMax:c,bitrateMin:u}=this._encoderConfig;if(u==null||c==null){const{max:h,min:m}=function(_,E,S,R,P){const k=re("BITRATE_ADAPTER_TYPE");if(k==="DEFAULT_BITRATE")return{min:R,max:P};if(P===void 0){var z;const F=Math.floor(200*Math.pow(S/15,.6)*Math.pow(_*E/640/360,.75));P=k==="STANDARD_BITRATE"?4*F:2*F,R=(z=R)!==null&&z!==void 0?z:F}else{var U;R=(U=R)!==null&&U!==void 0?U:Math.floor(P/10)}return{min:R,max:P}}(r,s,o,u,c);this._encoderConfig.bitrateMin=m,this._encoderConfig.bitrateMax=h,L.debug("[".concat(this.getTrackId(),"] update bitrate from profile, [w: ").concat(r,", h: ").concat(s,", fps: ").concat(o,"] => [brMax: ").concat(h,", brMin: ").concat(m,"]"))}}getVideoElementVisibleStatus(){try{var r,s;const o=this==null||(r=this._player)===null||r===void 0?void 0:r.getContainerElement(),c={track:this,element:this==null||(s=this._player)===null||s===void 0?void 0:s.getVideoElement(),slot:o==null?void 0:o.parentElement},{element:u,slot:h}=c;if(this.isPlaying&&u instanceof HTMLVideoElement&&h instanceof HTMLElement){const m=YW.checkOneElementVisible(u),_=Object.assign({},m);if(_.visible!==this._previousVideoVisibleStatus){this._previousVideoVisibleStatus=_.visible;const E=Rt.reportApiInvoke(null,{tag:xr.TRACER,name:Si.LOCAL_VIDEO_TRACK_GET_VIDEO_VISIBLE,options:[this.getTrackId()]});_.visible?E.onSuccess("Video is visible"):E.onSuccess("Invisible because of ".concat(_.reason))}return _}return}catch(o){throw new Le(X.GET_VIDEO_ELEMENT_VISIBLE_ERROR,o.message)}}async renewMediaStreamTrack(r){}pipe(r){if(this.processor===r)return r;if(r._source)throw new Le(X.INVALID_OPERATION,"Processor ".concat(r.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=r,this.processor._source=this,r.updateInput({track:this._originMediaStreamTrack,context:this.processorContext}),r}unpipe(){if(!this.processor)return;const r=this.processor;this.processor._source=void 0,this.processor=void 0,r.reset()}close(){super.close(),this.unbindProcessorDestinationEvents(),this.unbindProcessorContextEvents(),this.unpipe(),this.processorDestination._source&&this.processorDestination._source.unpipe()}clone(r){let s=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1],o=this._encoderConfig;r&&(o=Cr(Cr({},o),yh(r))),o=N_(o);const c=or(8,"track-video-cloned-"),u=new coe(s?this._mediaStreamTrack.clone():this._mediaStreamTrack,o,N_(this._scalabilityMode),this._optimizationMode,c,N_(this._hints));return r&&o&&u.setEncoderConfiguration(o),L.debug("clone video track from ".concat(this.getTrackId()," to ").concat(c,", clone ").concat(s)),u}async replaceTrack(r,s){if(!(r instanceof MediaStreamTrack))throw new Le(X.INVALID_PARAMS,"track should be an instance of MediaStreamTrack");if(r.kind!=="video")throw new Le(X.INVALID_PARAMS,"track should be a video MediaStreamTrack");await this._updateOriginMediaStreamTrack(r,s,!0),this.updateMediaStreamTrackResolution()}sendSeiData(r){if(Im(()=>{Rt.reportApiInvoke(null,{name:Si.LOCAL_VIDEO_SEND_SEI_DATA,options:[],tag:xr.TRACER}).onSuccess("")},this._mediaStreamTrack.id||this.getTrackId()),!re("ENABLE_VIDEO_SEI")||!re("ENABLE_ENCODED_TRANSFORM"))return void L.warning('To send/receive SEI, please call AgoraRTC.setParameter("ENABLE_VIDEO_SEI", true) before instantiate IAgoraRtcClient');if(r instanceof Uint8Array==0)return new Le(X.INVALID_PARAMS,"Invalid argument type, ILocalVideoTrack.sendSeiData() only accept Uint8Array argument.").throw();const s=this.getRTCRtpTransceiver();if(!s)return void L.warning("Video track is not published, SEI can not be send");const o=s.sender.getParameters();if(o.codecs.length===0)return;const c=o.codecs[0].mimeType.toLocaleLowerCase();c==="video/h264"?this.safeEmit("sei-to-send",r):L.warning("SEI is not supported by ".concat(c))}bindProcessorDestinationEvents(){this.processorDestination.on(So.ON_TRACK,async r=>{r?r!==this._mediaStreamTrack&&(this._mediaStreamTrack=r,this._updatePlayerSource(),await sr(this,yt.NEED_REPLACE_TRACK,this)):this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource(),await sr(this,yt.NEED_REPLACE_TRACK,this))})}unbindProcessorDestinationEvents(){this.processorDestination.removeAllListeners(So.ON_TRACK)}unbindProcessorContextEvents(){this.processorContext.removeAllListeners(Mc.REQUEST_UPDATE_CONSTRAINTS),this.processorContext.removeAllListeners(Mc.REQUEST_CONSTRAINTS)}},In(bn.prototype,"play",[Fz,jz],Object.getOwnPropertyDescriptor(bn.prototype,"play"),bn.prototype),In(bn.prototype,"stop",[Bz],Object.getOwnPropertyDescriptor(bn.prototype,"stop"),bn.prototype),In(bn.prototype,"setEnabled",[Wz,zz,Gz],Object.getOwnPropertyDescriptor(bn.prototype,"setEnabled"),bn.prototype),In(bn.prototype,"setMuted",[Hz,$z,Kz],Object.getOwnPropertyDescriptor(bn.prototype,"setMuted"),bn.prototype),In(bn.prototype,"setEncoderConfiguration",[qz,Yz],Object.getOwnPropertyDescriptor(bn.prototype,"setEncoderConfiguration"),bn.prototype),In(bn.prototype,"getStats",[Xz],Object.getOwnPropertyDescriptor(bn.prototype,"getStats"),bn.prototype),In(bn.prototype,"setBeautyEffect",[Jz,Qz],Object.getOwnPropertyDescriptor(bn.prototype,"setBeautyEffect"),bn.prototype),In(bn.prototype,"getCurrentFrameData",[Zz],Object.getOwnPropertyDescriptor(bn.prototype,"getCurrentFrameData"),bn.prototype),In(bn.prototype,"getCurrentFrameImage",[eG],Object.getOwnPropertyDescriptor(bn.prototype,"getCurrentFrameImage"),bn.prototype),In(bn.prototype,"setBitrateLimit",[tG],Object.getOwnPropertyDescriptor(bn.prototype,"setBitrateLimit"),bn.prototype),In(bn.prototype,"setOptimizationMode",[nG],Object.getOwnPropertyDescriptor(bn.prototype,"setOptimizationMode"),bn.prototype),In(bn.prototype,"setScalabiltyMode",[rG],Object.getOwnPropertyDescriptor(bn.prototype,"setScalabiltyMode"),bn.prototype),In(bn.prototype,"updateMediaStreamTrackResolution",[iG],Object.getOwnPropertyDescriptor(bn.prototype,"updateMediaStreamTrackResolution"),bn.prototype),In(bn.prototype,"pipe",[sG],Object.getOwnPropertyDescriptor(bn.prototype,"pipe"),bn.prototype),In(bn.prototype,"unpipe",[oG],Object.getOwnPropertyDescriptor(bn.prototype,"unpipe"),bn.prototype),In(bn.prototype,"close",[aG],Object.getOwnPropertyDescriptor(bn.prototype,"close"),bn.prototype),In(bn.prototype,"replaceTrack",[cG],Object.getOwnPropertyDescriptor(bn.prototype,"replaceTrack"),bn.prototype),bn),bx=(lG=Mt({argsMap:(t,r)=>[t.getTrackId(),r]}),uG=Qr(),dG=Nv("CameraVideoTrack","_enabledMutex"),hG=Mt({argsMap:(t,r)=>[t.getTrackId(),r]}),fG=Qr(),pG=Mt({argsMap:(t,r)=>[t.getTrackId(),r]}),mG=Qr(),gG=Mt({argsMap:t=>[t.getTrackId()]}),Bc=class loe extends _r{get __className__(){return"CameraVideoTrack"}constructor(r,s,o,c,u,h){super(r,yh(s.encoderConfig),c,u,h),Pe(this,"_config",void 0),Pe(this,"_originalConstraints",void 0),Pe(this,"_constraints",void 0),Pe(this,"_enabled",!0),Pe(this,"_deviceName","default"),Pe(this,"tryResumeVideoForIOS15_16WeChat",async()=>{(Pv()||BL())&&!function(){const m=Rn();if(m.os!==zi.IOS||!m.osVersion)return!1;const _=m.osVersion.split(".");return Number(_[0])===15&&Number(_[1])>=2}()&&HW()&&this._enabled&&!this._isClosed&&(L.debug("[".concat(this.getTrackId(),"] try capture camera media device for interrupted iOS 15 device on WeChat.")),await this.renewMediaStreamTrack())}),this._config=s,this._originalConstraints=o,this._constraints=o,this._deviceName=r.label,this._encoderConfig=yh(this._config.encoderConfig),Jn.on(cs.IOS_15_16_INTERRUPTION_END,this.tryResumeVideoForIOS15_16WeChat),Jn.on(cs.IOS_INTERRUPTION_END,this.tryResumeVideoForIOS15_16WeChat),this.bindProcessorContextEvents()}async setDevice(r){return typeof r=="string"?this._setDeviceById(r):r.deviceId?this._setDeviceById(r.deviceId):r.facingMode?this._setDeviceByFacingModel(r.facingMode):void 0}async _setDeviceById(r){if(L.info("[".concat(this.getTrackId(),"] set device to ").concat(r)),this._enabled)try{const s=await Fc.getDeviceById(r),o={};o.video=Cr({},this._constraints),o.video.deviceId={exact:r},o.video.facingMode=void 0,this._originMediaStreamTrack.stop();let c=null;try{c=await Vc(o,this.getTrackId())}catch(u){throw L.error("[".concat(this.getTrackId(),"] setDevice failed"),u.toString()),c=await Vc({video:this._constraints},this.getTrackId()),await this._updateOriginMediaStreamTrack(c.getVideoTracks()[0],!1),u}await this._updateOriginMediaStreamTrack(c.getVideoTracks()[0],!1),this.updateMediaStreamTrackResolution(),this._deviceName=s.label,this._config.cameraId=r,this._constraints.deviceId={exact:r}}catch(s){throw L.error("[".concat(this.getTrackId(),"] setDevice error"),s.toString()),s}else try{const s=await Fc.getDeviceById(r);this._deviceName=s.label,this._config.cameraId=r,this._constraints.deviceId={exact:r}}catch(s){throw L.error("[".concat(this.getTrackId(),"] setDevice error"),s.toString()),s}L.info("[".concat(this.getTrackId(),"] setDevice success"))}async _setDeviceByFacingModel(r){L.info("[".concat(this.getTrackId(),"] set facingMode ").concat(r));const s={video:Cr(Cr({},this._constraints),{},{deviceId:void 0,facingMode:{exact:r}})};if(this._enabled){this._originMediaStreamTrack.stop();let o=null;try{o=await Vc(s,this.getTrackId())}catch(c){throw L.error("[".concat(this.getTrackId(),"] setDeviceByFacingModel failed"),c.toString()),o=await Vc({video:this._constraints},this.getTrackId()),await this._updateOriginMediaStreamTrack(o.getVideoTracks()[0],!1),c}await this._updateOriginMediaStreamTrack(o.getVideoTracks()[0],!1),this.updateMediaStreamTrackResolution()}this._deviceName="",this._config.facingMode=r,this._config.cameraId=void 0,this._constraints=Cr({},s.video),L.info("[".concat(this.getTrackId(),"] setDeviceByFacingModel success"))}async setEnabled(r,s){if(!s){if(r===this._enabled)return;this.stateCheck("enabled",r)}if(L.info("[".concat(this.getTrackId(),"] start setEnabled"),r),r){try{if(this.isExternalTrack)this._originMediaStreamTrack.enabled=!0;else{const o=await Vc({video:this._constraints},this.getTrackId());await this._updateOriginMediaStreamTrack(o.getVideoTracks()[0],!1)}await sr(this,yt.NEED_ENABLE_TRACK,this)}catch(o){throw L.error("[".concat(this.getTrackId(),"] setEnabled true error"),o.toString()),o}this.updateMediaStreamTrackResolution(),L.info("[".concat(this.getTrackId(),"] setEnabled to true success")),s||(this._enabled=!0)}else{this.isExternalTrack?this._originMediaStreamTrack.enabled=!1:(this._originMediaStreamTrack.onended=null,this._originMediaStreamTrack.stop()),s||(this._enabled=!1);try{await sr(this,yt.NEED_DISABLE_TRACK,this)}catch(o){throw L.error("[".concat(this.getTrackId(),"] setEnabled to false error"),o.toString()),o}L.info("[".concat(this.getTrackId(),"] setEnabled to false success"))}}async setEncoderConfiguration(r,s){if(!this._enabled)throw new Le(X.TRACK_IS_DISABLED,"can not set encoder configuration when track is disabled");r=yh(r),this._forceBitrateLimit&&(r.bitrateMax=this._forceBitrateLimit.max_bitrate||r.bitrateMax,r.bitrateMin=this._forceBitrateLimit.min_bitrate||r.bitrateMin);const o=Mr(this._config);o.encoderConfig=r;const c=ZA(o);(Ss()||vo()||lu())&&(c.deviceId=void 0),L.debug("[".concat(this.getTrackId(),"] setEncoderConfiguration applyConstraints"),JSON.stringify(r),JSON.stringify(c));try{await this._originMediaStreamTrack.applyConstraints(c),this.updateMediaStreamTrackResolution()}catch(u){const h=new Le(X.UNEXPECTED_ERROR,u.toString());throw L.error("[".concat(this.getTrackId(),"] applyConstraints error"),h.toString()),h}this._config=o,this._constraints=c,this._originalConstraints=c,this._encoderConfig=r,this._hints.indexOf(ar.SCREEN_TRACK)===-1&&this.updateBitrateFromProfile();try{await sr(this,yt.NEED_UPDATE_VIDEO_ENCODER,this)}catch(u){return u.throw(L)}}_getDefaultPlayerConfig(){return{mirror:!0,fit:"cover"}}onTrackEnded(){if((vo()||lu())&&this._enabled&&!this._isClosed&&Jn.duringInterruption){const r=async()=>{Jn.off(cs.IOS_INTERRUPTION_END,r),this._enabled&&!this._isClosed&&(L.debug("[".concat(this.getTrackId(),"] try capture camera media device for interrupted iOS device.")),await this.setEnabled(!1),await this.setEnabled(!0))};Jn.on(cs.IOS_INTERRUPTION_END,r)}else L.debug("[".concat(this.getTrackId(),"] track ended")),this.safeEmit(Vv.TRACK_ENDED)}async renewMediaStreamTrack(r){const s=r||this._constraints,o=Fc.searchDeviceIdByName(this._deviceName);if(o&&!s.deviceId&&(s.deviceId={exact:o}),this._enabled){const c=await Vc({video:s},this.getTrackId());this._constraints=s,await this._updateOriginMediaStreamTrack(c.getVideoTracks()[0],!0),this.updateMediaStreamTrackResolution()}}close(){super.close(),Jn.off(cs.IOS_15_16_INTERRUPTION_END,this.tryResumeVideoForIOS15_16WeChat),Jn.off(cs.IOS_INTERRUPTION_END,this.tryResumeVideoForIOS15_16WeChat)}clone(r){let s=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1],o=this._encoderConfig;r&&(o=Cr(Cr({},o),yh(r))),o=N_(o);const c=or(8,"track-cam-cloned-"),u=new loe(s?this._mediaStreamTrack.clone():this._mediaStreamTrack,N_(Cr(Cr({},this._config),{},{encoderConfig:o})),N_(this._constraints),N_(this._scalabilityMode),this._optimizationMode,c);return r&&o&&u.setEncoderConfiguration(o),L.debug("clone track from ".concat(this.getTrackId()," to ").concat(c,", clone ").concat(s)),u}bindProcessorContextEvents(){this.processorContext.on(Mc.REQUEST_UPDATE_CONSTRAINTS,async(r,s,o)=>{try{const c=Object.assign({},this._originalConstraints,...r);await this.renewMediaStreamTrack(c),s()}catch(c){o(c)}}),this.processorContext.on(Mc.REQUEST_CONSTRAINTS,async r=>{r(this._originMediaStreamTrack.getSettings())})}},In(Bc.prototype,"setDevice",[lG,uG],Object.getOwnPropertyDescriptor(Bc.prototype,"setDevice"),Bc.prototype),In(Bc.prototype,"setEnabled",[dG,hG,fG],Object.getOwnPropertyDescriptor(Bc.prototype,"setEnabled"),Bc.prototype),In(Bc.prototype,"setEncoderConfiguration",[pG,mG],Object.getOwnPropertyDescriptor(Bc.prototype,"setEncoderConfiguration"),Bc.prototype),In(Bc.prototype,"close",[gG],Object.getOwnPropertyDescriptor(Bc.prototype,"close"),Bc.prototype),Bc);function Tx(t,r,s,o){s.optimizationMode&&(o&&o.width&&o.height?(s.encoderConfig=Cr(Cr({},o),{},{bitrateMin:o.bitrateMin,bitrateMax:o.bitrateMax}),s.optimizationMode!=="motion"&&s.optimizationMode!=="detail"||(r.contentHint=s.optimizationMode,r.contentHint===s.optimizationMode?L.debug("[".concat(t,"] set content hint to"),s.optimizationMode):L.debug("[".concat(t,"] set content hint failed")))):L.warning("[".concat(t,"] can not apply optimization mode bitrate config, no encoderConfig")))}var _G,yG,EG,vG,vl,SG,bG,TG,wG,RG,CG,no;class IG extends D8{getUserId(){return this._userId}constructor(r,s,o,c){super(r,"track-".concat(r.kind,"-").concat(s,"-").concat(c.clientId,"_").concat(or(5,""))),Pe(this,"_userId",void 0),Pe(this,"_uintId",void 0),Pe(this,"_isDestroyed",!1),Pe(this,"store",void 0),Pe(this,"processor",void 0),Pe(this,"processorContext",void 0),this._userId=s,this._uintId=o,this.store=c}_updateOriginMediaStreamTrack(r){this._originMediaStreamTrack=r,this._mediaStreamTrack=r,this._updatePlayerSource(),this.processor&&this.processor.updateInput({track:this._originMediaStreamTrack,context:this.processorContext})}_destroy(){this._isDestroyed=!0,L.info("[".concat(this.getTrackId(),"] is destroyed")),this.stop(),super.close()}getProcessorStats(){return this.processorContext.gatherStats()}getProcessorUsage(){return this.processorContext.gatherUsage()}}let Gv=(_G=Mt({argsMap:(t,r,s)=>[t.getTrackId(),typeof r=="string"?r:r instanceof HTMLVideoElement?"HTMLVideoElement":"HTMLElement",s]}),yG=Mt({argsMap:t=>[t.getTrackId()]}),EG=Mt({argsMap:(t,r)=>[t.getTrackId(),r.name]}),vG=Mt({argsMap:t=>[t.getTrackId()]}),In((vl=class extends IG{get isPlaying(){return!(!this._player||this._player.videoElementStatus!==to.PLAYING)}get __className__(){return"RemoteVideoTrack"}constructor(t,r,s,o){super(t,r,s,o),Pe(this,"_videoVisibleTimer",null),Pe(this,"_previousVideoVisibleStatus",void 0),Pe(this,"_clearPreviousVideoVisibleStatus",()=>this._previousVideoVisibleStatus=void 0),Pe(this,"trackMediaType",jv.VIDEO),Pe(this,"_videoWidth",void 0),Pe(this,"_videoHeight",void 0),Pe(this,"_player",void 0),Pe(this,"processorDestination",void 0),Pe(this,"processorContext",void 0),this.updateMediaStreamTrackResolution(),this.processorContext=new H8(this.getTrackId(),"remote"),this.processorDestination=new G8(this.processorContext),this.bindProcessorDestinationEvents()}getStats(){return Im(()=>{L.warning("[deprecated] RemoteVideoTrack.getStats will be removed in the future, use AgoraRTCClient.getRemoteVideoStats instead")},"remoteVideoTrackGetStatsWarning"),Nc(this,yt.GET_STATS)||Cr({},k8)}play(t){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(typeof t=="string"){const o=document.getElementById(t);o?t=o:(L.warning("[".concat(this.getTrackId(),'] can not find "#').concat(t,'" element, use document.body')),t=document.body)}L.debug("[".concat(this.getTrackId(),"] start video playback in ").concat(t instanceof HTMLVideoElement?"HTMLVideoElement":"HTMLElement"),JSON.stringify(r));const s=Cr(Cr({fit:"cover"},r),{},{trackId:this.getTrackId(),element:t});this._player?this._player.updateConfig(s):(t instanceof HTMLVideoElement?this._player=new Sx(s):this._player=new Vz(s),this._player.updateVideoTrack(this._mediaStreamTrack),this._player.onFirstVideoFrameDecoded=()=>{this.store.subscribe(this.getUserId(),"video",void 0,void 0,Date.now()),this.safeEmit(Fv.FIRST_FRAME_DECODED)},this._player.onVideoStateChanged=o=>{this.safeEmit(Fv.VIDEO_STATE_CHANGED,o)}),this._player.play(this.store.sessionId||void 0),this._videoVisibleTimer&&window.clearInterval(this._videoVisibleTimer),this._clearPreviousVideoVisibleStatus(),this._videoVisibleTimer=window.setInterval(()=>{try{const o=this.getVideoElementVisibleStatus();this.safeEmit(Fv.VIDEO_ELEMENT_VISIBLE_STATUS,o)}catch{}},re("CHECK_VIDEO_VISIBLE_INTERVAL"))}stop(){this._player&&(this._videoVisibleTimer&&(window.clearInterval(this._videoVisibleTimer),this._videoVisibleTimer=null),this._clearPreviousVideoVisibleStatus(),this._player.destroy(),this._player=void 0,L.debug("[".concat(this.getTrackId(),"] stop video playback")))}getCurrentFrameData(){return this._player?this._player.getCurrentFrame():new ImageData(2,2)}updateMediaStreamTrackResolution(){q8(this._originMediaStreamTrack).then(t=>{let[r,s]=t;this._videoHeight=s,this._videoWidth=r}).catch(WA)}_updatePlayerSource(){L.debug("[".concat(this.getTrackId(),"] update player source track")),this._player&&this._player.updateVideoTrack(this._mediaStreamTrack)}getVideoElementVisibleStatus(){try{var t,r;const s=this==null||(t=this._player)===null||t===void 0?void 0:t.getContainerElement(),o={track:this,element:this==null||(r=this._player)===null||r===void 0?void 0:r.getVideoElement(),slot:s==null?void 0:s.parentElement},{element:c,slot:u}=o;if(this.isPlaying&&c instanceof HTMLVideoElement&&u instanceof HTMLElement){const h=YW.checkOneElementVisible(c),m=Object.assign({},h);if(m.visible!==this._previousVideoVisibleStatus){this._previousVideoVisibleStatus=m.visible;const _=Rt.reportApiInvoke(null,{tag:xr.TRACER,name:Si.REMOTE_VIDEO_TRACK_GET_VIDEO_VISIBLE,options:[this.getTrackId()]});m.visible?_.onSuccess("Video is visible"):_.onSuccess("Invisible because of ".concat(m.reason))}return m}return}catch(s){throw new Le(X.GET_VIDEO_ELEMENT_VISIBLE_ERROR,s.message)}}pipe(t){if(this.processor===t)return t;if(t._source)throw new Le(X.INVALID_OPERATION,"Processor ".concat(t.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=t,this.processor._source=this,t.updateInput({track:this._originMediaStreamTrack,context:this.processorContext}),t}unpipe(){if(!this.processor)return;const t=this.processor;this.processor._source=void 0,this.processor=void 0,t.reset()}bindProcessorDestinationEvents(){this.processorDestination.on(So.ON_TRACK,async t=>{t?t!==this._mediaStreamTrack&&(this._mediaStreamTrack=t,this._updatePlayerSource()):this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource())})}unbindProcessorDestinationEvents(){this.processorDestination.removeAllListeners(So.ON_TRACK)}_destroy(){super._destroy(),this.unbindProcessorDestinationEvents()}_onSei(t){this.emit(M_.SEI_RECEIVED,t)}}).prototype,"play",[_G],Object.getOwnPropertyDescriptor(vl.prototype,"play"),vl.prototype),In(vl.prototype,"stop",[yG],Object.getOwnPropertyDescriptor(vl.prototype,"stop"),vl.prototype),In(vl.prototype,"pipe",[EG],Object.getOwnPropertyDescriptor(vl.prototype,"pipe"),vl.prototype),In(vl.prototype,"unpipe",[vG],Object.getOwnPropertyDescriptor(vl.prototype,"unpipe"),vl.prototype),vl),Hv=(SG=Mt({argsMap:(t,r)=>[t.getTrackId(),r],throttleTime:300}),bG=Mt({argsMap:(t,r)=>[t.getTrackId(),r]}),TG=Mt({argsMap:t=>[t.getTrackId()]}),wG=Mt({argsMap:t=>[t.getTrackId()]}),RG=Mt({argsMap:(t,r)=>[t.getTrackId(),r.name]}),CG=Mt({argsMap:t=>[t.getTrackId()]}),In((no=class extends IG{get isPlaying(){return this._useAudioElement?Ko.isPlaying(this.getTrackId()):this._source.isPlayed}get __className__(){return"RemoteAudioTrack"}constructor(t,r,s,o){super(t,r,s,o),Pe(this,"trackMediaType",jv.AUDIO),Pe(this,"_source",void 0),Pe(this,"_useAudioElement",!0),Pe(this,"_volume",100),Pe(this,"processorContext",void 0),Pe(this,"processorDestination",void 0),Pe(this,"_played",!1),Pe(this,"_bypassWebAudio",!1),re("DISABLE_WEBAUDIO")?(this._source=new Ex,this._bypassWebAudio=!0,this._useAudioElement=!0):(this._source=new U8(t,!0),re("REMOTE_AUDIO_TRACK_USES_WEB_AUDIO")&&(this._useAudioElement=!1)),this._source.once(xc.RECEIVE_TRACK_BUFFER,()=>{this.safeEmit(Fv.FIRST_FRAME_DECODED)}),this.processorContext=new K8(this._source.context,this.getTrackId(),"remote"),this.processorDestination=new $8(this.processorContext),this.bindProcessorDestinationEvents(),this._source.on(xc.UPDATE_SOURCE,()=>{this.processor&&this.processor.updateInput({node:this._source.processSourceNode,context:this.processorContext})})}setAudioFrameCallback(t){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:4096;if(!t)return this._source.removeAllListeners(xc.ON_AUDIO_BUFFER),void this._source.stopGetAudioBuffer();this._source.startGetAudioBuffer(r),this._source.removeAllListeners(xc.ON_AUDIO_BUFFER),this._source.on(xc.ON_AUDIO_BUFFER,s=>t(s))}setVolume(t){this._volume=t,this._useAudioElement?Ko.setVolume(this.getTrackId(),t):this._source.setVolume(t/100)}async setPlaybackDevice(t){if(!this._useAudioElement||!I8())throw new Le(X.NOT_SUPPORTED,"your browser does not support setting the audio output device");await Ko.setSinkID(this.getTrackId(),t)}getVolumeLevel(){return this._source.getAccurateVolumeLevel()}getStats(){return Im(()=>{L.warning("[deprecated] RemoteAudioTrack.getStats will be removed in the future, use AgoraRTCClient.getRemoteAudioStats instead")},"remoteAudioTrackGetStatsWarning"),Nc(this,yt.GET_STATS)||Cr({},O8)}play(){L.debug("[".concat(this.getTrackId(),"] start audio playback")),this._played=!0,this._useAudioElement?(L.debug("[".concat(this.getTrackId(),"] use audio element to play")),Ko.play(this._mediaStreamTrack,this.getTrackId(),this._volume,this.store.sessionId||void 0)):this._source.play()}stop(){L.debug("[".concat(this.getTrackId(),"] stop audio playback")),this._played=!1,this._useAudioElement?Ko.stop(this.getTrackId()):this._source.stop()}_destroy(){super._destroy(),this._played=!1,this.unbindProcessorDestinationEvents(),this._source.destroy()}_isFreeze(){return this._source.isFreeze}_updatePlayerSource(){let t=!(arguments.length>0&&arguments[0]!==void 0)||arguments[0];L.debug("[".concat(this.getTrackId(),"] update player source track")),t&&this._source.updateTrack(this._mediaStreamTrack),this._useAudioElement&&Ko.updateTrack(this.getTrackId(),this._mediaStreamTrack)}pipe(t){if(this._bypassWebAudio)throw new Le(X.NOT_SUPPORTED,"can not pipe extension when WebAudio disabled");if(this.processor===t)return t;if(t._source)throw new Le(X.INVALID_OPERATION,"Processor ".concat(t.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=t,this.processor._source=this,t.updateInput({track:this._originMediaStreamTrack,node:this._source.processSourceNode,context:this.processorContext}),t}unpipe(){var t;if(this._bypassWebAudio)throw new Le(X.NOT_SUPPORTED,"can not unpipe extension when WebAudio disabled");if(!this.processor)return;const r=this.processor;(t=this._source.processSourceNode)===null||t===void 0||t.disconnect(),this.processor._source=!1,this.processor=void 0,r.reset()}bindProcessorDestinationEvents(){this.processorDestination.on(So.ON_TRACK,async t=>{t?t!==this._mediaStreamTrack&&(this._mediaStreamTrack=t,this._updatePlayerSource(!1),this._source.processedNode=this._source.createMediaStreamSourceNode(t)):this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource())}),this.processorDestination.on(So.ON_NODE,t=>{this._source.processedNode=t;const r=!t;this._useAudioElement!==r&&(this._played?(this.stop(),this._useAudioElement=r,this.play()):this._useAudioElement=r)})}unbindProcessorDestinationEvents(){this.processorDestination.removeAllListeners(So.ON_TRACK),this.processorDestination.removeAllListeners(So.ON_NODE)}}).prototype,"setVolume",[SG],Object.getOwnPropertyDescriptor(no.prototype,"setVolume"),no.prototype),In(no.prototype,"setPlaybackDevice",[bG],Object.getOwnPropertyDescriptor(no.prototype,"setPlaybackDevice"),no.prototype),In(no.prototype,"play",[TG],Object.getOwnPropertyDescriptor(no.prototype,"play"),no.prototype),In(no.prototype,"stop",[wG],Object.getOwnPropertyDescriptor(no.prototype,"stop"),no.prototype),In(no.prototype,"pipe",[RG],Object.getOwnPropertyDescriptor(no.prototype,"pipe"),no.prototype),In(no.prototype,"unpipe",[CG],Object.getOwnPropertyDescriptor(no.prototype,"unpipe"),no.prototype),no);const Xf=new class extends Pr{get visibility(){return document.visibilityState}get lastHiddenTime(){return this._lastHiddenTime}get lastVisibleTime(){return this._lastVisibleTime}constructor(){super(),Pe(this,"_lastHiddenTime",0),Pe(this,"_lastVisibleTime",0),document.addEventListener("visibilitychange",()=>{document.visibilityState==="hidden"?this._lastHiddenTime=performance.now():this._lastVisibleTime=performance.now(),L.debug("current web page is ".concat(document.visibilityState)),this.emit("VISIBILITY_CHANGE",document.visibilityState)})}};class AG extends Pr{constructor(r,s){super(),Pe(this,"trackMediaType",jv.DATA),Pe(this,"_version",1),Pe(this,"_type",3),Pe(this,"_config",void 0),Pe(this,"_originDataChannel",void 0),Pe(this,"_dataStreamPacketHeader",new ArrayBuffer(4)),Pe(this,"_dataStreamPacketHandler",{serialize:o=>o,deserialize:o=>o}),Pe(this,"_datachannelEventMap",new Map),this._config=r,s&&(this._originDataChannel=s,this._bandDataChannelEvents(s)),this._initPacketHeader()}useDataStream(r){this._dataStreamPacketHandler=r}get id(){return this._config.id}get ordered(){return this._config.ordered}get maxRetransmits(){return re("DATASTREAM_MAX_RETRANSMITS")}get metadata(){return this._config.metadata}get readyState(){var r,s;return(r=(s=this._originDataChannel)===null||s===void 0?void 0:s.readyState)!==null&&r!==void 0?r:"connecting"}get _originDataChannelId(){var r,s;return(r=(s=this._originDataChannel)===null||s===void 0?void 0:s.id)!==null&&r!==void 0?r:null}getChannelId(){return this.id}getConfig(){return this._config}_close(){this._originDataChannel&&(this._unbindDataChannelEvents(this._originDataChannel),this._originDataChannel=void 0)}async _waitTillOpen(){return new lt((r,s)=>{if(this._originDataChannel){this._originDataChannel.readyState==="open"&&r();const o=setTimeout(()=>{var c;s(new Le(X.DATACHANNEL_CONNECTION_TIMEOUT,"Cannot create datachannel, id: ".concat((c=this._originDataChannel)===null||c===void 0?void 0:c.id)))},1e4);this._originDataChannel.onopen=()=>{clearTimeout(o),this._originDataChannel&&this._bandDataChannelEvents(this._originDataChannel),r()},this._originDataChannel.onerror=()=>{throw clearTimeout(o),new Le(X.DATACHANNEL_CONNECTION_TIMEOUT)}}else s(new Le(X.DATACHANNEL_CONNECTION_TIMEOUT,"cannot find dataChannel"))})}_updateOriginDataChannel(r){this._originDataChannel=r,this._bandDataChannelEvents(r)}_initPacketHeader(){const r=new DataView(this._dataStreamPacketHeader);r.setUint16(0,this._version),r.setUint8(2,this._type),r.setUint8(3,this._config.id)}_bandDataChannelEvents(r){this._unbindDataChannelEvents(r),[JA.OPEN,JA.CLOSE,JA.ERROR].forEach(s=>{const o=()=>{this.emit(s)};this._datachannelEventMap.set(s,o),r.addEventListener(s,o)})}_unbindDataChannelEvents(r){Array.from(this._datachannelEventMap.entries()).forEach(s=>{let[o,c]=s;r.removeEventListener(o,c)}),this._datachannelEventMap.clear()}}class Ape extends AG{constructor(r){super(r),Pe(this,"_messageListener",void 0),this._messageListener=s=>{if(s.data.byteLength<this._dataStreamPacketHeader.byteLength)throw Error("invalid byteLength: the byte length must exceed "+this._dataStreamPacketHeader.byteLength);const o=s.data.slice(0,this._dataStreamPacketHeader.byteLength),c=new DataView(o).getUint8(3);if(c!==this.id)return void(re("SHOW_DATASTREAM2_LOG")&&L.debug("invalid datachannel id: ".concat(c," !== ").concat(this.id)));let u=s.data.slice(this._dataStreamPacketHeader.byteLength);u=this._dataStreamPacketHandler.deserialize(u),this.emit(JA.MESSAGE,u)}}_updateOriginDataChannel(r){super._updateOriginDataChannel(r),this._bandRemoteDataChannelEvents()}_close(){this._originDataChannel&&(this._originDataChannel.removeEventListener("message",this._messageListener),super._close())}_bandRemoteDataChannelEvents(){this._originDataChannel&&this._originDataChannel.addEventListener("message",this._messageListener)}}class Ppe extends AG{send(r){if(this._originDataChannel){let s=r;s=this._dataStreamPacketHandler.serialize(r);const o=new Uint8Array(this._dataStreamPacketHeader.byteLength+s.byteLength);o.set(new Uint8Array(this._dataStreamPacketHeader),0),o.set(new Uint8Array(s),this._dataStreamPacketHeader.byteLength),this._originDataChannel.send(o.buffer)}}}function tP(){const t=new Blob([atob("ZnVuY3Rpb24gdCh0LGUsbil7bGV0IGE9bmV3IFVpbnQ4QXJyYXkodCxlLG4pLG89W10scj0wO2Zvcig7by5sZW5ndGg8bjspciszPG4mJjA9PT1hW3JdJiYwPT09YVtyKzFdJiYzPT09YVtyKzJdJiYoMD09PWFbciszXXx8MT09PWFbciszXXx8Mj09PWFbciszXXx8Mz09PWFbciszXSk/KG8ucHVzaChhW3JdLGFbcisxXSxhW3IrM10pLHIrPTQpOihvLnB1c2goYVtyXSkscisrKTtyZXR1cm4gbmV3IFVpbnQ4QXJyYXkobyl9ZnVuY3Rpb24gZSh0LGUpe2NvbnN0IG49ZnVuY3Rpb24odCl7Y29uc3QgZT10Lmxlbmd0aDtsZXQgbj1bXSxhPTA7Zm9yKDthPGU7KWErMjxlJiYwPT09dFthXSYmMD09PXRbYSsxXSYmKDA9PT10W2ErMl18fDE9PT10W2ErMl18fDI9PT10W2ErMl18fDM9PT10W2ErMl0pPyhuLnB1c2godFthXSx0W2ErMV0sMyx0W2ErMl0pLGErPTMpOihuLnB1c2godFthXSksYSsrKTtyZXR1cm4gbmV3IFVpbnQ4QXJyYXkobil9KGUpLGE9bi5sZW5ndGgsbz1NYXRoLmZsb29yKGEvMjU1KSxyPWElMjU1LHM9bmV3IFVpbnQ4QXJyYXkoNitvKzErYSt0LmJ5dGVMZW5ndGgpO3NbMF09MCxzWzFdPTAsc1syXT0wLHNbM109MSxzWzRdPTYsc1s1XT0xMDE7bGV0IGk9MDtmb3IoO2k8bzspc1s2K2ldPTI1NSxpKys7cmV0dXJuIHNbNitpXT1yLGkrKyxzLnNldChuLDYraSkscy5zZXQobmV3IFVpbnQ4QXJyYXkodCksNitpK2EpLHMuYnVmZmVyfWNvbnN0IG49NzEsYT0xLG89MixyPTEscz0yO3ZhciBpOyFmdW5jdGlvbih0KXt0W3QuQVVESU9fTEVWRUw9MV09IkFVRElPX0xFVkVMIix0W3QuTUVUQURBVEE9Ml09Ik1FVEFEQVRBIix0W3QuQVVESU9fNjRfQklUX1BUUz0zXT0iQVVESU9fNjRfQklUX1BUUyJ9KGl8fChpPXt9KSk7bmF2aWdhdG9yLnVzZXJBZ2VudC5pbmRleE9mKCJTYWZhcmkiKT4tMSYmLTE9PT1uYXZpZ2F0b3IudXNlckFnZW50LmluZGV4T2YoIkNocm9tZSIpJiYoc2VsZi5vbnJ0Y3RyYW5zZm9ybT1mPT57Y29uc3QgdT1mLnRyYW5zZm9ybWVyO2xldCBkPVtdLGw9W107dS5vcHRpb25zLnBvcnQub25tZXNzYWdlPXQ9Pnt0LmRhdGEuc2VpJiZkLnB1c2godC5kYXRhLnNlaSksdC5kYXRhLm1ldGFkYXRhJiZsLnB1c2godC5kYXRhLm1ldGFkYXRhKX0sc2VsZi5wb3N0TWVzc2FnZSgic3RhcnRlZCIpO2NvbnN0IGc9dS5yZWFkYWJsZS5nZXRSZWFkZXIoKSxjPXUud3JpdGFibGUuZ2V0V3JpdGVyKCk7InNlaS1yeCI9PT11Lm9wdGlvbnMubmFtZT9mdW5jdGlvbiBlKG4pe2cucmVhZCgpLnRoZW4oKGE9PntpZighYS5kb25lKXtpZihhLnZhbHVlIGluc3RhbmNlb2YgUlRDRW5jb2RlZFZpZGVvRnJhbWUpe2NvbnN0IGU9ZnVuY3Rpb24oZSl7Y29uc3Qgbj1uZXcgRGF0YVZpZXcoZS5kYXRhKTtsZXQgYT0wO2Zvcig7YSs0PGUuZGF0YS5ieXRlTGVuZ3RoOyl7aWYoMD09PW4uZ2V0VWludDgoYSswKSYmMD09PW4uZ2V0VWludDgoYSsxKSYmMD09PW4uZ2V0VWludDgoYSsyKSYmMT09PW4uZ2V0VWludDgoYSszKSYmNj09PW4uZ2V0VWludDgoYSs0KSl7bGV0IG89YSs2LHI9MCxzPTA7Zm9yKDsyNTU9PT0ocz1uLmdldFVpbnQ4KG8rKykpOylyKz0yNTU7cis9cztjb25zdCBpPXQoZS5kYXRhLG8scik7cmV0dXJuIG5ldyBVaW50OEFycmF5KGkpfWErK31yZXR1cm4gbnVsbH0oYS52YWx1ZSk7ZSYmbi5vcHRpb25zLnBvcnQucG9zdE1lc3NhZ2Uoe3NlaTplfSl9Yy53cml0ZShhLnZhbHVlKSxuLm9wdGlvbnMucG9ydC5wb3N0TWVzc2FnZSh7dHJhbnNmb3JtZWQ6ITB9KSxlKG4pfX0pKX0odSk6InNlaS10eCI9PT11Lm9wdGlvbnMubmFtZT9mdW5jdGlvbiB0KG4pe2cucmVhZCgpLnRoZW4oKGE9PntpZighYS5kb25lKXtpZihhLnZhbHVlIGluc3RhbmNlb2YgUlRDRW5jb2RlZFZpZGVvRnJhbWUpe2NvbnN0IHQ9ZC5zaGlmdCgpO3QmJihhLnZhbHVlLmRhdGE9ZShhLnZhbHVlLmRhdGEsdCkpfWMud3JpdGUoYS52YWx1ZSksbi5vcHRpb25zLnBvcnQucG9zdE1lc3NhZ2Uoe3RyYW5zZm9ybWVkOiEwfSksdChuKX19KSl9KHUpOiJhdWRpby1tZXRhZGF0YS1yeCI9PT11Lm9wdGlvbnMubmFtZT9mdW5jdGlvbiB0KGUpe2cucmVhZCgpLnRoZW4oKGY9PntpZighZi5kb25lKXtpZihmLnZhbHVlIGluc3RhbmNlb2YgUlRDRW5jb2RlZEF1ZGlvRnJhbWUpe2NvbnN0IHQ9ZnVuY3Rpb24odCxlPSExKXtjb25zdCBmPXQuZ2V0VWludDgoMCk7aWYoZiE9PW4pcmV0dXJuO2NvbnN0IHU9dC5nZXRVaW50MTYoMSksZD1hK28rdSxsPW5ldyBVaW50OEFycmF5KHQuYnl0ZUxlbmd0aC1kKTtsLnNldChuZXcgVWludDhBcnJheSh0LmJ1ZmZlcixkLHQuYnl0ZUxlbmd0aC1kKSk7Y29uc3QgZz17bTpmLHRsdkxlbjp1LHRsdjpbXSxmcmFtZTpsfTtsZXQgYz1hK287Zm9yKDtjPGQ7KXtjb25zdCBuPXQuZ2V0VWludDgoYyksYT10LmdldFVpbnQxNihjK3IpLG89citzO2lmKG49PT1pLkFVRElPX0xFVkVMKXtsZXQgcj10LmdldFVpbnQ4KGMrbyk7Zm9yKGxldCBlPTE7ZTxhO2UrKylyPXI8PDh8dC5nZXRVaW50OChjK28rZSk7Zy50bHYucHVzaCh7dGFnOm4sbGVuZ3RoOmEsdmFsdWU6ZT8xMjdecj4+MToxMjcmcn0pfWVsc2UgaWYobj09PWkuTUVUQURBVEF8fG49PT1pLkFVRElPXzY0X0JJVF9QVFMpe2NvbnN0IGU9bmV3IFVpbnQ4QXJyYXkoYSk7Zm9yKGxldCBuPTA7bjxhO24rKyllW25dPXQuZ2V0VWludDgoYytvK24pO2cudGx2LnB1c2goe3RhZzpuLGxlbmd0aDphLHZhbHVlOmV9KX1jKz1vK2F9cmV0dXJuIGd9KG5ldyBEYXRhVmlldyhmLnZhbHVlLmRhdGEpKTtpZih0KXtjb25zdCBuPXQudGx2LmZpbmQoKHQ9PnQudGFnPT09aS5NRVRBREFUQXx8dC50YWc9PT1pLkFVRElPXzY0X0JJVF9QVFMpKTtuJiZuLnZhbHVlIGluc3RhbmNlb2YgVWludDhBcnJheSYmZS5vcHRpb25zLnBvcnQucG9zdE1lc3NhZ2Uoe21ldGFkYXRhOm4udmFsdWV9KSxmLnZhbHVlLmRhdGE9dC5mcmFtZS5idWZmZXJ9fWMud3JpdGUoZi52YWx1ZSksZS5vcHRpb25zLnBvcnQucG9zdE1lc3NhZ2Uoe3RyYW5zZm9ybWVkOiEwfSksdChlKX19KSl9KHUpOiJhdWRpby1tZXRhZGF0YS10eCI9PT11Lm9wdGlvbnMubmFtZSYmZnVuY3Rpb24gdChlKXtnLnJlYWQoKS50aGVuKChmPT57aWYoIWYuZG9uZSl7aWYoZS5vcHRpb25zLnBvcnQucG9zdE1lc3NhZ2Uoe2dldE1ldGFkYXRhOiEwfSksZi52YWx1ZSBpbnN0YW5jZW9mIFJUQ0VuY29kZWRBdWRpb0ZyYW1lKXtjb25zdCB0PWwuc2hpZnQoKTt0JiYoZi52YWx1ZS5kYXRhPWZ1bmN0aW9uKHQsZSxpKXtjb25zdCBmPWkuYnl0ZUxlbmd0aCx1PWYrcitzLGQ9YStvK3UsbD1uZXcgQXJyYXlCdWZmZXIodC5ieXRlTGVuZ3RoK2QpLGc9bmV3IERhdGFWaWV3KGwpO2cuc2V0VWludDgoMCxuKSxnLnNldFVpbnQxNigxLHUpLGcuc2V0VWludDgoMyxlKSxnLnNldFVpbnQxNig0LGYpO2ZvcihsZXQgdD0wO3Q8Zjt0KyspZy5zZXRVaW50OCg2K3QsaVt0XSk7Y29uc3QgYz1uZXcgVWludDhBcnJheShnLmJ1ZmZlcik7cmV0dXJuIGMuc2V0KG5ldyBVaW50OEFycmF5KHQpLGQpLGMuYnVmZmVyfShmLnZhbHVlLmRhdGEsaS5BVURJT182NF9CSVRfUFRTLHQpKX1jLndyaXRlKGYudmFsdWUpLGUub3B0aW9ucy5wb3J0LnBvc3RNZXNzYWdlKHt0cmFuc2Zvcm1lZDohMH0pLHQoZSl9fSkpfSh1KX0sc2VsZi5wb3N0TWVzc2FnZSgicmVnaXN0ZXJlZCIpKTsK")],{type:"text/javascript"});return setTimeout(()=>tA.revokeObjectURL(t),0),new Worker(tA.createObjectURL(t))}const PG=71,wx=1,Rx=2,Cx=1,OG=2;var Jf=function(t){return t[t.AUDIO_LEVEL=1]="AUDIO_LEVEL",t[t.METADATA=2]="METADATA",t[t.AUDIO_64_BIT_PTS=3]="AUDIO_64_BIT_PTS",t}(Jf||{});function kG(t){let r=arguments.length>1&&arguments[1]!==void 0&&arguments[1];const s=t.getUint8(0);if(s!==PG)return;const o=t.getUint16(1),c=wx+Rx+o,u=new Uint8Array(t.byteLength-c);u.set(new Uint8Array(t.buffer,c,t.byteLength-c));const h={m:s,tlvLen:o,tlv:[],frame:u};let m=wx+Rx;for(;m<c;){const _=t.getUint8(m),E=t.getUint16(m+Cx),S=Cx+OG;if(_===Jf.AUDIO_LEVEL){let R=t.getUint8(m+S);for(let P=1;P<E;P++)R=R<<8|t.getUint8(m+S+P);h.tlv.push({tag:_,length:E,value:r?127^R>>1:127&R})}else if(_===Jf.METADATA||_===Jf.AUDIO_64_BIT_PTS){const R=new Uint8Array(E);for(let P=0;P<E;P++)R[P]=t.getUint8(m+S+P);h.tlv.push({tag:_,length:E,value:R})}m+=S+E}return h}const nP=new Map,rP=127,F_=1e-10,Ix=139/13,iP=new Map;function Ax(t,r,s){const o="".concat(t,"-").concat(r,"-").concat(s);let c=0;return iP.has(o)?c=iP.get(o):(c=Math.log(function(h,m){const _=h-m;m<_&&(m=_);let E=1;for(let S=h,R=1;S>m;S--,R++)E=E*S/R;return E}(r,t))+t*Math.log(.5)+(r-t)*Math.log(1-.5)-Math.log(s)+s*t,iP.set(o,c)),c<F_&&(c=F_),c}function NG(t,r,s){const o=r.length,c=t.length/o;let u=!1;for(let h=0,m=0;h<o;h++){let _=0;for(let E=m+c;m<E;m++)t[m]>s&&_++;r[h]!==_&&(r[h]=_,u=!0)}return u}window.cache=iP;let Ope=0;class DG{constructor(r){Pe(this,"id",void 0),Pe(this,"immediates",[]),Pe(this,"lastNonSilence",-1),Pe(this,"immediateSpeechActivityScore",F_),Pe(this,"lastLevelChangedTime",Date.now()),Pe(this,"levels",[]),Pe(this,"longs",[]),Pe(this,"longSpeechActivityScore",F_),Pe(this,"mediums",[]),Pe(this,"mediumSpeechActivityScore",F_),Pe(this,"minLevel",0),Pe(this,"nextMinLevel",0),Pe(this,"nextMinLevelWindowLength",0),Pe(this,"energyScore",0),this.id=r||"".concat(Ope++),this.immediates.length=50,this.mediums.length=10,this.longs.length=1,this.levels.length=this.immediates.length}computeImmediates(){const r=this.immediates,s=this.levels,o=this.minLevel+Ix;let c=!1;for(let u=0;u<r.length;++u){let h=s[u];h<o&&(h=0);const m=Math.floor(h/Ix);r[u]!==m&&(r[u]=m,c=!0)}return c}computeLongs(){return NG(this.mediums,this.longs,4)}computeMediums(){return NG(this.immediates,this.mediums,7)}evaluateImmediateSpeechActivityScore(){this.immediateSpeechActivityScore=Ax(this.immediates[0],13,.78)}evaluateLongSpeechActivityScore(r){this.longSpeechActivityScore=Ax(this.longs[0],10,47),this.longSpeechActivityScore>F_&&(this.lastNonSilence=r)}evaluateMediumSpeechActivityScore(){this.mediumSpeechActivityScore=Ax(this.mediums[0],5,24)}evaluateSpeechActivityScores(r){this.computeImmediates()&&(this.evaluateImmediateSpeechActivityScore(),this.computeMediums()&&(this.evaluateMediumSpeechActivityScore(),this.computeLongs()&&this.evaluateLongSpeechActivityScore(r)))}getLastLevelChangedTime(){return this.lastLevelChangedTime}getLevels(){var r;return"[".concat(em(r=[...this.levels]).call(r).join(),"]")}getSpeechActivityScore(r){switch(r){case 0:return this.immediateSpeechActivityScore;case 1:return this.mediumSpeechActivityScore;case 2:return this.longSpeechActivityScore;default:throw new Error("interval "+r)}}levelChanged(r,s){if(this.lastLevelChangedTime<=s){this.lastLevelChangedTime=s;let o=r;return r<0&&(o=0),r>rP&&(o=rP),this.levels.unshift(o),this.levels.length>this.immediates.length&&this.levels.pop(),this.updateMinLevel(o),o>=this.minLevel+Ix?o:o/2}return-1}levelTimedOut(){this.levelChanged(0,this.lastLevelChangedTime)}updateMinLevel(r){if(r!==0){if(this.minLevel===0||this.minLevel>r)return this.minLevel=r,this.nextMinLevel=0,void(this.nextMinLevelWindowLength=0);if(this.nextMinLevel===0)return this.nextMinLevel=r,void(this.nextMinLevelWindowLength=1);if(this.nextMinLevel>r&&(this.nextMinLevel=r),this.nextMinLevelWindowLength++,this.nextMinLevelWindowLength>=750){let s=Math.sqrt(this.minLevel*this.nextMinLevel);s<0?s=0:s>rP&&(s=rP),this.minLevel=s,this.nextMinLevel=0,this.nextMinLevelWindowLength=0}}}}class kpe{constructor(r){Pe(this,"algorithm",void 0),this.algorithm=r}execute(){let r=!this.algorithm;if(!r)try{const s=this.algorithm.runInDecisionMaker(this);s<=0?r=!0:setTimeout(this.execute.bind(this),s)}catch{r=!0}r&&this.algorithm&&this.algorithm.decisionMakerExited(this)}}class Px{constructor(r,s,o){Pe(this,"isDominant",void 0),Pe(this,"energyRanking",void 0),Pe(this,"energyScore",void 0),this.isDominant=r,this.energyRanking=s,this.energyScore=o}}class Npe extends Pr{constructor(r){super(),Pe(this,"dominantId",null),Pe(this,"lastDecisionTime",0),Pe(this,"lastLevelChangedTime",0),Pe(this,"lastLevelIdleTime",0),Pe(this,"relativeSpeechActivities",[]),Pe(this,"speakers",new Map),Pe(this,"enableSilence",!1),Pe(this,"timeoutToSilenceInterval",0),Pe(this,"decisionMaker",null),Pe(this,"loudest",[]),Pe(this,"numLoudestToTrack",3),Pe(this,"energyExpireTimeMs",250),Pe(this,"energyAlphaPct",50),this.timeoutToSilenceInterval=r,this.enableSilence=r>0,this.relativeSpeechActivities.length=3}setLoudestConfig(){let r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:3,s=arguments.length>1?arguments[1]:void 0,o=arguments.length>2?arguments[2]:void 0;this.numLoudestToTrack=r,s!=null&&(this.energyExpireTimeMs=s),o!=null&&(this.energyAlphaPct=o),this.loudest.length>r&&this.loudest.splice(r)}getDominantSpeaker(){return this.dominantId}isAmongLoudest(r){return this.loudest.some(s=>s.id===r)}levelChanged(r,s){const o=Date.now(),c=this.getOrCreateSpeaker(r);this.lastLevelChangedTime<o&&(this.lastLevelChangedTime=o,this.maybeStartDecisionMaker());const u=c.levelChanged(s,o);return this.updateLoudestList(c,u,o)}runInDecisionMaker(r){return this.decisionMaker!==r||this.lastDecisionTime>0&&this.lastDecisionTime-this.lastLevelChangedTime>=15e3?-1:this._runInDecisionMaker()}decisionMakerExited(r){this.decisionMaker===r&&(this.decisionMaker=null)}destroy(){this.decisionMaker=null,this.loudest.length=0,this.speakers.clear(),this.removeAllListeners()}addSpeakers(r){r.forEach(s=>{this.speakers.has(s.id)||this.speakers.set(s.id,s)})}removeSpeakers(r){r.forEach(s=>{this.speakers.delete(s.id)})}getOrCreateSpeaker(r){let s=this.speakers.get(r);return s||(s=new DG(r),this.speakers.set(r,s),this.maybeStartDecisionMaker()),s}updateLoudestList(r,s,o){const c=r.id===this.dominantId;if(s<0){let _=0;for(;_<this.loudest.length&&this.loudest[_]!==r;)++_;return new Px(c,_,r.energyScore)}if(r.energyScore=Math.floor((this.energyAlphaPct*s+(100-this.energyAlphaPct)*r.energyScore+50)/100),this.numLoudestToTrack===0)return new Px(c,0,r.energyScore);const u=o-this.energyExpireTimeMs;let h=0;for(;h<this.loudest.length;){const _=this.loudest[h];if(_.getLastLevelChangedTime()<u&&this.loudest.length>=this.numLoudestToTrack)this.loudest.splice(h,1);else if(_.id!==r.id)++h;else if(this.loudest.splice(h,1),this.loudest.length<this.numLoudestToTrack)break}let m=0;for(;m<this.loudest.length&&!(this.loudest[m].energyScore<r.energyScore);)++m;return m<this.numLoudestToTrack&&(this.loudest.splice(m,0,r),this.loudest.length>this.numLoudestToTrack&&this.loudest.splice(this.numLoudestToTrack,1)),new Px(c,m,r.energyScore)}maybeStartDecisionMaker(){!this.decisionMaker&&this.speakers.size>0&&(this.decisionMaker=new kpe(this),this.decisionMaker.execute())}makeDecision(r){let s=null,o=null;const c=this.speakers.size;let u=null;if(c===0)u=null;else if(c===1){var h;const m=Oc(h=this.speakers).call(h).next().value;this.enableSilence&&m&&(u=m.id,m.evaluateSpeechActivityScores(r),r-m.lastNonSilence>this.timeoutToSilenceInterval&&(u=null))}else{let m=this.dominantId==null?null:this.speakers.get(this.dominantId);if(m==null){const S=this.speakers.entries().next();S.value&&(u=S.value[0],m=S.value[1])}else u=m.id;m!=null&&m.evaluateSpeechActivityScores(r);const _=this.relativeSpeechActivities;let E=2;for(const S of this.speakers.entries()){const[R,P]=S;if(P===m)continue;P.evaluateSpeechActivityScores(r);for(let F=0;F<_.length;++F){const q=m==null?F_:m.getSpeechActivityScore(F);_[F]=Math.log(P.getSpeechActivityScore(F)/q)}const k=_[0],z=_[1],U=_[2];k>3&&z>2&&U>0&&z>E&&(E=z,u=R)}this.enableSilence&&m!=null&&u===m.id&&r-m.lastNonSilence>this.timeoutToSilenceInterval&&(u=null)}u==null&&!this.enableSilence||u===this.dominantId||(s=this.dominantId,this.dominantId=u,o=this.dominantId),o==null&&!this.enableSilence||o===s||this.emit("ActiveSpeakerChanged",o)}_runInDecisionMaker(){const r=Date.now(),s=300-(r-this.lastLevelIdleTime);let o=0;s<=0?(this.lastLevelIdleTime!==0&&this.timeoutIdleLevels(r),this.lastLevelIdleTime=r):o=s;let c=300-(r-this.lastDecisionTime);return c<=0&&(this.lastDecisionTime=r,this.makeDecision(r),c=300-(Date.now()-r)),c>0&&o>c&&(o=c),o}timeoutIdleLevels(r){const s=[];for(const c of Oc(o=this.speakers).call(o)){var o;const u=r-c.getLastLevelChangedTime();36e5<u&&(this.dominantId==null||c.id!==this.dominantId)?s.push(c.id):300<u&&c.levelTimedOut()}s.forEach(c=>this.speakers.delete(c))}}const $v=new Map;let gd=null,sP=null;const LG=3;let j_=[];const _d=new Map,oP=new Map;class Dpe{get samples(){return this.actives+this.inactives}get activeRate(){return this.actives/this.samples}constructor(r,s){Pe(this,"id",void 0),Pe(this,"track",void 0),Pe(this,"score",0),Pe(this,"active",!0),Pe(this,"muted",!1),Pe(this,"timer",0),Pe(this,"actives",0),Pe(this,"inactives",0),this.id=r,this.track=s,this.setActive(_d.size<3)}autoCheckActive(){this.autoSetActive(),this.autoAdjustActive(),this.resetTimer(),this.actives=0,this.inactives=0}autoSetActive(){const r=this.active;this.active=this.activeRate>=.8;const{actives:s,inactives:o}=function(){const c=[],u=[];return Array.from(Oc(_d).call(_d)).forEach(h=>{h.active?c.push(h):u.push(h)}),{actives:c,inactives:u}}();if(s.length>3){let c;s.forEach(u=>{(!c||c.score>u.score)&&(c=u)}),c&&c.setActive(!1)}if(s.length<3&&o.length>0){let c;o.forEach(u=>{(!c||c.score<u.score)&&u.id!==this.id&&(c=u)}),c&&r&&!this.active&&(c.samples>40&&c.activeRate-this.activeRate>.4?c.setActive(!0):this.active=!0)}this.setMuted(!this.active)}setActive(r){this.active=r,this.resetTimer(),this.setMuted(!r)}autoAdjustActive(){this.active?this.autoSwitchToInactive():this.autoSwitchToActive()}autoSwitchToActive(){const r=function(s){let o;return Array.from(Oc(_d).call(_d)).forEach(c=>{!c.active||c.id===s||c.samples<40||(!o||c.score<o.score)&&(o=c)}),o}(this.id);r&&this.activeRate-r.activeRate>.4&&(r.setActive(!1),this.setActive(!0))}autoSwitchToInactive(){const r=function(s){let o;return Array.from(Oc(_d).call(_d)).forEach(c=>{c.active||c.id===s||c.samples<40||(!o||c.score>o.score)&&(o=c)}),o}(this.id);r&&r.activeRate-this.activeRate>.4&&(r.setActive(!0),this.setActive(!1))}addSample(r){r?this.actives+=1:this.inactives+=1,this.samples>66.66666666666667&&this.autoCheckActive()}setMuted(r){this.track&&(this.track.enabled=!r,this.muted=r)}resetTimer(){this.clearTimer(),this.timer=window.setTimeout(()=>{if(this.samples!==0)return this.samples<50?this.resetTimer():void this.autoCheckActive()},1e3)}clearTimer(){this.timer&&(clearTimeout(this.timer),this.timer=0)}}let aP;function xG(t){const r=_d.get(t);r&&(_d.delete(t),r.clearTimer())}const cP=new Map,Lpe=new Map;function xpe(t,r,s){let o=new Uint8Array(t,r,s),c=[],u=0;for(;c.length<s;)u+3<s&&o[u]===0&&o[u+1]===0&&o[u+2]===3&&(o[u+3]===0||o[u+3]===1||o[u+3]===2||o[u+3]===3)?(c.push(o[u],o[u+1],o[u+3]),u+=4):(c.push(o[u]),u++);return new Uint8Array(c)}const lP=new Map,TT=new Map;(function(){const t=Rn();as.getDisplayMedia=!(!navigator.mediaDevices||!navigator.mediaDevices.getDisplayMedia),as.getStreamFromExtension=t.name===Un.CHROME&&Number(t.version)>34,as.supportUnifiedPlan=function(){if(!window.RTCRtpTransceiver||!("currentDirection"in RTCRtpTransceiver.prototype))return!1;const r=new RTCPeerConnection;let s=!1;try{r.addTransceiver("audio"),s=!0}catch{}return r.close(),s}(),as.supportMinBitrate=t.name===Un.CHROME||t.name===Un.EDGE,as.supportSetRtpSenderParameters=function(){const r=Rn();return!!(window.RTCRtpSender&&window.RTCRtpSender.prototype.setParameters&&window.RTCRtpSender.prototype.getParameters)&&(!!Kf()||!(!Ss()&&!VA())||r.name===Un.FIREFOX&&Number(r.version)>=64)}(),t.name===Un.SAFARI&&(Number(t.version)>=14?as.supportDualStream=!0:as.supportDualStream=!1),as.webAudioMediaStreamDest=function(){const r=Rn();return!(r.name===Un.SAFARI&&Number(r.version)<12)}(),as.supportReplaceTrack=!!window.RTCRtpSender&&typeof RTCRtpSender.prototype.replaceTrack=="function",as.supportWebGL=typeof WebGLRenderingContext<"u",as.supportRequestFrame=!!window.CanvasCaptureMediaStreamTrack,Kf()||(as.webAudioWithAEC=!0),as.supportShareAudio=function(){const r=Rn();return(r.os===zi.WIN_10||r.os===zi.WIN_81||r.os===zi.WIN_7||r.os===zi.LINUX||r.os===zi.MAC_OS||r.os===zi.CHROMIUM_OS)&&r.name===Un.CHROME&&Number(r.version)>=74}(),as.supportDataChannel=!!(hT(76)||function(r){const s=Rn();return!(s.name!==Un.FIREFOX||!s.osVersion)&&Number(s.version)>=r}(68)||jW(14)),as.supportPCSetConfiguration=function(){const r=window.RTCPeerConnection;return!Dr()&&!!r&&r.prototype.setConfiguration instanceof Function}(),as.supportWebRTCEncodedTransform=function(){const r=Rn();return r.name==="Chrome"&&Number(r.version)>=87||r.name==="Safari"&&Number(r.version)>=15}(),as.supportWebRTCInsertableStream=function(){const r=Rn();return(r.name===Un.CHROME||r.name===Un.EDGE)&&Number(r.version)>=94&&"MediaStreamTrackGenerator"in window&&"MediaStreamTrackProcessor"in window}(),as.supportRequestVideoFrameCallback="requestVideoFrameCallback"in HTMLVideoElement.prototype,as.supportWebCrypto=typeof window<"u"&&window.crypto!==void 0&&window.crypto.subtle!==void 0,BA(()=>{as.supportDualStreamEncoding=function(){const r=Rn();return!!re("DISABLE_WEBAUDIO")||r.name==="Safari"&&Number(r.version)>=14||!!(r.name==="Chrome"&&/Windows/i.test(r.os||"")&&Number(r.version)>=100&&re("CHROME_DUAL_STREAM_USE_ENCODING"))}(),L.debug("browser ua: ",navigator.userAgent),L.info("browser info: ",t),L.info("browser compatibility: ",as)})})();const Mpe=["CHINA","GLOBAL"],MG=[[0,1,2,3,4,5,5],[0,2,2,3,4,5,5],[0,3,3,3,4,5,5],[0,4,4,4,4,5,5],[0,5,5,5,5,5,5]],B_=[],Kv=[];function W_(t,r){return!!r&&B_.some(s=>s.uid===t&&s.channelName===r)}function Ox(){return Kv.length>0}var Upe=i6.forEach,UG=Sf("forEach")?[].forEach:function(t){return Upe(this,t,arguments.length>1?arguments[1]:void 0)};Mn({target:"Array",proto:!0,forced:[].forEach!=UG},{forEach:UG});var Vpe=qa("Array").forEach,Fpe=Ec,jpe=yi,Bpe=N,Wpe=Vpe,kx=Array.prototype,zpe={DOMTokenList:!0,NodeList:!0},Gpe=function(t){var r=t.forEach;return t===kx||Bpe(kx,t)&&r===kx.forEach||jpe(zpe,Fpe(t))?Wpe:r},Hpe=l(Gpe),$pe=Po,VG=bc;Mn({target:"Object",stat:!0,forced:d(function(){VG(1)})},{keys:function(t){return VG($pe(t))}});var FG=l(bt.Object.keys),Kpe=l(rE),qpe=l(sE),Ype=Mn,jG=$g,Xpe=m_,Jpe=Et,BG=pe,Qpe=oi,Zpe=Re,eme=zI,tme=hr,nme=_s,rme=qB("slice"),ime=tme("species"),Nx=Array,sme=Math.max;Ype({target:"Array",proto:!0,forced:!rme},{slice:function(t,r){var s,o,c,u=Zpe(this),h=Qpe(u),m=BG(t,h),_=BG(r===void 0?h:r,h);if(jG(u)&&(s=u.constructor,(Xpe(s)&&(s===Nx||jG(s.prototype))||Jpe(s)&&(s=s[ime])===null)&&(s=void 0),s===Nx||s===void 0))return nme(u,m,_);for(o=new(s===void 0?Nx:s)(sme(_-m,0)),c=0;m<_;m++,c++)m in u&&eme(o,c,u[m]);return o.length=c,o}});var ome=qa("Array").slice,ame=N,cme=ome,Dx=Array.prototype,lme=function(t){var r=t.slice;return t===Dx||ame(Dx,t)&&r===Dx.slice?cme:r},ume=l(lme);function vt(t,r,s,o,c){var u,h,m,_={};return Hpe(u=FG(o)).call(u,function(E){_[E]=o[E]}),_.enumerable=!!_.enumerable,_.configurable=!!_.configurable,("value"in _||_.initializer)&&(_.writable=!0),_=Kpe(h=qpe(m=ume(s).call(s)).call(m)).call(h,function(E,S){return S(t,r,E)||E},_),c&&_.initializer!==void 0&&(_.value=_.initializer?_.initializer.call(c):void 0,_.initializer=void 0),_.initializer===void 0&&(GB(t,r,_),_=null),_}let uP=function(t){return t[t.ACCESS_POINT=101]="ACCESS_POINT",t[t.UNILBS=201]="UNILBS",t[t.STRING_UID_ALLOCATOR=901]="STRING_UID_ALLOCATOR",t}({}),Lx=function(t){return t[t.IIIEGAL_APPID=1]="IIIEGAL_APPID",t[t.IIIEGAL_UID=2]="IIIEGAL_UID",t[t.INTERNAL_ERROR=3]="INTERNAL_ERROR",t}({}),hu=function(t){return t[t.INVALID_VENDOR_KEY=5]="INVALID_VENDOR_KEY",t[t.INVALID_CHANNEL_NAME=7]="INVALID_CHANNEL_NAME",t[t.INTERNAL_ERROR=8]="INTERNAL_ERROR",t[t.NO_AUTHORIZED=9]="NO_AUTHORIZED",t[t.DYNAMIC_KEY_TIMEOUT=10]="DYNAMIC_KEY_TIMEOUT",t[t.NO_ACTIVE_STATUS=11]="NO_ACTIVE_STATUS",t[t.DYNAMIC_KEY_EXPIRED=13]="DYNAMIC_KEY_EXPIRED",t[t.STATIC_USE_DYNAMIC_KEY=14]="STATIC_USE_DYNAMIC_KEY",t[t.DYNAMIC_USE_STATIC_KEY=15]="DYNAMIC_USE_STATIC_KEY",t[t.USER_OVERLOAD=16]="USER_OVERLOAD",t[t.FORBIDDEN_REGION=18]="FORBIDDEN_REGION",t[t.CANNOT_MEET_AREA_DEMAND=19]="CANNOT_MEET_AREA_DEMAND",t}({}),bo=function(t){return t[t.NO_FLAG_SET=100]="NO_FLAG_SET",t[t.FLAG_SET_BUT_EMPTY=101]="FLAG_SET_BUT_EMPTY",t[t.INVALID_FALG_SET=102]="INVALID_FALG_SET",t[t.FLAG_SET_BUT_NO_RE=103]="FLAG_SET_BUT_NO_RE",t[t.INVALID_SERVICE_ID=104]="INVALID_SERVICE_ID",t[t.NO_SERVICE_AVAILABLE=200]="NO_SERVICE_AVAILABLE",t[t.NO_SERVICE_AVAILABLE_P2P=201]="NO_SERVICE_AVAILABLE_P2P",t[t.NO_SERVICE_AVAILABLE_VOICE=202]="NO_SERVICE_AVAILABLE_VOICE",t[t.NO_SERVICE_AVAILABLE_WEBRTC=203]="NO_SERVICE_AVAILABLE_WEBRTC",t[t.NO_SERVICE_AVAILABLE_CDS=204]="NO_SERVICE_AVAILABLE_CDS",t[t.NO_SERVICE_AVAILABLE_CDN=205]="NO_SERVICE_AVAILABLE_CDN",t[t.NO_SERVICE_AVAILABLE_TDS=206]="NO_SERVICE_AVAILABLE_TDS",t[t.NO_SERVICE_AVAILABLE_REPORT=207]="NO_SERVICE_AVAILABLE_REPORT",t[t.NO_SERVICE_AVAILABLE_APP_CENTER=208]="NO_SERVICE_AVAILABLE_APP_CENTER",t[t.NO_SERVICE_AVAILABLE_ENV0=209]="NO_SERVICE_AVAILABLE_ENV0",t[t.NO_SERVICE_AVAILABLE_VOET=210]="NO_SERVICE_AVAILABLE_VOET",t[t.NO_SERVICE_AVAILABLE_STRING_UID=211]="NO_SERVICE_AVAILABLE_STRING_UID",t[t.NO_SERVICE_AVAILABLE_WEBRTC_UNILBS=212]="NO_SERVICE_AVAILABLE_WEBRTC_UNILBS",t[t.NO_SERVICE_AVAILABLE_UNILBS_FLV=213]="NO_SERVICE_AVAILABLE_UNILBS_FLV",t}({}),Lt=function(t){return t[t.K_TIMESTAMP_EXPIRED=2]="K_TIMESTAMP_EXPIRED",t[t.K_CHANNEL_PERMISSION_INVALID=3]="K_CHANNEL_PERMISSION_INVALID",t[t.K_CERTIFICATE_INVALID=4]="K_CERTIFICATE_INVALID",t[t.K_CHANNEL_NAME_EMPTY=5]="K_CHANNEL_NAME_EMPTY",t[t.K_CHANNEL_NOT_FOUND=6]="K_CHANNEL_NOT_FOUND",t[t.K_TICKET_INVALID=7]="K_TICKET_INVALID",t[t.K_CHANNEL_CONFLICTED=8]="K_CHANNEL_CONFLICTED",t[t.K_SERVICE_NOT_READY=9]="K_SERVICE_NOT_READY",t[t.K_SERVICE_TOO_HEAVY=10]="K_SERVICE_TOO_HEAVY",t[t.K_UID_BANNED=14]="K_UID_BANNED",t[t.K_IP_BANNED=15]="K_IP_BANNED",t[t.K_CHANNEL_BANNED=16]="K_CHANNEL_BANNED",t[t.DATASTREAM2_NOT_AVAILABLE=27]="DATASTREAM2_NOT_AVAILABLE",t[t.K_AUTO_REBALANCE=28]="K_AUTO_REBALANCE",t[t.WARN_NO_AVAILABLE_CHANNEL=103]="WARN_NO_AVAILABLE_CHANNEL",t[t.WARN_LOOKUP_CHANNEL_TIMEOUT=104]="WARN_LOOKUP_CHANNEL_TIMEOUT",t[t.WARN_LOOKUP_CHANNEL_REJECTED=105]="WARN_LOOKUP_CHANNEL_REJECTED",t[t.WARN_OPEN_CHANNEL_TIMEOUT=106]="WARN_OPEN_CHANNEL_TIMEOUT",t[t.WARN_OPEN_CHANNEL_REJECTED=107]="WARN_OPEN_CHANNEL_REJECTED",t[t.WARN_REQUEST_DEFERRED=108]="WARN_REQUEST_DEFERRED",t[t.ERR_DYNAMIC_KEY_TIMEOUT=109]="ERR_DYNAMIC_KEY_TIMEOUT",t[t.ERR_NO_AUTHORIZED=110]="ERR_NO_AUTHORIZED",t[t.ERR_VOM_SERVICE_UNAVAILABLE=111]="ERR_VOM_SERVICE_UNAVAILABLE",t[t.ERR_NO_CHANNEL_AVAILABLE_CODE=112]="ERR_NO_CHANNEL_AVAILABLE_CODE",t[t.ERR_MASTER_VOCS_UNAVAILABLE=114]="ERR_MASTER_VOCS_UNAVAILABLE",t[t.ERR_INTERNAL_ERROR=115]="ERR_INTERNAL_ERROR",t[t.ERR_NO_ACTIVE_STATUS=116]="ERR_NO_ACTIVE_STATUS",t[t.ERR_INVALID_UID=117]="ERR_INVALID_UID",t[t.ERR_DYNAMIC_KEY_EXPIRED=118]="ERR_DYNAMIC_KEY_EXPIRED",t[t.ERR_STATIC_USE_DYANMIC_KE=119]="ERR_STATIC_USE_DYANMIC_KE",t[t.ERR_DYNAMIC_USE_STATIC_KE=120]="ERR_DYNAMIC_USE_STATIC_KE",t[t.ERR_NO_VOCS_AVAILABLE=2e3]="ERR_NO_VOCS_AVAILABLE",t[t.ERR_NO_VOS_AVAILABLE=2001]="ERR_NO_VOS_AVAILABLE",t[t.ERR_JOIN_CHANNEL_TIMEOUT=2002]="ERR_JOIN_CHANNEL_TIMEOUT",t[t.ERR_REPEAT_JOIN_CHANNEL=2003]="ERR_REPEAT_JOIN_CHANNEL",t[t.ERR_JOIN_BY_MULTI_IP=2004]="ERR_JOIN_BY_MULTI_IP",t[t.ERR_NOT_JOINED=2011]="ERR_NOT_JOINED",t[t.ERR_REPEAT_JOIN_REQUEST=2012]="ERR_REPEAT_JOIN_REQUEST",t[t.ERR_INVALID_VENDOR_KEY=2013]="ERR_INVALID_VENDOR_KEY",t[t.ERR_INVALID_CHANNEL_NAME=2014]="ERR_INVALID_CHANNEL_NAME",t[t.ERR_INVALID_STRINGUID=2015]="ERR_INVALID_STRINGUID",t[t.ERR_TOO_MANY_USERS=2016]="ERR_TOO_MANY_USERS",t[t.ERR_SET_CLIENT_ROLE_TIMEOUT=2017]="ERR_SET_CLIENT_ROLE_TIMEOUT",t[t.ERR_SET_CLIENT_ROLE_NO_PERMISSION=2018]="ERR_SET_CLIENT_ROLE_NO_PERMISSION",t[t.ERR_SET_CLIENT_ROLE_ALREADY_IN_USE=2019]="ERR_SET_CLIENT_ROLE_ALREADY_IN_USE",t[t.ERR_PUBLISH_REQUEST_INVALID=2020]="ERR_PUBLISH_REQUEST_INVALID",t[t.ERR_SUBSCRIBE_REQUEST_INVALID=2021]="ERR_SUBSCRIBE_REQUEST_INVALID",t[t.ERR_NOT_SUPPORTED_MESSAGE=2022]="ERR_NOT_SUPPORTED_MESSAGE",t[t.ERR_ILLEAGAL_PLUGIN=2023]="ERR_ILLEAGAL_PLUGIN",t[t.ERR_REJOIN_TOKEN_INVALID=2024]="ERR_REJOIN_TOKEN_INVALID",t[t.ERR_REJOIN_USER_NOT_JOINED=2025]="ERR_REJOIN_USER_NOT_JOINED",t[t.ERR_INVALID_OPTIONAL_INFO=2027]="ERR_INVALID_OPTIONAL_INFO",t[t.ILLEGAL_AES_PASSWORD=2028]="ILLEGAL_AES_PASSWORD",t[t.ILLEGAL_CLIENT_ROLE_LEVEL=2029]="ILLEGAL_CLIENT_ROLE_LEVEL",t[t.ERR_TOO_MANY_BROADCASTERS=2031]="ERR_TOO_MANY_BROADCASTERS",t[t.ERR_TOO_MANY_SUBSCRIBERS=2032]="ERR_TOO_MANY_SUBSCRIBERS",t[t.ERR_LICENSE_MISSING=32769]="ERR_LICENSE_MISSING",t[t.ERR_LICENSE_EXPIRED=32771]="ERR_LICENSE_EXPIRED",t[t.ERR_LICENSE_MINUTES_EXCEEDED=32773]="ERR_LICENSE_MINUTES_EXCEEDED",t[t.ERR_LICENSE_PERIOD_INVALID=32774]="ERR_LICENSE_PERIOD_INVALID",t[t.ERR_LICENSE_MULTIPLE_SDK_SERVICE=32778]="ERR_LICENSE_MULTIPLE_SDK_SERVICE",t[t.ERR_LICENSE_ILLEGAL=32783]="ERR_LICENSE_ILLEGAL",t[t.ERR_TEST_RECOVER=9e3]="ERR_TEST_RECOVER",t[t.ERR_TEST_TRYNEXT=9001]="ERR_TEST_TRYNEXT",t[t.ERR_TEST_RETRY=9002]="ERR_TEST_RETRY",t}({}),lr=function(t){return t.CONNECTING="connecting",t.CONNECTED="connected",t.RECONNECTING="reconnecting",t.CLOSED="closed",t}({}),Wt=function(t){return t.WS_CONNECTED="ws_connected",t.WS_RECONNECTING="ws_reconnecting",t.WS_CLOSED="ws_closed",t.WS_RECONNECT_CREATE_CONNECTION="ws_reconnect_create_connection",t.ON_BINARY_DATA="on_binary_data",t.REQUEST_RECOVER="request_recover",t.REQUEST_JOIN_INFO="request_join_info",t.REQUEST_REJOIN_INFO="req_rejoin_info",t.IS_P2P_DISCONNECTED="is_p2p_dis",t.DISCONNECT_P2P="dis_p2p",t.ABORT_P2P_EXECUTION="abort_p2p_execution",t.NEED_RENEW_SESSION="need-sid",t.REPORT_JOIN_GATEWAY="report_join_gateway",t.REQUEST_TIMEOUT="request_timeout",t.REQUEST_SUCCESS="request_success",t.JOIN_RESPONSE="join_response",t.PRE_CONNECT_PC="pre_connect_pc",t.P2P_CONNECTION="p2p_connection",t.P2P_REMOTE_CANDIDATE_UPDATE="p2p_remote_candidate_update",t.P2P_SUBSCRIBE="p2p_subscribe",t.P2P_UNSUBSCRIBE="p2p_unsubscribe",t.P2P_EXCHANGE_SDP="p2p_exchange_sdp",t.P2P_ON_ADD_VIDEO_STREAM="p2p_on_add_video_stream",t.P2P_ON_ADD_AUDIO_STREAM="p2p_on_add_audio_stream",t.RECOVER_NOTIFICATION="recover_notification",t}({}),jt=function(t){return t.PING="ping",t.PING_BACK="ping_back",t.JOIN="join_v3",t.REJOIN="rejoin_v3",t.LEAVE="leave",t.SET_CLIENT_ROLE="set_client_role",t.PUBLISH="publish",t.PUBLISH_DATASTREAM="publish_datastream",t.UNPUBLISH="unpublish",t.UNPUBLISH_DATASTREAM="unpublish_datastream",t.SUBSCRIBE="subscribe",t.PRE_SUBSCRIBE="pre_subscribe",t.SUBSCRIBE_DATASTREAM="subscribe_datastream",t.SUBSCRIBE_STREAMS="subscribe_streams",t.UNSUBSCRIBE="unsubscribe",t.UNSUBSCRIBE_DATASTREAM="unsubscribe_datastream",t.UNSUBSCRIBE_STREAMS="unsubscribe_streams",t.SUBSCRIBE_CHANGE="subscribe_change",t.TRAFFIC_STATS="traffic_stats",t.RENEW_TOKEN="renew_token",t.SWITCH_VIDEO_STREAM="switch_video_stream",t.DEFAULT_VIDEO_STREAM="default_video_stream",t.SET_FALLBACK_OPTION="set_fallback_option",t.GATEWAY_INFO="gateway_info",t.CONTROL="control",t.SEND_METADATA="send_metadata",t.DATA_STREAM="data_stream",t.PICK_SVC_LAYER="pick_svc_layer",t.RESTART_ICE="restart_ice",t.CONNECT_PC="connect_pc",t.SET_VIDEO_PROFILE="set_video_profile",t.SET_PARAMETER="set_parameter",t.SET_RTM2_FLAG="set_rtm2_flag",t}({}),wT=function(t){return t.WRTC_STATS="wrtc_stats",t.WS_INFLATE_DATA_LENGTH="ws_inflate_data_length",t.DENOISER_STATS="denoiser_stats",t.EXTENSION_USAGE_STATS="extension_usage_stats",t}({}),_n=function(t){return t.ON_USER_ONLINE="on_user_online",t.ON_USER_OFFLINE="on_user_offline",t.ON_STREAM_FALLBACK_UPDATE="on_stream_fallback_update",t.ON_PUBLISH_STREAM="on_publish_stream",t.ON_UPLINK_STATS="on_uplink_stats",t.ON_P2P_LOST="on_p2p_lost",t.ON_REMOVE_STREAM="on_remove_stream",t.ON_ADD_AUDIO_STREAM="on_add_audio_stream",t.ON_ADD_VIDEO_STREAM="on_add_video_stream",t.ON_TOKEN_PRIVILEGE_WILL_EXPIRE="on_token_privilege_will_expire",t.ON_TOKEN_PRIVILEGE_DID_EXPIRE="on_token_privilege_did_expire",t.ON_USER_BANNED="on_user_banned",t.ON_USER_LICENSE_BANNED="on_user_license_banned",t.ON_NOTIFICATION="on_notification",t.ON_CRYPT_ERROR="on_crypt_error",t.MUTE_AUDIO="mute_audio",t.MUTE_VIDEO="mute_video",t.UNMUTE_AUDIO="unmute_audio",t.UNMUTE_VIDEO="unmute_video",t.ON_P2P_OK="on_p2p_ok",t.RECEIVE_METADATA="receive_metadata",t.ON_DATA_STREAM="on_data_stream",t.ON_RTP_CAPABILITY_CHANGE="on_rtp_capability_change",t.ON_REMOTE_DATASTREAM_UPDATE="on_remote_datastream_update",t.ON_REMOTE_FULL_DATASTREAM_INFO="on_remote_full_datastream_info",t.ENABLE_LOCAL_VIDEO="enable_local_video",t.DISABLE_LOCAL_VIDEO="disable_local_video",t.ENABLE_LOCAL_AUDIO="enable_local_audio",t.DISABLE_LOCAL_AUDIO="disable_local_audio",t.ON_PUBLISHED_USER_LIST="on_published_user_list",t}({}),To=function(t){return t.SEND_ONLY="SEND_ONLY",t.RECEIVE_ONLY="RECEIVE_ONLY",t}({}),Yt=function(t){return t.CONNECTED="websocket:connected",t.RECONNECTING="websocket:reconnecting",t.WILL_RECONNECT="websocket:will_reconnect",t.CLOSED="websocket:closed",t.FAILED="websocket:failed",t.ON_MESSAGE="websocket:on_message",t.REQUEST_NEW_URLS="websocket:request_new_urls",t.RECONNECT_CREATE_CONNECTION="websocket:reconnect_create_connection",t.ON_TOKEN_PRIVILEGE_DID_EXPIRE="websocket:on_token_privilege_did_expire",t}({});function dP(t){if(typeof t!="string"||!/^[a-zA-Z0-9 \!\#\$\%\&\(\)\+\-\:\;\<\=\.\>\?\@\[\]\^\_\{\}\|\~\,]{1,64}$/.test(t))throw L.error("Invalid Channel Name ".concat(t)),new Oe(X.INVALID_PARAMS,"The length must be within 64 bytes. The supported characters: a-z,A-Z,0-9,space,!, #, $, %, &, (, ), +, -, :, ;, <, =, ., >, ?, @, [, ], ^, _,  {, }, |, ~, ,")}function hP(t){if(r=t,!(typeof r=="number"&&Math.floor(r)===r&&0<=r&&r<=4294967295||qW(t,1,255)))throw new Oe(X.INVALID_PARAMS,"[String uid] Length of the string: [1,255]. ASCII characters only. [Number uid] The value range is [0,10000]");var r;typeof t=="string"&&L.warn("You input a string as the user ID, to ensure better end-user experience, Agora highly suggests not using a string as the user ID.")}let Qf=function(t){return t.TRANSCODE="mix_streaming",t.RAW="raw_streaming",t}({});const dme={alpha:1,height:640,width:360,x:0,y:0,zOrder:0,audioChannel:0},xx={x:0,y:0,width:160,height:160,zOrder:255,alpha:1};function Mx(t,r){ss(t.url,"".concat(r,".url"),1,1e3,!1),Lr(t.x)||er(t.x,"".concat(r,".x"),0,1e4),Lr(t.y)||er(t.y,"".concat(r,".y"),0,1e4),Lr(t.width)||er(t.width,"".concat(r,".width"),0,1e4),Lr(t.height)||er(t.height,"".concat(r,".height"),0,1e4),Lr(t.zOrder)||er(t.zOrder,"".concat(r,".zOrder"),0,255),Lr(t.alpha)||er(t.alpha,"".concat(r,".alpha"),0,1,!1)}const hme={audioBitrate:48,audioChannels:1,audioSampleRate:48e3,backgroundColor:0,height:360,lowLatency:!1,videoBitrate:400,videoCodecProfile:100,videoCodecType:1,videoFrameRate:15,videoGop:30,width:640,images:[],userConfigs:[],userConfigExtraInfo:""};let Om=function(t){return t.WARNING="@live_uap-warning",t.ERROR="@line_uap-error",t.PUBLISH_STREAM_STATUS="@live_uap-publish-status",t.WORKER_STATUS="@live_uap-worker-status",t.REQUEST_NEW_ADDRESS="@live_uap-request-address",t}({}),Ux=function(t){return t.REQUEST_WORKER_MANAGER_LIST="@live_req_worker_manager",t}({}),Pi=function(t){return t[t.LIVE_STREAM_RESPONSE_SUCCEED=200]="LIVE_STREAM_RESPONSE_SUCCEED",t[t.LIVE_STREAM_RESPONSE_ALREADY_EXISTS_STREAM=454]="LIVE_STREAM_RESPONSE_ALREADY_EXISTS_STREAM",t[t.LIVE_STREAM_RESPONSE_TRANSCODING_PARAMETER_ERROR=450]="LIVE_STREAM_RESPONSE_TRANSCODING_PARAMETER_ERROR",t[t.LIVE_STREAM_RESPONSE_BAD_STREAM=451]="LIVE_STREAM_RESPONSE_BAD_STREAM",t[t.LIVE_STREAM_RESPONSE_WM_PARAMETER_ERROR=400]="LIVE_STREAM_RESPONSE_WM_PARAMETER_ERROR",t[t.LIVE_STREAM_RESPONSE_WM_WORKER_NOT_EXIST=404]="LIVE_STREAM_RESPONSE_WM_WORKER_NOT_EXIST",t[t.LIVE_STREAM_RESPONSE_NOT_AUTHORIZED=456]="LIVE_STREAM_RESPONSE_NOT_AUTHORIZED",t[t.LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE=457]="LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE",t[t.LIVE_STREAM_RESPONSE_REQUEST_TOO_OFTEN=429]="LIVE_STREAM_RESPONSE_REQUEST_TOO_OFTEN",t[t.LIVE_STREAM_RESPONSE_NOT_FOUND_PUBLISH=452]="LIVE_STREAM_RESPONSE_NOT_FOUND_PUBLISH",t[t.LIVE_STREAM_RESPONSE_NOT_SUPPORTED=453]="LIVE_STREAM_RESPONSE_NOT_SUPPORTED",t[t.LIVE_STREAM_RESPONSE_MAX_STREAM_NUM=455]="LIVE_STREAM_RESPONSE_MAX_STREAM_NUM",t[t.LIVE_STREAM_RESPONSE_INTERNAL_SERVER_ERROR=500]="LIVE_STREAM_RESPONSE_INTERNAL_SERVER_ERROR",t[t.LIVE_STREAM_RESPONSE_WORKER_LOST=501]="LIVE_STREAM_RESPONSE_WORKER_LOST",t[t.LIVE_STREAM_RESPONSE_RESOURCE_LIMIT=502]="LIVE_STREAM_RESPONSE_RESOURCE_LIMIT",t[t.LIVE_STREAM_RESPONSE_WORKER_QUIT=503]="LIVE_STREAM_RESPONSE_WORKER_QUIT",t[t.ERROR_FAIL_SEND_MESSAGE=504]="ERROR_FAIL_SEND_MESSAGE",t[t.PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE=30]="PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE",t[t.PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT=31]="PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT",t[t.PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH=32]="PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH",t[t.PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN=33]="PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN",t}({});function WG(t){if(!t.channelName)throw new Oe(X.INVALID_PARAMS,"invalid channelName in info");if(typeof t.uid!="number")throw new Oe(X.INVALID_PARAMS,"invalid uid in info, uid must be a number");return t.token&&ss(t.token,"info.token",1,2047),hP(t.uid),dP(t.channelName),!0}let wo=function(t){return t[t.SetSdkProfile=0]="SetSdkProfile",t[t.SetSourceChannel=1]="SetSourceChannel",t[t.SetSourceUserId=2]="SetSourceUserId",t[t.SetDestChannel=3]="SetDestChannel",t[t.StartPacketTransfer=4]="StartPacketTransfer",t[t.StopPacketTransfer=5]="StopPacketTransfer",t[t.UpdateDestChannel=6]="UpdateDestChannel",t[t.Reconnect=7]="Reconnect",t[t.SetVideoProfile=8]="SetVideoProfile",t}({}),Zf=function(t){return t.NETWORK_DISCONNECTED="NETWORK_DISCONNECTED",t.NETWORK_CONNECTED="NETWORK_CONNECTED",t.PACKET_JOINED_SRC_CHANNEL="PACKET_JOINED_SRC_CHANNEL",t.PACKET_JOINED_DEST_CHANNEL="PACKET_JOINED_DEST_CHANNEL",t.PACKET_SENT_TO_DEST_CHANNEL="PACKET_SENT_TO_DEST_CHANNEL",t.PACKET_RECEIVED_VIDEO_FROM_SRC="PACKET_RECEIVED_VIDEO_FROM_SRC",t.PACKET_RECEIVED_AUDIO_FROM_SRC="PACKET_RECEIVED_AUDIO_FROM_SRC",t.PACKET_UPDATE_DEST_CHANNEL="PACKET_UPDATE_DEST_CHANNEL",t.PACKET_UPDATE_DEST_CHANNEL_REFUSED="PACKET_UPDATE_DEST_CHANNEL_REFUSED",t.PACKET_UPDATE_DEST_CHANNEL_NOT_CHANGE="PACKET_UPDATE_DEST_CHANNEL_NOT_CHANGE",t}({}),Ia=function(t){return t.RELAY_STATE_IDLE="RELAY_STATE_IDLE",t.RELAY_STATE_CONNECTING="RELAY_STATE_CONNECTING",t.RELAY_STATE_RUNNING="RELAY_STATE_RUNNING",t.RELAY_STATE_FAILURE="RELAY_STATE_FAILURE",t}({}),qv=function(t){return t.RELAY_OK="RELAY_OK",t.SERVER_CONNECTION_LOST="SERVER_CONNECTION_LOST",t.SRC_TOKEN_EXPIRED="SRC_TOKEN_EXPIRED",t.DEST_TOKEN_EXPIRED="DEST_TOKEN_EXPIRED",t}({}),zn=function(t){return t.High="high",t.Low="low",t.Audio="audio",t.Screen="screen",t.ScreenLow="screen_low",t}({}),es=function(t){return t.DISCONNECT="disconnect",t.CONNECTION_STATE_CHANGE="connection-state-change",t.NETWORK_QUALITY="network-quality",t.STREAM_TYPE_CHANGE="stream-type-change",t.IS_P2P_DISCONNECTED="is-p2p-dis",t.DISCONNECT_P2P="dis-p2p",t.REQUEST_NEW_GATEWAY_LIST="req-gate-url",t.NEED_RENEW_SESSION="need-sid",t.REQUEST_P2P_CONNECTION_PARAMS="request-p2p-connection-params",t.JOIN_RESPONSE="join-response",t.RESET_CONNECTION_EVENTS="reset-connection-events",t.PRE_CONNECT_PC="pre-connect_pc",t.UPDATE_GATEWAY_CONFIG="update-gateway-config",t}({}),fP=function(t){return t.P2P_DISCONNECTED="P2P_DISCONNECTED",t.A_ROUND_WS_FAILED="A_ROUND_WS_FAILED",t.TIMEOUT="TIMEOUT",t.UNKNOWN_REASON="UNKNOWN_REASON",t}({}),Hi=function(t){return t[t.Nothing=0]="Nothing",t[t.Audio=1]="Audio",t[t.LwoVideo=2]="LwoVideo",t[t.Video=4]="Video",t[t.Data=8]="Data",t[t.DataStream0=256]="DataStream0",t[t.DataStream1=512]="DataStream1",t[t.DataStream2=1024]="DataStream2",t[t.DataStream3=2048]="DataStream3",t[t.DataStream4=4096]="DataStream4",t[t.DataStream5=8192]="DataStream5",t[t.DataStream6=16384]="DataStream6",t[t.DataStream7=32768]="DataStream7",t}({}),Vn=function(t){return t.CHINA="CHINA",t.ASIA="ASIA",t.NORTH_AMERICA="NORTH_AMERICA",t.EUROPE="EUROPE",t.JAPAN="JAPAN",t.INDIA="INDIA",t.KOREA="KOREA",t.HKMC="HKMC",t.US="US",t.OCEANIA="OCEANIA",t.SOUTH_AMERICA="SOUTH_AMERICA",t.AFRICA="AFRICA",t.OVERSEA="OVERSEA",t.GLOBAL="GLOBAL",t.EXTENSIONS="EXTENSIONS",t}({});const zG=[Vn.AFRICA,Vn.ASIA,Vn.CHINA,Vn.EUROPE,Vn.GLOBAL,Vn.INDIA,Vn.JAPAN,Vn.NORTH_AMERICA,Vn.OCEANIA,Vn.OVERSEA,Vn.SOUTH_AMERICA];let Ns=function(t){return t.CHINA="CN",t.ASIA="AS",t.NORTH_AMERICA="NA",t.EUROPE="EU",t.JAPAN="JP",t.INDIA="IN",t.KOREA="KR",t.HKMC="HK",t.US="US",t.OCEANIA="OC",t.SOUTH_AMERICA="SA",t.AFRICA="AF",t.OVERSEA="OVERSEA",t.GLOBAL="GLOBAL",t.EXTENSIONS="GLOBAL",t}({});const pP={CHINA:{},ASIA:{CODE:Ns.ASIA,WEBCS_DOMAIN:["ap-web-1-asia.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-asia.agora.io"],PROXY_CS:["proxy-ap-web-asia.agora.io"],CDS_AP:["cds-ap-web-asia.agora.io","cds-ap-web-asia2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-asia.agora.io","sua-ap-web-asia2.agora.io"],UAP_AP:["uap-ap-web-asia.agora.io","uap-ap-web-asia2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-asia.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-asia.agora.io"],LOG_UPLOAD_SERVER:["logservice-asia.agora.io"],PROXY_SERVER_TYPE3:["southeast-asia.webrtc-cloud-proxy.sd-rtn.com"]},NORTH_AMERICA:{CODE:Ns.NORTH_AMERICA,WEBCS_DOMAIN:["ap-web-1-north-america.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-north-america.agora.io"],PROXY_CS:["proxy-ap-web-america.agora.io"],CDS_AP:["cds-ap-web-america.agora.io","cds-ap-web-america2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-america.agora.io","sua-ap-web-america2.agora.io"],UAP_AP:["uap-ap-web-america.agora.io","uap-ap-web-america2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-north-america.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-north-america.agora.io"],LOG_UPLOAD_SERVER:["logservice-north-america.agora.io"],PROXY_SERVER_TYPE3:["east-usa.webrtc-cloud-proxy.sd-rtn.com"]},EUROPE:{CODE:Ns.EUROPE,WEBCS_DOMAIN:["ap-web-1-europe.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-europe.agora.io"],PROXY_CS:["proxy-ap-web-europe.agora.io"],CDS_AP:["cds-ap-web-europe.agora.io","cds-ap-web-europe2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-europe.agora.io","sua-ap-web-europe.agora.io"],UAP_AP:["uap-ap-web-europe.agora.io","uap-ap-web-europe2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-europe.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-europe.agora.io"],LOG_UPLOAD_SERVER:["logservice-europe.agora.io"],PROXY_SERVER_TYPE3:["europe.webrtc-cloud-proxy.sd-rtn.com"]},JAPAN:{CODE:Ns.JAPAN,WEBCS_DOMAIN:["ap-web-1-japan.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-japan.agora.io"],PROXY_CS:["proxy-ap-web-japan.agora.io"],CDS_AP:["cds-ap-web-japan.agora.io","cds-ap-web-japan2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-japan.agora.io","sua-ap-web-japan2.agora.io"],UAP_AP:["uap-ap-web-japan.agora.io","uap-ap-web-japan2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-japan.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-japan.agora.io"],LOG_UPLOAD_SERVER:["logservice-japan.agora.io"],PROXY_SERVER_TYPE3:["japan.webrtc-cloud-proxy.sd-rtn.com"]},INDIA:{CODE:Ns.INDIA,WEBCS_DOMAIN:["ap-web-1-india.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-india.agora.io"],PROXY_CS:["proxy-ap-web-india.agora.io"],CDS_AP:["cds-ap-web-india.agora.io","cds-ap-web-india2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-india.agora.io","sua-ap-web-india2.agora.io"],UAP_AP:["uap-ap-web-india.agora.io","uap-ap-web-india2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-india.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-india.agora.io"],LOG_UPLOAD_SERVER:["logservice-india.agora.io"],PROXY_SERVER_TYPE3:["india.webrtc-cloud-proxy.sd-rtn.com"]},KOREA:{CODE:Ns.KOREA,WEBCS_DOMAIN:["ap-web-1-korea.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-korea.agora.io"],PROXY_CS:["proxy-ap-web-korea.agora.io"],CDS_AP:["cds-ap-web-korea.agora.io","cds-ap-web-korea2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-korea.agora.io","sua-ap-web-korea2.agora.io"],UAP_AP:["uap-ap-web-korea.agora.io","uap-ap-web-korea2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-korea.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-korea.agora.io"],LOG_UPLOAD_SERVER:["logservice-korea.agora.io"],PROXY_SERVER_TYPE3:["korea.webrtc-cloud-proxy.sd-rtn.com"]},HKMC:{CODE:Ns.HKMC,WEBCS_DOMAIN:["ap-web-1-hkmc.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-hkmc.agora.io"],PROXY_CS:["proxy-ap-web-hkmc.agora.io"],CDS_AP:["cds-ap-web-hkmc.agora.io","cds-ap-web-hkmc2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-hkmc.agora.io","sua-ap-web-hkmc2.agora.io"],UAP_AP:["uap-ap-web-hkmc.agora.io","uap-ap-web-hkmc2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-hkmc.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-hkmc.agora.io"],LOG_UPLOAD_SERVER:["logservice-hkmc.agora.io"],PROXY_SERVER_TYPE3:["hkmc.webrtc-cloud-proxy.sd-rtn.com"]},US:{CODE:Ns.US,WEBCS_DOMAIN:["ap-web-1-us.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-us.agora.io"],PROXY_CS:["proxy-ap-web-us.agora.io"],CDS_AP:["cds-ap-web-us.agora.io","cds-ap-web-us2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-us.agora.io","sua-ap-web-us2.agora.io"],UAP_AP:["uap-ap-web-us.agora.io","uap-ap-web-us2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-us.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-us.agora.io"],LOG_UPLOAD_SERVER:["logservice-us.agora.io"],PROXY_SERVER_TYPE3:["us.webrtc-cloud-proxy.sd-rtn.com"]},OVERSEA:{CODE:Ns.OVERSEA,WEBCS_DOMAIN:["ap-web-1-oversea.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-oversea.agora.io"],PROXY_CS:["proxy-ap-web-oversea.agora.io"],CDS_AP:["cds-ap-web-oversea.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-oversea.agora.io"],UAP_AP:["uap-ap-web-oversea.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-oversea.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-oversea.agora.io"],LOG_UPLOAD_SERVER:["logservice-oversea.agora.io"],PROXY_SERVER_TYPE3:["webrtc-cloud-proxy.agora.io"]},GLOBAL:{CODE:Ns.GLOBAL,WEBCS_DOMAIN:["webrtc2-ap-web-1.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["webrtc2-ap-web-3.agora.io"],PROXY_CS:["ap-proxy-1.agora.io","ap-proxy-2.agora.io"],CDS_AP:["cds-ap-web-1.agora.io","cds-ap-web-3.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-1.agora.io","sua-ap-web-3.agora.io"],UAP_AP:["uap-ap-web-1.agora.io","uap-ap-web-3.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2.agora.io"],LOG_UPLOAD_SERVER:["logservice.agora.io"],PROXY_SERVER_TYPE3:["webrtc-cloud-proxy.sd-rtn.com"]},OCEANIA:{CODE:Ns.OCEANIA,WEBCS_DOMAIN:["ap-web-1-oceania.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-oceania.agora.io"],PROXY_CS:["proxy-ap-web-oceania.agora.io"],CDS_AP:["cds-ap-web-oceania.agora.io","cds-ap-web-oceania2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-oceania.agora.io","sua-ap-web-oceania2.agora.io"],UAP_AP:["uap-ap-web-oceania.agora.io","uap-ap-web-oceania2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-oceania.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-oceania.agora.io"],LOG_UPLOAD_SERVER:["logservice-oceania.agora.io"],PROXY_SERVER_TYPE3:["oceania.webrtc-cloud-proxy.sd-rtn.com"]},SOUTH_AMERICA:{CODE:Ns.SOUTH_AMERICA,WEBCS_DOMAIN:["ap-web-1-south-america.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-south-america.agora.io"],PROXY_CS:["proxy-ap-web-south-america.agora.io"],CDS_AP:["cds-ap-web-south-america.agora.io","cds-ap-web-south-america2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-south-america.agora.io","sua-ap-web-south-america2.agora.io"],UAP_AP:["uap-ap-web-south-america.agora.io","uap-ap-web-south-america2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-south-america.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-south-america.agora.io"],LOG_UPLOAD_SERVER:["logservice-south-america.agora.io"],PROXY_SERVER_TYPE3:["south-america.webrtc-cloud-proxy.sd-rtn.com"]},AFRICA:{CODE:Ns.AFRICA,WEBCS_DOMAIN:["ap-web-1-africa.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-africa.agora.io"],PROXY_CS:["proxy-ap-web-africa.agora.io"],CDS_AP:["cds-ap-web-africa.agora.io","cds-ap-web-africa2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-africa.agora.io","sua-ap-web-africa2.agora.io"],UAP_AP:["uap-ap-web-africa.agora.io","uap-ap-web-africa2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-africa.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-africa.agora.io"],LOG_UPLOAD_SERVER:["logservice-south-africa.agora.io"],PROXY_SERVER_TYPE3:["africa.webrtc-cloud-proxy.sd-rtn.com"]},EXTENSIONS:{}};ix&&(pP.CHINA={CODE:Ns.CHINA,WEBCS_DOMAIN:["webrtc2-2.ap.sd-rtn.com"],WEBCS_DOMAIN_BACKUP_LIST:["webrtc2-4.ap.sd-rtn.com"],PROXY_CS:["proxy-web.ap.sd-rtn.com"],CDS_AP:["cds-web-2.ap.sd-rtn.com","cds-web-4.ap.sd-rtn.com"],ACCOUNT_REGISTER:["sua-web-2.ap.sd-rtn.com","sua-web-4.ap.sd-rtn.com"],UAP_AP:["uap-web-2.ap.sd-rtn.com","uap-web-4.ap.sd-rtn.com"],EVENT_REPORT_DOMAIN:["web-3.statscollector.sd-rtn.com"],EVENT_REPORT_BACKUP_DOMAIN:["web-4.statscollector.sd-rtn.com"],LOG_UPLOAD_SERVER:["logservice-china.agora.io"],PROXY_SERVER_TYPE3:["east-cn.webrtc-cloud-proxy.sd-rtn.com"]});let RT=function(t){return t.UPDATE_BITRATE_LIMIT="update_bitrate_limit",t.UPDATE_CLIENT_ROLE_OPTIONS="update_client_role_options",t}({});function GG(t){return!!t&&!(!t.uplink||!t.id)&&t.uplink.max_bitrate!==void 0&&t.uplink.min_bitrate!==void 0}class HG extends Pr{constructor(r,s){super(),$(this,"onICEConnectionStateChange",void 0),$(this,"onConnectionStateChange",void 0),$(this,"onDTLSTransportStateChange",void 0),$(this,"onDTLSTransportError",void 0),$(this,"onICETransportStateChange",void 0),$(this,"onFirstAudioReceived",void 0),$(this,"onFirstVideoReceived",void 0),$(this,"onFirstAudioDecoded",void 0),$(this,"onFirstVideoDecoded",void 0),$(this,"onFirstVideoDecodedTimeout",void 0),$(this,"onSelectedLocalCandidateChanged",void 0),$(this,"onSelectedRemoteCandidateChanged",void 0),$(this,"onICECandidateError",void 0),$(this,"getLocalVideoStats",void 0)}}class $G extends HG{constructor(r,s){super(r,s),$(this,"establishPromise",void 0)}}let gt=function(t){return t.VIDEO="video",t.AUDIO="audio",t}({}),Ds=function(t){return t.UDP_RELAY="udp_relay",t.UDP_TCP_RELAY="udp_tcp_relay",t.TCP_RELAY="tcp_relay",t.RELAY="relay",t}({}),ep=function(t){return t[t.FIRST_CONNECTION=0]="FIRST_CONNECTION",t[t.UDP_TCP_RESTART=1]="UDP_TCP_RESTART",t[t.RELAY_RESTART=2]="RELAY_RESTART",t[t.TCP_RESTART=3]="TCP_RESTART",t[t.OLD_FIRST_CONNECTION=10]="OLD_FIRST_CONNECTION",t[t.OLD_RESTART=11]="OLD_RESTART",t[t.DISCONNECTED_OR_FAILED=20]="DISCONNECTED_OR_FAILED",t}({});const KG=["disconnected","failed"];let $e=function(t){return t.LocalVideoTrack="videoTrack",t.LocalAudioTrack="audioTrack",t.LocalVideoLowTrack="videoLowTrack",t}({}),Wn=function(t){return t.New="new",t.Connected="connected",t.Reconnecting="reconnecting",t.Disconnected="disconnected",t}({}),kt=function(t){return t.AudioMetadata="audioMetadata",t.StateChange="stateChange",t.IceConnectionStateChange="iceConnectionStateChange",t.RequestMuteLocal="requestMuteLocal",t.RequestUnmuteLocal="requestUnmuteLocal",t.RequestRePublish="requestRePublish",t.RequestRePublishDataChannel="requestRePublishDataChannel",t.RequestReSubscribe="requestReSubscribe",t.RequestUploadStats="requestUploadStats",t.RequestUpload="requestUpload",t.MediaReconnectStart="MediaReconnectStart",t.MediaReconnectEnd="MediaReconnectEnd",t.NeedSignalRTT="NeedSignalRTT",t.RequestRestartICE="RequestRestartIce",t.PeerConnectionStateChange="PeerConnectionStateChange",t.RequestReconnect="RequestReconnect",t.RequestReconnectPC="RequestReconnectPC",t.RequestUnpublishForReconnectPC="RequestUnpublishForReconnectPC",t.P2PLost="P2PLost",t.UpdateVideoEncoder="UpdateVideoEncoder",t.ConnectionTypeChange="ConnectionTypeChange",t.RequestLowStreamParameter="RequestLowStreamParameter",t.QueryClientConnectionState="QueryClientConnectionState",t.LocalCandidate="LocalCandidate",t.RequestP2PMuteLocal="requestP2PMuteLocal",t.RequestP2PUnPublish="RequestP2PUnPublish",t.RequestP2PUnmuteRemote="RequestP2PUnmuteRemote",t.RequestP2PMuteRemote="RequestP2PMuteRemote",t.RequestP2PRestartICE="RequestP2PRestartICE",t}({}),fu=function(t){return t.CONNECTING="CONNECTING",t.RECONNECTING="RECONNECTING",t.CONNECTED="CONNECTED",t.CLOSED="CLOSED",t}({}),pu=function(t){return t[t.CONNECT_AP=0]="CONNECT_AP",t[t.AP_CONNECTED=1]="AP_CONNECTED",t[t.CONNECT_WORKER_MANAGER=2]="CONNECT_WORKER_MANAGER",t[t.WORKER_MANAGER_CONNECTED=3]="WORKER_MANAGER_CONNECTED",t[t.GET_WORKER_MANAGER_RESPONSE=4]="GET_WORKER_MANAGER_RESPONSE",t[t.CONNECT_WORKER=5]="CONNECT_WORKER",t[t.WORKER_CONNECTED=6]="WORKER_CONNECTED",t[t.CLOSED=7]="CLOSED",t}({}),ts=function(t){return t.CONNECTION_STATE_CHANGE="connection-state-change",t.STATE_CHANGE="state-change",t.INSPECT_RESULT="inspect-result",t.CLIENT_LOCAL_VIDEO_TRACK="client-local-video-track",t.REQUEST_NEW_WORKER_URL="request-new-worker-url",t}({}),qG=function(t){return t.CONNECTED="transmitter:connected",t.RECONNECTING="transmitter:reconnecting",t.WILL_RECONNECT="transmitter:will_reconnect",t.CLOSED="transmitter:closed",t.FAILED="transmitter:failed",t.ON_MESSAGE="transmitter:on_message",t.REQUEST_NEW_URLS="transmitter:request_new_urls",t.RECONNECT_CREATE_CONNECTION="transmitter:reconnect_create_connection",t.ON_TOKEN_PRIVILEGE_DID_EXPIRE="transmitter:on_token_privilege_did_expire",t.TO_CONNECT_DATACHANNEL="transmitter:to_connect_datachannel",t.FAILBACK="transmitter:failback",t.PRE_CONNECT_PC="transmitter:pre_connect_pc",t}({}),Sh=function(t){return t.CAMERA_CHANGED="camera-changed",t.MICROPHONE_CHANGED="microphone-changed",t.PLAYBACK_DEVICE_CHANGED="playback-device-changed",t.AUDIO_AUTOPLAY_FAILED="audio-autoplay-failed",t.AUTOPLAY_FAILED="autoplay-failed",t.AUDIO_CONTEXT_STATE_CHANGED="audio-context-state-changed",t.SECURITY_POLICY_VIOLATION="security-policy-violation",t}({}),Sl=function(t){return t.CONNECTING="CONNECTING",t.RECONNECTING="RECONNECTING",t.CONNECTED="CONNECTED",t.CLOSED="CLOSED",t}({}),yd=function(t){return t.CONNECTION_STATE_CHANGE="connection-state-change",t.STATE_CHANGE="state-change",t.INSPECT_RESULT="inspect-result",t.CLIENT_LOCAL_VIDEO_TRACK="client-local-video-track",t.REQUEST_NEW_WORKER_URL="request-new-worker-url",t}({}),Yv=function(t){return t[t.CONNECT_AP=0]="CONNECT_AP",t[t.AP_CONNECTED=1]="AP_CONNECTED",t[t.CONNECT_WORKER_MANAGER=2]="CONNECT_WORKER_MANAGER",t[t.WORKER_MANAGER_CONNECTED=3]="WORKER_MANAGER_CONNECTED",t[t.GET_WORKER_MANAGER_RESPONSE=4]="GET_WORKER_MANAGER_RESPONSE",t[t.CONNECT_WORKER=5]="CONNECT_WORKER",t[t.WORKER_CONNECTED=6]="WORKER_CONNECTED",t[t.CLOSED=7]="CLOSED",t}({}),Zr=function(t){return t.CALL="call",t.CANDIDATE="candidate",t.PUBLISH="publish",t.UNPUBLISH="unpublish",t.CONTROL="control",t.RESTART_ICE="restart_ice",t.ACK="ack",t.RESPONSE="response",t.JOIN="join",t.CHECK="check",t}({}),Xv=function(t){return t.ABORT="abort",t}({}),km=function(t){return t.MUTE_LOCAL_AUDIO="mute_local_audio",t.MUTE_LOCAL_VIDEO="mute_local_video",t.UNMUTE_LOCAL_AUDIO="unmute_local_audio",t.UNMUTE_LOCAL_VIDEO="unmute_local_video",t}({}),fme=function(t){return t.P2P_TOKEN_TIMEOUT="p2p_token_timeout",t.P2P_TOKEN_CHANGED="p2p_token_changed",t}({});const pme={[uP.ACCESS_POINT]:{[bo.NO_FLAG_SET]:{desc:"flag is zero",retry:!1},[bo.FLAG_SET_BUT_EMPTY]:{desc:"flag is empty",retry:!1},[bo.INVALID_FALG_SET]:{desc:"invalid flag",retry:!1},[bo.FLAG_SET_BUT_NO_RE]:{desc:"flag set unilbs but no request",retry:!1},[bo.INVALID_SERVICE_ID]:{desc:"invalid service id",retry:!1},[bo.NO_SERVICE_AVAILABLE]:{desc:"no service available",retry:!0},[bo.NO_SERVICE_AVAILABLE_P2P]:{desc:"no unilbs p2p service available",retry:!0},[bo.NO_SERVICE_AVAILABLE_VOICE]:{desc:"no unilbs voice service available",retry:!0},[bo.NO_SERVICE_AVAILABLE_WEBRTC]:{desc:"no unilbs webrtc service available",retry:!0},[bo.NO_SERVICE_AVAILABLE_CDS]:{desc:"no cds service available",retry:!0},[bo.NO_SERVICE_AVAILABLE_CDN]:{desc:"no cdn dispatcher service available",retry:!0},[bo.NO_SERVICE_AVAILABLE_TDS]:{desc:"no tds service available",retry:!0},[bo.NO_SERVICE_AVAILABLE_REPORT]:{desc:"no unilbs report service available",retry:!0},[bo.NO_SERVICE_AVAILABLE_APP_CENTER]:{desc:"no app center service available",retry:!0},[bo.NO_SERVICE_AVAILABLE_ENV0]:{desc:"no unilbs sig env0 service available",retry:!0},[bo.NO_SERVICE_AVAILABLE_VOET]:{desc:"no unilbs voet service available",retry:!0},[bo.NO_SERVICE_AVAILABLE_STRING_UID]:{desc:"no string uid service available",retry:!0},[bo.NO_SERVICE_AVAILABLE_WEBRTC_UNILBS]:{desc:"no webrtc unilbs service available",retry:!0}},[uP.UNILBS]:{[hu.INVALID_VENDOR_KEY]:{desc:"invalid vendor key, can not find appid",retry:!1},[hu.INVALID_CHANNEL_NAME]:{desc:"invalid channel name",retry:!1},[hu.INTERNAL_ERROR]:{desc:"unilbs internal error",retry:!1},[hu.NO_AUTHORIZED]:{desc:"invalid token, authorized failed",retry:!1},[hu.DYNAMIC_KEY_TIMEOUT]:{desc:"dynamic key or token timeout",retry:!1},[hu.NO_ACTIVE_STATUS]:{desc:"no active status",retry:!1},[hu.DYNAMIC_KEY_EXPIRED]:{desc:"dynamic key expired",retry:!1},[hu.STATIC_USE_DYNAMIC_KEY]:{desc:"static use dynamic key",retry:!1},[hu.DYNAMIC_USE_STATIC_KEY]:{desc:"dynamic use static key",retry:!1},[hu.USER_OVERLOAD]:{desc:"amount of users over load",retry:!1},[hu.FORBIDDEN_REGION]:{desc:"the request is forbidden in this area",retry:!1},[hu.CANNOT_MEET_AREA_DEMAND]:{desc:"unable to allocate services in this area",retry:!1}},[uP.STRING_UID_ALLOCATOR]:{[Lx.IIIEGAL_APPID]:{desc:"invalid appid",retry:!1},[Lx.IIIEGAL_UID]:{desc:"invalid string uid",retry:!1},[Lx.INTERNAL_ERROR]:{desc:"string uid allocator internal error",retry:!0}}};function Jv(t){const r=pme[Math.floor(t/1e4)];if(!r)return{desc:"unknown error",retry:!1};const s=r[t%1e4];if(!s){if(Math.floor(t/1e4)===uP.ACCESS_POINT){const o=t%1e4;if(o.toString()[0]==="1")return{desc:t.toString(),retry:!1};if(o.toString()[0]==="2")return{desc:t.toString(),retry:!0}}return{desc:"unknown error",retry:!1}}return s}const mme={[Lt.K_TIMESTAMP_EXPIRED]:{desc:"K_TIMESTAMP_EXPIRED",action:"failed"},[Lt.K_CHANNEL_PERMISSION_INVALID]:{desc:"K_CHANNEL_PERMISSION_INVALID",action:"failed"},[Lt.K_CERTIFICATE_INVALID]:{desc:"K_CERTIFICATE_INVALID",action:"failed"},[Lt.K_CHANNEL_NAME_EMPTY]:{desc:"K_CHANNEL_NAME_EMPTY",action:"failed"},[Lt.K_CHANNEL_NOT_FOUND]:{desc:"K_CHANNEL_NOT_FOUND",action:"failed"},[Lt.K_TICKET_INVALID]:{desc:"K_TICKET_INVALID",action:"failed"},[Lt.K_CHANNEL_CONFLICTED]:{desc:"K_CHANNEL_CONFLICTED",action:"failed"},[Lt.K_SERVICE_NOT_READY]:{desc:"K_SERVICE_NOT_READY",action:"tryNext"},[Lt.K_SERVICE_TOO_HEAVY]:{desc:"K_SERVICE_TOO_HEAVY",action:"tryNext"},[Lt.K_UID_BANNED]:{desc:"K_UID_BANNED",action:"failed"},[Lt.K_IP_BANNED]:{desc:"K_IP_BANNED",action:"failed"},[Lt.DATASTREAM2_NOT_AVAILABLE]:{desc:"DATASTREAM2_NOT_AVAILABLE",action:"quit"},[Lt.K_AUTO_REBALANCE]:{desc:"k_AUTO_REBALANCE",action:"recover"},[Lt.ERR_INVALID_VENDOR_KEY]:{desc:"ERR_INVALID_VENDOR_KEY",action:"failed"},[Lt.ERR_INVALID_CHANNEL_NAME]:{desc:"ERR_INVALID_CHANNEL_NAME",action:"failed"},[Lt.WARN_NO_AVAILABLE_CHANNEL]:{desc:"WARN_NO_AVAILABLE_CHANNEL",action:"failed"},[Lt.WARN_LOOKUP_CHANNEL_TIMEOUT]:{desc:"WARN_LOOKUP_CHANNEL_TIMEOUT",action:"tryNext"},[Lt.WARN_LOOKUP_CHANNEL_REJECTED]:{desc:"WARN_LOOKUP_CHANNEL_REJECTED",action:"failed"},[Lt.WARN_OPEN_CHANNEL_TIMEOUT]:{desc:"WARN_OPEN_CHANNEL_TIMEOUT",action:"tryNext"},[Lt.WARN_OPEN_CHANNEL_REJECTED]:{desc:"WARN_OPEN_CHANNEL_REJECTED",action:"failed"},[Lt.WARN_REQUEST_DEFERRED]:{desc:"WARN_REQUEST_DEFERRED",action:"failed"},[Lt.ERR_DYNAMIC_KEY_TIMEOUT]:{desc:"ERR_DYNAMIC_KEY_TIMEOUT",action:"failed"},[Lt.ERR_NO_AUTHORIZED]:{desc:"ERR_NO_AUTHORIZED",action:"failed"},[Lt.ERR_VOM_SERVICE_UNAVAILABLE]:{desc:"ERR_VOM_SERVICE_UNAVAILABLE",action:"tryNext"},[Lt.ERR_NO_CHANNEL_AVAILABLE_CODE]:{desc:"ERR_NO_CHANNEL_AVAILABLE_CODE",action:"failed"},[Lt.ERR_MASTER_VOCS_UNAVAILABLE]:{desc:"ERR_MASTER_VOCS_UNAVAILABLE",action:"tryNext"},[Lt.ERR_INTERNAL_ERROR]:{desc:"ERR_INTERNAL_ERROR",action:"tryNext"},[Lt.ERR_NO_ACTIVE_STATUS]:{desc:"ERR_NO_ACTIVE_STATUS",action:"failed"},[Lt.ERR_INVALID_UID]:{desc:"ERR_INVALID_UID",action:"failed"},[Lt.ERR_DYNAMIC_KEY_EXPIRED]:{desc:"ERR_DYNAMIC_KEY_EXPIRED",action:"failed"},[Lt.ERR_STATIC_USE_DYANMIC_KE]:{desc:"ERR_STATIC_USE_DYANMIC_KE",action:"failed"},[Lt.ERR_DYNAMIC_USE_STATIC_KE]:{desc:"ERR_DYNAMIC_USE_STATIC_KE",action:"failed"},[Lt.ERR_NO_VOCS_AVAILABLE]:{desc:"ERR_NO_VOCS_AVAILABLE",action:"tryNext"},[Lt.ERR_NO_VOS_AVAILABLE]:{desc:"ERR_NO_VOS_AVAILABLE",action:"tryNext"},[Lt.ERR_JOIN_CHANNEL_TIMEOUT]:{desc:"ERR_JOIN_CHANNEL_TIMEOUT",action:"tryNext"},[Lt.ERR_JOIN_BY_MULTI_IP]:{desc:"ERR_JOIN_BY_MULTI_IP",action:"recover"},[Lt.ERR_NOT_JOINED]:{desc:"ERR_NOT_JOINED",action:"failed"},[Lt.ERR_REPEAT_JOIN_REQUEST]:{desc:"ERR_REPEAT_JOIN_REQUEST",action:"quit"},[Lt.ERR_REPEAT_JOIN_CHANNEL]:{desc:"ERR_REPEAT_JOIN_CHANNEL",action:"quit"},[Lt.ERR_INVALID_STRINGUID]:{desc:"ERR_INVALID_STRINGUID",action:"failed"},[Lt.ERR_TOO_MANY_USERS]:{desc:"ERR_TOO_MANY_USERS",action:"tryNext"},[Lt.ERR_SET_CLIENT_ROLE_TIMEOUT]:{desc:"ERR_SET_CLIENT_ROLE_TIMEOUT",action:"failed"},[Lt.ERR_SET_CLIENT_ROLE_NO_PERMISSION]:{desc:"ERR_SET_CLIENT_ROLE_TIMEOUT",action:"failed"},[Lt.ERR_SET_CLIENT_ROLE_ALREADY_IN_USE]:{desc:"ERR_SET_CLIENT_ROLE_ALREADY_IN_USE",action:"success"},[Lt.ERR_PUBLISH_REQUEST_INVALID]:{desc:"ERR_PUBLISH_REQUEST_INVALID",action:"failed"},[Lt.ERR_SUBSCRIBE_REQUEST_INVALID]:{desc:"ERR_SUBSCRIBE_REQUEST_INVALID",action:"failed"},[Lt.ERR_NOT_SUPPORTED_MESSAGE]:{desc:"ERR_NOT_SUPPORTED_MESSAGE",action:"failed"},[Lt.ERR_ILLEAGAL_PLUGIN]:{desc:"ERR_ILLEAGAL_PLUGIN",action:"failed"},[Lt.ILLEGAL_CLIENT_ROLE_LEVEL]:{desc:"ILLEGAL_CLIENT_ROLE_LEVEL",action:"failed"},[Lt.ERR_REJOIN_TOKEN_INVALID]:{desc:"ERR_REJOIN_TOKEN_INVALID",action:"failed"},[Lt.ERR_REJOIN_USER_NOT_JOINED]:{desc:"ERR_REJOIN_NOT_JOINED",action:"failed"},[Lt.ERR_INVALID_OPTIONAL_INFO]:{desc:"ERR_INVALID_OPTIONAL_INFO",action:"quit"},[Lt.ERR_TEST_RECOVER]:{desc:"ERR_TEST_RECOVER",action:"recover"},[Lt.ERR_TEST_TRYNEXT]:{desc:"ERR_TEST_TRYNEXT",action:"recover"},[Lt.ERR_TEST_RETRY]:{desc:"ERR_TEST_RETRY",action:"recover"},[Lt.ILLEGAL_AES_PASSWORD]:{desc:"ERR_TEST_RETRY",action:"failed"},[Lt.ERR_TOO_MANY_BROADCASTERS]:{desc:"ERR_TOO_MANY_BROADCASTERS",action:"failed"},[Lt.ERR_TOO_MANY_SUBSCRIBERS]:{desc:"ERR_TOO_MANY_SUBSCRIBERS",action:"failed"},[Lt.ERR_LICENSE_ILLEGAL]:{desc:"ERR_LICENSE_ILLEGAL",action:"quit"},[Lt.ERR_LICENSE_MISSING]:{desc:"ERR_LICENSE_MISSING",action:"quit"},[Lt.ERR_LICENSE_EXPIRED]:{desc:"ERR_LICENSE_EXPIRED",action:"quit"},[Lt.ERR_LICENSE_MINUTES_EXCEEDED]:{desc:"ERR_LICENSE_MINUTES_EXCEEDED",action:"quit"},[Lt.ERR_LICENSE_PERIOD_INVALID]:{desc:"ERR_LICENSE_PERIOD_INVALID",action:"quit"},[Lt.ERR_LICENSE_MULTIPLE_SDK_SERVICE]:{desc:"ERR_LICENSE_MULTIPLE_SDK_SERVICE",action:"quit"}};function CT(t){return mme[t]||{desc:"UNKNOWN_ERROR_".concat(t),action:"failed"}}function YG(t,r){var s=Object.keys(t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);r&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(t,c).enumerable})),s.push.apply(s,o)}return s}function Vx(t){for(var r=1;r<arguments.length;r++){var s=arguments[r]!=null?arguments[r]:{};r%2?YG(Object(s),!0).forEach(function(o){$(t,o,s[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(s)):YG(Object(s)).forEach(function(o){Object.defineProperty(t,o,Object.getOwnPropertyDescriptor(s,o))})}return t}function XG(t,r){if(typeof t=="string")return t;const{proxy:s,host:o,port:c}=t;if(r){const u=re("JOIN_GATEWAY_FALLBACK_PORT")||443;return u===443?"wss://".concat(o,"/ws/?p=").concat(Number(c)+150):"wss://".concat(o,":").concat(u,"/ws/?p=").concat(Number(c)+150)}return s?"wss://".concat(s,"/ws/?h=").concat(o,"&p=").concat(c):"wss://".concat(o,":").concat(c)}const gme=/wss:\/\/(.+)\/ws\/\?h=(.+)&p=([0-9]+)\/?/,_me=/wss:\/\/(.+)\/ws\/\?p=([0-9]+)\/?/,yme=/wss:\/\/(.+):([0-9]+)\/?/,Eme=/wss:\/\/(.[^\/]+)\/?/;let vme=0;class Sme{constructor(r,s){$(this,"id",0),$(this,"store",void 0),$(this,"recordIndex",void 0),$(this,"websockets",[]),$(this,"try443PortDuration",2e3),$(this,"forceCloseWSDuration",5e3),$(this,"try443PortTimeout",null),$(this,"forceCloseTimeout",null),$(this,"isTry443PortFailed",!1),$(this,"isNormalPortFailed",!1),$(this,"useDoubleDomain",!1),$(this,"useProxy",!1),$(this,"startTime",Date.now()),this.id=++vme,this.try443PortDuration=re("JOIN_GATEWAY_TRY_443PORT_DURATION")||2e3,this.forceCloseWSDuration=r||5e3,this.store=s}closeAllWebsockets(){this.websockets.forEach(r=>{r.onopen=null,r.onclose=null,r.onmessage=null,r.close()}),this.websockets.length=0}clearTimeout(){this.forceCloseTimeout&&clearTimeout(this.forceCloseTimeout),this.try443PortTimeout&&clearTimeout(this.try443PortTimeout),this.forceCloseTimeout=null,this.try443PortTimeout=null}logger(){var r;const s=Date.now()-this.startTime;for(var o=arguments.length,c=new Array(o),u=0;u<o;u++)c[u]=arguments[u];L.debug("[choose-best-ws ".concat((r=this.store)===null||r===void 0?void 0:r.clientId," ").concat(this.id,"] ").concat(s,"ms:"),...c)}createWebSocket(r,s,o){this.logger("createWebSocket:",r,{isTry443Port:s,hasTimeoutDetection:o});const c=re("GATEWAY_DOMAINS"),u=Date.now(),h=[],m=c.find(P=>{var k;return ot(k=r.host).call(k,P)});m||(this.useDoubleDomain=!1);const _=[];if(this.useDoubleDomain)c.forEach(P=>{_.push(XG(Vx(Vx({},r),{},{host:r.host.replace(m,P)}),s))});else{const P=Vx({},r);if(s&&m){const k=c.find(z=>z!==m);k&&(P.host=P.host.replace(m,k))}_.push(XG(P,s))}try{_.forEach(P=>{const k=new WebSocket(P);k.binaryType="arraybuffer",h.push(k),this.logger("ws is connecting:",k.url)})}catch(P){if(this.logger("ws create failed"),h.forEach(k=>k.close()),h.length=0,this.useDoubleDomain)return this.useDoubleDomain=!1,this.createWebSocket(r,s,o);if(!s&&Number(r.port)!==443)return this.createWebSocket(r,!0,o);throw new Oe(X.WS_ERR,"init websocket failed! Error: ".concat(P.toString()))}const E=dT();this.store&&this.store.recordJoinChannelService({urls:h.map(P=>P.url),service:"gateway"},this.recordIndex),h.forEach(P=>{P.onopen=()=>{this.logger("onopen: ws ".concat(P.url," open cost ").concat(Date.now()-u,"ms")),this.websockets.forEach(k=>{k!==P&&(k.onopen=null,k.onclose=null,k.onmessage=null,k.close(),this.logger("close backup websocket: ".concat(k.url)))}),this.websockets.length=0,E.resolve(P)},P.onclose=k=>{this.logger("onclose: ws ".concat(P.url," closed cost ").concat(Date.now()-u,"ms state: ").concat(P.readyState));const z=h.every(U=>U.readyState===WebSocket.CLOSED||U.readyState===WebSocket.CLOSING);this.logger("".concat(s?"443":"47xx"," websocket closed, all failed: ").concat(z)),z&&(s||this.isTry443PortFailed||this.useProxy)?(this.logger("onclose: all websocket is closed, ".concat(k.reason)),E.reject({code:k.code,reason:fP.A_ROUND_WS_FAILED})):!s&&z&&!this.isNormalPortFailed&&this.try443PortTimeout&&(this.logger("all 47xx websocket is closed, try 443 port"),this.clearTimeout(),R()),s?this.isTry443PortFailed=z:this.isNormalPortFailed=z},P.onmessage=k=>this.logger("".concat(P.url," onmessage: ").concat(k.data))}),this.websockets.push(...h);const S=()=>{this.websockets.forEach(P=>P.readyState!==WebSocket.OPEN&&P.close())},R=()=>{if(E.isResolved)return S();Rn().os===zi.MAC_OS&&Dr()&&S(),this.createWebSocket(r,!0,!0).then(P=>{E.resolve(P)}).catch(P=>{this.isNormalPortFailed&&E.reject(P),this.logger("try 443 port to create ws failed")}),this.forceCloseTimeout=window.setTimeout(()=>{this.logger("5s timeout close un-opens, isWebsocket created: ",E.isResolved),this.forceCloseTimeout=null,S()},this.forceCloseWSDuration)};return o||(()=>{if(s||this.useProxy)return this.logger("add 5s timeout at ".concat(s?"try-443":"proxy"," condition")),this.forceCloseTimeout=window.setTimeout(()=>{this.forceCloseTimeout=null,S()},this.forceCloseWSDuration);this.try443PortTimeout=window.setTimeout(()=>{this.logger("2s timeout, isWebsocket created: ",E.isResolved),this.try443PortTimeout=null,R()},this.try443PortDuration)})(),E.promise}chooseBestWebsocket(r,s,o,c){return this.useDoubleDomain=!!s,typeof r=="string"&&(r=function(u){let h,m,_;return[,h,m,_]=u.match(gme)||[],h||([,m,_]=u.match(_me)||[]),m&&_||([,m,_]=u.match(yme)||[]),m&&_||([,m]=u.match(Eme)||[]),m||L.warning("un-destructible url: ",u),{proxy:h,host:m,port:_||"443"}}(r)),this.recordIndex=c,this.useProxy=!!r.proxy,o&&this.useProxy&&(L.warn("cannot use 443 only when use proxy"),o=!1),this.createWebSocket(r,!!o,!1).finally(()=>this.clearTimeout())}}function JG(t,r){var s=Object.keys(t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);r&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(t,c).enumerable})),s.push.apply(s,o)}return s}class QG extends Pr{get url(){return this.websocket&&this.websocket.url||null}get reconnectMode(){return this._reconnectMode}set reconnectMode(r){var s;ot(s=["tryNext","recover"]).call(s,r)&&this.resetReconnectCount(r),this._reconnectMode=r}get state(){return this._state}set state(r){r!==this._state&&(this._state=r,this._state==="reconnecting"?this.emit(Yt.RECONNECTING,this.reconnectReason):this._state==="connected"?this.emit(Yt.CONNECTED):this._state==="closed"?this.emit(Yt.CLOSED):this._state==="failed"&&this.emit(Yt.FAILED))}resetReconnectCount(r){L.debug("websocket reset reconnect count, reason: "+r),this.reconnectCount=0}constructor(r,s){let o=arguments.length>2&&arguments[2]!==void 0&&arguments[2],c=arguments.length>3&&arguments[3]!==void 0&&arguments[3],u=arguments.length>4&&arguments[4]!==void 0&&arguments[4],h=arguments.length>5?arguments[5]:void 0;super(),$(this,"connectionID",0),$(this,"currentURLIndex",0),$(this,"urls",[]),$(this,"_reconnectMode","tryNext"),$(this,"reconnectReason",void 0),$(this,"_initMutex",void 0),$(this,"name",void 0),$(this,"_state","closed"),$(this,"reconnectInterrupter",void 0),$(this,"websocket",void 0),$(this,"retryConfig",void 0),$(this,"reconnectCount",0),$(this,"forceCloseTimeout",5e3),$(this,"onlineReconnectListener",void 0),$(this,"useCompress",void 0),$(this,"tryDoubleDomain",!1),$(this,"use443PortOnly",!1),$(this,"wsInflateLength",0),$(this,"wsDeflateLength",0),$(this,"closeEstablishingWs",()=>{}),$(this,"store",void 0),$(this,"joinGatewayRecordIndex",void 0),this.store=h,this.name=r,this.retryConfig=function(R){for(var P=1;P<arguments.length;P++){var k=arguments[P]!=null?arguments[P]:{};P%2?JG(Object(k),!0).forEach(function(z){$(R,z,k[z])}):Object.getOwnPropertyDescriptors?Object.defineProperties(R,Object.getOwnPropertyDescriptors(k)):JG(Object(k)).forEach(function(z){Object.defineProperty(R,z,Object.getOwnPropertyDescriptor(k,z))})}return R}({},s),this.useCompress=o,this.tryDoubleDomain=c,this.use443PortOnly=u,this._initMutex=new ks("websocket",h?h.clientId:void 0);const{timeout:m,timeoutFactor:_}=s,E=Math.max(300,Math.floor(3*m/5)),S=Math.max(1.2,Math.floor(8*_)/10);nc.ONLINE&&(this.retryConfig.timeout=E,this.retryConfig.timeoutFactor=S),ci.on(Ov.NETWORK_STATE_CHANGE,(R,P)=>{R!==P&&(this.resetReconnectCount("network state change: ".concat(P," -> ").concat(R)),R===nc.ONLINE?(this.retryConfig.timeout=E,this.retryConfig.timeoutFactor=S):(this.retryConfig.timeout=m,this.retryConfig.timeoutFactor=_))})}getConnection(){return this.websocket||void 0}async init(r){let s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:5e3;const o=await this._initMutex.lock();this._reconnectMode="tryNext",this.forceCloseTimeout=s,this.urls=r,this.state="connecting";try{const c=dT(),u=this.urls[this.currentURLIndex];re("ENABLE_PREALLOC_PC")&&this.emit(qG.PRE_CONNECT_PC),this.createWebSocketConnection(u).then(c.resolve).catch(c.reject),this.once(Yt.CLOSED,()=>{c.reject(new Le(X.WS_DISCONNECT))}),this.once(Yt.CONNECTED,c.resolve),await c.promise}catch{}finally{o()}}close(r,s){if(this.currentURLIndex=0,this.resetReconnectCount("close"),this.reconnectInterrupter&&this.reconnectInterrupter(),this.websocket){this.websocket.onclose=null,this.websocket.onopen=null,this.websocket.onmessage=null;const o=this.websocket;s?setTimeout(()=>o.close(),500):o.close(),this.websocket=void 0}this.state=r?"failed":"closed",this.closeEstablishingWs&&this.closeEstablishingWs()}reconnect(r,s){if(!this.websocket)return void L.warning("[".concat(this.name,"] can not reconnect, no websocket"));r!==void 0&&(this.reconnectMode=r),L.debug("[".concat(this.name,"] reconnect is triggered initiative")),typeof this.joinGatewayRecordIndex=="number"&&this.store&&this.store.recordJoinChannelService({status:"error",errors:[new Error(s)]},this.joinGatewayRecordIndex);const o=this.websocket.onclose;this.websocket.onclose=null,this.websocket.close(),o&&o.bind(this.websocket)({code:9999,reason:s})}sendMessage(r){let s=arguments.length>2&&arguments[2]!==void 0&&arguments[2];if(!this.websocket||this.websocket.readyState!==WebSocket.OPEN)throw new Le(X.WS_ABORT,"websocket is not ready");try{s||(r=JSON.stringify(r)),this.websocket.send(r)}catch(o){throw new Le(X.WS_ERR,"send websocket message error"+o.toString())}}setWsInflateData(r){this.wsDeflateLength=this.wsDeflateLength+r.originLength,this.wsInflateLength=this.wsInflateLength+r.compressedLength}getWsInflateData(){const r=this.wsInflateLength,s=this.wsDeflateLength;return this.clearWsInflateData(),{wsInflateLength:r,wsDeflateLength:s}}clearWsInflateData(){this.wsInflateLength=0,this.wsDeflateLength=0}async createWebSocketConnection(r){var s;const o=dT();this.connectionID+=1,this.joinGatewayRecordIndex=void 0;const c=S=>{var R;(R=this.store)===null||R===void 0||R.signalChannelOpen(),L.debug("[".concat(this.name,"] websocket opened:"),S),this.reconnectMode="retry",this.state="connected",this.resetReconnectCount("opened"),o.resolve()},u=async S=>{var R;if(L.debug("[".concat(this.name,"] websocket close ").concat((R=this.websocket)===null||R===void 0?void 0:R.url,", code: ").concat(S.code,", reason: ").concat(S.reason,", current mode: ").concat(this.reconnectMode)),this.reconnectCount>=this.retryConfig.maxRetryCount)o.reject(new Le(X.WS_DISCONNECT,"websocket close: ".concat(S.code))),this.close();else{this.state==="connected"&&(this.reconnectReason=S.reason,this.state="reconnecting");const P=Nc(this,Yt.WILL_RECONNECT,this.reconnectMode,S.reason)||this.reconnectMode,k=await this.reconnectWithAction(P);if(this.state==="closed")return void L.debug("[".concat(this.connectionID,"] ws is closed, no need to reconnect"));if(!k)return o.reject(new Le(X.WS_DISCONNECT,"websocket reconnect failed: ".concat(S.code))),this.close(!0);o.resolve()}},h=S=>{this.emit(Yt.ON_MESSAGE,S)},m=S=>{L.warn("[".concat(this.connectionID,"] ws open error ").concat(S))};this.websocket&&(this.websocket.onclose=null,this.websocket.close()),re("GATEWAY_WSS_ADDRESS")&&this.name.startsWith("gateway")&&(r=re("GATEWAY_WSS_ADDRESS")),L.debug("[".concat(this.name,"] start connect, url:"),r);const _=(s=this.store)===null||s===void 0?void 0:s.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"gateway"});try{var E;const S=await this.chooseBestWebsocketConnection(r);this.websocket=S,c&&c(this.websocket.url),this.websocket.onclose=u,this.websocket.onmessage=h,this.websocket.onerror=m,(E=this.store)===null||E===void 0||E.recordJoinChannelService({endTs:Date.now(),status:"success"},_),this.joinGatewayRecordIndex=_}catch(S){const R=this.state==="closed",P=S instanceof Le,k=P&&S.code===X.WS_ABORT,z=P&&S.code===X.WS_ERR,U=P?S.message:S&&(S.reason||S.toString());L.warning("[choose-best-ws] chooseBestWebsocket error: ".concat(U)),this.store&&this.store.recordJoinChannelService({endTs:Date.now(),status:k?"aborted":"error",errors:[S]},_),R||z?(o.reject(R?new Le(X.WS_DISCONNECT,"websocket is closed: ".concat(U)):new Le(X.WS_ERR,"init websocket failed: ".concat(U))),z&&L.error("[".concat(this.name,"] init websocket failed: ").concat(U))):u&&u(S)}return o.promise}async reconnectWithAction(r){let s=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1];if(this.reconnectCount>=this.retryConfig.maxRetryCount||this.urls.length===0||this.state==="closed")return!1;L.warning("[choose-best-ws] action: =>",r),this.onlineReconnectListener||ci.isOnline||!ci.onlineWaiter||(this.onlineReconnectListener=ci.onlineWaiter.then(()=>{this.onlineReconnectListener=void 0}));let o=!0;if(this.reconnectInterrupter=()=>o=!1,s){const h=XL(this.reconnectCount,this.retryConfig);L.debug("[".concat(this.name,"] wait ").concat(h,"ms to reconnect websocket, mode: ").concat(r)),await lt.race([os(h),this.onlineReconnectListener||new lt(()=>{})])}if(this._state==="closed"||!o)return!1;this.reconnectCount+=1;const c=async(h,m)=>{this.emit(Yt.RECONNECT_CREATE_CONNECTION,m),await this.createWebSocketConnection(h)};try{if(r==="retry")await c(this.urls[this.currentURLIndex],r);else if(r==="tryNext"){if(this.currentURLIndex+=1,this.currentURLIndex>=this.urls.length)return this.reconnectWithAction("recover",!1);L.debug("[".concat(this.name,"] websocket url length: ").concat(this.urls.length," current index: ").concat(this.currentURLIndex)),await c(this.urls[this.currentURLIndex],r)}else r==="recover"&&(L.debug("[".concat(this.name,"] request new urls")),this.resetReconnectCount("recover mode"),this.urls=await Ts(this,Yt.REQUEST_NEW_URLS),this.currentURLIndex=0,await c(this.urls[this.currentURLIndex],r))}catch(h){var u;L.error("[".concat(this.name,"] reconnect failed ").concat(h&&h.toString()));const m=h==null||(u=h.data)===null||u===void 0?void 0:u.desc;return Array.isArray(m)&&ot(m).call(m,"dynamic key expired")?(this.emit(Yt.ON_TOKEN_PRIVILEGE_DID_EXPIRE),!1):this.reconnectWithAction(r,s)}return!0}}class Fx extends QG{constructor(r,s){super(r,s,arguments.length>2&&arguments[2]!==void 0&&arguments[2],arguments.length>3&&arguments[3]!==void 0&&arguments[3],arguments.length>4&&arguments[4]!==void 0&&arguments[4],arguments.length>5?arguments[5]:void 0)}async chooseBestWebsocketConnection(r,s){const o=dT(),c=function(h,m){return new Sme(h,m)}(this.forceCloseTimeout,this.store);this.closeEstablishingWs=()=>{L.debug("[choose-best-ws] close establishing websockets"),c.closeAllWebsockets(),o.reject(new Le(X.WS_ABORT,"choose best websocket aborted"))};const u=re("GATEWAY_DOMAINS");return L.debug("[choose-best-ws] currentDomain: ",r,", domains: ",u,"total: ".concat(this.urls.length),"current: ".concat(this.currentURLIndex+1)),c.chooseBestWebsocket(r,this.tryDoubleDomain,this.use443PortOnly,s).then(o.resolve).catch(o.reject),o.promise.finally(()=>{this.closeEstablishingWs=void 0})}}class IT extends QG{constructor(r,s){super(r,s,arguments.length>2&&arguments[2]!==void 0&&arguments[2],arguments.length>3&&arguments[3]!==void 0&&arguments[3],arguments.length>4&&arguments[4]!==void 0&&arguments[4],arguments.length>5?arguments[5]:void 0)}async chooseBestWebsocketConnection(r,s){return new lt((o,c)=>{let u=!1;const h=[];this.closeEstablishingWs=()=>{L.debug("[choose-best-ws] close establishing websockets"),h.forEach(z=>{z.onclose=null,z.onopen=null,z.onmessage=null,z.close()}),c(new Le(X.WS_ABORT,"choose best websocket aborted"))};const m=re("GATEWAY_DOMAINS");let _;const E=r.indexOf("?h="),S=m.find(z=>E!==-1?ot(r).call(r,z,E):ot(r).call(r,z));L.debug("[choose-best-ws] currentDomain: ",S,", domains: ",m);let R=!this.tryDoubleDomain||!S;if(!R&&S){var P;const z=Date.now();try{m.forEach(U=>{const F=E===-1?r.replace(S,U):r.substr(0,E)+r.substr(E).replace(S,U),q=new WebSocket(F);q.binaryType="arraybuffer",h.push(q),L.debug("[choose-best-ws] ws is connecting:",q.url)})}catch{for(L.debug("[choose-best-ws] ws create failed, fallback to single url"),h.forEach(F=>F.close());h.length;)h.pop();R=!0}(P=this.store)===null||P===void 0||P.recordJoinChannelService({urls:h.map(U=>U.url),service:"gateway"},s),h.forEach(U=>{U.onopen=()=>{if(u)return;const F=Date.now()-z;L.debug("[choose-best-ws] ws open cost ".concat(F,"ms")),h.filter(q=>q!==U).forEach(q=>{L.debug("[choose-best-ws]close backup websocket: ".concat(q.url)),q.close()}),u=!0,o(U)},U.onclose=F=>{_=F,!u&&(h.find(q=>!(q.readyState===WebSocket.CLOSED||q.readyState===WebSocket.CLOSING))||(L.debug("[choose-best-ws] all websocket is closed"),u=!0,c(_)))},U.onmessage=F=>{L.debug("[choose-best-ws]".concat(U.url," onmessage: ").concat(F.data))}}),os(this.forceCloseTimeout).then(()=>{h.forEach(U=>{U.readyState!==WebSocket.OPEN&&U.close()})})}if(R){var k;let z;L.debug("[choose-best-ws] use single url: ",r),(k=this.store)===null||k===void 0||k.recordJoinChannelService({urls:[r],service:"gateway"},s);try{z=new WebSocket(r),h.push(z),z.binaryType="arraybuffer"}catch(U){const F=new Le(X.WS_ERR,"init websocket failed! Error: ".concat(U.toString()));return L.error("[".concat(this.name,"]").concat(F)),void c(F)}z.onopen=()=>{o(z)},z.onclose=U=>{c(U)},z.onmessage=U=>{L.debug("[choose-best-ws]".concat(z.url," onmessage: ").concat(U.data))},os(this.forceCloseTimeout).then(()=>{z&&z.readyState!==WebSocket.OPEN&&z.close()})}}).then(o=>(this.closeEstablishingWs=void 0,o)).catch(o=>{throw this.closeEstablishingWs=void 0,o})}}class bme extends Pr{get connectionState(){return this._connectionState}set connectionState(r){r!==this._connectionState&&(this._connectionState=r,r===lr.CONNECTED?this.emit(Wt.WS_CONNECTED):r===lr.RECONNECTING?this.emit(Wt.WS_RECONNECTING,this._websocketReconnectReason):r===lr.CLOSED&&this.emit(Wt.WS_CLOSED,this._disconnectedReason))}get currentURLIndex(){return this.websocket.currentURLIndex}get url(){return this.websocket&&this.websocket.url||null}get rtt(){return this.rttRolling.mean()}constructor(r,s){super(),$(this,"_disconnectedReason",void 0),$(this,"_websocketReconnectReason",void 0),$(this,"_connectionState",lr.CLOSED),$(this,"reconnectToken",void 0),$(this,"websocket",void 0),$(this,"openConnectionTime",void 0),$(this,"clientId",void 0),$(this,"lastMsgTime",Date.now()),$(this,"uploadCache",[]),$(this,"uploadCacheInterval",void 0),$(this,"rttRolling",new u8(5)),$(this,"pingpongTimer",void 0),$(this,"wsInflateDataTimer",void 0),$(this,"pingpongTimeoutCount",0),$(this,"joinResponse",void 0),$(this,"multiIpOption",void 0),$(this,"initError",void 0),$(this,"spec",void 0),$(this,"store",void 0),$(this,"onWebsocketMessage",o=>{if(o.data instanceof ArrayBuffer)return void this.emit(Wt.ON_BINARY_DATA,o.data);const c=JSON.parse(o.data);if(this.lastMsgTime=Date.now(),Object.prototype.hasOwnProperty.call(c,"_id")){const u="res-@".concat(c._id);this.emit(u,c._result,c._message)}else if(Object.prototype.hasOwnProperty.call(c,"_type")){if(this.emit(c._type,c._message),c._type===_n.ON_NOTIFICATION&&this.handleNotification(c._message),c._type===_n.ON_USER_BANNED)switch(c._message.error_code){case 14:this.close(Bn.UID_BANNED);break;case 15:this.close(Bn.IP_BANNED);break;case 16:this.close(Bn.CHANNEL_BANNED)}if(c._type===_n.ON_USER_LICENSE_BANNED)switch(c._message.error_code){case Lt.ERR_LICENSE_MISSING:this.close(Bn.LICENSE_MISSING);break;case Lt.ERR_LICENSE_EXPIRED:this.close(Bn.LICENSE_EXPIRED);break;case Lt.ERR_LICENSE_MINUTES_EXCEEDED:this.close(Bn.LICENSE_MINUTES_EXCEEDED);break;case Lt.ERR_LICENSE_PERIOD_INVALID:this.close(Bn.LICENSE_PERIOD_INVALID);break;case Lt.ERR_LICENSE_MULTIPLE_SDK_SERVICE:this.close(Bn.LICENSE_MULTIPLE_SDK_SERVICE);break;case Lt.ERR_LICENSE_ILLEGAL:this.close(Bn.LICENSE_ILLEGAL);break;default:this.close()}}}),this.clientId=r.clientId,this.spec=r,this.store=s,this.websocket=new Fx("gateway-".concat(this.clientId),this.spec.retryConfig,!0,re("JOIN_GATEWAY_USE_DUAL_DOMAIN"),re("JOIN_GATEWAY_USE_443PORT_ONLY"),s),this.handleWebsocketEvents(),window.addEventListener("offline",()=>{this.connectionState===lr.CONNECTED&&this.reconnect("retry",bs.OFFLINE)})}async request(r,s,o,c){const u=or(6,""),h={_id:u,_type:r,_message:s},m=this.websocket.connectionID,_=()=>new lt((z,U)=>{if(this.connectionState===lr.CONNECTED)return z();const F=()=>{this.off(Wt.WS_CLOSED,q),z()},q=()=>{this.off(Wt.WS_CONNECTED,F),U(new Oe(X.WS_ABORT))};this.once(Wt.WS_CONNECTED,F),this.once(Wt.WS_CLOSED,q),r!==jt.PUBLISH&&r!==jt.PUBLISH_DATASTREAM&&r!==jt.SUBSCRIBE&&r!==jt.SUBSCRIBE_DATASTREAM&&r!==jt.UNSUBSCRIBE&&r!==jt.UNSUBSCRIBE_DATASTREAM&&r!==jt.UNPUBLISH&&r!==jt.UNPUBLISH_DATASTREAM&&r!==jt.CONTROL&&r!==jt.RESTART_ICE||this.once(Wt.DISCONNECT_P2P,()=>{U(new Oe(X.DISCONNECT_P2P))}),r!==jt.PUBLISH&&r!==jt.RESTART_ICE||this.once(Wt.ABORT_P2P_EXECUTION,()=>{U(new Oe(X.DISCONNECT_P2P))})});if(this.connectionState!==lr.CONNECTING&&this.connectionState!==lr.RECONNECTING||r===jt.JOIN||r===jt.REJOIN||await _(),this.websocket.sendMessage(h,!0),c)return;const E=new lt((z,U)=>{let F=!1;const q=(le,ye)=>{F=!0,z({isSuccess:le==="success",message:ye||{}}),this.off(Wt.WS_CLOSED,Y),this.off(Wt.WS_RECONNECTING,Y),this.emit(Wt.REQUEST_SUCCESS,r,s)};this.once("res-@".concat(u),q);const Y=()=>{U(new Oe(X.WS_ABORT,"type: ".concat(r))),this.off(Wt.WS_CLOSED,Y),this.off(Wt.WS_RECONNECTING,Y),this.off("res-@".concat(u),q)};this.once(Wt.WS_CLOSED,Y),this.once(Wt.WS_RECONNECTING,Y),os(re("SIGNAL_REQUEST_TIMEOUT")).then(()=>{this.websocket.connectionID!==m||F||(L.warning("[".concat(this.clientId,"] ws request timeout, type: ").concat(r)),this.emit(Wt.REQUEST_TIMEOUT,r,s))})});let S=null;try{S=await E}catch(z){if(this.connectionState===lr.CLOSED||r===jt.LEAVE)throw new Oe(X.WS_ABORT);return!this.spec.forceWaitGatewayResponse||o?z.throw():r===jt.JOIN||r===jt.REJOIN?null:(await _(),await this.request(r,s))}if(S.isSuccess)return S.message;const R=Number(S.message.error_code||S.message.code),P=CT(R),k=new Oe(X.UNEXPECTED_RESPONSE,"".concat(P.desc,": ").concat(S.message.error_str),{code:R,data:S.message,desc:P.desc});return P.action==="success"?S.message:(L.warning("[".concat(this.clientId,"] [").concat(this.websocket.connectionID,"] unexpected response from type ").concat(r,", error_code: ").concat(R,", message: ").concat(P.desc,", action: ").concat(P.action)),R===Lt.ERR_TOO_MANY_BROADCASTERS?((r===jt.JOIN||r===jt.REJOIN)&&(this.initError=k,this.close()),k.throw()):P.action==="failed"?k.throw():P.action==="quit"?(this.initError=k,this.close(),k.throw()):(R===Lt.ERR_JOIN_BY_MULTI_IP?(this.multiIpOption=S.message.option,L.warning("[".concat(this.clientId,"] detect multi ip, recover")),this.reconnect("recover",bs.MULTI_IP)):this.reconnect(P.action,bs.SERVER_ERROR),r===jt.JOIN||r===jt.REJOIN?null:await this.request(r,s)))}waitMessage(r,s){return new lt(o=>{const c=u=>{(!s||s(u))&&(this.off(r,c),o(u))};this.on(r,c)})}uploadWRTCStats(r){if(!this.store.sessionId)return void L.warn("[".concat(this.clientId,"] no session id when upload wrtc stats"));const s={lts:Date.now(),sid:this.store.sessionId,uid:this.store.intUid,stats:r};this.upload(wT.WRTC_STATS,s)}upload(r,s){const o={_type:r,_message:s};try{this.websocket.sendMessage(o)}catch{const u=re("MAX_UPLOAD_CACHE")||50;this.uploadCache.push(o),this.uploadCache.length>u&&this.uploadCache.splice(0,1),this.uploadCache.length>0&&!this.uploadCacheInterval&&(this.uploadCacheInterval=window.setInterval(()=>{if(this.connectionState!==lr.CONNECTED)return;const h=this.uploadCache.splice(0,1)[0];this.uploadCache.length===0&&(window.clearInterval(this.uploadCacheInterval),this.uploadCacheInterval=void 0),this.upload(h._type,h._message)},re("UPLOAD_CACHE_INTERVAL")||2e3))}}send(r,s){const o={_type:r,_message:s};this.websocket.sendMessage(o)}init(r){return this.initError=void 0,this.multiIpOption=void 0,this.joinResponse=void 0,this.reconnectToken=void 0,this.openConnectionTime=void 0,new lt((s,o)=>{this.once(Wt.WS_CONNECTED,()=>s(this.joinResponse)),this.once(Wt.WS_CLOSED,c=>o(this.initError||new Oe(X.WS_ABORT,c))),this.connectionState=lr.CONNECTING,this.websocket.init(r).catch(o),this.wsInflateDataTimer&&window.clearInterval(this.wsInflateDataTimer),this.wsInflateDataTimer=window.setInterval(()=>{this.handleWsInflateData()},2e4)})}close(r){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.wsInflateDataTimer&&(this.handleWsInflateData(),window.clearInterval(this.wsInflateDataTimer),this.wsInflateDataTimer=void 0),this.reconnectToken=void 0,this.joinResponse=void 0,this._disconnectedReason=r||Bn.LEAVE,this.connectionState=lr.CLOSED,L.debug("[".concat(this.clientId,"] ")+"will close websocket in signal"),this.websocket.close()}async join(){if(!this.joinResponse){this.emit(Wt.ABORT_P2P_EXECUTION);const r=await Ts(this,Wt.REQUEST_JOIN_INFO),s=await this.request(jt.JOIN,r);if(!s)return this.emit(Wt.REPORT_JOIN_GATEWAY,fP.TIMEOUT,this.url||""),!1;this.joinResponse=s,this.emit(Wt.JOIN_RESPONSE,this.joinResponse),this.reconnectToken=this.joinResponse.rejoin_token}return this.connectionState=lr.CONNECTED,this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(this.handlePingPong.bind(this),3e3),!0}async rejoin(){if(!this.reconnectToken)throw new Oe(X.UNEXPECTED_ERROR,"can not rejoin, no rejoin token");const r=_T(this,Wt.REQUEST_REJOIN_INFO);r.token=this.reconnectToken;const s=await this.request(jt.REJOIN,r);return!!s&&(this.connectionState=lr.CONNECTED,this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(this.handlePingPong.bind(this),3e3),s.peers&&s.peers.forEach(o=>{this.emit(_n.ON_USER_ONLINE,{uid:o.uid}),o.audio&&this.emit(_n.ON_ADD_AUDIO_STREAM,{uid:o.uid,uint_id:o.uint_id,audio:!0,ssrcId:o.audio_ssrc}),o.video&&this.emit(_n.ON_ADD_VIDEO_STREAM,{uid:o.uid,uint_id:o.uint_id,video:!0,ssrcId:o.video_ssrc}),o.audio_mute?this.emit(_n.MUTE_AUDIO,{uid:o.uid}):this.emit(_n.UNMUTE_AUDIO,{uid:o.uid}),o.video_mute?this.emit(_n.MUTE_VIDEO,{uid:o.uid}):this.emit(_n.UNMUTE_VIDEO,{uid:o.uid}),o.audio_enable_local?this.emit(_n.ENABLE_LOCAL_AUDIO,{uid:o.uid}):this.emit(_n.DISABLE_LOCAL_AUDIO,{uid:o.uid}),o.video_enable_local?this.emit(_n.ENABLE_LOCAL_VIDEO,{uid:o.uid}):this.emit(_n.DISABLE_LOCAL_VIDEO,{uid:o.uid}),o.audio||o.video||this.emit(_n.ON_REMOVE_STREAM,{uid:o.uid,uint_id:o.uint_id})}),!0)}reconnect(r,s){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.websocket.reconnect(r,s)}handleNotification(r){L.debug("[".concat(this.clientId,"] receive notification: "),r);const s=CT(r.code);if(r.code===28&&"detail"in r&&(L.info("[".concat(this.clientId,"] receive recover notification: "),r.detail),this.emit(Wt.RECOVER_NOTIFICATION,r.detail)),s.action!=="success"){if(s.action!=="failed")return s.action==="quit"?(s.desc==="ERR_REPEAT_JOIN_CHANNEL"&&this.close(Bn.UID_BANNED),void this.close()):void this.reconnect(s.action,bs.SERVER_ERROR);L.error("[".concat(this.clientId,"] ignore error: "),s.desc)}}handlePingPong(){if(!this.websocket||this.websocket.state!=="connected")return;this.pingpongTimeoutCount>0&&this.rttRolling.add(3e3),this.pingpongTimeoutCount+=1;const r=re("PING_PONG_TIME_OUT"),s=Date.now();this.pingpongTimeoutCount>=r&&(L.warning("[".concat(this.clientId,"] PING-PONG Timeout. Last Socket Message: ").concat(s-this.lastMsgTime,"ms")),s-this.lastMsgTime>re("WEBSOCKET_TIMEOUT_MIN"))?this.reconnect("retry",bs.TIMEOUT):this.request(jt.PING,void 0,!0).then(()=>{this.pingpongTimeoutCount=0;const o=Date.now()-s;this.rttRolling.add(o),re("REPORT_STATS")&&this.send(jt.PING_BACK,{pingpongElapse:o})}).catch(o=>{})}handleWsInflateData(){const{wsInflateLength:r,wsDeflateLength:s}=this.websocket.getWsInflateData();r!==0&&s!==0&&this.upload(wT.WS_INFLATE_DATA_LENGTH,{ws_deflate_length:s,ws_inflate_length:r})}handleWebsocketEvents(){this.websocket.on(Yt.RECONNECT_CREATE_CONNECTION,r=>{this.emit(Wt.WS_RECONNECT_CREATE_CONNECTION,r)}),this.websocket.on(Yt.ON_MESSAGE,this.onWebsocketMessage),this.websocket.on(Yt.CLOSED,()=>{this.connectionState=lr.CLOSED}),this.websocket.on(Yt.FAILED,()=>{this._disconnectedReason=Bn.NETWORK_ERROR,this.connectionState=lr.CLOSED}),this.websocket.on(Yt.RECONNECTING,r=>{this._websocketReconnectReason=r,this.joinResponse=void 0,this.connectionState===lr.CONNECTED?this.connectionState=lr.RECONNECTING:this.connectionState=lr.CONNECTING}),this.websocket.on(Yt.WILL_RECONNECT,(r,s,o)=>{const c=_T(this,Wt.IS_P2P_DISCONNECTED),u=c||r!=="retry";c&&r==="retry"&&(L.debug("".concat(this.clientId," reconnect mode is retry, but p2p lost, change to tryNext")),r="tryNext",s=fP.P2P_DISCONNECTED),u&&(L.debug("".concat(this.clientId," will renewSession, reconnect mode: ").concat(r)),this.emit(Wt.REPORT_JOIN_GATEWAY,s||fP.UNKNOWN_REASON,this.url||""),this.reconnectToken=void 0,this.emit(Wt.DISCONNECT_P2P)),o(r)}),this.websocket.on(Yt.CONNECTED,()=>{this.openConnectionTime=Date.now(),this.reconnectToken?this.rejoin().catch(r=>{L.warning("[".concat(this.clientId,"] rejoin failed ").concat(r)),this.reconnect("tryNext",bs.SERVER_ERROR)}):this.join().catch(r=>{if(this.emit(Wt.REPORT_JOIN_GATEWAY,r,this.url||""),r instanceof Oe){if(r.code===X.UNEXPECTED_RESPONSE&&r.data.code===Lt.ERR_NO_AUTHORIZED)return this.initError=new Oe(X.TOKEN_EXPIRE,"dynamic key expired"),void this.close(Bn.TOKEN_EXPIRE);L.error("[".concat(this.clientId,"] join gateway request failed"),r.toString()),this.spec.forceWaitGatewayResponse?this.reconnect("tryNext",bs.SERVER_ERROR):(this.initError=r,this.close())}})}),this.websocket.on(Yt.REQUEST_NEW_URLS,(r,s)=>{Ts(this,Wt.REQUEST_RECOVER,this.multiIpOption).then(r).catch(s)}),this.websocket.on(Yt.ON_TOKEN_PRIVILEGE_DID_EXPIRE,()=>{this.emit(_n.ON_TOKEN_PRIVILEGE_DID_EXPIRE)}),this.websocket.on(qG.PRE_CONNECT_PC,()=>{this.emit(Wt.PRE_CONNECT_PC)})}}let Tme=function(t){return t.NATIVE_RTC="native_rtc",t.NATIVE_RTM="native_rtm",t.WEB_RTC="web_rtc",t.WEB_RTM="web_rtm",t}({}),li=function(t){return t[t.CHOOSE_SERVER=11]="CHOOSE_SERVER",t[t.CLOUD_PROXY=18]="CLOUD_PROXY",t[t.CLOUD_PROXY_5=20]="CLOUD_PROXY_5",t[t.CLOUD_PROXY_FALLBACK=26]="CLOUD_PROXY_FALLBACK",t}({});function ZG(t,r){var s=Object.keys(t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);r&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(t,c).enumerable})),s.push.apply(s,o)}return s}function mP(t){for(var r=1;r<arguments.length;r++){var s=arguments[r]!=null?arguments[r]:{};r%2?ZG(Object(s),!0).forEach(function(o){$(t,o,s[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(s)):ZG(Object(s)).forEach(function(o){Object.defineProperty(t,o,Object.getOwnPropertyDescriptor(s,o))})}return t}function Nm(t){return t.match(/^[\.\:\d]+$/)?"".concat(t.replace(/[^\d]/g,"-"),".").concat(re("TURN_DOMAIN")):(L.debug("Cannot recognized as ip address: ".concat(t,", use as host")),t)}function jx(t,r){t.addresses||(t.addresses=[]);const s=function(m,_){if(re("CONNECT_GATEWAY_WITHOUT_DOMAIN"))return m.map(R=>{let{ip:P,port:k}=R;return{address:"".concat(P,":").concat(k)}});const E=re("GATEWAY_DOMAINS");let S=E[1]&&ot(_).call(_,E[1])?1:0;return m.map(R=>{let{domain_prefix:P,port:k,ip:z}=R;if(P)return{address:"".concat(P,".").concat(E[S++%E.length],":").concat(k)};const U=/^[\.\:\d]+$/.test(z),F=U?"".concat(z.replace(/[^\d]/g,"-"),".").concat(E[S++%E.length],":").concat(k):"".concat(z,":").concat(k);return U||L.debug("Cannot recognized as ip address: ".concat(z,", use as host")),{ip:z,port:k,address:F}})}(t.addresses,r),o=Array.isArray(t.detail)&&t.detail[18];if(o&&typeof o=="string"){const m=o.split(";");for(let _=0;_<m.length;_++){var c;const E=eo(c=m[_]).call(c);s[_]&&E&&(s[_].ip6=E)}}const u=t.detail&&t.detail.candidate;let h;if(u){const[m,_]=u.split(":");m&&_&&(h={port:Number(_),ip:m,address:"".concat(m,":").concat(_)})}return{gatewayAddrs:s,apGatewayAddress:h,uid:t.uid,cid:t.cid,cert:t.cert,vid:t.detail&&t.detail[8],uni_lbs_ip:t.detail&&t.detail[1],res:t,csIp:t.detail&&t.detail[502]}}function rc(t){return typeof t=="number"?t:t.exact||t.ideal||t.max||t.min||0}function eH(t){const r=t._encoderConfig;if(!r)return{};const s={resolution:r.width&&r.height?"".concat(rc(r.width),"x").concat(rc(r.height)):void 0,maxVideoBW:r.bitrateMax,minVideoBW:r.bitrateMin};return typeof r.frameRate=="number"?(s.maxFrameRate=r.frameRate,s.minFrameRate=r.frameRate):r.frameRate&&(s.maxFrameRate=r.frameRate.max||r.frameRate.ideal||r.frameRate.exact||r.frameRate.min,s.minFrameRate=r.frameRate.min||r.frameRate.ideal||r.frameRate.exact||r.frameRate.max),s}function tH(t){return t>=0&&t<.17?1:t>=.17&&t<.36?2:t>=.36&&t<.59?3:t>=.59&&t<=1?4:t>1?5:0}function AT(t,r){let s,o,c;switch(r){case li.CHOOSE_SERVER:o=4096,c="choose server";break;case li.CLOUD_PROXY:o=1048576,c="proxy";break;case li.CLOUD_PROXY_5:o=4194304,c="proxy5";break;case li.CLOUD_PROXY_FALLBACK:o=4194310,c="proxy fallback";break;default:throw new Oe(X.UNEXPECTED_ERROR,"multi unlibs response transformer get unknown service id",{csIp:t.detail&&t.detail[502],retry:!1})}if(t.response_body.forEach(u=>{u.buffer&&u.buffer.flag===o&&(s={code:u.buffer.code,addresses:(u.buffer.edges_services||[]).map(h=>mP(mP({},h),{},{ticket:u.buffer.cert})),server_ts:t.enter_ts,uid:u.buffer.uid,cid:u.buffer.cid,cname:u.buffer.cname,detail:mP(mP({},u.buffer.detail),t.detail),flag:u.buffer.flag,opid:t.opid,cert:u.buffer.cert})}),!s)throw new Oe(X.MULTI_UNILBS_RESPONSE_ERROR,"cannot parse response ".concat(c," from multi unilbs response"),{csIp:t.detail&&t.detail[502]});return s}async function nH(t,r){return await lt.all(t.addresses.map(async s=>({address:re("USE_TURN_IP")?s.ip:Nm(s.ip),tcpport:s.port,udpport:s.port,username:r&&re("ENCRYPT_PROXY_USERNAME_AND_PSW")&&window.isSecureContext?r.toString():ws.username,password:r&&re("ENCRYPT_PROXY_USERNAME_AND_PSW")&&window.isSecureContext?await $L(r.toString()):ws.password})))}function Bx(t,r){const s=r.getMediaStreamTrack(!0).getSettings(),o=r.videoHeight||s.height,c=r.videoWidth||s.width;return o&&c?Math.max(Math.min(o,c)/Math.min(rc(t.height),rc(t.width)),1):(L.warning("can't get ori-track's height, default scale down 4 times for low stream"),4)}function Dm(t){let{candidateType:r,relayProtocol:s,type:o,address:c,port:u,protocol:h}=t;const m={candidateType:r,relayProtocol:s,protocol:h};if(o!=="local-candidate"){const _=c.split(".");_.length>=4&&(_[1]="*",_[2]="*"),m.address=_.join("."),m.port=u}return m}function gP(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:re("SVC_MODE");if(re("ENABLE_SVC"))return function(r){return r in HA}(t)?t:HA.L1T3}const rH={[gt.VIDEO]:[{key:"abs-send-time",extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time"},{key:"video-orientation",extensionName:"urn:3gpp:video-orientation"},{key:"draft-holmer-rmcat-transport-wide-cc-extensions-01",extensionName:"http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01"},{key:"playout-delay",extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/playout-delay"},{key:"video-content-type",extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/video-content-type"},{key:"color-space",extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/color-space"},{key:"video-timing",extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/video-timing"}],[gt.AUDIO]:[{key:"ssrc-audio-level",extensionName:"urn:ietf:params:rtp-hdrext:ssrc-audio-level"},{key:"draft-holmer-rmcat-transport-wide-cc-extensions-01",extensionName:"http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01"},{key:"abs-send-time",extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time"}]};function _P(t,r,s){r.forEach(o=>{var c;const u=rH[t].find(m=>{var _;let{key:E}=m;return ot(_=o.extensionName).call(_,E)});if(!u)return;const h=s.find(m=>{let{extensionName:_}=m;return ot(_).call(_,u.key)});h&&ot(c=h.extensionName).call(c,"gdpr_forbidden")&&(o.extensionName=h.extensionName)})}function Qv(t,r){r.forEach(s=>{var o;const c=rH[t].find(u=>{var h;let{key:m}=u;return ot(h=s.extensionName).call(h,m)});ot(o=s.extensionName).call(o,"gdpr_forbidden")&&c&&(s.extensionName=c.extensionName)})}function iH(t){return t==="http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time"||ot(t).call(t,"abs-send-time")}function yP(t){return t==="http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01"||ot(t).call(t,"draft-holmer-rmcat-transport-wide-cc-extensions-01")}function sH(t,r){var s=Object.keys(t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);r&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(t,c).enumerable})),s.push.apply(s,o)}return s}function oH(t){for(var r=1;r<arguments.length;r++){var s=arguments[r]!=null?arguments[r]:{};r%2?sH(Object(s),!0).forEach(function(o){$(t,o,s[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(s)):sH(Object(s)).forEach(function(o){Object.defineProperty(t,o,Object.getOwnPropertyDescriptor(s,o))})}return t}function PT(t){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},s=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},o=arguments.length>3?arguments[3]:void 0;const{filterRTX:c,filterVideoFec:u,filterAudioFec:h,filterAudioCodec:m,filterVideoCodec:_}=r,{useXR:E}=s;let S=[],R=[],P=[],k=[],z=!1,U=!1;if(Ca(t).mediaDescriptions.forEach(q=>{o&&o!==q.attributes.direction||(q.media.mediaType!=="video"||z||(R=q.attributes.payloads,k=q.attributes.extmaps,z=!0),q.media.mediaType!=="audio"||U||(S=q.attributes.payloads,P=q.attributes.extmaps,U=!0))}),!k||R.length===0)throw new Error("Cannot get video capabilities from SDP.");if(!P||S.length===0)throw new Error("Cannot get audio capabilities from SDP.");if(R.forEach(q=>{var Y;(Y=q.rtpMap)!==null&&Y!==void 0&&Y.clockRate&&(q.rtpMap.clockRate=parseInt(q.rtpMap.clockRate)),E&&q.rtcpFeedbacks.push({type:"rrtr"})}),S.forEach(q=>{var Y;(Y=q.rtpMap)!==null&&Y!==void 0&&Y.clockRate&&(q.rtpMap.clockRate=parseInt(q.rtpMap.clockRate)),E&&q.rtcpFeedbacks.push({type:"rrtr"})}),c&&(S=S.filter(q=>{var Y;return((Y=q.rtpMap)===null||Y===void 0?void 0:Y.encodingName.toLowerCase())!=="rtx"}),R=R.filter(q=>{var Y;return((Y=q.rtpMap)===null||Y===void 0?void 0:Y.encodingName.toLowerCase())!=="rtx"})),u&&(R=R.filter(q=>{var Y;return!/(red)|(ulpfec)|(flexfec)/i.test(((Y=q.rtpMap)===null||Y===void 0?void 0:Y.encodingName)||"")})),h&&(S=S.filter(q=>{var Y;return!/(red)|(ulpfec)|(flexfec)/i.test(((Y=q.rtpMap)===null||Y===void 0?void 0:Y.encodingName)||"")})),m&&(m==null?void 0:m.length)>0&&(S=S.filter(q=>{var Y;return ot(m).call(m,((Y=q.rtpMap)===null||Y===void 0?void 0:Y.encodingName.toLowerCase())||"")})),_&&(_==null?void 0:_.length)>0){const q=R.filter(Y=>{var le;return ot(_).call(_,((le=Y.rtpMap)===null||le===void 0?void 0:le.encodingName.toLowerCase())||"")});R=q.concat(c?[]:Gx(q,R))}const F=re("UNSUPPORTED_VIDEO_CODEC");return F&&F.length>0&&(R=R.filter(q=>!(q.rtpMap&&ot(F).call(F,q.rtpMap.encodingName.toLowerCase())))),{audioCodecs:S,videoCodecs:R,audioExtensions:P,videoExtensions:k}}function Lm(t){const r=Ca(t);let s,o;for(const c of r.mediaDescriptions){if(!s){const u=c.attributes.iceUfrag,h=c.attributes.icePwd;if(!u||!h)throw new Error("Cannot get iceUfrag or icePwd from SDP.");s={iceUfrag:u,icePwd:h}}if(!o){const u=c.attributes.fingerprints;u.length>0&&(o={fingerprints:u})}}if(!o&&r.attributes.fingerprints.length>0&&(o={fingerprints:r.attributes.fingerprints}),!o||!s)throw new Error("Cannot get iceParameters or dtlsParameters from SDP.");return{iceParameters:s,dtlsParameters:o}}function aH(t,r){const s=[],o=t.attributes.ssrcGroups.filter(h=>h.semantic==="FID"),c=t.attributes.ssrcGroups.find(h=>h.semantic==="SIM"),u=t.attributes.ssrcs;if(c)c.ssrcIds.forEach(h=>{var m;const _=(m=o.find(E=>E.ssrcIds[0]===h))===null||m===void 0?void 0:m.ssrcIds[1];s.push({ssrcId:h,rtx:r?_:void 0})});else if(o.length>0){const h=o[0].ssrcIds[0],m=o[0].ssrcIds[1];s.push({ssrcId:h,rtx:r?m:void 0})}else{if(u.length===0)throw new Error("No ssrcs found on local media description.");s.push({ssrcId:u[0].ssrcId})}return s}function cH(t,r,s){const{cname:o}=t;let c=[];r&&(c=lH(r)),c.length===0&&(c=t.iceParameters.candidates.map(S=>({foundation:S.foundation,componentId:"1",transport:S.protocol,priority:S.priority.toString(),connectionAddress:S.ip,port:S.port.toString(),type:S.type,extension:{}})),L.debug("Using candidates from gateway."));const u={fingerprints:t.dtlsParameters.fingerprints.map(S=>({hashFunction:S.algorithm,fingerprint:S.fingerprint}))},h={iceUfrag:t.iceParameters.iceUfrag,icePwd:t.iceParameters.icePwd};let m;switch(t.dtlsParameters.role){case"server":m="passive";break;case"client":m="active";break;case"auto":m="actpass"}const _=vP(t.rtpCapabilities),E=[];return Array.isArray(s)&&s.length>0&&s.forEach(S=>{E.push({kind:gt.VIDEO,ssrcId:S.v,rtx:S.v_rtx,mslabel:"".concat(S.v,"_").concat(S.a)},{kind:gt.AUDIO,ssrcId:S.a,mslabel:"".concat(S.v,"_").concat(S.a)})}),{dtlsParameters:u,iceParameters:h,candidates:c,rtpCapabilities:_,setup:m,cname:o,preSSRCs:E}}function lH(t){let r=[];return t.ip&&typeof t.port=="number"&&(r=[{foundation:"udpcandidate",componentId:"1",transport:"udp",priority:"2103266323",connectionAddress:t.ip,port:t.port.toString(),type:"host",extension:{}}],L.debug("Using remote candidate from AP ".concat(t.ip,":").concat(t.port)),t.ip6&&(r.push({foundation:"udpcandidate",componentId:"1",transport:"udp",priority:"2103266323",connectionAddress:t.ip6,port:t.port.toString(),type:"host",extension:{}}),L.debug("Using IPV6 remote candidate from AP ".concat(t.ip6,":").concat(t.port)))),r}function z_(t,r,s){const o=[],c=[];return t.forEach(u=>{let{ssrcId:h,rtx:m}=u;const _=or(8,"track-"),E={ssrcId:h,attributes:oH({label:_,mslabel:s=s||or(10,""),msid:"".concat(s," ").concat(_)},r&&{cname:r})};if(o.push(E),m!==void 0){const S={ssrcId:m,attributes:oH({label:_,mslabel:s,msid:"".concat(s," ").concat(_)},r&&{cname:r})};o.push(S),c.push({semantic:"FID",ssrcIds:[h,m]})}}),t.length>1&&c.push({semantic:"SIM",ssrcIds:t.map(u=>{let{ssrcId:h}=u;return h})}),{ssrcs:o,ssrcGroups:c}}function Zv(t,r){r instanceof Br&&t.attributes.payloads.forEach(s=>{var o;const c=(o=s.rtpMap)===null||o===void 0?void 0:o.encodingName.toLowerCase();if(!c||["opus","pcmu","pcma","g722"].indexOf(c)===-1)return;s.fmtp||(s.fmtp={parameters:{}}),s.fmtp.parameters.minptime="10",s.fmtp.parameters.useinbandfec="1";const u=r._encoderConfig;u&&c!=="pcmu"&&c!=="pcma"&&c!=="g722"&&(u.bitrate&&!Dr()&&(s.fmtp.parameters.maxaveragebitrate="".concat(Math.floor(1e3*u.bitrate))),u.sampleRate&&(s.fmtp.parameters.maxplaybackrate="".concat(u.sampleRate),s.fmtp.parameters["sprop-maxcapturerate"]="".concat(u.sampleRate)),u.stereo&&(s.fmtp.parameters.stereo="1",s.fmtp.parameters["sprop-stereo"]="1"))})}function Wx(t){const r=t.attributes.unrecognized.findIndex(s=>s.attField==="x-google-flag"&&s.attValue==="conference");r!==-1&&t.attributes.unrecognized.splice(r,1)}function zx(t,r){var s;if(!(r instanceof _r&&r._encoderConfig&&r._hints.indexOf(ar.SCREEN_TRACK)===-1))return;const o=r._encoderConfig;kn().supportMinBitrate&&o.bitrateMin&&t.attributes.payloads.forEach(c=>{var u,h;ot(u=["h264","h265","vp8","vp9","av1"]).call(u,((h=c.rtpMap)===null||h===void 0?void 0:h.encodingName.toLowerCase())||"")&&(c.fmtp||(c.fmtp={parameters:{}}),c.fmtp.parameters["x-google-min-bitrate"]="".concat(o.bitrateMin))}),kn().supportMinBitrate&&!ot(s=r._hints).call(s,ar.LOW_STREAM)&&o.bitrateMax&&t.attributes.payloads.forEach(c=>{var u,h;ot(u=["h264","h265","vp8","vp9","av1"]).call(u,((h=c.rtpMap)===null||h===void 0?void 0:h.encodingName.toLowerCase())||"")&&(c.fmtp||(c.fmtp={parameters:{}}),c.fmtp.parameters["x-google-start-bitrate"]="".concat(re("X_GOOGLE_START_BITRATE")||Math.floor(o.bitrateMax)))})}function uH(t){if(t.media.mediaType!=="video")return;const r=Rn();if(r.name!==Un.SAFARI&&r.os!==zi.IOS)return;const s=t.attributes.extmaps.findIndex(o=>/video-orientation/g.test(o.extensionName));s!==-1&&t.attributes.extmaps.splice(s,1)}function EP(t,r,s){if(!r)return;let o,c;if(t.media.mediaType==="video"?(o=s.videoExtensions,c=s.videoCodecs):(o=s.audioExtensions,c=s.audioCodecs),r.twcc===!0){const u=o.find(h=>yP(h.extensionName));if(u){const h=u.extensionName;t.attributes.extmaps.find(_=>yP(_.extensionName))||t.attributes.extmaps.push({entry:u.entry,extensionName:h}),function(_,E){return E.filter(S=>!!_.find(R=>R.payloadType===S.payloadType&&!!R.rtcpFeedbacks.find(P=>P.type==="transport-cc")))}(c,t.attributes.payloads).forEach(_=>{_.rtcpFeedbacks.find(E=>E.type==="transport-cc")||_.rtcpFeedbacks.push({type:"transport-cc"})})}}else if(r.twcc===!1){const u=t.attributes.extmaps.findIndex(h=>yP(h.extensionName));u!==-1&&t.attributes.extmaps.splice(u,1),t.attributes.payloads.forEach(h=>{const m=h.rtcpFeedbacks.findIndex(_=>_.type==="transport-cc");m!==-1&&h.rtcpFeedbacks.splice(m,1)})}if(r.remb===!0){const u=o.find(h=>iH(h.extensionName));if(u){const h=u.extensionName;t.attributes.extmaps.find(_=>_.extensionName===h)||t.attributes.extmaps.push({entry:u.entry,extensionName:h}),function(_,E){return E.filter(S=>!!_.find(R=>R.payloadType===S.payloadType&&!!R.rtcpFeedbacks.find(P=>P.type==="goog-remb")))}(c,t.attributes.payloads).forEach(_=>{_.rtcpFeedbacks.find(E=>E.type==="goog-remb")||_.rtcpFeedbacks.push({type:"goog-remb"})})}}else if(r.remb===!1){const u=t.attributes.extmaps.findIndex(h=>iH(h.extensionName));u!==-1&&t.attributes.extmaps.splice(u,1),t.attributes.payloads.forEach(h=>{const m=h.rtcpFeedbacks.findIndex(_=>_.type==="goog-remb");m!==-1&&h.rtcpFeedbacks.splice(m,1)})}}function dH(t,r,s){if(Dr()||t.media.mediaType!=="video"||!(r instanceof _r)||s!=="vp9"&&s!=="vp8"||s==="vp8"&&!re("SIMULCAST")||s==="vp9"&&re("ENABLE_SVC")||r._scalabilityMode===void 0||r._scalabilityMode.numSpatialLayers<=1)return;const o=s==="vp8"?2:r._scalabilityMode.numSpatialLayers,c=t.attributes.ssrcs[0],u=t.attributes.ssrcGroups.find(m=>m.semantic==="FID"&&m.ssrcIds[0]===c.ssrcId),h={semantic:"SIM",ssrcIds:[c.ssrcId]};for(let m=1;m<o;m++)t.attributes.ssrcs.push({ssrcId:c.ssrcId+m,attributes:Mr(c.attributes)}),h.ssrcIds.push(c.ssrcId+m),u&&(t.attributes.ssrcs.push({ssrcId:u.ssrcIds[1]+m,attributes:Mr(c.attributes)}),t.attributes.ssrcGroups.push({semantic:"FID",ssrcIds:[c.ssrcId+m,u.ssrcIds[1]+m]}));t.attributes.ssrcGroups.unshift(h)}async function hH(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const s=new RTCPeerConnection;s.addTransceiver("video",{direction:"sendonly"}),s.addTransceiver("audio",{direction:"sendonly"}),s.addTransceiver("video",{direction:"recvonly"}),s.addTransceiver("audio",{direction:"recvonly"});const o=(await s.createOffer()).sdp,{send:c,recv:u,sendrecv:h}=function(){let m=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},_=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},E=arguments.length>2?arguments[2]:void 0;const S=PT(E,m,_,"sendonly"),R=PT(E,m,_,"recvonly"),P={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},k={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},z={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]};if(mu(S,R,"videoExtensions",P,k,z),mu(S,R,"videoCodecs",P,k,z),mu(S,R,"audioExtensions",P,k,z),mu(S,R,"audioCodecs",P,k,z),re("RAISE_H264_BASELINE_PRIORITY")){const U=[],F=[];z.videoCodecs.forEach((q,Y)=>{var le;if(((le=q.rtpMap)===null||le===void 0?void 0:le.encodingName.toLocaleLowerCase())==="h264"){var ye,Ee;const me=z.videoCodecs[Y+1],ke=me&&_H(q,me),Ye=(ye=q.fmtp)===null||ye===void 0?void 0:ye.parameters["profile-level-id"],ut=(Ee=q.fmtp)===null||Ee===void 0?void 0:Ee.parameters["packetization-mode"];!Ye||Ye!==re("FIRST_H264_PROFILE_LEVEL_ID")||re("FIRST_PACKETIZATION_MODE")&&ut!==re("FIRST_PACKETIZATION_MODE")?ke?F.push([q,me]):F.push([q]):ke?U.push([q,me]):U.push([q])}}),U.length>0&&F.length>0&&(L.debug("raising H264 baseline profile priority"),z.videoCodecs.forEach((q,Y)=>{var le;if(((le=q.rtpMap)===null||le===void 0?void 0:le.encodingName.toLocaleLowerCase())==="h264"){const ye=_H(q,z.videoCodecs[Y+1]),Ee=U.shift()||F.shift()||[];Ee.length>0&&(ye?z.videoCodecs.splice(Y,2,...Ee):z.videoCodecs.splice(Y,1,...Ee))}}),k.videoCodecs=k.videoCodecs.filter(q=>{var Y,le;return!(((Y=q.rtpMap)===null||Y===void 0?void 0:Y.encodingName.toLocaleLowerCase())==="h264"&&((le=q.fmtp)===null||le===void 0?void 0:le.parameters["profile-level-id"])!==re("FIRST_H264_PROFILE_LEVEL_ID"))}),re("FILTER_SEND_H264_BASELINE")&&(P.videoCodecs=P.videoCodecs.filter(q=>{var Y,le;return!(((Y=q.rtpMap)===null||Y===void 0?void 0:Y.encodingName.toLocaleLowerCase())==="h264"&&((le=q.fmtp)===null||le===void 0?void 0:le.parameters["profile-level-id"])!==re("FIRST_H264_PROFILE_LEVEL_ID"))})))}return{send:P,recv:k,sendrecv:z}}(t,r,o);try{s.close()}catch{}return{send:c,recv:u,sendrecv:h}}function fH(){const t={audioCodecs:[],videoCodecs:[],audioExtensions:[],videoExtensions:[]},r=PT(arguments.length>2?arguments[2]:void 0,arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},"recvonly"),s={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},o={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},c={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]};if(mu(t,r,"videoExtensions",s,o,c),mu(t,r,"videoCodecs",s,o,c),mu(t,r,"audioExtensions",s,o,c),mu(t,r,"audioCodecs",s,o,c),re("RAISE_H264_BASELINE_PRIORITY")){const u=c.videoCodecs.findIndex(h=>h.rtpMap&&h.rtpMap.encodingName.toLocaleLowerCase()==="h264"&&h.fmtp&&h.fmtp.parameters["profile-level-id"]==="42001f");if(u!==-1){const h=c.videoCodecs.findIndex(m=>m.rtpMap&&m.rtpMap.encodingName.toLocaleLowerCase()==="h264");if(h<u){L.debug("raising H264 baseline profile priority");const m=c.videoCodecs[u];c.videoCodecs.splice(u,1),c.videoCodecs.splice(h,0,m)}h!==-1&&(o.videoCodecs=o.videoCodecs.filter(m=>!(m.rtpMap&&m.rtpMap.encodingName.toLocaleLowerCase()==="h264"&&m.fmtp&&m.fmtp.parameters["profile-level-id"]!=="42001f")))}}return{send:s,recv:o,sendrecv:c}}function mu(t,r,s,o,c,u){if(s==="videoExtensions"||s==="audioExtensions"){const h=[];return t[s].forEach(m=>{r[s].some((_,E)=>{if(m.entry===_.entry&&m.extensionName===_.extensionName)return h.push(E),!0})?u[s].push(m):o[s].push(m)}),void r[s].forEach((m,_)=>{h.indexOf(_)===-1&&c[s].push(m)})}if(s==="videoCodecs"||s==="audioCodecs"){const h=[];return t[s].forEach(m=>{r[s].some((_,E)=>{if(m.payloadType===_.payloadType&&JSON.stringify(m)===JSON.stringify(_))return h.push(E),!0})?u[s].push(m):o[s].push(m)}),void r[s].forEach((m,_)=>{h.indexOf(_)===-1&&c[s].push(m)})}}function vP(t){const{send:r,recv:s,sendrecv:o}=t;if(!o){if(!r||!s)throw new Error("cannot merge rtp capabilities because one of send or recv is empty!");return{send:r,recv:s}}let c,u;return r?(c={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},c.audioCodecs=[...r.audioCodecs,...o.audioCodecs],c.videoCodecs=[...r.videoCodecs,...o.videoCodecs],c.audioExtensions=[...r.audioExtensions,...o.audioExtensions],c.videoExtensions=[...r.videoExtensions,...o.videoExtensions]):c=o,s?(u={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},u.audioCodecs=[...s.audioCodecs,...o.audioCodecs],u.videoCodecs=[...s.videoCodecs,...o.videoCodecs],u.audioExtensions=[...s.audioExtensions,...o.audioExtensions],u.videoExtensions=[...s.videoExtensions,...o.videoExtensions]):u=o,{send:c,recv:u}}function eS(t){t.media.mediaType==="audio"&&t.attributes.payloads.filter(r=>{var s;return((s=r.rtpMap)===null||s===void 0?void 0:s.encodingName.toLowerCase())==="opus"}).forEach(r=>{r.fmtp||(r.fmtp={parameters:{}}),r.fmtp.parameters.stereo="1",r.fmtp.parameters["sprop-stereo"]="1"})}function OT(t,r,s,o){let c=[];if(t===gt.VIDEO){if(re("H264_PROFILE_LEVEL_ID")&&o==="h264"&&(c=r.videoCodecs.filter(u=>{var h;return ot(h=u.rtpMap&&u.rtpMap.encodingName.toLowerCase()||"").call(h,o)&&u&&u.fmtp&&u.fmtp.parameters["profile-level-id"]===re("H264_PROFILE_LEVEL_ID")})),!Array.isArray(c)||c.length===0){let u=[];const h=[],m=[],_=[];if(s.videoCodecs.forEach(E=>{const S=E.rtpMap&&E.rtpMap.encodingName.toLowerCase()||"";ot(S).call(S,o)?u.push(E):ot(S).call(S,"vp9")?h.push(E):ot(S).call(S,"vp8")?m.push(E):ot(S).call(S,"h264")&&_.push(E)}),u.length===0){let E="";h.length!==0?(u=h,E="vp9"):m.length!==0?(u=m,E="vp8"):_.length!==0&&(u=_,E="h264"),L.warning("codec ".concat(o," not included in rtpCapabilities, fallback to default payloads: ").concat(E))}u.length!==0&&(c=r.videoCodecs.filter(E=>u.some(S=>S.payloadType===E.payloadType)))}if(c.length===0&&(L.warning("codec ".concat(o," not included in rtpCapabilities, fallback to default payloads: ").concat(r.videoCodecs[0].rtpMap&&r.videoCodecs[0].rtpMap.encodingName)),c=r.videoCodecs),re("USE_PUB_RTX")||re("USE_SUB_RTX")){const u=Gx(c,r.videoCodecs);c=[...c,...u]}}else c=r.audioCodecs.filter(u=>{var h;return ot(h=u.rtpMap&&u.rtpMap.encodingName.toLowerCase()||"").call(h,o)}),c.length===0&&(L.warning("codec ".concat(o," not included in rtpCapabilities, fallback to opus")),c=r.audioCodecs.filter(u=>{var h;return ot(h=u.rtpMap&&u.rtpMap.encodingName.toLowerCase()||"").call(h,"opus")}));return c}function Gx(t,r){const s=t.map(o=>o.payloadType.toString());return r.filter(o=>o.rtpMap&&o.rtpMap.encodingName==="rtx"&&o.fmtp&&o.fmtp.parameters.apt&&ot(s).call(s,o.fmtp&&o.fmtp.parameters.apt))}async function kT(t,r,s){const o=r.toString(),c=mH(o,"offer","remote","exchangeSDP");await t.setRemoteDescription({type:"offer",sdp:o});const u=await t.createAnswer();if(!u.sdp)throw new Error("cannot get answer sdp");let h=u.sdp;h=pH(h,s||{}),c==null||c(h||""),await t.setLocalDescription({type:"answer",sdp:h})}function pH(t,r,s){const o=Ca(t),{useXR:c}=r;return o.mediaDescriptions.forEach(u=>{var h;u.attributes.mid&&(Array.isArray(s)&&!ot(s).call(s,u.attributes.mid)||(u.media.mediaType==="audio"&&eS(u),c&&ot(h=["audio","video"]).call(h,u.media.mediaType)&&u.attributes.payloads.forEach(m=>{m.rtcpFeedbacks.findIndex(_=>_.type==="rrtr")===-1&&m.rtcpFeedbacks.push({type:"rrtr"})})))}),Pm(o)}function mH(t,r,s,o){if(re("SDP_LOGGING"))return L.upload("exchanging ".concat(s," ").concat(r," SDP during P2PConnection.").concat(o,`
`),t),r==="offer"?c=>{mH(c,"answer",s==="local"?"remote":"local",o)}:void 0}function gH(t){const r=re("COMPATIBLE_SDP_EXTENSION");return!!(Array.isArray(r)&&r.length>0)&&r.some(s=>ot(t).call(t,s))}function _H(t,r){try{var s;return((s=t.fmtp)===null||s===void 0?void 0:s.parameters.apt)===r.payloadType.toString()}catch{return!1}}function yH(t,r){var s=Object.keys(t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);r&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(t,c).enumerable})),s.push.apply(s,o)}return s}function bl(t,r){return typeof re(t)===r?re(t):void 0}function wme(){try{const t=re("EXPERIMENTS")||{};return typeof t=="string"||Array.isArray(t)?{}:function(r){for(var s=1;s<arguments.length;s++){var o=arguments[s]!=null?arguments[s]:{};s%2?yH(Object(o),!0).forEach(function(c){$(r,c,o[c])}):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(o)):yH(Object(o)).forEach(function(c){Object.defineProperty(r,c,Object.getOwnPropertyDescriptor(o,c))})}return r}({},t)}catch(t){return L.debug("handle gateway attributes failed: ",t),{}}}const EH={};function xm(t){(!(arguments.length>1&&arguments[1]!==void 0)||arguments[1])&&L.debug("install service ".concat(t.name)),EH[t.name]=t}function tp(t){const r=EH[t];if(!r)throw new Le(X.INVALID_OPERATION,"".concat(t," not found, please use AgoraRTC.use(").concat(t,"Service) to load it first"));return r}function vH(t,r){return tp("DataStream").create(t,r)}function SP(){return tp("InterceptFrame").create()}function SH(t,r){var s=Object.keys(t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);r&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(t,c).enumerable})),s.push.apply(s,o)}return s}function np(t){for(var r=1;r<arguments.length;r++){var s=arguments[r]!=null?arguments[r]:{};r%2?SH(Object(s),!0).forEach(function(o){$(t,o,s[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(s)):SH(Object(s)).forEach(function(o){Object.defineProperty(t,o,Object.getOwnPropertyDescriptor(s,o))})}return t}const Hx=new Map;class Rme extends Pr{get state(){return this._state}set state(r){if(r===this._state)return;const s=this._state;this._state=r,r==="DISCONNECTED"&&this._disconnectedReason?this.emit(es.CONNECTION_STATE_CHANGE,r,s,this._disconnectedReason):this.emit(es.CONNECTION_STATE_CHANGE,r,s)}get joinGatewayStartTime(){return this._joinGatewayStartTime}set joinGatewayStartTime(r){L.debug("[".concat(this.store.clientId,"] set joinGatewayStartTime at ").concat(r)),this._joinGatewayStartTime=r}constructor(r,s){var o,c,u;super(),$(this,"store",void 0),$(this,"joinInfo",void 0),$(this,"key",void 0),$(this,"ntpOffset",0),$(this,"signal",void 0),$(this,"role",void 0),$(this,"inChannelInfo",{joinAt:null,duration:0}),$(this,"spec",void 0),$(this,"_state","DISCONNECTED"),$(this,"_statsCollector",void 0),$(this,"_disconnectedReason",void 0),$(this,"isSignalRecover",!1),$(this,"hasChangeBGPAddress",!1),$(this,"trafficStatsInterval",void 0),$(this,"networkQualityInterval",void 0),$(this,"_joinGatewayStartTime",0),$(this,"_signalTimeout",!1),$(this,"_clientRoleOptions",void 0),$(this,"_isProactiveJoin",!1),this.store=r,this.spec=s,this.signal=this.store.useP2P?(o={spec:np(np({},s),{},{retryConfig:s.websocketRetryConfig}),store:r},(c=(u=tp("P2PChannel")).createSubmodule)===null||c===void 0?void 0:c.call(u,o)):new bme(np(np({},s),{},{retryConfig:s.websocketRetryConfig}),r),this._statsCollector=s.statsCollector,this.role=s.role||"audience",this._clientRoleOptions=s.clientRoleOptions,this.handleSignalEvents()}async join(r,s,o){this.store.joinGatewayStart(),r.cloudProxyServer!=="disabled"&&(this.hasChangeBGPAddress=!0);const c=Date.now();let u=Hx.get(r.cname);if(u||(u=new Map,Hx.set(r.cname,u)),this._isProactiveJoin=!0,u.has(r.uid)){const E=new Oe(X.UID_CONFLICT);throw Rt.joinGateway(r.sid,{lts:c,succ:!1,ec:E.code,addr:null,uid:r.uid,cid:r.cid,firstSuccess:this._isProactiveJoin,avoidJoinStartTime:this.store.avoidJoinStart,isProxy:!!r.proxyServer,signalChannel:"0",preload:r.preload}),E}u.set(r.uid,!0),this.joinInfo=r,this.key=s;let h=0;this.joinGatewayStartTime=c;const m=r.proxyServer;try{L.debug("[".concat(this.store.clientId,"] use websocket join uid ").concat(h));const E=r.gatewayAddrs.map(S=>{let{address:R}=S;const[P,k]=R.split(":"),z={host:P,port:k};return r.proxyServer&&(z.proxy=r.proxyServer),z});h=(await this.signal.init(E)).uid,L.debug("[".concat(this.store.clientId,"] websocket join uid ").concat(h," cost ").concat(Date.now()-this.joinGatewayStartTime))}catch(E){var _;throw L.error("[".concat(this.store.clientId,"] User join failed"),E.toString()),Rt.joinGateway(r.sid,{lts:c,succ:!1,ec:((_=E.data)===null||_===void 0?void 0:_.desc)||E.code,errorMsg:E.message,addr:this.signal.url,uid:r.uid,cid:r.cid,firstSuccess:this._isProactiveJoin,avoidJoinStartTime:this.store.avoidJoinStart,isProxy:!!m,signalChannel:"0",preload:r.preload}),u.delete(r.uid),this.signal.close(),E}return this.state="CONNECTED",this.inChannelInfo.joinAt=Date.now(),L.debug("[".concat(this.store.clientId,"] Connected to gateway server")),this.trafficStatsInterval=window.setInterval(()=>{this.updateTrafficStats().catch(E=>{L.warning("[".concat(this.store.clientId,"] get traffic stats error"),E.toString())})},3e3),this.networkQualityInterval=window.setInterval(()=>{navigator&&navigator.onLine!==void 0&&!navigator.onLine?this.emit(es.NETWORK_QUALITY,{downlinkNetworkQuality:6,uplinkNetworkQuality:6}):this._signalTimeout?this.emit(es.NETWORK_QUALITY,{downlinkNetworkQuality:5,uplinkNetworkQuality:5}):this.state==="CONNECTED"&&this._statsCollector.trafficStats?this.emit(es.NETWORK_QUALITY,{uplinkNetworkQuality:tH(this._statsCollector.trafficStats.B_unq),downlinkNetworkQuality:tH(this._statsCollector.trafficStats.B_dnq)}):this.emit(es.NETWORK_QUALITY,{uplinkNetworkQuality:0,downlinkNetworkQuality:0})},2e3),this.store.joinGatewayEnd(),h}async leave(){let r=arguments.length>0&&arguments[0]!==void 0&&arguments[0],s=arguments.length>1?arguments[1]:void 0;if(this.state!=="DISCONNECTED"){s!==Bn.FALLBACK&&(this.state="DISCONNECTING");try{r||this.signal.connectionState!==lr.CONNECTED||await function(o,c){return c===1/0?o:lt.race([o,Xfe(c)])}(this.signal.request(jt.LEAVE,void 0,!0),3e3)}catch(o){L.warning("[".concat(this.store.clientId,"] leave request failed, ignore"),o)}this.signal.close(s),s!==Bn.FALLBACK&&(this.state="DISCONNECTED"),this.reset()}}async publish(r,s,o){if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new Oe(X.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));const c={state:"offer",p2p_id:this.store.p2pId,ortc:s,mode:this.spec.mode,extend:re("PUB_EXTEND"),twcc:!!re("PUBLISH_TWCC"),rtx:!!re("USE_PUB_RTX")};try{return(await this.signal.request(jt.PUBLISH,c,!0))._message}catch(u){if(o&&u.data&&u.data.code===Lt.ERR_PUBLISH_REQUEST_INVALID)return L.warning("[".concat(this.store.clientId,"] receive publish error code, retry"),u.toString()),await this.tryUnpubBeforeRepub(r,s),this.publish(r,s,!1);throw u}}async publishDataChannel(r,s,o){var c;if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new Oe(X.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));const u={stream_id:s.streamId,ordered:s.ordered?1:0,max_retrans_times:(c=s.maxRetransmits)!==null&&c!==void 0?c:10,channel_id:s.channelId,metadata:s.metadata};try{await this.signal.request(jt.PUBLISH_DATASTREAM,u,!0)}catch(h){if(o&&h.data&&h.data.code===Lt.ERR_PUBLISH_REQUEST_INVALID)return L.warning("[".concat(this.store.clientId,"] receive publish datachannels error code, retry"),h.toString()),await this.tryUnpubDataChannelBeforeRepub(r,s),this.publishDataChannel(r,s,!1);throw h}}async unpublish(r,s){try{if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new Oe(X.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));await this.signal.request(jt.UNPUBLISH,{stream_id:s,ortc:r},!0)}catch(o){L.warning("[".concat(this.store.clientId,"] unpublish warning: "),o)}}async unpublishDataChannel(r){try{if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new Oe(X.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));await lt.all(r.map(s=>this.signal.request(jt.UNPUBLISH_DATASTREAM,{channel_id:s},!0)))}catch(s){L.warning("unpublish datachannels warning: ",s)}}async presubscribe(r,s,o){if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new Oe(X.INVALID_OPERATION,"can not presubscribe when connection state is ".concat(this.state));const c={stream_id:r,stream_type:s,mode:this.spec.mode,codec:this.spec.codec,p2p_id:this.store.p2pId,twcc:!!re("SUBSCRIBE_TWCC"),rtx:!!re("USE_SUB_RTX")||void 0,extend:re("SUB_EXTEND"),svc:Array.isArray(re("SVC"))&&re("SVC").length!==0?re("SVC"):void 0};try{return await this.signal.request(jt.PRE_SUBSCRIBE,c,!0)}catch(u){if(o&&u.data&&u.data.code===Lt.ERR_SUBSCRIBE_REQUEST_INVALID)return L.warning("[".concat(this.store.clientId,"] pre-subscribe error, retry"),u.toString()),this.presubscribe(r,s,!1);throw u}}async subscribe(r,s,o){if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new Oe(X.INVALID_OPERATION,"can not subscribe when connection state is ".concat(this.state));const c={stream_id:r,stream_type:s.stream_type,mode:this.spec.mode,codec:this.spec.codec,p2p_id:this.store.p2pId,twcc:!!re("SUBSCRIBE_TWCC"),rtx:!!re("USE_SUB_RTX"),extend:re("SUB_EXTEND"),ssrcId:s.ssrcId,svc:Array.isArray(re("SVC"))&&re("SVC").length!==0?re("SVC"):void 0};try{return(await this.signal.request(jt.SUBSCRIBE,c,!0))._message}catch(u){if(o&&u.data&&u.data.code===Lt.ERR_SUBSCRIBE_REQUEST_INVALID)return L.warning("[".concat(this.store.clientId,"] receiver subscribe error code, retry"),u.toString()),await this.tryUnsubBeforeResub(r,s),await this.subscribe(r,s,!1);throw u}}async subscribeDataChannel(r,s,o){if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new Oe(X.INVALID_OPERATION,"can not subscribe datachannel when connection state is ".concat(this.state));const c={uid:r,stream_id:s.id,channel_id:s.datachannelId};try{return void await this.signal.request(jt.SUBSCRIBE_DATASTREAM,c,!0)}catch(u){if(o&&u.data&&u.data.code===Lt.ERR_SUBSCRIBE_REQUEST_INVALID)return L.warning("[".concat(this.store.clientId,"] receiver subscribe datachannel error code, retry"),u.toString()),await this.tryUnsubDataChannelBeforeResub(r,s),await this.subscribeDataChannel(r,s,!1);throw u}}async subscribeAll(r,s){if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new Oe(X.INVALID_OPERATION,"can not massSubscribe when connection state is ".concat(this.state));const o={p2p_id:this.store.p2pId,users:r,dtx:!1,rtx:!!re("USE_SUB_RTX"),twcc:!!re("SUBSCRIBE_TWCC"),svc:Array.isArray(re("SVC"))&&re("SVC").length!==0?re("SVC"):void 0};try{return await this.signal.request(jt.SUBSCRIBE_STREAMS,o,!0)}catch(c){if(s&&c.data&&c.data.code===Lt.ERR_SUBSCRIBE_REQUEST_INVALID)return L.warning("[".concat(this.store.clientId,"] receiver massSubscribe error code, retry"),c.toString()),await this.tryMassUnsubBeforeResub(r),await this.subscribeAll(r,!1);throw c}}async setVideoProfile(r){const s=function(o){if(!(o.bitrateMax&&o.bitrateMin&&o.frameRate&&o.height&&o.width))return;let c=o.frameRate,u=o.width,h=o.height,m=!0;return typeof c!="number"&&(c=c.exact||c.ideal||c.max||c.min||0,c||(m=!1)),typeof u!="number"&&(u=u.exact||u.ideal||u.max||u.min||0,u||(m=!1)),typeof h!="number"&&(h=h.exact||h.ideal||h.max||h.min||0,c||(m=!1)),m?{stream_type:0,width:u,height:h,fps:c,start_bps:1e3*o.bitrateMax,min_bps:1e3*o.bitrateMin,target_bps:1e3*o.bitrateMax}:void 0}(r);if(s)return this.signal.request(jt.SET_VIDEO_PROFILE,s);L.debug("[".concat(this.store.clientId,"] encoder config is not complete, do not report to gateway"))}async unsubscribe(r,s){try{await this.signal.request(jt.UNSUBSCRIBE,{p2p_id:this.store.p2pId,ortc:r,stream_id:s},!0)}catch(o){L.warning("[".concat(this.store.clientId,"] unsubscribe warning: "),o)}}async unsubscribeDataChannel(r,s){try{if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new Oe(X.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));await lt.all(r.map(o=>this.signal.request(jt.UNSUBSCRIBE_DATASTREAM,{stream_id:o,uid:s},!0)))}catch(o){L.warning("unsubscribeDataChannel warning: ",o)}}async massUnsubscribe(r){try{await this.signal.request(jt.UNSUBSCRIBE_STREAMS,r,!0)}catch(s){L.warning("[".concat(this.store.clientId,"] massUnsubscribeAll warning: "),s)}}async reconnectPC(r){const{iceParameters:s,dtlsParameters:o,rtpCapabilities:c}=r;return{gatewayEstablishParams:await this.signal.request(jt.CONNECT_PC,{p2p_id:this.store.p2pId,stream_id:this.store.uid,ortc:{iceParameters:s,dtlsParameters:o,rtpCapabilities:c}},!0),gatewayAddress:this.getCurrentGatewayAddress()}}getGatewayInfo(){return this.signal.request(jt.GATEWAY_INFO)}async renewToken(r){await this.signal.request(jt.RENEW_TOKEN,r),this.key=r.token}updateClientRole(r,s){s&&(this._clientRoleOptions=Object.assign({},s)),re("CLIENT_ROLE_OPTIONS")&&(L.debug("[".concat(this.store.clientId,"] Set roleOptions for ").concat(JSON.stringify(re("CLIENT_ROLE_OPTIONS"))," instead of ").concat(JSON.stringify(this._clientRoleOptions)," ")),this._clientRoleOptions=Object.assign({},re("CLIENT_ROLE_OPTIONS"))),this.role=r}async setClientRole(r,s){if(s&&(this._clientRoleOptions=Object.assign({},s)),re("CLIENT_ROLE_OPTIONS")&&(this._clientRoleOptions=Object.assign({},re("CLIENT_ROLE_OPTIONS")),L.debug("[".concat(this.store.clientId,"] Set roleOptions for ").concat(JSON.stringify(re("CLIENT_ROLE_OPTIONS"))," instead of ").concat(JSON.stringify(this._clientRoleOptions)," "))),this.state!=="CONNECTED")return void(this.role=r);let o,c=0;r==="audience"?this._clientRoleOptions&&this._clientRoleOptions.delay?(o=this._clientRoleOptions.delay,c=1):c=this._clientRoleOptions&&this._clientRoleOptions.level?this._clientRoleOptions.level:2:c=0,await this.signal.request(jt.SET_CLIENT_ROLE,{role:r,level:c,delay:o,client_ts:Date.now()}),this.role=r}async setRemoteVideoStreamType(r,s){await this.signal.request(jt.SWITCH_VIDEO_STREAM,{stream_id:r,stream_type:s})}async setDefaultRemoteVideoStreamType(r){await this.signal.request(jt.DEFAULT_VIDEO_STREAM,{stream_type:r})}async setStreamFallbackOption(r,s){await this.signal.request(jt.SET_FALLBACK_OPTION,{stream_id:r,fallback_type:s})}async pickSVCLayer(r,s){await this.signal.request(jt.PICK_SVC_LAYER,{stream_id:r,spatial_layer:s.spatialLayer,temporal_layer:s.temporalLayer})}async setRTM2Flag(r){await this.signal.request(jt.SET_RTM2_FLAG,{rtm2_flag:r})}async sendExtensionMessage(r,s,o){if(this.store.useP2P)return this.signal.sendExtensionMessage(r,s,o)}getInChannelInfo(){return this.inChannelInfo.joinAt&&(this.inChannelInfo.duration=Date.now()-this.inChannelInfo.joinAt),np({},this.inChannelInfo)}async getGatewayVersion(){return(await this.signal.request(jt.GATEWAY_INFO)).version}reset(){if(this.inChannelInfo.joinAt&&(this.inChannelInfo.duration=Date.now()-this.inChannelInfo.joinAt,this.inChannelInfo.joinAt=null),this.trafficStatsInterval&&(window.clearInterval(this.trafficStatsInterval),this.trafficStatsInterval=void 0),this.joinInfo){const r=Hx.get(this.joinInfo.cname);r&&r.delete(this.joinInfo.uid)}this.joinInfo=void 0,this.key=void 0,this.networkQualityInterval&&(window.clearInterval(this.networkQualityInterval),this.networkQualityInterval=void 0)}updateTurnConfigFromSignal(){if(!this.joinInfo)return;const r=function(s){let o;return o=s.startsWith("dc")?s.match(/(dc\:\/\/)?([^:]+):(\d+)/):s.match(/(wss\:\/\/)?([^:]+):(\d+)/),o?{username:ws.username,password:ws.password,turnServerURL:o[2],tcpport:parseInt(o[3])+30,udpport:parseInt(o[3])+30,forceturn:!1}:null}((this.joinInfo.cloudProxyServer==="disabled"?this.signal.url:this.joinInfo.gatewayAddrs[this.signal.currentURLIndex].address)||"");this.joinInfo.turnServer.serversFromGateway=[],r&&this.joinInfo.turnServer.mode!=="off"&&this.joinInfo.cloudProxyServer==="disabled"&&this.joinInfo.turnServer.serversFromGateway.push(np(np({},ws),{},{turnServerURL:r.turnServerURL,tcpport:r.tcpport,udpport:r.udpport,username:this.joinInfo.uid.toString(),password:this.joinInfo.token}))}async updateTrafficStats(){if(this.state!=="CONNECTED")return;const r=await this.signal.request(jt.TRAFFIC_STATS,void 0,!0);r.timestamp=Date.now(),r.ntp_offset!=null&&(this.ntpOffset=r.ntp_offset),r.peer_delay.forEach(s=>{const o=this._statsCollector.trafficStats&&this._statsCollector.trafficStats.peer_delay.find(c=>c.peer_uid===s.peer_uid);o&&o.B_st!==s.B_st&&BA(()=>{this.emit(es.STREAM_TYPE_CHANGE,s.peer_uid,s.B_st)})}),this._statsCollector.updateTrafficStats(r)}getJoinMessage(r){if(!this.joinInfo||!this.key)throw new Oe(X.UNEXPECTED_ERROR,"can not generate join message, no join info");const s=Object.assign({},this.joinInfo.apResponse);let o=re("REPORT_APP_SCENARIO");if(typeof o!="string")try{o=JSON.stringify(o)}catch{o=void 0}var c;o&&o.length>128&&(o=void 0),this.store.hasStartJoinChannel=!0,this.store.isABTestSuccess||this.emit(es.UPDATE_GATEWAY_CONFIG),c=this.store.clientId,ot(Kv).call(Kv,c)||Kv.push(c);const u=!(Dr()||FW(87)||A8())&&typeof re("ENABLE_PRE_SUB")=="boolean"&&re("ENABLE_PRE_SUB"),h=!A8()&&bl("ENABLE_PREALLOC_PC","boolean"),m=wme(),_=hT(87)||function(){const S=Rn();if(S.name!==Un.SAFARI||!S.browserVersion)return!1;const R=S.browserVersion.split(".");return Number(R[0])>15||Number(R[0])===15&&Number(R[1])>=4}(),E=np({license:this.joinInfo.license,p2p_id:this.store.p2pId,session_id:this.joinInfo.sid,app_id:this.joinInfo.appId,channel_key:this.key,channel_name:this.joinInfo.cname,sdk_version:yl,browser:navigator.userAgent,process_id:re("PROCESS_ID"),mode:this.store.useP2P?"p2p":this.spec.mode,codec:this.spec.codec,role:this.role,has_changed_gateway:this.hasChangeBGPAddress,ap_response:s,extend:re("JOIN_EXTEND"),details:{6:this.joinInfo.stringUid,cservice_map:this.joinInfo.cloudProxyServer==="proxy3"?"1":this.joinInfo.cloudProxyServer==="proxy5"?"2":void 0},features:{rejoin:!0},optionalInfo:this.joinInfo.optionalInfo,appScenario:o,attributes:{userAttributes:np({enableEncodedTransform:!!re("ENABLE_AUDIO_METADATA")&&_||!!re("ENABLE_AUDIO_TOPN")&&VL(Un.CHROME,87,116)||void 0,enableAudioMetadata:!!re("ENABLE_AUDIO_METADATA")&&_,enableAudioPts:!!re("ENABLE_AUDIO_PTS_METADATA")&&_,topnSmoothLevel:re("TOPN_SMOOTH_LEVEL"),topnNewSpeakerDelay:re("TOPN_NEW_SPEAKER_DELAY"),topnSwitchHoldMs:re("TOPN_SWITCH_HOLD_MS"),topnAudioGain:re("TOPN_AUDIO_GAIN"),enablePublishedUserList:re("ENABLE_PUBLISHED_USER_LIST"),maxSubscription:re("MAX_SUBSCRIPTION"),subscribeAudioFilterTopN:bl("SUBSCRIBE_AUDIO_FILTER_TOPN","number"),enablePublishAudioFilter:bl("ENABLE_PUBLISH_AUDIO_FILTER","boolean"),enableUserLicenseCheck:bl("ENABLE_USER_LICENSE_CHECK","boolean"),enableRTX:re("USE_PUB_RTX")===!0||re("USE_SUB_RTX")===!0||void 0,disableFEC:re("DISABLE_FEC"),enableNTPReport:!!re("ENABLE_NTP_REPORT")||void 0,enableInstantVideo:!!re("ENABLE_INSTANT_VIDEO")||void 0,enableFulllinkAvSync:!!re("ENABLE_FULL_LINK_AV_SYNC")||void 0,enableDataStream2:bl("ENABLE_DATASTREAM_2","boolean"),enableAutFeedback:!!re("ENABLE_AUT_FEEDBACK")||void 0,rtm2Flag:typeof this.joinInfo.rtmFlag=="number"?this.joinInfo.rtmFlag:void 0,enableUserAutoRebalanceCheck:!!re("ENABLE_USER_AUTO_REBALANCE_CHECK"),enableXR:bl("USE_XR","boolean"),enableLossbasedBwe:bl("ENABLE_LOSSBASED_BWE","boolean"),enableAutCC:!!re("ENABLE_AUT_CC")||void 0,enableCCFallback:bl("ENABLE_CC_FALLBACK","boolean"),enablePreallocPC:h,preSubNum:u?bl("PRE_SUB_NUM","number"):void 0,enablePubTWCC:bl("PUBLISH_TWCC","boolean"),enableSubTWCC:bl("SUBSCRIBE_TWCC","boolean"),enablePubRTX:bl("USE_PUB_RTX","boolean"),enableSubRTX:bl("USE_SUB_RTX","boolean"),enableSubSVC:re("ENABLE_SVC")?re("ENABLE_SVC_DEFAULT_CODECS"):Array.isArray(re("SVC"))&&re("SVC").length!==0?re("SVC"):void 0,enableSvcExtended:re("ENABLE_SVC")&&Array.isArray(re("SVC_EXTENDED"))&&re("SVC_EXTENDED").length!==0?re("SVC_EXTENDED"):void 0},m)},join_ts:this.joinGatewayStartTime},r);return this.joinInfo.stringUid&&(E.string_uid=this.joinInfo.stringUid),this.joinInfo.aesmode&&this.joinInfo.aespassword&&(E.aes_mode=this.joinInfo.aesmode,re("ENCRYPT_AES")?(E.aes_secret=this.joinInfo.aespassword,E.aes_encrypt=!0):E.aes_secret=this.joinInfo.aespassword,this.joinInfo.aessalt&&(E.aes_salt=this.joinInfo.aessalt)),s.addresses[this.signal.websocket.currentURLIndex]&&(E.ap_response.ticket=s.addresses[this.signal.websocket.currentURLIndex].ticket,delete s.addresses),this.joinInfo.defaultVideoStream!==void 0&&(E.default_video_stream=this.joinInfo.defaultVideoStream),E}getRejoinMessage(){if(!this.joinInfo)throw new Oe(X.UNEXPECTED_ERROR,"can not generate rejoin message, no join info");return{session_id:this.joinInfo.sid,channel_name:this.joinInfo.cname,cid:this.joinInfo.cid,uid:this.joinInfo.uid,vid:Number(this.joinInfo.vid)}}handleSignalEvents(){this.signal.on(Wt.WS_RECONNECT_CREATE_CONNECTION,r=>{this.joinGatewayStartTime=Date.now()}),this.signal.on(Wt.WS_RECONNECTING,r=>{this.joinInfo&&Rt.WebSocketQuit(this.joinInfo.sid,{lts:Date.now(),succ:-1,cname:this.joinInfo.cname,uid:this.joinInfo.uid,cid:this.joinInfo.cid,errorCode:r||bs.NETWORK_ERROR}),this.joinInfo&&(this.state="RECONNECTING",Rt.sessionInit(this.joinInfo.sid,{lts:new Date().getTime(),extend:this.isSignalRecover?{recover:!0}:{rejoin:!0},cname:this.joinInfo.cname,appid:this.joinInfo.appId,mode:this.spec.mode,stringUid:this.joinInfo.stringUid,channelProfile:this.spec.mode==="live"?1:0,channelMode:0,lsid:this.joinInfo.sid,clientRole:this.role==="audience"?2:1,buildFormat:1}),this.isSignalRecover=!1,this.joinGatewayStartTime=Date.now())}),this.signal.on(Wt.WS_CLOSED,r=>{let s;switch(r){case Bn.LEAVE:s=bs.LEAVE;break;case Bn.UID_BANNED:case Bn.IP_BANNED:case Bn.CHANNEL_BANNED:case Bn.SERVER_ERROR:s=bs.SERVER_ERROR;break;case Bn.FALLBACK:s=bs.FALLBACK;break;case Bn.LICENSE_MISSING:case Bn.LICENSE_EXPIRED:case Bn.LICENSE_MINUTES_EXCEEDED:case Bn.LICENSE_PERIOD_INVALID:case Bn.LICENSE_MULTIPLE_SDK_SERVICE:case Bn.LICENSE_ILLEGAL:case Bn.TOKEN_EXPIRE:s=r;break;default:s=bs.NETWORK_ERROR}L.debug("[".concat(this.store.clientId,"] [signal] websocket closed, reason: ").concat(s||"undefined -> "+bs.NETWORK_ERROR)),this.joinInfo&&Rt.WebSocketQuit(this.joinInfo.sid,{lts:Date.now(),succ:r===Bn.LEAVE?1:-1,cname:this.joinInfo.cname,uid:this.joinInfo.uid,cid:this.joinInfo.cid,errorCode:s}),this._disconnectedReason=r,r!==Bn.FALLBACK&&(this.state="DISCONNECTED"),this.reset()}),this.signal.on(Wt.WS_CONNECTED,()=>{if(this.updateTurnConfigFromSignal(),this.state="CONNECTED",this.joinInfo){if(this.role==="audience"){const r=re("CLIENT_ROLE_OPTIONS")||this._clientRoleOptions;r&&(r.level||r.delay)&&(L.debug("[".concat(this.store.clientId,"] patch to send set client role, role: ").concat(this.role,", mode: ").concat(this.spec.mode,", level: ").concat(r.level,", delay: ").concat(r.delay)),this.setClientRole(this.role,r))}if(Rt.joinGateway(this.joinInfo.sid,{lts:this.joinGatewayStartTime,succ:!0,ec:null,vid:this.joinInfo.vid,addr:this.signal.url,uid:this.joinInfo.uid,cid:this.joinInfo.cid,firstSuccess:this._isProactiveJoin,avoidJoinStartTime:this.store.avoidJoinStart,isProxy:!!this.joinInfo.proxyServer,signalChannel:"0",preload:this.joinInfo.preload,isABTestSuccess:this.store.isABTestSuccess}),this._isProactiveJoin=!1,this.joinInfo.useLocalAccessPoint&&this.joinInfo.setLocalAPVersion===1){const r=this.signal.url&&this.signal.url.match(/wss\:\/\/([^:]+):(\d+)/);if(!r)return void L.error("[".concat(this.store.clientId,"] set local access point after joined failed: ").concat(r));Xn("EVENT_REPORT_DOMAIN",r[1]),Xn("EVENT_REPORT_BACKUP_DOMAIN",r[1]),Xn("LOG_UPLOAD_SERVER","".concat(r[1],":6444"))}}}),this.signal.on(_n.ON_UPLINK_STATS,r=>{this._statsCollector.updateUplinkStats(r)}),this.signal.on(Wt.REQUEST_RECOVER,(r,s,o)=>{if(!this.joinInfo)return o(new Oe(X.UNEXPECTED_ERROR,"gateway: can not recover, no join info"));r&&(this.joinInfo.multiIP=r,this.hasChangeBGPAddress=!0),this.isSignalRecover=!0,Ts(this,es.REQUEST_NEW_GATEWAY_LIST).then(s).catch(o)}),this.signal.on(Wt.REQUEST_JOIN_INFO,async(r,s,o)=>{var c;if(this.updateTurnConfigFromSignal(),this.store.useP2P)return void r(this.getJoinMessage({ortc:{}}));const u=Mr((c=this.joinInfo)===null||c===void 0?void 0:c.turnServer);if(re("NEW_TURN_MODE")&&u){let E=u.servers,S=u.serversFromGateway;const R=this.signal.currentURLIndex;E.length>0&&(E=[E[R%E.length]],u.servers=E),Array.isArray(S)&&S.length>0&&(S=[S[0]],u.serversFromGateway=S),L.debug("[".concat(this.store.clientId,"] use single turn, use turn server index: ").concat(R))}const{iceParameters:h,dtlsParameters:m,rtpCapabilities:_}=await Ts(this,es.REQUEST_P2P_CONNECTION_PARAMS,{turnServer:u});try{r(this.getJoinMessage({ortc:{iceParameters:h,dtlsParameters:m,rtpCapabilities:_,version:"2"}}))}catch(E){s(E)}}),this.signal.on(Wt.REQUEST_REJOIN_INFO,r=>{r(this.getRejoinMessage())}),this.signal.on(Wt.REPORT_JOIN_GATEWAY,(r,s)=>{if(!this.joinInfo)return;let o,c="";var u;r instanceof Oe?(o=((u=r.data)===null||u===void 0?void 0:u.desc)||r.code,c=r.message):o=r,Rt.joinGateway(this.joinInfo.sid,{lts:this.joinGatewayStartTime,succ:!1,ec:o,errorMsg:c,addr:s,uid:this.joinInfo.uid,cid:this.joinInfo.cid,firstSuccess:this._isProactiveJoin,avoidJoinStartTime:this.store.avoidJoinStart,isProxy:!!this.joinInfo.proxyServer,signalChannel:"0",preload:this.joinInfo.preload})}),this.signal.on(Wt.IS_P2P_DISCONNECTED,r=>{r(_T(this,es.IS_P2P_DISCONNECTED))}),this.signal.on(Wt.DISCONNECT_P2P,()=>{this.emit(es.DISCONNECT_P2P)}),this.signal.on(Wt.REQUEST_SUCCESS,()=>{this._signalTimeout=!1}),this.signal.on(Wt.REQUEST_TIMEOUT,()=>{this._signalTimeout=!0}),this.signal.on(Wt.JOIN_RESPONSE,r=>{const s=this.getCurrentGatewayAddress();this.emit(es.JOIN_RESPONSE,r,s)}),this.signal.on(Wt.PRE_CONNECT_PC,async()=>{if(this.joinInfo){this.updateTurnConfigFromSignal();const r=this.getCurrentGatewayAddress(),s=re("FINGERPRINT")||this.joinInfo.apResponse.addresses[this.signal.currentURLIndex].fingerprint;if(r&&s){const o=lH(r);this.emit(es.PRE_CONNECT_PC,{candidates:o,fingerprint:s})}}}),this.signal.on(Wt.RECOVER_NOTIFICATION,r=>{this.joinInfo&&typeof re("AP_REQUEST_DETAIL")=="string"&&(this.joinInfo.apRequestDetail="".concat(re("AP_REQUEST_DETAIL"),";").concat(r))})}async tryUnsubBeforeResub(r,s){try{await this.signal.request(jt.UNSUBSCRIBE,{p2p_id:this.store.p2pId,stream_id:r,ortc:[s]},!0)}catch(o){throw L.warning("[".concat(this.store.clientId,"] tryUnsubBeforeResub warning"),o),o}}async tryUnsubDataChannelBeforeResub(r,s){try{await this.signal.request(jt.UNSUBSCRIBE,{stream_id:s.id},!0)}catch(o){throw L.warning("unsubscribe datachannel warning",o),o}}async tryUnpubBeforeRepub(r,s){try{await this.signal.request(jt.UNPUBLISH,{stream_id:r,ortc:s},!0)}catch(o){throw L.warning("[".concat(this.store.clientId,"] tryUnpubBeforeRepub warning: "),o),o}}async tryUnpubDataChannelBeforeRepub(r,s){try{await this.signal.request(jt.UNPUBLISH_DATASTREAM,{channnel_id:s.channelId},!0)}catch(o){throw L.warning("unpublish datastream warning: ",o),o}}async tryMassUnsubBeforeResub(r){const s={users:r.map(o=>({stream_id:o.stream_id,stream_type:o.stream_type}))};try{await this.signal.request(jt.UNSUBSCRIBE_STREAMS,s,!0)}catch(o){throw L.warning("[".concat(this.store.clientId,"] tryMassUnsubBeforeResub warning"),o),o}}async muteLocal(r,s){const o={action:r.find(c=>c.stream_type===zn.Audio)?"mute_local_audio":"mute_local_video",p2p_id:this.store.p2pId,ortc:r,stream_id:s};try{await this.signal.request(jt.CONTROL,o,!0,!0)}catch(c){throw L.warning("[".concat(this.store.clientId,"] gateway muteLocal warning: "),c),c}}async unmuteLocal(r,s){const o={action:r.find(c=>c.stream_type===zn.Audio)?"unmute_local_audio":"unmute_local_video",p2p_id:this.store.p2pId,ortc:r,stream_id:s};try{await this.signal.request(jt.CONTROL,o,!0,!0)}catch(c){throw L.warning("[".concat(this.store.clientId,"] gateway unmuteLocal warning: "),c),c}}async muteRemote(r,s){const o={action:r===gt.AUDIO?"mute_remote_audio":"mute_remote_video",p2p_id:this.store.p2pId,stream_id:s};try{await this.signal.request(jt.CONTROL,o,!0,!0)}catch(c){throw L.warning("[".concat(this.store.clientId,"] gateway muteRemote warning: "),c),c}}async unmuteRemote(r,s){const o={action:r===gt.AUDIO?"unmute_remote_audio":"unmute_remote_video",p2p_id:this.store.p2pId,stream_id:s};try{await this.signal.request(jt.CONTROL,o,!0,!0)}catch(c){throw L.warning("[".concat(this.store.clientId,"] gateway unmuteRemote warning: "),c),c}}uploadWRTCStats(r){this.signal.uploadWRTCStats(r)}upload(r,s){this.signal.upload(r,s)}getSignalRTT(){return this.signal.rtt}async restartICE(r){const s={p2p_id:this.store.p2pId,stream_id:this.store.uid,ortc:r};try{return await this.signal.request(jt.RESTART_ICE,s,!0)}catch(o){throw L.warning("[".concat(this.store.clientId,"] P2PChannel.restartICE warning: "),o),o}}reconnect(r,s){this.state==="CONNECTED"&&this.signal.reconnect(r||void 0,s||bs.P2P_FAILED)}getCurrentGatewayAddress(){var r,s;if(!re("GATEWAY_WSS_ADDRESS"))return re("USE_CANDIDATE_FROM_AP_DETAIL")&&(r=this.joinInfo)!==null&&r!==void 0&&r.apGatewayAddress?(L.debug("[".concat(this.store.clientId,"] use candidate from ap detail, ").concat(JSON.stringify(this.joinInfo.apGatewayAddress))),this.joinInfo.apGatewayAddress):(s=this.joinInfo)!==null&&s!==void 0&&s.gatewayAddrs?this.joinInfo.gatewayAddrs[this.signal.currentURLIndex]:void 0}async setPublishAudioFilterEnabled(r){await this.signal.request(jt.SET_PARAMETER,{enablePublishAudioFilter:r})}}let bP=0,$x=0;function Ed(t,r,s,o){return new lt((c,u)=>{r.timeout=r.timeout||re("HTTP_CONNECT_TIMEOUT"),r.responseType=r.responseType||"json",r.data&&!s?(r.data=JSON.stringify(r.data),bP+=gh(r.data)):s&&(r.data.size?bP+=r.data.size:r.data instanceof FormData?bP+=r8(r.data):bP+=gh(JSON.stringify(r.data))),r.headers=r.headers||{},r.headers["Content-Type"]=r.headers["Content-Type"]||"application/json",r.method="POST",r.url=t,$o.request(r).then(h=>{typeof h.data=="string"?$x+=gh(h.data):h.data instanceof ArrayBuffer||h.data instanceof Uint8Array?$x+=h.data.byteLength:$x+=gh(JSON.stringify(h.data)),o&&c({data:h.data,headers:h.headers}),c(h.data)}).catch(h=>{$o.isCancel(h)?u(new Oe(X.OPERATION_ABORTED,"cancel token canceled")):h.code==="ECONNABORTED"?u(new Oe(X.NETWORK_TIMEOUT,h.message)):h.response?u(new Oe(X.NETWORK_RESPONSE_ERROR,h.response.status)):u(new Oe(X.NETWORK_ERROR,h.message))})})}/*! formdata-polyfill. MIT License. Jimmy W?rting <https://jimmy.warting.se/opensource> */(function(){var t;function r(je){var st=0;return function(){return st<je.length?{done:!1,value:je[st++]}:{done:!0}}}var s=typeof Object.defineProperties=="function"?Object.defineProperty:function(je,st,Tt){return je==Array.prototype||je==Object.prototype||(je[st]=Tt.value),je},o,c=function(je){je=[typeof globalThis=="object"&&globalThis,je,typeof window=="object"&&window,typeof self=="object"&&self,typeof a=="object"&&a];for(var st=0;st<je.length;++st){var Tt=je[st];if(Tt&&Tt.Math==Math)return Tt}throw Error("Cannot find global object")}(this);function u(je,st){if(st)e:{var Tt=c;je=je.split(".");for(var We=0;We<je.length-1;We++){var x=je[We];if(!(x in Tt))break e;Tt=Tt[x]}(st=st(We=Tt[je=je[je.length-1]]))!=We&&st!=null&&s(Tt,je,{configurable:!0,writable:!0,value:st})}}function h(je){return(je={next:je})[Symbol.iterator]=function(){return this},je}function m(je){var st=typeof Symbol<"u"&&Symbol.iterator&&je[Symbol.iterator];return st?st.call(je):{next:r(je)}}if(u("Symbol",function(je){function st(x,ie){this.A=x,s(this,"description",{configurable:!0,writable:!0,value:ie})}if(je)return je;st.prototype.toString=function(){return this.A};var Tt="jscomp_symbol_"+(1e9*Math.random()>>>0)+"_",We=0;return function x(ie){if(this instanceof x)throw new TypeError("Symbol is not a constructor");return new st(Tt+(ie||"")+"_"+We++,ie)}}),u("Symbol.iterator",function(je){if(je)return je;je=Symbol("Symbol.iterator");for(var st="Array Int8Array Uint8Array Uint8ClampedArray Int16Array Uint16Array Int32Array Uint32Array Float32Array Float64Array".split(" "),Tt=0;Tt<st.length;Tt++){var We=c[st[Tt]];typeof We=="function"&&typeof We.prototype[je]!="function"&&s(We.prototype,je,{configurable:!0,writable:!0,value:function(){return h(r(this))}})}return je}),typeof Object.setPrototypeOf=="function")o=Object.setPrototypeOf;else{var _;e:{var E={};try{E.__proto__={a:!0},_=E.a;break e}catch{}_=!1}o=_?function(je,st){if(je.__proto__=st,je.__proto__!==st)throw new TypeError(je+" is not extensible");return je}:null}var S=o;function R(){this.m=!1,this.j=null,this.v=void 0,this.h=1,this.u=this.C=0,this.l=null}function P(je){if(je.m)throw new TypeError("Generator is already running");je.m=!0}function k(je,st){return je.h=3,{value:st}}function z(je){this.g=new R,this.G=je}function U(je,st,Tt,We){try{var x=st.call(je.g.j,Tt);if(!(x instanceof Object))throw new TypeError("Iterator result "+x+" is not an object");if(!x.done)return je.g.m=!1,x;var ie=x.value}catch(de){return je.g.j=null,je.g.s(de),F(je)}return je.g.j=null,We.call(je.g,ie),F(je)}function F(je){for(;je.g.h;)try{var st=je.G(je.g);if(st)return je.g.m=!1,{value:st.value,done:!1}}catch(Tt){je.g.v=void 0,je.g.s(Tt)}if(je.g.m=!1,je.g.l){if(st=je.g.l,je.g.l=null,st.F)throw st.D;return{value:st.return,done:!0}}return{value:void 0,done:!0}}function q(je){this.next=function(st){return je.o(st)},this.throw=function(st){return je.s(st)},this.return=function(st){return function(Tt,We){P(Tt.g);var x=Tt.g.j;return x?U(Tt,"return"in x?x.return:function(ie){return{value:ie,done:!0}},We,Tt.g.return):(Tt.g.return(We),F(Tt))}(je,st)},this[Symbol.iterator]=function(){return this}}function Y(je,st){return st=new q(new z(st)),S&&je.prototype&&S(st,je.prototype),st}if(R.prototype.o=function(je){this.v=je},R.prototype.s=function(je){this.l={D:je,F:!0},this.h=this.C||this.u},R.prototype.return=function(je){this.l={return:je},this.h=this.u},z.prototype.o=function(je){return P(this.g),this.g.j?U(this,this.g.j.next,je,this.g.o):(this.g.o(je),F(this))},z.prototype.s=function(je){return P(this.g),this.g.j?U(this,this.g.j.throw,je,this.g.o):(this.g.s(je),F(this))},u("Array.prototype.entries",function(je){return je||function(){return function(st,Tt){st instanceof String&&(st+="");var We=0,x=!1,ie={next:function(){if(!x&&We<st.length){var de=We++;return{value:Tt(de,st[de]),done:!1}}return x=!0,{done:!0,value:void 0}}};return ie[Symbol.iterator]=function(){return ie},ie}(this,function(st,Tt){return[st,Tt]})}}),typeof Blob<"u"&&(typeof FormData>"u"||!FormData.prototype.keys)){var le=function(je,st){for(var Tt=0;Tt<je.length;Tt++)st(je[Tt])},ye=function(je){return je.replace(/\r?\n|\r/g,`\r
`)},Ee=function(je,st,Tt){return st instanceof Blob?(Tt=Tt!==void 0?Tt+"":typeof st.name=="string"?st.name:"blob",st.name===Tt&&Object.prototype.toString.call(st)!=="[object Blob]"||(st=new File([st],Tt)),[String(je),st]):[String(je),String(st)]},me=function(je,st){if(je.length<st)throw new TypeError(st+" argument required, but only "+je.length+" present.")},ke=typeof globalThis=="object"?globalThis:typeof window=="object"?window:typeof self=="object"?self:this,Ye=ke.FormData,ut=ke.XMLHttpRequest&&ke.XMLHttpRequest.prototype.send,pt=ke.Request&&ke.fetch,vn=ke.navigator&&ke.navigator.sendBeacon,Sn=ke.Element&&ke.Element.prototype,cr=ke.Symbol&&Symbol.toStringTag;cr&&(Blob.prototype[cr]||(Blob.prototype[cr]="Blob"),"File"in ke&&!File.prototype[cr]&&(File.prototype[cr]="File"));try{new File([],"")}catch{ke.File=function(st,Tt,We){return st=new Blob(st,We||{}),Object.defineProperties(st,{name:{value:Tt},lastModified:{value:+(We&&We.lastModified!==void 0?new Date(We.lastModified):new Date)},toString:{value:function(){return"[object File]"}}}),cr&&Object.defineProperty(st,cr,{value:"File"}),st}}var ei=function(je){return je.replace(/\n/g,"%0A").replace(/\r/g,"%0D").replace(/"/g,"%22")},Wr=function(je){this.i=[];var st=this;je&&le(je.elements,function(Tt){if(Tt.name&&!Tt.disabled&&Tt.type!=="submit"&&Tt.type!=="button"&&!Tt.matches("form fieldset[disabled] *"))if(Tt.type==="file"){var We=Tt.files&&Tt.files.length?Tt.files:[new File([],"",{type:"application/octet-stream"})];le(We,function(x){st.append(Tt.name,x)})}else Tt.type==="select-multiple"||Tt.type==="select-one"?le(Tt.options,function(x){!x.disabled&&x.selected&&st.append(Tt.name,x.value)}):Tt.type==="checkbox"||Tt.type==="radio"?Tt.checked&&st.append(Tt.name,Tt.value):(We=Tt.type==="textarea"?ye(Tt.value):Tt.value,st.append(Tt.name,We))})};if((t=Wr.prototype).append=function(je,st,Tt){me(arguments,2),this.i.push(Ee(je,st,Tt))},t.delete=function(je){me(arguments,1);var st=[];je=String(je),le(this.i,function(Tt){Tt[0]!==je&&st.push(Tt)}),this.i=st},t.entries=function je(){var st,Tt=this;return Y(je,function(We){if(We.h==1&&(st=0),We.h!=3)return st<Tt.i.length?We=k(We,Tt.i[st]):(We.h=0,We=void 0),We;st++,We.h=2})},t.forEach=function(je,st){me(arguments,1);for(var Tt=m(this),We=Tt.next();!We.done;We=Tt.next()){var x=m(We.value);We=x.next().value,x=x.next().value,je.call(st,x,We,this)}},t.get=function(je){me(arguments,1);var st=this.i;je=String(je);for(var Tt=0;Tt<st.length;Tt++)if(st[Tt][0]===je)return st[Tt][1];return null},t.getAll=function(je){me(arguments,1);var st=[];return je=String(je),le(this.i,function(Tt){Tt[0]===je&&st.push(Tt[1])}),st},t.has=function(je){me(arguments,1),je=String(je);for(var st=0;st<this.i.length;st++)if(this.i[st][0]===je)return!0;return!1},t.keys=function je(){var st,Tt,We,x,ie=this;return Y(je,function(de){if(de.h==1&&(st=m(ie),Tt=st.next()),de.h!=3)return Tt.done?void(de.h=0):(We=Tt.value,x=m(We),k(de,x.next().value));Tt=st.next(),de.h=2})},t.set=function(je,st,Tt){me(arguments,2),je=String(je);var We=[],x=Ee(je,st,Tt),ie=!0;le(this.i,function(de){de[0]===je?ie&&(ie=!We.push(x)):We.push(de)}),ie&&We.push(x),this.i=We},t.values=function je(){var st,Tt,We,x,ie=this;return Y(je,function(de){if(de.h==1&&(st=m(ie),Tt=st.next()),de.h!=3)return Tt.done?void(de.h=0):(We=Tt.value,(x=m(We)).next(),k(de,x.next().value));Tt=st.next(),de.h=2})},Wr.prototype._asNative=function(){for(var je=new Ye,st=m(this),Tt=st.next();!Tt.done;Tt=st.next()){var We=m(Tt.value);Tt=We.next().value,We=We.next().value,je.append(Tt,We)}return je},Wr.prototype._blob=function(){var je="----formdata-polyfill-"+Math.random(),st=[],Tt="--"+je+`\r
Content-Disposition: form-data; name="`;return this.forEach(function(We,x){return typeof We=="string"?st.push(Tt+ei(ye(x))+`"\r
\r
`+ye(We)+`\r
`):st.push(Tt+ei(ye(x))+'"; filename="'+ei(We.name)+`"\r
Content-Type: `+(We.type||"application/octet-stream")+`\r
\r
`,We,`\r
`)}),st.push("--"+je+"--"),new Blob(st,{type:"multipart/form-data; boundary="+je})},Wr.prototype[Symbol.iterator]=function(){return this.entries()},Wr.prototype.toString=function(){return"[object FormData]"},Sn&&!Sn.matches&&(Sn.matches=Sn.matchesSelector||Sn.mozMatchesSelector||Sn.msMatchesSelector||Sn.oMatchesSelector||Sn.webkitMatchesSelector||function(je){for(var st=(je=(this.document||this.ownerDocument).querySelectorAll(je)).length;0<=--st&&je.item(st)!==this;);return-1<st}),cr&&(Wr.prototype[cr]="FormData"),ut){var Qo=ke.XMLHttpRequest.prototype.setRequestHeader;ke.XMLHttpRequest.prototype.setRequestHeader=function(je,st){Qo.call(this,je,st),je.toLowerCase()==="content-type"&&(this.B=!0)},ke.XMLHttpRequest.prototype.send=function(je){je instanceof Wr?(je=je._blob(),this.B||this.setRequestHeader("Content-Type",je.type),ut.call(this,je)):ut.call(this,je)}}pt&&(ke.fetch=function(je,st){return st&&st.body&&st.body instanceof Wr&&(st.body=st.body._blob()),pt.call(this,je,st)}),vn&&(ke.navigator.sendBeacon=function(je,st){return st instanceof Wr&&(st=st._asNative()),vn.call(this,je,st)}),ke.FormData=Wr}})();const NT=()=>{const t=re("AREAS");return t.length===0&&t.push(Vn.GLOBAL),Ya(t).call(t,(r,s,o)=>{const c=bH(s);return c?o===0?c:"".concat(r,",").concat(c):r},"")},bH=t=>t===Vn.OVERSEA?"".concat(Ns.ASIA,",").concat(Ns.EUROPE,",").concat(Ns.AFRICA,",").concat(Ns.NORTH_AMERICA,",").concat(Ns.SOUTH_AMERICA,",").concat(Ns.OCEANIA):Ns[t],Cme=t=>{const r={CODE:"",WEBCS_DOMAIN:[],WEBCS_DOMAIN_BACKUP_LIST:[],PROXY_CS:[],CDS_AP:[],ACCOUNT_REGISTER:[],UAP_AP:[],EVENT_REPORT_DOMAIN:[],EVENT_REPORT_BACKUP_DOMAIN:[],LOG_UPLOAD_SERVER:[],PROXY_SERVER_TYPE3:[]};return t.map(s=>{const o=pP[s],c=Object.keys(o);c&&c.map(u=>{u!=="CODE"&&(r[u]=r[u].concat(o[u]))})}),r},TP={GLOBAL:{ASIA:[Vn.CHINA,Vn.JAPAN,Vn.INDIA,Vn.KOREA,Vn.HKMC],EUROPE:[],NORTH_AMERICA:[Vn.US],SOUTH_AMERICA:[],OCEANIA:[],AFRICA:[]}},wP=Object.keys(TP[Vn.GLOBAL]),Kx=[Vn.CHINA,Vn.NORTH_AMERICA,Vn.EUROPE,Vn.ASIA,Vn.JAPAN,Vn.INDIA,Vn.OCEANIA,Vn.SOUTH_AMERICA,Vn.AFRICA,Vn.KOREA,Vn.HKMC,Vn.US],Ime=function(t,r){let s=[];if(ot(t).call(t,Vn.GLOBAL)){const u=[Vn.GLOBAL,Vn.OVERSEA],h=Object.keys(pP);if(r===Vn.GLOBAL)throw new Oe(X.INVALID_PARAMS,"GLOBAL is an invalid excludedArea value");if(r===Vn.CHINA)s=[Vn.OVERSEA];else if(c=r,ot(wP).call(wP,c)){const m=(o=r,TP[Vn.GLOBAL][o]||[]),_=[...u,r,...m];s=h.filter(E=>!ot(_).call(_,E))}else if(function(m){let _=!1;return wP.forEach(E=>{var S;ot(S=TP[Vn.GLOBAL][E]).call(S,m)&&(_=!0)}),_}(r)){const m=function(E){let S;return wP.forEach(R=>{var P;ot(P=TP[Vn.GLOBAL][R]).call(P,E)&&(S=R)}),S}(r),_=[...u,m,r];s=h.filter(E=>!ot(_).call(_,E))}else s=t;s=function(m){const _=[];return Kx.forEach(E=>{ot(m).call(m,E)&&_.push(E)}),_.concat(m.filter(E=>!ot(Kx).call(Kx,E)))}(s)}else s=t;var o,c;return s};function TH(t){var r,s;if(!t&&ot(r=re("AREAS")).call(r,Vn.EXTENSIONS))return L.debug("update area from ap : reset"),void qx(Mpe,!0);if(!ot(s=re("AREAS")).call(s,Vn.GLOBAL)||!t)return;let o=pP.EXTENSIONS;o&&(o={CODE:bH(Vn.EXTENSIONS),WEBCS_DOMAIN:["ap-web-1-".concat(t,".agora.io")],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-".concat(t,".ap.sd-rtn.com")],PROXY_CS:["proxy-ap-web-".concat(t,".agora.io")],CDS_AP:["cds-ap-web-1-".concat(t,".agora.io"),"cds-ap-web-2-".concat(t,".ap.sd-rtn.com")],ACCOUNT_REGISTER:["sua-ap-web-1-".concat(t,".agora.io"),"sua-ap-web-2-".concat(t,".ap.sd-rtn.com")],UAP_AP:["uap-ap-web-1-".concat(t,".agora.io"),"uap-ap-web-2-".concat(t,".ap.sd-rtn.com")],EVENT_REPORT_DOMAIN:["statscollector-1-".concat(t,".agora.io")],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-".concat(t,".agora.io")],LOG_UPLOAD_SERVER:["logservice-".concat(t,".agora.io")],PROXY_SERVER_TYPE3:["webrtc-cloud-proxy-".concat(t,".agora.io")]},L.debug("update area from ap success: ".concat(t,",config is "),o),Xn("AREAS",[Vn.EXTENSIONS],!0),Object.keys(o).map(c=>{c==="LOG_UPLOAD_SERVER"||c==="EVENT_REPORT_DOMAIN"||c==="EVENT_REPORT_BACKUP_DOMAIN"||c==="PROXY_SERVER_TYPE3"?Xn(c,o[c][0]):Xn(c,o[c])}))}function qx(t){let r=arguments.length>1&&arguments[1]!==void 0&&arguments[1];const s=Rt.reportApiInvoke(null,{name:Si.SET_AREA,options:t,tag:xr.TRACER});try{let o=[];if(typeof t=="string"&&(o=[t]),Array.isArray(t)&&(t.forEach(u=>{if(!ot(zG).call(zG,u))throw new Oe(X.INVALID_PARAMS,"invalid area code")}),o=t),Object.prototype.toString.call(t)==="[object Object]"){const{areaCode:u,excludedArea:h}=t;if(!u)throw new Oe(X.INVALID_PARAMS,"area code is needed");let m=u;typeof u=="string"&&(m=[u]),o=h?Ime(m,h):m}if(!r){if(md.AREAS){const u=new Oe(X.PROHIBITED_OPERATION,"setArea is prohibited because of config-distribute");return s.onError(u),void L.warning("setArea is prohibited because of config-distribute")}if(ot(o).call(o,Vn.GLOBAL)&&re("AREAS")===Vn.EXTENSIONS){const u=new Oe(X.PROHIBITED_OPERATION,"setArea is prohibited because of ap extensions");return s.onError(u),void L.warning("setArea is prohibited because of ap extensions")}}Xn("AREAS",o,r);const c=Cme(o);Object.keys(c).map(u=>{u==="LOG_UPLOAD_SERVER"||u==="EVENT_REPORT_DOMAIN"||u==="EVENT_REPORT_BACKUP_DOMAIN"||u==="PROXY_SERVER_TYPE3"?Xn(u,c[u][0]):Xn(u,c[u])}),L.debug("set area success:",o.join(","))}catch(o){throw s.onError(o),o}s.onSuccess()}function wH(t,r){var s=Object.keys(t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);r&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(t,c).enumerable})),s.push.apply(s,o)}return s}function bh(t){for(var r=1;r<arguments.length;r++){var s=arguments[r]!=null?arguments[r]:{};r%2?wH(Object(s),!0).forEach(function(o){$(t,o,s[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(s)):wH(Object(s)).forEach(function(o){Object.defineProperty(t,o,Object.getOwnPropertyDescriptor(s,o))})}return t}let Yx=1;function Ame(t,r,s,o,c){Yx+=1;const u={sid:s.sid,command:"convergeAllocateEdge",uid:"666",appId:s.appId,ts:Math.floor(Date.now()/1e3),seq:Yx,requestId:Yx,version:yl,cname:s.cname},h={service_name:r,json_body:JSON.stringify(u)};let m,_,E=t[0];return pd(async()=>{m=Date.now();const S=await Ed(E,{data:h,cancelToken:o,headers:{"X-Packet-Service-Type":"0","X-Packet-URI":"61"}});if(_=Date.now()-m,S.code!==0){const k=new Oe(X.UNEXPECTED_RESPONSE,"live streaming ap error, code"+S.code,{retry:!0,responseTime:_});throw L.error(k.toString()),k}const R=JSON.parse(S.json_body);if(R.code!==200){const k=new Oe(X.UNEXPECTED_RESPONSE,"live streaming app center error, code: ".concat(R.code,", reason: ").concat(R.reason),{code:R.code,responseTime:_});throw L.error(k.toString()),k}if(!R.servers||R.servers.length===0){const k=new Oe(X.UNEXPECTED_RESPONSE,"live streaming app center empty server",{code:R.code,responseTime:_});throw L.error(k.toString()),k}const P=function(k,z){return{addressList:k.servers.map(U=>"wss://".concat(U.address.replace(/\./g,"-"),".").concat(re("WORKER_DOMAIN"),":").concat(U.wss,"?serviceName=").concat(encodeURIComponent(z))),workerToken:k.workerToken,vid:k.vid}}(R,r);return re("LIVE_STREAMING_ADDRESS")&&(P.addressList=re("LIVE_STREAMING_ADDRESS")instanceof Array?re("LIVE_STREAMING_ADDRESS"):[re("LIVE_STREAMING_ADDRESS")]),bh(bh({},P),{},{responseTime:_})},(S,R)=>(Rt.apworkerEvent(s.sid,{success:!0,sc:200,serviceName:r,responseDetail:JSON.stringify(S.addressList),firstSuccess:R===0,responseTime:_,serverIp:t[R%t.length]}),!1),(S,R)=>(Rt.apworkerEvent(s.sid,{success:!1,sc:S.data&&S.data.code||200,serviceName:r,responseTime:_,serverIp:t[R%t.length]}),!!(S.code!==X.OPERATION_ABORTED&&S.code!==X.UNEXPECTED_RESPONSE||S.data&&S.data.retry)&&(E=t[(R+1)%t.length],!0)),c)}let Xx=1;function RH(t,r,s,o){let{url:c,areaCode:u}=t;const{clientId:h,sid:m}=r,_=Date.now();let E;const S=r.role,[R,P]=Qx(r,u,[li.CHOOSE_SERVER]);let k=ci.networkState;return pd(async()=>{k&&ci.networkState===nc.OFFLINE&&ci.onlineWaiter&&await lt.race([ci.onlineWaiter,os(o&&o.maxRetryTimeout||bi.maxRetryTimeout)]),k=ci.networkState;const{data:z,headers:U}=await Ed(c,{data:R,cancelToken:s,headers:{"Content-Type":"multipart/form-data;"}},!0,!0);E=U.http3==="1"?1:-1,Rt.reportResourceTiming(c,m),IH(z,c,r,_,[li.CHOOSE_SERVER],E);const F=AT(z,li.CHOOSE_SERVER);return Jx(F),jx(F,c)},z=>(z&&Rt.joinChooseServer(m,{role:S,lts:_,succ:!0,csAddr:c,opid:P,serverList:z.gatewayAddrs.map(U=>U.address),ec:null,cid:z.cid.toString(),uid:z.uid.toString(),csIp:z.csIp,unilbsServerIds:[li.CHOOSE_SERVER].toString(),isHttp3:E,corssRegionTagReq:r.apRequestDetail,corssRegionTagRes:z.res.detail&&z.res.detail[38]}),!1),z=>z.code!==X.OPERATION_ABORTED&&(z.code===X.CAN_NOT_GET_GATEWAY_SERVER?z.data.retry:(Rt.joinChooseServer(m,{role:S,lts:_,succ:!1,csAddr:c,serverList:null,opid:P,ec:z.code,csIp:z.data&&z.data.csIp,unilbsServerIds:[li.CHOOSE_SERVER].toString(),extend:JSON.stringify({networkState:k}),isHttp3:E,corssRegionTagReq:r.apRequestDetail}),L.warning("[".concat(h||"sid-".concat(m.slice(0,6)),"] Choose server network error, retry"),z),!0)),o)}function CH(t,r,s,o){let c,{url:u,areaCode:h,serviceIds:m}=t;const _=Date.now(),E=r.role,[S,R]=Qx(r,h,m);let P;return pd(async()=>{P&&ci.networkState===nc.OFFLINE&&ci.onlineWaiter&&await lt.race([ci.onlineWaiter,os(o&&o.maxRetryTimeout||bi.maxRetryTimeout)]),P=ci.networkState;const{data:k,headers:z}=await Ed(u,{data:S,cancelToken:s,headers:{"Content-Type":"multipart/form-data;"}},!0,!0);c=z.http3==="1"?1:-1,Rt.reportResourceTiming(u,r.sid),IH(k,u,r,_,m,c);const U=AT(k,li.CHOOSE_SERVER),F=AT(k,r.cloudProxyServer==="proxy5"?li.CLOUD_PROXY_5:r.cloudProxyServer==="proxy3"||r.cloudProxyServer==="proxy4"?li.CLOUD_PROXY:li.CLOUD_PROXY_FALLBACK);return Jx(U),{gatewayInfo:jx(U,u),proxyInfo:F,url:u}},k=>(k.gatewayInfo&&Rt.joinChooseServer(r.sid,{role:E,lts:_,succ:!0,csAddr:u,serverList:k.gatewayInfo.gatewayAddrs.map(z=>z.address),ec:null,opid:R,cid:k.gatewayInfo.cid.toString(),uid:k.gatewayInfo.uid.toString(),csIp:k.gatewayInfo.csIp,unilbsServerIds:m.toString(),isHttp3:c,corssRegionTagReq:r.apRequestDetail,corssRegionTagRes:k.gatewayInfo.res.detail&&k.gatewayInfo.res.detail[38]}),k.proxyInfo&&Rt.joinWebProxyAP(r.sid,{lts:_,sucess:1,apServerAddr:u,turnServerAddrList:k.proxyInfo.addresses.map(z=>z.ip).join(","),errorCode:null,eventType:r.cloudProxyServer,unilbsServerIds:m.toString()}),!1),k=>k.code!==X.OPERATION_ABORTED&&(k.code===X.CAN_NOT_GET_GATEWAY_SERVER?k.data.retry:(Rt.joinWebProxyAP(r.sid,{lts:_,sucess:0,apServerAddr:u,turnServerAddrList:null,errorCode:k.code,eventType:r.cloudProxyServer,unilbsServerIds:m.toString(),extend:JSON.stringify({networkState:P})}),L.warning("[".concat(r.clientId,"] multi unilbs network error, retry"),k),!0)),o)}const IH=(t,r,s,o,c,u)=>{const{sid:h,clientId:m,cloudProxyServer:_}=s,E=[],S=R=>{R.flag===4096?Rt.joinChooseServer(h,{role:s.role,lts:o,succ:!1,csAddr:r,opid:t.opid,serverList:null,ec:R.error.message,csIp:R.error.data&&R.error.data.csIp,unilbsServerIds:c.toString(),isHttp3:u,corssRegionTagReq:s.apRequestDetail}):R.flag!==1048576&&R.flag!==4194304&&R.flag!==4194310||Rt.joinWebProxyAP(h,{lts:o,sucess:0,apServerAddr:r,turnServerAddrList:null,errorCode:R.error.code,eventType:_,unilbsServerIds:c.toString()})};if(t.response_body.forEach(R=>{const P=R.buffer.code;if(R.uri===23&&P===0&&!R.buffer.edges_services)if(R.buffer.flag===4194310)L.warning("no edge services in ap response of proxy fallback, will not set proxy in iceServers"),R.buffer.edges_services=[];else{const k={error:new Oe(X.CAN_NOT_GET_GATEWAY_SERVER,"no edge services in ap response",{retry:!0,csIp:t.detail[502]}),flag:R.buffer.flag};E.push(k),S(k)}if(P!==0){const k=Jv(P),z={error:new Oe(X.CAN_NOT_GET_GATEWAY_SERVER,k.desc,{desc:k.desc,retry:k.retry,csIp:t.detail[502]}),flag:R.buffer.flag};R.buffer.flag===4194310?L.warning(z.error.toString()):E.push(z),S(z)}}),E.length)throw L.warning("[".concat(m||"sid-".concat(h.slice(0,6)),"] multi unilbs ").concat(r," failed, ").concat(E.map(R=>"flag: ".concat(R.flag,", message: ").concat(R.error.message,", retry: ").concat(R.error.data.retry)).join(" | "))),new Oe(X.CAN_NOT_GET_GATEWAY_SERVER,E.map(R=>"flag: ".concat(R.flag,", message: ").concat(R.error.message)).join(" | "),{retry:!!E.find(R=>R.error.data.retry),csIp:t.detail[502],desc:[...new Set(E.map(R=>{var P;return R==null||(P=R.error)===null||P===void 0||(P=P.data)===null||P===void 0?void 0:P.desc}).filter(R=>!!R))]})},Jx=t=>{var r,s,o,c;if(t.addresses&&t.addresses.length===0&&t.code===0)throw new Oe(X.CAN_NOT_GET_GATEWAY_SERVER,"void gateway address",{retry:!0,csIp:t.detail&&t.detail[502]});if(re("AP_AREA")&&((o=t.detail)!==null&&o!==void 0&&o[23]&&typeof((c=t.detail)===null||c===void 0?void 0:c[23])=="string"?TH(t.detail[23].toLowerCase()):TH()),(r=t.detail)!==null&&r!==void 0&&r[19]&&typeof((s=t.detail)===null||s===void 0?void 0:s[19])=="string"){const h=t.detail[19],m=h==null?void 0:h.split(";");for(let _=0;_<m.length;_++){var u;const E=eo(u=m[_]).call(u);t.addresses[_]&&m&&(t.addresses[_].fingerprint=E)}}if(re("GATEWAY_ADDRESS")&&re("GATEWAY_ADDRESS").length>0){L.debug("assign gateway address to",re("GATEWAY_ADDRESS"));const h=re("GATEWAY_ADDRESS").map(m=>{var _,E;const S=(_=(E=t.addresses.find(R=>R.ip===m.ip&&R.port===m.port))===null||E===void 0?void 0:E.fingerprint)!==null&&_!==void 0?_:"";return{ip:m.ip,port:m.port,ticket:t.addresses[0]&&t.addresses[0].ticket,fingerprint:S}});t.addresses=h}},Pme=(t,r)=>{if(t.response_body&&t.response_body.length){const s=t.response_body[0];if(s.buffer.code!==0){const o=Jv(s.buffer.code);throw new Oe(X.UPDATE_TICKET_FAILED,"[".concat(s.buffer.code,"]: ").concat(o.desc),{retry:o.retry})}return s.buffer.ticket}throw L.debug("update ticket request received ap response without response body:",r),new Oe(X.UPDATE_TICKET_FAILED,"cannot find response body from ap response",{retry:!1})},Qx=(t,r,s)=>{const o=Math.floor(Math.random()*1e12),c=t.role==="host"?"1":t.role==="audience"?"2":void 0,u={appid:t.appId,client_ts:Date.now(),opid:o,sid:t.sid,request_bodies:[{uri:22,buffer:{cname:t.cname,detail:bh(bh(bh({6:t.stringUid,11:r,12:re("USE_NEW_TOKEN")?"1":void 0},c?{17:c}:{}),{},{22:r},t.apRequestDetail?{33:t.apRequestDetail}:{}),t.apRTM?{26:"RTM2"}:{}),key:t.token,service_ids:s,uid:t.uid||0}}]};u.request_bodies.forEach(m=>{t.multiIP&&t.multiIP.gateway_ip&&(m.buffer.detail[5]=JSON.stringify({vocs_ip:[t.multiIP.uni_lbs_ip],vos_ip:[t.multiIP.gateway_ip]}))});const h=new FormData;return h.append("request",JSON.stringify(u)),[h,o]},Ome=(t,r)=>{const s=Math.floor(Math.random()*1e12),o={appid:t.appId,client_ts:Date.now(),opid:s,sid:t.sid,request_bodies:[{uri:28,buffer:{cname:t.cname,detail:{1:"",6:t.stringUid,12:"1"},token:t.token,service_ids:r,uid:t.uid||0,edges_services:t.apResponse.addresses.map(u=>({ip:u.ip,port:u.port}))}}]},c=new FormData;return c.append("request",JSON.stringify(o)),[c,s]};let tS=0;function nS(t){return lt.all(t.map(r=>r.then(s=>{throw s},s=>s))).then(r=>{throw r},r=>r)}const DT=async t=>{let{fragementLength:r,referenceList:s,asyncMapHandler:o,allFailedhandler:c,promisesCollector:u}=t,h=0;const m=r;let _,E=0;const S=async()=>{const R=(()=>{const P=h*m,k=P+m;return s.slice(P,k).map(o)})();u&&u.push(...R);try{_=await nS(R)}catch(P){if(E+=m,h++,!(E>=s.length))return void await S();c(P)}R.forEach(P=>P.cancel())};return await S(),_},AH=async t=>{let{referenceList:r,asyncMapHandler:s,closeFn:o}=t;const c=r.length;let u=0;const h=async()=>{const m=s(r.shift());try{return await m}catch(_){if(u++,u>=c||o!=null&&o(_))throw _;return h()}};return h()};async function Zx(t,r,s,o){return{gatewayInfo:await async function(u,h,m,_){let E=null;const S=[],R=async()=>{const k=re("WEBCS_DOMAIN").slice(0,re("AJAX_REQUEST_CONCURRENT")).map(F=>({url:u.proxyServer?"https://".concat(u.proxyServer,"/ap/?url=").concat(F+"/api/v2/transpond/webrtc?v=2"):"https://".concat(F,"/api/v2/transpond/webrtc?v=2"),areaCode:NT()})),z=_.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"chooseServer",urls:k.map(F=>F.url)}),U=await DT({fragementLength:re("FRAGEMENT_LENGTH"),referenceList:k,asyncMapHandler:F=>(L.debug("[".concat(u.clientId,"] Connect to choose_server:"),F.url),RH(F,u,h,m)),allFailedhandler:F=>{throw _.recordJoinChannelService({endTs:Date.now(),status:"error",errors:F},z),F[0]},promisesCollector:S});return _.recordJoinChannelService({endTs:Date.now(),status:"success"},z),U},P=async()=>{if(await os(1e3),E!==null)return E;const k=re("WEBCS_DOMAIN_BACKUP_LIST").map(F=>({url:u.proxyServer?"https://".concat(u.proxyServer,"/ap/?url=").concat(F+"/api/v2/transpond/webrtc?v=2"):"https://".concat(F,"/api/v2/transpond/webrtc?v=2"),areaCode:NT()})),z=_.recordJoinChannelService({endTs:void 0,startTs:Date.now(),status:"pending",service:"chooseServer",urls:k.map(F=>F.url)}),U=await DT({fragementLength:re("FRAGEMENT_LENGTH"),referenceList:k,asyncMapHandler:F=>(L.debug("[".concat(u.clientId,"] Connect to backup choose_server:"),F.url),RH(F,u,h,m)),allFailedhandler:F=>{throw _.recordJoinChannelService({endTs:Date.now(),status:"error",errors:F},z),F[0]},promisesCollector:S});return _.recordJoinChannelService({endTs:Date.now(),status:"success"},z),U};try{return E=await nS([R(),P()]),S.length&&S.forEach(k=>k.cancel&&typeof k.cancel=="function"&&k.cancel()),E}catch(k){throw k[0]}}(t,r,s,o)}}async function PH(t,r,s,o,c){const u=t.cloudProxyServer;if(u==="disabled"){if(t.useLocalAccessPoint)return await Zx(t,r,s,c);if(re("JOIN_WITH_FALLBACK_MEDIA_PROXY")){const{gatewayInfo:P,proxyInfo:k}=await NH(t,r,s,c);if(t.turnServer&&t.turnServer.mode!=="auto")return{gatewayInfo:P};const z=k.map(U=>({turnServerURL:U.address,tcpport:U.tcpport||ws.tcpport,udpport:U.udpport||ws.udpport,username:U.username||ws.username,password:U.password||ws.password,forceturn:!1,security:!0}));if(c.useP2P){var h;const U=(h=t.uid)!==null&&h!==void 0?h:P.uid,F="glb:".concat(U.toString()),q=await $L(F),Y=k.map(le=>({turnServerURL:le.address,tcpport:le.tcpport||ws.tcpport,udpport:le.udpport||ws.udpport,username:F,password:q,forceturn:!1,security:!0}));z.push(...Y)}return t.turnServer={mode:"manual",servers:z},{gatewayInfo:P}}return await Zx(t,r,s,c)}const{proxyInfo:m,gatewayInfo:_}=await NH(t,r,s,c),E={gatewayInfo:_},S=m.map(P=>({turnServerURL:P.address,tcpport:u==="proxy3"?void 0:P.tcpport?P.tcpport:ws.tcpport,udpport:u==="proxy4"?void 0:P.udpport?P.udpport:ws.udpport,username:P.username||ws.username,password:P.password||ws.password,forceturn:u!=="proxy4",security:u==="proxy5"}));if(c.useP2P){var R;const P=(R=t.uid)!==null&&R!==void 0?R:_.uid,k="glb:".concat(P.toString()),z=await $L(k),U=m.map(F=>({turnServerURL:F.address,tcpport:u==="proxy3"?void 0:F.tcpport||ws.tcpport,udpport:u==="proxy4"?void 0:F.udpport||ws.udpport,username:k,password:z,forceturn:u!=="proxy4",security:u==="proxy5"}));S.push(...U)}return t.turnServer={mode:"manual",servers:S},L.debug("[".concat(t.clientId,"] set proxy server: ").concat(t.proxyServer,", mode: ").concat(u)),E}async function OH(t,r,s,o,c){const u=re("ACCOUNT_REGISTER").slice(0,re("AJAX_REQUEST_CONCURRENT"));let h=[];h=r.proxyServer?u.map(_=>"https://".concat(r.proxyServer,"/ap/?url=").concat(_+"/api/v1")):u.map(_=>"https://".concat(_,"/api/v1"));const m=c==null?void 0:c.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"stringUID",urls:h});try{const _=await async function(E,S,R,P,k){const z=Date.now(),U={sid:R.sid,opid:10,appid:R.appId,string_uid:S};let F=E[0];const q=await pd(()=>Ed(F+"".concat(F.indexOf("?")===-1?"?":"&","action=stringuid"),{data:U,cancelToken:P,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":72}}),(Y,le)=>{if(Y.code===0){if(Y.uid<=0||Y.uid>=Math.pow(2,32))throw L.error("Invalid Uint Uid ".concat(S," => ").concat(Y.uid),Y),Rt.reqUserAccount(U.sid,{lts:z,success:!1,serverAddr:F,stringUid:U.string_uid,uid:Y.uid,errorCode:X.INVALID_UINT_UID_FROM_STRING_UID,extend:U}),new Oe(X.INVALID_UINT_UID_FROM_STRING_UID);return Rt.reqUserAccount(U.sid,{lts:z,success:!0,serverAddr:F,stringUid:U.string_uid,uid:Y.uid,errorCode:null,extend:U}),!1}const ye=Jv(Y.code);return ye.retry&&(F=E[(le+1)%E.length]),Rt.reqUserAccount(U.sid,{lts:z,success:!1,serverAddr:F,stringUid:U.string_uid,uid:Y.uid,errorCode:ye.desc,extend:U}),ye.retry},(Y,le)=>Y.code!==X.OPERATION_ABORTED&&(Rt.reqUserAccount(U.sid,{lts:z,success:!1,serverAddr:F,stringUid:U.string_uid,uid:null,errorCode:Y.code,extend:U}),F=E[(le+1)%E.length],!0),k);if(q.code!==0){const Y=Jv(q.code);throw new Oe(X.UNEXPECTED_RESPONSE,Y.desc)}return q}(h,t,r,s,o);return c==null||c.recordJoinChannelService({status:"success",endTs:Date.now()},m),_.uid}catch(_){throw c==null||c.recordJoinChannelService({status:"error",endTs:Date.now(),errors:[_]},m),_}}async function kme(t,r,s){const o=re("ACCOUNT_REGISTER");let c=[];c=r.proxyServer?o.map(u=>"https://".concat(r.proxyServer,"/ap/?url=").concat(u+"/api/v1")):o.map(u=>"https://".concat(u,"/api/v1"));try{return await AH({referenceList:c,asyncMapHandler:h=>async function(m,_,E,S){const R=Date.now(),P={sid:E.sid,opid:10,appid:E.appId,string_uid:_};try{const k=await Ed(m+"".concat(m.indexOf("?")===-1?"?":"&","action=stringuid"),{data:P,cancelToken:S,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":72}});if(k.code!==0){const z=Jv(k.code);throw new Oe(X.UNEXPECTED_RESPONSE,"preload sua error:".concat(z.desc),z)}if(k.uid<=0||k.uid>=Math.pow(2,32))throw new Oe(X.INVALID_UINT_UID_FROM_STRING_UID);return{requestTime:R,url:m,req:P,uid:k.uid,elapse:Date.now()-R}}catch(k){throw k}}(h,t,r,s),closeFn:h=>h.code===X.OPERATION_ABORTED||h.code===X.UNEXPECTED_RESPONSE&&!h.data.retry})}catch(u){throw u}}async function Nme(t,r,s){const o=re("CDS_AP").slice(0,re("AJAX_REQUEST_CONCURRENT")).map(_=>t.proxyServer?"https://".concat(t.proxyServer,"/ap/?url=").concat(_+"/api/v1"):"https://".concat(_,"/api/v1?action=config")),c=o.map(_=>function(E,S,R,P){const k=Rn(),z={flag:64,cipher_method:0,features:bh(bh(bh(bh(bh({install_id:rx(),device:k.name,system:k.os,system_general:navigator.userAgent,vendor:S.appId,version:yl,cname:S.cname,session_id:S.sid,proxyServer:S.proxyServer,sdk_type:Tme.WEB_RTC,browser_name:k.name,browser_version:k.version,user_agent:navigator.userAgent,channel_name:S.cname},S.stringUid&&{string_uid:S.stringUid}),S.uid&&{uid:S.uid+""}),k.os&&{os_name:k.os}),k.osVersion&&{os_version:k.osVersion}),{},{detail:""})};return pd(()=>Ed(E,{data:z,timeout:1e3,cancelToken:R,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":54}}),void 0,U=>U.code!==X.OPERATION_ABORTED,P)}(_,t,r,s));let u=null,h=null,m={};try{u=await nS(c)}catch(_){if(_.code===X.OPERATION_ABORTED)throw _;h=_}if(c.forEach(_=>_.cancel()),Rt.reportApiInvoke(t.sid,{name:Si.REQUEST_CONFIG_DISTRIBUTE,options:{error:h,res:u}}).onSuccess(),u&&u.test_tags)try{m=function(_){if(!_.test_tags)return{};const E=_.test_tags,S=Object.keys(E),R={};return S.forEach(P=>{var k;const z=eo(k=P.slice(4)).call(k),U=JSON.parse(E[P]),F=U[1];R[z]={tag:U[0]||"",value:F}}),R}(u)}catch{}return m}async function kH(t,r){const s=re("WEBCS_DOMAIN").concat(re("WEBCS_DOMAIN_BACKUP_LIST")).map(o=>({url:"https://".concat(o,"/api/v2/transpond/webrtc?v=2"),areaCode:NT(),serviceIds:[li.CHOOSE_SERVER,li.CLOUD_PROXY_FALLBACK]}));try{return await AH({referenceList:s,asyncMapHandler:c=>async function(u,h,m){let _,{url:E,areaCode:S,serviceIds:R}=u;const P=Date.now(),[k,z]=Qx(h,S,R);let U=ci.networkState;try{U&&ci.networkState===nc.OFFLINE&&ci.onlineWaiter&&await lt.race([ci.onlineWaiter,os(bi.maxRetryTimeout)]),U=ci.networkState;const{data:F,headers:q}=await Ed(E,{data:k,cancelToken:m,headers:{"Content-Type":"multipart/form-data;"}},!0,!0);_=q.http3==="1"?1:-1,(Ee=>{const me=[];if(Ee.response_body.forEach(ke=>{const Ye=ke.buffer.code;if(ke.uri===23&&Ye===0&&!ke.buffer.edges_services)if(ke.buffer.flag===4194310)ke.buffer.edges_services=[];else{const ut={error:new Oe(X.CAN_NOT_GET_GATEWAY_SERVER,"no edge services in ap response",{retry:!0,csIp:Ee.detail[502]}),flag:ke.buffer.flag};me.push(ut)}if(Ye!==0){const ut=Jv(Ye),pt={error:new Oe(X.CAN_NOT_GET_GATEWAY_SERVER,ut.desc,{desc:ut.desc,retry:ut.retry,csIp:Ee.detail[502]}),flag:ke.buffer.flag};ke.buffer.flag===4194310?L.warning(pt.error.toString()):me.push(pt)}}),me.length)throw new Oe(X.CAN_NOT_GET_GATEWAY_SERVER,me.map(ke=>"flag: ".concat(ke.flag,", message: ").concat(ke.error.message)).join(" | "),{retry:!!me.find(ke=>ke.error.data.retry),csIp:Ee.detail[502],desc:[...new Set(me.map(ke=>{var Ye;return ke==null||(Ye=ke.error)===null||Ye===void 0||(Ye=Ye.data)===null||Ye===void 0?void 0:Ye.desc}).filter(ke=>!!ke))]})})(F);const le=AT(F,li.CHOOSE_SERVER),ye=AT(F,li.CLOUD_PROXY_FALLBACK);return Jx(le),{gatewayInfo:jx(le,E),proxyInfo:ye,opid:z,requestTime:P,url:E,isHttp3:_,elapse:Date.now()-P}}catch(F){throw F}}(c,t,r),closeFn:c=>c.code===X.OPERATION_ABORTED||c.code===X.CAN_NOT_GET_GATEWAY_SERVER&&!c.data.retry})}catch(o){throw o}}async function NH(t,r,s,o){const c=re("PROXY_SERVER_TYPE3"),u=(k,z,U)=>{let F=U||c;return Array.isArray(F)&&(F=z%2==0?c[1]:c[0]),"https://".concat(F,"/ap/?url=").concat(k)};let h=null;const m=[],_=async()=>{const k=re("WEBCS_DOMAIN").slice(0,re("AJAX_REQUEST_CONCURRENT")).map((F,q)=>{let Y;return Y=t.cloudProxyServer==="disabled"&&t.proxyServer?u("".concat(F,"/api/v2/transpond/webrtc?v=2"),q,t.proxyServer):t.cloudProxyServer==="disabled"||t.cloudProxyServer==="fallback"?"https://".concat(F,"/api/v2/transpond/webrtc?v=2"):u("".concat(F,"/api/v2/transpond/webrtc?v=2"),q),{url:Y,areaCode:NT(),serviceIds:[li.CHOOSE_SERVER,t.cloudProxyServer==="proxy5"?li.CLOUD_PROXY_5:t.cloudProxyServer==="proxy3"||t.cloudProxyServer==="proxy4"?li.CLOUD_PROXY:li.CLOUD_PROXY_FALLBACK]}}),z=o.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"chooseServer",urls:k.map(F=>F.url)}),U=await DT({fragementLength:re("FRAGEMENT_LENGTH"),referenceList:k,asyncMapHandler:F=>(L.debug("[".concat(t.clientId,"] Connect to choose_server:"),F.url),CH(F,t,r,s)),allFailedhandler:F=>{throw o.recordJoinChannelService({endTs:Date.now(),status:"error",errors:F},z),F[0]},promisesCollector:m});return o.recordJoinChannelService({endTs:Date.now(),status:"success"},z),U},E=async()=>{if(await os(1e3),h!==null)return h;const k=re("WEBCS_DOMAIN_BACKUP_LIST").map((F,q)=>{let Y;return Y=t.cloudProxyServer==="disabled"&&t.proxyServer?u("".concat(F,"/api/v2/transpond/webrtc?v=2"),q,t.proxyServer):t.cloudProxyServer==="disabled"||t.cloudProxyServer==="fallback"?"https://".concat(F,"/api/v2/transpond/webrtc?v=2"):u("".concat(F,"/api/v2/transpond/webrtc?v=2"),q),{url:Y,areaCode:NT(),serviceIds:[li.CHOOSE_SERVER,t.cloudProxyServer==="proxy5"?li.CLOUD_PROXY_5:t.cloudProxyServer==="proxy3"||t.cloudProxyServer==="proxy4"?li.CLOUD_PROXY:li.CLOUD_PROXY_FALLBACK]}}),z=o.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"chooseServer",urls:k.map(F=>F.url)}),U=await DT({fragementLength:re("FRAGEMENT_LENGTH"),referenceList:k,asyncMapHandler:F=>(L.debug("[".concat(t.clientId,"] Connect to backup choose_server:"),F.url),CH(F,t,r,s)),allFailedhandler:F=>{throw o.recordJoinChannelService({endTs:Date.now(),status:"error",errors:F},z),F[0]},promisesCollector:m});return o.recordJoinChannelService({endTs:Date.now(),status:"success"},z),U};let S,R,P;try{({gatewayInfo:S,proxyInfo:R,url:P}=await nS([_(),E()]))}catch(k){throw k[0]}if(m.length&&m.forEach(k=>k.cancel&&typeof k.cancel=="function"&&k.cancel()),!S||!R)throw new Oe(X.UNEXPECTED_ERROR,"missing gateway or proxy response").print();if(t.apUrl=P,t.cloudProxyServer!=="disabled"&&Array.isArray(c)&&P){const k=/^https?:\/\/(.+?)(\/.*)?$/.exec(P)[1];ot(c).call(c,k)&&(t.proxyServer=k,L.setProxyServer(k),Rt.setProxyServer(k))}return h={gatewayInfo:S,proxyInfo:await nH(R,S.uid)},h}async function Dme(t,r,s){const o=re("UAP_AP").slice(0,re("AJAX_REQUEST_CONCURRENT")).map(u=>t.proxyServer?"https://".concat(t.proxyServer,"/ap/?url=").concat(u+"/api/v1?action=uap"):"https://".concat(u,"/api/v1?action=uap")),c=o.map(u=>function(h,m,_,E){const S={command:"convergeAllocateEdge",sid:m.sid,appId:m.appId,token:m.token,ts:Date.now(),version:yl,cname:m.cname,uid:m.uid.toString(),requestId:Xx,seq:Xx};Xx+=1;const R={service_name:"tele_channel",json_body:JSON.stringify(S)};return pd(async()=>{const P=await Ed(h,{data:R,cancelToken:_,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":61}});if(P.code!==0){const z=new Oe(X.UNEXPECTED_RESPONSE,"cross channel ap error, code"+P.code,{retry:!0});throw L.error(z.toString()),z}const k=JSON.parse(P.json_body);if(k.code!==200){const z=new Oe(X.UNEXPECTED_RESPONSE,"cross channel app center error, code: ".concat(k.code,", reason: ").concat(k.reason));throw L.error(z.toString()),z}if(!k.servers||k.servers.length===0){const z=new Oe(X.UNEXPECTED_RESPONSE,"cross channel app center empty server");throw L.error(z.toString()),z}return{vid:k.vid,workerToken:k.workerToken,addressList:(re("CHANNEL_MEDIA_RELAY_SERVERS")||k.servers).map(z=>"wss://".concat(z.address.replace(/\./g,"-"),".").concat(re("WORKER_DOMAIN"),":").concat(z.wss))}},void 0,P=>!!(P.code!==X.OPERATION_ABORTED&&P.code!==X.UNEXPECTED_RESPONSE||P.data&&P.data.retry),E)}(u,t,r,s));try{const u=await nS(c);return c.forEach(h=>h.cancel()),u}catch(u){throw u[0]}}async function Lme(t,r,s){let o=null;const c=[],u=async h=>{const m=re(h?"WEBCS_DOMAIN_BACKUP_LIST":"WEBCS_DOMAIN").map(_=>t.proxyServer?"https://".concat(t.proxyServer,"/ap/?url=").concat(_+"/api/v2/transpond/webrtc?v=2"):"https://".concat(_,"/api/v2/transpond/webrtc?v=2"));return h&&(await os(1e3),o!==null)?o:await DT({fragementLength:re("FRAGEMENT_LENGTH"),referenceList:m,asyncMapHandler:_=>(L.debug("[".concat(t.clientId,"] update ticket, Connect to ").concat(h?"backup":""," choose_server:"),_),function(E,S,R,P){const[k]=Ome(S,[li.CHOOSE_SERVER]);let z=ci.networkState;return pd(async()=>{z&&ci.networkState===nc.OFFLINE&&ci.onlineWaiter&&await lt.race([ci.onlineWaiter,os(P&&P.maxRetryTimeout||bi.maxRetryTimeout)]),z=ci.networkState;const U=await Ed(E,{data:k,cancelToken:R,headers:{"Content-Type":"multipart/form-data;"}},!0);return Pme(U,E)},()=>!1,U=>U.code!==X.OPERATION_ABORTED&&(U.code===X.UPDATE_TICKET_FAILED?U.data.retry:(L.warning("[".concat(S.clientId,"] update ticket network error, retry"),U),!0)),P)}(_,t,r,s)),allFailedhandler:_=>{throw _[0]},promisesCollector:c})};try{return o=await nS([u(!1),u(!0)]),c.length&&c.forEach(h=>h.cancel&&typeof h.cancel=="function"&&h.cancel()),o}catch(h){throw h[0]}}function DH(t,r){var s=Object.keys(t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);r&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(t,c).enumerable})),s.push.apply(s,o)}return s}function eM(t){for(var r=1;r<arguments.length;r++){var s=arguments[r]!=null?arguments[r]:{};r%2?DH(Object(s),!0).forEach(function(o){$(t,o,s[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(s)):DH(Object(s)).forEach(function(o){Object.defineProperty(t,o,Object.getOwnPropertyDescriptor(s,o))})}return t}class xme extends Pr{get isSuccess(){return!!this.configs}constructor(r,s){super(),$(this,"configs",void 0),$(this,"store",void 0),$(this,"joinInfo",void 0),$(this,"cancelToken",void 0),$(this,"retryConfig",{timeout:3e3,timeoutFactor:1.5,maxRetryCount:1,maxRetryTimeout:1e4}),$(this,"interval",void 0),$(this,"mutex",void 0),$(this,"mutableParamsRead",!1),$(this,"configCache",{}),$(this,"limit_bitrate",void 0),this.mutex=new ks("config-distribute",r),this.store=s}startGetConfigDistribute(r,s){this.joinInfo=r,this.cancelToken=s,this.interval&&this.stopGetConfigDistribute(),re("ENABLE_CONFIG_DISTRIBUTE")&&(this.updateConfigDistribute(),this.interval=window.setInterval(()=>{this.updateConfigDistribute()},re("CONFIG_DISTRIBUTE_INTERVAL")))}stopGetConfigDistribute(){this.interval&&clearInterval(this.interval),this.interval=void 0,this.joinInfo=void 0,this.cancelToken=void 0,this.configs=void 0,this.limit_bitrate=void 0}async awaitConfigDistributeComplete(){this.mutex.isLocked&&(await this.mutex.lock())()}async updateConfigDistribute(){if(this.mutableParamsRead||(this.mutableParamsRead=!0,Rt.reportApiInvoke(null,{options:void 0,name:Si.LOAD_CONFIG_FROM_LOCALSTORAGE,tag:xr.TRACER}).onSuccess(JSON.stringify(md))),!this.joinInfo||!this.cancelToken||!this.retryConfig)return void L.debug("[config-distribute] get config distribute interrupted have no joininfo");let r;const s=await this.mutex.lock();try{r=await Nme(this.joinInfo,this.cancelToken,this.retryConfig),L.debug("[config-distribute] get config distribute",JSON.stringify(r));const o=function(c){var u;const h=eT(u=Object.keys(c).filter(E=>/^webrtc_ng_global_parameter/.test(E))).call(u);for(let E=0;E<h.length;E++)for(let S=h.length-1;S>E;S--){const R=h[S],P=c[R].value;if(typeof P.__priority=="number"){const k=P.__priority,z=h[S-1],U=c[z].value;if(typeof U.__priority=="number"){if(!(k>U.__priority))continue;{const F=R;h[S]=h[S-1],h[S-1]=F}}else{const F=R;h[S]=h[S-1],h[S-1]=F}}}const m=Date.now();let _={};return h.forEach(E=>{const S=c[E].value.__expires;S&&S<=m||(_[E]=c[E])}),_}(r);this.cacheGlobalParameterConfig(o),this.store.hasStartJoinChannel||(this.store.isABTestSuccess=!0),this.configs=o}catch(o){const c=new Oe(X.NETWORK_RESPONSE_ERROR,o);L.warning("[config-distribute] ".concat(c.toString()))}finally{s()}}getBitrateLimit(){return this.limit_bitrate||void 0}handleBitrateLimit(r){GG(r)&&(this.limit_bitrate?this.limit_bitrate&&this.limit_bitrate.id!==r.id&&this.emit(RT.UPDATE_BITRATE_LIMIT,r):this.emit(RT.UPDATE_BITRATE_LIMIT,r))}getLowStreamConfigDistribute(){return this.limit_bitrate&&eM({},this.limit_bitrate.low_stream_uplink)}handleABTestConfigDistribute(r){try{const s={},o=Object.keys(r),c=[];o.forEach(u=>{const h=r[u].value;s[u]=h;const m=h.__id;if(m&&this.configCache[u]&&this.configCache[u].__id===m)return;const _=h.__type,E=r[u].value,S=r[u].tag;let R=0;_?_===E8.REALTIME&&(R=1):Object.keys(E).some(P=>Object.prototype.hasOwnProperty.call(ax,P)||!Ox()&&Object.prototype.hasOwnProperty.call($A,P)?(R=1,!0):void 0),c.push({tag:S,isApplied:R,feature:u,params:JSON.stringify(h)})}),c.forEach(u=>{let{tag:h,feature:m,params:_,isApplied:E}=u;this.store.sessionId&&Rt.abTest(this.store.sessionId,{intSucc:1,isApplied:E,tag:h,feature:m,params:_,cid:this.store.cid,uid:this.store.intUid})}),this.configCache=s}catch(s){L.debug("handleABTestConfigDistribute error",s)}}cacheGlobalParameterConfig(r){const s=function(c){const u={};return Object.keys(c).forEach(h=>{const m=c[h].value,_=m.__expires,E=m.__type;Object.keys(m).forEach(S=>{S==="__id"||S==="__type"||S==="__priority"||S==="__expires"||Object.prototype.hasOwnProperty.call(u,S)||(u[S]=eM(eM({value:m[S]},_&&{expires:_}),E&&{type:E}))})}),u}(r);try{var o;const c=(o=s.LIMIT_BITRATE)===null||o===void 0?void 0:o.value;delete s.LIMIT_BITRATE,c&&GG(c)&&this.handleBitrateLimit(c),this.limit_bitrate=c,this.handleGlobalParameterConfig(s),this.handleABTestConfigDistribute(r),function(m){try{const _=Date.now();Object.keys(m).forEach(E=>{const{value:S,type:R,expires:P}=m[E];P&&P<=_||((R===E8.REALTIME||Object.prototype.hasOwnProperty.call(ax,E))&&(md[E]=S,gr[E]=S,L.debug("Update realtime parameters from config distribute",E,S)),R||Ox()||!Object.prototype.hasOwnProperty.call($A,E)||(md[E]=S,gr[E]=S,L.debug("Update gateway parameters from config distribute",E,S)))})}catch(_){L.error("Error update config immediately: ".concat(m),_.message)}}(s);const u=JSON.stringify(s),h=window.btoa(u);window.localStorage.setItem("websdk_ng_global_parameter",h),L.debug("Caching global parameters ".concat(u))}catch(c){L.error("Error caching global parameters:",c.message)}}handleGlobalParameterConfig(r){try{const s=Date.now();Object.keys(r).forEach(o=>{if(o==="CLIENT_ROLE_OPTIONS"&&Object.prototype.hasOwnProperty.call(gr,o)){const{value:c,expires:u}=r[o];if(u&&u<=s)return;(function(h,m){try{return typeof h=="object"&&typeof m=="object"&&JSON.stringify(h)===JSON.stringify(m)}catch{return!1}})(gr[o],c)||(md[o]=c,gr[o]=c,this.emit(RT.UPDATE_CLIENT_ROLE_OPTIONS,c),L.debug("Updating client role options: ".concat(JSON.stringify(c))))}})}catch(s){L.error("Error handling global parameter config:",s.message)}}}class Mme extends Pr{constructor(){super(...arguments),$(this,"resultStorage",new Map)}setLocalAudioStats(r,s,o){this.record("AUDIO_INPUT_LEVEL_TOO_LOW",r,this.checkAudioInputLevel(o,s)),this.record("SEND_AUDIO_BITRATE_TOO_LOW",r,this.checkSendAudioBitrate(o,s))}setLocalVideoStats(r,s,o){this.record("SEND_VIDEO_BITRATE_TOO_LOW",r,this.checkSendVideoBitrate(o,s)),this.record("FRAMERATE_INPUT_TOO_LOW",r,this.checkFramerateInput(o,s)),this.record("FRAMERATE_SENT_TOO_LOW",r,this.checkFramerateSent(o))}setRemoteAudioStats(r,s){const o=r.getUserId();this.record("AUDIO_OUTPUT_LEVEL_TOO_LOW",o,this.checkAudioOutputLevel(s))}setRemoteVideoStats(r,s){const o=r.getUserId();this.record("RECV_VIDEO_DECODE_FAILED",o,this.checkVideoDecode(s))}record(r,s,o){if(re("STATS_UPDATE_INTERVAL")>500)return;this.resultStorage.has(r)||this.resultStorage.set(r,{result:[],isPrevNormal:!0});const c=this.resultStorage.get(r);if(c&&(c.result.push(o),c.result.length>=5)){var u;const h=ot(u=c.result).call(u,!0);c.isPrevNormal&&!h&&this.emit("exception",LH[r],r,s),!c.isPrevNormal&&h&&this.emit("exception",LH[r]+2e3,r+"_RECOVER",s),c.isPrevNormal=h,c.result=[]}}checkAudioOutputLevel(r){return!(r.receiveBitrate>0&&r.receiveLevel===0)}checkAudioInputLevel(r,s){return s instanceof Ai&&!s.isActive||!!s.muted||r.sendVolumeLevel!==0}checkFramerateInput(r,s){let o=null;s._encoderConfig&&s._encoderConfig.frameRate&&(o=rc(s._encoderConfig.frameRate));const c=r.captureFrameRate;return!o||!c||!(o>10&&c<5||o<10&&o>=5&&c<=1)}checkFramerateSent(r){return!(r.captureFrameRate&&r.sendFrameRate&&r.captureFrameRate>5&&r.sendFrameRate<=1)}checkSendVideoBitrate(r,s){return!!s.muted||r.sendBitrate!==0}checkSendAudioBitrate(r,s){return s instanceof Ai&&!s.isActive||!!s.muted||r.sendBitrate!==0}checkVideoDecode(r){return r.receiveBitrate===0||r.decodeFrameRate!==0}}const LH={FRAMERATE_INPUT_TOO_LOW:1001,FRAMERATE_SENT_TOO_LOW:1002,SEND_VIDEO_BITRATE_TOO_LOW:1003,RECV_VIDEO_DECODE_FAILED:1005,AUDIO_INPUT_LEVEL_TOO_LOW:2001,AUDIO_OUTPUT_LEVEL_TOO_LOW:2002,SEND_AUDIO_BITRATE_TOO_LOW:2003},Ls=new class{markSubscribeStart(t,r){performance.mark("agora-web-sdk/".concat(t,"/subscribe-").concat(r))}markPublishStart(t,r){performance.mark("agora-web-sdk/".concat(t,"/publish-").concat(r))}measureFromSubscribeStart(t,r){const s=performance.getEntriesByName("agora-web-sdk/".concat(t,"/subscribe-").concat(r));if(s.length>0){const o=s[s.length-1];return Math.round(performance.now()-o.startTime)}return 0}measureFromPublishStart(t,r){const s=performance.getEntriesByName("agora-web-sdk/".concat(t,"/publish-").concat(r));if(s.length>0){const o=s[s.length-1];return Math.round(performance.now()-o.startTime)}return 0}};function xH(t,r){var s=Object.keys(t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);r&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(t,c).enumerable})),s.push.apply(s,o)}return s}function G_(t){for(var r=1;r<arguments.length;r++){var s=arguments[r]!=null?arguments[r]:{};r%2?xH(Object(s),!0).forEach(function(o){$(t,o,s[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(s)):xH(Object(s)).forEach(function(o){Object.defineProperty(t,o,Object.getOwnPropertyDescriptor(s,o))})}return t}class LT{constructor(r){$(this,"store",void 0),$(this,"onStatsException",void 0),$(this,"onUploadPublishDuration",void 0),$(this,"onStatsChanged",void 0),$(this,"localStats",new Map),$(this,"remoteStats",new Map),$(this,"updateStatsInterval",void 0),$(this,"trafficStats",void 0),$(this,"trafficStatsPeerList",[]),$(this,"uplinkStats",void 0),$(this,"exceptionMonitor",void 0),$(this,"p2pChannel",void 0),$(this,"scalabilityMode",HA.L1T1),$(this,"updateStats",()=>{this.p2pChannel&&(this.updateRemoteStats(this.p2pChannel),this.updateLocalStats(this.p2pChannel))}),this.store=r,this.exceptionMonitor=new Mme,this.exceptionMonitor.on("exception",(s,o,c)=>{this.onStatsException&&this.onStatsException(s,o,c)})}startUpdateStats(){this.updateStatsInterval||(this.updateStatsInterval=window.setInterval(this.updateStats,1e3))}stopUpdateStats(){this.updateStatsInterval&&(window.clearInterval(this.updateStatsInterval),this.updateStatsInterval=void 0)}reset(){this.localStats=new Map,this.remoteStats=new Map,this.trafficStats=void 0,this.trafficStatsPeerList=[],this.uplinkStats=void 0}getLocalAudioTrackStats(){return this.localStats.get($e.LocalAudioTrack)||G_({},hx)}getLocalVideoTrackStats(){return this.localStats.get($e.LocalVideoTrack)||G_({},fx)}getRemoteAudioTrackStats(r){const s=(u,h)=>{if(!this.trafficStats)return h;const m=this.trafficStats.peer_delay.find(_=>_.peer_uid===u);return m&&(h.publishDuration=m.B_ppad+(Date.now()-this.trafficStats.timestamp)),h},o={};if(r){var c;const u=(c=this.remoteStats.get(r))===null||c===void 0?void 0:c.audioStats;u&&(o[r]=s(r,u))}else Array.from(this.remoteStats.entries()).forEach(u=>{let[h,{audioStats:m}]=u;m&&(o[h]=s(h,m))});return o}getRemoteNetworkQualityStats(r){const s={};if(r){var o;const c=(o=this.remoteStats.get(r))===null||o===void 0?void 0:o.networkStats;c&&(s[r]=c)}else Array.from(this.remoteStats.entries()).forEach(c=>{let[u,{networkStats:h}]=c;h&&(s[u]=h)});return s}getRemoteVideoTrackStats(r){const s=(u,h)=>{if(!this.trafficStats)return h;const m=this.trafficStats.peer_delay.find(_=>_.peer_uid===u);return m&&(h.publishDuration=m.B_ppvd+(Date.now()-this.trafficStats.timestamp)),h},o={};if(r){var c;const u=(c=this.remoteStats.get(r))===null||c===void 0?void 0:c.videoStats;u&&(o[r]=s(r,u))}else Array.from(this.remoteStats.entries()).forEach(u=>{let[h,{videoStats:m}]=u;m&&(o[h]=s(h,m))});return o}getRTCStats(){let r=0,s=0,o=0,c=0;const u=this.localStats.get($e.LocalAudioTrack);u&&(r+=u.sendBytes,s+=u.sendBitrate);const h=this.localStats.get($e.LocalVideoTrack);h&&(r+=h.sendBytes,s+=h.sendBitrate);const m=this.localStats.get($e.LocalVideoLowTrack);m&&(r+=m.sendBytes,s+=m.sendBitrate),this.remoteStats.forEach(E=>{let{audioStats:S,videoStats:R}=E;S&&(o+=S.receiveBytes,c+=S.receiveBitrate),R&&(o+=R.receiveBytes,c+=R.receiveBitrate)});let _=1;return this.trafficStats&&(_+=this.trafficStats.peer_delay.length),{Duration:0,UserCount:_,SendBitrate:s,SendBytes:r,RecvBytes:o,RecvBitrate:c,OutgoingAvailableBandwidth:this.uplinkStats?this.uplinkStats.B_uab/1e3:0,RTT:this.trafficStats?2*this.trafficStats.B_acd:0}}addLocalStats(r){this.localStats.set(r,void 0)}removeLocalStats(r){r?this.localStats.delete(r):this.localStats.clear()}addRemoteStats(r){this.remoteStats.set(r,{})}removeRemoteStats(r){r?this.remoteStats.delete(r):this.remoteStats.clear()}addP2PChannel(r){this.p2pChannel=r}updateTrafficStats(r){r.peer_delay=r.peer_delay.filter(s=>s.B_ppad!==void 0||s.B_ppvd!==void 0),r.peer_delay.filter(s=>this.trafficStatsPeerList.indexOf(s.peer_uid)===-1).forEach(s=>{var o;const c=(o=this.p2pChannel)===null||o===void 0?void 0:o.getRemoteMedia(s.peer_uid),u=c!=null&&c.videoSSRC?Ls.measureFromSubscribeStart(this.store.clientId,c.videoSSRC):0,h=c!=null&&c.audioSSRC?Ls.measureFromSubscribeStart(this.store.clientId,c.audioSSRC):0;s.B_ppad!==void 0&&s.B_ppvd!==void 0&&(this.onUploadPublishDuration&&this.onUploadPublishDuration(s.peer_uid,s.B_ppad,s.B_ppvd,u>h?u:h),this.trafficStatsPeerList.push(s.peer_uid))}),this.trafficStats=r}updateUplinkStats(r){this.uplinkStats&&this.uplinkStats.B_fir!==r.B_fir&&L.debug("[".concat(this.store.clientId,"]: Period fir changes to ").concat(r.B_fir)),this.uplinkStats=r}static isRemoteVideoFreeze(r,s,o){if(!r)return!1;const c=!!o&&s.framesDecodeFreezeTime>o.framesDecodeFreezeTime,u=!o||s.framesDecodeCount>o.framesDecodeCount;return c||!u}static isRemoteAudioFreeze(r){return!!r&&r._isFreeze()}isLocalVideoFreeze(r){return!(!r.inputFrame||!r.sentFrame)&&r.inputFrame.frameRate>5&&r.sentFrame.frameRate<3}updateLocalStats(r){Array.from(this.localStats.entries()).forEach(s=>{let[o,c]=s;switch(o){case $e.LocalVideoTrack:case $e.LocalVideoLowTrack:{const h=c,m=G_({},fx),_=r.getStats(),E=r.getLocalMedia(o);if(_){const S=_.videoSend.find(R=>R.ssrc===(E==null?void 0:E.ssrcs[0].ssrcId));if(S){const R=r.getLocalVideoSize(),P=r.getEncoderConfig($e.LocalVideoTrack);S.codec!=="H264"&&S.codec!=="H265"&&S.codec!=="VP8"&&S.codec!=="VP9"&&S.codec!=="AV1X"&&S.codec!=="AV1"||(m.codecType=S.codec),m.sendBytes=S.bytes,m.sendBitrate=h?8*Math.max(0,m.sendBytes-h.sendBytes):0,S.inputFrame?(m.captureFrameRate=S.inputFrame.frameRate,m.captureResolutionHeight=S.inputFrame.height,m.captureResolutionWidth=S.inputFrame.width):R&&(m.captureResolutionWidth=R.width,m.captureResolutionHeight=R.height),S.sentFrame?(m.sendFrameRate=S.sentFrame.frameRate,m.sendResolutionHeight=S.sentFrame.height,m.sendResolutionWidth=S.sentFrame.width):R&&(m.sendResolutionWidth=R.width,m.sendResolutionHeight=R.height),S.avgEncodeMs&&(m.encodeDelay=S.avgEncodeMs),P&&P.bitrateMax&&(m.targetSendBitrate=1e3*P.bitrateMax),m.sendPackets=S.packets,m.sendPacketsLost=S.packetsLost,m.sendJitterMs=S.jitterMs,m.sendRttMs=S.rttMs,m.totalDuration=h?h.totalDuration+1:1,m.totalFreezeTime=h?h.totalFreezeTime:0,this.isLocalVideoFreeze(S)&&(m.totalFreezeTime+=1),S.scalabilityMode&&this.scalabilityMode!==S.scalabilityMode&&(L.debug("[".concat(this.store.clientId,"]: The scalabilityMode of the video sending stream is ").concat(S.scalabilityMode)),this.scalabilityMode=S.scalabilityMode)}this.trafficStats&&(m.currentPacketLossRate=(this.trafficStats.B_pvlr4||0)/100)}var u;this.localStats.set(o,m),((h==null?void 0:h.sendResolutionWidth)!==m.sendResolutionWidth||(h==null?void 0:h.sendResolutionHeight)!==m.sendResolutionHeight)&&((u=this.onStatsChanged)===null||u===void 0||u.call(this,"resolution",{width:m.sendResolutionWidth,height:m.sendResolutionHeight})),m&&E&&this.exceptionMonitor.setLocalVideoStats(this.store.uid,E.track,m);break}case $e.LocalAudioTrack:{const h=c,m=G_({},hx),_=r.getStats(),E=r.getLocalMedia(o);if(_){const S=_.audioSend.find(R=>R.ssrc===(E==null?void 0:E.ssrcs[0].ssrcId));if(S){if(S.codec!=="opus"&&S.codec!=="aac"&&S.codec!=="PCMU"&&S.codec!=="PCMA"&&S.codec!=="G722"||(m.codecType=S.codec),S.inputLevel)m.sendVolumeLevel=Math.round(32767*S.inputLevel);else{const R=r.getLocalAudioVolume();R&&(m.sendVolumeLevel=Math.round(32767*R))}m.sendBytes=S.bytes,m.sendPackets=S.packets,m.sendPacketsLost=S.packetsLost,m.sendJitterMs=S.jitterMs,m.sendRttMs=S.rttMs,m.sendBitrate=h?8*Math.max(0,m.sendBytes-h.sendBytes):0}}this.trafficStats&&(m.currentPacketLossRate=(this.trafficStats.B_palr4||0)/100),this.localStats.set($e.LocalAudioTrack,m),m&&E&&this.exceptionMonitor.setLocalAudioStats(this.store.uid,E.track,m);break}}})}updateRemoteStats(r){Array.from(this.remoteStats.entries()).forEach(s=>{var o,c;let[u,{videoStats:h,audioStats:m,videoPcStats:_}]=s;const E=m,S=h,R=_,P=G_({},O8),k=G_({},k8),z=G_({},vpe),{audioTrack:U,videoTrack:F,audioSSRC:q,videoSSRC:Y}=r.getRemoteMedia(u);let le;le=this.store.useP2P?r.getStats(!0):r.getStats();const ye=(o=le)===null||o===void 0?void 0:o.audioRecv.find(Ye=>Ye.ssrc===q),Ee=(c=le)===null||c===void 0?void 0:c.videoRecv.find(Ye=>Ye.ssrc===Y),me=this.trafficStats&&this.trafficStats.peer_delay.find(Ye=>Ye.peer_uid===u);if(ye&&(ye.codec!=="opus"&&ye.codec!=="aac"&&ye.codec!=="PCMU"&&ye.codec!=="PCMA"&&ye.codec!=="G722"||(P.codecType=ye.codec),ye.outputLevel?P.receiveLevel=Math.round(32767*ye.outputLevel):U&&(P.receiveLevel=Math.round(32767*U.getVolumeLevel())),P.receiveBytes=ye.bytes,P.receivePackets=ye.packets,P.receivePacketsLost=ye.packetsLost,P.receivePacketsDiscarded=ye.packetsDiscarded,P.packetLossRate=P.receivePacketsLost/(P.receivePackets+P.receivePacketsLost),P.receiveBitrate=E?8*Math.max(0,P.receiveBytes-E.receiveBytes):0,P.totalDuration=E?E.totalDuration+1:1,P.totalFreezeTime=E?E.totalFreezeTime:0,P.freezeRate=P.totalFreezeTime/P.totalDuration,P.receiveDelay=ye.jitterBufferMs,P.totalDuration>10&&LT.isRemoteAudioFreeze(U)&&(P.totalFreezeTime+=1)),Ee){var ke;Ee.codec!=="H264"&&Ee.codec!=="H265"&&Ee.codec!=="VP8"&&Ee.codec!=="VP9"&&Ee.codec!=="AV1X"&&Ee.codec!=="AV1"||(k.codecType=Ee.codec),k.receiveBytes=Ee.bytes,k.receiveBitrate=S?8*Math.max(0,k.receiveBytes-S.receiveBytes):0,k.decodeFrameRate=Ee.decodeFrameRate<0?0:Ee.decodeFrameRate,k.renderFrameRate=Ee.decodeFrameRate<0?0:Ee.decodeFrameRate,Ee.outputFrame&&(k.renderFrameRate=Ee.outputFrame.frameRate),Ee.receivedFrame?(k.receiveFrameRate=Ee.receivedFrame.frameRate,k.receiveResolutionHeight=Ee.receivedFrame.height,k.receiveResolutionWidth=Ee.receivedFrame.width):F&&(k.receiveResolutionHeight=F._videoHeight||0,k.receiveResolutionWidth=F._videoWidth||0),Ee.framesRateFirefox!==void 0&&(k.receiveFrameRate=Math.round(Ee.framesRateFirefox)),k.receivePackets=Ee.packets,k.receivePacketsLost=Ee.packetsLost,k.packetLossRate=k.receivePacketsLost/(k.receivePackets+k.receivePacketsLost);const Ye=S?S.totalFreezeTime:0,ut=S?S.totalDuration:0;k.totalDuration=S?S.totalDuration+1:1,k.totalFreezeTime=(ke=Ee.totalFreezesDuration)!==null&&ke!==void 0?ke:Ye||0,k.receiveDelay=Ee.jitterBufferMs||0;const pt=!!Y&&r.getRemoteVideoIsReady(Y);Ee.totalFreezesDuration===void 0&&F&&pt&&LT.isRemoteVideoFreeze(F,Ee,R)&&(k.totalFreezeTime+=1),k.freezeRate=Math.max(0,Math.min((k.totalFreezeTime-Ye)/(k.totalDuration-ut),1))}me&&(P.end2EndDelay=me.B_ad,k.end2EndDelay=me.B_vd,P.transportDelay=me.B_ed,k.transportDelay=me.B_ed,P.currentPacketLossRate=me.B_ealr4/100,k.currentPacketLossRate=me.B_evlr4/100,z.uplinkNetworkQuality=me.B_punq?me.B_punq:0,z.downlinkNetworkQuality=me.B_pdnq?me.B_pdnq:0),this.remoteStats.set(u,{audioStats:P,videoStats:k,videoPcStats:Ee,networkStats:z}),U&&this.exceptionMonitor.setRemoteAudioStats(U,P),F&&this.exceptionMonitor.setRemoteVideoStats(F,k)})}}class MH{constructor(){$(this,"destChannelMediaInfos",new Map),$(this,"srcChannelMediaInfo",void 0)}setSrcChannelInfo(r){WG(r),this.srcChannelMediaInfo=r}addDestChannelInfo(r){WG(r),this.destChannelMediaInfos.set(r.channelName,r)}removeDestChannelInfo(r){dP(r),this.destChannelMediaInfos.delete(r)}getSrcChannelMediaInfo(){return this.srcChannelMediaInfo}getDestChannelMediaInfo(){return this.destChannelMediaInfos}}function UH(t){if(!(t instanceof MH))return new Oe(X.INVALID_PARAMS,"Config should be instance of [ChannelMediaRelayConfiguration]").throw();const r=t.getSrcChannelMediaInfo(),s=t.getDestChannelMediaInfo();if(!r)return new Oe(X.INVALID_PARAMS,"srcChannelMediaInfo should not be empty").throw();if(s.size===0)return new Oe(X.INVALID_PARAMS,"destChannelMediaInfo should not be empty").throw()}class Mm{get hasVideo(){return this._video_enabled_&&!this._video_muted_&&this._video_added_}get hasAudio(){return this._audio_enabled_&&!this._audio_muted_&&this._audio_added_}get audioTrack(){if(this.hasAudio||this._audio_pre_subscribed)return this._audioTrack}get videoTrack(){if(this.hasVideo||this._video_pre_subscribed)return this._videoTrack}get dataChannels(){return this._dataChannels}constructor(r,s){$(this,"uid",void 0),$(this,"_uintid",void 0),$(this,"_trust_in_room_",!0),$(this,"_trust_audio_enabled_state_",!0),$(this,"_trust_video_enabled_state_",!0),$(this,"_trust_audio_mute_state_",!0),$(this,"_trust_video_mute_state_",!0),$(this,"_audio_muted_",!1),$(this,"_video_muted_",!1),$(this,"_audio_enabled_",!0),$(this,"_video_enabled_",!0),$(this,"_audio_added_",!1),$(this,"_video_added_",!1),$(this,"_is_pre_created",!1),$(this,"_video_pre_subscribed",!1),$(this,"_audio_pre_subscribed",!1),$(this,"_trust_video_stream_added_state_",!0),$(this,"_trust_audio_stream_added_state_",!0),$(this,"_audioTrack",void 0),$(this,"_videoTrack",void 0),$(this,"_dataChannels",[]),$(this,"_audioSSRC",void 0),$(this,"_videoSSRC",void 0),$(this,"_audioOrtc",void 0),$(this,"_videoOrtc",void 0),$(this,"_cname",void 0),$(this,"_rtxSsrcId",void 0),$(this,"_videoMid",void 0),$(this,"_audioMid",void 0),this.uid=r,this._uintid=s}}function VH(t,r){var s=Object.keys(t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);r&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(t,c).enumerable})),s.push.apply(s,o)}return s}function FH(t){for(var r=1;r<arguments.length;r++){var s=arguments[r]!=null?arguments[r]:{};r%2?VH(Object(s),!0).forEach(function(o){$(t,o,s[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(s)):VH(Object(s)).forEach(function(o){Object.defineProperty(t,o,Object.getOwnPropertyDescriptor(s,o))})}return t}const xT="9",jH=4e4;function BH(t,r){var s=Object.keys(t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);r&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(t,c).enumerable})),s.push.apply(s,o)}return s}function rp(t){for(var r=1;r<arguments.length;r++){var s=arguments[r]!=null?arguments[r]:{};r%2?BH(Object(s),!0).forEach(function(o){$(t,o,s[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(s)):BH(Object(s)).forEach(function(o){Object.defineProperty(t,o,Object.getOwnPropertyDescriptor(s,o))})}return t}var rS=function(t){return t[t.DOWN=0]="DOWN",t[t.UP=1]="UP",t}(rS||{});const RP=new Map;function WH(t,r,s,o){let{scale:c}=t;if(c===0&&o===rS.UP||c>=r.length-1&&o===rS.DOWN)return t;let u=rp(rp({},t),{},{scale:o===rS.DOWN?++c:--c});switch(s){case"maintain-framerate":u=rp(rp({},u),r[c].motion);break;case"maintain-resolution":u=rp(rp({},u),r[c].detail);break;case"balanced":u=rp(rp({},u),r[c].balanced)}return u}function zH(t,r){if(r){const s={overUse:0,underUse:0,adaptationList:GH(r)};RP.set(t,s)}else RP.delete(t)}function GH(t){const r=rp({},t),{bitrateMax:s,frameRate:o,scaleResolutionDownBy:c,bitrateMin:u}=r,{MIN_FRAME_RATE:h,MAX_THRESHOLD_FRAMERATE:m,MAX_SCALE:_,BITRATE_MIN_THRESHOLD:E,BITRATE_MAX_THRESHOLD:S,BWE_SCALE_UP_THRESHOLD:R,BWE_SCALE_DOWN_THRESHOLD:P,PERF_SCALE_DOWN_THRESHOLD:k,PERF_SCALE_UP_THRESHOLD:z,BALANCE_BITRATE_FACTOR:U,BALANCE_FRAMERATE_FACTOR:F,BALANCE_RESOLUTION_FACTOR:q,MOTION_RESOLUTION_FACTOR:Y,MOTION_BITRATE_FACTOR:le,DETAIL_FRAMERATE_FACTOR:ye,DETAIL_BITRATE_FACTOR:Ee}=sx,me=Math.min(r.frameRate,m),ke=[{scale:0,threshold:{bwe_down:Math.round(Math.pow(P,1)*s),bwe_up:s,fps_down:Math.round(Math.pow(k,1)*me),fps_up:o},balanced:{scaleResolutionDownBy:1,frameRate:o,bitrateMax:s,bitrateMin:u},motion:{scaleResolutionDownBy:1,frameRate:o,bitrateMax:s,bitrateMin:u},detail:{scaleResolutionDownBy:1,frameRate:o,bitrateMax:s,bitrateMin:u}}];for(let Ye=1;Ye<=_;Ye++){const ut={bwe_up:Math.round(Math.pow(R,Ye)*s),bwe_down:Math.round(Math.pow(P,Ye+1)*s),fps_up:Math.round(Math.pow(z,Ye)*me),fps_down:Math.round(Math.pow(k,Ye+1)*me)},pt={scaleResolutionDownBy:c/Math.pow(q,Ye),frameRate:Math.max(Math.round(Math.pow(F,Ye)*o),h),bitrateMax:Math.max(Math.round(Math.pow(U,Ye)*s),S),bitrateMin:Math.max(Math.round(Math.pow(U,Ye)*u),E)},vn={scaleResolutionDownBy:c/Math.pow(Y,Ye),frameRate:o,bitrateMax:Math.max(Math.round(Math.pow(le,Ye)*s),S),bitrateMin:Math.max(Math.round(Math.pow(le,Ye)*u),E)},Sn={scaleResolutionDownBy:1,frameRate:Math.max(Math.round(Math.pow(ye,Ye)*o),h),bitrateMax:Math.max(Math.round(Math.pow(Ee,Ye)*s),S),bitrateMin:Math.max(Math.round(Math.pow(Ee,Ye)*u),E)};ke.push({scale:Ye,threshold:ut,balanced:pt,motion:vn,detail:Sn})}return ke}function Ume(t,r,s,o,c,u){const h=RP.get(t)||{overUse:0,underUse:0,adaptationList:GH(c)},{adaptationList:m}=h;RP.set(t,h);const{OVERUSE_TIMES_THRESHOLD:_,UNDERUSE_TIMES_THRESHOLD:E}=sx,{scale:S}=o;let R,P;return typeof r=="number"&&r>0&&function(k,z,U,F){if(z>=U.length)return!1;let{threshold:{fps_down:q}}=U[z];return re("FORCE_AG_HIGH_FRAMERATE")&&F==="maintain-framerate"&&(q=U[0].threshold.fps_down),k<q}(r,S,m,u)&&(h.overUse++,P=ET.CPU,h.overUse>_)||typeof s=="number"&&s>0&&function(k,z,U){if(z>=U.length)return!1;const{threshold:{bwe_down:F}}=U[z];return k<F}(s,S,m)&&(h.overUse++,P=ET.BANDWIDTH,h.overUse>_)?(h.overUse=0,h.underUse=0,R=WH(o,m,u,rS.DOWN),[R,P]):(typeof r=="number"&&r>0&&typeof s=="number"&&s>0&&function(k,z,U,F){if(z===0)return;let{threshold:{fps_up:q}}=U[z];return re("FORCE_AG_HIGH_FRAMERATE")&&F==="maintain-framerate"&&(q=U[1].threshold.fps_up),k>q}(r,S,m,u)&&function(k,z,U){if(z===0)return;const{threshold:{bwe_up:F}}=U[z];return k>F}(s,S,m)&&(h.underUse++,h.underUse>E&&(h.overUse=0,h.underUse=0,R=WH(o,m,u,rS.UP),R.scale===0&&(P=ET.NONE))),[R,P])}function HH(t,r){var s=Object.keys(t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);r&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(t,c).enumerable})),s.push.apply(s,o)}return s}function tM(t){for(var r=1;r<arguments.length;r++){var s=arguments[r]!=null?arguments[r]:{};r%2?HH(Object(s),!0).forEach(function(o){$(t,o,s[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(s)):HH(Object(s)).forEach(function(o){Object.defineProperty(t,o,Object.getOwnPropertyDescriptor(s,o))})}return t}function Vme(t){var r;return!!re("ENABLE_AG_ADAPTATION")&&!!(t instanceof bx||ot(r=t._hints).call(r,ar.CUSTOM_TRACK))&&(!!re("FORCE_SUPPORT_AG_ADAPTATION")||!!(function(s){const o=Rn();if(o.os!==zi.IOS||!o.osVersion)return!1;const c=o.osVersion.split(".");return Number(c[0])>=s}(14)&&BW(17,4)||jW(14)&&WW(17,4,!0)))}const CP=new Map;function IP(t,r){const s=CP.get(t);if(s){const{timer:o}=s;window.clearTimeout(o),CP.delete(t)}r.qualityLimitationReason=ET.NONE,zH(t)}function Fme(t,r){var s;let o;switch(r){case $e.LocalAudioTrack:o=zn.Audio;break;case $e.LocalVideoTrack:o=ot(s=t._hints).call(s,ar.SCREEN_TRACK)?zn.Screen:zn.High;break;case $e.LocalVideoLowTrack:o=zn.Low}return o}function nM(t){const r=kn();if(t.some(s=>s._bypassWebAudio))throw new Le(X.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio");if(!r.webAudioMediaStreamDest)throw new Le(X.NOT_SUPPORTED,"cannot publish multiple tracks because your browser does not support audio mixing")}function rM(t,r){nM(t);const s=new Ai;return t.forEach(o=>s.addAudioTrack(o)),s}const jme=!kn().supportUnifiedPlan||re("CHROME_FORCE_PLAN_B")&&Kf();function AP(t){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};var s;return jme?(s={spec:r,store:t},tp("PlanBConnection").create(s)):new Th(r,t)}function iM(t){return t&&(t.iceConnectionState==="disconnected"||t.iceConnectionState==="checking"||t.iceConnectionState==="failed")}function $H(t){try{if(t.iceServers)return!1;if(t.turnServer&&t.turnServer.mode!=="off"){if(gT(t.turnServer.servers))return!1;if(re("FORCE_TURN_TCP")||t.turnServer.servers.concat(t.turnServer.serversFromGateway||[]).some(r=>r.forceturn))return!0}return!1}catch{return!1}}var Tn;function KH(t,r){var s=Object.keys(t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);r&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(t,c).enumerable})),s.push.apply(s,o)}return s}function vd(t){for(var r=1;r<arguments.length;r++){var s=arguments[r]!=null?arguments[r]:{};r%2?KH(Object(s),!0).forEach(function(o){$(t,o,s[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(s)):KH(Object(s)).forEach(function(o){Object.defineProperty(t,o,Object.getOwnPropertyDescriptor(s,o))})}return t}let Th=(Tn=class dy extends $G{get currentLocalDescription(){return this.peerConnection.currentLocalDescription}get currentRemoteDescription(){return this.peerConnection.currentRemoteDescription}get peerConnectionState(){return this.peerConnection.connectionState}get iceConnectionState(){return this.peerConnection.iceConnectionState}get dtlsTransportState(){var r,s;return(r=(s=this.peerConnection.getReceivers()[0])===null||s===void 0||(s=s.transport)===null||s===void 0?void 0:s.state)!==null&&r!==void 0?r:null}get localCodecs(){return[...new Set(this.localCapabilities&&this.localCapabilities.send.videoCodecs.map(r=>r.rtpMap&&r.rtpMap.encodingName.toLowerCase()||"").filter(r=>{var s;return ot(s=Object.keys(KA)).call(s,r)}))]}constructor(r,s){super(r,s),$(this,"id",or(5,"connection-")),$(this,"store",void 0),$(this,"peerConnection",void 0),$(this,"forceTurn",!1),$(this,"remoteSDP",void 0),$(this,"initialOffer",void 0),$(this,"transportEventReceiver",void 0),$(this,"statsFilter",void 0),$(this,"extension",{useXR:re("USE_XR")}),$(this,"localCapabilities",void 0),$(this,"remoteCodecs",void 0),$(this,"localCandidateCount",0),$(this,"allCandidatesReceived",!1),$(this,"isPreallocation",!1),$(this,"preSSRCMap",new Map),$(this,"dataStreamChannelMap",new Map),$(this,"establishPromise",void 0),$(this,"recoveredDataChannelIds",[]),$(this,"currentDataChannelId",1),$(this,"supportAV1RtpSpec",!1),$(this,"mutex",void 0),$(this,"qualityLimitationReason",ET.NONE),$(this,"isFirstConnected",!1),this.store=s,this.forceTurn=$H(r),this.mutex=new ks("P2PConnection-mutex",s.clientId),this.peerConnection=new RTCPeerConnection(dy.resolvePCConfiguration(r),{optional:[{googDscp:!0}]}),this.isFirstConnected=!1,this.statsFilter=nx(this.peerConnection,re("STATS_UPDATE_INTERVAL"),void 0,Dr()?1200:void 0),this.bindPCEvents(),this.bindStatsEvents(),this.store.p2pId=this.store.p2pId+1,this.establishPromise=this.establish()}getPreMedia(r){const s=this.preSSRCMap.get(r);if(s!==void 0){const o=this.peerConnection.getTransceivers().find(c=>c.mid===s);if(o)return{transceiver:o,track:o.receiver.track,id:s}}}async updateRemoteRTPCapabilities(r,s){if(this.remoteCodecs=s,!this.remoteSDP)return void L.debug("[P2PConnection] cannot updateRemoteRTPCapabilities before remote SDP created, local codecs: ".concat(this.localCodecs,", codecs: ").concat(s));if(this.remoteSDP.updateRemoteCodec(r,s,this.store.codec)){const o=await this.peerConnection.createOffer(),c=this.logSDPExchange(o.sdp||"","offer","local","muteLocal");await this.peerConnection.setLocalDescription(o);const u=this.remoteSDP.toString();c==null||c(u),await this.peerConnection.setRemoteDescription({type:"answer",sdp:u})}else L.debug("[P2PConnection] updateRemoteRTPCapabilities no need to exchange SDP.")}async establish(){try{this.peerConnection.addTransceiver("video",{direction:"recvonly"}),this.peerConnection.addTransceiver("audio",{direction:"recvonly"});const o=await this.peerConnection.createOffer();if(!o.sdp)throw new Error("Cannot get initialOffer.sdp when trying to establish PeerConnection.");const c=Lm(o.sdp),u=await hH({filterRTX:!re("USE_PUB_RTX")&&!re("USE_SUB_RTX"),filterVideoFec:re("FILTER_VIDEO_FEC"),filterAudioFec:re("FILTER_AUDIO_FEC"),filterVideoCodec:re("FILTER_VIDEO_CODEC")},this.extension);if(this.localCapabilities=vP(u),this.initialOffer=o,re("ENABLE_SVC")&&this.store.codec=="av1"){const m=await async function(){try{const _=new RTCPeerConnection;_.addTransceiver("video",{direction:"sendonly",sendEncodings:[{scalabilityMode:HA.L1T3}]});const E=await _.createOffer();if(!E.sdp)return void _.close();const S=Ca(E.sdp).mediaDescriptions[0];if(!S)return;const R=S.attributes.extmaps.find(P=>P.extensionName==="https://aomediacodec.github.io/av1-rtp-spec/#dependency-descriptor-rtp-header-extension");return _.close(),R}catch{return}}();var r;m&&(this.supportAV1RtpSpec=!0,(r=u.send)===null||r===void 0||r.videoExtensions.push(m))}let h;return o.sdp&&gH(o.sdp)&&(h=Mr(u),(s=h).send&&(Qv(gt.VIDEO,s.send.videoExtensions),Qv(gt.AUDIO,s.send.audioExtensions)),s.recv&&(Qv(gt.VIDEO,s.recv.videoExtensions),Qv(gt.AUDIO,s.recv.audioExtensions)),s.sendrecv&&(Qv(gt.VIDEO,s.sendrecv.videoExtensions),Qv(gt.AUDIO,s.sendrecv.audioExtensions))),vd(vd({},c),{},{rtpCapabilities:h||u,offerSDP:o.sdp})}catch(o){throw new Le(X.GET_LOCAL_CONNECTION_PARAMS_FAILED,o.toString())}var s}async connect(r){try{if(!this.initialOffer)throw new Error("Cannot establish P2PConnection without initial offer.");this.initialOffer.sdp&&gH(this.initialOffer.sdp)&&(s=r.rtpCapabilities,o=this.localCapabilities,s.send&&(_P(gt.VIDEO,s.send.videoExtensions,o.send.videoExtensions),_P(gt.AUDIO,s.send.audioExtensions,o.send.audioExtensions)),s.recv&&(_P(gt.VIDEO,s.recv.videoExtensions,o.recv.videoExtensions),_P(gt.AUDIO,s.recv.audioExtensions,o.recv.audioExtensions))),this.remoteSDP=new class{get localCapabilities(){return Mr(this._localCapabilities)}get rtpCapabilities(){return Mr(this._rtpCapabilities)}get candidates(){return Mr(this._candidates)}get iceParameters(){return Mr(this._iceParameters)}get dtlsParameters(){return Mr(this._dtlsParameters)}constructor(E){let S=arguments.length>1&&arguments[1]!==void 0&&arguments[1];$(this,"sessionDesc",void 0),$(this,"_localCapabilities",void 0),$(this,"_rtpCapabilities",void 0),$(this,"_candidates",void 0),$(this,"_originCandidates",void 0),$(this,"_iceParameters",void 0),$(this,"_isUseExtmapAllowMixed",void 0),$(this,"_dtlsParameters",void 0),$(this,"setup",void 0),$(this,"currentMidIndex",void 0),$(this,"cname",void 0),$(this,"firefoxSsrcMidMap",new Map),this._isUseExtmapAllowMixed=S,E=Mr(E);const{iceParameters:R,dtlsParameters:P,candidates:k,rtpCapabilities:z,setup:U,localCapabilities:F,cname:q}=E;this._rtpCapabilities=z,this._candidates=k,this._originCandidates=Mr(k),this._iceParameters=R,this._dtlsParameters=P,this._localCapabilities=F,this.setup=U,this.cname=q,this.sessionDesc=this.updateRemoteRTPCapabilities(z),this.currentMidIndex=this.sessionDesc.mediaDescriptions.length-1}preloadRemoteMedia(E){const S=this.candidates,R=this.dtlsParameters,P=this.iceParameters,k=this.rtpCapabilities.send;let z=this.sessionDesc.mediaDescriptions.length-1;for(let U=1;U<E;U++){const F=2*U+2e4,q=2*U+jH,{ssrcs:Y,ssrcGroups:le}=z_([{ssrcId:F}],this.cname),{ssrcs:ye,ssrcGroups:Ee}=z_([{ssrcId:q,rtx:re("USE_SUB_RTX")?q+1:void 0}],this.cname);this.sessionDesc.mediaDescriptions.push({media:{mediaType:"video",port:xT,protos:["UDP","TLS","RTP","SAVPF"],fmts:k.videoCodecs.map(me=>me.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:P.iceUfrag,icePwd:P.icePwd,unrecognized:[],candidates:S,extmaps:k.videoExtensions,fingerprints:R.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:ye,ssrcGroups:Ee,rtcpFeedbackWildcards:[],payloads:k.videoCodecs,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:"sendonly",rtcpMux:!0,rtcpRsize:!0,mid:"".concat(++z)}}),this.sessionDesc.mediaDescriptions.push({media:{mediaType:"audio",port:xT,protos:["UDP","TLS","RTP","SAVPF"],fmts:k.audioCodecs.map(me=>me.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:P.iceUfrag,icePwd:P.icePwd,unrecognized:[],candidates:S,extmaps:k.audioExtensions,fingerprints:R.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:Y,ssrcGroups:le,rtcpFeedbackWildcards:[],payloads:k.audioCodecs,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:"sendonly",rtcpMux:!0,rtcpRsize:!0,mid:"".concat(++z)}}),this.currentMidIndex+=2}this.updateBundleMids()}toString(){return Pm(this.sessionDesc)}send(E,S,R,P){const{ssrcs:k,ssrcGroups:z}=z_(S,this.cname,re("SYNC_GROUP")?R:void 0),U=this.findPreloadMediaDesc(k);if(U){if(Dr()&&this.firefoxSsrcMidMap.set(k[0].ssrcId,U.attributes.mid),P&&(P.twcc||P.remb)){const F=this.sessionDesc.mediaDescriptions.indexOf(U);return this.sessionDesc.mediaDescriptions[F]=this.mungSendMediaDesc(U,P),{mid:U.attributes.mid,needExchangeSDP:!0}}return{mid:U.attributes.mid,needExchangeSDP:!1}}{const F=this.findAvailableMediaIndex(E,k);let q;return F===-1||F===1&&(Ss()||function(){const Y=Rn();return!(Y.name!==Un.CHROME||!Y.osVersion)&&Number(Y.version)<=90}()||re("ENABLE_ENCODED_TRANSFORM")&&$f())||F===0&&re("USE_SUB_RTX")||zW()?(q=this.createOrRecycleSendMedia(E,k,z,"sendonly",P),this.updateBundleMids()):(q=Mr(this.sessionDesc.mediaDescriptions[F]),q.attributes.direction="sendonly",q.attributes.ssrcs=k,q.attributes.ssrcGroups=z,this.sessionDesc.mediaDescriptions[F]=this.mungSendMediaDesc(q,P)),Dr()&&this.firefoxSsrcMidMap.set(k[0].ssrcId,q.attributes.mid),{mid:q.attributes.mid,needExchangeSDP:!0}}}sendDataChannel(){const{mediaDesc:E,needExchangeSDP:S}=this.createOrRecycleDataChannel();return this.updateBundleMids(),{mid:E.attributes.mid,needExchangeSDP:S}}batchSend(E){const S=E.map(k=>{let{kind:z,ssrcMsg:U,mslabel:F}=k;return this.send(z,U,F)}),R=[];let P=!1;return S.forEach(k=>{let{mid:z,needExchangeSDP:U}=k;U&&(P=!0),R.push(z)}),{mids:R,needExchangeSDP:P}}stopSending(E){const S=this.sessionDesc.mediaDescriptions.filter(R=>R.attributes.mid&&E.indexOf(R.attributes.mid)!==-1);if(S.length!==E.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.stopSending.");S.forEach(R=>{R.attributes.mid==="0"||Dr()||zW()?R.attributes.ssrcs=[]:(R.attributes.ssrcs=[],R.attributes.direction="inactive",R.media.port="0")}),this.updateBundleMids()}mute(E){const S=this.sessionDesc.mediaDescriptions.find(R=>R.attributes.mid===E);if(!S)throw new Error("mediaDescription not found with ".concat(E," in remote SDP when calling RemoteSDP.mute."));S.attributes.direction="inactive"}unmute(E){const S=this.sessionDesc.mediaDescriptions.find(R=>R.attributes.mid===E);if(!S)throw new Error("mediaDescription not found with ".concat(E," in remote SDP when calling RemoteSDP.unmute."));S.attributes.direction="sendonly"}muteRemote(E){const S=this.sessionDesc.mediaDescriptions.filter(R=>ot(E).call(E,R.attributes.mid||""));if(S.length!==E.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");S.forEach(R=>{R.attributes.direction="inactive"})}unmuteRemote(E){const S=this.sessionDesc.mediaDescriptions.filter(R=>ot(E).call(E,R.attributes.mid||""));if(S.length!==E.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");S.forEach(R=>{R.attributes.direction="recvonly"})}receive(E,S,R,P){E.forEach((k,z)=>{this.createOrRecycleRecvMedia(k,[],"recvonly",S,R,P[z])}),this.updateBundleMids()}stopReceiving(E){const S=this.sessionDesc.mediaDescriptions.filter(R=>E.indexOf(R.attributes.mid)!==-1);if(S.length!==E.length)throw new Error("MediaDescriptions' length doesn't match mids's length when calling RemoteSDP.receive.");S.forEach(R=>{R.media.port="0",R.attributes.direction="inactive"}),this.updateBundleMids()}updateRemoteRTPCapabilities(E){const S=this.sessionDesc||Ca((R=this._isUseExtmapAllowMixed,`v=0
o=- 0 0 IN IP4 127.0.0.1
s=AgoraGateway
t=0 0
a=group:BUNDLE 0 1
a=msid-semantic: WMS
a=ice-lite`.concat(R?`
a=extmap-allow-mixed`:"",`
m=video 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendonly
a=rtcp-mux
a=rtcp-rsize
a=mid:0
m=audio 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendonly
a=rtcp-mux
a=rtcp-rsize
a=mid:1
`)));var R;this._rtpCapabilities=E;const P=this.rtpCapabilities.send,k=this.localCapabilities.send;for(const z of S.mediaDescriptions){if(z.attributes.iceUfrag=this._iceParameters.iceUfrag,z.attributes.icePwd=this._iceParameters.icePwd,z.attributes.fingerprints=this._dtlsParameters.fingerprints,z.attributes.candidates=this._candidates,z.attributes.setup=this.setup,z.media.mediaType==="application"&&(z.attributes.sctpPort="5000"),z.media.mediaType==="video"){if(P.videoCodecs.length===0){const U=k.videoCodecs.filter(F=>{var q,Y;return(q=F.rtpMap)===null||q===void 0?void 0:ot(Y=q.encodingName.toLowerCase()).call(Y,"vp8")})||[k.videoCodecs[0]];z.media.fmts=U.map(F=>F.payloadType.toString(10)),z.attributes.payloads=U,z.attributes.extmaps=[]}else if(z.media.fmts=P.videoCodecs.map(U=>U.payloadType.toString(10)),z.attributes.payloads=P.videoCodecs,z.attributes.extmaps=P.videoExtensions,re("PRELOAD_MEDIA_COUNT")>0){const{ssrcs:U,ssrcGroups:F}=z_([{ssrcId:jH,rtx:re("USE_SUB_RTX")?40001:void 0}],this.cname);z.attributes.ssrcs=U,z.attributes.ssrcGroups=F}}if(z.media.mediaType==="audio"){if(P.audioCodecs.length===0){const U=k.audioCodecs.filter(F=>{var q,Y;return(q=F.rtpMap)===null||q===void 0?void 0:ot(Y=q.encodingName.toLowerCase()).call(Y,"opus")})||[k.audioCodecs[0]];z.media.fmts=U.map(F=>F.payloadType.toString(10)),z.attributes.payloads=U,z.attributes.extmaps=[]}else if(z.media.fmts=P.audioCodecs.map(U=>U.payloadType.toString(10)),z.attributes.payloads=P.audioCodecs,z.attributes.extmaps=P.audioExtensions,eS(z),re("PRELOAD_MEDIA_COUNT")>0){const{ssrcs:U,ssrcGroups:F}=z_([{ssrcId:2e4}],this.cname);z.attributes.ssrcs=U,z.attributes.ssrcGroups=F}}}return this.sessionDesc=S,this.currentMidIndex=S.mediaDescriptions.length-1,this.sessionDesc}updateCandidates(E){const S=this._originCandidates.filter(P=>P.transport==="udp"),R=[];if(S.forEach(P=>{R.push(FH(FH({},P),{},{foundation:"tcpcandidate",priority:Number(P.priority)-1+"",transport:"tcp",port:Number(P.port)+90+""}))}),S.length!==0){switch(E){case Ds.TCP_RELAY:this._candidates=R;break;case Ds.UDP_TCP_RELAY:case Ds.RELAY:this._candidates=[...S,...R];break;default:this._candidates=S}for(const P of this.sessionDesc.mediaDescriptions)P.attributes.candidates=this.candidates}}restartICE(E){E=Mr(E),this._iceParameters=E,this.sessionDesc.mediaDescriptions.forEach(S=>{S.attributes.iceUfrag=E.iceUfrag,S.attributes.icePwd=E.icePwd})}predictReceivingMids(E){const S=[];for(let R=0;R<E;R++)S.push((this.currentMidIndex+R+1).toString(10));return S}findAvailableMediaIndex(E,S){return this.sessionDesc.mediaDescriptions.findIndex(R=>{const P=R.media.mediaType===E&&R.media.port!=="0"&&(R.attributes.direction==="sendonly"||R.attributes.direction==="sendrecv")&&R.attributes.ssrcs.length===0;if(Dr()){if(P){const k=this.firefoxSsrcMidMap.get(S[0].ssrcId);return!(k||R.attributes.mid!=="0"&&R.attributes.mid!=="1")||!(!k||k!==R.attributes.mid)}return!1}return P})}createOrRecycleDataChannel(){for(const R of this.sessionDesc.mediaDescriptions)if(R.media.mediaType==="application")return{mediaDesc:R,needExchangeSDP:!1};this.currentMidIndex+=1;const E="".concat(this.currentMidIndex),S={media:{mediaType:"application",port:xT,protos:["UDP","DTLS","SCTP"],fmts:["webrtc-datachannel"]},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:this.candidates,extmaps:[],fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:[],ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:[],rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,mid:"".concat(E),sctpPort:"5000"}};return this.sessionDesc.mediaDescriptions.push(S),{mediaDesc:S,needExchangeSDP:!0}}createOrRecycleRecvMedia(E,S,R,P,k,z){const U=E._mediaStreamTrack.kind,F=this.rtpCapabilities.recv,q=OT(U,F,this.localCapabilities.send,U===gt.VIDEO?P:k),Y=U===gt.VIDEO?F.videoExtensions:F.audioExtensions;this.currentMidIndex+=1;const le="".concat(this.currentMidIndex);let ye={media:{mediaType:U,port:xT,protos:["UDP","TLS","RTP","SAVPF"],fmts:q.map(me=>me.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:this.candidates,extmaps:Y,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:S,ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:q,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:R,rtcpMux:!0,rtcpRsize:!0,mid:"".concat(le)}};ye=this.mungRecvMediaDsec(ye,E,z);const Ee=this.findFirstClosedMedia(U);if(Ee){const me=this.sessionDesc.mediaDescriptions.indexOf(Ee);this.sessionDesc.mediaDescriptions[me]=ye}else this.sessionDesc.mediaDescriptions.push(ye);return ye}updateRemoteCodec(E,S,R){const P=[...new Set(this._rtpCapabilities.recv.videoCodecs.map(ye=>ye.rtpMap&&ye.rtpMap.encodingName.toLowerCase()||"").filter(ye=>{var Ee;return ot(Ee=Object.keys(KA)).call(Ee,ye)}))],k=new Set(S);if(P.every(ye=>k.has(ye)))return L.debug("codecs has not changed, no need to updateRemoteCodec, codecs: ".concat(S)),!1;const z=this._rtpCapabilities.recv.videoCodecs.filter(ye=>S.some(Ee=>{var me;return ot(me=ye.rtpMap&&ye.rtpMap.encodingName.toLowerCase()||"").call(me,Ee)}));if(z.length===0)return L.debug("updateRemoteCodec failed, because cannot find matched codec, remoteCapabilities codecs: ".concat(P," codecs: ").concat(S)),!1;const U=[...new Set(z.map(ye=>ye.rtpMap&&ye.rtpMap.encodingName.toLowerCase()||""))];let F;if(L.debug("updateRemoteCodec, from ".concat(P," to ").concat(U)),E.length===0)F=this.sessionDesc.mediaDescriptions.filter(ye=>ye.media.mediaType==="video"&&ye.attributes.direction==="recvonly");else if(F=this.sessionDesc.mediaDescriptions.filter(ye=>ye.attributes.mid&&ot(E).call(E,ye.attributes.mid)&&ye.attributes.direction==="recvonly"),F.length!==E.length)return L.debug("updateRemoteCodec failed, because cannot find mids, mids: ".concat(E,", codecs: ").concat(S)),!1;if(re("USE_PUB_RTX")||re("USE_SUB_RTX")){const ye=Gx(z,this.rtpCapabilities.recv.videoCodecs);z.push(...ye)}this._rtpCapabilities.recv.videoCodecs=z;const q=this.localCapabilities.send,Y=this.rtpCapabilities.recv,le=OT(gt.VIDEO,Y,q,R);return F.forEach(ye=>{const Ee=le.map(me=>me.payloadType.toString(10));L.debug("updateRemoteCodec mid: ".concat(ye.attributes.mid,", from"),ye.attributes.payloads,"to",le),ye.attributes.payloads=le,ye.media.fmts=Ee}),!0}createOrRecycleSendMedia(E,S,R,P,k){const z=this.rtpCapabilities.send,U=E===gt.VIDEO?z.videoCodecs:z.audioCodecs,F=E===gt.VIDEO?z.videoExtensions:z.audioExtensions;this.currentMidIndex+=1;const q="".concat(this.currentMidIndex);let Y={media:{mediaType:E,port:xT,protos:["UDP","TLS","RTP","SAVPF"],fmts:U.map(ye=>ye.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:this.candidates,extmaps:F,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:S,ssrcGroups:R,rtcpFeedbackWildcards:[],payloads:U,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:P,rtcpMux:!0,rtcpRsize:!0,mid:"".concat(q)}};Y=this.mungSendMediaDesc(Y,k);const le=this.findFirstClosedMedia(E);if(le){const ye=this.sessionDesc.mediaDescriptions.indexOf(le);this.sessionDesc.mediaDescriptions[ye]=Y}else this.sessionDesc.mediaDescriptions.push(Y);return Y}updateBundleMids(){this.sessionDesc.attributes.groups[0].identificationTag=this.sessionDesc.mediaDescriptions.filter(E=>E.media.port!=="0").map(E=>E.attributes.mid)}mungRecvMediaDsec(E,S,R){const P=Mr(E);return Wx(P),Zv(P,S),zx(P,S),uH(P),EP(P,R,this.localCapabilities.send),P}mungSendMediaDesc(E,S){const R=Mr(E);return EP(R,S,this.localCapabilities.recv),eS(R),R}updateRecvMedia(E,S){const R=this.sessionDesc.mediaDescriptions.findIndex(P=>P.attributes.mid===E);if(R!==-1){const P=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[R],S);this.sessionDesc.mediaDescriptions[R]=P}}bumpMid(E){this.currentMidIndex+=E}findFirstClosedMedia(E){return this.sessionDesc.mediaDescriptions.find(S=>Dr()?S.media.port==="0"&&S.media.mediaType===E:S.media.port==="0")}findPreloadMediaDesc(E){return this.sessionDesc.mediaDescriptions.find(S=>{var R;return((R=S.attributes)===null||R===void 0||(R=R.ssrcs[0])===null||R===void 0?void 0:R.ssrcId)===E[0].ssrcId})}getSSRC(E){var S;return(S=this.sessionDesc.mediaDescriptions.find(R=>R.attributes.mid===E))===null||S===void 0?void 0:S.attributes.ssrcs}}(vd(vd({},r),{},{localCapabilities:this.localCapabilities}),this.supportAV1RtpSpec),r.preallocation&&(this.isPreallocation=!0),Array.isArray(this.remoteCodecs)&&this.remoteCodecs.length>0&&this.remoteSDP.updateRemoteCodec([],this.remoteCodecs,this.store.codec);const c=this.remoteSDP.toString(),u=pH(this.initialOffer.sdp,this.extension),h=this.logSDPExchange(u||"","offer","local","connect");this.store.descriptionStart(),await this.peerConnection.setLocalDescription({type:"offer",sdp:u}),h==null||h(c),await this.peerConnection.setRemoteDescription({type:"answer",sdp:c});const m=this.peerConnection.getTransceivers()[0];if(m!=null&&m.receiver&&this.tryBindTransportEvents(m.receiver),re("PRELOAD_MEDIA_COUNT")>0){this.remoteSDP.preloadRemoteMedia(re("PRELOAD_MEDIA_COUNT"));const E=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:E});const S=await this.peerConnection.createAnswer();await this.peerConnection.setLocalDescription(S)}const{preSSRCs:_}=r;if(Array.isArray(_)&&_.length>0){const{mids:E}=this.remoteSDP.batchSend(_.map(S=>({kind:S.kind,ssrcMsg:[{ssrcId:S.ssrcId,rtx:S.rtx}],mslabel:S.mslabel})));E.forEach((S,R)=>{this.preSSRCMap.set(_[R].ssrcId,S)}),await kT(this.peerConnection,this.remoteSDP,this.extension),L.debug("[".concat(this.store.clientId,"] [P2PConnection] pre-batchReceive exchange SDP."))}}catch(c){throw new Le(X.EXCHANGE_SDP_FAILED,"P2PConnection.connect failed; ".concat(c.toString()))}var s,o}async updateRemoteConnect(r){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.updateRemoteConnect before remote SDP created");const{rtpCapabilities:s}=r;this.remoteSDP.updateRemoteRTPCapabilities(s),Array.isArray(this.remoteCodecs)&&this.remoteCodecs.length>0&&this.remoteSDP.updateRemoteCodec([],this.remoteCodecs,this.store.codec);const{preSSRCs:o}=r;if(Array.isArray(o)&&o.length>0){const{mids:c}=this.remoteSDP.batchSend(o.map(u=>Object.assign({},{kind:u.kind,ssrcMsg:[{ssrcId:u.ssrcId,rtx:u.rtx}],mslabel:u.mslabel})));c.forEach((u,h)=>{this.preSSRCMap.set(o[h].ssrcId,u)})}await kT(this.peerConnection,this.remoteSDP,this.extension),L.debug("[P2PConnection] updateRemoteRTPCapabilities by exchanging SDP.")}catch(s){throw new Le(X.EXCHANGE_SDP_FAILED,"P2PConnection.updateRemoteConnect failed; ".concat(s.toString()))}}send(r,s,o){var c=this;return _l(function*(){const u=yield wn(c.mutex.lock("From P2PConnection.send"));try{if(!c.remoteSDP)throw new Error("Cannot call P2PConnection.send before remote SDP created");const h=[],m=gP();r.forEach(F=>{const q=c.peerConnection.addTransceiver(F._mediaStreamTrack,vd({direction:"sendonly"},F.trackMediaType==="video"&&c.supportAV1RtpSpec&&m?{sendEncodings:[{scalabilityMode:m}]}:{}));h.push(q),F._updateRtpTransceiver(q)}),Dr()&&re("SIMULCAST")===!0&&(yield wn(c.applySimulcastForFirefox(h,r)));const _=yield wn(c.peerConnection.createOffer()),E=c.remoteSDP.predictReceivingMids(r.length),S=c.mungSendOfferSDP(_.sdp,r,E),R=Ca(S),P=E.map(F=>{const q=R.mediaDescriptions.find(Y=>Y.attributes.mid===F);if(!q)throw new Error("Cannot extract ssrc from mediaDescription.");return aH(q,re("USE_PUB_RTX"))});let k;try{k=yield P}catch(F){k=[],c.remoteSDP.receive(r,s,o,k);const q=c.remoteSDP.toString();throw yield wn(c.peerConnection.setLocalDescription({type:"offer",sdp:S})),yield wn(c.peerConnection.setRemoteDescription({type:"answer",sdp:q})),yield wn(c.stopSending(E,!0)),F}c.remoteSDP.receive(r,s,o,k);const z=c.remoteSDP.toString(),U=c.logSDPExchange(S,"offer","local","send");return yield wn(c.peerConnection.setLocalDescription({type:"offer",sdp:S})),yield wn(c.applySimulcastEncodings(h,r)),yield wn(c.applySendEncodings(h,r)),U==null||U(z),yield wn(c.peerConnection.setRemoteDescription({type:"answer",sdp:z})),h.map((F,q)=>{const Y=E[q];return{localSSRC:P[q],id:Y,transceiver:F}})}catch(h){throw h instanceof Le?h:new Le(X.EXCHANGE_SDP_FAILED,"P2PConnection.send failed; ".concat(h.toString()))}finally{u()}})()}async createDataChannels(r,s){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.createDataChannels before remote SDP created");let o=this.dataStreamChannelMap.get(r);if(o&&o.readyState==="open")L.debug("[P2PConnection] Channels are already available and can be reused directly.");else{const u=this.currentDataChannelId<1023?this.currentDataChannelId++:this.recoveredDataChannelIds.shift();if(typeof u!="number")throw new Error("create DataChannel error, because cannot get dc id");o=this.peerConnection.createDataChannel("datastream-channel",{id:u,negotiated:!0,ordered:!1,maxRetransmits:re("DATASTREAM_MAX_RETRANSMITS")}),o.binaryType="arraybuffer",this.dataStreamChannelMap.set(r,o)}s.forEach(u=>{u._updateOriginDataChannel(o)});const{needExchangeSDP:c}=this.remoteSDP.sendDataChannel();if(c){const u=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:u});const h=await this.peerConnection.createAnswer();await this.peerConnection.setLocalDescription(h),L.debug("[P2PConnection] createDataChannels by exchanging SDP.")}else L.debug("[P2PConnection] createDataChannels no need to exchange SDP.");return}catch(o){throw o instanceof Le?o:new Le(X.EXCHANGE_SDP_FAILED,"P2PConnection.createDataChannels failed; ".concat(o.toString()))}}async stopDataChannels(r){try{const s=this.dataStreamChannelMap.get(r);return s&&(s.id&&this.recoveredDataChannelIds.push(s.id),s.close()),void this.dataStreamChannelMap.delete(r)}catch(s){throw s instanceof Le?s:new Le(X.DATACHANNEL_FAILED,"P2PConnection.stopDataChannels failed; ".concat(s.toString()))}}async stopSending(r,s){const o=s?void 0:await this.mutex.lock("From P2PConnection.stopSending");try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopSending before remote SDP created");const c=this.peerConnection.getTransceivers().filter(_=>r.indexOf(_.mid)!==-1);if(c.length!==r.length)throw new Error("Transceivers' length doesn't match mids' length when trying to call P2PConnection.stopSending.");c.map(_=>{var E;IP(this.id+_.mid,this),_.direction="inactive",(E=_.stop)===null||E===void 0||E.call(_)});const u=await this.peerConnection.createOffer(),h=this.logSDPExchange(u.sdp||"","offer","local","stopSending");await this.peerConnection.setLocalDescription(u),this.remoteSDP.stopReceiving(r);const m=this.remoteSDP.toString();h==null||h(m),await this.peerConnection.setRemoteDescription({type:"answer",sdp:m})}catch(c){throw new Le(X.EXCHANGE_SDP_FAILED,"P2PConnection.stopSending failed; ".concat(c.toString()))}finally{o&&o()}}async receive(r,s,o,c){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.receive ".concat(r," before remoteSDP created."));const{mid:u,needExchangeSDP:h}=this.remoteSDP.send(r,s,o,c);h&&(await kT(this.peerConnection,this.remoteSDP,this.extension),L.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(r," by exchanging SDP.")));const m=this.peerConnection.getTransceivers().find(_=>_.mid===u);if(!m)throw new Error("Cannot get transceiver after setLocalDescription.");return{track:m.receiver.track,id:u,transceiver:m}}catch(u){throw new Le(X.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(u.toString()))}}async batchReceive(r){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.batchReceive before remoteSDP created.");const{mids:s,needExchangeSDP:o}=this.remoteSDP.batchSend(r);return o&&(await kT(this.peerConnection,this.remoteSDP,this.extension),L.debug("[".concat(this.store.clientId,"] [P2PConnection] batchReceive by exchanging SDP."))),s.map(c=>{const u=this.peerConnection.getTransceivers().find(h=>h.mid===c);if(!u)throw new Error("Cannot get transceiver after setLocalDescription.");return{track:u.receiver.track,id:c,transceiver:u}})}catch(s){throw new Le(X.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(s.toString()))}}async stopReceiving(r){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopReceiving before remote SDP created.");r.forEach(u=>{Array.from(this.preSSRCMap.entries()).some(h=>{let[m,_]=h;if(_===u)return this.preSSRCMap.delete(m),!0})}),this.remoteSDP.stopSending(r);const s=this.remoteSDP.toString(),o=this.logSDPExchange(s,"offer","remote","stopReceiving");await this.peerConnection.setRemoteDescription({type:"offer",sdp:s});const c=await this.peerConnection.createAnswer();o==null||o(c.sdp||""),await this.peerConnection.setLocalDescription(c)}catch(s){throw new Le(X.EXCHANGE_SDP_FAILED,"P2PConnection stopReceiving failed; ".concat(s.toString()))}}async muteRemote(r){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.muteRemote mid=".concat(r," before remote SDP created."));this.remoteSDP.mute(r);const s=this.remoteSDP.toString(),o=this.logSDPExchange(s,"offer","remote","muteRemote");await this.peerConnection.setRemoteDescription({type:"offer",sdp:s});const c=await this.peerConnection.createAnswer();o==null||o(c.sdp||""),await this.peerConnection.setLocalDescription(c)}catch(s){throw new Le(X.EXCHANGE_SDP_FAILED,"P2PConnection.muteRemote failed; ".concat(s.toString()))}}async unmuteRemote(r){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.unmuteRemote mid=".concat(r," before remote SDP created."));this.remoteSDP.unmute(r);const s=this.remoteSDP.toString(),o=this.logSDPExchange(s,"offer","remote","unmuteRemote");await this.peerConnection.setRemoteDescription({type:"offer",sdp:s});const c=await this.peerConnection.createAnswer();o==null||o(c.sdp||""),await this.peerConnection.setLocalDescription(c)}catch(s){throw new Le(X.EXCHANGE_SDP_FAILED,"P2PConnection.unmuteRemote failed; ".concat(s.toString()))}}async muteLocal(r){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.muteLocal before remote SDP created.");const s=this.peerConnection.getTransceivers().filter(h=>h.mid&&r.indexOf(h.mid)!==-1);if(s.length!==r.length)throw new Error("Transceivers' length doesn't match mids' length.");s.map(h=>{h.direction="inactive"});const o=await this.peerConnection.createOffer(),c=this.logSDPExchange(o.sdp||"","offer","local","muteLocal");await this.peerConnection.setLocalDescription(o),this.remoteSDP.muteRemote(r);const u=this.remoteSDP.toString();c==null||c(u),await this.peerConnection.setRemoteDescription({type:"answer",sdp:u})}catch(s){throw new Le(X.EXCHANGE_SDP_FAILED,"P2PConnection.muteLocal failed; ".concat(s.toString()))}}async unmuteLocal(r){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.unmuteLocal before remote SDP created.");const s=this.peerConnection.getTransceivers().filter(h=>h.mid&&r.indexOf(h.mid)!==-1);if(s.length!==r.length)throw new Error("Transceivers' length doesn't match mids' length.");s.map(async(h,m)=>{h.direction="sendonly"});const o=await this.peerConnection.createOffer(),c=this.logSDPExchange(o.sdp||"","offer","local","unmuteLocal");await this.peerConnection.setLocalDescription(o),this.remoteSDP.unmuteRemote(r),Array.isArray(this.remoteCodecs)&&this.remoteCodecs.length>0&&this.remoteSDP.updateRemoteCodec(r,this.remoteCodecs,this.store.codec);const u=this.remoteSDP.toString();c==null||c(u),await this.peerConnection.setRemoteDescription({type:"answer",sdp:u})}catch(s){throw new Le(X.EXCHANGE_SDP_FAILED,"P2PConnection.unmuteLocal failed; ".concat(s.toString()))}}restartICE(r){var s=this;return _l(function*(){const o=yield wn(s.mutex.lock("From P2PConnection.restartICE"));try{if(!s.remoteSDP)throw new Error("Cannot restartICE before remoteSDP created.");const c=kn().supportPCSetConfiguration,u=re("FORCE_TURN_TCP")||s.forceTurn;if(r===Ds.RELAY&&!c)return;if(c&&!u){const R=r===Ds.RELAY?"relay":"all",P=s.peerConnection.getConfiguration();P.iceTransportPolicy!==R&&(L.debug("[".concat(s.store.clientId,"] restartICE change iceTransportPolicy from [").concat(P.iceTransportPolicy,"] to [").concat(R,"]")),P.iceTransportPolicy=R,s.peerConnection.setConfiguration(P))}s.remoteSDP.updateCandidates(r);const h=yield wn(s.peerConnection.createOffer({iceRestart:!0}));if(!h.sdp)throw new Error("Cannot restartICE because restart offer SDP does not exist.");const m=Lm(h.sdp),{remoteIceParameters:_}=yield m.iceParameters;s.remoteSDP.restartICE(_);const E=s.remoteSDP.toString(),S=s.logSDPExchange(h.sdp||"","offer","local","restartICE");s.store.descriptionStart(),yield wn(s.peerConnection.setLocalDescription(h)),S==null||S(E),yield wn(s.peerConnection.setRemoteDescription({type:"answer",sdp:E}))}catch(c){L.warning("[".concat(s.store.clientId,"] restart ICE failed, abort operation"),c)}finally{o()}})()}async extendCandidate(){if(!this.remoteSDP||this.isFirstConnected)return;const r=await this.mutex.lock("From P2PConnection.extendCandidate");try{this.remoteSDP.updateCandidates(Ds.TCP_RELAY),await kT(this.peerConnection,this.remoteSDP,this.extension)}catch(s){L.warning("[".concat(this.store.clientId,"] extend candidate failed, abort operation"),s)}finally{r()}}close(){var r;this.peerConnection.getTransceivers().forEach(s=>{IP(this.id+s.mid,this)}),this.preSSRCMap.clear(),this.peerConnection.close(),(r=this.onConnectionStateChange)===null||r===void 0||r.call(this,"closed"),this.tryUnbindTransportEvents(),this.unbindPCEvents(),this.unbindStatsEvents(),this.removeAllListeners(),this.transportEventReceiver=void 0,this.statsFilter.destroy(),this.dataStreamChannelMap.clear(),this.recoveredDataChannelIds=[],this.currentDataChannelId=1}getStats(){return vd(vd({},this.statsFilter.getStats()),{},{qualityLimitationReason:this.qualityLimitationReason})}getRemoteVideoIsReady(r){return this.statsFilter.getVideoIsReady(r)}async updateEncoderConfig(r,s){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.updateEncoderConfig before remote SDP created.");const o=await this.peerConnection.createOffer(),c=this.mungSendOfferSDP(o.sdp,[s],[r]);this.remoteSDP.updateRecvMedia(r,s);const u=this.remoteSDP.toString(),h=this.logSDPExchange(c,"offer","local","updateEncoderConfig");await this.peerConnection.setLocalDescription({type:"offer",sdp:c}),h==null||h(u),await this.peerConnection.setRemoteDescription({type:"answer",sdp:u})}catch(o){throw new Le(X.EXCHANGE_SDP_FAILED,o.toString())}}async updateSendParameters(r,s){const o=this.peerConnection.getTransceivers().filter(c=>c.mid===r);o.length===1&&(this.isVP8Simulcast(s)?Dr()||await this.applySimulcastEncodings(o,[s]):await this.applySendEncodings(o,[s]))}setStatsRemoteVideoIsReady(r,s){this.statsFilter.setVideoIsReady2(r,s)}async replaceTrack(r,s){const o=this.peerConnection.getTransceivers().find(c=>c.mid===s);o&&await o.sender.replaceTrack(r._mediaStreamTrack)}async getSelectedCandidatePair(){const r=this.peerConnection.getReceivers();if(r.length>0&&r[0].transport&&r[0].transport.iceTransport&&r[0].transport.iceTransport.getSelectedCandidatePair&&r[0].transport.iceTransport.getSelectedCandidatePair()){const s=r[0].transport.iceTransport,{local:o,remote:c}=s.getSelectedCandidatePair();return{local:vd(vd({},_h),{},{candidateType:o.type,protocol:o.protocol,address:o.address,port:o.port}),remote:vd(vd({},_h),{},{candidateType:c.type,protocol:c.protocol,address:c.address,port:c.port})}}return this.statsFilter.getSelectedCandidatePair()}bindPCEvents(){this.peerConnection.oniceconnectionstatechange=()=>{var r;(r=this.onICEConnectionStateChange)===null||r===void 0||r.call(this,this.peerConnection.iceConnectionState)},this.peerConnection.onconnectionstatechange=()=>{var r;this.peerConnection.connectionState==="connected"&&(this.isFirstConnected=!0),(r=this.onConnectionStateChange)===null||r===void 0||r.call(this,this.peerConnection.connectionState)},this.peerConnection.onicecandidateerror=r=>{if(r&&(r.errorCode||r.errorText)){var s;const o="code: ".concat(r.errorCode,", message: ").concat(r.errorText),c=r.port?"local: ".concat(r.port):"";L.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICECandidateError(").concat(o,"), url: ").concat(r.url||"",", host_candidate:").concat(c)),(s=this.onICECandidateError)===null||s===void 0||s.call(this,o)}},this.peerConnection.onicegatheringstatechange=r=>{r&&r.target&&"iceGatheringState"in r.target&&L.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] RTCPeerConnection.onicegatheringstatechange(").concat(r.target.iceGatheringState,")"))},this.peerConnection.onicecandidate=r=>{r.candidate?this.localCandidateCount+=1:(this.peerConnection.onicecandidate=null,this.allCandidatesReceived=!0,L.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] local candidate count"),this.localCandidateCount))},setTimeout(()=>{this.allCandidatesReceived||(this.allCandidatesReceived=!0,L.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] onicecandidate timeout, local candidate count"),this.localCandidateCount))},re("CANDIDATE_TIMEOUT"))}unbindPCEvents(){this.peerConnection.oniceconnectionstatechange=null,this.peerConnection.onconnectionstatechange=null,this.peerConnection.onsignalingstatechange=null,this.peerConnection.onicecandidateerror=null,this.peerConnection.onicecandidate=null,this.peerConnection.ontrack=null}static resolvePCConfiguration(r){const s={iceServers:[]};return r.iceServers?s.iceServers=r.iceServers:r.turnServer&&(gT(r.turnServer.servers)?s.iceServers=r.turnServer.servers:re("NEW_TURN_MODE")&&s.iceServers?(re("USE_TURN_SERVER_OF_GATEWAY")?r.turnServer.serversFromGateway&&s.iceServers.push(...dy.newTurnServerConfigToIceServers(r.turnServer.serversFromGateway)):s.iceServers.push(...dy.newTurnServerConfigToIceServers(r.turnServer.servers)),re("NEW_FORCE_TURN")&&(s.iceTransportPolicy="relay")):r.turnServer.mode!=="off"&&(s.iceServers&&s.iceServers.push(...dy.turnServerConfigToIceServers(r.turnServer.servers)),re("USE_TURN_SERVER_OF_GATEWAY")&&s.iceServers&&r.turnServer.serversFromGateway&&s.iceServers.push(...dy.turnServerConfigToIceServers(r.turnServer.serversFromGateway)),re("FORCE_TURN_TCP")?s.iceTransportPolicy="relay":r.turnServer.servers.concat(r.turnServer.serversFromGateway||[]).forEach(o=>{o.forceturn&&(s.iceTransportPolicy="relay")}))),re("ENABLE_ENCODED_TRANSFORM")&&kn().supportWebRTCEncodedTransform&&(s.encodedInsertableStreams=!0),s}static turnServerConfigToIceServers(r){const s=[];return r.forEach(o=>{o.security?o.tcpport&&s.push({username:o.username,credential:o.password,credentialType:"password",urls:"turns:".concat(Nm(o.turnServerURL),":").concat(o.tcpport,"?transport=tcp")}):(o.udpport&&!re("FORCE_TURN_TCP")&&s.push({username:o.username,credential:o.password,credentialType:"password",urls:"turn:".concat(o.turnServerURL,":").concat(o.udpport,"?transport=udp")}),o.tcpport&&s.push({username:o.username,credential:o.password,credentialType:"password",urls:"turn:".concat(o.turnServerURL,":").concat(o.tcpport,"?transport=tcp")}))}),s}static newTurnServerConfigToIceServers(r){const s=[];return r.forEach(o=>{const c=re("NEW_TURN_MODE");c===1?s.push({username:o.username,credential:o.password,credentialType:"password",urls:"turn:".concat(o.turnServerURL,":3478?transport=udp")}):c===2?s.push({username:o.username,credential:o.password,credentialType:"password",urls:"turn:".concat(o.turnServerURL,":3478?transport=tcp")}):c===3?s.push({username:o.username,credential:o.password,credentialType:"password",urls:"turns:".concat(Nm(o.turnServerURL),":443?transport=tcp")}):c===4&&(s.push({username:o.username,credential:o.password,credentialType:"password",urls:"turn:".concat(o.turnServerURL,":3478?transport=udp")}),s.push({username:o.username,credential:o.password,credentialType:"password",urls:"turn:".concat(o.turnServerURL,":3478?transport=tcp")}),s.push({username:o.username,credential:o.password,credentialType:"password",urls:"turns:".concat(Nm(o.turnServerURL),":443?transport=tcp")}))}),s}tryBindTransportEvents(r){const s=r.transport;if(s){this.transportEventReceiver=r,s.onstatechange=()=>{var c;s!=null&&s.state&&((c=this.onDTLSTransportStateChange)===null||c===void 0||c.call(this,s.state))},s.onerror=c=>{var u;(u=this.onDTLSTransportError)===null||u===void 0||u.call(this,"error"in c?c.error:c)};const o=s.iceTransport;o&&(o.onstatechange=()=>{const c=s==null?void 0:s.iceTransport.state;var u;c&&((u=this.onICETransportStateChange)===null||u===void 0||u.call(this,c))},o.getSelectedCandidatePair&&(o.onselectedcandidatepairchange=()=>{if(o.getSelectedCandidatePair()){const{local:c,remote:u}=o.getSelectedCandidatePair();L.info("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] selectedcandidatepairchange: local ").concat(JSON.stringify({candidateType:c.type,protocol:c.protocol}),", remote ").concat(JSON.stringify({candidateType:u.type,protocol:u.protocol,address:u.address,port:u.port})," )"))}}))}}tryUnbindTransportEvents(){this.transportEventReceiver&&this.transportEventReceiver.transport&&(this.transportEventReceiver.transport.onstatechange=null,this.transportEventReceiver.transport.onerror=null,this.transportEventReceiver.transport.iceTransport&&(this.transportEventReceiver.transport.iceTransport.onstatechange=null))}async updateRtpSenderEncodings(r,s){var o,c;if(s||(s=this.peerConnection.getSenders().find(F=>F.track===r._mediaStreamTrack)),!s)return L.warn("[".concat(r.getTrackId(),"] no rtpSender found}"));if(this.isVP8Simulcast(r))return L.warn("[updateRtpSenderEncodings] Track is VP8 simulcast, please apply simulcast encodings");if(!kn().supportSetRtpSenderParameters)return L.warn("[updateRtpSenderEncodings] Browser not support set rtp-sender parameters");const u={},h={};switch(r._optimizationMode){case"motion":u.degradationPreference="maintain-framerate";break;case"detail":u.degradationPreference="maintain-resolution";break;case"balanced":u.degradationPreference="balanced"}const m=function(U,F){return U.getTransceivers().find(q=>q.sender.track===F||q.receiver.track===F)}(this.peerConnection,r._mediaStreamTrack),_=Rpe(r);if(Vme(r)&&m&&s&&_&&this.getLocalVideoStats&&ot(o=["vp8","vp9"]).call(o,this.store.codec)){var E;const U=u.degradationPreference||(ot(E=r._hints).call(E,ar.CUSTOM_TRACK)?re("CUSTOM_ADAPTATION_DEFAULT_MODE"):"maintain-framerate");(function(F,q,Y,le,ye,Ee){if(IP(F,Y),ye(q),le!=="balanced"&&le!=="maintain-framerate"&&le!=="maintain-resolution")return;let me=-1;zH(F,q);const ke=window.setInterval(()=>{const ut=CP.get(F);if(!re("ENABLE_AG_ADAPTATION")||!ut)return IP(F,Y),void ye(q);const pt=Ee();if(pt.sendPackets>0&&pt.OutgoingAvailableBandwidth>0){if(me===-1)return void(me=Date.now());if(Date.now()-me<1e3)return;const vn=pt.sendFrameRate,Sn=pt.OutgoingAvailableBandwidth,[cr,ei]=Ume(F,vn,Sn,ut.adaptationConfig,q,le);ei&&(Y.qualityLimitationReason=ei),cr&&ut.adaptationConfig.scale!==cr.scale&&(L.debug("[".concat(F,"] applyAdaptation: ").concat(Y.qualityLimitationReason,`
           sendFps `).concat(vn,", bwe ").concat(Sn,", switch from ").concat(ut.adaptationConfig.scale," to ").concat(cr.scale," ")),ut.adaptationConfig=tM(tM({},ut.adaptationConfig),cr),ye(cr))}},re("CHECK_LOCAL_STATS_INTERVAL")),Ye=tM({},q);CP.set(F,{timer:ke,adaptationConfig:Ye,originConfig:q,adaptationFunc:ye}),L.debug("[".concat(F,"] start adaptation, originConfig: ").concat(JSON.stringify(q),", degradationPreference: ").concat(le))})(this.id+m.mid,_,this,U,F=>{s&&this.updateAdaptation(s,F)},this.getLocalVideoStats.bind(this))}if(r._encoderConfig){var S;const{bitrateMax:U,frameRate:F,scaleResolutionDownBy:q}=r._encoderConfig;U&&(h.maxBitrate=1e3*U),(ot(S=r._hints).call(S,ar.LOW_STREAM)||r.isUseScaleResolutionDownBy)&&(F&&(h.maxFramerate=rc(F)),q&&q>=1&&(h.scaleResolutionDownBy=q))}const{maxFramerate:R}=re("ENCODER_CONFIG_LIMIT");if(R&&typeof R=="number"&&(h.maxFramerate=h.maxFramerate?Math.min(h.maxFramerate,R):R),re("DSCP_TYPE")&&Kf()){var P;const U=re("DSCP_TYPE");ot(P=["very-low","low","medium","high"]).call(P,U)&&(h.networkPriority=U)}const k=s.getParameters(),z=(c=k.encodings)===null||c===void 0?void 0:c[0];Dr()&&!z&&(u.encodings=[h]),z&&Object.assign(z,h),Object.assign(k,u),L.debug("[".concat(r.getTrackId(),"] updateRtpSenderEncodings: ").concat(JSON.stringify(k.encodings))),await s.setParameters(k),await async function(U,F,q){try{var Y;if(!kn().supportSetRtpSenderParameters||!function(ke){return ke==="vp9"||ke==="av1"}(U)||!re("ENABLE_SVC"))return;const le={},ye={},Ee=F.getParameters(),me=(Y=Ee.encodings)===null||Y===void 0?void 0:Y[0];ye.scalabilityMode=gP(q),me&&Object.assign(me,ye),Object.assign(Ee,le),await F.setParameters(Ee),L.debug("[updateAdaptation] updateRtpSenderEncodings scalabilityMode success: ".concat(JSON.stringify(Ee.encodings)))}catch(le){L.debug("[updateAdaptation] updateRtpSenderEncodings scalabilityMode failed",le)}}(this.store.codec,s,re("SVC_MODE"))}async updateAdaptation(r,s){var o,c;if(!r)return L.debug("[updateAdaptation] no rtpSender found");if(!kn().supportSetRtpSenderParameters)return L.debug("[updateAdaptation] Browser not support set rtp-sender parameters");const u={},{bitrateMax:h,frameRate:m,scaleResolutionDownBy:_}=s;h&&(u.maxBitrate=1e3*h),m&&(u.maxFramerate=rc(m)),_&&_>=1&&ot(o=["vp8","vp9"]).call(o,this.store.codec)&&(u.scaleResolutionDownBy=_);const E=r.getParameters(),S=(c=E.encodings)===null||c===void 0?void 0:c[0];S&&Object.assign(S,u),Object.assign(E,{});try{await r.setParameters(E),L.debug("[updateAdaptation] updateRtpSenderEncodings: ".concat(JSON.stringify(E.encodings)))}catch(R){!("transport"in r)||r.transport&&r.transport.state==="connected"?this.peerConnectionState!=="connected"?L.debug("[updateAdaptation] peerConnection not connected}"):L.debug("[updateAdaptation] updateRtpSenderEncodings failed",R):L.debug("[updateAdaptation] rtpSender transport not connected}")}}async applySendEncodings(r,s){try{if(!kn().supportSetRtpSenderParameters||r.length!==s.length)return;for(let o=0;o<r.length;o++){const c=r[o],u=s[o];u instanceof _r&&!this.isVP8Simulcast(u)&&await this.updateRtpSenderEncodings(u,c.sender)}}catch{L.debug("[".concat(this.store.clientId,"] Apply RTPSendEncodings failed."))}}mungSendOfferSDP(r,s,o){const c=Ca(r);return s.forEach((u,h)=>{const m=o[h],_=c.mediaDescriptions.find(E=>E.attributes.mid===m);_&&(Zv(_,u),dH(_,u,this.store.codec))}),Pm(c)}bindStatsEvents(){this.statsFilter.onFirstAudioReceived=r=>{var s;(s=this.onFirstAudioReceived)===null||s===void 0||s.call(this,r)},this.statsFilter.onFirstVideoReceived=r=>{var s;(s=this.onFirstVideoReceived)===null||s===void 0||s.call(this,r)},this.statsFilter.onFirstAudioDecoded=r=>{var s;(s=this.onFirstAudioDecoded)===null||s===void 0||s.call(this,r)},this.statsFilter.onFirstVideoDecoded=(r,s,o)=>{var c;(c=this.onFirstVideoDecoded)===null||c===void 0||c.call(this,r,s,o)},this.statsFilter.onSelectedLocalCandidateChanged=(r,s)=>{var o;(o=this.onSelectedLocalCandidateChanged)===null||o===void 0||o.call(this,r,s)},this.statsFilter.onSelectedRemoteCandidateChanged=(r,s)=>{var o;(o=this.onSelectedRemoteCandidateChanged)===null||o===void 0||o.call(this,r,s)},this.statsFilter.onFirstVideoDecodedTimeout=r=>{var s;(s=this.onFirstVideoDecodedTimeout)===null||s===void 0||s.call(this,r)}}unbindStatsEvents(){this.statsFilter.onFirstAudioReceived=void 0,this.statsFilter.onFirstVideoReceived=void 0,this.statsFilter.onFirstAudioDecoded=void 0,this.statsFilter.onFirstVideoDecoded=void 0,this.statsFilter.onSelectedLocalCandidateChanged=void 0,this.statsFilter.onSelectedRemoteCandidateChanged=void 0,this.statsFilter.onFirstVideoDecodedTimeout=void 0}async applySimulcastForFirefox(r,s){if(r.length===s.length)for(let _=0;_<r.length;_++){var o,c,u,h,m;const E=r[_],S=s[_];if(S instanceof _r&&!ot(o=S._hints).call(o,ar.LOW_STREAM)&&(c=S._encoderConfig)!==null&&c!==void 0&&c.bitrateMax&&((u=S._encoderConfig)===null||u===void 0?void 0:u.bitrateMax)>200&&(h=S._scalabilityMode)!==null&&h!==void 0&&h.numSpatialLayers&&((m=S._scalabilityMode)===null||m===void 0?void 0:m.numSpatialLayers)>1&&this.store.codec==="vp8"){const R={},P={high:1e3*(S._encoderConfig.bitrateMax-50),medium:5e4};R.encodings=[{rid:"m",active:!0,maxBitrate:P.medium,scaleResolutionDownBy:4},{rid:"h",active:!0,maxBitrate:P.high}];const k=E.sender.getParameters();await E.sender.setParameters(Object.assign(k,R))}}}async applySimulcastEncodings(r,s){if(!Dr()&&r.length===s.length)for(let o=0;o<r.length;o++){const c=s[o];if(c instanceof _r&&this.isVP8Simulcast(c)){const u=r[o],h={},m={high:1e3*(c._encoderConfig.bitrateMax-50),medium:5e4};h.encodings=[{active:!0,adaptivePtime:!1,networkPriority:"high",priority:"high",maxBitrate:m.high},{active:!0,adaptivePtime:!1,networkPriority:"low",priority:"low",maxBitrate:m.medium,scaleResolutionDownBy:4}];const _=u.sender.getParameters();await u.sender.setParameters(Object.assign(_,h))}}}isVP8Simulcast(r){var s,o,c,u,h;return!!(r instanceof _r&&re("SIMULCAST")&&this.store.codec==="vp8"&&!ot(s=r._hints).call(s,ar.LOW_STREAM)&&(o=r._encoderConfig)!==null&&o!==void 0&&o.bitrateMax&&((c=r._encoderConfig)===null||c===void 0?void 0:c.bitrateMax)>200&&(u=r._scalabilityMode)!==null&&u!==void 0&&u.numSpatialLayers&&((h=r._scalabilityMode)===null||h===void 0?void 0:h.numSpatialLayers)>1)}logSDPExchange(r,s,o,c){if(re("SDP_LOGGING"))return L.upload("[".concat(this.store.clientId,"] exchanging ").concat(o," ").concat(s," SDP during P2PConnection.").concat(c,`
`),r),s==="offer"?u=>{this.logSDPExchange(u,"answer",o==="local"?"remote":"local",c)}:void 0}async getRemoteSSRC(r){if(!this.remoteSDP)return;const s=this.remoteSDP.getSSRC(r);return s&&s.length!==0?s[0].ssrcId:void 0}setConfiguration(r){if(kn().supportPCSetConfiguration){const s=dy.resolvePCConfiguration(r);this.peerConnection.setConfiguration(s)}}},vt(Tn.prototype,"updateRemoteRTPCapabilities",[qo],Object.getOwnPropertyDescriptor(Tn.prototype,"updateRemoteRTPCapabilities"),Tn.prototype),vt(Tn.prototype,"connect",[qo],Object.getOwnPropertyDescriptor(Tn.prototype,"connect"),Tn.prototype),vt(Tn.prototype,"updateRemoteConnect",[qo],Object.getOwnPropertyDescriptor(Tn.prototype,"updateRemoteConnect"),Tn.prototype),vt(Tn.prototype,"createDataChannels",[qo],Object.getOwnPropertyDescriptor(Tn.prototype,"createDataChannels"),Tn.prototype),vt(Tn.prototype,"receive",[qo],Object.getOwnPropertyDescriptor(Tn.prototype,"receive"),Tn.prototype),vt(Tn.prototype,"batchReceive",[qo],Object.getOwnPropertyDescriptor(Tn.prototype,"batchReceive"),Tn.prototype),vt(Tn.prototype,"stopReceiving",[qo],Object.getOwnPropertyDescriptor(Tn.prototype,"stopReceiving"),Tn.prototype),vt(Tn.prototype,"muteRemote",[qo],Object.getOwnPropertyDescriptor(Tn.prototype,"muteRemote"),Tn.prototype),vt(Tn.prototype,"unmuteRemote",[qo],Object.getOwnPropertyDescriptor(Tn.prototype,"unmuteRemote"),Tn.prototype),vt(Tn.prototype,"muteLocal",[qo],Object.getOwnPropertyDescriptor(Tn.prototype,"muteLocal"),Tn.prototype),vt(Tn.prototype,"unmuteLocal",[qo],Object.getOwnPropertyDescriptor(Tn.prototype,"unmuteLocal"),Tn.prototype),vt(Tn.prototype,"close",[qo],Object.getOwnPropertyDescriptor(Tn.prototype,"close"),Tn.prototype),vt(Tn.prototype,"updateEncoderConfig",[qo],Object.getOwnPropertyDescriptor(Tn.prototype,"updateEncoderConfig"),Tn.prototype),vt(Tn.prototype,"updateSendParameters",[qo],Object.getOwnPropertyDescriptor(Tn.prototype,"updateSendParameters"),Tn.prototype),vt(Tn.prototype,"replaceTrack",[qo],Object.getOwnPropertyDescriptor(Tn.prototype,"replaceTrack"),Tn.prototype),vt(Tn.prototype,"updateAdaptation",[qo],Object.getOwnPropertyDescriptor(Tn.prototype,"updateAdaptation"),Tn.prototype),vt(Tn.prototype,"getRemoteSSRC",[qo],Object.getOwnPropertyDescriptor(Tn.prototype,"getRemoteSSRC"),Tn.prototype),Tn);function qo(t,r,s){const o=t[r];if(typeof o!="function")throw new Error("Cannot use mutex on object property.");return s.value=async function(){const c=this.mutex,u=await c.lock("From P2PConnection.".concat(r));try{for(var h=arguments.length,m=new Array(h),_=0;_<h;_++)m[_]=arguments[_];return await o.apply(this,m)}finally{u()}},s}function sM(t,r){let s=document.createElement("video"),o=document.createElement("canvas");s.setAttribute("style","display:none"),o.setAttribute("style","display:none"),s.setAttribute("muted",""),s.muted=!0,s.setAttribute("autoplay",""),s.autoplay=!0,s.setAttribute("playsinline",""),o.width=rc(r.width),o.height=rc(r.height);const c=rc(r.framerate||15);document.body.append(s),document.body.append(o);let u=t._mediaStreamTrack;s.srcObject=new MediaStream([u]),s.play();const h=o.getContext("2d");if(!h)throw new Oe(X.UNEXPECTED_ERROR,"can not get canvas context");const m=kn(),_=o.captureStream(m.supportRequestFrame?0:c).getVideoTracks()[0];_.canvas||(_.canvas=o),o.startCapture=()=>{if(!s)return o.stopCapture&&o.stopCapture();if(s.paused&&s.play(),s.videoHeight>2&&s.videoWidth>2){const S=s.videoWidth,R=s.videoHeight/S,P=o.width*R;Math.abs(P-o.height)>=2&&(L.debug("adjust low stream resolution","".concat(o.width,"x").concat(o.height," -> ").concat(o.width,"x").concat(P)),o.height=P)}h.drawImage(s,0,0,o.width,o.height),_.requestFrame&&_.requestFrame(),u!==t._mediaStreamTrack&&(u=t._mediaStreamTrack,s.srcObject=new MediaStream([u]))},o.stopCapture=gx(()=>o.startCapture&&o.startCapture(),c);const E=_.stop;return _.stop=()=>{E.call(_),s&&(s.remove(),s.srcObject=null,s=null),o&&(o.width=0,o.remove(),o.stopCapture&&o.stopCapture(),o.startCapture=void 0,o.stopCapture=void 0,o=null),L.debug("clean low stream renderer")},_}var PP=function(t){return t[t.HEIGHT=2033]="HEIGHT",t[t.FRAME_RATE=2034]="FRAME_RATE",t[t.WIDTH=2035]="WIDTH",t}(PP||{}),ui=function(t){return t[t.FRAME_RATE=2002]="FRAME_RATE",t[t.WIDTH=2003]="WIDTH",t[t.HEIGHT=2004]="HEIGHT",t[t.PACKAGE_LOST=2005]="PACKAGE_LOST",t[t.AVG_ENCODE=2007]="AVG_ENCODE",t[t.NACKS=2009]="NACKS",t[t.PLIS=2010]="PLIS",t[t.FIRS=2011]="FIRS",t[t.BITRATE=2012]="BITRATE",t[t.PACKAGE_RATE=2031]="PACKAGE_RATE",t[t.ADAPTATION=2032]="ADAPTATION",t[t.ACTUAL_ENCODED=2060]="ACTUAL_ENCODED",t[t.BANDWIDTH=2061]="BANDWIDTH",t[t.RETRANSMIT=2062]="RETRANSMIT",t[t.TARGET_ENCODED=2064]="TARGET_ENCODED",t[t.TRANSMIT=2066]="TRANSMIT",t[t.FREEZE=2082]="FREEZE",t[t.DISABLED=2095]="DISABLED",t[t.PLAYER_STATUS=2128]="PLAYER_STATUS",t[t.QP_SUM=2143]="QP_SUM",t[t.BYTES_RETRANSMIT=2173]="BYTES_RETRANSMIT",t[t.PACKAGES_RETRANSMIT=2172]="PACKAGES_RETRANSMIT",t[t.HUGE_FRAME_SENT=2174]="HUGE_FRAME_SENT",t[t.KEY_FRAMES_ENCODED=2207]="KEY_FRAMES_ENCODED",t}(ui||{}),H_=function(t){return t[t.BITRATE=2069]="BITRATE",t[t.PACKAGE_LOST=2070]="PACKAGE_LOST",t[t.PACKAGE_RATE=2071]="PACKAGE_RATE",t[t.HEIGHT=2073]="HEIGHT",t[t.FRAME_RATE=2075]="FRAME_RATE",t[t.WIDTH=2077]="WIDTH",t}(H_||{}),di=function(t){return t[t.JITTER=-1]="JITTER",t[t.PACKAGE_LOST=2014]="PACKAGE_LOST",t[t.WIDTH=2018]="WIDTH",t[t.HEIGHT=2019]="HEIGHT",t[t.FRAME_RATE=2020]="FRAME_RATE",t[t.JITTER_BUFFER=2023]="JITTER_BUFFER",t[t.CURRENT_DELAY=2024]="CURRENT_DELAY",t[t.NACKS=2026]="NACKS",t[t.PLIS=2027]="PLIS",t[t.FIRS=2028]="FIRS",t[t.BITRATE=2029]="BITRATE",t[t.PACKAGE_RATE=2078]="PACKAGE_RATE",t[t.FREEZE=2084]="FREEZE",t[t.DISABLED=2101]="DISABLED",t[t.PLAYER_STATUS=2129]="PLAYER_STATUS",t[t.QP_SUM=2144]="QP_SUM",t[t.I_FRAME_DELAY=2149]="I_FRAME_DELAY",t[t.FRAMES_DROPPED=2181]="FRAMES_DROPPED",t[t.BYTES_RETRANSMIT=2175]="BYTES_RETRANSMIT",t[t.PACKAGES_RETRANSMIT=2176]="PACKAGES_RETRANSMIT",t[t.PACKAGES_DISCARDED=2198]="PACKAGES_DISCARDED",t[t.AVG_DECODE=2200]="AVG_DECODE",t[t.AVG_PROCESSING_DELAY=2202]="AVG_PROCESSING_DELAY",t[t.AVG_ASSEMBLY_TIME=2203]="AVG_ASSEMBLY_TIME",t[t.AVG_INTER_FRAME_DELAY=2204]="AVG_INTER_FRAME_DELAY",t[t.KEY_FRAMES_DECODED=2206]="KEY_FRAMES_DECODED",t}(di||{}),$_=function(t){return t[t.FRAME_RATE_DECODE=2021]="FRAME_RATE_DECODE",t[t.FRAME_RATE_RENDER=2022]="FRAME_RATE_RENDER",t[t.FRAME_RATE_OUTPUT=2155]="FRAME_RATE_OUTPUT",t[t.FREEZE_TIME=2109]="FREEZE_TIME",t[t.FREEZE_TIME_RENDER=2147]="FREEZE_TIME_RENDER",t[t.FREEZE_DURATION=2156]="FREEZE_DURATION",t}($_||{}),qH=function(t){return t[t.PCM_LEVEL=2104]="PCM_LEVEL",t}(qH||{}),wh=function(t){return t[t.PACKAGE_LOST=-1]="PACKAGE_LOST",t[t.LEVEL=2038]="LEVEL",t[t.BITRATE=2039]="BITRATE",t[t.PACKAGE_RATE=2040]="PACKAGE_RATE",t[t.AEC_RETURN_LOSS=2041]="AEC_RETURN_LOSS",t[t.AEC_RETURN_LOSS_ENH=2042]="AEC_RETURN_LOSS_ENH",t[t.FREEZE=2081]="FREEZE",t[t.DISABLED=2096]="DISABLED",t[t.BYTES_RETRANSMIT=2179]="BYTES_RETRANSMIT",t[t.PACKAGES_RETRANSMIT=2180]="PACKAGES_RETRANSMIT",t}(wh||{}),Yo=function(t){return t[t.BITRATE=2044]="BITRATE",t[t.PACKAGE_LOST=2045]="PACKAGE_LOST",t[t.PACKAGE_RATE=2046]="PACKAGE_RATE",t[t.CURRENT_DELAY=2047]="CURRENT_DELAY",t[t.JITTER_BUFFER=2054]="JITTER_BUFFER",t[t.JITTER=2055]="JITTER",t[t.FREEZE=2083]="FREEZE",t[t.DISABLED=2102]="DISABLED",t[t.PCM_LEVEL=2105]="PCM_LEVEL",t[t.PLAYER_STATUS=2130]="PLAYER_STATUS",t[t.CONCEALED_SAMPLES=2148]="CONCEALED_SAMPLES",t[t.BYTES_RETRANSMIT=2178]="BYTES_RETRANSMIT",t[t.PACKAGES_RETRANSMIT=2177]="PACKAGES_RETRANSMIT",t[t.PACKAGES_DISCARDED=2199]="PACKAGES_DISCARDED",t[t.AVG_PROCESSING_DELAY=2201]="AVG_PROCESSING_DELAY",t[t.TOTAL_SAMPLES_RECEIVED=2224]="TOTAL_SAMPLES_RECEIVED",t}(Yo||{}),YH=function(t){return t[t.FREEZE_TIME=-1]="FREEZE_TIME",t[t.LEVEL=2043]="LEVEL",t}(YH||{}),Xo=function(t){return t[t.RTT=2006]="RTT",t[t.CONN_TYPE=801]="CONN_TYPE",t[t.STATS_UPDATE_INTERVAL=2205]="STATS_UPDATE_INTERVAL",t}(Xo||{}),OP=function(t){return t[t.RTC_PEER_CONNECTION_STATE=2219]="RTC_PEER_CONNECTION_STATE",t}(OP||{});const K_=1e3,q_=6,kP=3,Bme=Math.max(q_,kP);function Ft(t,r,s){s!=null&&Number.isFinite(s)&&(t[r]=Math.round(Math.max(0,s)))}function XH(t){const r={[Xo.CONN_TYPE]:0,[Xo.RTT]:t.rtt,[Xo.STATS_UPDATE_INTERVAL]:t.updateInterval?Math.round(Math.max(0,t.updateInterval)):void 0};switch(t.selectedCandidatePair.localCandidate.candidateType){case"relay":{const s=t.selectedCandidatePair.localCandidate.relayProtocol;s==="udp"&&(r[Xo.CONN_TYPE]=1),s==="tcp"&&(r[Xo.CONN_TYPE]=3),s==="tls"&&(r[Xo.CONN_TYPE]=4);break}case"srflx":r[Xo.CONN_TYPE]=2;break;case"unknown":r[Xo.CONN_TYPE]=5;break;default:r[Xo.CONN_TYPE]=0}return r}function JH(t){let r=0;switch(t){case"none":r=0;break;case"cpu":r=1;break;case"bandwidth":r=2;break;case"other":r=3}return r}class QH extends Pr{constructor(r){super(),$(this,"store",void 0),$(this,"uploadWRTCStatsTimer",void 0),$(this,"uploadOutboundDenoiserStatsTimer",void 0),$(this,"uploadExtStatsTimer",void 0),$(this,"uploadExtUsageStatsTimer",void 0),$(this,"uploadInboundExtStatsTimer",void 0),$(this,"requestStats",void 0),$(this,"requestTransportStats",void 0),$(this,"requestLocalMedia",void 0),$(this,"requestRemoteMedia",void 0),$(this,"requestAllTracks",void 0),$(this,"requestVideoIsReady",void 0),$(this,"requestUploadStats",void 0),$(this,"requestUpload",void 0),$(this,"uploadOutboundStarted",!1),$(this,"uploadInboundStarted",!1),$(this,"uploadTransportStarted",!1),$(this,"uploadBaseStatsStarted",!1),$(this,"uploadExtensionUsageStarted",!1),$(this,"lastRecvStats",void 0),$(this,"lastSendStats",void 0),$(this,"lastRefRecvStats",void 0),$(this,"lastRefSendStats",void 0),$(this,"lastFullRecvStats",void 0),$(this,"lastFullSendStats",void 0),$(this,"needUploadRenderFreezeTime",!0),this.store=r}uploadWRTCStats(r){if(!this.requestStats||!this.requestUploadStats)return;const s=r%kP==0,o=r%q_==0;let c,u;if(this.uploadTransportStarted&&(c=this.requestStats(),this.store.useP2P&&(u=this.requestStats(!0))),!c&&this.uploadOutboundStarted&&(c=this.requestStats()),!u&&this.uploadInboundStarted&&(u=this.requestStats(!0)),c||u){var h;const m={};if(this.uploadTransportStarted&&c){const E=this.getTransportStats(c,u,s);E&&(m.misc=[E])}if(this.uploadOutboundStarted&&c){const E=this.getOutboundStats(c,o?this.lastFullSendStats:s?this.lastRefSendStats:this.lastSendStats,s,o);E&&(m.outbound=[E])}if(this.uploadInboundStarted&&u){const E=this.getInboundStats(u,o?this.lastFullRecvStats:s?this.lastRefRecvStats:this.lastRecvStats,s,o);E&&(m.inbound=E)}const _=(h=this.requestTransportStats)===null||h===void 0?void 0:h.call(this).connectState;_&&(Array.isArray(m.misc)?m.misc[0]&&m.misc[0].addition&&(m.misc[0].addition[OP.RTC_PEER_CONNECTION_STATE]=tx[_]):m.misc=[{addition:{[OP.RTC_PEER_CONNECTION_STATE]:tx[_]}}]),this.requestUploadStats(m)}this.lastRecvStats=u,this.lastSendStats=c,o&&(this.lastFullRecvStats=u,this.lastFullSendStats=c),s&&(this.lastRefRecvStats=u,this.lastRefSendStats=c)}startUploadWRTCStats(){if(this.uploadWRTCStatsTimer)return;this.uploadBaseStatsStarted=!0;let r=1;this.uploadWRTCStatsTimer=window.setInterval(()=>{if(!this.uploadTransportStarted&&!this.uploadInboundStarted&&!this.uploadOutboundStarted){if(this.uploadBaseStatsStarted){var s,o;const c=(s=this.requestTransportStats)===null||s===void 0?void 0:s.call(this);return void(c&&((o=this.requestUploadStats)===null||o===void 0||o.call(this,{misc:[{addition:{[OP.RTC_PEER_CONNECTION_STATE]:tx[c.connectState]}}]})))}return this.stopUploadWRTCStats()}this.uploadWRTCStats(r),++r===Bme+1&&(r=1)},K_)}stopUploadWRTCStats(){window.clearInterval(this.uploadWRTCStatsTimer),this.uploadWRTCStatsTimer=void 0,this.lastSendStats&&(this.lastSendStats.videoSend=[],this.lastSendStats.audioSend=[],this.lastSendStats=void 0),this.lastRecvStats&&(this.lastRecvStats.videoRecv=[],this.lastRecvStats.audioRecv=[],this.lastRecvStats=void 0)}getTransportStats(r,s,o){if(!this.requestStats)return;if(!o)return r.rtt==null?void 0:{addition:{[Xo.RTT]:r.rtt,[Xo.CONN_TYPE]:void 0,[Xo.STATS_UPDATE_INTERVAL]:r.updateInterval||void 0}};const c=XH(r);if(this.store.useP2P){if(s){const u=XH(s);c[Xo.CONN_TYPE]+=u[Xo.CONN_TYPE]<<3}c[Xo.CONN_TYPE]+=110}else c[Xo.CONN_TYPE]+=100;return{addition:c}}getOutboundStats(r,s,o,c){if(!this.requestUploadStats||!this.requestLocalMedia)return;const u=this.requestLocalMedia();if(!u||u.length===0)return;let h,m,_;return u.forEach(E=>{let[S,{track:R,ssrcs:P}]=E;switch(S){case $e.LocalVideoLowTrack:case $e.LocalVideoTrack:if(S===$e.LocalVideoTrack){const k=function(F,q,Y,le,ye,Ee){const me=q.videoSend.find(pt=>pt.ssrc===F);if(!me)return;const ke={},{sentFrame:Ye,inputFrame:ut}=me;if(Ee&&(Ft(ke,ui.QP_SUM,me.qpSumPerFrame),ut&&Ye)){const pt=ut.frameRate,vn=Ye.frameRate;ke[ui.FREEZE]=function(Sn,cr){let ei=!0;return ei=!(Sn<=5)&&(Sn<=10?cr<3:Sn<=20?cr<4:cr<5),ei}(pt,vn)?1:0}if(ye){switch(Ye&&(Ft(ke,ui.HEIGHT,Ye.height),Ft(ke,ui.WIDTH,Ye.width),Ft(ke,ui.FRAME_RATE,Ye.frameRate)),ke[ui.DISABLED]=le._originMediaStreamTrack&&!le._originMediaStreamTrack.enabled||le._mediaStreamTrack&&!le._mediaStreamTrack.enabled?1:0,me.adaptionChangeReason){case"none":ke[ui.ADAPTATION]=0;break;case"cpu":ke[ui.ADAPTATION]=1;break;case"bandwidth":ke[ui.ADAPTATION]=2;break;case"other":ke[ui.ADAPTATION]=3}let pt=0;me.adaptionChangeReason&&(pt+=JH(me.adaptionChangeReason)),q.qualityLimitationReason&&(pt+=JH(q.qualityLimitationReason)<<3),ke[ui.ADAPTATION]=pt,ke[ui.PLAYER_STATUS]=px[le._player?le._player.videoElementStatus:"uninit"],Ft(ke,ui.NACKS,me.nacksCount),Ft(ke,ui.PLIS,me.plisCount),Ft(ke,ui.FIRS,me.firsCount),Ft(ke,ui.AVG_ENCODE,me.avgEncodeMs),Ft(ke,ui.HUGE_FRAME_SENT,me.hugeFramesSent),Ft(ke,ui.BYTES_RETRANSMIT,me.retransmittedBytesSent),Ft(ke,ui.PACKAGES_RETRANSMIT,me.retransmittedPacketsSent),Ft(ke,ui.KEY_FRAMES_ENCODED,me.keyFramesEncoded);const vn=Y&&Y.videoSend.find(Sn=>Sn.ssrc===F);if(vn){let Sn=ye?K_:K_*q_;vn.timestamp&&me.timestamp&&(Sn=me.timestamp-vn.timestamp),vn.packets!=null&&me.packets!=null&&Ft(ke,ui.PACKAGE_RATE,1e3*(me.packets-vn.packets)/Sn),me.packetsLost!=null&&vn.packetsLost!=null&&Ft(ke,ui.PACKAGE_LOST,me.packetsLost-vn.packetsLost),vn.bytes!=null&&me.bytes!=null&&Ft(ke,ui.BITRATE,8*(me.bytes-vn.bytes)/Sn)}}return ke}(P[0].ssrcId,r,s,R,o,c),z=R&&function(F,q,Y,le){const ye=q.videoSend.find(me=>me.ssrc===F);if(!ye)return null;const Ee={};if(le){const me=ye.inputFrame,ke=me&&me.height||Y.videoHeight||0,Ye=me&&me.width||Y.videoWidth||0,ut=me&&me.frameRate||0;Ft(Ee,PP.HEIGHT,ke),Ft(Ee,PP.WIDTH,Ye),Ft(Ee,PP.FRAME_RATE,ut)}return Ee}(P[0].ssrcId,r,R,o),U=function(F,q){const Y={};return q&&(Ft(Y,ui.RETRANSMIT,F.bitrate.retransmit),Ft(Y,ui.TARGET_ENCODED,F.bitrate.targetEncoded),Ft(Y,ui.ACTUAL_ENCODED,F.bitrate.actualEncoded),Ft(Y,ui.TRANSMIT,F.bitrate.transmit),Ft(Y,ui.BANDWIDTH,F.sendBandwidth)),Y}(r,o);m=Object.assign({},k,z,U)}else _=function(k,z,U,F){const q=z.videoSend.find(le=>le.ssrc===k);if(!q)return;const Y={};if(F){const le=q.sentFrame;if(le&&(Ft(Y,H_.HEIGHT,le.height),Ft(Y,H_.WIDTH,le.width),Ft(Y,H_.FRAME_RATE,le.frameRate)),U){const ye=U.videoSend.find(Ee=>Ee.ssrc===k);if(ye){let Ee=K_*q_;ye.timestamp&&q.timestamp&&(Ee=q.timestamp-ye.timestamp),ye.packets!=null&&q.packets!=null&&Ft(Y,H_.PACKAGE_RATE,1e3*(q.packets-ye.packets)/Ee),q.packetsLost!=null&&ye.packetsLost!=null&&Ft(Y,H_.PACKAGE_LOST,q.packetsLost-ye.packetsLost),ye.bytes!=null&&q.bytes!=null&&Ft(Y,H_.BITRATE,8*(q.bytes-ye.bytes)/Ee)}}}return Y}(P[0].ssrcId,r,s,o);break;case $e.LocalAudioTrack:h=R&&function(k,z,U,F,q){const Y=z.audioSend.find(ye=>ye.ssrc===k);if(!Y)return;const le={};if(q){le[wh.DISABLED]=F._originMediaStreamTrack&&!F._originMediaStreamTrack.enabled||F._mediaStreamTrack&&!F._mediaStreamTrack.enabled?1:0;const ye=100*F._source.getAccurateVolumeLevel(),Ee=Y.inputLevel;if(Ee!=null){const ke=Math.ceil(50*Math.log10(100*Ee+1));Ft(le,wh.LEVEL,ke)}Ft(le,qH.PCM_LEVEL,ye),Ft(le,wh.AEC_RETURN_LOSS,Y.aecReturnLoss),Ft(le,wh.AEC_RETURN_LOSS_ENH,Y.aecReturnLossEnhancement),Ft(le,wh.BYTES_RETRANSMIT,Y.retransmittedBytesSent),Ft(le,wh.PACKAGES_RETRANSMIT,Y.retransmittedPacketsSent),le[wh.FREEZE]=0;const me=U&&U.audioSend.find(ke=>ke.ssrc===k);if(me){let ke=K_*q_;me.timestamp&&Y.timestamp&&(ke=Y.timestamp-me.timestamp),me.bytes!=null&&Y.bytes!=null&&Ft(le,wh.BITRATE,8*(Y.bytes-me.bytes)/ke),me.packets!=null&&Y.packets!=null&&Ft(le,wh.PACKAGE_RATE,1e3*(Y.packets-me.packets)/ke)}}return le}(P[0].ssrcId,r,s,R,o)}}),{high:m,low:_,audio:h}}getInboundStats(r,s,o,c){if(!this.requestRemoteMedia)return;const u=this.requestRemoteMedia()||[],h=[];return u.forEach(m=>{let[_,E]=m;const S={peer:_.uid};if(E.has(gt.VIDEO)&&_.videoTrack){const R=_._videoSSRC&&this.requestVideoIsReady&&this.requestVideoIsReady(_._videoSSRC)||!1,P=_.videoTrack?function(k,z,U,F,q,Y,le,ye){const Ee=z.videoRecv.find(Sn=>Sn.ssrc===k);if(!Ee)return;const me={},{receivedFrame:ke,outputFrame:Ye,decodeFrameRate:ut}=Ee,pt=U&&U.videoRecv.find(Sn=>Sn.ssrc===k);if(Ft(me,$_.FRAME_RATE_DECODE,ut),Ee.framesRateFirefox&&Ft(me,di.FRAME_RATE,Ee.framesRateFirefox),ke&&Ft(me,di.FRAME_RATE,ke.frameRate),Ft(me,di.FRAMES_DROPPED,Ee.framesDroppedCount),Ft(me,di.BYTES_RETRANSMIT,Ee.retransmittedBytesReceived),Ft(me,di.PACKAGES_RETRANSMIT,Ee.retransmittedPacketsReceived),Ft(me,di.PACKAGES_DISCARDED,Ee.packetsDiscarded),Ft(me,di.AVG_DECODE,Ee.avgDecodeMs),Ft(me,di.AVG_PROCESSING_DELAY,Ee.avgProcessingDelayMs),Ft(me,di.AVG_ASSEMBLY_TIME,Ee.avgFramesAssembledFromMultiplePacketsMs),Ft(me,di.AVG_INTER_FRAME_DELAY,Ee.avgInterFrameDelayMs),Ft(me,di.KEY_FRAMES_DECODED,Ee.keyFramesDecoded),pt){const Sn=z.timestamp-U.timestamp||K_*(ye?q_:le?kP:1);Ee.packetsLost!=null&&pt.packetsLost!=null&&Ft(me,di.PACKAGE_LOST,Ee.packetsLost-pt.packetsLost),pt.bytes!=null&&Ee.bytes!=null&&Ft(me,di.BITRATE,8*(Ee.bytes-pt.bytes)/Sn),pt.packets!=null&&Ee.packets!=null&&Ft(me,di.PACKAGE_RATE,1e3*(Ee.packets-pt.packets)/Sn)}if(ye&&(Ft(me,di.QP_SUM,Ee.qpSumPerFrame),me[di.FREEZE]=q&&LT.isRemoteVideoFreeze(F,Ee,pt)?1:0),le){var vn;ke?(Ft(me,di.HEIGHT,ke.height),Ft(me,di.WIDTH,ke.width)):F&&(Ft(me,di.HEIGHT,F._videoHeight||0),Ft(me,di.WIDTH,F._videoWidth||0)),Ye&&Ft(me,$_.FRAME_RATE_OUTPUT,Ye.frameRate);const Sn=(vn=F._player)===null||vn===void 0?void 0:vn.rendFrameRate.toFixed(0);if(Sn&&Ft(me,$_.FRAME_RATE_RENDER,+Sn),Ft(me,di.JITTER_BUFFER,Ee.jitterBufferMs),Ft(me,di.CURRENT_DELAY,Ee.currentDelayMs),Ft(me,di.FIRS,Ee.firsCount),Ft(me,di.NACKS,Ee.nacksCount),Ft(me,di.PLIS,Ee.plisCount),F){me[di.DISABLED]=F._originMediaStreamTrack.enabled&&F._mediaStreamTrack.enabled?0:1;const cr=F._player;if(cr){const{freezeTimeCounterList:ei,renderFreezeAccTime:Wr,videoElementStatus:Qo}=cr;if(ei&&ei.length>0&&Ft(me,$_.FREEZE_TIME,ei.splice(0,1)[0]),Y&&Xf.visibility==="visible"&&Qo===to.PLAYING&&kn().supportRequestVideoFrameCallback){const je=Math.min(6e3,Wr);cr.renderFreezeAccTime=Math.max(0,Wr-je),Ft(me,$_.FREEZE_TIME_RENDER,je)}if(typeof Ee.totalFreezesDuration=="number"){const je=pt&&pt.totalFreezesDuration?Ee.totalFreezesDuration-pt.totalFreezesDuration:Ee.totalFreezesDuration;Ft(me,$_.FREEZE_DURATION,1e3*je)}}}if(me[di.PLAYER_STATUS]=px[F._player?F._player.videoElementStatus:"uninit"],pt&&Ee.totalInterFrameDelay!==void 0&&Ee.totalSquaredInterFrameDelay!==void 0&&pt.totalInterFrameDelay!==void 0&&pt.totalSquaredInterFrameDelay!==void 0){const cr=Ee.totalInterFrameDelay-pt.totalInterFrameDelay,ei=Ee.totalSquaredInterFrameDelay-pt.totalSquaredInterFrameDelay,Wr=Ee.framesDecodeCount-pt.framesDecodeCount,Qo=cr/Wr*1e3,je=Math.round(1e3*Math.sqrt((ei-Math.pow(cr,2)/Wr)/Wr));!isNaN(je)&&Qo+je>Math.max(3*Qo,Qo+150)&&(me[di.I_FRAME_DELAY]=je)}}return me}(_._videoSSRC,r,s,_.videoTrack,R===!0,this.needUploadRenderFreezeTime,o,c):void 0;P&&(S.video=P)}if(E.has(gt.AUDIO)&&_.audioTrack){const R=_.audioTrack?function(P,k,z,U,F,q){const Y=k.audioRecv.find(me=>me.ssrc===P);if(!Y)return;const le={},ye=z&&z.audioRecv.find(me=>me.ssrc===P);if(Ft(le,Yo.JITTER,Y.jitterMs),Ft(le,Yo.BYTES_RETRANSMIT,Y.retransmittedBytesReceived),Ft(le,Yo.PACKAGES_RETRANSMIT,Y.retransmittedPacketsReceived),Ft(le,Yo.PACKAGES_DISCARDED,Y.packetsDiscarded),Ft(le,Yo.AVG_PROCESSING_DELAY,Y.avgProcessingDelayMs),ye){const me=k.timestamp-z.timestamp||K_*(q?q_:F?kP:1);Y.packets!=null&&ye.packets!=null&&Ft(le,Yo.PACKAGE_RATE,1e3*(Y.packets-ye.packets)/me),F&&ye.bytes!=null&&Y.bytes!=null&&Ft(le,Yo.BITRATE,8*(Y.bytes-ye.bytes)/me),Y.packetsLost!=null&&ye.packetsLost!=null&&Ft(le,Yo.PACKAGE_LOST,Y.packetsLost-ye.packetsLost)}if(q){const{receivedFrames:me,droppedFrames:ke}=Y;me!=null&&ke!=null&&(le[Yo.FREEZE]=(Ee=me)===0||100*ke/Ee>20?1:0)}var Ee;if(F){const me=100*U._source.getAccurateVolumeLevel(),ke=Y.outputLevel;if(ke!=null){const Ye=Math.ceil(50*Math.log10(100*ke+1));Ft(le,YH.LEVEL,Ye)}if(Ft(le,Yo.PCM_LEVEL,me),U&&(le[Yo.DISABLED]=U._originMediaStreamTrack.enabled&&U._mediaStreamTrack.enabled?0:1),Ft(le,Yo.JITTER_BUFFER,Y.jitterBufferMs),Ft(le,Yo.CURRENT_DELAY,Y.jitterBufferMs),le[Yo.PLAYER_STATUS]=px[Ko.getPlayerState(U.getTrackId())],ye){const Ye=Y.concealedSamples-ye.concealedSamples;Ye>0&&Ft(le,Yo.CONCEALED_SAMPLES,Ye);const ut=Y.totalSamplesReceived-ye.totalSamplesReceived;ut>0&&Ft(le,Yo.TOTAL_SAMPLES_RECEIVED,ut)}}return le}(_._audioSSRC,r,s,_.audioTrack,o,c):void 0;R&&(S.audio=R)}(S.video||S.audio)&&h.push(S)}),this.needUploadRenderFreezeTime=!this.needUploadRenderFreezeTime,h}startUploadTransportStats(){this.uploadTransportStarted=!0,this.uploadWRTCStatsTimer||this.startUploadWRTCStats()}stopUploadTransportStats(){this.uploadTransportStarted=!1}startUploadOutboundStats(){this.uploadOutboundStarted||(this.uploadOutboundStarted=!0,this.uploadWRTCStatsTimer||this.startUploadWRTCStats(),this.uploadOutboundDenoiserStatsTimer&&window.clearInterval(this.uploadOutboundDenoiserStatsTimer),this.uploadOutboundDenoiserStatsTimer=window.setInterval(()=>{if(!this.requestAllTracks||!this.requestUpload)return;const r=(this.requestAllTracks()||[]).find(s=>s instanceof eP);if(r&&r._external.getDenoiserStats){const s=r._external.getDenoiserStats();s&&this.requestUpload(wT.DENOISER_STATS,s)}},2e3),this.uploadExtStatsTimer&&window.clearInterval(this.uploadExtStatsTimer),this.uploadExtStatsTimer=window.setInterval(()=>{!this.requestAllTracks||!this.requestUpload||this.requestAllTracks().forEach(r=>{r.getProcessorStats().forEach(s=>{this.requestUpload&&this.requestUpload(s.type,s.stats)})})},2e3))}stopUploadOutboundStats(){this.uploadOutboundStarted&&(this.uploadOutboundStarted=!1,this.lastSendStats&&(this.lastSendStats.videoSend=[],this.lastSendStats.audioSend=[],this.lastSendStats=void 0),this.uploadOutboundDenoiserStatsTimer&&window.clearInterval(this.uploadOutboundDenoiserStatsTimer),this.uploadOutboundDenoiserStatsTimer=void 0)}startUploadInboundStats(){this.uploadInboundStarted||(this.uploadInboundStarted=!0,this.uploadWRTCStatsTimer||this.startUploadWRTCStats(),this.uploadInboundExtStatsTimer&&window.clearInterval(this.uploadInboundExtStatsTimer),this.uploadInboundExtStatsTimer=window.setInterval(()=>{!this.requestUpload||!this.requestRemoteMedia||(this.requestRemoteMedia()||[]).forEach(r=>{let[s,o]=r;o.has(gt.VIDEO)&&s.videoTrack&&s.videoTrack.getProcessorStats().forEach(c=>{this.requestUpload&&this.requestUpload(c.type,c.stats)}),o.has(gt.AUDIO)&&s.audioTrack&&s.audioTrack.getProcessorStats().forEach(c=>{this.requestUpload&&this.requestUpload(c.type,c.stats)})})},2e3))}stopUploadInboundStats(){this.uploadInboundStarted&&(this.uploadInboundStarted=!1,this.lastRecvStats&&(this.lastRecvStats.videoRecv=[],this.lastRecvStats.audioRecv=[],this.lastRecvStats=void 0))}startUploadExtensionUsageStats(){if(this.uploadExtensionUsageStarted)return;this.uploadExtensionUsageStarted=!0,this.uploadExtUsageStatsTimer&&window.clearInterval(this.uploadExtUsageStatsTimer);const r=new Map;this.uploadExtUsageStatsTimer=window.setInterval(async()=>{const s=Date.now(),o={connectionInterval:re("EXTENSION_USAGE_UPLOAD_INTERVAL")/1e3,details:[],lts:s};let c=[];const u=this.requestAllTracks&&this.requestAllTracks()||[];for(const E of u)!E.muted&&E.enabled&&(c=c.concat(await E.getProcessorUsage()));const h=this.requestRemoteMedia&&this.requestRemoteMedia()||[];for(const[E,S]of h)S.has(gt.VIDEO)&&E.videoTrack&&(c=c.concat(await E.videoTrack.getProcessorUsage())),S.has(gt.AUDIO)&&E.audioTrack&&(c=c.concat(await E.audioTrack.getProcessorUsage()));if(c.length===0)return;o.details=function(E,S){const R={};for(const{id:U,value:F,level:q,direction:Y}of E){var P;const le=(P=S.get(U))!==null&&P!==void 0?P:0,ye=F===2?le+re("EXTENSION_USAGE_UPLOAD_INTERVAL")/1e3:le;var k,z;S.set(U,ye),R[U]?(F===2&&(R[U].value=F),q>R[U].level&&(R[U].level=q),Y==="remote"&&(R[U].remoteUidCount+=1),R[U].totalTs=(k=S.get(U))!==null&&k!==void 0?k:0):R[U]={value:F,level:q,remoteUidCount:Y==="local"?0:1,totalTs:(z=S.get(U))!==null&&z!==void 0?z:0}}return Object.keys(R).map(U=>{const{level:F,value:q,totalTs:Y}=R[U];return{id:U,level:F,value:q,totalTs:Y}})}(c,r);const m=Date.now(),_=m>s?m:s+1;this.requestUpload&&this.requestUpload(wT.EXTENSION_USAGE_STATS,{usageStats:o,sendTs:_})},re("EXTENSION_USAGE_UPLOAD_INTERVAL"))}stopUploadExtensionUsageStats(){this.uploadExtensionUsageStarted&&(this.uploadExtensionUsageStarted=!1,this.uploadExtUsageStatsTimer&&window.clearInterval(this.uploadExtUsageStatsTimer),this.uploadExtUsageStatsTimer=void 0)}stopUploadBaseStats(){this.uploadBaseStatsStarted=!1}}const Wme=re("ICE_RESTART_INTERVAL");let NP=new Map,iS=new Map,Um=[Ds.UDP_TCP_RELAY,Ds.TCP_RELAY,Ds.RELAY],oM=re("JOIN_WITH_FALLBACK_MEDIA_PROXY_FORCE")&&kn().supportPCSetConfiguration;function ZH(t){let r=arguments.length>1&&arguments[1]!==void 0&&arguments[1];const s=NP.get(t.id);s&&(window.clearTimeout(s),NP.delete(t.id));const o=iS.get(t.id);r&&o&&o.index===Um.length-1&&(L.debug("[".concat(t.id,"] reset ICE restart policy")),iS.delete(t.id))}function e9(t,r,s){if(NP.size===0&&iS.size===0&&(Array.isArray(re("RESTART_SEQUENCE"))&&re("RESTART_SEQUENCE").length>0&&!function(m,_){if(m.length!==_.length)return!1;for(let E=0;E<m.length;E+=1){const S=m[E];if(m.filter(R=>R===S).length!==_.filter(R=>R===S).length)return!1}return!0}(Um,re("RESTART_SEQUENCE"))&&(Um=re("RESTART_SEQUENCE").filter(m=>{var _;if(ot(_=Object.values(Ds)).call(_,m))return!0}),L.debug("use reconnection policy from config distribution, queues: ".concat(Um.join(" => ")))),oM=re("JOIN_WITH_FALLBACK_MEDIA_PROXY_FORCE")&&kn().supportPCSetConfiguration),Um.length===0)return void s();let o,{index:c=0,type:u}=iS.get(t.id)||{};if(oM&&u===Ds.RELAY)return void s();let h=u&&c>=Um.length-1;if(oM)u=Ds.RELAY;else{if(h)return void s();u?(c++,u=Um[c]):(u=Um[0],c=0)}L.debug("[".concat(t.id,"] choose ICE restart policy: ").concat(u,", index: ").concat(c)),r(u),iS.set(t.id,{index:c,type:u}),o=window.setTimeout(()=>e9(t,r,s),Wme),NP.set(t.id,o)}var dn;function t9(t,r){var s=Object.keys(t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);r&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(t,c).enumerable})),s.push.apply(s,o)}return s}function Rh(t){for(var r=1;r<arguments.length;r++){var s=arguments[r]!=null?arguments[r]:{};r%2?t9(Object(s),!0).forEach(function(o){$(t,o,s[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(s)):t9(Object(s)).forEach(function(o){Object.defineProperty(t,o,Object.getOwnPropertyDescriptor(s,o))})}return t}function n9(t){var r,s,o,c=2;for(typeof Symbol<"u"&&(s=OL,o=Symbol.iterator);c--;){if(s&&(r=t[s])!=null)return r.call(t);if(o&&(r=t[o])!=null)return new DP(r.call(t));s="@@asyncIterator",o="@@iterator"}throw new TypeError("Object is not async iterable")}function DP(t){function r(s){if(Object(s)!==s)return lt.reject(new TypeError(s+" is not an object."));var o=s.done;return lt.resolve(s.value).then(function(c){return{value:c,done:o}})}return DP=function(s){this.s=s,this.n=s.next},DP.prototype={s:null,n:null,next:function(){return r(this.n.apply(this.s,arguments))},return:function(s){var o=this.s.return;return o===void 0?lt.resolve({value:s,done:!0}):r(o.apply(this.s,arguments))},throw:function(s){var o=this.s.return;return o===void 0?lt.reject(s):r(o.apply(this.s,arguments))}},new DP(t)}let MT=(dn=class extends Pr{get state(){return this._state}set state(t){const r=this._state;this._state=t,this.emit(kt.StateChange,r,this._state)}constructor(t,r){super(),$(this,"isPlanB",void 0),$(this,"store",void 0),$(this,"statsUploader",void 0),$(this,"connection",void 0),$(this,"localTrackMap",new Map),$(this,"remoteUserMap",new Map),$(this,"localDataChannels",[]),$(this,"remoteDataChannelMap",new Map),$(this,"pendingLocalTracks",[]),$(this,"pendingRemoteTracks",[]),$(this,"pendingLocalDataChannels",[]),$(this,"pendingRemoteDataChannels",[]),$(this,"statsCollector",void 0),$(this,"shouldForwardP2PCreation",void 0),$(this,"iceFailedCount",0),$(this,"dtlsFailedCount",0),$(this,"mutex",void 0),$(this,"_state",Wn.Disconnected),$(this,"_pcStatsUploadType",re("NEW_ICE_RESTART")?ep.FIRST_CONNECTION:ep.OLD_FIRST_CONNECTION),$(this,"_isStartRestartIce",!1),$(this,"_restartTimer",void 0),$(this,"_isTryConnecting",!1),$(this,"_iceError",null),$(this,"_forceTurn",!1),$(this,"_isWaitPcToRePub",!1),$(this,"handleMuteLocalTrack",async(s,o,c)=>{const u=await this.mutex.lock("Locking from P2PChannel.handleMuteLocalTrack");try{if(!this.connection||this.state!==Wn.Connected)return void c(new Le(X.INVALID_OPERATION,"Cannot call P2PChannel.handleMuteLocalTrack before connection established."));const h=this.filterTobeMutedTracks(s);if(h.length===0)return void o();const m=h.find(E=>E[0]==="videoLowTrack");m&&m[1].track._originMediaStreamTrack.stop(),await this.connection.muteLocal(h.map(E=>{let[,{id:S}]=E;return S}));const _=this.createMuteMessage(h);await sr(this,kt.RequestMuteLocal,_),o()}catch(h){c(h)}finally{u()}}),$(this,"handleUnmuteLocalTrack",async(s,o,c)=>{const u=await this.mutex.lock("Locking from P2PChannel.handleUnmuteLocalTrack");try{if(!this.connection||this.state!==Wn.Connected)return void c(new Le(X.INVALID_OPERATION,"Cannot call P2PChannel.handleUnmuteLocalTrack before connection established."));const h=this.filterTobeUnmutedTracks(s);if(h.length===0)return void o();const m=h.find(E=>E[0]==="videoLowTrack");if(m){const E=m[1];if(E.track._originMediaStreamTrack.stop(),!re("DISABLE_DUAL_STREAM_USE_ENCODING")&&kn().supportDualStreamEncoding){const S=s._mediaStreamTrack.clone();E.track._mediaStreamTrack=S,E.track._originMediaStreamTrack=S}else{const S=sM(s,_T(this,kt.RequestLowStreamParameter));E.track._mediaStreamTrack=S,E.track._originMediaStreamTrack=S}await new lt((S,R)=>{this.handleReplaceTrack(E.track,S,R,!0)})}await this.connection.unmuteLocal(h.map(E=>{let[,{id:S}]=E;return S}));const _=this.createUnmuteMessage(h);await sr(this,kt.RequestUnmuteLocal,_),o()}catch(h){c(h)}finally{u()}}),$(this,"handleUpdateVideoEncoder",async(s,o,c,u)=>{let h;u||(h=await this.mutex.lock("Locking from P2PChannel.handleUpdateVideoEncoder"));try{const _=this.localTrackMap.get($e.LocalVideoTrack);if(!this.connection||!_||_.track!==s||this.state!==Wn.Connected)return void o();const{id:E,track:S}=_;await this.connection.updateSendParameters(E,S),await this.connection.updateEncoderConfig(E,S),this.emit(kt.UpdateVideoEncoder,S),o()}catch(_){c(_)}finally{var m;(m=h)===null||m===void 0||m()}}),$(this,"handleUpdateVideoSendParameters",async(s,o,c)=>{const u=await this.mutex.lock("Locking from P2PChannel.handleUpdateVideoSendParameters");try{const h=this.localTrackMap.get($e.LocalVideoTrack);if(!this.connection||!h||h.track!==s||this.state!==Wn.Connected)return void o();const{id:m,track:_}=h;await this.connection.updateSendParameters(m,_),o()}catch(h){c(h)}finally{u()}}),$(this,"handleReplaceMixingTrack",async(s,o,c,u)=>{if(!this.connection||this.state!==Wn.Connected)return void o();const h=rM([s]);let m;L.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection will replace audioTrack [").concat(h.getTrackId(),"]")),typeof u=="boolean"&&u||(m=await this.mutex.lock("From P2PChannel.handleReplaceMixingTrack"));try{await this.replaceTrack(s,h),o()}catch(E){c(E)}finally{var _;(_=m)===null||_===void 0||_()}}),$(this,"handleReplaceTrack",async(s,o,c,u)=>{let h;L.debug("[".concat(this.store.clientId,"] P2PChannel handleReplaceTrack for [track-id-").concat(s.getTrackId(),"]")),typeof u=="boolean"&&u||(h=await this.mutex.lock("From P2PChannel.handleReplaceTrack"));try{var m;const E=Array.from(this.localTrackMap.entries()).find(S=>{let[,{track:R}]=S;return s===R});if(!this.connection||!E||this.state!==Wn.Connected)return void o();if(await((m=this.connection)===null||m===void 0?void 0:m.replaceTrack(s,E[1].id)),this.isPlanB){const S=E[1];S.id=s._mediaStreamTrack.id,this.localTrackMap.set(E[0],S)}if(E[0]===$e.LocalVideoTrack&&!re("DISABLE_DUAL_STREAM_USE_ENCODING")&&kn().supportDualStreamEncoding){const S=this.localTrackMap.get($e.LocalVideoLowTrack);if(S){const R=s._mediaStreamTrack.clone();S.track._originMediaStreamTrack.stop(),S.track._mediaStreamTrack=R,S.track._originMediaStreamTrack=R,await new lt((P,k)=>{this.handleReplaceTrack(S.track,P,k,!0)})}}o()}catch(E){c(E)}finally{var _;(_=h)===null||_===void 0||_()}}),$(this,"handleGetRTCStats",s=>{s(this.statsCollector.getRTCStats())}),$(this,"handleGetLocalVideoStats",s=>{s(this.statsCollector.getLocalVideoTrackStats())}),$(this,"handleGetLocalAudioStats",s=>{s(this.statsCollector.getLocalAudioTrackStats())}),$(this,"handleGetRemoteVideoStats",s=>this.statsCollector.getRemoteVideoTrackStats(s.uid)[s.uid]),$(this,"handleGetRemoteAudioStats",s=>this.statsCollector.getRemoteAudioTrackStats(s.uid)[s.uid]),this.store=t,this.statsCollector=r,this.statsCollector.addP2PChannel(this),this.statsUploader=new QH(this.store),this.bindStatsUploaderEvents(),this.mutex=new ks("P2PChannel-mutex",this.store.clientId),this.isPlanB=!kn().supportUnifiedPlan||re("CHROME_FORCE_PLAN_B")&&Kf(),this.shouldForwardP2PCreation=re("FORWARD_P2P_CREATION")&&kn().supportPCSetConfiguration&&WL(),this.shouldForwardP2PCreation&&(this.connection=AP(this.store),this.emit(kt.PeerConnectionStateChange,this.connection.peerConnectionState),this.bindConnectionEvents(this.connection))}async startP2PConnection(t){var r;this.state=Wn.New,this._forceTurn=$H(t),L.debug("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] forceTurn: ").concat(this._forceTurn));const s=this.shouldForwardP2PCreation&&((r=this.connection)===null||r===void 0?void 0:r.peerConnectionState)==="closed";if(this.shouldForwardP2PCreation&&!s||(s&&this.connection&&(L.warning("[".concat(this.store.clientId,"] P2PChannel.startP2PConnection ForwardP2P closed.")),this.resetConnection(this.connection)),this.connection=AP(this.store,t),this.emit(kt.PeerConnectionStateChange,this.connection.peerConnectionState),this.bindConnectionEvents(this.connection)),!this.connection)throw new Le(X.UNEXPECTED_ERROR,"Cannot P2PChannel.startConnection before P2PConnection initialization .");return this._pcStatsUploadType=re("NEW_ICE_RESTART")?ep.FIRST_CONNECTION:ep.OLD_FIRST_CONNECTION,this._isTryConnecting=!0,this._isStartRestartIce=!1,this._iceError=null,this.connection.setConfiguration(t),this.connection.establishPromise}async connect(t){if(!this.connection)throw new Le(X.UNEXPECTED_ERROR,"Cannot P2PChannel.connect before P2PChannel.startP2PConnection .");re("ENABLE_PREALLOC_PC")&&this.state===Wn.Connected?await this.connection.updateRemoteConnect(t):(this.store.peerConnectionStart(),await this.connection.connect(t),this.statsUploader.startUploadTransportStats(),this.statsUploader.startUploadExtensionUsageStats(),this.state=Wn.Connected)}updateRemoteRTPCapabilities(t){const r=Array.from(this.localTrackMap.entries()).filter(c=>{var u;let[h]=c;return ot(u=[$e.LocalVideoLowTrack,$e.LocalVideoTrack]).call(u,h)}),s=r.map(c=>{let[,{id:u}]=c;return u}),o=r.map(c=>{let[u]=c;return u});if(this.connection instanceof Th){if(Rt.updateRemoteRTPCapabilities(this.store.sessionId,{trackTypes:JSON.stringify(o),localCodecs:JSON.stringify(this.connection.localCodecs),remoteCodecs:JSON.stringify(t)}),!ot(t).call(t,this.store.codec)){const c=["vp9","vp8","h264"].find(u=>ot(t).call(t,u));c&&(this.store.codec=c,L.debug("[".concat(this.store.clientId,"] [").concat(this.store.p2pId," updateRemoteRTPCapabilities] default codec is not available, hence the fallback to ").concat(c,".")))}this.connection.updateRemoteRTPCapabilities(s,t)}}async getEstablishParams(){var t;if(this.connection instanceof Th&&this.connection.peerConnectionState!=="closed"&&ot(t=[Wn.New,Wn.Connected]).call(t,this.state))return this.connection.establishPromise}async publishDataChannel(t){if(!this.connection||this.state!==Wn.Connected){if(this.state===Wn.Disconnected)throw new Le(X.UNEXPECTED_ERROR,"PeerConnection already disconnected.");return t.forEach(s=>{var o;ot(o=this.pendingLocalDataChannels).call(o,s)||this.pendingLocalDataChannels.push(s)}),[]}const r=this.filterTobePublishedDataChannels(t);return r.length===0?[]:(r.forEach(s=>{const o=Date.now();this.store.publish(s.id.toString(),"datachannel",o)}),await this.connection.createDataChannels(this.store.uid,r),r.forEach(s=>{this.localDataChannels.push(s);const o=Date.now();this.store.publish(s.id+"","datachannel",void 0,o)}),t.map(s=>({streamId:s.id,ordered:s.ordered,maxRetransmits:s.maxRetransmits,metadata:s.metadata,channelId:s._originDataChannelId})))}publish(t,r,s){var o=this;return _l(function*(){const c=yield wn(o.mutex.lock("From P2PChannel.publish"));try{var u;const h=o.connection&&ot(u=["disconnected","failed"]).call(u,o.connection.peerConnectionState);if(!o.connection||o.state!==Wn.Connected||h){if(o.state===Wn.Disconnected)throw new Le(X.UNEXPECTED_ERROR,"PeerConnection already disconnected.");o.throwIfTrackTypeNotMatch(t);const _=t.filter(E=>o.pendingLocalTracks.indexOf(E)===-1);return o.pendingLocalTracks=o.pendingLocalTracks.concat(_),void(h&&(o._isWaitPcToRePub=!0))}o.store.pubId=o.store.pubId+1,Ls.markPublishStart(o.store.clientId,o.store.pubId);const m=o.filterTobePublishedTracks(t,r,s);if(m.length===0)return void(yield wn(o.tryToUnmuteAudio(t)));yield*IA(n9(o.doPublish(o.connection,m)))}finally{c()}})()}doPublish(t,r){var s=this;return _l(function*(){r.forEach(P=>{let{track:k,type:z}=P;const U=Date.now();s.store.publish(k.getTrackId(),z===$e.LocalAudioTrack?"audio":"video",U)}),s.bindLocalTrackEvents(r);const o=r.map(P=>{let{track:k}=P;return k}),c=yield wn(t.send(o,s.store.codec,s.store.audioCodec)),u=(yield wn(c.next())).value,h=s.createGatewayPublishMessage(r,u);let m;try{m=yield h}catch(P){throw c.throw(P),(P==null?void 0:P.code)===X.WS_ABORT&&r.forEach(k=>{let{track:z}=k;s.pendingLocalTracks.indexOf(z)===-1&&s.pendingLocalTracks.push(z)}),s.unbindLocalTrackEvents(r),P}const _=s.mapPubResToRemoteConfig(h,m,o),E=(yield wn(c.next(_))).value;if(s.state===Wn.Disconnected)throw new Le(X.UNEXPECTED_ERROR,"PeerConnection already disconnected.");re("ENABLE_VIDEO_SEI");const S=re("ENABLE_ENCODED_TRANSFORM"),R=re("ENABLE_AUDIO_METADATA");o.forEach(async P=>{const k=P.getRTCRtpTransceiver();if(!k||!S)return;const{interceptLocalVideoFrame:z,interceptLocalAudioFrame:U}=SP();P.trackMediaType===gt.VIDEO?await z(k.sender,P):P.trackMediaType===gt.AUDIO&&await U(k.sender,{metadata:R?()=>{const F=P.metadata.shift();return F&&F.value}:void 0})}),r.forEach(P=>{let{type:k}=P;s.statsCollector.addLocalStats(k)}),s.assignLocalTracks(r,E),s.statsUploader.startUploadOutboundStats(),r.forEach(P=>{let{track:k,type:z}=P;const U=Date.now();s.store.publish(k.getTrackId(),z===$e.LocalAudioTrack?"audio":"video",void 0,U)})})()}async updateVideoStreamParameter(t,r){const s=this.localTrackMap.get(r);if(!s||!this.connection)return;if(!(s.track instanceof _r))return L.warn("[updateVideoStreamParameter]: track is not an instance of LocalVideoTrack");const{track:o}=s,c=function(u,h){const m={};return u.height&&u.width&&(m.scaleResolutionDownBy=Bx(u,h)),m.maxFramerate=u.framerate?rc(u.framerate):void 0,m.maxBitrate=u.bitrate?1e3*u.bitrate:void 0,m}(t,o);if(o._encoderConfig||(o._encoderConfig={}),r!==$e.LocalVideoLowTrack||!re("DISABLE_DUAL_STREAM_USE_ENCODING")&&kn().supportDualStreamEncoding)c.scaleResolutionDownBy!=null&&(o._encoderConfig.scaleResolutionDownBy=c.scaleResolutionDownBy);else{const u=o._originMediaStreamTrack;if(!u.canvas)return L.warn("[".concat(o.getTrackId(),"] no canvas on track"));(function(h,m){const _=h.canvas;m.width&&(_.width=rc(m.width)),m.height&&(_.height=rc(m.height)),m.framerate&&(_.stopCapture&&_.stopCapture(),_.stopCapture=gx(()=>{!_.startCapture&&_.stopCapture&&_.stopCapture(),_.startCapture&&_.startCapture()},rc(m.framerate)))})(u,t)}c.maxBitrate!=null&&(o._encoderConfig.bitrateMax=c.maxBitrate/1e3),c.maxFramerate!=null&&(o._encoderConfig.frameRate&&typeof o._encoderConfig.frameRate=="object"?o._encoderConfig.frameRate.max=c.maxFramerate:o._encoderConfig.frameRate={max:c.maxFramerate}),L.debug("[".concat(o.getTrackId(),"] LowStreamEncoderConfig: , ").concat(JSON.stringify(o._encoderConfig))),await this.connection.updateRtpSenderEncodings(o)}publishLowStream(t){var r=this;return _l(function*(){if(!r.connection||r.state!==Wn.Connected)return;const s=yield wn(r.mutex.lock("Locking from P2PChannel.publishLowStream"));try{const c=r.localTrackMap.get($e.LocalVideoTrack);if(!c)throw new Le(X.UNEXPECTED_ERROR,"Could not find high stream");if(r.localTrackMap.has($e.LocalVideoLowTrack))throw new Le(X.UNEXPECTED_ERROR,"[".concat(r.store.clientId,"] Can't publish low stream when stream already publish"));const u=[{track:r.getLowVideoTrack(c.track,t),type:$e.LocalVideoLowTrack}];if(yield*IA(n9(r.doPublish(r.connection,u))),c.track.muted||!c.track.enabled){var o;const h=(o=r.localTrackMap.get($e.LocalVideoLowTrack))===null||o===void 0?void 0:o.id;h!==void 0&&(yield wn(r.connection.muteLocal([h])))}}finally{s()}})()}async republish(){this.pendingLocalTracks.length>0&&(L.debug("[".concat(this.store.clientId,"] Emit P2PChannelEvents.RequestRePublish to republish tracks.")),await Ts(this,kt.RequestRePublish,this.pendingLocalTracks),this.emit(kt.MediaReconnectEnd,this.store.uid),this.pendingLocalTracks=[]),this.pendingLocalDataChannels.length>0&&(L.debug("Emit P2PChannelEvents.RequestRePublishDataChannel to republish datachannels."),await Ts(this,kt.RequestRePublishDataChannel,this.pendingLocalDataChannels),this.pendingLocalDataChannels=[]),this._isWaitPcToRePub=!1}async reSubscribe(t){for(let r=this.pendingRemoteTracks.length-1;r>=0;r--){const{user:s,kind:o}=this.pendingRemoteTracks[r];(o!==gt.AUDIO||s._audio_added_&&s._audioSSRC)&&(o!==gt.VIDEO||s._video_added_&&s._videoSSRC)||this.pendingRemoteTracks.splice(r,1)}if(t)await Ts(this,kt.RequestReSubscribe,this.pendingRemoteTracks);else for(const{user:r,kind:s}of this.pendingRemoteTracks)await this.subscribe(r,s,s===gt.VIDEO?r._videoSSRC:r._audioSSRC);this.pendingRemoteTracks.forEach(r=>{let{user:s}=r;this.emit(kt.MediaReconnectEnd,s.uid)}),this.pendingRemoteTracks=[]}async unpublish(t){if(!this.connection||this.state!==Wn.Connected)return void t.forEach(o=>{const c=this.pendingLocalTracks.indexOf(o);c!==-1&&this.pendingLocalTracks.splice(c,1)});const r=this.filterTobeUnpublishedTracks(t);if(r.length===0)return;const s=r.find(o=>o[0]==="videoLowTrack");return s&&s[1].track.close(),this.doUnpublish(this.connection,r)}async unpublishDataChannel(t){if(!this.connection||this.state!==Wn.Connected)return void t.forEach(s=>{const o=this.pendingLocalDataChannels.indexOf(s);o!==-1&&this.pendingLocalDataChannels.splice(o,1)});const r=this.filterTobeUnpublishedDataChannels(t);return r.length!==0?(r.forEach(s=>{const o=this.localDataChannels.indexOf(s);o!==-1&&this.localDataChannels.splice(o,1)}),this.localDataChannels.length===0&&await this.connection.stopDataChannels(this.store.uid),r.map(s=>s.id)):void 0}async unpublishLowStream(){if(!this.connection||this.state!==Wn.Connected)return;const t=this.localTrackMap.get($e.LocalVideoLowTrack);if(!t)return;t.track.close();const r=[[$e.LocalVideoLowTrack,t]];return this.doUnpublish(this.connection,r)}async doUnpublish(t,r){const s=this.createGatewayUnpublishMessage(r);return await t.stopSending(r.map(o=>{let[,{id:c}]=o;return c})),this.withdrawLocalTracks(r),this.unbindLocalTrackEvents(r.map(o=>{let[c,{track:u}]=o;return{type:c,track:u}})),r.forEach(o=>{let[c]=o;this.statsCollector.removeLocalStats(c)}),this.localTrackMap.size===0&&this.statsUploader.stopUploadOutboundStats(),s}async subscribeDataChannel(t,r){if(!this.connection||this.state!==Wn.Connected)throw new Le(X.INVALID_OPERATION,"Cannot subscribe remote user when peerConnection disconnected.");const s=r.filter(o=>{var c;return!((c=this.remoteDataChannelMap.get(t))!==null&&c!==void 0&&c.get(o.id))});if(s.length!==0)return await this.connection.createDataChannels(t.uid,s),s.forEach(o=>{var c;this.remoteDataChannelMap.has(t)?(c=this.remoteDataChannelMap.get(t))===null||c===void 0||c.set(o.id,o):this.remoteDataChannelMap.set(t,new Map([[o.id,o]]));const u=this.pendingRemoteDataChannels.findIndex(h=>{let{user:m,id:_}=h;return m.uid===t.uid&&_===o.id});u!==-1&&this.pendingRemoteDataChannels.splice(u,1)}),s.map(o=>o.id)}async subscribe(t,r,s,o,c){var u;if(!this.connection||this.state!==Wn.Connected)throw new Le(X.INVALID_OPERATION,"Cannot subscribe remote user when peerConnection disconnected.");if((u=this.remoteUserMap.get(t))!==null&&u!==void 0&&u.has(r))return;let h,m,_;const E=this.connection.getPreMedia(s);if(E)L.debug("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] preSSRCMap has ssrcId: ").concat(s,", no need to send sub to gateway.")),_=E.transceiver,h=E.track,m=E.id;else if(c){const P=c.find(z=>{let{stream_type:U}=z;return U===r});if(!P)throw new Le(X.UNEXPECTED_ERROR,"Cannot subscribe to remote ".concat(r," for user: ").concat(t.uid," because subscribe answer from gateway does not contain stream_type: ").concat(r,"."));const k=await this.connection.receive(r,P.ssrcs,String(t._uintid),P.attributes);this.connection instanceof Th&&(_=k.transceiver),h=k.track,m=k.id}else{const P=await this.connection.receive(r,[{ssrcId:s,rtx:o}],String(t._uintid),void 0);this.connection instanceof Th&&(_=P.transceiver),h=P.track,m=P.id}if(r===gt.AUDIO?(t._audioTrack?t._audioTrack._updateOriginMediaStreamTrack(h):(t._audioTrack=new Hv(h,t.uid,t._uintid,this.store),L.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote audio track: ").concat(t._audioTrack.getTrackId()))),_&&t._audioTrack._updateRtpTransceiver(_),this.bindRemoteTrackEvents(t,t._audioTrack)):(t._videoTrack?t._videoTrack._updateOriginMediaStreamTrack(h):(t._videoTrack=new Gv(h,t.uid,t._uintid,this.store),L.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote video track: ").concat(t._videoTrack.getTrackId()))),_&&t._videoTrack._updateRtpTransceiver(_),this.bindRemoteTrackEvents(t,t._videoTrack)),_&&re("ENABLE_ENCODED_TRANSFORM")){const{interceptRemoteVideoFrame:P,interceptRemoteAudioFrame:k}=SP();r==gt.VIDEO?await P(_.receiver,{onSei:re("ENABLE_VIDEO_SEI")&&(z=>{var U;return(U=t._videoTrack)===null||U===void 0?void 0:U._onSei(z)})}):r==gt.AUDIO&&await k(_.receiver,{enableTopn:!!re("ENABLE_AUDIO_TOPN"),enableMetadata:!!re("ENABLE_AUDIO_METADATA"),onMetadata:z=>{this.safeEmit(kt.AudioMetadata,z)}})}const S=this.remoteUserMap.get(t);S?S.set(r,m):this.remoteUserMap.set(t,new Map([[r,m]])),this.statsCollector.addRemoteStats(t.uid),this.statsUploader.startUploadInboundStats();const R=this.pendingRemoteTracks.findIndex(P=>{let{user:k,kind:z}=P;return k.uid===t.uid&&r===z});R!==-1&&(this.pendingRemoteTracks.splice(R,1),this.emit(kt.MediaReconnectEnd,t.uid))}async massSubscribe(t){return this.massSubscribeNoLock(t)}async massSubscribeNoLock(t){if(!this.connection||this.state!==Wn.Connected)throw new Le(X.INVALID_OPERATION,"Cannot subscribeAll remote users when peerConnection disconnected.");t=t.filter(c=>{var u;let{user:h,mediaType:m}=c;return!((u=this.remoteUserMap.get(h))!==null&&u!==void 0&&u.has(m))});const r=[],s=new Map;t.forEach(c=>{if(!this.connection)return;const u=this.connection.getPreMedia(c.ssrcId);u?s.set(c.ssrcId,u):r.push(c)});const o=await this.connection.batchReceive(r.map(c=>{let{user:u,mediaType:h,ssrcId:m,rtxSsrcId:_}=c;return{kind:h,ssrcMsg:[{ssrcId:m,rtx:_}],mslabel:String(u._uintid)}}));r.forEach((c,u)=>{s.set(c.ssrcId,o[u])});for(const{user:c,mediaType:u,ssrcId:h}of t){const m=s.get(h);if(!m)return void L.debug("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] cannot find ").concat(c.uid," subscribe data,").concat(u,", ").concat(h));const{track:_,id:E,transceiver:S}=m;if(S&&re("ENABLE_ENCODED_TRANSFORM")){const{interceptRemoteVideoFrame:k,interceptRemoteAudioFrame:z}=SP();u==gt.VIDEO?await k(S.receiver,{onSei:re("ENABLE_VIDEO_SEI")&&(U=>{var F;return(F=c._videoTrack)===null||F===void 0?void 0:F._onSei(U)})}):u==gt.AUDIO&&await z(S.receiver,{enableTopn:!!re("ENABLE_AUDIO_TOPN"),enableMetadata:!!re("ENABLE_AUDIO_METADATA"),onMetadata:U=>{this.safeEmit(kt.AudioMetadata,U)}})}if(u===gt.AUDIO?(c._audioTrack?c._audioTrack._updateOriginMediaStreamTrack(_):(c._audioTrack=new Hv(_,c.uid,c._uintid,this.store),L.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote audio track: ").concat(c._audioTrack.getTrackId()))),S&&c._audioTrack._updateRtpTransceiver(S),this.bindRemoteTrackEvents(c,c._audioTrack)):(c._videoTrack?c._videoTrack._updateOriginMediaStreamTrack(_):(c._videoTrack=new Gv(_,c.uid,c._uintid,this.store),L.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote video track: ").concat(c._videoTrack.getTrackId()))),S&&c._videoTrack._updateRtpTransceiver(S),this.bindRemoteTrackEvents(c,c._videoTrack)),re("ENABLE_VIDEO_SEI")&&S){const{interceptRemoteVideoFrame:k,interceptRemoteAudioFrame:z}=SP();u==gt.VIDEO?await k(S.receiver,{onSei:U=>{var F;(F=c._videoTrack)===null||F===void 0||F._onSei(U)}}):u==gt.AUDIO&&await z(S.receiver)}const R=this.remoteUserMap.get(c);R?R.set(u,E):this.remoteUserMap.set(c,new Map([[u,E]])),this.statsCollector.addRemoteStats(c.uid),this.statsUploader.startUploadInboundStats();const P=this.pendingRemoteTracks.findIndex(k=>{let{user:z,kind:U}=k;return z.uid===c.uid&&u===U});P!==-1&&(this.pendingRemoteTracks.splice(P,1),this.emit(kt.MediaReconnectEnd,c.uid))}}async unsubscribe(t,r,s){const o=this.pendingRemoteTracks.filter(h=>{let{user:m,kind:_}=h;return r!==void 0?m.uid===t.uid&&r===_:m.uid===t.uid});if(o.forEach(h=>{const m=this.pendingRemoteTracks.indexOf(h);this.pendingRemoteTracks.splice(m,1)}),this.connection&&this.state===Wn.Connected||s||o.forEach(h=>{let{kind:m}=h;var _;if(m===gt.AUDIO)(_=t._audioTrack)===null||_===void 0||_._destroy(),t._audioTrack=void 0;else if(m===gt.VIDEO){var E;(E=t._videoTrack)===null||E===void 0||E._destroy(),t._videoTrack=void 0}}),!this.connection||this.state!==Wn.Connected)return;const c=this.filterTobeUnSubscribedTracks(t,r);if(c.length===0)return;await this.connection.stopReceiving(c.map(h=>{let[,{id:m}]=h;return m}));const u=this.createUnsubscribeMessage(c);return this.withdrawRemoteTracks(c),this.remoteUserMap.size===0&&this.statsUploader.stopUploadInboundStats(),c.forEach(h=>{let[m,{kind:_}]=h;var E,S;if(_===gt.VIDEO&&m._videoSSRC&&((E=this.connection)===null||E===void 0||E.setStatsRemoteVideoIsReady(m._videoSSRC,!1)),_===gt.VIDEO)this.unbindRemoteTrackEvents(m._videoTrack),s||((S=m._videoTrack)===null||S===void 0||S._destroy(),m._videoTrack=void 0);else if(_===gt.AUDIO){var R;this.unbindRemoteTrackEvents(m._audioTrack),!s&&((R=m._audioTrack)===null||R===void 0||R._destroy(),m._audioTrack=void 0)}}),u}async unsubscribeDataChannel(t,r){if(r.forEach(c=>{const u=this.pendingRemoteDataChannels.findIndex(h=>h.id===c.id);u!==-1&&this.pendingRemoteDataChannels.splice(u,1)}),!this.connection)return;const s=this.filterTobeUnSubscribedDataChannels(t,r);if(s.length===0)return;r.forEach(c=>{c._close()});const o=this.remoteDataChannelMap.get(t);return s.forEach(c=>{o&&o.delete(c.id)}),o&&o.size===0&&(this.remoteDataChannelMap.delete(t),await this.connection.stopDataChannels(t.uid)),s.map(c=>c.id)}async massUnsubscribe(t){return this.massUnsubscribeNoLock(t)}async massUnsubscribeNoLock(t){let r=[];for(const{user:c,mediaType:u}of t){const h=this.pendingRemoteTracks.filter(m=>{let{user:_,kind:E}=m;return u!==void 0?_.uid===c.uid&&u===E:_.uid===c.uid});h.forEach(m=>{const _=this.pendingRemoteTracks.indexOf(m);this.pendingRemoteTracks.splice(_,1)}),r=r.concat(h)}if(!this.connection||this.state!==Wn.Connected)return void r.forEach(c=>{let{user:u,kind:h}=c;var m;if(h===gt.AUDIO)(m=u._audioTrack)===null||m===void 0||m._destroy(),u._audioTrack=void 0;else if(h===gt.VIDEO){var _;(_=u._videoTrack)===null||_===void 0||_._destroy(),u._videoTrack=void 0}});const s=Ya(t).call(t,(c,u)=>{let{user:h,mediaType:m}=u;const _=this.filterTobeUnSubscribedTracks(h,m);return c.concat(_)},[]);if(s.length===0)return;await this.connection.stopReceiving(s.map(c=>{let[,{id:u}]=c;return u}));const o=this.createUnsubscribeAllMessage(s);return this.withdrawRemoteTracks(s),this.remoteUserMap.size===0&&this.statsUploader.stopUploadInboundStats(),s.forEach(c=>{let[u,{kind:h}]=c;var m,_;if(h===gt.VIDEO&&u._videoSSRC&&((m=this.connection)===null||m===void 0||m.setStatsRemoteVideoIsReady(u._videoSSRC,!1)),h===gt.VIDEO)this.unbindRemoteTrackEvents(u._videoTrack),(_=u._videoTrack)===null||_===void 0||_._destroy(),u._videoTrack=void 0;else if(h===gt.AUDIO){var E;this.unbindRemoteTrackEvents(u._audioTrack),(E=u._audioTrack)===null||E===void 0||E._destroy(),u._audioTrack=void 0}}),o}isPreSubScribe(t){return!this.connection||this.state!==Wn.Connected?!1:!!this.connection.getPreMedia(t)}async muteRemote(t,r){if(!this.connection)return;const s=this.remoteUserMap.get(t);if(!s)return void L.warning("[".concat(this.store.clientId,"] P2PChannel.muteRemote has no remote user ").concat(t.uid,"."));if(!s.get(r))return void L.warning("[".concat(this.store.clientId,"] P2PChannel.muteRemote has no remote user ").concat(t.uid," media type ").concat(r,"."));const o=r===gt.VIDEO?t._videoSSRC:t._audioSSRC;o!==void 0&&this.connection.setStatsRemoteVideoIsReady(o,!1)}async unmuteRemote(t,r){return this.unmuteRemoteNoLock(t,r)}async unmuteRemoteNoLock(t,r){if(!this.connection)return;const s=this.remoteUserMap.get(t);if(!s)return void L.warning("[".concat(this.store.clientId,"] P2PChannel.unmuteRemote has no remote user ").concat(t.uid,"."));s.get(r)||L.warning("[".concat(this.store.clientId,"] P2PChannel.unmuteRemote has no remote user ").concat(t.uid," media type ").concat(r,"."))}addAudioMetadata(t){const r=this.localTrackMap.get($e.LocalAudioTrack),s=r&&r.track;s&&s.metadata.push(t)}getAllTracks(t){const r=this.localTrackMap.get($e.LocalAudioTrack);if((r==null?void 0:r.track)instanceof Ai){const s=r.track;return Array.from(this.localTrackMap.entries()).filter(o=>{let[c]=o;return c!==$e.LocalAudioTrack}).filter(o=>{let[c]=o;return!(t&&c===$e.LocalVideoLowTrack)}).map(o=>{let[,{track:c}]=o;return c}).concat(s.trackList)}return Array.from(this.localTrackMap.entries()).filter(s=>{let[o]=s;return!(t&&o===$e.LocalVideoLowTrack)}).map(s=>{let[,{track:o}]=s;return o})}getAllDataChannels(){return this.localDataChannels}reportPublishEvent(t,r,s,o,c){if(t){const h=this.localTrackMap.get($e.LocalAudioTrack),m=o?this.localTrackMap.get($e.LocalVideoLowTrack):this.localTrackMap.get($e.LocalVideoTrack);Rt.publish(this.store.sessionId,{eventElapse:Ls.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:t,ec:r,audioName:h==null?void 0:h.track.getTrackLabel(),videoName:m==null?void 0:m.track.getTrackLabel(),screenshare:(m==null?void 0:m.track._hints.indexOf(ar.SCREEN_TRACK))!==-1,audio:!!h,video:!!m,p2pid:this.store.p2pId,publishRequestid:this.store.pubId,extend:c})}else{var u;s||(s=[]);const h=s.find(_=>_ instanceof Br),m=o?(u=this.localTrackMap.get($e.LocalVideoTrack))===null||u===void 0?void 0:u.track:s.find(_=>_ instanceof _r);Rt.publish(this.store.sessionId,{eventElapse:Ls.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:t,ec:r,audioName:h==null?void 0:h.getTrackLabel(),videoName:m==null?void 0:m.getTrackLabel(),screenshare:(m==null?void 0:m._hints.indexOf(ar.SCREEN_TRACK))!==-1,audio:!!h,video:!!m,p2pid:this.store.p2pId,publishRequestid:this.store.pubId,extend:c})}}reportSubscribeEvent(t,r,s,o){const c=o===gt.VIDEO?s._videoSSRC:s._audioSSRC;c&&Rt.subscribe(this.store.sessionId,{succ:t,ec:r,video:o===gt.VIDEO,audio:o===gt.AUDIO,peerid:s.uid,subscribeRequestid:c,p2pid:this.store.p2pId,eventElapse:Ls.measureFromSubscribeStart(this.store.clientId,c),preSsrc:this.isPreSubScribe(c)})}reset(){L.debug("[".concat(this.store.clientId,"] P2PChannel.reset")),this.mutex=new ks("P2PChannel-mutex",this.store.clientId),this.connection&&(this.resetConnection(this.connection),this.connection=void 0),this.shouldForwardP2PCreation&&(this.connection=AP(this.store),this.emit(kt.PeerConnectionStateChange,this.connection.peerConnectionState),this.bindConnectionEvents(this.connection)),this.statsUploader.stopUploadOutboundStats(),this.statsUploader.stopUploadInboundStats(),this.statsUploader.stopUploadTransportStats(),this.statsUploader.stopUploadExtensionUsageStats(),this.statsUploader.stopUploadBaseStats(),this.unbindLocalTrackEvents(),this.unbindAllRemoteTrackEvents(),this.unbindRtpTransceiver();const t=this.localTrackMap.get($e.LocalAudioTrack);if((t==null?void 0:t.track)instanceof Ai){if(t.track.trackList.length>0){const r=t.track;t.track.trackList.forEach(s=>{r.removeAudioTrack(s)})}t.track.close()}this.localTrackMap.clear(),this.remoteUserMap.clear(),this.statsCollector.removeRemoteStats(),this.statsCollector.removeLocalStats(),this.iceFailedCount=0,this.dtlsFailedCount=0,this.pendingLocalTracks=[],this.pendingRemoteTracks=[],this.localDataChannels=[],this.remoteDataChannelMap.clear(),this.pendingLocalDataChannels=[],this.pendingRemoteDataChannels=[],this.state=Wn.Disconnected}getStats(){var t;return(t=this.connection)===null||t===void 0?void 0:t.getStats()}getRemoteVideoIsReady(t){var r;return((r=this.connection)===null||r===void 0?void 0:r.getRemoteVideoIsReady(t))||!1}getLocalAudioVolume(){const t=this.localTrackMap.get($e.LocalAudioTrack);if(t)return t.track.getVolumeLevel()}getLocalVideoSize(){const t=this.localTrackMap.get($e.LocalVideoTrack);if(t)return{width:t.track.videoWidth||0,height:t.track.videoHeight||0}}getEncoderConfig(t){const r=this.localTrackMap.get(t);return r&&r.track instanceof _r||r&&r.track instanceof Br?r.track._encoderConfig:void 0}getLocalMedia(t){return this.localTrackMap.get(t)}hasLocalMedia(){return this.localTrackMap.size>0}hasRemoteMedia(t,r){if(!t)return this.remoteUserMap.size>0;const s=this.remoteUserMap.get(t);return!!s&&(!r||s.has(r))}async hasRemoteMediaWithLock(t,r){if(!t)return this.remoteUserMap.size>0;const s=this.remoteUserMap.get(t);return!!s&&(!r||s.has(r))}getRemoteMedia(t){var r;const s=Array.from(Lc(r=this.remoteUserMap).call(r)).find(o=>o.uid===t);return s?{audioTrack:s.audioTrack,audioSSRC:s._audioSSRC,videoTrack:s.videoTrack,videoSSRC:s._videoSSRC}:{}}getAudioLevels(){let t=Array.from(this.remoteUserMap.entries()).map(s=>{let[o]=s;return{uid:o.uid,level:o.audioTrack?100*o.audioTrack._source.getAccurateVolumeLevel():0}});const r=this.localTrackMap.get($e.LocalAudioTrack);return r&&t.push({level:100*r.track._source.getAccurateVolumeLevel(),uid:this.store.uid}),t=eT(t).call(t,(s,o)=>s.level-o.level),t}async disconnectForReconnect(){this.connection&&(L.debug("[".concat(this.store.clientId,"] P2PChannel.disconnectForReconnect closing P2PConnection")),this.state=Wn.Reconnecting,re("KEEP_LAST_FRAME")&&this.remoteUserMap.size!==0&&Array.from(this.remoteUserMap.entries()).forEach(t=>{let[r]=t;var s;r._videoTrack&&r._videoTrack._player&&((s=r._videoTrack._player.getVideoElement())===null||s===void 0||s.pause(),r._videoTrack._player.isKeepLastFrame=!0,r._videoTrack._originMediaStreamTrack.stop())}),this.resetConnection(this.connection),this.connection=void 0,this.shouldForwardP2PCreation&&(this.connection=AP(this.store),this.emit(kt.PeerConnectionStateChange,this.connection.peerConnectionState),this.bindConnectionEvents(this.connection)),this.localTrackMap.size!==0&&(Array.from(this.localTrackMap.entries()).forEach(t=>{var r;let[s,{track:o}]=t;switch(s){case $e.LocalVideoTrack:ot(r=o._hints).call(r,ar.LOW_STREAM)?o.close():this.pendingLocalTracks.push(o);break;case $e.LocalAudioTrack:o instanceof Ai?this.pendingLocalTracks=this.pendingLocalTracks.concat(o.trackList):this.pendingLocalTracks.push(o);case $e.LocalVideoLowTrack:}}),this.emit(kt.MediaReconnectStart,this.store.uid)),this.unbindLocalTrackEvents(),this.localTrackMap.clear(),this.remoteUserMap.size!==0&&Array.from(this.remoteUserMap.entries()).forEach(t=>{let[r,s]=t;Array.from(Lc(s).call(s)).forEach(o=>{this.setPendingRemoteMedia(r,o)}),this.emit(kt.MediaReconnectStart,r.uid)}),this.unbindAllRemoteTrackEvents(),this.remoteUserMap.clear(),this.localDataChannels.length!==0&&(this.localDataChannels.forEach(t=>{this.pendingLocalDataChannels.push(t)}),this.localDataChannels.length=0),this.remoteDataChannelMap.size!==0&&(Array.from(this.remoteDataChannelMap.entries()).forEach(t=>{let[r,s]=t;Array.from(Lc(s).call(s)).forEach(o=>{this.setPendingRemoteDataChannel(r,o)})}),this.remoteDataChannelMap.clear()),this.statsUploader.stopUploadOutboundStats(),this.statsUploader.stopUploadInboundStats(),this.statsUploader.stopUploadTransportStats(),L.debug("[".concat(this.store.clientId,"] P2PChannel disconnected, waiting to reconnect.")))}hasPendingRemoteDataChannel(t,r){for(const s of this.pendingRemoteDataChannels){const{user:o,id:c}=s;if((t instanceof Mm?t.uid:t)===o.uid&&c===r)return!0}return!1}setPendingRemoteDataChannel(t,r){this.hasPendingRemoteDataChannel(t,r)||this.pendingRemoteDataChannels.push({user:t,id:r})}hasPendingRemoteMedia(t,r){for(const s of this.pendingRemoteTracks){const{user:o,kind:c}=s;if((t instanceof Mm?t.uid:t)===o.uid&&r===c)return!0}return!1}setPendingRemoteMedia(t,r){this.hasPendingRemoteMedia(t,r)||this.pendingRemoteTracks.push({user:t,kind:r})}restartICE(t){var r=this;return _l(function*(){if(!r.connection||r.state!==Wn.Connected)return;const s=yield wn(r.mutex.lock("From P2PChannel.restartICE"));let o;try{o=yield wn(r.connection.restartICE(t));const u=yield wn(o.next());if(u.done)return;const h=u.value,m=yield h;switch(iM(r.connection)&&r.reportPCStats(Date.now(),!1,r._pcStatsUploadType),t){case Ds.UDP_TCP_RELAY:r._pcStatsUploadType=ep.UDP_TCP_RESTART;break;case Ds.TCP_RELAY:r._pcStatsUploadType=ep.TCP_RESTART;break;case Ds.RELAY:r._pcStatsUploadType=ep.RELAY_RESTART;break;default:r._pcStatsUploadType=ep.OLD_RESTART}r._isTryConnecting=!0,o.next(m)}catch(u){var c;(c=o)===null||c===void 0||c.throw(u)}finally{s()}})()}getUplinkNetworkQuality(){if(!this.connection)return 0;const t=this.connection.getStats(),r=this.localTrackMap.get($e.LocalVideoTrack),s=this.localTrackMap.get($e.LocalAudioTrack),o=t.videoSend.find(k=>k.ssrc===(r==null?void 0:r.ssrcs[0].ssrcId)),c=t.audioSend.find(k=>k.ssrc===(s==null?void 0:s.ssrcs[0].ssrcId));if(!o||!c)return 1;const u=Nc(this,kt.NeedSignalRTT),h=o?o.rttMs:void 0,m=c?c.rttMs:void 0,_=h&&m?(h+m)/2:h||m,E=(_&&u?(_+u)/2:_||u)||0,S=100*t.sendPacketLossRate*.7/50+.3*E/1500,R=S<.17?1:S<.36?2:S<.59?3:S<.1?4:5,P=r==null?void 0:r.track;if(P&&P._encoderConfig&&P._hints.indexOf(ar.SCREEN_TRACK)===-1){const k=P._encoderConfig.bitrateMax,z=t.bitrate.actualEncoded;if(k&&z){const U=(1e3*k-z)/(1e3*k);return MG[U<.15?0:U<.3?1:U<.45?2:U<.6?3:4][R]}}return R}getDownlinkNetworkQuality(){if(!this.connection)return 0;const t=this.connection.getStats();let r=0;return Array.from(this.remoteUserMap.entries()).forEach(s=>{let[o]=s;const c=o._audioSSRC,u=o._videoSSRC,h=t.audioRecv.find(z=>z.ssrc===c),m=t.videoRecv.find(z=>z.ssrc===u);if(!h&&!m)return void(r+=1);const _=Nc(this,kt.NeedSignalRTT),E=t.rtt,S=(E&&_?(E+_)/2:E||_)||0,R=h?h.jitterMs:void 0,P=t.recvPacketLossRate;let k=.7*P*100/50+.3*S/1500;R&&(k=.6*P*100/50+.2*S/1500+.2*R/400),r+=k<.1?1:k<.17?2:k<.36?3:k<.59?4:5}),this.remoteUserMap.size>0?Math.round(r/this.remoteUserMap.size):r}async muteLocalTrack(t){return new lt((r,s)=>{this.handleMuteLocalTrack(t,r,s)})}async replaceTrack(t,r){var s;if(L.debug("[".concat(this.store.clientId,"] P2PChannel replaceTrack from [").concat(t.getTrackId(),"] to [").concat(r.getTrackId(),"]")),!this.connection||this.state!==Wn.Connected)return;const o=Array.from(this.localTrackMap.entries()).find(u=>{let[,{track:h}]=u;return t===h});if(!o)return;const c=o[0];if(t!==r&&(this.unbindLocalTrackEvents([{track:t,type:c}]),this.bindLocalTrackEvents([{track:r,type:c}]),o[1].track=r),await((s=this.connection)===null||s===void 0?void 0:s.replaceTrack(r,o[1].id)),this.isPlanB){const u=o[1];u.id=r._mediaStreamTrack.id,this.localTrackMap.set(c,u)}if(c===$e.LocalVideoTrack&&!re("DISABLE_DUAL_STREAM_USE_ENCODING")&&kn().supportDualStreamEncoding){const u=this.localTrackMap.get($e.LocalVideoLowTrack);if(u){const h=t._mediaStreamTrack.clone();u.track._originMediaStreamTrack.stop(),u.track._mediaStreamTrack=h,u.track._originMediaStreamTrack=h,await new lt((m,_)=>{this.handleReplaceTrack(u.track,m,_,!0)})}}}filterTobePublishedTracks(t,r,s){const o=[],c=this.getAllTracks();t=kv(t=t.filter(_=>c.indexOf(_)===-1));let u,h=!1;const m=this.localTrackMap.get($e.LocalAudioTrack);for(const _ of t){if(_ instanceof _r&&(this.localTrackMap.has($e.LocalVideoTrack)||h?new Le(X.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS).throw():(o.push({track:_,type:$e.LocalVideoTrack}),h=!0),r)){const E=this.getLowVideoTrack(_,s);o.push({track:E,type:$e.LocalVideoLowTrack})}if(_ instanceof Br)if(m){const E=m.track;if(E instanceof Ai)nM([_]),E.addAudioTrack(_),this.bindLocalAudioTrackEvents(_,!0);else{const S=rM([E,_]);L.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection will replace audioTrack [").concat(S.getTrackId(),"]")),this.replaceTrack(E,S)}}else u instanceof Ai?(nM([_]),u.addAudioTrack(_)):u||!_._useAudioElement&&kn().webAudioMediaStreamDest&&!_._bypassWebAudio?u=rM(u?[_,u]:[_]):u=_}return u&&(L.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection will send audioTrack [").concat(u.getTrackId(),"]")),o.push({track:u,type:$e.LocalAudioTrack})),o}filterTobeUnpublishedTracks(t){const r=[],s=this.getAllTracks();t=kv(t=t.filter(o=>s.indexOf(o)!==-1));for(const o of t){if(o instanceof Br){const c=this.localTrackMap.get($e.LocalAudioTrack);if(!c)continue;c.track instanceof Ai?(c.track.removeAudioTrack(o),this.unbindLocalAudioTrackEvents(o),c.track.trackList.length===0&&(r.push([$e.LocalAudioTrack,c]),c.track.close())):r.push([$e.LocalAudioTrack,c])}if(o instanceof _r){const c=this.localTrackMap.get($e.LocalVideoTrack);if(!c)continue;r.push([$e.LocalVideoTrack,c]);const u=this.localTrackMap.get($e.LocalVideoLowTrack);u&&r.push([$e.LocalVideoLowTrack,u])}}return r}filterTobePublishedDataChannels(t){return t=(t=kv(t)).filter(r=>this.localDataChannels.findIndex(s=>s.id===r.id)===-1)}filterTobeUnpublishedDataChannels(t){return t=(t=(t=kv(t)).filter(r=>this.localDataChannels.indexOf(r)!==-1)).filter(r=>r._originDataChannel)}bindLocalTrackEvents(t){t.forEach(r=>{let{track:s,type:o}=r;switch(o){case $e.LocalVideoTrack:s.addListener(yt.GET_STATS,this.handleGetLocalVideoStats),s.addListener(yt.GET_RTC_STATS,this.handleGetRTCStats),s.addListener(yt.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),s.addListener(yt.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),s.addListener(yt.NEED_UPDATE_VIDEO_ENCODER,this.handleUpdateVideoEncoder),s.addListener(yt.NEED_UPDATE_VIDEO_SEND_PARAMETERS,this.handleUpdateVideoSendParameters),s.addListener(yt.NEED_REPLACE_TRACK,this.handleReplaceTrack),s.addListener(yt.NEED_MUTE_TRACK,this.handleMuteLocalTrack),s.addListener(yt.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack);break;case $e.LocalAudioTrack:this.bindLocalAudioTrackEvents(s);case $e.LocalVideoLowTrack:}})}bindLocalAudioTrackEvents(t,r){t instanceof Ai?t.trackList.forEach(s=>{s.addListener(yt.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),s.addListener(yt.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),s.addListener(yt.GET_STATS,this.handleGetLocalAudioStats),s.addListener(yt.NEED_MUTE_TRACK,this.handleMuteLocalTrack),s.addListener(yt.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack)}):(t.addListener(yt.GET_STATS,this.handleGetLocalAudioStats),t.addListener(yt.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),t.addListener(yt.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),t.addListener(yt.NEED_MUTE_TRACK,this.handleMuteLocalTrack),t.addListener(yt.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack),r||(t.addListener(yt.NEED_REPLACE_TRACK,this.handleReplaceTrack),t.addListener(yt.NEED_REPLACE_MIXING_TRACK,this.handleReplaceMixingTrack)))}unbindLocalTrackEvents(t){t||(t=Array.from(this.localTrackMap.entries()).map(r=>{let[s,{track:o}]=r;return{track:o,type:s}})),t.forEach(r=>{let{track:s,type:o}=r;switch(o){case $e.LocalVideoTrack:s.off(yt.GET_STATS,this.handleGetLocalVideoStats),s.off(yt.GET_RTC_STATS,this.handleGetRTCStats),s.off(yt.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),s.off(yt.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),s.off(yt.NEED_UPDATE_VIDEO_ENCODER,this.handleUpdateVideoEncoder),s.off(yt.NEED_UPDATE_VIDEO_SEND_PARAMETERS,this.handleUpdateVideoSendParameters),s.off(yt.NEED_REPLACE_TRACK,this.handleReplaceTrack),s.off(yt.NEED_MUTE_TRACK,this.handleMuteLocalTrack),s.off(yt.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack);break;case $e.LocalAudioTrack:this.unbindLocalAudioTrackEvents(s);case $e.LocalVideoLowTrack:}})}unbindLocalAudioTrackEvents(t){t instanceof Ai?t.trackList.forEach(r=>{r.off(yt.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),r.off(yt.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),r.off(yt.GET_STATS,this.handleGetLocalAudioStats),r.off(yt.NEED_MUTE_TRACK,this.handleMuteLocalTrack),r.off(yt.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack)}):(t.off(yt.GET_STATS,this.handleGetLocalAudioStats),t.off(yt.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),t.off(yt.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),t.off(yt.NEED_REPLACE_TRACK,this.handleReplaceTrack),t.off(yt.NEED_REPLACE_MIXING_TRACK,this.handleReplaceMixingTrack),t.off(yt.NEED_MUTE_TRACK,this.handleMuteLocalTrack),t.off(yt.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack))}bindRemoteTrackEvents(t,r){r instanceof Gv&&r.addListener(yt.GET_STATS,s=>{s(this.handleGetRemoteVideoStats(t))}),r instanceof Hv&&r.addListener(yt.GET_STATS,s=>{s(this.handleGetRemoteAudioStats(t))})}unbindRemoteTrackEvents(t){t&&t.removeAllListeners(yt.GET_STATS)}unbindAllRemoteTrackEvents(){Array.from(this.remoteUserMap.entries()).forEach(t=>{let[r,s]=t;s.has(gt.AUDIO)&&this.unbindRemoteTrackEvents(r._audioTrack),s.has(gt.VIDEO)&&this.unbindRemoteTrackEvents(r._videoTrack)})}createGatewayPublishMessage(t,r){return t.map((s,o)=>{var c;let u,h,{track:m,type:_}=s;switch(_){case $e.LocalAudioTrack:u=zn.Audio,h={dtx:m instanceof eP&&m._config.DTX,hq:!1,lq:!1,stereo:!1,speech:!1};break;case $e.LocalVideoTrack:u=ot(c=m._hints).call(c,ar.SCREEN_TRACK)?zn.Screen:zn.High,h=Rh(Rh({},eH(m)),{},{codec:this.store.codec,svc_mode:gP()});break;case $e.LocalVideoLowTrack:u=zn.Low,h=Rh(Rh({},eH(m)),{},{codec:this.store.codec,svc_mode:gP()})}return{stream_type:u,attributes:h,ssrcs:r[o]}})}createGatewayUnpublishMessage(t){return t.map(r=>{var s;let o,[c,{track:u,ssrcs:h,id:m}]=r;switch(c){case $e.LocalVideoTrack:o=ot(s=u._hints).call(s,ar.SCREEN_TRACK)?zn.Screen:zn.High;break;case $e.LocalAudioTrack:o=zn.Audio;break;case $e.LocalVideoLowTrack:o=zn.Low}return{stream_type:o,ssrcs:h,mid:m}})}assignLocalTracks(t,r){t.forEach((s,o)=>{let{track:c,type:u}=s;this.localTrackMap.set(u,{track:c,id:r[o].id,ssrcs:r[o].localSSRC})})}withdrawLocalTracks(t){t.forEach(r=>{let[s]=r;this.localTrackMap.delete(s)})}bindConnectionEvents(t){t.onConnectionStateChange=async r=>{if(L.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onConnectionStateChange(").concat(r,")")),this.emit(kt.PeerConnectionStateChange,r),r==="connecting"&&t instanceof Th&&!Dr()&&re("FIRST_TCP_CANDIDATE")&&window.setTimeout(()=>{r==="connecting"&&t.extendCandidate()},re("FIRST_TCP_CANDIDATE_INTERVAL")),r!=="connected"||this.store.keyMetrics.peerConnectionEnd||this.store.peerConnectionEnd(),r==="connected"&&(this._restartTimer&&(window.clearTimeout(this._restartTimer),this._restartTimer=void 0),t instanceof Th&&ZH(t,!0),this._isTryConnecting&&this.reportPCStats(Date.now(),!0,this._pcStatsUploadType),this._isTryConnecting=!1,this._isStartRestartIce=!1,this._pcStatsUploadType=ep.DISCONNECTED_OR_FAILED,Nc(this,kt.QueryClientConnectionState)==="CONNECTED"&&this._isWaitPcToRePub)){const s=this.pendingLocalTracks.map(c=>c.getTrackId()),o=this.pendingLocalDataChannels.map(c=>"dc_".concat(c.id));Rt.reportApiInvoke(this.store.sessionId,{name:Si.REPUB_AFTER_PC_CONNECTED,options:s.concat(o),tag:xr.TRACER}).onSuccess(),this.republish()}if(re("NEW_ICE_RESTART")&&t instanceof Th&&!Dr()&&!this._forceTurn){if(ot(KG).call(KG,r)){if(this._isStartRestartIce)return;this._isStartRestartIce=!0;const s=c=>{iM(t)&&(L.debug("[".concat(this.store.clientId,"] [P2PChannel] try to restartICE, type is ").concat(c)),Nc(this,kt.QueryClientConnectionState)==="CONNECTED"&&this.emit(kt.RequestRestartICE,c))},o=()=>{iM(t)&&(this.reportPCStats(Date.now(),!1,this._pcStatsUploadType),L.debug("[".concat(this.store.clientId,"] P2PConnection disconnected timeout, force reconnect")),setTimeout(()=>this.emit(kt.P2PLost),0),this.iceFailedCount+=1,this.requestReconnect())};return void(this._restartTimer=window.setTimeout(()=>{e9(t,s,o)},800))}}else{if(r==="disconnected"&&t.iceConnectionState==="disconnected")return setTimeout(()=>{t.iceConnectionState==="disconnected"&&re("ICE_RESTART")&&Nc(this,kt.QueryClientConnectionState)==="CONNECTED"&&this.emit(kt.RequestRestartICE)},800),void setTimeout(()=>{t.peerConnectionState==="disconnected"&&(L.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection disconnected timeout 4000ms, force reconnect")),this.reportPCStats(Date.now(),!1,this._pcStatsUploadType),this._isTryConnecting=!1,setTimeout(()=>this.emit(kt.P2PLost),0),this.iceFailedCount+=1,this.requestReconnect())},4e3);r==="failed"&&(L.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection state failed, force reconnect")),this.reportPCStats(Date.now(),!1,this._pcStatsUploadType),setTimeout(()=>this.emit(kt.P2PLost),0),this.iceFailedCount+=1,await this.requestReconnect())}},t.onICEConnectionStateChange=r=>{r!=="connected"||this.store.keyMetrics.iceConnectionEnd||this.store.iceConnectionEnd(),L.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICEConnectionStateChange(").concat(r,")")),Rt.reportApiInvoke(this.store.sessionId,{name:"ICEConnectionStateChange",options:r,tag:xr.TRACER}).onSuccess(),this.emit(kt.IceConnectionStateChange,r)},t.onICETransportStateChange=r=>{L.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICETransportStateChange(").concat(r,")"))},t.onDTLSTransportStateChange=r=>{L.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onDTLSTransportStateChange(").concat(r,")"))},t.onDTLSTransportError=r=>{L.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onDTLSTransportError(").concat(r,")"))},t.onFirstAudioDecoded=r=>{var s;const o=Array.from(Lc(s=this.remoteUserMap).call(s)).find(u=>u._audioSSRC===r);var c;o&&(this.store.subscribe(o.uid,"audio",void 0,void 0,void 0,Date.now()),(c=o.audioTrack)===null||c===void 0||c.emit(Fv.FIRST_FRAME_DECODED),Rt.firstRemoteFrame(this.store.sessionId,Gi.FIRST_AUDIO_DECODE,Rr.FIRST_AUDIO_DECODE,{peer:o._uintid,subscribeElapse:Ls.measureFromSubscribeStart(this.store.clientId,r),subscribeRequestid:r,p2pid:this.store.p2pId}))},t.onFirstAudioReceived=r=>{var s;const o=Array.from(Lc(s=this.remoteUserMap).call(s)).find(c=>c._audioSSRC===r);o&&Rt.firstRemoteFrame(this.store.sessionId,Gi.FIRST_AUDIO_RECEIVED,Rr.FIRST_AUDIO_RECEIVED,{peer:o._uintid,subscribeElapse:Ls.measureFromSubscribeStart(this.store.clientId,r),subscribeRequestid:r,p2pid:this.store.p2pId})},t.onFirstVideoDecoded=(r,s,o)=>{this.reportVideoFirstFrameDecoded(r,s,o)},t.onFirstVideoReceived=r=>{var s;const o=Array.from(Lc(s=this.remoteUserMap).call(s)).find(c=>c._videoSSRC===r);o&&Rt.firstRemoteFrame(this.store.sessionId,Gi.FIRST_VIDEO_RECEIVED,Rr.FIRST_VIDEO_RECEIVED,{peer:o._uintid,subscribeElapse:Ls.measureFromSubscribeStart(this.store.clientId,r),subscribeRequestid:r,p2pid:this.store.p2pId})},t.onSelectedLocalCandidateChanged=(r,s)=>{const o=r.candidateType==="relay",c=s.candidateType==="relay";s.candidateType!=="unknown"&&o===c||this.emit(kt.ConnectionTypeChange,o),L.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.SelectedLocalCandidateChanged(").concat(JSON.stringify(Dm(s))," -> ").concat(JSON.stringify(Dm(r)),")"))},t.onSelectedRemoteCandidateChanged=(r,s)=>{L.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.SelectedRemoteCandidateChanged(").concat(JSON.stringify(Dm(s))," -> ").concat(JSON.stringify(Dm(r)),")"))},t.onFirstVideoDecodedTimeout=r=>{this.reportVideoFirstFrameDecoded(r,void 0,void 0,!0)},t.getLocalVideoStats=()=>{const r=this.statsCollector.getLocalVideoTrackStats(),s=this.statsCollector.getRTCStats();return Rh(Rh({},r),s)},t.onICECandidateError=r=>{this._iceError=r}}resetConnection(t){t instanceof Th&&function(r){iS.delete(r.id),ZH(r)}(t),t.close(),this.emit(kt.PeerConnectionStateChange,"closed"),function(r){r.onConnectionStateChange=void 0,r.onICEConnectionStateChange=void 0,r.onICETransportStateChange=void 0,r.onDTLSTransportStateChange=void 0,r.onDTLSTransportError=void 0,r.onFirstAudioDecoded=void 0,r.onFirstAudioReceived=void 0,r.onFirstVideoDecoded=void 0,r.onFirstVideoReceived=void 0,r.onSelectedLocalCandidateChanged=void 0,r.onSelectedRemoteCandidateChanged=void 0,r.onFirstVideoDecodedTimeout=void 0,r.getLocalVideoStats=void 0}(t),this._isWaitPcToRePub=!1}filterTobeMutedTracks(t){const r=[];if(this.getAllTracks().indexOf(t)===-1)return r;const s=this.localTrackMap.get($e.LocalAudioTrack);if(t instanceof Br&&(s==null?void 0:s.track)instanceof Ai)return s.track.isActive||r.push([$e.LocalAudioTrack,s]),r;const o=Array.from(this.localTrackMap.entries()).find(c=>{let[,{track:u}]=c;return t===u});if(o&&(r.push(o),o[0]===$e.LocalVideoTrack)){const c=this.localTrackMap.get($e.LocalVideoLowTrack);c&&r.push([$e.LocalVideoLowTrack,c])}return r}filterTobeUnmutedTracks(t){const r=[],s=this.localTrackMap.get($e.LocalAudioTrack);if(t instanceof Br&&(s==null?void 0:s.track)instanceof Ai)return s.track.isActive&&r.push([$e.LocalAudioTrack,s]),r;const o=Array.from(this.localTrackMap.entries()).find(c=>{let[,{track:u}]=c;return t===u});if(o)if(o[0]===$e.LocalVideoTrack){r.push(o);const c=this.localTrackMap.get($e.LocalVideoLowTrack);c&&r.push([$e.LocalVideoLowTrack,c])}else r.push(o);return r}createMuteMessage(t){return t.map(r=>{var s;let o,[c,{track:u,ssrcs:h,id:m}]=r;switch(c){case $e.LocalAudioTrack:o=zn.Audio;break;case $e.LocalVideoTrack:o=ot(s=u._hints).call(s,ar.SCREEN_TRACK)?zn.Screen:zn.High;break;case $e.LocalVideoLowTrack:o=zn.Low}return{stream_type:o,ssrcs:h,mid:m}})}createUnmuteMessage(t){return t.map(r=>{var s;let o,[c,{track:u,ssrcs:h,id:m}]=r;switch(c){case $e.LocalAudioTrack:o=zn.Audio;break;case $e.LocalVideoTrack:o=ot(s=u._hints).call(s,ar.SCREEN_TRACK)?zn.Screen:zn.High;break;case $e.LocalVideoLowTrack:o=zn.Low}return{stream_type:o,ssrcs:h,mid:m}})}filterTobeUnSubscribedTracks(t,r){const s=[],o=this.remoteUserMap.get(t);if(!o)return s;if(r){const c=o.get(r);if(!c)return s;s.push([t,{kind:r,id:c}])}else Array.from(o.entries()).forEach(c=>{let[u,h]=c;s.push([t,{kind:u,id:h}])});return s}filterTobeUnSubscribedDataChannels(t,r){const s=[];return r.forEach(o=>{var c;(c=this.remoteDataChannelMap.get(t))!==null&&c!==void 0&&c.has(o.id)&&s.push(o)}),s}createUnsubscribeMessage(t){const r=[];return t.forEach(s=>{let[o,{kind:c,id:u}]=s;switch(c){case gt.VIDEO:return void(o._videoSSRC&&r.push({stream_type:gt.VIDEO,ssrcId:o._videoSSRC}));case gt.AUDIO:return void(o._audioSSRC&&r.push({stream_type:gt.AUDIO,ssrcId:o._audioSSRC}))}}),r}createUnsubscribeAllMessage(t){const r=new Map;return t.forEach(s=>{let[o,{kind:c}]=s;if(r.has(o)){let u=r.get(o);c===gt.VIDEO?u|=Hi.Video:u|=Hi.Audio,r.set(o,u)}else c===gt.VIDEO?r.set(o,Hi.Video):r.set(o,Hi.Audio)}),{users:Array.from(r.entries()).map(s=>{let[o,c]=s;return{stream_id:o.uid,stream_type:c}})}}withdrawRemoteTracks(t){t.forEach(r=>{let[s,{kind:o}]=r;const c=this.remoteUserMap.get(s);c&&(c.delete(o),Array.from(c.entries()).length===0&&this.remoteUserMap.delete(s))})}async updateBitrateLimit(t){const r=this.localTrackMap.get($e.LocalVideoTrack),s=this.localTrackMap.get($e.LocalVideoLowTrack);r&&(await r.track.setBitrateLimit(t.uplink),await new lt((o,c)=>{this.handleUpdateVideoEncoder(r.track,o,c,!0)})),s&&t.low_stream_uplink&&(await s.track.setBitrateLimit({max_bitrate:t.low_stream_uplink.bitrate,min_bitrate:t.low_stream_uplink.bitrate||0}),await new lt((o,c)=>{this.handleUpdateVideoEncoder(s.track,o,c,!0)}))}isP2PDisconnected(){return this.connection?this.connection.peerConnectionState!=="connected":!0}mapPubResToRemoteConfig(t,r,s){return t.map((o,c)=>{var u;let{stream_type:h}=o;const m=(u=r.find(_=>{let{stream_type:E}=_;return h===E}))===null||u===void 0?void 0:u.attributes;if(m&&re("DISABLE_SCREEN_SHARE_REMB")){const _=s[c]._hints;(ot(_).call(_,ar.SCREEN_TRACK)||ot(_).call(_,ar.SCREEN_LOW_TRACK))&&(m.remb=!1,L.debug("disable remb for screen share, hints:",_))}return m})}async tryToUnmuteAudio(t){for(let s=0;s<t.length;s++)if(t[s]instanceof Br){var r;const o=this.filterTobeUnmutedTracks(t[s]);if(o.length===0)continue;await((r=this.connection)===null||r===void 0?void 0:r.unmuteLocal(o.map(u=>{let[,{id:h}]=u;return h})));const c=this.createUnmuteMessage(o);return void await sr(this,kt.RequestUnmuteLocal,c)}}bindStatsUploaderEvents(){this.statsUploader.requestStats=()=>this.getStats(),this.statsUploader.requestLocalMedia=()=>Array.from(this.localTrackMap.entries()),this.statsUploader.requestRemoteMedia=()=>Array.from(this.remoteUserMap.entries()),this.statsUploader.requestVideoIsReady=t=>{var r;return!((r=this.connection)===null||r===void 0||!r.getRemoteVideoIsReady(t))},this.statsUploader.requestUpload=(t,r)=>this.emit(kt.RequestUpload,t,r),this.statsUploader.requestUploadStats=t=>this.emit(kt.RequestUploadStats,t),this.statsUploader.requestAllTracks=()=>this.getAllTracks(),this.statsUploader.requestTransportStats=()=>{var t;return{connectState:((t=this.connection)===null||t===void 0?void 0:t.peerConnectionState)||"closed"}}}unbindStatsUploaderEvents(){this.statsUploader.requestStats=void 0,this.statsUploader.requestLocalMedia=void 0,this.statsUploader.requestRemoteMedia=void 0,this.statsUploader.requestVideoIsReady=void 0}async requestReconnect(){this.dtlsFailedCount+=1,await os(XL(this.dtlsFailedCount,bi)),this.emit(kt.RequestReconnect)}async reconnectP2P(){const t=Array.from(this.localTrackMap.entries()),r=this.createGatewayUnpublishMessage(t);Array.from(this.remoteUserMap.entries()),r.length>0&&await Ts(this,kt.RequestUnpublishForReconnectPC,r),this.disconnectForReconnect(),this.emit(kt.RequestReconnectPC)}canPublishLowStream(){return this.localTrackMap.has($e.LocalVideoTrack)||this.pendingLocalTracks.some(t=>t instanceof _r)}throwIfTrackTypeNotMatch(t){if(t.filter(r=>r instanceof _r).length>1)throw new Le(X.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS);if(t.filter(r=>r instanceof Br).length>1&&(t.some(r=>r instanceof Br&&r._bypassWebAudio)||!kn().webAudioMediaStreamDest))throw new Le(X.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser doesn't support MediaStreamDestNode");for(const r of t){if(r instanceof _r&&this.pendingLocalTracks.some(s=>s instanceof _r))throw new Le(X.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS);if(r instanceof Br&&this.pendingLocalTracks.some(s=>s instanceof Br)&&(!kn().webAudioMediaStreamDest||r._bypassWebAudio||this.pendingLocalTracks.some(s=>s instanceof Br&&s._bypassWebAudio)))throw new Le(X.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser doesn't support MediaStreamDestNode")}}getLowVideoTrack(t,r){var s;const o=!re("DISABLE_DUAL_STREAM_USE_ENCODING")&&kn().supportDualStreamEncoding,c=Rh(Rh({},{width:160,height:120,framerate:15,bitrate:50}),r);let u;u=o?t._mediaStreamTrack.clone():sM(t,c);const h=or(8,"track-low-"),m=new _r(u,Rh(Rh({},o&&{scaleResolutionDownBy:Bx(c,t)}),{},{frameRate:c.framerate,bitrateMax:c.bitrate,bitrateMin:c.bitrate}),void 0,void 0,h);return m.on(M_.TRANSCEIVER_UPDATED,_=>{t._updateRtpTransceiver(_,Uv.LOW_STREAM)}),m._hints.push(ar.LOW_STREAM),ot(s=t._hints).call(s,ar.SCREEN_TRACK)&&m._hints.push(ar.SCREEN_LOW_TRACK),t.on("sei-to-send",_=>{m.emit("sei-to-send",_)}),t.addListener(yt.NEED_CLOSE,()=>{m.close()}),m}async globalLock(){return this.mutex.lock("From P2PChannel.globalLock")}async reportPCStats(t,r,s){let o=arguments.length>3&&arguments[3]!==void 0?arguments[3]:null;if(this.connection&&this.connection instanceof Th){var c,u,h,m;const _=this.store.keyMetrics.descriptionStart||0,{iceConnectionState:E,dtlsTransportState:S,peerConnectionState:R}=this.connection,{local:P,remote:k}=await this.connection.getSelectedCandidatePair();Rt.pcStats(this.store.sessionId,{startTime:_,eventElapse:t-_||0,iceconnectionsate:E,dtlsstate:S,connectionstate:R,intSucc:r?1:2,error:this._iceError||o||"",selectedLocalCandidateProtocol:(c=P==null?void 0:P.protocol)!==null&&c!==void 0?c:"",selectedLocalCandidateType:(u=P.candidateType)!==null&&u!==void 0?u:"",selectedLocalCandidateAddress:"".concat(P.address,":").concat(P.port),selectedRemoteCandidateProtocol:(h=k.protocol)!==null&&h!==void 0?h:"",selectedRemoteCandidateType:(m=k.candidateType)!==null&&m!==void 0?m:"",selectedRemoteCandidateAddress:"".concat(k.address,":").concat(k.port),restartCnt:s,preallocation:this.connection.isPreallocation}),this._iceError=null}}reportVideoFirstFrameDecoded(t,r,s,o){var c;const u=Array.from(Lc(c=this.remoteUserMap).call(c)).find(h=>h._videoSSRC===t);if(u){o||this.store.subscribe(u.uid,"video",void 0,void 0,void 0,void 0,Date.now());const h=this.store.keyMetrics,m=h.subscribe.find(_=>_.userId===u.uid&&_.type==="video");Rt.firstRemoteVideoDecode(this.store.sessionId,Gi.FIRST_VIDEO_DECODE,Rr.FIRST_VIDEO_DECODE,{peer:u._uintid,videowidth:r,videoheight:s,subscribeElapse:Ls.measureFromSubscribeStart(this.store.clientId,t),subscribeRequestid:t,p2pid:this.store.p2pId,apEnd:h.requestAPEnd||0,apStart:h.requestAPStart||0,joinGwEnd:h.joinGatewayEnd||0,joinGwStart:h.joinGatewayStart||0,pcEnd:h.peerConnectionEnd||0,pcStart:h.peerConnectionStart||0,subscriberEnd:(m==null?void 0:m.subscribeEnd)||0,subscriberStart:(m==null?void 0:m.subscribeStart)||0,videoAddNotify:(m==null?void 0:m.streamAdded)||0,state:o?1:0,firstFrame:(m==null?void 0:m.firstFrame)||0})}}async remoteMediaSsrcChanged(t,r,s){if(!this.connection)return!1;const o=this.remoteUserMap.get(t);if(!o)return!1;const c=o.get(r);if(!c)return!1;const u=await this.connection.getRemoteSSRC(c);return u!==void 0&&u!==s}unbindRtpTransceiver(){this.localTrackMap.size!==0&&Array.from(this.localTrackMap.entries()).forEach(t=>{let[r,{track:s}]=t;r===$e.LocalVideoLowTrack?s._updateRtpTransceiver(void 0,Uv.LOW_STREAM):s._updateRtpTransceiver(void 0)})}},vt(dn.prototype,"startP2PConnection",[ro],Object.getOwnPropertyDescriptor(dn.prototype,"startP2PConnection"),dn.prototype),vt(dn.prototype,"connect",[ro],Object.getOwnPropertyDescriptor(dn.prototype,"connect"),dn.prototype),vt(dn.prototype,"updateRemoteRTPCapabilities",[ro],Object.getOwnPropertyDescriptor(dn.prototype,"updateRemoteRTPCapabilities"),dn.prototype),vt(dn.prototype,"publishDataChannel",[ro],Object.getOwnPropertyDescriptor(dn.prototype,"publishDataChannel"),dn.prototype),vt(dn.prototype,"unpublish",[ro],Object.getOwnPropertyDescriptor(dn.prototype,"unpublish"),dn.prototype),vt(dn.prototype,"unpublishDataChannel",[ro],Object.getOwnPropertyDescriptor(dn.prototype,"unpublishDataChannel"),dn.prototype),vt(dn.prototype,"unpublishLowStream",[ro],Object.getOwnPropertyDescriptor(dn.prototype,"unpublishLowStream"),dn.prototype),vt(dn.prototype,"subscribeDataChannel",[ro],Object.getOwnPropertyDescriptor(dn.prototype,"subscribeDataChannel"),dn.prototype),vt(dn.prototype,"subscribe",[ro],Object.getOwnPropertyDescriptor(dn.prototype,"subscribe"),dn.prototype),vt(dn.prototype,"massSubscribe",[ro],Object.getOwnPropertyDescriptor(dn.prototype,"massSubscribe"),dn.prototype),vt(dn.prototype,"unsubscribe",[ro],Object.getOwnPropertyDescriptor(dn.prototype,"unsubscribe"),dn.prototype),vt(dn.prototype,"unsubscribeDataChannel",[ro],Object.getOwnPropertyDescriptor(dn.prototype,"unsubscribeDataChannel"),dn.prototype),vt(dn.prototype,"massUnsubscribe",[ro],Object.getOwnPropertyDescriptor(dn.prototype,"massUnsubscribe"),dn.prototype),vt(dn.prototype,"muteRemote",[ro],Object.getOwnPropertyDescriptor(dn.prototype,"muteRemote"),dn.prototype),vt(dn.prototype,"unmuteRemote",[ro],Object.getOwnPropertyDescriptor(dn.prototype,"unmuteRemote"),dn.prototype),vt(dn.prototype,"hasRemoteMediaWithLock",[ro],Object.getOwnPropertyDescriptor(dn.prototype,"hasRemoteMediaWithLock"),dn.prototype),vt(dn.prototype,"disconnectForReconnect",[ro],Object.getOwnPropertyDescriptor(dn.prototype,"disconnectForReconnect"),dn.prototype),vt(dn.prototype,"updateBitrateLimit",[ro],Object.getOwnPropertyDescriptor(dn.prototype,"updateBitrateLimit"),dn.prototype),vt(dn.prototype,"remoteMediaSsrcChanged",[ro],Object.getOwnPropertyDescriptor(dn.prototype,"remoteMediaSsrcChanged"),dn.prototype),dn);function ro(t,r,s){const o=t[r];if(typeof o!="function")throw new Error("Cannot use mutex on object property.");return s.value=async function(){const c=this.mutex,u=await c.lock("From P2PChannel.".concat(r));try{for(var h=arguments.length,m=new Array(h),_=0;_<h;_++)m[_]=arguments[_];return await o.apply(this,m)}finally{u()}},s}function r9(t,r){var s=Object.keys(t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);r&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(t,c).enumerable})),s.push.apply(s,o)}return s}function i9(t){for(var r=1;r<arguments.length;r++){var s=arguments[r]!=null?arguments[r]:{};r%2?r9(Object(s),!0).forEach(function(o){$(t,o,s[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(s)):r9(Object(s)).forEach(function(o){Object.defineProperty(t,o,Object.getOwnPropertyDescriptor(s,o))})}return t}const zme=Date.now(),Gme=20,aM=new Map,LP=new Map;async function s9(t){const r=aM.get(t),s=Array.isArray(r)&&r[r.length-1],o=LP.get(t);if(!s)return void(o.isSyncing=!1);const c={uid:s.uid,payload:s.payload};o.firstRecvTs===0&&(o.firstRecvTs=s.recvTs,o.firstSendTs=s.sendTs);const u=s.sendTs-o.firstSendTs,h=u-(Date.now()-o.firstRecvTs);h>0&&(o.firstRecvTs=Date.now()-u);let m=s.mediaDelay+h;m<=0?(r.pop(),o9(s.context,c),m=0):m=Math.min(m,Gme),setTimeout(()=>r.length&&s9(t),m)}function o9(t,r){t.safeEmit(mn.STREAM_MESSAGE,r.uid,r.payload),t.onStreamMessage&&t.onStreamMessage(r)}function Hme(t){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,s=arguments.length>2?arguments[2]:void 0;if(!t.syncWithAudio)return o9(s,{uid:t.uid,payload:t.payload});const o="".concat(s.id,"-").concat(t.uid),c=aM.get(o)||[],u=c.findIndex(E=>t.sendTs>=E.sendTs),h=i9(i9({},t),{},{context:s,mediaDelay:r,recvTs:Date.now()});u===-1?c.push(h):c.splice(u,0,h),aM.set(o,c);let m=!1;var _;LP.has(o)?m=!((_=LP.get(o))===null||_===void 0||!_.isSyncing):LP.set(o,{isSyncing:m,firstRecvTs:0,firstSendTs:0}),m||s9(o)}const $me=Rn().name;function a9(t,r){var s=Object.keys(t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);r&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(t,c).enumerable})),s.push.apply(s,o)}return s}function c9(t){for(var r=1;r<arguments.length;r++){var s=arguments[r]!=null?arguments[r]:{};r%2?a9(Object(s),!0).forEach(function(o){$(t,o,s[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(s)):a9(Object(s)).forEach(function(o){Object.defineProperty(t,o,Object.getOwnPropertyDescriptor(s,o))})}return t}const sS="websdk_ng_cache_parameter",Kme=re("MAX_PRELOAD_ASYNC_LENGTH"),qme=1e4,Y_=new Map,X_=[];let cM=null,lM=0,uM=0;const xP=new Map,Yme=function(t,r){const s=[];let o=0;const c=async()=>{const u=s.shift();u&&await u(),s.length>0&&o<r?c():o--};return async function(){for(var u=arguments.length,h=new Array(u),m=0;m<u;m++)h[m]=arguments[m];return new lt(async(_,E)=>{s.push(async()=>{try{const S=await t(...h);_(S)}catch(S){E(S)}}),o<r&&(o++,c())})}}(l9,Kme),dM=$o.CancelToken.source();async function l9(t,r,s,o,c,u){try{if(!re("ENABLE_PRELOAD"))return;if(!kn().supportWebCrypto)return void Im(()=>{L.warn("Your browser does not support preloading, this feature  be run in a secure environment")},"preload_webcrypto_not_supported");if(!s&&s!==null)throw new Le(X.INVALID_PARAMS,"Invalid token: ".concat(s,". If you don not use token, set it to null"));s&&ss(s,"token",1,2047),ss(t,"appid",1,2047),dP(r),o&&hP(o);const h=L_();L.debug("preload channel ".concat(r,", uid is ").concat(o));const m={appId:t,cname:r,token:s||t,uid:typeof o!="string"?o:null,sid:h,proxyServer:c};let _,E;typeof o=="string"?(m.stringUid=o,[E,_]=await lt.all([kme(o,{sid:h,appId:t},dM.token),kH(c9(c9({},m),{},{token:s||t,uid:0}),dM.token)]),m.uid=E.uid,_.gatewayInfo.uid=m.uid,_.gatewayInfo.res.uid=m.uid):(u&&(m.stringUid=u),_=await kH(m,dM.token));const S={sid:h,appId:t,cname:r,token:s||t,uid:m.stringUid||o,intUid:m.uid||_.gatewayInfo.uid,stringUid:m.stringUid,ts:Date.now(),sua:E,ap:_};await async function(R){let P;try{R.uid&&d9({appId:R.appId,cname:R.cname,token:R.token,uid:R.uid,stringUid:R.stringUid});const k=m9(R),z=await async function(F,q){try{const Y=await window.crypto.subtle.importKey("raw",t8(q),"AES-GCM",!1,["encrypt"]),le=await window.crypto.subtle.encrypt({name:"AES-GCM",iv:new Uint8Array(1)},Y,D_(window.btoa(JSON.stringify(F))));return Am(new Uint8Array(le))}catch{return}}(R,R.token||R.appId);if(!z)return;P=p9(sS);const U=P?JSON.parse(P):[];U.push({[k]:z}),U.length>re("AP_CACHE_NUM")&&U.shift(),MP(sS,JSON.stringify(U))}catch(k){L.warn("Error caching server parameters:",k.message),MP(sS,"")}}(S),lM++}catch(h){throw uM++,function(m){cM||(cM=window.setTimeout(()=>{let E="";xP.forEach((S,R)=>{E+="".concat(R,": ").concat(S," ;")}),Rt.reportApiInvoke(null,{name:Si.PRELOAD,options:{success:lM,failed:uM,err:E}}).onError(m),lM=0,uM=0,xP.clear(),cM=null},qme));const _=xP.get(m.code)||0;xP.set(m.code,_+1)}(h),h}}async function u9(t){try{if(re("AP_REQUEST_DETAIL")||re("ENABLE_ROLE_SELECT_EDGE"))return;const r=d9(t);if(!r||t.cloudProxyServer!=="disabled")return;const s=await async function(o,c){try{const u=await window.crypto.subtle.importKey("raw",t8(c),"AES-GCM",!1,["decrypt"]),h=await window.crypto.subtle.decrypt({name:"AES-GCM",iv:new Uint8Array(1)},u,D_(o));return JSON.parse(window.atob(Am(new Uint8Array(h))))}catch{return}}(r,t.token||t.appId);if(!s||!function(o,c){return o.cname===c.cname&&o.appId===c.appId&&o.token===c.token?c.stringUid?o.stringUid===c.stringUid:typeof c.uid=="number"?o.uid===c.uid:o.uid==c.uid:!1}(s,t))return;if(s&&Date.now()-s.ts<re("AP_CACHE_LIFETIME"))return s}catch(r){L.warn("Error get preloadInfo",r.message)}}function d9(t){let r;try{if(r=p9(sS),!r)return;const s=JSON.parse(r),o=m9(t),c=function(h,m){for(let _=h.length-1;_>=0;_--)if(m(h[_]))return _;return-1}(s,h=>o in h);if(c===-1)return;const u=s.splice(c,1)[0];return MP(sS,JSON.stringify(s)),u[o]}catch(s){L.warn("Error delete preload info: ".concat(r),s.message),MP(sS,"")}}function hM(t){if(t){let r=Y_.get(t);r&&(window.clearTimeout(r),r=null,Y_.delete(t)),ot(X_).call(X_,t)||t.cloudProxyServer!=="disabled"||X_.push(t)}if(Y_.size<re("AP_CACHE_NUM")&&X_.length>0){const r=X_.shift();Y_.set(r,window.setTimeout(async()=>{const{appId:s,cname:o,token:c,stringUid:u,uid:h,proxyServer:m}=r;try{await Yme(s,o,c,h,m,u),Y_.has(r)&&hM(r)}catch(_){L.warn("update preload failed",_.message),h9(r)}},re("AP_UPDATE_INTERVAL")))}}function h9(t){const r=X_.indexOf(t);r!==-1&&X_.splice(r,1);let s=Y_.get(t);s&&(window.clearTimeout(s),s=null,Y_.delete(t),hM())}function f9(t,r){const s=t.sua,o=t.ap;r&&s&&Rt.reqUserAccount(t.sid,{lts:s.requestTime,elapse:s.elapse,success:!0,serverAddr:s.url,stringUid:r,uid:t.intUid,errorCode:null,extend:s.req}),Rt.reportResourceTiming(t.ap.url,t.sid),Rt.joinWebProxyAP(t.sid,{lts:o.requestTime,elapse:o.elapse,sucess:1,apServerAddr:o.url,turnServerAddrList:o.proxyInfo.addresses.map(c=>c.ip).join(","),eventType:"disabled",unilbsServerIds:[li.CHOOSE_SERVER,li.CLOUD_PROXY_FALLBACK].toString()}),Rt.joinChooseServer(t.sid,{lts:o.requestTime,elapse:o.elapse,succ:!0,csAddr:o.url,opid:o.opid,serverList:o.gatewayInfo.gatewayAddrs.map(c=>c.address),ec:null,cid:o.gatewayInfo.cid.toString(),uid:o.gatewayInfo.uid.toString(),csIp:o.gatewayInfo.csIp,unilbsServerIds:[li.CHOOSE_SERVER].toString(),isHttp3:o.isHttp3})}function p9(t){return window.atob(window.localStorage.getItem(t)||"")}function MP(t,r){window.localStorage.setItem(t,window.btoa(r))}function m9(t){let r="".concat(t.appId,"_").concat(t.cname);return typeof t.uid=="string"&&(r+="_s_".concat(t.uid)),typeof t.uid=="number"&&(r+="_".concat(t.uid)),t.token&&(r+="_".concat(t.token)),c8(r)}function Xme(t){let r=function(){const s=Zme.pop();return s?(s.offset=s.limit=0,s):{bytes:new Uint8Array(64),offset:0,limit:0}}();return function(s,o){let c=s.appId;c!==void 0&&(hi(o,10),Vm(o,c));let u=s.cid;u!==void 0&&(hi(o,16),hi(o,u));let h=s.cname;h!==void 0&&(hi(o,26),Vm(o,h));let m=s.deviceId;m!==void 0&&(hi(o,34),Vm(o,m));let _=s.elapse;_!==void 0&&(hi(o,40),Fm(o,_));let E=s.fileSize;E!==void 0&&(hi(o,48),Fm(o,oS(E)));let S=s.height;S!==void 0&&(hi(o,56),Fm(o,oS(S)));let R=s.jpg;R!==void 0&&(hi(o,66),hi(o,R.length),_9(o,R));let P=s.networkType;P!==void 0&&(hi(o,72),Fm(o,oS(P)));let k=s.osType;k!==void 0&&(hi(o,80),Fm(o,oS(k)));let z=s.requestId;z!==void 0&&(hi(o,90),Vm(o,z));let U=s.sdkVersion;U!==void 0&&(hi(o,98),Vm(o,U));let F=s.sequence;F!==void 0&&(hi(o,104),Fm(o,oS(F)));let q=s.sid;q!==void 0&&(hi(o,114),Vm(o,q));let Y=s.timestamp;Y!==void 0&&(hi(o,120),Fm(o,Y));let le=s.uid;le!==void 0&&(hi(o,128),hi(o,le));let ye=s.vid;ye!==void 0&&(hi(o,136),hi(o,ye));let Ee=s.width;Ee!==void 0&&(hi(o,144),Fm(o,oS(Ee)));let me=s.service;me!==void 0&&(hi(o,152),hi(o,me));let ke=s.callbackData;ke!==void 0&&(hi(o,162),hi(o,ke.length),_9(o,ke));let Ye=s.ticket;Ye!==void 0&&(hi(o,170),Vm(o,Ye));let ut=s.vendorConfigs;ut!==void 0&&(hi(o,178),Vm(o,ut))}(t,r),function(s){let o=s.bytes,c=s.limit;return o.length===c?o:o.subarray(0,c)}(r)}function Jme(t){return function(s){let o={};e:for(;!ege(s);){let c=UT(s);switch(c>>>3){case 0:break e;case 1:o.code=UT(s);break;case 2:o.msg=y9(s,UT(s));break;case 3:o.requestId=y9(s,UT(s));break;case 4:o.timestamp=tge(s,!1);break;default:Qme(s,7&c)}}return o}({bytes:r=t,offset:0,limit:r.length});var r}function Qme(t,r){switch(r){case 0:for(;128&gu(t););break;case 2:fM(t,UT(t));break;case 5:fM(t,4);break;case 1:fM(t,8);break;default:throw new Error("Unimplemented type: "+r)}}function oS(t){return{low:t|=0,high:t>>31,unsigned:t>=0}}let Zme=[];function fM(t,r){if(t.offset+r>t.limit)throw new Error("Skip past limit");t.offset+=r}function ege(t){return t.offset>=t.limit}function UP(t,r){let s=t.bytes,o=t.offset,c=t.limit,u=o+r;if(u>s.length){let h=new Uint8Array(2*u);h.set(s),t.bytes=h}return t.offset=u,u>c&&(t.limit=u),o}function g9(t,r){let s=t.offset;if(s+r>t.limit)throw new Error("Read past limit");return t.offset+=r,s}function _9(t,r){let s=UP(t,r.length);t.bytes.set(r,s)}function y9(t,r){let s=g9(t,r),o=String.fromCharCode,c=t.bytes,u="",h="";for(let m=0;m<r;m++){let _,E,S,R,P=c[m+s];(128&P)==0?h+=o(P):(224&P)==192?m+1>=r?h+=u:(_=c[m+s+1],(192&_)!=128?h+=u:(R=(31&P)<<6|63&_,R<128?h+=u:(h+=o(R),m++))):(240&P)==224?m+2>=r?h+=u:(_=c[m+s+1],E=c[m+s+2],(49344&(_|E<<8))!=32896?h+=u:(R=(15&P)<<12|(63&_)<<6|63&E,R<2048||R>=55296&&R<=57343?h+=u:(h+=o(R),m+=2))):(248&P)==240?m+3>=r?h+=u:(_=c[m+s+1],E=c[m+s+2],S=c[m+s+3],(12632256&(_|E<<8|S<<16))!=8421504?h+=u:(R=(7&P)<<18|(63&_)<<12|(63&E)<<6|63&S,R<65536||R>1114111?h+=u:(R-=65536,h+=o(55296+(R>>10),56320+(1023&R)),m+=3))):h+=u}return h}function Vm(t,r){let s=r.length,o=0;for(let h=0;h<s;h++){let m=r.charCodeAt(h);m>=55296&&m<=56319&&h+1<s&&(m=(m<<10)+r.charCodeAt(++h)-56613888),o+=m<128?1:m<2048?2:m<65536?3:4}hi(t,o);let c=UP(t,o),u=t.bytes;for(let h=0;h<s;h++){let m=r.charCodeAt(h);m>=55296&&m<=56319&&h+1<s&&(m=(m<<10)+r.charCodeAt(++h)-56613888),m<128?u[c++]=m:(m<2048?u[c++]=m>>6&31|192:(m<65536?u[c++]=m>>12&15|224:(u[c++]=m>>18&7|240,u[c++]=m>>12&63|128),u[c++]=m>>6&63|128),u[c++]=63&m|128)}}function gu(t){return t.bytes[g9(t,1)]}function E9(t,r){let s=UP(t,1);t.bytes[s]=r}function UT(t){let r,s=0,o=0;do r=gu(t),s<32&&(o|=(127&r)<<s),s+=7;while(128&r);return o}function hi(t,r){for(r>>>=0;r>=128;)E9(t,127&r|128),r>>>=7;E9(t,r)}function tge(t,r){let s,o=0,c=0,u=0;return s=gu(t),o=127&s,128&s&&(s=gu(t),o|=(127&s)<<7,128&s&&(s=gu(t),o|=(127&s)<<14,128&s&&(s=gu(t),o|=(127&s)<<21,128&s&&(s=gu(t),c=127&s,128&s&&(s=gu(t),c|=(127&s)<<7,128&s&&(s=gu(t),c|=(127&s)<<14,128&s&&(s=gu(t),c|=(127&s)<<21,128&s&&(s=gu(t),u=127&s,128&s&&(s=gu(t),u|=(127&s)<<7))))))))),{low:o|c<<28,high:c>>>4|u<<24,unsigned:r}}function Fm(t,r){let s=r.low>>>0,o=(r.low>>>28|r.high<<4)>>>0,c=r.high>>>24,u=c===0?o===0?s<16384?s<128?1:2:s<1<<21?3:4:o<16384?o<128?5:6:o<1<<21?7:8:c<128?9:10,h=UP(t,u),m=t.bytes;switch(u){case 10:m[h+9]=c>>>7&1;case 9:m[h+8]=u!==9?128|c:127&c;case 8:m[h+7]=u!==8?o>>>21|128:o>>>21&127;case 7:m[h+6]=u!==7?o>>>14|128:o>>>14&127;case 6:m[h+5]=u!==6?o>>>7|128:o>>>7&127;case 5:m[h+4]=u!==5?128|o:127&o;case 4:m[h+3]=u!==4?s>>>21|128:s>>>21&127;case 3:m[h+2]=u!==3?s>>>14|128:s>>>14&127;case 2:m[h+1]=u!==2?s>>>7|128:s>>>7&127;case 1:m[h]=u!==1?128|s:127&s}}const v9={},S9={},VP=4294967296,nge=VP*VP,rge=nge/2;T9(0,!0);const b9=T9(0),ige=VT(0,-2147483648,!1),sge=VT(-1,2147483647,!1);function T9(t,r){let s,o,c;return r?(c=0<=(t>>>=0)&&t<256)&&(o=S9[t],o)?o:(s=VT(t,0,!0),c&&(S9[t]=s),s):(c=-128<=(t|=0)&&t<128)&&(o=v9[t],o)?o:(s=VT(t,t<0?-1:0,!1),c&&(v9[t]=s),s)}function VT(t,r,s){return{low:0|t,high:0|r,unsigned:!!s}}function w9(t,r){if(isNaN(t))return b9;{if(t<=-9223372036854776e3)return ige;if(t+1>=rge)return sge}return t<0?b9:VT(t%VP|0,t/VP|0,r)}function R9(t,r){var s=Object.keys(t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);r&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(t,c).enumerable})),s.push.apply(s,o)}return s}class pM extends Pr{get connectionState(){return this._connectionState}set connectionState(r){if(this._connectionState===r)return;const s=this._connectionState;this._connectionState=r,this.emit(yd.CONNECTION_STATE_CHANGE,r,s)}get quality(){return this._quality}set quality(r){this._quality=r>1?1:r<.1?.1:r,this._qualityTimer&&(window.clearTimeout(this._qualityTimer),this._qualityTimer=null),this._quality>=1||(this._qualityTimer=window.setTimeout(()=>{this.quality=this._quality/this._qualityRatio},6e4))}constructor(r){var s;super(),$(this,"name","AgoraRTCImageModeration"),$(this,"_connectionState",Sl.CONNECTING),$(this,"_sequence",0),$(this,"_moderationStartTime",void 0),$(this,"_workerConnection",void 0),$(this,"_workerMessageLengthLimit",void 0),$(this,"_qualityRatio",void 0),$(this,"_connectInfo",void 0),$(this,"_cancelTokenSource",$o.CancelToken.source()),$(this,"_retryConfig",void 0),$(this,"_moderationInterval",void 0),$(this,"_moderationTimer",null),$(this,"_moderationMode",1),$(this,"_quality",1),$(this,"_qualityTimer",null),$(this,"_ticket",void 0),$(this,"_moderationIntervalMinimum",void 0),$(this,"_uploadFailedNum",0),$(this,"_uploadNum",0),$(this,"_uploadTimer",null),$(this,"_extraInfo",void 0),$(this,"_vendor",""),$(this,"_encoder",new TextEncoder),$(this,"_moderationId",void 0),$(this,"inspectImage",()=>{if(this.connectionState!==Sl.CONNECTED)throw new Oe(X.OPERATION_ABORTED,"image moderation service connection status is ".concat(this.connectionState));this._moderationTimer&&(window.clearInterval(this._moderationTimer),this._moderationTimer=null),this._moderationTimer=window.setInterval(()=>{this.connectionState===Sl.CONNECTED?this.requestToInspectImage():L.debug("[".concat(this._moderationId,"] Moderation State is not connected , "),this.connectionState)},this._moderationInterval<this._moderationIntervalMinimum?this._moderationIntervalMinimum:this._moderationInterval),this.requestToInspectImage()}),this._moderationId=or(5,"image-moderation-"),this._workerMessageLengthLimit=re("IMAGE_MODERATION_WORKER_MESSAGE_LENGTH_LIMIT"),this._moderationIntervalMinimum=re("IMAGE_MODERATION_INTERVAL_MINIMUM"),this._moderationInterval=(s=r.interval)!==null&&s!==void 0?s:1e3,r.extraInfo&&(this._extraInfo=this._encoder.encode(r.extraInfo)),r.vendor&&(this._vendor=r.vendor),this._qualityRatio=re("IMAGE_MODERATION_QUALITY_RATIO"),this._moderationStartTime=Number(Date.now()),this._workerConnection=new IT("worker-"+this._moderationId,bi),this.on(yd.STATE_CHANGE,(o,c)=>{L.debug("[".concat(this._moderationId,"] Moderation operation :").concat(Yv[o]," ").concat(c||""))}),this.handleWorkerEvents()}async init(r,s){this.emit(yd.STATE_CHANGE,Yv.CONNECT_AP),this._connectInfo=r;const o=this._cancelTokenSource.token;return this._retryConfig=s,new lt((c,u)=>{this.on(yd.CONNECTION_STATE_CHANGE,(h,m)=>{h===Sl.CONNECTED&&c()}),this.requestAP(r,o,s).then(h=>{this.connectWorker(h)}).catch(h=>{u(h)})})}updateConfig(r){var s;this._moderationInterval=(s=r.interval)!==null&&s!==void 0?s:1e3,r.extraInfo&&(this._extraInfo=this._encoder.encode(r.extraInfo)),r.vendor&&(this._vendor=r.vendor),L.debug("[".concat(this._moderationId,"] updateConfig: ").concat(JSON.stringify(r))),this.connectionState===Sl.CONNECTED&&this.inspectImage()}async requestAP(r,s,o){const c=re("WEBCS_DOMAIN").map(_=>"https://".concat(_,"/api/v1")),u=await function(_,E,S,R){let{appId:P,areaCode:k,cname:z,sid:U,token:F,uid:q}=E;tS++;const Y="moderation_plugin",le={service_name:Y,json_body:JSON.stringify({appId:P,areaCode:k,cname:z,command:"allocateEdge",requestId:tS,seq:tS,sid:U,appToken:F,ts:Date.now(),uid:q+""})};let ye,Ee,me=_[0];return pd(async()=>{ye=Date.now();const ke=await Ed(me,{data:le,cancelToken:S,headers:{"X-Packet-Service-Type":"0","X-Packet-URI":"61"},params:{action:"wrtc_gateway"}});if(Ee=Date.now()-ye,ke.code!==0){const pt=new Oe(X.UNEXPECTED_RESPONSE,"moderation plugin ap error, code"+ke.code,{retry:!0,responseTime:Ee});throw L.error(pt.toString()),pt}const Ye=JSON.parse(ke.json_body);if(Ye.code!==200){const pt=new Oe(X.UNEXPECTED_RESPONSE,"moderation plugin ap error, code: ".concat(Ye.code,", reason: ").concat(Ye.reason),{code:Ye.code,responseTime:Ee});throw L.error(pt.toString()),pt}if(!Ye.servers||!Array.isArray(Ye.servers)||Ye.servers.length===0){const pt=new Oe(X.UNEXPECTED_RESPONSE,"moderation plugin ap empty server",{code:Ye.code,responseTime:Ee});throw L.error(pt.toString()),pt}if(!Ye.servers.some(pt=>!!pt.wss)){const pt=new Oe(X.UNEXPECTED_RESPONSE,"moderation plugin ap empty port",{code:Ye.code,responseTime:Ee});throw L.error(pt.toString()),pt}const ut=re("IMAGE_MODERATION_WORKER_HOST");return{addressList:Ye.servers.map(pt=>{let{address:vn,wss:Sn}=pt;if(vn&&Sn)return"wss://".concat(vn.replace(/\./g,"-"),".").concat(ut,":").concat(Sn,"/moderation")}).filter(pt=>!!pt),workerToken:Ye.workerToken,vid:Ye.vid,ticket:Ye.appTicket,responseTime:Ee}},(ke,Ye)=>(Rt.apworkerEvent(U,{success:!0,sc:200,serviceName:Y,responseDetail:JSON.stringify(ke.addressList),firstSuccess:Ye===0,responseTime:Ee,serverIp:_[Ye%_.length]}),!1),(ke,Ye)=>(Rt.apworkerEvent(U,{success:!1,sc:ke.data&&ke.data.code||200,serviceName:Y,responseTime:Ee,serverIp:_[Ye%_.length]}),!!(ke.code!==X.OPERATION_ABORTED&&ke.code!==X.UNEXPECTED_RESPONSE||ke.data&&ke.data.retry)&&(me=_[(Ye+1)%_.length],!0)),R)}(c,r,s,o);this.emit(yd.STATE_CHANGE,Yv.AP_CONNECTED);const{addressList:h,ticket:m}=u;return this._ticket=m,h}async connectWorker(r){this.emit(yd.STATE_CHANGE,Yv.CONNECT_WORKER),await this._workerConnection.init(r,1e4)}handleWorkerEvents(){this._workerConnection.on(Yt.CONNECTED,async()=>{this.emit(yd.STATE_CHANGE,Yv.WORKER_CONNECTED,this._workerConnection.url),this.connectionState=Sl.CONNECTED}),this._workerConnection.on(Yt.CLOSED,()=>{this.connectionState=Sl.CLOSED}),this._workerConnection.on(Yt.FAILED,()=>{this.connectionState=Sl.CLOSED}),this._workerConnection.on(Yt.RECONNECTING,()=>{this.connectionState=this.connectionState===Sl.CONNECTED?Sl.RECONNECTING:Sl.CONNECTING}),this._workerConnection.on(Yt.ON_MESSAGE,async r=>{if(r.data instanceof ArrayBuffer){const s=Jme(new Uint8Array(r.data));re("SHOW_IMAGE_MODERATION_WORKER_MESSAGE")&&L.debug("[".concat(this._moderationId,"] Response message for worker of image moderation "),JSON.stringify(s)),this._uploadNum++,s.code===void 0||s.code===0||(this._uploadFailedNum++,L.error("[".concat(this._moderationId,"] Error response from worke, code is ").concat(s.code,", msg is ").concat(s.msg)),this._uploadTimer||(this._uploadTimer=window.setTimeout(()=>{Rt.reportApiInvoke(this._connectInfo.sid||null,{name:Si.IMAGE_MODERATION_UPLOAD,options:[this._uploadFailedNum,this._uploadNum,s.code],tag:xr.TRACER}).onError(new Oe(X.IMAGE_MODERATION_UPLOAD_FAILED,s.msg)),this._uploadTimer=null},re("IMAGE_MODERATION_UPLOAD_REPORT_INTERVAL"))))}else L.error("[".concat(this._moderationId,"] Unexpected message type from worker"))}),this._workerConnection.on(Yt.WILL_RECONNECT,(r,s,o)=>{r==="recover"&&o(r),o("tryNext")}),this._workerConnection.on(Yt.REQUEST_NEW_URLS,(r,s)=>{this.requestAP(this._connectInfo,this._cancelTokenSource.token,this._retryConfig).then(r).catch(s)})}static intToLong(r){return{low:r|=0,high:r>>31,unsigned:r>=0}}async requestToInspectImage(){const r=Nc(this,yd.CLIENT_LOCAL_VIDEO_TRACK),s={appId:this._connectInfo.appId,cname:this._connectInfo.cname,cid:this._connectInfo.cid,sid:this._connectInfo.sid,uid:this._connectInfo.uid,vid:this._connectInfo.vid};if(r){if(!r.isPlaying)return void(re("SHOW_IMAGE_MODERATION_WORKER_MESSAGE")&&L.debug("Only the track being played can be inspected"));this._sequence++;const o=await this.generateRequestData(r,s);this._workerConnection.sendMessage(o,!0,!0)}else re("SHOW_IMAGE_MODERATION_WORKER_MESSAGE")&&L.debug("Only the track being published can be inspected")}async generateRequestData(r,s){let{appId:o,cname:c,cid:u,vid:h,sid:m,uid:_}=s;const E=Date.now(),S=await r.getCurrentFrameImage("image/jpeg",this.quality),R=await J8(S,o,c),P=this._sequence+"-"+u+"-"+_+"-"+E+"-"+or(12,""),k={appId:o,cid:u,cname:c,deviceId:"",elapse:pM.intToLong(Number(E-this._moderationStartTime)),fileSize:S.buffer.byteLength,height:S.height,width:S.width,jpg:R,networkType:6,osType:7,requestId:P,sdkVersion:"4.23.2",sequence:this._sequence,sid:m,timestamp:w9(E),uid:_,vid:h,service:this._moderationMode,ticket:this._ticket,callbackData:this._extraInfo,vendorConfigs:this._vendor};this._extraInfo===void 0&&delete k.callbackData;const z=Xme(k);if(z.byteLength<this._workerMessageLengthLimit){if(re("SHOW_IMAGE_MODERATION_WORKER_MESSAGE")){const U=function(F){for(var q=1;q<arguments.length;q++){var Y=arguments[q]!=null?arguments[q]:{};q%2?R9(Object(Y),!0).forEach(function(le){$(F,le,Y[le])}):Object.getOwnPropertyDescriptors?Object.defineProperties(F,Object.getOwnPropertyDescriptors(Y)):R9(Object(Y)).forEach(function(le){Object.defineProperty(F,le,Object.getOwnPropertyDescriptor(Y,le))})}return F}({},k);delete U.jpg,L.debug("[".concat(this._moderationId,"] Request message for worker of image moderation service: "),JSON.stringify(U))}return z}{const U=this.quality*this._qualityRatio;return this.quality=U,await this.generateRequestData(r,{appId:o,cname:c,cid:u,vid:h,sid:m,uid:_})}}close(){this._cancelTokenSource.cancel(),this._cancelTokenSource=$o.CancelToken.source(),this._workerConnection&&this._workerConnection.close(),this._moderationTimer&&window.clearInterval(this._moderationTimer),this._moderationTimer=null,this._uploadTimer&&window.clearTimeout(this._uploadTimer),this._uploadTimer=null,this.connectionState=Sl.CLOSED,this.emit(yd.STATE_CHANGE,Yv.CLOSED)}}function C9(t){if(er(t.interval,"interval",1e3,1/0),t&&t.extraInfo&&t.extraInfo.length>1024)throw new Oe(X.INVALID_PARAMS,"config.extraInfo length cannot exceed 1024 bytes");if(t&&t.vendor&&t.vendor.length>1024)throw new Oe(X.INVALID_PARAMS,"config.vendor length cannot exceed 1024 bytes")}const oge={name:"ImageModeration",create:function(t){let{config:r}=t;return C9(r),new pM(r)}};var I9,A9,P9,O9,k9,N9,D9,L9,x9,M9,U9,V9,F9,j9,B9,W9,z9,G9,H9,$9,K9,q9,Y9,X9,J9,Q9,Z9,e7,t7,n7,r7,i7,s7,o7,a7,c7,l7,u7,d7,h7,f7,ft;function p7(t,r){var s=Object.keys(t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);r&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(t,c).enumerable})),s.push.apply(s,o)}return s}function _u(t){for(var r=1;r<arguments.length;r++){var s=arguments[r]!=null?arguments[r]:{};r%2?p7(Object(s),!0).forEach(function(o){$(t,o,s[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(s)):p7(Object(s)).forEach(function(o){Object.defineProperty(t,o,Object.getOwnPropertyDescriptor(s,o))})}return t}ks.setLogger(L);let age=(I9=Mt(),A9=Mt({argsMap:(t,r)=>{if(!Array.isArray(r)){if(!(r instanceof Bv))return[r];r=[r]}return r.map(s=>s?Object(s).toString():"null")}}),P9=Mt({argsMap:(t,r)=>(r||(r=[]),Array.isArray(r)||r.trackMediaType!==jv.DATA?(Array.isArray(r)||(r=[r]),r.map(s=>s.getTrackId())):[r.getChannelId()])}),O9=Mt({argsMap:(t,r,s,o)=>[typeof r=="object"?r.uid:r,s,o]}),k9=Mt({argsMap:(t,r,s)=>[r,s]}),N9=Mt({argsMap:(t,r)=>r.map(s=>{let{user:o,mediaType:c}=s;return[o==null?void 0:o.uid,c]})}),D9=Mt({argsMap:(t,r,s,o)=>[typeof r=="object"?r.uid:r,s,o]}),L9=Mt({argsMap:(t,r)=>r.map(s=>{let{user:o,mediaType:c}=s;return{uid:o==null?void 0:o.uid,mediaType:c}})}),x9=Mt(),M9=Mt(),U9=Mt(),V9=Mt(),F9=Mt(),j9=Mt(),B9=Mt(),W9=Mt(),z9=Mt(),G9=Mt(),H9=Mt(),$9=Mt(),K9=Mt(),q9=Mt(),Y9=Mt(),X9=Mt({argsMap:(t,r)=>[r]}),J9=Mt(),Q9=Mt(),Z9=Mt(),e7=Mt(),t7=Mt(),n7=Mt(),r7=Mt(),i7=Mt(),s7=Mt({argsMap:(t,r)=>(Array.isArray(r)||(r=[r]),[JSON.stringify(r)])}),o7=Mt(),a7=Mt(),c7=Mt(),l7=Mt(),u7=Mt(),d7=Mt(),h7=Mt({reportResult:!0}),f7=Mt(),ft=class extends Pr{get connectionState(){return this._gateway.state}get remoteUsers(){return this._users}get localTracks(){return this._p2pChannel.getAllTracks(!0)}get uid(){return this._uid}get channelName(){return this._channelName}get localDataChannels(){return this._p2pChannel.getAllDataChannels()}get mode(){return this._config.mode}get role(){var t;return((t=this._config)===null||t===void 0?void 0:t.role)||"audience"}get codec(){return this._config.codec}get audioCodec(){return this._config.audioCodec||"opus"}get isStringUID(){return!!this._joinInfo&&!!this._joinInfo.stringUid}get __className__(){return"Client"}constructor(t,r){let s;if(super(),$(this,"store",void 0),$(this,"_uid",void 0),$(this,"_channelName",void 0),$(this,"_uintUid",void 0),$(this,"_users",[]),$(this,"_config",void 0),$(this,"_clientId",void 0),$(this,"_appId",void 0),$(this,"_sessionId",null),$(this,"_key",void 0),$(this,"_rtmConfig",{}),$(this,"_joinInfo",void 0),$(this,"_gateway",void 0),$(this,"_statsCollector",void 0),$(this,"_configDistribute",void 0),$(this,"_leaveMutex",void 0),$(this,"_publishMutex",void 0),$(this,"_renewTokenMutex",void 0),$(this,"_subscribeMutex",void 0),$(this,"_encryptionMode","none"),$(this,"_encryptionSecret",null),$(this,"_encryptionSalt",null),$(this,"_encryptDataStream",!1),$(this,"_encryptDataStreamKey",null),$(this,"_encryptDataStreamIv",null),$(this,"_proxyServer",void 0),$(this,"_turnServer",{servers:[],mode:"auto"}),$(this,"_cloudProxyServerMode","disabled"),$(this,"_isDualStreamEnabled",!1),$(this,"_defaultStreamFallbackType",void 0),$(this,"_lowStreamParameter",void 0),$(this,"_streamFallbackTypeCacheMap",new Map),$(this,"_remoteStreamTypeCacheMap",new Map),$(this,"_axiosCancelSource",$o.CancelToken.source()),$(this,"_audioVolumeIndicationInterval",void 0),$(this,"_networkQualityInterval",void 0),$(this,"_userOfflineTimeout",void 0),$(this,"_streamRemovedTimeout",void 0),$(this,"_liveTranscodeStreamingClient",void 0),$(this,"_liveRawStreamingClient",void 0),$(this,"_channelMediaRelayClient",void 0),$(this,"_networkQualitySensitivity","normal"),$(this,"_p2pChannel",void 0),$(this,"_useLocalAccessPoint",!1),$(this,"_setLocalAPVersion",void 0),$(this,"_joinAndNotLeaveYet",!1),$(this,"_numberOfJoinCount",0),$(this,"_remoteDefaultVideoStreamType",void 0),$(this,"_inspect",void 0),$(this,"_moderation",void 0),$(this,"_license",void 0),$(this,"_pendingPublishedUsers",[]),$(this,"ntpAlignErrorCount",0),$(this,"remoteInboundOffset",0),$(this,"_peerConnectionState",void 0),$(this,"_handleLocalTrackEnable",(c,u,h)=>{this.publish(c,!1).then(u).catch(h)}),$(this,"_handleLocalTrackDisable",(c,u,h)=>{this.unpublish(c).then(u).catch(h)}),$(this,"_handleUserOnline",c=>{if(re("BLOCK_LOCAL_CLIENT")&&W_(c.uid,this.channelName))return void L.debug("[".concat(c.uid,"] will be ignored in local"));this.isStringUID&&typeof c.uid!="string"&&L.error("[".concat(this._clientId,"] StringUID is Mixed with UintUID"));const u=this._users.find(h=>h.uid===c.uid);if(u)u._trust_in_room_=!0,u._is_pre_created&&(u._is_pre_created=!1,this.safeEmit(mn.USER_JOINED,u));else{const h=new Mm(c.uid,c.uint_id||c.uid);this._users.push(h),L.debug("[".concat(this._clientId,"] user online"),c.uid),this.safeEmit(mn.USER_JOINED,h)}}),$(this,"_handleUserOffline",c=>{if(re("BLOCK_LOCAL_CLIENT")&&W_(c.uid,this.channelName))return;const u=this._users.find(h=>h.uid===c.uid);u&&(this._handleRemoveStream(c),this._handleRemoveDataChannels(c),u._audio_pre_subscribed||u._video_pre_subscribed?u._is_pre_created=!0:jA(this._users,u),this._remoteStreamTypeCacheMap.delete(u.uid),this._streamFallbackTypeCacheMap.delete(u.uid),L.debug("[".concat(this._clientId,"] user offline"),c.uid,"reason:",c.reason),this.safeEmit(mn.USER_LEAVED,u,c.reason))}),$(this,"_handleAddAudioOrVideoStream",(c,u,h,m,_,E,S)=>{if(re("BLOCK_LOCAL_CLIENT")&&W_(u,this.channelName))return;const R=this._users.find(k=>k.uid===u);if(!R)return void L.error("[".concat(this._clientId,"] can not find target user!(on_add_stream)"));L.debug("[".concat(this._clientId,"] stream added with uid ").concat(u,", type ").concat(c)),this.store.subscribe(R.uid,c,void 0,void 0,void 0,Date.now());const P=c==="audio"?R.hasAudio:R.hasVideo;R._uintid||(R._uintid=_||u),c==="audio"?R._trust_audio_stream_added_state_=!0:R._trust_video_stream_added_state_=!0,c==="audio"?(R._audio_added_=!0,h!==void 0&&(R._audioSSRC=h),m!==void 0&&(R._cname=m),E&&(R._audioOrtc=E)):(R._video_added_=!0,h!==void 0&&(R._videoSSRC=h),m!==void 0&&(R._cname=m),S!==void 0&&(R._rtxSsrcId=S),E&&(R._videoOrtc=E)),(c==="audio"?R.hasAudio:R.hasVideo)&&!P&&(L.info("[".concat(this._clientId,"] remote user ").concat(R.uid," published ").concat(c)),this.safeEmit(mn.USER_PUBLISHED,R,c)),c==="video"?Rt.onGatewayStream(this._sessionId,Gi.ON_ADD_VIDEO_STREAM,Rr.ON_ADD_VIDEO_STREAM,{peer:_||u,ssrc:R._videoSSRC}):Rt.onGatewayStream(this._sessionId,Gi.ON_ADD_AUDIO_STREAM,Rr.ON_ADD_AUDIO_STREAM,{peer:_||u,ssrc:R._audioSSRC}),this._p2pChannel.remoteMediaSsrcChanged(R,c,h).then(k=>{if(k&&(L.debug("[".concat(this._clientId,"] resubscribe ").concat(c," for user ").concat(R.uid," after rejoin because SSRC id changed.")),this._p2pChannel instanceof MT))return this._p2pChannel.unsubscribe(R,c,!0).then(()=>this._subscribe(R,c,!0).catch(z=>{L.error("[".concat(this._clientId,"] resubscribe error"),z.toString())}))}),this._p2pChannel.hasPendingRemoteMedia(R,c)&&(L.debug("[".concat(this._clientId,"] resubscribe ").concat(c," for user ").concat(R.uid," after reconnect.")),this._subscribe(R,c,!0).catch(k=>{L.error("[".concat(this._clientId,"] resubscribe error"),k.toString())}))}),$(this,"_handleRemoveStream",c=>{if(re("BLOCK_LOCAL_CLIENT")&&W_(c.uid,this.channelName))return;const u=this._users.find(m=>m.uid===c.uid);if(!u)return void L.warning("[".concat(this._clientId,"] can not find target user!(on_remove_stream)"));L.debug("[".concat(this._clientId,"] stream removed with uid ").concat(c.uid));let h=()=>{};u.hasAudio&&u.hasVideo?h=()=>{L.info("[".concat(this._clientId,"] remote user ").concat(u.uid," unpublished audio track")),this.safeEmit(mn.USER_UNPUBLISHED,u,"audio"),L.info("[".concat(this._clientId,"] remote user ").concat(u.uid," unpublished video track")),this.safeEmit(mn.USER_UNPUBLISHED,u,"video")}:u.hasVideo?h=()=>{L.info("[".concat(this._clientId,"] remote user ").concat(u.uid," unpublished video track")),this.safeEmit(mn.USER_UNPUBLISHED,u,"video")}:u.hasAudio&&(h=()=>{L.info("[".concat(this._clientId,"] remote user ").concat(u.uid," unpublished audio track")),this.safeEmit(mn.USER_UNPUBLISHED,u,"audio")}),u._video_pre_subscribed||u._audio_pre_subscribed||(u._trust_audio_stream_added_state_=!0,u._trust_video_stream_added_state_=!0,u._audio_added_=!1,u._video_added_=!1,this._p2pChannel instanceof MT&&this._p2pChannel.unsubscribe(u).then(m=>{if(m)return this._gateway.unsubscribe(m,u.uid)}),u._audioSSRC=void 0,u._videoSSRC=void 0,u._audioOrtc=void 0,u._videoOrtc=void 0,u._rtxSsrcId=void 0),Rt.onGatewayStream(this._sessionId,Gi.ON_REMOVE_STREAM,Rr.ON_REMOVE_STREAM,{peer:c.uint_id||c.uid}),h()}),$(this,"_handleSetStreamLocalEnable",(c,u,h)=>{if(re("BLOCK_LOCAL_CLIENT")&&W_(u,this.channelName))return;const m=this._users.find(S=>S.uid===u);if(!m)return void L.error("[".concat(this._clientId,"] can not find target user!(disable_local)"));L.debug("[".concat(this._clientId,"] local ").concat(c," ").concat(h?"enabled":"disabled"," with uid ").concat(u));const _=c==="audio"?m.hasAudio:m.hasVideo;if(c==="audio"){m._trust_audio_enabled_state_=!0;const S=m._audio_enabled_;if(m._audio_enabled_=h,m._audio_enabled_===S)return;{const R=m._audio_enabled_?"enable-local-audio":"disable-local-audio";L.debug("[".concat(this._clientId,"] user-info-updated, uid: ").concat(u,", msg: ").concat(R)),this.safeEmit(mn.USER_INFO_UPDATED,u,R)}}else{m._trust_video_enabled_state_=!0;const S=m._video_enabled_;if(m._video_enabled_=h,m._video_enabled_===S)return;{const R=m._video_enabled_?"enable-local-video":"disable-local-video";L.debug("[".concat(this._clientId,"] user-info-update, uid: ").concat(u,", msg: ").concat(R)),this.safeEmit(mn.USER_INFO_UPDATED,u,R)}}const E=c==="audio"?m.hasAudio:m.hasVideo;return _!==E?!_&&E?(L.info("[".concat(this._clientId,"] remote user ").concat(u," published ").concat(c)),void this.safeEmit(mn.USER_PUBLISHED,m,c)):(c==="video"&&m._videoTrack&&m._videoTrack._destroy(),c==="audio"&&m._audioTrack,this._p2pChannel.muteRemote(m,c),L.info("[".concat(this._clientId,"] remote user ").concat(u," unpublished ").concat(c)),void this.safeEmit(mn.USER_UNPUBLISHED,m,c)):void 0}),$(this,"_handleMuteStream",(c,u,h)=>{if(re("BLOCK_LOCAL_CLIENT")&&W_(c,this.channelName))return;L.debug("[".concat(this._clientId,"] receive mute message"),c,u,h);const m=this._users.find(S=>S.uid===c);if(!m)return void L.warning("[".concat(this._clientId,"] can not find remote user, ignore mute event, uid: ").concat(c));const _=u==="audio"?m.hasAudio:m.hasVideo;if(u==="audio"){m._trust_audio_mute_state_=!0;const S=m._audio_muted_;if(m._audio_muted_=h,m._audio_muted_===S)return;{const R=m._audio_muted_?"mute-audio":"unmute-audio";L.debug("[".concat(this._clientId,"] user-info-update, uid: ").concat(c,", msg: ").concat(R)),this.safeEmit(mn.USER_INFO_UPDATED,c,R)}}else{m._trust_video_mute_state_=!0;const S=m._video_muted_;if(m._video_muted_=h,m._video_muted_===S)return;{const R=m._video_muted_?"mute-video":"unmute-video";L.debug("[".concat(this._clientId,"] user-info-update, uid: ").concat(c,", msg: ").concat(R)),this.safeEmit(mn.USER_INFO_UPDATED,c,R)}}const E=u==="audio"?m.hasAudio:m.hasVideo;if(_!==E){if(!_&&E)return(u==="audio"?m._audioSSRC:m._videoSSRC)?(L.info("[".concat(this._clientId,"] remote user ").concat(c," published ").concat(u)),void this.safeEmit(mn.USER_PUBLISHED,m,u)):void L.warning("[".concat(this._clientId,"] remote user ").concat(c," receive ").concat(u," unmute message  before add stream message, ").concat(u," SSRC doesn't exist yet."));u==="video"&&m._videoTrack&&!m._video_pre_subscribed&&m._videoTrack._destroy(),u==="audio"&&m._audioTrack,this._p2pChannel.muteRemote(m,u),L.info("[".concat(this._clientId,"] remote user ").concat(c," unpublished ").concat(u)),this.safeEmit(mn.USER_UNPUBLISHED,m,u)}}),$(this,"_handleP2PLost",async c=>{L.debug("[".concat(this._clientId,"] receive p2p lost"),c),parseInt(c.p2pid,10)===this.store.p2pId?await this._p2pChannel.requestReconnect():L.warning("[".concat(this._clientId,"] P2PLost stream not found"),c)}),$(this,"_handleTokenWillExpire",()=>{L.debug("[".concat(this._clientId,"] received message onTokenPrivilegeWillExpire")),this.safeEmit(mn.ON_TOKEN_PRIVILEGE_WILL_EXPIRE)}),$(this,"_handleBeforeUnload",c=>{c.type==="beforeunload"&&c.returnValue!==void 0&&c.returnValue!==""||(this.leave(),L.info("[".concat(this._clientId,"] auto leave onbeforeunload or pagehide")))}),$(this,"_handleUpdateNetworkQuality",()=>{if(this._networkQualitySensitivity==="normal")return;if(navigator&&navigator.onLine!==void 0&&!navigator.onLine)return void this.safeEmit(mn.NETWORK_QUALITY,{downlinkNetworkQuality:6,uplinkNetworkQuality:6});const c={downlinkNetworkQuality:0,uplinkNetworkQuality:0};c.uplinkNetworkQuality=this._p2pChannel.getUplinkNetworkQuality(),c.downlinkNetworkQuality=this._p2pChannel.getDownlinkNetworkQuality(),this.safeEmit(mn.NETWORK_QUALITY,c)}),$(this,"_handleP2PAddAudioOrVideoStream",(c,u,h,m)=>{const _=this._users.find(S=>S.uid===u);if(!_)return void L.error("[".concat(this._clientId,"] can not find target user!(on_add_stream)"));L.debug("[".concat(this._clientId,"] stream added with uid ").concat(u,", type ").concat(c)),this.store.subscribe(_.uid,c,void 0,void 0,void 0,Date.now());const E=c==="audio"?_.hasAudio:_.hasVideo;c==="audio"?_._trust_audio_stream_added_state_=!0:_._trust_video_stream_added_state_=!0,c==="audio"?(_._audio_added_=!0,h!==void 0&&(_._audioSSRC=h),m!==void 0&&(_._audioMid=m)):(_._video_added_=!0,h!==void 0&&(_._videoSSRC=h),m!==void 0&&(_._videoMid=m)),(c==="audio"?_.hasAudio:_.hasVideo)&&!E&&(L.info("[".concat(this._clientId,"] remote user ").concat(_.uid," published ").concat(c)),this.safeEmit(mn.USER_PUBLISHED,_,c)),this._p2pChannel.hasPendingRemoteMedia(_,c)&&(L.debug("[".concat(this._clientId,"] resubscribe ").concat(c," for user ").concat(_.uid," after reconnect.")),this._subscribe(_,c,!0).catch(S=>{L.error("[".concat(this._clientId,"] resubscribe error"),S.toString())}))}),this._config=t,this._clientId=r||or(5,"client-"),this.store=new class{constructor(c,u,h,m){Gt(this,"state",void 0),this.state={codec:c,audioCodec:u,mode:h,clientId:m,sessionId:null,p2pId:0,dcId:0,pubId:0,subId:0,avoidJoinStart:0,keyMetrics:{publish:[],subscribe:[]},joinChannelServiceRecords:[],cloudProxyServerMode:"disabled",useP2P:!1,p2pTransport:x_.Default,hasStartJoinChannel:!1,isABTestSuccess:!1}}dispatch(c){this.state=function(u,h){switch(h.type){case gn.SET_SESSION_ID:return mt(mt({},u),{},{sessionId:h.sessionId});case gn.SET_P2P_ID:return mt(mt({},u),{},{p2pId:h.p2pId});case gn.SET_UID:return mt(mt({},u),{},{uid:h.uid});case gn.SET_INT_UID:return mt(mt({},u),{},{intUid:h.intUid});case gn.SET_PUB_ID:return mt(mt({},u),{},{pubId:h.pubId});case gn.KEY_METRIC_CLIENT_CREATED:return mt(mt({},u),{},{keyMetrics:mt(mt({},u.keyMetrics),{},{clientCreated:h.metric})});case gn.KEY_METRIC_JOIN_START:return mt(mt({},u),{},{keyMetrics:mt(mt({},u.keyMetrics),{},{joinStart:h.metric})});case gn.AVOID_JOIN_START:return mt(mt({},u),{},{avoidJoinStart:h.avoidJoinStart});case gn.KEY_METRIC_JOIN_END:return mt(mt({},u),{},{keyMetrics:mt(mt({},u.keyMetrics),{},{joinEnd:h.metric})});case gn.KEY_METRIC_REQUEST_AP_START:return mt(mt({},u),{},{keyMetrics:mt(mt({},u.keyMetrics),{},{requestAPStart:h.metric})});case gn.KEY_METRIC_REQUEST_AP_END:return mt(mt({},u),{},{keyMetrics:mt(mt({},u.keyMetrics),{},{requestAPEnd:h.metric})});case gn.KEY_METRIC_JOIN_GATEWAY_START:return mt(mt({},u),{},{keyMetrics:mt(mt({},u.keyMetrics),{},{joinGatewayStart:h.metric})});case gn.KEY_METRIC_JOIN_GATEWAY_END:return mt(mt({},u),{},{keyMetrics:mt(mt({},u.keyMetrics),{},{joinGatewayEnd:h.metric})});case gn.KEY_METRIC_PEER_CONNECTION_START:return mt(mt({},u),{},{keyMetrics:mt(mt({},u.keyMetrics),{},{peerConnectionStart:h.metric})});case gn.KEY_METRIC_PEER_CONNECTION_END:return mt(mt({},u),{},{keyMetrics:mt(mt({},u.keyMetrics),{},{peerConnectionEnd:h.metric})});case gn.KEY_METRIC_DESCRIPTION_START:return mt(mt({},u),{},{keyMetrics:mt(mt({},u.keyMetrics),{},{descriptionStart:h.metric})});case gn.KEY_METRIC_SIGNAL_CHANNEL_OPEN:return mt(mt({},u),{},{keyMetrics:mt(mt({},u.keyMetrics),{},{signalChannelOpen:h.metric})});case gn.KEY_METRIC_ICE_CONNECTION_END:return mt(mt({},u),{},{keyMetrics:mt(mt({},u.keyMetrics),{},{iceConnectionEnd:h.metric})});case gn.KEY_METRIC_PUBLISH:{const m=u.keyMetrics.publish,_=m.findIndex(E=>E.trackId===h.metric.trackId);return _!==-1?(m[_]=mt(mt({},m[_]),h.metric),mt(mt({},u),{},{keyMetrics:mt(mt({},u.keyMetrics),{},{publish:[...m]})})):mt(mt({},u),{},{keyMetrics:mt(mt({},u.keyMetrics),{},{publish:[...u.keyMetrics.publish,h.metric]})})}case gn.KEY_METRIC_SUBSCRIBE:{const m=u.keyMetrics.subscribe,_=m.findIndex(E=>E.userId===h.metric.userId&&E.type===h.metric.type);return _!==-1?(m[_]=mt(mt({},m[_]),h.metric),mt(mt({},u),{},{keyMetrics:mt(mt({},u.keyMetrics),{},{subscribe:[...m]})})):mt(mt({},u),{},{keyMetrics:mt(mt({},u.keyMetrics),{},{subscribe:[...u.keyMetrics.subscribe,h.metric]})})}case gn.SET_CLOUD_PROXY_SERVER_MODE:return u.cloudProxyServerMode=h.mode,u;case gn.RECORD_JOIN_CHANNEL_SERVICE:return typeof h.index!="number"?u.joinChannelServiceRecords=[...u.joinChannelServiceRecords,h.record]:(u.joinChannelServiceRecords[h.index]=mt(mt({},u.joinChannelServiceRecords[h.index]),h.record),u.joinChannelServiceRecords=[...u.joinChannelServiceRecords]),u;case gn.RESET_JOIN_CHANNEL_SERVICE_RECORDS:return u.joinChannelServiceRecords=[],u;case gn.RESET_KEY_METRICS:return u.keyMetrics={publish:[],subscribe:[]},u;case gn.SET_USE_P2P:return mt(mt({},u),{},{useP2P:h.val});case gn.SET_TRANSPORT_TYPE:return mt(mt({},u),{},{p2pTransport:h.val});default:return u}}(this.state,c)}set sessionId(c){this.dispatch({type:gn.SET_SESSION_ID,sessionId:c})}get sessionId(){return this.state.sessionId}set cid(c){this.state.cid=c}get cid(){return this.state.cid}set codec(c){this.state.codec=c}get codec(){return this.state.codec}get mode(){return this.state.mode}get audioCodec(){return this.state.audioCodec}get clientId(){return this.state.clientId}set p2pId(c){this.dispatch({type:gn.SET_P2P_ID,p2pId:c})}get p2pId(){return this.state.p2pId}set dcId(c){this.dispatch({type:gn.SET_DC_ID,dcId:c})}get dcId(){return this.state.dcId}set uid(c){this.dispatch({type:gn.SET_UID,uid:c})}get uid(){return this.state.uid}set intUid(c){this.dispatch({type:gn.SET_INT_UID,intUid:c})}get intUid(){return this.state.intUid}set pubId(c){this.dispatch({type:gn.SET_PUB_ID,pubId:c})}get pubId(){return this.state.pubId}set cloudProxyServerMode(c){this.dispatch({type:gn.SET_CLOUD_PROXY_SERVER_MODE,mode:c})}get cloudProxyServerMode(){return this.state.cloudProxyServerMode}set useP2P(c){this.dispatch({type:gn.SET_USE_P2P,val:c})}get useP2P(){return this.state.useP2P}set p2pTransport(c){this.dispatch({type:gn.SET_TRANSPORT_TYPE,val:c})}get p2pTransport(){return this.state.p2pTransport}set hasStartJoinChannel(c){this.state.hasStartJoinChannel=c}get hasStartJoinChannel(){return this.state.hasStartJoinChannel}set isABTestSuccess(c){this.state.isABTestSuccess=c}get isABTestSuccess(){return this.state.isABTestSuccess}clientCreated(){this.dispatch({type:gn.KEY_METRIC_CLIENT_CREATED,metric:Date.now()})}joinStart(){this.dispatch({type:gn.KEY_METRIC_JOIN_START,metric:Date.now()})}joinEnd(){this.dispatch({type:gn.KEY_METRIC_JOIN_END,metric:Date.now()})}requestAPStart(){this.dispatch({type:gn.KEY_METRIC_REQUEST_AP_START,metric:Date.now()})}requestAPEnd(){this.dispatch({type:gn.KEY_METRIC_REQUEST_AP_END,metric:Date.now()})}joinGatewayStart(){this.dispatch({type:gn.KEY_METRIC_JOIN_GATEWAY_START,metric:Date.now()})}joinGatewayEnd(){this.dispatch({type:gn.KEY_METRIC_JOIN_GATEWAY_END,metric:Date.now()})}peerConnectionStart(){this.dispatch({type:gn.KEY_METRIC_PEER_CONNECTION_START,metric:Date.now()})}peerConnectionEnd(){this.dispatch({type:gn.KEY_METRIC_PEER_CONNECTION_END,metric:Date.now()})}descriptionStart(){this.dispatch({type:gn.KEY_METRIC_DESCRIPTION_START,metric:Date.now()})}signalChannelOpen(){this.dispatch({type:gn.KEY_METRIC_SIGNAL_CHANNEL_OPEN,metric:Date.now()})}iceConnectionEnd(){this.dispatch({type:gn.KEY_METRIC_ICE_CONNECTION_END,metric:Date.now()})}publish(c,u,h,m){this.dispatch({type:gn.KEY_METRIC_PUBLISH,metric:mt(mt({trackId:c,type:u},h&&{publishStart:h}),m&&{publishEnd:m})})}subscribe(c,u,h,m,_,E,S){this.dispatch({type:gn.KEY_METRIC_SUBSCRIBE,metric:mt(mt(mt(mt(mt({userId:c,type:u},h&&{subscribeStart:h}),m&&{subscribeEnd:m}),_&&{firstFrame:_}),E&&{streamAdded:E}),S&&{firstDecoded:S})})}massSubscribe(c,u,h,m){c.forEach(_=>{this.dispatch({type:gn.KEY_METRIC_SUBSCRIBE,metric:mt(mt(mt({userId:_.userId,type:_.type},u&&{subscribeStart:u}),h&&{subscribeEnd:h}),m&&{firstFrame:m})})})}get keyMetrics(){return this.state.keyMetrics}recordJoinChannelService(c,u){c.service==="gateway"&&Array.isArray(c.urls)&&(c.urls=c.urls.map(h=>h.replace(/(\d+)-\d+-\d+-(\d+)/,"$1-*-*-$2")));try{return typeof u!="number"?(this.dispatch({type:gn.RECORD_JOIN_CHANNEL_SERVICE,record:mt(mt({},c),{},{sessionId:this.sessionId,cloudProxyMode:this.cloudProxyServerMode,uid:this.uid})}),this.state.joinChannelServiceRecords.length-1):(u<0||u>=this.state.joinChannelServiceRecords.length||this.dispatch({type:gn.RECORD_JOIN_CHANNEL_SERVICE,record:c,index:u}),u)}catch{return 0}}resetJoinChannelServiceRecords(){this.dispatch({type:gn.RESET_JOIN_CHANNEL_SERVICE_RECORDS})}resetKeyMetrics(){this.dispatch({type:gn.RESET_KEY_METRICS})}get joinChannelServiceRecords(){try{return this.state.joinChannelServiceRecords}catch{return[]}}get avoidJoinStart(){return this.state.avoidJoinStart}set avoidJoinStart(c){this.dispatch({type:gn.AVOID_JOIN_START,avoidJoinStart:c})}}(t.codec,t.audioCodec,t.mode,this._clientId),this._leaveMutex=new ks("client-leave",this._clientId),this._publishMutex=new ks("client-publish",this._clientId),this._renewTokenMutex=new ks("client-renewtoken",this._clientId),this._subscribeMutex=new ks("client-subscribe",this._clientId),this.store.clientCreated(),t.proxyServer&&this.setProxyServer(t.proxyServer,!0),t.turnServer&&this.setTurnServer(t.turnServer,!0),L.info("[".concat(this._clientId,"] Initializing AgoraRTC client v").concat(yl," build: ").concat(ox,", mode: ").concat(this.mode,", codec: ").concat(this.codec)),t.clientRoleOptions)try{KL(t.clientRoleOptions),s=Object.assign({},t.clientRoleOptions)}catch(c){L.warning("[".concat(this._clientId,"] ").concat(c.toString()))}var o;this._statsCollector=new LT(this.store),this._statsCollector.onStatsException=(c,u,h)=>{L.warn("[".concat(this._clientId,"] receive exception msg, code: ").concat(c,", msg: ").concat(u,", uid: ").concat(h)),this.safeEmit(mn.EXCEPTION,{code:c,msg:u,uid:h})},this._statsCollector.onUploadPublishDuration=(c,u,h,m)=>{const _=this._users.find(E=>E.uid===c);_&&Rt.peerPublishStatus(this._sessionId,{subscribeElapse:m,audioPublishDuration:u,videoPublishDuration:h,peer:_._uintid})},this.store.useP2P=t.mode==="p2p",this._gateway=new Rme(this.store,{clientId:this._clientId,mode:this.mode,codec:this.codec,websocketRetryConfig:t.websocketRetryConfig||bi,httpRetryConfig:t.httpRetryConfig||bi,forceWaitGatewayResponse:t.forceWaitGatewayResponse===void 0||t.forceWaitGatewayResponse,statsCollector:this._statsCollector,role:t.role,clientRoleOptions:s}),this._configDistribute=new xme(this._clientId,this.store),this.store.useP2P?(this._p2pChannel=(o={store:this.store,statsCollector:this._statsCollector},tp("P2PChannel").create(o)),this._handleP2PEvents()):this._p2pChannel=new MT(this.store,this._statsCollector),this._handleP2PChannelEvents(),this._handleGatewayEvents(),this._handleGatewaySignalEvents()}async joinMeta(t,r,s,o,c){let u=!(arguments.length>5&&arguments[5]!==void 0)||arguments[5],h=arguments.length>6&&arguments[6]!==void 0&&arguments[6];Xn("JOIN_GATEWAY_USE_443PORT_ONLY",u),Xn("JOIN_GATEWAY_USE_DUAL_DOMAIN",h);const m=this._gateway.signal.websocket;return m instanceof Fx&&(m.use443PortOnly=u,m.tryDoubleDomain=h),async function(_,E,S){xA.get(_)||xA.set(_,[]),MA.get(_)||MA.set(_,E),mh.get(_)||mh.set(_,0);const R=xA.get(_),P=MA.get(_);if(!R||!P)throw new Error("concurrent: deferQueue or maxConcurrency is null");if(mh.get(_)===P){const q=dT();R.push(q),await q.promise}mh.set(_,mh.get(_)+1);for(var k=arguments.length,z=new Array(k>3?k-3:0),U=3;U<k;U++)z[U-3]=arguments[U];const F=await S(...z);return mh.set(_,mh.get(_)-1),mh.get(_)===P-1&&R.length>0&&(R[0].resolve(),R.shift()),mh.get(_)===0&&(xA.set(_,[]),MA.set(_,0),mh.set(_,0)),F}("client.join",re("JOIN_MAX_CONCURRENCY"),this.join.bind(this),t,r,s,o,c)}async join(t,r,s,o,c){const u=++this._numberOfJoinCount;this.store.joinStart(),o&&(this.store.uid=o);const h=(zA||zA||(zA=(window.location.protocol.split(":")[0]||"").toUpperCase(),zA))==="HTTPS",m=d8()?window.isSecureContext:"Browser Not Support";(!d8()&&!h||!window.isSecureContext)&&L.warning("The website must be running in a secure context (About secure context: https://developer.mozilla.org/en-US/docs/Web/Security/Secure_Contexts ), otherwise the media collection will be restricted by the browser"),this.connectionState==="DISCONNECTED"&&(this.store.avoidJoinStart=Math.round(Date.now()),L.debug("[".concat(this._clientId,"] set avoidJoinStart to ").concat(this.store.avoidJoinStart))),Rt.setAppId(t);try{if(!s&&s!==null)throw new Oe(X.INVALID_PARAMS,"Invalid token: ".concat(s,". If you don not use token, set it to null"));s&&ss(s,"token",1,2047),ss(t,"appid",1,2047),dP(r),o&&hP(o),c&&ss(c,"optionalInfo",1,2047)}catch(U){throw Rt.reportApiInvoke(L_(),{name:Si.JOIN,options:[t,r,s,o],states:{isHttps:h,isSecureContext:m},tag:xr.TRACER}).onError(U),U}if(this._leaveMutex.isLocked&&(L.debug("[".concat(this._clientId,"] join: waiting leave operation")),(await this._leaveMutex.lock())(),L.debug("[".concat(this._clientId,"] join: continue"))),this._joinAndNotLeaveYet=!0,this.connectionState!=="DISCONNECTED"){const U=new Oe(X.INVALID_OPERATION,"[".concat(this._clientId,"] Client already in connecting/connected state"));throw Rt.reportApiInvoke(L_(),{name:Si.JOIN,options:[t,r,s,o],states:{isHttps:h,isSecureContext:m},tag:xr.TRACER}).onError(U),U}this._gateway.state="CONNECTING";const _=await u9({appId:t,cname:r,uid:o,stringUid:typeof o=="string"?o:void 0,token:s||t,cloudProxyServer:this._cloudProxyServerMode});if(!this._joinAndNotLeaveYet)throw new Oe(X.INVALID_OPERATION,"[".concat(this._clientId,"] Client already left"));const E=(_==null?void 0:_.sid)||L_();L.info("[".concat(this._clientId,"] start join channel ").concat(r,", join number: ").concat(u)),this._sessionId||(this._sessionId=E,this.store.sessionId=this._sessionId);const S=Rt.reportApiInvoke(E,{id:this._clientId,name:Si.JOIN,options:[t,r,s,o],states:{isHttps:h,isSecureContext:m},tag:xr.TRACER}),R=_u(_u(_u({},this._rtmConfig),{},{role:this.role,clientId:this._clientId,appId:t,sid:this._sessionId,cname:r,uid:typeof o!="string"?o:null,turnServer:this._turnServer,proxyServer:this._proxyServer,token:s||t,cloudProxyServer:this._cloudProxyServerMode,optionalInfo:c,license:this._license,useLocalAccessPoint:this._useLocalAccessPoint,preload:!!_},this._remoteDefaultVideoStreamType!==void 0&&{defaultVideoStream:this._remoteDefaultVideoStreamType}),{},{apRequestDetail:re("AP_REQUEST_DETAIL")||void 0});if(this._useLocalAccessPoint&&(R.setLocalAPVersion=this._setLocalAPVersion),typeof o=="string"&&(R.stringUid=o,this._uintUid?(R.uid=this._uintUid,this._uintUid=void 0):R.uid=0),this._encryptionMode!=="none"&&this._encryptionSecret){if(R.aesmode=this._encryptionMode,R.aespassword=await(async U=>{const F=function(ye){const Ee=window.atob(`MIGfMA0GCSqGSIb3DQEBAQUAA4GNADCBiQKBgQDCMnXAHkKIGAM+x4N22gCI+Wyu
STM9ztkT3uYslTT2PuKmZfPzhH6kVdO7PTjGCOZnAsyb3oTtWat0KcxQ4jxvqQV+
HvYl3iI1Yd4vl2c3qRMJPLtRDfNxa2Mcxgq7e9aEUibzdd0st+OJAy3tOj/Y0aVy
xQiYDz3vqa6bP29adwIDAQAB`),me=new Uint8Array(new ArrayBuffer(Ee.length));for(let ke=0;ke<Ee.length;ke+=1)me[ke]=Ee.charCodeAt(ke);return me}(),q=await window.crypto.subtle.importKey("spki",F,{name:"RSA-OAEP",hash:"SHA-256"},!0,["encrypt"]),Y=HL(U),le=await window.crypto.subtle.encrypt({name:"RSA-OAEP"},q,Y);return function(ye){let Ee="";for(let me=0;me<ye.length;me+=1)Ee+=String.fromCharCode(ye[me]);return window.btoa(Ee)}(new Uint8Array(le))})(this._encryptionSecret),!this._joinAndNotLeaveYet)throw new Oe(X.INVALID_OPERATION,"[".concat(this._clientId,"] Client already left"));this._encryptionSalt&&(R.aessalt=this._encryptionSalt)}if(this._encryptDataStream&&(this._encryptionMode==="aes-128-gcm2"||this._encryptionMode==="aes-256-gcm2"))if(this._encryptionSalt&&this._encryptionSecret)if(window.crypto.subtle){const U=new TextEncoder,F=re("USE_PURE_ENCRYPTION_MASTER_KEY")?U.encode(R.appId+this._encryptionSecret+this._encryptionSecret):U.encode(R.appId+R.cname+this._encryptionSecret);this._encryptDataStreamIv=await async function(q,Y,le){const ye=await window.crypto.subtle.importKey("raw",Y,"PBKDF2",!1,["deriveBits","deriveKey"]),Ee=q==="aes-128-gcm2"?128:256,me=await window.crypto.subtle.deriveBits({name:"PBKDF2",iterations:S8,hash:"SHA-256",salt:le},ye,Ee+tpe);return new Uint8Array(me).subarray(Ee/8)}(this._encryptionMode,F,D_(this._encryptionSalt)),this._encryptDataStreamKey=await async function(q,Y,le){const ye=await window.crypto.subtle.importKey("raw",Y,"PBKDF2",!1,["deriveBits","deriveKey"]),Ee=q==="aes-128-gcm2"?128:256;return await window.crypto.subtle.deriveKey({name:"PBKDF2",iterations:S8,hash:"SHA-256",salt:le},ye,{name:"AES-GCM",length:Ee},!0,["encrypt","decrypt"])}(this._encryptionMode,F,D_(this._encryptionSalt))}else m?L.warning("[".concat(this._clientId,"] encrypt datastream must be running in a secure context, fallback to plain data stream")):L.warning("[".concat(this._clientId,"] current browser do not support WebCrypto ,fallback to plain data stream")),this._encryptDataStream=!1;else this._encryptDataStream=!1,L.debug("[".concat(this._clientId,"] no salt / secret, cannot support encrypt data stream, fallback to plain data stream"));this._startSession(this._sessionId,{channel:r,appId:t,stringUid:R.stringUid});const P=this._sessionId;setTimeout(()=>{this.connectionState==="CONNECTING"&&P===this._sessionId&&Rt.joinChannelTimeout(this._sessionId,5)},5e3);try{var k;let U;const F=R.cloudProxyServer;if(ot(k=["proxy3","proxy4","proxy5"]).call(k,F)){const Ee=re("PROXY_SERVER_TYPE3");Array.isArray(Ee)?R.proxyServer=Ee[0]:R.proxyServer=Ee}if(Rt.setProxyServer(R.proxyServer),L.setProxyServer(R.proxyServer),this.store.requestAPStart(),_){if(L.debug("[".concat(this._clientId,"] get serverInfo Success from Preload Cache ").concat(R.stringUid?", ".concat(R.stringUid," => ").concat(_.intUid):""," ")),R.stringUid&&!R.uid&&(R.uid=_.intUid),U={gatewayInfo:_.ap.gatewayInfo},re("JOIN_WITH_FALLBACK_MEDIA_PROXY")&&R.turnServer.mode==="auto")if(_.ap.proxyInfo.addresses.length===0)L.warning("no edge services in ap response of proxy fallback, will not set proxy in iceServers");else{const Ee=(await nH(_.ap.proxyInfo,_.ap.gatewayInfo.uid)).map(me=>({turnServerURL:me.address,tcpport:me.tcpport||ws.tcpport,udpport:me.udpport||ws.udpport,username:me.username||ws.username,password:me.password||ws.password,forceturn:!1,security:!0}));R.turnServer={mode:"manual",servers:Ee}}f9(_,R.stringUid)}else{if(R.stringUid&&!R.uid){let Ee;[Ee,U]=await lt.all([OH(R.stringUid,R,this._axiosCancelSource.token,this._config.httpRetryConfig||bi,this.store),PH(R,this._axiosCancelSource.token,this._config.httpRetryConfig||bi,!0,this.store)]),L.debug("[".concat(this._clientId,"] getUserAccount Success ").concat(R.stringUid," => ").concat(Ee)),R.uid=Ee,U.gatewayInfo.uid=Ee,U.gatewayInfo.res.uid=Ee}else U=await PH(R,this._axiosCancelSource.token,this._config.httpRetryConfig||bi,!0,this.store);if(!this._joinAndNotLeaveYet)throw new Oe(X.INVALID_OPERATION,"[".concat(this._clientId,"] Client already left"))}this.store.requestAPEnd(),setTimeout(()=>{this._configDistribute.startGetConfigDistribute(R,this._axiosCancelSource.token),this._configDistribute.on(RT.UPDATE_BITRATE_LIMIT,Ee=>{this._p2pChannel.updateBitrateLimit(Ee)}),this._configDistribute.on(RT.UPDATE_CLIENT_ROLE_OPTIONS,Ee=>{this._setClientRoleOptions(Ee)})},0),this._key=s||t;const q=U.gatewayInfo,Y=R.uid?R.uid:q.uid;this._joinInfo=_u(_u({},R),{},{cid:q.cid,uid:Y,vid:q.vid,apResponse:q.res,apGatewayAddress:q.apGatewayAddress,uni_lbs_ip:q.uni_lbs_ip,gatewayAddrs:q.gatewayAddrs}),this.store.intUid=Y,this.store.cid=q.cid;const le=await this._joinGateway();if(!this._joinAndNotLeaveYet)throw new Oe(X.INVALID_OPERATION,"[".concat(this._clientId,"] Client already left"));S.onSuccess(le),this._appId=t,this._channelName=R.cname,this._uid=le,this.store.uid=le,setTimeout(()=>{this._networkQualityInterval&&window.clearInterval(this._networkQualityInterval),this._networkQualityInterval=window.setInterval(this._handleUpdateNetworkQuality,2e3),window.addEventListener(Ss()?"beforeunload":"pagehide",this._handleBeforeUnload),this._statsCollector.startUpdateStats()},0);const ye=R.stringUid?"string uid: ".concat(R.stringUid,",uid: ").concat(R.uid):"uid: ".concat(this._uid);return L.info("[".concat(this._clientId,"] Joining channel success: channel: ").concat(r,",").concat(ye)),setTimeout(()=>{L.startUpload()},5e3),this.store.joinEnd(),z=this,ot(B_).call(B_,z)||B_.push(z),this._cloudProxyServerMode==="disabled"&&kn().supportWebCrypto&&re("ENABLE_PRELOAD")&&hM(this._joinInfo),le}catch(U){const F=Array.isArray(U)?U[0]:U;throw F&&F.code===X.OPERATION_ABORTED?L.warning("[".concat(this._clientId,"] join number: ").concat(u,", Joining channel failed, rollback"),F):L.error("[".concat(this._clientId,"] join number: ").concat(u,", Joining channel failed, rollback"),F),F.code!==X.OPERATION_ABORTED&&this._numberOfJoinCount===u&&(this._gateway.state="DISCONNECTED",this._reset()),S.onError(F),F}var z}_joinGateway(){if(!this._joinInfo||!this._key)throw new Oe(X.INVALID_OPERATION);return this._gateway.join(this._joinInfo,this._key,!(this._joinInfo.cloudProxyServer!=="disabled"||this._joinInfo.proxyServer||!re("JOIN_WITH_FALLBACK_SIGNAL_PROXY")))}async leave(){L.info("[".concat(this._clientId,"] Leaving channel")),window.removeEventListener(Ss()?"beforeunload":"pagehide",this._handleBeforeUnload),this._reset(),function(r){const s=B_.indexOf(r);s!==-1&&B_.splice(s,1)}(this),this._statsCollector.stopUpdateStats();const t=await this._leaveMutex.lock();if(this.connectionState==="DISCONNECTED")return L.info("[".concat(this._clientId,"] Leaving channel repeated, success")),void t();await this._gateway.leave(this.connectionState!=="CONNECTED",Bn.LEAVE),L.info("[".concat(this._clientId,"] Leaving channel success")),this._joinAndNotLeaveYet=!1,this.store.resetJoinChannelServiceRecords(),t()}async publish(t){let r=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1];if(!Array.isArray(t)){if(!(t instanceof Bv))return this._publishDataChannel(t);t=[t]}if(t.length===0)throw new Oe(X.INVALID_PARAMS,"param list is empty");const s=t;if(this._gateway.role==="audience")throw new Oe(X.INVALID_OPERATION,"audience can not publish stream");for(const c of s){if(!(c instanceof Bv))throw new Oe(X.INVALID_PARAMS,"parameter is not local track");if(!c._enabled&&r)throw new Oe(X.TRACK_IS_DISABLED,"can not publish a disabled track: ".concat(c.getTrackId()))}L.info("[".concat(this._clientId,"] Publishing tracks, id ").concat(s.map(c=>"".concat(c.getTrackId()," "))));const o=await this._publishMutex.lock();await this._configDistribute.awaitConfigDistributeComplete(),r&&s.forEach(c=>{const u=this._configDistribute.getBitrateLimit();c instanceof _r&&u&&c.setBitrateLimit(u.uplink)});try{await this._publishHighStream(s),L.info("[".concat(this._clientId,"] Publish success, id ").concat(s.map(c=>"".concat(c.getTrackId()," "))))}catch(c){throw L.error("[".concat(this._clientId,"] publish error"),c.toString()),c}finally{o()}}async _publishDataChannel(t){er(t.id,"id",0,65535,!0),qf(t.ordered,"ordered"),ss(t.metadata,"metadata",0,512),L.info("[".concat(this._clientId,"] Publishing datachannels, id ").concat(t.id));const r=await this._publishMutex.lock();try{if(this._p2pChannel.getAllDataChannels().findIndex(c=>c.id===t.id)!==-1)throw new Oe(X.INVALID_PARAMS,"Invalid id: ".concat(t.id,". If you want to republish the datachannel, unpublish first"));if(!this._joinInfo||this._uid===void 0)throw new Oe(X.INVALID_OPERATION,"Can't publish datachannel, haven't joined yet!");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new Oe(X.INVALID_OPERATION,"can not publish datachannel in ".concat(this.connectionState," state"));if(this._turnServer.mode==="auto"&&re("FORCE_TURN")&&!re("TURN_ENABLE_TCP")&&!re("TURN_ENABLE_UDP"))throw new Oe(X.UNEXPECTED_ERROR,"force TURN With No TURN Configuration");const s=function(c){return vH(c,!1)}(t),o=await this._p2pChannel.publishDataChannel([s]);if(o.length>0){if(typeof s._originDataChannelId!="number")throw L.error("[".concat(this._clientId,"] can not publish with mediaType datachannel, cannot get RTCDatachannel id")),new Oe(X.CREATE_DATACHANNEL_ERROR);try{await lt.all(o.map(c=>this._uid&&this._gateway.publishDataChannel(this._uid,c,!0))),await s._waitTillOpen()}catch(c){if(c.code!==X.DISCONNECT_P2P)throw c}}return L.info("[".concat(this._clientId,"] Publish dataChannels success, id ").concat(s.id)),s}catch(s){throw L.error("[".concat(this._clientId,"] publish datachannels error"),s.toString()),s}finally{r()}}async unpublish(t){if(!this._joinInfo||this._uid===void 0)throw new Oe(X.INVALID_OPERATION,"Can't unpublish stream, haven't joined yet!");let r=[];if(t)if(Array.isArray(t))r=t;else{if(!(t instanceof Bv))return this._unpublishDataChannel([t]);r=[t]}else this.store.useP2P||await this._unpublishDataChannel(),r=this._p2pChannel.getAllTracks(!0);L.info("[".concat(this._clientId,"] Unpublish tracks, tracks ").concat(r.map(o=>"".concat(o.getTrackId()," "))," "));const s=await this._publishMutex.lock();try{if(this.store.useP2P){const o=await this._p2pChannel.unpublish(r);o&&await this._gateway.sendExtensionMessage(Zr.UNPUBLISH,{unpubMsg:o},!0)}else{const o=await this._p2pChannel.unpublish(r);o&&await this._gateway.unpublish(o,this._uid),L.info("[".concat(this._clientId,"] Unpublish success,tracks ").concat(r.map(c=>"".concat(c.getTrackId()))))}}catch(o){throw L.error("[".concat(this._clientId,"] unpublish error"),o.toString()),o}finally{s&&s()}}async _unpublishDataChannel(t){t!==void 0&&t.length!==0||(t=this._p2pChannel.getAllDataChannels()),L.info("[".concat(this._clientId,"] Unpublish datachannels, datachannels ").concat(t.map(s=>"".concat(s.id," "))," "));const r=await this._publishMutex.lock();try{const s=await this._p2pChannel.unpublishDataChannel(t);s&&await this._gateway.unpublishDataChannel(s),L.info("[".concat(this._clientId,"] Unpublish dataChannel success,dataChannel ").concat(t.map(o=>"".concat(o.id))))}catch(s){throw L.error("[".concat(this._clientId,"] unpublish dataChannel error"),s.toString()),s}finally{r&&r()}}async subscribe(t,r,s){if(!(t instanceof Mm)){const o=this.remoteUsers.find(c=>c.uid===t);if(!o)throw new Oe(X.INVALID_REMOTE_USER,"user is not in the channel");t=o}return r==="datachannel"?this._subscribeDataChannel(t,s):this._subscribe(t,r)}async presubscribe(t,r){if(Di(r,"mediaType",["audio","video"]),this.store.useP2P)throw new Oe(X.INVALID_OPERATION,"can't presub at p2p mode");if(!this._joinInfo)throw new Oe(X.INVALID_OPERATION,"can't presub when not join");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new Oe(X.INVALID_OPERATION,"can't presub in ".concat(this.connectionState," state"));const s=r===gt.AUDIO,o=r===gt.VIDEO,c=await this._subscribeMutex.lock();try{const{ssrcId:u,ortc:h,rtxSsrcId:m,cname:_,uint_id:E}=await this._gateway.presubscribe(t,r,!0);if(u==null)throw new Oe(X.UNEXPECTED_RESPONSE,"no ssrc id");let S=this._users.find(P=>P.uid===t);S||(S=new Mm(t,E||t),S._is_pre_created=!0,this._users.push(S)),_&&(S._cname=_),S._uintid||(S._uintid=E||t),s&&(S._audioSSRC=u,S._audio_pre_subscribed=!0,h&&(S._audioOrtc=h)),o&&(S._videoSSRC=u,S._video_pre_subscribed=!0,h&&(S._videoOrtc=h),m!=null&&(S._rtxSsrcId=m)),L.info("[".concat(this._clientId,"] presub succeed ssrc: ").concat(u)),await this._p2pChannel.subscribe(S,r,u,m,h);const R=s?S._audioTrack:S._videoTrack;if(!R)throw new Oe(X.UNEXPECTED_ERROR,"can not find remote track in user");return s&&(S._trust_audio_stream_added_state_=!0,S._audio_added_=!0),o&&(S._trust_video_stream_added_state_=!0,S._video_added_=!0),R}catch(u){throw L.error("[".concat(this._clientId,"] presub user ").concat(t," error"),u),u}finally{c()}}async _subscribeDataChannel(t,r){var s;if(er(r,"channelId",0,65535,!0),!this._joinInfo)throw new Oe(X.INVALID_OPERATION,"Can't subscribe datachannel, not joined");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new Oe(X.INVALID_OPERATION,"Can't subscribe datachannel in ".concat(this.connectionState," state"));if(!this._users.find(m=>m===t))throw L.error("[".concat(this._clientId,"] can not subscribe ").concat(t.uid,", this user is not in the channel")),new Oe(X.INVALID_REMOTE_USER,"user is not in the channel");if(!t.hasAudio&&!t.hasVideo&&t._dataChannels.length===0)throw L.error("[".concat(this._clientId,"] can not subscribe ").concat(t.uid,", user is not published")),new Oe(X.INVALID_REMOTE_USER,"user is not published");const c=(s=t._dataChannels)===null||s===void 0?void 0:s.find(m=>m.id===r);if(!c)throw L.error("[".concat(this._clientId,"] can not subscribe ").concat(t.uid," with mediaType datachannel, remote datachannel is not published")),new Oe(X.REMOTE_USER_IS_NOT_PUBLISHED);const u=await this._subscribeMutex.lock();L.info("[".concat(this._clientId,"] subscribe user ").concat(t.uid,", mediaType: datachannel"));try{const m=await this._p2pChannel.subscribeDataChannel(t,[c]);if(m&&ot(m).call(m,c.id))try{var h;if(typeof c._originDataChannelId!="number")throw L.error("[".concat(this._clientId,"] can not subscribe ").concat(t.uid," with mediaType datachannel, cannot get RTCDatachannel")),new Oe(X.CREATE_DATACHANNEL_ERROR);const _={id:c.id,datachannelId:c._originDataChannelId,ordered:c.ordered,maxRetransmits:c.maxRetransmits,metadata:(h=c.metadata)!==null&&h!==void 0?h:""};await this._gateway.subscribeDataChannel(t.uid,_,!0),await c._waitTillOpen()}catch(_){if((_==null?void 0:_.code)!==X.WS_ABORT)throw await this._p2pChannel.unsubscribeDataChannel(t,[c]),_;await this._p2pChannel.unsubscribeDataChannel(t,[c]),this._p2pChannel.setPendingRemoteDataChannel(t,c.id)}return L.info("[".concat(this._clientId,"] subscribe success user ").concat(t.uid,", mediaType: datachannel")),c}finally{u()}}async _p2pSubscribe(t,r,s){if(Di(r,"mediaType",["audio","video"]),!this._joinInfo)throw new Oe(X.INVALID_OPERATION,"Can't subscribe stream, not joined");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new Oe(X.INVALID_OPERATION,"Can't subscribe stream in ".concat(this.connectionState," state"));if(!this._users.find(u=>u===t)){const u=new Oe(X.INVALID_REMOTE_USER,"user is not in the channel");throw L.error("[".concat(this._clientId,"] can not subscribe ").concat(t.uid,", this user is not in the channel")),u}if(!t.hasAudio&&!t.hasVideo){const u=new Oe(X.INVALID_REMOTE_USER,"user is not published");throw L.error("[".concat(this._clientId,"] can not subscribe ").concat(t.uid,", user is not published")),u}if(!s&&(r==="audio"&&!t.hasAudio||r==="video"&&!t.hasVideo)){const u=new Oe(X.REMOTE_USER_IS_NOT_PUBLISHED);throw L.error("[".concat(this._clientId,"] can not subscribe ").concat(t.uid," with mediaType ").concat(r,", remote track is not published")),u}const c=await this._subscribeMutex.lock();L.info("[".concat(this._clientId,"] subscribe user ").concat(t.uid,", mediaType: ").concat(r));try{if(await this._p2pChannel.hasRemoteMediaWithLock(t,r))await this._p2pChannel.unmuteRemote(t,r);else try{const h=r==="audio"?t._audioSSRC:t._videoSSRC,m=r==="audio"?t._audioMid:t._videoMid;this.store.subscribe(t.uid,r,Date.now()),this.store.useP2P&&await this._p2pChannel.subscribe(t,r,h,m)}catch(h){throw h}L.info("[".concat(this._clientId,"] subscribe success user ").concat(t.uid,", mediaType: ").concat(r)),this._defaultStreamFallbackType&&this.setStreamFallbackOption(t.uid,this._defaultStreamFallbackType).catch(h=>{L.warning("[".concat(this._clientId,"] auto set fallback failed"),h)});const u=r==="audio"?t._audioTrack:t._videoTrack;if(!u)throw new Oe(X.UNEXPECTED_ERROR,"can not find remote track in user object");return u}catch(u){throw L.error("[".concat(this._clientId,"] subscribe user ").concat(t.uid," error"),u),u}finally{c()}}async _subscribe(t,r,s){if(this.store.useP2P)return this._p2pSubscribe(t,r);if(Di(r,"mediaType",["audio","video"]),!this._joinInfo)throw new Oe(X.INVALID_OPERATION,"Can't subscribe stream, not joined");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new Oe(X.INVALID_OPERATION,"Can't subscribe stream in ".concat(this.connectionState," state"));if(!this._users.find(E=>E===t)){const E=new Oe(X.INVALID_REMOTE_USER,"user is not in the channel");throw L.error("[".concat(this._clientId,"] can not subscribe ").concat(t.uid,", this user is not in the channel")),E}if(!t.hasAudio&&!t.hasVideo){const E=new Oe(X.INVALID_REMOTE_USER,"user is not published");throw L.error("[".concat(this._clientId,"] can not subscribe ").concat(t.uid,", user is not published")),E}if(!(s||(r!=="audio"||t.hasAudio&&t._audioSSRC!==void 0)&&(r!=="video"||t.hasVideo&&t._videoSSRC!==void 0))){const E=new Oe(X.REMOTE_USER_IS_NOT_PUBLISHED);throw L.error("[".concat(this._clientId,"] can not subscribe ").concat(t.uid," with mediaType ").concat(r,", remote track is not published")),E}let c=r==="audio"?t._audioSSRC:t._videoSSRC,u=r==="audio"?t._audioOrtc:t._videoOrtc,h=r==="video"?t._rtxSsrcId:void 0,m={stream_type:r==="audio"?gt.AUDIO:gt.VIDEO,ssrcId:c};const _=await this._subscribeMutex.lock();L.info("[".concat(this._clientId,"] subscribe user ").concat(t.uid,", mediaType: ").concat(r));try{if(await this._p2pChannel.hasRemoteMediaWithLock(t,r))await this._p2pChannel.unmuteRemote(t,r);else try{const S=r==="audio"?t._audioSSRC:t._videoSSRC;S!==void 0&&S!==c&&(c=S,u=r==="audio"?t._audioOrtc:t._videoOrtc,h=r==="video"?t._rtxSsrcId:void 0,m={stream_type:r==="audio"?gt.AUDIO:gt.VIDEO,ssrcId:c}),Ls.markSubscribeStart(this.store.clientId,c),this.store.subscribe(t.uid,r,Date.now()),await this._p2pChannel.subscribe(t,r,c,h,u);try{this._p2pChannel.isPreSubScribe(c)||await this._gateway.subscribe(t.uid,m,!0)}catch(R){if((R==null?void 0:R.code)!==X.WS_ABORT)throw await this._p2pChannel.unsubscribe(t,r),R;await this._p2pChannel.unsubscribe(t,r,!0),this._p2pChannel.setPendingRemoteMedia(t,r)}this.store.subscribe(t.uid,r,void 0,Date.now()),this._p2pChannel.reportSubscribeEvent(!0,null,t,r)}catch(S){throw this._p2pChannel.reportSubscribeEvent(!1,S==null?void 0:S.code,t,r),S}L.info("[".concat(this._clientId,"] subscribe success user ").concat(t.uid,", mediaType: ").concat(r)),this._defaultStreamFallbackType&&this.setStreamFallbackOption(t.uid,this._defaultStreamFallbackType).catch(S=>{L.warning("[".concat(this._clientId,"] auto set fallback failed"),S)});const E=r==="audio"?t._audioTrack:t._videoTrack;if(!E)throw new Oe(X.UNEXPECTED_ERROR,"can not find remote track in user object");return E}catch(E){throw L.error("[".concat(this._clientId,"] subscribe user ").concat(t.uid," error"),E),E}finally{_()}}async massSubscribe(t){if(Yf(t,"subscribeList"),!this._joinInfo)throw new Oe(X.INVALID_OPERATION,"Can't subscribe stream, not joined");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new Oe(X.INVALID_OPERATION,"Can't subscribe stream in ".concat(this.connectionState," state"));const r=Date.now(),s=new Map,o=await this._subscribeMutex.lock();L.info("[".concat(this._clientId,"]start massSubscribe user ").concat(t.map(m=>{let{user:_,mediaType:E}=m;return"user: ".concat(_==null?void 0:_.uid,", mediaType: ").concat(E)}).join("; ")));const c=(t=[...t]).map(m=>{let{user:_,mediaType:E}=m;return{user:_,mediaType:E}}),u=await this._p2pChannel.globalLock();try{var h;for(let _=t.length-1;_>=0;_--){const E=t[_],{user:S,mediaType:R}=E;if(Di(R,"mediaType",["audio","video"]),!S){const U=new Oe(X.INVALID_PARAMS,"user property does not exist in subscribeList item");throw L.error("[".concat(this._clientId,"] user property does not exist in subscribeList item")),U}if(!this._users.find(U=>U===S)){const U=new Oe(X.INVALID_REMOTE_USER,"user is not in the channel");L.error("[".concat(this._clientId,"] can not massSubscribe ").concat(S.uid,", this user is not in the channel")),c[_].error=U,t.splice(_,1);continue}if(R==="audio"&&(!S.hasAudio||S._audioSSRC===void 0)||R==="video"&&(!S.hasVideo||S._videoSSRC===void 0)){const U=new Oe(X.REMOTE_USER_IS_NOT_PUBLISHED);L.error("[".concat(this._clientId,"] can not subscribe ").concat(S.uid," with mediaType ").concat(R,", remote user is not published")),c[_].error=U,t.splice(_,1);continue}const k=Hi.Video|Hi.LwoVideo,z=s.get(S);if(z){if(R==="video"?z&k:z&Hi.Audio){t.splice(_,1),L.warning("[".concat(this._clientId,"] repeat massSubscribe user:").concat(S.uid,", mediaType:").concat(R," twice"));continue}s.set(S,z|(R==="video"?k:Hi.Audio))}else s.set(S,R==="video"?k:Hi.Audio)}for(let _=t.length-1;_>=0;_--){const E=t[_],{user:S,mediaType:R}=E,P=Hi.Video|Hi.LwoVideo;if(this._p2pChannel.hasRemoteMedia(S,R)){await this._p2pChannel.unmuteRemoteNoLock(S,R);const k=s.get(S);s.set(S,R==="video"?k^P:k^Hi.Audio),t.splice(_,1)}}this.store.massSubscribe(t.map(_=>({userId:_.user.uid,type:_.mediaType})),r);let m=Ya(h=Array.from(s.entries())).call(h,(_,E)=>{let[S,R]=E;if(R===0)return _;const P={stream_id:S.uid,stream_type:R};return R&Hi.Audio&&(P.audio_ssrc=S._audioSSRC),R&Hi.Video&&(P.video_ssrc=S._videoSSRC),_.push(P),_},[]);try{t.length>0&&await this._p2pChannel.massSubscribeNoLock(t.map(E=>{let{user:S,mediaType:R}=E;return{user:S,mediaType:R,ssrcId:R===gt.VIDEO?S._videoSSRC:S._audioSSRC,rtxSsrcId:R===gt.VIDEO?S._rtxSsrcId:void 0}}));const _=new Map;if(m=m.filter(E=>E.video_ssrc&&!this._p2pChannel.isPreSubScribe(E.video_ssrc)||E.audio_ssrc&&!this._p2pChannel.isPreSubScribe(E.audio_ssrc)||!E.video_ssrc&&!E.audio_ssrc),m.length>0){const E=await this._gateway.subscribeAll(m,!0);((E==null?void 0:E.users)||[]).forEach(S=>{let{stream_id:R,video_error_code:P,audio_error_code:k,error_code:z}=S;(P||k||z)&&_.set(R,{video_error_code:P,audio_error_code:k,error_code:z})})}if(Array.from(_.entries()).length>0){const E=[];Array.from(_.entries()).forEach(S=>{let[R,P]=S;const k=this.remoteUsers.find(z=>z.uid===R);if(k){let z;P.error_code||P.video_error_code&&P.audio_error_code?z=void 0:P.video_error_code?z=gt.VIDEO:P.audio_error_code&&(z=gt.AUDIO),E.push({user:k,mediaType:z})}}),E.length>0&&await this._p2pChannel.massUnsubscribeNoLock(E)}for(const E of c){const S=_.get(E.user.uid);if(S){const R=S.error_code||E.mediaType==="audio"&&S.audio_error_code||E.mediaType==="video"&&S.video_error_code;if(R){const P=CT(R);L.error("user:".concat(E.user.uid," mediaType:").concat(E.mediaType," has massSubscribe error ").concat(P.desc)),E.error=new Oe(X.SUBSCRIBE_FAILED,"code ".concat(R,": ").concat(P.desc))}}E.error||(E.mediaType==="video"?E.track=E.user.videoTrack:E.track=E.user.audioTrack)}return this.store.massSubscribe(c.filter(E=>!E.error).map(E=>({userId:E.user.uid,type:E.mediaType})),void 0,Date.now()),c.forEach(E=>{var S;Rt.subscribe(this.store.sessionId,{succ:!!E.error,ec:((S=E.error)===null||S===void 0?void 0:S.code)||null,video:E.mediaType===gt.VIDEO,audio:E.mediaType===gt.AUDIO,peerid:E.user.uid,subscribeRequestid:E.mediaType===gt.VIDEO?E.user._videoSSRC:E.user._audioSSRC,p2pid:this.store.p2pId,eventElapse:Math.floor(performance.now()-r),preSsrc:this._p2pChannel.isPreSubScribe(E.user._videoSSRC)},!0)}),L.info("[".concat(this._clientId,"] massSubscribe success ").concat(t.map(E=>{let{user:S,mediaType:R}=E;return"user: ".concat(S==null?void 0:S.uid,", mediaType: ").concat(R)}).join("; "))),c}catch(_){throw await this._p2pChannel.massUnsubscribeNoLock(t),_}}finally{u(),o()}}async unsubscribe(t,r,s){if(!(t instanceof Mm)){const u=this.remoteUsers.find(h=>h.uid===t);if(!u)throw new Oe(X.INVALID_REMOTE_USER,"user is not in the channel");t=u}if(r||this.store.useP2P){if(r==="datachannel")return this._unsubscribeDataChannel(t,s)}else await this._unsubscribeDataChannel(t,s);if(r&&Di(r,"mediaType",["audio","video"]),!this._joinInfo)throw new Oe(X.INVALID_OPERATION,"Can't unsubscribe stream, haven't joined yet!");if(!this._users.find(u=>u===t)){const u=new Oe(X.INVALID_REMOTE_USER,"user is not in the channel");throw L.error("[".concat(this._clientId,"] can not unsubscribe ").concat(t.uid,", user is not in the channel")),u}L.info("[".concat(this._clientId,"] unsubscribe uid: ").concat(t.uid,", mediaType: ").concat(r));const c=await this._subscribeMutex.lock();try{if(this.store.useP2P)await this._p2pChannel.unsubscribe(t,r);else{const u=await this._p2pChannel.unsubscribe(t,r);u&&await this._gateway.unsubscribe(u,t.uid),r&&r!=="audio"||(t._audio_pre_subscribed=!1),r&&r!=="video"||(t._video_pre_subscribed=!1),t._is_pre_created&&jA(this._users,t),L.info("[".concat(this._clientId,"] unsubscribe success uid: ").concat(t.uid,", mediaType: ").concat(r))}}catch(u){if(u.code===X.DISCONNECT_P2P)return void L.warning("disconnecting p2p, abort unsubscribe request.");throw L.error("[".concat(this._clientId,"] unsubscribe user ").concat(t.uid," error"),u.toString()),u}finally{c()}}async _unsubscribeDataChannel(t,r){if(r&&er(r,"id",0,65535,!0),!this._joinInfo)throw new Oe(X.INVALID_OPERATION,"Can't unsubscribe datachannel, haven't joined yet!");if(!this._users.find(c=>c===t)){const c=new Oe(X.INVALID_REMOTE_USER,"user is not in the channel");throw L.error("[".concat(this._clientId,"] can not unsubscribe ").concat(t.uid,", user is not in the channel")),c}let o;if(typeof r=="number"){const c=t._dataChannels.find(u=>u.id===r);c&&(o=[c])}else o=t._dataChannels;if(o===void 0){const c=new Oe(X.REMOTE_USER_IS_NOT_PUBLISHED);throw L.error("[".concat(this._clientId,"] can not unsubscribe ").concat(t.uid," with channelId ").concat(r,", remote datachannel is not published")),c}L.info("[".concat(this._clientId,"] unsubscribe uid: ").concat(t.uid,", mediaType: datachannel, ids: ").concat(o.map(c=>c.id)));try{const c=await this._p2pChannel.unsubscribeDataChannel(t,o);c&&await this._gateway.unsubscribeDataChannel(c,t.uid),L.info("[".concat(this._clientId,"] unsubscribe datachannel success uid: ").concat(t.uid,", mediaType: datachannel, ids: ").concat(c))}catch(c){if(c.code===X.DISCONNECT_P2P)return void L.warning("disconnecting p2p, abort unsubscribe request.");throw L.error("[".concat(this._clientId,"] unsubscribe user ").concat(t.uid," error"),c.toString()),c}}async massUnsubscribe(t){if(Yf(t,"unsubscribeList"),!this._joinInfo)throw new Oe(X.INVALID_OPERATION,"Can't unsubscribeAll stream, haven't joined yet!");L.info("[".concat(this._clientId,"] start massUnsubscribe ").concat(t.map(s=>{let{user:o,mediaType:c}=s;return"user: ".concat(o==null?void 0:o.uid,", mediaType: ").concat(c,";")}).join())),t=[...t];const r=new Map;for(let s=t.length-1;s>=0;s--){const{user:o,mediaType:c}=t[s];if(!o){const m=new Oe(X.INVALID_PARAMS,"user property does not exist in unsubscribeList item");throw L.error("[".concat(this._clientId,"] user property does not exist in unsubscribeList item")),m}if(Di(c,"mediaType",["video","audio",void 0]),!this._users.find(m=>m===o)){L.warning("[".concat(this._clientId,"] can not unsubscribe ").concat(o.uid,", user is not in the channel")),t.splice(s,1);continue}const h=Hi.Video|Hi.LwoVideo;if(r.has(o)){const m=r.get(o);let _;switch(c){case"video":_=m&h;break;case"audio":_=m&Hi.Audio;break;default:_=m&(Hi.Audio|h)}if(_){L.warning("[".concat(this._clientId,"] repeat massUnsubscribe user:").concat(o.uid,",mediaType:").concat(c," twice.")),t.splice(s,1);continue}c?c==="audio"?r.set(o,m|Hi.Audio):c==="video"&&r.set(o,m|h):r.set(o,m|Hi.Audio|h)}else c?c==="audio"?r.set(o,Hi.Audio):c==="video"&&r.set(o,h):r.set(o,Hi.Audio|h)}try{const s=await this._p2pChannel.massUnsubscribe(t);s&&await this._gateway.massUnsubscribe(s),L.info("[".concat(this._clientId,"] massUnsubscribe success ").concat(t.map(o=>{let{user:c,mediaType:u}=o;return"user: ".concat(c==null?void 0:c.uid,", mediaType: ").concat(u,";")}).join()))}catch(s){if(s.code===X.DISCONNECT_P2P)return void L.warning("[".concat(this._clientId,"] disconnecting p2p, abort unsubscribe request."));throw L.error("[".concat(this._clientId,"] massUnsubscribe error"),s.toString()),s}}async setLowStreamParameter(t){(function(s){if(!s)throw new Le(X.INVALID_PARAMS);Lr(s.width)||zL(s.width,"streamParameter.width"),Lr(s.height)||zL(s.height,"streamParameter.height"),Lr(s.framerate)||zL(s.framerate,"streamParameter.framerate"),Lr(s.bitrate)||er(s.bitrate,"streamParameter.bitrate")})(t),(!t.width&&t.height||t.width&&!t.height)&&L.warning("[".concat(this._clientId,"] The width and height parameters take effect only when both are set")),L.info("[".concat(this._clientId,"] set low stream parameter to"),JSON.stringify(t));const r=this._configDistribute.getLowStreamConfigDistribute();if(r&&r.bitrate&&t.bitrate&&r.bitrate<t.bitrate&&(t.bitrate=r.bitrate),this._lowStreamParameter=t,this._isDualStreamEnabled)return this._p2pChannel.updateVideoStreamParameter(t,$e.LocalVideoLowTrack)}async enableDualStream(){if(!kn().supportDualStream)throw Rt.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!0,succ:!1}),new Oe(X.NOT_SUPPORTED,"Your browser is not support dual stream");if(this._isDualStreamEnabled)throw new Oe(X.INVALID_OPERATION,"Dual stream is already enabled");if(this._p2pChannel.canPublishLowStream())try{await this._publishLowStream()}catch(t){throw Rt.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!0,succ:!1}),t}this._isDualStreamEnabled=!0,Rt.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!0,succ:!0}),L.info("[".concat(this._clientId,"] enable dual stream"))}async disableDualStream(){if(this._isDualStreamEnabled){if(!this._joinInfo)throw new Oe(X.INVALID_OPERATION,"Can't publish stream, haven't joined yet!");if(this._p2pChannel.getLocalMedia($e.LocalVideoLowTrack))try{const t=await this._p2pChannel.unpublishLowStream();t&&await this._gateway.unpublish(t,this._joinInfo.stringUid||this._joinInfo.uid)}catch(t){throw Rt.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!1,succ:!1}),t}this._isDualStreamEnabled=!1,Rt.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!1,succ:!0}),L.info("[".concat(this._clientId,"] disable dual stream"))}}async setClientRole(t,r){if(function(o){Di(o,"role",["audience","host"])}(t),r&&KL(r),this.mode==="rtc"||this.mode==="p2p")throw L.warning("[".concat(this._clientId,"]").concat(this.mode," mode can not use setClientRole")),new Oe(X.INVALID_OPERATION,"".concat(this.mode," mode can not use setClientRole"));if(r&&r.level&&t==="host")throw new Oe(X.INVALID_OPERATION,"host mode can not set audience latency level");if(t==="audience"&&this._p2pChannel.hasLocalMedia())throw new Oe(X.INVALID_OPERATION,"can not set client role to audience when publishing stream");const s=this._config.role;this._joinInfo&&(this._joinInfo.role=t),t!==s&&re("ENABLE_ROLE_SELECT_EDGE")?(this._gateway.updateClientRole(t,r),this._config.role=t,this._gateway.reconnect("recover",bs.REGIONAL_DISTRIBUTION)):(await this._gateway.setClientRole(t,r),this._config.role=t),L.info("[".concat(this._clientId,"] set client role to ").concat(t,", level: ").concat(r&&r.level))}async _setClientRoleOptions(t){if(this.mode==="rtc"||this.mode==="p2p"||this._config.role!=="audience"||this._p2pChannel.hasLocalMedia())return;let r=!1;try{t&&KL(t),await this._gateway.setClientRole(this._config.role,t),r=!0}catch{}finally{L.info("[".concat(this._clientId,"] set client role options ").concat(r?"succeed":"failed",", options is ").concat(t))}}getRemoteInboundOffset(){var t;const r=(t=this._p2pChannel.getStats())===null||t===void 0?void 0:t.audioSend[0];if(!r||!r.timestamp)return 0;const s=r.timestamp-Date.now();return Math.abs(s)>1e3+r.rttMs+100?this.ntpAlignErrorCount+=1:this.ntpAlignErrorCount=0,this.ntpAlignErrorCount>=3?s:0}getNtpWallTimeInMs(){return document.visibilityState==="visible"&&(this.remoteInboundOffset=this.getRemoteInboundOffset()),this.remoteInboundOffset+Date.now()+this._gateway.ntpOffset}setProxyServer(t,r){if(ss(t,"proxyServer"),!r){if(this.connectionState!=="DISCONNECTED")throw new Oe(X.INVALID_OPERATION,"Set proxy server before join channel");if(this._cloudProxyServerMode!=="disabled"||this._useLocalAccessPoint)throw new Oe(X.INVALID_OPERATION,"You have already set the proxy")}this._proxyServer=t,Rt.setProxyServer(this._proxyServer),L.setProxyServer(this._proxyServer),L.info("[".concat(this._clientId,"] Set proxy server ").concat(r?"by initialize call":""," success."))}setTurnServer(t,r){if(Array.isArray(t)||(t=[t]),!r){if(this.connectionState!=="DISCONNECTED")throw new Oe(X.INVALID_OPERATION,"Set turn server before join channel");if(this._cloudProxyServerMode!=="disabled"||this._useLocalAccessPoint)throw new Oe(X.INVALID_OPERATION,"You have already set the proxy")}if(gT(t))return this._turnServer={servers:t,mode:"original-manual"},void L.info("[".concat(this._clientId,"] Set original turnserver ").concat(r?"by initialize call":""," success: ").concat(t.map(s=>s.urls).join(","),"."));t.forEach(s=>ZW(s)),this._turnServer={servers:t,mode:"manual"},L.info("[".concat(this._clientId,"] Set turnserver ").concat(r?"by initialize call":""," success."))}setLicense(t){if(this.connectionState!=="DISCONNECTED")throw new Oe(X.INVALID_OPERATION,"you should set license before join channel");if(ss(t,"license",32,32),!/^[A-Za-z\d]+$/.test(t))throw new Oe(X.INVALID_PARAMS,"license should only contains characters from A-Z a-z 0-9");this._license=t,L.info("[".concat(this._clientId,"] set license success"),t)}startProxyServer(t){if(this.connectionState!=="DISCONNECTED")throw new Oe(X.INVALID_OPERATION,"Start proxy server before join channel");if(this._proxyServer||this._turnServer.mode==="manual"||this._useLocalAccessPoint)throw new Oe(X.INVALID_OPERATION,"You have already set the proxy");const r=[3,4,5];let s;switch(t===void 0&&(t=3),t){case 1:case 2:throw new Oe(X.NOT_SUPPORTED,"proxy mode 1/2 has been deprecated and not supported.");case 3:s="proxy3";break;case 4:s="proxy4";break;case 5:s="proxy5";break;default:throw new Oe(X.INVALID_PARAMS,"proxy server mode must be ".concat(r.join("|")))}this._cloudProxyServerMode=s,this.store.cloudProxyServerMode=s,L.info("[".concat(this._clientId,"] set cloud proxy server mode to"),this._cloudProxyServerMode)}stopProxyServer(){if(this.connectionState!=="DISCONNECTED")throw new Oe(X.INVALID_OPERATION,"Stop proxy server after leave channel");Rt.setProxyServer(),L.setProxyServer(),this._cloudProxyServerMode="disabled",this.store.cloudProxyServerMode="disabled",L.info("[".concat(this._clientId,"] set cloud proxy server mode to"),this._cloudProxyServerMode),this._proxyServer=void 0,this._turnServer={mode:"auto",servers:[]}}setLocalAccessPointsV2(t){if(!t.accessPoints)throw new Oe(X.INVALID_PARAMS,"accessPoints is required.");Yf(t.accessPoints.serverList,"accessPoints.serverList"),ss(t.accessPoints.domain,"accessPoints.domain");const r=(P,k)=>{er(P,k,0,65535,!0)};let s=443;if(t.accessPoints.port&&(r(t.accessPoints.port,"accessPoints.port"),s=t.accessPoints.port),this._proxyServer||this._cloudProxyServerMode!=="disabled")throw new Oe(X.INVALID_OPERATION,"set local access point failed, You have already set the cloud proxy");re("CLOSE_AFB_FOR_LOCAL_AP")&&(Xn("JOIN_WITH_FALLBACK_SIGNAL_PROXY",!1),Xn("JOIN_WITH_FALLBACK_MEDIA_PROXY",!1));const o=/^((\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.){3}(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])$/,c=t.accessPoints.domain,u=t.accessPoints.serverList.map(P=>o.test(P)?"".concat(P.replace(/\./g,"-"),".").concat(c):P),h=u.map(P=>"".concat(P,":").concat(s));this._useLocalAccessPoint=!0,this._setLocalAPVersion=2,Xn("WEBCS_DOMAIN",h),Xn("WEBCS_DOMAIN_BACKUP_LIST",h),Xn("GATEWAY_DOMAINS",[c]),t.report&&t.report.hostname&&Array.isArray(t.report.hostname)&&t.report.hostname.length?(Yf(t.report.hostname,"report.hostname"),Xn("EVENT_REPORT_DOMAIN",t.report.hostname[0]),Xn("EVENT_REPORT_BACKUP_DOMAIN",t.report.hostname[1]||t.report.hostname[0])):(Xn("EVENT_REPORT_DOMAIN",u[0]),Xn("EVENT_REPORT_BACKUP_DOMAIN",u[1]||u[0]));let m=6443;t.report&&t.report.port&&(r(t.report.port,"report.port"),m=t.report.port),Xn("STATS_COLLECTOR_PORT",m),t.report?Xn("ENABLE_EVENT_REPORT",!0):Xn("ENABLE_EVENT_REPORT",!1);let _="";t.log&&t.log.hostname&&Array.isArray(t.log.hostname)&&t.log.hostname.length?(Yf(t.log.hostname,"log.hostname"),_=t.log.hostname[0]):_=u[0];let E=6444;t.log&&t.log.port&&(r(t.log.port,"log.port"),E=t.log.port),Xn("LOG_UPLOAD_SERVER","".concat(_,":").concat(E));let S=[];t.cds&&t.cds.hostname&&Array.isArray(t.cds.hostname)&&t.cds.hostname.length?(Yf(t.cds.hostname,"cds.hostname"),S=t.cds.hostname):S=u;let R=443;t.cds&&t.cds.port&&(r(t.cds.port,"cds.port"),R=t.cds.port),Xn("CDS_AP",S.map(P=>"".concat(P,":").concat(R))),t.cds?Xn("ENABLE_CONFIG_DISTRIBUTE",!0):Xn("ENABLE_CONFIG_DISTRIBUTE",!1),L.info("set local access point v2 success")}setLocalAccessPoints(t,r){if(Yf(t,"serverList"),ss(r,"domain"),this._proxyServer||this._cloudProxyServerMode!=="disabled")throw new Oe(X.INVALID_OPERATION,"set local access point failed, You have already set the cloud proxy");const s=/^(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])$/;t=t.map(o=>s.test(o)?"".concat(o.replace(/\./g,"-"),".").concat(r):o),this._useLocalAccessPoint=!0,this._setLocalAPVersion=1,Xn("WEBCS_DOMAIN",t),Xn("WEBCS_DOMAIN_BACKUP_LIST",t),Xn("GATEWAY_DOMAINS",[r]),Xn("EVENT_REPORT_DOMAIN",t[0]),Xn("EVENT_REPORT_BACKUP_DOMAIN",t[1]||t[0]),Xn("LOG_UPLOAD_SERVER","".concat(t[0],":6444")),L.info("[".concat(this._clientId,"] set local access point success"))}async setRemoteDefaultVideoStreamType(t){if(Di(t,"streamType",[0,1,4,5,6,7,8,9]),this._remoteDefaultVideoStreamType=t,this._joinInfo)try{await this._gateway.setDefaultRemoteVideoStreamType(t),this._joinInfo.defaultVideoStream=this._remoteDefaultVideoStreamType}catch(r){throw L.error("[".concat(this._clientId,"] set default remote video stream type error"),r.toString()),r}else L.debug("[".concat(this._clientId,"] haven't joined yet, cache remoteDefaultVideoStreamType ").concat(t))}async setRemoteVideoStreamType(t,r){Di(r,"streamType",[0,1,4,5,6,7,8,9]);try{await this._gateway.setRemoteVideoStreamType(t,r),setTimeout(()=>{const s=this._users.find(o=>o.uid===t);s&&s.videoTrack&&s.videoTrack.updateMediaStreamTrackResolution()},2e3)}catch(s){throw L.error("[".concat(this._clientId,"] set remote video stream type error"),s.toString()),s}L.info("[".concat(this._clientId,"] set remote ").concat(t," video stream type to ").concat(r)),this._remoteStreamTypeCacheMap.set(t,r)}async setStreamFallbackOption(t,r){Di(r,"fallbackType",[0,1,2,3,4,5,6,7,8]);try{await this._gateway.setStreamFallbackOption(t,r)}catch(s){throw L.error("[".concat(this._clientId,"] set stream fallback option"),s.toString()),s}L.info("[".concat(this._clientId,"] set remote ").concat(t," stream fallback type to ").concat(r)),this._streamFallbackTypeCacheMap.set(t,r)}setEncryptionConfig(t,r,s,o){(function(u){Di(u,"encryptionMode",["aes-128-xts","aes-256-xts","aes-128-ecb","sm4-128-ecb","aes-128-gcm","aes-256-gcm","aes-128-gcm2","aes-256-gcm2","none"])})(t),ss(r,"secret");const c=["aes-128-gcm2","aes-256-gcm2"];if(ot(c).call(c,t)){if(!s||!(s instanceof Uint8Array&&s.length===32))throw new Oe(X.INVALID_PARAMS,"salt must be an Uint8Array and exactly equal to 32 bytes")}else if(s)throw new Oe(X.INVALID_PARAMS,"current encrypt mode does not need salt");if(o){if(qf(o,"encryptDataStream"),!ot(c).call(c,t))throw new Oe(X.INVALID_PARAMS,"current encrypt mode does not support data stream");this._encryptDataStream=!0}new RegExp(`^(?=.*[a-z])(?=.*[A-Z])(?=.*[0-9])(?=.*[!@#$%^&*,.<>?/:;'"|{}\\[\\]])(?=.{8,})`).test(r)||L.warning(`The secret is not strong:
      The secret must contain at least 1 lowercase alphabetical character,
      The secret must contain at least 1 uppercase alphabetical character,
      The secret must contain at least 1 numeric character,
      The secret must contain at least one special character,
      The secret must be eight characters or longer.
      `),this._encryptionMode=t,this._encryptionSecret=r,s&&(this._encryptionSalt=Am(s))}async renewToken(t){if(ss(t,"token",1,2047),!this._key||!this._joinInfo)throw new Oe(X.INVALID_OPERATION,"renewToken should not be called before user join");const r=this._key;this._key=t,this._joinInfo&&(this._joinInfo.token=t);const s=await this._renewTokenMutex.lock();try{if(re("USE_NEW_TOKEN")){L.debug("[".concat(this._clientId,"] start renew token with ticket from unilbs"));const o=await Lme(this._joinInfo,this._axiosCancelSource.token,this._config.httpRetryConfig||bi);L.debug("[".concat(this._clientId,"] get ticket from unilbs success")),await this._gateway.renewToken({token:t,ticket:o})}else L.debug("[".concat(this._clientId,"] start renew token without ticket")),await this._gateway.renewToken({token:t});L.debug("[".concat(this._clientId,"] renewToken success"))}catch(o){throw this._key=r,this._joinInfo.token=r,L.error("[".concat(this._clientId,"] renewToken failed"),o.toString()),o}finally{s()}}enableAudioVolumeIndicator(){this._audioVolumeIndicationInterval?L.warning("you have already enabled audio volume indicator!"):this._audioVolumeIndicationInterval=window.setInterval(()=>{const t=this._p2pChannel.getAudioLevels();this.safeEmit(mn.VOLUME_INDICATOR,t)},re("AUDIO_VOLUME_INDICATION_INTERVAL")||2e3)}getRTCStats(){const t=this._statsCollector.getRTCStats(),r=this._gateway.getInChannelInfo();return t.Duration=Math.round(r.duration/1e3),t}async startLiveStreaming(t,r){if(!r){if(this.codec!=="h264")throw new Oe(X.LIVE_STREAMING_INVALID_RAW_STREAM,"raw streaming is only support h264");if(!this._p2pChannel.hasLocalMedia())throw new Oe(X.LIVE_STREAMING_INVALID_RAW_STREAM,"can not find stream to raw streaming")}if(this._liveRawStreamingClient&&this._liveRawStreamingClient.hasUrl(t)||this._liveTranscodeStreamingClient&&this._liveTranscodeStreamingClient.hasUrl(t))throw new Oe(X.LIVE_STREAMING_TASK_CONFLICT);const s=r?Qf.TRANSCODE:Qf.RAW;return this._createLiveStreamingClient(s).startLiveStreamingTask(t,s)}setLiveTranscoding(t){return this._createLiveStreamingClient(Qf.TRANSCODE).setTranscodingConfig(t)}async stopLiveStreaming(t){const r=[this._liveRawStreamingClient,this._liveTranscodeStreamingClient].filter(s=>s&&s.hasUrl(t));if(!r.length)throw new Oe(X.INVALID_PARAMS,"can not find live streaming url to stop");await lt.all(r.map(s=>s&&s.stopLiveStreamingTask(t)))}async startChannelMediaRelay(t){UH(t),await this._createChannelMediaRelayClient().startChannelMediaRelay(t)}async updateChannelMediaRelay(t){UH(t),await this._createChannelMediaRelayClient().updateChannelMediaRelay(t)}async stopChannelMediaRelay(){await this._createChannelMediaRelayClient().stopChannelMediaRelay(),this._statsCollector.onStatsChanged&&(this._statsCollector.onStatsChanged=void 0)}sendAudioMetadata(t){this._p2pChannel instanceof MT&&this._p2pChannel.addAudioMetadata(t)}async sendStreamMessage(t){var r;let s=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1];if(!this._joinInfo)throw new Oe(X.INVALID_OPERATION,"can not send data stream, not joined");if((typeof t=="string"||t instanceof Uint8Array)&&(t={payload:t}),typeof t.payload=="string"){const c=new TextEncoder;t.payload=c.encode(t.payload)}let o=!1;if(this._encryptDataStream&&this._encryptDataStreamIv&&this._encryptDataStreamKey&&window.crypto.subtle&&ot(r=["aes-128-gcm2","aes-256-gcm2"]).call(r,this._encryptionMode)&&(o=!0,t.payload=await async function(c,u,h){var m;const _=Ya(m=Array.from(h)).call(m,(U,F)=>U+F,0),E={serverTs:0,seq:npe++,length:h.length,checkSum:_},S=new Uint8Array(a8(_,2)),R=new ArrayBuffer(Lv),P=new DataView(R);P.setUint32(0,E.serverTs),P.setUint16(4,E.seq),P.setUint16(6,E.length),P.setUint16(8,E.checkSum);const k=16-h.length%16;h=n8(h,new Uint8Array(k));const z=await window.crypto.subtle.encrypt({name:"AES-GCM",iv:c,tagLength:v8,additionalData:S},u,h);return n8(new Uint8Array(R),new Uint8Array(z))}(this._encryptDataStreamIv,this._encryptDataStreamKey,t.payload)),new Blob([t.payload]).size>1024)throw new Oe(X.INVALID_PARAMS,o?"encrypted stream message out of range.":"stream message out of range.");return this._gateway.signal.request(jt.DATA_STREAM,{payload:Am(t.payload),syncWithAudio:t.syncWithAudio,sendTs:Date.now()-zme},!s)}sendMetadata(t){if(!this._joinInfo)throw new Oe(X.INVALID_OPERATION,"can not send metadata, not joined");if(new Blob([t]).size>1024)throw new Oe(X.METADATA_OUT_OF_RANGE);return this._gateway.signal.request(jt.SEND_METADATA,{session_id:this._joinInfo.sid,metadata:Am(t)})}async sendCustomReportMessage(t){if(Array.isArray(t)||(t=[t]),t.forEach(dpe),!this._joinInfo)throw new Oe(X.INVALID_OPERATION,"can not send custom report, not joined");await Rt.sendCustomReportMessage(this._joinInfo.sid,t)}getLocalAudioStats(){return this._statsCollector.getLocalAudioTrackStats()}getRemoteAudioStats(){return this._statsCollector.getRemoteAudioTrackStats()}getLocalVideoStats(){return this._statsCollector.getLocalVideoTrackStats()}getRemoteVideoStats(){return this._statsCollector.getRemoteVideoTrackStats()}getRemoteNetworkQuality(){return this._statsCollector.getRemoteNetworkQualityStats()}async pickSVCLayer(t,r){Di(r.spatialLayer,"spatialLayer",[0,1,2,3]),Di(r.temporalLayer,"temporalLayer",[0,1,2,3]);try{await this._gateway.pickSVCLayer(t,r)}catch(s){throw L.error("[".concat(this._clientId,"] pick SVC layer failed"),s.toString()),s}}async setRTMConfig(t){const{apRTM:r=!1,rtmFlag:s}=t;if(qf(r,"apRTM"),er(s,"rtmFlag",0),this._rtmConfig.apRTM=r,this._rtmConfig.rtmFlag=s,L.debug("[".concat(this._clientId,"] setRTMconfig ").concat(JSON.stringify(t)," in ").concat(this.connectionState," state")),(this.connectionState==="CONNECTED"||this.connectionState==="RECONNECTING")&&this._joinInfo)return this._joinInfo.apRTM=r,this._joinInfo.rtmFlag=s,this._gateway.setRTM2Flag(s)}_reset(){if(L.debug("[".concat(this._clientId,"] reset client")),function(t){const r=Kv.indexOf(t);r!==-1&&Kv.splice(r,1)}(this._clientId),this.store.hasStartJoinChannel=!1,this.store.isABTestSuccess=!1,this._axiosCancelSource.cancel(),this._axiosCancelSource=$o.CancelToken.source(),this._streamFallbackTypeCacheMap=new Map,this._remoteStreamTypeCacheMap=new Map,this._configDistribute.stopGetConfigDistribute(),this._joinInfo&&h9(this._joinInfo),this._joinInfo=void 0,this._proxyServer=void 0,this._defaultStreamFallbackType=void 0,this._sessionId&&Rt.removeSid(this._sessionId),this._sessionId=null,this.store.sessionId=null,this._statsCollector.reset(),this._key=void 0,this._appId=void 0,this._uid=void 0,this.store.uid=void 0,this._channelName=void 0,this._encryptionMode="none",this._encryptionSecret=null,this._encryptionSalt=null,this._encryptDataStreamKey=null,this._encryptDataStreamIv=null,this._pendingPublishedUsers=[],this._users.forEach(t=>{t._audioTrack&&t._audioTrack._destroy(),t._videoTrack&&t._videoTrack._destroy(),t._dataChannels&&(t._dataChannels.forEach(r=>r._close()),t._dataChannels.length=0)}),this._users=[],this._audioVolumeIndicationInterval&&(window.clearInterval(this._audioVolumeIndicationInterval),this._audioVolumeIndicationInterval=void 0),this._cloudProxyServerMode==="fallback"&&(this._cloudProxyServerMode="disabled",this.store.cloudProxyServerMode="disabled"),this._p2pChannel.reset(),this._publishMutex=new ks("client-publish",this._clientId),this._subscribeMutex=new ks("client-subscribe",this._clientId),this._networkQualityInterval&&(window.clearInterval(this._networkQualityInterval),this._networkQualityInterval=void 0),this._liveRawStreamingClient&&(this._liveRawStreamingClient.terminate(),this._liveRawStreamingClient.removeAllListeners(),this._liveRawStreamingClient=void 0),this._liveTranscodeStreamingClient&&(this._liveTranscodeStreamingClient.terminate(),this._liveTranscodeStreamingClient.removeAllListeners(),this._liveTranscodeStreamingClient=void 0),this._channelMediaRelayClient&&(this._channelMediaRelayClient.dispose(),this._channelMediaRelayClient=void 0),this._inspect)try{this._inspect.close(),this._inspect=void 0}catch{}if(this._moderation)try{this.setImageModeration(!1)}catch{}}_startSession(t,r){var s;const o=t||L_();t?L.debug("[".concat(this._clientId,"] new Session ").concat(o)):L.debug("[".concat(this._clientId,"] renewSession ").concat(this._sessionId," => ").concat(o));const c=t?"":this._sessionId||"";this._sessionId=o,this.store.sessionId=o,Rt.addSid(o);const u={lts:new Date().getTime(),mode:this.mode,buildFormat:1,stringUid:(r==null?void 0:r.stringUid)||((s=this._joinInfo)===null||s===void 0?void 0:s.stringUid),channelProfile:this.mode==="live"?1:0,channelMode:0,isABTestSuccess:Number(this._configDistribute.isSuccess),lsid:c,clientRole:this.role==="audience"?2:1};Rt.sessionInit(this._sessionId,_u({cname:r.channel,appid:r.appId},u)),this._joinInfo&&(this._joinInfo.sid=o),this._gateway.joinInfo&&(this._gateway.joinInfo.sid=o)}async _publishHighStream(t){if(!this._joinInfo||this._uid===void 0)throw new Oe(X.INVALID_OPERATION,"Can't publish stream, haven't joined yet!");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new Oe(X.INVALID_OPERATION,"can not publish stream in ".concat(this.connectionState," state"));if(this._turnServer.mode==="auto"&&re("FORCE_TURN")&&!re("TURN_ENABLE_TCP")&&!re("TURN_ENABLE_UDP"))throw new Oe(X.UNEXPECTED_ERROR,"force TURN With No TURN Configuration");L.debug("[".concat(this._clientId,"] publish high stream"));try{const s=await this._p2pChannel.publish(t,this._isDualStreamEnabled,this._lowStreamParameter);if(this.store.useP2P){const o=(await s.next()).value;if(o){try{await this._gateway.sendExtensionMessage(Zr.PUBLISH,o,!0)}catch(c){throw s.throw(c),c}await s.next()}this._p2pChannel.reportPublishEvent(!0,null)}else{const o=(await s.next()).value;if(o){var r;let c;try{c=await this._gateway.publish(this._uid,o,!0)}catch(u){if(u.code!==X.DISCONNECT_P2P)throw s.throw(u),u}await s.next(((r=c)===null||r===void 0?void 0:r.ortc)||[])}this._p2pChannel.reportPublishEvent(!0,null);for(const c of t)c instanceof _r&&c._encoderConfig&&this._gateway.setVideoProfile(c._encoderConfig).catch(u=>{L.debug("[".concat(this._clientId,"] stop setVideoProfile, because websocket is closed"))}),!c.muted&&c.enabled||await this._p2pChannel.muteLocalTrack(c)}}catch(s){if(this._p2pChannel.reportPublishEvent(!1,s==null?void 0:s.code,t),(s==null?void 0:s.code)===X.WS_ABORT)return;throw s}}async _publishLowStream(){if(!this._joinInfo||this._uid===void 0)throw new Oe(X.INVALID_OPERATION,"Can't publish stream, haven't joined yet!");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new Oe(X.INVALID_OPERATION,"can not publish stream in ".concat(this.connectionState," state"));L.debug("[".concat(this._clientId,"] publish low stream"));const t=this._configDistribute.getLowStreamConfigDistribute();t&&t.bitrate&&(this._lowStreamParameter||(this._lowStreamParameter={width:160,height:120,framerate:15,bitrate:50}),this._lowStreamParameter&&this._lowStreamParameter.bitrate&&t.bitrate<this._lowStreamParameter.bitrate&&(this._lowStreamParameter.bitrate=t.bitrate));try{const s=await this._p2pChannel.publishLowStream(this._lowStreamParameter),o=(await s.next()).value;if(o){var r;let c;try{c=await this._gateway.publish(this._uid,o,!0)}catch(u){if(u.code!==X.DISCONNECT_P2P)throw s.throw(u),u}s.next(((r=c)===null||r===void 0?void 0:r.ortc)||[]),this._p2pChannel.reportPublishEvent(!0,null,void 0,!0)}}catch(s){if(this._p2pChannel.reportPublishEvent(!1,s==null?void 0:s.code,void 0,!0),(s==null?void 0:s.code)===X.WS_ABORT)return;throw s}}_createLiveStreamingClient(t){const r=()=>{if(!this._joinInfo||!this._appId)return new Oe(X.INVALID_OPERATION,"can not create live streaming client, please join channel first").throw();const s=(o={joinInfo:this._joinInfo,appId:this._appId,websocketRetryConfig:this._config.websocketRetryConfig,httpRetryConfig:this._config.httpRetryConfig},tp("LiveStreaming").create(o));var o;return s.onLiveStreamError=(c,u)=>{Rt.reportApiInvoke(this._sessionId,{name:Si.ON_LIVE_STREAM_ERROR,options:[c,u],tag:xr.TRACER}).onSuccess(),this.safeEmit(mn.LIVE_STREAMING_ERROR,c,u)},s.onLiveStreamWarning=(c,u)=>{Rt.reportApiInvoke(this._sessionId,{name:Si.ON_LIVE_STREAM_WARNING,options:[c,u],tag:xr.TRACER}).onSuccess(),this.safeEmit(mn.LIVE_STREAMING_WARNING,c,u)},s.on(Ux.REQUEST_WORKER_MANAGER_LIST,(c,u,h)=>{if(!this._joinInfo)return h(new Oe(X.INVALID_OPERATION,"can not find join info to get worker manager"));(async function(m,_,E,S){const R=re("UAP_AP").slice(0,re("AJAX_REQUEST_CONCURRENT")).map(P=>_.proxyServer?"https://".concat(_.proxyServer,"/ap/?url=").concat(P+"/api/v1?action=uap"):"https://".concat(P,"/api/v1?action=uap"));return await Ame(R,m,_,E,S)})(c,this._joinInfo,this._axiosCancelSource.token,bi).then(u).catch(h)}),s};return t===Qf.RAW?(this._liveRawStreamingClient=this._liveRawStreamingClient||r(),this._liveRawStreamingClient):(this._liveTranscodeStreamingClient=this._liveTranscodeStreamingClient||r(),this._liveTranscodeStreamingClient)}_createChannelMediaRelayClient(){if(!this._joinInfo)return new Oe(X.INVALID_OPERATION,"can not create channel media relay client, please join channel first").throw();if(!this._channelMediaRelayClient){const{sendResolutionWidth:r,sendResolutionHeight:s}=this.getLocalVideoStats(),o=(t={joinInfo:this._joinInfo,clientId:this._clientId,websocketRetryConfig:this._config.websocketRetryConfig,httpRetryConfig:this._config.httpRetryConfig,resolution:{width:r,height:s}},tp("ChannelMediaRelay").create(t));o.on("state",c=>{c===Ia.RELAY_STATE_FAILURE&&o&&o.dispose(),this.safeEmit(mn.CHANNEL_MEDIA_RELAY_STATE,c)}),o.on("event",c=>{this.safeEmit(mn.CHANNEL_MEDIA_RELAY_EVENT,c)}),this._channelMediaRelayClient=o,this._statsCollector.onStatsChanged=(c,u)=>{var h;c==="resolution"&&((h=this._channelMediaRelayClient)===null||h===void 0||h.setVideoProfile(u))}}var t;return this._channelMediaRelayClient}_handleUpdateDataChannel(t,r){const{added:s,deleted:o}=t,c=[];if(r){const u=[];this._users.forEach(h=>{h._dataChannels.forEach(m=>{s.every(_=>_.uid!==h._uintid||_.stream_id!==m.id)&&u.push({uid:h._uintid,stream_id:m.id,ordered:m.ordered,max_retrans_times:m.maxRetransmits,metadata:m.metadata})})}),u.length>0&&this._handleUpdateDataChannel({added:[],deleted:u})}Array.isArray(s)&&s.length>0&&s.forEach(u=>{const{uid:h,stream_id:m,ordered:_,max_retrans_times:E,metadata:S}=u,R=this._users.find(P=>P._uintid===h);if(!R)return void L.error("[".concat(this._clientId,"] can not find target user!(on_add_data_channel)"));if(L.debug("[".concat(this._clientId,"] data_channel added with uid ").concat(h)),ot(c).call(c,R)||c.push(R),R._uintid||(R._uintid=h),R._dataChannels.findIndex(P=>P.id===u.stream_id)===-1){const P={id:m,ordered:!!_,maxRetransmits:E,metadata:S},k=function(z){return vH(z,!0)}(P);R._dataChannels.push(k),L.info("[".concat(this._clientId,"] remote user ").concat(R.uid," published datachannel")),r||this.safeEmit(mn.USER_PUBLISHED,R,"datachannel",P)}this._p2pChannel.hasPendingRemoteDataChannel(R,u.stream_id)&&(L.debug("[".concat(this._clientId,"] resubscribe datachannel for user ").concat(R.uid," after reconnect.")),this._subscribeDataChannel(R,u.stream_id).catch(P=>{L.error("[".concat(this._clientId,"] resubscribe datachannel error"),P.toString())}))}),r&&(this.safeEmit(mn.PUBLISHED_USER_LIST,this._pendingPublishedUsers),this._pendingPublishedUsers=[]),Array.isArray(o)&&o.length>0&&o.forEach(u=>{const{uid:h,stream_id:m}=u,_=this._users.find(S=>S._uintid===h);if(!_)return void L.error("[".concat(this._clientId,"] can not find target user!(on_delete_data_channel)"));const E=_._dataChannels.find(S=>S.id===u.stream_id);E&&(L.debug("[".concat(this._clientId,"] data_stream delete with uid ").concat(h)),this._p2pChannel.unsubscribeDataChannel(_,[E]).then(S=>{if(_._dataChannels=_._dataChannels.filter(R=>R!==E),S)return this._gateway.unsubscribeDataChannel(S,_.uid)}),L.info("[".concat(this._clientId,"] remote user ").concat(h," unpublished datachannel ,id:").concat(E.id)),this.safeEmit(mn.USER_UNPUBLISHED,_,"datachannel",E._config))})}_handleRemoveDataChannels(t){const r=this._users.find(s=>s.uid===t.uid);if(r){if(r._dataChannels!==void 0&&r._dataChannels.length>0){L.debug("[".concat(this._clientId,"] datachannel removed with uid ").concat(t.uid));const s=()=>{L.info("[".concat(this._clientId,"] remote user ").concat(r.uid," unpublished datachannel")),r._dataChannels.forEach(o=>{this.safeEmit(mn.USER_UNPUBLISHED,r,"datachannel",o._config)})};this._p2pChannel.unsubscribeDataChannel(r,r._dataChannels).then(o=>{if(o)return this._gateway.unsubscribeDataChannel(o,r.uid)}),s()}}else L.warning("[".concat(this._clientId,"] can not find target user!(on_remove_datachannel)"))}_handleGatewayEvents(){this._gateway.on(es.UPDATE_GATEWAY_CONFIG,()=>{(function(){let t;try{t=window.localStorage.getItem("websdk_ng_global_parameter")}catch(r){return void L.error("Error loading sdk config",r.message)}if(t)try{const r=JSON.parse(window.atob(t)),s=Date.now();Object.keys(r).forEach(o=>{const{value:c,type:u,expires:h}=r[o];h&&h<=s||u||Ox()||!Object.prototype.hasOwnProperty.call($A,o)||(md[o]=c,gr[o]=c,L.debug("Update gateway parameters from config distribute",o,c))})}catch(r){L.error("Error update config from local cache",r.message)}})()}),this._gateway.on(es.DISCONNECT_P2P,async()=>{await this._p2pChannel.disconnectForReconnect()}),this._gateway.on(es.CONNECTION_STATE_CHANGE,(t,r,s)=>{var o;if(s===Bn.FALLBACK)return;const c=()=>{this.safeEmit(mn.CONNECTION_STATE_CHANGE,t,r,s)};if(Rt.reportApiInvoke(this._sessionId||((o=this._gateway.joinInfo)===null||o===void 0?void 0:o.sid)||null,{name:Si.CONNECTION_STATE_CHANGE,options:[t,r,s],tag:xr.TRACER}).onSuccess(JSON.stringify({cur:t,prev:r,reason:s})),L.info("[".concat(this._clientId,"] signal connection state change: ").concat(r," -> ").concat(t)),t==="DISCONNECTED")return this._reset(),void c();if(t==="RECONNECTING")this._users.forEach(h=>{h._trust_in_room_=!1,h._trust_audio_enabled_state_=!1,h._trust_video_enabled_state_=!1,h._trust_audio_mute_state_=!1,h._trust_video_mute_state_=!1,h._trust_audio_stream_added_state_=!1,h._trust_video_stream_added_state_=!1,h._is_pre_created||(h._audio_pre_subscribed||(h._audioSSRC=void 0,h._audioOrtc=void 0),h._video_pre_subscribed||(h._videoSSRC=void 0,h._videoOrtc=void 0,h._rtxSsrcId=void 0),h._cname=void 0)}),this._userOfflineTimeout&&window.clearTimeout(this._userOfflineTimeout),this._streamRemovedTimeout&&window.clearTimeout(this._streamRemovedTimeout),this._userOfflineTimeout=void 0,this._streamRemovedTimeout=void 0;else if(t==="CONNECTED"){var u;this._streamFallbackTypeCacheMap.forEach((h,m)=>{this._gateway.setStreamFallbackOption(m,h).catch(_=>{L.warning("[".concat(this._clientId,"] auto set stream fallback option failed"),_)})}),this._remoteStreamTypeCacheMap.forEach((h,m)=>{this._gateway.setRemoteVideoStreamType(m,h).catch(_=>{L.warning("[".concat(this._clientId,"] auto set remote stream type failed"),_)})}),this._remoteDefaultVideoStreamType!==void 0&&((u=this._joinInfo)===null||u===void 0?void 0:u.defaultVideoStream)===void 0&&this.setRemoteDefaultVideoStreamType(this._remoteDefaultVideoStreamType).then(()=>{L.debug("[".concat(this._clientId,"] setRemoteDefaultVideoStreamType after gateway connected"))}).catch(h=>{L.error("[".concat(this._clientId,"] setRemoteDefaultVideoStreamType after gateway failed, ").concat(h))}),this.store.useP2P||(this._p2pChannel.republish(),this._userOfflineTimeout=window.setTimeout(()=>{this.connectionState==="CONNECTED"&&(this._userOfflineTimeout=void 0,this._users.filter(h=>!h._trust_in_room_).forEach(h=>{L.debug("[".concat(this._clientId,"] user offline timeout, emit user offline ").concat(h.uid)),this._handleUserOffline({uid:h.uid})}))},3e3),this._streamRemovedTimeout=window.setTimeout(()=>{this.connectionState==="CONNECTED"&&(this._streamRemovedTimeout=void 0,this._users.forEach(h=>{h._trust_audio_mute_state_||(L.debug("[".concat(this._clientId,"] auto dispatch audio unmute event ").concat(h.uid)),this._handleMuteStream(h.uid,gt.AUDIO,!1)),h._trust_video_mute_state_||(L.debug("[".concat(this._clientId,"] auto dispatch video unmute event ").concat(h.uid)),this._handleMuteStream(h.uid,gt.VIDEO,!1)),h._trust_audio_enabled_state_||(L.debug("[".concat(this._clientId,"] auto dispatch enable local audio ").concat(h.uid)),this._handleSetStreamLocalEnable("audio",h.uid,!0)),h._trust_video_enabled_state_||(L.debug("[".concat(this._clientId,"] auto dispatch enable local video ").concat(h.uid)),this._handleSetStreamLocalEnable("video",h.uid,!0)),h._trust_video_stream_added_state_||(L.debug("[".concat(this._clientId,"] auto dispatch reset video stream added ").concat(h.uid)),this._handleResetAddStream(h,"video")),h._trust_audio_stream_added_state_||(L.debug("[".concat(this._clientId,"] auto dispatch reset audio stream added ").concat(h.uid)),this._handleResetAddStream(h,"audio")),h._video_added_||h._audio_added_||(L.debug("[".concat(this._clientId,"] auto dispatch stream remove ").concat(h.uid)),this._handleRemoveStream({uid:h.uid,uint_id:h._uintid}))}))},1e3))}c()}),this._gateway.on(es.REQUEST_NEW_GATEWAY_LIST,async(t,r)=>{if(!this._joinInfo)return r(new Oe(X.UNEXPECTED_ERROR,"can not recover, no join info"));try{let s;const o=await u9(_u(_u({},this._joinInfo),{},{uid:this._joinInfo.uid,stringUid:void 0}));o?(s=o.ap,f9(o),this._joinInfo.preload=!0):(s=await Zx(this._joinInfo,this._axiosCancelSource.token,this._config.httpRetryConfig||bi,this.store),this._joinInfo.preload=!1),this._joinInfo&&(this._joinInfo.apResponse=s.gatewayInfo.res,this._joinInfo.gatewayAddrs=s.gatewayInfo.gatewayAddrs,this._joinInfo.uni_lbs_ip=s.gatewayInfo.uni_lbs_ip);const c=[];s.gatewayInfo.gatewayAddrs.forEach(u=>{let{address:h}=u;const[m,_]=h.split(":");this._joinInfo&&this._joinInfo.proxyServer?c.push({proxy:this._joinInfo.proxyServer,host:m,port:_}):c.push({host:m,port:_})}),t(c)}catch(s){r(s)}}),this._gateway.on(es.NETWORK_QUALITY,t=>{this._networkQualitySensitivity==="normal"&&this.safeEmit(mn.NETWORK_QUALITY,t)}),this._gateway.on(es.STREAM_TYPE_CHANGE,(t,r)=>{this.safeEmit(mn.STREAM_TYPE_CHANGED,t,r),Rt.reportApiInvoke(this._sessionId,{name:Si.STREAM_TYPE_CHANGE,options:[t,r],tag:xr.TRACER}).onSuccess(JSON.stringify({uid:t,streamType:r}))}),this._gateway.on(es.IS_P2P_DISCONNECTED,t=>{this._p2pChannel.isP2PDisconnected()?t(!0):this._p2pChannel.hasLocalMedia()||this._p2pChannel.hasRemoteMedia()?t(!1):t(!0)}),this._gateway.on(es.REQUEST_P2P_CONNECTION_PARAMS,async(t,r,s)=>{try{let o=await this._p2pChannel.getEstablishParams();re("ENABLE_PREALLOC_PC")&&o||(o=await this._p2pChannel.startP2PConnection(t)),r(o)}catch(o){s(o)}}),this._gateway.on(es.JOIN_RESPONSE,(t,r)=>{if(this.store.useP2P)return;let s;t.attributes?s=t.attributes.userAttributes.preSubSsrcs:L.debug("no attributes in joinResponse");const o=cH(t.ortc,r,s);this._p2pChannel.connect(o)}),this._gateway.on(es.PRE_CONNECT_PC,async t=>{const{candidates:r,fingerprint:s}=t;if(this._joinInfo&&r.length>0&&!this._p2pChannel.isPlanB){var o;await this._p2pChannel.startP2PConnection({turnServer:this._joinInfo.turnServer});const{cert:c,cid:u}=this._joinInfo.apResponse;await this._p2pChannel.connect({iceParameters:{iceUfrag:"".concat(u,"_").concat(c),icePwd:"".concat(u,"_").concat(c)},dtlsParameters:{fingerprints:[{hashFunction:"sha-256",fingerprint:(o=re("FINGERPRINT"))!==null&&o!==void 0?o:s}]},candidates:r,rtpCapabilities:{send:{audioCodecs:[],videoCodecs:[],audioExtensions:[],videoExtensions:[]},recv:{audioCodecs:[],videoCodecs:[],audioExtensions:[],videoExtensions:[]}},setup:"active",cname:"o/i14u9pJrxRKAsu",preallocation:!0})}})}_handleGatewaySignalEvents(){this._gateway.signal.on(_n.ON_USER_ONLINE,this._handleUserOnline),this._gateway.signal.on(_n.ON_USER_OFFLINE,this._handleUserOffline),this._gateway.signal.on(_n.ON_ADD_AUDIO_STREAM,t=>this._handleAddAudioOrVideoStream("audio",t.uid,t.ssrcId,t.cname,t.uint_id,t.ortc)),this._gateway.signal.on(_n.ON_ADD_VIDEO_STREAM,t=>this._handleAddAudioOrVideoStream("video",t.uid,t.ssrcId,t.cname,t.uint_id,t.ortc,t.rtxSsrcId)),this._gateway.signal.on(_n.ON_REMOTE_DATASTREAM_UPDATE,t=>{this._handleUpdateDataChannel(t)}),this._gateway.signal.on(_n.ON_REMOTE_FULL_DATASTREAM_INFO,t=>{this._handleUpdateDataChannel({added:t.datastreams||[],deleted:[]},!0)}),this._gateway.signal.on(_n.ON_REMOVE_STREAM,this._handleRemoveStream),this._gateway.signal.on(_n.ON_P2P_LOST,this._handleP2PLost),this._gateway.signal.on(_n.MUTE_AUDIO,t=>this._handleMuteStream(t.uid,gt.AUDIO,!0)),this._gateway.signal.on(_n.UNMUTE_AUDIO,t=>this._handleMuteStream(t.uid,gt.AUDIO,!1)),this._gateway.signal.on(_n.MUTE_VIDEO,t=>this._handleMuteStream(t.uid,gt.VIDEO,!0)),this._gateway.signal.on(_n.UNMUTE_VIDEO,t=>this._handleMuteStream(t.uid,gt.VIDEO,!1)),this._gateway.signal.on(_n.RECEIVE_METADATA,t=>{const r=D_(t.metadata);this.safeEmit(mn.RECEIVE_METADATA,t.uid,r)}),this._gateway.signal.on(_n.ON_DATA_STREAM,async t=>{var r;if(!t)return;let s=D_(t.payload);if(this._encryptDataStream&&this._encryptDataStreamIv&&this._encryptDataStreamKey&&window.crypto.subtle&&ot(r=["aes-128-gcm2","aes-256-gcm2"]).call(r,this._encryptionMode)){if(t.payload.length<Lv)throw new Oe(X.UNEXPECTED_RESPONSE,"payload length ".concat(t.payload.length," is less than header length ").concat(Lv));s=await async function(u,h,m){const _=m.subarray(0,Lv),E=_.slice(8,Lv),S=(E[0]<<8)+E[1],R=(_[6]<<8)+_[7],P=await window.crypto.subtle.decrypt({name:"AES-GCM",iv:u,tagLength:v8,additionalData:new Uint8Array(a8(S,2))},h,m.subarray(Lv));return new Uint8Array(P).subarray(0,R)}(this._encryptDataStreamIv,this._encryptDataStreamKey,s)}let o=0;if(t.ordered||t.syncWithAudio){const c=this._p2pChannel.getStats(),u=this.remoteUsers.find(m=>m.uid===t.uid),h=c==null?void 0:c.audioRecv.find(m=>m.ssrc===(u==null?void 0:u._audioSSRC));o=h==null?void 0:h.jitterBufferMs}(o==null||Number.isNaN(o))&&(o=0),Hme(_u(_u({},t),{},{payload:s}),o,{id:this._clientId,onStreamMessage:typeof this.onStreamMessage=="function"?this.onStreamMessage.bind(this):void 0,safeEmit:this.safeEmit.bind(this)})}),this._gateway.signal.on(_n.ON_CRYPT_ERROR,()=>{Im(()=>{L.warning("[".concat(this._clientId,"] on crypt error")),this.safeEmit(mn.CRYPT_ERROR)},this._sessionId)}),this._gateway.signal.on(_n.ON_TOKEN_PRIVILEGE_WILL_EXPIRE,this._handleTokenWillExpire),this._gateway.signal.on(_n.ON_TOKEN_PRIVILEGE_DID_EXPIRE,()=>{L.warning("[".concat(this._clientId,"] received message onTokenPrivilegeDidExpire, please get new token and join again")),this._gateway.leave(!0,Bn.TOKEN_EXPIRE),this.safeEmit(mn.ON_TOKEN_PRIVILEGE_DID_EXPIRE),this._reset()}),this._gateway.signal.on(_n.ON_STREAM_FALLBACK_UPDATE,t=>{L.debug("[".concat(this._clientId,"] stream fallback peerId: ").concat(t.stream_id,", attr: ").concat(t.stream_type)),this.safeEmit(mn.STREAM_FALLBACK,t.stream_id,t.stream_type===1?"fallback":"recover")}),this._gateway.signal.on(_n.ON_PUBLISH_STREAM,t=>{this.uid===this._uid&&(this._p2pChannel.reportPublishEvent(!0,null,void 0,!1,JSON.stringify({proxy:t.proxy})),L.info("[".concat(this._clientId,"] on publish stream, ").concat(JSON.stringify(t))))}),this._gateway.signal.on(_n.ENABLE_LOCAL_VIDEO,t=>{this._handleSetStreamLocalEnable("video",t.uid,!0)}),this._gateway.signal.on(_n.DISABLE_LOCAL_VIDEO,t=>{this._handleSetStreamLocalEnable("video",t.uid,!1)}),this._gateway.signal.on(Wt.REQUEST_TIMEOUT,(t,r)=>{if(this._joinInfo)switch(t){case jt.PUBLISH:{if(!r)return;const c=r.ortc;if(c){var s,o;const u=c.some(_=>{let{stream_type:E}=_;return E===zn.Audio}),h=c.some(_=>{let{stream_type:E}=_;return E!==zn.Audio}),m=c.some(_=>{let{stream_type:E}=_;return E===zn.Screen||E===zn.ScreenLow});r.state==="offer"&&Rt.publish(this._joinInfo.sid,{eventElapse:Ls.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:!1,ec:X.TIMEOUT,audio:u,video:h,p2pid:r.p2p_id,publishRequestid:this.store.pubId,screenshare:m,audioName:u?(s=c.find(_=>{let{stream_type:E}=_;return E===zn.Audio}))===null||s===void 0||(s=s.ssrcs[0])===null||s===void 0?void 0:s.ssrcId.toString():void 0,videoName:h?(o=c.find(_=>{let{stream_type:E}=_;return E!==zn.Audio}))===null||o===void 0||(o=o.ssrcs[0])===null||o===void 0?void 0:o.ssrcId.toString():void 0})}break}case jt.SUBSCRIBE:r&&Rt.subscribe(this._joinInfo.sid,{succ:!1,ec:X.TIMEOUT,audio:r.stream_type===gt.AUDIO,video:r.stream_type===gt.VIDEO,peerid:r.stream_id,subscribeRequestid:r.ssrcId,p2pid:this.store.p2pId,eventElapse:Ls.measureFromSubscribeStart(this.store.clientId,r.ssrcId),preSsrc:this._p2pChannel.isPreSubScribe(r.ssrcId)})}}),this._gateway.signal.on(_n.ON_P2P_OK,t=>{this.uid,this._uid}),this._gateway.signal.on(_n.ON_PUBLISHED_USER_LIST,t=>{if(t==null||!t.users)return;re("BLOCK_LOCAL_CLIENT")&&(t.users=t.users.filter(o=>!W_(o.string_id||o.stream_id,this.channelName)));const r=[],s=[];for(const o of t.users){let c=this._users.find(S=>S._uintid===o.stream_id);c?c._trust_in_room_=!0:(c=new Mm(o.string_id||o.stream_id,o.stream_id),this._users.push(c),this.getListeners(mn.PUBLISHED_USER_LIST).length===0&&(L.debug("[".concat(this._clientId,"] user online"),o.stream_id),this.safeEmit(mn.USER_JOINED,c)));const u=Hi.Audio&o.stream_type,h=(Hi.Video|Hi.LwoVideo)&o.stream_type,m=(65280&o.stream_type)!=0,_=u&&c.hasAudio,E=h&&c.hasVideo;h&&(c._trust_video_stream_added_state_=!0,c._video_added_=!0,c._videoSSRC=o.video_ssrc,c._rtxSsrcId=o.video_rtx),u&&(c._trust_audio_stream_added_state_=!0,c._audio_added_=!0,c._audioSSRC=o.audio_ssrc),u&&!_&&this.getListeners(mn.PUBLISHED_USER_LIST).length===0&&(L.info("[".concat(this._clientId,"] remote user ").concat(c.uid," published audio")),this.safeEmit(mn.USER_PUBLISHED,c,"audio")),h&&!E&&this.getListeners(mn.PUBLISHED_USER_LIST).length===0&&(L.info("[".concat(this._clientId,"] remote user ").concat(c.uid," published video")),this.safeEmit(mn.USER_PUBLISHED,c,"video")),(u&&!_||h&&!E||m)&&r.push(c),h&&this._p2pChannel.hasPendingRemoteMedia(c,"video")&&s.push({user:c,mediaType:"video"}),u&&this._p2pChannel.hasPendingRemoteMedia(c,"audio")&&s.push({user:c,mediaType:"audio"})}s.length>0&&(L.debug("[".concat(this._clientId,"] RE massSubscribe after reconnect ").concat(s.map(o=>"user: ".concat(o.user.uid,", mediaType: ").concat(o.mediaType)).join("; ")," ")),this.massSubscribe(s).catch(o=>{L.error("[".concat(this._clientId,"] mass resubscribe error"),o.toString())})),this.getListeners(mn.PUBLISHED_USER_LIST).length>0?re("ENABLE_DATASTREAM_2")?this._pendingPublishedUsers=r:(L.info("[".concat(this._clientId,"] client emit user-list event, users: ").concat(r.map(o=>o.uid).join(", "))),this.safeEmit(mn.PUBLISHED_USER_LIST,r)):L.info("[".concat(this._clientId,"] client not emit user-list event case there is no user-list listener, users: ").concat(r.map(o=>o.uid).join(", ")))}),this._gateway.signal.on(_n.ON_RTP_CAPABILITY_CHANGE,t=>{const{video_codec:r}=t;this._p2pChannel instanceof MT&&this._p2pChannel.updateRemoteRTPCapabilities(r.map(s=>s.toLowerCase()).filter(s=>{var o;return ot(o=Object.keys(KA)).call(o,s)}))})}_handleP2PEvents(){this._gateway.signal.on(_n.ON_USER_OFFLINE,()=>{this._p2pChannel.disconnectForReconnect()}),this._gateway.signal.on(Zr.PUBLISH,(t,r,s)=>{const{uid:o}=t;t.forEach(c=>{const{kind:u,ssrcs:h,mid:m,isMuted:_}=c;this._handleP2PAddAudioOrVideoStream(u,o,h[0].ssrcId,m);const E=this._users.find(S=>S.uid===o);return E&&this.store.useP2P?this._p2pChannel.mockSubscribe(E,u,h[0].ssrcId,m).then(()=>{r()}).catch(s):r(),this._handleMuteStream(o,u,!!_)})}),this._gateway.signal.on(Zr.CALL,async(t,r,s)=>{if(this.store.useP2P)try{var o;r(await this._p2pChannel.startP2P({turnServer:(o=this._joinInfo)===null||o===void 0?void 0:o.turnServer},t))}catch(c){s(c)}}),this._gateway.signal.on(Wt.P2P_CONNECTION,async t=>{this.store.useP2P&&(await this._p2pChannel).p2pConnect(t)}),this._gateway.signal.on(Zr.UNPUBLISH,async(t,r,s)=>{if(this.store.useP2P){const{unpubMsg:o,uid:c}=t,u=this._users.find(h=>h.uid===c);if(!u)return L.warning("[".concat(this._clientId,"] can not find remote user, ignore mute event, uid: ").concat(c)),void r();try{o.forEach(async h=>{let{stream_type:m}=h;const _=m===zn.Audio?gt.AUDIO:gt.VIDEO;await this._p2pChannel.unsubscribe(u,_),this._handleMuteStream(c,_,!0)}),r()}catch(h){s(h)}}}),this._gateway.signal.on(Zr.CONTROL,async(t,r)=>{const{action:s}=t;switch(s){case km.MUTE_LOCAL_VIDEO:this._handleMuteStream(r,gt.VIDEO,!0);break;case km.MUTE_LOCAL_AUDIO:this._handleMuteStream(r,gt.AUDIO,!0);break;case km.UNMUTE_LOCAL_VIDEO:this._handleP2PAddAudioOrVideoStream("video",r),this._handleMuteStream(r,gt.VIDEO,!1);break;case km.UNMUTE_LOCAL_AUDIO:this._handleP2PAddAudioOrVideoStream("audio",r),this._handleMuteStream(r,gt.AUDIO,!1)}}),this._gateway.signal.on(Zr.RESTART_ICE,async(t,r,s)=>{if(this.store.useP2P)try{const{direction:o,iceParameter:c}=t;o!==To.SEND_ONLY||c?r(await this._p2pChannel.restartICE(o,c)):(this._p2pChannel.handleDisconnect(o),r())}catch(o){s(o)}}),this._gateway.signal.on(Zr.CANDIDATE,t=>{if(this.store.useP2P){const{candidate:r,direction:s}=t;this._p2pChannel.addRemoteCandidate(r,s)}}),this._p2pChannel.on(kt.RequestP2PRestartICE,async(t,r,s)=>{try{const{direction:o}=t;r(await this._gateway.sendExtensionMessage(Zr.RESTART_ICE,t,o===To.SEND_ONLY))}catch(o){s(o)}}),this._p2pChannel.on(kt.LocalCandidate,t=>{this._gateway.sendExtensionMessage(Zr.CANDIDATE,JSON.stringify(t),!0)}),this._p2pChannel.on(kt.RequestP2PMuteLocal,async(t,r,s)=>{try{await this._gateway.sendExtensionMessage(Zr.CONTROL,t,!0),r()}catch(o){s(o)}}),this._p2pChannel.on(kt.RequestP2PUnmuteRemote,async(t,r,s)=>{if(this._joinInfo)try{await this._gateway.unmuteRemote(t,this._joinInfo.stringUid||this._joinInfo.uid),r()}catch(o){o.code===X.DISCONNECT_P2P?r():s(o)}else r()}),this._p2pChannel.on(kt.RequestP2PMuteRemote,async(t,r,s)=>{if(this._joinInfo)try{await this._gateway.muteRemote(t,this._joinInfo.stringUid||this._joinInfo.uid),r()}catch(o){o.code===X.DISCONNECT_P2P?r():s(o)}else r()}),this._p2pChannel.on(kt.StateChange,(t,r)=>{r===Wn.Connected&&this._p2pChannel.republish()})}_handleP2PChannelEvents(){this._p2pChannel.on(kt.PeerConnectionStateChange,t=>{const r=this._peerConnectionState;t!==r&&(this.safeEmit(mn.PEERCONNECTION_STATE_CHANGE,t,r),this._peerConnectionState=t)}),this._p2pChannel.on(kt.RequestMuteLocal,async(t,r,s)=>{if(this._joinInfo)try{await this._gateway.muteLocal(t,this._joinInfo.stringUid||this._joinInfo.uid),r()}catch(o){o.code===X.DISCONNECT_P2P?r():s(o)}else r()}),this._p2pChannel.on(kt.RequestUnmuteLocal,async(t,r,s)=>{if(this._joinInfo)try{await this._gateway.unmuteLocal(t,this._joinInfo.stringUid||this._joinInfo.uid),r()}catch(o){o.code===X.DISCONNECT_P2P?r():s(o)}else r()}),this._p2pChannel.on(kt.RequestRePublish,(t,r,s)=>{this.publish(t,!1).then(r).catch(s)}),this._p2pChannel.on(kt.RequestRePublishDataChannel,(t,r,s)=>{lt.all(t.map(async o=>{const c=await this._p2pChannel.publishDataChannel([o]);try{c.forEach(u=>{this._uid&&this._gateway.publishDataChannel(this._uid,u,!0)})}catch(u){if(u.code!==X.DISCONNECT_P2P)throw u}})).then(r).catch(s)}),this._p2pChannel.on(kt.RequestReSubscribe,async(t,r,s)=>{try{for(const{user:o,kind:c}of t)c===gt.VIDEO?await this.subscribe(o,"video"):await this.subscribe(o,"audio");r()}catch(o){s(o)}}),this._p2pChannel.on(kt.RequestUpload,(t,r)=>{this._gateway.upload(t,r)}),this._p2pChannel.on(kt.RequestUploadStats,t=>{this._gateway.uploadWRTCStats(t)}),this._p2pChannel.on(kt.MediaReconnectStart,t=>{this.safeEmit(mn.MEDIA_RECONNECT_START,t)}),this._p2pChannel.on(kt.MediaReconnectEnd,t=>{this.safeEmit(mn.MEDIA_RECONNECT_END,t)}),this._p2pChannel.on(kt.NeedSignalRTT,t=>{t(this._gateway.getSignalRTT())}),this._p2pChannel.on(kt.RequestRestartICE,async t=>{if(this.store.useP2P)return;const r=await this._p2pChannel.restartICE(t),s=await r.next();if(s.done)return;const o=s.value;let c;try{c=await this._gateway.restartICE({iceParameters:o})}catch(h){return void r.throw(h)}const{iceParameters:u}=function(h){const m=h.iceParameters;return{iceParameters:{iceUfrag:m.iceUfrag,icePwd:m.icePwd}}}(c);await r.next({remoteIceParameters:u})}),this._p2pChannel.on(kt.RequestReconnect,async()=>{this._gateway.reconnect()}),this._p2pChannel.on(kt.RequestReconnectPC,async()=>{var t;const{iceParameters:r,dtlsParameters:s,rtpCapabilities:o}=await this._p2pChannel.startP2PConnection({turnServer:(t=this._joinInfo)===null||t===void 0?void 0:t.turnServer}),{gatewayEstablishParams:c,gatewayAddress:u}=await this._gateway.reconnectPC({iceParameters:r,dtlsParameters:s,rtpCapabilities:o}),h=cH(c,u);await this._p2pChannel.connect(h),await this._p2pChannel.republish(),await this._p2pChannel.reSubscribe()}),this._p2pChannel.on(kt.RequestUnpublishForReconnectPC,async(t,r,s)=>{this._joinInfo&&this._uid!==void 0?(await this._gateway.unpublish(t,this._uid),r()):s()}),this._p2pChannel.on(kt.P2PLost,()=>{this.safeEmit(mn.P2P_LOST,this.store.uid)}),this._p2pChannel.on(kt.UpdateVideoEncoder,t=>{t._encoderConfig&&this._gateway.setVideoProfile(t._encoderConfig)}),this._p2pChannel.on(kt.ConnectionTypeChange,t=>{this.safeEmit(mn.IS_USING_CLOUD_PROXY,t)}),this._p2pChannel.on(kt.RequestLowStreamParameter,t=>{t(this._lowStreamParameter||{width:160,height:120,framerate:15,bitrate:50})}),this._p2pChannel.on(kt.QueryClientConnectionState,t=>{t(this.connectionState)}),this._p2pChannel.on(kt.AudioMetadata,t=>{this.safeEmit(mn.AUDIO_METADATA,t)})}getKeyMetrics(){return this.store.keyMetrics}async enableContentInspect(t){if(!this._joinInfo||this.connectionState!=="CONNECTED")throw new Oe(X.INVALID_OPERATION,"[".concat(this._clientId,"] can not create content inspect, please join channel first"));if(this._inspect)throw new Oe(X.INVALID_OPERATION,"[".concat(this._clientId,"] Inspect content service already in connecting/connected state"));try{const s=(r={config:t},tp("ContentInspect").create(r));this._inspect=s,this.handleVideoInspectEvents(s);const{appId:o,cname:c,sid:u,token:h,uid:m,cid:_,vid:E}=this._joinInfo;await s.init({appId:o,areaCode:"",cname:c,sid:u,token:h,uid:m,cid:_,vid:E?Number(E):0},bi)}catch(s){throw Array.isArray(s)?s[0]:s}var r}handleVideoInspectEvents(t){t.on(ts.CONNECTION_STATE_CHANGE,(r,s)=>{if(this.safeEmit(mn.CONTENT_INSPECT_CONNECTION_STATE_CHANGE,r,s),s===fu.CONNECTED){if(this.connectionState!=="CONNECTED")return void this.safeEmit(mn.CONTENT_INSPECT_ERROR,new Oe(X.OPERATION_ABORTED,"Content inspect was cancelled because it left the channel"));t.inspectImage()}}),t.on(ts.INSPECT_RESULT,(r,s)=>{var o;if((s==null?void 0:s.code)===X.INVALID_OPERATION&&this.connectionState==="DISCONNECTED")return L.debug("Stop inspect content because that has left channel"),this==null||(o=this._inspect)===null||o===void 0||o.close(),void(this._inspect=void 0);this.safeEmit(mn.CONTENT_INSPECT_RESULT,r,s)}),t.on(ts.CLIENT_LOCAL_VIDEO_TRACK,r=>{r(this.localTracks.filter(s=>s.trackMediaType==="video")[0])})}async disableContentInspect(){if(!this._inspect)throw new Oe(X.INVALID_OPERATION,"[".concat(this._clientId,"] inspectVideoContent not started"));try{this._inspect.close(),this._inspect=void 0}catch(t){throw Array.isArray(t)?t[0]:t}}async setImageModeration(t,r){if(qf(t,"enabled"),t){if(!r)throw new Oe(X.INVALID_PARAMS,"config is required");if(C9(r),!this._joinInfo)throw new Oe(X.INVALID_OPERATION,"can not create image moderation, please join channel first");try{if(this._moderation)this._moderation.updateConfig(r);else{const o=(s={config:r},tp("ImageModeration").create(s));this._moderation=o,this.handleImageModerationEvents(o);const{appId:c,cname:u,sid:h,token:m,uid:_,cid:E,vid:S}=this._joinInfo;await o.init({appId:c,areaCode:"",cname:u,sid:h,token:m,uid:_,cid:E,vid:S?Number(S):0},bi)}}catch(o){throw Array.isArray(o)?o[0]:o}}else{var s;if(!this._moderation)throw new Oe(X.INVALID_OPERATION,"[".concat(this._clientId,"] image moderation not started"));try{this._moderation.close(),this._moderation.removeAllListeners(),this._moderation=void 0}catch(o){throw Array.isArray(o)?o[0]:o}}}handleImageModerationEvents(t){t.on(yd.CONNECTION_STATE_CHANGE,(r,s)=>{if(this.safeEmit(mn.IMAGE_MODERATION_CONNECTION_STATE_CHANGE,r,s),r===Sl.CONNECTED){if(this.connectionState!=="CONNECTED")throw this.setImageModeration(!1),new Oe(X.OPERATION_ABORTED,"Image moderation was cancelled because it left the channel");t.inspectImage()}}),t.on(yd.CLIENT_LOCAL_VIDEO_TRACK,r=>{r(this.localTracks.filter(s=>s.trackMediaType==="video")[0])})}setP2PTransport(t){if(function(r){Di(r,"transport",["default","auto","relay","sd-rtn"])}(t),this.mode!=="p2p")throw new Oe(X.INVALID_OPERATION,"only p2p mode can set p2pTransport");this.store.p2pTransport=t,L.info("[".concat(this._clientId,"] set client p2pTransport to ").concat(t))}getJoinChannelServiceRecords(){return L.debug("getJoinChannelServiceRecords"),this.store.joinChannelServiceRecords}async setPublishAudioFilterEnabled(t){qf(t,"enabled"),Xn("ENABLE_PUBLISH_AUDIO_FILTER",t),this._joinInfo&&await this._gateway.setPublishAudioFilterEnabled(t)}_handleResetAddStream(t,r){switch(r){case"audio":t._audio_added_=!1,t._trust_audio_stream_added_state_=!0;break;case"video":t._video_added_=!1,t._trust_video_stream_added_state_=!0}}},vt(ft.prototype,"leave",[I9],Object.getOwnPropertyDescriptor(ft.prototype,"leave"),ft.prototype),vt(ft.prototype,"publish",[A9],Object.getOwnPropertyDescriptor(ft.prototype,"publish"),ft.prototype),vt(ft.prototype,"unpublish",[P9],Object.getOwnPropertyDescriptor(ft.prototype,"unpublish"),ft.prototype),vt(ft.prototype,"subscribe",[O9],Object.getOwnPropertyDescriptor(ft.prototype,"subscribe"),ft.prototype),vt(ft.prototype,"presubscribe",[k9],Object.getOwnPropertyDescriptor(ft.prototype,"presubscribe"),ft.prototype),vt(ft.prototype,"massSubscribe",[N9],Object.getOwnPropertyDescriptor(ft.prototype,"massSubscribe"),ft.prototype),vt(ft.prototype,"unsubscribe",[D9],Object.getOwnPropertyDescriptor(ft.prototype,"unsubscribe"),ft.prototype),vt(ft.prototype,"massUnsubscribe",[L9],Object.getOwnPropertyDescriptor(ft.prototype,"massUnsubscribe"),ft.prototype),vt(ft.prototype,"setLowStreamParameter",[x9],Object.getOwnPropertyDescriptor(ft.prototype,"setLowStreamParameter"),ft.prototype),vt(ft.prototype,"enableDualStream",[M9],Object.getOwnPropertyDescriptor(ft.prototype,"enableDualStream"),ft.prototype),vt(ft.prototype,"disableDualStream",[U9],Object.getOwnPropertyDescriptor(ft.prototype,"disableDualStream"),ft.prototype),vt(ft.prototype,"setClientRole",[V9],Object.getOwnPropertyDescriptor(ft.prototype,"setClientRole"),ft.prototype),vt(ft.prototype,"_setClientRoleOptions",[F9],Object.getOwnPropertyDescriptor(ft.prototype,"_setClientRoleOptions"),ft.prototype),vt(ft.prototype,"setProxyServer",[j9],Object.getOwnPropertyDescriptor(ft.prototype,"setProxyServer"),ft.prototype),vt(ft.prototype,"setTurnServer",[B9],Object.getOwnPropertyDescriptor(ft.prototype,"setTurnServer"),ft.prototype),vt(ft.prototype,"setLicense",[W9],Object.getOwnPropertyDescriptor(ft.prototype,"setLicense"),ft.prototype),vt(ft.prototype,"startProxyServer",[z9],Object.getOwnPropertyDescriptor(ft.prototype,"startProxyServer"),ft.prototype),vt(ft.prototype,"stopProxyServer",[G9],Object.getOwnPropertyDescriptor(ft.prototype,"stopProxyServer"),ft.prototype),vt(ft.prototype,"setLocalAccessPointsV2",[H9],Object.getOwnPropertyDescriptor(ft.prototype,"setLocalAccessPointsV2"),ft.prototype),vt(ft.prototype,"setLocalAccessPoints",[$9],Object.getOwnPropertyDescriptor(ft.prototype,"setLocalAccessPoints"),ft.prototype),vt(ft.prototype,"setRemoteDefaultVideoStreamType",[K9],Object.getOwnPropertyDescriptor(ft.prototype,"setRemoteDefaultVideoStreamType"),ft.prototype),vt(ft.prototype,"setRemoteVideoStreamType",[q9],Object.getOwnPropertyDescriptor(ft.prototype,"setRemoteVideoStreamType"),ft.prototype),vt(ft.prototype,"setStreamFallbackOption",[Y9],Object.getOwnPropertyDescriptor(ft.prototype,"setStreamFallbackOption"),ft.prototype),vt(ft.prototype,"setEncryptionConfig",[X9],Object.getOwnPropertyDescriptor(ft.prototype,"setEncryptionConfig"),ft.prototype),vt(ft.prototype,"renewToken",[J9],Object.getOwnPropertyDescriptor(ft.prototype,"renewToken"),ft.prototype),vt(ft.prototype,"enableAudioVolumeIndicator",[Q9],Object.getOwnPropertyDescriptor(ft.prototype,"enableAudioVolumeIndicator"),ft.prototype),vt(ft.prototype,"startLiveStreaming",[Z9],Object.getOwnPropertyDescriptor(ft.prototype,"startLiveStreaming"),ft.prototype),vt(ft.prototype,"setLiveTranscoding",[e7],Object.getOwnPropertyDescriptor(ft.prototype,"setLiveTranscoding"),ft.prototype),vt(ft.prototype,"stopLiveStreaming",[t7],Object.getOwnPropertyDescriptor(ft.prototype,"stopLiveStreaming"),ft.prototype),vt(ft.prototype,"startChannelMediaRelay",[n7],Object.getOwnPropertyDescriptor(ft.prototype,"startChannelMediaRelay"),ft.prototype),vt(ft.prototype,"updateChannelMediaRelay",[r7],Object.getOwnPropertyDescriptor(ft.prototype,"updateChannelMediaRelay"),ft.prototype),vt(ft.prototype,"stopChannelMediaRelay",[i7],Object.getOwnPropertyDescriptor(ft.prototype,"stopChannelMediaRelay"),ft.prototype),vt(ft.prototype,"sendCustomReportMessage",[s7],Object.getOwnPropertyDescriptor(ft.prototype,"sendCustomReportMessage"),ft.prototype),vt(ft.prototype,"pickSVCLayer",[o7],Object.getOwnPropertyDescriptor(ft.prototype,"pickSVCLayer"),ft.prototype),vt(ft.prototype,"setRTMConfig",[a7],Object.getOwnPropertyDescriptor(ft.prototype,"setRTMConfig"),ft.prototype),vt(ft.prototype,"enableContentInspect",[c7],Object.getOwnPropertyDescriptor(ft.prototype,"enableContentInspect"),ft.prototype),vt(ft.prototype,"disableContentInspect",[l7],Object.getOwnPropertyDescriptor(ft.prototype,"disableContentInspect"),ft.prototype),vt(ft.prototype,"setImageModeration",[u7],Object.getOwnPropertyDescriptor(ft.prototype,"setImageModeration"),ft.prototype),vt(ft.prototype,"setP2PTransport",[d7],Object.getOwnPropertyDescriptor(ft.prototype,"setP2PTransport"),ft.prototype),vt(ft.prototype,"getJoinChannelServiceRecords",[h7],Object.getOwnPropertyDescriptor(ft.prototype,"getJoinChannelServiceRecords"),ft.prototype),vt(ft.prototype,"setPublishAudioFilterEnabled",[f7],Object.getOwnPropertyDescriptor(ft.prototype,"setPublishAudioFilterEnabled"),ft.prototype),ft);class FT{constructor(r,s){$(this,"id",0),$(this,"element",void 0),$(this,"peerPair",void 0),$(this,"context",void 0),$(this,"audioPlayerElement",void 0),$(this,"audioTrack",void 0),FT.count+=1,this.id=FT.count,this.element=r,this.context=s}initPeers(){this.peerPair=[new RTCPeerConnection,new RTCPeerConnection],this.peerPair[1].ontrack=r=>{const s=document.createElement("audio");s.srcObject=new MediaStream([r.track]),s.play(),this.audioPlayerElement=s}}async switchSdp(){if(!this.peerPair)return;const r=async(o,c)=>{const u=c==="offer"?await o.createOffer():await o.createAnswer();return await o.setLocalDescription(u),o.iceGatheringState==="complete"?o.localDescription:new lt(h=>{o.onicegatheringstatechange=()=>{o.iceGatheringState==="complete"&&h(o.localDescription)}})},s=async(o,c)=>await o.setRemoteDescription(c);try{const o=await r(this.peerPair[0],"offer");await s(this.peerPair[1],o);const c=await r(this.peerPair[1],"answer");await s(this.peerPair[0],c)}catch(o){throw new Oe(X.LOCAL_AEC_ERROR,o.toString()).print()}}async getTracksFromMediaElement(r){if(this.audioTrack)return this.audioTrack;let s;try{r instanceof HTMLVideoElement&&(r.captureStream?r.captureStream():r.mozCaptureStream()),s=this.context.createMediaStreamDestination(),this.context.createMediaElementSource(r).connect(s)}catch(c){throw new Oe(X.LOCAL_AEC_ERROR,c.toString()).print()}if(!s)throw new Oe(X.LOCAL_AEC_ERROR,"no dest node when local aec").print();const o=s.stream.getAudioTracks()[0];return this.audioTrack=o,o}getElement(){return this.element}async startEchoCancellation(){this.context.resume(),this.peerPair&&this.close(),this.initPeers();const r=this.element,s=await this.getTracksFromMediaElement(r);this.peerPair&&this.peerPair[0].addTrack(s),await this.switchSdp()}close(){L.debug("close echo cancellation unit, id is",this.id),this.audioPlayerElement&&this.audioPlayerElement.pause(),this.peerPair&&this.peerPair.forEach(r=>{r.close()}),this.peerPair=void 0,this.audioPlayerElement=void 0}}var m7,FP;$(FT,"count",0);const cge=window.AudioContext||window.webkitAudioContext,lge=new(m7=Mt({report:Rt}),vt((FP=class{constructor(){$(this,"units",[]),$(this,"context",void 0)}processExternalMediaAEC(t){if(!this._doesEnvironmentNeedAEC())return L.debug("the system does not need to process local aec"),-1;this.context||(this.context=new cge);let r=this.units.find(s=>s&&s.getElement()===t);return r||(r=new FT(t,this.context),this.units.push(r)),r.startEchoCancellation(),L.debug("start processing local audio echo cancellation, id is",r.id),r.id}_doesEnvironmentNeedAEC(){return Rn().name!==Un.SAFARI}}).prototype,"processExternalMediaAEC",[m7],Object.getOwnPropertyDescriptor(FP.prototype,"processExternalMediaAEC"),FP.prototype),FP);function g7(t,r){var s=Object.keys(t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);r&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(t,c).enumerable})),s.push.apply(s,o)}return s}function _7(t){for(var r=1;r<arguments.length;r++){var s=arguments[r]!=null?arguments[r]:{};r%2?g7(Object(s),!0).forEach(function(o){$(t,o,s[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(s)):g7(Object(s)).forEach(function(o){Object.defineProperty(t,o,Object.getOwnPropertyDescriptor(s,o))})}return t}const mM=window||document;function y7(t){let r=arguments.length>1&&arguments[1]!==void 0&&arguments[1];if(!mM)return;const s=Ti._cspEventHandlerPointer;if(s&&r)return void console.error(s,r);const o=c=>{if(!(c&&c.blockedURI&&(Ti.onSecurityPolicyViolation||Ti.getListeners(Sh.SECURITY_POLICY_VIOLATION).length>0)))return;const u=c.blockedURI;re("CSP_DETECTED_HOSTNAME_LIST").some(h=>ot(u).call(u,h))&&(Ti.onSecurityPolicyViolation&&typeof Ti.onSecurityPolicyViolation=="function"&&Ti.onSecurityPolicyViolation(c),Ti.getListeners(Sh.SECURITY_POLICY_VIOLATION).length>0&&Ti.safeEmit(Sh.SECURITY_POLICY_VIOLATION,c))};s&&mM.removeEventListener("securitypolicyviolation",s),(r||t&&typeof t=="function"||Ti.getListeners(Sh.SECURITY_POLICY_VIOLATION).length>0)&&mM.addEventListener("securitypolicyviolation",o),Ti._cspEventHandlerPointer=o}var uge=N,dge=tW,E7=RegExp.prototype,hge=function(t){return t===E7||uge(E7,t)?dge(t):t.flags},io=l(hge);function aS(t){let r=t.length;for(;--r>=0;)t[r]=0}const gM=256,v7=286,jT=30,BT=15,_M=new Uint8Array([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0]),jP=new Uint8Array([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13]),fge=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7]),S7=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),ip=new Array(576);aS(ip);const WT=new Array(60);aS(WT);const zT=new Array(512);aS(zT);const GT=new Array(256);aS(GT);const yM=new Array(29);aS(yM);const BP=new Array(jT);function EM(t,r,s,o,c){this.static_tree=t,this.extra_bits=r,this.extra_base=s,this.elems=o,this.max_length=c,this.has_stree=t&&t.length}let b7,T7,w7;function vM(t,r){this.dyn_tree=t,this.max_code=0,this.stat_desc=r}aS(BP);const R7=t=>t<256?zT[t]:zT[256+(t>>>7)],HT=(t,r)=>{t.pending_buf[t.pending++]=255&r,t.pending_buf[t.pending++]=r>>>8&255},Wc=(t,r,s)=>{t.bi_valid>16-s?(t.bi_buf|=r<<t.bi_valid&65535,HT(t,t.bi_buf),t.bi_buf=r>>16-t.bi_valid,t.bi_valid+=s-16):(t.bi_buf|=r<<t.bi_valid&65535,t.bi_valid+=s)},Ch=(t,r,s)=>{Wc(t,s[2*r],s[2*r+1])},C7=(t,r)=>{let s=0;do s|=1&t,t>>>=1,s<<=1;while(--r>0);return s>>>1},I7=(t,r,s)=>{const o=new Array(16);let c,u,h=0;for(c=1;c<=BT;c++)h=h+s[c-1]<<1,o[c]=h;for(u=0;u<=r;u++){let m=t[2*u+1];m!==0&&(t[2*u]=C7(o[m]++,m))}},A7=t=>{let r;for(r=0;r<v7;r++)t.dyn_ltree[2*r]=0;for(r=0;r<jT;r++)t.dyn_dtree[2*r]=0;for(r=0;r<19;r++)t.bl_tree[2*r]=0;t.dyn_ltree[512]=1,t.opt_len=t.static_len=0,t.sym_next=t.matches=0},P7=t=>{t.bi_valid>8?HT(t,t.bi_buf):t.bi_valid>0&&(t.pending_buf[t.pending++]=t.bi_buf),t.bi_buf=0,t.bi_valid=0},O7=(t,r,s,o)=>{const c=2*r,u=2*s;return t[c]<t[u]||t[c]===t[u]&&o[r]<=o[s]},SM=(t,r,s)=>{const o=t.heap[s];let c=s<<1;for(;c<=t.heap_len&&(c<t.heap_len&&O7(r,t.heap[c+1],t.heap[c],t.depth)&&c++,!O7(r,o,t.heap[c],t.depth));)t.heap[s]=t.heap[c],s=c,c<<=1;t.heap[s]=o},k7=(t,r,s)=>{let o,c,u,h,m=0;if(t.sym_next!==0)do o=255&t.pending_buf[t.sym_buf+m++],o+=(255&t.pending_buf[t.sym_buf+m++])<<8,c=t.pending_buf[t.sym_buf+m++],o===0?Ch(t,c,r):(u=GT[c],Ch(t,u+gM+1,r),h=_M[u],h!==0&&(c-=yM[u],Wc(t,c,h)),o--,u=R7(o),Ch(t,u,s),h=jP[u],h!==0&&(o-=BP[u],Wc(t,o,h)));while(m<t.sym_next);Ch(t,256,r)},bM=(t,r)=>{const s=r.dyn_tree,o=r.stat_desc.static_tree,c=r.stat_desc.has_stree,u=r.stat_desc.elems;let h,m,_,E=-1;for(t.heap_len=0,t.heap_max=573,h=0;h<u;h++)s[2*h]!==0?(t.heap[++t.heap_len]=E=h,t.depth[h]=0):s[2*h+1]=0;for(;t.heap_len<2;)_=t.heap[++t.heap_len]=E<2?++E:0,s[2*_]=1,t.depth[_]=0,t.opt_len--,c&&(t.static_len-=o[2*_+1]);for(r.max_code=E,h=t.heap_len>>1;h>=1;h--)SM(t,s,h);_=u;do h=t.heap[1],t.heap[1]=t.heap[t.heap_len--],SM(t,s,1),m=t.heap[1],t.heap[--t.heap_max]=h,t.heap[--t.heap_max]=m,s[2*_]=s[2*h]+s[2*m],t.depth[_]=(t.depth[h]>=t.depth[m]?t.depth[h]:t.depth[m])+1,s[2*h+1]=s[2*m+1]=_,t.heap[1]=_++,SM(t,s,1);while(t.heap_len>=2);t.heap[--t.heap_max]=t.heap[1],((S,R)=>{const P=R.dyn_tree,k=R.max_code,z=R.stat_desc.static_tree,U=R.stat_desc.has_stree,F=R.stat_desc.extra_bits,q=R.stat_desc.extra_base,Y=R.stat_desc.max_length;let le,ye,Ee,me,ke,Ye,ut=0;for(me=0;me<=BT;me++)S.bl_count[me]=0;for(P[2*S.heap[S.heap_max]+1]=0,le=S.heap_max+1;le<573;le++)ye=S.heap[le],me=P[2*P[2*ye+1]+1]+1,me>Y&&(me=Y,ut++),P[2*ye+1]=me,ye>k||(S.bl_count[me]++,ke=0,ye>=q&&(ke=F[ye-q]),Ye=P[2*ye],S.opt_len+=Ye*(me+ke),U&&(S.static_len+=Ye*(z[2*ye+1]+ke)));if(ut!==0){do{for(me=Y-1;S.bl_count[me]===0;)me--;S.bl_count[me]--,S.bl_count[me+1]+=2,S.bl_count[Y]--,ut-=2}while(ut>0);for(me=Y;me!==0;me--)for(ye=S.bl_count[me];ye!==0;)Ee=S.heap[--le],Ee>k||(P[2*Ee+1]!==me&&(S.opt_len+=(me-P[2*Ee+1])*P[2*Ee],P[2*Ee+1]=me),ye--)}})(t,r),I7(s,E,t.bl_count)},N7=(t,r,s)=>{let o,c,u=-1,h=r[1],m=0,_=7,E=4;for(h===0&&(_=138,E=3),r[2*(s+1)+1]=65535,o=0;o<=s;o++)c=h,h=r[2*(o+1)+1],++m<_&&c===h||(m<E?t.bl_tree[2*c]+=m:c!==0?(c!==u&&t.bl_tree[2*c]++,t.bl_tree[32]++):m<=10?t.bl_tree[34]++:t.bl_tree[36]++,m=0,u=c,h===0?(_=138,E=3):c===h?(_=6,E=3):(_=7,E=4))},D7=(t,r,s)=>{let o,c,u=-1,h=r[1],m=0,_=7,E=4;for(h===0&&(_=138,E=3),o=0;o<=s;o++)if(c=h,h=r[2*(o+1)+1],!(++m<_&&c===h)){if(m<E)do Ch(t,c,t.bl_tree);while(--m!=0);else c!==0?(c!==u&&(Ch(t,c,t.bl_tree),m--),Ch(t,16,t.bl_tree),Wc(t,m-3,2)):m<=10?(Ch(t,17,t.bl_tree),Wc(t,m-3,3)):(Ch(t,18,t.bl_tree),Wc(t,m-11,7));m=0,u=c,h===0?(_=138,E=3):c===h?(_=6,E=3):(_=7,E=4)}};let L7=!1;const x7=(t,r,s,o)=>{Wc(t,0+(o?1:0),3),P7(t),HT(t,s),HT(t,~s),s&&t.pending_buf.set(t.window.subarray(r,r+s),t.pending),t.pending+=s};var pge=t=>{L7||((()=>{let r,s,o,c,u;const h=new Array(16);for(o=0,c=0;c<28;c++)for(yM[c]=o,r=0;r<1<<_M[c];r++)GT[o++]=c;for(GT[o-1]=c,u=0,c=0;c<16;c++)for(BP[c]=u,r=0;r<1<<jP[c];r++)zT[u++]=c;for(u>>=7;c<jT;c++)for(BP[c]=u<<7,r=0;r<1<<jP[c]-7;r++)zT[256+u++]=c;for(s=0;s<=BT;s++)h[s]=0;for(r=0;r<=143;)ip[2*r+1]=8,r++,h[8]++;for(;r<=255;)ip[2*r+1]=9,r++,h[9]++;for(;r<=279;)ip[2*r+1]=7,r++,h[7]++;for(;r<=287;)ip[2*r+1]=8,r++,h[8]++;for(I7(ip,287,h),r=0;r<jT;r++)WT[2*r+1]=5,WT[2*r]=C7(r,5);b7=new EM(ip,_M,257,v7,BT),T7=new EM(WT,jP,0,jT,BT),w7=new EM(new Array(0),fge,0,19,7)})(),L7=!0),t.l_desc=new vM(t.dyn_ltree,b7),t.d_desc=new vM(t.dyn_dtree,T7),t.bl_desc=new vM(t.bl_tree,w7),t.bi_buf=0,t.bi_valid=0,A7(t)},mge=(t,r,s,o)=>{let c,u,h=0;t.level>0?(t.strm.data_type===2&&(t.strm.data_type=(m=>{let _,E=4093624447;for(_=0;_<=31;_++,E>>>=1)if(1&E&&m.dyn_ltree[2*_]!==0)return 0;if(m.dyn_ltree[18]!==0||m.dyn_ltree[20]!==0||m.dyn_ltree[26]!==0)return 1;for(_=32;_<gM;_++)if(m.dyn_ltree[2*_]!==0)return 1;return 0})(t)),bM(t,t.l_desc),bM(t,t.d_desc),h=(m=>{let _;for(N7(m,m.dyn_ltree,m.l_desc.max_code),N7(m,m.dyn_dtree,m.d_desc.max_code),bM(m,m.bl_desc),_=18;_>=3&&m.bl_tree[2*S7[_]+1]===0;_--);return m.opt_len+=3*(_+1)+5+5+4,_})(t),c=t.opt_len+3+7>>>3,u=t.static_len+3+7>>>3,u<=c&&(c=u)):c=u=s+5,s+4<=c&&r!==-1?x7(t,r,s,o):t.strategy===4||u===c?(Wc(t,2+(o?1:0),3),k7(t,ip,WT)):(Wc(t,4+(o?1:0),3),((m,_,E,S)=>{let R;for(Wc(m,_-257,5),Wc(m,E-1,5),Wc(m,S-4,4),R=0;R<S;R++)Wc(m,m.bl_tree[2*S7[R]+1],3);D7(m,m.dyn_ltree,_-1),D7(m,m.dyn_dtree,E-1)})(t,t.l_desc.max_code+1,t.d_desc.max_code+1,h+1),k7(t,t.dyn_ltree,t.dyn_dtree)),A7(t),o&&P7(t)},gge=(t,r,s)=>(t.pending_buf[t.sym_buf+t.sym_next++]=r,t.pending_buf[t.sym_buf+t.sym_next++]=r>>8,t.pending_buf[t.sym_buf+t.sym_next++]=s,r===0?t.dyn_ltree[2*s]++:(t.matches++,r--,t.dyn_ltree[2*(GT[s]+gM+1)]++,t.dyn_dtree[2*R7(r)]++),t.sym_next===t.sym_end),_ge=t=>{Wc(t,2,3),Ch(t,256,ip),(r=>{r.bi_valid===16?(HT(r,r.bi_buf),r.bi_buf=0,r.bi_valid=0):r.bi_valid>=8&&(r.pending_buf[r.pending++]=255&r.bi_buf,r.bi_buf>>=8,r.bi_valid-=8)})(t)},yge={_tr_init:pge,_tr_stored_block:x7,_tr_flush_block:mge,_tr_tally:gge,_tr_align:_ge},$T=(t,r,s,o)=>{let c=65535&t|0,u=t>>>16&65535|0,h=0;for(;s!==0;){h=s>2e3?2e3:s,s-=h;do c=c+r[o++]|0,u=u+c|0;while(--h);c%=65521,u%=65521}return c|u<<16|0};const Ege=new Uint32Array((()=>{let t,r=[];for(var s=0;s<256;s++){t=s;for(var o=0;o<8;o++)t=1&t?3988292384^t>>>1:t>>>1;r[s]=t}return r})());var Ro=(t,r,s,o)=>{const c=Ege,u=o+s;t^=-1;for(let h=o;h<u;h++)t=t>>>8^c[255&(t^r[h])];return-1^t},J_={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"},WP={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_MEM_ERROR:-4,Z_BUF_ERROR:-5,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_UNKNOWN:2,Z_DEFLATED:8};const{_tr_init:vge,_tr_stored_block:TM,_tr_flush_block:Sge,_tr_tally:jm,_tr_align:bge}=yge,{Z_NO_FLUSH:Bm,Z_PARTIAL_FLUSH:Tge,Z_FULL_FLUSH:wge,Z_FINISH:yu,Z_BLOCK:M7,Z_OK:Jo,Z_STREAM_END:U7,Z_STREAM_ERROR:Ih,Z_DATA_ERROR:Rge,Z_BUF_ERROR:wM,Z_DEFAULT_COMPRESSION:Cge,Z_FILTERED:Ige,Z_HUFFMAN_ONLY:zP,Z_RLE:Age,Z_FIXED:Pge,Z_DEFAULT_STRATEGY:Oge,Z_UNKNOWN:kge,Z_DEFLATED:GP}=WP,RM=286,Nge=30,Dge=19,Lge=2*RM+1,xge=15,Q_=258,Ah=262,cS=42,Z_=113,KT=666,ey=(t,r)=>(t.msg=J_[r],r),V7=t=>2*t-(t>4?9:0),Wm=t=>{let r=t.length;for(;--r>=0;)t[r]=0},Mge=t=>{let r,s,o,c=t.w_size;r=t.hash_size,o=r;do s=t.head[--o],t.head[o]=s>=c?s-c:0;while(--r);r=c,o=r;do s=t.prev[--o],t.prev[o]=s>=c?s-c:0;while(--r)};let zm=(t,r,s)=>(r<<t.hash_shift^s)&t.hash_mask;const Tl=t=>{const r=t.state;let s=r.pending;s>t.avail_out&&(s=t.avail_out),s!==0&&(t.output.set(r.pending_buf.subarray(r.pending_out,r.pending_out+s),t.next_out),t.next_out+=s,r.pending_out+=s,t.total_out+=s,t.avail_out-=s,r.pending-=s,r.pending===0&&(r.pending_out=0))},wl=(t,r)=>{Sge(t,t.block_start>=0?t.block_start:-1,t.strstart-t.block_start,r),t.block_start=t.strstart,Tl(t.strm)},$r=(t,r)=>{t.pending_buf[t.pending++]=r},qT=(t,r)=>{t.pending_buf[t.pending++]=r>>>8&255,t.pending_buf[t.pending++]=255&r},CM=(t,r,s,o)=>{let c=t.avail_in;return c>o&&(c=o),c===0?0:(t.avail_in-=c,r.set(t.input.subarray(t.next_in,t.next_in+c),s),t.state.wrap===1?t.adler=$T(t.adler,r,c,s):t.state.wrap===2&&(t.adler=Ro(t.adler,r,c,s)),t.next_in+=c,t.total_in+=c,c)},F7=(t,r)=>{let s,o,c=t.max_chain_length,u=t.strstart,h=t.prev_length,m=t.nice_match;const _=t.strstart>t.w_size-Ah?t.strstart-(t.w_size-Ah):0,E=t.window,S=t.w_mask,R=t.prev,P=t.strstart+Q_;let k=E[u+h-1],z=E[u+h];t.prev_length>=t.good_match&&(c>>=2),m>t.lookahead&&(m=t.lookahead);do if(s=r,E[s+h]===z&&E[s+h-1]===k&&E[s]===E[u]&&E[++s]===E[u+1]){u+=2,s++;do;while(E[++u]===E[++s]&&E[++u]===E[++s]&&E[++u]===E[++s]&&E[++u]===E[++s]&&E[++u]===E[++s]&&E[++u]===E[++s]&&E[++u]===E[++s]&&E[++u]===E[++s]&&u<P);if(o=Q_-(P-u),u=P-Q_,o>h){if(t.match_start=r,h=o,o>=m)break;k=E[u+h-1],z=E[u+h]}}while((r=R[r&S])>_&&--c!=0);return h<=t.lookahead?h:t.lookahead},lS=t=>{const r=t.w_size;let s,o,c;do{if(o=t.window_size-t.lookahead-t.strstart,t.strstart>=r+(r-Ah)&&(t.window.set(t.window.subarray(r,r+r-o),0),t.match_start-=r,t.strstart-=r,t.block_start-=r,t.insert>t.strstart&&(t.insert=t.strstart),Mge(t),o+=r),t.strm.avail_in===0)break;if(s=CM(t.strm,t.window,t.strstart+t.lookahead,o),t.lookahead+=s,t.lookahead+t.insert>=3)for(c=t.strstart-t.insert,t.ins_h=t.window[c],t.ins_h=zm(t,t.ins_h,t.window[c+1]);t.insert&&(t.ins_h=zm(t,t.ins_h,t.window[c+3-1]),t.prev[c&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=c,c++,t.insert--,!(t.lookahead+t.insert<3)););}while(t.lookahead<Ah&&t.strm.avail_in!==0)},j7=(t,r)=>{let s,o,c,u=t.pending_buf_size-5>t.w_size?t.w_size:t.pending_buf_size-5,h=0,m=t.strm.avail_in;do{if(s=65535,c=t.bi_valid+42>>3,t.strm.avail_out<c||(c=t.strm.avail_out-c,o=t.strstart-t.block_start,s>o+t.strm.avail_in&&(s=o+t.strm.avail_in),s>c&&(s=c),s<u&&(s===0&&r!==yu||r===Bm||s!==o+t.strm.avail_in)))break;h=r===yu&&s===o+t.strm.avail_in?1:0,TM(t,0,0,h),t.pending_buf[t.pending-4]=s,t.pending_buf[t.pending-3]=s>>8,t.pending_buf[t.pending-2]=~s,t.pending_buf[t.pending-1]=~s>>8,Tl(t.strm),o&&(o>s&&(o=s),t.strm.output.set(t.window.subarray(t.block_start,t.block_start+o),t.strm.next_out),t.strm.next_out+=o,t.strm.avail_out-=o,t.strm.total_out+=o,t.block_start+=o,s-=o),s&&(CM(t.strm,t.strm.output,t.strm.next_out,s),t.strm.next_out+=s,t.strm.avail_out-=s,t.strm.total_out+=s)}while(h===0);return m-=t.strm.avail_in,m&&(m>=t.w_size?(t.matches=2,t.window.set(t.strm.input.subarray(t.strm.next_in-t.w_size,t.strm.next_in),0),t.strstart=t.w_size,t.insert=t.strstart):(t.window_size-t.strstart<=m&&(t.strstart-=t.w_size,t.window.set(t.window.subarray(t.w_size,t.w_size+t.strstart),0),t.matches<2&&t.matches++,t.insert>t.strstart&&(t.insert=t.strstart)),t.window.set(t.strm.input.subarray(t.strm.next_in-m,t.strm.next_in),t.strstart),t.strstart+=m,t.insert+=m>t.w_size-t.insert?t.w_size-t.insert:m),t.block_start=t.strstart),t.high_water<t.strstart&&(t.high_water=t.strstart),h?4:r!==Bm&&r!==yu&&t.strm.avail_in===0&&t.strstart===t.block_start?2:(c=t.window_size-t.strstart,t.strm.avail_in>c&&t.block_start>=t.w_size&&(t.block_start-=t.w_size,t.strstart-=t.w_size,t.window.set(t.window.subarray(t.w_size,t.w_size+t.strstart),0),t.matches<2&&t.matches++,c+=t.w_size,t.insert>t.strstart&&(t.insert=t.strstart)),c>t.strm.avail_in&&(c=t.strm.avail_in),c&&(CM(t.strm,t.window,t.strstart,c),t.strstart+=c,t.insert+=c>t.w_size-t.insert?t.w_size-t.insert:c),t.high_water<t.strstart&&(t.high_water=t.strstart),c=t.bi_valid+42>>3,c=t.pending_buf_size-c>65535?65535:t.pending_buf_size-c,u=c>t.w_size?t.w_size:c,o=t.strstart-t.block_start,(o>=u||(o||r===yu)&&r!==Bm&&t.strm.avail_in===0&&o<=c)&&(s=o>c?c:o,h=r===yu&&t.strm.avail_in===0&&s===o?1:0,TM(t,t.block_start,s,h),t.block_start+=s,Tl(t.strm)),h?3:1)},IM=(t,r)=>{let s,o;for(;;){if(t.lookahead<Ah){if(lS(t),t.lookahead<Ah&&r===Bm)return 1;if(t.lookahead===0)break}if(s=0,t.lookahead>=3&&(t.ins_h=zm(t,t.ins_h,t.window[t.strstart+3-1]),s=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart),s!==0&&t.strstart-s<=t.w_size-Ah&&(t.match_length=F7(t,s)),t.match_length>=3)if(o=jm(t,t.strstart-t.match_start,t.match_length-3),t.lookahead-=t.match_length,t.match_length<=t.max_lazy_match&&t.lookahead>=3){t.match_length--;do t.strstart++,t.ins_h=zm(t,t.ins_h,t.window[t.strstart+3-1]),s=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart;while(--t.match_length!=0);t.strstart++}else t.strstart+=t.match_length,t.match_length=0,t.ins_h=t.window[t.strstart],t.ins_h=zm(t,t.ins_h,t.window[t.strstart+1]);else o=jm(t,0,t.window[t.strstart]),t.lookahead--,t.strstart++;if(o&&(wl(t,!1),t.strm.avail_out===0))return 1}return t.insert=t.strstart<2?t.strstart:2,r===yu?(wl(t,!0),t.strm.avail_out===0?3:4):t.sym_next&&(wl(t,!1),t.strm.avail_out===0)?1:2},uS=(t,r)=>{let s,o,c;for(;;){if(t.lookahead<Ah){if(lS(t),t.lookahead<Ah&&r===Bm)return 1;if(t.lookahead===0)break}if(s=0,t.lookahead>=3&&(t.ins_h=zm(t,t.ins_h,t.window[t.strstart+3-1]),s=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart),t.prev_length=t.match_length,t.prev_match=t.match_start,t.match_length=2,s!==0&&t.prev_length<t.max_lazy_match&&t.strstart-s<=t.w_size-Ah&&(t.match_length=F7(t,s),t.match_length<=5&&(t.strategy===Ige||t.match_length===3&&t.strstart-t.match_start>4096)&&(t.match_length=2)),t.prev_length>=3&&t.match_length<=t.prev_length){c=t.strstart+t.lookahead-3,o=jm(t,t.strstart-1-t.prev_match,t.prev_length-3),t.lookahead-=t.prev_length-1,t.prev_length-=2;do++t.strstart<=c&&(t.ins_h=zm(t,t.ins_h,t.window[t.strstart+3-1]),s=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart);while(--t.prev_length!=0);if(t.match_available=0,t.match_length=2,t.strstart++,o&&(wl(t,!1),t.strm.avail_out===0))return 1}else if(t.match_available){if(o=jm(t,0,t.window[t.strstart-1]),o&&wl(t,!1),t.strstart++,t.lookahead--,t.strm.avail_out===0)return 1}else t.match_available=1,t.strstart++,t.lookahead--}return t.match_available&&(o=jm(t,0,t.window[t.strstart-1]),t.match_available=0),t.insert=t.strstart<2?t.strstart:2,r===yu?(wl(t,!0),t.strm.avail_out===0?3:4):t.sym_next&&(wl(t,!1),t.strm.avail_out===0)?1:2};function Ph(t,r,s,o,c){this.good_length=t,this.max_lazy=r,this.nice_length=s,this.max_chain=o,this.func=c}const YT=[new Ph(0,0,0,0,j7),new Ph(4,4,8,4,IM),new Ph(4,5,16,8,IM),new Ph(4,6,32,32,IM),new Ph(4,4,16,16,uS),new Ph(8,16,32,32,uS),new Ph(8,16,128,128,uS),new Ph(8,32,128,256,uS),new Ph(32,128,258,1024,uS),new Ph(32,258,258,4096,uS)];function Uge(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=GP,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new Uint16Array(2*Lge),this.dyn_dtree=new Uint16Array(2*(2*Nge+1)),this.bl_tree=new Uint16Array(2*(2*Dge+1)),Wm(this.dyn_ltree),Wm(this.dyn_dtree),Wm(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new Uint16Array(xge+1),this.heap=new Uint16Array(2*RM+1),Wm(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new Uint16Array(2*RM+1),Wm(this.depth),this.sym_buf=0,this.lit_bufsize=0,this.sym_next=0,this.sym_end=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}const XT=t=>{if(!t)return 1;const r=t.state;return!r||r.strm!==t||r.status!==cS&&r.status!==57&&r.status!==69&&r.status!==73&&r.status!==91&&r.status!==103&&r.status!==Z_&&r.status!==KT?1:0},B7=t=>{if(XT(t))return ey(t,Ih);t.total_in=t.total_out=0,t.data_type=kge;const r=t.state;return r.pending=0,r.pending_out=0,r.wrap<0&&(r.wrap=-r.wrap),r.status=r.wrap===2?57:r.wrap?cS:Z_,t.adler=r.wrap===2?0:1,r.last_flush=-2,vge(r),Jo},W7=t=>{const r=B7(t);return r===Jo&&(s=>{s.window_size=2*s.w_size,Wm(s.head),s.max_lazy_match=YT[s.level].max_lazy,s.good_match=YT[s.level].good_length,s.nice_match=YT[s.level].nice_length,s.max_chain_length=YT[s.level].max_chain,s.strstart=0,s.block_start=0,s.lookahead=0,s.insert=0,s.match_length=s.prev_length=2,s.match_available=0,s.ins_h=0})(t.state),r},z7=(t,r,s,o,c,u)=>{if(!t)return Ih;let h=1;if(r===Cge&&(r=6),o<0?(h=0,o=-o):o>15&&(h=2,o-=16),c<1||c>9||s!==GP||o<8||o>15||r<0||r>9||u<0||u>Pge||o===8&&h!==1)return ey(t,Ih);o===8&&(o=9);const m=new Uge;return t.state=m,m.strm=t,m.status=cS,m.wrap=h,m.gzhead=null,m.w_bits=o,m.w_size=1<<m.w_bits,m.w_mask=m.w_size-1,m.hash_bits=c+7,m.hash_size=1<<m.hash_bits,m.hash_mask=m.hash_size-1,m.hash_shift=~~((m.hash_bits+3-1)/3),m.window=new Uint8Array(2*m.w_size),m.head=new Uint16Array(m.hash_size),m.prev=new Uint16Array(m.w_size),m.lit_bufsize=1<<c+6,m.pending_buf_size=4*m.lit_bufsize,m.pending_buf=new Uint8Array(m.pending_buf_size),m.sym_buf=m.lit_bufsize,m.sym_end=3*(m.lit_bufsize-1),m.level=r,m.strategy=u,m.method=s,W7(t)};var Vge=(t,r)=>{if(XT(t)||r>M7||r<0)return t?ey(t,Ih):Ih;const s=t.state;if(!t.output||t.avail_in!==0&&!t.input||s.status===KT&&r!==yu)return ey(t,t.avail_out===0?wM:Ih);const o=s.last_flush;if(s.last_flush=r,s.pending!==0){if(Tl(t),t.avail_out===0)return s.last_flush=-1,Jo}else if(t.avail_in===0&&V7(r)<=V7(o)&&r!==yu)return ey(t,wM);if(s.status===KT&&t.avail_in!==0)return ey(t,wM);if(s.status===cS&&s.wrap===0&&(s.status=Z_),s.status===cS){let c=GP+(s.w_bits-8<<4)<<8,u=-1;if(u=s.strategy>=zP||s.level<2?0:s.level<6?1:s.level===6?2:3,c|=u<<6,s.strstart!==0&&(c|=32),c+=31-c%31,qT(s,c),s.strstart!==0&&(qT(s,t.adler>>>16),qT(s,65535&t.adler)),t.adler=1,s.status=Z_,Tl(t),s.pending!==0)return s.last_flush=-1,Jo}if(s.status===57){if(t.adler=0,$r(s,31),$r(s,139),$r(s,8),s.gzhead)$r(s,(s.gzhead.text?1:0)+(s.gzhead.hcrc?2:0)+(s.gzhead.extra?4:0)+(s.gzhead.name?8:0)+(s.gzhead.comment?16:0)),$r(s,255&s.gzhead.time),$r(s,s.gzhead.time>>8&255),$r(s,s.gzhead.time>>16&255),$r(s,s.gzhead.time>>24&255),$r(s,s.level===9?2:s.strategy>=zP||s.level<2?4:0),$r(s,255&s.gzhead.os),s.gzhead.extra&&s.gzhead.extra.length&&($r(s,255&s.gzhead.extra.length),$r(s,s.gzhead.extra.length>>8&255)),s.gzhead.hcrc&&(t.adler=Ro(t.adler,s.pending_buf,s.pending,0)),s.gzindex=0,s.status=69;else if($r(s,0),$r(s,0),$r(s,0),$r(s,0),$r(s,0),$r(s,s.level===9?2:s.strategy>=zP||s.level<2?4:0),$r(s,3),s.status=Z_,Tl(t),s.pending!==0)return s.last_flush=-1,Jo}if(s.status===69){if(s.gzhead.extra){let c=s.pending,u=(65535&s.gzhead.extra.length)-s.gzindex;for(;s.pending+u>s.pending_buf_size;){let m=s.pending_buf_size-s.pending;if(s.pending_buf.set(s.gzhead.extra.subarray(s.gzindex,s.gzindex+m),s.pending),s.pending=s.pending_buf_size,s.gzhead.hcrc&&s.pending>c&&(t.adler=Ro(t.adler,s.pending_buf,s.pending-c,c)),s.gzindex+=m,Tl(t),s.pending!==0)return s.last_flush=-1,Jo;c=0,u-=m}let h=new Uint8Array(s.gzhead.extra);s.pending_buf.set(h.subarray(s.gzindex,s.gzindex+u),s.pending),s.pending+=u,s.gzhead.hcrc&&s.pending>c&&(t.adler=Ro(t.adler,s.pending_buf,s.pending-c,c)),s.gzindex=0}s.status=73}if(s.status===73){if(s.gzhead.name){let c,u=s.pending;do{if(s.pending===s.pending_buf_size){if(s.gzhead.hcrc&&s.pending>u&&(t.adler=Ro(t.adler,s.pending_buf,s.pending-u,u)),Tl(t),s.pending!==0)return s.last_flush=-1,Jo;u=0}c=s.gzindex<s.gzhead.name.length?255&s.gzhead.name.charCodeAt(s.gzindex++):0,$r(s,c)}while(c!==0);s.gzhead.hcrc&&s.pending>u&&(t.adler=Ro(t.adler,s.pending_buf,s.pending-u,u)),s.gzindex=0}s.status=91}if(s.status===91){if(s.gzhead.comment){let c,u=s.pending;do{if(s.pending===s.pending_buf_size){if(s.gzhead.hcrc&&s.pending>u&&(t.adler=Ro(t.adler,s.pending_buf,s.pending-u,u)),Tl(t),s.pending!==0)return s.last_flush=-1,Jo;u=0}c=s.gzindex<s.gzhead.comment.length?255&s.gzhead.comment.charCodeAt(s.gzindex++):0,$r(s,c)}while(c!==0);s.gzhead.hcrc&&s.pending>u&&(t.adler=Ro(t.adler,s.pending_buf,s.pending-u,u))}s.status=103}if(s.status===103){if(s.gzhead.hcrc){if(s.pending+2>s.pending_buf_size&&(Tl(t),s.pending!==0))return s.last_flush=-1,Jo;$r(s,255&t.adler),$r(s,t.adler>>8&255),t.adler=0}if(s.status=Z_,Tl(t),s.pending!==0)return s.last_flush=-1,Jo}if(t.avail_in!==0||s.lookahead!==0||r!==Bm&&s.status!==KT){let c=s.level===0?j7(s,r):s.strategy===zP?((u,h)=>{let m;for(;;){if(u.lookahead===0&&(lS(u),u.lookahead===0)){if(h===Bm)return 1;break}if(u.match_length=0,m=jm(u,0,u.window[u.strstart]),u.lookahead--,u.strstart++,m&&(wl(u,!1),u.strm.avail_out===0))return 1}return u.insert=0,h===yu?(wl(u,!0),u.strm.avail_out===0?3:4):u.sym_next&&(wl(u,!1),u.strm.avail_out===0)?1:2})(s,r):s.strategy===Age?((u,h)=>{let m,_,E,S;const R=u.window;for(;;){if(u.lookahead<=Q_){if(lS(u),u.lookahead<=Q_&&h===Bm)return 1;if(u.lookahead===0)break}if(u.match_length=0,u.lookahead>=3&&u.strstart>0&&(E=u.strstart-1,_=R[E],_===R[++E]&&_===R[++E]&&_===R[++E])){S=u.strstart+Q_;do;while(_===R[++E]&&_===R[++E]&&_===R[++E]&&_===R[++E]&&_===R[++E]&&_===R[++E]&&_===R[++E]&&_===R[++E]&&E<S);u.match_length=Q_-(S-E),u.match_length>u.lookahead&&(u.match_length=u.lookahead)}if(u.match_length>=3?(m=jm(u,1,u.match_length-3),u.lookahead-=u.match_length,u.strstart+=u.match_length,u.match_length=0):(m=jm(u,0,u.window[u.strstart]),u.lookahead--,u.strstart++),m&&(wl(u,!1),u.strm.avail_out===0))return 1}return u.insert=0,h===yu?(wl(u,!0),u.strm.avail_out===0?3:4):u.sym_next&&(wl(u,!1),u.strm.avail_out===0)?1:2})(s,r):YT[s.level].func(s,r);if(c!==3&&c!==4||(s.status=KT),c===1||c===3)return t.avail_out===0&&(s.last_flush=-1),Jo;if(c===2&&(r===Tge?bge(s):r!==M7&&(TM(s,0,0,!1),r===wge&&(Wm(s.head),s.lookahead===0&&(s.strstart=0,s.block_start=0,s.insert=0))),Tl(t),t.avail_out===0))return s.last_flush=-1,Jo}return r!==yu?Jo:s.wrap<=0?U7:(s.wrap===2?($r(s,255&t.adler),$r(s,t.adler>>8&255),$r(s,t.adler>>16&255),$r(s,t.adler>>24&255),$r(s,255&t.total_in),$r(s,t.total_in>>8&255),$r(s,t.total_in>>16&255),$r(s,t.total_in>>24&255)):(qT(s,t.adler>>>16),qT(s,65535&t.adler)),Tl(t),s.wrap>0&&(s.wrap=-s.wrap),s.pending!==0?Jo:U7)},Fge=(t,r)=>{let s=r.length;if(XT(t))return Ih;const o=t.state,c=o.wrap;if(c===2||c===1&&o.status!==cS||o.lookahead)return Ih;if(c===1&&(t.adler=$T(t.adler,r,s,0)),o.wrap=0,s>=o.w_size){c===0&&(Wm(o.head),o.strstart=0,o.block_start=0,o.insert=0);let _=new Uint8Array(o.w_size);_.set(r.subarray(s-o.w_size,s),0),r=_,s=o.w_size}const u=t.avail_in,h=t.next_in,m=t.input;for(t.avail_in=s,t.next_in=0,t.input=r,lS(o);o.lookahead>=3;){let _=o.strstart,E=o.lookahead-2;do o.ins_h=zm(o,o.ins_h,o.window[_+3-1]),o.prev[_&o.w_mask]=o.head[o.ins_h],o.head[o.ins_h]=_,_++;while(--E);o.strstart=_,o.lookahead=2,lS(o)}return o.strstart+=o.lookahead,o.block_start=o.strstart,o.insert=o.lookahead,o.lookahead=0,o.match_length=o.prev_length=2,o.match_available=0,t.next_in=h,t.input=m,t.avail_in=u,o.wrap=c,Jo},JT={deflateInit:(t,r)=>z7(t,r,GP,15,8,Oge),deflateInit2:z7,deflateReset:W7,deflateResetKeep:B7,deflateSetHeader:(t,r)=>XT(t)||t.state.wrap!==2?Ih:(t.state.gzhead=r,Jo),deflate:Vge,deflateEnd:t=>{if(XT(t))return Ih;const r=t.state.status;return t.state=null,r===Z_?ey(t,Rge):Jo},deflateSetDictionary:Fge,deflateInfo:"pako deflate (from Nodeca project)"};const jge=(t,r)=>Object.prototype.hasOwnProperty.call(t,r);var HP={assign:function(t){const r=Array.prototype.slice.call(arguments,1);for(;r.length;){const s=r.shift();if(s){if(typeof s!="object")throw new TypeError(s+"must be non-object");for(const o in s)jge(s,o)&&(t[o]=s[o])}}return t},flattenChunks:t=>{let r=0;for(let o=0,c=t.length;o<c;o++)r+=t[o].length;const s=new Uint8Array(r);for(let o=0,c=0,u=t.length;o<u;o++){let h=t[o];s.set(h,c),c+=h.length}return s}};let G7=!0;try{String.fromCharCode.apply(null,new Uint8Array(1))}catch{G7=!1}const QT=new Uint8Array(256);for(let t=0;t<256;t++)QT[t]=t>=252?6:t>=248?5:t>=240?4:t>=224?3:t>=192?2:1;QT[254]=QT[254]=1;var ZT={string2buf:t=>{if(typeof TextEncoder=="function"&&TextEncoder.prototype.encode)return new TextEncoder().encode(t);let r,s,o,c,u,h=t.length,m=0;for(c=0;c<h;c++)s=t.charCodeAt(c),(64512&s)==55296&&c+1<h&&(o=t.charCodeAt(c+1),(64512&o)==56320&&(s=65536+(s-55296<<10)+(o-56320),c++)),m+=s<128?1:s<2048?2:s<65536?3:4;for(r=new Uint8Array(m),u=0,c=0;u<m;c++)s=t.charCodeAt(c),(64512&s)==55296&&c+1<h&&(o=t.charCodeAt(c+1),(64512&o)==56320&&(s=65536+(s-55296<<10)+(o-56320),c++)),s<128?r[u++]=s:s<2048?(r[u++]=192|s>>>6,r[u++]=128|63&s):s<65536?(r[u++]=224|s>>>12,r[u++]=128|s>>>6&63,r[u++]=128|63&s):(r[u++]=240|s>>>18,r[u++]=128|s>>>12&63,r[u++]=128|s>>>6&63,r[u++]=128|63&s);return r},buf2string:(t,r)=>{const s=r||t.length;if(typeof TextDecoder=="function"&&TextDecoder.prototype.decode)return new TextDecoder().decode(t.subarray(0,r));let o,c;const u=new Array(2*s);for(c=0,o=0;o<s;){let h=t[o++];if(h<128){u[c++]=h;continue}let m=QT[h];if(m>4)u[c++]=65533,o+=m-1;else{for(h&=m===2?31:m===3?15:7;m>1&&o<s;)h=h<<6|63&t[o++],m--;m>1?u[c++]=65533:h<65536?u[c++]=h:(h-=65536,u[c++]=55296|h>>10&1023,u[c++]=56320|1023&h)}}return((h,m)=>{if(m<65534&&h.subarray&&G7)return String.fromCharCode.apply(null,h.length===m?h:h.subarray(0,m));let _="";for(let E=0;E<m;E++)_+=String.fromCharCode(h[E]);return _})(u,c)},utf8border:(t,r)=>{(r=r||t.length)>t.length&&(r=t.length);let s=r-1;for(;s>=0&&(192&t[s])==128;)s--;return s<0||s===0?r:s+QT[t[s]]>r?s:r}},H7=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0};const $7=Object.prototype.toString,{Z_NO_FLUSH:Bge,Z_SYNC_FLUSH:Wge,Z_FULL_FLUSH:zge,Z_FINISH:Gge,Z_OK:$P,Z_STREAM_END:Hge,Z_DEFAULT_COMPRESSION:$ge,Z_DEFAULT_STRATEGY:Kge,Z_DEFLATED:qge}=WP;function KP(t){this.options=HP.assign({level:$ge,method:qge,chunkSize:16384,windowBits:15,memLevel:8,strategy:Kge},t||{});let r=this.options;r.raw&&r.windowBits>0?r.windowBits=-r.windowBits:r.gzip&&r.windowBits>0&&r.windowBits<16&&(r.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new H7,this.strm.avail_out=0;let s=JT.deflateInit2(this.strm,r.level,r.method,r.windowBits,r.memLevel,r.strategy);if(s!==$P)throw new Error(J_[s]);if(r.header&&JT.deflateSetHeader(this.strm,r.header),r.dictionary){let o;if(o=typeof r.dictionary=="string"?ZT.string2buf(r.dictionary):$7.call(r.dictionary)==="[object ArrayBuffer]"?new Uint8Array(r.dictionary):r.dictionary,s=JT.deflateSetDictionary(this.strm,o),s!==$P)throw new Error(J_[s]);this._dict_set=!0}}function Yge(t,r){const s=new KP(r);if(s.push(t,!0),s.err)throw s.msg||J_[s.err];return s.result}KP.prototype.push=function(t,r){const s=this.strm,o=this.options.chunkSize;let c,u;if(this.ended)return!1;for(u=r===~~r?r:r===!0?Gge:Bge,typeof t=="string"?s.input=ZT.string2buf(t):$7.call(t)==="[object ArrayBuffer]"?s.input=new Uint8Array(t):s.input=t,s.next_in=0,s.avail_in=s.input.length;;)if(s.avail_out===0&&(s.output=new Uint8Array(o),s.next_out=0,s.avail_out=o),(u===Wge||u===zge)&&s.avail_out<=6)this.onData(s.output.subarray(0,s.next_out)),s.avail_out=0;else{if(c=JT.deflate(s,u),c===Hge)return s.next_out>0&&this.onData(s.output.subarray(0,s.next_out)),c=JT.deflateEnd(this.strm),this.onEnd(c),this.ended=!0,c===$P;if(s.avail_out!==0){if(u>0&&s.next_out>0)this.onData(s.output.subarray(0,s.next_out)),s.avail_out=0;else if(s.avail_in===0)break}else this.onData(s.output)}return!0},KP.prototype.onData=function(t){this.chunks.push(t)},KP.prototype.onEnd=function(t){t===$P&&(this.result=HP.flattenChunks(this.chunks)),this.chunks=[],this.err=t,this.msg=this.strm.msg};var Xge={deflate:Yge};const qP=16209;var Jge=function(t,r){let s,o,c,u,h,m,_,E,S,R,P,k,z,U,F,q,Y,le,ye,Ee,me,ke,Ye,ut;const pt=t.state;s=t.next_in,Ye=t.input,o=s+(t.avail_in-5),c=t.next_out,ut=t.output,u=c-(r-t.avail_out),h=c+(t.avail_out-257),m=pt.dmax,_=pt.wsize,E=pt.whave,S=pt.wnext,R=pt.window,P=pt.hold,k=pt.bits,z=pt.lencode,U=pt.distcode,F=(1<<pt.lenbits)-1,q=(1<<pt.distbits)-1;e:do{k<15&&(P+=Ye[s++]<<k,k+=8,P+=Ye[s++]<<k,k+=8),Y=z[P&F];t:for(;;){if(le=Y>>>24,P>>>=le,k-=le,le=Y>>>16&255,le===0)ut[c++]=65535&Y;else{if(!(16&le)){if((64&le)==0){Y=z[(65535&Y)+(P&(1<<le)-1)];continue t}if(32&le){pt.mode=16191;break e}t.msg="invalid literal/length code",pt.mode=qP;break e}ye=65535&Y,le&=15,le&&(k<le&&(P+=Ye[s++]<<k,k+=8),ye+=P&(1<<le)-1,P>>>=le,k-=le),k<15&&(P+=Ye[s++]<<k,k+=8,P+=Ye[s++]<<k,k+=8),Y=U[P&q];n:for(;;){if(le=Y>>>24,P>>>=le,k-=le,le=Y>>>16&255,!(16&le)){if((64&le)==0){Y=U[(65535&Y)+(P&(1<<le)-1)];continue n}t.msg="invalid distance code",pt.mode=qP;break e}if(Ee=65535&Y,le&=15,k<le&&(P+=Ye[s++]<<k,k+=8,k<le&&(P+=Ye[s++]<<k,k+=8)),Ee+=P&(1<<le)-1,Ee>m){t.msg="invalid distance too far back",pt.mode=qP;break e}if(P>>>=le,k-=le,le=c-u,Ee>le){if(le=Ee-le,le>E&&pt.sane){t.msg="invalid distance too far back",pt.mode=qP;break e}if(me=0,ke=R,S===0){if(me+=_-le,le<ye){ye-=le;do ut[c++]=R[me++];while(--le);me=c-Ee,ke=ut}}else if(S<le){if(me+=_+S-le,le-=S,le<ye){ye-=le;do ut[c++]=R[me++];while(--le);if(me=0,S<ye){le=S,ye-=le;do ut[c++]=R[me++];while(--le);me=c-Ee,ke=ut}}}else if(me+=S-le,le<ye){ye-=le;do ut[c++]=R[me++];while(--le);me=c-Ee,ke=ut}for(;ye>2;)ut[c++]=ke[me++],ut[c++]=ke[me++],ut[c++]=ke[me++],ye-=3;ye&&(ut[c++]=ke[me++],ye>1&&(ut[c++]=ke[me++]))}else{me=c-Ee;do ut[c++]=ut[me++],ut[c++]=ut[me++],ut[c++]=ut[me++],ye-=3;while(ye>2);ye&&(ut[c++]=ut[me++],ye>1&&(ut[c++]=ut[me++]))}break}}break}}while(s<o&&c<h);ye=k>>3,s-=ye,k-=ye<<3,P&=(1<<k)-1,t.next_in=s,t.next_out=c,t.avail_in=s<o?o-s+5:5-(s-o),t.avail_out=c<h?h-c+257:257-(c-h),pt.hold=P,pt.bits=k};const YP=15,Qge=new Uint16Array([3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0]),Zge=new Uint8Array([16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78]),e_e=new Uint16Array([1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0]),t_e=new Uint8Array([16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64]);var ew=(t,r,s,o,c,u,h,m)=>{const _=m.bits;let E,S,R,P,k,z,U=0,F=0,q=0,Y=0,le=0,ye=0,Ee=0,me=0,ke=0,Ye=0,ut=null;const pt=new Uint16Array(16),vn=new Uint16Array(16);let Sn,cr,ei,Wr=null;for(U=0;U<=YP;U++)pt[U]=0;for(F=0;F<o;F++)pt[r[s+F]]++;for(le=_,Y=YP;Y>=1&&pt[Y]===0;Y--);if(le>Y&&(le=Y),Y===0)return c[u++]=20971520,c[u++]=20971520,m.bits=1,0;for(q=1;q<Y&&pt[q]===0;q++);for(le<q&&(le=q),me=1,U=1;U<=YP;U++)if(me<<=1,me-=pt[U],me<0)return-1;if(me>0&&(t===0||Y!==1))return-1;for(vn[1]=0,U=1;U<YP;U++)vn[U+1]=vn[U]+pt[U];for(F=0;F<o;F++)r[s+F]!==0&&(h[vn[r[s+F]]++]=F);if(t===0?(ut=Wr=h,z=20):t===1?(ut=Qge,Wr=Zge,z=257):(ut=e_e,Wr=t_e,z=0),Ye=0,F=0,U=q,k=u,ye=le,Ee=0,R=-1,ke=1<<le,P=ke-1,t===1&&ke>852||t===2&&ke>592)return 1;for(;;){Sn=U-Ee,h[F]+1<z?(cr=0,ei=h[F]):h[F]>=z?(cr=Wr[h[F]-z],ei=ut[h[F]-z]):(cr=96,ei=0),E=1<<U-Ee,S=1<<ye,q=S;do S-=E,c[k+(Ye>>Ee)+S]=Sn<<24|cr<<16|ei|0;while(S!==0);for(E=1<<U-1;Ye&E;)E>>=1;if(E!==0?(Ye&=E-1,Ye+=E):Ye=0,F++,--pt[U]==0){if(U===Y)break;U=r[s+h[F]]}if(U>le&&(Ye&P)!==R){for(Ee===0&&(Ee=le),k+=q,ye=U-Ee,me=1<<ye;ye+Ee<Y&&(me-=pt[ye+Ee],!(me<=0));)ye++,me<<=1;if(ke+=1<<ye,t===1&&ke>852||t===2&&ke>592)return 1;R=Ye&P,c[R]=le<<24|ye<<16|k-u|0}}return Ye!==0&&(c[k+Ye]=U-Ee<<24|64<<16|0),m.bits=le,0};const{Z_FINISH:K7,Z_BLOCK:n_e,Z_TREES:XP,Z_OK:ty,Z_STREAM_END:r_e,Z_NEED_DICT:i_e,Z_STREAM_ERROR:Eu,Z_DATA_ERROR:q7,Z_MEM_ERROR:Y7,Z_BUF_ERROR:s_e,Z_DEFLATED:X7}=WP,JP=16180,QP=16190,sp=16191,AM=16192,PM=16194,ZP=16199,eO=16200,OM=16206,ns=16209,J7=t=>(t>>>24&255)+(t>>>8&65280)+((65280&t)<<8)+((255&t)<<24);function o_e(){this.strm=null,this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new Uint16Array(320),this.work=new Uint16Array(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}const ny=t=>{if(!t)return 1;const r=t.state;return!r||r.strm!==t||r.mode<JP||r.mode>16211?1:0},Q7=t=>{if(ny(t))return Eu;const r=t.state;return t.total_in=t.total_out=r.total=0,t.msg="",r.wrap&&(t.adler=1&r.wrap),r.mode=JP,r.last=0,r.havedict=0,r.flags=-1,r.dmax=32768,r.head=null,r.hold=0,r.bits=0,r.lencode=r.lendyn=new Int32Array(852),r.distcode=r.distdyn=new Int32Array(592),r.sane=1,r.back=-1,ty},Z7=t=>{if(ny(t))return Eu;const r=t.state;return r.wsize=0,r.whave=0,r.wnext=0,Q7(t)},e$=(t,r)=>{let s;if(ny(t))return Eu;const o=t.state;return r<0?(s=0,r=-r):(s=5+(r>>4),r<48&&(r&=15)),r&&(r<8||r>15)?Eu:(o.window!==null&&o.wbits!==r&&(o.window=null),o.wrap=s,o.wbits=r,Z7(t))},t$=(t,r)=>{if(!t)return Eu;const s=new o_e;t.state=s,s.strm=t,s.window=null,s.mode=JP;const o=e$(t,r);return o!==ty&&(t.state=null),o};let kM,NM,n$=!0;const a_e=t=>{if(n$){kM=new Int32Array(512),NM=new Int32Array(32);let r=0;for(;r<144;)t.lens[r++]=8;for(;r<256;)t.lens[r++]=9;for(;r<280;)t.lens[r++]=7;for(;r<288;)t.lens[r++]=8;for(ew(1,t.lens,0,288,kM,0,t.work,{bits:9}),r=0;r<32;)t.lens[r++]=5;ew(2,t.lens,0,32,NM,0,t.work,{bits:5}),n$=!1}t.lencode=kM,t.lenbits=9,t.distcode=NM,t.distbits=5},r$=(t,r,s,o)=>{let c;const u=t.state;return u.window===null&&(u.wsize=1<<u.wbits,u.wnext=0,u.whave=0,u.window=new Uint8Array(u.wsize)),o>=u.wsize?(u.window.set(r.subarray(s-u.wsize,s),0),u.wnext=0,u.whave=u.wsize):(c=u.wsize-u.wnext,c>o&&(c=o),u.window.set(r.subarray(s-o,s-o+c),u.wnext),(o-=c)?(u.window.set(r.subarray(s-o,s),0),u.wnext=o,u.whave=u.wsize):(u.wnext+=c,u.wnext===u.wsize&&(u.wnext=0),u.whave<u.wsize&&(u.whave+=c))),0};var c_e=(t,r)=>{let s,o,c,u,h,m,_,E,S,R,P,k,z,U,F,q,Y,le,ye,Ee,me,ke,Ye=0;const ut=new Uint8Array(4);let pt,vn;const Sn=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]);if(ny(t)||!t.output||!t.input&&t.avail_in!==0)return Eu;s=t.state,s.mode===sp&&(s.mode=AM),h=t.next_out,c=t.output,_=t.avail_out,u=t.next_in,o=t.input,m=t.avail_in,E=s.hold,S=s.bits,R=m,P=_,ke=ty;e:for(;;)switch(s.mode){case JP:if(s.wrap===0){s.mode=AM;break}for(;S<16;){if(m===0)break e;m--,E+=o[u++]<<S,S+=8}if(2&s.wrap&&E===35615){s.wbits===0&&(s.wbits=15),s.check=0,ut[0]=255&E,ut[1]=E>>>8&255,s.check=Ro(s.check,ut,2,0),E=0,S=0,s.mode=16181;break}if(s.head&&(s.head.done=!1),!(1&s.wrap)||(((255&E)<<8)+(E>>8))%31){t.msg="incorrect header check",s.mode=ns;break}if((15&E)!==X7){t.msg="unknown compression method",s.mode=ns;break}if(E>>>=4,S-=4,me=8+(15&E),s.wbits===0&&(s.wbits=me),me>15||me>s.wbits){t.msg="invalid window size",s.mode=ns;break}s.dmax=1<<s.wbits,s.flags=0,t.adler=s.check=1,s.mode=512&E?16189:sp,E=0,S=0;break;case 16181:for(;S<16;){if(m===0)break e;m--,E+=o[u++]<<S,S+=8}if(s.flags=E,(255&io(s))!==X7){t.msg="unknown compression method",s.mode=ns;break}if(57344&io(s)){t.msg="unknown header flags set",s.mode=ns;break}s.head&&(s.head.text=E>>8&1),512&io(s)&&4&s.wrap&&(ut[0]=255&E,ut[1]=E>>>8&255,s.check=Ro(s.check,ut,2,0)),E=0,S=0,s.mode=16182;case 16182:for(;S<32;){if(m===0)break e;m--,E+=o[u++]<<S,S+=8}s.head&&(s.head.time=E),512&io(s)&&4&s.wrap&&(ut[0]=255&E,ut[1]=E>>>8&255,ut[2]=E>>>16&255,ut[3]=E>>>24&255,s.check=Ro(s.check,ut,4,0)),E=0,S=0,s.mode=16183;case 16183:for(;S<16;){if(m===0)break e;m--,E+=o[u++]<<S,S+=8}s.head&&(s.head.xflags=255&E,s.head.os=E>>8),512&io(s)&&4&s.wrap&&(ut[0]=255&E,ut[1]=E>>>8&255,s.check=Ro(s.check,ut,2,0)),E=0,S=0,s.mode=16184;case 16184:if(1024&io(s)){for(;S<16;){if(m===0)break e;m--,E+=o[u++]<<S,S+=8}s.length=E,s.head&&(s.head.extra_len=E),512&io(s)&&4&s.wrap&&(ut[0]=255&E,ut[1]=E>>>8&255,s.check=Ro(s.check,ut,2,0)),E=0,S=0}else s.head&&(s.head.extra=null);s.mode=16185;case 16185:if(1024&io(s)&&(k=s.length,k>m&&(k=m),k&&(s.head&&(me=s.head.extra_len-s.length,s.head.extra||(s.head.extra=new Uint8Array(s.head.extra_len)),s.head.extra.set(o.subarray(u,u+k),me)),512&io(s)&&4&s.wrap&&(s.check=Ro(s.check,o,k,u)),m-=k,u+=k,s.length-=k),s.length))break e;s.length=0,s.mode=16186;case 16186:if(2048&io(s)){if(m===0)break e;k=0;do me=o[u+k++],s.head&&me&&s.length<65536&&(s.head.name+=String.fromCharCode(me));while(me&&k<m);if(512&io(s)&&4&s.wrap&&(s.check=Ro(s.check,o,k,u)),m-=k,u+=k,me)break e}else s.head&&(s.head.name=null);s.length=0,s.mode=16187;case 16187:if(4096&io(s)){if(m===0)break e;k=0;do me=o[u+k++],s.head&&me&&s.length<65536&&(s.head.comment+=String.fromCharCode(me));while(me&&k<m);if(512&io(s)&&4&s.wrap&&(s.check=Ro(s.check,o,k,u)),m-=k,u+=k,me)break e}else s.head&&(s.head.comment=null);s.mode=16188;case 16188:if(512&io(s)){for(;S<16;){if(m===0)break e;m--,E+=o[u++]<<S,S+=8}if(4&s.wrap&&E!==(65535&s.check)){t.msg="header crc mismatch",s.mode=ns;break}E=0,S=0}s.head&&(s.head.hcrc=io(s)>>9&1,s.head.done=!0),t.adler=s.check=0,s.mode=sp;break;case 16189:for(;S<32;){if(m===0)break e;m--,E+=o[u++]<<S,S+=8}t.adler=s.check=J7(E),E=0,S=0,s.mode=QP;case QP:if(s.havedict===0)return t.next_out=h,t.avail_out=_,t.next_in=u,t.avail_in=m,s.hold=E,s.bits=S,i_e;t.adler=s.check=1,s.mode=sp;case sp:if(r===n_e||r===XP)break e;case AM:if(s.last){E>>>=7&S,S-=7&S,s.mode=OM;break}for(;S<3;){if(m===0)break e;m--,E+=o[u++]<<S,S+=8}switch(s.last=1&E,E>>>=1,S-=1,3&E){case 0:s.mode=16193;break;case 1:if(a_e(s),s.mode=ZP,r===XP){E>>>=2,S-=2;break e}break;case 2:s.mode=16196;break;case 3:t.msg="invalid block type",s.mode=ns}E>>>=2,S-=2;break;case 16193:for(E>>>=7&S,S-=7&S;S<32;){if(m===0)break e;m--,E+=o[u++]<<S,S+=8}if((65535&E)!=(E>>>16^65535)){t.msg="invalid stored block lengths",s.mode=ns;break}if(s.length=65535&E,E=0,S=0,s.mode=PM,r===XP)break e;case PM:s.mode=16195;case 16195:if(k=s.length,k){if(k>m&&(k=m),k>_&&(k=_),k===0)break e;c.set(o.subarray(u,u+k),h),m-=k,u+=k,_-=k,h+=k,s.length-=k;break}s.mode=sp;break;case 16196:for(;S<14;){if(m===0)break e;m--,E+=o[u++]<<S,S+=8}if(s.nlen=257+(31&E),E>>>=5,S-=5,s.ndist=1+(31&E),E>>>=5,S-=5,s.ncode=4+(15&E),E>>>=4,S-=4,s.nlen>286||s.ndist>30){t.msg="too many length or distance symbols",s.mode=ns;break}s.have=0,s.mode=16197;case 16197:for(;s.have<s.ncode;){for(;S<3;){if(m===0)break e;m--,E+=o[u++]<<S,S+=8}s.lens[Sn[s.have++]]=7&E,E>>>=3,S-=3}for(;s.have<19;)s.lens[Sn[s.have++]]=0;if(s.lencode=s.lendyn,s.lenbits=7,pt={bits:s.lenbits},ke=ew(0,s.lens,0,19,s.lencode,0,s.work,pt),s.lenbits=pt.bits,ke){t.msg="invalid code lengths set",s.mode=ns;break}s.have=0,s.mode=16198;case 16198:for(;s.have<s.nlen+s.ndist;){for(;Ye=s.lencode[E&(1<<s.lenbits)-1],F=Ye>>>24,q=Ye>>>16&255,Y=65535&Ye,!(F<=S);){if(m===0)break e;m--,E+=o[u++]<<S,S+=8}if(Y<16)E>>>=F,S-=F,s.lens[s.have++]=Y;else{if(Y===16){for(vn=F+2;S<vn;){if(m===0)break e;m--,E+=o[u++]<<S,S+=8}if(E>>>=F,S-=F,s.have===0){t.msg="invalid bit length repeat",s.mode=ns;break}me=s.lens[s.have-1],k=3+(3&E),E>>>=2,S-=2}else if(Y===17){for(vn=F+3;S<vn;){if(m===0)break e;m--,E+=o[u++]<<S,S+=8}E>>>=F,S-=F,me=0,k=3+(7&E),E>>>=3,S-=3}else{for(vn=F+7;S<vn;){if(m===0)break e;m--,E+=o[u++]<<S,S+=8}E>>>=F,S-=F,me=0,k=11+(127&E),E>>>=7,S-=7}if(s.have+k>s.nlen+s.ndist){t.msg="invalid bit length repeat",s.mode=ns;break}for(;k--;)s.lens[s.have++]=me}}if(s.mode===ns)break;if(s.lens[256]===0){t.msg="invalid code -- missing end-of-block",s.mode=ns;break}if(s.lenbits=9,pt={bits:s.lenbits},ke=ew(1,s.lens,0,s.nlen,s.lencode,0,s.work,pt),s.lenbits=pt.bits,ke){t.msg="invalid literal/lengths set",s.mode=ns;break}if(s.distbits=6,s.distcode=s.distdyn,pt={bits:s.distbits},ke=ew(2,s.lens,s.nlen,s.ndist,s.distcode,0,s.work,pt),s.distbits=pt.bits,ke){t.msg="invalid distances set",s.mode=ns;break}if(s.mode=ZP,r===XP)break e;case ZP:s.mode=eO;case eO:if(m>=6&&_>=258){t.next_out=h,t.avail_out=_,t.next_in=u,t.avail_in=m,s.hold=E,s.bits=S,Jge(t,P),h=t.next_out,c=t.output,_=t.avail_out,u=t.next_in,o=t.input,m=t.avail_in,E=s.hold,S=s.bits,s.mode===sp&&(s.back=-1);break}for(s.back=0;Ye=s.lencode[E&(1<<s.lenbits)-1],F=Ye>>>24,q=Ye>>>16&255,Y=65535&Ye,!(F<=S);){if(m===0)break e;m--,E+=o[u++]<<S,S+=8}if(q&&(240&q)==0){for(le=F,ye=q,Ee=Y;Ye=s.lencode[Ee+((E&(1<<le+ye)-1)>>le)],F=Ye>>>24,q=Ye>>>16&255,Y=65535&Ye,!(le+F<=S);){if(m===0)break e;m--,E+=o[u++]<<S,S+=8}E>>>=le,S-=le,s.back+=le}if(E>>>=F,S-=F,s.back+=F,s.length=Y,q===0){s.mode=16205;break}if(32&q){s.back=-1,s.mode=sp;break}if(64&q){t.msg="invalid literal/length code",s.mode=ns;break}s.extra=15&q,s.mode=16201;case 16201:if(s.extra){for(vn=s.extra;S<vn;){if(m===0)break e;m--,E+=o[u++]<<S,S+=8}s.length+=E&(1<<s.extra)-1,E>>>=s.extra,S-=s.extra,s.back+=s.extra}s.was=s.length,s.mode=16202;case 16202:for(;Ye=s.distcode[E&(1<<s.distbits)-1],F=Ye>>>24,q=Ye>>>16&255,Y=65535&Ye,!(F<=S);){if(m===0)break e;m--,E+=o[u++]<<S,S+=8}if((240&q)==0){for(le=F,ye=q,Ee=Y;Ye=s.distcode[Ee+((E&(1<<le+ye)-1)>>le)],F=Ye>>>24,q=Ye>>>16&255,Y=65535&Ye,!(le+F<=S);){if(m===0)break e;m--,E+=o[u++]<<S,S+=8}E>>>=le,S-=le,s.back+=le}if(E>>>=F,S-=F,s.back+=F,64&q){t.msg="invalid distance code",s.mode=ns;break}s.offset=Y,s.extra=15&q,s.mode=16203;case 16203:if(s.extra){for(vn=s.extra;S<vn;){if(m===0)break e;m--,E+=o[u++]<<S,S+=8}s.offset+=E&(1<<s.extra)-1,E>>>=s.extra,S-=s.extra,s.back+=s.extra}if(s.offset>s.dmax){t.msg="invalid distance too far back",s.mode=ns;break}s.mode=16204;case 16204:if(_===0)break e;if(k=P-_,s.offset>k){if(k=s.offset-k,k>s.whave&&s.sane){t.msg="invalid distance too far back",s.mode=ns;break}k>s.wnext?(k-=s.wnext,z=s.wsize-k):z=s.wnext-k,k>s.length&&(k=s.length),U=s.window}else U=c,z=h-s.offset,k=s.length;k>_&&(k=_),_-=k,s.length-=k;do c[h++]=U[z++];while(--k);s.length===0&&(s.mode=eO);break;case 16205:if(_===0)break e;c[h++]=s.length,_--,s.mode=eO;break;case OM:if(s.wrap){for(;S<32;){if(m===0)break e;m--,E|=o[u++]<<S,S+=8}if(P-=_,t.total_out+=P,s.total+=P,4&s.wrap&&P&&(t.adler=s.check=io(s)?Ro(s.check,c,P,h-P):$T(s.check,c,P,h-P)),P=_,4&s.wrap&&(io(s)?E:J7(E))!==s.check){t.msg="incorrect data check",s.mode=ns;break}E=0,S=0}s.mode=16207;case 16207:if(s.wrap&&io(s)){for(;S<32;){if(m===0)break e;m--,E+=o[u++]<<S,S+=8}if(4&s.wrap&&E!==(4294967295&s.total)){t.msg="incorrect length check",s.mode=ns;break}E=0,S=0}s.mode=16208;case 16208:ke=r_e;break e;case ns:ke=q7;break e;case 16210:return Y7;default:return Eu}return t.next_out=h,t.avail_out=_,t.next_in=u,t.avail_in=m,s.hold=E,s.bits=S,(s.wsize||P!==t.avail_out&&s.mode<ns&&(s.mode<OM||r!==K7))&&r$(t,t.output,t.next_out,P-t.avail_out),R-=t.avail_in,P-=t.avail_out,t.total_in+=R,t.total_out+=P,s.total+=P,4&s.wrap&&P&&(t.adler=s.check=io(s)?Ro(s.check,c,P,t.next_out-P):$T(s.check,c,P,t.next_out-P)),t.data_type=s.bits+(s.last?64:0)+(s.mode===sp?128:0)+(s.mode===ZP||s.mode===PM?256:0),(R===0&&P===0||r===K7)&&ke===ty&&(ke=s_e),ke},op={inflateReset:Z7,inflateReset2:e$,inflateResetKeep:Q7,inflateInit:t=>t$(t,15),inflateInit2:t$,inflate:c_e,inflateEnd:t=>{if(ny(t))return Eu;let r=t.state;return r.window&&(r.window=null),t.state=null,ty},inflateGetHeader:(t,r)=>{if(ny(t))return Eu;const s=t.state;return(2&s.wrap)==0?Eu:(s.head=r,r.done=!1,ty)},inflateSetDictionary:(t,r)=>{const s=r.length;let o,c,u;return ny(t)?Eu:(o=t.state,o.wrap!==0&&o.mode!==QP?Eu:o.mode===QP&&(c=1,c=$T(c,r,s,0),c!==o.check)?q7:(u=r$(t,r,s,s),u?(o.mode=16210,Y7):(o.havedict=1,ty)))},inflateInfo:"pako inflate (from Nodeca project)"},l_e=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1};const i$=Object.prototype.toString,{Z_NO_FLUSH:u_e,Z_FINISH:d_e,Z_OK:tw,Z_STREAM_END:DM,Z_NEED_DICT:LM,Z_STREAM_ERROR:h_e,Z_DATA_ERROR:s$,Z_MEM_ERROR:f_e}=WP;function tO(t){this.options=HP.assign({chunkSize:65536,windowBits:15,to:""},t||{});const r=this.options;r.raw&&r.windowBits>=0&&r.windowBits<16&&(r.windowBits=-r.windowBits,r.windowBits===0&&(r.windowBits=-15)),!(r.windowBits>=0&&r.windowBits<16)||t&&t.windowBits||(r.windowBits+=32),r.windowBits>15&&r.windowBits<48&&(15&r.windowBits)==0&&(r.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new H7,this.strm.avail_out=0;let s=op.inflateInit2(this.strm,r.windowBits);if(s!==tw)throw new Error(J_[s]);if(this.header=new l_e,op.inflateGetHeader(this.strm,this.header),r.dictionary&&(typeof r.dictionary=="string"?r.dictionary=ZT.string2buf(r.dictionary):i$.call(r.dictionary)==="[object ArrayBuffer]"&&(r.dictionary=new Uint8Array(r.dictionary)),r.raw&&(s=op.inflateSetDictionary(this.strm,r.dictionary),s!==tw)))throw new Error(J_[s])}function p_e(t,r){const s=new tO(r);if(s.push(t),s.err)throw s.msg||J_[s.err];return s.result}tO.prototype.push=function(t,r){const s=this.strm,o=this.options.chunkSize,c=this.options.dictionary;let u,h,m;if(this.ended)return!1;for(h=r===~~r?r:r===!0?d_e:u_e,i$.call(t)==="[object ArrayBuffer]"?s.input=new Uint8Array(t):s.input=t,s.next_in=0,s.avail_in=s.input.length;;){for(s.avail_out===0&&(s.output=new Uint8Array(o),s.next_out=0,s.avail_out=o),u=op.inflate(s,h),u===LM&&c&&(u=op.inflateSetDictionary(s,c),u===tw?u=op.inflate(s,h):u===s$&&(u=LM));s.avail_in>0&&u===DM&&s.state.wrap>0&&t[s.next_in]!==0;)op.inflateReset(s),u=op.inflate(s,h);switch(u){case h_e:case s$:case LM:case f_e:return this.onEnd(u),this.ended=!0,!1}if(m=s.avail_out,s.next_out&&(s.avail_out===0||u===DM))if(this.options.to==="string"){let _=ZT.utf8border(s.output,s.next_out),E=s.next_out-_,S=ZT.buf2string(s.output,_);s.next_out=E,s.avail_out=o-E,E&&s.output.set(s.output.subarray(_,_+E),0),this.onData(S)}else this.onData(s.output.length===s.next_out?s.output:s.output.subarray(0,s.next_out));if(u!==tw||m!==0){if(u===DM)return u=op.inflateEnd(this.strm),this.onEnd(u),this.ended=!0,!0;if(s.avail_in===0)break}}return!0},tO.prototype.onData=function(t){this.chunks.push(t)},tO.prototype.onEnd=function(t){t===tw&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=HP.flattenChunks(this.chunks)),this.chunks=[],this.err=t,this.msg=this.strm.msg};var m_e={inflate:p_e};const{deflate:g_e}=Xge,{inflate:__e}=m_e;var y_e=g_e,E_e=__e,o$=function(t){return t[t.ONE_BYTE=0]="ONE_BYTE",t[t.TWO_BYTE=1]="TWO_BYTE",t}(o$||{});class v_e{constructor(){$(this,"_sequence",0),$(this,"_startTime",Date.now()),$(this,"isUseOneByte",!0)}get startTime(){const r=Date.now()-this._startTime;return r<Math.pow(2,16)?r:(this._startTime+=Math.pow(2,16),this.startTime)}get sequence(){return this._sequence<Math.pow(2,32)?this._sequence++:(this._sequence-=Math.pow(2,32),this.sequence)}serialize(r){const s={commonPacketHeader:{length:0,reserved:0,extension:0,sequence:this.sequence},commonStreamHeader:this.startTime,extension:void 0,payload:r};if(r.byteLength>128){const m=new Uint8Array(4);m.set([1,0,0,0]);const _={id:0,length:4,data:m.buffer},E={profile:this.isUseOneByte?0:1,length:this.isUseOneByte?5:6,datas:[_]};s.commonPacketHeader.extension=1,s.extension=E,s.payload=this.compress(r),s.commonPacketHeader.length=8+(s.extension.length+2)+s.payload.byteLength}else s.commonPacketHeader.length=8+s.payload.byteLength;re("SHOW_DATASTREAM2_LOG")&&L.debug("send data header: ".concat(JSON.stringify(s.commonPacketHeader)));const o=new ArrayBuffer(s.commonPacketHeader.length),c=new Uint8Array(o),u=new DataView(o);let h=0;if(u.setUint16(h,s.commonPacketHeader.extension<<15|s.commonPacketHeader.reserved<<14|s.commonPacketHeader.length,!0),h+=2,u.setUint32(h,s.commonPacketHeader.sequence,!0),h+=4,u.setUint16(h,s.commonStreamHeader,!0),h+=2,s.extension){const m=this.serializeExtension(s.extension);c.set(new Uint8Array(m),h),h+=m.byteLength}if(c.set(new Uint8Array(s.payload),h),h+=s.payload.byteLength,h!==s.commonPacketHeader.length)throw Error("serialize error!");return o}deserialize(r){if(r.byteLength<4)return new ArrayBuffer(0);const s=new DataView(r);let o=0;const c=s.getUint16(o,!0);o+=2;const u={length:16383&c,reserved:(16384&c)>>14,extension:(32768&c)>>15,sequence:s.getUint16(o+2,!0)<<16|s.getUint16(o,!0)};let h,m;if(o+=4,re("SHOW_DATASTREAM2_LOG")&&L.debug("receive data header: ".concat(JSON.stringify(u))),s.getUint16(o,!0),o+=2,u.extension){m=this.deserializeExtension(r.slice(o)),o+=2+m.length,h=r.slice(o);let _=!1;if(m.datas.length>0){const E=m.datas.find(S=>S.id===0);E&&(_=(1&new DataView(E.data).getUint32(0,!0))==1)}h=_?this.decompress(h):h}else h=r.slice(8);return h}serializeExtension(r){const{profile:s,length:o,datas:c}=r,u=new ArrayBuffer(o+2),h=new Uint8Array(u),m=new DataView(u);let _=0;if(m.setUint8(_++,s),m.setUint8(_++,o),c.forEach(E=>{s?(m.setUint8(_++,E.id),m.setUint8(_++,E.length),h.set(new Uint8Array(E.data),_),_+=E.data.byteLength):(m.setUint8(_++,E.id|E.length<<4),h.set(new Uint8Array(E.data),_),_+=E.data.byteLength)}),_!==o+2)throw Error("serialize extension error, is ".concat(_,"!==").concat(o+2));return u}deserializeExtension(r){const s=new DataView(r);let o=0;const c=s.getUint8(o);o++;const u=s.getUint8(o);o++;const h=c===o$.TWO_BYTE,m=[],_=new DataView(r,2);let E=0;for(;E<u;){let S=0,R=0,P=new ArrayBuffer(0);h?(S=_.getUint8(E),E++,R=_.getUint8(E),E++):(S=15&_.getUint8(E),R=_.getUint8(E)>>4,E++),R>0&&(P=_.buffer.slice(E+2,E+2+R),E+=P.byteLength),m.push({id:S,length:R,data:P})}if(E!==u)throw Error("parse error");return{profile:c,length:u,datas:m}}decompress(r){return E_e(new Uint8Array(r))}compress(r){return y_e(new Uint8Array(r))}}const S_e={name:"DataStream",create:(t,r)=>{const s=r?new Ape(t):new Ppe(t);return s.useDataStream(new v_e),s}};class b_e extends Pr{constructor(r,s,o){super(),$(this,"ws",void 0),$(this,"requestId",1),$(this,"heartBeatTimer",void 0),$(this,"joinInfo",void 0),$(this,"clientId",void 0),$(this,"onOpen",()=>{this.emit("open"),this.startHeartBeatCheck()}),$(this,"onClose",c=>{this.emit("close"),this.dispose()}),$(this,"onMessage",c=>{const u=JSON.parse(c.data);if(!u||u.command!=="serverResponse"||!u.requestId)return u&&u.command==="serverStatus"&&u.serverStatus&&u.serverStatus.command?(this.emit("status",u.serverStatus),void this.emit(u.serverStatus.command,u.serverStatus)):void 0;this.emit("req_".concat(u.requestId),u)}),this.joinInfo=r,this.clientId=s,this.ws=new IT("cross-channel-".concat(this.clientId),o),this.ws.on(Yt.RECONNECTING,()=>{this.ws.reconnectMode="retry",this.emit("reconnecting")}),this.ws.on(Yt.CONNECTED,this.onOpen),this.ws.on(Yt.ON_MESSAGE,this.onMessage),this.ws.on(Yt.CLOSED,this.onClose)}isConnect(){return this.ws.state==="connected"}sendMessage(r){const s=this.requestId++;return r.requestId=s,r.seq=s,this.ws.sendMessage(r),s}waitStatus(r){return new lt((s,o)=>{const c=window.setTimeout(()=>{o(new Oe(X.TIMEOUT,"wait status timeout, status: ".concat(r)))},5e3);this.once(r,u=>{window.clearTimeout(c),u.state&&u.state!==0?o(new Oe(X.CROSS_CHANNEL_WAIT_STATUS_ERROR,"wait status error, status: ".concat(r))):s(void 0)}),this.once("dispose",()=>{window.clearTimeout(c),o(new Oe(X.WS_ABORT))})})}async request(r){if(this.ws.state==="closed")throw new Oe(X.WS_DISCONNECT);const s=()=>new lt((h,m)=>{this.ws.once(Yt.CLOSED,()=>m(new Oe(X.WS_ABORT))),this.ws.once(Yt.CONNECTED,h)});this.ws.state!=="connected"&&await s();const o=this.sendMessage(r),c=new lt((h,m)=>{const _=()=>{m(new Oe(X.WS_ABORT))};this.ws.once(Yt.RECONNECTING,_),this.ws.once(Yt.CLOSED,_),this.once("req_".concat(o),h),os(3e3).then(()=>{this.removeAllListeners("req_".concat(o)),this.ws.off(Yt.RECONNECTING,_),this.ws.off(Yt.CLOSED,_),m(new Oe(X.TIMEOUT,"cross channel ws request timeout"))})}),u=await c;if(!u||u.code!==200)throw new Oe(X.CROSS_CHANNEL_SERVER_ERROR_RESPONSE,"response: ".concat(JSON.stringify(u)));return u}async connect(r){this.ws.removeAllListeners(Yt.REQUEST_NEW_URLS),this.ws.on(Yt.REQUEST_NEW_URLS,s=>{s(r)}),await this.ws.init(r)}dispose(){this.clearHeartBeatCheck(),this.emit("dispose"),this.removeAllListeners(),this.ws.close()}sendPing(r){const s=this.requestId++;return r.requestId=s,this.ws.sendMessage(r),s}startHeartBeatCheck(){this.heartBeatTimer&&window.clearInterval(this.heartBeatTimer),this.heartBeatTimer=window.setInterval(()=>{this.sendPing({command:"ping",appId:this.joinInfo.appId,cname:this.joinInfo.cname,uid:this.joinInfo.uid.toString(),sid:this.joinInfo.sid,ts:+new Date,requestId:0})},3e3)}clearHeartBeatCheck(){window.clearInterval(this.heartBeatTimer),this.heartBeatTimer=void 0}}class T_e extends Pr{set state(r){r!==this._state&&(r!==Ia.RELAY_STATE_FAILURE&&(this.errorCode=qv.RELAY_OK),this.emit("state",r,this.errorCode),this._state=r)}get state(){return this._state}constructor(r,s,o,c,u){super(),$(this,"joinInfo",void 0),$(this,"sid",void 0),$(this,"clientId",void 0),$(this,"cancelToken",$o.CancelToken.source()),$(this,"workerToken",void 0),$(this,"requestId",0),$(this,"signal",void 0),$(this,"prevChannelMediaConfig",void 0),$(this,"httpRetryConfig",void 0),$(this,"_resolution",void 0),$(this,"_state",Ia.RELAY_STATE_IDLE),$(this,"errorCode",qv.RELAY_OK),$(this,"onStatus",h=>{L.debug("[".concat(this.clientId,"] ChannelMediaStatus: ").concat(JSON.stringify(h))),h&&h.command&&(h.command==="onAudioPacketReceived"&&this.emit("event",Zf.PACKET_RECEIVED_AUDIO_FROM_SRC),h.command==="onVideoPacketReceived"&&this.emit("event",Zf.PACKET_RECEIVED_VIDEO_FROM_SRC),h.command==="onSrcTokenPrivilegeDidExpire"&&(this.errorCode=qv.SRC_TOKEN_EXPIRED,this.state=Ia.RELAY_STATE_FAILURE),h.command==="onDestTokenPrivilegeDidExpire"&&(this.errorCode=qv.DEST_TOKEN_EXPIRED,this.state=Ia.RELAY_STATE_FAILURE))}),$(this,"onReconnect",async()=>{L.debug("[".concat(this.clientId,"] ChannelMediaSocket disconnect, reconnecting")),this.emit("event",Zf.NETWORK_DISCONNECTED),this.state=Ia.RELAY_STATE_IDLE,this.prevChannelMediaConfig&&this.sendStartRelayMessage(this.prevChannelMediaConfig).catch(h=>{this.state!==Ia.RELAY_STATE_IDLE&&(L.error("auto restart channel media relay failed",h.toString()),this.errorCode=qv.SERVER_CONNECTION_LOST,this.state=Ia.RELAY_STATE_FAILURE)})}),this.joinInfo=r,this.clientId=s,this.sid=L_(),this.signal=new b_e(this.joinInfo,this.clientId,o),this.httpRetryConfig=c,this._resolution=u}async startChannelMediaRelay(r){if(this.state!==Ia.RELAY_STATE_IDLE)throw new Oe(X.INVALID_OPERATION);this.state=Ia.RELAY_STATE_CONNECTING,await this.connect(),L.debug("[".concat(this.clientId,"] startChannelMediaRelay: connect success"));try{await this.sendStartRelayMessage(r)}catch(s){throw s.data&&s.data.serverResponse&&s.data.serverResponse.command==="SetSourceChannel"?new Oe(X.CROSS_CHANNEL_FAILED_JOIN_SRC):s.data&&s.data.serverResponse&&s.serverResponse.command==="SetDestChannelStatus"?new Oe(X.CROSS_CHANNEL_FAILED_JOIN_DEST):s.data&&s.data.serverResponse&&s.serverResponse.command==="StartPacketTransfer"?new Oe(X.CROSS_CHANNEL_FAILED_PACKET_SENT_TO_DEST):s}this.prevChannelMediaConfig=r}async updateChannelMediaRelay(r){if(this.state!==Ia.RELAY_STATE_RUNNING)throw new Oe(X.INVALID_OPERATION);await this.sendUpdateMessage(r),this.prevChannelMediaConfig=r}async setVideoProfile(r){if(this._resolution=r,this.state!==Ia.RELAY_STATE_RUNNING)throw new Oe(X.INVALID_OPERATION);const s=this.genMessage(wo.SetVideoProfile);await this.signal.request(s),L.debug("[".concat(this.clientId,"] startChannelMediaRelay: setVideoProfile success"))}async stopChannelMediaRelay(){await this.sendStopRelayMessage(),L.debug("[".concat(this.clientId,"] stopChannelMediaRelay: send stop message success")),this.state=Ia.RELAY_STATE_IDLE,this.dispose()}dispose(){L.debug("[".concat(this.clientId,"] disposeChannelMediaRelay")),this.cancelToken.cancel(),this.cancelToken=$o.CancelToken.source(),this.state=Ia.RELAY_STATE_IDLE,this.emit("dispose"),this.signal.dispose(),this.prevChannelMediaConfig=void 0}async connect(){const r=await Dme(this.joinInfo,this.cancelToken.token,this.httpRetryConfig);this.workerToken=r.workerToken,await this.signal.connect(r.addressList),this.emit("event",Zf.NETWORK_CONNECTED),this.signal.on("status",this.onStatus),this.signal.on("reconnecting",this.onReconnect)}async sendStartRelayMessage(r){const s=this.genMessage(wo.StopPacketTransfer);await this.signal.request(s),await this.signal.waitStatus("Normal Quit"),L.debug("[".concat(this.clientId,"] startChannelMediaRelay: StopPacketTransfer success"));const o=this.genMessage(wo.SetSdkProfile,r);await this.signal.request(o),L.debug("[".concat(this.clientId,"] startChannelMediaRelay: SetSdkProfile success"));const c=this.genMessage(wo.SetSourceChannel,r);await this.signal.request(c),await this.signal.waitStatus("SetSourceChannelStatus"),this.emit("event",Zf.PACKET_JOINED_SRC_CHANNEL),L.debug("[".concat(this.clientId,"] startChannelMediaRelay: SetSourceChannel success"));const u=this.genMessage(wo.SetSourceUserId,r);await this.signal.request(u),L.debug("[".concat(this.clientId,"] startChannelMediaRelay: SetSourceUserId success"));const h=this.genMessage(wo.SetDestChannel,r);await this.signal.request(h),await this.signal.waitStatus("SetDestChannelStatus"),this.emit("event",Zf.PACKET_JOINED_DEST_CHANNEL),L.debug("[".concat(this.clientId,"] startChannelMediaRelay: SetDestChannel success"));const m=this.genMessage(wo.StartPacketTransfer,r);await this.signal.request(m),this.emit("event",Zf.PACKET_SENT_TO_DEST_CHANNEL),this.state=Ia.RELAY_STATE_RUNNING,L.debug("[".concat(this.clientId,"] startChannelMediaRelay: StartPacketTransfer success")),this.setVideoProfile(this._resolution)}async sendUpdateMessage(r){const s=this.genMessage(wo.UpdateDestChannel,r);await this.signal.request(s),this.emit("event",Zf.PACKET_UPDATE_DEST_CHANNEL),L.debug("[".concat(this.clientId,"] sendUpdateMessage: UpdateDestChannel success"))}async sendStopRelayMessage(){const r=this.genMessage(wo.StopPacketTransfer);await this.signal.request(r),L.debug("[".concat(this.clientId,"] sendStopRelayMessage: StopPacketTransfer success"))}genMessage(r,s){const o=[],c=[],u=[];this.requestId+=1;const h={appId:this.joinInfo.appId,cname:this.joinInfo.cname,uid:this.joinInfo.uid.toString(),sdkVersion:yl,sid:this.sid,ts:Date.now(),requestId:this.requestId,seq:this.requestId,allocate:!0,clientRequest:{}};h.sdkVersion==="4.23.2"&&(h.sdkVersion="0.0.1");let m=null,_=null;switch(r){case wo.SetSdkProfile:return h.clientRequest={command:"SetSdkProfile",type:"multi_channel"},h;case wo.SetSourceChannel:if(_=s&&s.getSrcChannelMediaInfo(),!_)throw new Oe(X.UNEXPECTED_ERROR,"can not find source config");return h.clientRequest={command:"SetSourceChannel",uid:"0",channelName:_.channelName,token:_.token||this.joinInfo.appId},h;case wo.SetSourceUserId:if(_=s&&s.getSrcChannelMediaInfo(),!_)throw new Oe(X.UNEXPECTED_ERROR,"can not find source config");return h.clientRequest={command:"SetSourceUserId",uid:_.uid+""},h;case wo.SetDestChannel:if(m=s&&s.getDestChannelMediaInfo(),!m)throw new Oe(X.UNEXPECTED_ERROR,"can not find dest config");return m.forEach(E=>{o.push(E.channelName),c.push(E.uid+""),u.push(E.token||this.joinInfo.appId)}),h.clientRequest={command:"SetDestChannel",channelName:o,uid:c,token:u},h;case wo.StartPacketTransfer:return h.clientRequest={command:"StartPacketTransfer"},h;case wo.Reconnect:return h.clientRequest={command:"Reconnect"},h;case wo.StopPacketTransfer:return h.clientRequest={command:"StopPacketTransfer"},h;case wo.UpdateDestChannel:if(m=s&&s.getDestChannelMediaInfo(),!m)throw new Oe(X.UNEXPECTED_ERROR,"can not find dest config");return m.forEach(E=>{o.push(E.channelName),c.push(E.uid+""),u.push(E.token||this.joinInfo.appId)}),h.clientRequest={command:"UpdateDestChannel",channelName:o,uid:c,token:u},h;case wo.SetVideoProfile:h.clientRequest={command:"SetVideoProfile",width:this._resolution.width,height:this._resolution.height}}return h}}const w_e={name:"ChannelMediaRelay",create:function(t){return new T_e(t.joinInfo,t.clientId,t.websocketRetryConfig||bi,t.httpRetryConfig||bi,t.resolution)}};function a$(t,r){var s=Object.keys(t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);r&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(t,c).enumerable})),s.push.apply(s,o)}return s}function nw(t){for(var r=1;r<arguments.length;r++){var s=arguments[r]!=null?arguments[r]:{};r%2?a$(Object(s),!0).forEach(function(o){$(t,o,s[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(s)):a$(Object(s)).forEach(function(o){Object.defineProperty(t,o,Object.getOwnPropertyDescriptor(s,o))})}return t}class R_e extends Pr{constructor(r,s,o,c){super(),$(this,"spec",void 0),$(this,"token",void 0),$(this,"websocket",void 0),$(this,"pingpongTimer",void 0),$(this,"reconnectMode","retry"),$(this,"serviceMode",void 0),$(this,"reqId",0),$(this,"commandReqId",0),$(this,"handleWebSocketOpen",()=>{this.reconnectMode="retry",this.startPingPong()}),$(this,"handleWebSocketMessage",u=>{if(!u.data)return;const h=JSON.parse(u.data);h.requestId?this.emit("@".concat(h.requestId,"-").concat(h.sid),h):(Rt.workerEvent(this.spec.sid,{actionType:"status",serverCode:h.code,workerType:this.serviceMode===Qf.TRANSCODE?1:2}),this.emit(Om.PUBLISH_STREAM_STATUS,h))}),this.spec=s,this.token=r,this.serviceMode=c,this.websocket=new IT("live-streaming",o),this.websocket.on(Yt.CONNECTED,this.handleWebSocketOpen),this.websocket.on(Yt.ON_MESSAGE,this.handleWebSocketMessage),this.websocket.on(Yt.REQUEST_NEW_URLS,(u,h)=>{Ts(this,Om.REQUEST_NEW_ADDRESS).then(u).catch(h)}),this.websocket.on(Yt.RECONNECTING,()=>{this.websocket.reconnectMode=this.reconnectMode})}init(r){return this.websocket.init(r)}async request(r,s,o,c){this.reqId+=1,r==="request"&&(this.commandReqId+=1);const u=this.commandReqId,h=this.reqId;if(!h||!this.websocket)throw new Oe(X.UNEXPECTED_ERROR);const m=nw({command:r,sdkVersion:yl==="4.23.2"?"0.0.1":yl,seq:h,requestId:h,allocate:o,cname:this.spec.cname,appId:this.spec.appId,sid:this.spec.sid,uid:this.spec.uid.toString(),ts:Math.floor(Date.now()/1e3)},s);if(this.websocket.state==="closed")throw new Oe(X.WS_DISCONNECT);const _=()=>new lt((P,k)=>{this.websocket.once(Yt.CLOSED,()=>k(new Oe(X.WS_ABORT))),this.websocket.once(Yt.CONNECTED,P)});this.websocket.state!=="connected"&&await _(),m.clientRequest&&(m.clientRequest.workerToken=this.token);const E=new lt((P,k)=>{const z=()=>{k(new Oe(X.WS_ABORT))};this.websocket.once(Yt.RECONNECTING,z),this.websocket.once(Yt.CLOSED,z),this.once("@".concat(h,"-").concat(this.spec.sid),U=>{P(U)})});c&&Rt.workerEvent(this.spec.sid,nw(nw({},c),{},{requestId:u,actionType:"request",payload:JSON.stringify(s.clientRequest),serverCode:0,code:0}));const S=Date.now();this.websocket.sendMessage(m);let R=null;try{R=await E}catch(P){if(this.websocket.state==="closed")throw P;return await _(),await this.request(r,s,o)}return c&&Rt.workerEvent(this.spec.sid,nw(nw({},c),{},{requestId:u,actionType:"response",payload:JSON.stringify(R.serverResponse),serverCode:R.code,success:R.code===200,responseTime:Date.now()-S})),R.code!==200&&this.handleResponseError(R),R}tryNextAddress(){this.reconnectMode="tryNext",this.websocket.reconnect("tryNext")}close(){const r=yl==="4.23.2"?"0.0.1":yl;this.reqId+=1,this.websocket.state==="connected"?(this.websocket.sendMessage({command:"request",appId:this.spec.appId,cname:this.spec.cname,uid:this.spec.uid.toString(),sdkVersion:r,sid:this.spec.sid,seq:this.reqId,ts:Math.floor(Date.now()/1e3),requestId:this.reqId,clientRequest:{command:"DestroyWorker"}}),this.websocket.close(!1,!0)):this.websocket.close(!1),this.pingpongTimer&&(window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0)}handleResponseError(r){switch(r.code){case Pi.LIVE_STREAM_RESPONSE_ALREADY_EXISTS_STREAM:return void L.warning("live stream response already exists stream");case Pi.LIVE_STREAM_RESPONSE_TRANSCODING_PARAMETER_ERROR:case Pi.LIVE_STREAM_RESPONSE_BAD_STREAM:case Pi.LIVE_STREAM_RESPONSE_WM_PARAMETER_ERROR:return new Oe(X.LIVE_STREAMING_INVALID_ARGUMENT,"",{code:r.code}).throw();case Pi.LIVE_STREAM_RESPONSE_WM_WORKER_NOT_EXIST:if(r.serverResponse.command==="UnpublishStream")return;throw new Oe(X.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"live stream response wm worker not exist",{retry:!0});case Pi.LIVE_STREAM_RESPONSE_NOT_AUTHORIZED:return new Oe(X.LIVE_STREAMING_PUBLISH_STREAM_NOT_AUTHORIZED,"",{code:r.code}).throw();case Pi.LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE:{const s=new Oe(X.LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE);return this.emit(Om.WARNING,s,r.serverResponse.url)}case Pi.LIVE_STREAM_RESPONSE_REQUEST_TOO_OFTEN:{const s=new Oe(X.LIVE_STREAMING_WARN_FREQUENT_REQUEST);return this.emit(Om.WARNING,s,r.serverResponse.url)}case Pi.LIVE_STREAM_RESPONSE_NOT_FOUND_PUBLISH:throw new Oe(X.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"live stream response wm worker not exist",{retry:!0});case Pi.LIVE_STREAM_RESPONSE_NOT_SUPPORTED:return new Oe(X.LIVE_STREAMING_TRANSCODING_NOT_SUPPORTED,"",{code:r.code}).throw();case Pi.LIVE_STREAM_RESPONSE_MAX_STREAM_NUM:{const s=new Oe(X.LIVE_STREAMING_WARN_STREAM_NUM_REACH_LIMIT);return this.emit(Om.WARNING,s,r.serverResponse.url)}case Pi.LIVE_STREAM_RESPONSE_INTERNAL_SERVER_ERROR:return new Oe(X.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"",{code:r.code}).throw();case Pi.LIVE_STREAM_RESPONSE_RESOURCE_LIMIT:throw new Oe(X.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"live stream resource limit",{retry:!0,changeAddress:!0});case Pi.LIVE_STREAM_RESPONSE_WORKER_LOST:case Pi.LIVE_STREAM_RESPONSE_WORKER_QUIT:if(r.serverResponse.command==="UnpublishStream")return;throw new Oe(X.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"error fail send message",{retry:!0,changeAddress:!0});case Pi.ERROR_FAIL_SEND_MESSAGE:if(r.serverResponse.command==="UnpublishStream")return;if(r.serverResponse.command==="UpdateTranscoding"||r.serverResponse.command==="ControlStream")return new Oe(X.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"error fail send message",{code:r.code}).throw();throw new Oe(X.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"error fail send message",{retry:!0,changeAddress:!0});case Pi.PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN:case Pi.PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT:case Pi.PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE:case Pi.PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH:return new Oe(X.LIVE_STREAMING_CDN_ERROR,"",{code:r.code}).throw()}}startPingPong(){this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(()=>{this.websocket.state==="connected"&&this.request("ping",{}).catch(WA)},6e3)}}function c$(t,r){var s=Object.keys(t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);r&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(t,c).enumerable})),s.push.apply(s,o)}return s}function Aa(t){for(var r=1;r<arguments.length;r++){var s=arguments[r]!=null?arguments[r]:{};r%2?c$(Object(s),!0).forEach(function(o){$(t,o,s[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(s)):c$(Object(s)).forEach(function(o){Object.defineProperty(t,o,Object.getOwnPropertyDescriptor(s,o))})}return t}class C_e extends Pr{constructor(r){let s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:bi,o=arguments.length>2&&arguments[2]!==void 0?arguments[2]:bi;super(),$(this,"onLiveStreamWarning",void 0),$(this,"onLiveStreamError",void 0),$(this,"spec",void 0),$(this,"retryTimeout",1e4),$(this,"connection",void 0),$(this,"httpRetryConfig",void 0),$(this,"wsRetryConfig",void 0),$(this,"streamingTasks",new Map),$(this,"isStartingStreamingTask",!1),$(this,"taskMutex",new ks("live-streaming")),$(this,"cancelToken",$o.CancelToken.source()),$(this,"transcodingConfig",void 0),$(this,"uapResponse",void 0),$(this,"lastTaskId",1),$(this,"statusError",new Map),this.spec=r,this.httpRetryConfig=o,this.wsRetryConfig=s}async setTranscodingConfig(r){const s=Aa(Aa({},hme),r);s.videoCodecProfile!==66&&s.videoCodecProfile!==77&&s.videoCodecProfile!==100&&(L.debug("[".concat(this.spec.clientId,"] set transcoding config, fix video codec profile: ").concat(s.videoCodecProfile," -> 100")),s.videoCodecProfile=100),s.transcodingUsers||(s.transcodingUsers=s.userConfigs),s.transcodingUsers&&(s.transcodingUsers=s.transcodingUsers.map(h=>Aa(Aa(Aa({},dme),h),{},{zOrder:h.zOrder?h.zOrder+1:1}))),function(h){Lr(h.width)||er(h.width,"config.width",0,1e4),Lr(h.height)||er(h.height,"config.height",0,1e4),Lr(h.videoBitrate)||er(h.videoBitrate,"config.videoBitrate",1,1e6),Lr(h.videoFrameRate)||er(h.videoFrameRate,"config.videoFrameRate"),Lr(h.lowLatency)||qf(h.lowLatency,"config.lowLatency"),Lr(h.audioSampleRate)||Di(h.audioSampleRate,"config.audioSampleRate",[32e3,44100,48e3]),Lr(h.audioBitrate)||er(h.audioBitrate,"config.audioBitrate",1,128),Lr(h.audioChannels)||Di(h.audioChannels,"config.audioChannels",[1,2,3,4,5]),Lr(h.videoGop)||er(h.videoGop,"config.videoGop"),Lr(h.videoCodecProfile)||Di(h.videoCodecProfile,"config.videoCodecProfile",[66,77,100]),Lr(h.userCount)||er(h.userCount,"config.userCount",0,17),Lr(h.backgroundColor)||er(h.backgroundColor,"config.backgroundColor",0,16777215),Lr(h.userConfigExtraInfo)||ss(h.userConfigExtraInfo,"config.userConfigExtraInfo",0,4096,!1),h.transcodingUsers&&!Lr(h.transcodingUsers)&&(Yf(h.transcodingUsers,"config.transcodingUsers"),h.transcodingUsers.forEach((m,_)=>{hP(m.uid),Lr(m.x)||er(m.x,"transcodingUser[".concat(_,"].x"),0,1e4),Lr(m.y)||er(m.y,"transcodingUser[".concat(_,"].y"),0,1e4),Lr(m.width)||er(m.width,"transcodingUser[".concat(_,"].width"),0,1e4),Lr(m.height)||er(m.height,"transcodingUser[".concat(_,"].height"),0,1e4),Lr(m.zOrder)||er(m.zOrder-1,"transcodingUser[".concat(_,"].zOrder"),0,100),Lr(m.alpha)||er(m.alpha,"transcodingUser[".concat(_,"].alpha"),0,1,!1)})),Lr(h.watermark)||Mx(h.watermark,"watermark"),Lr(h.backgroundImage)||Mx(h.backgroundImage,"backgroundImage"),h.images&&!Lr(h.images)&&(Yf(h.images,"config.images"),h.images.forEach((m,_)=>{Mx(m,"images[".concat(_,"]"))}))}(s);const o=[];s.images&&o.push(...s.images.map(h=>Aa(Aa(Aa({},xx),h),{},{zOrder:255}))),s.backgroundImage&&(o.push(Aa(Aa(Aa({},xx),s.backgroundImage),{},{zOrder:0})),delete s.backgroundImage),s.watermark&&(o.push(Aa(Aa(Aa({},xx),s.watermark),{},{zOrder:255})),delete s.watermark),s.images=o,s.transcodingUsers&&(s.userConfigs=s.transcodingUsers.map(h=>Aa({},h)),s.userCount=s.transcodingUsers.length,delete s.transcodingUsers);const c=(s.userConfigs||[]).map(h=>typeof h.uid=="number"?lt.resolve(h.uid):OH(h.uid,this.spec,this.cancelToken.token,this.httpRetryConfig));if((await lt.all(c)).forEach((h,m)=>{s.userConfigs&&s.userConfigs[m]&&(s.userConfigs[m].uid=h)}),this.transcodingConfig=s,this.connection)try{var u;const h=await this.connection.request("request",{clientRequest:{command:"UpdateTranscoding",transcodingConfig:this.transcodingConfig}},!1,{command:"UpdateTranscoding",workerType:1,requestByUser:!0,tid:Array.from(Oc(u=this.streamingTasks).call(u)).map(m=>m.taskId).join("#")});L.debug("[".concat(this.spec.clientId,"] update live transcoding config success, code: ").concat(h.code,", config:"),JSON.stringify(this.transcodingConfig))}catch(h){if(!h.data||!h.data.retry)throw h;h.data.changeAddress&&this.connection.tryNextAddress(),this.streamingTasks.forEach(m=>{L.warning("[".concat(this.spec.clientId,"] live streaming receive error"),h.toString(),"try to republish",m.url),this.startLiveStreamingTask(m.url,m.mode,h).then(()=>{L.debug("[".concat(this.spec.clientId,"] live streaming republish ").concat(m.url," success"))}).catch(_=>{L.error("[".concat(this.spec.clientId,"] live streaming republish failed"),m.url,_.toString()),this.onLiveStreamError&&this.onLiveStreamError(m.url,_)})})}}async startLiveStreamingTask(r,s,o){if(!this.transcodingConfig&&s===Qf.TRANSCODE)throw new Oe(X.INVALID_OPERATION,"[LiveStreaming] no transcoding config found, can not start transcoding streaming task");const c={command:"PublishStream",ts:Date.now(),url:r,uid:this.spec.uid.toString(),autoDestroyTime:100,acceptImageTimeout:!0};L.debug("[".concat(this.spec.clientId,"] start live streaming ").concat(r,", mode: ").concat(s));const u=await this.taskMutex.lock();if(!this.connection&&o)return void u();if(this.streamingTasks.get(r)&&!o)return u(),new Oe(X.LIVE_STREAMING_TASK_CONFLICT).throw();try{this.connection||(this.connection=await this.connect(s))}catch(m){throw u(),m}switch(s){case Qf.TRANSCODE:c.transcodingConfig=Aa({},this.transcodingConfig)}this.uapResponse&&this.uapResponse.vid&&(c.vid=this.uapResponse.vid),this.isStartingStreamingTask=!0;const h=this.lastTaskId++;try{const m=new lt((E,S)=>{os(this.retryTimeout).then(()=>{if(o)return S(o);const R=this.statusError.get(r);return R?(this.statusError.delete(r),S(R)):void 0})}),_=await lt.race([this.connection.request("request",{clientRequest:c},!0,{url:r,command:"PublishStream",workerType:s===Qf.TRANSCODE?1:2,requestByUser:!o,tid:h.toString()}),m]);this.isStartingStreamingTask=!1,L.debug("[".concat(this.spec.clientId,"] live streaming started, code: ").concat(_.code)),this.streamingTasks.set(r,{clientRequest:c,mode:s,url:r,taskId:h}),u()}catch(m){if(u(),this.isStartingStreamingTask=!1,!m.data||!m.data.retry||o)throw m;return m.data.changeAddress?(this.connection.tryNextAddress(),await this.startLiveStreamingTask(r,s,m)):await this.startLiveStreamingTask(r,s,m)}}stopLiveStreamingTask(r){return new lt((s,o)=>{const c=this.streamingTasks.get(r);if(!c||!this.connection)return new Oe(X.UNEXPECTED_ERROR,"can not find streaming task to stop").throw();const u=c.mode;c.abortTask=()=>{L.debug("[".concat(this.spec.clientId,"] stop live streaming success(worker exception)")),this.streamingTasks.delete(r),s()},this.connection.request("request",{clientRequest:{command:"UnpublishStream",url:c.url}},!1,{url:r,command:"UnPublishStream",workerType:u===Qf.TRANSCODE?1:2,requestByUser:!0,tid:(this.lastTaskId++).toString()}).then(h=>{L.debug("[".concat(this.spec.clientId,"] stop live streaming success, code: ").concat(h.code)),this.streamingTasks.delete(r),this.streamingTasks.size===0&&(this.connection&&this.connection.close(),this.connection=void 0),s()}).catch(o)})}resetAllTask(){var r;const s=Array.from(Oc(r=this.streamingTasks).call(r));this.terminate();for(const o of s)this.startLiveStreamingTask(o.url,o.mode).catch(c=>{this.onLiveStreamError&&this.onLiveStreamError(o.url,c)})}terminate(){this.cancelToken&&this.cancelToken.cancel(),this.streamingTasks=new Map,this.isStartingStreamingTask=!1,this.statusError=new Map,this.cancelToken=$o.CancelToken.source(),this.uapResponse=void 0,this.connection&&this.connection.close(),this.connection=void 0}async connect(r){if(this.connection)throw new Oe(X.UNEXPECTED_ERROR,"live streaming connection has already connected");const s=await Ts(this,Ux.REQUEST_WORKER_MANAGER_LIST,r);return this.uapResponse=s,this.connection=new R_e(s.workerToken,this.spec,this.wsRetryConfig,r),this.connection.on(Om.WARNING,(o,c)=>this.onLiveStreamWarning&&this.onLiveStreamWarning(c,o)),this.connection.on(Om.PUBLISH_STREAM_STATUS,o=>this.handlePublishStreamServer(o)),this.connection.on(Om.REQUEST_NEW_ADDRESS,(o,c)=>{if(!this.connection)return c(new Oe(X.UNEXPECTED_ERROR,"can not get new live streaming address list"));Ts(this,Ux.REQUEST_WORKER_MANAGER_LIST,r).then(u=>{this.uapResponse=u,o(u.addressList)}).catch(c)}),await this.connection.init(s.addressList),this.connection}handlePublishStreamServer(r){const s=r.serverStatus&&r.serverStatus.url||"empty_url",o=this.streamingTasks.get(s),c=r.reason;switch(r.code){case Pi.PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN:case Pi.PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT:case Pi.PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE:case Pi.PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH:{const h=new Oe(X.LIVE_STREAMING_CDN_ERROR,"",{code:r.code});if(o)return L.error(h.toString()),this.onLiveStreamError&&this.onLiveStreamError(s,h);if(!this.isStartingStreamingTask)return;this.statusError.set(s,h)}case Pi.LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE:{const h=new Oe(X.LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE,c);return this.onLiveStreamWarning&&this.onLiveStreamWarning(s,h)}case Pi.LIVE_STREAM_RESPONSE_WORKER_LOST:case Pi.LIVE_STREAM_RESPONSE_WORKER_QUIT:{var u;if(!this.connection)return;this.connection.tryNextAddress();const h=Array.from(Oc(u=this.streamingTasks).call(u));for(const m of h)m.abortTask?m.abortTask():(L.warning("[".concat(this.spec.clientId,"] publish stream status code"),r.code,"try to republish",m.url),this.startLiveStreamingTask(m.url,m.mode,new Oe(X.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"",{code:r.code})).then(()=>{L.debug("[".concat(this.spec.clientId,"] republish live stream success"),m.url)}).catch(_=>{L.error(_.toString()),this.onLiveStreamError&&this.onLiveStreamError(m.url,_)}));return}}}hasUrl(r){return this.streamingTasks.has(r)}}const I_e={name:"LiveStreaming",create:function(t){return new C_e(t.joinInfo,t.websocketRetryConfig||bi,t.httpRetryConfig||bi)}};function A_e(t){let r=d$();return function(s,o){let c=s.appId;c!==void 0&&($n(o,10),Oh(o,c));let u=s.cid;u!==void 0&&($n(o,16),$n(o,u));let h=s.cname;h!==void 0&&($n(o,26),Oh(o,h));let m=s.deviceId;m!==void 0&&($n(o,34),Oh(o,m));let _=s.elapse;_!==void 0&&($n(o,40),Gm(o,_));let E=s.fileSize;E!==void 0&&($n(o,48),Gm(o,dS(E)));let S=s.height;S!==void 0&&($n(o,56),Gm(o,dS(S)));let R=s.jpg;R!==void 0&&($n(o,66),$n(o,R.length),function(Qo,je){let st=hS(Qo,je.length);Qo.bytes.set(je,st)}(o,R));let P=s.networkType;P!==void 0&&($n(o,72),Gm(o,dS(P)));let k=s.osType;k!==void 0&&($n(o,80),Gm(o,dS(k)));let z=s.requestId;z!==void 0&&($n(o,90),Oh(o,z));let U=s.sdkVersion;U!==void 0&&($n(o,98),Oh(o,U));let F=s.sequence;F!==void 0&&($n(o,104),Gm(o,dS(F)));let q=s.sid;q!==void 0&&($n(o,114),Oh(o,q));let Y=s.timestamp;Y!==void 0&&($n(o,120),Gm(o,Y));let le=s.uid;le!==void 0&&($n(o,128),$n(o,le));let ye=s.vid;ye!==void 0&&($n(o,136),$n(o,ye));let Ee=s.width;Ee!==void 0&&($n(o,144),Gm(o,dS(Ee)));let me=s.service;me!==void 0&&($n(o,152),$n(o,me));let ke=s.callbackData;ke!==void 0&&($n(o,162),Oh(o,ke));let Ye=s.jpgEncryption;Ye!==void 0&&($n(o,168),$n(o,Ye));let ut=s.requestType;ut!==void 0&&($n(o,176),$n(o,ut));let pt=s.scorePorn;pt!==void 0&&($n(o,185),FM(o,pt));let vn=s.scoreSexy;vn!==void 0&&($n(o,193),FM(o,vn));let Sn=s.scoreNeutral;Sn!==void 0&&($n(o,201),FM(o,Sn));let cr=s.scene;cr!==void 0&&($n(o,208),$n(o,cr));let ei=s.ossFilePrefix;ei!==void 0&&($n(o,218),Oh(o,ei));let Wr=s.serviceVendor;if(Wr!==void 0)for(let Qo of Wr){$n(o,226);let je=d$();k_e(Qo,je),$n(o,je.limit),x_e(o,je),L_e(je)}}(t,r),function(s){let o=s.bytes,c=s.limit;return o.length===c?o:o.subarray(0,c)}(r)}function P_e(t){return function(s){let o={};e:for(;!h$(s);){let c=kh(s);switch(c>>>3){case 0:break e;case 1:o.code=kh(s);break;case 2:o.msg=f$(s,kh(s));break;case 3:{let u=N_e(s);o.data=O_e(s),s.limit=u;break}default:l$(s,7&c)}}return o}({bytes:r=t,offset:0,limit:r.length});var r}function O_e(t){let r={};e:for(;!h$(t);){let s=kh(t);switch(s>>>3){case 0:break e;case 1:r.requestId=f$(t,kh(t));break;case 2:r.requestType=kh(t)>>>0;break;case 3:r.scorePorn=VM(t);break;case 4:r.scoreSexy=VM(t);break;case 5:r.scoreNeutral=VM(t);break;case 6:r.requestScene=kh(t)>>>0;break;case 7:r.scene=kh(t)>>>0;break;default:l$(t,7&s)}}return r}function k_e(t,r){let s=t.service;s!==void 0&&($n(r,8),$n(r,s));let o=t.vendor;o!==void 0&&($n(r,16),$n(r,o));let c=t.token;c!==void 0&&($n(r,26),Oh(r,c));let u=t.callbackUrl;u!==void 0&&($n(r,34),Oh(r,u))}function N_e(t){let r=kh(t),s=t.limit;return t.limit=t.offset+r,s}function l$(t,r){switch(r){case 0:for(;128&p$(t););break;case 2:MM(t,kh(t));break;case 5:MM(t,4);break;case 1:MM(t,8);break;default:throw new Error("Unimplemented type: "+r)}}let D_e=new Float32Array(1);new Uint8Array(D_e.buffer);let xM=new Float64Array(1),Pa=new Uint8Array(xM.buffer);function dS(t){return{low:t|=0,high:t>>31,unsigned:t>=0}}let u$=[];function d$(){const t=u$.pop();return t?(t.offset=t.limit=0,t):{bytes:new Uint8Array(64),offset:0,limit:0}}function L_e(t){u$.push(t)}function MM(t,r){if(t.offset+r>t.limit)throw new Error("Skip past limit");t.offset+=r}function h$(t){return t.offset>=t.limit}function hS(t,r){let s=t.bytes,o=t.offset,c=t.limit,u=o+r;if(u>s.length){let h=new Uint8Array(2*u);h.set(s),t.bytes=h}return t.offset=u,u>c&&(t.limit=u),o}function UM(t,r){let s=t.offset;if(s+r>t.limit)throw new Error("Read past limit");return t.offset+=r,s}function f$(t,r){let s=UM(t,r),o=String.fromCharCode,c=t.bytes,u="",h="";for(let m=0;m<r;m++){let _,E,S,R,P=c[m+s];(128&P)==0?h+=o(P):(224&P)==192?m+1>=r?h+=u:(_=c[m+s+1],(192&_)!=128?h+=u:(R=(31&P)<<6|63&_,R<128?h+=u:(h+=o(R),m++))):(240&P)==224?m+2>=r?h+=u:(_=c[m+s+1],E=c[m+s+2],(49344&(_|E<<8))!=32896?h+=u:(R=(15&P)<<12|(63&_)<<6|63&E,R<2048||R>=55296&&R<=57343?h+=u:(h+=o(R),m+=2))):(248&P)==240?m+3>=r?h+=u:(_=c[m+s+1],E=c[m+s+2],S=c[m+s+3],(12632256&(_|E<<8|S<<16))!=8421504?h+=u:(R=(7&P)<<18|(63&_)<<12|(63&E)<<6|63&S,R<65536||R>1114111?h+=u:(R-=65536,h+=o(55296+(R>>10),56320+(1023&R)),m+=3))):h+=u}return h}function Oh(t,r){let s=r.length,o=0;for(let h=0;h<s;h++){let m=r.charCodeAt(h);m>=55296&&m<=56319&&h+1<s&&(m=(m<<10)+r.charCodeAt(++h)-56613888),o+=m<128?1:m<2048?2:m<65536?3:4}$n(t,o);let c=hS(t,o),u=t.bytes;for(let h=0;h<s;h++){let m=r.charCodeAt(h);m>=55296&&m<=56319&&h+1<s&&(m=(m<<10)+r.charCodeAt(++h)-56613888),m<128?u[c++]=m:(m<2048?u[c++]=m>>6&31|192:(m<65536?u[c++]=m>>12&15|224:(u[c++]=m>>18&7|240,u[c++]=m>>12&63|128),u[c++]=m>>6&63|128),u[c++]=63&m|128)}}function x_e(t,r){let s=hS(t,r.limit),o=t.bytes,c=r.bytes;for(let u=0,h=r.limit;u<h;u++)o[u+s]=c[u]}function p$(t){return t.bytes[UM(t,1)]}function m$(t,r){let s=hS(t,1);t.bytes[s]=r}function VM(t){let r=UM(t,8),s=t.bytes;return Pa[0]=s[r++],Pa[1]=s[r++],Pa[2]=s[r++],Pa[3]=s[r++],Pa[4]=s[r++],Pa[5]=s[r++],Pa[6]=s[r++],Pa[7]=s[r++],xM[0]}function FM(t,r){let s=hS(t,8),o=t.bytes;xM[0]=r,o[s++]=Pa[0],o[s++]=Pa[1],o[s++]=Pa[2],o[s++]=Pa[3],o[s++]=Pa[4],o[s++]=Pa[5],o[s++]=Pa[6],o[s++]=Pa[7]}function kh(t){let r,s=0,o=0;do r=p$(t),s<32&&(o|=(127&r)<<s),s+=7;while(128&r);return o}function $n(t,r){for(r>>>=0;r>=128;)m$(t,127&r|128),r>>>=7;m$(t,r)}function Gm(t,r){let s=r.low>>>0,o=(r.low>>>28|r.high<<4)>>>0,c=r.high>>>24,u=c===0?o===0?s<16384?s<128?1:2:s<1<<21?3:4:o<16384?o<128?5:6:o<1<<21?7:8:c<128?9:10,h=hS(t,u),m=t.bytes;switch(u){case 10:m[h+9]=c>>>7&1;case 9:m[h+8]=u!==9?128|c:127&c;case 8:m[h+7]=u!==8?o>>>21|128:o>>>21&127;case 7:m[h+6]=u!==7?o>>>14|128:o>>>14&127;case 6:m[h+5]=u!==6?o>>>7|128:o>>>7&127;case 5:m[h+4]=u!==5?128|o:127&o;case 4:m[h+3]=u!==4?s>>>21|128:s>>>21&127;case 3:m[h+2]=u!==3?s>>>14|128:s>>>14&127;case 2:m[h+1]=u!==2?s>>>7|128:s>>>7&127;case 1:m[h]=u!==1?128|s:127&s}}function g$(t,r){var s=Object.keys(t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);r&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(t,c).enumerable})),s.push.apply(s,o)}return s}const M_e=new Map([["moderation",1],["supervise",2]]);class U_e extends Pr{get connectionState(){return this._connectionState}set connectionState(r){if(this._connectionState===r)return;const s=this._connectionState;this._connectionState=r,this.emit(ts.CONNECTION_STATE_CHANGE,s,r)}get inspectType(){return this._inspectType}set inspectType(r){var s;this._inspectMode=Ya(s=r.map(o=>M_e.get(o)||0)).call(s,(o,c)=>o+c),this._inspectType=r}get quality(){return this._quality}set quality(r){this._quality=r>1?1:r<.1?.1:r,this.qualityTimer&&(window.clearTimeout(this.qualityTimer),this.qualityTimer=null),this._quality>=1||(this.qualityTimer=window.setTimeout(()=>{this.quality=this._quality/this.qualityRatio},6e4))}constructor(r){super(),$(this,"name","AgoraRTCVideoContentInspect"),$(this,"_connectionState",fu.CONNECTING),$(this,"_innerConnectionState",void 0),$(this,"sequence",0),$(this,"inspectStartTime",void 0),$(this,"workerManagerConnection",void 0),$(this,"workerConnection",void 0),$(this,"workerMessageLengthLimit",void 0),$(this,"inspectIntervalMinimum",void 0),$(this,"qualityRatio",void 0),$(this,"_connectInfo",void 0),$(this,"_cancelTokenSource",$o.CancelToken.source()),$(this,"_retryConfig",void 0),$(this,"wmSequence",0),$(this,"inspectInterval",void 0),$(this,"inspectTimer",null),$(this,"ossFilePrefix",void 0),$(this,"extraInfo",void 0),$(this,"_inspectType",void 0),$(this,"_inspectMode",void 0),$(this,"_quality",1),$(this,"qualityTimer",null),$(this,"_inspectId",void 0),$(this,"_needWorkUrlOnly",!1),$(this,"inspectImage",()=>{if(this.connectionState!==fu.CONNECTED)throw new Oe(X.OPERATION_ABORTED,"content inspect service connection status is ".concat(this.connectionState));this.inspectTimer&&(window.clearInterval(this.inspectTimer),this.inspectTimer=null),this.inspectTimer=window.setInterval(()=>{this.connectionState===fu.CONNECTED?this.requestToInspectImage():L.debug("[".concat(this._inspectId,"] Inspect State is not connected , "),this.connectionState)},this.inspectInterval<this.inspectIntervalMinimum?this.inspectIntervalMinimum:this.inspectInterval),this.requestToInspectImage()}),this._inspectId=or(5,"inspect-"),this.workerMessageLengthLimit=re("VIDEO_INSPECT_WORKER_MESSAGE_LENGTH_LIMIT"),this.inspectIntervalMinimum=re("VIDEO_INSPECT_INTERVAL_MINIMUM"),this.qualityRatio=re("VIDEO_INSPECT_QUALITY_RATIO"),this.inspectInterval=r.interval,this.ossFilePrefix=r.ossFilePrefix,this.extraInfo=r.extraInfo,this.inspectType=r.inspectType,this.inspectStartTime=Number(Date.now()),this.workerManagerConnection=new IT("worker-manager-"+this._inspectId,bi),this.on(ts.STATE_CHANGE,(s,o)=>{this._innerConnectionState=s,L.debug("[".concat(this._inspectId,"] Inspect operation :").concat(pu[s]," ").concat(o||""))}),this.handleWorkerManagerEvents(),this.workerConnection=new IT("worker-"+this._inspectId,bi),this.handleWorkerEvents()}async init(r,s){this.emit(ts.STATE_CHANGE,pu.CONNECT_AP),this._connectInfo=r;const o=this._cancelTokenSource.token;return this._retryConfig=s,new lt((c,u)=>{this.on(ts.CONNECTION_STATE_CHANGE,(h,m)=>{m===fu.CONNECTED&&c()}),this.requestAP(r,o,s).then(h=>{this.connectWorkerManager(h)}).catch(h=>{u(h)})})}async requestAP(r,s,o){const c=re("WEBCS_DOMAIN").map(m=>"https://".concat(m,"/api/v1")),u=await function(m,_,E,S){let{appId:R,areaCode:P,cname:k,sid:z,token:U,uid:F}=_;tS++;const q="image_moderation_api",Y={service_name:q,json_body:JSON.stringify({appId:R,areaCode:P,cname:k,command:"allocateEdge",requestId:tS,seq:tS,sid:z,token:U,ts:Date.now(),uid:F+""})};let le,ye,Ee=m[0];return pd(async()=>{le=Date.now();const me=await Ed(Ee,{data:Y,cancelToken:E,headers:{"X-Packet-Service-Type":"0","X-Packet-URI":"61"},params:{action:"wrtc_gateway"}});if(ye=Date.now()-le,me.code!==0){const pt=new Oe(X.UNEXPECTED_RESPONSE,"image inspect ap error, code"+me.code,{retry:!0,responseTime:ye});throw L.error(pt.toString()),pt}const ke=JSON.parse(me.json_body);if(ke.code!==200){const pt=new Oe(X.UNEXPECTED_RESPONSE,"image inspect ap error, code: ".concat(ke.code,", reason: ").concat(ke.reason),{code:ke.code,responseTime:ye});throw L.error(pt.toString()),pt}if(!ke.servers||!Array.isArray(ke.servers)||ke.servers.length===0){const pt=new Oe(X.UNEXPECTED_RESPONSE,"image inspect ap empty server",{code:ke.code,responseTime:ye});throw L.error(pt.toString()),pt}const Ye=re("VIDEO_INSPECT_WORKER_MANAGER_HOST"),ut=re("VIDEO_INSPECT_WORKER_MANAGER_PORT");return{addressList:ke.servers.map(pt=>{let{address:vn,wss:Sn}=pt;if(vn&&Sn)return"wss://".concat(vn.replace(/\./g,"-"),".").concat(Ye,":").concat(ut||Sn)}).filter(pt=>!!pt),workerToken:ke.workerToken,vid:ke.vid,responseTime:ye}},(me,ke)=>(Rt.apworkerEvent(z,{success:!0,sc:200,serviceName:q,responseDetail:JSON.stringify(me.addressList),firstSuccess:ke===0,responseTime:ye,serverIp:m[ke%m.length]}),!1),(me,ke)=>(Rt.apworkerEvent(z,{success:!1,sc:me.data&&me.data.code||200,serviceName:q,responseTime:ye,serverIp:m[ke%m.length]}),!!(me.code!==X.OPERATION_ABORTED&&me.code!==X.UNEXPECTED_RESPONSE||me.data&&me.data.retry)&&(Ee=m[(ke+1)%m.length],!0)),S)}(c,r,s,o);this.emit(ts.STATE_CHANGE,pu.AP_CONNECTED);const{addressList:h}=u;return this.wmSequence++,h}async connectWorkerManager(r){let s=arguments.length>1&&arguments[1]!==void 0&&arguments[1];this._needWorkUrlOnly=s,this.emit(ts.STATE_CHANGE,pu.CONNECT_WORKER_MANAGER),await this.workerManagerConnection.init(r,1e4)}async connectWorker(r){await this.workerConnection.init([r])}handleWorkerManagerEvents(){this.workerManagerConnection.on(Yt.CONNECTED,async()=>{this.emit(ts.STATE_CHANGE,pu.WORKER_MANAGER_CONNECTED,this.workerManagerConnection.url),this.workerManagerConnection.sendMessage({appId:this._connectInfo.appId,cname:this._connectInfo.cname,uid:this._connectInfo.uid+"",sdkVersion:"4.23.2",sid:this._connectInfo.sid,seq:this.wmSequence,ts:Number(Date.now()),requestId:Math.floor(1e12*Math.random()),allocate:!0,clientRequest:{command:"join"}},!0)}),this.workerManagerConnection.on(Yt.CLOSED,()=>{this._innerConnectionState<pu.GET_WORKER_MANAGER_RESPONSE&&L.debug("[".concat(this._inspectId,"] Inspect worker manager is closed before connecting worker"))}),this.workerManagerConnection.on(Yt.FAILED,()=>{this._innerConnectionState<pu.GET_WORKER_MANAGER_RESPONSE&&L.debug("[".concat(this._inspectId,"] Connecting inspect worker manager is failed before connecting worker"))}),this.workerManagerConnection.on(Yt.RECONNECTING,()=>{this._innerConnectionState<pu.GET_WORKER_MANAGER_RESPONSE&&L.debug("[".concat(this._inspectId,"] Inspect worker manager is reconnecting before connecting worker"))}),this.workerManagerConnection.on(Yt.ON_MESSAGE,async r=>{this.emit(ts.STATE_CHANGE,pu.GET_WORKER_MANAGER_RESPONSE);const s=this.workerManagerConnection.url;this.workerManagerConnection.close();const o=JSON.parse(r.data);if(o.code!==200)throw L.error("[".concat(this._inspectId,"] Unexpected code ").concat(o.code," from worker manager")),new Oe(X.UNEXPECTED_RESPONSE,"response code of worker is unexpected",o);if(!(o.serverResponse&&o.serverResponse.portWss&&s))throw L.error("[".concat(this._inspectId,"] Unexpected content from worker manager : ").concat(JSON.stringify(o))),new Oe(X.UNEXPECTED_RESPONSE,"response content of worker is unexpected",o);{const c=re("VIDEO_INSPECT_WORKER_PORT")||o.serverResponse.portWss,u=s.replace(/:\d+\/?$/,":".concat(c));this.emit(ts.STATE_CHANGE,pu.CONNECT_WORKER,u),this._needWorkUrlOnly?this.emit(ts.REQUEST_NEW_WORKER_URL,u):await this.connectWorker(u)}}),this.workerManagerConnection.on(Yt.WILL_RECONNECT,(r,s,o)=>{o(r)}),this.workerManagerConnection.on(Yt.REQUEST_NEW_URLS,(r,s)=>{this.requestAP(this._connectInfo,this._cancelTokenSource.token,this._retryConfig).then(r).catch(s)})}handleWorkerEvents(){this.workerConnection.on(Yt.CONNECTED,async()=>{this.emit(ts.STATE_CHANGE,pu.WORKER_CONNECTED,this.workerConnection.url),this.connectionState=fu.CONNECTED}),this.workerConnection.on(Yt.ON_MESSAGE,async r=>{if(r.data instanceof ArrayBuffer){const o=P_e(new Uint8Array(r.data));if(re("SHOW_VIDEO_INSPECT_WORKER_MESSAGE")&&L.debug("[".concat(this._inspectId,"] Response message for worker of inspect content "),JSON.stringify(o)),o.code===200){if(Array.isArray(this.inspectType)&&this.inspectType.length===1&&this.inspectType[0]==="supervise")return void this.emit(ts.INSPECT_RESULT,void 0,void 0);if(o.data&&o.data.scorePorn&&o.data.scoreSexy&&o.data.scoreNeutral){var s;const c={porn:o.data.scorePorn,sexy:o.data.scoreSexy,neutral:o.data.scoreNeutral},u=Ya(s=Object.keys(c)).call(s,(m,_)=>c[m]>c[_]?m:_,"porn"),h=Object.keys(c).find(m=>m===u);this.emit(ts.INSPECT_RESULT,h)}else this.emit(ts.INSPECT_RESULT,void 0,new Oe(X.UNEXPECTED_RESPONSE,o.code+"","There is an unexpected data on message"))}else this.emit(ts.INSPECT_RESULT,void 0,new Oe(X.UNEXPECTED_RESPONSE,o.code+"",o.msg))}else L.error("[".concat(this._inspectId,"] Unexpected message type from worker")),this.emit(ts.INSPECT_RESULT,void 0,new Oe(X.UNEXPECTED_RESPONSE,"invalid worker message type"))}),this.workerConnection.on(Yt.CLOSED,()=>{this.connectionState=fu.CLOSED}),this.workerConnection.on(Yt.FAILED,()=>{this.connectionState=fu.CLOSED}),this.workerConnection.on(Yt.RECONNECTING,()=>{this.connectionState=this.connectionState===fu.CONNECTED?fu.RECONNECTING:fu.CONNECTING}),this.workerConnection.on(Yt.WILL_RECONNECT,(r,s,o)=>{r==="recover"&&o(r),o("tryNext")}),this.workerConnection.on(Yt.REQUEST_NEW_URLS,(r,s)=>{this.workerManagerConnection.close(),this.once(ts.REQUEST_NEW_WORKER_URL,o=>{r([o])}),this.requestAP(this._connectInfo,this._cancelTokenSource.token,this._retryConfig).then(o=>{this.connectWorkerManager(o,!0)}).catch(o=>{s(o)})})}async requestToInspectImage(){this.sequence++;const r=Nc(this,ts.CLIENT_LOCAL_VIDEO_TRACK),s={appId:this._connectInfo.appId,cname:this._connectInfo.cname,cid:this._connectInfo.cid,sid:this._connectInfo.sid,uid:this._connectInfo.uid,vid:this._connectInfo.vid};if(r){if(!r.isPlaying)return void this.emit(ts.INSPECT_RESULT,void 0,new Oe(X.INVALID_OPERATION,"Only the track being played can be inspected"));const o=await this.generateRequestData(r,s);this.workerConnection.sendMessage(o,!0,!0)}else this.emit(ts.INSPECT_RESULT,void 0,new Oe(X.INVALID_OPERATION,"Only the track being published can be inspected"))}async generateRequestData(r,s){let{appId:o,cname:c,cid:u,vid:h,sid:m,uid:_}=s;const E=Date.now(),S=await r.getCurrentFrameImage("image/jpeg",this.quality),R=await J8(S,o,c),P=this.sequence+"-"+u+"-"+_+"-"+E+"-"+or(12,""),k={appId:o,cid:u,cname:c,deviceId:"",elapse:(z=Number(E-this.inspectStartTime),{low:z|=0,high:z>>31,unsigned:z>=0}),fileSize:R.byteLength,jpgEncryption:2,height:S.height,width:S.width,jpg:R,networkType:6,osType:7,requestId:P,sdkVersion:"4.23.2",sequence:this.sequence,sid:m,timestamp:w9(E),uid:_,vid:h,service:this._inspectMode,callbackData:this.extraInfo,ossFilePrefix:this.ossFilePrefix};var z;this.extraInfo===void 0&&delete k.callbackData,this.ossFilePrefix===void 0&&delete k.ossFilePrefix;const U=A_e(k);if(U.byteLength<this.workerMessageLengthLimit){if(re("SHOW_VIDEO_INSPECT_WORKER_MESSAGE")){const F=function(q){for(var Y=1;Y<arguments.length;Y++){var le=arguments[Y]!=null?arguments[Y]:{};Y%2?g$(Object(le),!0).forEach(function(ye){$(q,ye,le[ye])}):Object.getOwnPropertyDescriptors?Object.defineProperties(q,Object.getOwnPropertyDescriptors(le)):g$(Object(le)).forEach(function(ye){Object.defineProperty(q,ye,Object.getOwnPropertyDescriptor(le,ye))})}return q}({},k);delete F.jpg,L.debug("[".concat(this._inspectId,"] Request message for worker of inspect content "),JSON.stringify(F))}return U}{const F=this.quality*this.qualityRatio;return this.quality=F,await this.generateRequestData(r,{appId:o,cname:c,cid:u,vid:h,sid:m,uid:_})}}close(){this._cancelTokenSource.cancel(),this._cancelTokenSource=$o.CancelToken.source(),this.workerManagerConnection&&this.workerManagerConnection.close(),this.workerConnection&&this.workerConnection.close(),this.inspectTimer&&window.clearInterval(this.inspectTimer),this.inspectTimer=null,this.connectionState=fu.CLOSED,this.emit(ts.STATE_CHANGE,pu.CLOSED)}}const V_e={name:"ContentInspect",create:function(t){let{config:r}=t;return function(s){if(!s)throw new Oe(X.INVALID_PARAMS,"inspectConfig is necessary.");if(!s.inspectType||!Array.isArray(s.inspectType))throw new Oe(X.INVALID_PARAMS,"inspectConfig.inspectType is necessary and is an instance of Array.");{const o=[...new Set(s.inspectType)];o.forEach(c=>{var u;if(!ot(u=["supervise","moderation"]).call(u,c))throw new Oe(X.INVALID_PARAMS,"".concat(c," is not a valid inspect type."))}),s.inspectType=o}if(s&&s.extraInfo&&s.extraInfo.length>1024)throw new Oe(X.INVALID_PARAMS,"inspectConfig.extraInfo length cannot exceed 1024 bytes")}(r),new U_e(r)}};var _$=l(bt.Object.getOwnPropertySymbols),F_e=Mn,j_e=jo.indexOf,B_e=Sf,jM=se([].indexOf),y$=!!jM&&1/jM([1],1,-0)<0;F_e({target:"Array",proto:!0,forced:y$||!B_e("indexOf")},{indexOf:function(t){var r=arguments.length>1?arguments[1]:void 0;return y$?jM(this,t,r)||0:j_e(this,t,r)}});var W_e=qa("Array").indexOf,z_e=N,G_e=W_e,BM=Array.prototype,H_e=function(t){var r=t.indexOf;return t===BM||z_e(BM,t)&&r===BM.indexOf?G_e:r},E$=l(H_e);function $_e(t,r){if(t==null)return{};var s,o,c=function(h,m){if(h==null)return{};var _,E,S={},R=FG(h);for(E=0;E<R.length;E++)_=R[E],E$(m).call(m,_)>=0||(S[_]=h[_]);return S}(t,r);if(_$){var u=_$(t);for(o=0;o<u.length;o++)s=u[o],E$(r).call(r,s)>=0||Object.prototype.propertyIsEnumerable.call(t,s)&&(c[s]=t[s])}return c}let v$=class{get localCapabilities(){return Mr(this._localCapabilities)}get rtpCapabilities(){return Mr(this._rtpCapabilities)}get candidates(){return Mr(this._candidates)}get iceParameters(){return Mr(this._iceParameters)}get dtlsParameters(){return Mr(this._dtlsParameters)}constructor(t){$(this,"sessionDesc",void 0),$(this,"_localCapabilities",void 0),$(this,"_rtpCapabilities",void 0),$(this,"_candidates",void 0),$(this,"_iceParameters",void 0),$(this,"_dtlsParameters",void 0),$(this,"setup",void 0),$(this,"currentMidIndex",void 0),$(this,"cname","o/i14u9pJrxRKAsu"),$(this,"firefoxSsrcMidMap",new Map),t=Mr(t);const{remoteIceParameters:r,remoteDtlsParameters:s,candidates:o,remoteRTPCapabilities:c,localCapabilities:u,direction:h,setup:m,videoCodec:_,audioCodec:E}=t;let S;this.setup=m,S=h===To.RECEIVE_ONLY?Ca(`v=0
o=- 0 0 IN IP4 127.0.0.1
s=AgoraGateway
t=0 0
a=group:BUNDLE 0 1
a=msid-semantic: WMS
a=extmap-allow-mixed
m=video 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendonly
a=rtcp-mux
a=rtcp-rsize
a=mid:0
m=audio 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendonly
a=rtcp-mux
a=rtcp-rsize
a=mid:1
`):Ca(`v=0
o=- 0 0 IN IP4 127.0.0.1
s=AgoraGateway
t=0 0
a=group:BUNDLE 0 1
a=msid-semantic: WMS
a=extmap-allow-mixed
m=video 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=recvonly
a=rtcp-mux
a=rtcp-rsize
a=mid:0
m=audio 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=recvonly
a=rtcp-mux
a=rtcp-rsize
a=mid:1
`),this._rtpCapabilities=c,this._candidates=o,this._iceParameters=r,this._dtlsParameters=s,this._localCapabilities=u;const R=h===To.RECEIVE_ONLY?this.rtpCapabilities.send:this.rtpCapabilities.recv,P=h===To.RECEIVE_ONLY?this._localCapabilities.recv:this._localCapabilities.send,k=h===To.RECEIVE_ONLY?c.send.videoCodecs:OT(gt.VIDEO,R,P,_),z=h===To.RECEIVE_ONLY?c.send.audioCodecs:OT(gt.AUDIO,R,P,E);for(const U of S.mediaDescriptions)U.attributes.iceUfrag=r.iceUfrag,U.attributes.icePwd=r.icePwd,U.attributes.fingerprints=s.fingerprints,U.attributes.candidates=o,U.attributes.setup=this.setup,U.media.mediaType==="application"&&(U.attributes.sctpPort="5000"),U.media.mediaType==="video"&&(U.media.fmts=k.map(F=>F.payloadType.toString(10)),U.attributes.payloads=k,U.attributes.extmaps=R.videoExtensions),U.media.mediaType==="audio"&&(U.media.fmts=z.map(F=>F.payloadType.toString(10)),U.attributes.payloads=z,U.attributes.extmaps=R.audioExtensions,eS(U));this.sessionDesc=S,this.currentMidIndex=S.mediaDescriptions.length-1}toString(){return Pm(this.sessionDesc)}hasMid(t){return Array.isArray(t)?t.every(r=>this.hasMid(r)):this.sessionDesc.mediaDescriptions.some(r=>r.attributes.mid===t)}send(t,r,s,o,c){s=s.replace(/ /g,"-");const{ssrcs:u,ssrcGroups:h}=z_(r,this.cname,re("SYNC_GROUP")?s:void 0),m=this.findPreloadMediaDesc(u);if(m){if(Dr()&&this.firefoxSsrcMidMap.set(u[0].ssrcId,m.attributes.mid),c&&(c.twcc||c.remb)){const _=this.sessionDesc.mediaDescriptions.indexOf(m);return this.sessionDesc.mediaDescriptions[_]=this.mungSendMediaDesc(m,c),{mid:m.attributes.mid,needExchangeSDP:!0}}return{mid:m.attributes.mid,needExchangeSDP:!1}}{const _=this.findAvailableMediaIndex(t,u,o);let E;return _===-1?(E=this.createOrRecycleSendMedia(t,u,h,"sendonly",o,c),this.updateBundleMids()):(E=Mr(this.sessionDesc.mediaDescriptions[_]),E.attributes.direction="sendonly",E.attributes.ssrcs=u,E.attributes.ssrcGroups=h,this.sessionDesc.mediaDescriptions[_]=this.mungSendMediaDesc(E,c)),Dr()&&this.firefoxSsrcMidMap.set(u[0].ssrcId,E.attributes.mid),{needExchangeSDP:!0,mid:E.attributes.mid}}}stopSending(t){const r=this.sessionDesc.mediaDescriptions.filter(s=>s.attributes.mid&&t.indexOf(s.attributes.mid)!==-1);if(r.length!==t.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.stopSending.");r.forEach(s=>{s.attributes.ssrcs=[]}),this.updateBundleMids()}receive(t,r,s){const o=[];return t.forEach(c=>{const u=c._mediaStreamTrack.kind,h=this.findAvailableRecvMediaIndex(u);let m,_=!1;h===-1?(_=!0,m=this.createOrRecycleRecvMedia(c,[],"recvonly",r,s),this.updateBundleMids()):(m=Mr(this.sessionDesc.mediaDescriptions[h]),m.attributes.direction="recvonly"),o.push({mid:m.attributes.mid,needCreateTransceiver:_})}),o}stopReceiving(t){const r=this.sessionDesc.mediaDescriptions.filter(s=>t.indexOf(s.attributes.mid)!==-1);if(r.length!==t.length)throw new Error("MediaDescriptions' length doesn't match mids's length when calling RemoteSDP.receive.");r.forEach(s=>{s.media.port="0",s.attributes.direction="inactive"}),this.updateBundleMids()}addRemoteCandidate(t){const{foundation:r,protocol:s,address:o,port:c,type:u,relatedAddress:h,relatedPort:m,priority:_}=new RTCIceCandidate(t),E={foundation:r??"",componentId:"1",transport:s??"",priority:_?_+"":"",connectionAddress:o??"",port:c?c+"":"",type:u?u+"":"",relAddr:h??"",relPort:m?m+"":"",extension:{}};this.candidates.some(S=>S.priority===E.priority&&S.connectionAddress===E.connectionAddress&&S.port===E.port)||(this._candidates.push(E),this.sessionDesc.mediaDescriptions.forEach(S=>{S.attributes.candidates=this.candidates}))}clearRemoteCandidate(){this._candidates=[],this.sessionDesc.mediaDescriptions[0].attributes.candidates=this._candidates}createOrRecycleRecvMedia(t,r,s,o,c){const u=t._mediaStreamTrack.kind,h=this.rtpCapabilities.recv,m=OT(u,h,this.localCapabilities.send,u===gt.AUDIO?c:o),_=u===gt.VIDEO?h.videoExtensions:h.audioExtensions,E="".concat(++this.currentMidIndex);let S={media:{mediaType:u,port:"9",protos:["UDP","TLS","RTP","SAVPF"],fmts:m.map(P=>P.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:[],extmaps:_,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:r,ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:m,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:s,rtcpMux:!0,rtcpRsize:!0,mid:"".concat(E)}};S=this.mungRecvMediaDsec(S,t);const R=this.findFirstClosedMedia(u);if(R){const P=this.sessionDesc.mediaDescriptions.indexOf(R);this.sessionDesc.mediaDescriptions[P]=S}else this.sessionDesc.mediaDescriptions.push(S);return S}muteRemote(t){const r=this.sessionDesc.mediaDescriptions.filter(s=>ot(t).call(t,s.attributes.mid||""));if(r.length!==t.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");r.forEach(s=>{s.attributes.direction="inactive"})}unmuteRemote(t){const r=this.sessionDesc.mediaDescriptions.filter(s=>ot(t).call(t,s.attributes.mid||""));if(r.length!==t.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");r.forEach(s=>{s.attributes.direction="recvonly"})}findAvailableMediaIndex(t,r,s){return this.sessionDesc.mediaDescriptions.findIndex(o=>{const c=o.media.mediaType===t&&o.media.port!=="0"&&(o.attributes.direction==="sendonly"||o.attributes.direction==="sendrecv")&&o.attributes.ssrcs.length===0;if(Dr()){if(c){const u=this.firefoxSsrcMidMap.get(r[0].ssrcId);return!(u||o.attributes.mid!=="0"&&o.attributes.mid!=="1")||!(!u||u!==o.attributes.mid)}return!1}return c&&o.attributes.mid===s})}findAvailableRecvMediaIndex(t){return this.sessionDesc.mediaDescriptions.findIndex(r=>{const s=r.media.mediaType===t&&r.media.port!=="0"&&(r.attributes.direction==="recvonly"||r.attributes.direction==="sendrecv");return r.attributes.mid!=="0"&&r.attributes.mid!=="1"&&s})}predictReceivingMids(t){const r=[];for(let s=0;s<t;s++)r.push((this.currentMidIndex+s+1).toString(10));return r}restartICE(t){t=Mr(t),this._iceParameters=t,this.sessionDesc.mediaDescriptions.forEach(r=>{r.attributes.iceUfrag=t.iceUfrag,r.attributes.icePwd=t.icePwd})}createOrRecycleSendMedia(t,r,s,o,c,u){const h=this.rtpCapabilities.send,m=t===gt.VIDEO?h.videoCodecs:h.audioCodecs,_=t===gt.VIDEO?h.videoExtensions:h.audioExtensions;Dr()&&(c="".concat(++this.currentMidIndex));let E={media:{mediaType:t,port:"9",protos:["UDP","TLS","RTP","SAVPF"],fmts:m.map(R=>R.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:[],extmaps:_,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:r,ssrcGroups:s,rtcpFeedbackWildcards:[],payloads:m,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:o,rtcpMux:!0,rtcpRsize:!0,mid:c}};E=this.mungSendMediaDesc(E,u);const S=this.findFirstClosedMedia(t);if(S){const R=this.sessionDesc.mediaDescriptions.indexOf(S);this.sessionDesc.mediaDescriptions[R]=E}else this.sessionDesc.mediaDescriptions.push(E);return E}mungRecvMediaDsec(t,r,s){const o=Mr(t);return Wx(o),Zv(o,r),zx(o,r),uH(o),EP(o,s,this.localCapabilities.send),o}mungSendMediaDesc(t,r){const s=Mr(t);return EP(s,r,this.localCapabilities.recv),eS(s),s}updateRecvMedia(t,r){const s=this.sessionDesc.mediaDescriptions.findIndex(o=>o.attributes.mid===t);if(s!==-1){const o=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[s],r);this.sessionDesc.mediaDescriptions[s]=o}}updateBundleMids(){this.sessionDesc.attributes.groups[0].identificationTag=this.sessionDesc.mediaDescriptions.filter(t=>t.media.port!=="0").map(t=>t.attributes.mid)}findPreloadMediaDesc(t){return this.sessionDesc.mediaDescriptions.find(r=>{var s;return((s=r.attributes)===null||s===void 0||(s=s.ssrcs[0])===null||s===void 0?void 0:s.ssrcId)===t[0].ssrcId})}findFirstClosedMedia(t){return this.sessionDesc.mediaDescriptions.find(r=>Dr()?r.media.port==="0"&&r.media.mediaType===t:r.media.port==="0")}};const K_e=["sdp"];var fr;function S$(t,r){var s=Object.keys(t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);r&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(t,c).enumerable})),s.push.apply(s,o)}return s}function Hm(t){for(var r=1;r<arguments.length;r++){var s=arguments[r]!=null?arguments[r]:{};r%2?S$(Object(s),!0).forEach(function(o){$(t,o,s[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(s)):S$(Object(s)).forEach(function(o){Object.defineProperty(t,o,Object.getOwnPropertyDescriptor(s,o))})}return t}let b$=(fr=class CS extends HG{get currentLocalDescription(){return this.peerConnection.currentLocalDescription}get currentRemoteDescription(){return this.peerConnection.currentRemoteDescription}get peerConnectionState(){return this.peerConnection.connectionState}get iceConnectionState(){return this.peerConnection.iceConnectionState}get dtlsTransportState(){var r,s;return(r=(s=this.peerConnection.getReceivers()[0])===null||s===void 0||(s=s.transport)===null||s===void 0?void 0:s.state)!==null&&r!==void 0?r:null}get localCodecs(){return[]}set isInRestartIce(r){this._isInRestartIce=r}get isInRestartIce(){return this._isInRestartIce}constructor(r,s,o){super(r,s),$(this,"direction",void 0),$(this,"name",void 0),$(this,"store",void 0),$(this,"spec",void 0),$(this,"peerConnection",void 0),$(this,"initialOffer",void 0),$(this,"transport",void 0),$(this,"statsFilter",void 0),$(this,"localCandidateCount",0),$(this,"_isInRestartIce",!1),$(this,"mutex",void 0),$(this,"onLocalCandidate",void 0),$(this,"remoteSDP",void 0),$(this,"pendingCandidates",[]),$(this,"localCapabilities",void 0),$(this,"isReady",!1),$(this,"restartCnt",0),$(this,"curTurnServerIndex",0),this.store=s,this.spec=r,this.mutex=new ks("P2PConnection-mutex",s.clientId),this.peerConnection=new RTCPeerConnection(CS.resolvePCConfiguration(r,s.p2pTransport),{optional:[{googDscp:!0}]}),this.direction=o??To.SEND_ONLY,this.name=this.direction===To.SEND_ONLY?"sendP2PConnection":"recvP2PConnection",this.statsFilter=nx(this.peerConnection,re("STATS_UPDATE_INTERVAL"),void 0,Dr()?1200:void 0),this.bindPCEvents(),this.bindStatsEvents(),this.store.p2pId=this.store.p2pId+1}async establish(r){try{const s=await hH();if(this.localCapabilities=vP(s),r){const{sdp:o}=r,c=$_e(r,K_e),u=function(){const S={audioCodecs:[],videoCodecs:[],audioExtensions:[],videoExtensions:[]},R=PT(arguments.length>2?arguments[2]:void 0,arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},"sendonly"),P={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},k={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},z={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]};if(mu(R,S,"videoExtensions",P,k,z),mu(R,S,"videoCodecs",P,k,z),mu(R,S,"audioExtensions",P,k,z),mu(R,S,"audioCodecs",P,k,z),re("RAISE_H264_BASELINE_PRIORITY")){const U=z.videoCodecs.findIndex(F=>F.rtpMap&&F.rtpMap.encodingName.toLocaleLowerCase()==="h264"&&F.fmtp&&F.fmtp.parameters["profile-level-id"]==="42001f");if(U!==-1){const F=z.videoCodecs.findIndex(q=>q.rtpMap&&q.rtpMap.encodingName.toLocaleLowerCase()==="h264");if(F<U){L.debug("raising H264 baseline profile priority");const q=z.videoCodecs[U];z.videoCodecs.splice(U,1),z.videoCodecs.splice(F,0,q)}F!==-1&&re("FILTER_SEND_H264_BASELINE")&&(P.videoCodecs=P.videoCodecs.filter(q=>!(q.rtpMap&&q.rtpMap.encodingName.toLocaleLowerCase()==="h264"&&q.fmtp&&q.fmtp.parameters["profile-level-id"]!=="42001f")))}}return{send:P,recv:k,sendrecv:z}}({},{},o);this.remoteSDP=new v$({remoteIceParameters:c.iceParameters,remoteDtlsParameters:c.dtlsParameters,candidates:[],remoteRTPCapabilities:u,localCapabilities:this.localCapabilities,direction:this.direction,setup:"actpass",videoCodec:this.store.codec,audioCodec:this.store.audioCodec}),await this.setRemoteDescription({type:"offer",sdp:this.remoteSDP.toString()}),this.isReady=!0;const h=await this.peerConnection.createAnswer();if(!h.sdp)throw new Error("Cannot get answer sdp when trying to establish PeerConnection.");const m=Lm(h.sdp);await this.peerConnection.setLocalDescription(h);const _=await fH({},{},h.sdp);this.localCapabilities=vP(_);const E=this.peerConnection.getTransceivers()[0];return E!=null&&E.receiver&&E.receiver.transport&&this.tryBindTransportEvents(E.receiver.transport),Hm(Hm({},m),{},{sdp:h.sdp})}{this.peerConnection.addTransceiver("video",{direction:"sendonly"}),this.peerConnection.addTransceiver("audio",{direction:"sendonly"});const o=await this.peerConnection.createOffer();if(!o.sdp)throw new Error("Cannot get initialOffer.sdp when trying to establish PeerConnection.");const c=Lm(o.sdp);return this.initialOffer=o,Hm(Hm({},c),{},{sdp:o.sdp})}}catch(s){throw new Le(X.GET_LOCAL_CONNECTION_PARAMS_FAILED,s.toString())}}async connect(r){try{if(!this.initialOffer)throw new Error("Cannot establish P2PConnection without initial offer.");await this.peerConnection.setLocalDescription(this.initialOffer);const{sdp:s,iceParameters:o,dtlsParameters:c}=r,u=await fH({},{},s);this.remoteSDP=new v$({remoteIceParameters:o,remoteDtlsParameters:c,candidates:[],remoteRTPCapabilities:u,localCapabilities:this.localCapabilities,direction:this.direction,setup:"active",videoCodec:this.store.codec,audioCodec:this.store.audioCodec}),await this.setRemoteDescription({type:"answer",sdp:this.remoteSDP.toString()});const h=this.peerConnection.getTransceivers()[0];h!=null&&h.sender&&h.sender.transport&&this.tryBindTransportEvents(h.sender.transport)}catch(s){throw new Le(X.EXCHANGE_SDP_FAILED,"P2PConnection.connect failed; ".concat(s.toString()))}}async addRemoteCandidate(r){try{r&&this.pendingCandidates.push(r),this.peerConnection.remoteDescription&&this.isReady&&(this.pendingCandidates.forEach(s=>{this.peerConnection.addIceCandidate(s)}),this.pendingCandidates=[])}catch(s){throw new Le(X.ADD_CANDIDATE_FAILED,"P2PConnection.addRemoteCandidate failed; ".concat(s.toString()))}}send(r,s,o){var c=this;return _l(function*(){const u=yield wn(c.mutex.lock("From P2PConnection.send"));try{if(!c.remoteSDP)throw new Error("Cannot call P2PConnection.send before remote SDP created");const h=[],m=c.remoteSDP.receive(r,s,o);r.forEach((F,q)=>{if(m[q].needCreateTransceiver){const Y=c.peerConnection.addTransceiver(F._mediaStreamTrack,{direction:"sendonly"});h.push(Y),F._updateRtpTransceiver(Y)}else{const Y=c.peerConnection.getTransceivers().find(le=>le.mid===m[q].mid);if(!Y)throw new Error("cannot find transceiver when sendPeerconnection send, mid is ".concat(m[q].mid));h.push(Y),F._updateRtpTransceiver(Y)}}),Dr()&&re("SIMULCAST")===!0&&(yield wn(c.applySimulcastForFirefox(h,r)));const _=m.map(F=>F.mid),E=yield wn(c.peerConnection.createOffer()),S=c.mungSendOfferSDP(E.sdp,r,_),R=Ca(S),P=_.map(F=>{const q=R.mediaDescriptions.find(Y=>Y.attributes.mid===F);if(!q)throw new Error("Cannot extract ssrc from mediaDescription.");return aH(q,re("USE_PUB_RTX"))}),k=h.map((F,q)=>{const Y=_[q];return{localSSRC:P[q],id:Y}});yield wn(c.peerConnection.setLocalDescription({type:"offer",sdp:S}));try{yield k}catch(F){const q=c.remoteSDP.toString();throw yield wn(c.peerConnection.setLocalDescription({type:"offer",sdp:S})),yield wn(c.peerConnection.setRemoteDescription({type:"answer",sdp:q})),yield wn(c.stopSending(_,!0)),F}yield wn(c.applySimulcastEncodings(h,r)),yield wn(c.applySendEncodings(h,r));const z=c.remoteSDP.toString(),U=c.logSDPExchange(S,"offer","local","send");return U==null||U(z),yield wn(c.setRemoteDescription({type:"answer",sdp:z})),h.map((F,q)=>{const Y=_[q];return{localSSRC:P[q],id:Y}})}catch(h){throw h instanceof Le?h:new Le(X.EXCHANGE_SDP_FAILED,"P2PConnection.send failed; ".concat(h.toString()))}finally{u()}})()}async stopSending(r,s){const o=s?void 0:await this.mutex.lock("From P2PConnection.stopSending");try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopSending before remote SDP created");const c=this.peerConnection.getTransceivers().filter(_=>r.indexOf(_.mid)!==-1);if(c.length!==r.length)throw new Error("Transceivers' length (".concat(c.length,") doesn't match mids' length (").concat(r.length,") when trying to call P2PConnection.stopSending."));c.map(_=>{var E;_.direction="inactive",(E=_.stop)===null||E===void 0||E.call(_)});const u=await this.peerConnection.createOffer(),h=this.logSDPExchange(u.sdp||"","offer","local","stopSending");await this.peerConnection.setLocalDescription(u),this.remoteSDP.stopReceiving(r);const m=this.remoteSDP.toString();h==null||h(m),await this.setRemoteDescription({type:"answer",sdp:m})}catch(c){throw new Le(X.EXCHANGE_SDP_FAILED,"P2PConnection.stopSending failed; ".concat(c.toString()))}finally{o&&o()}}async receive(r,s,o,c){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.receive ".concat(r," before remoteSDP created."));const{mid:u,needExchangeSDP:h}=this.remoteSDP.send(r,s,o,c);if(h){const _=this.remoteSDP.toString(),E=this.logSDPExchange(_,"offer","remote","receive");await this.setRemoteDescription({type:"offer",sdp:_});const S=await this.peerConnection.createAnswer(),R=this.mungReceiveAnswerSDP(S.sdp,u,r);E==null||E(R||""),await this.peerConnection.setLocalDescription({type:"answer",sdp:R}),L.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(r," by exchanging SDP."))}else L.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(r," no need to exchange SDP."));const m=this.peerConnection.getTransceivers().find(_=>_.mid===u);if(!m||m.mid===null)throw new Error("Cannot get transceiver after setLocalDescription.");return{track:m.receiver.track,mid:m.mid,transceiver:m}}catch(u){throw new Le(X.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(u.toString()))}}async mockReceive(r,s,o,c){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.receive ".concat(r," before remoteSDP created."));const{mid:u,needExchangeSDP:h}=this.remoteSDP.send(r,s,o,c);if(h){const m=this.remoteSDP.toString(),_=this.logSDPExchange(m,"offer","remote","receive");await this.setRemoteDescription({type:"offer",sdp:m});const E=await this.peerConnection.createAnswer(),S=this.mungReceiveAnswerSDP(E.sdp,u,r);_==null||_(S||""),await this.peerConnection.setLocalDescription({type:"answer",sdp:S}),L.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(r," by exchanging SDP."))}else L.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(r," no need to exchange SDP."))}catch(u){throw new Le(X.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(u.toString()))}}async stopReceiving(r){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopReceiving before remote SDP created.");this.remoteSDP.stopSending(r);const s=this.remoteSDP.toString(),o=this.logSDPExchange(s,"offer","remote","stopReceiving");await this.setRemoteDescription({type:"offer",sdp:s});const c=await this.peerConnection.createAnswer();o==null||o(c.sdp||""),await this.peerConnection.setLocalDescription(c)}catch(s){throw new Le(X.EXCHANGE_SDP_FAILED,"P2PConnection stopReceiving failed; ".concat(s.toString()))}}async restartICE(r){try{if(this.store.p2pTransport===x_.Auto&&(this.store.p2pTransport=x_.SdRtn,kn().supportPCSetConfiguration&&this.peerConnection.setConfiguration(CS.resolvePCConfiguration(this.spec,this.store.p2pTransport))),this.restartCnt>3&&(this.restartCnt=0,kn().supportPCSetConfiguration&&this.peerConnection.setConfiguration(CS.resolvePCConfiguration(this.spec,this.store.p2pTransport,++this.curTurnServerIndex))),!r){this.restartCnt++,this.isReady=!1;const s=await this.peerConnection.createOffer({iceRestart:!0});if(!s.sdp)throw new Error("Cannot restartICE because restart offer SDP does not exist.");const{iceParameters:o}=Lm(s.sdp);return this.store.descriptionStart(),this.direction===To.SEND_ONLY&&await this.peerConnection.setLocalDescription(s),o}if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopReceiving before remote SDP created.");if(this.remoteSDP.restartICE(r),this.store.descriptionStart(),this.direction===To.RECEIVE_ONLY){this.restartCnt++,await this.setRemoteDescription({type:"offer",sdp:this.remoteSDP.toString()});const s=await this.peerConnection.createAnswer();if(!s.sdp)throw new Error("Cannot get answer sdp when trying to iceRestart.");const{iceParameters:o}=Lm(s.sdp);return await this.peerConnection.setLocalDescription(s),o}await this.setRemoteDescription({type:"answer",sdp:this.remoteSDP.toString()}),this.isReady=!0}catch(s){throw new Le(X.EXCHANGE_SDP_FAILED,"P2PConnection stopReceiving failed; ".concat(s.toString()))}}close(){var r;this.peerConnection.close(),this.peerConnection.onicecandidate=null,(r=this.onConnectionStateChange)===null||r===void 0||r.call(this,"closed"),this.tryUnbindTransportEvents(),this.unbindPCEvents(),this.unbindStatsEvents(),this.transport=void 0,this.statsFilter.destroy()}getStats(){return this.statsFilter.getStats()}getRemoteVideoIsReady(r){return this.statsFilter.getVideoIsReady(r)}async updateEncoderConfig(r,s){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.updateEncoderConfig before remote SDP created.");const o=await this.peerConnection.createOffer(),c=this.mungSendOfferSDP(o.sdp,[s],[r]);this.remoteSDP.updateRecvMedia(r,s);const u=this.remoteSDP.toString(),h=this.logSDPExchange(c,"offer","local","updateEncoderConfig");await this.peerConnection.setLocalDescription({type:"offer",sdp:c}),h==null||h(u),await this.peerConnection.setRemoteDescription({type:"answer",sdp:u})}catch(o){throw new Le(X.EXCHANGE_SDP_FAILED,o.toString())}}async updateSendParameters(r,s){const o=this.peerConnection.getTransceivers().filter(c=>c.mid===r);o.length===1&&(this.isVP8Simulcast(s)?Dr()||await this.applySimulcastEncodings(o,[s]):await this.applySendEncodings(o,[s]))}setStatsRemoteVideoIsReady(r,s){this.statsFilter.setVideoIsReady2(r,s)}async replaceTrack(r,s){const o=this.peerConnection.getTransceivers().find(c=>c.mid===s);o&&await o.sender.replaceTrack(r._mediaStreamTrack)}async getSelectedCandidatePair(){const r=this.peerConnection.getReceivers();if(r.length>0&&r[0].transport&&r[0].transport.iceTransport&&r[0].transport.iceTransport.getSelectedCandidatePair&&r[0].transport.iceTransport.getSelectedCandidatePair()){const s=r[0].transport.iceTransport,{local:o,remote:c}=s.getSelectedCandidatePair();return{local:Hm(Hm({},_h),{},{candidateType:o.type,protocol:o.protocol,address:o.address,port:o.port}),remote:Hm(Hm({},_h),{},{candidateType:c.type,protocol:c.protocol,address:c.address,port:c.port})}}return this.statsFilter.getSelectedCandidatePair()}bindPCEvents(){this.peerConnection.oniceconnectionstatechange=()=>{var r,s;ot(r=["connected","completed"]).call(r,this.peerConnection.iceConnectionState)&&(this.isReady=!1),(s=this.onICEConnectionStateChange)===null||s===void 0||s.call(this,this.peerConnection.iceConnectionState)},this.peerConnection.onconnectionstatechange=()=>{var r;this.peerConnection.connectionState==="connected"&&(this.restartCnt=0),(r=this.onConnectionStateChange)===null||r===void 0||r.call(this,this.peerConnection.connectionState)},this.startICECandidate()}startICECandidate(){this.peerConnection.onicecandidate||(this.localCandidateCount=0,this.peerConnection.onicecandidate=r=>{if(r.candidate){var s;r.candidate.candidate&&((s=this.onLocalCandidate)===null||s===void 0||s.call(this,r.candidate.toJSON())),this.localCandidateCount+=1}else L.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] local candidate count"),this.localCandidateCount)})}unbindPCEvents(){this.peerConnection.oniceconnectionstatechange=null,this.peerConnection.onconnectionstatechange=null,this.peerConnection.onsignalingstatechange=null,this.peerConnection.onicecandidateerror=null,this.peerConnection.onicecandidate=null,this.peerConnection.ontrack=null}static resolvePCConfiguration(r,s){let o=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0;const c={iceServers:[]};var u;return r.iceServers?c.iceServers=r.iceServers:r.turnServer&&r.turnServer.mode!=="off"&&(gT(r.turnServer.servers)?c.iceServers=r.turnServer.servers:(c.iceServers&&c.iceServers.push(...CS.turnServerConfigToIceServers(r.turnServer.servers,s,o)),re("USE_TURN_SERVER_OF_GATEWAY")&&c.iceServers&&r.turnServer.serversFromGateway&&c.iceServers.push(...CS.turnServerConfigToIceServers(r.turnServer.serversFromGateway,s,o)),ot(u=[x_.Relay,x_.SdRtn]).call(u,s)&&(c.iceTransportPolicy="relay"),re("FORCE_TURN_TCP")?c.iceTransportPolicy="relay":r.turnServer.servers.concat(r.turnServer.serversFromGateway||[]).forEach(h=>{h.forceturn&&(c.iceTransportPolicy="relay")}))),re("ENABLE_ENCODED_TRANSFORM")&&kn().supportWebRTCEncodedTransform&&(c.encodedInsertableStreams=!0),L.debug("P2PConnection p2pTransport is ".concat(s)),c}static turnServerConfigToIceServers(r,s){let o=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0;const c=[],u=r.filter(m=>m.tcpport);L.debug("P2PConnection turnServers is ".concat(u,", current index is ").concat(o));const h=u.length>o?u[o]:u[0];switch(s){case x_.SdRtn:const m=r.filter(E=>{var S;return ot(S=E.username).call(S,"glb:")&&E.turnServerURL==E.turnServerURL}),_=m.length>o?m[o]:m[0];_&&(c.push({username:_.username,credential:_.password,credentialType:"password",urls:"turn:".concat(Nm(_.turnServerURL),":").concat(_.tcpport,"?transport=udp")}),c.push({username:_.username,credential:_.password,credentialType:"password",urls:"turns:".concat(Nm(_.turnServerURL),":").concat(_.tcpport,"?transport=tcp")}));break;case x_.Relay:h&&(c.push({username:h.username,credential:h.password,credentialType:"password",urls:"turn:".concat(h.turnServerURL,":").concat(h.tcpport,"?transport=udp")}),c.push({username:h.username,credential:h.password,credentialType:"password",urls:"turns:".concat(Nm(h.turnServerURL),":").concat(h.tcpport,"?transport=tcp")}));break;default:h&&(c.push({username:h.username,credential:h.password,credentialType:"password",urls:"turn:".concat(h.turnServerURL,":").concat(h.tcpport,"?transport=udp")}),c.push({username:h.username,credential:h.password,credentialType:"password",urls:"turns:".concat(Nm(h.turnServerURL),":").concat(h.tcpport,"?transport=tcp")}),c.push({username:h.username,credential:h.password,credentialType:"password",urls:"stun:".concat(h.turnServerURL,":").concat(h.tcpport)}))}return c}tryBindTransportEvents(r){if(r){this.transport=r,r.onstatechange=()=>{var o;r!=null&&r.state&&((o=this.onDTLSTransportStateChange)===null||o===void 0||o.call(this,r.state))},r.onerror=o=>{var c;(c=this.onDTLSTransportError)===null||c===void 0||c.call(this,"error"in o?o.error:o)};const s=r.iceTransport;s&&(s.onstatechange=()=>{const o=r==null?void 0:r.iceTransport.state;var c;o&&((c=this.onICETransportStateChange)===null||c===void 0||c.call(this,o))},s.getSelectedCandidatePair&&(s.onselectedcandidatepairchange=()=>{if(s.getSelectedCandidatePair()){const{local:o,remote:c}=s.getSelectedCandidatePair();L.info("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] selectedcandidatepairchange: local ").concat(JSON.stringify({candidateType:o.type,protocol:o.protocol}),", remote ").concat(JSON.stringify({candidateType:c.type,protocol:c.protocol,address:c.address,port:c.port})," )"))}}))}}tryUnbindTransportEvents(){this.transport&&(this.transport.onstatechange=null,this.transport.onerror=null,this.transport.iceTransport&&(this.transport.iceTransport.onstatechange=null))}async updateRtpSenderEncodings(r,s){var o;if(s||(s=this.peerConnection.getSenders().find(S=>S.track===r._mediaStreamTrack)),!s)return L.warn("[".concat(r.getTrackId(),"] no rtpSender found}"));if(this.isVP8Simulcast(r))return L.warn("[updateRtpSenderEncodings] Track is VP8 simulcast, please apply simulcast encodings");if(!kn().supportSetRtpSenderParameters)return L.warn("[updateRtpSenderEncodings] Browser not support set rtp-sender parameters");const c={},u={};switch(r._optimizationMode){case"motion":c.degradationPreference="maintain-framerate";break;case"detail":c.degradationPreference="maintain-resolution";break;default:c.degradationPreference="balanced"}if(r._encoderConfig){var h;const{bitrateMax:S,frameRate:R,scaleResolutionDownBy:P}=r._encoderConfig;S&&(u.maxBitrate=1e3*S),ot(h=r._hints).call(h,ar.LOW_STREAM)&&(R&&(u.maxFramerate=rc(R)),P&&P>=1&&(u.scaleResolutionDownBy=P))}if(re("DSCP_TYPE")&&Kf()){var m;const S=re("DSCP_TYPE");ot(m=["very-low","low","medium","high"]).call(m,S)&&(u.networkPriority=S)}const _=s.getParameters(),E=(o=_.encodings)===null||o===void 0?void 0:o[0];Dr()&&!E&&(c.encodings=[u]),E&&Object.assign(E,u),Object.assign(_,c),L.debug("[".concat(r.getTrackId(),"] updateRtpSenderEncodings: ").concat(JSON.stringify(_.encodings))),await s.setParameters(_)}async applySendEncodings(r,s){try{if(!kn().supportSetRtpSenderParameters||r.length!==s.length)return;for(let o=0;o<r.length;o++){const c=r[o],u=s[o];u instanceof _r&&!this.isVP8Simulcast(u)&&await this.updateRtpSenderEncodings(u,c.sender)}}catch{L.debug("[".concat(this.store.clientId,"] Apply RTPSendEncodings failed."))}}mungSendOfferSDP(r,s,o){const c=Ca(r);return s.forEach((u,h)=>{const m=o[h],_=c.mediaDescriptions.find(E=>E.attributes.mid===m);_&&(Zv(_,u),dH(_,u,this.store.codec))}),Pm(c)}bindStatsEvents(){this.statsFilter.onFirstAudioReceived=r=>{var s;(s=this.onFirstAudioReceived)===null||s===void 0||s.call(this,r)},this.statsFilter.onFirstVideoReceived=r=>{var s;(s=this.onFirstVideoReceived)===null||s===void 0||s.call(this,r)},this.statsFilter.onFirstAudioDecoded=r=>{var s;(s=this.onFirstAudioDecoded)===null||s===void 0||s.call(this,r)},this.statsFilter.onFirstVideoDecoded=(r,s,o)=>{var c;(c=this.onFirstVideoDecoded)===null||c===void 0||c.call(this,r,s,o)},this.statsFilter.onSelectedLocalCandidateChanged=(r,s)=>{var o;(o=this.onSelectedLocalCandidateChanged)===null||o===void 0||o.call(this,r,s)},this.statsFilter.onSelectedRemoteCandidateChanged=(r,s)=>{var o;(o=this.onSelectedRemoteCandidateChanged)===null||o===void 0||o.call(this,r,s)},this.statsFilter.onFirstVideoDecodedTimeout=r=>{var s;(s=this.onFirstVideoDecodedTimeout)===null||s===void 0||s.call(this,r)}}unbindStatsEvents(){this.statsFilter.onFirstAudioReceived=void 0,this.statsFilter.onFirstVideoReceived=void 0,this.statsFilter.onFirstAudioDecoded=void 0,this.statsFilter.onFirstVideoDecoded=void 0,this.statsFilter.onSelectedLocalCandidateChanged=void 0,this.statsFilter.onSelectedRemoteCandidateChanged=void 0,this.statsFilter.onFirstVideoDecodedTimeout=void 0}async applySimulcastForFirefox(r,s){if(r.length===s.length)for(let _=0;_<r.length;_++){var o,c,u,h,m;const E=r[_],S=s[_];if(S instanceof _r&&!ot(o=S._hints).call(o,ar.LOW_STREAM)&&(c=S._encoderConfig)!==null&&c!==void 0&&c.bitrateMax&&((u=S._encoderConfig)===null||u===void 0?void 0:u.bitrateMax)>200&&(h=S._scalabilityMode)!==null&&h!==void 0&&h.numSpatialLayers&&((m=S._scalabilityMode)===null||m===void 0?void 0:m.numSpatialLayers)>1&&this.store.codec==="vp8"){const R={},P={high:1e3*(S._encoderConfig.bitrateMax-50),medium:5e4};R.encodings=[{rid:"m",active:!0,maxBitrate:P.medium,scaleResolutionDownBy:4},{rid:"h",active:!0,maxBitrate:P.high}];const k=E.sender.getParameters();await E.sender.setParameters(Object.assign(k,R))}}}async applySimulcastEncodings(r,s){if(!Dr()&&r.length===s.length)for(let o=0;o<r.length;o++){const c=s[o];if(c instanceof _r&&this.isVP8Simulcast(c)){const u=r[o],h={},m={high:1e3*(c._encoderConfig.bitrateMax-50),medium:5e4};h.encodings=[{active:!0,adaptivePtime:!1,networkPriority:"high",priority:"high",maxBitrate:m.high},{active:!0,adaptivePtime:!1,networkPriority:"low",priority:"low",maxBitrate:m.medium,scaleResolutionDownBy:4}];const _=u.sender.getParameters();await u.sender.setParameters(Object.assign(_,h))}}}isVP8Simulcast(r){var s,o,c,u,h;return!!(r instanceof _r&&re("SIMULCAST")&&this.store.codec==="vp8"&&!ot(s=r._hints).call(s,ar.LOW_STREAM)&&(o=r._encoderConfig)!==null&&o!==void 0&&o.bitrateMax&&((c=r._encoderConfig)===null||c===void 0?void 0:c.bitrateMax)>200&&(u=r._scalabilityMode)!==null&&u!==void 0&&u.numSpatialLayers&&((h=r._scalabilityMode)===null||h===void 0?void 0:h.numSpatialLayers)>1)}logSDPExchange(r,s,o,c){if(re("SDP_LOGGING"))return L.upload("[".concat(this.store.clientId,"] exchanging ").concat(o," ").concat(s," SDP during P2PConnection.").concat(c,`
`),r),s==="offer"?u=>{this.logSDPExchange(u,"answer",o==="local"?"remote":"local",c)}:void 0}async muteLocal(r){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.muteLocal before remote SDP created.");const s=this.peerConnection.getTransceivers().filter(h=>h.mid&&r.indexOf(h.mid)!==-1);if(s.length!==r.length)throw new Error("Transceivers' length doesn't match mids' length.");s.map(h=>{h.direction="inactive"});const o=await this.peerConnection.createOffer(),c=this.logSDPExchange(o.sdp||"","offer","local","muteLocal");await this.peerConnection.setLocalDescription(o),this.remoteSDP.muteRemote(r);const u=this.remoteSDP.toString();c==null||c(u),await this.setRemoteDescription({type:"answer",sdp:u})}catch(s){throw new Le(X.EXCHANGE_SDP_FAILED,"P2PConnection.muteLocal failed; ".concat(s.toString()))}}async unmuteLocal(r){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.unmuteLocal before remote SDP created.");const s=this.peerConnection.getTransceivers().filter(h=>h.mid&&r.indexOf(h.mid)!==-1);if(s.length!==r.length)throw new Error("Transceivers' length doesn't match mids' length.");s.map(async h=>{h.direction="sendonly"});const o=await this.peerConnection.createOffer(),c=this.logSDPExchange(o.sdp||"","offer","local","unmuteLocal");await this.peerConnection.setLocalDescription(o),this.remoteSDP.unmuteRemote(r);const u=this.remoteSDP.toString();c==null||c(u),await this.setRemoteDescription({type:"answer",sdp:u})}catch(s){throw new Le(X.EXCHANGE_SDP_FAILED,"P2PConnection.unmuteLocal failed; ".concat(s.toString()))}}async getRemoteSSRC(r,s){var o,c;if(s=(o=s)!==null&&o!==void 0?o:(c=this.currentRemoteDescription)===null||c===void 0?void 0:c.sdp){var u;const h=(u=Ca(s).mediaDescriptions.find(m=>m.attributes.mid===r))===null||u===void 0?void 0:u.attributes.ssrcs;return h==null?void 0:h[0].ssrcId}}async setRemoteDescription(r){var s;await this.peerConnection.setRemoteDescription(r),ot(s=["connected","completed"]).call(s,this.peerConnection.iceConnectionState)||(this.isReady=!0,this.addRemoteCandidate())}mungReceiveAnswerSDP(r,s,o){const c=Ca(r),u=c.mediaDescriptions.find(h=>h.attributes.mid===s);return u&&o===gt.AUDIO&&u.media.mediaType==="audio"&&eS(u),Pm(c)}},vt(fr.prototype,"establish",[vu],Object.getOwnPropertyDescriptor(fr.prototype,"establish"),fr.prototype),vt(fr.prototype,"connect",[vu],Object.getOwnPropertyDescriptor(fr.prototype,"connect"),fr.prototype),vt(fr.prototype,"receive",[vu],Object.getOwnPropertyDescriptor(fr.prototype,"receive"),fr.prototype),vt(fr.prototype,"mockReceive",[vu],Object.getOwnPropertyDescriptor(fr.prototype,"mockReceive"),fr.prototype),vt(fr.prototype,"stopReceiving",[vu],Object.getOwnPropertyDescriptor(fr.prototype,"stopReceiving"),fr.prototype),vt(fr.prototype,"restartICE",[vu],Object.getOwnPropertyDescriptor(fr.prototype,"restartICE"),fr.prototype),vt(fr.prototype,"close",[vu],Object.getOwnPropertyDescriptor(fr.prototype,"close"),fr.prototype),vt(fr.prototype,"updateEncoderConfig",[vu],Object.getOwnPropertyDescriptor(fr.prototype,"updateEncoderConfig"),fr.prototype),vt(fr.prototype,"updateSendParameters",[vu],Object.getOwnPropertyDescriptor(fr.prototype,"updateSendParameters"),fr.prototype),vt(fr.prototype,"replaceTrack",[vu],Object.getOwnPropertyDescriptor(fr.prototype,"replaceTrack"),fr.prototype),vt(fr.prototype,"muteLocal",[vu],Object.getOwnPropertyDescriptor(fr.prototype,"muteLocal"),fr.prototype),vt(fr.prototype,"unmuteLocal",[vu],Object.getOwnPropertyDescriptor(fr.prototype,"unmuteLocal"),fr.prototype),fr);function vu(t,r,s){const o=t[r];if(typeof o!="function")throw new Error("Cannot use mutex on object property.");return s.value=async function(){const c=this.mutex,u=await c.lock("From P2PConnection.".concat(r));try{for(var h=arguments.length,m=new Array(h),_=0;_<h;_++)m[_]=arguments[_];return await o.apply(this,m)}finally{u()}},s}let Sd=function(t){return t.SEND_ONLY="SEND_ONLY",t.RECEIVE_ONLY="RECEIVE_ONLY",t}({});var T$,w$,R$,C$,I$,A$,P$,O$,k$,N$,D$,Ir;function L$(t,r){var s=Object.keys(t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);r&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(t,c).enumerable})),s.push.apply(s,o)}return s}function nO(t){for(var r=1;r<arguments.length;r++){var s=arguments[r]!=null?arguments[r]:{};r%2?L$(Object(s),!0).forEach(function(o){$(t,o,s[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(s)):L$(Object(s)).forEach(function(o){Object.defineProperty(t,o,Object.getOwnPropertyDescriptor(s,o))})}return t}let q_e=(T$=bd(Sd.SEND_ONLY),w$=bd(Sd.SEND_ONLY),R$=bd(),C$=bd(Sd.RECEIVE_ONLY),I$=bd(Sd.RECEIVE_ONLY),A$=bd(Sd.RECEIVE_ONLY),P$=bd(Sd.RECEIVE_ONLY),O$=bd(Sd.RECEIVE_ONLY),k$=bd(Sd.RECEIVE_ONLY),N$=bd(),D$=bd(Sd.RECEIVE_ONLY),Ir=class extends Pr{get state(){return this._state}set state(t){const r=this._state;this._state=t,this.emit(kt.StateChange,r,this._state)}constructor(t,r){super(),$(this,"isPlanB",!1),$(this,"store",void 0),$(this,"statsUploader",void 0),$(this,"sendConnection",void 0),$(this,"recvConnection",void 0),$(this,"localTrackMap",new Map),$(this,"remoteUserMap",new Map),$(this,"localDataChannels",[]),$(this,"pendingLocalTracks",[]),$(this,"pendingRemoteTracks",[]),$(this,"statsCollector",void 0),$(this,"dtlsFailedCount",0),$(this,"sendMutex",void 0),$(this,"recvMutex",void 0),$(this,"_state",Wn.Disconnected),$(this,"_restartStates",["disconnected","failed"]),$(this,"reconnectInterval",void 0),$(this,"uploadUnplinkStarted",!1),$(this,"uploadDownlinkStarted",!1),$(this,"uplinkStateUploadInterval",void 0),$(this,"downlinkStatsUploadInterval",void 0),$(this,"handleMuteLocalTrack",async(s,o,c)=>{const u=await this.sendMutex.lock("Locking from P2PChannel2.handleMuteLocalTrack");try{if(!this.sendConnection||this.state!==Wn.Connected)return void c(new Le(X.INVALID_OPERATION,"Cannot call P2PChannel2.handleMuteLocalTrack before sendConnection established."));const _=this.filterTobeMutedTracks(s);if(_.length===0)return void o();const E=_.find(k=>k[0]==="videoLowTrack");E&&E[1].track._originMediaStreamTrack.stop(),await this.sendConnection.muteLocal(_.map(k=>{let[,{id:z}]=k;return z}));let S=!1;var h,m;s.trackMediaType==="video"?S=!((h=this.localTrackMap.get($e.LocalAudioTrack))===null||h===void 0||!h.track._muted):S=((m=this.localTrackMap.get($e.LocalVideoTrack))===null||m===void 0?void 0:m.id)===void 0;const R=this.createMuteMessage(_);await sr(this,kt.RequestMuteLocal,R);const P=s.trackMediaType==="video"?km.MUTE_LOCAL_VIDEO:km.MUTE_LOCAL_AUDIO;await sr(this,kt.RequestP2PMuteLocal,{action:P,message:R,isMuteAll:S}),o()}catch(_){c(_)}finally{u()}}),$(this,"handleUnmuteLocalTrack",async(s,o,c)=>{const u=await this.sendMutex.lock("Locking from P2PChannel2.handleUnmuteLocalTrack");try{if(!this.sendConnection||this.state!==Wn.Connected)return void c(new Le(X.INVALID_OPERATION,"Cannot call P2PChannel2.handleUnmuteLocalTrack before sendConnection established."));const h=this.filterTobeUnmutedTracks(s);if(h.length===0)return void o();await this.sendConnection.unmuteLocal(h.map(E=>{let[,{id:S}]=E;return S}));const m=this.createUnmuteMessage(h),_=s.trackMediaType==="video"?km.UNMUTE_LOCAL_VIDEO:km.UNMUTE_LOCAL_AUDIO;await sr(this,kt.RequestP2PMuteLocal,{action:_,message:m}),o()}catch(h){c(h)}finally{u()}}),$(this,"handleUpdateVideoEncoder",async(s,o,c,u)=>{let h;typeof u=="boolean"&&u||(h=await this.sendMutex.lock("Locking from P2PChannel2.handleUpdateVideoEncoder"));try{const _=this.localTrackMap.get($e.LocalVideoTrack);if(!this.sendConnection||!_||_.track!==s||this.state!==Wn.Connected)return void o();const{id:E,track:S}=_;E&&(await this.sendConnection.updateSendParameters(E,S),await this.sendConnection.updateEncoderConfig(E,S),this.emit(kt.UpdateVideoEncoder,S)),o()}catch(_){c(_)}finally{var m;(m=h)===null||m===void 0||m()}}),$(this,"handleUpdateVideoSendParameters",async(s,o,c)=>{const u=await this.sendMutex.lock("Locking from P2PChannel2.handleUpdateVideoSendParameters");try{const h=this.localTrackMap.get($e.LocalVideoTrack);if(!this.sendConnection||!h||h.track!==s||this.state!==Wn.Connected)return void o();const{id:m,track:_}=h;m&&await this.sendConnection.updateSendParameters(m,_),o()}catch(h){c(h)}finally{u()}}),$(this,"handleReplaceTrack",async(s,o,c,u)=>{let h;L.debug("[".concat(this.store.clientId,"] P2PChannel2 handleReplaceTrack for [track-id-").concat(s.getTrackId(),"]")),typeof u=="boolean"&&u||(h=await this.sendMutex.lock("From P2PChannel2.handleReplaceTrack"));try{var m;const E=Array.from(this.localTrackMap.entries()).find(S=>{let[,{track:R}]=S;return s===R});if(!this.sendConnection||!E||E[1].id===void 0||this.state!==Wn.Connected)return void o();if(await((m=this.sendConnection)===null||m===void 0?void 0:m.replaceTrack(s,E[1].id)),E[0]===$e.LocalVideoTrack&&kn().supportDualStreamEncoding){const S=this.localTrackMap.get($e.LocalVideoLowTrack);if(S){const R=s._mediaStreamTrack.clone();S.track._originMediaStreamTrack.stop(),S.track._mediaStreamTrack=R,S.track._originMediaStreamTrack=R,await new lt((P,k)=>{this.handleReplaceTrack(S.track,P,k,!0)})}}o()}catch(E){c(E)}finally{var _;(_=h)===null||_===void 0||_()}}),$(this,"handleGetLocalVideoStats",s=>{s(this.statsCollector.getLocalVideoTrackStats())}),$(this,"handleGetLocalAudioStats",s=>{s(this.statsCollector.getLocalAudioTrackStats())}),$(this,"handleGetRemoteVideoStats",s=>this.statsCollector.getRemoteVideoTrackStats(s.uid)[s.uid]),$(this,"handleGetRemoteAudioStats",s=>this.statsCollector.getRemoteAudioTrackStats(s.uid)[s.uid]),this.store=t,this.statsCollector=r,this.statsCollector.addP2PChannel(this),this.statsUploader=new QH(t),this.bindStatsUploaderEvents(),this.sendMutex=new ks("P2PChannel2-send-mutex",t.clientId),this.recvMutex=new ks("P2PChannel2-recv-mutex",t.clientId),this.reconnectInterval=window.setInterval(()=>{[this.sendConnection,this.recvConnection].forEach(s=>{s&&(s.iceConnectionState!=="disconnected"&&s.iceConnectionState!=="failed"||this.handleDisconnect(s.direction))})},re("ICE_RESTART_INTERVAL"))}async startP2PConnection(t,r){throw new Le(X.NOT_SUPPORTED,"p2p mode does not support startP2PConnection.")}async connect(t){throw new Le(X.NOT_SUPPORTED,"p2p mode does not support connect.")}async startP2P(t,r){let s;try{if(r){this.recvConnection&&(L.warning("[".concat(this.store.clientId,"] P2PChannel.startP2P reset recvConnection.")),this.recvConnection.close(),this.unbindConnectionEvents(this.recvConnection)),s=await this.recvMutex.lock("From P2PChannel.startP2P"),this.recvConnection=new b$(t,this.store,To.RECEIVE_ONLY),this.bindConnectionEvents(this.recvConnection);const o=await this.recvConnection.establish(r);return{iceParameters:o.iceParameters,dtlsParameters:o.dtlsParameters,sdp:o.sdp}}{this.state=Wn.New,this.sendConnection&&(L.warning("[".concat(this.store.clientId,"] P2PChannel.startP2P reset sendConnection.")),this.sendConnection.close(),this.unbindConnectionEvents(this.sendConnection)),s=await this.sendMutex.lock("From P2PChannel.startP2P"),this.sendConnection=new b$(t,this.store),this.store.peerConnectionStart(),this.bindConnectionEvents(this.sendConnection);const o=await this.sendConnection.establish();return{iceParameters:o.iceParameters,dtlsParameters:o.dtlsParameters,sdp:o.sdp}}}finally{s&&s()}}async p2pConnect(t){if(!this.sendConnection)throw new Le(X.UNEXPECTED_ERROR,"Cannot P2PChannel2.p2pConnect before P2PChannel2.startP2PConnection .");this.store.peerConnectionStart(),await this.sendConnection.connect(t),this.statsUploader.startUploadTransportStats(),this.statsUploader.startUploadExtensionUsageStats(),this.state=Wn.Connected}async addRemoteCandidate(t,r){if(r===To.RECEIVE_ONLY){if(!this.sendConnection)throw new Le(X.UNEXPECTED_ERROR,"Cannot P2PChannel2.connect before P2PChannel2.addRemoteCandidate .");await this.sendConnection.addRemoteCandidate(t)}else{if(!this.recvConnection)throw new Le(X.UNEXPECTED_ERROR,"Cannot P2PChannel2.connect before P2PChannel2.addRemoteCandidate .");await this.recvConnection.addRemoteCandidate(t)}}publish(t,r,s){var o=this;return _l(function*(){const c=yield wn(o.sendMutex.lock("From P2PChannel.publish"));try{if(!o.sendConnection||o.state!==Wn.Connected){o.throwIfTrackTypeNotMatch(t);const E=t.filter(S=>o.pendingLocalTracks.indexOf(S)===-1);return void(o.pendingLocalTracks=o.pendingLocalTracks.concat(E))}o.store.pubId=o.store.pubId+1,Ls.markPublishStart(o.store.clientId,o.store.pubId);const u=o.filterTobePublishedTracks(t,r,s);if(u.length===0)return void(yield wn(o.tryToUnmuteAudio(t)));u.forEach(E=>{let{track:S,type:R}=E;const P=Date.now();o.store.publish(S.getTrackId(),R===$e.LocalAudioTrack?"audio":"video",P)}),o.bindLocalTrackEvents(u);const h=yield wn(o.sendConnection.send(u.map(E=>{let{track:S}=E;return S}),o.store.codec,o.store.audioCodec)),m=(yield wn(h.next())).value,_=o.createGatewayPublishMessage(u,m);try{yield _}catch(E){throw h.throw(E),(E==null?void 0:E.code)===X.WS_ABORT&&u.forEach(S=>{let{track:R}=S;o.pendingLocalTracks.indexOf(R)===-1&&o.pendingLocalTracks.push(R)}),o.unbindLocalTrackEvents(u),E}yield wn(h.next()),u.forEach(E=>{let{type:S}=E;o.statsCollector.addLocalStats(S)}),o.statsUploader.startUploadOutboundStats(),o.assignLocalTracks(u,m),u.forEach(E=>{let{track:S,type:R}=E;const P=Date.now();o.store.publish(S.getTrackId(),R===$e.LocalAudioTrack?"audio":"video",void 0,P)}),o.startUploadUplinkState()}finally{c()}})()}async unpublish(t){if(!this.sendConnection||this.state!==Wn.Connected)return void(t.length===0?this.pendingLocalTracks.length=0:this.pendingLocalTracks=this.pendingLocalTracks.filter(c=>!ot(t).call(t,c)));const r=this.filterTobeUnpublishedTracks(t);if(r.length===0)return;const s=r.find(c=>c[0]==="videoLowTrack");s&&s[1].track.close();const o=this.createGatewayUnpublishMessage(r);if(await this.sendConnection.stopSending(r.map(c=>{let[,{id:u}]=c;return u})),this.withdrawLocalTracks(r),this.unbindLocalTrackEvents(r.map(c=>{let[u,{track:h}]=c;return{type:u,track:h}})),r.forEach(c=>{let[u]=c;this.statsCollector.removeLocalStats(u)}),this.localTrackMap.size===0&&(this.statsUploader.stopUploadOutboundStats(),this.stopUploadUplinkState()),this.sendConnection&&this.state===Wn.Connected)return s&&s[1].track.close(),o;t.forEach(c=>{const u=this.pendingLocalTracks.indexOf(c);u!==-1&&this.pendingLocalTracks.splice(u,1)})}startUploadUplinkState(){if(this.uploadUnplinkStarted)return;this.uploadUnplinkStarted=!0,this.uplinkStateUploadInterval&&window.clearInterval(this.uplinkStateUploadInterval);const t=()=>{const r=[],s=[];Array.from(this.localTrackMap.entries()).forEach(o=>{let[c,{track:u,ssrcs:h}]=o;const m={stream_type:Fme(u,c),ssrcs:h};u._muted||!u._enabled?r.push(m):s.push(m)}),r.length>0&&r.forEach(o=>{sr(this,kt.RequestMuteLocal,[o])}),s.length>0&&s.forEach(o=>{sr(this,kt.RequestUnmuteLocal,[o])})};t(),this.uplinkStateUploadInterval=window.setInterval(()=>{t()},3e3)}stopUploadUplinkState(){this.uploadUnplinkStarted&&(this.uploadUnplinkStarted=!1,this.uplinkStateUploadInterval&&window.clearInterval(this.uplinkStateUploadInterval))}publishLowStream(t){return _l(function*(){throw new Le(X.NOT_SUPPORTED,"p2p mode does not support publishLowStream.")})()}async republish(){this.pendingLocalTracks.length>0&&(L.debug("[".concat(this.store.clientId,"] Emit P2PChannelEvents.RequestRePublish to republish tracks.")),await Ts(this,kt.RequestRePublish,this.pendingLocalTracks),this.emit(kt.MediaReconnectEnd,this.store.uid),this.pendingLocalTracks=[])}async unpublishLowStream(){throw new Le(X.NOT_SUPPORTED,"p2p mode does not support unpublishLowStream.")}async subscribe(t,r,s,o){var c;if(!this.recvConnection)throw new Le(X.INVALID_OPERATION,"Cannot subscribe remote user when recvConnection disconnected.");if((c=this.remoteUserMap.get(t))!==null&&c!==void 0&&c.has(r))return;const{track:u,mid:h,transceiver:m}=await this.recvConnection.receive(r,[{ssrcId:s}],String(t.uid),o);r===gt.AUDIO?(t._audioTrack?t._audioTrack._updateOriginMediaStreamTrack(u):(t._audioTrack=new Hv(u,t.uid,t._uintid,this.store),L.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote audio track: ").concat(t._audioTrack.getTrackId()))),m&&t._audioTrack._updateRtpTransceiver(m),this.bindRemoteTrackEvents(t,t._audioTrack)):(t._videoSSRC=s,t._videoTrack?t._videoTrack._updateOriginMediaStreamTrack(u):(t._videoTrack=new Gv(u,t.uid,t._uintid,this.store),L.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote video track: ").concat(t._videoTrack.getTrackId()))),m&&t._videoTrack._updateRtpTransceiver(m),this.bindRemoteTrackEvents(t,t._videoTrack));const _=this.remoteUserMap.get(t);_?_.set(r,h):this.remoteUserMap.set(t,new Map([[r,h]])),this.statsCollector.addRemoteStats(t.uid),this.statsUploader.startUploadInboundStats(),this.startUploadDownlinkState();const E=this.pendingRemoteTracks.findIndex(S=>{let{user:R,kind:P}=S;return R.uid===t.uid&&r===P});E!==-1&&(this.pendingRemoteTracks.splice(E,1),this.emit(kt.MediaReconnectEnd,t.uid))}async mockSubscribe(t,r,s,o){if(!this.recvConnection)throw new Le(X.INVALID_OPERATION,"Cannot subscribe remote user when recvConnection disconnected.");await this.recvConnection.mockReceive(r,[{ssrcId:s}],String(t.uid),o)}async unsubscribe(t,r,s){const o=this.pendingRemoteTracks.filter(u=>{let{user:h,kind:m}=u;return r!==void 0?h.uid===t.uid&&r===m:h.uid===t.uid});if(o.forEach(u=>{const h=this.pendingRemoteTracks.indexOf(u);this.pendingRemoteTracks.splice(h,1)}),this.recvConnection||s||o.forEach(u=>{let{kind:h}=u;var m;if(h===gt.AUDIO)(m=t._audioTrack)===null||m===void 0||m._destroy(),t._audioTrack=void 0;else if(h===gt.VIDEO){var _;(_=t._videoTrack)===null||_===void 0||_._destroy(),t._videoTrack=void 0}}),!this.recvConnection)return;const c=this.filterTobeUnSubscribedTracks(t,r);c.length!==0&&(await this.recvConnection.stopReceiving(c.map(u=>{let[,{id:h}]=u;return h})),this.withdrawRemoteTracks(c),this.remoteUserMap.size===0&&(this.statsUploader.stopUploadInboundStats(),this.stopUploadDownlinkState()),c.forEach(u=>{let[h,{kind:m}]=u;var _,E;if(m===gt.VIDEO&&h._videoSSRC&&((_=this.recvConnection)===null||_===void 0||_.setStatsRemoteVideoIsReady(h._videoSSRC,!1)),m===gt.VIDEO)this.unbindRemoteTrackEvents(h._videoTrack),s||((E=h._videoTrack)===null||E===void 0||E._destroy(),h._videoTrack=void 0);else if(m===gt.AUDIO){var S;this.unbindRemoteTrackEvents(h._audioTrack),!s&&((S=h._audioTrack)===null||S===void 0||S._destroy(),h._audioTrack=void 0)}}),c.forEach(u=>{let[,{kind:h}]=u;sr(this,kt.RequestP2PMuteRemote,h)}))}startUploadDownlinkState(){if(this.uploadDownlinkStarted)return;this.uploadDownlinkStarted=!0,this.downlinkStatsUploadInterval&&window.clearInterval(this.downlinkStatsUploadInterval);const t=()=>Array.from(this.remoteUserMap.entries()).forEach(r=>{let[,s]=r;[gt.VIDEO,gt.AUDIO].forEach(o=>{s.has(o)?sr(this,kt.RequestP2PUnmuteRemote,o):sr(this,kt.RequestP2PMuteRemote,o)})});t(),this.downlinkStatsUploadInterval=window.setInterval(()=>{t()},3e3)}stopUploadDownlinkState(){this.uploadDownlinkStarted&&(this.uploadDownlinkStarted=!1,this.downlinkStatsUploadInterval&&window.clearInterval(this.downlinkStatsUploadInterval))}getAllDataChannels(){return this.localDataChannels}async massSubscribe(t){throw new Le(X.NOT_SUPPORTED,"p2p mode does not support massSubscribe.")}async massSubscribeNoLock(t){throw new Le(X.NOT_SUPPORTED,"p2p mode does not support massSubscribeNoLock.")}async massUnsubscribe(t){throw new Le(X.NOT_SUPPORTED,"p2p mode does not support massUnsubscribe.")}async massUnsubscribeNoLock(t){throw new Le(X.NOT_SUPPORTED,"p2p mode does not support massUnsubscribeNoLock.")}async muteRemote(t,r){if(!this.recvConnection)return;const s=this.remoteUserMap.get(t);if(!s)return void L.warning("[".concat(this.store.clientId,"] P2PChannel2.muteRemote has no remote user ").concat(t.uid,"."));if(!s.get(r))return void L.warning("[".concat(this.store.clientId,"] P2PChannel2.muteRemote has no remote user ").concat(t.uid," media type ").concat(r,"."));const o=r===gt.VIDEO?t._videoSSRC:t._audioSSRC;o!==void 0&&this.recvConnection.setStatsRemoteVideoIsReady(o,!1)}async unmuteRemote(t,r){return this.unmuteRemoteNoLock(t,r)}async unmuteRemoteNoLock(t,r){if(!this.recvConnection)return;const s=this.remoteUserMap.get(t);if(!s)return void L.warning("[".concat(this.store.clientId,"] P2PChannel2.unmuteRemote has no remote user ").concat(t.uid,"."));s.get(r)||L.warning("[".concat(this.store.clientId,"] P2PChannel2.unmuteRemote has no remote user ").concat(t.uid," media type ").concat(r,"."))}getAllTracks(t){const r=this.localTrackMap.get($e.LocalAudioTrack);if((r==null?void 0:r.track)instanceof Ai){const s=r.track;return Array.from(this.localTrackMap.entries()).filter(o=>{let[c]=o;return c!==$e.LocalAudioTrack}).filter(o=>{let[c]=o;return!(t&&c===$e.LocalVideoLowTrack)}).map(o=>{let[,{track:c}]=o;return c}).concat(s.trackList)}return Array.from(this.localTrackMap.entries()).filter(s=>{let[o]=s;return!(t&&o===$e.LocalVideoLowTrack)}).map(s=>{let[,{track:o}]=s;return o})}reportPublishEvent(t,r,s,o,c){if(t){const h=this.localTrackMap.get($e.LocalAudioTrack),m=o?this.localTrackMap.get($e.LocalVideoLowTrack):this.localTrackMap.get($e.LocalVideoTrack);Rt.publish(this.store.sessionId,{eventElapse:Ls.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:t,ec:r,audioName:h==null?void 0:h.track.getTrackLabel(),videoName:m==null?void 0:m.track.getTrackLabel(),screenshare:(m==null?void 0:m.track._hints.indexOf(ar.SCREEN_TRACK))!==-1,audio:!!h,video:!!m,p2pid:this.store.p2pId,publishRequestid:this.store.pubId,extend:c})}else{var u;s||(s=[]);const h=s.find(_=>_ instanceof Br),m=o?(u=this.localTrackMap.get($e.LocalVideoTrack))===null||u===void 0?void 0:u.track:s.find(_=>_ instanceof _r);Rt.publish(this.store.sessionId,{eventElapse:Ls.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:t,ec:r,audioName:h==null?void 0:h.getTrackLabel(),videoName:m==null?void 0:m.getTrackLabel(),screenshare:(m==null?void 0:m._hints.indexOf(ar.SCREEN_TRACK))!==-1,audio:!!h,video:!!m,p2pid:this.store.p2pId,publishRequestid:this.store.pubId,extend:c})}}reportSubscribeEvent(t,r,s,o){const c=o===gt.VIDEO?s._videoSSRC:s._audioSSRC;c&&Rt.subscribe(this.store.sessionId,{succ:t,ec:r,video:o===gt.VIDEO,audio:o===gt.AUDIO,peerid:s.uid,subscribeRequestid:o===gt.VIDEO?s._videoSSRC:s._audioSSRC,p2pid:this.store.p2pId,eventElapse:Ls.measureFromSubscribeStart(this.store.clientId,c)})}reset(){L.debug("[".concat(this.store.clientId,"] P2PChannel2.reset")),this.sendMutex=new ks("P2PChannel2-send-mutex",this.store.clientId),this.sendMutex=new ks("P2PChannel2-recv-mutex",this.store.clientId),this.sendConnection&&(this.sendConnection.close(),this.unbindConnectionEvents(this.sendConnection),this.sendConnection=void 0),this.recvConnection&&(this.recvConnection.close(),this.unbindConnectionEvents(this.recvConnection),this.recvConnection=void 0),this.statsUploader.stopUploadOutboundStats(),this.statsUploader.stopUploadInboundStats(),this.statsUploader.stopUploadTransportStats(),this.statsUploader.stopUploadExtensionUsageStats(),this.stopUploadUplinkState(),this.stopUploadDownlinkState(),this.unbindLocalTrackEvents(),this.unbindAllRemoteTrackEvents(),this.unbindRtpTransceiver();const t=this.localTrackMap.get($e.LocalAudioTrack);if((t==null?void 0:t.track)instanceof Ai){if(t.track.trackList.length>0){const r=t.track;t.track.trackList.forEach(s=>{r.removeAudioTrack(s)})}t.track.close()}this.localTrackMap.clear(),this.remoteUserMap.clear(),this.statsCollector.removeRemoteStats(),this.statsCollector.removeLocalStats(),this.dtlsFailedCount=0,this.pendingLocalTracks=[],this.pendingRemoteTracks=[],this.reconnectInterval&&(window.clearInterval(this.reconnectInterval),this.reconnectInterval=void 0),this.state=Wn.Disconnected}getStats(t){var r,s;return t?(s=this.recvConnection)===null||s===void 0?void 0:s.getStats():(r=this.sendConnection)===null||r===void 0?void 0:r.getStats()}getRemoteVideoIsReady(t){var r;return((r=this.recvConnection)===null||r===void 0?void 0:r.getRemoteVideoIsReady(t))||!1}getLocalAudioVolume(){const t=this.localTrackMap.get($e.LocalAudioTrack);if(t)return t.track.getVolumeLevel()}getLocalVideoSize(){const t=this.localTrackMap.get($e.LocalVideoTrack);if(t)return{width:t.track.videoWidth||0,height:t.track.videoHeight||0}}getEncoderConfig(t){const r=this.localTrackMap.get(t);return r&&r.track instanceof _r||r&&r.track instanceof Br?r.track._encoderConfig:void 0}getLocalMedia(t){return this.localTrackMap.get(t)}hasLocalMedia(){return this.localTrackMap.size>0}hasRemoteMedia(t,r){if(!t)return this.remoteUserMap.size>0;const s=this.remoteUserMap.get(t);return!!s&&(!r||s.has(r))}async hasRemoteMediaWithLock(t,r){if(!t)return this.remoteUserMap.size>0;const s=this.remoteUserMap.get(t);return!!s&&(!r||s.has(r))}getRemoteMedia(t){var r;const s=Array.from(Lc(r=this.remoteUserMap).call(r)).find(o=>o.uid===t);return s?{audioTrack:s.audioTrack,audioSSRC:s._audioSSRC,videoTrack:s.videoTrack,videoSSRC:s._videoSSRC}:{}}getAudioLevels(){let t=Array.from(this.remoteUserMap.entries()).map(s=>{let[o]=s;return{uid:o.uid,level:o.audioTrack?100*o.audioTrack._source.getAccurateVolumeLevel():0}});const r=this.localTrackMap.get($e.LocalAudioTrack);return r&&t.push({level:100*r.track._source.getAccurateVolumeLevel(),uid:this.store.uid}),t=eT(t).call(t,(s,o)=>s.level-o.level),t}async disconnectForReconnect(){this.sendConnection&&this.recvConnection&&(L.debug("[".concat(this.store.clientId,"] P2PChannel2.disconnectForReconnect closing P2PConnection")),this.state=Wn.Reconnecting,re("KEEP_LAST_FRAME")&&this.remoteUserMap.size!==0&&Array.from(this.remoteUserMap.entries()).forEach(t=>{let[r]=t;var s;r._videoTrack&&r._videoTrack._player&&((s=r._videoTrack._player.getVideoElement())===null||s===void 0||s.pause(),r._videoTrack._player.isKeepLastFrame=!0,r._videoTrack._originMediaStreamTrack.stop())}),this.sendConnection.close(),this.unbindConnectionEvents(this.sendConnection),this.sendConnection=void 0,this.recvConnection.close(),this.unbindConnectionEvents(this.recvConnection),this.recvConnection=void 0,this.localTrackMap.size!==0&&(Array.from(this.localTrackMap.entries()).forEach(t=>{var r;let[s,{track:o}]=t;switch(s){case $e.LocalVideoTrack:ot(r=o._hints).call(r,ar.LOW_STREAM)?o.close():this.pendingLocalTracks.push(o);break;case $e.LocalAudioTrack:o instanceof Ai?this.pendingLocalTracks=this.pendingLocalTracks.concat(o.trackList):this.pendingLocalTracks.push(o);case $e.LocalVideoLowTrack:}}),this.emit(kt.MediaReconnectStart,this.store.uid)),this.unbindLocalTrackEvents(),this.localTrackMap.clear(),this.remoteUserMap.size!==0&&Array.from(this.remoteUserMap.entries()).forEach(t=>{let[r,s]=t;Array.from(Lc(s).call(s)).forEach(o=>{this.setPendingRemoteMedia(r,o)}),this.emit(kt.MediaReconnectStart,r.uid)}),this.unbindAllRemoteTrackEvents(),this.remoteUserMap.clear(),this.stopUploadUplinkState(),this.stopUploadDownlinkState(),this.statsUploader.stopUploadOutboundStats(),this.statsUploader.stopUploadInboundStats(),this.statsUploader.stopUploadTransportStats(),L.debug("[".concat(this.store.clientId,"] P2PChannel2 disconnected, waiting to reconnect.")))}hasPendingRemoteMedia(t,r){for(const s of this.pendingRemoteTracks){const{user:o,kind:c}=s;if((t instanceof Mm?t.uid:t)===o.uid&&r===c)return!0}return!1}setPendingRemoteMedia(t,r){this.hasPendingRemoteMedia(t,r)||this.pendingRemoteTracks.push({user:t,kind:r})}async restartICE(t,r){let s,o;if(t===To.SEND_ONLY){if(!this.sendConnection)throw new Le(X.INVALID_OPERATION,"Cannot call P2PChannel2.handleMuteLocalTrack before sendConnection established.");s=await this.sendMutex.lock("From P2PChannel.restartICE"),o=this.sendConnection}else{if(!this.recvConnection)throw new Le(X.INVALID_OPERATION,"Cannot call P2PChannel2.handleMuteLocalTrack before recvConnection established.");s=await this.recvMutex.lock("From P2PChannel.restartICE"),o=this.recvConnection}try{if(r){const c=await o.restartICE(r);return o.isInRestartIce=!1,c}{const c=await o.restartICE();if(c){const u=await Ts(this,kt.RequestP2PRestartICE,{direction:To.RECEIVE_ONLY,iceParameter:c});await o.restartICE(u),o.isInRestartIce=!1}}}finally{s()}}getUplinkNetworkQuality(){if(!this.sendConnection)return 0;const t=this.sendConnection.getStats(),r=this.localTrackMap.get($e.LocalVideoTrack),s=this.localTrackMap.get($e.LocalAudioTrack),o=t.videoSend.find(k=>{var z;return k.ssrc===(r==null||(z=r.ssrcs)===null||z===void 0?void 0:z[0].ssrcId)}),c=t.audioSend.find(k=>{var z;return k.ssrc===(s==null||(z=s.ssrcs)===null||z===void 0?void 0:z[0].ssrcId)});if(!o||!c)return 1;const u=Nc(this,kt.NeedSignalRTT),h=o?o.rttMs:void 0,m=c?c.rttMs:void 0,_=h&&m?(h+m)/2:h||m,E=(_&&u?(_+u)/2:_||u)||0,S=100*t.sendPacketLossRate*.7/50+.3*E/1500,R=S<.17?1:S<.36?2:S<.59?3:S<.1?4:5,P=r==null?void 0:r.track;if(P&&P._encoderConfig&&P._hints.indexOf(ar.SCREEN_TRACK)===-1){const k=P._encoderConfig.bitrateMax,z=t.bitrate.actualEncoded;if(k&&z){const U=(1e3*k-z)/(1e3*k);return MG[U<.15?0:U<.3?1:U<.45?2:U<.6?3:4][R]}}return R}getDownlinkNetworkQuality(){if(!this.recvConnection)return 0;const t=this.recvConnection.getStats();let r=0;return Array.from(this.remoteUserMap.entries()).forEach(s=>{let[o]=s;const c=o._audioSSRC,u=o._videoSSRC,h=t.audioRecv.find(z=>z.ssrc===c),m=t.videoRecv.find(z=>z.ssrc===u);if(!h&&!m)return void(r+=1);const _=Nc(this,kt.NeedSignalRTT),E=t.rtt,S=(E&&_?(E+_)/2:E||_)||0,R=h?h.jitterMs:void 0,P=t.recvPacketLossRate;let k=.7*P*100/50+.3*S/1500;R&&(k=.6*P*100/50+.2*S/1500+.2*R/400),r+=k<.1?1:k<.17?2:k<.36?3:k<.59?4:5}),this.remoteUserMap.size>0?Math.round(r/this.remoteUserMap.size):r}async muteLocalTrack(t){return new lt((r,s)=>{this.handleMuteLocalTrack(t,r,s)})}filterTobePublishedTracks(t,r,s){const o=[],c=kn(),u=this.getAllTracks();t=kv(t=t.filter(_=>u.indexOf(_)===-1));let h=!1,m=!1;for(const _ of t){if(_ instanceof _r&&(this.localTrackMap.has($e.LocalVideoTrack)||h?new Le(X.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS).throw():(o.push({track:_,type:$e.LocalVideoTrack}),h=!0),r)){const E=this.getLowVideoTrack(_,s);o.push({track:E,type:$e.LocalVideoLowTrack})}if(_ instanceof Br){const E=this.localTrackMap.get($e.LocalAudioTrack);if(E){if(!(E.track instanceof Ai))throw new Le(X.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser does not support audio mixing");if(_._bypassWebAudio)throw new Le(X.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio");E.track.addAudioTrack(_),this.bindLocalAudioTrackEvents(_,!0)}else if(m){const S=o.find(R=>{let{type:P}=R;return P===$e.LocalAudioTrack});if(!(S.track instanceof Ai))throw new Le(X.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser does not support audio mixing");if(_._bypassWebAudio)throw new Le(X.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio");S.track.addAudioTrack(_)}else{if(!c.webAudioMediaStreamDest||_ instanceof Ai||_._bypassWebAudio)o.push({track:_,type:$e.LocalAudioTrack});else{const S=new Ai;S.addAudioTrack(_),o.push({track:S,type:$e.LocalAudioTrack})}m=!0}}}return o}filterTobeUnpublishedTracks(t){const r=[],s=this.getAllTracks();t=kv(t=t.filter(o=>s.indexOf(o)!==-1));for(const o of t){if(o instanceof Br){const c=this.localTrackMap.get($e.LocalAudioTrack);if(!c)continue;c.track instanceof Ai?(c.track.removeAudioTrack(o),this.unbindLocalAudioTrackEvents(o),c.track.trackList.length===0&&(r.push([$e.LocalAudioTrack,c]),c.track.close())):r.push([$e.LocalAudioTrack,c])}if(o instanceof _r){const c=this.localTrackMap.get($e.LocalVideoTrack);if(!c)continue;r.push([$e.LocalVideoTrack,c]);const u=this.localTrackMap.get($e.LocalVideoLowTrack);u&&r.push([$e.LocalVideoLowTrack,u])}}return r}bindLocalTrackEvents(t){t.forEach(r=>{let{track:s,type:o}=r;switch(o){case $e.LocalVideoTrack:s.addListener(yt.GET_STATS,this.handleGetLocalVideoStats),s.addListener(yt.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),s.addListener(yt.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),s.addListener(yt.NEED_UPDATE_VIDEO_ENCODER,this.handleUpdateVideoEncoder),s.addListener(yt.NEED_UPDATE_VIDEO_SEND_PARAMETERS,this.handleUpdateVideoSendParameters),s.addListener(yt.NEED_REPLACE_TRACK,this.handleReplaceTrack),s.addListener(yt.NEED_MUTE_TRACK,this.handleMuteLocalTrack),s.addListener(yt.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack);break;case $e.LocalAudioTrack:this.bindLocalAudioTrackEvents(s);case $e.LocalVideoLowTrack:}})}bindLocalAudioTrackEvents(t,r){t instanceof Ai?t.trackList.forEach(s=>{s.addListener(yt.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),s.addListener(yt.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),s.addListener(yt.GET_STATS,this.handleGetLocalAudioStats),s.addListener(yt.NEED_MUTE_TRACK,this.handleMuteLocalTrack),s.addListener(yt.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack)}):(t.addListener(yt.GET_STATS,this.handleGetLocalAudioStats),t.addListener(yt.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),t.addListener(yt.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),t.addListener(yt.NEED_MUTE_TRACK,this.handleMuteLocalTrack),t.addListener(yt.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack),r||t.addListener(yt.NEED_REPLACE_TRACK,this.handleReplaceTrack))}unbindLocalTrackEvents(t){t||(t=Array.from(this.localTrackMap.entries()).map(r=>{let[s,{track:o}]=r;return{track:o,type:s}})),t.forEach(r=>{let{track:s,type:o}=r;switch(o){case $e.LocalVideoTrack:s.off(yt.GET_STATS,this.handleGetLocalVideoStats),s.off(yt.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),s.off(yt.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),s.off(yt.NEED_UPDATE_VIDEO_ENCODER,this.handleUpdateVideoEncoder),s.off(yt.NEED_UPDATE_VIDEO_SEND_PARAMETERS,this.handleUpdateVideoSendParameters),s.off(yt.NEED_REPLACE_TRACK,this.handleReplaceTrack),s.off(yt.NEED_MUTE_TRACK,this.handleMuteLocalTrack),s.off(yt.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack);break;case $e.LocalAudioTrack:this.unbindLocalAudioTrackEvents(s);case $e.LocalVideoLowTrack:}})}unbindLocalAudioTrackEvents(t){t instanceof Ai?t.trackList.forEach(r=>{r.off(yt.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),r.off(yt.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),r.off(yt.GET_STATS,this.handleGetLocalAudioStats),r.off(yt.NEED_MUTE_TRACK,this.handleMuteLocalTrack),r.off(yt.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack)}):(t.off(yt.GET_STATS,this.handleGetLocalAudioStats),t.off(yt.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),t.off(yt.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),t.off(yt.NEED_REPLACE_TRACK,this.handleReplaceTrack),t.off(yt.NEED_MUTE_TRACK,this.handleMuteLocalTrack),t.off(yt.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack))}bindRemoteTrackEvents(t,r){r instanceof Gv&&r.addListener(yt.GET_STATS,s=>{s(this.handleGetRemoteVideoStats(t))}),r instanceof Hv&&r.addListener(yt.GET_STATS,s=>{s(this.handleGetRemoteAudioStats(t))})}unbindRemoteTrackEvents(t){t&&t.removeAllListeners(yt.GET_STATS)}unbindAllRemoteTrackEvents(){Array.from(this.remoteUserMap.entries()).forEach(t=>{let[r,s]=t;s.has(gt.AUDIO)&&this.unbindRemoteTrackEvents(r._audioTrack),s.has(gt.VIDEO)&&this.unbindRemoteTrackEvents(r._videoTrack)})}createGatewayPublishMessage(t,r){return t.map((s,o)=>{var c;let u,{track:h,type:m}=s;switch(m){case $e.LocalAudioTrack:u=zn.Audio;break;case $e.LocalVideoTrack:u=ot(c=h._hints).call(c,ar.SCREEN_TRACK)?zn.Screen:zn.High;break;case $e.LocalVideoLowTrack:u=zn.Low}return{kind:m===$e.LocalAudioTrack?gt.AUDIO:gt.VIDEO,stream_type:u,mid:r[o].id,ssrcs:r[o].localSSRC,isMuted:h.muted||!h.enabled}})}createGatewayUnpublishMessage(t){return t.map(r=>{var s;let o,[c,{track:u,ssrcs:h,id:m}]=r;switch(c){case $e.LocalVideoTrack:o=ot(s=u._hints).call(s,ar.SCREEN_TRACK)?zn.Screen:zn.High;break;case $e.LocalAudioTrack:o=zn.Audio;break;case $e.LocalVideoLowTrack:o=zn.Low}return{stream_type:o,ssrcs:h,mid:m}})}assignLocalTracks(t,r){t.forEach((s,o)=>{let{track:c,type:u}=s;this.localTrackMap.set(u,{track:c,id:r[o].id,ssrcs:r[o].localSSRC})})}withdrawLocalTracks(t){t.forEach(r=>{let[s]=r;this.localTrackMap.delete(s)})}bindConnectionEvents(t){t.onConnectionStateChange=async r=>{var s;L.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: ").concat(t.name,".onConnectionStateChange(").concat(r,")")),this.emit(kt.PeerConnectionStateChange,r),r!=="connected"||this.store.keyMetrics.peerConnectionEnd||this.store.peerConnectionEnd(),r==="connected"&&(t.isInRestartIce=!1),ot(s=this._restartStates).call(s,r)&&!t.isInRestartIce&&(r==="disconnected"&&await os(800),t.iceConnectionState!=="disconnected"&&t.iceConnectionState!=="failed"||this.handleDisconnect(t.direction))},t.onICEConnectionStateChange=r=>{r!=="connected"||this.store.keyMetrics.iceConnectionEnd||this.store.iceConnectionEnd(),L.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICEConnectionStateChange(").concat(r,")")),Rt.reportApiInvoke(this.store.sessionId,{name:"ICEConnectionStateChange",options:r,tag:xr.TRACER}).onSuccess(),this.emit(kt.IceConnectionStateChange,r)},t.onICETransportStateChange=r=>{L.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICETransportStateChange(").concat(r,")"))},t.onDTLSTransportStateChange=r=>{L.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onDTLSTransportStateChange(").concat(r,")"))},t.onDTLSTransportError=r=>{L.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onDTLSTransportError(").concat(r,")"))},t.onFirstAudioDecoded=r=>{var s;const o=Array.from(Lc(s=this.remoteUserMap).call(s)).find(u=>u._audioSSRC===r);var c;o&&(this.store.subscribe(o.uid,"audio",void 0,void 0,void 0,Date.now()),(c=o.audioTrack)===null||c===void 0||c.emit(Fv.FIRST_FRAME_DECODED),Rt.firstRemoteFrame(this.store.sessionId,Gi.FIRST_AUDIO_DECODE,Rr.FIRST_AUDIO_DECODE,{peer:o._uintid,subscribeElapse:Ls.measureFromSubscribeStart(this.store.clientId,r),subscribeRequestid:r,p2pid:this.store.p2pId}))},t.onFirstAudioReceived=r=>{var s;const o=Array.from(Lc(s=this.remoteUserMap).call(s)).find(c=>c._audioSSRC===r);o&&Rt.firstRemoteFrame(this.store.sessionId,Gi.FIRST_AUDIO_RECEIVED,Rr.FIRST_AUDIO_RECEIVED,{peer:o._uintid,subscribeElapse:Ls.measureFromSubscribeStart(this.store.clientId,r),subscribeRequestid:r,p2pid:this.store.p2pId})},t.onFirstVideoDecoded=(r,s,o)=>{this.reportVideoFirstFrameDecoded(r,s,o)},t.onFirstVideoReceived=r=>{var s;const o=Array.from(Lc(s=this.remoteUserMap).call(s)).find(c=>c._videoSSRC===r);o&&Rt.firstRemoteFrame(this.store.sessionId,Gi.FIRST_VIDEO_RECEIVED,Rr.FIRST_VIDEO_RECEIVED,{peer:o._uintid,subscribeElapse:Ls.measureFromSubscribeStart(this.store.clientId,r),subscribeRequestid:r,p2pid:this.store.p2pId})},t.onSelectedLocalCandidateChanged=(r,s)=>{const o=r.candidateType==="relay",c=s.candidateType==="relay";s.candidateType!=="unknown"&&o===c||this.emit(kt.ConnectionTypeChange,o),L.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.SelectedLocalCandidateChanged(").concat(JSON.stringify(Dm(s))," -> ").concat(JSON.stringify(Dm(r)),")"))},t.onSelectedRemoteCandidateChanged=(r,s)=>{L.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.SelectedRemoteCandidateChanged(").concat(JSON.stringify(Dm(s))," -> ").concat(JSON.stringify(Dm(r)),")"))},t.onFirstVideoDecodedTimeout=r=>{this.reportVideoFirstFrameDecoded(r,void 0,void 0,!0)},t.onLocalCandidate=r=>{this.emit(kt.LocalCandidate,{candidate:r,direction:t.direction})}}unbindConnectionEvents(t){t.onConnectionStateChange=void 0,t.onICEConnectionStateChange=void 0,t.onICETransportStateChange=void 0,t.onDTLSTransportStateChange=void 0,t.onDTLSTransportError=void 0,t.onFirstAudioDecoded=void 0,t.onFirstAudioReceived=void 0,t.onFirstVideoDecoded=void 0,t.onFirstVideoReceived=void 0,t.onSelectedLocalCandidateChanged=void 0,t.onSelectedRemoteCandidateChanged=void 0,t.onFirstVideoDecodedTimeout=void 0,t.onLocalCandidate=void 0}async handleDisconnect(t){const r=t===To.SEND_ONLY?this.sendConnection:this.recvConnection;r&&!r.isInRestartIce&&(r.isInRestartIce=!0,L.debug("[".concat(this.store.clientId,"] [P2PChannel-").concat(r.name,"] start use restartICE")),t===To.SEND_ONLY?this.restartICE(t):Ts(this,kt.RequestP2PRestartICE,{direction:To.SEND_ONLY}))}filterTobeMutedTracks(t){const r=[];if(this.getAllTracks().indexOf(t)===-1)return r;const s=this.localTrackMap.get($e.LocalAudioTrack);if(t instanceof Br&&(s==null?void 0:s.track)instanceof Ai)return s.track.isActive||r.push([$e.LocalAudioTrack,s]),r;const o=Array.from(this.localTrackMap.entries()).find(c=>{let[,{track:u}]=c;return t===u});if(o&&(r.push(o),o[0]===$e.LocalVideoTrack)){const c=this.localTrackMap.get($e.LocalVideoLowTrack);c&&r.push([$e.LocalVideoLowTrack,c])}return r}filterTobeUnmutedTracks(t){const r=[],s=this.localTrackMap.get($e.LocalAudioTrack);if(t instanceof Br&&(s==null?void 0:s.track)instanceof Ai)return s.track.isActive&&r.push([$e.LocalAudioTrack,s]),r;const o=Array.from(this.localTrackMap.entries()).find(c=>{let[,{track:u}]=c;return t===u});if(o)if(o[0]===$e.LocalVideoTrack){r.push(o);const c=this.localTrackMap.get($e.LocalVideoLowTrack);c&&r.push([$e.LocalVideoLowTrack,c])}else r.push(o);return r}createMuteMessage(t){return t.map(r=>{var s;let o,[c,{track:u,ssrcs:h,id:m}]=r;switch(c){case $e.LocalAudioTrack:o=zn.Audio;break;case $e.LocalVideoTrack:o=ot(s=u._hints).call(s,ar.SCREEN_TRACK)?zn.Screen:zn.High;break;case $e.LocalVideoLowTrack:o=zn.Low}return{stream_type:o,ssrcs:h,mid:m}})}createUnmuteMessage(t){return t.map(r=>{var s;let o,[c,{track:u,ssrcs:h,id:m}]=r;switch(c){case $e.LocalAudioTrack:o=zn.Audio;break;case $e.LocalVideoTrack:o=ot(s=u._hints).call(s,ar.SCREEN_TRACK)?zn.Screen:zn.High;break;case $e.LocalVideoLowTrack:o=zn.Low}return{stream_type:o,ssrcs:h,mid:m}})}filterTobeUnSubscribedTracks(t,r){const s=[],o=this.remoteUserMap.get(t);if(!o)return s;if(r){const c=o.get(r);if(!c)return s;s.push([t,{kind:r,id:c}])}else Array.from(o.entries()).forEach(c=>{let[u,h]=c;s.push([t,{kind:u,id:h}])});return s}createUnsubscribeMessage(t){const r=[];return t.forEach(s=>{let[o,{kind:c,id:u}]=s;switch(c){case gt.VIDEO:return void(o._videoSSRC&&r.push({stream_type:gt.VIDEO,ssrcId:o._videoSSRC}));case gt.AUDIO:return void(o._audioSSRC&&r.push({stream_type:gt.AUDIO,ssrcId:o._audioSSRC}))}}),r}withdrawRemoteTracks(t){t.forEach(r=>{let[s,{kind:o}]=r;const c=this.remoteUserMap.get(s);c&&(c.delete(o),Array.from(c.entries()).length===0&&this.remoteUserMap.delete(s))})}async updateBitrateLimit(t){const r=this.localTrackMap.get($e.LocalVideoTrack),s=this.localTrackMap.get($e.LocalVideoLowTrack);r&&(await r.track.setBitrateLimit(t.uplink),await new lt((o,c)=>{this.handleUpdateVideoEncoder(r.track,o,c,!0)})),s&&t.low_stream_uplink&&(await s.track.setBitrateLimit({max_bitrate:t.low_stream_uplink.bitrate,min_bitrate:t.low_stream_uplink.bitrate||0}),await new lt((o,c)=>{this.handleUpdateVideoEncoder(s.track,o,c,!0)}))}isP2PDisconnected(){if(this.sendConnection&&this.recvConnection){const t=this.sendConnection.peerConnectionState,r=this.recvConnection.peerConnectionState;return t!=="connected"&&r!=="connected"}return!0}async tryToUnmuteAudio(t){for(let r=0;r<t.length;r++)if(t[r]instanceof Br){const s=this.filterTobeUnmutedTracks(t[r]);if(s.length===0)continue;const o=this.createUnmuteMessage(s);return void await sr(this,kt.RequestUnmuteLocal,o)}}bindStatsUploaderEvents(){this.statsUploader.requestStats=t=>this.getStats(t),this.statsUploader.requestLocalMedia=()=>Array.from(this.localTrackMap.entries()).filter(t=>{let[,{ssrcs:r}]=t;return!!r}),this.statsUploader.requestRemoteMedia=()=>Array.from(this.remoteUserMap.entries()),this.statsUploader.requestVideoIsReady=t=>{var r;return!((r=this.recvConnection)===null||r===void 0||!r.getRemoteVideoIsReady(t))},this.statsUploader.requestUpload=(t,r)=>this.emit(kt.RequestUpload,t,r),this.statsUploader.requestUploadStats=t=>this.emit(kt.RequestUploadStats,t),this.statsUploader.requestAllTracks=()=>this.getAllTracks()}unbindStatsUploaderEvents(){this.statsUploader.requestStats=void 0,this.statsUploader.requestLocalMedia=void 0,this.statsUploader.requestRemoteMedia=void 0,this.statsUploader.requestVideoIsReady=void 0}async requestReconnect(){this.dtlsFailedCount+=1,await os(XL(this.dtlsFailedCount,bi)),this.emit(kt.RequestReconnect)}async reconnectP2P(){}canPublishLowStream(){return this.localTrackMap.has($e.LocalVideoTrack)||this.pendingLocalTracks.some(t=>t instanceof _r)}throwIfTrackTypeNotMatch(t){if(t.filter(r=>r instanceof _r).length>1)throw new Le(X.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS);if(t.filter(r=>r instanceof Br).length>1&&(t.some(r=>r instanceof Br&&r._bypassWebAudio)||!kn().webAudioMediaStreamDest))throw new Le(X.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser doesn't support MediaStreamDestNode");for(const r of t){if(r instanceof _r&&this.pendingLocalTracks.some(s=>s instanceof _r))throw new Le(X.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS);if(r instanceof Br&&this.pendingLocalTracks.some(s=>s instanceof Br)&&(!kn().webAudioMediaStreamDest||r._bypassWebAudio||this.pendingLocalTracks.some(s=>s instanceof Br&&s._bypassWebAudio)))throw new Le(X.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser doesn't support MediaStreamDestNode")}}getLowVideoTrack(t,r){const s=!re("DISABLE_DUAL_STREAM_USE_ENCODING")&&kn().supportDualStreamEncoding,o=nO(nO({},{width:160,height:120,framerate:15,bitrate:50}),r);let c;c=s?t._mediaStreamTrack.clone():sM(t,o);const u=or(8,"track-low-"),h=new _r(c,nO(nO({},s&&{scaleResolutionDownBy:Bx(o,t)}),{},{frameRate:o.framerate,bitrateMax:o.bitrate,bitrateMin:o.bitrate}),void 0,void 0,u);return h.on(M_.TRANSCEIVER_UPDATED,m=>{t._updateRtpTransceiver(m,Uv.LOW_STREAM)}),h._hints.push(ar.LOW_STREAM),t.addListener(yt.NEED_CLOSE,()=>{h.close()}),h}async globalLock(){return this.recvMutex.lock("From P2PChannel2.globalLock")}reportVideoFirstFrameDecoded(t,r,s,o){var c;const u=Array.from(Lc(c=this.remoteUserMap).call(c)).find(h=>h._videoSSRC===t);if(u){o||this.store.subscribe(u.uid,"video",void 0,void 0,void 0,void 0,Date.now());const h=this.store.keyMetrics,m=h.subscribe.find(_=>_.userId===u.uid&&_.type==="video");Rt.firstRemoteVideoDecode(this.store.sessionId,Gi.FIRST_VIDEO_DECODE,Rr.FIRST_VIDEO_DECODE,{peer:u._uintid,videowidth:r,videoheight:s,subscribeElapse:Ls.measureFromSubscribeStart(this.store.clientId,t),subscribeRequestid:t,p2pid:this.store.p2pId,apEnd:h.requestAPEnd||0,apStart:h.requestAPStart||0,joinGwEnd:h.joinGatewayEnd||0,joinGwStart:h.joinGatewayStart||0,pcEnd:h.peerConnectionEnd||0,pcStart:h.peerConnectionStart||0,subscriberEnd:(m==null?void 0:m.subscribeEnd)||0,subscriberStart:(m==null?void 0:m.subscribeStart)||0,videoAddNotify:(m==null?void 0:m.streamAdded)||0,state:o?1:0})}}async remoteMediaSsrcChanged(t,r,s){if(!this.recvConnection)return!1;const o=this.remoteUserMap.get(t);if(!o)return!1;const c=o.get(r);if(!c)return!1;const u=await this.recvConnection.getRemoteSSRC(c);return u!==void 0&&u!==s}isPreSubScribe(t){return!1}async publishDataChannel(t){throw new Le(X.NOT_SUPPORTED)}async unpublishDataChannel(t){throw new Le(X.NOT_SUPPORTED)}async subscribeDataChannel(t,r){throw new Le(X.NOT_SUPPORTED)}async unsubscribeDataChannel(t,r){throw new Le(X.NOT_SUPPORTED)}hasPendingRemoteDataChannel(t,r){throw new Le(X.NOT_SUPPORTED)}setPendingRemoteDataChannel(t,r){throw new Le(X.NOT_SUPPORTED)}async preConnect(t){throw new Le(X.NOT_SUPPORTED)}getEstablishParams(){throw new Le(X.NOT_SUPPORTED)}async reSubscribe(t){throw new Le(X.NOT_SUPPORTED)}async updateVideoStreamParameter(t,r){throw new Le(X.NOT_SUPPORTED)}unbindRtpTransceiver(){this.localTrackMap.size!==0&&Array.from(this.localTrackMap.entries()).forEach(t=>{let[r,{track:s}]=t;r===$e.LocalVideoLowTrack?s._updateRtpTransceiver(void 0,Uv.LOW_STREAM):s._updateRtpTransceiver(void 0)})}},vt(Ir.prototype,"p2pConnect",[T$],Object.getOwnPropertyDescriptor(Ir.prototype,"p2pConnect"),Ir.prototype),vt(Ir.prototype,"unpublish",[w$],Object.getOwnPropertyDescriptor(Ir.prototype,"unpublish"),Ir.prototype),vt(Ir.prototype,"unpublishLowStream",[R$],Object.getOwnPropertyDescriptor(Ir.prototype,"unpublishLowStream"),Ir.prototype),vt(Ir.prototype,"subscribe",[C$],Object.getOwnPropertyDescriptor(Ir.prototype,"subscribe"),Ir.prototype),vt(Ir.prototype,"mockSubscribe",[I$],Object.getOwnPropertyDescriptor(Ir.prototype,"mockSubscribe"),Ir.prototype),vt(Ir.prototype,"unsubscribe",[A$],Object.getOwnPropertyDescriptor(Ir.prototype,"unsubscribe"),Ir.prototype),vt(Ir.prototype,"muteRemote",[P$],Object.getOwnPropertyDescriptor(Ir.prototype,"muteRemote"),Ir.prototype),vt(Ir.prototype,"unmuteRemote",[O$],Object.getOwnPropertyDescriptor(Ir.prototype,"unmuteRemote"),Ir.prototype),vt(Ir.prototype,"hasRemoteMediaWithLock",[k$],Object.getOwnPropertyDescriptor(Ir.prototype,"hasRemoteMediaWithLock"),Ir.prototype),vt(Ir.prototype,"disconnectForReconnect",[N$],Object.getOwnPropertyDescriptor(Ir.prototype,"disconnectForReconnect"),Ir.prototype),vt(Ir.prototype,"remoteMediaSsrcChanged",[D$],Object.getOwnPropertyDescriptor(Ir.prototype,"remoteMediaSsrcChanged"),Ir.prototype),Ir);function bd(t){return function(r,s,o){const c=r[s];if(typeof c!="function")throw new Error("Cannot use mutex on object property.");return o.value=async function(){for(var u=arguments.length,h=new Array(u),m=0;m<u;m++)h[m]=arguments[m];switch(t){case Sd.SEND_ONLY:{const _=await this.sendMutex.lock("From P2PChannel2.".concat(s));try{return await c.apply(this,h)}finally{_()}}case Sd.RECEIVE_ONLY:{const _=await this.recvMutex.lock("From P2PChannel2.".concat(s));try{return await c.apply(this,h)}finally{_()}}default:{const _=await this.sendMutex.lock("From P2PChannel2.".concat(s)),E=await this.recvMutex.lock("From P2PChannel2.".concat(s));try{return await c.apply(this,h)}finally{_(),E()}}}},o}}class ry extends Pr{constructor(r,s){super(),$(this,"signal",void 0),$(this,"token",void 0),$(this,"tokenTimeout",void 0),$(this,"tokenInterval",void 0),$(this,"_sequence",0),$(this,"userMap",new Map),$(this,"encoder",new TextEncoder),this.signal=r,this.token=s;const o=()=>{this.signal.connectionState===lr.CONNECTED&&this.check(),this.userMap.size===0?this.tokenInterval=window.setTimeout(o,1e3):this.tokenInterval=window.setTimeout(o,3*re("P2P_TOKEN_INTERVAL"))};o()}async send(r,s,o,c,u){var h,m,_;if(this.userMap.size===0)return;const E=Array.from(Oc(h=this.userMap).call(h))[0].token;typeof s!="string"&&(s=JSON.stringify(s)),c=(m=c)!==null&&m!==void 0?m:or(6,""),u=(_=u)!==null&&_!==void 0?_:this._sequence++;const S={_id:c,_type:r,_seq:u,_message:s,token:"".concat(this.token,"_").concat(E)};re("SHOW_P2P_LOG")&&L.debug("send message",S,"noNeedResponse : ".concat(o)),this.splitMessage(JSON.stringify(S)).forEach(P=>{this.signal.request(jt.DATA_STREAM,{payload:Am(this.encoder.encode(P))})});const R=new lt((P,k)=>{const z=window.setTimeout(()=>{this.off("res-@".concat(c,"_ack"),U),this.off("res-@".concat(c),q),this.off(Xv.ABORT,F),L.debug("[external-signal] request timeout, type: ".concat(r,", requestId: ").concat(c)),this.userMap.size===0?k(new Le(X.INVALID_REMOTE_USER)):k(new Le(X.TIMEOUT))},re("EXTERNAL_SIGNAL_REQUEST_TIMEOUT")),U=()=>{z&&window.clearTimeout(z),this.off(Xv.ABORT,F),o&&P()},F=()=>{z&&window.clearTimeout(z),this.off("res-@".concat(c,"_ack"),U),this.off("res-@".concat(c),q),k(new Le(X.EXTERNAL_SIGNAL_ABORT,"type: ".concat(r,", requestId: ").concat(c)))};this.once(Xv.ABORT,F),this.once("res-@".concat(c,"_ack"),U);const q=(le,ye)=>{Y=!0,z&&window.clearTimeout(z),this.off("res-@".concat(c,"_ack"),U),this.off(Xv.ABORT,F),le==="success"?P(ye):k(new Le(X.P2P_MESSAGE_FAILED,"request ".concat(r," failed, requestId: ").concat(c)))};let Y=!1;o||(this.once("res-@".concat(c),q),os(re("SIGNAL_REQUEST_TIMEOUT")).then(()=>{Y||L.warning("external_signal request timeout, type: ".concat(r,", requestId: ").concat(c,", ").concat(S))}))});try{return await R}catch(P){if(P.code===X.TIMEOUT)return await this.send(r,s,o,c,u);throw P}}onMessage(r){var s;const{_uid:o}=r;let c,u=this.userMap.get(o);if(u)c=u.splitMessageMap;else{if(this.userMap.size>0||!("_type"in r)||r._type!==Zr.CHECK)return;const{token:E}=r;c=new Map,u={uid:o,isStart:!0,token:E,splitMessageMap:c,nextExpectedSequenceNumber:0,receivedMessagesMap:new Map},this.userMap.set(o,u),this.signal.emit(_n.ON_USER_ONLINE,{uid:o}),this.handleUserOnline()}if("id"in r&&"total"in r){var h;const{id:E,total:S}=r,R=(h=c.get(E))!==null&&h!==void 0?h:[];if(R.push(r),c.has(E)||c.set(E,R),R.length!==S)return;{const P=eT(R).call(R,(k,z)=>k.index-z.index).map(k=>k.payload).join("");c.delete(E),(r=JSON.parse(P))._uid=o}}const{_type:m,token:_}=r;if(ot(s=[Zr.ACK,Zr.CHECK]).call(s,m))return m===Zr.CHECK&&this.handleCheckToken(u,_),void this.receiveMessage(r);_==="".concat(u.token,"_").concat(this.token)?this.handleReceivedMessage(r):L.debug('Receive unexpected message", '.concat(_,", cur_token: ").concat(u.token,"_").concat(this.token),r)}check(){const r={_id:or(6,""),token:this.token,_type:Zr.CHECK};re("SHOW_P2P_LOG")&&L.debug("send message",r),this.signal.request(jt.DATA_STREAM,{payload:Am(this.encoder.encode(JSON.stringify(r)))})}ack(r){const s={_id:r,_type:Zr.ACK,token:this.token};re("SHOW_P2P_LOG")&&L.debug("send message",s),this.signal.request(jt.DATA_STREAM,{payload:Am(this.encoder.encode(JSON.stringify(s)))})}response(r,s,o){this.send(Zr.RESPONSE,JSON.stringify({success:!o,message:s}),!0,r)}handleReceivedMessage(r){const s=()=>{this.userMap.forEach(E=>{const{receivedMessagesMap:S,nextExpectedSequenceNumber:R}=E;for(;S.has(R);){const P=S.get(R);S.delete(R),this.receiveMessage(P),E.nextExpectedSequenceNumber++}})};if(!r)return void s();const{_uid:o,_seq:c}=r,u=this.userMap.get(o),{receivedMessagesMap:h,isStart:m,nextExpectedSequenceNumber:_}=u;if(c<_)return this.ack(r._id),void L.debug("[external-signal] receive old message, seq: ".concat(c,", ").concat(r._message));h.set(c,r),m&&c===_&&(this.receiveMessage(r),h.delete(_),u.nextExpectedSequenceNumber++,s())}receiveMessage(r){const{_id:s,_type:o,_message:c,_uid:u}=r;if(re("SHOW_P2P_LOG")&&L.debug("receive message",r),s){let h;switch(r._type!==Zr.ACK&&(c&&(h=JSON.parse(c)),this.ack(r._id)),r._type){case Zr.CANDIDATE:case Zr.CONTROL:this.signal.emit(o,h,u);break;case Zr.PUBLISH:case Zr.UNPUBLISH:case Zr.RESTART_ICE:case Zr.CALL:h.uid=u,Ts(this.signal,o,h).then(m=>{this.response(r._id,m)}).catch(()=>{this.response(r._id,void 0,!0)});break;case Zr.ACK:this.getListeners("res-@".concat(s,"_ack")).length>0&&this.emit("res-@".concat(s,"_ack"));break;case Zr.RESPONSE:{const{success:m,message:_}=h;this.emit("res-@".concat(s),m?"success":"failed",_);break}}}}splitMessage(r){if(r.length<ry.MAX_MESSAGE_SIZE)return[r];const s=[],{remoteToken:o}=JSON.parse(r),c=or(6,"");let u=0,h=800;const m=Math.ceil(r.length/h);for(;r.length>0;){u++;const _={id:c,index:u,total:m,payload:r.slice(0,h),token:"".concat(this.token,"_").concat(o)};JSON.stringify(_).length>ry.MAX_MESSAGE_SIZE?h-=50:(s.push(_),r=r.slice(h))}return s.map(_=>JSON.stringify(_))}handleCheckToken(r,s){return r.token!==s?(L.debug("token changed, from ".concat(r.token," to ").concat(s)),this.reset(r.uid,s),!1):(this.tokenTimeout&&(window.clearTimeout(this.tokenTimeout),this.tokenTimeout=void 0),this.tokenTimeout=window.setTimeout(()=>{L.debug("token timeout, ".concat(s)),this.reset(r.uid)},re("MAX_P2P_TIMEOUT")),!0)}async handleUserOnline(){const r=await Ts(this.signal,Zr.CALL,void 0),s=await this.send(Zr.CALL,r);this.signal.emit(Wt.P2P_CONNECTION,s,!0)}async reset(r,s){const o=this.userMap.get(r);o&&(this.emit(Xv.ABORT),this.signal.emit(_n.ON_USER_OFFLINE,{uid:o.uid,reason:fme.P2P_TOKEN_CHANGED}),this._sequence=0,this.userMap.clear(),s||(L.debug("change local token from ".concat(s," to ").concat(s)),this.token=or(6,"")))}clear(){this._sequence=0,this.userMap.clear(),this.tokenInterval&&window.clearTimeout(this.tokenInterval),this.tokenInterval=void 0,this.tokenTimeout&&window.clearTimeout(this.tokenTimeout),this.tokenTimeout=void 0,this.emit(Xv.ABORT)}}$(ry,"MAX_SIZE",1),$(ry,"MAX_MESSAGE_SIZE",1024);class Y_e extends Pr{get connectionState(){return this._connectionState}set connectionState(r){r!==this._connectionState&&(this._connectionState=r,r===lr.CONNECTED?this.emit(Wt.WS_CONNECTED):r===lr.RECONNECTING?this.emit(Wt.WS_RECONNECTING,this._websocketReconnectReason):r===lr.CLOSED&&this.emit(Wt.WS_CLOSED,this._disconnectedReason))}get currentURLIndex(){return this.websocket.currentURLIndex}get url(){return this.websocket&&this.websocket.url||null}get rtt(){return this.rttRolling.mean()}constructor(r,s){super(),$(this,"_disconnectedReason",void 0),$(this,"_websocketReconnectReason",void 0),$(this,"_connectionState",lr.CLOSED),$(this,"reconnectToken",void 0),$(this,"p2pToken",void 0),$(this,"websocket",void 0),$(this,"openConnectionTime",void 0),$(this,"clientId",void 0),$(this,"lastMsgTime",Date.now()),$(this,"uploadCache",[]),$(this,"uploadCacheInterval",void 0),$(this,"rttRolling",new u8(5)),$(this,"pingpongTimer",void 0),$(this,"pingpongTimeoutCount",0),$(this,"joinResponse",void 0),$(this,"multiIpOption",void 0),$(this,"initError",void 0),$(this,"spec",void 0),$(this,"store",void 0),$(this,"_external_signal",void 0),$(this,"onWebsocketMessage",o=>{if(o.data instanceof ArrayBuffer)return void this.emit(Wt.ON_BINARY_DATA,o.data);const c=JSON.parse(o.data);if(this.lastMsgTime=Date.now(),Object.prototype.hasOwnProperty.call(c,"_id")){const u="res-@".concat(c._id);this.emit(u,c._result,c._message)}else if(Object.prototype.hasOwnProperty.call(c,"_type")){switch(c._type){case _n.ON_DATA_STREAM:return void this.handleDataStream(c._message);case _n.MUTE_AUDIO:case _n.MUTE_VIDEO:case _n.ON_P2P_LOST:case _n.ON_USER_ONLINE:return;case _n.ON_USER_OFFLINE:const{uid:u}=c._message;return L.debug("[".concat(this.clientId,"] user-offline uid: ").concat(u)),void this._external_signal.reset(u)}if(this.emit(c._type,c._message),c._type===_n.ON_NOTIFICATION&&this.handleNotification(c._message),c._type===_n.ON_USER_BANNED)switch(c._message.error_code){case 14:this.close(Bn.UID_BANNED);break;case 15:this.close(Bn.IP_BANNED);break;case 16:this.close(Bn.CHANNEL_BANNED)}if(c._type===_n.ON_USER_LICENSE_BANNED)switch(c._message.error_code){case Lt.ERR_LICENSE_MISSING:this.close(Bn.LICENSE_MISSING);break;case Lt.ERR_LICENSE_EXPIRED:this.close(Bn.LICENSE_EXPIRED);break;case Lt.ERR_LICENSE_MINUTES_EXCEEDED:this.close(Bn.LICENSE_MINUTES_EXCEEDED);break;case Lt.ERR_LICENSE_PERIOD_INVALID:this.close(Bn.LICENSE_PERIOD_INVALID);break;case Lt.ERR_LICENSE_MULTIPLE_SDK_SERVICE:this.close(Bn.LICENSE_MULTIPLE_SDK_SERVICE);break;case Lt.ERR_LICENSE_ILLEGAL:this.close(Bn.LICENSE_ILLEGAL);break;default:this.close()}}}),this.clientId=r.clientId,this.spec=r,this.store=s,this.websocket=new Fx("gateway-".concat(this.clientId),this.spec.retryConfig,!0,re("JOIN_GATEWAY_USE_DUAL_DOMAIN"),re("JOIN_GATEWAY_USE_443PORT_ONLY"),s),this.handleWebsocketEvents(),window.addEventListener("offline",()=>{this.connectionState===lr.CONNECTED&&this.reconnect("retry",bs.OFFLINE)}),this.p2pToken=or(6,""),this._external_signal=new ry(this,this.p2pToken)}async request(r,s,o,c){const u=or(6,""),h={_id:u,_type:r,_message:s},m=this.websocket.connectionID,_=()=>new lt((z,U)=>{if(this.connectionState===lr.CONNECTED)return z();const F=()=>{this.off(Wt.WS_CLOSED,q),z()},q=()=>{this.off(Wt.WS_CONNECTED,F),U(new Le(X.WS_ABORT))};this.once(Wt.WS_CONNECTED,F),this.once(Wt.WS_CLOSED,q)});if(this.connectionState!==lr.CONNECTING&&this.connectionState!==lr.RECONNECTING||r===jt.JOIN||r===jt.REJOIN||await _(),this.websocket.sendMessage(h,!0),c)return;const E=new lt((z,U)=>{let F=!1;const q=(le,ye)=>{F=!0,z({isSuccess:le==="success",message:ye||{}}),this.off(Wt.WS_CLOSED,Y),this.off(Wt.WS_RECONNECTING,Y),this.emit(Wt.REQUEST_SUCCESS,r,s)};this.once("res-@".concat(u),q);const Y=()=>{U(new Le(X.WS_ABORT,"type: ".concat(r))),this.off(Wt.WS_CLOSED,Y),this.off(Wt.WS_RECONNECTING,Y),this.off("res-@".concat(u),q)};this.once(Wt.WS_CLOSED,Y),this.once(Wt.WS_RECONNECTING,Y),os(re("SIGNAL_REQUEST_TIMEOUT")).then(()=>{this.websocket.connectionID!==m||F||(L.warning("[".concat(this.clientId,"] ws request timeout, type: ").concat(r)),this.emit(Wt.REQUEST_TIMEOUT,r,s))})});let S=null;try{S=await E}catch(z){if(this.connectionState===lr.CLOSED||r===jt.LEAVE)throw new Le(X.WS_ABORT);return!this.spec.forceWaitGatewayResponse||o?z.throw():r===jt.JOIN||r===jt.REJOIN?null:(await _(),await this.request(r,s))}if(S.isSuccess)return S.message;const R=Number(S.message.error_code||S.message.code),P=CT(R),k=new Le(X.UNEXPECTED_RESPONSE,"".concat(P.desc,": ").concat(S.message.error_str),{code:R,data:S.message,desc:P.desc});return P.action==="success"?S.message:(L.warning("[".concat(this.clientId,"] [").concat(this.websocket.connectionID,"] unexpected response from type ").concat(r,", error_code: ").concat(R,", message: ").concat(P.desc,", action: ").concat(P.action)),R===Lt.ERR_TOO_MANY_BROADCASTERS?((r===jt.JOIN||r===jt.REJOIN)&&(this.initError=k,this.close()),k.throw()):P.action==="failed"?k.throw():P.action==="quit"?(this.initError=k,this.close(),k.throw()):(R===Lt.ERR_JOIN_BY_MULTI_IP?(this.multiIpOption=S.message.option,L.warning("[".concat(this.clientId,"] detect multi ip, recover")),this.reconnect("recover",bs.MULTI_IP)):this.reconnect(P.action,bs.SERVER_ERROR),r===jt.JOIN||r===jt.REJOIN?null:await this.request(r,s)))}waitMessage(r,s){return new lt(o=>{const c=u=>{(!s||s(u))&&(this.off(r,c),o(u))};this.on(r,c)})}uploadWRTCStats(r){if(!this.store.sessionId)return void L.warn("[".concat(this.clientId,"] no session id when upload wrtc stats"));const s={lts:Date.now(),sid:this.store.sessionId,uid:this.store.intUid,stats:r};this.upload(wT.WRTC_STATS,s)}upload(r,s){const o={_type:r,_message:s};try{this.websocket.sendMessage(o)}catch{const u=re("MAX_UPLOAD_CACHE")||50;this.uploadCache.push(o),this.uploadCache.length>u&&this.uploadCache.splice(0,1),this.uploadCache.length>0&&!this.uploadCacheInterval&&(this.uploadCacheInterval=window.setInterval(()=>{if(this.connectionState!==lr.CONNECTED)return;const h=this.uploadCache.splice(0,1)[0];this.uploadCache.length===0&&(window.clearInterval(this.uploadCacheInterval),this.uploadCacheInterval=void 0),this.upload(h._type,h._message)},re("UPLOAD_CACHE_INTERVAL")||2e3))}}send(r,s){const o={_type:r,_message:s};this.websocket.sendMessage(o)}async sendExtensionMessage(r,s,o){return await this._external_signal.send(r,s,o)}init(r){return this.initError=void 0,this.multiIpOption=void 0,this.joinResponse=void 0,this.reconnectToken=void 0,this.openConnectionTime=void 0,new lt((s,o)=>{this.once(Wt.WS_CONNECTED,()=>s(this.joinResponse)),this.once(Wt.WS_CLOSED,()=>o(this.initError||new Le(X.WS_ABORT))),this.connectionState=lr.CONNECTING,this.websocket.init(r).catch(o)})}close(r){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.reconnectToken=void 0,this.joinResponse=void 0,this._external_signal.clear(),this._disconnectedReason=r||Bn.LEAVE,this.connectionState=lr.CLOSED,L.debug("[".concat(this.clientId,"] ")+"will close websocket in signal"),this.websocket.close(),this.p2pToken=or(6,""),this._external_signal.clear(),this._external_signal=new ry(this,this.p2pToken)}async join(){if(!this.joinResponse){this.emit(Wt.ABORT_P2P_EXECUTION);const r=await Ts(this,Wt.REQUEST_JOIN_INFO),s=await this.request(jt.JOIN,r);if(!s)return this.emit(Wt.REPORT_JOIN_GATEWAY,X.TIMEOUT,this.url||""),!1;this.joinResponse=s,this.emit(Wt.JOIN_RESPONSE,this.joinResponse),this.reconnectToken=this.joinResponse.rejoin_token}return this.connectionState=lr.CONNECTED,this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(this.handlePingPong.bind(this),3e3),!0}reconnect(r,s){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.websocket.reconnect(r,s)}handleDataStream(r){try{var s;const o=D_(r.payload),c=new TextDecoder().decode(o),u=JSON.parse(c);"total"in u&&"id"in u||ot(s=Object.values(Zr)).call(s,u._type)?(u._uid=r.uid,this._external_signal.onMessage(u)):this.emit(_n.ON_DATA_STREAM,r)}catch{this.emit(_n.ON_DATA_STREAM,r)}}handleNotification(r){L.debug("[".concat(this.clientId,"] receive notification: "),r);const s=CT(r.code);if(s.action!=="success"){if(s.action!=="failed")return s.action==="quit"?(s.desc==="ERR_REPEAT_JOIN_CHANNEL"&&this.close(Bn.UID_BANNED),void this.close()):void this.reconnect(s.action,bs.SERVER_ERROR);L.error("[".concat(this.clientId,"] ignore error: "),s.desc)}}handlePingPong(){if(!this.websocket||this.websocket.state!=="connected")return;this.pingpongTimeoutCount>0&&this.rttRolling.add(3e3),this.pingpongTimeoutCount+=1;const r=re("PING_PONG_TIME_OUT"),s=Date.now();this.pingpongTimeoutCount>=r&&(L.warning("[".concat(this.clientId,"] PINGPONG Timeout. Last Socket Message: ").concat(s-this.lastMsgTime,"ms")),s-this.lastMsgTime>re("WEBSOCKET_TIMEOUT_MIN"))?this.reconnect("retry",bs.TIMEOUT):this.request(jt.PING,void 0,!0).then(()=>{this.pingpongTimeoutCount=0;const o=Date.now()-s;this.rttRolling.add(o),re("REPORT_STATS")&&this.send(jt.PING_BACK,{pingpongElapse:o})}).catch(o=>{})}handleWebsocketEvents(){this.websocket.on(Yt.RECONNECT_CREATE_CONNECTION,r=>{this.emit(Wt.WS_RECONNECT_CREATE_CONNECTION,r)}),this.websocket.on(Yt.ON_MESSAGE,this.onWebsocketMessage),this.websocket.on(Yt.CLOSED,()=>{this.connectionState=lr.CLOSED}),this.websocket.on(Yt.FAILED,()=>{this._disconnectedReason=Bn.NETWORK_ERROR,this.connectionState=lr.CLOSED}),this.websocket.on(Yt.RECONNECTING,r=>{this._websocketReconnectReason=r,this.joinResponse=void 0,this.connectionState===lr.CONNECTED?this.connectionState=lr.RECONNECTING:this.connectionState=lr.CONNECTING}),this.websocket.on(Yt.WILL_RECONNECT,(r,s,o)=>{r!=="retry"?(L.debug("".concat(this.clientId," websocket will_connect event, renewSession reconnectMode is ").concat(r)),this.reconnectToken=void 0):L.debug("".concat(this.clientId," reconnect mode is retry, no need to renew session")),o(r)}),this.websocket.on(Yt.CONNECTED,()=>{this.openConnectionTime=Date.now(),this.join().catch(r=>{if(this.emit(Wt.REPORT_JOIN_GATEWAY,r,this.url||""),r instanceof Le&&r.code===X.UNEXPECTED_RESPONSE&&r.data.code===Lt.ERR_NO_AUTHORIZED)return L.warning("[".concat(this.clientId,"] reconnect no authorized, recover")),void this.reconnect("recover",bs.SERVER_ERROR);L.error("[".concat(this.clientId,"] join gateway request failed"),r.toString()),this.spec.forceWaitGatewayResponse?this.reconnect("tryNext",bs.SERVER_ERROR):(this.initError=r,this.close())})}),this.websocket.on(Yt.REQUEST_NEW_URLS,(r,s)=>{Ts(this,Wt.REQUEST_RECOVER,this.multiIpOption).then(r).catch(s)}),this.websocket.on(Yt.ON_TOKEN_PRIVILEGE_DID_EXPIRE,()=>{this.emit(_n.ON_TOKEN_PRIVILEGE_DID_EXPIRE)})}}const X_e={name:"P2PChannel",create:function(t){let{store:r,statsCollector:s}=t;return new q_e(r,s)},createSubmodule:function(t){let{store:r,spec:s}=t;return new Y_e(s,r)}};function x$(t,r){var s=Object.keys(t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);r&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(t,c).enumerable})),s.push.apply(s,o)}return s}function M$(t){for(var r=1;r<arguments.length;r++){var s=arguments[r]!=null?arguments[r]:{};r%2?x$(Object(s),!0).forEach(function(o){$(t,o,s[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(s)):x$(Object(s)).forEach(function(o){Object.defineProperty(t,o,Object.getOwnPropertyDescriptor(s,o))})}return t}class J_e{constructor(r){$(this,"sessionDesc",void 0),$(this,"localCapabilities",void 0),$(this,"rtpCapabilities",void 0),$(this,"candidates",void 0),$(this,"_originCandidates",void 0),$(this,"iceParameters",void 0),$(this,"dtlsParameters",void 0),$(this,"setup",void 0),$(this,"currentMidIndex",void 0),$(this,"cname",void 0),r=Mr(r);const{iceParameters:s,dtlsParameters:o,candidates:c,rtpCapabilities:u,setup:h,localCapabilities:m,sdkCodec:_,cname:E}=r,S=Ca(`v=0
o=- 0 0 IN IP4 127.0.0.1
s=AgoraGateway
t=0 0
a=group:BUNDLE audio video
a=msid-semantic: WMS
a=ice-lite
m=audio 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendrecv
a=rtcp-mux
a=rtcp-rsize
a=mid:audio
m=video 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendrecv
a=rtcp-mux
a=rtcp-rsize
a=mid:video
`);this.rtpCapabilities=u,this.candidates=c,this._originCandidates=Mr(c),this.iceParameters=s,this.dtlsParameters=o,this.setup=h,this.localCapabilities=m,this.cname=E;for(let R=0;R<S.mediaDescriptions.length;R++){const P=S.mediaDescriptions[R];if(P.attributes.iceUfrag=s.iceUfrag,P.attributes.icePwd=s.icePwd,P.attributes.fingerprints=o.fingerprints,P.attributes.candidates=c,P.attributes.setup=h,P.media.mediaType==="video"){P.media.fmts=u.videoCodecs.map(z=>z.payloadType.toString(10));let k=u.videoCodecs.filter(z=>{var U,F;return(U=z.rtpMap)===null||U===void 0?void 0:ot(F=U.encodingName.toLowerCase()).call(F,_)});k.length===0&&(k=u.videoCodecs),P.attributes.payloads=k,P.attributes.extmaps=u.videoExtensions}P.media.mediaType==="audio"&&(P.media.fmts=u.audioCodecs.map(k=>k.payloadType.toString(10)),P.attributes.payloads=u.audioCodecs,P.attributes.extmaps=u.audioExtensions),S.mediaDescriptions[R]=this.mungMediaDesc(P)}this.sessionDesc=S,this.currentMidIndex=S.mediaDescriptions.length-1}toString(){return Pm(this.sessionDesc)}send(r,s,o){const{ssrcs:c,ssrcGroups:u}=z_(s,this.cname),h=this.sessionDesc.mediaDescriptions.find(E=>r===gt.VIDEO?E.media.mediaType==="video":E.media.mediaType==="audio"),m=c[0].attributes.label,_=c[0].attributes.mslabel;return h.attributes.ssrcs=h.attributes.ssrcs.concat(c),h.attributes.ssrcGroups=h.attributes.ssrcGroups.concat(u),{id:m,mslabel:_}}batchSend(r){return r.map(s=>{let{kind:o,ssrcMsg:c}=s;return this.send(o,c,void 0)})}stopSending(r){this.sessionDesc.mediaDescriptions.forEach(s=>{const o=[],c=[],u=[];s.attributes.ssrcs.forEach(h=>{ot(r).call(r,h.attributes.label||"")?u.push(h):o.push(h)}),s.attributes.ssrcGroups.forEach(h=>{var m;ot(m=u.map(_=>_.ssrcId)).call(m,h.ssrcIds[0])||c.push(h)}),s.attributes.ssrcs=o,s.attributes.ssrcGroups=c})}mute(r){const s=this.sessionDesc.mediaDescriptions.find(o=>o.attributes.mid===r);if(!s)throw new Error("mediaDescription not found with ".concat(r," in remote SDP when calling RemoteSDP.mute."));s.attributes.direction="inactive"}unmute(r){const s=this.sessionDesc.mediaDescriptions.find(o=>o.attributes.mid===r);if(!s)throw new Error("mediaDescription not found with ".concat(r," in remote SDP when calling RemoteSDP.unmute."));s.attributes.direction="sendonly"}receive(r,s,o){r.forEach((c,u)=>{const h=c._mediaStreamTrack,m=this.sessionDesc.mediaDescriptions.findIndex(E=>E.attributes.mid===h.kind),_=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[m],c);this.sessionDesc.mediaDescriptions[m]=_})}stopReceiving(r){}updateCandidates(r){const s=this._originCandidates.filter(c=>c.transport==="udp"),o=[];if(s.forEach(c=>{o.push(M$(M$({},c),{},{foundation:"tcpcandidate",priority:Number(c.priority)-1+"",transport:"tcp",port:Number(c.port)+90+""}))}),s.length!==0){switch(r){case Ds.TCP_RELAY:this.candidates=o;break;case Ds.UDP_TCP_RELAY:case Ds.RELAY:this.candidates=[...s,...o];break;default:this.candidates=s}for(const c of this.sessionDesc.mediaDescriptions)c.attributes.candidates=this.candidates}}restartICE(r){r=Mr(r),this.iceParameters=r,this.sessionDesc.mediaDescriptions.forEach(s=>{s.attributes.iceUfrag=r.iceUfrag,s.attributes.icePwd=r.icePwd})}predictReceivingMids(r){const s=[];for(let o=0;o<r;o++)s.push((this.currentMidIndex+o+1).toString(10));return s}mungRecvMediaDsec(r,s){const o=Mr(r);return Zv(o,s),zx(o,s),o}updateRecvMedia(r,s){const o=this.sessionDesc.mediaDescriptions.findIndex(c=>c.attributes.mid===r);if(o!==-1){const c=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[o],s);this.sessionDesc.mediaDescriptions[o]=c}}bumpMid(r){this.currentMidIndex+=r}updateTrackLabel(r,s,o){const c=this.sessionDesc.mediaDescriptions.find(h=>r===gt.VIDEO?h.attributes.mid==="video":h.attributes.mid==="audio");if(c){const h=c.attributes.ssrcs.find(m=>m.attributes.label===s);var u;h&&(h.attributes.label=o,(u=h.attributes.msid)===null||u===void 0||u.replace(s,o))}}mungMediaDesc(r){const s=Mr(r);return Wx(s),function(o){const c=o.attributes.extmaps.find(u=>yP(u.extensionName));c&&o.attributes.extmaps.splice(o.attributes.extmaps.indexOf(c),1),o.attributes.payloads.forEach(u=>{const h=u.rtcpFeedbacks.findIndex(m=>m.type==="transport-cc");h!==-1&&u.rtcpFeedbacks.splice(h,1)})}(s),s}getSSRC(r){for(const s of this.sessionDesc.mediaDescriptions)for(const o of s.attributes.ssrcs)if(o.attributes.label===r)return[o]}}var rr;function U$(t,r){var s=Object.keys(t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);r&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(t,c).enumerable})),s.push.apply(s,o)}return s}function rO(t){for(var r=1;r<arguments.length;r++){var s=arguments[r]!=null?arguments[r]:{};r%2?U$(Object(s),!0).forEach(function(o){$(t,o,s[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(s)):U$(Object(s)).forEach(function(o){Object.defineProperty(t,o,Object.getOwnPropertyDescriptor(s,o))})}return t}let Q_e=(rr=class zw extends $G{get peerConnectionState(){return this.peerConnection.connectionState}get iceConnectionState(){return this.peerConnection.iceConnectionState}get currentLocalDescription(){return this.peerConnection.currentLocalDescription}get currentRemoteDescription(){return this.peerConnection.currentRemoteDescription}get localCodecs(){return[...new Set(this.localCapabilities&&this.localCapabilities.videoCodecs.map(r=>r.rtpMap&&r.rtpMap.encodingName.toLowerCase()||"").filter(r=>{var s;return ot(s=Object.keys(KA)).call(s,r)}))]}constructor(r,s){super(r,s),$(this,"store",void 0),$(this,"peerConnection",void 0),$(this,"remoteSDP",void 0),$(this,"initialOffer",void 0),$(this,"statsFilter",void 0),$(this,"useRTX",!1),$(this,"localCapabilities",void 0),$(this,"localCandidateCount",0),$(this,"allCandidatesReceived",!1),$(this,"establishPromise",void 0),$(this,"mutex",void 0),this.store=s,this.mutex=new ks("P2PConnection-mutex",s.clientId),this.peerConnection=new RTCPeerConnection(zw.resolvePCConfiguration(r),{optional:[{googDscp:!0}]}),this.statsFilter=nx(this.peerConnection,re("STATS_UPDATE_INTERVAL"),void 0,Dr()?1200:void 0),this.bindPCEvents(),this.bindStatsEvents(),this.store.p2pId=this.store.p2pId+1,this.establishPromise=this.establish()}async establish(){try{const r=await this.peerConnection.createOffer({offerToReceiveAudio:!0,offerToReceiveVideo:!0});if(!r.sdp)throw new Error("Cannot get initialOffer.sdp when trying to establish PeerConnection.");const s=Lm(r.sdp),o=PT(r.sdp,{filterRTX:!this.useRTX,filterVideoFec:re("FILTER_VIDEO_FEC"),filterAudioFec:re("FILTER_AUDIO_FEC"),filterAudioCodec:["opus"]});return this.localCapabilities=o,this.initialOffer=r,rO(rO({},s),{},{rtpCapabilities:{send:{audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},recv:{audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},sendrecv:o},offerSDP:r.sdp})}catch(r){throw new Le(X.GET_LOCAL_CONNECTION_PARAMS_FAILED,r.toString())}}async updateRemoteConnect(){}async connect(r){try{if(!this.initialOffer)throw new Error("Cannot establish P2PConnection without initial offer.");this.remoteSDP=new J_e(rO(rO({},r),{},{rtpCapabilities:r.rtpCapabilities.send,localCapabilities:this.localCapabilities,sdkCodec:this.store.codec}));const s=this.remoteSDP.toString();await this.peerConnection.setLocalDescription(this.initialOffer),await this.peerConnection.setRemoteDescription({type:"answer",sdp:s})}catch(s){throw new Le(X.EXCHANGE_SDP_FAILED,"P2PConnection.connect failed; ".concat(s.toString()))}}async updateRemoteRTPCapabilities(r,s){throw new Le(X.NOT_SUPPORTED,"Planb mode does not support createDataChannels.")}getPreMedia(r){}send(r,s){var o=this;return _l(function*(){const c=yield wn(o.mutex.lock());try{if(!o.remoteSDP)throw new Error("Cannot call P2PConnection.send before remote SDP created");const u=r.map(P=>o.peerConnection.addTrack(P._mediaStreamTrack)),h=yield wn(o.peerConnection.createOffer()),m=Ca(h.sdp),_=r.map(P=>{const k=P._mediaStreamTrack,z=m.mediaDescriptions.find(U=>U.attributes.mid===k.kind);if(!z)throw new Error("Cannot extract ssrc from mediaDescription.");return function(U,F,q){const Y=U.attributes.ssrcs.filter(ye=>ye.attributes.label===F),le=U.attributes.ssrcGroups;if(Y.length===0)throw new Error("Cannot extract ssrc from plan-b SDP.");if(le&&Y.length>1){const ye=le.find(Ee=>Ee.ssrcIds.indexOf(Y[0].ssrcId)!==-1);return ye?[{ssrcId:ye.ssrcIds[0],rtx:q?ye.ssrcIds[1]:void 0}]:[{ssrcId:Y[0].ssrcId}]}return[{ssrcId:Y[0].ssrcId}]}(z,k.id,o.useRTX)});let E;try{E=yield _}catch(P){throw u.forEach(k=>{Ss()&&k.replaceTrack(null),o.peerConnection.removeTrack(k)}),P}const S=o.mungSendOfferSDP(h.sdp,r);o.remoteSDP.receive(r,s,E);const R=o.remoteSDP.toString();return yield wn(o.peerConnection.setLocalDescription({type:"offer",sdp:S})),yield wn(o.applySendEncodings(u,r)),yield wn(o.peerConnection.setRemoteDescription({type:"answer",sdp:R})),r.map((P,k)=>{const z=P._mediaStreamTrack.id;return{localSSRC:_[k],id:z}})}catch(u){throw new Le(X.EXCHANGE_SDP_FAILED,"P2PConnection.send failed; ".concat(u.toString()))}finally{c()}})()}async stopSending(r){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopSending before remote SDP created");const s=this.peerConnection.getSenders().filter(u=>{var h;return r.indexOf(((h=u.track)===null||h===void 0?void 0:h.id)||"")!==-1});if(s.length!==r.length)throw new Error("Transceivers' length doesn't match mids' length when trying to call P2PConnection.stopSending.");s.map(u=>{Ss()&&u.replaceTrack(null),this.peerConnection.removeTrack(u)});const o=await this.peerConnection.createOffer();await this.peerConnection.setLocalDescription(o),this.remoteSDP.stopReceiving(r);const c=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"answer",sdp:c})}catch(s){throw new Le(X.EXCHANGE_SDP_FAILED,"P2PConnection.stopSending failed; ".concat(s.toString()))}}async receive(r,s,o,c){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.receive ".concat(r," before remoteSDP created."));const{id:u,mslabel:h}=this.remoteSDP.send(r,s,c),m=new lt((S,R)=>{const P=setTimeout(()=>{R(new Error("Cannot receive track, id: ".concat(u)))},1e4),k=z=>{const U=Rn();if((U.name==="Safari"&&Number(U.version)===11||vo())&&z.track.id!==u&&z.streams[0].id===h){var F;const q=z.streams[0].getTracks()[0];return(F=this.remoteSDP)===null||F===void 0||F.updateTrackLabel(r,u,z.track.id),this.peerConnection.removeEventListener("track",k),clearTimeout(P),void S(q)}if(z.track.id===u)return this.peerConnection.removeEventListener("track",k),clearTimeout(P),void S(z.track)};this.peerConnection.addEventListener("track",k)}),_=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:_});const E=await this.peerConnection.createAnswer();return await this.peerConnection.setLocalDescription(E),{track:await m,id:u}}catch(u){throw new Le(X.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(u.toString()))}}async stopReceiving(r){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopReceiving before remote SDP created.");this.remoteSDP.stopSending(r);const s=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:s});const o=await this.peerConnection.createAnswer();await this.peerConnection.setLocalDescription(o)}catch(s){throw new Le(X.EXCHANGE_SDP_FAILED,"P2PConnection stopReceiving failed; ".concat(s.toString()))}}async muteRemote(r){}async unmuteRemote(r){}async muteLocal(r){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.muteLocal before remote SDP created.");const s=this.peerConnection.getSenders().filter(o=>{var c;return r.indexOf(((c=o.track)===null||c===void 0?void 0:c.id)||"")!==-1});if(s.length!==r.length)throw new Error("sender' length doesn't match mids' length.");s.map(o=>{if(Ss()&&o.track)o.track.enabled=!1;else{const c=o.getParameters();c.encodings.forEach(u=>u.active=!1),o.setParameters(c)}})}catch(s){throw new Le(X.EXCHANGE_SDP_FAILED,"P2PConnection.muteLocal failed; ".concat(s.toString()))}}async unmuteLocal(r){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.unmuteLocal before remote SDP created.");const s=this.peerConnection.getSenders().filter(u=>{var h;return r.indexOf(((h=u.track)===null||h===void 0?void 0:h.id)||"")!==-1});if(s.length!==r.length)throw new Error("Senders' length doesn't match mids' length.");s.map(async u=>{if(Ss()&&u.track)u.track.enabled=!0;else{const h=u.getParameters();h.encodings.forEach(m=>m.active=!0),await u.setParameters(h)}});const o=await this.peerConnection.createOffer();await this.peerConnection.setLocalDescription(o);const c=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"answer",sdp:c})}catch(s){throw new Le(X.EXCHANGE_SDP_FAILED,"P2PConnection.unmuteLocal failed; ".concat(s.toString()))}}restartICE(r){var s=this;return _l(function*(){const o=yield wn(s.mutex.lock("From P2PConnection.restartICE"));try{if(!s.remoteSDP)throw new Error("Cannot restartICE before remoteSDP created.");const c=kn().supportPCSetConfiguration;if(r===Ds.RELAY&&!c)return;if(c){const E=s.peerConnection.getConfiguration(),S=r===Ds.RELAY?"relay":"all";E.iceTransportPolicy!==S&&(L.debug("[".concat(s.store.clientId,"] restartICE change iceTransportPolicy from [").concat(E.iceTransportPolicy,"] to [").concat(S,"]")),E.iceTransportPolicy=S,s.peerConnection.setConfiguration(E))}r!==Ds.RELAY&&s.remoteSDP.updateCandidates(r);const u=yield wn(s.peerConnection.createOffer({iceRestart:!0}));if(!u.sdp)throw new Error("Cannot restartICE because restart offer SDP does not exist.");const h=Lm(u.sdp),{remoteIceParameters:m}=yield h.iceParameters;s.remoteSDP.restartICE(m);const _=s.remoteSDP.toString();yield wn(s.peerConnection.setLocalDescription(u)),yield wn(s.peerConnection.setRemoteDescription({type:"answer",sdp:_}))}catch(c){L.warning("[".concat(s.store.clientId,"] restart ICE failed, abort operation"),c)}finally{o()}})()}close(){var r;this.peerConnection.close(),(r=this.onConnectionStateChange)===null||r===void 0||r.call(this,"closed"),this.unbindPCEvents(),this.unbindStatsEvents(),this.removeAllListeners(),this.statsFilter.destroy()}getStats(){return this.statsFilter.getStats()}getRemoteVideoIsReady(r){return this.statsFilter.getVideoIsReady(r)}async updateEncoderConfig(r,s){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.updateEncoderConfig before remote SDP created.");const o=await this.peerConnection.createOffer(),c=this.mungSendOfferSDP(o.sdp,[s]);this.remoteSDP.updateRecvMedia(s._mediaStreamTrack.kind,s);const u=this.remoteSDP.toString();await this.peerConnection.setLocalDescription({type:"offer",sdp:c}),await this.peerConnection.setRemoteDescription({type:"answer",sdp:u})}catch(o){throw new Le(X.EXCHANGE_SDP_FAILED,o.toString())}}async updateSendParameters(r,s){const o=this.peerConnection.getSenders().filter(c=>{var u;return((u=c.track)===null||u===void 0?void 0:u.id)===r});o.length===1&&await this.applySendEncodings(o,[s])}setStatsRemoteVideoIsReady(r,s){this.statsFilter.setVideoIsReady2(r,s)}async replaceTrack(r,s){const o=this.peerConnection.getSenders().find(c=>{var u;return((u=c.track)===null||u===void 0?void 0:u.id)===s});o&&await o.replaceTrack(r._mediaStreamTrack)}createDataChannels(r,s){throw new Le(X.NOT_SUPPORTED,"Planb mode does not support createDataChannels.")}stopDataChannels(r){throw new Le(X.NOT_SUPPORTED,"Planb mode does not support stopDataChannels.")}bindPCEvents(){this.peerConnection.oniceconnectionstatechange=()=>{var r;(r=this.onICEConnectionStateChange)===null||r===void 0||r.call(this,this.peerConnection.iceConnectionState)},this.peerConnection.onconnectionstatechange=()=>{var r;(r=this.onConnectionStateChange)===null||r===void 0||r.call(this,this.peerConnection.connectionState)},this.peerConnection.onicecandidate=r=>{r.candidate?this.localCandidateCount+=1:(this.peerConnection.onicecandidate=null,this.allCandidatesReceived=!0,L.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] local candidate count"),this.localCandidateCount))},setTimeout(()=>{this.allCandidatesReceived||(this.allCandidatesReceived=!0,L.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] onicecandidate timeout, local candidate count"),this.localCandidateCount))},re("CANDIDATE_TIMEOUT"))}unbindPCEvents(){this.peerConnection.oniceconnectionstatechange=null,this.peerConnection.onconnectionstatechange=null,this.peerConnection.onsignalingstatechange=null,this.peerConnection.onicecandidateerror=null,this.peerConnection.onicecandidate=null,this.peerConnection.ontrack=null}static resolvePCConfiguration(r){const s={iceServers:[],sdpSemantics:"plan-b"};return r.iceServers?s.iceServers=r.iceServers:r.turnServer&&r.turnServer.mode!=="off"&&(gT(r.turnServer.servers)?s.iceServers=r.turnServer.servers:(s.iceServers&&s.iceServers.push(...zw.turnServerConfigToIceServers(r.turnServer.servers)),re("USE_TURN_SERVER_OF_GATEWAY")&&s.iceServers&&r.turnServer.serversFromGateway&&s.iceServers.push(...zw.turnServerConfigToIceServers(r.turnServer.serversFromGateway)),r.turnServer.servers.concat(r.turnServer.serversFromGateway||[]).forEach(o=>{o.forceturn&&(s.iceTransportPolicy="relay")}))),s}static turnServerConfigToIceServers(r){const s=[];return r.forEach(o=>{o.security?o.tcpport&&s.push({username:o.username,credential:o.password,credentialType:"password",urls:"turns:".concat(o.turnServerURL,":").concat(o.tcpport,"?transport=tcp")}):(o.udpport&&s.push({username:o.username,credential:o.password,credentialType:"password",urls:"turn:".concat(o.turnServerURL,":").concat(o.udpport,"?transport=udp")}),o.tcpport&&s.push({username:o.username,credential:o.password,credentialType:"password",urls:"turn:".concat(o.turnServerURL,":").concat(o.tcpport,"?transport=tcp")}))}),s}async updateRtpSenderEncodings(r,s){var o;if(s||(s=this.peerConnection.getSenders().find(E=>{var S;return((S=E.track)===null||S===void 0?void 0:S.id)===r._mediaStreamTrack.id})),!s)return L.warn("[".concat(r.getTrackId(),"] no rtpSender found}"));if(!kn().supportSetRtpSenderParameters)return L.warn("Browser not support set rtp-sender parameters");const c={},u={};if(r instanceof _r)switch(r._optimizationMode){case"motion":c.degradationPreference="maintain-framerate";break;case"detail":c.degradationPreference="maintain-resolution";break;default:c.degradationPreference="balanced"}if(re("DSCP_TYPE")&&Kf()){var h;const E=re("DSCP_TYPE");ot(h=["very-low","low","medium","high"]).call(h,E)&&(u.networkPriority=E)}const m=s.getParameters(),_=(o=m.encodings)===null||o===void 0?void 0:o[0];_&&Object.assign(_,u),Object.assign(m,c),L.debug("[".concat(r.getTrackId(),"] updateRtpSenderEncodings: ").concat(JSON.stringify(m.encodings))),await s.setParameters(m)}async applySendEncodings(r,s){try{if(!kn().supportSetRtpSenderParameters||r.length!==s.length)return;for(let o=0;o<r.length;o++){const c=r[o],u=s[o];c&&u&&await this.updateRtpSenderEncodings(u,c)}}catch{L.debug("[".concat(this.store.clientId,"] Apply RTPSendEncodings failed."))}}mungSendOfferSDP(r,s){const o=Ca(r);return s.forEach((c,u)=>{const h=c._mediaStreamTrack,m=o.mediaDescriptions.find(_=>_.attributes.mid===h.kind);m&&Zv(m,c)}),Pm(o)}bindStatsEvents(){this.statsFilter.onFirstAudioReceived=r=>{var s;(s=this.onFirstAudioReceived)===null||s===void 0||s.call(this,r)},this.statsFilter.onFirstVideoReceived=r=>{var s;(s=this.onFirstVideoReceived)===null||s===void 0||s.call(this,r)},this.statsFilter.onFirstAudioDecoded=r=>{var s;(s=this.onFirstAudioDecoded)===null||s===void 0||s.call(this,r)},this.statsFilter.onFirstVideoDecoded=(r,s,o)=>{var c;(c=this.onFirstVideoDecoded)===null||c===void 0||c.call(this,r,s,o)},this.statsFilter.onSelectedLocalCandidateChanged=(r,s)=>{var o;(o=this.onSelectedLocalCandidateChanged)===null||o===void 0||o.call(this,r,s)},this.statsFilter.onSelectedRemoteCandidateChanged=(r,s)=>{var o;(o=this.onSelectedRemoteCandidateChanged)===null||o===void 0||o.call(this,r,s)}}unbindStatsEvents(){this.statsFilter.onFirstAudioReceived=void 0,this.statsFilter.onFirstVideoReceived=void 0,this.statsFilter.onFirstAudioDecoded=void 0,this.statsFilter.onFirstVideoDecoded=void 0,this.statsFilter.onSelectedLocalCandidateChanged=void 0,this.statsFilter.onSelectedRemoteCandidateChanged=void 0}async batchReceive(r){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.batchReceive before remoteSDP created.");const s=this.remoteSDP.batchSend(r).map((u,h)=>{let{id:m,mslabel:_}=u;const{kind:E}=r[h];return new lt((S,R)=>{const P=setTimeout(()=>{R(new Error("Cannot receive track, id: ".concat(m)))},1e4),k=z=>{const U=Rn();if(U.name==="Safari"&&Number(U.version)===11&&z.track.id!==m&&z.streams[0].id===_){var F;const q=z.streams[0].getTracks()[0];return(F=this.remoteSDP)===null||F===void 0||F.updateTrackLabel(E,m,z.track.id),this.peerConnection.removeEventListener("track",k),clearTimeout(P),void S({track:q,id:m})}if(z.track.id===m)return this.peerConnection.removeEventListener("track",k),clearTimeout(P),void S({track:z.track,id:m})};this.peerConnection.addEventListener("track",k)})}),o=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:o});const c=await this.peerConnection.createAnswer();return await this.peerConnection.setLocalDescription(c),await lt.all(s)}catch(s){throw new Le(X.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(s.toString()))}}async getRemoteSSRC(r){if(!this.remoteSDP)return;const s=this.remoteSDP.getSSRC(r);return s==null?void 0:s[0].ssrcId}setConfiguration(r){if(kn().supportPCSetConfiguration){const s=zw.resolvePCConfiguration(r);this.peerConnection.setConfiguration(s)}}},vt(rr.prototype,"connect",[Rl],Object.getOwnPropertyDescriptor(rr.prototype,"connect"),rr.prototype),vt(rr.prototype,"stopSending",[Rl],Object.getOwnPropertyDescriptor(rr.prototype,"stopSending"),rr.prototype),vt(rr.prototype,"receive",[Rl],Object.getOwnPropertyDescriptor(rr.prototype,"receive"),rr.prototype),vt(rr.prototype,"stopReceiving",[Rl],Object.getOwnPropertyDescriptor(rr.prototype,"stopReceiving"),rr.prototype),vt(rr.prototype,"muteRemote",[Rl],Object.getOwnPropertyDescriptor(rr.prototype,"muteRemote"),rr.prototype),vt(rr.prototype,"unmuteRemote",[Rl],Object.getOwnPropertyDescriptor(rr.prototype,"unmuteRemote"),rr.prototype),vt(rr.prototype,"muteLocal",[Rl],Object.getOwnPropertyDescriptor(rr.prototype,"muteLocal"),rr.prototype),vt(rr.prototype,"unmuteLocal",[Rl],Object.getOwnPropertyDescriptor(rr.prototype,"unmuteLocal"),rr.prototype),vt(rr.prototype,"close",[Rl],Object.getOwnPropertyDescriptor(rr.prototype,"close"),rr.prototype),vt(rr.prototype,"updateEncoderConfig",[Rl],Object.getOwnPropertyDescriptor(rr.prototype,"updateEncoderConfig"),rr.prototype),vt(rr.prototype,"updateSendParameters",[Rl],Object.getOwnPropertyDescriptor(rr.prototype,"updateSendParameters"),rr.prototype),vt(rr.prototype,"replaceTrack",[Rl],Object.getOwnPropertyDescriptor(rr.prototype,"replaceTrack"),rr.prototype),vt(rr.prototype,"getRemoteSSRC",[Rl],Object.getOwnPropertyDescriptor(rr.prototype,"getRemoteSSRC"),rr.prototype),rr);function Rl(t,r,s){const o=t[r];if(typeof o!="function")throw new Error("Cannot use mutex on object property.");return s.value=async function(){const c=this.mutex,u=await c.lock("Locking from P2PConnection.".concat(r));try{for(var h=arguments.length,m=new Array(h),_=0;_<h;_++)m[_]=arguments[_];return await o.apply(this,m)}finally{u()}},s}const Z_e={name:"PlanBConnection",create:function(t){let{store:r,spec:s}=t;return new Q_e(s,r)}},eye={interceptLocalAudioFrame:async function(t){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(!kn().supportWebRTCEncodedTransform)return void L.warning("browser not support audio encoded transform");if(nP.has(t)||!t.track)return;const s={track:t.track};if($f()){if(!t.createEncodedStreams)return void L.warning("browser not support createEncodedStreams() API");let c=null;try{c=t.createEncodedStreams()}catch(h){return void L.error("create audio-encoded-streams error",h&&h.message)}const u=new TransformStream({transform(h,m){s.controller||(s.controller=m),t.track&&t.track.id!==s.track.id&&(L.debug("audio track changed: ".concat(s.track.id," => ").concat(t.track.id)),s.track.removeEventListener("ended",o),s.track=t.track,s.track.addEventListener("ended",o));const _=r.metadata&&r.metadata();_?function(E,S){const{chunk:R,controller:P}=S,k=re("ENABLE_AUDIO_PTS_METADATA")?Jf.AUDIO_64_BIT_PTS:Jf.METADATA;R.data=function(z,U,F){const q=F.byteLength,Y=q+Cx+OG,le=wx+Rx+Y,ye=new ArrayBuffer(z.byteLength+le),Ee=new DataView(ye);Ee.setUint8(0,PG),Ee.setUint16(1,Y),Ee.setUint8(3,U),Ee.setUint16(4,q);for(let ke=0;ke<q;ke++)Ee.setUint8(6+ke,F[ke]);const me=new Uint8Array(Ee.buffer);return me.set(new Uint8Array(z),le),me.buffer}(R.data,k,E),P.enqueue(R)}(_,{chunk:h,controller:m}):m.enqueue(h)}});c.readable.pipeThrough(u).pipeTo(c.writable)}else if(Ss()){if(typeof RTCRtpScriptTransform>"u")return void L.warning("browser not support RTCRtpScriptTransform");const c=tP(),u=new MessageChannel;await new lt(m=>c.onmessage=_=>{_.data==="registered"&&m(void 0)});const h=new RTCRtpScriptTransform(c,{name:"audio-metadata-tx",port:u.port2},[u.port2]);t.transform=h,await new lt(m=>c.onmessage=_=>{_.data==="started"&&m(void 0)}),u.port1.onmessage=m=>{var _;if(m.data.transformed&&t.track&&((_=t.track)===null||_===void 0?void 0:_.id)!==s.track.id)L.debug("audio track changed: ".concat(s.track.id," => ").concat(t.track.id)),s.track.removeEventListener("ended",o),s.track=t.track,s.track.addEventListener("ended",o);else if(m.data.getMetadata){const E=r.metadata&&r.metadata();E&&u.port1.postMessage({metadata:E})}},s.worker=c}function o(){if(t.track){if(this.id!==t.track.id)return;t.track.removeEventListener("ended",o)}const c=nP.get(t);if(c){nP.delete(t);try{var u,h;(u=c.controller)===null||u===void 0||u.terminate(),(h=c.worker)===null||h===void 0||h.terminate()}catch(m){L.warning(m&&m.message)}}}nP.set(t,s),t.track.addEventListener("ended",o)},interceptRemoteAudioFrame:async function(t){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(!kn().supportWebRTCEncodedTransform)return void L.warning("browser not support audio encoded transform");if(cP.has(t))return;const s={track:t.track,onMetadata:r.onMetadata};if($f()){if(!t.createEncodedStreams)return void L.warning("browser not support createEncodedStreams() API");VL(Un.CHROME,87,116)||(r.enableTopn=!1);let c=null;try{c=t.createEncodedStreams()}catch(h){return void L.error("create audio-encoded-streams error",h&&h.message)}const u=new TransformStream({transform(h,m){s.controller||(s.controller=m),t.track&&t.track.id!==s.track.id&&(L.debug("audio track changed: ".concat(s.track.id," => ").concat(t.track.id)),s.track.removeEventListener("ended",o),s.track=t.track,s.track.addEventListener("ended",o)),r.enableTopn?function(_,E,S){var R;const P=kG(new DataView(E.data));if(!P)return S.enqueue(E);const k=_.track.id;Lpe.set(k,_.track);const z=(R=P.tlv.find(ye=>ye.tag===Jf.AUDIO_LEVEL))===null||R===void 0?void 0:R.value;let U=0;typeof z=="number"&&(U=127-z);const F=Math.round(Math.pow(10,U/60)-1),{selected:q,speaker:Y}=function(ye,Ee){let me=$v.get(ye);if(me||(me=function(ke){const Ye=new DG;return $v.set(ke,Ye),gd||(gd=new Npe(re("TOPN_SILENCE_THRESHOLD")||500),gd.on("ActiveSpeakerChanged",ut=>{ut!=null&&(sP=ut)})),gd.addSpeakers([Ye]),Ye}(ye)),$v.size<=LG)return{selected:!0,speaker:me};if(!gd)throw new Error("no active speaker detector");return gd.levelChanged(me.id,Ee),j_=gd.loudest.map(ke=>ke.id),sP&&!ot(j_).call(j_,sP)&&j_.length>=LG&&j_.pop(),{selected:ot(j_).call(j_,me.id)||me.id===sP,speaker:me}}(_,F),le=function(ye,Ee,me){const ke=_d.get(ye)||new Dpe(ye,Ee);return ke.score=me,_d.set(ye,ke),function(Ye){if(oP.set(Ye,!0),!aP)return void(aP=Date.now());const ut=Date.now();ut-aP>1e3&&(oP.get(Ye)?oP.set(Ye,!1):(xG(Ye),oP.delete(Ye)),aP=ut)}(ye),ke}(k,_.track,Y.energyScore);le.addSample(q),le.active&&(E.data=P.frame.buffer,S.enqueue(E))}(t,h,m):r.enableMetadata?function(_,E,S){const R=kG(new DataView(_.data));if(!R)return E.enqueue(_);const P=R.tlv.find(k=>k.tag===Jf.METADATA||k.tag===Jf.AUDIO_64_BIT_PTS);P&&S&&P.value instanceof Uint8Array&&S(P.value),_.data=R.frame.buffer,E.enqueue(_)}(h,m,r.onMetadata):m.enqueue(h)}});c.readable.pipeThrough(u).pipeTo(c.writable)}else if(Ss()){if(typeof RTCRtpScriptTransform>"u")return void L.warning("browser not support RTCRtpScriptTransform");const c=tP(),u=new MessageChannel;await new lt(m=>c.onmessage=_=>{_.data==="registered"&&m(void 0)});const h=new RTCRtpScriptTransform(c,{name:"audio-metadata-rx",port:u.port2},[u.port2]);t.transform=h,await new lt(m=>c.onmessage=_=>{_.data==="started"&&m(void 0)}),u.port1.onmessage=m=>{var _;m.data.transformed&&t.track&&((_=t.track)===null||_===void 0?void 0:_.id)!==s.track.id?(L.debug("audio track changed: ".concat(s.track.id," => ").concat(t.track.id)),s.track.removeEventListener("ended",o),s.track=t.track,s.track.addEventListener("ended",o)):m.data.metadata&&s.onMetadata&&s.onMetadata(m.data.metadata)},s.worker=c}function o(){t.track.removeEventListener("ended",o),function(c){const u=cP.get(c);if(u){(function(_){const E=$v.get(_);E&&($v.delete(_),gd&&(gd.removeSpeakers([E]),$v.size===0&&(gd.destroy(),gd=null)))})(c),xG(c.track.id),cP.delete(c);try{var h,m;(h=u.controller)===null||h===void 0||h.terminate(),(m=u.worker)===null||m===void 0||m.terminate()}catch(_){L.warning(_&&_.message)}}}(t)}cP.set(t,s),t.track.addEventListener("ended",o)},interceptLocalVideoFrame:async function(t,r){if(!kn().supportWebRTCEncodedTransform)return void L.warning("browser not support video encoded transform");if(lP.has(t)||!t.track)return;const s={track:t.track};if($f()){if(!t.createEncodedStreams)return void L.warning("browser not support createEncodedStreams() API");let c=null;try{c=t.createEncodedStreams()}catch(m){return void L.error("create video-encoded-streams error",m&&m.message)}const u=[];r.on("sei-to-send",m=>{u.push(m)});const h=new TransformStream({transform(m,_){s.controller||(s.controller=_),t.track&&t.track.id!==s.track.id&&(L.debug("video track changed: ".concat(s.track.id," => ").concat(t.track.id)),s.track.removeEventListener("ended",o),s.track=t.track,s.track.addEventListener("ended",o));const E=u.shift();E&&(m.data=function(S,R){const P=function(Y){const le=Y.length;let ye=[],Ee=0;for(;Ee<le;)Ee+2<le&&Y[Ee]===0&&Y[Ee+1]===0&&(Y[Ee+2]===0||Y[Ee+2]===1||Y[Ee+2]===2||Y[Ee+2]===3)?(ye.push(Y[Ee],Y[Ee+1],3,Y[Ee+2]),Ee+=3):(ye.push(Y[Ee]),Ee++);return new Uint8Array(ye)}(R),k=P.length,z=Math.floor(k/255),U=k%255,F=new Uint8Array(6+z+1+k+S.byteLength);F[0]=0,F[1]=0,F[2]=0,F[3]=1,F[4]=6,F[5]=101;let q=0;for(;q<z;)F[6+q]=255,q++;return F[6+q]=U,q++,F.set(P,6+q),F.set(new Uint8Array(S),6+q+k),F.buffer}(m.data,E)),_.enqueue(m)}});c.readable.pipeThrough(h).pipeTo(c.writable)}else{if(!Ss())return;{if(typeof RTCRtpScriptTransform>"u")return void L.warning("browser not support RTCRtpScriptTransform");const c=tP(),u=new MessageChannel;await new lt(m=>c.onmessage=_=>{_.data==="registered"&&m(void 0)});const h=new RTCRtpScriptTransform(c,{name:"sei-tx",port:u.port2},[u.port2]);t.transform=h,await new lt(m=>c.onmessage=_=>{_.data==="started"&&m(void 0)}),r.on("sei-to-send",m=>{u.port1.postMessage({sei:m})}),u.port1.onmessage=m=>{var _;m.data.transformed&&t.track&&((_=t.track)===null||_===void 0?void 0:_.id)!==s.track.id&&(L.debug("video track changed: ".concat(s.track.id," => ").concat(t.track.id)),s.track.removeEventListener("ended",o),s.track=t.track,s.track.addEventListener("ended",o))},s.worker=c}}function o(){if(t.track){if(this.id!==t.track.id)return;t.track.removeEventListener("ended",o)}const c=lP.get(t);if(c){lP.delete(t);try{var u,h;(u=c.controller)===null||u===void 0||u.terminate(),(h=c.worker)===null||h===void 0||h.terminate()}catch(m){L.warning(m&&m.message)}}}lP.set(t,s),t.track.addEventListener("ended",o)},interceptRemoteVideoFrame:async function(t){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(!kn().supportWebRTCEncodedTransform)return void L.warning("browser not support video encoded transform");if(!t.track)return;if(TT.has(t)){const c=TT.get(t);return void(c&&(c.onSei=r.onSei))}const s={track:t.track,onSei:r.onSei};if($f()){if(!t.createEncodedStreams)return void L.warning("browser not support createEncodedStreams() API");let c=null;try{c=t.createEncodedStreams()}catch(h){return void L.error("create video-encoded-streams error",h&&h.message)}const u=new TransformStream({transform(h,m){s.controller||(s.controller=m),t.track&&t.track.id!==s.track.id&&(L.debug("video track changed: ".concat(s.track.id," => ").concat(t.track.id)),s.track.removeEventListener("ended",o),s.track=t.track,s.track.addEventListener("ended",o));const _=function(E){const S=new DataView(E.data);let R=0;for(;R+4<E.data.byteLength;){if(S.getUint8(R+0)===0&&S.getUint8(R+1)===0&&S.getUint8(R+2)===0&&S.getUint8(R+3)===1&&S.getUint8(R+4)===6){let P=R+6,k=0,z=0;for(;(z=S.getUint8(P++))===255;)k+=255;k+=z;const U=xpe(E.data,P,k);return new Uint8Array(U)}R++}return null}(h);_&&s.onSei&&s.onSei(_),m.enqueue(h)}});c.readable.pipeThrough(u).pipeTo(c.writable)}else if(Ss()){if(typeof RTCRtpScriptTransform>"u")return void L.warning("browser not support RTCRtpScriptTransform");const c=tP(),u=new MessageChannel;await new lt(m=>c.onmessage=_=>{_.data==="registered"&&m(void 0)});const h=new RTCRtpScriptTransform(c,{name:"sei-rx",port:u.port2},[u.port2]);t.transform=h,await new lt(m=>c.onmessage=_=>{_.data==="started"&&m(void 0)}),u.port1.onmessage=m=>{var _;m.data.transformed&&t.track&&((_=t.track)===null||_===void 0?void 0:_.id)!==s.track.id?(L.debug("video track changed: ".concat(s.track.id," => ").concat(t.track.id)),s.track.removeEventListener("ended",o),s.track=t.track,s.track.addEventListener("ended",o)):m.data.sei&&s.onSei&&s.onSei(m.data.sei)},s.worker=c}function o(){if(t.track){if(this.id!==t.track.id)return;t.track.removeEventListener("ended",o)}(function(c){const u=TT.get(c);if(u){TT.delete(c);try{var h,m;(h=u.controller)===null||h===void 0||h.terminate(),(m=u.worker)===null||m===void 0||m.terminate()}catch(_){L.warning(_&&_.message)}}})(t)}TT.set(t,s),t.track.addEventListener("ended",o)}},tye={name:"InterceptFrame",create:()=>eye};rx(),Xn("PROCESS_ID","process-".concat(or(8,""),"-").concat(or(4,""),"-").concat(or(4,""),"-").concat(or(4,""),"-").concat(or(12,""))),function(){let t;try{t=window.localStorage.getItem("websdk_ng_global_parameter")}catch(r){return void L.error("Error loading sdk config",r.message)}if(t)try{const r=JSON.parse(window.atob(t)),s=Date.now();L.debug("Loading global parameters from cache",r),Object.keys(r).forEach(o=>{if(Object.prototype.hasOwnProperty.call(gr,o)){const{value:c,expires:u}=r[o];if(u&&u<=s)return;md[o]=c,gr[o]=c}})}catch(r){L.error("Error loading mutableParamsCache: ".concat(t),r.message)}}(),Array.isArray(md.AREAS)&&md.AREAS.length>0&&qx(md.AREAS,!0);const V$=(t,r,s)=>{L.debug("setParameter key:".concat(t,", value:").concat(JSON.stringify(r))),Xn(t,r,s)};xm(w_e,!1),xm(I_e,!1),xm(oge,!1),xm(V_e,!1),xm(S_e,!1),xm(X_e,!1),xm(Z_e,!1),xm(tye,!1);const Ti=function(t){const r=new Pr,s=t,o={getListeners:r.getListeners.bind(r),on:(c,u)=>(function(h,m){h===Sh.SECURITY_POLICY_VIOLATION&&y7(m,!0)}(c,u),r.on.bind(r)(c,u)),addListener:r.addListener.bind(r),once:r.once.bind(r),off:r.off.bind(r),removeAllListeners:r.removeAllListeners.bind(r),emit:r.emit.bind(r),safeEmit:r.safeEmit.bind(r)};return _7(_7({},s),o)}({__TRACK_LIST__:Mv,VERSION:yl,BUILD:ox,ESM_BUNDLER:!1,ESM:!1,UMD:!0,DEV:!1,setParameter:V$,getParameter:re,getSupportedCodec:async function(){let t={audio:[],video:[]};try{let r=new RTCPeerConnection;const s=await async function(o){let c;return kn().supportUnifiedPlan?(o.addTransceiver("video",{direction:"recvonly"}),o.addTransceiver("audio",{direction:"recvonly"}),c=(await o.createOffer()).sdp):c=(await o.createOffer({offerToReceiveAudio:!0,offerToReceiveVideo:!0})).sdp,c}(r);if(!s)return t;r.close(),r=null,t=function(o){const c={video:[],audio:[]};return o.match(/ VP8/i)&&c.video.push("VP8"),o.match(/ VP9/i)&&c.video.push("VP9"),o.match(/ AV1/i)&&c.video.push("AV1"),o.match(/ H264/i)&&c.video.push("H264"),o.match(/ H265/i)&&c.video.push("H265"),o.match(/ opus/i)&&c.audio.push("OPUS"),o.match(/ PCMU/i)&&c.audio.push("PCMU"),o.match(/ PCMA/i)&&c.audio.push("PCMA"),o.match(/ G722/i)&&c.audio.push("G722"),c}(s)}catch(r){throw new Oe(X.CREATE_OFFER_FAILED,r.toString&&r.toString()).print()}return t},checkSystemRequirements:function(){const t=Rt.reportApiInvoke(null,{name:Si.CHECK_SYSTEM_REQUIREMENTS,options:[],tag:xr.TRACER});let r=!1;try{const u=window.RTCPeerConnection,h=navigator.mediaDevices&&navigator.mediaDevices.getUserMedia,m=window.WebSocket;r=!!(u&&h&&m),r&&WL()&&FW(75)&&new u().close()}catch(u){return L.error("check system requirement failed: ",u),!1}let s=!1;const o=Rn();o.name===Un.CHROME&&Number(o.version)>=58&&(fd.engine.name!=="WebKit"||function(){const u=Rn();if(VA()){if(u.os===zi.MAC_OS)return!0;if(u.os===zi.IOS){const h=fd.os.version&&fd.os.version.split(".");if(h&&Number(h[0])===14&&h[1]&&Number(h[1])>=3||h&&Number(h[0])>14)return!0}}return!1}())&&(s=!0),(o.name===Un.FIREFOX&&Number(o.version)>=56||o.name===Un.OPERA&&Number(o.version)>=45||o.name===Un.SAFARI&&Number(o.version)>=11||o.name==="WebKit"&&(vo()||lu())&&o.osVersion&&Number(o.osVersion.split(".")[0])>=11||HW()||Rn().name===Un.QQ)&&(s=!0),L.debug("checkSystemRequirements, api:",r,"browser",s);const c=r&&s;return t.onSuccess(c),c},getDevices:function(t){return Fc.enumerateDevices(!0,!0,t)},getMicrophones:function(t){return Fc.getRecordingDevices(t)},getCameras:function(t){return Fc.getCamerasDevices(t)},getElectronScreenSources:F8,getPlaybackDevices:function(t){return Fc.getSpeakers(t)},createClient:function(){var t;let r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{codec:"vp8",audioCodec:"opus",mode:"rtc"};const s=or(5,"client-"),o=Rt.reportApiInvoke(null,{id:s,name:Si.CREATE_CLIENT,options:[r],tag:xr.TRACER});try{(function(c){Di(c.codec,"config.codec",["vp8","vp9","av1","h264","h265"]),Di(c.mode,"config.mode",["rtc","live","p2p"]),c.audioCodec!==void 0&&Di(c.audioCodec,"config.audioCodec",["opus","pcmu","pcma","g722"]),c.proxyServer!==void 0&&ss(c.proxyServer,"config.proxyServer",1,1e4),c.turnServer!==void 0&&ZW(c.turnServer),c.httpRetryConfig!==void 0&&QW(c.httpRetryConfig),c.websocketRetryConfig!==void 0&&QW(c.websocketRetryConfig)})(r)}catch(c){throw o.onError(c),c}return(BW(16,0)||WW(16,0,!0))&&(r.codec==="vp9"&&(r.codec="vp8",L.debug("browser not support vp9, force use vp8")),Xn("UNSUPPORTED_VIDEO_CODEC",["vp9"])),r.audioCodec===void 0&&(r.audioCodec="opus"),o.onSuccess(),new age(_u(_u({forceWaitGatewayResponse:!0},r),{},{role:ot(t=["rtc","p2p"]).call(t,r.mode)?"host":r.role||"audience"}),s)},createCameraVideoTrack:async function(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const r=re("CAMERA_CAPTURE_CONFIG"),s=or(8,"track-cam-"),o=Rt.reportApiInvoke(null,{id:s,tag:xr.TRACER,name:Si.CREATE_CAM_VIDEO_TRACK,options:[Cr({},t),r]});r&&(t.encoderConfig=r);const c=ZA(t);let u=null;L.info("start create camera video track with config",JSON.stringify(t),"trackId",s);try{u=(await Vc({video:c},s)).getVideoTracks()[0]||null}catch(m){throw o.onError(m),m}if(!u){const m=new Le(X.UNEXPECTED_ERROR,"can not find track in media stream");return o.onError(m),m.throw(L)}t.optimizationMode&&Tx(s,u,t,yh(t.encoderConfig));const h=new bx(u,t,c,t.scalabiltyMode?YA(t.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},t.optimizationMode,s);return o.onSuccess(h.getTrackId()),L.info("create camera video success, trackId:",s),h},createCustomVideoTrack:function(t){const r=or(8,"track-cus-"),s=Rt.reportApiInvoke(null,{id:r,tag:xr.TRACER,name:Si.CREATE_CUSTOM_VIDEO_TRACK,options:[t]}),o=new _r(t.mediaStreamTrack,{width:t.width,height:t.height,frameRate:t.frameRate,bitrateMax:t.bitrateMax,bitrateMin:t.bitrateMin},t.scalabiltyMode?YA(t.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},t.optimizationMode,r,[ar.CUSTOM_TRACK]);return s.onSuccess(o.getTrackId()),L.info("create custom video track success with config",t,"trackId",o.getTrackId()),o},createScreenVideoTrack:async function(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"disable";const s=typeof r=="object"?function(P){return Y8(P)}(r):void 0;s&&(r="auto");const o=or(8,"track-scr-v-"),c=Rt.reportApiInvoke(null,{id:o,tag:xr.TRACER,name:Si.CREATE_SCREEN_VIDEO_TRACK,options:[Cr({},t),r]});t.encoderConfig?typeof t.encoderConfig=="string"||t.encoderConfig.width&&t.encoderConfig.height||(t.encoderConfig.width={max:1920},t.encoderConfig.height={max:1080}):t.encoderConfig="1080p_2";const u=function(P){const k={};P.screenSourceType&&(k.mediaSource=P.screenSourceType),P.extensionId&&$f()&&(k.extensionId=P.extensionId);const{displaySurface:z,selfBrowserSurface:U,surfaceSwitching:F,systemAudio:q,preferCurrentTab:Y}=P;(hT(107)||FL(107)||jL(93))&&(z&&(Di(z,"displaySurface",["browser","window","monitor"]),k.displaySurface=z),U?(Di(U,"selfBrowserSurface",["exclude","include"]),k.selfBrowserSurface=U):k.selfBrowserSurface="include",F&&(Di(F,"surfaceSwitching",["exclude","include"]),k.surfaceSwitching=F)),(hT(105)||FL(105)||jL(91))&&q&&(Di(q,"systemAudio",["exclude","include"]),k.systemAudio=q),(hT(94)||FL(94)||jL(80))&&Y&&(k.preferCurrentTab=!0),P.electronScreenSourceId&&(k.sourceId=P.electronScreenSourceId);const le=P.encoderConfig?dx(P.encoderConfig):null;return k.mandatory={chromeMediaSource:"desktop",maxWidth:le?le.width:void 0,maxHeight:le?le.height:void 0},le&&(le.frameRate&&(typeof le.frameRate=="number"?(k.mandatory.maxFrameRate=le.frameRate,k.mandatory.minFrameRate=le.frameRate):(k.mandatory.maxFrameRate=le.frameRate.max||le.frameRate.ideal||le.frameRate.exact||void 0,k.mandatory.minFrameRate=le.frameRate.min||le.frameRate.ideal||le.frameRate.exact||void 0),k.frameRate=le.frameRate),le.width&&(k.width=le.width),le.height&&(k.height=le.height)),k}(t);let h=null,m=null;const _=kn();if(!_.supportShareAudio&&r==="enable"){const P=new Le(X.NOT_SUPPORTED,"your browser or platform is not support share-screen with audio");return c.onError(P),P.throw(L)}L.info("start create screen video track with config",t,"withAudio",r,"trackId",o);const E=_.supportShareAudio&&r!=="disable";try{const P=await Vc({screen:u,screenAudio:E?s||!0:void 0},o);h=P.getVideoTracks()[0]||null,m=P.getAudioTracks()[0]||null}catch(P){throw c.onError(P),P}if(!h){const P=new Le(X.UNEXPECTED_ERROR,"can not find track in media stream");return c.onError(P),P.throw(L)}if(!m&&r==="enable"){h&&h.stop();const P=new Le(X.SHARE_AUDIO_NOT_ALLOWED);return c.onError(P),P.throw(L)}t.optimizationMode||(t.optimizationMode="detail"),t.optimizationMode&&(Tx(o,h,t,t.encoderConfig&&dx(t.encoderConfig)||void 0),t.encoderConfig&&typeof t.encoderConfig!="string"&&(t.encoderConfig.bitrateMin=t.encoderConfig.bitrateMax));const S=new _r(h,t.encoderConfig?dx(t.encoderConfig):{},t.scalabiltyMode?YA(t.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},t.optimizationMode,o,[ar.SCREEN_TRACK]);if(!m)return c.onSuccess(S.getTrackId()),L.info("create screen video track success","video:",S.getTrackId()),S;const R=new Br(m,void 0,or(8,"track-scr-a-"),!1);return c.onSuccess([S.getTrackId(),R.getTrackId()]),L.info("create screen video track success","video:",S.getTrackId(),"audio:",R.getTrackId()),[S,R]},createMicrophoneAndCameraTracks:async function(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const s=re("CAMERA_CAPTURE_CONFIG"),o=or(8,"track-mic-"),c=or(8,"track-cam-"),u=Rt.reportApiInvoke(null,{id:"".concat(o,"-").concat(c),tag:xr.TRACER,name:Si.CREATE_MIC_AND_CAM_TRACKS,options:[t,r,s]});s&&(r.encoderConfig=s);const h=ZA(r),m=X8(t);let _=null,E=null;L.info("start create camera video track(".concat(c,") and microphone audio track(").concat(o,") with config, audio: ").concat(JSON.stringify(t),", video: ").concat(JSON.stringify(r)));try{const P=await Vc({audio:m,video:h},"".concat(o,"-").concat(c));_=P.getAudioTracks()[0],E=P.getVideoTracks()[0]}catch(P){throw u.onError(P),P}if(!_||!E){const P=new Le(X.UNEXPECTED_ERROR,"can not find tracks in media stream");return u.onError(P),P.throw(L)}r.optimizationMode&&Tx(c,E,r,yh(r.encoderConfig));const S=new eP(_,t,m,o),R=new bx(E,r,h,r.scalabiltyMode?YA(r.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},r.optimizationMode,c);return u.onSuccess([S.getTrackId(),R.getTrackId()]),L.info("create camera video track(".concat(c,") and microphone audio track(").concat(o,") success")),[S,R]},createMicrophoneAudioTrack:async function(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const r=or(8,"track-mic-"),s=Rt.reportApiInvoke(null,{id:r,tag:xr.TRACER,name:Si.CREATE_MIC_AUDIO_TRACK,options:[t]}),o=X8(t);let c=null;L.info("start create microphone audio track with config",JSON.stringify(t),"trackId",r);try{c=(await Vc({audio:o},r)).getAudioTracks()[0]||null}catch(h){throw s.onError(h),h}if(!c){const h=new Le(X.UNEXPECTED_ERROR,"can not find track in media stream");return s.onError(h),h.throw(L)}const u=new eP(c,t,o,r);return s.onSuccess(u.getTrackId()),L.info("create microphone audio track success, trackId:",r),u},createCustomAudioTrack:function(t){const r=or(8,"track-cus-"),s=Rt.reportApiInvoke(null,{id:r,tag:xr.TRACER,name:Si.CREATE_CUSTOM_AUDIO_TRACK,options:[t]}),o=new Br(t.mediaStreamTrack,t.encoderConfig?XA(t.encoderConfig):{},r,!1);return L.info("create custom audio track success with config",t,"trackId",o.getTrackId()),s.onSuccess(o.getTrackId()),o},createBufferSourceAudioTrack:async function(t){var r;const{cacheOnlineFile:s,encoderConfig:o}=t;let{source:c}=t;const u={source:c instanceof AudioBuffer?"AudioBuffer":c instanceof File?(r=File.name)!==null&&r!==void 0?r:"File":c,cacheOnlineFile:s,encoderConfig:o},h=or(8,"track-buf-"),m=Rt.reportApiInvoke(null,{id:h,tag:xr.TRACER,name:Si.CREATE_BUFFER_AUDIO_TRACK,options:[u]});if(re("DISABLE_WEBAUDIO"))throw new Le(X.NOT_SUPPORTED,"can not create BufferSourceAudioTrack when WebAudio disabled");L.info("start create buffer source audio track with config",JSON.stringify(u),"trackId",h);const _=c;if(!(c instanceof AudioBuffer))try{c=await async function(R,P){let k=null;if(typeof R=="string"){const U=Mz.get(R);if(U)return L.debug("use cached audio resource: ",R),U;try{k=(await pd(()=>$o.get(R,{responseType:"arraybuffer"}),void 0,void 0,{maxRetryCount:3})).data}catch(F){throw new Le(X.FETCH_AUDIO_FILE_FAILED,F.toString())}}else k=await new lt((F,q)=>{const Y=new FileReader;Y.onload=le=>{le.target?F(le.target.result):q(new Le(X.READ_LOCAL_AUDIO_FILE_ERROR))},Y.onerror=()=>{q(new Le(X.READ_LOCAL_AUDIO_FILE_ERROR))},Y.readAsArrayBuffer(R)});const z=await function(U){const F=Wv();return new lt((q,Y)=>{F.decodeAudioData(U,le=>{q(le)},le=>{Y(new Le(X.DECODE_AUDIO_FILE_FAILED,le.toString()))})})}(k);return typeof R=="string"&&P&&Mz.set(R,z),z}(c,s)}catch(R){return m.onError(R),R.throw(L)}const E=new Ipe(c),S=new Cpe(_,E,o?XA(o):{},h);return L.info("create buffer source audio track success, trackId:",h),m.onSuccess(S.getTrackId()),S},setAppType:function(t){if(L.debug("setAppType: ".concat(t)),!(Number.isInteger(t)&&t>=0))throw L.debug("Invalid appType"),new Oe(X.INVALID_PARAMS,"invalid app type",t);Xn("APP_TYPE",Math.floor(t))},setLogLevel:function(t){L.setLogLevel(t)},enableLogUpload:function(){re("USE_NEW_LOG")?Xn("UPLOAD_LOG",!0):L.enableLogUpload()},disableLogUpload:function(){re("USE_NEW_LOG")?Xn("UPLOAD_LOG",!1):L.disableLogUpload()},createChannelMediaRelayConfiguration:function(){return new MH},checkAudioTrackIsActive:async function(t){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:5e3;const s=Rt.reportApiInvoke(null,{tag:xr.TRACER,name:Si.CHECK_AUDIO_TRACK_IS_ACTIVE,options:[r]});if(!(t instanceof Br||t instanceof Hv)){const _=new Oe(X.INVALID_TRACK,"the parameter is not a audio track");return s.onError(_),_.throw()}r&&r<1e3&&(r=1e3);const o=t instanceof Br?t.getTrackLabel():"remote_track",c=t.getVolumeLevel();let u=c,h=c;const m=Date.now();return new lt(_=>{const E=setInterval(()=>{const S=t.getVolumeLevel();u=S>u?S:u,h=S<h?S:h;const R=u-h>1e-4,P=Date.now()-m;if(R||P>r){clearInterval(E);const k=R,z={duration:P,deviceLabel:o,maxVolumeLevel:u,result:k};L.info("[track-".concat(t.getTrackId(),"] check audio track active completed. ").concat(JSON.stringify(z))),s.onSuccess(z),_(k)}},200)})},checkVideoTrackIsActive:async function(t){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:5e3;const s=Rt.reportApiInvoke(null,{tag:xr.TRACER,name:Si.CHECK_VIDEO_TRACK_IS_ACTIVE,options:[r]});if(!(t instanceof _r||t instanceof Gv)){const R=new Oe(X.INVALID_TRACK,"the parameter is not a video track");return s.onError(R),R.throw()}r&&r<1e3&&(r=1e3);const o=t instanceof _r?t.getTrackLabel():"remote_track",c=t.getMediaStreamTrack(!0),u=document.createElement("video");u.style.width="1px",u.style.height="1px",u.setAttribute("muted",""),u.muted=!0,u.setAttribute("playsinline",""),u.controls=!1,(Ss()||VA())&&(u.style.opacity="0.01",u.style.position="fixed",u.style.left="0",u.style.top="0",document.body.appendChild(u)),u.srcObject=new MediaStream([c]),u.play();const h=document.createElement("canvas");h.width=160,h.height=120;let m=0,_=0;try{const R=Date.now();m=await function(P,k,z,U){let F,q=0,Y=null;return new lt((le,ye)=>{function Ee(){q>U&&F&&(F(),le(q));const me=z.getContext("2d");if(!me){const ut=new Oe(X.UNEXPECTED_ERROR,"can not get canvas 2d context.");return L.error(ut.toString()),void ye(ut)}me.drawImage(P,0,0,160,120);const ke=me.getImageData(0,0,z.width,z.height),Ye=Math.floor(ke.data.length/3);if(Y){for(let ut=0;ut<Ye;ut+=3)if(ke.data[ut]!==Y[ut])return q+=1,void(Y=ke.data);Y=ke.data}else Y=ke.data}setTimeout(()=>{F&&(F(),le(q))},k),F=gx(()=>{Ee()},30)})}(u,r,h,4),_=Date.now()-R}catch(R){throw s.onError(R),R}$me===Un.SAFARI&&(u.pause(),u.remove()),u.srcObject=null;const E=m>4,S={duration:_,changedPicNum:m,deviceLabel:o,result:E};return L.info("[track-".concat(t.getTrackId(),"] check video track active completed. ").concat(JSON.stringify(S))),s.onSuccess(S),E},setArea:qx,audioElementPlayCenter:Ko,resumeAudioContext:function(){Ko.autoResumeAfterInterruption(!0)},processExternalMediaAEC:function(t){lge.processExternalMediaAEC(t)},registerExtensions:function(t){const r=re("PLUGIN_INFO")||[];t.forEach(s=>{"name"in s&&!ot(r).call(r,s.name)&&r.push(s.name);const o=s;o.__registered__=!0,o.logger.hookLog=L.extLog,o.reporter.hookApiInvoke=Rt.extApiInvoke,o.parameters&&Object.keys(o.parameters).forEach(c=>{o.parameters[c]=re(c)})}),V$("PLUGIN_INFO",r)},ChannelMediaRelayError:qv,ChannelMediaRelayEvent:Zf,ChannelMediaRelayState:Ia,RemoteStreamFallbackType:Epe,RemoteStreamType:ype,ConnectionDisconnectedReason:Bn,AudienceLatencyLevelType:Yfe,AREAS:Vn,preload:async function(t,r,s,o){return l9(t,r,s,o)}});return Object.defineProperties(Ti,{onAudioAutoplayFailed:{get:()=>jc.onAudioAutoplayFailed,set:t=>{jc.onAudioAutoplayFailed=t}},onAutoplayFailed:{get:()=>jc.onAutoplayFailed,set:t=>{jc.onAutoplayFailed=t}},_onSecurityPolicyViolation:{value:void 0,writable:!0},_cspEventHandlerPointer:{value:void 0,writable:!0},onSecurityPolicyViolation:{get:()=>Ti._onSecurityPolicyViolation,set(t){Ti._onSecurityPolicyViolation=t,y7(t)}},__CLIENT_LIST__:{get:()=>re("SHOW_GLOBAL_CLIENT_LIST")?B_:[]}}),Fc.on(U_.CAMERA_DEVICE_CHANGED,t=>{L.info("camera device changed",JSON.stringify(t)),Ti.onCameraChanged&&Ti.onCameraChanged(t),Ti.safeEmit(Sh.CAMERA_CHANGED,t)}),Fc.on(U_.RECORDING_DEVICE_CHANGED,t=>{L.info("microphone device changed",JSON.stringify(t)),Ti.onMicrophoneChanged&&Ti.onMicrophoneChanged(t),Ti.safeEmit(Sh.MICROPHONE_CHANGED,t)}),Fc.on(U_.PLAYOUT_DEVICE_CHANGED,t=>{L.debug("playout device changed",JSON.stringify(t)),Ti.onPlaybackDeviceChanged&&Ti.onPlaybackDeviceChanged(t),Ti.safeEmit(Sh.PLAYBACK_DEVICE_CHANGED,t)}),Ko.onAutoplayFailed=()=>{L.info("detect audio element autoplay failed"),jc.onAudioAutoplayFailed&&jc.onAudioAutoplayFailed()},Jn.on("autoplay-failed",()=>{L.info("detect webaudio autoplay failed"),jc.onAudioAutoplayFailed&&jc.onAudioAutoplayFailed(),Ti.safeEmit(Sh.AUTOPLAY_FAILED)}),Jn.on(cs.STATE_CHANGE,(t,r)=>{L.info("audio context state changed: ".concat(r," => ").concat(t)),Ti.onAudioContextStateChanged&&Ti.onAudioContextStateChanged(t,r),Ti.safeEmit(Sh.AUDIO_CONTEXT_STATE_CHANGED,t,r)}),ci.on(Ov.NETWORK_STATE_CHANGE,(t,r)=>{L.info("[network-indicator] network state changed, ".concat(r," => ").concat(t))}),window&&(window.__ARTC__=Ti),Ti})}(Ek)),Ek.exports}var oWe=sWe();const BR=I0(oWe),aWe={BASE_URL:"./",DEV:!1,MODE:"production",PROD:!0,SSR:!1,VITE_AGORA_APP_ID:"a2a7f4eb05284449b1063eb71d8301dc"},uoe="a2a7f4eb05284449b1063eb71d8301dc";console.log("AgoraProvider: DEFAULT_AGORA_APP_ID:",uoe);console.log("AgoraProvider: import.meta.env:",aWe);const cWe=BR.createClient({mode:"rtc",codec:"vp8"});let Tw=null;const doe=D.createContext(null),hoe=({children:n,appId:e=uoe,channel:i=null,token:a=null,uid:l=null,enabled:d=!0,startMuted:p=!0,onClientReady:y=()=>{}})=>{console.log("AgoraProvider: appId prop:",e);const[v,b]=D.useState(!1),[w,A]=D.useState(!1),[N,V]=D.useState([]),[j,B]=D.useState(null),[G,ee]=D.useState(null),[K,ne]=D.useState(null),[ce,oe]=D.useState(!1),[ge,te]=D.useState(!1),[Z,J]=D.useState(!1),[se,he]=D.useState(null),[fe,ue]=D.useState(!1),Me=xu(),He=D.useRef(cWe),rt=D.useRef({appId:e,channel:i,uid:l,enabled:d}),we=D.useRef(!1),Ce=D.useRef(null);D.useRef(null),D.useEffect(()=>{rt.current={appId:e,channel:i,uid:l,enabled:d},console.log("AgoraProvider: Updated props ref:",{appId:e,channel:i,uid:l,enabled:d})},[e,i,l,d]),D.useEffect(()=>{console.log("AgoraProvider: Props changed:",{appId:e,channel:i,uid:l,enabled:d}),typeof window<"u"&&!window.agoraClient&&(window.agoraClient={isVoiceEnabled:!1,isJoined:!1,client:He.current},console.log("AgoraProvider: Initialized window.agoraClient"))},[e,i,l,d]),D.useEffect(()=>{console.log("AgoraProvider: Setting current channel:",i),ee(i)},[i]),D.useEffect(()=>{if(!He.current)return;const nt=dt=>{console.log(`Connection state changed to: ${dt}`),dt==="DISCONNECTED"?(b(!1),console.log("Disconnected from Agora")):dt==="CONNECTED"&&(b(!0),B(null))};return He.current.on("connection-state-change",nt),()=>{He.current.off("connection-state-change",nt)}},[]),D.useEffect(()=>{if(!i||!d){console.log("AgoraProvider: Skipping initialization - channel or enabled is falsy",{channel:i,enabled:d});return}console.log("AgoraProvider: Initial setup for channel",i,"with UID",l);const nt=async(Ut,ln)=>{console.log("AgoraProvider: User published:",Ut.uid,ln);try{await He.current.subscribe(Ut,ln),console.log("AgoraProvider: Subscribed to user:",Ut.uid,"mediaType:",ln),ln==="audio"&&(Ut.audioTrack.play(),console.log("AgoraProvider: Playing audio track for user:",Ut.uid)),V(xn=>xn.some(Xt=>Xt.uid===Ut.uid)?xn:[...xn,Ut])}catch(xn){console.error("AgoraProvider: Error subscribing to user:",xn)}},dt=(Ut,ln)=>{console.log("AgoraProvider: User unpublished:",Ut.uid,ln),ln==="audio"&&Ut.audioTrack&&(Ut.audioTrack.stop(),console.log("AgoraProvider: Stopped audio track for user:",Ut.uid))},Xe=Ut=>{console.log("AgoraProvider: User joined:",Ut.uid),V(ln=>ln.some(xn=>xn.uid===Ut.uid)?ln:[...ln,Ut])},It=Ut=>{console.log("AgoraProvider: User left:",Ut.uid),V(ln=>ln.filter(xn=>xn.uid!==Ut.uid))};He.current.on("user-published",nt),He.current.on("user-unpublished",dt),He.current.on("user-joined",Xe),He.current.on("user-left",It);const hn=async()=>{if(we.current){console.log("AgoraProvider: Already initializing, skipping duplicate initialization");return}we.current=!0;try{if(v&&Ce.current===i){console.log("AgoraProvider: Already joined to channel",i),oe(!0),y(He.current);return}if(He.current.connectionState==="CONNECTING"||He.current.connectionState==="CONNECTED")if(console.log("AgoraProvider: Client already in connecting/connected state:",He.current.connectionState),Ce.current&&Ce.current!==i){console.log("AgoraProvider: Connected to different channel, leaving first");try{await Te()}catch(Ut){console.error("AgoraProvider: Error leaving channel:",Ut)}}else{console.log("AgoraProvider: Client already connected or connecting, setting joined state to true"),b(!0),oe(!0),Ce.current=i,Tw=i,y(He.current);return}console.log("AgoraProvider: Joining channel",i,"current joined channel:",Ce.current),await Ne(),console.log("AgoraProvider: Join channel completed")}catch(Ut){console.error("AgoraProvider: Error during initialization:",Ut)}finally{we.current=!1}};return console.log("AgoraProvider: Running initialization"),hn(),()=>{console.log("AgoraProvider: Cleaning up event listeners"),He.current.off("user-published",nt),He.current.off("user-unpublished",dt),He.current.off("user-joined",Xe),He.current.off("user-left",It)}},[i,d,l,y,v]);const ve=async()=>{if(!d||K)return K;console.log("Initializing microphone");try{const nt=await BR.createMicrophoneAudioTrack();return await nt.setMuted(p),ne(nt),console.log("Microphone initialized successfully"),nt}catch(nt){return console.error("Error initializing microphone:",nt),B("Failed to initialize microphone. Please check your permissions."),null}};D.useEffect(()=>{(async()=>{if(i)try{const It=await _g(i);It&&It.voiceDisabled?(console.log("AgoraProvider: Voice is disabled for this space"),ue(!0),v&&await Te()):ue(!1)}catch(Xe){console.error("AgoraProvider: Error checking if voice is disabled:",Xe)}})();const dt=Xe=>{Xe.detail&&typeof Xe.detail.voiceDisabled=="boolean"&&(console.log("AgoraProvider: Voice setting changed:",Xe.detail.voiceDisabled),ue(Xe.detail.voiceDisabled),Xe.detail.voiceDisabled&&v?Te():!Xe.detail.voiceDisabled&&!v&&d&&i&&Ne())};return window.addEventListener("SpaceVoiceSettingChanged",dt),()=>{window.removeEventListener("SpaceVoiceSettingChanged",dt)}},[i,v,d]);const Ne=async()=>{if(!d)return console.log("AgoraProvider: Agora is disabled, not joining channel"),!1;if(fe)return console.log("AgoraProvider: Voice is disabled for this space, not joining channel"),B("Voice chat is disabled for this space"),!1;if(!i)return console.error("AgoraProvider: No channel specified"),B("No channel specified"),!1;if(console.log("AgoraProvider: joinChannel called for channel",i,"with UID",l),console.log("AgoraProvider: Current state:",{isJoined:v,isJoining:ge,connectionState:He.current.connectionState,joinedChannel:Ce.current}),v&&Ce.current===i)return console.log("AgoraProvider: Already joined to channel:",i),!0;if(ge)return console.log("AgoraProvider: Already in the process of joining"),!1;if(He.current.connectionState==="CONNECTED")if(Ce.current&&Ce.current!==i){console.log("AgoraProvider: Connected to different channel, leaving first");try{await Te()}catch(nt){console.error("AgoraProvider: Error leaving channel:",nt)}}else return console.log("AgoraProvider: Client already connected, setting joined state to true"),b(!0),oe(!0),Ce.current=i,Tw=i,y(He.current),!0;if(He.current.connectionState==="CONNECTING")return console.log("AgoraProvider: Client already connecting, waiting for connection"),te(!0),new Promise(nt=>{const dt=setInterval(()=>{He.current.connectionState==="CONNECTED"&&(clearInterval(dt),b(!0),te(!1),oe(!0),Ce.current=i,Tw=i,y(He.current),nt(!0))},500);setTimeout(()=>{clearInterval(dt),console.log("AgoraProvider: Connection timeout, considering join failed"),te(!1),nt(!1)},1e4)});try{if(console.log("AgoraProvider: Joining channel:",i,"with UID:",l||"random"),console.log("AgoraProvider: Using appId:",e,"Type:",typeof e,"Length:",e.length),!e||e.trim()===""){const dt="AgoraProvider: App ID is empty or invalid";return console.error(dt),B(dt),te(!1),!1}te(!0);const nt=l||Math.floor(Math.random()*1e6);return await He.current.join(e,i,a,nt),console.log("AgoraProvider: Joined channel successfully with UID:",He.current.uid),b(!0),te(!1),oe(!0),Ce.current=i,Tw=i,y(He.current),!0}catch(nt){return console.error("AgoraProvider: Error joining channel:",nt),B(`Error joining channel: ${nt.toString()}`),te(!1),!1}},Te=async()=>{if(v)try{K&&await He.current.unpublish(K),await He.current.leave(),Tw=null,Ce.current=null,console.log("Left channel successfully"),b(!1),V([])}catch(nt){console.error("Error leaving channel:",nt),B(nt.message||"Failed to leave channel")}};D.useEffect(()=>()=>{K&&K.close()},[]),D.useEffect(()=>{d&&i&&(!v||Ce.current!==i)&&Ne()},[d,i,v]);const be=()=>{if(!K)return!1;try{return K.isActive&&!K.muted}catch(nt){return console.error("Error checking microphone status:",nt),!1}};D.useEffect(()=>{const nt=()=>{const Xe=be();Xe!==w&&(console.log("Syncing microphone state:",{actualStatus:Xe,currentState:w}),A(Xe),window.dispatchEvent(new CustomEvent("VoiceToggled",{detail:{enabled:Xe}})),window.agoraClient&&(window.agoraClient.isVoiceEnabled=Xe,window.agoraClient.microphoneTrack=K))};K&&nt();const dt=setInterval(nt,1e3);return()=>{clearInterval(dt)}},[K,w]);const Ae=async()=>{var nt;if(fe)return console.log("AgoraProvider: Voice is disabled for this space, cannot toggle"),Me({title:"Voice Chat Disabled",description:"Voice chat has been disabled for this space by the owner.",status:"info",duration:3e3,isClosable:!0}),!1;try{const dt=w!==void 0?w:K?!K.muted:!1;if(console.log("AgoraProvider: Toggling voice, current state:",{isVoiceEnabled:w,currentState:dt,hasMicTrack:!!K,trackMuted:K==null?void 0:K.muted}),!K&&(console.log("AgoraProvider: No microphone track, initializing..."),!await ve()))return console.error("AgoraProvider: Failed to initialize microphone"),dt;const Xe=!dt;if(console.log("AgoraProvider: New voice state will be:",Xe),dt){if(K)try{console.log("AgoraProvider: Muting microphone track"),await K.setMuted(!0),K.muted||(console.warn("AgoraProvider: Track not muted after setMuted(true), trying again"),await K.setEnabled(!1)),console.log("AgoraProvider: Microphone track muted successfully, muted state:",K.muted)}catch(It){return console.error("Error muting track:",It),dt}}else if(K)try{He.current&&v&&!((nt=He.current.localTracks)!=null&&nt.includes(K))&&(console.log("AgoraProvider: Publishing microphone track"),await He.current.publish(K),console.log("AgoraProvider: Microphone track published successfully")),console.log("AgoraProvider: Unmuting microphone track"),await K.setMuted(!1),K.muted&&(console.warn("AgoraProvider: Track still muted after setMuted(false), trying again"),await K.setEnabled(!0)),console.log("AgoraProvider: Microphone track unmuted successfully, muted state:",K.muted)}catch(It){return console.error("Error unmuting track:",It),dt}return A(Xe),Xe}catch(dt){return console.error("AgoraProvider: Error toggling voice:",dt),w}},Ue=async nt=>{try{ne(nt),console.log("Microphone track updated successfully")}catch(dt){throw console.error("Error updating microphone track:",dt),dt}},ze=async()=>{if(!He.current||!i)return console.error("AgoraProvider: Voice chat not connected"),!1;try{if(Z)return console.log("AgoraProvider: Stopping screen share"),se&&(Array.isArray(se)?(await He.current.unpublish(se),se.forEach(nt=>nt.close())):(await He.current.unpublish(se),se.close()),he(null)),J(!1),console.log("AgoraProvider: Screen sharing stopped"),typeof window<"u"&&(window.agoraClient||(window.agoraClient={}),window.agoraClient.isScreenSharing=!1,window.agoraClient.screenTrack=null,window.dispatchEvent(new CustomEvent("ScreenShareToggled",{detail:{enabled:!1}}))),!1;console.log("AgoraProvider: Starting screen share");try{const nt=await BR.createScreenVideoTrack({encoderConfig:"1080p_1",optimizationMode:"detail"});return console.log("AgoraProvider: Screen track created:",nt),nt.on("track-ended",()=>{console.log("AgoraProvider: Screen sharing ended by browser UI"),He.current.unpublish(nt),nt.close(),he(null),J(!1),typeof window<"u"&&(window.agoraClient||(window.agoraClient={}),window.agoraClient.isScreenSharing=!1,window.agoraClient.screenTrack=null,window.dispatchEvent(new CustomEvent("ScreenShareToggled",{detail:{enabled:!1}})))}),await He.current.publish(nt),he(nt),J(!0),console.log("AgoraProvider: Screen sharing started"),typeof window<"u"&&(window.agoraClient||(window.agoraClient={}),window.agoraClient.isScreenSharing=!0,window.agoraClient.screenTrack=nt,window.dispatchEvent(new CustomEvent("ScreenShareToggled",{detail:{enabled:!0}}))),!0}catch(nt){return console.error("AgoraProvider: Error creating screen track:",nt),J(!1),he(null),!1}}catch(nt){return console.error("AgoraProvider: Error toggling screen share:",nt),J(!1),he(null),!1}};D.useEffect(()=>{if(console.log("AgoraProvider: Initializing window.agoraClient"),typeof window<"u"){window.agoraClient={isVoiceEnabled:!1,isJoined:!1,client:He.current,isScreenSharing:!1,screenTrack:null};const nt=Xe=>{console.log("AgoraProvider: Received ToggleScreenShare event"),ze().then(It=>{Xe.detail&&Xe.detail.callback&&Xe.detail.callback(!0,It)}).catch(It=>{console.error("AgoraProvider: Error handling ToggleScreenShare event:",It),Xe.detail&&Xe.detail.callback&&Xe.detail.callback(!1,Z)})},dt=Xe=>{console.log("AgoraProvider: Received JoinVoiceChat event"),Ne().then(It=>{Xe.detail&&Xe.detail.callback&&Xe.detail.callback(It)}).catch(It=>{console.error("AgoraProvider: Error handling JoinVoiceChat event:",It),Xe.detail&&Xe.detail.callback&&Xe.detail.callback(!1)})};return window.addEventListener("ToggleScreenShare",nt),window.addEventListener("JoinVoiceChat",dt),()=>{window.removeEventListener("ToggleScreenShare",nt),window.removeEventListener("JoinVoiceChat",dt),typeof window<"u"&&window.agoraClient&&(console.log("AgoraProvider: Cleaning up window.agoraClient"),window.agoraClient=null)}}return()=>{typeof window<"u"&&window.agoraClient&&(console.log("AgoraProvider: Cleaning up window.agoraClient"),window.agoraClient=null)}},[]),D.useEffect(()=>{console.log("AgoraProvider: Voice enabled state changed:",w),typeof window<"u"&&(window.agoraClient||(window.agoraClient={}),window.agoraClient.isVoiceEnabled=w,window.agoraClient.microphoneTrack=K,window.agoraClient.client=He.current,window.dispatchEvent(new CustomEvent("VoiceToggled",{detail:{enabled:w}})),console.log("AgoraProvider: Updated window.agoraClient and dispatched event:",{isVoiceEnabled:w}))},[w,K]);const et={client:He.current,isJoined:v,isVoiceEnabled:w,users:N,error:j,channel:G,appId:e,toggleVoice:Ae,leaveChannel:Te,joinChannel:Ne,microphoneTrack:K,isReady:ce,createMicrophoneTrack:Ue,isScreenSharing:Z,screenTrack:se,toggleScreenShare:ze,voiceDisabled:fe};return C.jsx(doe.Provider,{value:et,children:n})},foe=()=>{const n=D.useContext(doe);if(!n)throw new Error("useAgoraContext must be used within an AgoraProvider");return n};hoe.propTypes={children:mr.node.isRequired,appId:mr.string.isRequired,channel:mr.string.isRequired,token:mr.string,uid:mr.oneOfType([mr.string,mr.number])};const lWe=()=>{var we,Ce;const{client:n,isVoiceEnabled:e,isJoined:i,users:a,error:l,microphoneTrack:d,isReady:p,channel:y,appId:v,toggleVoice:b,joinChannel:w,leaveChannel:A,createMicrophoneTrack:N,isScreenSharing:V,screenTrack:j,toggleScreenShare:B,voiceDisabled:G}=foe(),[ee,K]=D.useState(e!==void 0?e:((we=window.agoraClient)==null?void 0:we.isVoiceEnabled)||!1),[ne,ce]=D.useState(V!==void 0?V:((Ce=window.agoraClient)==null?void 0:Ce.isScreenSharing)||!1),[oe,ge]=D.useState(G!==void 0?G:!1),[te,Z]=D.useState(!0);D.useEffect(()=>{var ve;e!==void 0?K(e):((ve=window.agoraClient)==null?void 0:ve.isVoiceEnabled)!==void 0?K(window.agoraClient.isVoiceEnabled):d&&K(!d.muted)},[e,d]),D.useEffect(()=>{var ve;V!==void 0?ce(V):((ve=window.agoraClient)==null?void 0:ve.isScreenSharing)!==void 0&&ce(window.agoraClient.isScreenSharing)},[V]),D.useEffect(()=>{G!==void 0&&ge(G)},[G]);const J=D.useRef({isVoiceEnabled:ee,isScreenSharing:ne,isJoined:i,users:a,error:l,isReady:p,channel:y,appId:v,voiceDisabled:oe});D.useEffect(()=>{J.current={isVoiceEnabled:ee,isScreenSharing:ne,isJoined:i,users:a,error:l,isReady:p,channel:y,appId:v,voiceDisabled:oe}},[ee,ne,i,a,l,p,y,v,oe]),D.useEffect(()=>{const ve=setTimeout(()=>{Z(!1)},5e3);return()=>clearTimeout(ve)},[]),D.useEffect(()=>{p&&Z(!1)},[p]),D.useEffect(()=>{console.log("useVoiceChat context:",{contextIsVoiceEnabled:e,localVoiceEnabled:ee,contextIsScreenSharing:V,localScreenSharing:ne,isJoined:i,users:a.length,error:l,isReady:p,channel:y,appId:v,hasMicrophoneTrack:!!d,trackMuted:d==null?void 0:d.muted,hasScreenTrack:!!j})},[e,ee,V,ne,i,a,l,p,y,v,d,j]);const se=async()=>{try{console.log("useVoiceChat: Toggling voice from:",ee);const ve=await b();if(console.log("useVoiceChat: Toggle result:",ve),ve!==void 0)K(ve);else{const Ne=!ee;K(Ne),window.agoraClient&&(window.agoraClient.isVoiceEnabled=Ne)}return ve!==void 0?ve:!ee}catch(ve){return console.error("useVoiceChat: Error toggling voice:",ve),ee}},he=async()=>{try{console.log("useVoiceChat: Toggling screen share from:",ne);const ve=await B();if(console.log("useVoiceChat: Screen share toggle result:",ve),ve!==void 0)ce(ve);else{const Ne=!ne;ce(Ne),window.agoraClient&&(window.agoraClient.isScreenSharing=Ne)}return ve!==void 0?ve:!ne}catch(ve){return console.error("useVoiceChat: Error toggling screen share:",ve),ne}},fe=async()=>{ee&&d&&await se()},ue=async()=>{!ee&&d&&await se()},Me=ve=>a.some(Ne=>{var Te;return Ne.uid===ve&&((Te=Ne.audioTrack)==null?void 0:Te.isPlaying)}),He=D.useCallback(()=>{if(!d||!ee)return 0;try{return d.getVolumeLevel()}catch(ve){return console.error("Error getting volume level:",ve),0}},[d,ee]);return{isVoiceEnabled:ee,isScreenSharing:ne,isJoined:i,users:a,error:l,toggleVoice:se,toggleScreenShare:he,mute:fe,unmute:ue,isUserSpeaking:Me,getVolumeLevel:He,microphoneTrack:d,screenTrack:j,isLoading:te,channel:y,appId:v,joinChannel:w,leaveChannel:A,client:n,setMicrophoneDevice:async ve=>{try{if(!ve){console.error("No device ID provided");return}if(!n||!i){console.error("Client not initialized or not joined to a channel");return}d&&(ee&&await n.unpublish(d),await d.close());const Ne=await BR.createMicrophoneAudioTrack({microphoneId:ve,encoderConfig:"music_standard"});N&&await N(Ne),ee&&await n.publish(Ne),console.log("Microphone device changed successfully")}catch(Ne){throw console.error("Error changing microphone device:",Ne),Ne}},voiceDisabled:oe}},uWe=({size:n="md",tooltipPlacement:e="top",defaultMuted:i=!0,joinOnClick:a=!0,className:l="voice-button"})=>{const{isVoiceEnabled:d,toggleVoice:p,isJoined:y,joinChannel:v,channel:b,client:w,voiceDisabled:A}=lWe(),[N,V]=D.useState(!1),[j,B]=D.useState(!1);D.useEffect(()=>{const K=()=>{_e.log("VoiceButton: Player instantiated, showing button"),B(!0)};return window.addEventListener("PlayerInstantiated",K),window.isPlayerInstantiated&&(_e.log("VoiceButton: Player was already instantiated"),B(!0)),()=>{window.removeEventListener("PlayerInstantiated",K)}},[]),D.useEffect(()=>{console.log("VoiceButton: State:",{isVoiceEnabled:d,isJoined:y,channel:b,hasClient:!!w,clientState:w==null?void 0:w.connectionState,windowAgoraClient:window.agoraClient,isPlayerReady:j,voiceDisabled:A})},[d,y,b,w,j,A]);const G=async()=>{if(!(N||A)){V(!0),console.log("VoiceButton: Handling click, current state:",{isVoiceEnabled:d,isJoined:y});try{if(!y&&a)try{console.log("VoiceButton: Not joined, attempting to join channel"),await v(),console.log("VoiceButton: Joined channel successfully")}catch(ne){ne.message&&ne.message.includes("already in connecting/connected state")?console.log("VoiceButton: Already connected to channel"):console.error("VoiceButton: Error joining channel:",ne)}console.log("VoiceButton: Toggling voice state from:",d);const K=await p();console.log("VoiceButton: Voice toggled, new state:",K)}catch(K){console.error("VoiceButton: Error toggling voice:",K)}finally{V(!1)}}},ee=()=>A?"Voice chat is disabled for this space":j?N?"Processing...":y?d?"Turn microphone off":"Turn microphone on":"Connecting to voice chat...":"Waiting for player to be ready...";return!j||A?null:C.jsx(hg,{label:ee(),placement:e,hasArrow:!0,children:C.jsxs(St,{position:"relative",cursor:"pointer",onClick:G,children:[C.jsx(ku,{size:n,borderRadius:"full",bg:d?"green.500":"red.500",icon:d?C.jsx(XV,{color:"white"}):C.jsx(YV,{color:"white"}),borderWidth:"1px",borderColor:"whiteAlpha.300",className:l,"data-testid":"voice-button"}),N&&C.jsx(St,{position:"absolute",top:"0",left:"0",right:"0",bottom:"0",display:"flex",alignItems:"center",justifyContent:"center",bg:"rgba(0, 0, 0, 0.6)",borderRadius:"full",children:C.jsx(lf,{size:"sm",color:"white"})})]})})},dWe=ri.createContext({user:null}),hWe=({userNickname:n})=>{const{client:e,channel:i,screenTrack:a,isScreenSharing:l,toggleScreenShare:d}=foe(),[p,y]=D.useState([]),[v,b]=D.useState(!1),[w,A]=D.useState(!0);D.useRef({});const N=D.useRef(null);D.useRef(null);const{user:V}=D.useContext(dWe)||{user:null},[j,B]=D.useState({}),G=D.useRef(a),[ee,K]=D.useState(null),{isOpen:ne,onOpen:ce,onClose:oe}=rf(),[ge,te]=D.useState(!1),Z=D.useRef(null),J=D.useRef(null);D.useEffect(()=>{G.current=a},[a]),D.useEffect(()=>{if(!e||!i){b(!1);return}const Me=setTimeout(()=>{A(!1)},5e3);console.log("Setting up screen share display with existing client:",e),console.log("Current channel:",i);const He=e.connectionState;if(console.log("Current connection state:",He),He==="CONNECTED")b(!0),A(!1);else{b(!1);const rt=we=>{console.log("Connection state changed:",we),we==="CONNECTED"?(b(!0),A(!1)):b(!1)};return e.on("connection-state-change",rt),()=>{e.off("connection-state-change",rt),clearTimeout(Me)}}return()=>{clearTimeout(Me)}},[e,i]),D.useEffect(()=>{const Me=async()=>{const He={...j};let rt=!1;for(const we of p){if(j[we.uid])continue;let Ce=null,ve=we.uid;if(typeof ve=="string"&&(ve.includes("-")?(Ce=ve.split("-")[0],ve=ve.split("-")[1]):ve.includes("_")&&(Ce=ve.split("_")[0],ve=ve.split("_")[1])),ve)try{console.log("Trying to fetch nickname for user ID:",ve);const Ne=await af(ve);Ne&&Ne.Nickname?(console.log("Found nickname in Firebase for user ID:",ve,"Nickname:",Ne.Nickname),He[we.uid]=Ne.Nickname,rt=!0):Ce?(console.log("Using extracted name for user ID:",ve,"Name:",Ce),He[we.uid]=Ce,rt=!0):(He[we.uid]="User",rt=!0)}catch(Ne){console.error("Error fetching user profile:",Ne),Ce?(He[we.uid]=Ce,rt=!0):(He[we.uid]="User",rt=!0)}else Ce?(He[we.uid]=Ce,rt=!0):(He[we.uid]="User",rt=!0)}rt&&B(He)};p.length>0&&Me()},[p,j]),D.useEffect(()=>{if(!e||!i||!v)return;console.log("Setting up screen share event handlers");const Me=async(we,Ce)=>{if(console.log("User published:",we.uid,Ce,we),Ce==="video"){console.log("Remote video track detected:",we.uid);try{await e.subscribe(we,Ce),console.log("Subscribed to remote video track:",we.uid),y(ve=>ve.some(Ne=>Ne.uid===we.uid)?ve:[...ve,we])}catch(ve){console.error("Error subscribing to remote video track:",ve)}}},He=(we,Ce)=>{if(console.log("User unpublished:",we.uid,Ce),Ce==="video"){if(console.log("Remote video track unpublished:",we.uid),we.videoTrack)try{we.videoTrack.stop()}catch(ve){console.error("Error stopping video track:",ve)}if(y(ve=>ve.filter(Ne=>Ne.uid!==we.uid)),l&&G.current&&N.current)try{console.log("Ensuring local screen track is still playing after remote user unpublished"),G.current.play(N.current)}catch(ve){console.error("Error replaying local screen track:",ve)}}},rt=we=>{console.log("User left:",we.uid);const Ce=p.find(ve=>ve.uid===we.uid);if(Ce&&Ce.videoTrack)try{Ce.videoTrack.stop()}catch(ve){console.error("Error stopping video track:",ve)}if(y(ve=>ve.filter(Ne=>Ne.uid!==we.uid)),l&&G.current&&N.current)try{console.log("Ensuring local screen track is still playing after remote user left"),G.current.play(N.current)}catch(ve){console.error("Error replaying local screen track:",ve)}};return e.on("user-published",Me),e.on("user-unpublished",He),e.on("user-left",rt),()=>{e.off("user-published",Me),e.off("user-unpublished",He),e.off("user-left",rt)}},[e,i,v,p,l]),D.useEffect(()=>{if(console.log("Remote screens changed:",p.length,p),p.forEach(Me=>{if(Me.videoTrack)try{console.log("Playing video track for:",Me.uid),Me.videoTrack.play(`video-container-${Me.uid}`)}catch(He){console.error("Error playing video track:",He)}}),l&&G.current&&N.current)try{console.log("Ensuring local screen track is still playing after remote screens changed"),G.current.play(N.current)}catch(Me){console.error("Error replaying local screen track:",Me)}},[p,l]),D.useEffect(()=>{if(console.log("Local screen sharing state changed:",l,a),l&&a&&N.current)try{console.log("Playing local screen track"),a.play(N.current)}catch(Me){console.error("Error playing local screen track:",Me)}},[l,a]),D.useEffect(()=>()=>{if(p.forEach(Me=>{if(Me.videoTrack)try{Me.videoTrack.stop()}catch(He){console.error("Error stopping video track on unmount:",He)}}),a)try{a.stop()}catch(Me){console.error("Error stopping local screen track on unmount:",Me)}},[p,a]);const se=()=>{console.log("Stopping local screen share"),d()},he=Me=>(console.log("Getting display name for UID:",Me,"type:",typeof Me),l&&V&&(Me===V.uid||Me===(e==null?void 0:e.uid))?n||"You":j[Me]?j[Me]:typeof Me=="string"?Me.includes("-")?Me.split("-")[0]:Me.includes("_")?Me.split("_")[0]:Me:"User"),fe=Me=>{console.log("Opening modal for remote screen",Me),K(Me),ce()},ue=()=>{console.log("Opening modal for local screen"),K({isLocal:!0}),ce()};return D.useEffect(()=>{ne&&ee?(console.log("Modal opened, activeScreen:",ee),setTimeout(()=>{if(ee.isLocal&&G.current)try{console.log("Playing local screen in modal"),G.current.play("modal-screen-container"),te(!0)}catch(Me){console.error("Error playing local screen in modal:",Me)}else if(ee.videoTrack)try{console.log("Playing remote screen in modal"),ee.videoTrack.play("modal-screen-container"),te(!0)}catch(Me){console.error("Error playing remote screen in modal:",Me)}},500)):ne||(te(!1),K(null),setTimeout(()=>{if(l&&G.current)try{G.current.play("local-screen-container")}catch(Me){console.error("Error playing local screen in small container:",Me)}p.forEach(Me=>{if(Me.videoTrack)try{Me.videoTrack.play(`video-container-${Me.uid}`)}catch(He){console.error(`Error playing remote screen ${Me.uid} in small container:`,He)}})},500))},[ne,ee,l,p]),!v||w&&p.length===0&&!l||p.length===0&&!l?null:C.jsxs(C.Fragment,{children:[!ne&&C.jsxs(St,{position:"fixed",top:"20px",left:"20px",zIndex:1e4,overflow:"visible",ref:Z,children:[l&&a&&C.jsxs(St,{position:"relative",mb:4,borderRadius:"md",overflow:"hidden",boxShadow:"xl",bg:"black",width:"200px",height:"120px",cursor:"pointer",transition:"all 0.2s",_hover:{filter:"brightness(0.8)",transform:"scale(1.05)"},onClick:ue,children:[C.jsx(St,{id:"local-screen-container",width:"100%",height:"100%",position:"relative"}),C.jsx(St,{position:"absolute",bottom:2,left:2,color:"white",fontSize:"xs",bg:"rgba(0,0,0,0.5)",px:2,py:1,borderRadius:"md",zIndex:5,children:n?`${n}'s Screen`:"Your Screen"})]}),p.map(Me=>{const He=j[Me.uid]||he(Me.uid);return C.jsxs(St,{position:"relative",mb:4,borderRadius:"md",overflow:"hidden",boxShadow:"xl",bg:"black",width:"200px",height:"120px",cursor:"pointer",transition:"all 0.2s",_hover:{filter:"brightness(0.8)",transform:"scale(1.05)"},onClick:()=>fe(Me),children:[C.jsx(St,{id:`video-container-${Me.uid}`,width:"100%",height:"100%",position:"relative"}),C.jsx(St,{position:"absolute",bottom:2,left:2,color:"white",fontSize:"xs",bg:"rgba(0,0,0,0.5)",px:2,py:1,borderRadius:"md",zIndex:5,children:`${He}'s Screen`})]},Me.uid)})]}),ne&&C.jsx(St,{position:"fixed",top:"0",left:"0",width:"100vw",height:"100vh",bg:"rgba(0,0,0,0.8)",zIndex:1e4,display:"flex",justifyContent:"center",alignItems:"center",onClick:oe,children:C.jsxs(St,{width:"80vw",height:"80vh",bg:"black",borderRadius:"md",overflow:"hidden",position:"relative",onClick:Me=>Me.stopPropagation(),children:[!ge&&C.jsxs(St,{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",color:"white",textAlign:"center",children:[C.jsx(lf,{size:"xl"}),C.jsx(ht,{mt:4,children:"Loading screen share..."})]}),C.jsx(St,{id:"modal-screen-container",width:"100%",height:"100%",position:"relative",ref:J}),C.jsx(St,{position:"absolute",top:2,right:2,color:"white",bg:"rgba(0,0,0,0.5)",borderRadius:"full",width:"30px",height:"30px",display:"flex",justifyContent:"center",alignItems:"center",cursor:"pointer",onClick:oe,children:""}),C.jsx(St,{position:"absolute",bottom:4,left:4,color:"white",fontSize:"sm",bg:"rgba(0,0,0,0.5)",px:3,py:2,borderRadius:"md",children:ee!=null&&ee.isLocal?n?`${n}'s Screen`:"Your Screen":`${j[ee==null?void 0:ee.uid]||he(ee==null?void 0:ee.uid)}'s Screen`}),(ee==null?void 0:ee.isLocal)&&C.jsx(St,{position:"absolute",bottom:4,right:4,children:C.jsx(zr,{colorScheme:"red",size:"sm",onClick:se,children:"Stop Sharing"})})]})})]})},fWe=({onClose:n})=>{const e=xu(),[i,a]=D.useState(!1),[l,d]=D.useState(!1);D.useEffect(()=>{const v=()=>{window.agoraClient&&d(!!window.agoraClient.isScreenSharing)};v();const b=setInterval(v,1e3),w=()=>{v()};return window.addEventListener("ScreenShareToggled",w),()=>{clearInterval(b),window.removeEventListener("ScreenShareToggled",w)}},[]);const p=async v=>{if(v.preventDefault(),v.stopPropagation(),n&&n(),!window.agoraClient||!window.agoraClient.client){e({title:"Screen sharing not available",description:"Voice chat must be connected to use screen sharing",status:"warning",duration:3e3,isClosable:!0});return}try{if(a(!0),window.agoraClient.isJoined)y();else{console.log("ScreenShareMenuOption: Not joined to voice chat, joining automatically");const b=new CustomEvent("JoinVoiceChat",{detail:{callback:w=>{if(!w){console.error("ScreenShareMenuOption: Failed to join voice chat"),e({title:"Connection failed",description:"Could not connect to voice chat",status:"error",duration:3e3,isClosable:!0}),a(!1);return}y()}}});window.dispatchEvent(b)}}catch(b){console.error("Error in screen share handler:",b),a(!1),e({title:"Screen sharing error",description:b.message||"Failed to toggle screen sharing",status:"error",duration:5e3,isClosable:!0})}},y=async()=>{try{const v=new CustomEvent("ToggleScreenShare",{detail:{callback:(b,w)=>{a(!1),b?(d(w),e(w?{title:"Screen sharing started",status:"success",duration:3e3,isClosable:!0}:{title:"Screen sharing stopped",status:"info",duration:3e3,isClosable:!0})):e({title:"Screen sharing error",description:"Failed to toggle screen sharing",status:"error",duration:5e3,isClosable:!0})}}});window.dispatchEvent(v)}catch(v){console.error("Error toggling screen share:",v),a(!1),e({title:"Screen sharing error",description:v.message||"Failed to toggle screen sharing",status:"error",duration:5e3,isClosable:!0})}};return C.jsx(ht,{fontSize:"md",cursor:"pointer",_hover:{bg:"whiteAlpha.200"},p:2,borderRadius:"md",onClick:p,color:l?"red.300":"white",children:i?"Connecting...":l?"Stop Screen Sharing":"Share Screen"})};function pWe({open:n,onClose:e}){const[i,a]=D.useState(0);return C.jsxs(ra,{isOpen:n,onClose:e,size:"md",isCentered:!0,children:[C.jsx(oa,{backdropFilter:"blur(4px)"}),C.jsxs(ia,{bg:"rgba(23, 25, 35, 0.95)",color:"white",borderRadius:"md",boxShadow:"0 4px 20px rgba(0, 0, 0, 0.5)",maxW:"600px",h:"350px",overflow:"hidden",children:[C.jsx(tl,{borderBottom:"1px solid",borderColor:"whiteAlpha.200",py:2,fontSize:"md",fontWeight:"600",children:"Controls"}),C.jsx(ja,{size:"sm",color:"whiteAlpha.700",_hover:{color:"white",bg:"whiteAlpha.100"}}),C.jsx(sa,{p:0,display:"flex",children:C.jsxs(oC,{orientation:"vertical",variant:"unstyled",index:i,onChange:a,display:"flex",flexGrow:1,children:[C.jsxs(aC,{bg:"rgba(0, 0, 0, 0.2)",w:"80px",py:4,borderRight:"1px solid",borderColor:"whiteAlpha.200",children:[C.jsxs(qc,{display:"flex",flexDirection:"column",alignItems:"center",py:3,_selected:{bg:"whiteAlpha.100",color:"blue.300"},_hover:{bg:"whiteAlpha.50"},children:[C.jsx(Dn,{as:W6e,mb:1}),C.jsx(ht,{fontSize:"xs",children:"Movement"})]}),C.jsxs(qc,{display:"flex",flexDirection:"column",alignItems:"center",py:3,_selected:{bg:"whiteAlpha.100",color:"blue.300"},_hover:{bg:"whiteAlpha.50"},children:[C.jsx(Dn,{as:z6e,mb:1}),C.jsx(ht,{fontSize:"xs",children:"Camera"})]}),C.jsxs(qc,{display:"flex",flexDirection:"column",alignItems:"center",py:3,_selected:{bg:"whiteAlpha.100",color:"blue.300"},_hover:{bg:"whiteAlpha.50"},children:[C.jsx(Dn,{as:j6e,mb:1}),C.jsx(ht,{fontSize:"xs",children:"Actions"})]}),C.jsxs(qc,{display:"flex",flexDirection:"column",alignItems:"center",py:3,_selected:{bg:"whiteAlpha.100",color:"blue.300"},_hover:{bg:"whiteAlpha.50"},children:[C.jsx(Dn,{as:B6e,mb:1}),C.jsx(ht,{fontSize:"xs",children:"Tips"})]})]}),C.jsxs(M1,{flexGrow:1,display:"flex",flexDirection:"column",children:[C.jsxs(Cu,{p:4,display:"flex",flexDirection:"column",h:"100%",children:[C.jsx(ht,{fontSize:"sm",fontWeight:"600",mb:3,color:"blue.300",children:"Movement Controls"}),C.jsxs(mi,{wrap:"wrap",gap:3,children:[C.jsx(Il,{keyLabel:"W",description:"Move Forward"}),C.jsx(Il,{keyLabel:"A",description:"Move Left"}),C.jsx(Il,{keyLabel:"S",description:"Move Backward"}),C.jsx(Il,{keyLabel:"D",description:"Move Right"}),C.jsx(Il,{keyLabel:"Shift",description:"Run"}),C.jsx(Il,{keyLabel:"Space",description:"Jump / Double Jump"})]})]}),C.jsxs(Cu,{p:4,display:"flex",flexDirection:"column",h:"100%",children:[C.jsx(ht,{fontSize:"sm",fontWeight:"600",mb:3,color:"blue.300",children:"Camera Controls"}),C.jsxs(mi,{wrap:"wrap",gap:3,children:[C.jsx(Il,{keyLabel:"Mouse",description:"Look Around"}),C.jsx(Il,{keyLabel:"Click + Drag",description:"Rotate Camera"}),C.jsx(Il,{keyLabel:"Scroll",description:"Zoom In/Out"})]})]}),C.jsxs(Cu,{p:4,display:"flex",flexDirection:"column",h:"100%",children:[C.jsx(ht,{fontSize:"sm",fontWeight:"600",mb:3,color:"blue.300",children:"Action Controls"}),C.jsxs(mi,{wrap:"wrap",gap:3,children:[C.jsx(Il,{keyLabel:"E",description:"Interact"}),C.jsx(Il,{keyLabel:"F",description:"Emote Menu"}),C.jsx(Il,{keyLabel:"T",description:"Chat"}),C.jsx(Il,{keyLabel:"M",description:"Mute Mic"})]})]}),C.jsxs(Cu,{p:4,display:"flex",flexDirection:"column",h:"100%",children:[C.jsx(ht,{fontSize:"sm",fontWeight:"600",mb:3,color:"blue.300",children:"Tips & Tricks"}),C.jsxs(ii,{align:"stretch",spacing:2,children:[C.jsx(ht,{fontSize:"xs",children:" Double-tap Shift to auto-run"}),C.jsx(ht,{fontSize:"xs",children:" Press ESC to access settings"}),C.jsx(ht,{fontSize:"xs",children:" Click on players to view their profile"}),C.jsx(ht,{fontSize:"xs",children:" Use the minimap to navigate"})]})]})]})]})})]})]})}const Il=({keyLabel:n,description:e})=>C.jsx(St,{bg:"whiteAlpha.100",borderRadius:"md",p:2,minW:"120px",maxW:"180px",children:C.jsxs(Oi,{spacing:2,children:[C.jsx(St,{bg:"whiteAlpha.200",borderRadius:"md",px:2,py:1,fontSize:"xs",fontWeight:"bold",minW:"30px",textAlign:"center",children:n}),C.jsx(ht,{fontSize:"xs",children:e})]})}),mWe=()=>{const[n,e]=D.useState([]),[i,a]=D.useState(""),[l,d]=D.useState(0),[p,y]=D.useState(100),[v,b]=D.useState(100),[w,A]=D.useState(!0),[N,V]=D.useState(!0),[j,B]=D.useState(!1);D.useEffect(()=>{(async()=>{try{await navigator.mediaDevices.getUserMedia({audio:!0});const oe=await BR.getMicrophones();e(oe),oe.length>0&&a(oe[0].deviceId)}catch(oe){console.error("Error getting audio devices:",oe)}})()},[]),D.useEffect(()=>{const ce=setInterval(()=>{d(j?Math.random()*50:0)},100);return()=>clearInterval(ce)},[j]);const G=ce=>{const oe=ce.target.value;a(oe),console.log("Microphone changed to:",oe)},ee=ce=>{y(ce),console.log("Microphone volume set to:",ce)},K=ce=>{b(ce),console.log("Speaker volume set to:",ce)},ne=()=>{B(!j)};return C.jsxs(ii,{spacing:6,align:"stretch",children:[C.jsxs(pi,{children:[C.jsxs(Io,{children:["Microphone",C.jsx(_p,{ml:2,colorScheme:j?"green":"red",children:j?"Enabled":"Muted"})]}),C.jsxs(One,{value:i,onChange:G,bg:"gray.700",borderColor:"gray.600",_hover:{borderColor:"gray.500"},children:[n.map(ce=>C.jsx("option",{value:ce.deviceId,children:ce.label||`Microphone ${ce.deviceId.slice(0,5)}...`},ce.deviceId)),n.length===0&&C.jsx("option",{value:"",children:"No microphones found"})]})]}),C.jsxs(St,{children:[C.jsx(ht,{mb:2,children:"Microphone Level"}),C.jsx(m0,{value:l,colorScheme:"green",size:"sm",borderRadius:"md",hasStripe:l>20,isAnimated:l>20})]}),C.jsxs(pi,{children:[C.jsxs(Io,{children:["Microphone Volume: ",p,"%"]}),C.jsxs(uV,{value:p,onChange:ee,min:0,max:100,step:1,colorScheme:"blue",children:[C.jsx(hV,{bg:"gray.700",children:C.jsx(fV,{})}),C.jsx(dV,{boxSize:6})]})]}),C.jsxs(pi,{children:[C.jsxs(Io,{children:["Speaker Volume: ",v,"%"]}),C.jsxs(uV,{value:v,onChange:K,min:0,max:100,step:1,colorScheme:"blue",children:[C.jsx(hV,{bg:"gray.700",children:C.jsx(fV,{})}),C.jsx(dV,{boxSize:6})]})]}),C.jsxs(pi,{display:"flex",alignItems:"center",children:[C.jsx(Io,{mb:"0",children:"Microphone Enabled"}),C.jsx(dg,{isChecked:j,onChange:ne,colorScheme:"green",size:"lg"})]}),C.jsxs(pi,{display:"flex",alignItems:"center",children:[C.jsx(Io,{mb:"0",children:"Echo Cancellation"}),C.jsx(dg,{isChecked:w,onChange:()=>A(!w),colorScheme:"green",size:"lg"})]}),C.jsxs(pi,{display:"flex",alignItems:"center",children:[C.jsx(Io,{mb:"0",children:"Noise Suppression"}),C.jsx(dg,{isChecked:N,onChange:()=>V(!N),colorScheme:"green",size:"lg"})]}),C.jsxs(lg,{status:"info",borderRadius:"md",children:[C.jsx(ug,{}),"Note: These settings will be applied when you join a voice chat."]})]})};function gWe({open:n,onClose:e,containerRef:i}){return C.jsx(Vl,{containerRef:i,children:C.jsxs(ra,{isOpen:n,onClose:e,size:"lg",isCentered:!0,children:[C.jsx(oa,{}),C.jsxs(ia,{bg:"gray.900",color:"white",borderRadius:"lg",children:[C.jsx(tl,{children:"Settings"}),C.jsx(ja,{size:"lg",bg:"gray.700",color:"white",borderRadius:"full",_hover:{bg:"gray.600"},_focus:{boxShadow:"none"}}),C.jsx(sa,{children:C.jsxs(oC,{variant:"enclosed",children:[C.jsxs(aC,{mb:4,children:[C.jsx(qc,{_selected:{color:"white",borderBottom:"2px solid white"},children:"Audio"}),C.jsx(qc,{_selected:{color:"white",borderBottom:"2px solid white"},children:"Graphics"})]}),C.jsxs(M1,{children:[C.jsx(Cu,{children:C.jsx(St,{p:4,bg:"gray.800",borderRadius:"md",children:C.jsx(mWe,{})})}),C.jsx(Cu,{children:C.jsx(St,{p:4,bg:"gray.800",borderRadius:"md",children:"Graphics settings content goes here."})})]})]})})]})]})})}function _We(n){return Vr({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"circle",attr:{cx:"12",cy:"8",r:"7"}},{tag:"polyline",attr:{points:"8.21 13.89 7 23 12 20 17 23 15.79 13.88"}}]})(n)}function yWe(n){return Vr({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"path",attr:{d:"M23 19a2 2 0 0 1-2 2H3a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h4l2-3h6l2 3h4a2 2 0 0 1 2 2z"}},{tag:"circle",attr:{cx:"12",cy:"13",r:"4"}}]})(n)}function n0(n){return Vr({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"rect",attr:{x:"3",y:"3",width:"18",height:"18",rx:"2",ry:"2"}},{tag:"circle",attr:{cx:"8.5",cy:"8.5",r:"1.5"}},{tag:"polyline",attr:{points:"21 15 16 10 5 21"}}]})(n)}function poe(n){return Vr({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"circle",attr:{cx:"12",cy:"12",r:"10"}},{tag:"line",attr:{x1:"12",y1:"16",x2:"12",y2:"12"}},{tag:"line",attr:{x1:"12",y1:"8",x2:"12.01",y2:"8"}}]})(n)}function EWe(n){return Vr({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"path",attr:{d:"M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"}},{tag:"path",attr:{d:"M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"}}]})(n)}function vWe(n){return Vr({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"circle",attr:{cx:"12",cy:"12",r:"3"}},{tag:"path",attr:{d:"M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"}}]})(n)}function SWe(n){return Vr({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"polygon",attr:{points:"12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"}}]})(n)}function dR(n){return Vr({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"polyline",attr:{points:"3 6 5 6 21 6"}},{tag:"path",attr:{d:"M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"}},{tag:"line",attr:{x1:"10",y1:"11",x2:"10",y2:"17"}},{tag:"line",attr:{x1:"14",y1:"11",x2:"14",y2:"17"}}]})(n)}function QV(n){return Vr({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"path",attr:{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"}},{tag:"polyline",attr:{points:"17 8 12 3 7 8"}},{tag:"line",attr:{x1:"12",y1:"3",x2:"12",y2:"15"}}]})(n)}function YJ(n){return Vr({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"path",attr:{d:"M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"}},{tag:"circle",attr:{cx:"9",cy:"7",r:"4"}},{tag:"path",attr:{d:"M23 21v-2a4 4 0 0 0-3-3.87"}},{tag:"path",attr:{d:"M16 3.13a4 4 0 0 1 0 7.75"}}]})(n)}function MO(n){return Vr({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"polygon",attr:{points:"23 7 16 12 23 17 23 7"}},{tag:"rect",attr:{x:"1",y:"5",width:"15",height:"14",rx:"2",ry:"2"}}]})(n)}function bWe(n){return Vr({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"polygon",attr:{points:"11 5 6 9 2 9 2 15 6 15 11 19 11 5"}},{tag:"path",attr:{d:"M19.07 4.93a10 10 0 0 1 0 14.14M15.54 8.46a5 5 0 0 1 0 7.07"}}]})(n)}const TWe=async()=>{try{_e.log("tagsFirestore: Fetching all tags");const n=jy(gi,"tags"),e=await FR(n),i=[];return e.forEach(a=>{i.push({id:a.id,...a.data()})}),i}catch(n){throw _e.error("tagsFirestore: Error fetching tags:",n),n}},wWe=async n=>{try{_e.log(`tagsFirestore: Fetching tag with ID: ${n}`);const e=Mi(gi,"tags",n),i=await Lu(e);return i.exists()?{id:i.id,...i.data()}:(_e.warn(`tagsFirestore: Tag with ID ${n} not found`),null)}catch(e){throw _e.error(`tagsFirestore: Error fetching tag with ID ${n}:`,e),e}},RWe=async({id:n,name:e,color:i,description:a})=>{try{_e.log(`tagsFirestore: Creating new tag: ${e}`);const l={name:e,color:i||"#808080",description:a||"",createdAt:new Date,updatedAt:new Date};let d;if(n){const p=Mi(gi,"tags",n);await n1(p,l),d=n}else{const p=jy(gi,"tags");d=(await c5e(p,l)).id}return{id:d,...l}}catch(l){throw _e.error("tagsFirestore: Error creating tag:",l),l}},CWe=async(n,e)=>{try{_e.log(`tagsFirestore: Adding tag ${e} to space ${n}`);const i=Mi(gi,"tags",e);if(!(await Lu(i)).exists())throw new Error(`Tag with ID ${e} does not exist`);const l=Mi(gi,"spaces",n);return await nl(l,{tags:l5e(e)}),!0}catch(i){throw _e.error(`tagsFirestore: Error adding tag ${e} to space ${n}:`,i),i}},IWe=async(n,e)=>{try{_e.log(`tagsFirestore: Removing tag ${e} from space ${n}`);const i=Mi(gi,"spaces",n);return await nl(i,{tags:u5e(e)}),!0}catch(i){throw _e.error(`tagsFirestore: Error removing tag ${e} from space ${n}:`,i),i}},AWe=async n=>{try{_e.log(`tagsFirestore: Getting tags for space ${n}`);const e=Mi(gi,"spaces",n),i=await Lu(e);if(!i.exists())throw new Error(`Space with ID ${n} not found`);const l=i.data().tags||[];if(l.length===0)return[];const d=[];for(const p of l){const y=await wWe(p);y&&d.push(y)}return d}catch(e){throw _e.error(`tagsFirestore: Error getting tags for space ${n}:`,e),e}},PWe=async()=>{_e.log("tagsFirestore: Initializing default tags");const n=[{id:"collaboration",name:"Collaboration",color:"#4287f5",description:"Spaces designed for team collaboration and meetings"},{id:"social",name:"Social",color:"#f54242",description:"Social gathering and networking spaces"},{id:"education",name:"Education",color:"#42f581",description:"Learning and educational environments"},{id:"events",name:"Events",color:"#f5a742",description:"Spaces optimized for hosting events"},{id:"showcase",name:"Showcase",color:"#9f42f5",description:"Spaces for exhibiting content and creations"},{id:"entertainment",name:"Entertainment",color:"#f542b3",description:"Entertainment and leisure spaces"},{id:"productivity",name:"Productivity",color:"#42dbf5",description:"Spaces focused on work and productivity"},{id:"featured",name:"Featured",color:"#f5f242",description:"Featured and highlighted spaces"}];try{let e=0,i=0;for(const a of n){_e.log(`tagsFirestore: Processing tag: ${a.name}`);const l=Mi(gi,"tags",a.id);(await Lu(l)).exists()?(_e.log(`tagsFirestore: Tag ${a.id} already exists, skipping`),i++):(await RWe(a),e++,_e.log(`tagsFirestore: Created tag: ${a.name}`))}return _e.log(`tagsFirestore: Tags initialization complete. Created: ${e}, Skipped: ${i}`),{created:e,skipped:i}}catch(e){throw _e.error("tagsFirestore: Error initializing default tags:",e),e}},moe=({spaceID:n})=>{const[e,i]=D.useState([]),[a,l]=D.useState([]),[d,p]=D.useState(!0),[y,v]=D.useState(!1),[b,w]=D.useState(!1),[A,N]=D.useState(null),{isOpen:V,onOpen:j,onClose:B}=rf(),G=xu(),{user:ee}=D.useContext(ca),K=(ee==null?void 0:ee.groups)&&(ee.groups.includes("disruptiveAdmin")||ee.groups.includes("admin"));D.useEffect(()=>{ne()},[n]);const ne=async()=>{p(!0);try{let J=[];try{J=await TWe(),i(J)}catch(se){_e.error("SpaceTagsManager: Error loading available tags:",se),i([]),G({title:"Error loading tags",description:"Failed to load available tags. Please try again later.",status:"error",duration:3e3,isClosable:!0})}if(n)try{const se=await AWe(n);l(se)}catch(se){_e.error("SpaceTagsManager: Error loading space tags:",se),l([]),G({title:"Error loading space tags",description:"Failed to load this space's tags. Please try again later.",status:"error",duration:3e3,isClosable:!0})}}catch(J){_e.error("SpaceTagsManager: Error in loadTags:",J),G({title:"Error loading tags",description:"Failed to load tags. Please try again later.",status:"error",duration:3e3,isClosable:!0})}finally{p(!1)}},ce=async()=>{w(!0),N(null);try{const J=await PWe();console.log("Tag initialization result:",J),N(J),G({title:"Tags initialized",description:`Successfully created ${J.created} tags. Skipped ${J.skipped} existing tags.`,status:"success",duration:4e3,isClosable:!0}),await ne()}catch(J){_e.error("SpaceTagsManager: Error initializing tags:",J),N(!1),G({title:"Error initializing tags",description:"Failed to initialize tags. Please try again later.",status:"error",duration:4e3,isClosable:!0})}finally{w(!1)}},oe=async J=>{if(!(!n||!J)){v(!0);try{await CWe(n,J);const se=e.find(he=>he.id===J);se&&l(he=>[...he,se]),G({title:"Tag added",description:"Tag has been added to the space.",status:"success",duration:2e3,isClosable:!0})}catch(se){_e.error(`SpaceTagsManager: Error adding tag ${J} to space:`,se),G({title:"Error adding tag",description:"Failed to add tag to the space.",status:"error",duration:3e3,isClosable:!0})}finally{v(!1)}}},ge=async J=>{if(!(!n||!J)){v(!0);try{await IWe(n,J),l(se=>se.filter(he=>he.id!==J)),G({title:"Tag removed",description:"Tag has been removed from the space.",status:"info",duration:2e3,isClosable:!0})}catch(se){_e.error(`SpaceTagsManager: Error removing tag ${J} from space:`,se),G({title:"Error removing tag",description:"Failed to remove tag from the space.",status:"error",duration:3e3,isClosable:!0})}finally{v(!1)}}},te=()=>{const J=a.map(se=>se.id);return e.filter(se=>!J.includes(se.id))},Z=te().length===0;return C.jsxs(St,{children:[C.jsx(mi,{mb:3,justifyContent:"space-between",alignItems:"center",children:C.jsxs(Oi,{spacing:2,ml:"auto",children:[K&&C.jsx(zr,{size:"xs",leftIcon:C.jsx(VBe,{}),onClick:j,variant:"outline",colorScheme:"purple",children:"Admin"}),C.jsxs(rC,{children:[C.jsx(iC,{as:zr,size:"xs",leftIcon:C.jsx(UBe,{}),rightIcon:C.jsx(jse,{}),isDisabled:d||y||Z,children:Z?"No Available Tags":"Add Tag"}),C.jsx(sC,{zIndex:1e3,bg:"gray.800",borderColor:"gray.700",color:"white",children:te().length>0?te().map(J=>C.jsx(Pd,{onClick:()=>oe(J.id),icon:C.jsx(St,{width:"12px",height:"12px",borderRadius:"full",bg:J.color||"#888"}),_hover:{bg:"gray.700"},_focus:{bg:"gray.700"},_active:{bg:"gray.700"},_focusVisible:{bg:"gray.700"},bg:"gray.800",color:"white",children:J.name},J.id)):C.jsx(Pd,{isDisabled:!0,bg:"gray.800",color:"gray.400",children:"No available tags to add"})})]})]})}),d?C.jsx(mi,{justify:"center",py:4,children:C.jsx(lf,{size:"sm",color:"blue.300"})}):e.length===0?C.jsx(St,{children:C.jsxs(ht,{fontSize:"sm",color:"red.400",mb:2,children:["No tags have been created in the system yet.",K?" Use the Admin button to initialize tags.":" Ask an admin to initialize tags."]})}):a.length===0?C.jsx(ht,{fontSize:"sm",color:"gray.400",fontStyle:"italic",children:"No tags assigned to this space."}):C.jsx(Bne,{spacing:2,children:a.map(J=>C.jsx(Pj,{children:C.jsxs(Mne,{size:"md",borderRadius:"full",variant:"subtle",colorScheme:"gray",boxShadow:`0 0 0 1px ${J.color||"#888"}`,children:[C.jsx(St,{width:"8px",height:"8px",borderRadius:"full",bg:J.color||"#888",mr:1}),C.jsx(Une,{children:J.name}),C.jsx(Fne,{onClick:()=>ge(J.id),isDisabled:y})]})},J.id))}),C.jsxs(ra,{isOpen:V,onClose:B,size:"md",children:[C.jsx(oa,{backdropFilter:"blur(4px)"}),C.jsxs(ia,{bg:"gray.800",color:"white",children:[C.jsx(tl,{fontSize:"md",children:"Tag System Administration"}),C.jsx(ja,{}),C.jsxs(sa,{children:[C.jsx(ht,{fontSize:"sm",mb:4,children:"Initialize the default tags in your Firestore database. This will create a set of predefined tags if they don't already exist."}),A&&C.jsxs(lg,{status:"success",mb:4,borderRadius:"md",size:"sm",children:[C.jsx(ug,{}),C.jsxs(ht,{fontSize:"sm",children:["Tags initialized. Created: ",C.jsx("b",{children:A.created}),", Skipped: ",C.jsx("b",{children:A.skipped})]})]}),C.jsx(zr,{colorScheme:"blue",onClick:ce,isLoading:b,loadingText:"Initializing...",size:"sm",width:"full",children:"Initialize Default Tags"})]}),C.jsx(bg,{children:C.jsx(zr,{variant:"ghost",size:"sm",onClick:B,children:"Close"})})]})]})]})};moe.propTypes={spaceID:mr.string.isRequired};const OWe=({isOpen:n,onClose:e})=>{const{spaceID:i}=rl(),[a,l]=D.useState(0),[d,p]=D.useState(""),[y,v]=D.useState(""),[b,w]=D.useState(!1),[A,N]=D.useState(null),[V,j]=D.useState(null),[B,G]=D.useState(!1),[ee,K]=D.useState(0),[ne,ce]=D.useState(null),oe=D.useRef(null),[ge,te]=D.useState(null),[Z,J]=D.useState(null),[se,he]=D.useState(!1),[fe,ue]=D.useState(0),[Me,He]=D.useState(null),rt=D.useRef(null),[we,Ce]=D.useState([]),[ve,Ne]=D.useState([]),[Te,be]=D.useState(!1),[Ae,Ue]=D.useState(!1),[ze,et]=D.useState(!0),[nt,dt]=D.useState(!1),Xe=xu();D.useEffect(()=>{n&&i&&It()},[n,i]);const It=async()=>{try{const Ge=await _g(i);Ge.logoUrl&&ce(Ge.logoUrl),Ge.backgroundUrl&&He(Ge.backgroundUrl),Ge.voiceDisabled!==void 0&&Ue(Ge.voiceDisabled),Ge.accessibleToAllUsers!==void 0&&et(Ge.accessibleToAllUsers),p(Ge.name||""),v(Ge.description||""),hn(Ge)}catch(Ge){_e.error("Error fetching space data:",Ge),Xe({title:"Error",description:"Failed to load space data",status:"error",duration:3e3,isClosable:!0})}},hn=async Ge=>{if(i&&n){be(!0);try{const Ot=BV(),Jt=`space_${i}_owners`,fn=zV(jy(Ot,"users"),pJ("groups","array-contains",Jt)),an=await FR(fn),ir=[];for(const _i of an.docs){const Ri=_i.data(),dr=await af(_i.id);ir.push({uid:_i.id,email:Ri.email,displayName:Ri.displayName||dr.Nickname||"Unknown User",photoURL:Ri.photoURL||dr.photoURL,firstName:dr.firstName,lastName:dr.lastName})}Ce(ir);const la=`space_${i}_hosts`,Vt=zV(jy(Ot,"users"),pJ("groups","array-contains",la)),sn=await FR(Vt),ki=[];for(const _i of sn.docs){const Ri=_i.data(),dr=await af(_i.id);ki.push({uid:_i.id,email:Ri.email,displayName:Ri.displayName||dr.Nickname||"Unknown User",photoURL:Ri.photoURL||dr.photoURL,firstName:dr.firstName,lastName:dr.lastName})}Ne(ki)}catch(Ot){_e.error("Error fetching space users:",Ot),Xe({title:"Error",description:"Failed to load space users",status:"error",duration:3e3,isClosable:!0})}finally{be(!1)}}};D.useEffect(()=>{i&&n&&a===4&&hn()},[i,n,a]);const Ut=Ge=>{const Ot=Ge.target.files[0];if(Ot){if(!Ot.type.startsWith("image/")){Xe({title:"Invalid file type",description:"Please select an image file",status:"error",duration:5e3,isClosable:!0});return}N(Ot);const Jt=new FileReader;Jt.onloadend=()=>{j(Jt.result)},Jt.readAsDataURL(Ot)}},ln=Ge=>{const Ot=Ge.target.files[0];if(Ot){if(!Ot.type.startsWith("image/")){Xe({title:"Invalid file type",description:"Please select an image file",status:"error",duration:5e3,isClosable:!0});return}te(Ot);const Jt=new FileReader;Jt.onloadend=()=>{J(Jt.result)},Jt.readAsDataURL(Ot)}},xn=async()=>{if(!A){Xe({title:"No file selected",description:"Please select a file to upload",status:"warning",duration:5e3,isClosable:!0});return}try{G(!0);const Ge=setInterval(()=>{K(Jt=>{const fn=Jt+10;return fn>=90?90:fn})},300),Ot=await kBe(i,A);clearInterval(Ge),K(100),ce(Ot),Xe({title:"Upload successful",description:"Space logo has been updated",status:"success",duration:5e3,isClosable:!0}),setTimeout(()=>{N(null),j(null),K(0),G(!1)},1e3),window.dispatchEvent(new CustomEvent("SpaceLogoUpdated",{detail:{logoUrl:Ot}}))}catch(Ge){console.error("Error uploading logo:",Ge),Xe({title:"Upload failed",description:Ge.message||"An error occurred during upload",status:"error",duration:5e3,isClosable:!0}),G(!1),K(0)}},Xt=async()=>{if(!ge){Xe({title:"No file selected",description:"Please select a file to upload",status:"warning",duration:5e3,isClosable:!0});return}try{he(!0);const Ge=setInterval(()=>{ue(Jt=>{const fn=Jt+10;return fn>=90?90:fn})},300),Ot=await DBe(i,ge);clearInterval(Ge),ue(100),He(Ot),Xe({title:"Upload successful",description:"Space background has been updated",status:"success",duration:5e3,isClosable:!0}),setTimeout(()=>{te(null),J(null),ue(0),he(!1)},1e3),window.dispatchEvent(new CustomEvent("SpaceBackgroundUpdated",{detail:{backgroundUrl:Ot}}))}catch(Ge){console.error("Error uploading background:",Ge),Xe({title:"Upload failed",description:Ge.message||"An error occurred during upload",status:"error",duration:5e3,isClosable:!0}),he(!1),ue(0)}},Yn=async()=>{if(ne)try{G(!0),await NBe(i),ce(null),Xe({title:"Logo removed",description:"Space logo has been removed",status:"info",duration:5e3,isClosable:!0}),G(!1),window.dispatchEvent(new CustomEvent("SpaceLogoUpdated",{detail:{logoUrl:null}}))}catch(Ge){console.error("Error deleting logo:",Ge),Xe({title:"Deletion failed",description:Ge.message||"An error occurred during deletion",status:"error",duration:5e3,isClosable:!0}),G(!1)}},qt=async()=>{if(Me)try{he(!0),await LBe(i),He(null),Xe({title:"Background removed",description:"Space background has been removed",status:"info",duration:5e3,isClosable:!0}),he(!1),window.dispatchEvent(new CustomEvent("SpaceBackgroundUpdated",{detail:{backgroundUrl:null}}))}catch(Ge){console.error("Error deleting background:",Ge),Xe({title:"Deletion failed",description:Ge.message||"An error occurred during deletion",status:"error",duration:5e3,isClosable:!0}),he(!1)}},Re=()=>{oe.current&&oe.current.click()},Fe=()=>{rt.current&&rt.current.click()},Ke=async()=>{dt(!0);try{await xBe(i,{voiceDisabled:!Ae}),Ue(!Ae),Xe({title:"Settings Updated",description:`Voice chat has been ${Ae?"enabled":"disabled"} for this space.`,status:"success",duration:3e3,isClosable:!0})}catch(Ge){_e.error("Error updating voice settings:",Ge),Xe({title:"Error",description:"Failed to update voice settings",status:"error",duration:3e3,isClosable:!0})}finally{dt(!1)}},Et=async()=>{dt(!0);try{await MBe(i,!ze),et(!ze),Xe({title:"Settings Updated",description:`Space is now ${ze?"not accessible":"accessible"} to all users.`,status:"success",duration:3e3,isClosable:!0})}catch(Ge){_e.error("Error updating accessibility settings:",Ge),Xe({title:"Error",description:"Failed to update accessibility settings",status:"error",duration:3e3,isClosable:!0})}finally{dt(!1)}},bt=async()=>{if(i){w(!0);try{const Ge=BV(),Ot=Mi(Ge,"spaces",i);await nl(Ot,{name:d,description:y}),Xe({title:"Success",description:"Space details updated successfully",status:"success",duration:3e3,isClosable:!0}),window.dispatchEvent(new CustomEvent("SpaceDetailsUpdated",{detail:{name:d,description:y}}))}catch(Ge){_e.error("Error updating space details:",Ge),Xe({title:"Error",description:"Failed to update space details",status:"error",duration:3e3,isClosable:!0})}finally{w(!1)}}};return C.jsxs(ra,{isOpen:n,onClose:e,size:"lg",isCentered:!0,children:[C.jsx(oa,{backdropFilter:"blur(4px)"}),C.jsxs(ia,{bg:"rgba(23, 25, 35, 0.95)",color:"white",borderRadius:"md",boxShadow:"0 4px 20px rgba(0, 0, 0, 0.5)",maxW:"800px",h:"500px",overflow:"hidden",children:[C.jsx(tl,{borderBottom:"1px solid",borderColor:"whiteAlpha.200",py:2,fontSize:"md",fontWeight:"600",children:"Manage Space"}),C.jsx(ja,{size:"sm",color:"whiteAlpha.700",_hover:{color:"white",bg:"whiteAlpha.100"}}),C.jsx(sa,{p:0,display:"flex",children:C.jsxs(oC,{orientation:"vertical",variant:"unstyled",index:a,onChange:l,display:"flex",flexGrow:1,children:[C.jsxs(aC,{bg:"rgba(0, 0, 0, 0.2)",w:"80px",py:4,borderRight:"1px solid",borderColor:"whiteAlpha.200",children:[C.jsxs(qc,{display:"flex",flexDirection:"column",alignItems:"center",py:3,_selected:{bg:"whiteAlpha.100",color:"blue.300"},_hover:{bg:"whiteAlpha.50"},children:[C.jsx(Dn,{as:poe,mb:1}),C.jsx(ht,{fontSize:"xs",children:"Details"})]}),C.jsxs(qc,{display:"flex",flexDirection:"column",alignItems:"center",py:3,_selected:{bg:"whiteAlpha.100",color:"blue.300"},_hover:{bg:"whiteAlpha.50"},children:[C.jsx(Dn,{as:n0,mb:1}),C.jsx(ht,{fontSize:"xs",children:"Logo"})]}),C.jsxs(qc,{display:"flex",flexDirection:"column",alignItems:"center",py:3,_selected:{bg:"whiteAlpha.100",color:"blue.300"},_hover:{bg:"whiteAlpha.50"},children:[C.jsx(Dn,{as:yWe,mb:1}),C.jsx(ht,{fontSize:"xs",children:"Background"})]}),C.jsxs(qc,{display:"flex",flexDirection:"column",alignItems:"center",py:3,_selected:{bg:"whiteAlpha.100",color:"blue.300"},_hover:{bg:"whiteAlpha.50"},children:[C.jsx(Dn,{as:vWe,mb:1}),C.jsx(ht,{fontSize:"xs",children:"Settings"})]}),C.jsxs(qc,{display:"flex",flexDirection:"column",alignItems:"center",py:3,_selected:{bg:"whiteAlpha.100",color:"blue.300"},_hover:{bg:"whiteAlpha.50"},children:[C.jsx(Dn,{as:YJ,mb:1}),C.jsx(ht,{fontSize:"xs",children:"Users"})]})]}),C.jsxs(M1,{flexGrow:1,display:"flex",flexDirection:"column",overflowY:"auto",children:[C.jsxs(Cu,{p:4,display:"flex",flexDirection:"column",children:[C.jsx(ht,{fontSize:"sm",fontWeight:"600",mb:3,color:"blue.300",children:"Space Details"}),C.jsxs(ii,{spacing:4,align:"stretch",children:[C.jsxs(pi,{children:[C.jsx(Io,{fontSize:"xs",children:"Space Name"}),C.jsx(ls,{value:d,onChange:Ge=>p(Ge.target.value),placeholder:"Enter space name",size:"sm",bg:"whiteAlpha.100",borderColor:"whiteAlpha.200",_hover:{borderColor:"whiteAlpha.300"},_focus:{borderColor:"blue.300",boxShadow:"0 0 0 1px #63B3ED"},color:"white",maxLength:100})]}),C.jsxs(pi,{children:[C.jsx(Io,{fontSize:"xs",children:"Description"}),C.jsx(jne,{value:y,onChange:Ge=>v(Ge.target.value),placeholder:"Enter space description",size:"sm",bg:"whiteAlpha.100",borderColor:"whiteAlpha.200",_hover:{borderColor:"whiteAlpha.300"},_focus:{borderColor:"blue.300",boxShadow:"0 0 0 1px #63B3ED"},rows:4,resize:"vertical",maxLength:500})]}),C.jsxs(pi,{children:[C.jsx(Io,{fontSize:"xs",children:"Space Tags"}),C.jsx(St,{p:3,bg:"whiteAlpha.50",borderWidth:"1px",borderColor:"whiteAlpha.200",borderRadius:"md",children:i?C.jsx(moe,{spaceID:i}):C.jsxs(lg,{status:"warning",variant:"subtle",borderRadius:"md",children:[C.jsx(ug,{}),C.jsx(eR,{fontSize:"sm",children:"Space ID missing"}),C.jsx(tR,{fontSize:"xs",children:"Unable to load tags without a valid space ID."})]})})]}),C.jsx(zr,{colorScheme:"blue",size:"sm",onClick:bt,isLoading:b,loadingText:"Saving...",alignSelf:"flex-start",mt:2,children:"Save Details"})]})]}),C.jsxs(Cu,{p:4,display:"flex",flexDirection:"column",children:[C.jsx(ht,{fontSize:"sm",fontWeight:"600",mb:3,color:"blue.300",children:"Space Logo"}),C.jsx(ht,{fontSize:"xs",mb:4,children:"Upload a logo for your space. This will be displayed during loading."}),(ne||V)&&C.jsxs(mi,{direction:{base:"column",md:"row"},gap:4,mb:4,children:[ne&&C.jsxs(St,{borderWidth:"1px",borderRadius:"md",p:3,bg:"whiteAlpha.50",borderColor:"whiteAlpha.200",flex:"1",children:[C.jsx(ht,{fontSize:"xs",fontWeight:"medium",mb:2,children:"Current Logo"}),C.jsx(Gh,{src:ne,alt:"Space Logo",maxH:"120px",mx:"auto",objectFit:"contain"}),C.jsx(zr,{mt:3,colorScheme:"red",leftIcon:C.jsx(Dn,{as:dR}),onClick:Yn,isLoading:B,loadingText:"Removing...",size:"xs",variant:"ghost",children:"Remove Logo"})]}),V&&C.jsxs(St,{borderWidth:"1px",borderRadius:"md",p:3,bg:"whiteAlpha.50",borderColor:"whiteAlpha.200",flex:"1",children:[C.jsx(ht,{fontSize:"xs",fontWeight:"medium",mb:2,children:"Preview"}),C.jsx(Gh,{src:V,alt:"Preview",maxH:"120px",mx:"auto",objectFit:"contain"})]})]}),C.jsxs(pi,{children:[C.jsx(Io,{fontSize:"xs",children:"Upload New Logo"}),C.jsx(ls,{type:"file",accept:"image/*",onChange:Ut,ref:oe,display:"none"}),B&&C.jsxs(St,{mt:3,mb:3,children:[C.jsxs(ht,{fontSize:"xs",mb:1,children:["Uploading... ",ee,"%"]}),C.jsx(m0,{value:ee,size:"xs",colorScheme:"blue",borderRadius:"full"})]}),C.jsxs(Oi,{mt:3,spacing:3,children:[C.jsx(zr,{colorScheme:"blue",leftIcon:C.jsx(Dn,{as:n0}),onClick:Re,isDisabled:B,size:"sm",variant:"outline",children:"Browse"}),C.jsx(zr,{colorScheme:"green",leftIcon:C.jsx(Dn,{as:QV}),onClick:xn,isLoading:B,loadingText:"Uploading...",isDisabled:!A||B,size:"sm",children:"Upload"})]}),C.jsx(XU,{fontSize:"xs",color:"whiteAlpha.700",mt:2,children:"Recommended: PNG format with transparent background. Max height: 400px."})]})]}),C.jsxs(Cu,{p:4,display:"flex",flexDirection:"column",children:[C.jsx(ht,{fontSize:"sm",fontWeight:"600",mb:3,color:"blue.300",children:"Loading Background"}),C.jsx(ht,{fontSize:"xs",mb:4,children:"Upload a background image for your space. This will be displayed during loading."}),(Me||Z)&&C.jsxs(mi,{direction:{base:"column",md:"row"},gap:4,mb:4,children:[Me&&C.jsxs(St,{borderWidth:"1px",borderRadius:"md",p:3,bg:"whiteAlpha.50",borderColor:"whiteAlpha.200",flex:"1",children:[C.jsx(ht,{fontSize:"xs",fontWeight:"medium",mb:2,children:"Current Background"}),C.jsx(Gh,{src:Me,alt:"Space Background",maxH:"120px",mx:"auto",objectFit:"contain"}),C.jsx(zr,{mt:3,colorScheme:"red",leftIcon:C.jsx(Dn,{as:dR}),onClick:qt,isLoading:se,loadingText:"Removing...",size:"xs",variant:"ghost",children:"Remove Background"})]}),Z&&C.jsxs(St,{borderWidth:"1px",borderRadius:"md",p:3,bg:"whiteAlpha.50",borderColor:"whiteAlpha.200",flex:"1",children:[C.jsx(ht,{fontSize:"xs",fontWeight:"medium",mb:2,children:"Preview"}),C.jsx(Gh,{src:Z,alt:"Preview",maxH:"120px",mx:"auto",objectFit:"contain"})]})]}),C.jsxs(pi,{children:[C.jsx(Io,{fontSize:"xs",children:"Upload New Background"}),C.jsx(ls,{type:"file",accept:"image/*",onChange:ln,ref:rt,display:"none"}),se&&C.jsxs(St,{mt:3,mb:3,children:[C.jsxs(ht,{fontSize:"xs",mb:1,children:["Uploading... ",fe,"%"]}),C.jsx(m0,{value:fe,size:"xs",colorScheme:"blue",borderRadius:"full"})]}),C.jsxs(Oi,{mt:3,spacing:3,children:[C.jsx(zr,{colorScheme:"blue",leftIcon:C.jsx(Dn,{as:n0}),onClick:Fe,isDisabled:se,size:"sm",variant:"outline",children:"Browse"}),C.jsx(zr,{colorScheme:"green",leftIcon:C.jsx(Dn,{as:QV}),onClick:Xt,isLoading:se,loadingText:"Uploading...",isDisabled:!ge||se,size:"sm",children:"Upload"})]}),C.jsx(XU,{fontSize:"xs",color:"whiteAlpha.700",mt:2,children:"Recommended: High-quality image (1920x1080 or higher) that works well with the frosted glass overlay."})]})]}),C.jsxs(Cu,{p:4,display:"flex",flexDirection:"column",children:[C.jsx(ht,{fontSize:"sm",fontWeight:"600",mb:3,color:"blue.300",children:"Space Settings"}),C.jsx(ht,{fontSize:"xs",mb:4,children:"Configure settings for your space."}),C.jsxs(ii,{spacing:4,align:"stretch",children:[C.jsx(St,{borderWidth:"1px",borderRadius:"md",p:3,bg:"whiteAlpha.50",borderColor:"whiteAlpha.200",children:C.jsxs(Oi,{justify:"space-between",align:"center",children:[C.jsxs(St,{children:[C.jsxs(Oi,{mb:1,spacing:2,children:[C.jsxs(St,{position:"relative",w:"16px",h:"16px",children:[C.jsx(Dn,{as:bWe,color:Ae?"red.400":"green.400"}),Ae&&C.jsx(St,{position:"absolute",top:"50%",left:"0",right:"0",height:"2px",bg:"red.400",transform:"rotate(45deg)",transformOrigin:"center"})]}),C.jsx(ht,{fontSize:"sm",fontWeight:"600",children:"Voice Chat"})]}),C.jsx(ht,{fontSize:"xs",color:"whiteAlpha.800",children:Ae?"Voice chat is currently disabled for all users in this space.":"Voice chat is currently enabled for all users in this space."})]}),C.jsx(dg,{isChecked:!Ae,onChange:Ke,colorScheme:"green",size:"md",isDisabled:nt})]})}),C.jsx(St,{borderWidth:"1px",borderRadius:"md",p:3,bg:"whiteAlpha.50",borderColor:"whiteAlpha.200",children:C.jsxs(Oi,{justify:"space-between",align:"center",children:[C.jsxs(St,{children:[C.jsxs(Oi,{mb:1,spacing:2,children:[C.jsx(St,{position:"relative",w:"16px",h:"16px",children:C.jsx(Dn,{as:YJ,color:ze?"green.400":"red.400"})}),C.jsx(ht,{fontSize:"sm",fontWeight:"600",children:"Public Access"})]}),C.jsx(ht,{fontSize:"xs",color:"whiteAlpha.800",children:ze?"This space is accessible to all users in the 'users' group.":"This space is only accessible to specific users."}),C.jsx(ht,{fontSize:"xs",color:"blue.300",mt:1,children:"Note: Space owners and hosts will always have access regardless of this setting."})]}),C.jsx(dg,{isChecked:ze,onChange:Et,colorScheme:"green",size:"md",isDisabled:nt})]})}),C.jsxs(lg,{status:"info",variant:"subtle",bg:"whiteAlpha.100",borderRadius:"md",borderWidth:"1px",borderColor:"blue.800",children:[C.jsx(ug,{color:"blue.300"}),C.jsxs(St,{children:[C.jsx(eR,{fontSize:"xs",fontWeight:"medium",children:"Coming Soon"}),C.jsx(tR,{fontSize:"xs",children:"Additional space configuration options will be available in a future update."})]})]})]})]}),C.jsxs(Cu,{p:4,display:"flex",flexDirection:"column",children:[C.jsx(ht,{fontSize:"sm",fontWeight:"600",mb:3,color:"blue.300",children:"Manage Users"}),C.jsx(ht,{fontSize:"xs",mb:4,children:"View and manage the owners and hosts of this space."}),Te?C.jsx(mi,{justify:"center",align:"center",h:"200px",children:C.jsx(lf,{color:"blue.300"})}):C.jsxs(ii,{spacing:4,align:"stretch",children:[C.jsxs(St,{children:[C.jsxs(Oi,{mb:2,children:[C.jsx(Dn,{as:_We,color:"green.400"}),C.jsx(ht,{fontSize:"sm",fontWeight:"600",children:"Owners"}),C.jsx(_p,{colorScheme:"green",ml:2,children:we.length})]}),C.jsx(St,{borderWidth:"1px",borderRadius:"md",p:2,bg:"whiteAlpha.50",borderColor:"whiteAlpha.200",maxH:"120px",overflowY:"auto",css:{"&::-webkit-scrollbar":{width:"4px"},"&::-webkit-scrollbar-track":{background:"rgba(0,0,0,0.1)"},"&::-webkit-scrollbar-thumb":{background:"rgba(255,255,255,0.3)",borderRadius:"2px"}},children:we.length===0?C.jsx(ht,{fontSize:"xs",color:"whiteAlpha.600",children:"No owners found"}):C.jsx(ii,{spacing:1,align:"stretch",children:we.map(Ge=>C.jsxs(Oi,{spacing:2,p:1,borderRadius:"md",_hover:{bg:"whiteAlpha.100"},children:[C.jsx(ku,{size:"xs",src:Ge.photoURL,name:Ge.displayName}),C.jsxs(St,{children:[C.jsx(ht,{fontSize:"xs",children:Ge.displayName}),C.jsx(ht,{fontSize:"xs",color:"whiteAlpha.600",children:Ge.firstName&&Ge.lastName?`${Ge.firstName} ${Ge.lastName}`:"Full name not available"})]}),C.jsx(Lk,{}),C.jsx(_p,{colorScheme:"green",variant:"solid",fontSize:"2xs",children:"Owner"})]},Ge.uid))})})]}),C.jsxs(St,{children:[C.jsxs(Oi,{mb:2,children:[C.jsx(Dn,{as:SWe,color:"purple.400"}),C.jsx(ht,{fontSize:"sm",fontWeight:"600",children:"Hosts"}),C.jsx(_p,{colorScheme:"purple",ml:2,children:ve.length})]}),C.jsx(St,{borderWidth:"1px",borderRadius:"md",p:2,bg:"whiteAlpha.50",borderColor:"whiteAlpha.200",maxH:"120px",overflowY:"auto",css:{"&::-webkit-scrollbar":{width:"4px"},"&::-webkit-scrollbar-track":{background:"rgba(0,0,0,0.1)"},"&::-webkit-scrollbar-thumb":{background:"rgba(255,255,255,0.3)",borderRadius:"2px"}},children:ve.length===0?C.jsx(ht,{fontSize:"xs",color:"whiteAlpha.600",children:"No hosts found"}):C.jsx(ii,{spacing:1,align:"stretch",children:ve.map(Ge=>C.jsxs(Oi,{spacing:2,p:1,borderRadius:"md",_hover:{bg:"whiteAlpha.100"},children:[C.jsx(ku,{size:"xs",src:Ge.photoURL,name:Ge.displayName}),C.jsxs(St,{children:[C.jsx(ht,{fontSize:"xs",children:Ge.displayName}),C.jsx(ht,{fontSize:"xs",color:"whiteAlpha.600",children:Ge.firstName&&Ge.lastName?`${Ge.firstName} ${Ge.lastName}`:"Full name not available"})]}),C.jsx(Lk,{}),C.jsx(_p,{colorScheme:"purple",variant:"solid",fontSize:"2xs",children:"Host"})]},Ge.uid))})})]}),C.jsx(Cp,{borderColor:"whiteAlpha.200"}),C.jsxs(lg,{status:"info",variant:"subtle",bg:"whiteAlpha.100",borderRadius:"md",borderWidth:"1px",borderColor:"blue.800",py:2,fontSize:"xs",children:[C.jsx(ug,{color:"blue.300",boxSize:4}),C.jsxs(St,{children:[C.jsx(eR,{fontSize:"xs",fontWeight:"medium",children:"Coming Soon"}),C.jsx(tR,{fontSize:"xs",children:"User management features like adding/removing hosts and owners will be available in a future update."})]})]})]})]})]})]})})]})]})},kWe=({onTogglePlayerList:n,spaceID:e})=>{const{fullscreenRef:i}=Ud(),[a,l]=D.useState(!0),[d,p]=D.useState(!1),[y,v]=D.useState(!1),[b,w]=D.useState(!1),[A,N]=D.useState(!1),[V,j]=D.useState(!1),[B,G]=D.useState(null),[ee,K]=D.useState(!1),[ne,ce]=D.useState(!1),[oe,ge]=D.useState(!1),[te,Z]=D.useState(!1),J=xu(),{user:se}=D.useContext(ca),he=(se==null?void 0:se.Nickname)||"Unknown",[fe,ue]=D.useState(!1),Me=async()=>{if(se!=null&&se.uid&&e)try{const be=await af(se.uid);let Ae=!1,Ue=!1;if(be.groups){const et=`space_${e}_owners`,nt=`space_${e}_hosts`;Ae=be.groups.includes(et),Ue=be.groups.includes(nt)}const ze=await Sse(se.uid,"disruptiveAdmin");if(Z(ze),G({rpmURL:be.rpmURL?be.rpmURL.replace(".glb",".png?scene=fullbody-portrait-closeupfront&w=640&q=75"):null}),ce(Ae||ze),ge(Ue),!Ae&&!ze&&ee){K(!1);const et=new CustomEvent("editModeChanged",{detail:{enabled:!1}});window.dispatchEvent(et),J({title:"Edit Mode Disabled",description:"You don't have permission to edit this space.",status:"warning",duration:5e3,isClosable:!0,position:"top"})}}catch(be){console.error("Error fetching profile data:",be),ce(!1),ge(!1),Z(!1)}else ce(!1),ge(!1),Z(!1)};D.useEffect(()=>{Me()},[se==null?void 0:se.uid,e,ee]),D.useEffect(()=>{const be=()=>{l(!0)};return window.addEventListener("PlayerInstantiated",be),()=>{window.removeEventListener("PlayerInstantiated",be)}},[]),D.useEffect(()=>{(async()=>{try{window.agoraClient&&typeof window.agoraClient.voiceDisabled=="boolean"&&ue(window.agoraClient.voiceDisabled)}catch(Ue){console.error("Error checking if voice is disabled:",Ue)}})();const Ae=Ue=>{Ue.detail&&typeof Ue.detail.voiceDisabled=="boolean"&&(console.log("Voice setting changed:",Ue.detail.voiceDisabled),ue(Ue.detail.voiceDisabled))};return window.addEventListener("SpaceVoiceSettingChanged",Ae),()=>{window.removeEventListener("SpaceVoiceSettingChanged",Ae)}},[]);const He=()=>v(!y),rt=()=>w(!b),we=()=>{j(!V),Ne()},Ce=()=>{N(!1),Me()},ve=be=>{be.stopPropagation(),typeof n=="function"&&(_e.log("CanvasMainMenu: Toggling player list"),n())},Ne=()=>{p(!1)},Te=be=>{if(be.stopPropagation(),!ne){J({title:"Permission Denied",description:"You don't have permission to edit this space. Only space owners can use Edit Mode.",status:"error",duration:5e3,isClosable:!0,position:"top"});return}const Ae=!ee;K(Ae);const Ue=new CustomEvent("editModeChanged",{detail:{enabled:Ae}});window.dispatchEvent(Ue),J({title:Ae?"Edit Mode Enabled":"Edit Mode Disabled",description:Ae?"You can now make changes to the scene.":"Scene editing is now disabled.",status:Ae?"info":"success",duration:3e3,isClosable:!0,position:"top"})};return C.jsxs(C.Fragment,{children:[C.jsxs(rC,{isOpen:d,onClose:()=>p(!1),children:[C.jsx(iC,{as:Ma,icon:C.jsx(WBe,{}),"aria-label":"Main menu",variant:"ghost",color:"white",bg:d?"whiteAlpha.400":"whiteAlpha.200",_hover:{bg:d?"whiteAlpha.500":"whiteAlpha.300"},size:"md",onClick:()=>p(!d)}),C.jsx(Vl,{containerRef:i,children:C.jsx(sC,{bg:"rgba(0,0,0,0.4)",backdropFilter:"blur(10px)",border:"none",boxShadow:"lg",color:"white",width:"300px",p:4,borderRadius:"xl",zIndex:9999,transform:"none !important",children:C.jsxs(ii,{align:"stretch",spacing:4,children:[C.jsxs(Oi,{children:[C.jsx(ku,{size:"md",src:B==null?void 0:B.rpmURL,bg:"white",name:" ",borderWidth:"1px",borderColor:"whiteAlpha.300"}),C.jsxs(ii,{align:"start",spacing:0,children:[C.jsxs(Oi,{children:[C.jsx(ht,{fontWeight:"bold",children:he}),ne&&!te&&C.jsx(hg,{label:"Owner",placement:"top",hasArrow:!0,zIndex:1e4,openDelay:300,gutter:8,portalProps:{containerRef:i},children:C.jsx(St,{display:"inline-block",children:C.jsx(Dn,{as:qV,color:"green.400",boxSize:3})})}),!ne&&oe&&!te&&C.jsx(hg,{label:"Host",placement:"top",hasArrow:!0,zIndex:1e4,openDelay:300,gutter:8,portalProps:{containerRef:i},children:C.jsx(St,{display:"inline-block",children:C.jsx(Dn,{as:JV,color:"purple.400",boxSize:3})})}),te&&C.jsx(hg,{label:"Admin",placement:"top",hasArrow:!0,zIndex:1e4,openDelay:300,gutter:8,portalProps:{containerRef:i},children:C.jsx(St,{display:"inline-block",children:C.jsx(Dn,{as:H6e,color:"blue.400",boxSize:3})})})]}),C.jsx(ht,{fontSize:"sm",color:"whiteAlpha.800",children:"Spaces Metaverse"})]})]}),C.jsxs(Oi,{spacing:4,justify:"center",children:[C.jsx(Ma,{icon:C.jsx(K6e,{}),variant:"ghost",colorScheme:"whiteAlpha",size:"sm","aria-label":"People",_hover:{bg:"whiteAlpha.200"},onClick:ve}),ne&&C.jsx(Ma,{icon:C.jsx(V6e,{}),variant:"ghost",colorScheme:ee?"green":"whiteAlpha",size:"sm","aria-label":"Edit Mode",_hover:{bg:"whiteAlpha.200"},onClick:Te}),C.jsx(Ma,{icon:C.jsx(St,{w:"4",h:"4"}),variant:"ghost",colorScheme:"whiteAlpha",size:"sm","aria-label":"Action 3",_hover:{bg:"whiteAlpha.200"}}),C.jsx(Ma,{icon:C.jsx(St,{w:"4",h:"4"}),variant:"ghost",colorScheme:"whiteAlpha",size:"sm","aria-label":"Action 4",_hover:{bg:"whiteAlpha.200"}})]}),C.jsx(Cp,{borderColor:"whiteAlpha.300"}),C.jsxs(ii,{align:"stretch",spacing:2,children:[ne&&C.jsxs(Oi,{p:2,borderRadius:"md",_hover:{bg:"whiteAlpha.200"},onClick:be=>be.stopPropagation(),justify:"space-between",children:[C.jsx(ht,{fontSize:"md",children:"Edit Mode"}),C.jsx(dg,{id:"edit-mode-toggle",isChecked:ee,onChange:Te,colorScheme:"green",sx:{"& .chakra-switch__track":{bg:ee?"green.500":"black"}}})]}),ne&&C.jsx(ht,{fontSize:"md",cursor:"pointer",_hover:{bg:"whiteAlpha.200"},p:2,borderRadius:"md",onClick:we,children:"Manage Space"}),se&&e&&!fe&&C.jsx(fWe,{onClose:Ne}),C.jsx(ht,{fontSize:"md",cursor:"pointer",_hover:{bg:"whiteAlpha.200"},p:2,borderRadius:"md",onClick:He,children:"Settings"}),C.jsx(ht,{fontSize:"md",cursor:"pointer",_hover:{bg:"whiteAlpha.200"},p:2,borderRadius:"md",onClick:rt,children:"Controls"}),C.jsx(ht,{fontSize:"md",cursor:"pointer",_hover:{bg:"whiteAlpha.200"},p:2,borderRadius:"md",children:"Help"}),C.jsx(ht,{fontSize:"md",cursor:"pointer",_hover:{bg:"whiteAlpha.200"},p:2,borderRadius:"md",color:"red.300",children:"Leave"})]})]})})})]}),b&&C.jsx(pWe,{open:b,onClose:rt}),y&&C.jsx(gWe,{open:y,onClose:He}),A&&C.jsx(aoe,{open:A,onClose:Ce}),C.jsx(OWe,{isOpen:V,onClose:we})]})},NWe=({isOpen:n,onClose:e,mediaScreenId:i,onImageChange:a})=>{const{spaceID:l}=rl(),d=Ug(),p=xu(),y=D.useRef(null),v=D.useRef(null),b=D.useRef(),[w,A]=D.useState(null),[N,V]=D.useState(""),[j,B]=D.useState(!1),[G,ee]=D.useState(0),[K,ne]=D.useState(null),[ce,oe]=D.useState(!0),[ge,te]=D.useState(!1),[Z,J]=D.useState(!1),[se,he]=D.useState(0),[fe,ue]=D.useState("image"),[Me,He]=D.useState(""),[rt,we]=D.useState(!1);D.useEffect(()=>{(async()=>{if(n&&i&&l){oe(!0);try{const It=await Sp(l,i);if(It&&(It.imageUrl||It.videoUrl)){ne(It);const hn=It.mediaType==="video";ue(hn?"video":"image"),we(It.displayAsVideo||!1),hn&&It.videoUrl&&(He(It.videoUrl),he(1))}else ne(null)}catch(It){_e.error("Error fetching existing image:",It),ne(null)}finally{oe(!1)}}})()},[n,i,l]),D.useEffect(()=>{n||(A(null),V(""),ee(0),He(""))},[n]);const Ce=D.useCallback(Xe=>{Xe.preventDefault(),Xe.stopPropagation(),J(!0)},[]),ve=D.useCallback(Xe=>{Xe.preventDefault(),Xe.stopPropagation(),J(!1)},[]),Ne=D.useCallback(Xe=>{Xe.preventDefault(),Xe.stopPropagation()},[]),Te=D.useCallback(Xe=>{if(Xe.preventDefault(),Xe.stopPropagation(),J(!1),Xe.dataTransfer.files&&Xe.dataTransfer.files.length>0){const It=Xe.dataTransfer.files[0];be(It)}},[]);D.useEffect(()=>{const Xe=v.current;if(Xe)return Xe.addEventListener("dragenter",Ce),Xe.addEventListener("dragleave",ve),Xe.addEventListener("dragover",Ne),Xe.addEventListener("drop",Te),()=>{Xe.removeEventListener("dragenter",Ce),Xe.removeEventListener("dragleave",ve),Xe.removeEventListener("dragover",Ne),Xe.removeEventListener("drop",Te)}},[Ce,ve,Ne,Te]);const be=Xe=>{if(!Xe)return;if(!Xe.type.startsWith("image/")){p({title:"Invalid file type",description:"Please select an image file (PNG, JPEG, etc.)",status:"error",duration:5e3,isClosable:!0});return}A(Xe);const It=new FileReader;It.onloadend=()=>{V(It.result)},It.readAsDataURL(Xe)},Ae=Xe=>{const It=Xe.target.files[0];be(It)},Ue=async Xe=>{const It=Xe.target.checked;if(we(It),K)try{await P6e(l,i,It),It?d("SetMediaScreenImage",{mediaScreenId:i,imageUrl:null,videoUrl:K.videoUrl||null,mediaType:K.mediaType||"image",displayAsVideo:!0}):d("SetMediaScreenImage",{mediaScreenId:i,imageUrl:K.imageUrl||null,videoUrl:K.videoUrl||null,mediaType:K.mediaType||"image",displayAsVideo:!1}),ne({...K,displayAsVideo:It}),p({title:"Display mode updated",description:`The media screen will now be displayed as ${It?"video":"image"}`,status:"success",duration:3e3,isClosable:!0}),_e.log(`Updated display mode for media screen ${i} to ${It?"video":"image"}`),a&&a({type:"update",mediaScreenId:i,displayAsVideo:It})}catch(hn){_e.error("Error updating display mode:",hn),p({title:"Update failed",description:hn.message||"An error occurred while updating the display mode",status:"error",duration:5e3,isClosable:!0}),we(!It)}},ze=async()=>{if(fe==="image"&&!w){p({title:"No file selected",description:"Please select an image to upload",status:"warning",duration:5e3,isClosable:!0});return}if(fe==="video"&&!Me){p({title:"No video URL",description:"Please enter a video URL",status:"warning",duration:5e3,isClosable:!0});return}try{B(!0);const Xe=setInterval(()=>{ee(ln=>{const xn=ln+10;return xn>=90?90:xn})},300);let It;fe==="image"?It=await HJ(l,i,w,{mediaType:fe,displayAsVideo:rt}):(It=Me,await HJ(l,i,null,{mediaType:"video",directUrl:Me,displayAsVideo:rt})),clearInterval(Xe),ee(100);let hn=null,Ut=null;fe==="image"?(hn=rt?null:It,Ut=(K==null?void 0:K.videoUrl)||null):(hn=!rt&&(K!=null&&K.imageUrl)?K.imageUrl:null,Ut=It),d("SetMediaScreenImage",{mediaScreenId:i,imageUrl:hn,videoUrl:Ut,mediaType:fe,displayAsVideo:rt}),_e.log(`Uploaded and sent ${fe} for media screen ${i} (display as video: ${rt})`),a&&a({type:"upload",mediaScreenId:i,imageUrl:fe==="image"?It:K==null?void 0:K.imageUrl,videoUrl:fe==="video"?It:K==null?void 0:K.videoUrl,mediaType:fe,displayAsVideo:rt}),p({title:"Upload successful",description:`The ${fe} has been uploaded and applied to the media screen`,status:"success",duration:5e3,isClosable:!0}),setTimeout(()=>{A(null),V(""),B(!1),ee(0),e()},1e3)}catch(Xe){_e.error(`Error uploading ${fe}:`,Xe),p({title:"Upload failed",description:Xe.message||`An error occurred while uploading the ${fe}`,status:"error",duration:5e3,isClosable:!0}),B(!1),ee(0)}},et=async()=>{te(!1);try{B(!0),await A6e(l,i),d("SetMediaScreenImage",{mediaScreenId:i,imageUrl:fe==="image"?null:(K==null?void 0:K.imageUrl)||null,videoUrl:fe==="video"?null:(K==null?void 0:K.videoUrl)||null,mediaType:null,displayAsVideo:!1}),_e.log(`Deleted ${fe} for media screen ${i}`),a&&a({type:"delete",mediaScreenId:i}),p({title:`${fe==="image"?"Image":"Video"} deleted`,description:`The ${fe} has been removed from the media screen`,status:"success",duration:5e3,isClosable:!0}),ne(null),B(!1),He(""),we(!1),setTimeout(()=>{e()},500)}catch(Xe){_e.error(`Error deleting ${fe}:`,Xe),p({title:"Deletion failed",description:Xe.message||`An error occurred while deleting the ${fe}`,status:"error",duration:5e3,isClosable:!0}),B(!1)}},nt=()=>{j||(A(null),V(""),ee(0),e())},dt=Xe=>{he(Xe),ue(Xe===0?"image":"video")};return C.jsxs(C.Fragment,{children:[C.jsxs(ra,{isOpen:n,onClose:nt,size:"xl",children:[C.jsx(oa,{backdropFilter:"blur(10px)"}),C.jsxs(ia,{bg:"gray.800",color:"white",maxW:"900px",children:[C.jsx(tl,{children:"Media Screen Content"}),C.jsx(ja,{isDisabled:j}),C.jsxs(St,{px:6,pb:2,children:[C.jsxs(mi,{justify:"space-between",align:"center",bg:"gray.700",p:4,borderRadius:"md",mb:4,children:[C.jsxs(Oi,{spacing:4,children:[C.jsx(ht,{fontWeight:"medium",children:"Display as:"}),C.jsxs(Oi,{spacing:2,children:[C.jsx(Dn,{as:n0,color:rt?"gray.400":"green.300"}),C.jsx(dg,{colorScheme:"purple",size:"md",isChecked:rt,onChange:Ue}),C.jsx(Dn,{as:MO,color:rt?"purple.300":"gray.400"})]})]}),C.jsx(_p,{colorScheme:rt?"purple":"green",fontSize:"sm",px:2,py:1,borderRadius:"md",children:rt?"Video Output":"Image Output"})]}),C.jsxs(ht,{fontSize:"sm",color:"gray.400",mb:1,children:["Media Screen ID: ",C.jsx("strong",{children:i})]}),C.jsx(ht,{fontSize:"xs",color:"gray.500",mb:2,children:"The toggle above controls how the content will be displayed in the 3D space, regardless of the content type you upload."}),C.jsx(Cp,{mb:4})]}),C.jsx(sa,{children:C.jsxs(mi,{children:[C.jsx(oC,{orientation:"vertical",variant:"solid-rounded",colorScheme:"blue",index:se,onChange:dt,h:"100%",minW:"120px",mr:4,children:C.jsxs(aC,{children:[C.jsxs(qc,{_selected:{color:"white",bg:"blue.500"},mb:2,py:6,justifyContent:"flex-start",children:[C.jsx(Dn,{as:n0,mr:2})," Image"]}),C.jsxs(qc,{_selected:{color:"white",bg:"blue.500"},py:6,justifyContent:"flex-start",children:[C.jsx(Dn,{as:MO,mr:2})," Video"]})]})}),C.jsx(St,{flex:"1",children:ce?C.jsx(mi,{justify:"center",align:"center",h:"150px",children:C.jsx(lf,{size:"xl",color:"blue.400"})}):C.jsxs(C.Fragment,{children:[C.jsx(St,{children:se===0?C.jsxs(ii,{spacing:4,align:"stretch",children:[K&&K.imageUrl&&fe==="image"&&C.jsxs(St,{children:[C.jsx(ht,{fontWeight:"semibold",mb:2,children:"Current Image:"}),C.jsxs(mi,{children:[C.jsx(St,{borderWidth:"1px",borderRadius:"md",overflow:"hidden",mb:2,maxW:"200px",mr:4,children:C.jsx(Gh,{src:K.imageUrl,alt:"Current image",maxHeight:"150px",width:"100%",objectFit:"contain"})}),C.jsxs(ii,{align:"flex-start",spacing:2,children:[C.jsxs(ht,{fontSize:"xs",color:"gray.400",children:["Uploaded: ",new Date(K.uploadedAt).toLocaleString()]}),C.jsxs(ht,{fontSize:"xs",color:"gray.400",children:["Display Mode: ",K.displayAsVideo?"Video":"Image"]}),C.jsx(zr,{size:"sm",colorScheme:"red",variant:"outline",leftIcon:C.jsx(Dn,{as:dR}),onClick:()=>te(!0),isDisabled:j,children:"Delete"})]})]}),C.jsx(Cp,{my:4})]}),C.jsx(ht,{fontWeight:"semibold",mb:2,children:K&&K.imageUrl&&fe==="image"?"Replace with new image:":"Upload new image:"}),C.jsxs(St,{ref:v,borderWidth:"2px",borderRadius:"md",borderStyle:"dashed",borderColor:Z?"blue.400":"gray.500",bg:Z?"blue.900":"gray.700",p:6,textAlign:"center",transition:"all 0.2s",_hover:{borderColor:"blue.400",bg:"gray.600"},cursor:"pointer",onClick:()=>y.current.click(),children:[N?C.jsx(St,{borderRadius:"md",overflow:"hidden",maxH:"200px",children:C.jsx(Gh,{src:N,alt:"Preview",maxHeight:"200px",width:"100%",objectFit:"contain"})}):C.jsxs(ii,{spacing:2,children:[C.jsx(Dn,{as:QV,boxSize:"24px",color:"gray.400"}),C.jsx(ht,{children:"Drag and drop an image here, or click to browse"}),C.jsx(ht,{fontSize:"xs",color:"gray.400",children:"Supports PNG, JPG, JPEG, GIF"})]}),C.jsx(ls,{type:"file",accept:"image/*",onChange:Ae,ref:y,display:"none"})]}),w&&C.jsxs(ht,{fontSize:"sm",children:["Selected file: ",w.name," (",Math.round(w.size/1024)," KB)"]})]}):C.jsxs(ii,{spacing:4,align:"stretch",children:[K&&K.videoUrl&&fe==="video"&&C.jsxs(St,{children:[C.jsx(ht,{fontWeight:"semibold",mb:2,children:"Current Video URL:"}),C.jsxs(mi,{children:[C.jsx(St,{borderWidth:"1px",borderRadius:"md",p:3,mb:2,flex:"1",mr:4,bg:"gray.700",children:C.jsx(ht,{fontSize:"sm",wordBreak:"break-all",children:K.videoUrl})}),C.jsxs(ii,{align:"flex-start",spacing:2,children:[C.jsxs(ht,{fontSize:"xs",color:"gray.400",children:["Added: ",new Date(K.uploadedAt).toLocaleString()]}),C.jsxs(ht,{fontSize:"xs",color:"gray.400",children:["Display Mode: ",K.displayAsVideo?"Video":"Image"]}),C.jsx(zr,{size:"sm",colorScheme:"red",variant:"outline",leftIcon:C.jsx(Dn,{as:dR}),onClick:()=>te(!0),isDisabled:j,children:"Delete"})]})]}),C.jsx(Cp,{my:4})]}),C.jsx(ht,{fontWeight:"semibold",mb:2,children:K&&K.videoUrl&&fe==="video"?"Replace with new video:":"Add video URL:"}),C.jsx(St,{p:3,bg:"blue.900",borderRadius:"md",mb:4,borderLeftWidth:"4px",borderLeftColor:"blue.400",children:C.jsxs(Oi,{children:[C.jsx(Dn,{as:poe,color:"blue.300"}),C.jsx(ht,{fontSize:"sm",fontWeight:"medium",children:'After entering a URL, click the "Save Video URL" button at the bottom to save your changes.'})]})}),C.jsxs(pi,{children:[C.jsx(Io,{fontSize:"sm",children:"Video URL"}),C.jsx(ls,{placeholder:"Enter video URL (YouTube, Vimeo, etc.)",value:Me,onChange:Xe=>He(Xe.target.value),bg:"gray.700",borderColor:"gray.600",_hover:{borderColor:"blue.400"},_focus:{borderColor:"blue.400",boxShadow:"0 0 0 1px var(--chakra-colors-blue-400)"},size:"lg"}),C.jsx(ht,{fontSize:"xs",color:"gray.400",mt:1,children:"Enter a URL from YouTube, Vimeo, or other video hosting services"})]}),C.jsxs(St,{mt:4,p:4,bg:"gray.700",borderRadius:"md",children:[C.jsxs(Oi,{children:[C.jsx(Dn,{as:MO,color:"blue.300"}),C.jsx(ht,{fontWeight:"medium",children:"Video Support"})]}),C.jsx(ht,{fontSize:"sm",mt:2,color:"gray.300",children:"Video playback will be implemented in a future update. For now, you can add the URL which will be stored with the media screen."}),C.jsx(ht,{fontSize:"sm",mt:2,color:"yellow.300",fontWeight:"medium",children:'Important: Click the "Upload" button at the bottom to save your video URL.'})]}),Me&&C.jsxs(St,{mt:4,p:4,bg:"gray.900",borderRadius:"md",borderWidth:"1px",borderColor:"blue.500",children:[C.jsxs(Oi,{mb:2,children:[C.jsx(Dn,{as:EWe,color:"blue.300"}),C.jsx(ht,{fontWeight:"medium",children:"URL Preview"})]}),C.jsx(ht,{fontSize:"sm",wordBreak:"break-all",color:"gray.300",children:Me}),C.jsx(ht,{fontSize:"xs",color:"gray.400",mt:2,children:"This URL will be saved when you click the Upload button below"})]})]})}),j&&C.jsxs(St,{mt:4,children:[C.jsxs(ht,{mb:2,children:["Uploading: ",G,"%"]}),C.jsx(m0,{value:G,colorScheme:"blue",size:"sm",borderRadius:"md"})]})]})})]})}),C.jsxs(bg,{children:[C.jsx(zr,{variant:"ghost",mr:3,onClick:nt,isDisabled:j,children:"Cancel"}),C.jsx(zr,{colorScheme:"blue",onClick:ze,isLoading:j,loadingText:"Uploading",isDisabled:fe==="image"&&!w||fe==="video"&&!Me||j||ce,leftIcon:C.jsx(Dn,{as:fe==="image"?n0:MO}),size:"lg",px:6,children:fe==="image"?"Upload Image":"Save Video URL"})]})]})]}),C.jsx(lMe,{isOpen:ge,leastDestructiveRef:b,onClose:()=>te(!1),children:C.jsx(oa,{children:C.jsxs(uMe,{bg:"gray.800",color:"white",children:[C.jsxs(tl,{fontSize:"lg",fontWeight:"bold",children:["Delete ",fe==="video"?"Video":"Image"]}),C.jsxs(sa,{children:["Are you sure you want to delete this ",fe,"? This will revert the media screen to its blank state."]}),C.jsxs(bg,{children:[C.jsx(zr,{ref:b,onClick:()=>te(!1),children:"Cancel"}),C.jsx(zr,{colorScheme:"red",onClick:et,ml:3,leftIcon:C.jsx(Dn,{as:dR}),children:"Delete"})]})]})})})]})},DWe=n=>{const[e,i]=D.useState(null),[a,l]=D.useState(""),[d,p]=D.useState(null),[y,v]=D.useState(!1),b=jp(),{spaceID:w}=rl(),A=D.useCallback(j=>{var B,G;try{if(!j)return null;if(j.includes("youtube.com")||j.includes("youtu.be")){let ee="";return j.includes("youtube.com/watch")?ee=new URLSearchParams(new URL(j).search).get("v"):j.includes("youtu.be/")&&(ee=j.split("youtu.be/")[1].split("?")[0]),ee?`https://www.youtube.com/embed/${ee}?autoplay=1`:j}if(j.includes("vimeo.com")){if(j.includes("player.vimeo.com/video"))return j;const ee=(G=(B=j.split("vimeo.com/")[1])==null?void 0:B.split("?")[0])==null?void 0:G.split("/")[0];return ee?`https://player.vimeo.com/video/${ee}?autoplay=1`:j}return j}catch(ee){return _e.error("Error converting to embed URL:",ee),j}},[]),N=D.useCallback(()=>{setTimeout(()=>{v(!1),_e.log("Video processing state reset")},100)},[]);D.useEffect(()=>{let j=!0,B=null;const ee=b("PlayMediaScreenVideo",async K=>{try{console.log("[DEBUG] PlayMediaScreenVideo event received:",K,"isEditMode:",n),console.log("PlayMediaScreenVideo event received:",K);const{mediaScreenId:ne,videoUrl:ce}=K||{};if(!ne){_e.error("Media screen ID is missing in Unity event data."),N();return}if(n){console.log(`[DEBUG] Edit mode is active for screen ${ne}, setting ID but not playing video`),_e.log("Edit mode is active, setting media screen ID but not playing video"),p(ne);return}if(v(!0),B=setTimeout(()=>{j&&(_e.warn("Video processing timeout reached, resetting state"),v(!1))},5e3),ce){if(console.log(`Using direct video URL from event: ${ce}`),j)try{const oe=A(ce);console.log(`Setting video URL to: ${oe} (original: ${ce})`),i(oe),l(`Media Screen ${ne}`),p(ne),_e.log("Media screen video URL set directly from event:",oe)}catch(oe){_e.error("Error setting video URL from direct URL:",oe)}finally{N(),clearTimeout(B)}return}console.log(`Fetching media screen data for ID: ${ne}`);try{const oe=await Sp(w,ne);if(console.log("Media screen data from Firestore:",oe),!oe||!oe.videoUrl){_e.error("No video URL found for media screen:",ne),N(),clearTimeout(B);return}if(!oe.displayAsVideo){_e.log("Media screen is not set to display as video:",ne),console.log("displayAsVideo flag is false for this media screen"),N(),clearTimeout(B);return}if(j)try{const ge=A(oe.videoUrl);console.log(`Setting video URL to: ${ge} (original: ${oe.videoUrl})`),i(ge),l(oe.title||`Media Screen ${ne}`),p(ne),_e.log("Media screen video URL set to:",ge)}catch(ge){_e.error("Error setting video URL from Firestore:",ge)}finally{N(),clearTimeout(B)}}catch(oe){_e.error(`Error fetching media screen data for ${ne}:`,oe),N(),clearTimeout(B)}}catch(ne){_e.error("Error handling media screen video play:",ne),console.error("Error handling media screen video play:",ne),N(),clearTimeout(B)}});return()=>{j=!1,B&&clearTimeout(B),ee()}},[b,w,n,A,N]);const V=D.useCallback(()=>{i(null),l(""),p(null),v(!1),_e.log("Video player state reset")},[]);return[e,a,d,V,y]},LWe=()=>{const{spaceID:n}=rl(),e=Ug(),i=jp(),[a,l]=D.useState(!1);D.useEffect(()=>{if(window.isPlayerInstantiated){_e.log("useMediaScreenThumbnails: Unity already ready (via window flag)"),l(!0);return}const b=()=>{_e.log("useMediaScreenThumbnails: Unity is now ready (PlayerInstantiated event)"),l(!0)};return window.addEventListener("PlayerInstantiated",b),()=>{window.removeEventListener("PlayerInstantiated",b)}},[]);const d=D.useCallback(async b=>{try{return b.includes("vimeo.com")?await p(b):b.includes("youtube.com")||b.includes("youtu.be")?await y(b):"https://via.placeholder.com/640x360?text=Video"}catch(w){return _e.error(`Error fetching thumbnail for ${b}:`,w),"https://via.placeholder.com/640x360?text=Error"}},[]),p=async b=>{try{const w=`https://vimeo.com/api/oembed.json?url=${encodeURIComponent(b)}`,A=await fetch(w);if(!A.ok)throw new Error(`Failed to fetch Vimeo thumbnail: ${A.statusText}`);const N=await A.json(),V=N.thumbnail_url.replace(/_\d+x\d+/,""),j=["640x360","295x166"];let B=null;for(let G of j){const ee=`https://i.vimeocdn.com/filter/overlay?src0=${encodeURIComponent(`${V}_${G}`)}&src1=http://f.vimeocdn.com/p/images/crawler_play.png`;try{if((await fetch(ee,{method:"HEAD"})).ok){B=ee;break}}catch(K){_e.warn(`Failed to validate thumbnail URL: ${ee}`,K)}}return B||N.thumbnail_url}catch(w){return _e.error(`Error fetching Vimeo thumbnail: ${w.message}`),"https://via.placeholder.com/640x360?text=Vimeo+Video"}},y=async b=>{let w="";if(b.includes("youtube.com/watch")?w=new URLSearchParams(new URL(b).search).get("v"):b.includes("youtu.be/")&&(w=b.split("youtu.be/")[1].split("?")[0]),!w)throw new Error("Could not extract YouTube video ID");const A=`https://img.youtube.com/vi/${w}/maxresdefault.jpg`;try{if((await fetch(A,{method:"HEAD"})).ok)return A}catch(N){_e.warn(`Failed to validate maxresdefault thumbnail for YouTube video ${w}`,N)}return`https://img.youtube.com/vi/${w}/hqdefault.jpg`},v=D.useCallback(async b=>{try{if(!n||!b)return;_e.log(`Refreshing thumbnail for media screen ${b}`);const w=await Sp(n,b);if(!w){_e.log(`No media screen found with ID ${b}`);return}if(_e.log("Media screen data:",w),!w.displayAsVideo||!w.videoUrl){_e.log(`Media screen ${b} is not set to display as video or has no video URL`);return}const A=await d(w.videoUrl);e("SetMediaScreenThumbnail",{mediaScreenId:b,thumbnailUrl:A}),_e.log(`Sent refreshed thumbnail for media screen ${b}: ${A}`)}catch(w){_e.error(`Error refreshing thumbnail for media screen ${b}:`,w)}},[n,d,e]);D.useEffect(()=>{if(!a){_e.log("useMediaScreenThumbnails: Waiting for Unity to be ready before setting up thumbnail listeners");return}_e.log("useMediaScreenThumbnails: Unity is ready, now setting up thumbnail listeners");const w=i("SetMediaScreenThumbnail",async A=>{try{const{mediaScreenId:N,thumbnailUrl:V}=A;V==="refresh"&&N&&(console.log(`Received request to refresh thumbnail for media screen ${N}`),await v(N))}catch(N){console.error("Error handling SetMediaScreenThumbnail event:",N)}});return()=>{w()}},[i,v,a]),D.useEffect(()=>{if(!a){_e.log("useMediaScreenThumbnails: Waiting for Unity to be ready before fetching thumbnails");return}_e.log("useMediaScreenThumbnails: Unity is ready, now fetching thumbnails");const b=async()=>{try{if(!n)throw new Error("spaceID is not defined.");_e.log("Fetching media screens for thumbnails...");const A=await G4(n);_e.log("All media screens:",A);const N=A.filter(B=>B.displayAsVideo&&B.videoUrl);if(_e.log("Media screens set to display as videos:",N),N.length===0){_e.log("No media screens set to display as videos found.");return}_e.log(`Found ${N.length} media screens set to display as videos.`);const V=N.map(async B=>{try{const G=await d(B.videoUrl);return _e.log(`Fetched thumbnail for ${B.id}: ${G}`),{mediaScreenId:B.id,thumbnailUrl:G}}catch(G){return _e.error(`Error processing thumbnail for media screen ${B.id}:`,G),{mediaScreenId:B.id,thumbnailUrl:"https://via.placeholder.com/640x360?text=Error"}}}),j=await Promise.all(V);_e.log("Fetched Media Screen Thumbnails",j),j.forEach(({mediaScreenId:B,thumbnailUrl:G})=>{e("SetMediaScreenThumbnail",{mediaScreenId:B,thumbnailUrl:G}),_e.log(`Sent thumbnail to Unity for media screen ${B}: ${G}`)})}catch(A){_e.error("Error fetching media screen thumbnails:",A)}};b();const w=setInterval(b,5*60*1e3);return()=>{clearInterval(w)}},[e,n,d,a])},XJ={iframeContainer:{position:"relative",paddingBottom:"56.25%",height:0,overflow:"hidden",width:"100%",pointerEvents:"auto !important"},iframe:{position:"absolute",top:0,left:0,width:"100%",height:"100%",border:"none",pointerEvents:"auto !important",zIndex:1e4}},xWe=()=>C.jsx("style",{dangerouslySetInnerHTML:{__html:`
        /* Disable pointer events on Unity elements when modal is open */
        body.unity-input-disabled #unity-container,
        body.unity-input-disabled #unity-canvas {
          pointer-events: none !important;
        }
        
        /* Make sure the modal is above Unity */
        .chakra-modal__overlay {
          z-index: 1001 !important;
          pointer-events: auto !important;
        }
        
        .chakra-modal__content {
          z-index: 1002 !important;
          pointer-events: auto !important;
        }
        
        /* Make sure the iframe is visible and interactive */
        .video-iframe {
          z-index: 1003 !important;
          pointer-events: auto !important;
        }
        
        /* Make sure the close button is accessible */
        .chakra-modal__close-btn {
          z-index: 1004 !important;
        }
        
        /* Ensure the iframe container allows clicks */
        .iframe-container {
          pointer-events: auto !important;
        }
        
        /* Remove the full-screen blocker */
      `}}),MWe=({videoUrl:n,videoTitle:e,mediaScreenId:i,isOpen:a,onClose:l})=>{const{fullscreenRef:d}=Ud();return fN(a,`video-modal-${i}`),D.useEffect(()=>{if(a){const p=b=>{b.target.classList&&b.target.classList.contains("chakra-modal__overlay")&&(b.stopPropagation(),b.preventDefault())};document.addEventListener("mousemove",p,!0),document.addEventListener("mousedown",p,!0),document.addEventListener("mouseup",p,!0),document.addEventListener("click",p,!0),document.addEventListener("wheel",p,!0);const y=document.getElementById("unity-canvas"),v=document.getElementById("unity-container");if(y&&(y.style.pointerEvents="none"),v&&(v.style.pointerEvents="none"),document.body.classList.add("unity-input-disabled"),window.unityInstance)try{window.unityInstance.SendMessage("WebGLInputManager","Disable"),window.unityInstance.SendMessage("CameraController","DisableInput","VideoModal")}catch(b){console.error("Error disabling Unity input:",b)}return()=>{if(document.removeEventListener("mousemove",p,!0),document.removeEventListener("mousedown",p,!0),document.removeEventListener("mouseup",p,!0),document.removeEventListener("click",p,!0),document.removeEventListener("wheel",p,!0),y&&(y.style.pointerEvents="auto"),v&&(v.style.pointerEvents="auto"),document.body.classList.remove("unity-input-disabled"),window.unityInstance)try{window.unityInstance.SendMessage("WebGLInputManager","Enable"),window.unityInstance.SendMessage("CameraController","EnableInput","VideoModal")}catch(b){console.error("Error re-enabling Unity input:",b)}}}},[a]),C.jsxs(C.Fragment,{children:[C.jsx(xWe,{}),C.jsxs(ra,{isOpen:a,onClose:l,size:"xl",isCentered:!0,portalProps:{containerRef:d},closeOnOverlayClick:!0,closeOnEsc:!0,id:`video-modal-${i}`,children:[C.jsx(oa,{bg:"rgba(0, 0, 0, 0.8)",onClick:p=>{p.target===p.currentTarget&&(l(),p.stopPropagation(),p.preventDefault())},onMouseMove:p=>{p.target===p.currentTarget&&(p.stopPropagation(),p.preventDefault())},onMouseDown:p=>{p.target===p.currentTarget&&(p.stopPropagation(),p.preventDefault())},onMouseUp:p=>{p.target===p.currentTarget&&(p.stopPropagation(),p.preventDefault())},onWheel:p=>{p.target===p.currentTarget&&(p.stopPropagation(),p.preventDefault())},style:{pointerEvents:"auto"}}),C.jsxs(ia,{bg:"gray.900",color:"white",borderRadius:"lg",overflow:"hidden",maxWidth:"80vw",maxHeight:"80vh",className:"video-modal-content",children:[C.jsx(ja,{size:"lg",bg:"gray.700",color:"white",borderRadius:"full",zIndex:"10004",_hover:{bg:"gray.600"},position:"absolute",top:"10px",right:"10px"}),C.jsx(sa,{p:0,width:"100%",children:n?C.jsx(St,{className:"iframe-container",style:XJ.iframeContainer,children:C.jsx("iframe",{className:"video-iframe",src:n,style:XJ.iframe,allow:"autoplay; fullscreen",allowFullScreen:!0,title:e||"Video Player"})}):C.jsxs(mi,{direction:"column",align:"center",justify:"center",h:"400px",children:[C.jsx(lf,{size:"xl",mb:4}),C.jsx(ht,{children:"Unable to load video"}),C.jsx(ht,{fontSize:"sm",color:"gray.400",mt:2,children:"No video URL provided"})]})})]})]})]})},xs=(...n)=>{},UWe=()=>{const{isOpen:n,onOpen:e,onClose:i}=rf(),[a,l]=D.useState(null),[d,p]=D.useState("image"),y=D.useRef(null);fN(n,"image-viewer-modal");const v=D.useCallback(A=>{A.stopPropagation()},[]);return D.useEffect(()=>{if(n&&y.current){const A=y.current;A.addEventListener("mousemove",v),A.addEventListener("mousedown",v),A.addEventListener("mouseup",v),A.addEventListener("wheel",v);const N=document.getElementById("unity-canvas");return N&&(N.style.pointerEvents="none"),()=>{A.removeEventListener("mousemove",v),A.removeEventListener("mousedown",v),A.removeEventListener("mouseup",v),A.removeEventListener("wheel",v),N&&(N.style.pointerEvents="auto")}}},[n,v]),{isOpen:n,currentImageUrl:a,currentMediaType:d,openImageViewer:(A,N="image")=>{console.log(`[DEBUG] Opening image viewer with URL: ${A} and original media type: ${N}`);const V=typeof A=="string"&&(A.match(/\.(jpeg|jpg|gif|png|webp)($|\?)/i)||A.includes("firebasestorage")&&!A.includes("video")),j=V?"image":N;console.log(`[DEBUG] Detected URL as ${V?"image":"non-image"}, using media type: ${j}`),l(A),p(j),e()},closeImageViewer:()=>{i(),setTimeout(()=>{l(null),p("image")},300)},modalContentRef:y,preventPropagation:v}},VWe=()=>C.jsx("style",{dangerouslySetInnerHTML:{__html:`
        body.unity-input-disabled #unity-container,
        body.unity-input-disabled #unity-canvas {
          pointer-events: none !important;
        }
        
        .image-viewer-modal-content {
          pointer-events: auto !important;
        }
        
        .chakra-modal__overlay {
          pointer-events: auto !important;
        }
      `}}),hU=n=>{if(!n)return null;try{if(n.includes("firebasestorage.googleapis.com")){const e=new URL(n),i=e.searchParams.get("alt"),a=e.searchParams.get("token");return e.search="",i&&e.searchParams.set("alt",i),a&&e.searchParams.set("token",a),xs(`Cleaned Firebase URL from ${n} to ${e.toString()}`),e.toString()}return n}catch(e){return console.error("Error cleaning Firebase URL:",e),n}},FWe=()=>{const{spaceID:n}=rl(),[e,i]=D.useState(!1),[a,l]=D.useState([]),[d,p]=D.useState(null),{isOpen:y,onOpen:v,onClose:b}=rf(),[w,A]=D.useState({}),[N,V]=D.useState(0);D.useRef(null);const j=Ug(),{fullscreenRef:B}=Ud(),G=jp(),[ee,K]=D.useState(!1),{isOpen:ne,currentImageUrl:ce,currentMediaType:oe,openImageViewer:ge,closeImageViewer:te,modalContentRef:Z,preventPropagation:J}=UWe(),[se,he,fe,ue,Me]=DWe(e),{isOpen:He,onOpen:rt,onClose:we}=rf();LWe(),noe(),D.useEffect(()=>{if(window.isPlayerInstantiated){K(!0);return}const be=()=>{K(!0)};return window.addEventListener("PlayerInstantiated",be),()=>{window.removeEventListener("PlayerInstantiated",be)}},[]);const Ce=D.useCallback(be=>{if(Array.isArray(a)&&a.length>0){const Ae=a.find(Ue=>Ue.mediaScreenId===be);if(Ae){const Ue=Ae.imageUrl,ze=Ae.videoUrl;return{screen:Ae,imageUrl:Ue,videoUrl:ze,mediaType:Ae.mediaType||"image",displayAsVideo:Ae.displayAsVideo||!1}}}else console.warn("mediaScreens is not an array or is empty:",a);if(ce){let Ae=null;return Array.isArray(a)&&(Ae=a.find(Ue=>Ue.mediaScreenId===be)),{screen:Ae||{mediaScreenId:be},imageUrl:ce,videoUrl:null,mediaType:(Ae==null?void 0:Ae.mediaType)||"image",displayAsVideo:(Ae==null?void 0:Ae.displayAsVideo)||!1}}return n&&be&&Sp(n,be).then(Ae=>{Ae&&l(Ue=>Array.isArray(Ue)&&Ue.some(et=>et.mediaScreenId===be)?Ue.map(et=>et.mediaScreenId===be?{...et,imageUrl:Ae.imageUrl,videoUrl:Ae.videoUrl,mediaType:Ae.mediaType||"image",displayAsVideo:Ae.displayAsVideo||!1,hasImage:!!Ae.imageUrl,source:"firestore-fetch",lastUpdated:new Date().toISOString()}:et):[...Array.isArray(Ue)?Ue:[],{mediaScreenId:be,imageUrl:Ae.imageUrl,videoUrl:Ae.videoUrl,mediaType:Ae.mediaType||"image",displayAsVideo:Ae.displayAsVideo||!1,hasImage:!!Ae.imageUrl,source:"firestore-fetch",firstDetected:new Date().toISOString(),lastUpdated:new Date().toISOString()}])}).catch(Ae=>{console.error(`Error fetching media screen data for ${be}:`,Ae)}),console.warn("No screen data found for:",be),null},[a,ce,n,l]),ve=D.useCallback(be=>{if(console.log(`[DEBUG] Processing click on screen: ${be}, isEditMode: ${e}`),p(be),e)console.log(`[DEBUG] Opening upload modal for screen: ${be} in edit mode`),v();else{const Ae=Ce(be);if(Ae){if(console.log(`[DEBUG] Screen data for ${be}:`,Ae),xs("Screen data details:",{mediaScreenId:be,imageUrl:Ae.imageUrl,videoUrl:Ae.videoUrl,mediaType:Ae.mediaType,displayAsVideo:Ae.displayAsVideo}),He&&fe===be)return;if(Ae.displayAsVideo&&Ae.videoUrl)xs(`Opening video player for: ${Ae.videoUrl}`),j("PlayMediaScreenVideo",{mediaScreenId:be,videoUrl:Ae.videoUrl});else if(Ae.imageUrl){xs(`Opening viewer modal with ${Ae.mediaType}: ${Ae.imageUrl}`);const ze=hU(Ae.imageUrl);ge(ze,Ae.mediaType||"image")}else n&&Sp(n,be).then(ze=>{if(ze){if(ze.displayAsVideo&&ze.videoUrl)xs(`Opening video player for: ${ze.videoUrl}`),j("PlayMediaScreenVideo",{mediaScreenId:be,videoUrl:ze.videoUrl});else if(ze.imageUrl){xs(`Opening viewer modal with image: ${ze.imageUrl}`);const et=hU(ze.imageUrl);ge(et,ze.mediaType||"image")}l(et=>Array.isArray(et)&&et.some(dt=>dt.mediaScreenId===be)?et.map(dt=>dt.mediaScreenId===be?{...dt,...ze,mediaScreenId:be,source:"firestore-click",lastUpdated:new Date().toISOString()}:dt):[...Array.isArray(et)?et:[],{...ze,mediaScreenId:be,source:"firestore-click",firstDetected:new Date().toISOString(),lastUpdated:new Date().toISOString()}])}}).catch(ze=>{console.error(`Error fetching media screen data for ${be}:`,ze)})}else n&&Sp(n,be).then(Ue=>{if(Ue){if(Ue.displayAsVideo&&Ue.videoUrl)xs(`Opening video player for: ${Ue.videoUrl}`),j("PlayMediaScreenVideo",{mediaScreenId:be,videoUrl:Ue.videoUrl});else if(Ue.imageUrl){xs(`Opening viewer modal with image: ${Ue.imageUrl}`);const ze=hU(Ue.imageUrl);ge(ze,Ue.mediaType||"image")}l(ze=>Array.isArray(ze)&&ze.some(nt=>nt.mediaScreenId===be)?ze.map(nt=>nt.mediaScreenId===be?{...nt,...Ue,mediaScreenId:be,source:"firestore-click",lastUpdated:new Date().toISOString()}:nt):[...Array.isArray(ze)?ze:[],{...Ue,mediaScreenId:be,source:"firestore-click",firstDetected:new Date().toISOString(),lastUpdated:new Date().toISOString()}])}}).catch(Ue=>{console.error(`Error fetching media screen data for ${be}:`,Ue)})}},[e,v,Ce,He,fe,j,ge,n]);D.useEffect(()=>{if(!ee)return;const be=async()=>{if(n)try{const Ue=await G4(n),ze={};Ue.forEach(et=>{et.id&&et.imageUrl&&(ze[et.id]=et.imageUrl)}),l(et=>et.map(nt=>{const dt=!!ze[nt.mediaScreenId],Xe=ze[nt.mediaScreenId],It=nt.mediaType||"image";return{...nt,hasImage:dt,imageUrl:Xe,mediaType:It}}))}catch(Ue){console.error("Error fetching media screen images:",Ue)}};be();let Ae=null;return e&&(Ae=setInterval(be,5e3)),()=>{Ae&&clearInterval(Ae)}},[n,e,N,ee]);const Ne=be=>{l(Ae=>Ae.map(Ue=>{if(Ue.mediaScreenId===be.mediaScreenId){if(be.type==="upload")return{...Ue,hasImage:!0,imageUrl:be.imageUrl,mediaType:be.mediaType||"image"};if(be.type==="delete")return{...Ue,hasImage:!1,imageUrl:null,mediaType:null}}return Ue})),be.type==="delete"?(setTimeout(()=>{l(Ae=>Ae.filter(Ue=>Ue.mediaScreenId!==be.mediaScreenId))},100),setTimeout(()=>{l(Ae=>Ae.filter(Ue=>Ue.mediaScreenId!==be.mediaScreenId))},1500)):setTimeout(()=>{l(Ae=>Ae.some(ze=>ze.mediaScreenId===be.mediaScreenId)?Ae.map(ze=>ze.mediaScreenId===be.mediaScreenId?{...ze,imageUrl:be.imageUrl,hasImage:!0,mediaType:be.mediaType||"image"}:ze):[...Ae,{mediaScreenId:be.mediaScreenId,imageUrl:be.imageUrl,hasImage:!0,mediaType:be.mediaType||"image",source:"delayed-update",firstDetected:new Date().toISOString(),lastUpdated:new Date().toISOString()}])},1e3)};D.useEffect(()=>{const be=Ae=>{const Ue=Ae.detail.enabled;i(Ue),Ue?j("SetMediaScreenEditMode",{enabled:!0,showUploadIcon:!0}):j("SetMediaScreenEditMode",{enabled:!1,showUploadIcon:!1})};return window.addEventListener("editModeChanged",be),()=>{window.removeEventListener("editModeChanged",be)}},[j]),D.useEffect(()=>(window.JsSendMediaScreenClick=function(be){console.log("Unity: MediaScreenClick received with data:",be);try{const Ae=JSON.parse(be),Ue=new CustomEvent("MediaScreenClick",{detail:JSON.stringify(Ae)});window.dispatchEvent(Ue)}catch(Ae){console.error("Error processing MediaScreenClick data:",Ae)}},window.handleMediaScreenClick=function(be){console.log("Direct call to handleMediaScreenClick with ID:",be),ve(be)},window.TestJavaScriptFromUnity=function(be){console.log("Unity called TestJavaScriptFromUnity with:",be),alert("Unity called JavaScript: "+be)},()=>{delete window.JsSendMediaScreenClick,delete window.handleMediaScreenClick,delete window.TestJavaScriptFromUnity}),[ve]),D.useEffect(()=>{const be=ze=>{try{const et=JSON.parse(ze.detail);_e.log(`MediaScreen registered: ${et.mediaScreenId}`),xs("MediaScreen registered from Unity:",et),l(dt=>dt.some(It=>It.mediaScreenId===et.mediaScreenId)?dt.map(It=>It.mediaScreenId===et.mediaScreenId?{...It,...et,source:"event",lastUpdated:new Date().toISOString()}:It):[...dt,{...et,source:"event",firstDetected:new Date().toISOString(),lastUpdated:new Date().toISOString()}]),e&&j("SetMediaScreenEditMode",{mediaScreenId:et.mediaScreenId,enabled:!0,showUploadIcon:!0});const nt=et.mediaScreenId;nt&&Sp(n,nt).then(dt=>{dt&&(xs(`Media screen data for ${nt}:`,dt),dt.displayAsVideo&&dt.videoUrl&&(xs(`Media screen ${nt} should display as video, sending null imageUrl`),j("SetMediaScreenImage",{mediaScreenId:nt,imageUrl:null,displayAsVideo:!0})))}).catch(dt=>{console.error(`Error fetching media screen data for ${nt}:`,dt)})}catch(et){console.error("Error handling MediaScreen registration:",et)}},Ae=ze=>{try{xs("MediaScreenClick event received:",ze);let et;if(typeof ze=="string")et=ze,xs("MediaScreenClick: Direct call with ID:",et);else{xs("MediaScreenClick: Event from Unity:",ze),xs("MediaScreenClick: Event detail:",ze.detail);try{et=JSON.parse(ze.detail).mediaScreenId,xs("MediaScreenClick: Parsed mediaScreenId:",et)}catch(nt){if(console.error("MediaScreenClick: Error parsing event detail:",nt),ze.detail&&ze.detail.mediaScreenId)et=ze.detail.mediaScreenId,xs("MediaScreenClick: Using direct mediaScreenId from detail:",et);else throw new Error("Could not extract mediaScreenId from event")}}_e.log(`MediaScreen clicked: ${et}`),xs("MediaScreen clicked:",et),ve(et)}catch(et){console.error("Error handling MediaScreen click:",et)}},Ue=ze=>{if(ze.detail&&ze.detail.eventName==="RegisterMediaScreen")be({detail:ze.detail.eventData});else if(ze.detail&&ze.detail.eventName==="MediaScreenClick")Ae({detail:ze.detail.eventData});else if(ze.detail&&ze.detail.eventName==="SetMediaScreenImage")try{const et=JSON.parse(ze.detail.eventData);et.mediaScreenId&&(xs("SetMediaScreenImage event received:",et),l(nt=>Array.isArray(nt)&&nt.some(Xe=>Xe.mediaScreenId===et.mediaScreenId)?nt.map(Xe=>Xe.mediaScreenId===et.mediaScreenId?{...Xe,imageUrl:et.imageUrl,hasImage:!!et.imageUrl,displayAsVideo:et.displayAsVideo||!1,lastUpdated:new Date().toISOString()}:Xe):[...Array.isArray(nt)?nt:[],{mediaScreenId:et.mediaScreenId,imageUrl:et.imageUrl,hasImage:!!et.imageUrl,displayAsVideo:et.displayAsVideo||!1,source:"set-media-screen-image",firstDetected:new Date().toISOString(),lastUpdated:new Date().toISOString()}]))}catch(et){console.error("Error handling SetMediaScreenImage event:",et)}};return window.addEventListener("RegisterMediaScreen",be),window.addEventListener("MediaScreenClick",Ae),window.addEventListener("reactUnityEvent",Ue),()=>{window.removeEventListener("RegisterMediaScreen",be),window.removeEventListener("MediaScreenClick",Ae),window.removeEventListener("reactUnityEvent",Ue)}},[e,v,j,a,ne,He,ge,ve,n]),D.useEffect(()=>{const be=Ae=>{try{xs("Direct MediaScreenClick event received:",Ae);let Ue;if(Ae.detail)try{Ue=JSON.parse(Ae.detail).mediaScreenId}catch(ze){console.error("Error parsing MediaScreenClick event detail:",ze);return}if(!Ue){console.error("No mediaScreenId found in MediaScreenClick event");return}xs(`Direct handler: Processing click for media screen ${Ue}`),ve(Ue)}catch(Ue){console.error("Error in direct MediaScreenClick handler:",Ue)}};return window.addEventListener("MediaScreenClick",be),()=>{window.removeEventListener("MediaScreenClick",be)}},[ve]),D.useEffect(()=>{se&&rt()},[se,rt]);const Te=()=>{ue(),we()};return D.useEffect(()=>{const Ae=G("RegisterMediaScreen",Ue=>{try{if(_e.log("Direct RegisterMediaScreen event received with data:",Ue),!Ue||!Ue.mediaScreenId){_e.warn("RegisterMediaScreen event received with invalid data");return}const ze=Ue.mediaScreenId;_e.log(`Media screen registered directly: ${ze}`),l(et=>et.some(dt=>dt.mediaScreenId===ze)?et.map(dt=>dt.mediaScreenId===ze?{...dt,...Ue,source:"direct-event",lastUpdated:new Date().toISOString()}:dt):[...et,{...Ue,source:"direct-event",firstDetected:new Date().toISOString(),lastUpdated:new Date().toISOString()}]),e&&j("SetMediaScreenEditMode",{mediaScreenId:ze,enabled:!0,showUploadIcon:!0})}catch(ze){console.error("Error handling direct RegisterMediaScreen event:",ze)}});return()=>{Ae()}},[G,e,j]),D.useEffect(()=>{const Ae=G("MediaScreenClick",Ue=>{try{if(_e.log("Direct MediaScreenClick event received with data:",Ue),!Ue||!Ue.mediaScreenId){_e.warn("MediaScreenClick event received with invalid data");return}const ze=Ue.mediaScreenId;_e.log(`Media screen clicked directly: ${ze}`),ve(ze)}catch(ze){console.error("Error handling direct MediaScreenClick event:",ze)}});return()=>{Ae()}},[G,ve]),D.useEffect(()=>{e&&fe&&(console.log(`[DEBUG] Detected currentVideoMediaScreenId change in edit mode: ${fe}`),p(fe),v(),ue())},[e,fe,v,ue]),C.jsxs(C.Fragment,{children:[C.jsx(NWe,{isOpen:y,onClose:b,mediaScreenId:d,onImageChange:Ne}),C.jsx(VWe,{}),C.jsx(Vl,{containerRef:B,children:C.jsxs(ra,{isOpen:ne,onClose:te,size:"lg",isCentered:!0,portalProps:{containerRef:B},id:"image-viewer-modal",blockScrollOnMount:!0,children:[C.jsx(oa,{bg:"rgba(0, 0, 0, 0.8)",onClick:J,onMouseMove:J,onMouseDown:J,onMouseUp:J,onWheel:J}),C.jsxs(ia,{ref:Z,bg:"gray.900",color:"white",borderRadius:"lg",overflow:"hidden",maxWidth:"80vw",maxHeight:"80vh",display:"flex",justifyContent:"center",alignItems:"center",position:"relative",zIndex:"10000",className:"image-viewer-modal-content",onClick:J,onMouseMove:J,onMouseDown:J,onMouseUp:J,onWheel:J,children:[C.jsx(ja,{size:"lg",bg:"gray.700",color:"white",borderRadius:"full",zIndex:"modal",_hover:{bg:"gray.600"},_focus:{boxShadow:"none"},position:"absolute",top:"10px",right:"10px"}),C.jsx(sa,{p:0,width:"100%",onClick:J,onMouseMove:J,onMouseDown:J,onMouseUp:J,onWheel:J,children:ce?C.jsx(St,{position:"relative",width:"100%",height:"100%",display:"flex",justifyContent:"center",alignItems:"center",onClick:J,onMouseMove:J,onMouseDown:J,onMouseUp:J,onWheel:J,children:oe==="image"?C.jsx(Gh,{src:ce,maxWidth:"100%",maxHeight:"80vh",objectFit:"contain",alt:"Media Screen Image",onLoad:()=>console.log("Image loaded successfully:",ce),onError:be=>console.error("Error loading image:",be,ce),onClick:J}):C.jsxs(St,{width:"100%",textAlign:"center",onClick:J,onMouseMove:J,onMouseDown:J,onMouseUp:J,onWheel:J,children:[C.jsx(ht,{mb:4,fontSize:"lg",children:"Video URL:"}),C.jsx(ht,{p:3,bg:"gray.800",borderRadius:"md",fontSize:"sm",wordBreak:"break-all",maxWidth:"100%",children:ce}),C.jsx(ht,{mt:4,fontSize:"sm",color:"gray.400",children:"Video playback will be implemented in a future update"})]})}):C.jsx(mi,{direction:"column",align:"center",justify:"center",h:"400px",onClick:J,onMouseMove:J,onMouseDown:J,onMouseUp:J,onWheel:J,children:C.jsx(ht,{children:"No image available"})})})]})]})}),C.jsx(MWe,{videoUrl:se,videoTitle:he,mediaScreenId:fe,isOpen:He,onClose:Te})]})},goe=({backgroundUrl:n=null,containerRef:e})=>{const[i,a]=D.useState(!1),[l,d]=D.useState(n),p=D.useRef(null),y=D.useRef(null);return D.useEffect(()=>{const v=b=>{const{backgroundUrl:w}=b.detail;d(w),p.current&&(w?(p.current.style.backgroundImage=`url('${w}')`,p.current.style.display="block",y.current&&(y.current.style.display="block")):(p.current.style.display="none",y.current&&(y.current.style.display="none")))};return window.addEventListener("SpaceBackgroundUpdated",v),()=>{window.removeEventListener("SpaceBackgroundUpdated",v)}},[]),D.useEffect(()=>{d(n),p.current&&n!==l&&(p.current.style.backgroundImage=`url('${n}')`)},[n]),D.useEffect(()=>{if(!e||!e.current)return;const v=document.createElement("div");p.current=v,Object.assign(v.style,{position:"absolute",top:"0",left:"0",width:"100%",height:"100%",backgroundImage:l?`url('${l}')`:"none",backgroundSize:"cover",backgroundPosition:"center",backgroundRepeat:"no-repeat",zIndex:"20",transition:"opacity 1.5s ease-in-out",pointerEvents:"none",display:l?"block":"none"});const b=document.createElement("div");y.current=b,Object.assign(b.style,{position:"absolute",top:"0",left:"0",width:"100%",height:"100%",backdropFilter:"blur(5px)",backgroundColor:"rgba(255, 255, 255, 0.08)",zIndex:"21",transition:"opacity 1.5s ease-in-out",pointerEvents:"none",display:l?"block":"none"}),e.current.appendChild(v),e.current.appendChild(b);const w=()=>{console.log("PersistentBackground: Player instantiated event received"),a(!0),v.style.opacity="0",b.style.opacity="0",setTimeout(()=>{e.current&&e.current.contains(v)&&e.current.removeChild(v),e.current&&e.current.contains(b)&&e.current.removeChild(b)},1500)};if(window.isPlayerInstantiated)console.log("PersistentBackground: Player was already instantiated"),w();else{Dd.subscribe(Nd.playerInstantiated,w);const A=()=>w();window.addEventListener("PlayerInstantiated",A);const N=setTimeout(()=>{console.log("PersistentBackground: Forcing background removal after timeout"),w()},3e4);return()=>{Dd.unsubscribe(Nd.playerInstantiated,w),window.removeEventListener("PlayerInstantiated",A),clearTimeout(N),e.current&&e.current.contains(v)&&e.current.removeChild(v),e.current&&e.current.contains(b)&&e.current.removeChild(b)}}},[l,e]),null};goe.propTypes={backgroundUrl:mr.string,containerRef:mr.shape({current:mr.instanceOf(Element)})};const _oe=({containerRef:n})=>{const{spaceID:e}=rl(),[i,a]=D.useState(!1),[l,d]=D.useState(!1),[p,y]=D.useState(0),[v,b]=D.useState("Initialising World"),[w,A]=D.useState(null),N=D.useRef(null),V=D.useRef(null),j=D.useRef(null),B=D.useRef(null);D.useEffect(()=>(_e.log("PersistentLoader: Component mounted with spaceID:",e),_e.log("PersistentLoader: Container ref:",n),()=>{_e.log("PersistentLoader: Component unmounting")}),[]);const{error:G}=rl(),[ee,K]=D.useState(!1);return D.useEffect(()=>{G&&(_e.error("PersistentLoader: Unity error detected:",G),K(!0),setTimeout(()=>{if(N.current){const ne=N.current.querySelector("div:first-child");ne&&(ne.textContent="Reconnecting...")}},3e3))},[G]),D.useEffect(()=>{(async()=>{if(e){_e.log(`PersistentLoader: Fetching logo for space ${e}`);try{const ce=await _g(e);ce&&ce.logoUrl?(_e.log(`PersistentLoader: Found logo URL: ${ce.logoUrl}`),A(ce.logoUrl)):_e.log(`PersistentLoader: No logo URL found for space ${e}`)}catch(ce){_e.error("PersistentLoader: Error fetching space logo:",ce)}}else _e.warn("PersistentLoader: No spaceID provided, cannot fetch logo")})()},[e]),D.useEffect(()=>{const ne=ce=>{const{logoUrl:oe}=ce.detail;_e.log(`PersistentLoader: Logo update event received with URL: ${oe}`),A(oe),V.current?oe?(_e.log("PersistentLoader: Updating logo element with new URL"),V.current.src=oe,j.current.style.display="flex"):(_e.log("PersistentLoader: Hiding logo element (no URL)"),j.current.style.display="none"):_e.warn("PersistentLoader: Logo ref is null during update")};return _e.log("PersistentLoader: Adding SpaceLogoUpdated event listener"),window.addEventListener("SpaceLogoUpdated",ne),()=>{_e.log("PersistentLoader: Removing SpaceLogoUpdated event listener"),window.removeEventListener("SpaceLogoUpdated",ne)}},[]),D.useEffect(()=>{if(!n||!n.current){_e.error("PersistentLoader: Container ref is null or has no current property");return}_e.log("PersistentLoader: Creating loader elements");const ne=document.createElement("div");if(N.current=ne,Object.assign(ne.style,{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, calc(-50% + 50px))",width:"300px",padding:"16px",display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"center",zIndex:"50",transition:"opacity 1.5s ease-in-out",pointerEvents:"none",color:"white",fontFamily:"Arial, sans-serif",backgroundColor:"rgba(0, 0, 0, 0.8)",borderRadius:"8px",boxShadow:"0 0 20px rgba(0, 0, 0, 0.7)"}),w){_e.log(`PersistentLoader: Creating logo element with URL: ${w}`);const He=document.createElement("div");j.current=He,Object.assign(He.style,{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, calc(-50% - 40px))",display:"flex",justifyContent:"center",alignItems:"center",zIndex:"50",transition:"opacity 1.5s ease-in-out",pointerEvents:"none",padding:"8px",width:"280px"});const rt=document.createElement("img");V.current=rt,rt.src=w,rt.alt="Space Logo",rt.style.maxHeight="100px",rt.style.maxWidth="100%",rt.style.objectFit="contain",rt.style.filter="drop-shadow(0 0 8px rgba(0, 0, 0, 0.7))",He.appendChild(rt),n.current.appendChild(He),_e.log("PersistentLoader: Logo container added to main container")}else _e.log("PersistentLoader: No logo URL available, skipping logo creation");const ce=document.createElement("style");ce.textContent=`
      @keyframes progress-pulse {
        0% { box-shadow: 0 0 5px rgba(255, 255, 255, 0.5); }
        50% { box-shadow: 0 0 15px rgba(255, 255, 255, 0.8); }
        100% { box-shadow: 0 0 5px rgba(255, 255, 255, 0.5); }
      }
      
      @keyframes progress-glow {
        0% { background-position: 0% 50%; }
        50% { background-position: 100% 50%; }
        100% { background-position: 0% 50%; }
      }
    `,document.head.appendChild(ce),_e.log("PersistentLoader: Animation styles added to document head");const oe=document.createElement("div");oe.style.fontSize="16px",oe.style.fontWeight="bold",oe.style.textAlign="center",oe.style.marginBottom="16px",oe.style.color="#ffffff",oe.textContent="Initialising World";const ge=document.createElement("div");ge.style.width="100%",ge.style.height="12px",ge.style.backgroundColor="rgba(255, 255, 255, 0.2)",ge.style.borderRadius="6px",ge.style.overflow="hidden",ge.style.position="relative",ge.style.boxShadow="0 0 10px rgba(0, 0, 0, 0.5) inset";const te=document.createElement("div");te.style.height="100%",te.style.width="0%",te.style.background="linear-gradient(90deg, #4facfe 0%, #00f2fe 100%)",te.style.backgroundSize="200% 200%",te.style.animation="progress-glow 2s ease infinite",te.style.transition="width 0.5s ease-out",te.style.borderRadius="6px",te.style.boxShadow="0 0 10px rgba(255, 255, 255, 0.5)",ge.appendChild(te);const Z=document.createElement("div");Z.style.marginTop="8px",Z.style.fontSize="14px",Z.style.fontWeight="bold",Z.style.color="#ffffff",Z.textContent="0%",ne.appendChild(oe),ne.appendChild(ge),ne.appendChild(Z),n.current.appendChild(ne),_e.log("PersistentLoader: Loader element added to container");const J=He=>{y(He),te.style.width=`${Math.round(He*100)}%`,Z.textContent=`${Math.round(He*100)}%`,_e.log(`PersistentLoader: Progress updated to ${Math.round(He*100)}%`)},se=He=>{b(He),oe.textContent=He,_e.log(`PersistentLoader: Loading stage updated to "${He}"`)},he=[{stage:"Initialising World",progress:.33},{stage:"Loading Assets",progress:.66},{stage:"Loading User",progress:1}];ee&&(he[0].stage="Connecting to Space",he[1].stage="Reconnecting...",he[2].stage="Please Wait"),se(he[0].stage),J(.05);const fe=He=>{const rt=He.detail.progress;_e.log(`PersistentLoader: Progress event received with value: ${rt}`),J(rt),rt<.33?se(he[0].stage):rt<.66?se(he[1].stage):se(he[2].stage)},ue=()=>{_e.log("PersistentLoader: First scene loaded event received"),a(!0),se(he[1].stage),J(.66)},Me=()=>{if(_e.log("PersistentLoader: Player instantiated event received"),B.current&&(clearInterval(B.current),_e.log("PersistentLoader: Progress interval cleared")),d(!0),se(he[2].stage),J(1),ee){_e.log("PersistentLoader: Keeping loader visible due to Unity error");return}ne.style.opacity="0",j.current&&(j.current.style.opacity="0"),setTimeout(()=>{n.current&&n.current.contains(ne)?(n.current.removeChild(ne),_e.log("PersistentLoader: Loader element removed after fade")):_e.warn("PersistentLoader: Could not remove loader element (not found in container)"),j.current&&n.current&&n.current.contains(j.current)?(n.current.removeChild(j.current),_e.log("PersistentLoader: Logo container removed after fade")):j.current&&_e.warn("PersistentLoader: Could not remove logo container (not found in container)")},1500)};if(window.isPlayerInstantiated)_e.log("PersistentLoader: Player was already instantiated"),Me();else{_e.log("PersistentLoader: Subscribing to playerInstantiated event"),Dd.subscribe(Nd.playerInstantiated,Me);const He=()=>Me();_e.log("PersistentLoader: Adding PlayerInstantiated event listener"),window.addEventListener("PlayerInstantiated",He),_e.log("PersistentLoader: Adding firstSceneLoaded event listener"),Dd.subscribe(Nd.firstSceneLoaded,ue),_e.log("PersistentLoader: Adding UnityProgress event listener"),window.addEventListener("UnityProgress",fe),B.current=setInterval(()=>{l||y(we=>{const Ce=Math.min(we+.01,.95);return te.style.width=`${Math.round(Ce*100)}%`,Z.textContent=`${Math.round(Ce*100)}%`,Ce<.33&&v!==he[0].stage?se(he[0].stage):Ce>=.33&&Ce<.66&&v!==he[1].stage?se(he[1].stage):Ce>=.66&&v!==he[2].stage&&se(he[2].stage),Ce})},500);const rt=setTimeout(()=>{_e.log("PersistentLoader: Forcing loader removal after timeout"),Me()},6e4);return()=>{_e.log("PersistentLoader: Cleaning up event listeners"),Dd.unsubscribe(Nd.playerInstantiated,Me),window.removeEventListener("PlayerInstantiated",He),Dd.unsubscribe(Nd.firstSceneLoaded,ue),window.removeEventListener("UnityProgress",fe),clearInterval(B.current),clearTimeout(rt),n.current&&n.current.contains(ne)&&(n.current.removeChild(ne),_e.log("PersistentLoader: Loader element removed during cleanup")),j.current&&n.current&&n.current.contains(j.current)&&(n.current.removeChild(j.current),_e.log("PersistentLoader: Logo container removed during cleanup"))}}},[w,n]),null};_oe.propTypes={containerRef:mr.shape({current:mr.instanceOf(Element)})};const jWe="a2a7f4eb05284449b1063eb71d8301dc",fU=()=>document.querySelector("canvas")||document.getElementById("unity-canvas"),H4=D.forwardRef(({settings:n},e)=>{const{unityProvider:i,isLoaded:a,error:l}=rl(),d=T6e();R6e();const p=Ug(),y=k6e(d),{user:v}=D.useContext(ca),[b,w]=D.useState(!1),[A,N]=D.useState(window.devicePixelRatio),[V,j]=I6e();toe().find(Ne=>Ne.isLocalPlayer);const[G,ee]=D.useState(!0),[K,ne]=D.useState(!0),[ce,oe]=D.useState(!1),[ge,te]=D.useState(!1),[Z,J]=D.useState(!1);D.useEffect(()=>{Z?(console.log("WebGLRenderer: Modal opened, disabling Unity keyboard capture"),kd(!0)):(console.log("WebGLRenderer: Modal closed, enabling Unity keyboard capture"),a&&!ge&&kd(!1).then(()=>{setTimeout(()=>{py(!0)},100)}))},[Z,a,ge]);const se=n.spaceID||"default",he=D.useMemo(()=>{const be=new URLSearchParams(window.location.search).get("sessionId")||se;return console.log("WebGLRenderer: Using session ID:",be),be},[se]),[fe,ue]=D.useState(null);D.useEffect(()=>{v!=null&&v.uid&&af(v.uid).then(Ne=>{ue(Ne),console.log("WebGLRenderer: User profile loaded:",(Ne==null?void 0:Ne.Nickname)||"Unknown")}).catch(Ne=>{console.error("Error fetching user profile:",Ne)})},[v==null?void 0:v.uid]),D.useEffect(()=>{if(l||!v){_e.log("WebGLRenderer: User not logged in or Unity error, showing sign-in modal");const Ne=setTimeout(()=>{te(!0),J(!0)},1e3);return()=>clearTimeout(Ne)}else te(!1)},[l,v]),D.useEffect(()=>{console.log("WebGLRenderer: Setting up player instantiation listener");const Ne=()=>{console.log("WebGLRenderer: Player instantiated event received"),ne(!0),window.dispatchEvent(new CustomEvent("PlayerInstantiated")),window.isPlayerInstantiated=!0};window.isPlayerInstantiated&&(console.log("WebGLRenderer: Player was already instantiated from previous mount"),ne(!0)),Dd.subscribe(Nd.playerInstantiated,Ne);const Te=setTimeout(()=>{K||(console.log("WebGLRenderer: Forcing player instantiation after timeout"),ne(!0),window.isPlayerInstantiated=!0,window.dispatchEvent(new CustomEvent("PlayerInstantiated")))},5e3);return()=>{Dd.unsubscribe(Nd.playerInstantiated,Ne),clearTimeout(Te)}},[K]),D.useEffect(()=>{const Ne=()=>{console.log("WebGLRenderer: Modal opened"),J(!0)},Te=()=>{console.log("WebGLRenderer: Modal closed"),J(!1)};return window.addEventListener("modal-opened",Ne),window.addEventListener("modal-closed",Te),()=>{window.removeEventListener("modal-opened",Ne),window.removeEventListener("modal-closed",Te)}},[]),D.useEffect(()=>{J(V!==null)},[V]),D.useEffect(()=>{a||d?setTimeout(()=>{w(!0),_e.log("WebGLRenderer: Unity is ready to receive messages.")},5e3):_e.warn("WebGLRenderer: Unity is NOT ready yet.")},[a,d]),D.useEffect(()=>{a&&i&&setTimeout(()=>{if(window.unityInstance)try{console.log("WebGLRenderer: Disabling Unity keyboard capture on initialization"),window.unityInstance.SendMessage("WebGLInput","SetCaptureAllKeyboardInput",!1)}catch(Ne){console.error("WebGLRenderer: Error disabling Unity keyboard capture:",Ne)}},1e3)},[a,i]),D.useEffect(()=>{const Ne=document.getElementById("webgl-root");return Ne?(console.log("WebGLRenderer: Found webgl-root element, ensuring it is visible"),Ne.style.display="block",Ne.getAttribute("data-space-id")!==se&&(Ne.setAttribute("data-space-id",se),console.log(`WebGLRenderer: Set data-space-id attribute to ${se}`))):console.error("WebGLRenderer: Could not find webgl-root element"),()=>{}},[se]),D.useEffect(()=>{const Ne=()=>{const Ae=fU();Ae?(console.log("WebGLRenderer: Configuring Unity canvas for keyboard input"),Ae.tabIndex=1,Ae.style.outline="none",Ae.addEventListener("click",()=>{console.log("WebGLRenderer: Unity canvas clicked, enabling keyboard capture"),Z||py(!0)}),console.log("WebGLRenderer: Unity canvas configured with tabIndex=1")):console.warn("WebGLRenderer: Could not find Unity canvas to configure")};Ne();const Te=setTimeout(Ne,1e3),be=()=>{console.log("WebGLRenderer: Received unityReady event, configuring canvas"),Ne()};return window.addEventListener("unityReady",be),()=>{clearTimeout(Te),window.removeEventListener("unityReady",be)}},[a,Z]);const Me=D.useCallback(()=>{console.log("WebGLRenderer: Unity canvas clicked, enabling keyboard capture"),Z||py(!0)},[Z]);D.useEffect(()=>{if(a&&i){const Ne=fU();if(Ne)return console.log("WebGLRenderer: Adding click handler to Unity canvas"),Ne.addEventListener("click",Me),()=>{Ne.removeEventListener("click",Me)}}},[a,i,Me]),D.useEffect(()=>{if(a&&i){console.log("WebGLRenderer: Setting up global click handler for focus management");const Ne=Te=>{if(Z){console.log("WebGLRenderer: Modal is open, not refocusing Unity on click");return}if(Te.target.tagName==="INPUT"||Te.target.tagName==="TEXTAREA"||Te.target.tagName==="SELECT"||Te.target.tagName==="BUTTON"){console.log("WebGLRenderer: Clicked on form element, not refocusing Unity");return}if(Te.target.closest(".chakra-modal__content")||Te.target.closest('[role="dialog"]')||Te.target.closest('[role="menu"]')||Te.target.closest(".chakra-popover__content")||Te.target.closest('[role="tooltip"]')){console.log("WebGLRenderer: Clicked inside modal/dialog content, not refocusing Unity");return}const be=fU();if(be&&(Te.target===be||be.contains(Te.target)))return;if(Te.target.closest(".webgl-overlay")||Te.target.closest(".game-ui")||Te.target.closest(".player-list")||Te.target.closest(".unity-ui-overlay")){console.log("WebGLRenderer: Clicked on UI overlay that should allow keyboard events"),setTimeout(()=>{Z||py(!0)},50);return}console.log("WebGLRenderer: Clicked outside forms/modals/special UI, refocusing Unity canvas"),setTimeout(()=>{be&&!Z&&((be.tabIndex===void 0||be.tabIndex<0)&&(be.tabIndex=1),be.focus(),py(!0))},50)};return document.addEventListener("click",Ne,!0),()=>{document.removeEventListener("click",Ne,!0)}}},[a,i,Z]),D.useEffect(()=>{const Ne=Te=>{_e.log("WebGLRenderer: Received 'sendUserToUnity' event"),p("FirebaseUserFromReact",Te)};return Dd.subscribe(Nd.sendUserToUnity,Ne),()=>Dd.unsubscribe(Nd.sendUserToUnity,Ne)},[p]);const{setFullscreenRef:He,fullscreenRef:rt}=Ud();D.useEffect(()=>{He(e.current)},[e,He]);const we=()=>{ee(!G)},Ce=v&&n.enableVoiceChat;console.log("WebGLRenderer: Render with state:",{user:!!v,userId:v==null?void 0:v.uid,isPlayerInstantiated:K,showVoiceChat:Ce,sessionId:he}),D.useEffect(()=>{const Ne=Te=>{oe(Te.detail.enabled)};return window.addEventListener("editModeChanged",Ne),()=>{window.removeEventListener("editModeChanged",Ne)}},[]),noe(),C6e();const ve=D.useRef(null);return C.jsxs(St,{className:"webgl-renderer",children:[n.urlLoadingBackground&&C.jsx(goe,{backgroundUrl:n.urlLoadingBackground,containerRef:ve}),!ge&&C.jsx(_oe,{containerRef:ve}),ge&&C.jsx(St,{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",zIndex:"100",width:"100%",height:"100%",display:"flex",justifyContent:"center",alignItems:"center",children:C.jsx(mN,{mode:"button",label:"Sign In",initialIsOpen:!0,buttonProps:{size:"lg",colorScheme:"blue"}})}),C.jsx(yF,{containerRef:rt.current?rt:document.body,children:C.jsxs("div",{ref:e,style:{width:"100%",height:"100%",aspectRatio:"auto",position:"absolute"},children:[C.jsxs(St,{position:"absolute",zIndex:"10",top:4,right:4,display:"flex",alignItems:"center",gap:2,children:[n.showAuthButton&&C.jsx(D6e,{}),Ce&&C.jsxs(hoe,{appId:jWe,channel:he,uid:v==null?void 0:v.uid,enabled:!0,children:[C.jsx(uWe,{size:"md",defaultMuted:!0,joinOnClick:!0}),C.jsx(hWe,{userNickname:fe==null?void 0:fe.Nickname})]}),C.jsx(J6e,{}),C.jsx(St,{position:"relative",zIndex:"9999",children:C.jsx(kWe,{onTogglePlayerList:we,spaceID:se})})]}),C.jsxs(St,{ref:ve,position:"relative",overflow:"hidden",width:"100%",height:"100%",bgRepeat:"no-repeat",bgSize:"cover",bgPosition:"center",bgColor:"#666666",children:[C.jsx(St,{position:"absolute",top:"0",left:"0",width:"100%",height:"100%",backdropFilter:"blur(8px)",backgroundColor:"rgba(255, 255, 255, 0.1)",zIndex:"0"}),C.jsx(St,{...y,width:"100%",height:"100%",position:"absolute",zIndex:"1",children:i?C.jsx(eoe.Unity,{unityProvider:i,style:{width:"100%",height:"100%"},devicePixelRatio:A,tabIndex:1}):C.jsx(St,{width:"100%",height:"100%"})}),C.jsx(St,{position:"absolute",zIndex:"6",width:"100%",height:"100%",style:{display:"none"},children:C.jsx(N6e,{})})]}),C.jsx(St,{...y,position:"absolute",zIndex:"2",top:4,left:4,display:"flex",alignItems:"flex-start",gap:3,height:"50px",children:n.showDisruptiveLogo&&C.jsx(Gh,{src:n.urlDisruptiveLogo,width:"100px",alt:"Disruptive Logo"})}),C.jsx(St,{...y,position:"absolute",zIndex:"2",bottom:4,left:4,display:"flex",alignItems:"flex-start",gap:3}),C.jsxs(St,{...y,position:"absolute",zIndex:"2",bottom:4,right:4,display:"flex",alignItems:"flex-start",gap:3,children:[n.showHelpButton&&C.jsx(L6e,{}),C.jsx(eWe,{})]}),C.jsx(tWe,{}),C.jsx(nWe,{isOpen:V!==null,onClose:()=>{console.log(" Closing nameplate modal"),j()},playerName:(V==null?void 0:V.playerName)||"Unknown Player",playerId:(V==null?void 0:V.playerId)||"Unknown ID"}),C.jsx(rWe,{isVisible:G,onToggleVisibility:ee,spaceID:se}),C.jsx(FWe,{})]})})]})});H4.displayName="WebGLRenderer";H4.propTypes={settings:mr.shape({urlLoadingBackground:mr.string,showAuthButton:mr.bool,showDisruptiveLogo:mr.bool,urlDisruptiveLogo:mr.string,showHelpButton:mr.bool,enableVoiceChat:mr.bool,spaceID:mr.string})};typeof window<"u"&&!window.MultipleView&&(console.log("Defining fallback MultipleView class - scripts may not be loaded yet"),window.MultipleView=class{constructor(){console.log("HISPlayer: Fallback MultipleView constructor called"),this.multiView={getPlayer:()=>(console.log("HISPlayer: getPlayer called from fallback"),{isPlaying:!1,play:()=>(console.log("HISPlayer: play called"),!0),pause:()=>(console.log("HISPlayer: pause called"),!0),mute:e=>(console.log("HISPlayer: mute called with state:",e),!0),isMuted:!1,seek:e=>(console.log("HISPlayer: seek called with time:",e),!0),setVolume:e=>(console.log("HISPlayer: setVolume called with volume:",e),!0),getVolume:()=>(console.log("HISPlayer: getVolume called"),1),getCurrentTime:()=>(console.log("HISPlayer: getCurrentTime called"),0),getDuration:()=>(console.log("HISPlayer: getDuration called"),100)}),initialize:()=>(console.log("HISPlayer: initialize called"),!0),setUnityContext:e=>(console.log("HISPlayer: setUnityContext called with:",e),window.hisPlayerContextId=e,!0),release:()=>(console.log("HISPlayer: release called"),!0),setProperties:e=>(console.log("HISPlayer: setProperties called with:",e),!0),setMultiPaths:e=>(console.log("HISPlayer: setMultiPaths called with:",e),window._hisplayer_paths=e,!0)}}});if(typeof window<"u"&&!window._hisPlayerInitialized){if(_e.log("WebGLLoader: Initializing HISPlayer functions"),window._hisPlayerInitialized=!0,window._hisplayer_event_queue=window._hisplayer_event_queue||[],window._hisplayer_error_queue=window._hisplayer_error_queue||[],!document.getElementById("hisplayer-error")){const n=document.createElement("div");n.id="hisplayer-error",n.style.position="absolute",n.style.top="10px",n.style.left="50%",n.style.transform="translateX(-50%)",n.style.color="red",n.style.zIndex="9999",document.body.appendChild(n),_e.log("WebGLLoader: Created hisplayer-error div")}window.isErrorQueueEmpty=window.isErrorQueueEmpty||function(){return window._hisplayer_error_queue.length===0},window.getNextError=window.getNextError||function(){return window._hisplayer_error_queue.length>0?window._hisplayer_error_queue.shift():""},window.isEventQueueEmpty=window.isEventQueueEmpty||function(){return window._hisplayer_event_queue.length===0},window.getNextEvent=window.getNextEvent||function(){return window._hisplayer_event_queue.length>0?window._hisplayer_event_queue.shift():""},window.setUpContext=window.setUpContext||function(n){console.log("HISPlayer: setUpContext called with contextId:",n),window.hisPlayerContextId=n;try{if(window.MultipleView){console.log("HISPlayer: Creating MultipleView instance");const e=new window.MultipleView;if(e&&e.multiView&&typeof e.multiView.setUnityContext=="function")return e.multiView.setUnityContext(n),window._hisplayer_instance=e,console.log("HISPlayer: Successfully set Unity context ID"),!0;console.error("HISPlayer: Player initialization failed - missing expected methods")}else{console.error("HISPlayer: MultipleView class not found"),window.MultipleView=class{constructor(){console.log("HISPlayer: Backup MultipleView constructor called"),this.multiView={getPlayer:()=>(console.log("HISPlayer: getPlayer called from backup"),{isPlaying:!1,play:()=>!0,pause:()=>!0,mute:()=>!0,isMuted:!1,seek:()=>!0,setVolume:()=>!0,getVolume:()=>1,getCurrentTime:()=>0,getDuration:()=>100}),initialize:()=>!0,setUnityContext:a=>(window.hisPlayerContextId=a,!0),release:()=>!0,setProperties:()=>!0,setMultiPaths:()=>!0}}},console.log("HISPlayer: Trying again with backup MultipleView");const e=new window.MultipleView;return e.multiView.setUnityContext(n),window._hisplayer_instance=e,!0}}catch(e){console.error("HISPlayer: Error in setUpContext:",e);const i=document.getElementById("hisplayer-error");i&&(i.innerHTML="Error: "+e.message)}return!1}}const $4=({spaceID:n,overrideSettings:e})=>{const i=D.useRef(null),[a,l]=D.useState(!0),[d,p]=D.useState({spaceID:n,loaderUrl:"",dataUrl:"",frameworkUrl:"",codeUrl:""}),[y,v]=D.useState({urlDisruptiveLogo:"gs://disruptive-metaverse.appspot.com/common/images/Disruptive-logo-white-p-500.png",urlLoadingBackground:"",showDisruptiveLogo:null,showAuthButton:null,showHelpButton:null,enableVoiceChat:!0,spaceID:n});return D.useEffect(()=>{(async()=>{try{const w=await _g(n);if(w){p(V=>({...V,spaceID:n,loaderUrl:w.loaderUrl,dataUrl:w.dataUrl,frameworkUrl:w.frameworkUrl,codeUrl:w.codeUrl}));const A=await gk(y.urlDisruptiveLogo);let N="";if(w.backgroundUrl)N=w.backgroundUrl;else if(w.backgroundGsUrl)try{N=await gk(w.backgroundGsUrl)}catch(V){_e.warn("WebGLLoader: Error fetching background from GS URL:",V)}else if(w.gsUrlLoadingBackground)try{N=await gk(w.gsUrlLoadingBackground)}catch(V){_e.warn("WebGLLoader: Error fetching background from legacy GS URL:",V)}v(V=>({...V,urlLoadingBackground:N,showAuthButton:w.showAuthButton!==void 0?w.showAuthButton:!0,showDisruptiveLogo:w.showDisruptiveLogo!==void 0?w.showDisruptiveLogo:!0,showHelpButton:w.showHelpButton!==void 0?w.showHelpButton:!0,enableVoiceChat:w.enableVoiceChat!==void 0?w.enableVoiceChat:!0,urlDisruptiveLogo:A,spaceID:n,...e||{}})),l(!1)}else _e.error(`WebGLLoader: No configuration found for spaceID: ${n}`)}catch(w){_e.error("WebGLLoader: Error fetching space data:",w)}finally{l(!1)}})()},[n,y.urlDisruptiveLogo,e]),D.useEffect(()=>{a||(_e.log("WebGLLoader: Unity config from Firebase",d),_e.log("WebGLLoader: Space settings from Firebase",y))},[a]),C.jsx(C.Fragment,{children:a?C.jsx("div",{className:"flex justify-center items-center h-full mt-12",children:"Getting space data..."}):C.jsx(b6e,{...d,children:C.jsx(H4,{ref:i,settings:y})})})};$4.propTypes={spaceID:mr.string.isRequired,overrideSettings:mr.object};function JJ(){const n=document.getElementById("webgl-root");if(n){const e=n.getAttribute("data-space-id"),i=n.getAttribute("data-theme")||"default",a=()=>{const[l,d]=D.useState(null);return D.useEffect(()=>{OR(i).then(d)},[]),l?C.jsx(I1,{theme:l,children:C.jsx(dN,{children:C.jsx(M4,{children:C.jsx($4,{spaceID:e})})})}):C.jsx("div",{children:"Loading theme..."})};try{c1.createRoot(n).render(C.jsx(a,{}))}catch(l){console.warn("Error initializing WebGL:",l)}}}typeof window<"u"&&(document.readyState==="loading"?document.addEventListener("DOMContentLoaded",JJ):JJ());const BWe=(n,e)=>{try{const i=jy(gi,`spaces/${n}/chatMessages`),a=new Date,l=zV(i,r5e("timestamp","asc"),i5e(a));return gse(l,d=>{const p=[];d.docChanges().forEach(y=>{if(y.type==="added"){const v=y.doc.data();console.log("Firestore document data:",v),p.push({id:y.doc.id,...v})}}),p.length>0&&e(p)})}catch(i){throw _e.error("Error subscribing to space chat messages:",i),i}};function Vd(n){const e=Object.prototype.toString.call(n);return n instanceof Date||typeof n=="object"&&e==="[object Date]"?new n.constructor(+n):typeof n=="number"||e==="[object Number]"||typeof n=="string"||e==="[object String]"?new Date(n):new Date(NaN)}function Wy(n,e){return n instanceof Date?new n.constructor(e):new Date(e)}const yoe=6048e5,WWe=864e5;let zWe={};function gN(){return zWe}function WR(n,e){var y,v,b,w;const i=gN(),a=(e==null?void 0:e.weekStartsOn)??((v=(y=e==null?void 0:e.locale)==null?void 0:y.options)==null?void 0:v.weekStartsOn)??i.weekStartsOn??((w=(b=i.locale)==null?void 0:b.options)==null?void 0:w.weekStartsOn)??0,l=Vd(n),d=l.getDay(),p=(d<a?7:0)+d-a;return l.setDate(l.getDate()-p),l.setHours(0,0,0,0),l}function a1(n){return WR(n,{weekStartsOn:1})}function Eoe(n){const e=Vd(n),i=e.getFullYear(),a=Wy(n,0);a.setFullYear(i+1,0,4),a.setHours(0,0,0,0);const l=a1(a),d=Wy(n,0);d.setFullYear(i,0,4),d.setHours(0,0,0,0);const p=a1(d);return e.getTime()>=l.getTime()?i+1:e.getTime()>=p.getTime()?i:i-1}function QJ(n){const e=Vd(n);return e.setHours(0,0,0,0),e}function ZJ(n){const e=Vd(n),i=new Date(Date.UTC(e.getFullYear(),e.getMonth(),e.getDate(),e.getHours(),e.getMinutes(),e.getSeconds(),e.getMilliseconds()));return i.setUTCFullYear(e.getFullYear()),+n-+i}function GWe(n,e){const i=QJ(n),a=QJ(e),l=+i-ZJ(i),d=+a-ZJ(a);return Math.round((l-d)/WWe)}function HWe(n){const e=Eoe(n),i=Wy(n,0);return i.setFullYear(e,0,4),i.setHours(0,0,0,0),a1(i)}function $We(n){return n instanceof Date||typeof n=="object"&&Object.prototype.toString.call(n)==="[object Date]"}function KWe(n){if(!$We(n)&&typeof n!="number")return!1;const e=Vd(n);return!isNaN(Number(e))}function qWe(n){const e=Vd(n),i=Wy(n,0);return i.setFullYear(e.getFullYear(),0,1),i.setHours(0,0,0,0),i}const YWe={lessThanXSeconds:{one:"less than a second",other:"less than {{count}} seconds"},xSeconds:{one:"1 second",other:"{{count}} seconds"},halfAMinute:"half a minute",lessThanXMinutes:{one:"less than a minute",other:"less than {{count}} minutes"},xMinutes:{one:"1 minute",other:"{{count}} minutes"},aboutXHours:{one:"about 1 hour",other:"about {{count}} hours"},xHours:{one:"1 hour",other:"{{count}} hours"},xDays:{one:"1 day",other:"{{count}} days"},aboutXWeeks:{one:"about 1 week",other:"about {{count}} weeks"},xWeeks:{one:"1 week",other:"{{count}} weeks"},aboutXMonths:{one:"about 1 month",other:"about {{count}} months"},xMonths:{one:"1 month",other:"{{count}} months"},aboutXYears:{one:"about 1 year",other:"about {{count}} years"},xYears:{one:"1 year",other:"{{count}} years"},overXYears:{one:"over 1 year",other:"over {{count}} years"},almostXYears:{one:"almost 1 year",other:"almost {{count}} years"}},XWe=(n,e,i)=>{let a;const l=YWe[n];return typeof l=="string"?a=l:e===1?a=l.one:a=l.other.replace("{{count}}",e.toString()),i!=null&&i.addSuffix?i.comparison&&i.comparison>0?"in "+a:a+" ago":a};function pU(n){return(e={})=>{const i=e.width?String(e.width):n.defaultWidth;return n.formats[i]||n.formats[n.defaultWidth]}}const JWe={full:"EEEE, MMMM do, y",long:"MMMM do, y",medium:"MMM d, y",short:"MM/dd/yyyy"},QWe={full:"h:mm:ss a zzzz",long:"h:mm:ss a z",medium:"h:mm:ss a",short:"h:mm a"},ZWe={full:"{{date}} 'at' {{time}}",long:"{{date}} 'at' {{time}}",medium:"{{date}}, {{time}}",short:"{{date}}, {{time}}"},e8e={date:pU({formats:JWe,defaultWidth:"full"}),time:pU({formats:QWe,defaultWidth:"full"}),dateTime:pU({formats:ZWe,defaultWidth:"full"})},t8e={lastWeek:"'last' eeee 'at' p",yesterday:"'yesterday at' p",today:"'today at' p",tomorrow:"'tomorrow at' p",nextWeek:"eeee 'at' p",other:"P"},n8e=(n,e,i,a)=>t8e[n];function ww(n){return(e,i)=>{const a=i!=null&&i.context?String(i.context):"standalone";let l;if(a==="formatting"&&n.formattingValues){const p=n.defaultFormattingWidth||n.defaultWidth,y=i!=null&&i.width?String(i.width):p;l=n.formattingValues[y]||n.formattingValues[p]}else{const p=n.defaultWidth,y=i!=null&&i.width?String(i.width):n.defaultWidth;l=n.values[y]||n.values[p]}const d=n.argumentCallback?n.argumentCallback(e):e;return l[d]}}const r8e={narrow:["B","A"],abbreviated:["BC","AD"],wide:["Before Christ","Anno Domini"]},i8e={narrow:["1","2","3","4"],abbreviated:["Q1","Q2","Q3","Q4"],wide:["1st quarter","2nd quarter","3rd quarter","4th quarter"]},s8e={narrow:["J","F","M","A","M","J","J","A","S","O","N","D"],abbreviated:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],wide:["January","February","March","April","May","June","July","August","September","October","November","December"]},o8e={narrow:["S","M","T","W","T","F","S"],short:["Su","Mo","Tu","We","Th","Fr","Sa"],abbreviated:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],wide:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"]},a8e={narrow:{am:"a",pm:"p",midnight:"mi",noon:"n",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},abbreviated:{am:"AM",pm:"PM",midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},wide:{am:"a.m.",pm:"p.m.",midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"}},c8e={narrow:{am:"a",pm:"p",midnight:"mi",noon:"n",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"},abbreviated:{am:"AM",pm:"PM",midnight:"midnight",noon:"noon",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"},wide:{am:"a.m.",pm:"p.m.",midnight:"midnight",noon:"noon",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"}},l8e=(n,e)=>{const i=Number(n),a=i%100;if(a>20||a<10)switch(a%10){case 1:return i+"st";case 2:return i+"nd";case 3:return i+"rd"}return i+"th"},u8e={ordinalNumber:l8e,era:ww({values:r8e,defaultWidth:"wide"}),quarter:ww({values:i8e,defaultWidth:"wide",argumentCallback:n=>n-1}),month:ww({values:s8e,defaultWidth:"wide"}),day:ww({values:o8e,defaultWidth:"wide"}),dayPeriod:ww({values:a8e,defaultWidth:"wide",formattingValues:c8e,defaultFormattingWidth:"wide"})};function Rw(n){return(e,i={})=>{const a=i.width,l=a&&n.matchPatterns[a]||n.matchPatterns[n.defaultMatchWidth],d=e.match(l);if(!d)return null;const p=d[0],y=a&&n.parsePatterns[a]||n.parsePatterns[n.defaultParseWidth],v=Array.isArray(y)?h8e(y,A=>A.test(p)):d8e(y,A=>A.test(p));let b;b=n.valueCallback?n.valueCallback(v):v,b=i.valueCallback?i.valueCallback(b):b;const w=e.slice(p.length);return{value:b,rest:w}}}function d8e(n,e){for(const i in n)if(Object.prototype.hasOwnProperty.call(n,i)&&e(n[i]))return i}function h8e(n,e){for(let i=0;i<n.length;i++)if(e(n[i]))return i}function f8e(n){return(e,i={})=>{const a=e.match(n.matchPattern);if(!a)return null;const l=a[0],d=e.match(n.parsePattern);if(!d)return null;let p=n.valueCallback?n.valueCallback(d[0]):d[0];p=i.valueCallback?i.valueCallback(p):p;const y=e.slice(l.length);return{value:p,rest:y}}}const p8e=/^(\d+)(th|st|nd|rd)?/i,m8e=/\d+/i,g8e={narrow:/^(b|a)/i,abbreviated:/^(b\.?\s?c\.?|b\.?\s?c\.?\s?e\.?|a\.?\s?d\.?|c\.?\s?e\.?)/i,wide:/^(before christ|before common era|anno domini|common era)/i},_8e={any:[/^b/i,/^(a|c)/i]},y8e={narrow:/^[1234]/i,abbreviated:/^q[1234]/i,wide:/^[1234](th|st|nd|rd)? quarter/i},E8e={any:[/1/i,/2/i,/3/i,/4/i]},v8e={narrow:/^[jfmasond]/i,abbreviated:/^(jan|feb|mar|apr|may|jun|jul|aug|sep|oct|nov|dec)/i,wide:/^(january|february|march|april|may|june|july|august|september|october|november|december)/i},S8e={narrow:[/^j/i,/^f/i,/^m/i,/^a/i,/^m/i,/^j/i,/^j/i,/^a/i,/^s/i,/^o/i,/^n/i,/^d/i],any:[/^ja/i,/^f/i,/^mar/i,/^ap/i,/^may/i,/^jun/i,/^jul/i,/^au/i,/^s/i,/^o/i,/^n/i,/^d/i]},b8e={narrow:/^[smtwf]/i,short:/^(su|mo|tu|we|th|fr|sa)/i,abbreviated:/^(sun|mon|tue|wed|thu|fri|sat)/i,wide:/^(sunday|monday|tuesday|wednesday|thursday|friday|saturday)/i},T8e={narrow:[/^s/i,/^m/i,/^t/i,/^w/i,/^t/i,/^f/i,/^s/i],any:[/^su/i,/^m/i,/^tu/i,/^w/i,/^th/i,/^f/i,/^sa/i]},w8e={narrow:/^(a|p|mi|n|(in the|at) (morning|afternoon|evening|night))/i,any:/^([ap]\.?\s?m\.?|midnight|noon|(in the|at) (morning|afternoon|evening|night))/i},R8e={any:{am:/^a/i,pm:/^p/i,midnight:/^mi/i,noon:/^no/i,morning:/morning/i,afternoon:/afternoon/i,evening:/evening/i,night:/night/i}},C8e={ordinalNumber:f8e({matchPattern:p8e,parsePattern:m8e,valueCallback:n=>parseInt(n,10)}),era:Rw({matchPatterns:g8e,defaultMatchWidth:"wide",parsePatterns:_8e,defaultParseWidth:"any"}),quarter:Rw({matchPatterns:y8e,defaultMatchWidth:"wide",parsePatterns:E8e,defaultParseWidth:"any",valueCallback:n=>n+1}),month:Rw({matchPatterns:v8e,defaultMatchWidth:"wide",parsePatterns:S8e,defaultParseWidth:"any"}),day:Rw({matchPatterns:b8e,defaultMatchWidth:"wide",parsePatterns:T8e,defaultParseWidth:"any"}),dayPeriod:Rw({matchPatterns:w8e,defaultMatchWidth:"any",parsePatterns:R8e,defaultParseWidth:"any"})},I8e={code:"en-US",formatDistance:XWe,formatLong:e8e,formatRelative:n8e,localize:u8e,match:C8e,options:{weekStartsOn:0,firstWeekContainsDate:1}};function A8e(n){const e=Vd(n);return GWe(e,qWe(e))+1}function P8e(n){const e=Vd(n),i=+a1(e)-+HWe(e);return Math.round(i/yoe)+1}function voe(n,e){var w,A,N,V;const i=Vd(n),a=i.getFullYear(),l=gN(),d=(e==null?void 0:e.firstWeekContainsDate)??((A=(w=e==null?void 0:e.locale)==null?void 0:w.options)==null?void 0:A.firstWeekContainsDate)??l.firstWeekContainsDate??((V=(N=l.locale)==null?void 0:N.options)==null?void 0:V.firstWeekContainsDate)??1,p=Wy(n,0);p.setFullYear(a+1,0,d),p.setHours(0,0,0,0);const y=WR(p,e),v=Wy(n,0);v.setFullYear(a,0,d),v.setHours(0,0,0,0);const b=WR(v,e);return i.getTime()>=y.getTime()?a+1:i.getTime()>=b.getTime()?a:a-1}function O8e(n,e){var y,v,b,w;const i=gN(),a=(e==null?void 0:e.firstWeekContainsDate)??((v=(y=e==null?void 0:e.locale)==null?void 0:y.options)==null?void 0:v.firstWeekContainsDate)??i.firstWeekContainsDate??((w=(b=i.locale)==null?void 0:b.options)==null?void 0:w.firstWeekContainsDate)??1,l=voe(n,e),d=Wy(n,0);return d.setFullYear(l,0,a),d.setHours(0,0,0,0),WR(d,e)}function k8e(n,e){const i=Vd(n),a=+WR(i,e)-+O8e(i,e);return Math.round(a/yoe)+1}function fi(n,e){const i=n<0?"-":"",a=Math.abs(n).toString().padStart(e,"0");return i+a}const Jm={y(n,e){const i=n.getFullYear(),a=i>0?i:1-i;return fi(e==="yy"?a%100:a,e.length)},M(n,e){const i=n.getMonth();return e==="M"?String(i+1):fi(i+1,2)},d(n,e){return fi(n.getDate(),e.length)},a(n,e){const i=n.getHours()/12>=1?"pm":"am";switch(e){case"a":case"aa":return i.toUpperCase();case"aaa":return i;case"aaaaa":return i[0];case"aaaa":default:return i==="am"?"a.m.":"p.m."}},h(n,e){return fi(n.getHours()%12||12,e.length)},H(n,e){return fi(n.getHours(),e.length)},m(n,e){return fi(n.getMinutes(),e.length)},s(n,e){return fi(n.getSeconds(),e.length)},S(n,e){const i=e.length,a=n.getMilliseconds(),l=Math.trunc(a*Math.pow(10,i-3));return fi(l,e.length)}},SS={midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},eQ={G:function(n,e,i){const a=n.getFullYear()>0?1:0;switch(e){case"G":case"GG":case"GGG":return i.era(a,{width:"abbreviated"});case"GGGGG":return i.era(a,{width:"narrow"});case"GGGG":default:return i.era(a,{width:"wide"})}},y:function(n,e,i){if(e==="yo"){const a=n.getFullYear(),l=a>0?a:1-a;return i.ordinalNumber(l,{unit:"year"})}return Jm.y(n,e)},Y:function(n,e,i,a){const l=voe(n,a),d=l>0?l:1-l;if(e==="YY"){const p=d%100;return fi(p,2)}return e==="Yo"?i.ordinalNumber(d,{unit:"year"}):fi(d,e.length)},R:function(n,e){const i=Eoe(n);return fi(i,e.length)},u:function(n,e){const i=n.getFullYear();return fi(i,e.length)},Q:function(n,e,i){const a=Math.ceil((n.getMonth()+1)/3);switch(e){case"Q":return String(a);case"QQ":return fi(a,2);case"Qo":return i.ordinalNumber(a,{unit:"quarter"});case"QQQ":return i.quarter(a,{width:"abbreviated",context:"formatting"});case"QQQQQ":return i.quarter(a,{width:"narrow",context:"formatting"});case"QQQQ":default:return i.quarter(a,{width:"wide",context:"formatting"})}},q:function(n,e,i){const a=Math.ceil((n.getMonth()+1)/3);switch(e){case"q":return String(a);case"qq":return fi(a,2);case"qo":return i.ordinalNumber(a,{unit:"quarter"});case"qqq":return i.quarter(a,{width:"abbreviated",context:"standalone"});case"qqqqq":return i.quarter(a,{width:"narrow",context:"standalone"});case"qqqq":default:return i.quarter(a,{width:"wide",context:"standalone"})}},M:function(n,e,i){const a=n.getMonth();switch(e){case"M":case"MM":return Jm.M(n,e);case"Mo":return i.ordinalNumber(a+1,{unit:"month"});case"MMM":return i.month(a,{width:"abbreviated",context:"formatting"});case"MMMMM":return i.month(a,{width:"narrow",context:"formatting"});case"MMMM":default:return i.month(a,{width:"wide",context:"formatting"})}},L:function(n,e,i){const a=n.getMonth();switch(e){case"L":return String(a+1);case"LL":return fi(a+1,2);case"Lo":return i.ordinalNumber(a+1,{unit:"month"});case"LLL":return i.month(a,{width:"abbreviated",context:"standalone"});case"LLLLL":return i.month(a,{width:"narrow",context:"standalone"});case"LLLL":default:return i.month(a,{width:"wide",context:"standalone"})}},w:function(n,e,i,a){const l=k8e(n,a);return e==="wo"?i.ordinalNumber(l,{unit:"week"}):fi(l,e.length)},I:function(n,e,i){const a=P8e(n);return e==="Io"?i.ordinalNumber(a,{unit:"week"}):fi(a,e.length)},d:function(n,e,i){return e==="do"?i.ordinalNumber(n.getDate(),{unit:"date"}):Jm.d(n,e)},D:function(n,e,i){const a=A8e(n);return e==="Do"?i.ordinalNumber(a,{unit:"dayOfYear"}):fi(a,e.length)},E:function(n,e,i){const a=n.getDay();switch(e){case"E":case"EE":case"EEE":return i.day(a,{width:"abbreviated",context:"formatting"});case"EEEEE":return i.day(a,{width:"narrow",context:"formatting"});case"EEEEEE":return i.day(a,{width:"short",context:"formatting"});case"EEEE":default:return i.day(a,{width:"wide",context:"formatting"})}},e:function(n,e,i,a){const l=n.getDay(),d=(l-a.weekStartsOn+8)%7||7;switch(e){case"e":return String(d);case"ee":return fi(d,2);case"eo":return i.ordinalNumber(d,{unit:"day"});case"eee":return i.day(l,{width:"abbreviated",context:"formatting"});case"eeeee":return i.day(l,{width:"narrow",context:"formatting"});case"eeeeee":return i.day(l,{width:"short",context:"formatting"});case"eeee":default:return i.day(l,{width:"wide",context:"formatting"})}},c:function(n,e,i,a){const l=n.getDay(),d=(l-a.weekStartsOn+8)%7||7;switch(e){case"c":return String(d);case"cc":return fi(d,e.length);case"co":return i.ordinalNumber(d,{unit:"day"});case"ccc":return i.day(l,{width:"abbreviated",context:"standalone"});case"ccccc":return i.day(l,{width:"narrow",context:"standalone"});case"cccccc":return i.day(l,{width:"short",context:"standalone"});case"cccc":default:return i.day(l,{width:"wide",context:"standalone"})}},i:function(n,e,i){const a=n.getDay(),l=a===0?7:a;switch(e){case"i":return String(l);case"ii":return fi(l,e.length);case"io":return i.ordinalNumber(l,{unit:"day"});case"iii":return i.day(a,{width:"abbreviated",context:"formatting"});case"iiiii":return i.day(a,{width:"narrow",context:"formatting"});case"iiiiii":return i.day(a,{width:"short",context:"formatting"});case"iiii":default:return i.day(a,{width:"wide",context:"formatting"})}},a:function(n,e,i){const l=n.getHours()/12>=1?"pm":"am";switch(e){case"a":case"aa":return i.dayPeriod(l,{width:"abbreviated",context:"formatting"});case"aaa":return i.dayPeriod(l,{width:"abbreviated",context:"formatting"}).toLowerCase();case"aaaaa":return i.dayPeriod(l,{width:"narrow",context:"formatting"});case"aaaa":default:return i.dayPeriod(l,{width:"wide",context:"formatting"})}},b:function(n,e,i){const a=n.getHours();let l;switch(a===12?l=SS.noon:a===0?l=SS.midnight:l=a/12>=1?"pm":"am",e){case"b":case"bb":return i.dayPeriod(l,{width:"abbreviated",context:"formatting"});case"bbb":return i.dayPeriod(l,{width:"abbreviated",context:"formatting"}).toLowerCase();case"bbbbb":return i.dayPeriod(l,{width:"narrow",context:"formatting"});case"bbbb":default:return i.dayPeriod(l,{width:"wide",context:"formatting"})}},B:function(n,e,i){const a=n.getHours();let l;switch(a>=17?l=SS.evening:a>=12?l=SS.afternoon:a>=4?l=SS.morning:l=SS.night,e){case"B":case"BB":case"BBB":return i.dayPeriod(l,{width:"abbreviated",context:"formatting"});case"BBBBB":return i.dayPeriod(l,{width:"narrow",context:"formatting"});case"BBBB":default:return i.dayPeriod(l,{width:"wide",context:"formatting"})}},h:function(n,e,i){if(e==="ho"){let a=n.getHours()%12;return a===0&&(a=12),i.ordinalNumber(a,{unit:"hour"})}return Jm.h(n,e)},H:function(n,e,i){return e==="Ho"?i.ordinalNumber(n.getHours(),{unit:"hour"}):Jm.H(n,e)},K:function(n,e,i){const a=n.getHours()%12;return e==="Ko"?i.ordinalNumber(a,{unit:"hour"}):fi(a,e.length)},k:function(n,e,i){let a=n.getHours();return a===0&&(a=24),e==="ko"?i.ordinalNumber(a,{unit:"hour"}):fi(a,e.length)},m:function(n,e,i){return e==="mo"?i.ordinalNumber(n.getMinutes(),{unit:"minute"}):Jm.m(n,e)},s:function(n,e,i){return e==="so"?i.ordinalNumber(n.getSeconds(),{unit:"second"}):Jm.s(n,e)},S:function(n,e){return Jm.S(n,e)},X:function(n,e,i){const a=n.getTimezoneOffset();if(a===0)return"Z";switch(e){case"X":return nQ(a);case"XXXX":case"XX":return hy(a);case"XXXXX":case"XXX":default:return hy(a,":")}},x:function(n,e,i){const a=n.getTimezoneOffset();switch(e){case"x":return nQ(a);case"xxxx":case"xx":return hy(a);case"xxxxx":case"xxx":default:return hy(a,":")}},O:function(n,e,i){const a=n.getTimezoneOffset();switch(e){case"O":case"OO":case"OOO":return"GMT"+tQ(a,":");case"OOOO":default:return"GMT"+hy(a,":")}},z:function(n,e,i){const a=n.getTimezoneOffset();switch(e){case"z":case"zz":case"zzz":return"GMT"+tQ(a,":");case"zzzz":default:return"GMT"+hy(a,":")}},t:function(n,e,i){const a=Math.trunc(n.getTime()/1e3);return fi(a,e.length)},T:function(n,e,i){const a=n.getTime();return fi(a,e.length)}};function tQ(n,e=""){const i=n>0?"-":"+",a=Math.abs(n),l=Math.trunc(a/60),d=a%60;return d===0?i+String(l):i+String(l)+e+fi(d,2)}function nQ(n,e){return n%60===0?(n>0?"-":"+")+fi(Math.abs(n)/60,2):hy(n,e)}function hy(n,e=""){const i=n>0?"-":"+",a=Math.abs(n),l=fi(Math.trunc(a/60),2),d=fi(a%60,2);return i+l+e+d}const rQ=(n,e)=>{switch(n){case"P":return e.date({width:"short"});case"PP":return e.date({width:"medium"});case"PPP":return e.date({width:"long"});case"PPPP":default:return e.date({width:"full"})}},Soe=(n,e)=>{switch(n){case"p":return e.time({width:"short"});case"pp":return e.time({width:"medium"});case"ppp":return e.time({width:"long"});case"pppp":default:return e.time({width:"full"})}},N8e=(n,e)=>{const i=n.match(/(P+)(p+)?/)||[],a=i[1],l=i[2];if(!l)return rQ(n,e);let d;switch(a){case"P":d=e.dateTime({width:"short"});break;case"PP":d=e.dateTime({width:"medium"});break;case"PPP":d=e.dateTime({width:"long"});break;case"PPPP":default:d=e.dateTime({width:"full"});break}return d.replace("{{date}}",rQ(a,e)).replace("{{time}}",Soe(l,e))},D8e={p:Soe,P:N8e},L8e=/^D+$/,x8e=/^Y+$/,M8e=["D","DD","YY","YYYY"];function U8e(n){return L8e.test(n)}function V8e(n){return x8e.test(n)}function F8e(n,e,i){const a=j8e(n,e,i);if(console.warn(a),M8e.includes(n))throw new RangeError(a)}function j8e(n,e,i){const a=n[0]==="Y"?"years":"days of the month";return`Use \`${n.toLowerCase()}\` instead of \`${n}\` (in \`${e}\`) for formatting ${a} to the input \`${i}\`; see: https://github.com/date-fns/date-fns/blob/master/docs/unicodeTokens.md`}const B8e=/[yYQqMLwIdDecihHKkms]o|(\w)\1*|''|'(''|[^'])+('|$)|./g,W8e=/P+p+|P+|p+|''|'(''|[^'])+('|$)|./g,z8e=/^'([^]*?)'?$/,G8e=/''/g,H8e=/[a-zA-Z]/;function $8e(n,e,i){var w,A,N,V;const a=gN(),l=a.locale??I8e,d=a.firstWeekContainsDate??((A=(w=a.locale)==null?void 0:w.options)==null?void 0:A.firstWeekContainsDate)??1,p=a.weekStartsOn??((V=(N=a.locale)==null?void 0:N.options)==null?void 0:V.weekStartsOn)??0,y=Vd(n);if(!KWe(y))throw new RangeError("Invalid time value");let v=e.match(W8e).map(j=>{const B=j[0];if(B==="p"||B==="P"){const G=D8e[B];return G(j,l.formatLong)}return j}).join("").match(B8e).map(j=>{if(j==="''")return{isToken:!1,value:"'"};const B=j[0];if(B==="'")return{isToken:!1,value:K8e(j)};if(eQ[B])return{isToken:!0,value:j};if(B.match(H8e))throw new RangeError("Format string contains an unescaped latin alphabet character `"+B+"`");return{isToken:!1,value:j}});l.localize.preprocessor&&(v=l.localize.preprocessor(y,v));const b={firstWeekContainsDate:d,weekStartsOn:p,locale:l};return v.map(j=>{if(!j.isToken)return j.value;const B=j.value;(V8e(B)||U8e(B))&&F8e(B,e,String(n));const G=eQ[B[0]];return G(y,B,l.localize,b)}).join("")}function K8e(n){const e=n.match(z8e);return e?e[1].replace(G8e,"'"):n}const q8e=cf(St),boe=({name:n,timestamp:e,text:i,isCurrentUser:a})=>{console.log("Message props:",{name:n,timestamp:e,text:i,isCurrentUser:a});const l=e&&e.toDate?$8e(e.toDate(),"HH:mm"):"Invalid date";return C.jsxs(q8e,{display:"flex",flexDirection:"column",alignItems:a?"flex-end":"flex-start",initial:{opacity:0},animate:{opacity:1},transition:{duration:.5},children:[C.jsxs(St,{w:"auto",maxW:"80%",bg:a?"secondary.500":"primary.200",color:a?"white":"black",p:"10px",borderRadius:"10px",alignSelf:a?"flex-end":"flex-start",wordBreak:"break-word",children:[C.jsx(ht,{fontWeight:"bold",children:n}),C.jsx(ht,{children:i})]}),C.jsx(ht,{color:"copy.light",fontSize:"xs",mt:"4px",mx:"6px",mb:"10px",textAlign:a?"right":"left",children:l})]})};boe.propTypes={name:mr.string.isRequired,timestamp:mr.object,text:mr.string.isRequired,isCurrentUser:mr.bool.isRequired};const Y8e=({spaceID:n})=>{const[e,i]=D.useState([]),{user:a}=D.useContext(ca),l=D.useRef(null);return D.useEffect(()=>{const d=BWe(n,p=>{console.log("New messages received:",p),i(y=>[...y,...p]),_e.log("Messages updated:",p)});return()=>d()},[n]),D.useEffect(()=>{l.current&&l.current.scrollIntoView({behavior:"smooth"})},[e]),C.jsxs(St,{className:"messages-container",display:"flex",flexDirection:"column",my:"10px",overflowY:"auto",maxHeight:"80vh",children:[e.map(d=>{const p=d.uid===(a==null?void 0:a.uid);return C.jsx(boe,{name:d.user,timestamp:d.timestamp,text:d.text,isCurrentUser:p},d.id)}),C.jsx("div",{ref:l})]})},X8e=({spaceID:n})=>{},Toe=({spaceID:n})=>{const{user:e}=D.useContext(ca);return e?C.jsxs(St,{children:[C.jsx(St,{height:"400px",overflowY:"auto",border:"1px solid #ccc",backgroundColor:"tertiaryAlpha.600",padding:"10px",children:C.jsx(Y8e,{spaceID:n})}),C.jsx(St,{mt:"8px",children:C.jsx(X8e,{spaceID:n})})]}):(console.log("No user found, returning login message"),C.jsx(St,{children:C.jsx(ht,{children:"Please log in to view the chat."})}))},UO=document.getElementById("chat-root");if(UO){const n=UO.getAttribute("data-space-id"),e=UO.getAttribute("data-theme")||"default",i=()=>{const[a,l]=D.useState(null);return D.useEffect(()=>{OR(e).then(l)},[]),a?C.jsx(I1,{theme:a,children:C.jsx(dN,{children:C.jsx(Toe,{spaceID:n})})}):C.jsx("div",{children:"Loading theme..."})};c1.createRoot(UO).render(C.jsx(i,{}))}else console.error("Root element 'chat-root' not found.");class J8e extends D.Component{constructor(e){super(e),this.state={hasError:!1}}static getDerivedStateFromError(e){return{hasError:!0}}componentDidCatch(e,i){console.error("WebGL Error:",e,i)}render(){return this.state.hasError?C.jsx(St,{p:4,bg:"red.100",color:"red.900",borderRadius:"md",children:C.jsx(ht,{children:"WebGL component error. Please refresh the page."})}):this.props.children}}const VO=document.getElementById("root");if(VO){const n=VO.getAttribute("data-space-id"),e=VO.getAttribute("data-theme")||"default",i=()=>{const[a,l]=D.useState(null);return D.useEffect(()=>{OR(e).then(l);const d=()=>{document.hidden||OR(e).then(l)};return document.addEventListener("visibilitychange",d),()=>{document.removeEventListener("visibilitychange",d)}},[]),a?C.jsx(I1,{theme:a,children:C.jsx(dN,{children:C.jsx(M4,{children:C.jsxs(ii,{spacing:4,align:"stretch",children:[C.jsxs(mi,{justify:"space-between",align:"center",p:4,bg:"gray.700",m:0,position:"relative",zIndex:"100",children:[C.jsx(ht,{fontSize:"xl",fontWeight:"bold",color:"white",children:"LOGO"}),C.jsx(St,{zIndex:"100",position:"relative",children:C.jsx(Jse,{})})]}),C.jsx(JU,{maxW:"container.xl",p:0,zIndex:"1",children:C.jsx(ate,{ratio:16/9,bg:"blue.100",m:0,children:C.jsx(St,{id:"webgl-root","data-space-id":n,w:"100%",m:0,children:C.jsx(J8e,{children:C.jsx($4,{spaceID:n})})})})}),C.jsx(JU,{maxW:"container.xl",p:0,children:C.jsx(Toe,{spaceID:n})})]})})})}):C.jsx("div",{children:"Loading theme..."})};c1.createRoot(VO).render(C.jsx(i,{}))}else console.error("Root element 'root' not found.");export{Rye as a,qve as b,Vi as c,Hve as d,Z8e as e,Q8e as f,Uve as g,Au as i,zh as m,$Re as t};
