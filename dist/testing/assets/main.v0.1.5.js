function qEe(n,e){for(var i=0;i<e.length;i++){const o=e[i];if(typeof o!="string"&&!Array.isArray(o)){for(const l in o)if(l!=="default"&&!(l in n)){const u=Object.getOwnPropertyDescriptor(o,l);u&&Object.defineProperty(n,l,u.get?u:{enumerable:!0,get:()=>o[l]})}}}return Object.freeze(Object.defineProperty(n,Symbol.toStringTag,{value:"Module"}))}var My=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function Jg(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}var JM={exports:{}},ZT={},QM={exports:{}},Lr={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var aq;function YEe(){if(aq)return Lr;aq=1;var n=Symbol.for("react.element"),e=Symbol.for("react.portal"),i=Symbol.for("react.fragment"),o=Symbol.for("react.strict_mode"),l=Symbol.for("react.profiler"),u=Symbol.for("react.provider"),p=Symbol.for("react.context"),y=Symbol.for("react.forward_ref"),E=Symbol.for("react.suspense"),b=Symbol.for("react.memo"),T=Symbol.for("react.lazy"),R=Symbol.iterator;function O(be){return be===null||typeof be!="object"?null:(be=R&&be[R]||be["@@iterator"],typeof be=="function"?be:null)}var L={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},D=Object.assign,U={};function F(be,xe,je){this.props=be,this.context=xe,this.refs=U,this.updater=je||L}F.prototype.isReactComponent={},F.prototype.setState=function(be,xe){if(typeof be!="object"&&typeof be!="function"&&be!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,be,xe,"setState")},F.prototype.forceUpdate=function(be){this.updater.enqueueForceUpdate(this,be,"forceUpdate")};function Y(){}Y.prototype=F.prototype;function W(be,xe,je){this.props=be,this.context=xe,this.refs=U,this.updater=je||L}var re=W.prototype=new Y;re.constructor=W,D(re,F.prototype),re.isPureReactComponent=!0;var le=Array.isArray,ie=Object.prototype.hasOwnProperty,me={current:null},q={key:!0,ref:!0,__self:!0,__source:!0};function J(be,xe,je){var nt,dt={},ft=null,lt=null;if(xe!=null)for(nt in xe.ref!==void 0&&(lt=xe.ref),xe.key!==void 0&&(ft=""+xe.key),xe)ie.call(xe,nt)&&!q.hasOwnProperty(nt)&&(dt[nt]=xe[nt]);var gt=arguments.length-2;if(gt===1)dt.children=je;else if(1<gt){for(var at=Array(gt),Ct=0;Ct<gt;Ct++)at[Ct]=arguments[Ct+2];dt.children=at}if(be&&be.defaultProps)for(nt in gt=be.defaultProps,gt)dt[nt]===void 0&&(dt[nt]=gt[nt]);return{$$typeof:n,type:be,key:ft,ref:lt,props:dt,_owner:me.current}}function Q(be,xe){return{$$typeof:n,type:be.type,key:xe,ref:be.ref,props:be.props,_owner:be._owner}}function ne(be){return typeof be=="object"&&be!==null&&be.$$typeof===n}function he(be){var xe={"=":"=0",":":"=2"};return"$"+be.replace(/[=:]/g,function(je){return xe[je]})}var de=/\/+/g;function pe(be,xe){return typeof be=="object"&&be!==null&&be.key!=null?he(""+be.key):xe.toString(36)}function Se(be,xe,je,nt,dt){var ft=typeof be;(ft==="undefined"||ft==="boolean")&&(be=null);var lt=!1;if(be===null)lt=!0;else switch(ft){case"string":case"number":lt=!0;break;case"object":switch(be.$$typeof){case n:case e:lt=!0}}if(lt)return lt=be,dt=dt(lt),be=nt===""?"."+pe(lt,0):nt,le(dt)?(je="",be!=null&&(je=be.replace(de,"$&/")+"/"),Se(dt,xe,je,"",function(Ct){return Ct})):dt!=null&&(ne(dt)&&(dt=Q(dt,je+(!dt.key||lt&&lt.key===dt.key?"":(""+dt.key).replace(de,"$&/")+"/")+be)),xe.push(dt)),1;if(lt=0,nt=nt===""?".":nt+":",le(be))for(var gt=0;gt<be.length;gt++){ft=be[gt];var at=nt+pe(ft,gt);lt+=Se(ft,xe,je,at,dt)}else if(at=O(be),typeof at=="function")for(be=at.call(be),gt=0;!(ft=be.next()).done;)ft=ft.value,at=nt+pe(ft,gt++),lt+=Se(ft,xe,je,at,dt);else if(ft==="object")throw xe=String(be),Error("Objects are not valid as a React child (found: "+(xe==="[object Object]"?"object with keys {"+Object.keys(be).join(", ")+"}":xe)+"). If you meant to render a collection of children, use an array instead.");return lt}function Ie(be,xe,je){if(be==null)return be;var nt=[],dt=0;return Se(be,nt,"","",function(ft){return xe.call(je,ft,dt++)}),nt}function Fe(be){if(be._status===-1){var xe=be._result;xe=xe(),xe.then(function(je){(be._status===0||be._status===-1)&&(be._status=1,be._result=je)},function(je){(be._status===0||be._status===-1)&&(be._status=2,be._result=je)}),be._status===-1&&(be._status=0,be._result=xe)}if(be._status===1)return be._result.default;throw be._result}var we={current:null},Re={transition:null},Te={ReactCurrentDispatcher:we,ReactCurrentBatchConfig:Re,ReactCurrentOwner:me};function Ne(){throw Error("act(...) is not supported in production builds of React.")}return Lr.Children={map:Ie,forEach:function(be,xe,je){Ie(be,function(){xe.apply(this,arguments)},je)},count:function(be){var xe=0;return Ie(be,function(){xe++}),xe},toArray:function(be){return Ie(be,function(xe){return xe})||[]},only:function(be){if(!ne(be))throw Error("React.Children.only expected to receive a single React element child.");return be}},Lr.Component=F,Lr.Fragment=i,Lr.Profiler=l,Lr.PureComponent=W,Lr.StrictMode=o,Lr.Suspense=E,Lr.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=Te,Lr.act=Ne,Lr.cloneElement=function(be,xe,je){if(be==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+be+".");var nt=D({},be.props),dt=be.key,ft=be.ref,lt=be._owner;if(xe!=null){if(xe.ref!==void 0&&(ft=xe.ref,lt=me.current),xe.key!==void 0&&(dt=""+xe.key),be.type&&be.type.defaultProps)var gt=be.type.defaultProps;for(at in xe)ie.call(xe,at)&&!q.hasOwnProperty(at)&&(nt[at]=xe[at]===void 0&&gt!==void 0?gt[at]:xe[at])}var at=arguments.length-2;if(at===1)nt.children=je;else if(1<at){gt=Array(at);for(var Ct=0;Ct<at;Ct++)gt[Ct]=arguments[Ct+2];nt.children=gt}return{$$typeof:n,type:be.type,key:dt,ref:ft,props:nt,_owner:lt}},Lr.createContext=function(be){return be={$$typeof:p,_currentValue:be,_currentValue2:be,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},be.Provider={$$typeof:u,_context:be},be.Consumer=be},Lr.createElement=J,Lr.createFactory=function(be){var xe=J.bind(null,be);return xe.type=be,xe},Lr.createRef=function(){return{current:null}},Lr.forwardRef=function(be){return{$$typeof:y,render:be}},Lr.isValidElement=ne,Lr.lazy=function(be){return{$$typeof:T,_payload:{_status:-1,_result:be},_init:Fe}},Lr.memo=function(be,xe){return{$$typeof:b,type:be,compare:xe===void 0?null:xe}},Lr.startTransition=function(be){var xe=Re.transition;Re.transition={};try{be()}finally{Re.transition=xe}},Lr.unstable_act=Ne,Lr.useCallback=function(be,xe){return we.current.useCallback(be,xe)},Lr.useContext=function(be){return we.current.useContext(be)},Lr.useDebugValue=function(){},Lr.useDeferredValue=function(be){return we.current.useDeferredValue(be)},Lr.useEffect=function(be,xe){return we.current.useEffect(be,xe)},Lr.useId=function(){return we.current.useId()},Lr.useImperativeHandle=function(be,xe,je){return we.current.useImperativeHandle(be,xe,je)},Lr.useInsertionEffect=function(be,xe){return we.current.useInsertionEffect(be,xe)},Lr.useLayoutEffect=function(be,xe){return we.current.useLayoutEffect(be,xe)},Lr.useMemo=function(be,xe){return we.current.useMemo(be,xe)},Lr.useReducer=function(be,xe,je){return we.current.useReducer(be,xe,je)},Lr.useRef=function(be){return we.current.useRef(be)},Lr.useState=function(be){return we.current.useState(be)},Lr.useSyncExternalStore=function(be,xe,je){return we.current.useSyncExternalStore(be,xe,je)},Lr.useTransition=function(){return we.current.useTransition()},Lr.version="18.3.1",Lr}var cq;function am(){return cq||(cq=1,QM.exports=YEe()),QM.exports}/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var lq;function XEe(){if(lq)return ZT;lq=1;var n=am(),e=Symbol.for("react.element"),i=Symbol.for("react.fragment"),o=Object.prototype.hasOwnProperty,l=n.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,u={key:!0,ref:!0,__self:!0,__source:!0};function p(y,E,b){var T,R={},O=null,L=null;b!==void 0&&(O=""+b),E.key!==void 0&&(O=""+E.key),E.ref!==void 0&&(L=E.ref);for(T in E)o.call(E,T)&&!u.hasOwnProperty(T)&&(R[T]=E[T]);if(y&&y.defaultProps)for(T in E=y.defaultProps,E)R[T]===void 0&&(R[T]=E[T]);return{$$typeof:e,type:y,key:O,ref:L,props:R,_owner:l.current}}return ZT.Fragment=i,ZT.jsx=p,ZT.jsxs=p,ZT}var uq;function JEe(){return uq||(uq=1,JM.exports=XEe()),JM.exports}var S=JEe(),k=am();const yi=Jg(k),dq=qEe({__proto__:null,default:yi},[k]);var YP={},ZM={exports:{}},yl={},eU={exports:{}},tU={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var hq;function QEe(){return hq||(hq=1,(function(n){function e(Re,Te){var Ne=Re.length;Re.push(Te);e:for(;0<Ne;){var be=Ne-1>>>1,xe=Re[be];if(0<l(xe,Te))Re[be]=Te,Re[Ne]=xe,Ne=be;else break e}}function i(Re){return Re.length===0?null:Re[0]}function o(Re){if(Re.length===0)return null;var Te=Re[0],Ne=Re.pop();if(Ne!==Te){Re[0]=Ne;e:for(var be=0,xe=Re.length,je=xe>>>1;be<je;){var nt=2*(be+1)-1,dt=Re[nt],ft=nt+1,lt=Re[ft];if(0>l(dt,Ne))ft<xe&&0>l(lt,dt)?(Re[be]=lt,Re[ft]=Ne,be=ft):(Re[be]=dt,Re[nt]=Ne,be=nt);else if(ft<xe&&0>l(lt,Ne))Re[be]=lt,Re[ft]=Ne,be=ft;else break e}}return Te}function l(Re,Te){var Ne=Re.sortIndex-Te.sortIndex;return Ne!==0?Ne:Re.id-Te.id}if(typeof performance=="object"&&typeof performance.now=="function"){var u=performance;n.unstable_now=function(){return u.now()}}else{var p=Date,y=p.now();n.unstable_now=function(){return p.now()-y}}var E=[],b=[],T=1,R=null,O=3,L=!1,D=!1,U=!1,F=typeof setTimeout=="function"?setTimeout:null,Y=typeof clearTimeout=="function"?clearTimeout:null,W=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function re(Re){for(var Te=i(b);Te!==null;){if(Te.callback===null)o(b);else if(Te.startTime<=Re)o(b),Te.sortIndex=Te.expirationTime,e(E,Te);else break;Te=i(b)}}function le(Re){if(U=!1,re(Re),!D)if(i(E)!==null)D=!0,Fe(ie);else{var Te=i(b);Te!==null&&we(le,Te.startTime-Re)}}function ie(Re,Te){D=!1,U&&(U=!1,Y(J),J=-1),L=!0;var Ne=O;try{for(re(Te),R=i(E);R!==null&&(!(R.expirationTime>Te)||Re&&!he());){var be=R.callback;if(typeof be=="function"){R.callback=null,O=R.priorityLevel;var xe=be(R.expirationTime<=Te);Te=n.unstable_now(),typeof xe=="function"?R.callback=xe:R===i(E)&&o(E),re(Te)}else o(E);R=i(E)}if(R!==null)var je=!0;else{var nt=i(b);nt!==null&&we(le,nt.startTime-Te),je=!1}return je}finally{R=null,O=Ne,L=!1}}var me=!1,q=null,J=-1,Q=5,ne=-1;function he(){return!(n.unstable_now()-ne<Q)}function de(){if(q!==null){var Re=n.unstable_now();ne=Re;var Te=!0;try{Te=q(!0,Re)}finally{Te?pe():(me=!1,q=null)}}else me=!1}var pe;if(typeof W=="function")pe=function(){W(de)};else if(typeof MessageChannel<"u"){var Se=new MessageChannel,Ie=Se.port2;Se.port1.onmessage=de,pe=function(){Ie.postMessage(null)}}else pe=function(){F(de,0)};function Fe(Re){q=Re,me||(me=!0,pe())}function we(Re,Te){J=F(function(){Re(n.unstable_now())},Te)}n.unstable_IdlePriority=5,n.unstable_ImmediatePriority=1,n.unstable_LowPriority=4,n.unstable_NormalPriority=3,n.unstable_Profiling=null,n.unstable_UserBlockingPriority=2,n.unstable_cancelCallback=function(Re){Re.callback=null},n.unstable_continueExecution=function(){D||L||(D=!0,Fe(ie))},n.unstable_forceFrameRate=function(Re){0>Re||125<Re?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):Q=0<Re?Math.floor(1e3/Re):5},n.unstable_getCurrentPriorityLevel=function(){return O},n.unstable_getFirstCallbackNode=function(){return i(E)},n.unstable_next=function(Re){switch(O){case 1:case 2:case 3:var Te=3;break;default:Te=O}var Ne=O;O=Te;try{return Re()}finally{O=Ne}},n.unstable_pauseExecution=function(){},n.unstable_requestPaint=function(){},n.unstable_runWithPriority=function(Re,Te){switch(Re){case 1:case 2:case 3:case 4:case 5:break;default:Re=3}var Ne=O;O=Re;try{return Te()}finally{O=Ne}},n.unstable_scheduleCallback=function(Re,Te,Ne){var be=n.unstable_now();switch(typeof Ne=="object"&&Ne!==null?(Ne=Ne.delay,Ne=typeof Ne=="number"&&0<Ne?be+Ne:be):Ne=be,Re){case 1:var xe=-1;break;case 2:xe=250;break;case 5:xe=1073741823;break;case 4:xe=1e4;break;default:xe=5e3}return xe=Ne+xe,Re={id:T++,callback:Te,priorityLevel:Re,startTime:Ne,expirationTime:xe,sortIndex:-1},Ne>be?(Re.sortIndex=Ne,e(b,Re),i(E)===null&&Re===i(b)&&(U?(Y(J),J=-1):U=!0,we(le,Ne-be))):(Re.sortIndex=xe,e(E,Re),D||L||(D=!0,Fe(ie))),Re},n.unstable_shouldYield=he,n.unstable_wrapCallback=function(Re){var Te=O;return function(){var Ne=O;O=Te;try{return Re.apply(this,arguments)}finally{O=Ne}}}})(tU)),tU}var pq;function ZEe(){return pq||(pq=1,eU.exports=QEe()),eU.exports}/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var fq;function eve(){if(fq)return yl;fq=1;var n=am(),e=ZEe();function i(f){for(var _="https://reactjs.org/docs/error-decoder.html?invariant="+f,C=1;C<arguments.length;C++)_+="&args[]="+encodeURIComponent(arguments[C]);return"Minified React error #"+f+"; visit "+_+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var o=new Set,l={};function u(f,_){p(f,_),p(f+"Capture",_)}function p(f,_){for(l[f]=_,f=0;f<_.length;f++)o.add(_[f])}var y=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),E=Object.prototype.hasOwnProperty,b=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,T={},R={};function O(f){return E.call(R,f)?!0:E.call(T,f)?!1:b.test(f)?R[f]=!0:(T[f]=!0,!1)}function L(f,_,C,x){if(C!==null&&C.type===0)return!1;switch(typeof _){case"function":case"symbol":return!0;case"boolean":return x?!1:C!==null?!C.acceptsBooleans:(f=f.toLowerCase().slice(0,5),f!=="data-"&&f!=="aria-");default:return!1}}function D(f,_,C,x){if(_===null||typeof _>"u"||L(f,_,C,x))return!0;if(x)return!1;if(C!==null)switch(C.type){case 3:return!_;case 4:return _===!1;case 5:return isNaN(_);case 6:return isNaN(_)||1>_}return!1}function U(f,_,C,x,j,K,fe){this.acceptsBooleans=_===2||_===3||_===4,this.attributeName=x,this.attributeNamespace=j,this.mustUseProperty=C,this.propertyName=f,this.type=_,this.sanitizeURL=K,this.removeEmptyString=fe}var F={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(f){F[f]=new U(f,0,!1,f,null,!1,!1)}),[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(f){var _=f[0];F[_]=new U(_,1,!1,f[1],null,!1,!1)}),["contentEditable","draggable","spellCheck","value"].forEach(function(f){F[f]=new U(f,2,!1,f.toLowerCase(),null,!1,!1)}),["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(f){F[f]=new U(f,2,!1,f,null,!1,!1)}),"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(f){F[f]=new U(f,3,!1,f.toLowerCase(),null,!1,!1)}),["checked","multiple","muted","selected"].forEach(function(f){F[f]=new U(f,3,!0,f,null,!1,!1)}),["capture","download"].forEach(function(f){F[f]=new U(f,4,!1,f,null,!1,!1)}),["cols","rows","size","span"].forEach(function(f){F[f]=new U(f,6,!1,f,null,!1,!1)}),["rowSpan","start"].forEach(function(f){F[f]=new U(f,5,!1,f.toLowerCase(),null,!1,!1)});var Y=/[\-:]([a-z])/g;function W(f){return f[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(f){var _=f.replace(Y,W);F[_]=new U(_,1,!1,f,null,!1,!1)}),"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(f){var _=f.replace(Y,W);F[_]=new U(_,1,!1,f,"http://www.w3.org/1999/xlink",!1,!1)}),["xml:base","xml:lang","xml:space"].forEach(function(f){var _=f.replace(Y,W);F[_]=new U(_,1,!1,f,"http://www.w3.org/XML/1998/namespace",!1,!1)}),["tabIndex","crossOrigin"].forEach(function(f){F[f]=new U(f,1,!1,f.toLowerCase(),null,!1,!1)}),F.xlinkHref=new U("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1),["src","href","action","formAction"].forEach(function(f){F[f]=new U(f,1,!1,f.toLowerCase(),null,!0,!0)});function re(f,_,C,x){var j=F.hasOwnProperty(_)?F[_]:null;(j!==null?j.type!==0:x||!(2<_.length)||_[0]!=="o"&&_[0]!=="O"||_[1]!=="n"&&_[1]!=="N")&&(D(_,C,j,x)&&(C=null),x||j===null?O(_)&&(C===null?f.removeAttribute(_):f.setAttribute(_,""+C)):j.mustUseProperty?f[j.propertyName]=C===null?j.type===3?!1:"":C:(_=j.attributeName,x=j.attributeNamespace,C===null?f.removeAttribute(_):(j=j.type,C=j===3||j===4&&C===!0?"":""+C,x?f.setAttributeNS(x,_,C):f.setAttribute(_,C))))}var le=n.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,ie=Symbol.for("react.element"),me=Symbol.for("react.portal"),q=Symbol.for("react.fragment"),J=Symbol.for("react.strict_mode"),Q=Symbol.for("react.profiler"),ne=Symbol.for("react.provider"),he=Symbol.for("react.context"),de=Symbol.for("react.forward_ref"),pe=Symbol.for("react.suspense"),Se=Symbol.for("react.suspense_list"),Ie=Symbol.for("react.memo"),Fe=Symbol.for("react.lazy"),we=Symbol.for("react.offscreen"),Re=Symbol.iterator;function Te(f){return f===null||typeof f!="object"?null:(f=Re&&f[Re]||f["@@iterator"],typeof f=="function"?f:null)}var Ne=Object.assign,be;function xe(f){if(be===void 0)try{throw Error()}catch(C){var _=C.stack.trim().match(/\n( *(at )?)/);be=_&&_[1]||""}return`
`+be+f}var je=!1;function nt(f,_){if(!f||je)return"";je=!0;var C=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(_)if(_=function(){throw Error()},Object.defineProperty(_.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(_,[])}catch(ut){var x=ut}Reflect.construct(f,[],_)}else{try{_.call()}catch(ut){x=ut}f.call(_.prototype)}else{try{throw Error()}catch(ut){x=ut}f()}}catch(ut){if(ut&&x&&typeof ut.stack=="string"){for(var j=ut.stack.split(`
`),K=x.stack.split(`
`),fe=j.length-1,Oe=K.length-1;1<=fe&&0<=Oe&&j[fe]!==K[Oe];)Oe--;for(;1<=fe&&0<=Oe;fe--,Oe--)if(j[fe]!==K[Oe]){if(fe!==1||Oe!==1)do if(fe--,Oe--,0>Oe||j[fe]!==K[Oe]){var Ve=`
`+j[fe].replace(" at new "," at ");return f.displayName&&Ve.includes("<anonymous>")&&(Ve=Ve.replace("<anonymous>",f.displayName)),Ve}while(1<=fe&&0<=Oe);break}}}finally{je=!1,Error.prepareStackTrace=C}return(f=f?f.displayName||f.name:"")?xe(f):""}function dt(f){switch(f.tag){case 5:return xe(f.type);case 16:return xe("Lazy");case 13:return xe("Suspense");case 19:return xe("SuspenseList");case 0:case 2:case 15:return f=nt(f.type,!1),f;case 11:return f=nt(f.type.render,!1),f;case 1:return f=nt(f.type,!0),f;default:return""}}function ft(f){if(f==null)return null;if(typeof f=="function")return f.displayName||f.name||null;if(typeof f=="string")return f;switch(f){case q:return"Fragment";case me:return"Portal";case Q:return"Profiler";case J:return"StrictMode";case pe:return"Suspense";case Se:return"SuspenseList"}if(typeof f=="object")switch(f.$$typeof){case he:return(f.displayName||"Context")+".Consumer";case ne:return(f._context.displayName||"Context")+".Provider";case de:var _=f.render;return f=f.displayName,f||(f=_.displayName||_.name||"",f=f!==""?"ForwardRef("+f+")":"ForwardRef"),f;case Ie:return _=f.displayName||null,_!==null?_:ft(f.type)||"Memo";case Fe:_=f._payload,f=f._init;try{return ft(f(_))}catch{}}return null}function lt(f){var _=f.type;switch(f.tag){case 24:return"Cache";case 9:return(_.displayName||"Context")+".Consumer";case 10:return(_._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return f=_.render,f=f.displayName||f.name||"",_.displayName||(f!==""?"ForwardRef("+f+")":"ForwardRef");case 7:return"Fragment";case 5:return _;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return ft(_);case 8:return _===J?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof _=="function")return _.displayName||_.name||null;if(typeof _=="string")return _}return null}function gt(f){switch(typeof f){case"boolean":case"number":case"string":case"undefined":return f;case"object":return f;default:return""}}function at(f){var _=f.type;return(f=f.nodeName)&&f.toLowerCase()==="input"&&(_==="checkbox"||_==="radio")}function Ct(f){var _=at(f)?"checked":"value",C=Object.getOwnPropertyDescriptor(f.constructor.prototype,_),x=""+f[_];if(!f.hasOwnProperty(_)&&typeof C<"u"&&typeof C.get=="function"&&typeof C.set=="function"){var j=C.get,K=C.set;return Object.defineProperty(f,_,{configurable:!0,get:function(){return j.call(this)},set:function(fe){x=""+fe,K.call(this,fe)}}),Object.defineProperty(f,_,{enumerable:C.enumerable}),{getValue:function(){return x},setValue:function(fe){x=""+fe},stopTracking:function(){f._valueTracker=null,delete f[_]}}}}function En(f){f._valueTracker||(f._valueTracker=Ct(f))}function Gt(f){if(!f)return!1;var _=f._valueTracker;if(!_)return!0;var C=_.getValue(),x="";return f&&(x=at(f)?f.checked?"true":"false":f.value),f=x,f!==C?(_.setValue(f),!0):!1}function Jt(f){if(f=f||(typeof document<"u"?document:void 0),typeof f>"u")return null;try{return f.activeElement||f.body}catch{return f.body}}function st(f,_){var C=_.checked;return Ne({},_,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:C??f._wrapperState.initialChecked})}function hn(f,_){var C=_.defaultValue==null?"":_.defaultValue,x=_.checked!=null?_.checked:_.defaultChecked;C=gt(_.value!=null?_.value:C),f._wrapperState={initialChecked:x,initialValue:C,controlled:_.type==="checkbox"||_.type==="radio"?_.checked!=null:_.value!=null}}function an(f,_){_=_.checked,_!=null&&re(f,"checked",_,!1)}function Ft(f,_){an(f,_);var C=gt(_.value),x=_.type;if(C!=null)x==="number"?(C===0&&f.value===""||f.value!=C)&&(f.value=""+C):f.value!==""+C&&(f.value=""+C);else if(x==="submit"||x==="reset"){f.removeAttribute("value");return}_.hasOwnProperty("value")?bt(f,_.type,C):_.hasOwnProperty("defaultValue")&&bt(f,_.type,gt(_.defaultValue)),_.checked==null&&_.defaultChecked!=null&&(f.defaultChecked=!!_.defaultChecked)}function on(f,_,C){if(_.hasOwnProperty("value")||_.hasOwnProperty("defaultValue")){var x=_.type;if(!(x!=="submit"&&x!=="reset"||_.value!==void 0&&_.value!==null))return;_=""+f._wrapperState.initialValue,C||_===f.value||(f.value=_),f.defaultValue=_}C=f.name,C!==""&&(f.name=""),f.defaultChecked=!!f._wrapperState.initialChecked,C!==""&&(f.name=C)}function bt(f,_,C){(_!=="number"||Jt(f.ownerDocument)!==f)&&(C==null?f.defaultValue=""+f._wrapperState.initialValue:f.defaultValue!==""+C&&(f.defaultValue=""+C))}var ve=Array.isArray;function De(f,_,C,x){if(f=f.options,_){_={};for(var j=0;j<C.length;j++)_["$"+C[j]]=!0;for(C=0;C<f.length;C++)j=_.hasOwnProperty("$"+f[C].value),f[C].selected!==j&&(f[C].selected=j),j&&x&&(f[C].defaultSelected=!0)}else{for(C=""+gt(C),_=null,j=0;j<f.length;j++){if(f[j].value===C){f[j].selected=!0,x&&(f[j].defaultSelected=!0);return}_!==null||f[j].disabled||(_=f[j])}_!==null&&(_.selected=!0)}}function qe(f,_){if(_.dangerouslySetInnerHTML!=null)throw Error(i(91));return Ne({},_,{value:void 0,defaultValue:void 0,children:""+f._wrapperState.initialValue})}function Ot(f,_){var C=_.value;if(C==null){if(C=_.children,_=_.defaultValue,C!=null){if(_!=null)throw Error(i(92));if(ve(C)){if(1<C.length)throw Error(i(93));C=C[0]}_=C}_==null&&(_=""),C=_}f._wrapperState={initialValue:gt(C)}}function vt(f,_){var C=gt(_.value),x=gt(_.defaultValue);C!=null&&(C=""+C,C!==f.value&&(f.value=C),_.defaultValue==null&&f.defaultValue!==C&&(f.defaultValue=C)),x!=null&&(f.defaultValue=""+x)}function Pt(f){var _=f.textContent;_===f._wrapperState.initialValue&&_!==""&&_!==null&&(f.value=_)}function Ut(f){switch(f){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function cn(f,_){return f==null||f==="http://www.w3.org/1999/xhtml"?Ut(_):f==="http://www.w3.org/2000/svg"&&_==="foreignObject"?"http://www.w3.org/1999/xhtml":f}var _t,wn=(function(f){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(_,C,x,j){MSApp.execUnsafeLocalFunction(function(){return f(_,C,x,j)})}:f})(function(f,_){if(f.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in f)f.innerHTML=_;else{for(_t=_t||document.createElement("div"),_t.innerHTML="<svg>"+_.valueOf().toString()+"</svg>",_=_t.firstChild;f.firstChild;)f.removeChild(f.firstChild);for(;_.firstChild;)f.appendChild(_.firstChild)}});function Nt(f,_){if(_){var C=f.firstChild;if(C&&C===f.lastChild&&C.nodeType===3){C.nodeValue=_;return}}f.textContent=_}var Ht={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},Ur=["Webkit","ms","Moz","O"];Object.keys(Ht).forEach(function(f){Ur.forEach(function(_){_=_+f.charAt(0).toUpperCase()+f.substring(1),Ht[_]=Ht[f]})});function Ri(f,_,C){return _==null||typeof _=="boolean"||_===""?"":C||typeof _!="number"||_===0||Ht.hasOwnProperty(f)&&Ht[f]?(""+_).trim():_+"px"}function ri(f,_){f=f.style;for(var C in _)if(_.hasOwnProperty(C)){var x=C.indexOf("--")===0,j=Ri(C,_[C],x);C==="float"&&(C="cssFloat"),x?f.setProperty(C,j):f[C]=j}}var zi=Ne({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function ds(f,_){if(_){if(zi[f]&&(_.children!=null||_.dangerouslySetInnerHTML!=null))throw Error(i(137,f));if(_.dangerouslySetInnerHTML!=null){if(_.children!=null)throw Error(i(60));if(typeof _.dangerouslySetInnerHTML!="object"||!("__html"in _.dangerouslySetInnerHTML))throw Error(i(61))}if(_.style!=null&&typeof _.style!="object")throw Error(i(62))}}function Eo(f,_){if(f.indexOf("-")===-1)return typeof _.is=="string";switch(f){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var Gr=null;function Mo(f){return f=f.target||f.srcElement||window,f.correspondingUseElement&&(f=f.correspondingUseElement),f.nodeType===3?f.parentNode:f}var Wc=null,Xr=null,vo=null;function Js(f){if(f=y_(f)){if(typeof Wc!="function")throw Error(i(280));var _=f.stateNode;_&&(_=HE(_),Wc(f.stateNode,f.type,_))}}function ns(f){Xr?vo?vo.push(f):vo=[f]:Xr=f}function Gc(){if(Xr){var f=Xr,_=vo;if(vo=Xr=null,Js(f),_)for(f=0;f<_.length;f++)Js(_[f])}}function So(f,_){return f(_)}function bu(){}var Ga=!1;function Ds(f,_,C){if(Ga)return f(_,C);Ga=!0;try{return So(f,_,C)}finally{Ga=!1,(Xr!==null||vo!==null)&&(bu(),Gc())}}function Kt(f,_){var C=f.stateNode;if(C===null)return null;var x=HE(C);if(x===null)return null;C=x[_];e:switch(_){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(x=!x.disabled)||(f=f.type,x=!(f==="button"||f==="input"||f==="select"||f==="textarea")),f=!x;break e;default:f=!1}if(f)return null;if(C&&typeof C!="function")throw Error(i(231,_,typeof C));return C}var Hc=!1;if(y)try{var ta={};Object.defineProperty(ta,"passive",{get:function(){Hc=!0}}),window.addEventListener("test",ta,ta),window.removeEventListener("test",ta,ta)}catch{Hc=!1}function Ha(f,_,C,x,j,K,fe,Oe,Ve){var ut=Array.prototype.slice.call(arguments,3);try{_.apply(C,ut)}catch(xt){this.onError(xt)}}var $c=!1,na=null,ra=!1,Sd=null,Ih={onError:function(f){$c=!0,na=f}};function kl(f,_,C,x,j,K,fe,Oe,Ve){$c=!1,na=null,Ha.apply(Ih,arguments)}function Ah(f,_,C,x,j,K,fe,Oe,Ve){if(kl.apply(this,arguments),$c){if($c){var ut=na;$c=!1,na=null}else throw Error(i(198));ra||(ra=!0,Sd=ut)}}function Ls(f){var _=f,C=f;if(f.alternate)for(;_.return;)_=_.return;else{f=_;do _=f,(_.flags&4098)!==0&&(C=_.return),f=_.return;while(f)}return _.tag===3?C:null}function Nl(f){if(f.tag===13){var _=f.memoizedState;if(_===null&&(f=f.alternate,f!==null&&(_=f.memoizedState)),_!==null)return _.dehydrated}return null}function ia(f){if(Ls(f)!==f)throw Error(i(188))}function bd(f){var _=f.alternate;if(!_){if(_=Ls(f),_===null)throw Error(i(188));return _!==f?null:f}for(var C=f,x=_;;){var j=C.return;if(j===null)break;var K=j.alternate;if(K===null){if(x=j.return,x!==null){C=x;continue}break}if(j.child===K.child){for(K=j.child;K;){if(K===C)return ia(j),f;if(K===x)return ia(j),_;K=K.sibling}throw Error(i(188))}if(C.return!==x.return)C=j,x=K;else{for(var fe=!1,Oe=j.child;Oe;){if(Oe===C){fe=!0,C=j,x=K;break}if(Oe===x){fe=!0,x=j,C=K;break}Oe=Oe.sibling}if(!fe){for(Oe=K.child;Oe;){if(Oe===C){fe=!0,C=K,x=j;break}if(Oe===x){fe=!0,x=K,C=j;break}Oe=Oe.sibling}if(!fe)throw Error(i(189))}}if(C.alternate!==x)throw Error(i(190))}if(C.tag!==3)throw Error(i(188));return C.stateNode.current===C?f:_}function xl(f){return f=bd(f),f!==null?Dl(f):null}function Dl(f){if(f.tag===5||f.tag===6)return f;for(f=f.child;f!==null;){var _=Dl(f);if(_!==null)return _;f=f.sibling}return null}var Sa=e.unstable_scheduleCallback,Ll=e.unstable_cancelCallback,Ph=e.unstable_shouldYield,Qs=e.unstable_requestPaint,Jr=e.unstable_now,Oh=e.unstable_getCurrentPriorityLevel,Vr=e.unstable_ImmediatePriority,_c=e.unstable_UserBlockingPriority,sa=e.unstable_NormalPriority,wd=e.unstable_LowPriority,Je=e.unstable_IdlePriority,qt=null,qn=null;function Xi(f){if(qn&&typeof qn.onCommitFiberRoot=="function")try{qn.onCommitFiberRoot(qt,f,void 0,(f.current.flags&128)===128)}catch{}}var Ss=Math.clz32?Math.clz32:yc,Kc=Math.log,kh=Math.LN2;function yc(f){return f>>>=0,f===0?32:31-(Kc(f)/kh|0)|0}var qc=64,Ml=4194304;function Rr(f){switch(f&-f){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return f&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return f&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return f}}function Ul(f,_){var C=f.pendingLanes;if(C===0)return 0;var x=0,j=f.suspendedLanes,K=f.pingedLanes,fe=C&268435455;if(fe!==0){var Oe=fe&~j;Oe!==0?x=Rr(Oe):(K&=fe,K!==0&&(x=Rr(K)))}else fe=C&~j,fe!==0?x=Rr(fe):K!==0&&(x=Rr(K));if(x===0)return 0;if(_!==0&&_!==x&&(_&j)===0&&(j=x&-x,K=_&-_,j>=K||j===16&&(K&4194240)!==0))return _;if((x&4)!==0&&(x|=C&16),_=f.entangledLanes,_!==0)for(f=f.entanglements,_&=x;0<_;)C=31-Ss(_),j=1<<C,x|=f[C],_&=~j;return x}function Ec(f,_){switch(f){case 1:case 2:case 4:return _+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return _+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function Ji(f,_){for(var C=f.suspendedLanes,x=f.pingedLanes,j=f.expirationTimes,K=f.pendingLanes;0<K;){var fe=31-Ss(K),Oe=1<<fe,Ve=j[fe];Ve===-1?((Oe&C)===0||(Oe&x)!==0)&&(j[fe]=Ec(Oe,_)):Ve<=_&&(f.expiredLanes|=Oe),K&=~Oe}}function di(f){return f=f.pendingLanes&-1073741825,f!==0?f:f&1073741824?1073741824:0}function Hr(){var f=qc;return qc<<=1,(qc&4194240)===0&&(qc=64),f}function Vl(f){for(var _=[],C=0;31>C;C++)_.push(f);return _}function wu(f,_,C){f.pendingLanes|=_,_!==536870912&&(f.suspendedLanes=0,f.pingedLanes=0),f=f.eventTimes,_=31-Ss(_),f[_]=C}function hi(f,_){var C=f.pendingLanes&~_;f.pendingLanes=_,f.suspendedLanes=0,f.pingedLanes=0,f.expiredLanes&=_,f.mutableReadLanes&=_,f.entangledLanes&=_,_=f.entanglements;var x=f.eventTimes;for(f=f.expirationTimes;0<C;){var j=31-Ss(C),K=1<<j;_[j]=0,x[j]=-1,f[j]=-1,C&=~K}}function Tu(f,_){var C=f.entangledLanes|=_;for(f=f.entanglements;C;){var x=31-Ss(C),j=1<<x;j&_|f[x]&_&&(f[x]|=_),C&=~j}}var yr=0;function jl(f){return f&=-f,1<f?4<f?(f&268435455)!==0?16:536870912:4:1}var Nh,xh,Cu,dm,Xp,Jp=!1,ba=[],bs=null,wa=null,Ta=null,Ru=new Map,Ca=new Map,$a=[],Qp="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function Yc(f,_){switch(f){case"focusin":case"focusout":bs=null;break;case"dragenter":case"dragleave":wa=null;break;case"mouseover":case"mouseout":Ta=null;break;case"pointerover":case"pointerout":Ru.delete(_.pointerId);break;case"gotpointercapture":case"lostpointercapture":Ca.delete(_.pointerId)}}function Ms(f,_,C,x,j,K){return f===null||f.nativeEvent!==K?(f={blockedOn:_,domEventName:C,eventSystemFlags:x,nativeEvent:K,targetContainers:[j]},_!==null&&(_=y_(_),_!==null&&xh(_)),f):(f.eventSystemFlags|=x,_=f.targetContainers,j!==null&&_.indexOf(j)===-1&&_.push(j),f)}function r_(f,_,C,x,j){switch(_){case"focusin":return bs=Ms(bs,f,_,C,x,j),!0;case"dragenter":return wa=Ms(wa,f,_,C,x,j),!0;case"mouseover":return Ta=Ms(Ta,f,_,C,x,j),!0;case"pointerover":var K=j.pointerId;return Ru.set(K,Ms(Ru.get(K)||null,f,_,C,x,j)),!0;case"gotpointercapture":return K=j.pointerId,Ca.set(K,Ms(Ca.get(K)||null,f,_,C,x,j)),!0}return!1}function Fl(f){var _=Zp(f.target);if(_!==null){var C=Ls(_);if(C!==null){if(_=C.tag,_===13){if(_=Nl(C),_!==null){f.blockedOn=_,Xp(f.priority,function(){Cu(C)});return}}else if(_===3&&C.stateNode.current.memoizedState.isDehydrated){f.blockedOn=C.tag===3?C.stateNode.containerInfo:null;return}}}f.blockedOn=null}function Bl(f){if(f.blockedOn!==null)return!1;for(var _=f.targetContainers;0<_.length;){var C=jr(f.domEventName,f.eventSystemFlags,_[0],f.nativeEvent);if(C===null){C=f.nativeEvent;var x=new C.constructor(C.type,C);Gr=x,C.target.dispatchEvent(x),Gr=null}else return _=y_(C),_!==null&&xh(_),f.blockedOn=C,!1;_.shift()}return!0}function Iu(f,_,C){Bl(f)&&C.delete(_)}function hm(){Jp=!1,bs!==null&&Bl(bs)&&(bs=null),wa!==null&&Bl(wa)&&(wa=null),Ta!==null&&Bl(Ta)&&(Ta=null),Ru.forEach(Iu),Ca.forEach(Iu)}function vc(f,_){f.blockedOn===_&&(f.blockedOn=null,Jp||(Jp=!0,e.unstable_scheduleCallback(e.unstable_NormalPriority,hm)))}function Ra(f){function _(j){return vc(j,f)}if(0<ba.length){vc(ba[0],f);for(var C=1;C<ba.length;C++){var x=ba[C];x.blockedOn===f&&(x.blockedOn=null)}}for(bs!==null&&vc(bs,f),wa!==null&&vc(wa,f),Ta!==null&&vc(Ta,f),Ru.forEach(_),Ca.forEach(_),C=0;C<$a.length;C++)x=$a[C],x.blockedOn===f&&(x.blockedOn=null);for(;0<$a.length&&(C=$a[0],C.blockedOn===null);)Fl(C),C.blockedOn===null&&$a.shift()}var zl=le.ReactCurrentBatchConfig,Ce=!0;function Me(f,_,C,x){var j=yr,K=zl.transition;zl.transition=null;try{yr=1,Yt(f,_,C,x)}finally{yr=j,zl.transition=K}}function ct(f,_,C,x){var j=yr,K=zl.transition;zl.transition=null;try{yr=4,Yt(f,_,C,x)}finally{yr=j,zl.transition=K}}function Yt(f,_,C,x){if(Ce){var j=jr(f,_,C,x);if(j===null)Ib(f,_,x,cr,C),Yc(f,x);else if(r_(j,f,_,C,x))x.stopPropagation();else if(Yc(f,x),_&4&&-1<Qp.indexOf(f)){for(;j!==null;){var K=y_(j);if(K!==null&&Nh(K),K=jr(f,_,C,x),K===null&&Ib(f,_,x,cr,C),K===j)break;j=K}j!==null&&x.stopPropagation()}else Ib(f,_,x,null,C)}}var cr=null;function jr(f,_,C,x){if(cr=null,f=Mo(x),f=Zp(f),f!==null)if(_=Ls(f),_===null)f=null;else if(C=_.tag,C===13){if(f=Nl(_),f!==null)return f;f=null}else if(C===3){if(_.stateNode.current.memoizedState.isDehydrated)return _.tag===3?_.stateNode.containerInfo:null;f=null}else _!==f&&(f=null);return cr=f,null}function ai(f){switch(f){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(Oh()){case Vr:return 1;case _c:return 4;case sa:case wd:return 16;case Je:return 536870912;default:return 16}default:return 16}}var nr=null,rr=null,Li=null;function Zs(){if(Li)return Li;var f,_=rr,C=_.length,x,j="value"in nr?nr.value:nr.textContent,K=j.length;for(f=0;f<C&&_[f]===j[f];f++);var fe=C-f;for(x=1;x<=fe&&_[C-x]===j[K-x];x++);return Li=j.slice(f,1<x?1-x:void 0)}function Xc(f){var _=f.keyCode;return"charCode"in f?(f=f.charCode,f===0&&_===13&&(f=13)):f=_,f===10&&(f=13),32<=f||f===13?f:0}function Uo(){return!0}function Au(){return!1}function Us(f){function _(C,x,j,K,fe){this._reactName=C,this._targetInst=j,this.type=x,this.nativeEvent=K,this.target=fe,this.currentTarget=null;for(var Oe in f)f.hasOwnProperty(Oe)&&(C=f[Oe],this[Oe]=C?C(K):K[Oe]);return this.isDefaultPrevented=(K.defaultPrevented!=null?K.defaultPrevented:K.returnValue===!1)?Uo:Au,this.isPropagationStopped=Au,this}return Ne(_.prototype,{preventDefault:function(){this.defaultPrevented=!0;var C=this.nativeEvent;C&&(C.preventDefault?C.preventDefault():typeof C.returnValue!="unknown"&&(C.returnValue=!1),this.isDefaultPrevented=Uo)},stopPropagation:function(){var C=this.nativeEvent;C&&(C.stopPropagation?C.stopPropagation():typeof C.cancelBubble!="unknown"&&(C.cancelBubble=!0),this.isPropagationStopped=Uo)},persist:function(){},isPersistent:Uo}),_}var Sc={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(f){return f.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},pm=Us(Sc),Jc=Ne({},Sc,{view:0,detail:0}),i_=Us(Jc),Dh,Td,Lh,bc=Ne({},Jc,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:Ou,button:0,buttons:0,relatedTarget:function(f){return f.relatedTarget===void 0?f.fromElement===f.srcElement?f.toElement:f.fromElement:f.relatedTarget},movementX:function(f){return"movementX"in f?f.movementX:(f!==Lh&&(Lh&&f.type==="mousemove"?(Dh=f.screenX-Lh.screenX,Td=f.screenY-Lh.screenY):Td=Dh=0,Lh=f),Dh)},movementY:function(f){return"movementY"in f?f.movementY:Td}}),Pu=Us(bc),s_=Ne({},bc,{dataTransfer:0}),NE=Us(s_),fm=Ne({},Jc,{relatedTarget:0}),mm=Us(fm),xE=Ne({},Sc,{animationName:0,elapsedTime:0,pseudoElement:0}),Ka=Us(xE),DE=Ne({},Sc,{clipboardData:function(f){return"clipboardData"in f?f.clipboardData:window.clipboardData}}),Cd=Us(DE),o_=Ne({},Sc,{data:0}),a_=Us(o_),Kn={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},Ia={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},LE={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function ME(f){var _=this.nativeEvent;return _.getModifierState?_.getModifierState(f):(f=LE[f])?!!_[f]:!1}function Ou(){return ME}var P=Ne({},Jc,{key:function(f){if(f.key){var _=Kn[f.key]||f.key;if(_!=="Unidentified")return _}return f.type==="keypress"?(f=Xc(f),f===13?"Enter":String.fromCharCode(f)):f.type==="keydown"||f.type==="keyup"?Ia[f.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:Ou,charCode:function(f){return f.type==="keypress"?Xc(f):0},keyCode:function(f){return f.type==="keydown"||f.type==="keyup"?f.keyCode:0},which:function(f){return f.type==="keypress"?Xc(f):f.type==="keydown"||f.type==="keyup"?f.keyCode:0}}),$=Us(P),se=Ne({},bc,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),Ee=Us(se),Ye=Ne({},Jc,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:Ou}),ht=Us(Ye),$t=Ne({},Sc,{propertyName:0,elapsedTime:0,pseudoElement:0}),ci=Us($t),eo=Ne({},bc,{deltaX:function(f){return"deltaX"in f?f.deltaX:"wheelDeltaX"in f?-f.wheelDeltaX:0},deltaY:function(f){return"deltaY"in f?f.deltaY:"wheelDeltaY"in f?-f.wheelDeltaY:"wheelDelta"in f?-f.wheelDelta:0},deltaZ:0,deltaMode:0}),mr=Us(eo),bo=[9,13,27,32],Vs=y&&"CompositionEvent"in window,Qc=null;y&&"documentMode"in document&&(Qc=document.documentMode);var qa=y&&"TextEvent"in window&&!Qc,Rd=y&&(!Vs||Qc&&8<Qc&&11>=Qc),gm=" ",fI=!1;function mI(f,_){switch(f){case"keyup":return bo.indexOf(_.keyCode)!==-1;case"keydown":return _.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function wc(f){return f=f.detail,typeof f=="object"&&"data"in f?f.data:null}var _m=!1;function _x(f,_){switch(f){case"compositionend":return wc(_);case"keypress":return _.which!==32?null:(fI=!0,gm);case"textInput":return f=_.data,f===gm&&fI?null:f;default:return null}}function yx(f,_){if(_m)return f==="compositionend"||!Vs&&mI(f,_)?(f=Zs(),Li=rr=nr=null,_m=!1,f):null;switch(f){case"paste":return null;case"keypress":if(!(_.ctrlKey||_.altKey||_.metaKey)||_.ctrlKey&&_.altKey){if(_.char&&1<_.char.length)return _.char;if(_.which)return String.fromCharCode(_.which)}return null;case"compositionend":return Rd&&_.locale!=="ko"?null:_.data;default:return null}}var Ex={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function _b(f){var _=f&&f.nodeName&&f.nodeName.toLowerCase();return _==="input"?!!Ex[f.type]:_==="textarea"}function gI(f,_,C,x){ns(x),_=f_(_,"onChange"),0<_.length&&(C=new pm("onChange","change",null,C,x),f.push({event:C,listeners:_}))}var c_=null,ym=null;function yb(f){II(f,0)}function UE(f){var _=Cm(f);if(Gt(_))return f}function vx(f,_){if(f==="change")return _}var l_=!1;if(y){var Eb;if(y){var vb="oninput"in document;if(!vb){var _I=document.createElement("div");_I.setAttribute("oninput","return;"),vb=typeof _I.oninput=="function"}Eb=vb}else Eb=!1;l_=Eb&&(!document.documentMode||9<document.documentMode)}function Id(){c_&&(c_.detachEvent("onpropertychange",yI),ym=c_=null)}function yI(f){if(f.propertyName==="value"&&UE(ym)){var _=[];gI(_,ym,f,Mo(f)),Ds(yb,_)}}function Sx(f,_,C){f==="focusin"?(Id(),c_=_,ym=C,c_.attachEvent("onpropertychange",yI)):f==="focusout"&&Id()}function Ya(f){if(f==="selectionchange"||f==="keyup"||f==="keydown")return UE(ym)}function bx(f,_){if(f==="click")return UE(_)}function wx(f,_){if(f==="input"||f==="change")return UE(_)}function Tx(f,_){return f===_&&(f!==0||1/f===1/_)||f!==f&&_!==_}var Wl=typeof Object.is=="function"?Object.is:Tx;function Em(f,_){if(Wl(f,_))return!0;if(typeof f!="object"||f===null||typeof _!="object"||_===null)return!1;var C=Object.keys(f),x=Object.keys(_);if(C.length!==x.length)return!1;for(x=0;x<C.length;x++){var j=C[x];if(!E.call(_,j)||!Wl(f[j],_[j]))return!1}return!0}function EI(f){for(;f&&f.firstChild;)f=f.firstChild;return f}function vI(f,_){var C=EI(f);f=0;for(var x;C;){if(C.nodeType===3){if(x=f+C.textContent.length,f<=_&&x>=_)return{node:C,offset:_-f};f=x}e:{for(;C;){if(C.nextSibling){C=C.nextSibling;break e}C=C.parentNode}C=void 0}C=EI(C)}}function SI(f,_){return f&&_?f===_?!0:f&&f.nodeType===3?!1:_&&_.nodeType===3?SI(f,_.parentNode):"contains"in f?f.contains(_):f.compareDocumentPosition?!!(f.compareDocumentPosition(_)&16):!1:!1}function Sb(){for(var f=window,_=Jt();_ instanceof f.HTMLIFrameElement;){try{var C=typeof _.contentWindow.location.href=="string"}catch{C=!1}if(C)f=_.contentWindow;else break;_=Jt(f.document)}return _}function bb(f){var _=f&&f.nodeName&&f.nodeName.toLowerCase();return _&&(_==="input"&&(f.type==="text"||f.type==="search"||f.type==="tel"||f.type==="url"||f.type==="password")||_==="textarea"||f.contentEditable==="true")}function Cx(f){var _=Sb(),C=f.focusedElem,x=f.selectionRange;if(_!==C&&C&&C.ownerDocument&&SI(C.ownerDocument.documentElement,C)){if(x!==null&&bb(C)){if(_=x.start,f=x.end,f===void 0&&(f=_),"selectionStart"in C)C.selectionStart=_,C.selectionEnd=Math.min(f,C.value.length);else if(f=(_=C.ownerDocument||document)&&_.defaultView||window,f.getSelection){f=f.getSelection();var j=C.textContent.length,K=Math.min(x.start,j);x=x.end===void 0?K:Math.min(x.end,j),!f.extend&&K>x&&(j=x,x=K,K=j),j=vI(C,K);var fe=vI(C,x);j&&fe&&(f.rangeCount!==1||f.anchorNode!==j.node||f.anchorOffset!==j.offset||f.focusNode!==fe.node||f.focusOffset!==fe.offset)&&(_=_.createRange(),_.setStart(j.node,j.offset),f.removeAllRanges(),K>x?(f.addRange(_),f.extend(fe.node,fe.offset)):(_.setEnd(fe.node,fe.offset),f.addRange(_)))}}for(_=[],f=C;f=f.parentNode;)f.nodeType===1&&_.push({element:f,left:f.scrollLeft,top:f.scrollTop});for(typeof C.focus=="function"&&C.focus(),C=0;C<_.length;C++)f=_[C],f.element.scrollLeft=f.left,f.element.scrollTop=f.top}}var wb=y&&"documentMode"in document&&11>=document.documentMode,Mh=null,Tb=null,rt=null,Cb=!1;function bI(f,_,C){var x=C.window===C?C.document:C.nodeType===9?C:C.ownerDocument;Cb||Mh==null||Mh!==Jt(x)||(x=Mh,"selectionStart"in x&&bb(x)?x={start:x.selectionStart,end:x.selectionEnd}:(x=(x.ownerDocument&&x.ownerDocument.defaultView||window).getSelection(),x={anchorNode:x.anchorNode,anchorOffset:x.anchorOffset,focusNode:x.focusNode,focusOffset:x.focusOffset}),rt&&Em(rt,x)||(rt=x,x=f_(Tb,"onSelect"),0<x.length&&(_=new pm("onSelect","select",null,_,C),f.push({event:_,listeners:x}),_.target=Mh)))}function VE(f,_){var C={};return C[f.toLowerCase()]=_.toLowerCase(),C["Webkit"+f]="webkit"+_,C["Moz"+f]="moz"+_,C}var vm={animationend:VE("Animation","AnimationEnd"),animationiteration:VE("Animation","AnimationIteration"),animationstart:VE("Animation","AnimationStart"),transitionend:VE("Transition","TransitionEnd")},jE={},Rb={};y&&(Rb=document.createElement("div").style,"AnimationEvent"in window||(delete vm.animationend.animation,delete vm.animationiteration.animation,delete vm.animationstart.animation),"TransitionEvent"in window||delete vm.transitionend.transition);function FE(f){if(jE[f])return jE[f];if(!vm[f])return f;var _=vm[f],C;for(C in _)if(_.hasOwnProperty(C)&&C in Rb)return jE[f]=_[C];return f}var wI=FE("animationend"),TI=FE("animationiteration"),u_=FE("animationstart"),Sm=FE("transitionend"),CI=new Map,RI="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function Gl(f,_){CI.set(f,_),u(_,[f])}for(var d_=0;d_<RI.length;d_++){var bm=RI[d_],Rx=bm.toLowerCase(),Ix=bm[0].toUpperCase()+bm.slice(1);Gl(Rx,"on"+Ix)}Gl(wI,"onAnimationEnd"),Gl(TI,"onAnimationIteration"),Gl(u_,"onAnimationStart"),Gl("dblclick","onDoubleClick"),Gl("focusin","onFocus"),Gl("focusout","onBlur"),Gl(Sm,"onTransitionEnd"),p("onMouseEnter",["mouseout","mouseover"]),p("onMouseLeave",["mouseout","mouseover"]),p("onPointerEnter",["pointerout","pointerover"]),p("onPointerLeave",["pointerout","pointerover"]),u("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),u("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),u("onBeforeInput",["compositionend","keypress","textInput","paste"]),u("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),u("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),u("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var h_="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),Ax=new Set("cancel close invalid load scroll toggle".split(" ").concat(h_));function BE(f,_,C){var x=f.type||"unknown-event";f.currentTarget=C,Ah(x,_,void 0,f),f.currentTarget=null}function II(f,_){_=(_&4)!==0;for(var C=0;C<f.length;C++){var x=f[C],j=x.event;x=x.listeners;e:{var K=void 0;if(_)for(var fe=x.length-1;0<=fe;fe--){var Oe=x[fe],Ve=Oe.instance,ut=Oe.currentTarget;if(Oe=Oe.listener,Ve!==K&&j.isPropagationStopped())break e;BE(j,Oe,ut),K=Ve}else for(fe=0;fe<x.length;fe++){if(Oe=x[fe],Ve=Oe.instance,ut=Oe.currentTarget,Oe=Oe.listener,Ve!==K&&j.isPropagationStopped())break e;BE(j,Oe,ut),K=Ve}}}if(ra)throw f=Sd,ra=!1,Sd=null,f}function Mi(f,_){var C=_[kb];C===void 0&&(C=_[kb]=new Set);var x=f+"__bubble";C.has(x)||(AI(_,f,2,!1),C.add(x))}function Xa(f,_,C){var x=0;_&&(x|=4),AI(C,f,x,_)}var zE="_reactListening"+Math.random().toString(36).slice(2);function Ad(f){if(!f[zE]){f[zE]=!0,o.forEach(function(C){C!=="selectionchange"&&(Ax.has(C)||Xa(C,!1,f),Xa(C,!0,f))});var _=f.nodeType===9?f:f.ownerDocument;_===null||_[zE]||(_[zE]=!0,Xa("selectionchange",!1,_))}}function AI(f,_,C,x){switch(ai(_)){case 1:var j=Me;break;case 4:j=ct;break;default:j=Yt}C=j.bind(null,_,C,f),j=void 0,!Hc||_!=="touchstart"&&_!=="touchmove"&&_!=="wheel"||(j=!0),x?j!==void 0?f.addEventListener(_,C,{capture:!0,passive:j}):f.addEventListener(_,C,!0):j!==void 0?f.addEventListener(_,C,{passive:j}):f.addEventListener(_,C,!1)}function Ib(f,_,C,x,j){var K=x;if((_&1)===0&&(_&2)===0&&x!==null)e:for(;;){if(x===null)return;var fe=x.tag;if(fe===3||fe===4){var Oe=x.stateNode.containerInfo;if(Oe===j||Oe.nodeType===8&&Oe.parentNode===j)break;if(fe===4)for(fe=x.return;fe!==null;){var Ve=fe.tag;if((Ve===3||Ve===4)&&(Ve=fe.stateNode.containerInfo,Ve===j||Ve.nodeType===8&&Ve.parentNode===j))return;fe=fe.return}for(;Oe!==null;){if(fe=Zp(Oe),fe===null)return;if(Ve=fe.tag,Ve===5||Ve===6){x=K=fe;continue e}Oe=Oe.parentNode}}x=x.return}Ds(function(){var ut=K,xt=Mo(C),Dt=[];e:{var kt=CI.get(f);if(kt!==void 0){var ln=pm,gn=f;switch(f){case"keypress":if(Xc(C)===0)break e;case"keydown":case"keyup":ln=$;break;case"focusin":gn="focus",ln=mm;break;case"focusout":gn="blur",ln=mm;break;case"beforeblur":case"afterblur":ln=mm;break;case"click":if(C.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":ln=Pu;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":ln=NE;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":ln=ht;break;case wI:case TI:case u_:ln=Ka;break;case Sm:ln=ci;break;case"scroll":ln=i_;break;case"wheel":ln=mr;break;case"copy":case"cut":case"paste":ln=Cd;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":ln=Ee}var yn=(_&4)!==0,ss=!yn&&f==="scroll",Qe=yn?kt!==null?kt+"Capture":null:kt;yn=[];for(var Be=ut,it;Be!==null;){it=Be;var Vt=it.stateNode;if(it.tag===5&&Vt!==null&&(it=Vt,Qe!==null&&(Vt=Kt(Be,Qe),Vt!=null&&yn.push(p_(Be,Vt,it)))),ss)break;Be=Be.return}0<yn.length&&(kt=new ln(kt,gn,null,C,xt),Dt.push({event:kt,listeners:yn}))}}if((_&7)===0){e:{if(kt=f==="mouseover"||f==="pointerover",ln=f==="mouseout"||f==="pointerout",kt&&C!==Gr&&(gn=C.relatedTarget||C.fromElement)&&(Zp(gn)||gn[Pd]))break e;if((ln||kt)&&(kt=xt.window===xt?xt:(kt=xt.ownerDocument)?kt.defaultView||kt.parentWindow:window,ln?(gn=C.relatedTarget||C.toElement,ln=ut,gn=gn?Zp(gn):null,gn!==null&&(ss=Ls(gn),gn!==ss||gn.tag!==5&&gn.tag!==6)&&(gn=null)):(ln=null,gn=ut),ln!==gn)){if(yn=Pu,Vt="onMouseLeave",Qe="onMouseEnter",Be="mouse",(f==="pointerout"||f==="pointerover")&&(yn=Ee,Vt="onPointerLeave",Qe="onPointerEnter",Be="pointer"),ss=ln==null?kt:Cm(ln),it=gn==null?kt:Cm(gn),kt=new yn(Vt,Be+"leave",ln,C,xt),kt.target=ss,kt.relatedTarget=it,Vt=null,Zp(xt)===ut&&(yn=new yn(Qe,Be+"enter",gn,C,xt),yn.target=it,yn.relatedTarget=ss,Vt=yn),ss=Vt,ln&&gn)t:{for(yn=ln,Qe=gn,Be=0,it=yn;it;it=wm(it))Be++;for(it=0,Vt=Qe;Vt;Vt=wm(Vt))it++;for(;0<Be-it;)yn=wm(yn),Be--;for(;0<it-Be;)Qe=wm(Qe),it--;for(;Be--;){if(yn===Qe||Qe!==null&&yn===Qe.alternate)break t;yn=wm(yn),Qe=wm(Qe)}yn=null}else yn=null;ln!==null&&PI(Dt,kt,ln,yn,!1),gn!==null&&ss!==null&&PI(Dt,ss,gn,yn,!0)}}e:{if(kt=ut?Cm(ut):window,ln=kt.nodeName&&kt.nodeName.toLowerCase(),ln==="select"||ln==="input"&&kt.type==="file")var vn=vx;else if(_b(kt))if(l_)vn=wx;else{vn=Ya;var xn=Sx}else(ln=kt.nodeName)&&ln.toLowerCase()==="input"&&(kt.type==="checkbox"||kt.type==="radio")&&(vn=bx);if(vn&&(vn=vn(f,ut))){gI(Dt,vn,C,xt);break e}xn&&xn(f,kt,ut),f==="focusout"&&(xn=kt._wrapperState)&&xn.controlled&&kt.type==="number"&&bt(kt,"number",kt.value)}switch(xn=ut?Cm(ut):window,f){case"focusin":(_b(xn)||xn.contentEditable==="true")&&(Mh=xn,Tb=ut,rt=null);break;case"focusout":rt=Tb=Mh=null;break;case"mousedown":Cb=!0;break;case"contextmenu":case"mouseup":case"dragend":Cb=!1,bI(Dt,C,xt);break;case"selectionchange":if(wb)break;case"keydown":case"keyup":bI(Dt,C,xt)}var Dn;if(Vs)e:{switch(f){case"compositionstart":var Bn="onCompositionStart";break e;case"compositionend":Bn="onCompositionEnd";break e;case"compositionupdate":Bn="onCompositionUpdate";break e}Bn=void 0}else _m?mI(f,C)&&(Bn="onCompositionEnd"):f==="keydown"&&C.keyCode===229&&(Bn="onCompositionStart");Bn&&(Rd&&C.locale!=="ko"&&(_m||Bn!=="onCompositionStart"?Bn==="onCompositionEnd"&&_m&&(Dn=Zs()):(nr=xt,rr="value"in nr?nr.value:nr.textContent,_m=!0)),xn=f_(ut,Bn),0<xn.length&&(Bn=new a_(Bn,f,null,C,xt),Dt.push({event:Bn,listeners:xn}),Dn?Bn.data=Dn:(Dn=wc(C),Dn!==null&&(Bn.data=Dn)))),(Dn=qa?_x(f,C):yx(f,C))&&(ut=f_(ut,"onBeforeInput"),0<ut.length&&(xt=new a_("onBeforeInput","beforeinput",null,C,xt),Dt.push({event:xt,listeners:ut}),xt.data=Dn))}II(Dt,_)})}function p_(f,_,C){return{instance:f,listener:_,currentTarget:C}}function f_(f,_){for(var C=_+"Capture",x=[];f!==null;){var j=f,K=j.stateNode;j.tag===5&&K!==null&&(j=K,K=Kt(f,C),K!=null&&x.unshift(p_(f,K,j)),K=Kt(f,_),K!=null&&x.push(p_(f,K,j))),f=f.return}return x}function wm(f){if(f===null)return null;do f=f.return;while(f&&f.tag!==5);return f||null}function PI(f,_,C,x,j){for(var K=_._reactName,fe=[];C!==null&&C!==x;){var Oe=C,Ve=Oe.alternate,ut=Oe.stateNode;if(Ve!==null&&Ve===x)break;Oe.tag===5&&ut!==null&&(Oe=ut,j?(Ve=Kt(C,K),Ve!=null&&fe.unshift(p_(C,Ve,Oe))):j||(Ve=Kt(C,K),Ve!=null&&fe.push(p_(C,Ve,Oe)))),C=C.return}fe.length!==0&&f.push({event:_,listeners:fe})}var Px=/\r\n?/g,Ab=/\u0000|\uFFFD/g;function OI(f){return(typeof f=="string"?f:""+f).replace(Px,`
`).replace(Ab,"")}function m_(f,_,C){if(_=OI(_),OI(f)!==_&&C)throw Error(i(425))}function g_(){}var Pb=null,WE=null;function Tm(f,_){return f==="textarea"||f==="noscript"||typeof _.children=="string"||typeof _.children=="number"||typeof _.dangerouslySetInnerHTML=="object"&&_.dangerouslySetInnerHTML!==null&&_.dangerouslySetInnerHTML.__html!=null}var Ob=typeof setTimeout=="function"?setTimeout:void 0,Ox=typeof clearTimeout=="function"?clearTimeout:void 0,kI=typeof Promise=="function"?Promise:void 0,kx=typeof queueMicrotask=="function"?queueMicrotask:typeof kI<"u"?function(f){return kI.resolve(null).then(f).catch(Nx)}:Ob;function Nx(f){setTimeout(function(){throw f})}function GE(f,_){var C=_,x=0;do{var j=C.nextSibling;if(f.removeChild(C),j&&j.nodeType===8)if(C=j.data,C==="/$"){if(x===0){f.removeChild(j),Ra(_);return}x--}else C!=="$"&&C!=="$?"&&C!=="$!"||x++;C=j}while(C);Ra(_)}function ku(f){for(;f!=null;f=f.nextSibling){var _=f.nodeType;if(_===1||_===3)break;if(_===8){if(_=f.data,_==="$"||_==="$!"||_==="$?")break;if(_==="/$")return null}}return f}function NI(f){f=f.previousSibling;for(var _=0;f;){if(f.nodeType===8){var C=f.data;if(C==="$"||C==="$!"||C==="$?"){if(_===0)return f;_--}else C==="/$"&&_++}f=f.previousSibling}return null}var Uh=Math.random().toString(36).slice(2),Nu="__reactFiber$"+Uh,__="__reactProps$"+Uh,Pd="__reactContainer$"+Uh,kb="__reactEvents$"+Uh,xx="__reactListeners$"+Uh,Dx="__reactHandles$"+Uh;function Zp(f){var _=f[Nu];if(_)return _;for(var C=f.parentNode;C;){if(_=C[Pd]||C[Nu]){if(C=_.alternate,_.child!==null||C!==null&&C.child!==null)for(f=NI(f);f!==null;){if(C=f[Nu])return C;f=NI(f)}return _}f=C,C=f.parentNode}return null}function y_(f){return f=f[Nu]||f[Pd],!f||f.tag!==5&&f.tag!==6&&f.tag!==13&&f.tag!==3?null:f}function Cm(f){if(f.tag===5||f.tag===6)return f.stateNode;throw Error(i(33))}function HE(f){return f[__]||null}var Nb=[],Od=-1;function Hl(f){return{current:f}}function Ii(f){0>Od||(f.current=Nb[Od],Nb[Od]=null,Od--)}function Ui(f,_){Od++,Nb[Od]=f.current,f.current=_}var Vh={},oa=Hl(Vh),Aa=Hl(!1),jh=Vh;function Fh(f,_){var C=f.type.contextTypes;if(!C)return Vh;var x=f.stateNode;if(x&&x.__reactInternalMemoizedUnmaskedChildContext===_)return x.__reactInternalMemoizedMaskedChildContext;var j={},K;for(K in C)j[K]=_[K];return x&&(f=f.stateNode,f.__reactInternalMemoizedUnmaskedChildContext=_,f.__reactInternalMemoizedMaskedChildContext=j),j}function Ja(f){return f=f.childContextTypes,f!=null}function $E(){Ii(Aa),Ii(oa)}function Rm(f,_,C){if(oa.current!==Vh)throw Error(i(168));Ui(oa,_),Ui(Aa,C)}function xI(f,_,C){var x=f.stateNode;if(_=_.childContextTypes,typeof x.getChildContext!="function")return C;x=x.getChildContext();for(var j in x)if(!(j in _))throw Error(i(108,lt(f)||"Unknown",j));return Ne({},C,x)}function KE(f){return f=(f=f.stateNode)&&f.__reactInternalMemoizedMergedChildContext||Vh,jh=oa.current,Ui(oa,f),Ui(Aa,Aa.current),!0}function DI(f,_,C){var x=f.stateNode;if(!x)throw Error(i(169));C?(f=xI(f,_,jh),x.__reactInternalMemoizedMergedChildContext=f,Ii(Aa),Ii(oa),Ui(oa,f)):Ii(Aa),Ui(Aa,C)}var kd=null,qE=!1,xb=!1;function Db(f){kd===null?kd=[f]:kd.push(f)}function Lx(f){qE=!0,Db(f)}function Bh(){if(!xb&&kd!==null){xb=!0;var f=0,_=yr;try{var C=kd;for(yr=1;f<C.length;f++){var x=C[f];do x=x(!0);while(x!==null)}kd=null,qE=!1}catch(j){throw kd!==null&&(kd=kd.slice(f+1)),Sa(Vr,Bh),j}finally{yr=_,xb=!1}}return null}var Im=[],zh=0,YE=null,XE=0,Pa=[],Zc=0,ef=null,Nd=1,xd="";function tf(f,_){Im[zh++]=XE,Im[zh++]=YE,YE=f,XE=_}function LI(f,_,C){Pa[Zc++]=Nd,Pa[Zc++]=xd,Pa[Zc++]=ef,ef=f;var x=Nd;f=xd;var j=32-Ss(x)-1;x&=~(1<<j),C+=1;var K=32-Ss(_)+j;if(30<K){var fe=j-j%5;K=(x&(1<<fe)-1).toString(32),x>>=fe,j-=fe,Nd=1<<32-Ss(_)+j|C<<j|x,xd=K+f}else Nd=1<<K|C<<j|x,xd=f}function Am(f){f.return!==null&&(tf(f,1),LI(f,1,0))}function JE(f){for(;f===YE;)YE=Im[--zh],Im[zh]=null,XE=Im[--zh],Im[zh]=null;for(;f===ef;)ef=Pa[--Zc],Pa[Zc]=null,xd=Pa[--Zc],Pa[Zc]=null,Nd=Pa[--Zc],Pa[Zc]=null}var Tc=null,Cc=null,Wi=!1,$l=null;function MI(f,_){var C=il(5,null,null,0);C.elementType="DELETED",C.stateNode=_,C.return=f,_=f.deletions,_===null?(f.deletions=[C],f.flags|=16):_.push(C)}function UI(f,_){switch(f.tag){case 5:var C=f.type;return _=_.nodeType!==1||C.toLowerCase()!==_.nodeName.toLowerCase()?null:_,_!==null?(f.stateNode=_,Tc=f,Cc=ku(_.firstChild),!0):!1;case 6:return _=f.pendingProps===""||_.nodeType!==3?null:_,_!==null?(f.stateNode=_,Tc=f,Cc=null,!0):!1;case 13:return _=_.nodeType!==8?null:_,_!==null?(C=ef!==null?{id:Nd,overflow:xd}:null,f.memoizedState={dehydrated:_,treeContext:C,retryLane:1073741824},C=il(18,null,null,0),C.stateNode=_,C.return=f,f.child=C,Tc=f,Cc=null,!0):!1;default:return!1}}function E_(f){return(f.mode&1)!==0&&(f.flags&128)===0}function v_(f){if(Wi){var _=Cc;if(_){var C=_;if(!UI(f,_)){if(E_(f))throw Error(i(418));_=ku(C.nextSibling);var x=Tc;_&&UI(f,_)?MI(x,C):(f.flags=f.flags&-4097|2,Wi=!1,Tc=f)}}else{if(E_(f))throw Error(i(418));f.flags=f.flags&-4097|2,Wi=!1,Tc=f}}}function Lb(f){for(f=f.return;f!==null&&f.tag!==5&&f.tag!==3&&f.tag!==13;)f=f.return;Tc=f}function Pm(f){if(f!==Tc)return!1;if(!Wi)return Lb(f),Wi=!0,!1;var _;if((_=f.tag!==3)&&!(_=f.tag!==5)&&(_=f.type,_=_!=="head"&&_!=="body"&&!Tm(f.type,f.memoizedProps)),_&&(_=Cc)){if(E_(f))throw Mb(),Error(i(418));for(;_;)MI(f,_),_=ku(_.nextSibling)}if(Lb(f),f.tag===13){if(f=f.memoizedState,f=f!==null?f.dehydrated:null,!f)throw Error(i(317));e:{for(f=f.nextSibling,_=0;f;){if(f.nodeType===8){var C=f.data;if(C==="/$"){if(_===0){Cc=ku(f.nextSibling);break e}_--}else C!=="$"&&C!=="$!"&&C!=="$?"||_++}f=f.nextSibling}Cc=null}}else Cc=Tc?ku(f.stateNode.nextSibling):null;return!0}function Mb(){for(var f=Cc;f;)f=ku(f.nextSibling)}function nf(){Cc=Tc=null,Wi=!1}function Om(f){$l===null?$l=[f]:$l.push(f)}var S_=le.ReactCurrentBatchConfig;function b_(f,_,C){if(f=C.ref,f!==null&&typeof f!="function"&&typeof f!="object"){if(C._owner){if(C=C._owner,C){if(C.tag!==1)throw Error(i(309));var x=C.stateNode}if(!x)throw Error(i(147,f));var j=x,K=""+f;return _!==null&&_.ref!==null&&typeof _.ref=="function"&&_.ref._stringRef===K?_.ref:(_=function(fe){var Oe=j.refs;fe===null?delete Oe[K]:Oe[K]=fe},_._stringRef=K,_)}if(typeof f!="string")throw Error(i(284));if(!C._owner)throw Error(i(290,f))}return f}function QE(f,_){throw f=Object.prototype.toString.call(_),Error(i(31,f==="[object Object]"?"object with keys {"+Object.keys(_).join(", ")+"}":f))}function Ub(f){var _=f._init;return _(f._payload)}function VI(f){function _(Qe,Be){if(f){var it=Qe.deletions;it===null?(Qe.deletions=[Be],Qe.flags|=16):it.push(Be)}}function C(Qe,Be){if(!f)return null;for(;Be!==null;)_(Qe,Be),Be=Be.sibling;return null}function x(Qe,Be){for(Qe=new Map;Be!==null;)Be.key!==null?Qe.set(Be.key,Be):Qe.set(Be.index,Be),Be=Be.sibling;return Qe}function j(Qe,Be){return Qe=ep(Qe,Be),Qe.index=0,Qe.sibling=null,Qe}function K(Qe,Be,it){return Qe.index=it,f?(it=Qe.alternate,it!==null?(it=it.index,it<Be?(Qe.flags|=2,Be):it):(Qe.flags|=2,Be)):(Qe.flags|=1048576,Be)}function fe(Qe){return f&&Qe.alternate===null&&(Qe.flags|=2),Qe}function Oe(Qe,Be,it,Vt){return Be===null||Be.tag!==6?(Be=Av(it,Qe.mode,Vt),Be.return=Qe,Be):(Be=j(Be,it),Be.return=Qe,Be)}function Ve(Qe,Be,it,Vt){var vn=it.type;return vn===q?xt(Qe,Be,it.props.children,Vt,it.key):Be!==null&&(Be.elementType===vn||typeof vn=="object"&&vn!==null&&vn.$$typeof===Fe&&Ub(vn)===Be.type)?(Vt=j(Be,it.props),Vt.ref=b_(Qe,Be,it),Vt.return=Qe,Vt):(Vt=zm(it.type,it.key,it.props,null,Qe.mode,Vt),Vt.ref=b_(Qe,Be,it),Vt.return=Qe,Vt)}function ut(Qe,Be,it,Vt){return Be===null||Be.tag!==4||Be.stateNode.containerInfo!==it.containerInfo||Be.stateNode.implementation!==it.implementation?(Be=Wm(it,Qe.mode,Vt),Be.return=Qe,Be):(Be=j(Be,it.children||[]),Be.return=Qe,Be)}function xt(Qe,Be,it,Vt,vn){return Be===null||Be.tag!==7?(Be=tp(it,Qe.mode,Vt,vn),Be.return=Qe,Be):(Be=j(Be,it),Be.return=Qe,Be)}function Dt(Qe,Be,it){if(typeof Be=="string"&&Be!==""||typeof Be=="number")return Be=Av(""+Be,Qe.mode,it),Be.return=Qe,Be;if(typeof Be=="object"&&Be!==null){switch(Be.$$typeof){case ie:return it=zm(Be.type,Be.key,Be.props,null,Qe.mode,it),it.ref=b_(Qe,null,Be),it.return=Qe,it;case me:return Be=Wm(Be,Qe.mode,it),Be.return=Qe,Be;case Fe:var Vt=Be._init;return Dt(Qe,Vt(Be._payload),it)}if(ve(Be)||Te(Be))return Be=tp(Be,Qe.mode,it,null),Be.return=Qe,Be;QE(Qe,Be)}return null}function kt(Qe,Be,it,Vt){var vn=Be!==null?Be.key:null;if(typeof it=="string"&&it!==""||typeof it=="number")return vn!==null?null:Oe(Qe,Be,""+it,Vt);if(typeof it=="object"&&it!==null){switch(it.$$typeof){case ie:return it.key===vn?Ve(Qe,Be,it,Vt):null;case me:return it.key===vn?ut(Qe,Be,it,Vt):null;case Fe:return vn=it._init,kt(Qe,Be,vn(it._payload),Vt)}if(ve(it)||Te(it))return vn!==null?null:xt(Qe,Be,it,Vt,null);QE(Qe,it)}return null}function ln(Qe,Be,it,Vt,vn){if(typeof Vt=="string"&&Vt!==""||typeof Vt=="number")return Qe=Qe.get(it)||null,Oe(Be,Qe,""+Vt,vn);if(typeof Vt=="object"&&Vt!==null){switch(Vt.$$typeof){case ie:return Qe=Qe.get(Vt.key===null?it:Vt.key)||null,Ve(Be,Qe,Vt,vn);case me:return Qe=Qe.get(Vt.key===null?it:Vt.key)||null,ut(Be,Qe,Vt,vn);case Fe:var xn=Vt._init;return ln(Qe,Be,it,xn(Vt._payload),vn)}if(ve(Vt)||Te(Vt))return Qe=Qe.get(it)||null,xt(Be,Qe,Vt,vn,null);QE(Be,Vt)}return null}function gn(Qe,Be,it,Vt){for(var vn=null,xn=null,Dn=Be,Bn=Be=0,io=null;Dn!==null&&Bn<it.length;Bn++){Dn.index>Bn?(io=Dn,Dn=null):io=Dn.sibling;var Qr=kt(Qe,Dn,it[Bn],Vt);if(Qr===null){Dn===null&&(Dn=io);break}f&&Dn&&Qr.alternate===null&&_(Qe,Dn),Be=K(Qr,Be,Bn),xn===null?vn=Qr:xn.sibling=Qr,xn=Qr,Dn=io}if(Bn===it.length)return C(Qe,Dn),Wi&&tf(Qe,Bn),vn;if(Dn===null){for(;Bn<it.length;Bn++)Dn=Dt(Qe,it[Bn],Vt),Dn!==null&&(Be=K(Dn,Be,Bn),xn===null?vn=Dn:xn.sibling=Dn,xn=Dn);return Wi&&tf(Qe,Bn),vn}for(Dn=x(Qe,Dn);Bn<it.length;Bn++)io=ln(Dn,Qe,Bn,it[Bn],Vt),io!==null&&(f&&io.alternate!==null&&Dn.delete(io.key===null?Bn:io.key),Be=K(io,Be,Bn),xn===null?vn=io:xn.sibling=io,xn=io);return f&&Dn.forEach(function(Vu){return _(Qe,Vu)}),Wi&&tf(Qe,Bn),vn}function yn(Qe,Be,it,Vt){var vn=Te(it);if(typeof vn!="function")throw Error(i(150));if(it=vn.call(it),it==null)throw Error(i(151));for(var xn=vn=null,Dn=Be,Bn=Be=0,io=null,Qr=it.next();Dn!==null&&!Qr.done;Bn++,Qr=it.next()){Dn.index>Bn?(io=Dn,Dn=null):io=Dn.sibling;var Vu=kt(Qe,Dn,Qr.value,Vt);if(Vu===null){Dn===null&&(Dn=io);break}f&&Dn&&Vu.alternate===null&&_(Qe,Dn),Be=K(Vu,Be,Bn),xn===null?vn=Vu:xn.sibling=Vu,xn=Vu,Dn=io}if(Qr.done)return C(Qe,Dn),Wi&&tf(Qe,Bn),vn;if(Dn===null){for(;!Qr.done;Bn++,Qr=it.next())Qr=Dt(Qe,Qr.value,Vt),Qr!==null&&(Be=K(Qr,Be,Bn),xn===null?vn=Qr:xn.sibling=Qr,xn=Qr);return Wi&&tf(Qe,Bn),vn}for(Dn=x(Qe,Dn);!Qr.done;Bn++,Qr=it.next())Qr=ln(Dn,Qe,Bn,Qr.value,Vt),Qr!==null&&(f&&Qr.alternate!==null&&Dn.delete(Qr.key===null?Bn:Qr.key),Be=K(Qr,Be,Bn),xn===null?vn=Qr:xn.sibling=Qr,xn=Qr);return f&&Dn.forEach(function(Qx){return _(Qe,Qx)}),Wi&&tf(Qe,Bn),vn}function ss(Qe,Be,it,Vt){if(typeof it=="object"&&it!==null&&it.type===q&&it.key===null&&(it=it.props.children),typeof it=="object"&&it!==null){switch(it.$$typeof){case ie:e:{for(var vn=it.key,xn=Be;xn!==null;){if(xn.key===vn){if(vn=it.type,vn===q){if(xn.tag===7){C(Qe,xn.sibling),Be=j(xn,it.props.children),Be.return=Qe,Qe=Be;break e}}else if(xn.elementType===vn||typeof vn=="object"&&vn!==null&&vn.$$typeof===Fe&&Ub(vn)===xn.type){C(Qe,xn.sibling),Be=j(xn,it.props),Be.ref=b_(Qe,xn,it),Be.return=Qe,Qe=Be;break e}C(Qe,xn);break}else _(Qe,xn);xn=xn.sibling}it.type===q?(Be=tp(it.props.children,Qe.mode,Vt,it.key),Be.return=Qe,Qe=Be):(Vt=zm(it.type,it.key,it.props,null,Qe.mode,Vt),Vt.ref=b_(Qe,Be,it),Vt.return=Qe,Qe=Vt)}return fe(Qe);case me:e:{for(xn=it.key;Be!==null;){if(Be.key===xn)if(Be.tag===4&&Be.stateNode.containerInfo===it.containerInfo&&Be.stateNode.implementation===it.implementation){C(Qe,Be.sibling),Be=j(Be,it.children||[]),Be.return=Qe,Qe=Be;break e}else{C(Qe,Be);break}else _(Qe,Be);Be=Be.sibling}Be=Wm(it,Qe.mode,Vt),Be.return=Qe,Qe=Be}return fe(Qe);case Fe:return xn=it._init,ss(Qe,Be,xn(it._payload),Vt)}if(ve(it))return gn(Qe,Be,it,Vt);if(Te(it))return yn(Qe,Be,it,Vt);QE(Qe,it)}return typeof it=="string"&&it!==""||typeof it=="number"?(it=""+it,Be!==null&&Be.tag===6?(C(Qe,Be.sibling),Be=j(Be,it),Be.return=Qe,Qe=Be):(C(Qe,Be),Be=Av(it,Qe.mode,Vt),Be.return=Qe,Qe=Be),fe(Qe)):C(Qe,Be)}return ss}var km=VI(!0),Vb=VI(!1),ZE=Hl(null),ev=null,Nm=null,jb=null;function Fb(){jb=Nm=ev=null}function Bb(f){var _=ZE.current;Ii(ZE),f._currentValue=_}function tv(f,_,C){for(;f!==null;){var x=f.alternate;if((f.childLanes&_)!==_?(f.childLanes|=_,x!==null&&(x.childLanes|=_)):x!==null&&(x.childLanes&_)!==_&&(x.childLanes|=_),f===C)break;f=f.return}}function Kl(f,_){ev=f,jb=Nm=null,f=f.dependencies,f!==null&&f.firstContext!==null&&((f.lanes&_)!==0&&(Za=!0),f.firstContext=null)}function el(f){var _=f._currentValue;if(jb!==f)if(f={context:f,memoizedValue:_,next:null},Nm===null){if(ev===null)throw Error(i(308));Nm=f,ev.dependencies={lanes:0,firstContext:f}}else Nm=Nm.next=f;return _}var rf=null;function zb(f){rf===null?rf=[f]:rf.push(f)}function Wb(f,_,C,x){var j=_.interleaved;return j===null?(C.next=C,zb(_)):(C.next=j.next,j.next=C),_.interleaved=C,Dd(f,x)}function Dd(f,_){f.lanes|=_;var C=f.alternate;for(C!==null&&(C.lanes|=_),C=f,f=f.return;f!==null;)f.childLanes|=_,C=f.alternate,C!==null&&(C.childLanes|=_),C=f,f=f.return;return C.tag===3?C.stateNode:null}var Ld=!1;function Gb(f){f.updateQueue={baseState:f.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function jI(f,_){f=f.updateQueue,_.updateQueue===f&&(_.updateQueue={baseState:f.baseState,firstBaseUpdate:f.firstBaseUpdate,lastBaseUpdate:f.lastBaseUpdate,shared:f.shared,effects:f.effects})}function Md(f,_){return{eventTime:f,lane:_,tag:0,payload:null,callback:null,next:null}}function ql(f,_,C){var x=f.updateQueue;if(x===null)return null;if(x=x.shared,(Ir&2)!==0){var j=x.pending;return j===null?_.next=_:(_.next=j.next,j.next=_),x.pending=_,Dd(f,C)}return j=x.interleaved,j===null?(_.next=_,zb(x)):(_.next=j.next,j.next=_),x.interleaved=_,Dd(f,C)}function nv(f,_,C){if(_=_.updateQueue,_!==null&&(_=_.shared,(C&4194240)!==0)){var x=_.lanes;x&=f.pendingLanes,C|=x,_.lanes=C,Tu(f,C)}}function FI(f,_){var C=f.updateQueue,x=f.alternate;if(x!==null&&(x=x.updateQueue,C===x)){var j=null,K=null;if(C=C.firstBaseUpdate,C!==null){do{var fe={eventTime:C.eventTime,lane:C.lane,tag:C.tag,payload:C.payload,callback:C.callback,next:null};K===null?j=K=fe:K=K.next=fe,C=C.next}while(C!==null);K===null?j=K=_:K=K.next=_}else j=K=_;C={baseState:x.baseState,firstBaseUpdate:j,lastBaseUpdate:K,shared:x.shared,effects:x.effects},f.updateQueue=C;return}f=C.lastBaseUpdate,f===null?C.firstBaseUpdate=_:f.next=_,C.lastBaseUpdate=_}function rv(f,_,C,x){var j=f.updateQueue;Ld=!1;var K=j.firstBaseUpdate,fe=j.lastBaseUpdate,Oe=j.shared.pending;if(Oe!==null){j.shared.pending=null;var Ve=Oe,ut=Ve.next;Ve.next=null,fe===null?K=ut:fe.next=ut,fe=Ve;var xt=f.alternate;xt!==null&&(xt=xt.updateQueue,Oe=xt.lastBaseUpdate,Oe!==fe&&(Oe===null?xt.firstBaseUpdate=ut:Oe.next=ut,xt.lastBaseUpdate=Ve))}if(K!==null){var Dt=j.baseState;fe=0,xt=ut=Ve=null,Oe=K;do{var kt=Oe.lane,ln=Oe.eventTime;if((x&kt)===kt){xt!==null&&(xt=xt.next={eventTime:ln,lane:0,tag:Oe.tag,payload:Oe.payload,callback:Oe.callback,next:null});e:{var gn=f,yn=Oe;switch(kt=_,ln=C,yn.tag){case 1:if(gn=yn.payload,typeof gn=="function"){Dt=gn.call(ln,Dt,kt);break e}Dt=gn;break e;case 3:gn.flags=gn.flags&-65537|128;case 0:if(gn=yn.payload,kt=typeof gn=="function"?gn.call(ln,Dt,kt):gn,kt==null)break e;Dt=Ne({},Dt,kt);break e;case 2:Ld=!0}}Oe.callback!==null&&Oe.lane!==0&&(f.flags|=64,kt=j.effects,kt===null?j.effects=[Oe]:kt.push(Oe))}else ln={eventTime:ln,lane:kt,tag:Oe.tag,payload:Oe.payload,callback:Oe.callback,next:null},xt===null?(ut=xt=ln,Ve=Dt):xt=xt.next=ln,fe|=kt;if(Oe=Oe.next,Oe===null){if(Oe=j.shared.pending,Oe===null)break;kt=Oe,Oe=kt.next,kt.next=null,j.lastBaseUpdate=kt,j.shared.pending=null}}while(!0);if(xt===null&&(Ve=Dt),j.baseState=Ve,j.firstBaseUpdate=ut,j.lastBaseUpdate=xt,_=j.shared.interleaved,_!==null){j=_;do fe|=j.lane,j=j.next;while(j!==_)}else K===null&&(j.shared.lanes=0);hf|=fe,f.lanes=fe,f.memoizedState=Dt}}function BI(f,_,C){if(f=_.effects,_.effects=null,f!==null)for(_=0;_<f.length;_++){var x=f[_],j=x.callback;if(j!==null){if(x.callback=null,x=C,typeof j!="function")throw Error(i(191,j));j.call(x)}}}var w_={},xu=Hl(w_),sf=Hl(w_),T_=Hl(w_);function Wh(f){if(f===w_)throw Error(i(174));return f}function Hb(f,_){switch(Ui(T_,_),Ui(sf,f),Ui(xu,w_),f=_.nodeType,f){case 9:case 11:_=(_=_.documentElement)?_.namespaceURI:cn(null,"");break;default:f=f===8?_.parentNode:_,_=f.namespaceURI||null,f=f.tagName,_=cn(_,f)}Ii(xu),Ui(xu,_)}function of(){Ii(xu),Ii(sf),Ii(T_)}function zI(f){Wh(T_.current);var _=Wh(xu.current),C=cn(_,f.type);_!==C&&(Ui(sf,f),Ui(xu,C))}function $b(f){sf.current===f&&(Ii(xu),Ii(sf))}var rs=Hl(0);function iv(f){for(var _=f;_!==null;){if(_.tag===13){var C=_.memoizedState;if(C!==null&&(C=C.dehydrated,C===null||C.data==="$?"||C.data==="$!"))return _}else if(_.tag===19&&_.memoizedProps.revealOrder!==void 0){if((_.flags&128)!==0)return _}else if(_.child!==null){_.child.return=_,_=_.child;continue}if(_===f)break;for(;_.sibling===null;){if(_.return===null||_.return===f)return null;_=_.return}_.sibling.return=_.return,_=_.sibling}return null}var Kb=[];function qb(){for(var f=0;f<Kb.length;f++)Kb[f]._workInProgressVersionPrimary=null;Kb.length=0}var C_=le.ReactCurrentDispatcher,Yb=le.ReactCurrentBatchConfig,af=0,Qi=null,to=null,ws=null,R_=!1,Ud=!1,I_=0,Mx=0;function aa(){throw Error(i(321))}function Xb(f,_){if(_===null)return!1;for(var C=0;C<_.length&&C<f.length;C++)if(!Wl(f[C],_[C]))return!1;return!0}function xm(f,_,C,x,j,K){if(af=K,Qi=_,_.memoizedState=null,_.updateQueue=null,_.lanes=0,C_.current=f===null||f.memoizedState===null?Vx:JI,f=C(x,j),Ud){K=0;do{if(Ud=!1,I_=0,25<=K)throw Error(i(301));K+=1,ws=to=null,_.updateQueue=null,C_.current=jx,f=C(x,j)}while(Ud)}if(C_.current=Lm,_=to!==null&&to.next!==null,af=0,ws=to=Qi=null,R_=!1,_)throw Error(i(300));return f}function Jb(){var f=I_!==0;return I_=0,f}function Yl(){var f={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return ws===null?Qi.memoizedState=ws=f:ws=ws.next=f,ws}function Qa(){if(to===null){var f=Qi.alternate;f=f!==null?f.memoizedState:null}else f=to.next;var _=ws===null?Qi.memoizedState:ws.next;if(_!==null)ws=_,to=f;else{if(f===null)throw Error(i(310));to=f,f={memoizedState:to.memoizedState,baseState:to.baseState,baseQueue:to.baseQueue,queue:to.queue,next:null},ws===null?Qi.memoizedState=ws=f:ws=ws.next=f}return ws}function cf(f,_){return typeof _=="function"?_(f):_}function Qb(f){var _=Qa(),C=_.queue;if(C===null)throw Error(i(311));C.lastRenderedReducer=f;var x=to,j=x.baseQueue,K=C.pending;if(K!==null){if(j!==null){var fe=j.next;j.next=K.next,K.next=fe}x.baseQueue=j=K,C.pending=null}if(j!==null){K=j.next,x=x.baseState;var Oe=fe=null,Ve=null,ut=K;do{var xt=ut.lane;if((af&xt)===xt)Ve!==null&&(Ve=Ve.next={lane:0,action:ut.action,hasEagerState:ut.hasEagerState,eagerState:ut.eagerState,next:null}),x=ut.hasEagerState?ut.eagerState:f(x,ut.action);else{var Dt={lane:xt,action:ut.action,hasEagerState:ut.hasEagerState,eagerState:ut.eagerState,next:null};Ve===null?(Oe=Ve=Dt,fe=x):Ve=Ve.next=Dt,Qi.lanes|=xt,hf|=xt}ut=ut.next}while(ut!==null&&ut!==K);Ve===null?fe=x:Ve.next=Oe,Wl(x,_.memoizedState)||(Za=!0),_.memoizedState=x,_.baseState=fe,_.baseQueue=Ve,C.lastRenderedState=x}if(f=C.interleaved,f!==null){j=f;do K=j.lane,Qi.lanes|=K,hf|=K,j=j.next;while(j!==f)}else j===null&&(C.lanes=0);return[_.memoizedState,C.dispatch]}function Zb(f){var _=Qa(),C=_.queue;if(C===null)throw Error(i(311));C.lastRenderedReducer=f;var x=C.dispatch,j=C.pending,K=_.memoizedState;if(j!==null){C.pending=null;var fe=j=j.next;do K=f(K,fe.action),fe=fe.next;while(fe!==j);Wl(K,_.memoizedState)||(Za=!0),_.memoizedState=K,_.baseQueue===null&&(_.baseState=K),C.lastRenderedState=K}return[K,x]}function WI(){}function GI(f,_){var C=Qi,x=Qa(),j=_(),K=!Wl(x.memoizedState,j);if(K&&(x.memoizedState=j,Za=!0),x=x.queue,av($I.bind(null,C,x,f),[f]),x.getSnapshot!==_||K||ws!==null&&ws.memoizedState.tag&1){if(C.flags|=2048,Vd(9,A_.bind(null,C,x,j,_),void 0,null),no===null)throw Error(i(349));(af&30)!==0||HI(C,_,j)}return j}function HI(f,_,C){f.flags|=16384,f={getSnapshot:_,value:C},_=Qi.updateQueue,_===null?(_={lastEffect:null,stores:null},Qi.updateQueue=_,_.stores=[f]):(C=_.stores,C===null?_.stores=[f]:C.push(f))}function A_(f,_,C,x){_.value=C,_.getSnapshot=x,lf(_)&&sv(f)}function $I(f,_,C){return C(function(){lf(_)&&sv(f)})}function lf(f){var _=f.getSnapshot;f=f.value;try{var C=_();return!Wl(f,C)}catch{return!0}}function sv(f){var _=Dd(f,1);_!==null&&Ac(_,f,1,-1)}function P_(f){var _=Yl();return typeof f=="function"&&(f=f()),_.memoizedState=_.baseState=f,f={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:cf,lastRenderedState:f},_.queue=f,f=f.dispatch=uf.bind(null,Qi,f),[_.memoizedState,f]}function Vd(f,_,C,x){return f={tag:f,create:_,destroy:C,deps:x,next:null},_=Qi.updateQueue,_===null?(_={lastEffect:null,stores:null},Qi.updateQueue=_,_.lastEffect=f.next=f):(C=_.lastEffect,C===null?_.lastEffect=f.next=f:(x=C.next,C.next=f,f.next=x,_.lastEffect=f)),f}function O_(){return Qa().memoizedState}function ov(f,_,C,x){var j=Yl();Qi.flags|=f,j.memoizedState=Vd(1|_,C,void 0,x===void 0?null:x)}function k_(f,_,C,x){var j=Qa();x=x===void 0?null:x;var K=void 0;if(to!==null){var fe=to.memoizedState;if(K=fe.destroy,x!==null&&Xb(x,fe.deps)){j.memoizedState=Vd(_,C,K,x);return}}Qi.flags|=f,j.memoizedState=Vd(1|_,C,K,x)}function KI(f,_){return ov(8390656,8,f,_)}function av(f,_){return k_(2048,8,f,_)}function qI(f,_){return k_(4,2,f,_)}function YI(f,_){return k_(4,4,f,_)}function cv(f,_){if(typeof _=="function")return f=f(),_(f),function(){_(null)};if(_!=null)return f=f(),_.current=f,function(){_.current=null}}function lv(f,_,C){return C=C!=null?C.concat([f]):null,k_(4,4,cv.bind(null,_,f),C)}function ew(){}function XI(f,_){var C=Qa();_=_===void 0?null:_;var x=C.memoizedState;return x!==null&&_!==null&&Xb(_,x[1])?x[0]:(C.memoizedState=[f,_],f)}function tw(f,_){var C=Qa();_=_===void 0?null:_;var x=C.memoizedState;return x!==null&&_!==null&&Xb(_,x[1])?x[0]:(f=f(),C.memoizedState=[f,_],f)}function uv(f,_,C){return(af&21)===0?(f.baseState&&(f.baseState=!1,Za=!0),f.memoizedState=C):(Wl(C,_)||(C=Hr(),Qi.lanes|=C,hf|=C,f.baseState=!0),_)}function Ux(f,_){var C=yr;yr=C!==0&&4>C?C:4,f(!0);var x=Yb.transition;Yb.transition={};try{f(!1),_()}finally{yr=C,Yb.transition=x}}function Xl(){return Qa().memoizedState}function Dm(f,_,C){var x=Xh(f);if(C={lane:x,action:C,hasEagerState:!1,eagerState:null,next:null},nw(f))rw(_,C);else if(C=Wb(f,_,C,x),C!==null){var j=ka();Ac(C,f,x,j),Gh(C,_,x)}}function uf(f,_,C){var x=Xh(f),j={lane:x,action:C,hasEagerState:!1,eagerState:null,next:null};if(nw(f))rw(_,j);else{var K=f.alternate;if(f.lanes===0&&(K===null||K.lanes===0)&&(K=_.lastRenderedReducer,K!==null))try{var fe=_.lastRenderedState,Oe=K(fe,C);if(j.hasEagerState=!0,j.eagerState=Oe,Wl(Oe,fe)){var Ve=_.interleaved;Ve===null?(j.next=j,zb(_)):(j.next=Ve.next,Ve.next=j),_.interleaved=j;return}}catch{}finally{}C=Wb(f,_,j,x),C!==null&&(j=ka(),Ac(C,f,x,j),Gh(C,_,x))}}function nw(f){var _=f.alternate;return f===Qi||_!==null&&_===Qi}function rw(f,_){Ud=R_=!0;var C=f.pending;C===null?_.next=_:(_.next=C.next,C.next=_),f.pending=_}function Gh(f,_,C){if((C&4194240)!==0){var x=_.lanes;x&=f.pendingLanes,C|=x,_.lanes=C,Tu(f,C)}}var Lm={readContext:el,useCallback:aa,useContext:aa,useEffect:aa,useImperativeHandle:aa,useInsertionEffect:aa,useLayoutEffect:aa,useMemo:aa,useReducer:aa,useRef:aa,useState:aa,useDebugValue:aa,useDeferredValue:aa,useTransition:aa,useMutableSource:aa,useSyncExternalStore:aa,useId:aa,unstable_isNewReconciler:!1},Vx={readContext:el,useCallback:function(f,_){return Yl().memoizedState=[f,_===void 0?null:_],f},useContext:el,useEffect:KI,useImperativeHandle:function(f,_,C){return C=C!=null?C.concat([f]):null,ov(4194308,4,cv.bind(null,_,f),C)},useLayoutEffect:function(f,_){return ov(4194308,4,f,_)},useInsertionEffect:function(f,_){return ov(4,2,f,_)},useMemo:function(f,_){var C=Yl();return _=_===void 0?null:_,f=f(),C.memoizedState=[f,_],f},useReducer:function(f,_,C){var x=Yl();return _=C!==void 0?C(_):_,x.memoizedState=x.baseState=_,f={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:f,lastRenderedState:_},x.queue=f,f=f.dispatch=Dm.bind(null,Qi,f),[x.memoizedState,f]},useRef:function(f){var _=Yl();return f={current:f},_.memoizedState=f},useState:P_,useDebugValue:ew,useDeferredValue:function(f){return Yl().memoizedState=f},useTransition:function(){var f=P_(!1),_=f[0];return f=Ux.bind(null,f[1]),Yl().memoizedState=f,[_,f]},useMutableSource:function(){},useSyncExternalStore:function(f,_,C){var x=Qi,j=Yl();if(Wi){if(C===void 0)throw Error(i(407));C=C()}else{if(C=_(),no===null)throw Error(i(349));(af&30)!==0||HI(x,_,C)}j.memoizedState=C;var K={value:C,getSnapshot:_};return j.queue=K,KI($I.bind(null,x,K,f),[f]),x.flags|=2048,Vd(9,A_.bind(null,x,K,C,_),void 0,null),C},useId:function(){var f=Yl(),_=no.identifierPrefix;if(Wi){var C=xd,x=Nd;C=(x&~(1<<32-Ss(x)-1)).toString(32)+C,_=":"+_+"R"+C,C=I_++,0<C&&(_+="H"+C.toString(32)),_+=":"}else C=Mx++,_=":"+_+"r"+C.toString(32)+":";return f.memoizedState=_},unstable_isNewReconciler:!1},JI={readContext:el,useCallback:XI,useContext:el,useEffect:av,useImperativeHandle:lv,useInsertionEffect:qI,useLayoutEffect:YI,useMemo:tw,useReducer:Qb,useRef:O_,useState:function(){return Qb(cf)},useDebugValue:ew,useDeferredValue:function(f){var _=Qa();return uv(_,to.memoizedState,f)},useTransition:function(){var f=Qb(cf)[0],_=Qa().memoizedState;return[f,_]},useMutableSource:WI,useSyncExternalStore:GI,useId:Xl,unstable_isNewReconciler:!1},jx={readContext:el,useCallback:XI,useContext:el,useEffect:av,useImperativeHandle:lv,useInsertionEffect:qI,useLayoutEffect:YI,useMemo:tw,useReducer:Zb,useRef:O_,useState:function(){return Zb(cf)},useDebugValue:ew,useDeferredValue:function(f){var _=Qa();return to===null?_.memoizedState=f:uv(_,to.memoizedState,f)},useTransition:function(){var f=Zb(cf)[0],_=Qa().memoizedState;return[f,_]},useMutableSource:WI,useSyncExternalStore:GI,useId:Xl,unstable_isNewReconciler:!1};function tl(f,_){if(f&&f.defaultProps){_=Ne({},_),f=f.defaultProps;for(var C in f)_[C]===void 0&&(_[C]=f[C]);return _}return _}function dv(f,_,C,x){_=f.memoizedState,C=C(x,_),C=C==null?_:Ne({},_,C),f.memoizedState=C,f.lanes===0&&(f.updateQueue.baseState=C)}var hv={isMounted:function(f){return(f=f._reactInternals)?Ls(f)===f:!1},enqueueSetState:function(f,_,C){f=f._reactInternals;var x=ka(),j=Xh(f),K=Md(x,j);K.payload=_,C!=null&&(K.callback=C),_=ql(f,K,j),_!==null&&(Ac(_,f,j,x),nv(_,f,j))},enqueueReplaceState:function(f,_,C){f=f._reactInternals;var x=ka(),j=Xh(f),K=Md(x,j);K.tag=1,K.payload=_,C!=null&&(K.callback=C),_=ql(f,K,j),_!==null&&(Ac(_,f,j,x),nv(_,f,j))},enqueueForceUpdate:function(f,_){f=f._reactInternals;var C=ka(),x=Xh(f),j=Md(C,x);j.tag=2,_!=null&&(j.callback=_),_=ql(f,j,x),_!==null&&(Ac(_,f,x,C),nv(_,f,x))}};function jd(f,_,C,x,j,K,fe){return f=f.stateNode,typeof f.shouldComponentUpdate=="function"?f.shouldComponentUpdate(x,K,fe):_.prototype&&_.prototype.isPureReactComponent?!Em(C,x)||!Em(j,K):!0}function QI(f,_,C){var x=!1,j=Vh,K=_.contextType;return typeof K=="object"&&K!==null?K=el(K):(j=Ja(_)?jh:oa.current,x=_.contextTypes,K=(x=x!=null)?Fh(f,j):Vh),_=new _(C,K),f.memoizedState=_.state!==null&&_.state!==void 0?_.state:null,_.updater=hv,f.stateNode=_,_._reactInternals=f,x&&(f=f.stateNode,f.__reactInternalMemoizedUnmaskedChildContext=j,f.__reactInternalMemoizedMaskedChildContext=K),_}function ZI(f,_,C,x){f=_.state,typeof _.componentWillReceiveProps=="function"&&_.componentWillReceiveProps(C,x),typeof _.UNSAFE_componentWillReceiveProps=="function"&&_.UNSAFE_componentWillReceiveProps(C,x),_.state!==f&&hv.enqueueReplaceState(_,_.state,null)}function iw(f,_,C,x){var j=f.stateNode;j.props=C,j.state=f.memoizedState,j.refs={},Gb(f);var K=_.contextType;typeof K=="object"&&K!==null?j.context=el(K):(K=Ja(_)?jh:oa.current,j.context=Fh(f,K)),j.state=f.memoizedState,K=_.getDerivedStateFromProps,typeof K=="function"&&(dv(f,_,K,C),j.state=f.memoizedState),typeof _.getDerivedStateFromProps=="function"||typeof j.getSnapshotBeforeUpdate=="function"||typeof j.UNSAFE_componentWillMount!="function"&&typeof j.componentWillMount!="function"||(_=j.state,typeof j.componentWillMount=="function"&&j.componentWillMount(),typeof j.UNSAFE_componentWillMount=="function"&&j.UNSAFE_componentWillMount(),_!==j.state&&hv.enqueueReplaceState(j,j.state,null),rv(f,C,j,x),j.state=f.memoizedState),typeof j.componentDidMount=="function"&&(f.flags|=4194308)}function Mm(f,_){try{var C="",x=_;do C+=dt(x),x=x.return;while(x);var j=C}catch(K){j=`
Error generating stack: `+K.message+`
`+K.stack}return{value:f,source:_,stack:j,digest:null}}function pv(f,_,C){return{value:f,source:null,stack:C??null,digest:_??null}}function sw(f,_){try{console.error(_.value)}catch(C){setTimeout(function(){throw C})}}var ow=typeof WeakMap=="function"?WeakMap:Map;function aw(f,_,C){C=Md(-1,C),C.tag=3,C.payload={element:null};var x=_.value;return C.callback=function(){la||(la=!0,Rw=x),sw(f,_)},C}function eA(f,_,C){C=Md(-1,C),C.tag=3;var x=f.type.getDerivedStateFromError;if(typeof x=="function"){var j=_.value;C.payload=function(){return x(j)},C.callback=function(){sw(f,_)}}var K=f.stateNode;return K!==null&&typeof K.componentDidCatch=="function"&&(C.callback=function(){sw(f,_),typeof x!="function"&&(qh===null?qh=new Set([this]):qh.add(this));var fe=_.stack;this.componentDidCatch(_.value,{componentStack:fe!==null?fe:""})}),C}function cw(f,_,C){var x=f.pingCache;if(x===null){x=f.pingCache=new ow;var j=new Set;x.set(_,j)}else j=x.get(_),j===void 0&&(j=new Set,x.set(_,j));j.has(C)||(j.add(C),f=yA.bind(null,f,_,C),_.then(f,f))}function tA(f){do{var _;if((_=f.tag===13)&&(_=f.memoizedState,_=_!==null?_.dehydrated!==null:!0),_)return f;f=f.return}while(f!==null);return null}function nA(f,_,C,x,j){return(f.mode&1)===0?(f===_?f.flags|=65536:(f.flags|=128,C.flags|=131072,C.flags&=-52805,C.tag===1&&(C.alternate===null?C.tag=17:(_=Md(-1,1),_.tag=2,ql(C,_,1))),C.lanes|=1),f):(f.flags|=65536,f.lanes=j,f)}var Fx=le.ReactCurrentOwner,Za=!1;function Oa(f,_,C,x){_.child=f===null?Vb(_,null,C,x):km(_,f.child,C,x)}function rA(f,_,C,x,j){C=C.render;var K=_.ref;return Kl(_,j),x=xm(f,_,C,x,K,j),C=Jb(),f!==null&&!Za?(_.updateQueue=f.updateQueue,_.flags&=-2053,f.lanes&=~j,Fd(f,_,j)):(Wi&&C&&Am(_),_.flags|=1,Oa(f,_,x,j),_.child)}function iA(f,_,C,x,j){if(f===null){var K=C.type;return typeof K=="function"&&!Mw(K)&&K.defaultProps===void 0&&C.compare===null&&C.defaultProps===void 0?(_.tag=15,_.type=K,lw(f,_,K,x,j)):(f=zm(C.type,null,x,_,_.mode,j),f.ref=_.ref,f.return=_,_.child=f)}if(K=f.child,(f.lanes&j)===0){var fe=K.memoizedProps;if(C=C.compare,C=C!==null?C:Em,C(fe,x)&&f.ref===_.ref)return Fd(f,_,j)}return _.flags|=1,f=ep(K,x),f.ref=_.ref,f.return=_,_.child=f}function lw(f,_,C,x,j){if(f!==null){var K=f.memoizedProps;if(Em(K,x)&&f.ref===_.ref)if(Za=!1,_.pendingProps=x=K,(f.lanes&j)!==0)(f.flags&131072)!==0&&(Za=!0);else return _.lanes=f.lanes,Fd(f,_,j)}return uw(f,_,C,x,j)}function Du(f,_,C){var x=_.pendingProps,j=x.children,K=f!==null?f.memoizedState:null;if(x.mode==="hidden")if((_.mode&1)===0)_.memoizedState={baseLanes:0,cachePool:null,transitions:null},Ui(Um,Ic),Ic|=C;else{if((C&1073741824)===0)return f=K!==null?K.baseLanes|C:C,_.lanes=_.childLanes=1073741824,_.memoizedState={baseLanes:f,cachePool:null,transitions:null},_.updateQueue=null,Ui(Um,Ic),Ic|=f,null;_.memoizedState={baseLanes:0,cachePool:null,transitions:null},x=K!==null?K.baseLanes:C,Ui(Um,Ic),Ic|=x}else K!==null?(x=K.baseLanes|C,_.memoizedState=null):x=C,Ui(Um,Ic),Ic|=x;return Oa(f,_,j,C),_.child}function sA(f,_){var C=_.ref;(f===null&&C!==null||f!==null&&f.ref!==C)&&(_.flags|=512,_.flags|=2097152)}function uw(f,_,C,x,j){var K=Ja(C)?jh:oa.current;return K=Fh(_,K),Kl(_,j),C=xm(f,_,C,x,K,j),x=Jb(),f!==null&&!Za?(_.updateQueue=f.updateQueue,_.flags&=-2053,f.lanes&=~j,Fd(f,_,j)):(Wi&&x&&Am(_),_.flags|=1,Oa(f,_,C,j),_.child)}function oA(f,_,C,x,j){if(Ja(C)){var K=!0;KE(_)}else K=!1;if(Kl(_,j),_.stateNode===null)gv(f,_),QI(_,C,x),iw(_,C,x,j),x=!0;else if(f===null){var fe=_.stateNode,Oe=_.memoizedProps;fe.props=Oe;var Ve=fe.context,ut=C.contextType;typeof ut=="object"&&ut!==null?ut=el(ut):(ut=Ja(C)?jh:oa.current,ut=Fh(_,ut));var xt=C.getDerivedStateFromProps,Dt=typeof xt=="function"||typeof fe.getSnapshotBeforeUpdate=="function";Dt||typeof fe.UNSAFE_componentWillReceiveProps!="function"&&typeof fe.componentWillReceiveProps!="function"||(Oe!==x||Ve!==ut)&&ZI(_,fe,x,ut),Ld=!1;var kt=_.memoizedState;fe.state=kt,rv(_,x,fe,j),Ve=_.memoizedState,Oe!==x||kt!==Ve||Aa.current||Ld?(typeof xt=="function"&&(dv(_,C,xt,x),Ve=_.memoizedState),(Oe=Ld||jd(_,C,Oe,x,kt,Ve,ut))?(Dt||typeof fe.UNSAFE_componentWillMount!="function"&&typeof fe.componentWillMount!="function"||(typeof fe.componentWillMount=="function"&&fe.componentWillMount(),typeof fe.UNSAFE_componentWillMount=="function"&&fe.UNSAFE_componentWillMount()),typeof fe.componentDidMount=="function"&&(_.flags|=4194308)):(typeof fe.componentDidMount=="function"&&(_.flags|=4194308),_.memoizedProps=x,_.memoizedState=Ve),fe.props=x,fe.state=Ve,fe.context=ut,x=Oe):(typeof fe.componentDidMount=="function"&&(_.flags|=4194308),x=!1)}else{fe=_.stateNode,jI(f,_),Oe=_.memoizedProps,ut=_.type===_.elementType?Oe:tl(_.type,Oe),fe.props=ut,Dt=_.pendingProps,kt=fe.context,Ve=C.contextType,typeof Ve=="object"&&Ve!==null?Ve=el(Ve):(Ve=Ja(C)?jh:oa.current,Ve=Fh(_,Ve));var ln=C.getDerivedStateFromProps;(xt=typeof ln=="function"||typeof fe.getSnapshotBeforeUpdate=="function")||typeof fe.UNSAFE_componentWillReceiveProps!="function"&&typeof fe.componentWillReceiveProps!="function"||(Oe!==Dt||kt!==Ve)&&ZI(_,fe,x,Ve),Ld=!1,kt=_.memoizedState,fe.state=kt,rv(_,x,fe,j);var gn=_.memoizedState;Oe!==Dt||kt!==gn||Aa.current||Ld?(typeof ln=="function"&&(dv(_,C,ln,x),gn=_.memoizedState),(ut=Ld||jd(_,C,ut,x,kt,gn,Ve)||!1)?(xt||typeof fe.UNSAFE_componentWillUpdate!="function"&&typeof fe.componentWillUpdate!="function"||(typeof fe.componentWillUpdate=="function"&&fe.componentWillUpdate(x,gn,Ve),typeof fe.UNSAFE_componentWillUpdate=="function"&&fe.UNSAFE_componentWillUpdate(x,gn,Ve)),typeof fe.componentDidUpdate=="function"&&(_.flags|=4),typeof fe.getSnapshotBeforeUpdate=="function"&&(_.flags|=1024)):(typeof fe.componentDidUpdate!="function"||Oe===f.memoizedProps&&kt===f.memoizedState||(_.flags|=4),typeof fe.getSnapshotBeforeUpdate!="function"||Oe===f.memoizedProps&&kt===f.memoizedState||(_.flags|=1024),_.memoizedProps=x,_.memoizedState=gn),fe.props=x,fe.state=gn,fe.context=Ve,x=ut):(typeof fe.componentDidUpdate!="function"||Oe===f.memoizedProps&&kt===f.memoizedState||(_.flags|=4),typeof fe.getSnapshotBeforeUpdate!="function"||Oe===f.memoizedProps&&kt===f.memoizedState||(_.flags|=1024),x=!1)}return dw(f,_,C,x,K,j)}function dw(f,_,C,x,j,K){sA(f,_);var fe=(_.flags&128)!==0;if(!x&&!fe)return j&&DI(_,C,!1),Fd(f,_,K);x=_.stateNode,Fx.current=_;var Oe=fe&&typeof C.getDerivedStateFromError!="function"?null:x.render();return _.flags|=1,f!==null&&fe?(_.child=km(_,f.child,null,K),_.child=km(_,null,Oe,K)):Oa(f,_,Oe,K),_.memoizedState=x.state,j&&DI(_,C,!0),_.child}function aA(f){var _=f.stateNode;_.pendingContext?Rm(f,_.pendingContext,_.pendingContext!==_.context):_.context&&Rm(f,_.context,!1),Hb(f,_.containerInfo)}function cA(f,_,C,x,j){return nf(),Om(j),_.flags|=256,Oa(f,_,C,x),_.child}var N_={dehydrated:null,treeContext:null,retryLane:0};function hw(f){return{baseLanes:f,cachePool:null,transitions:null}}function lA(f,_,C){var x=_.pendingProps,j=rs.current,K=!1,fe=(_.flags&128)!==0,Oe;if((Oe=fe)||(Oe=f!==null&&f.memoizedState===null?!1:(j&2)!==0),Oe?(K=!0,_.flags&=-129):(f===null||f.memoizedState!==null)&&(j|=1),Ui(rs,j&1),f===null)return v_(_),f=_.memoizedState,f!==null&&(f=f.dehydrated,f!==null)?((_.mode&1)===0?_.lanes=1:f.data==="$!"?_.lanes=8:_.lanes=1073741824,null):(fe=x.children,f=x.fallback,K?(x=_.mode,K=_.child,fe={mode:"hidden",children:fe},(x&1)===0&&K!==null?(K.childLanes=0,K.pendingProps=fe):K=W_(fe,x,0,null),f=tp(f,x,C,null),K.return=_,f.return=_,K.sibling=f,_.child=K,_.child.memoizedState=hw(C),_.memoizedState=N_,f):pw(_,fe));if(j=f.memoizedState,j!==null&&(Oe=j.dehydrated,Oe!==null))return Bx(f,_,fe,x,Oe,j,C);if(K){K=x.fallback,fe=_.mode,j=f.child,Oe=j.sibling;var Ve={mode:"hidden",children:x.children};return(fe&1)===0&&_.child!==j?(x=_.child,x.childLanes=0,x.pendingProps=Ve,_.deletions=null):(x=ep(j,Ve),x.subtreeFlags=j.subtreeFlags&14680064),Oe!==null?K=ep(Oe,K):(K=tp(K,fe,C,null),K.flags|=2),K.return=_,x.return=_,x.sibling=K,_.child=x,x=K,K=_.child,fe=f.child.memoizedState,fe=fe===null?hw(C):{baseLanes:fe.baseLanes|C,cachePool:null,transitions:fe.transitions},K.memoizedState=fe,K.childLanes=f.childLanes&~C,_.memoizedState=N_,x}return K=f.child,f=K.sibling,x=ep(K,{mode:"visible",children:x.children}),(_.mode&1)===0&&(x.lanes=C),x.return=_,x.sibling=null,f!==null&&(C=_.deletions,C===null?(_.deletions=[f],_.flags|=16):C.push(f)),_.child=x,_.memoizedState=null,x}function pw(f,_){return _=W_({mode:"visible",children:_},f.mode,0,null),_.return=f,f.child=_}function fv(f,_,C,x){return x!==null&&Om(x),km(_,f.child,null,C),f=pw(_,_.pendingProps.children),f.flags|=2,_.memoizedState=null,f}function Bx(f,_,C,x,j,K,fe){if(C)return _.flags&256?(_.flags&=-257,x=pv(Error(i(422))),fv(f,_,fe,x)):_.memoizedState!==null?(_.child=f.child,_.flags|=128,null):(K=x.fallback,j=_.mode,x=W_({mode:"visible",children:x.children},j,0,null),K=tp(K,j,fe,null),K.flags|=2,x.return=_,K.return=_,x.sibling=K,_.child=x,(_.mode&1)!==0&&km(_,f.child,null,fe),_.child.memoizedState=hw(fe),_.memoizedState=N_,K);if((_.mode&1)===0)return fv(f,_,fe,null);if(j.data==="$!"){if(x=j.nextSibling&&j.nextSibling.dataset,x)var Oe=x.dgst;return x=Oe,K=Error(i(419)),x=pv(K,x,void 0),fv(f,_,fe,x)}if(Oe=(fe&f.childLanes)!==0,Za||Oe){if(x=no,x!==null){switch(fe&-fe){case 4:j=2;break;case 16:j=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:j=32;break;case 536870912:j=268435456;break;default:j=0}j=(j&(x.suspendedLanes|fe))!==0?0:j,j!==0&&j!==K.retryLane&&(K.retryLane=j,Dd(f,j),Ac(x,f,j,-1))}return Fm(),x=pv(Error(i(421))),fv(f,_,fe,x)}return j.data==="$?"?(_.flags|=128,_.child=f.child,_=Yx.bind(null,f),j._reactRetry=_,null):(f=K.treeContext,Cc=ku(j.nextSibling),Tc=_,Wi=!0,$l=null,f!==null&&(Pa[Zc++]=Nd,Pa[Zc++]=xd,Pa[Zc++]=ef,Nd=f.id,xd=f.overflow,ef=_),_=pw(_,x.children),_.flags|=4096,_)}function uA(f,_,C){f.lanes|=_;var x=f.alternate;x!==null&&(x.lanes|=_),tv(f.return,_,C)}function mv(f,_,C,x,j){var K=f.memoizedState;K===null?f.memoizedState={isBackwards:_,rendering:null,renderingStartTime:0,last:x,tail:C,tailMode:j}:(K.isBackwards=_,K.rendering=null,K.renderingStartTime=0,K.last=x,K.tail=C,K.tailMode=j)}function fw(f,_,C){var x=_.pendingProps,j=x.revealOrder,K=x.tail;if(Oa(f,_,x.children,C),x=rs.current,(x&2)!==0)x=x&1|2,_.flags|=128;else{if(f!==null&&(f.flags&128)!==0)e:for(f=_.child;f!==null;){if(f.tag===13)f.memoizedState!==null&&uA(f,C,_);else if(f.tag===19)uA(f,C,_);else if(f.child!==null){f.child.return=f,f=f.child;continue}if(f===_)break e;for(;f.sibling===null;){if(f.return===null||f.return===_)break e;f=f.return}f.sibling.return=f.return,f=f.sibling}x&=1}if(Ui(rs,x),(_.mode&1)===0)_.memoizedState=null;else switch(j){case"forwards":for(C=_.child,j=null;C!==null;)f=C.alternate,f!==null&&iv(f)===null&&(j=C),C=C.sibling;C=j,C===null?(j=_.child,_.child=null):(j=C.sibling,C.sibling=null),mv(_,!1,j,C,K);break;case"backwards":for(C=null,j=_.child,_.child=null;j!==null;){if(f=j.alternate,f!==null&&iv(f)===null){_.child=j;break}f=j.sibling,j.sibling=C,C=j,j=f}mv(_,!0,C,null,K);break;case"together":mv(_,!1,null,null,void 0);break;default:_.memoizedState=null}return _.child}function gv(f,_){(_.mode&1)===0&&f!==null&&(f.alternate=null,_.alternate=null,_.flags|=2)}function Fd(f,_,C){if(f!==null&&(_.dependencies=f.dependencies),hf|=_.lanes,(C&_.childLanes)===0)return null;if(f!==null&&_.child!==f.child)throw Error(i(153));if(_.child!==null){for(f=_.child,C=ep(f,f.pendingProps),_.child=C,C.return=_;f.sibling!==null;)f=f.sibling,C=C.sibling=ep(f,f.pendingProps),C.return=_;C.sibling=null}return _.child}function _v(f,_,C){switch(_.tag){case 3:aA(_),nf();break;case 5:zI(_);break;case 1:Ja(_.type)&&KE(_);break;case 4:Hb(_,_.stateNode.containerInfo);break;case 10:var x=_.type._context,j=_.memoizedProps.value;Ui(ZE,x._currentValue),x._currentValue=j;break;case 13:if(x=_.memoizedState,x!==null)return x.dehydrated!==null?(Ui(rs,rs.current&1),_.flags|=128,null):(C&_.child.childLanes)!==0?lA(f,_,C):(Ui(rs,rs.current&1),f=Fd(f,_,C),f!==null?f.sibling:null);Ui(rs,rs.current&1);break;case 19:if(x=(C&_.childLanes)!==0,(f.flags&128)!==0){if(x)return fw(f,_,C);_.flags|=128}if(j=_.memoizedState,j!==null&&(j.rendering=null,j.tail=null,j.lastEffect=null),Ui(rs,rs.current),x)break;return null;case 22:case 23:return _.lanes=0,Du(f,_,C)}return Fd(f,_,C)}var yv,Ev,x_,mw;yv=function(f,_){for(var C=_.child;C!==null;){if(C.tag===5||C.tag===6)f.appendChild(C.stateNode);else if(C.tag!==4&&C.child!==null){C.child.return=C,C=C.child;continue}if(C===_)break;for(;C.sibling===null;){if(C.return===null||C.return===_)return;C=C.return}C.sibling.return=C.return,C=C.sibling}},Ev=function(){},x_=function(f,_,C,x){var j=f.memoizedProps;if(j!==x){f=_.stateNode,Wh(xu.current);var K=null;switch(C){case"input":j=st(f,j),x=st(f,x),K=[];break;case"select":j=Ne({},j,{value:void 0}),x=Ne({},x,{value:void 0}),K=[];break;case"textarea":j=qe(f,j),x=qe(f,x),K=[];break;default:typeof j.onClick!="function"&&typeof x.onClick=="function"&&(f.onclick=g_)}ds(C,x);var fe;C=null;for(ut in j)if(!x.hasOwnProperty(ut)&&j.hasOwnProperty(ut)&&j[ut]!=null)if(ut==="style"){var Oe=j[ut];for(fe in Oe)Oe.hasOwnProperty(fe)&&(C||(C={}),C[fe]="")}else ut!=="dangerouslySetInnerHTML"&&ut!=="children"&&ut!=="suppressContentEditableWarning"&&ut!=="suppressHydrationWarning"&&ut!=="autoFocus"&&(l.hasOwnProperty(ut)?K||(K=[]):(K=K||[]).push(ut,null));for(ut in x){var Ve=x[ut];if(Oe=j!=null?j[ut]:void 0,x.hasOwnProperty(ut)&&Ve!==Oe&&(Ve!=null||Oe!=null))if(ut==="style")if(Oe){for(fe in Oe)!Oe.hasOwnProperty(fe)||Ve&&Ve.hasOwnProperty(fe)||(C||(C={}),C[fe]="");for(fe in Ve)Ve.hasOwnProperty(fe)&&Oe[fe]!==Ve[fe]&&(C||(C={}),C[fe]=Ve[fe])}else C||(K||(K=[]),K.push(ut,C)),C=Ve;else ut==="dangerouslySetInnerHTML"?(Ve=Ve?Ve.__html:void 0,Oe=Oe?Oe.__html:void 0,Ve!=null&&Oe!==Ve&&(K=K||[]).push(ut,Ve)):ut==="children"?typeof Ve!="string"&&typeof Ve!="number"||(K=K||[]).push(ut,""+Ve):ut!=="suppressContentEditableWarning"&&ut!=="suppressHydrationWarning"&&(l.hasOwnProperty(ut)?(Ve!=null&&ut==="onScroll"&&Mi("scroll",f),K||Oe===Ve||(K=[])):(K=K||[]).push(ut,Ve))}C&&(K=K||[]).push("style",C);var ut=K;(_.updateQueue=ut)&&(_.flags|=4)}},mw=function(f,_,C,x){C!==x&&(_.flags|=4)};function D_(f,_){if(!Wi)switch(f.tailMode){case"hidden":_=f.tail;for(var C=null;_!==null;)_.alternate!==null&&(C=_),_=_.sibling;C===null?f.tail=null:C.sibling=null;break;case"collapsed":C=f.tail;for(var x=null;C!==null;)C.alternate!==null&&(x=C),C=C.sibling;x===null?_||f.tail===null?f.tail=null:f.tail.sibling=null:x.sibling=null}}function Vo(f){var _=f.alternate!==null&&f.alternate.child===f.child,C=0,x=0;if(_)for(var j=f.child;j!==null;)C|=j.lanes|j.childLanes,x|=j.subtreeFlags&14680064,x|=j.flags&14680064,j.return=f,j=j.sibling;else for(j=f.child;j!==null;)C|=j.lanes|j.childLanes,x|=j.subtreeFlags,x|=j.flags,j.return=f,j=j.sibling;return f.subtreeFlags|=x,f.childLanes=C,_}function vv(f,_,C){var x=_.pendingProps;switch(JE(_),_.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Vo(_),null;case 1:return Ja(_.type)&&$E(),Vo(_),null;case 3:return x=_.stateNode,of(),Ii(Aa),Ii(oa),qb(),x.pendingContext&&(x.context=x.pendingContext,x.pendingContext=null),(f===null||f.child===null)&&(Pm(_)?_.flags|=4:f===null||f.memoizedState.isDehydrated&&(_.flags&256)===0||(_.flags|=1024,$l!==null&&(Aw($l),$l=null))),Ev(f,_),Vo(_),null;case 5:$b(_);var j=Wh(T_.current);if(C=_.type,f!==null&&_.stateNode!=null)x_(f,_,C,x,j),f.ref!==_.ref&&(_.flags|=512,_.flags|=2097152);else{if(!x){if(_.stateNode===null)throw Error(i(166));return Vo(_),null}if(f=Wh(xu.current),Pm(_)){x=_.stateNode,C=_.type;var K=_.memoizedProps;switch(x[Nu]=_,x[__]=K,f=(_.mode&1)!==0,C){case"dialog":Mi("cancel",x),Mi("close",x);break;case"iframe":case"object":case"embed":Mi("load",x);break;case"video":case"audio":for(j=0;j<h_.length;j++)Mi(h_[j],x);break;case"source":Mi("error",x);break;case"img":case"image":case"link":Mi("error",x),Mi("load",x);break;case"details":Mi("toggle",x);break;case"input":hn(x,K),Mi("invalid",x);break;case"select":x._wrapperState={wasMultiple:!!K.multiple},Mi("invalid",x);break;case"textarea":Ot(x,K),Mi("invalid",x)}ds(C,K),j=null;for(var fe in K)if(K.hasOwnProperty(fe)){var Oe=K[fe];fe==="children"?typeof Oe=="string"?x.textContent!==Oe&&(K.suppressHydrationWarning!==!0&&m_(x.textContent,Oe,f),j=["children",Oe]):typeof Oe=="number"&&x.textContent!==""+Oe&&(K.suppressHydrationWarning!==!0&&m_(x.textContent,Oe,f),j=["children",""+Oe]):l.hasOwnProperty(fe)&&Oe!=null&&fe==="onScroll"&&Mi("scroll",x)}switch(C){case"input":En(x),on(x,K,!0);break;case"textarea":En(x),Pt(x);break;case"select":case"option":break;default:typeof K.onClick=="function"&&(x.onclick=g_)}x=j,_.updateQueue=x,x!==null&&(_.flags|=4)}else{fe=j.nodeType===9?j:j.ownerDocument,f==="http://www.w3.org/1999/xhtml"&&(f=Ut(C)),f==="http://www.w3.org/1999/xhtml"?C==="script"?(f=fe.createElement("div"),f.innerHTML="<script><\/script>",f=f.removeChild(f.firstChild)):typeof x.is=="string"?f=fe.createElement(C,{is:x.is}):(f=fe.createElement(C),C==="select"&&(fe=f,x.multiple?fe.multiple=!0:x.size&&(fe.size=x.size))):f=fe.createElementNS(f,C),f[Nu]=_,f[__]=x,yv(f,_,!1,!1),_.stateNode=f;e:{switch(fe=Eo(C,x),C){case"dialog":Mi("cancel",f),Mi("close",f),j=x;break;case"iframe":case"object":case"embed":Mi("load",f),j=x;break;case"video":case"audio":for(j=0;j<h_.length;j++)Mi(h_[j],f);j=x;break;case"source":Mi("error",f),j=x;break;case"img":case"image":case"link":Mi("error",f),Mi("load",f),j=x;break;case"details":Mi("toggle",f),j=x;break;case"input":hn(f,x),j=st(f,x),Mi("invalid",f);break;case"option":j=x;break;case"select":f._wrapperState={wasMultiple:!!x.multiple},j=Ne({},x,{value:void 0}),Mi("invalid",f);break;case"textarea":Ot(f,x),j=qe(f,x),Mi("invalid",f);break;default:j=x}ds(C,j),Oe=j;for(K in Oe)if(Oe.hasOwnProperty(K)){var Ve=Oe[K];K==="style"?ri(f,Ve):K==="dangerouslySetInnerHTML"?(Ve=Ve?Ve.__html:void 0,Ve!=null&&wn(f,Ve)):K==="children"?typeof Ve=="string"?(C!=="textarea"||Ve!=="")&&Nt(f,Ve):typeof Ve=="number"&&Nt(f,""+Ve):K!=="suppressContentEditableWarning"&&K!=="suppressHydrationWarning"&&K!=="autoFocus"&&(l.hasOwnProperty(K)?Ve!=null&&K==="onScroll"&&Mi("scroll",f):Ve!=null&&re(f,K,Ve,fe))}switch(C){case"input":En(f),on(f,x,!1);break;case"textarea":En(f),Pt(f);break;case"option":x.value!=null&&f.setAttribute("value",""+gt(x.value));break;case"select":f.multiple=!!x.multiple,K=x.value,K!=null?De(f,!!x.multiple,K,!1):x.defaultValue!=null&&De(f,!!x.multiple,x.defaultValue,!0);break;default:typeof j.onClick=="function"&&(f.onclick=g_)}switch(C){case"button":case"input":case"select":case"textarea":x=!!x.autoFocus;break e;case"img":x=!0;break e;default:x=!1}}x&&(_.flags|=4)}_.ref!==null&&(_.flags|=512,_.flags|=2097152)}return Vo(_),null;case 6:if(f&&_.stateNode!=null)mw(f,_,f.memoizedProps,x);else{if(typeof x!="string"&&_.stateNode===null)throw Error(i(166));if(C=Wh(T_.current),Wh(xu.current),Pm(_)){if(x=_.stateNode,C=_.memoizedProps,x[Nu]=_,(K=x.nodeValue!==C)&&(f=Tc,f!==null))switch(f.tag){case 3:m_(x.nodeValue,C,(f.mode&1)!==0);break;case 5:f.memoizedProps.suppressHydrationWarning!==!0&&m_(x.nodeValue,C,(f.mode&1)!==0)}K&&(_.flags|=4)}else x=(C.nodeType===9?C:C.ownerDocument).createTextNode(x),x[Nu]=_,_.stateNode=x}return Vo(_),null;case 13:if(Ii(rs),x=_.memoizedState,f===null||f.memoizedState!==null&&f.memoizedState.dehydrated!==null){if(Wi&&Cc!==null&&(_.mode&1)!==0&&(_.flags&128)===0)Mb(),nf(),_.flags|=98560,K=!1;else if(K=Pm(_),x!==null&&x.dehydrated!==null){if(f===null){if(!K)throw Error(i(318));if(K=_.memoizedState,K=K!==null?K.dehydrated:null,!K)throw Error(i(317));K[Nu]=_}else nf(),(_.flags&128)===0&&(_.memoizedState=null),_.flags|=4;Vo(_),K=!1}else $l!==null&&(Aw($l),$l=null),K=!0;if(!K)return _.flags&65536?_:null}return(_.flags&128)!==0?(_.lanes=C,_):(x=x!==null,x!==(f!==null&&f.memoizedState!==null)&&x&&(_.child.flags|=8192,(_.mode&1)!==0&&(f===null||(rs.current&1)!==0?ro===0&&(ro=3):Fm())),_.updateQueue!==null&&(_.flags|=4),Vo(_),null);case 4:return of(),Ev(f,_),f===null&&Ad(_.stateNode.containerInfo),Vo(_),null;case 10:return Bb(_.type._context),Vo(_),null;case 17:return Ja(_.type)&&$E(),Vo(_),null;case 19:if(Ii(rs),K=_.memoizedState,K===null)return Vo(_),null;if(x=(_.flags&128)!==0,fe=K.rendering,fe===null)if(x)D_(K,!1);else{if(ro!==0||f!==null&&(f.flags&128)!==0)for(f=_.child;f!==null;){if(fe=iv(f),fe!==null){for(_.flags|=128,D_(K,!1),x=fe.updateQueue,x!==null&&(_.updateQueue=x,_.flags|=4),_.subtreeFlags=0,x=C,C=_.child;C!==null;)K=C,f=x,K.flags&=14680066,fe=K.alternate,fe===null?(K.childLanes=0,K.lanes=f,K.child=null,K.subtreeFlags=0,K.memoizedProps=null,K.memoizedState=null,K.updateQueue=null,K.dependencies=null,K.stateNode=null):(K.childLanes=fe.childLanes,K.lanes=fe.lanes,K.child=fe.child,K.subtreeFlags=0,K.deletions=null,K.memoizedProps=fe.memoizedProps,K.memoizedState=fe.memoizedState,K.updateQueue=fe.updateQueue,K.type=fe.type,f=fe.dependencies,K.dependencies=f===null?null:{lanes:f.lanes,firstContext:f.firstContext}),C=C.sibling;return Ui(rs,rs.current&1|2),_.child}f=f.sibling}K.tail!==null&&Jr()>nl&&(_.flags|=128,x=!0,D_(K,!1),_.lanes=4194304)}else{if(!x)if(f=iv(fe),f!==null){if(_.flags|=128,x=!0,C=f.updateQueue,C!==null&&(_.updateQueue=C,_.flags|=4),D_(K,!0),K.tail===null&&K.tailMode==="hidden"&&!fe.alternate&&!Wi)return Vo(_),null}else 2*Jr()-K.renderingStartTime>nl&&C!==1073741824&&(_.flags|=128,x=!0,D_(K,!1),_.lanes=4194304);K.isBackwards?(fe.sibling=_.child,_.child=fe):(C=K.last,C!==null?C.sibling=fe:_.child=fe,K.last=fe)}return K.tail!==null?(_=K.tail,K.rendering=_,K.tail=_.sibling,K.renderingStartTime=Jr(),_.sibling=null,C=rs.current,Ui(rs,x?C&1|2:C&1),_):(Vo(_),null);case 22:case 23:return B_(),x=_.memoizedState!==null,f!==null&&f.memoizedState!==null!==x&&(_.flags|=8192),x&&(_.mode&1)!==0?(Ic&1073741824)!==0&&(Vo(_),_.subtreeFlags&6&&(_.flags|=8192)):Vo(_),null;case 24:return null;case 25:return null}throw Error(i(156,_.tag))}function zx(f,_){switch(JE(_),_.tag){case 1:return Ja(_.type)&&$E(),f=_.flags,f&65536?(_.flags=f&-65537|128,_):null;case 3:return of(),Ii(Aa),Ii(oa),qb(),f=_.flags,(f&65536)!==0&&(f&128)===0?(_.flags=f&-65537|128,_):null;case 5:return $b(_),null;case 13:if(Ii(rs),f=_.memoizedState,f!==null&&f.dehydrated!==null){if(_.alternate===null)throw Error(i(340));nf()}return f=_.flags,f&65536?(_.flags=f&-65537|128,_):null;case 19:return Ii(rs),null;case 4:return of(),null;case 10:return Bb(_.type._context),null;case 22:case 23:return B_(),null;case 24:return null;default:return null}}var L_=!1,jo=!1,Wx=typeof WeakSet=="function"?WeakSet:Set,dn=null;function df(f,_){var C=f.ref;if(C!==null)if(typeof C=="function")try{C(null)}catch(x){is(f,_,x)}else C.current=null}function gw(f,_,C){try{C()}catch(x){is(f,_,x)}}var dA=!1;function Gx(f,_){if(Pb=Ce,f=Sb(),bb(f)){if("selectionStart"in f)var C={start:f.selectionStart,end:f.selectionEnd};else e:{C=(C=f.ownerDocument)&&C.defaultView||window;var x=C.getSelection&&C.getSelection();if(x&&x.rangeCount!==0){C=x.anchorNode;var j=x.anchorOffset,K=x.focusNode;x=x.focusOffset;try{C.nodeType,K.nodeType}catch{C=null;break e}var fe=0,Oe=-1,Ve=-1,ut=0,xt=0,Dt=f,kt=null;t:for(;;){for(var ln;Dt!==C||j!==0&&Dt.nodeType!==3||(Oe=fe+j),Dt!==K||x!==0&&Dt.nodeType!==3||(Ve=fe+x),Dt.nodeType===3&&(fe+=Dt.nodeValue.length),(ln=Dt.firstChild)!==null;)kt=Dt,Dt=ln;for(;;){if(Dt===f)break t;if(kt===C&&++ut===j&&(Oe=fe),kt===K&&++xt===x&&(Ve=fe),(ln=Dt.nextSibling)!==null)break;Dt=kt,kt=Dt.parentNode}Dt=ln}C=Oe===-1||Ve===-1?null:{start:Oe,end:Ve}}else C=null}C=C||{start:0,end:0}}else C=null;for(WE={focusedElem:f,selectionRange:C},Ce=!1,dn=_;dn!==null;)if(_=dn,f=_.child,(_.subtreeFlags&1028)!==0&&f!==null)f.return=_,dn=f;else for(;dn!==null;){_=dn;try{var gn=_.alternate;if((_.flags&1024)!==0)switch(_.tag){case 0:case 11:case 15:break;case 1:if(gn!==null){var yn=gn.memoizedProps,ss=gn.memoizedState,Qe=_.stateNode,Be=Qe.getSnapshotBeforeUpdate(_.elementType===_.type?yn:tl(_.type,yn),ss);Qe.__reactInternalSnapshotBeforeUpdate=Be}break;case 3:var it=_.stateNode.containerInfo;it.nodeType===1?it.textContent="":it.nodeType===9&&it.documentElement&&it.removeChild(it.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(i(163))}}catch(Vt){is(_,_.return,Vt)}if(f=_.sibling,f!==null){f.return=_.return,dn=f;break}dn=_.return}return gn=dA,dA=!1,gn}function Hh(f,_,C){var x=_.updateQueue;if(x=x!==null?x.lastEffect:null,x!==null){var j=x=x.next;do{if((j.tag&f)===f){var K=j.destroy;j.destroy=void 0,K!==void 0&&gw(_,C,K)}j=j.next}while(j!==x)}}function Sv(f,_){if(_=_.updateQueue,_=_!==null?_.lastEffect:null,_!==null){var C=_=_.next;do{if((C.tag&f)===f){var x=C.create;C.destroy=x()}C=C.next}while(C!==_)}}function _w(f){var _=f.ref;if(_!==null){var C=f.stateNode;switch(f.tag){case 5:f=C;break;default:f=C}typeof _=="function"?_(f):_.current=f}}function hA(f){var _=f.alternate;_!==null&&(f.alternate=null,hA(_)),f.child=null,f.deletions=null,f.sibling=null,f.tag===5&&(_=f.stateNode,_!==null&&(delete _[Nu],delete _[__],delete _[kb],delete _[xx],delete _[Dx])),f.stateNode=null,f.return=null,f.dependencies=null,f.memoizedProps=null,f.memoizedState=null,f.pendingProps=null,f.stateNode=null,f.updateQueue=null}function yw(f){return f.tag===5||f.tag===3||f.tag===4}function pA(f){e:for(;;){for(;f.sibling===null;){if(f.return===null||yw(f.return))return null;f=f.return}for(f.sibling.return=f.return,f=f.sibling;f.tag!==5&&f.tag!==6&&f.tag!==18;){if(f.flags&2||f.child===null||f.tag===4)continue e;f.child.return=f,f=f.child}if(!(f.flags&2))return f.stateNode}}function Ew(f,_,C){var x=f.tag;if(x===5||x===6)f=f.stateNode,_?C.nodeType===8?C.parentNode.insertBefore(f,_):C.insertBefore(f,_):(C.nodeType===8?(_=C.parentNode,_.insertBefore(f,C)):(_=C,_.appendChild(f)),C=C._reactRootContainer,C!=null||_.onclick!==null||(_.onclick=g_));else if(x!==4&&(f=f.child,f!==null))for(Ew(f,_,C),f=f.sibling;f!==null;)Ew(f,_,C),f=f.sibling}function M_(f,_,C){var x=f.tag;if(x===5||x===6)f=f.stateNode,_?C.insertBefore(f,_):C.appendChild(f);else if(x!==4&&(f=f.child,f!==null))for(M_(f,_,C),f=f.sibling;f!==null;)M_(f,_,C),f=f.sibling}var Fo=null,Rc=!1;function $h(f,_,C){for(C=C.child;C!==null;)vw(f,_,C),C=C.sibling}function vw(f,_,C){if(qn&&typeof qn.onCommitFiberUnmount=="function")try{qn.onCommitFiberUnmount(qt,C)}catch{}switch(C.tag){case 5:jo||df(C,_);case 6:var x=Fo,j=Rc;Fo=null,$h(f,_,C),Fo=x,Rc=j,Fo!==null&&(Rc?(f=Fo,C=C.stateNode,f.nodeType===8?f.parentNode.removeChild(C):f.removeChild(C)):Fo.removeChild(C.stateNode));break;case 18:Fo!==null&&(Rc?(f=Fo,C=C.stateNode,f.nodeType===8?GE(f.parentNode,C):f.nodeType===1&&GE(f,C),Ra(f)):GE(Fo,C.stateNode));break;case 4:x=Fo,j=Rc,Fo=C.stateNode.containerInfo,Rc=!0,$h(f,_,C),Fo=x,Rc=j;break;case 0:case 11:case 14:case 15:if(!jo&&(x=C.updateQueue,x!==null&&(x=x.lastEffect,x!==null))){j=x=x.next;do{var K=j,fe=K.destroy;K=K.tag,fe!==void 0&&((K&2)!==0||(K&4)!==0)&&gw(C,_,fe),j=j.next}while(j!==x)}$h(f,_,C);break;case 1:if(!jo&&(df(C,_),x=C.stateNode,typeof x.componentWillUnmount=="function"))try{x.props=C.memoizedProps,x.state=C.memoizedState,x.componentWillUnmount()}catch(Oe){is(C,_,Oe)}$h(f,_,C);break;case 21:$h(f,_,C);break;case 22:C.mode&1?(jo=(x=jo)||C.memoizedState!==null,$h(f,_,C),jo=x):$h(f,_,C);break;default:$h(f,_,C)}}function fA(f){var _=f.updateQueue;if(_!==null){f.updateQueue=null;var C=f.stateNode;C===null&&(C=f.stateNode=new Wx),_.forEach(function(x){var j=Bm.bind(null,f,x);C.has(x)||(C.add(x),x.then(j,j))})}}function Jl(f,_){var C=_.deletions;if(C!==null)for(var x=0;x<C.length;x++){var j=C[x];try{var K=f,fe=_,Oe=fe;e:for(;Oe!==null;){switch(Oe.tag){case 5:Fo=Oe.stateNode,Rc=!1;break e;case 3:Fo=Oe.stateNode.containerInfo,Rc=!0;break e;case 4:Fo=Oe.stateNode.containerInfo,Rc=!0;break e}Oe=Oe.return}if(Fo===null)throw Error(i(160));vw(K,fe,j),Fo=null,Rc=!1;var Ve=j.alternate;Ve!==null&&(Ve.return=null),j.return=null}catch(ut){is(j,_,ut)}}if(_.subtreeFlags&12854)for(_=_.child;_!==null;)Sw(_,f),_=_.sibling}function Sw(f,_){var C=f.alternate,x=f.flags;switch(f.tag){case 0:case 11:case 14:case 15:if(Jl(_,f),Lu(f),x&4){try{Hh(3,f,f.return),Sv(3,f)}catch(yn){is(f,f.return,yn)}try{Hh(5,f,f.return)}catch(yn){is(f,f.return,yn)}}break;case 1:Jl(_,f),Lu(f),x&512&&C!==null&&df(C,C.return);break;case 5:if(Jl(_,f),Lu(f),x&512&&C!==null&&df(C,C.return),f.flags&32){var j=f.stateNode;try{Nt(j,"")}catch(yn){is(f,f.return,yn)}}if(x&4&&(j=f.stateNode,j!=null)){var K=f.memoizedProps,fe=C!==null?C.memoizedProps:K,Oe=f.type,Ve=f.updateQueue;if(f.updateQueue=null,Ve!==null)try{Oe==="input"&&K.type==="radio"&&K.name!=null&&an(j,K),Eo(Oe,fe);var ut=Eo(Oe,K);for(fe=0;fe<Ve.length;fe+=2){var xt=Ve[fe],Dt=Ve[fe+1];xt==="style"?ri(j,Dt):xt==="dangerouslySetInnerHTML"?wn(j,Dt):xt==="children"?Nt(j,Dt):re(j,xt,Dt,ut)}switch(Oe){case"input":Ft(j,K);break;case"textarea":vt(j,K);break;case"select":var kt=j._wrapperState.wasMultiple;j._wrapperState.wasMultiple=!!K.multiple;var ln=K.value;ln!=null?De(j,!!K.multiple,ln,!1):kt!==!!K.multiple&&(K.defaultValue!=null?De(j,!!K.multiple,K.defaultValue,!0):De(j,!!K.multiple,K.multiple?[]:"",!1))}j[__]=K}catch(yn){is(f,f.return,yn)}}break;case 6:if(Jl(_,f),Lu(f),x&4){if(f.stateNode===null)throw Error(i(162));j=f.stateNode,K=f.memoizedProps;try{j.nodeValue=K}catch(yn){is(f,f.return,yn)}}break;case 3:if(Jl(_,f),Lu(f),x&4&&C!==null&&C.memoizedState.isDehydrated)try{Ra(_.containerInfo)}catch(yn){is(f,f.return,yn)}break;case 4:Jl(_,f),Lu(f);break;case 13:Jl(_,f),Lu(f),j=f.child,j.flags&8192&&(K=j.memoizedState!==null,j.stateNode.isHidden=K,!K||j.alternate!==null&&j.alternate.memoizedState!==null||(Cw=Jr())),x&4&&fA(f);break;case 22:if(xt=C!==null&&C.memoizedState!==null,f.mode&1?(jo=(ut=jo)||xt,Jl(_,f),jo=ut):Jl(_,f),Lu(f),x&8192){if(ut=f.memoizedState!==null,(f.stateNode.isHidden=ut)&&!xt&&(f.mode&1)!==0)for(dn=f,xt=f.child;xt!==null;){for(Dt=dn=xt;dn!==null;){switch(kt=dn,ln=kt.child,kt.tag){case 0:case 11:case 14:case 15:Hh(4,kt,kt.return);break;case 1:df(kt,kt.return);var gn=kt.stateNode;if(typeof gn.componentWillUnmount=="function"){x=kt,C=kt.return;try{_=x,gn.props=_.memoizedProps,gn.state=_.memoizedState,gn.componentWillUnmount()}catch(yn){is(x,C,yn)}}break;case 5:df(kt,kt.return);break;case 22:if(kt.memoizedState!==null){bv(Dt);continue}}ln!==null?(ln.return=kt,dn=ln):bv(Dt)}xt=xt.sibling}e:for(xt=null,Dt=f;;){if(Dt.tag===5){if(xt===null){xt=Dt;try{j=Dt.stateNode,ut?(K=j.style,typeof K.setProperty=="function"?K.setProperty("display","none","important"):K.display="none"):(Oe=Dt.stateNode,Ve=Dt.memoizedProps.style,fe=Ve!=null&&Ve.hasOwnProperty("display")?Ve.display:null,Oe.style.display=Ri("display",fe))}catch(yn){is(f,f.return,yn)}}}else if(Dt.tag===6){if(xt===null)try{Dt.stateNode.nodeValue=ut?"":Dt.memoizedProps}catch(yn){is(f,f.return,yn)}}else if((Dt.tag!==22&&Dt.tag!==23||Dt.memoizedState===null||Dt===f)&&Dt.child!==null){Dt.child.return=Dt,Dt=Dt.child;continue}if(Dt===f)break e;for(;Dt.sibling===null;){if(Dt.return===null||Dt.return===f)break e;xt===Dt&&(xt=null),Dt=Dt.return}xt===Dt&&(xt=null),Dt.sibling.return=Dt.return,Dt=Dt.sibling}}break;case 19:Jl(_,f),Lu(f),x&4&&fA(f);break;case 21:break;default:Jl(_,f),Lu(f)}}function Lu(f){var _=f.flags;if(_&2){try{e:{for(var C=f.return;C!==null;){if(yw(C)){var x=C;break e}C=C.return}throw Error(i(160))}switch(x.tag){case 5:var j=x.stateNode;x.flags&32&&(Nt(j,""),x.flags&=-33);var K=pA(f);M_(f,K,j);break;case 3:case 4:var fe=x.stateNode.containerInfo,Oe=pA(f);Ew(f,Oe,fe);break;default:throw Error(i(161))}}catch(Ve){is(f,f.return,Ve)}f.flags&=-3}_&4096&&(f.flags&=-4097)}function Hx(f,_,C){dn=f,bw(f)}function bw(f,_,C){for(var x=(f.mode&1)!==0;dn!==null;){var j=dn,K=j.child;if(j.tag===22&&x){var fe=j.memoizedState!==null||L_;if(!fe){var Oe=j.alternate,Ve=Oe!==null&&Oe.memoizedState!==null||jo;Oe=L_;var ut=jo;if(L_=fe,(jo=Ve)&&!ut)for(dn=j;dn!==null;)fe=dn,Ve=fe.child,fe.tag===22&&fe.memoizedState!==null?mA(j):Ve!==null?(Ve.return=fe,dn=Ve):mA(j);for(;K!==null;)dn=K,bw(K),K=K.sibling;dn=j,L_=Oe,jo=ut}ww(f)}else(j.subtreeFlags&8772)!==0&&K!==null?(K.return=j,dn=K):ww(f)}}function ww(f){for(;dn!==null;){var _=dn;if((_.flags&8772)!==0){var C=_.alternate;try{if((_.flags&8772)!==0)switch(_.tag){case 0:case 11:case 15:jo||Sv(5,_);break;case 1:var x=_.stateNode;if(_.flags&4&&!jo)if(C===null)x.componentDidMount();else{var j=_.elementType===_.type?C.memoizedProps:tl(_.type,C.memoizedProps);x.componentDidUpdate(j,C.memoizedState,x.__reactInternalSnapshotBeforeUpdate)}var K=_.updateQueue;K!==null&&BI(_,K,x);break;case 3:var fe=_.updateQueue;if(fe!==null){if(C=null,_.child!==null)switch(_.child.tag){case 5:C=_.child.stateNode;break;case 1:C=_.child.stateNode}BI(_,fe,C)}break;case 5:var Oe=_.stateNode;if(C===null&&_.flags&4){C=Oe;var Ve=_.memoizedProps;switch(_.type){case"button":case"input":case"select":case"textarea":Ve.autoFocus&&C.focus();break;case"img":Ve.src&&(C.src=Ve.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(_.memoizedState===null){var ut=_.alternate;if(ut!==null){var xt=ut.memoizedState;if(xt!==null){var Dt=xt.dehydrated;Dt!==null&&Ra(Dt)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(i(163))}jo||_.flags&512&&_w(_)}catch(kt){is(_,_.return,kt)}}if(_===f){dn=null;break}if(C=_.sibling,C!==null){C.return=_.return,dn=C;break}dn=_.return}}function bv(f){for(;dn!==null;){var _=dn;if(_===f){dn=null;break}var C=_.sibling;if(C!==null){C.return=_.return,dn=C;break}dn=_.return}}function mA(f){for(;dn!==null;){var _=dn;try{switch(_.tag){case 0:case 11:case 15:var C=_.return;try{Sv(4,_)}catch(Ve){is(_,C,Ve)}break;case 1:var x=_.stateNode;if(typeof x.componentDidMount=="function"){var j=_.return;try{x.componentDidMount()}catch(Ve){is(_,j,Ve)}}var K=_.return;try{_w(_)}catch(Ve){is(_,K,Ve)}break;case 5:var fe=_.return;try{_w(_)}catch(Ve){is(_,fe,Ve)}}}catch(Ve){is(_,_.return,Ve)}if(_===f){dn=null;break}var Oe=_.sibling;if(Oe!==null){Oe.return=_.return,dn=Oe;break}dn=_.return}}var $x=Math.ceil,Kh=le.ReactCurrentDispatcher,wv=le.ReactCurrentOwner,ca=le.ReactCurrentBatchConfig,Ir=0,no=null,hs=null,js=0,Ic=0,Um=Hl(0),ro=0,Vm=null,hf=0,Tv=0,Tw=0,pf=null,Ts=null,Cw=0,nl=1/0,Mu=null,la=!1,Rw=null,qh=null,U_=!1,Yh=null,V_=0,jm=0,Iw=null,j_=-1,Cv=0;function ka(){return(Ir&6)!==0?Jr():j_!==-1?j_:j_=Jr()}function Xh(f){return(f.mode&1)===0?1:(Ir&2)!==0&&js!==0?js&-js:S_.transition!==null?(Cv===0&&(Cv=Hr()),Cv):(f=yr,f!==0||(f=window.event,f=f===void 0?16:ai(f.type)),f)}function Ac(f,_,C,x){if(50<jm)throw jm=0,Iw=null,Error(i(185));wu(f,C,x),((Ir&2)===0||f!==no)&&(f===no&&((Ir&2)===0&&(Tv|=C),ro===4&&Jh(f,js)),ua(f,x),C===1&&Ir===0&&(_.mode&1)===0&&(nl=Jr()+500,qE&&Bh()))}function ua(f,_){var C=f.callbackNode;Ji(f,_);var x=Ul(f,f===no?js:0);if(x===0)C!==null&&Ll(C),f.callbackNode=null,f.callbackPriority=0;else if(_=x&-x,f.callbackPriority!==_){if(C!=null&&Ll(C),_===1)f.tag===0?Lx(Rv.bind(null,f)):Db(Rv.bind(null,f)),kx(function(){(Ir&6)===0&&Bh()}),C=null;else{switch(jl(x)){case 1:C=Vr;break;case 4:C=_c;break;case 16:C=sa;break;case 536870912:C=Je;break;default:C=sa}C=Dw(C,gA.bind(null,f))}f.callbackPriority=_,f.callbackNode=C}}function gA(f,_){if(j_=-1,Cv=0,(Ir&6)!==0)throw Error(i(327));var C=f.callbackNode;if(Zh()&&f.callbackNode!==C)return null;var x=Ul(f,f===no?js:0);if(x===0)return null;if((x&30)!==0||(x&f.expiredLanes)!==0||_)_=z_(f,x);else{_=x;var j=Ir;Ir|=2;var K=Ow();(no!==f||js!==_)&&(Mu=null,nl=Jr()+500,Bd(f,_));do try{qx();break}catch(Oe){Pw(f,Oe)}while(!0);Fb(),Kh.current=K,Ir=j,hs!==null?_=0:(no=null,js=0,_=ro)}if(_!==0){if(_===2&&(j=di(f),j!==0&&(x=j,_=F_(f,j))),_===1)throw C=Vm,Bd(f,0),Jh(f,x),ua(f,Jr()),C;if(_===6)Jh(f,x);else{if(j=f.current.alternate,(x&30)===0&&!_A(j)&&(_=z_(f,x),_===2&&(K=di(f),K!==0&&(x=K,_=F_(f,K))),_===1))throw C=Vm,Bd(f,0),Jh(f,x),ua(f,Jr()),C;switch(f.finishedWork=j,f.finishedLanes=x,_){case 0:case 1:throw Error(i(345));case 2:rl(f,Ts,Mu);break;case 3:if(Jh(f,x),(x&130023424)===x&&(_=Cw+500-Jr(),10<_)){if(Ul(f,0)!==0)break;if(j=f.suspendedLanes,(j&x)!==x){ka(),f.pingedLanes|=f.suspendedLanes&j;break}f.timeoutHandle=Ob(rl.bind(null,f,Ts,Mu),_);break}rl(f,Ts,Mu);break;case 4:if(Jh(f,x),(x&4194240)===x)break;for(_=f.eventTimes,j=-1;0<x;){var fe=31-Ss(x);K=1<<fe,fe=_[fe],fe>j&&(j=fe),x&=~K}if(x=j,x=Jr()-x,x=(120>x?120:480>x?480:1080>x?1080:1920>x?1920:3e3>x?3e3:4320>x?4320:1960*$x(x/1960))-x,10<x){f.timeoutHandle=Ob(rl.bind(null,f,Ts,Mu),x);break}rl(f,Ts,Mu);break;case 5:rl(f,Ts,Mu);break;default:throw Error(i(329))}}}return ua(f,Jr()),f.callbackNode===C?gA.bind(null,f):null}function F_(f,_){var C=pf;return f.current.memoizedState.isDehydrated&&(Bd(f,_).flags|=256),f=z_(f,_),f!==2&&(_=Ts,Ts=C,_!==null&&Aw(_)),f}function Aw(f){Ts===null?Ts=f:Ts.push.apply(Ts,f)}function _A(f){for(var _=f;;){if(_.flags&16384){var C=_.updateQueue;if(C!==null&&(C=C.stores,C!==null))for(var x=0;x<C.length;x++){var j=C[x],K=j.getSnapshot;j=j.value;try{if(!Wl(K(),j))return!1}catch{return!1}}}if(C=_.child,_.subtreeFlags&16384&&C!==null)C.return=_,_=C;else{if(_===f)break;for(;_.sibling===null;){if(_.return===null||_.return===f)return!0;_=_.return}_.sibling.return=_.return,_=_.sibling}}return!0}function Jh(f,_){for(_&=~Tw,_&=~Tv,f.suspendedLanes|=_,f.pingedLanes&=~_,f=f.expirationTimes;0<_;){var C=31-Ss(_),x=1<<C;f[C]=-1,_&=~x}}function Rv(f){if((Ir&6)!==0)throw Error(i(327));Zh();var _=Ul(f,0);if((_&1)===0)return ua(f,Jr()),null;var C=z_(f,_);if(f.tag!==0&&C===2){var x=di(f);x!==0&&(_=x,C=F_(f,x))}if(C===1)throw C=Vm,Bd(f,0),Jh(f,_),ua(f,Jr()),C;if(C===6)throw Error(i(345));return f.finishedWork=f.current.alternate,f.finishedLanes=_,rl(f,Ts,Mu),ua(f,Jr()),null}function ff(f,_){var C=Ir;Ir|=1;try{return f(_)}finally{Ir=C,Ir===0&&(nl=Jr()+500,qE&&Bh())}}function Qh(f){Yh!==null&&Yh.tag===0&&(Ir&6)===0&&Zh();var _=Ir;Ir|=1;var C=ca.transition,x=yr;try{if(ca.transition=null,yr=1,f)return f()}finally{yr=x,ca.transition=C,Ir=_,(Ir&6)===0&&Bh()}}function B_(){Ic=Um.current,Ii(Um)}function Bd(f,_){f.finishedWork=null,f.finishedLanes=0;var C=f.timeoutHandle;if(C!==-1&&(f.timeoutHandle=-1,Ox(C)),hs!==null)for(C=hs.return;C!==null;){var x=C;switch(JE(x),x.tag){case 1:x=x.type.childContextTypes,x!=null&&$E();break;case 3:of(),Ii(Aa),Ii(oa),qb();break;case 5:$b(x);break;case 4:of();break;case 13:Ii(rs);break;case 19:Ii(rs);break;case 10:Bb(x.type._context);break;case 22:case 23:B_()}C=C.return}if(no=f,hs=f=ep(f.current,null),js=Ic=_,ro=0,Vm=null,Tw=Tv=hf=0,Ts=pf=null,rf!==null){for(_=0;_<rf.length;_++)if(C=rf[_],x=C.interleaved,x!==null){C.interleaved=null;var j=x.next,K=C.pending;if(K!==null){var fe=K.next;K.next=j,x.next=fe}C.pending=x}rf=null}return f}function Pw(f,_){do{var C=hs;try{if(Fb(),C_.current=Lm,R_){for(var x=Qi.memoizedState;x!==null;){var j=x.queue;j!==null&&(j.pending=null),x=x.next}R_=!1}if(af=0,ws=to=Qi=null,Ud=!1,I_=0,wv.current=null,C===null||C.return===null){ro=1,Vm=_,hs=null;break}e:{var K=f,fe=C.return,Oe=C,Ve=_;if(_=js,Oe.flags|=32768,Ve!==null&&typeof Ve=="object"&&typeof Ve.then=="function"){var ut=Ve,xt=Oe,Dt=xt.tag;if((xt.mode&1)===0&&(Dt===0||Dt===11||Dt===15)){var kt=xt.alternate;kt?(xt.updateQueue=kt.updateQueue,xt.memoizedState=kt.memoizedState,xt.lanes=kt.lanes):(xt.updateQueue=null,xt.memoizedState=null)}var ln=tA(fe);if(ln!==null){ln.flags&=-257,nA(ln,fe,Oe,K,_),ln.mode&1&&cw(K,ut,_),_=ln,Ve=ut;var gn=_.updateQueue;if(gn===null){var yn=new Set;yn.add(Ve),_.updateQueue=yn}else gn.add(Ve);break e}else{if((_&1)===0){cw(K,ut,_),Fm();break e}Ve=Error(i(426))}}else if(Wi&&Oe.mode&1){var ss=tA(fe);if(ss!==null){(ss.flags&65536)===0&&(ss.flags|=256),nA(ss,fe,Oe,K,_),Om(Mm(Ve,Oe));break e}}K=Ve=Mm(Ve,Oe),ro!==4&&(ro=2),pf===null?pf=[K]:pf.push(K),K=fe;do{switch(K.tag){case 3:K.flags|=65536,_&=-_,K.lanes|=_;var Qe=aw(K,Ve,_);FI(K,Qe);break e;case 1:Oe=Ve;var Be=K.type,it=K.stateNode;if((K.flags&128)===0&&(typeof Be.getDerivedStateFromError=="function"||it!==null&&typeof it.componentDidCatch=="function"&&(qh===null||!qh.has(it)))){K.flags|=65536,_&=-_,K.lanes|=_;var Vt=eA(K,Oe,_);FI(K,Vt);break e}}K=K.return}while(K!==null)}Nw(C)}catch(vn){_=vn,hs===C&&C!==null&&(hs=C=C.return);continue}break}while(!0)}function Ow(){var f=Kh.current;return Kh.current=Lm,f===null?Lm:f}function Fm(){(ro===0||ro===3||ro===2)&&(ro=4),no===null||(hf&268435455)===0&&(Tv&268435455)===0||Jh(no,js)}function z_(f,_){var C=Ir;Ir|=2;var x=Ow();(no!==f||js!==_)&&(Mu=null,Bd(f,_));do try{Kx();break}catch(j){Pw(f,j)}while(!0);if(Fb(),Ir=C,Kh.current=x,hs!==null)throw Error(i(261));return no=null,js=0,ro}function Kx(){for(;hs!==null;)kw(hs)}function qx(){for(;hs!==null&&!Ph();)kw(hs)}function kw(f){var _=vA(f.alternate,f,Ic);f.memoizedProps=f.pendingProps,_===null?Nw(f):hs=_,wv.current=null}function Nw(f){var _=f;do{var C=_.alternate;if(f=_.return,(_.flags&32768)===0){if(C=vv(C,_,Ic),C!==null){hs=C;return}}else{if(C=zx(C,_),C!==null){C.flags&=32767,hs=C;return}if(f!==null)f.flags|=32768,f.subtreeFlags=0,f.deletions=null;else{ro=6,hs=null;return}}if(_=_.sibling,_!==null){hs=_;return}hs=_=f}while(_!==null);ro===0&&(ro=5)}function rl(f,_,C){var x=yr,j=ca.transition;try{ca.transition=null,yr=1,xw(f,_,C,x)}finally{ca.transition=j,yr=x}return null}function xw(f,_,C,x){do Zh();while(Yh!==null);if((Ir&6)!==0)throw Error(i(327));C=f.finishedWork;var j=f.finishedLanes;if(C===null)return null;if(f.finishedWork=null,f.finishedLanes=0,C===f.current)throw Error(i(177));f.callbackNode=null,f.callbackPriority=0;var K=C.lanes|C.childLanes;if(hi(f,K),f===no&&(hs=no=null,js=0),(C.subtreeFlags&2064)===0&&(C.flags&2064)===0||U_||(U_=!0,Dw(sa,function(){return Zh(),null})),K=(C.flags&15990)!==0,(C.subtreeFlags&15990)!==0||K){K=ca.transition,ca.transition=null;var fe=yr;yr=1;var Oe=Ir;Ir|=4,wv.current=null,Gx(f,C),Sw(C,f),Cx(WE),Ce=!!Pb,WE=Pb=null,f.current=C,Hx(C),Qs(),Ir=Oe,yr=fe,ca.transition=K}else f.current=C;if(U_&&(U_=!1,Yh=f,V_=j),K=f.pendingLanes,K===0&&(qh=null),Xi(C.stateNode),ua(f,Jr()),_!==null)for(x=f.onRecoverableError,C=0;C<_.length;C++)j=_[C],x(j.value,{componentStack:j.stack,digest:j.digest});if(la)throw la=!1,f=Rw,Rw=null,f;return(V_&1)!==0&&f.tag!==0&&Zh(),K=f.pendingLanes,(K&1)!==0?f===Iw?jm++:(jm=0,Iw=f):jm=0,Bh(),null}function Zh(){if(Yh!==null){var f=jl(V_),_=ca.transition,C=yr;try{if(ca.transition=null,yr=16>f?16:f,Yh===null)var x=!1;else{if(f=Yh,Yh=null,V_=0,(Ir&6)!==0)throw Error(i(331));var j=Ir;for(Ir|=4,dn=f.current;dn!==null;){var K=dn,fe=K.child;if((dn.flags&16)!==0){var Oe=K.deletions;if(Oe!==null){for(var Ve=0;Ve<Oe.length;Ve++){var ut=Oe[Ve];for(dn=ut;dn!==null;){var xt=dn;switch(xt.tag){case 0:case 11:case 15:Hh(8,xt,K)}var Dt=xt.child;if(Dt!==null)Dt.return=xt,dn=Dt;else for(;dn!==null;){xt=dn;var kt=xt.sibling,ln=xt.return;if(hA(xt),xt===ut){dn=null;break}if(kt!==null){kt.return=ln,dn=kt;break}dn=ln}}}var gn=K.alternate;if(gn!==null){var yn=gn.child;if(yn!==null){gn.child=null;do{var ss=yn.sibling;yn.sibling=null,yn=ss}while(yn!==null)}}dn=K}}if((K.subtreeFlags&2064)!==0&&fe!==null)fe.return=K,dn=fe;else e:for(;dn!==null;){if(K=dn,(K.flags&2048)!==0)switch(K.tag){case 0:case 11:case 15:Hh(9,K,K.return)}var Qe=K.sibling;if(Qe!==null){Qe.return=K.return,dn=Qe;break e}dn=K.return}}var Be=f.current;for(dn=Be;dn!==null;){fe=dn;var it=fe.child;if((fe.subtreeFlags&2064)!==0&&it!==null)it.return=fe,dn=it;else e:for(fe=Be;dn!==null;){if(Oe=dn,(Oe.flags&2048)!==0)try{switch(Oe.tag){case 0:case 11:case 15:Sv(9,Oe)}}catch(vn){is(Oe,Oe.return,vn)}if(Oe===fe){dn=null;break e}var Vt=Oe.sibling;if(Vt!==null){Vt.return=Oe.return,dn=Vt;break e}dn=Oe.return}}if(Ir=j,Bh(),qn&&typeof qn.onPostCommitFiberRoot=="function")try{qn.onPostCommitFiberRoot(qt,f)}catch{}x=!0}return x}finally{yr=C,ca.transition=_}}return!1}function Iv(f,_,C){_=Mm(C,_),_=aw(f,_,1),f=ql(f,_,1),_=ka(),f!==null&&(wu(f,1,_),ua(f,_))}function is(f,_,C){if(f.tag===3)Iv(f,f,C);else for(;_!==null;){if(_.tag===3){Iv(_,f,C);break}else if(_.tag===1){var x=_.stateNode;if(typeof _.type.getDerivedStateFromError=="function"||typeof x.componentDidCatch=="function"&&(qh===null||!qh.has(x))){f=Mm(C,f),f=eA(_,f,1),_=ql(_,f,1),f=ka(),_!==null&&(wu(_,1,f),ua(_,f));break}}_=_.return}}function yA(f,_,C){var x=f.pingCache;x!==null&&x.delete(_),_=ka(),f.pingedLanes|=f.suspendedLanes&C,no===f&&(js&C)===C&&(ro===4||ro===3&&(js&130023424)===js&&500>Jr()-Cw?Bd(f,0):Tw|=C),ua(f,_)}function EA(f,_){_===0&&((f.mode&1)===0?_=1:(_=Ml,Ml<<=1,(Ml&130023424)===0&&(Ml=4194304)));var C=ka();f=Dd(f,_),f!==null&&(wu(f,_,C),ua(f,C))}function Yx(f){var _=f.memoizedState,C=0;_!==null&&(C=_.retryLane),EA(f,C)}function Bm(f,_){var C=0;switch(f.tag){case 13:var x=f.stateNode,j=f.memoizedState;j!==null&&(C=j.retryLane);break;case 19:x=f.stateNode;break;default:throw Error(i(314))}x!==null&&x.delete(_),EA(f,C)}var vA;vA=function(f,_,C){if(f!==null)if(f.memoizedProps!==_.pendingProps||Aa.current)Za=!0;else{if((f.lanes&C)===0&&(_.flags&128)===0)return Za=!1,_v(f,_,C);Za=(f.flags&131072)!==0}else Za=!1,Wi&&(_.flags&1048576)!==0&&LI(_,XE,_.index);switch(_.lanes=0,_.tag){case 2:var x=_.type;gv(f,_),f=_.pendingProps;var j=Fh(_,oa.current);Kl(_,C),j=xm(null,_,x,f,j,C);var K=Jb();return _.flags|=1,typeof j=="object"&&j!==null&&typeof j.render=="function"&&j.$$typeof===void 0?(_.tag=1,_.memoizedState=null,_.updateQueue=null,Ja(x)?(K=!0,KE(_)):K=!1,_.memoizedState=j.state!==null&&j.state!==void 0?j.state:null,Gb(_),j.updater=hv,_.stateNode=j,j._reactInternals=_,iw(_,x,f,C),_=dw(null,_,x,!0,K,C)):(_.tag=0,Wi&&K&&Am(_),Oa(null,_,j,C),_=_.child),_;case 16:x=_.elementType;e:{switch(gv(f,_),f=_.pendingProps,j=x._init,x=j(x._payload),_.type=x,j=_.tag=Xx(x),f=tl(x,f),j){case 0:_=uw(null,_,x,f,C);break e;case 1:_=oA(null,_,x,f,C);break e;case 11:_=rA(null,_,x,f,C);break e;case 14:_=iA(null,_,x,tl(x.type,f),C);break e}throw Error(i(306,x,""))}return _;case 0:return x=_.type,j=_.pendingProps,j=_.elementType===x?j:tl(x,j),uw(f,_,x,j,C);case 1:return x=_.type,j=_.pendingProps,j=_.elementType===x?j:tl(x,j),oA(f,_,x,j,C);case 3:e:{if(aA(_),f===null)throw Error(i(387));x=_.pendingProps,K=_.memoizedState,j=K.element,jI(f,_),rv(_,x,null,C);var fe=_.memoizedState;if(x=fe.element,K.isDehydrated)if(K={element:x,isDehydrated:!1,cache:fe.cache,pendingSuspenseBoundaries:fe.pendingSuspenseBoundaries,transitions:fe.transitions},_.updateQueue.baseState=K,_.memoizedState=K,_.flags&256){j=Mm(Error(i(423)),_),_=cA(f,_,x,C,j);break e}else if(x!==j){j=Mm(Error(i(424)),_),_=cA(f,_,x,C,j);break e}else for(Cc=ku(_.stateNode.containerInfo.firstChild),Tc=_,Wi=!0,$l=null,C=Vb(_,null,x,C),_.child=C;C;)C.flags=C.flags&-3|4096,C=C.sibling;else{if(nf(),x===j){_=Fd(f,_,C);break e}Oa(f,_,x,C)}_=_.child}return _;case 5:return zI(_),f===null&&v_(_),x=_.type,j=_.pendingProps,K=f!==null?f.memoizedProps:null,fe=j.children,Tm(x,j)?fe=null:K!==null&&Tm(x,K)&&(_.flags|=32),sA(f,_),Oa(f,_,fe,C),_.child;case 6:return f===null&&v_(_),null;case 13:return lA(f,_,C);case 4:return Hb(_,_.stateNode.containerInfo),x=_.pendingProps,f===null?_.child=km(_,null,x,C):Oa(f,_,x,C),_.child;case 11:return x=_.type,j=_.pendingProps,j=_.elementType===x?j:tl(x,j),rA(f,_,x,j,C);case 7:return Oa(f,_,_.pendingProps,C),_.child;case 8:return Oa(f,_,_.pendingProps.children,C),_.child;case 12:return Oa(f,_,_.pendingProps.children,C),_.child;case 10:e:{if(x=_.type._context,j=_.pendingProps,K=_.memoizedProps,fe=j.value,Ui(ZE,x._currentValue),x._currentValue=fe,K!==null)if(Wl(K.value,fe)){if(K.children===j.children&&!Aa.current){_=Fd(f,_,C);break e}}else for(K=_.child,K!==null&&(K.return=_);K!==null;){var Oe=K.dependencies;if(Oe!==null){fe=K.child;for(var Ve=Oe.firstContext;Ve!==null;){if(Ve.context===x){if(K.tag===1){Ve=Md(-1,C&-C),Ve.tag=2;var ut=K.updateQueue;if(ut!==null){ut=ut.shared;var xt=ut.pending;xt===null?Ve.next=Ve:(Ve.next=xt.next,xt.next=Ve),ut.pending=Ve}}K.lanes|=C,Ve=K.alternate,Ve!==null&&(Ve.lanes|=C),tv(K.return,C,_),Oe.lanes|=C;break}Ve=Ve.next}}else if(K.tag===10)fe=K.type===_.type?null:K.child;else if(K.tag===18){if(fe=K.return,fe===null)throw Error(i(341));fe.lanes|=C,Oe=fe.alternate,Oe!==null&&(Oe.lanes|=C),tv(fe,C,_),fe=K.sibling}else fe=K.child;if(fe!==null)fe.return=K;else for(fe=K;fe!==null;){if(fe===_){fe=null;break}if(K=fe.sibling,K!==null){K.return=fe.return,fe=K;break}fe=fe.return}K=fe}Oa(f,_,j.children,C),_=_.child}return _;case 9:return j=_.type,x=_.pendingProps.children,Kl(_,C),j=el(j),x=x(j),_.flags|=1,Oa(f,_,x,C),_.child;case 14:return x=_.type,j=tl(x,_.pendingProps),j=tl(x.type,j),iA(f,_,x,j,C);case 15:return lw(f,_,_.type,_.pendingProps,C);case 17:return x=_.type,j=_.pendingProps,j=_.elementType===x?j:tl(x,j),gv(f,_),_.tag=1,Ja(x)?(f=!0,KE(_)):f=!1,Kl(_,C),QI(_,x,j),iw(_,x,j,C),dw(null,_,x,!0,f,C);case 19:return fw(f,_,C);case 22:return Du(f,_,C)}throw Error(i(156,_.tag))};function Dw(f,_){return Sa(f,_)}function Lw(f,_,C,x){this.tag=f,this.key=C,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=_,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=x,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function il(f,_,C,x){return new Lw(f,_,C,x)}function Mw(f){return f=f.prototype,!(!f||!f.isReactComponent)}function Xx(f){if(typeof f=="function")return Mw(f)?1:0;if(f!=null){if(f=f.$$typeof,f===de)return 11;if(f===Ie)return 14}return 2}function ep(f,_){var C=f.alternate;return C===null?(C=il(f.tag,_,f.key,f.mode),C.elementType=f.elementType,C.type=f.type,C.stateNode=f.stateNode,C.alternate=f,f.alternate=C):(C.pendingProps=_,C.type=f.type,C.flags=0,C.subtreeFlags=0,C.deletions=null),C.flags=f.flags&14680064,C.childLanes=f.childLanes,C.lanes=f.lanes,C.child=f.child,C.memoizedProps=f.memoizedProps,C.memoizedState=f.memoizedState,C.updateQueue=f.updateQueue,_=f.dependencies,C.dependencies=_===null?null:{lanes:_.lanes,firstContext:_.firstContext},C.sibling=f.sibling,C.index=f.index,C.ref=f.ref,C}function zm(f,_,C,x,j,K){var fe=2;if(x=f,typeof f=="function")Mw(f)&&(fe=1);else if(typeof f=="string")fe=5;else e:switch(f){case q:return tp(C.children,j,K,_);case J:fe=8,j|=8;break;case Q:return f=il(12,C,_,j|2),f.elementType=Q,f.lanes=K,f;case pe:return f=il(13,C,_,j),f.elementType=pe,f.lanes=K,f;case Se:return f=il(19,C,_,j),f.elementType=Se,f.lanes=K,f;case we:return W_(C,j,K,_);default:if(typeof f=="object"&&f!==null)switch(f.$$typeof){case ne:fe=10;break e;case he:fe=9;break e;case de:fe=11;break e;case Ie:fe=14;break e;case Fe:fe=16,x=null;break e}throw Error(i(130,f==null?f:typeof f,""))}return _=il(fe,C,_,j),_.elementType=f,_.type=x,_.lanes=K,_}function tp(f,_,C,x){return f=il(7,f,x,_),f.lanes=C,f}function W_(f,_,C,x){return f=il(22,f,x,_),f.elementType=we,f.lanes=C,f.stateNode={isHidden:!1},f}function Av(f,_,C){return f=il(6,f,null,_),f.lanes=C,f}function Wm(f,_,C){return _=il(4,f.children!==null?f.children:[],f.key,_),_.lanes=C,_.stateNode={containerInfo:f.containerInfo,pendingChildren:null,implementation:f.implementation},_}function Uw(f,_,C,x,j){this.tag=_,this.containerInfo=f,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=Vl(0),this.expirationTimes=Vl(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=Vl(0),this.identifierPrefix=x,this.onRecoverableError=j,this.mutableSourceEagerHydrationData=null}function Gm(f,_,C,x,j,K,fe,Oe,Ve){return f=new Uw(f,_,C,Oe,Ve),_===1?(_=1,K===!0&&(_|=8)):_=0,K=il(3,null,null,_),f.current=K,K.stateNode=f,K.memoizedState={element:x,isDehydrated:C,cache:null,transitions:null,pendingSuspenseBoundaries:null},Gb(K),f}function Pv(f,_,C){var x=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:me,key:x==null?null:""+x,children:f,containerInfo:_,implementation:C}}function Vw(f){if(!f)return Vh;f=f._reactInternals;e:{if(Ls(f)!==f||f.tag!==1)throw Error(i(170));var _=f;do{switch(_.tag){case 3:_=_.stateNode.context;break e;case 1:if(Ja(_.type)){_=_.stateNode.__reactInternalMemoizedMergedChildContext;break e}}_=_.return}while(_!==null);throw Error(i(171))}if(f.tag===1){var C=f.type;if(Ja(C))return xI(f,C,_)}return _}function mf(f,_,C,x,j,K,fe,Oe,Ve){return f=Gm(C,x,!0,f,j,K,fe,Oe,Ve),f.context=Vw(null),C=f.current,x=ka(),j=Xh(C),K=Md(x,j),K.callback=_??null,ql(C,K,j),f.current.lanes=j,wu(f,j,x),ua(f,x),f}function Uu(f,_,C,x){var j=_.current,K=ka(),fe=Xh(j);return C=Vw(C),_.context===null?_.context=C:_.pendingContext=C,_=Md(K,fe),_.payload={element:f},x=x===void 0?null:x,x!==null&&(_.callback=x),f=ql(j,_,fe),f!==null&&(Ac(f,j,fe,K),nv(f,j,fe)),fe}function Ov(f){if(f=f.current,!f.child)return null;switch(f.child.tag){case 5:return f.child.stateNode;default:return f.child.stateNode}}function Hm(f,_){if(f=f.memoizedState,f!==null&&f.dehydrated!==null){var C=f.retryLane;f.retryLane=C!==0&&C<_?C:_}}function jw(f,_){Hm(f,_),(f=f.alternate)&&Hm(f,_)}function Jx(){return null}var SA=typeof reportError=="function"?reportError:function(f){console.error(f)};function Fw(f){this._internalRoot=f}G_.prototype.render=Fw.prototype.render=function(f){var _=this._internalRoot;if(_===null)throw Error(i(409));Uu(f,_,null,null)},G_.prototype.unmount=Fw.prototype.unmount=function(){var f=this._internalRoot;if(f!==null){this._internalRoot=null;var _=f.containerInfo;Qh(function(){Uu(null,f,null,null)}),_[Pd]=null}};function G_(f){this._internalRoot=f}G_.prototype.unstable_scheduleHydration=function(f){if(f){var _=dm();f={blockedOn:null,target:f,priority:_};for(var C=0;C<$a.length&&_!==0&&_<$a[C].priority;C++);$a.splice(C,0,f),C===0&&Fl(f)}};function H_(f){return!(!f||f.nodeType!==1&&f.nodeType!==9&&f.nodeType!==11)}function $_(f){return!(!f||f.nodeType!==1&&f.nodeType!==9&&f.nodeType!==11&&(f.nodeType!==8||f.nodeValue!==" react-mount-point-unstable "))}function bA(){}function wA(f,_,C,x,j){if(j){if(typeof x=="function"){var K=x;x=function(){var ut=Ov(fe);K.call(ut)}}var fe=mf(_,x,f,0,null,!1,!1,"",bA);return f._reactRootContainer=fe,f[Pd]=fe.current,Ad(f.nodeType===8?f.parentNode:f),Qh(),fe}for(;j=f.lastChild;)f.removeChild(j);if(typeof x=="function"){var Oe=x;x=function(){var ut=Ov(Ve);Oe.call(ut)}}var Ve=Gm(f,0,!1,null,null,!1,!1,"",bA);return f._reactRootContainer=Ve,f[Pd]=Ve.current,Ad(f.nodeType===8?f.parentNode:f),Qh(function(){Uu(_,Ve,C,x)}),Ve}function kv(f,_,C,x,j){var K=C._reactRootContainer;if(K){var fe=K;if(typeof j=="function"){var Oe=j;j=function(){var Ve=Ov(fe);Oe.call(Ve)}}Uu(_,fe,f,j)}else fe=wA(C,_,f,j,x);return Ov(fe)}Nh=function(f){switch(f.tag){case 3:var _=f.stateNode;if(_.current.memoizedState.isDehydrated){var C=Rr(_.pendingLanes);C!==0&&(Tu(_,C|1),ua(_,Jr()),(Ir&6)===0&&(nl=Jr()+500,Bh()))}break;case 13:Qh(function(){var x=Dd(f,1);if(x!==null){var j=ka();Ac(x,f,1,j)}}),jw(f,1)}},xh=function(f){if(f.tag===13){var _=Dd(f,134217728);if(_!==null){var C=ka();Ac(_,f,134217728,C)}jw(f,134217728)}},Cu=function(f){if(f.tag===13){var _=Xh(f),C=Dd(f,_);if(C!==null){var x=ka();Ac(C,f,_,x)}jw(f,_)}},dm=function(){return yr},Xp=function(f,_){var C=yr;try{return yr=f,_()}finally{yr=C}},Wc=function(f,_,C){switch(_){case"input":if(Ft(f,C),_=C.name,C.type==="radio"&&_!=null){for(C=f;C.parentNode;)C=C.parentNode;for(C=C.querySelectorAll("input[name="+JSON.stringify(""+_)+'][type="radio"]'),_=0;_<C.length;_++){var x=C[_];if(x!==f&&x.form===f.form){var j=HE(x);if(!j)throw Error(i(90));Gt(x),Ft(x,j)}}}break;case"textarea":vt(f,C);break;case"select":_=C.value,_!=null&&De(f,!!C.multiple,_,!1)}},So=ff,bu=Qh;var K_={usingClientEntryPoint:!1,Events:[y_,Cm,HE,ns,Gc,ff]},ec={findFiberByHostInstance:Zp,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},TA={bundleType:ec.bundleType,version:ec.version,rendererPackageName:ec.rendererPackageName,rendererConfig:ec.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:le.ReactCurrentDispatcher,findHostInstanceByFiber:function(f){return f=xl(f),f===null?null:f.stateNode},findFiberByHostInstance:ec.findFiberByHostInstance||Jx,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var Nv=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!Nv.isDisabled&&Nv.supportsFiber)try{qt=Nv.inject(TA),qn=Nv}catch{}}return yl.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=K_,yl.createPortal=function(f,_){var C=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!H_(_))throw Error(i(200));return Pv(f,_,null,C)},yl.createRoot=function(f,_){if(!H_(f))throw Error(i(299));var C=!1,x="",j=SA;return _!=null&&(_.unstable_strictMode===!0&&(C=!0),_.identifierPrefix!==void 0&&(x=_.identifierPrefix),_.onRecoverableError!==void 0&&(j=_.onRecoverableError)),_=Gm(f,1,!1,null,null,C,!1,x,j),f[Pd]=_.current,Ad(f.nodeType===8?f.parentNode:f),new Fw(_)},yl.findDOMNode=function(f){if(f==null)return null;if(f.nodeType===1)return f;var _=f._reactInternals;if(_===void 0)throw typeof f.render=="function"?Error(i(188)):(f=Object.keys(f).join(","),Error(i(268,f)));return f=xl(_),f=f===null?null:f.stateNode,f},yl.flushSync=function(f){return Qh(f)},yl.hydrate=function(f,_,C){if(!$_(_))throw Error(i(200));return kv(null,f,_,!0,C)},yl.hydrateRoot=function(f,_,C){if(!H_(f))throw Error(i(405));var x=C!=null&&C.hydratedSources||null,j=!1,K="",fe=SA;if(C!=null&&(C.unstable_strictMode===!0&&(j=!0),C.identifierPrefix!==void 0&&(K=C.identifierPrefix),C.onRecoverableError!==void 0&&(fe=C.onRecoverableError)),_=mf(_,null,f,1,C??null,j,!1,K,fe),f[Pd]=_.current,Ad(f),x)for(f=0;f<x.length;f++)C=x[f],j=C._getVersion,j=j(C._source),_.mutableSourceEagerHydrationData==null?_.mutableSourceEagerHydrationData=[C,j]:_.mutableSourceEagerHydrationData.push(C,j);return new G_(_)},yl.render=function(f,_,C){if(!$_(_))throw Error(i(200));return kv(null,f,_,!1,C)},yl.unmountComponentAtNode=function(f){if(!$_(f))throw Error(i(40));return f._reactRootContainer?(Qh(function(){kv(null,null,f,!1,function(){f._reactRootContainer=null,f[Pd]=null})}),!0):!1},yl.unstable_batchedUpdates=ff,yl.unstable_renderSubtreeIntoContainer=function(f,_,C,x){if(!$_(C))throw Error(i(200));if(f==null||f._reactInternals===void 0)throw Error(i(38));return kv(f,_,C,!1,x)},yl.version="18.3.1-next-f1338f8080-20240426",yl}var mq;function aee(){if(mq)return ZM.exports;mq=1;function n(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(n)}catch(e){console.error(e)}}return n(),ZM.exports=eve(),ZM.exports}var gq;function tve(){if(gq)return YP;gq=1;var n=aee();return YP.createRoot=n.createRoot,YP.hydrateRoot=n.hydrateRoot,YP}var nve=tve();const rve=Jg(nve);function ive(n,e,i,o){return n.addEventListener(e,i,o),()=>{n.removeEventListener(e,i,o)}}function tN(n){return n!=null&&typeof n=="object"&&"nodeType"in n&&n.nodeType===Node.ELEMENT_NODE}function sve(){return!!(globalThis!=null&&globalThis.document)}function cee(n){return n.parentElement&&cee(n.parentElement)?!0:n.hidden}function ove(n){const e=n.getAttribute("contenteditable");return e!=="false"&&e!=null}function ave(n){return!!n.getAttribute("disabled")||!!n.getAttribute("aria-disabled")}function cve(n){var e;return((e=lee(n))==null?void 0:e.defaultView)??window}function lee(n){return tN(n)?n.ownerDocument:document}function lve(n){return n.view??window}function uve(n){return lee(n).activeElement}function dve(n){const e=lve(n);return typeof e.PointerEvent<"u"&&n instanceof e.PointerEvent?n.pointerType==="mouse":n instanceof e.MouseEvent}function uee(n){return!!n.touches}function hve(n){return uee(n)&&n.touches.length>1}function pve(n,e="page"){const i=n.touches[0]||n.changedTouches[0];return{x:i[`${e}X`],y:i[`${e}Y`]}}function fve(n,e="page"){return{x:n[`${e}X`],y:n[`${e}Y`]}}function dee(n,e="page"){return uee(n)?pve(n,e):fve(n,e)}function mve(n){return e=>{const i=dve(e);(!i||i&&e.button===0)&&n(e)}}function gve(n,e=!1){function i(l){n(l,{point:dee(l)})}return e?mve(i):i}function IO(n,e,i,o){return ive(n,e,gve(i,e==="pointerdown"),o)}function _ve(n,...e){if(n==null)throw new TypeError("Cannot convert undefined or null to object");const i={...n};for(const o of e)if(o!=null)for(const l in o)Object.prototype.hasOwnProperty.call(o,l)&&(l in i&&delete i[l],i[l]=o[l]);return i}const pr=n=>n?"":void 0,Bf=n=>n?!0:void 0;function yve(n){return Array.isArray(n)}function pd(n){const e=typeof n;return n!=null&&(e==="object"||e==="function")&&!yve(n)}function Eve(n){const e=n==null?0:n.length;return e?n[e-1]:void 0}function vve(n){const e=parseFloat(n.toString()),i=n.toString().replace(String(e),"");return{unitless:!i,value:e,unit:i}}function CV(n){if(n==null)return n;const{unitless:e}=vve(n);return e||typeof n=="number"?`${n}px`:n}const hee=(n,e)=>parseInt(n[1],10)>parseInt(e[1],10)?1:-1,sj=n=>Object.fromEntries(Object.entries(n).sort(hee));function _q(n){const e=sj(n);return Object.assign(Object.values(e),e)}function Sve(n){const e=Object.keys(sj(n));return new Set(e)}function yq(n){if(!n)return n;n=CV(n)??n;const e=-.02;return typeof n=="number"?`${n+e}`:n.replace(/(\d+\.?\d*)/u,i=>`${parseFloat(i)+e}`)}function _C(n,e){const i=["@media screen"];return n&&i.push("and",`(min-width: ${CV(n)})`),e&&i.push("and",`(max-width: ${CV(e)})`),i.join(" ")}function bve(n){if(!n)return null;n.base=n.base??"0px";const e=_q(n),i=Object.entries(n).sort(hee).map(([u,p],y,E)=>{let[,b]=E[y+1]??[];return b=parseFloat(b)>0?yq(b):void 0,{_minW:yq(p),breakpoint:u,minW:p,maxW:b,maxWQuery:_C(null,b),minWQuery:_C(p),minMaxQuery:_C(p,b)}}),o=Sve(n),l=Array.from(o.values());return{keys:o,normalized:e,isResponsive(u){const p=Object.keys(u);return p.length>0&&p.every(y=>o.has(y))},asObject:sj(n),asArray:_q(n),details:i,get(u){return i.find(p=>p.breakpoint===u)},media:[null,...e.map(u=>_C(u)).slice(1)],toArrayValue(u){if(!pd(u))throw new Error("toArrayValue: value must be an object");const p=l.map(y=>u[y]??null);for(;Eve(p)===null;)p.pop();return p},toObjectValue(u){if(!Array.isArray(u))throw new Error("toObjectValue: value must be an array");return u.reduce((p,y,E)=>{const b=l[E];return b!=null&&y!=null&&(p[b]=y),p},{})}}}function pee(...n){return function(...i){n.forEach(o=>o==null?void 0:o(...i))}}function jn(...n){return function(i){n.some(o=>(o==null||o(i),i==null?void 0:i.defaultPrevented))}}function nN(n){return k.Children.toArray(n).filter(e=>k.isValidElement(e))}function oj(n){const e=Object.assign({},n);for(let i in e)e[i]===void 0&&delete e[i];return e}function wve(n,e){return`${n} returned \`undefined\`. Seems you forgot to wrap component within ${e}`}function xi(n={}){const{name:e,strict:i=!0,hookName:o="useContext",providerName:l="Provider",errorMessage:u,defaultValue:p}=n,y=k.createContext(p);y.displayName=e;function E(){var T;const b=k.useContext(y);if(!b&&i){const R=new Error(u??wve(o,l));throw R.name="ContextError",(T=Error.captureStackTrace)==null||T.call(Error,R,E),R}return b}return[y.Provider,E,y]}const Sn=(...n)=>n.filter(Boolean).join(" "),fee=n=>n.hasAttribute("tabindex"),Tve=n=>fee(n)&&n.tabIndex===-1;function ck(n){if(!tN(n)||cee(n)||ave(n))return!1;const{localName:e}=n;if(["input","select","textarea","button"].indexOf(e)>=0)return!0;const o={a:()=>n.hasAttribute("href"),audio:()=>n.hasAttribute("controls"),video:()=>n.hasAttribute("controls")};return e in o?o[e]():ove(n)?!0:fee(n)}function Cve(n){return n?tN(n)&&ck(n)&&!Tve(n):!1}const Rve=["input:not(:disabled):not([disabled])","select:not(:disabled):not([disabled])","textarea:not(:disabled):not([disabled])","embed","iframe","object","a[href]","area[href]","button:not(:disabled):not([disabled])","[tabindex]","audio[controls]","video[controls]","*[tabindex]:not([aria-disabled])","*[contenteditable]"],Ive=Rve.join(),Ave=n=>n.offsetWidth>0&&n.offsetHeight>0;function mee(n){const e=Array.from(n.querySelectorAll(Ive));return e.unshift(n),e.filter(i=>ck(i)&&Ave(i))}function Pve(n,e,i,o){const l=typeof e=="string"?e.split("."):[e];for(o=0;o<l.length&&n;o+=1)n=n[l[o]];return n===void 0?i:n}const Ove=n=>{const e=new WeakMap;return(o,l,u,p)=>{if(typeof o>"u")return n(o,l,u);e.has(o)||e.set(o,new Map);const y=e.get(o);if(y.has(l))return y.get(l);const E=n(o,l,u,p);return y.set(l,E),E}},gee=Ove(Pve),kve=n=>n.default||n;function aj(n){const{wasSelected:e,enabled:i,isSelected:o,mode:l="unmount"}=n;return!!(!i||o||l==="keepMounted"&&e)}function Nve(n){const e=parseFloat(n);return typeof e!="number"||Number.isNaN(e)?0:e}function cj(n,e){let i=Nve(n);const o=10**(e??10);return i=Math.round(i*o)/o,e?i.toFixed(e):i.toString()}function RV(n){if(!Number.isFinite(n))return 0;let e=1,i=0;for(;Math.round(n*e)/e!==n;)e*=10,i+=1;return i}function Eq(n,e,i){return(n-e)*100/(i-e)}function xve(n,e,i){return(i-e)*n+e}function vq(n,e,i){const o=Math.round((n-e)/i)*i+e,l=RV(i);return cj(o,l)}function AO(n,e,i){return n==null?n:(i<e&&console.warn("clamp: max cannot be less than min"),Math.min(Math.max(n,e),i))}function UR(n,e=[]){const i=Object.assign({},n);for(const o of e)o in i&&delete i[o];return i}function _ee(n,e){const i={};for(const o of e)o in n&&(i[o]=n[o]);return i}function rN(n,e){return Array.isArray(n)?n.map(i=>i===null?null:e(i)):pd(n)?Object.keys(n).reduce((i,o)=>(i[o]=e(n[o]),i),{}):n!=null?e(n):null}const Dve=n=>typeof n=="function";function Cl(n,...e){return Dve(n)?n(...e):n}function Lve(n){const e=n.ownerDocument.defaultView||window,{overflow:i,overflowX:o,overflowY:l}=e.getComputedStyle(n);return/auto|scroll|overlay|hidden/.test(i+l+o)}function Mve(n){return n.localName==="html"?n:n.assignedSlot||n.parentElement||n.ownerDocument.documentElement}function yee(n){return["html","body","#document"].includes(n.localName)?n.ownerDocument.body:tN(n)&&Lve(n)?n:yee(Mve(n))}function Uve(n,e){const i={},o={};for(const[l,u]of Object.entries(n))e.includes(l)?i[l]=u:o[l]=u;return[i,o]}function Vve(n,...e){const i=Object.getOwnPropertyDescriptors(n),o=Object.keys(i),l=p=>{const y={};for(let E=0;E<p.length;E++){const b=p[E];i[b]&&(Object.defineProperty(y,b,i[b]),delete i[b])}return y},u=p=>l(Array.isArray(p)?p:o.filter(p));return e.map(u).concat(l(o))}function Sq(n,e,i={}){const{stop:o,getKey:l}=i;function u(p,y=[]){if(pd(p)||Array.isArray(p)){const E={};for(const[b,T]of Object.entries(p)){const R=(l==null?void 0:l(b))??b,O=[...y,R];if(o!=null&&o(p,O))return e(p,y);E[R]=u(T,O)}return E}return e(p,y)}return u(n)}var yC={exports:{}};yC.exports;var bq;function jve(){return bq||(bq=1,(function(n,e){var i=200,o="__lodash_hash_undefined__",l=800,u=16,p=9007199254740991,y="[object Arguments]",E="[object Array]",b="[object AsyncFunction]",T="[object Boolean]",R="[object Date]",O="[object Error]",L="[object Function]",D="[object GeneratorFunction]",U="[object Map]",F="[object Number]",Y="[object Null]",W="[object Object]",re="[object Proxy]",le="[object RegExp]",ie="[object Set]",me="[object String]",q="[object Undefined]",J="[object WeakMap]",Q="[object ArrayBuffer]",ne="[object DataView]",he="[object Float32Array]",de="[object Float64Array]",pe="[object Int8Array]",Se="[object Int16Array]",Ie="[object Int32Array]",Fe="[object Uint8Array]",we="[object Uint8ClampedArray]",Re="[object Uint16Array]",Te="[object Uint32Array]",Ne=/[\\^$.*+?()[\]{}|]/g,be=/^\[object .+?Constructor\]$/,xe=/^(?:0|[1-9]\d*)$/,je={};je[he]=je[de]=je[pe]=je[Se]=je[Ie]=je[Fe]=je[we]=je[Re]=je[Te]=!0,je[y]=je[E]=je[Q]=je[T]=je[ne]=je[R]=je[O]=je[L]=je[U]=je[F]=je[W]=je[le]=je[ie]=je[me]=je[J]=!1;var nt=typeof My=="object"&&My&&My.Object===Object&&My,dt=typeof self=="object"&&self&&self.Object===Object&&self,ft=nt||dt||Function("return this")(),lt=e&&!e.nodeType&&e,gt=lt&&!0&&n&&!n.nodeType&&n,at=gt&&gt.exports===lt,Ct=at&&nt.process,En=(function(){try{var Ce=gt&&gt.require&&gt.require("util").types;return Ce||Ct&&Ct.binding&&Ct.binding("util")}catch{}})(),Gt=En&&En.isTypedArray;function Jt(Ce,Me,ct){switch(ct.length){case 0:return Ce.call(Me);case 1:return Ce.call(Me,ct[0]);case 2:return Ce.call(Me,ct[0],ct[1]);case 3:return Ce.call(Me,ct[0],ct[1],ct[2])}return Ce.apply(Me,ct)}function st(Ce,Me){for(var ct=-1,Yt=Array(Ce);++ct<Ce;)Yt[ct]=Me(ct);return Yt}function hn(Ce){return function(Me){return Ce(Me)}}function an(Ce,Me){return Ce==null?void 0:Ce[Me]}function Ft(Ce,Me){return function(ct){return Ce(Me(ct))}}var on=Array.prototype,bt=Function.prototype,ve=Object.prototype,De=ft["__core-js_shared__"],qe=bt.toString,Ot=ve.hasOwnProperty,vt=(function(){var Ce=/[^.]+$/.exec(De&&De.keys&&De.keys.IE_PROTO||"");return Ce?"Symbol(src)_1."+Ce:""})(),Pt=ve.toString,Ut=qe.call(Object),cn=RegExp("^"+qe.call(Ot).replace(Ne,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),_t=at?ft.Buffer:void 0,wn=ft.Symbol,Nt=ft.Uint8Array;_t&&_t.allocUnsafe;var Ht=Ft(Object.getPrototypeOf,Object),Ur=Object.create,Ri=ve.propertyIsEnumerable,ri=on.splice,zi=wn?wn.toStringTag:void 0,ds=(function(){try{var Ce=Ji(Object,"defineProperty");return Ce({},"",{}),Ce}catch{}})(),Eo=_t?_t.isBuffer:void 0,Gr=Math.max,Mo=Date.now,Wc=Ji(ft,"Map"),Xr=Ji(Object,"create"),vo=(function(){function Ce(){}return function(Me){if(!Yc(Me))return{};if(Ur)return Ur(Me);Ce.prototype=Me;var ct=new Ce;return Ce.prototype=void 0,ct}})();function Js(Ce){var Me=-1,ct=Ce==null?0:Ce.length;for(this.clear();++Me<ct;){var Yt=Ce[Me];this.set(Yt[0],Yt[1])}}function ns(){this.__data__=Xr?Xr(null):{},this.size=0}function Gc(Ce){var Me=this.has(Ce)&&delete this.__data__[Ce];return this.size-=Me?1:0,Me}function So(Ce){var Me=this.__data__;if(Xr){var ct=Me[Ce];return ct===o?void 0:ct}return Ot.call(Me,Ce)?Me[Ce]:void 0}function bu(Ce){var Me=this.__data__;return Xr?Me[Ce]!==void 0:Ot.call(Me,Ce)}function Ga(Ce,Me){var ct=this.__data__;return this.size+=this.has(Ce)?0:1,ct[Ce]=Xr&&Me===void 0?o:Me,this}Js.prototype.clear=ns,Js.prototype.delete=Gc,Js.prototype.get=So,Js.prototype.has=bu,Js.prototype.set=Ga;function Ds(Ce){var Me=-1,ct=Ce==null?0:Ce.length;for(this.clear();++Me<ct;){var Yt=Ce[Me];this.set(Yt[0],Yt[1])}}function Kt(){this.__data__=[],this.size=0}function Hc(Ce){var Me=this.__data__,ct=Qs(Me,Ce);if(ct<0)return!1;var Yt=Me.length-1;return ct==Yt?Me.pop():ri.call(Me,ct,1),--this.size,!0}function ta(Ce){var Me=this.__data__,ct=Qs(Me,Ce);return ct<0?void 0:Me[ct][1]}function Ha(Ce){return Qs(this.__data__,Ce)>-1}function $c(Ce,Me){var ct=this.__data__,Yt=Qs(ct,Ce);return Yt<0?(++this.size,ct.push([Ce,Me])):ct[Yt][1]=Me,this}Ds.prototype.clear=Kt,Ds.prototype.delete=Hc,Ds.prototype.get=ta,Ds.prototype.has=Ha,Ds.prototype.set=$c;function na(Ce){var Me=-1,ct=Ce==null?0:Ce.length;for(this.clear();++Me<ct;){var Yt=Ce[Me];this.set(Yt[0],Yt[1])}}function ra(){this.size=0,this.__data__={hash:new Js,map:new(Wc||Ds),string:new Js}}function Sd(Ce){var Me=Ec(this,Ce).delete(Ce);return this.size-=Me?1:0,Me}function Ih(Ce){return Ec(this,Ce).get(Ce)}function kl(Ce){return Ec(this,Ce).has(Ce)}function Ah(Ce,Me){var ct=Ec(this,Ce),Yt=ct.size;return ct.set(Ce,Me),this.size+=ct.size==Yt?0:1,this}na.prototype.clear=ra,na.prototype.delete=Sd,na.prototype.get=Ih,na.prototype.has=kl,na.prototype.set=Ah;function Ls(Ce){var Me=this.__data__=new Ds(Ce);this.size=Me.size}function Nl(){this.__data__=new Ds,this.size=0}function ia(Ce){var Me=this.__data__,ct=Me.delete(Ce);return this.size=Me.size,ct}function bd(Ce){return this.__data__.get(Ce)}function xl(Ce){return this.__data__.has(Ce)}function Dl(Ce,Me){var ct=this.__data__;if(ct instanceof Ds){var Yt=ct.__data__;if(!Wc||Yt.length<i-1)return Yt.push([Ce,Me]),this.size=++ct.size,this;ct=this.__data__=new na(Yt)}return ct.set(Ce,Me),this.size=ct.size,this}Ls.prototype.clear=Nl,Ls.prototype.delete=ia,Ls.prototype.get=bd,Ls.prototype.has=xl,Ls.prototype.set=Dl;function Sa(Ce,Me){var ct=wa(Ce),Yt=!ct&&bs(Ce),cr=!ct&&!Yt&&Ca(Ce),jr=!ct&&!Yt&&!cr&&Fl(Ce),ai=ct||Yt||cr||jr,nr=ai?st(Ce.length,String):[],rr=nr.length;for(var Li in Ce)ai&&(Li=="length"||cr&&(Li=="offset"||Li=="parent")||jr&&(Li=="buffer"||Li=="byteLength"||Li=="byteOffset")||Vl(Li,rr))||nr.push(Li);return nr}function Ll(Ce,Me,ct){(ct!==void 0&&!ba(Ce[Me],ct)||ct===void 0&&!(Me in Ce))&&Jr(Ce,Me,ct)}function Ph(Ce,Me,ct){var Yt=Ce[Me];(!(Ot.call(Ce,Me)&&ba(Yt,ct))||ct===void 0&&!(Me in Ce))&&Jr(Ce,Me,ct)}function Qs(Ce,Me){for(var ct=Ce.length;ct--;)if(ba(Ce[ct][0],Me))return ct;return-1}function Jr(Ce,Me,ct){Me=="__proto__"&&ds?ds(Ce,Me,{configurable:!0,enumerable:!0,value:ct,writable:!0}):Ce[Me]=ct}var Oh=Ul();function Vr(Ce){return Ce==null?Ce===void 0?q:Y:zi&&zi in Object(Ce)?di(Ce):Nh(Ce)}function _c(Ce){return Ms(Ce)&&Vr(Ce)==y}function sa(Ce){if(!Yc(Ce)||Tu(Ce))return!1;var Me=$a(Ce)?cn:be;return Me.test(Jp(Ce))}function wd(Ce){return Ms(Ce)&&Qp(Ce.length)&&!!je[Vr(Ce)]}function Je(Ce){if(!Yc(Ce))return jl(Ce);var Me=yr(Ce),ct=[];for(var Yt in Ce)Yt=="constructor"&&(Me||!Ot.call(Ce,Yt))||ct.push(Yt);return ct}function qt(Ce,Me,ct,Yt,cr){Ce!==Me&&Oh(Me,function(jr,ai){if(cr||(cr=new Ls),Yc(jr))qn(Ce,Me,ai,ct,qt,Yt,cr);else{var nr=Yt?Yt(Cu(Ce,ai),jr,ai+"",Ce,Me,cr):void 0;nr===void 0&&(nr=jr),Ll(Ce,ai,nr)}},Iu)}function qn(Ce,Me,ct,Yt,cr,jr,ai){var nr=Cu(Ce,ct),rr=Cu(Me,ct),Li=ai.get(rr);if(Li){Ll(Ce,ct,Li);return}var Zs=jr?jr(nr,rr,ct+"",Ce,Me,ai):void 0,Xc=Zs===void 0;if(Xc){var Uo=wa(rr),Au=!Uo&&Ca(rr),Us=!Uo&&!Au&&Fl(rr);Zs=rr,Uo||Au||Us?wa(nr)?Zs=nr:Ru(nr)?Zs=qc(nr):Au?(Xc=!1,Zs=Kc(rr)):Us?(Xc=!1,Zs=yc(rr)):Zs=[]:r_(rr)||bs(rr)?(Zs=nr,bs(nr)?Zs=Bl(nr):(!Yc(nr)||$a(nr))&&(Zs=Hr(rr))):Xc=!1}Xc&&(ai.set(rr,Zs),cr(Zs,rr,Yt,jr,ai),ai.delete(rr)),Ll(Ce,ct,Zs)}function Xi(Ce,Me){return dm(xh(Ce,Me,Ra),Ce+"")}var Ss=ds?function(Ce,Me){return ds(Ce,"toString",{configurable:!0,enumerable:!1,value:vc(Me),writable:!0})}:Ra;function Kc(Ce,Me){return Ce.slice()}function kh(Ce){var Me=new Ce.constructor(Ce.byteLength);return new Nt(Me).set(new Nt(Ce)),Me}function yc(Ce,Me){var ct=kh(Ce.buffer);return new Ce.constructor(ct,Ce.byteOffset,Ce.length)}function qc(Ce,Me){var ct=-1,Yt=Ce.length;for(Me||(Me=Array(Yt));++ct<Yt;)Me[ct]=Ce[ct];return Me}function Ml(Ce,Me,ct,Yt){var cr=!ct;ct||(ct={});for(var jr=-1,ai=Me.length;++jr<ai;){var nr=Me[jr],rr=void 0;rr===void 0&&(rr=Ce[nr]),cr?Jr(ct,nr,rr):Ph(ct,nr,rr)}return ct}function Rr(Ce){return Xi(function(Me,ct){var Yt=-1,cr=ct.length,jr=cr>1?ct[cr-1]:void 0,ai=cr>2?ct[2]:void 0;for(jr=Ce.length>3&&typeof jr=="function"?(cr--,jr):void 0,ai&&wu(ct[0],ct[1],ai)&&(jr=cr<3?void 0:jr,cr=1),Me=Object(Me);++Yt<cr;){var nr=ct[Yt];nr&&Ce(Me,nr,Yt,jr)}return Me})}function Ul(Ce){return function(Me,ct,Yt){for(var cr=-1,jr=Object(Me),ai=Yt(Me),nr=ai.length;nr--;){var rr=ai[++cr];if(ct(jr[rr],rr,jr)===!1)break}return Me}}function Ec(Ce,Me){var ct=Ce.__data__;return hi(Me)?ct[typeof Me=="string"?"string":"hash"]:ct.map}function Ji(Ce,Me){var ct=an(Ce,Me);return sa(ct)?ct:void 0}function di(Ce){var Me=Ot.call(Ce,zi),ct=Ce[zi];try{Ce[zi]=void 0;var Yt=!0}catch{}var cr=Pt.call(Ce);return Yt&&(Me?Ce[zi]=ct:delete Ce[zi]),cr}function Hr(Ce){return typeof Ce.constructor=="function"&&!yr(Ce)?vo(Ht(Ce)):{}}function Vl(Ce,Me){var ct=typeof Ce;return Me=Me??p,!!Me&&(ct=="number"||ct!="symbol"&&xe.test(Ce))&&Ce>-1&&Ce%1==0&&Ce<Me}function wu(Ce,Me,ct){if(!Yc(ct))return!1;var Yt=typeof Me;return(Yt=="number"?Ta(ct)&&Vl(Me,ct.length):Yt=="string"&&Me in ct)?ba(ct[Me],Ce):!1}function hi(Ce){var Me=typeof Ce;return Me=="string"||Me=="number"||Me=="symbol"||Me=="boolean"?Ce!=="__proto__":Ce===null}function Tu(Ce){return!!vt&&vt in Ce}function yr(Ce){var Me=Ce&&Ce.constructor,ct=typeof Me=="function"&&Me.prototype||ve;return Ce===ct}function jl(Ce){var Me=[];if(Ce!=null)for(var ct in Object(Ce))Me.push(ct);return Me}function Nh(Ce){return Pt.call(Ce)}function xh(Ce,Me,ct){return Me=Gr(Me===void 0?Ce.length-1:Me,0),function(){for(var Yt=arguments,cr=-1,jr=Gr(Yt.length-Me,0),ai=Array(jr);++cr<jr;)ai[cr]=Yt[Me+cr];cr=-1;for(var nr=Array(Me+1);++cr<Me;)nr[cr]=Yt[cr];return nr[Me]=ct(ai),Jt(Ce,this,nr)}}function Cu(Ce,Me){if(!(Me==="constructor"&&typeof Ce[Me]=="function")&&Me!="__proto__")return Ce[Me]}var dm=Xp(Ss);function Xp(Ce){var Me=0,ct=0;return function(){var Yt=Mo(),cr=u-(Yt-ct);if(ct=Yt,cr>0){if(++Me>=l)return arguments[0]}else Me=0;return Ce.apply(void 0,arguments)}}function Jp(Ce){if(Ce!=null){try{return qe.call(Ce)}catch{}try{return Ce+""}catch{}}return""}function ba(Ce,Me){return Ce===Me||Ce!==Ce&&Me!==Me}var bs=_c((function(){return arguments})())?_c:function(Ce){return Ms(Ce)&&Ot.call(Ce,"callee")&&!Ri.call(Ce,"callee")},wa=Array.isArray;function Ta(Ce){return Ce!=null&&Qp(Ce.length)&&!$a(Ce)}function Ru(Ce){return Ms(Ce)&&Ta(Ce)}var Ca=Eo||zl;function $a(Ce){if(!Yc(Ce))return!1;var Me=Vr(Ce);return Me==L||Me==D||Me==b||Me==re}function Qp(Ce){return typeof Ce=="number"&&Ce>-1&&Ce%1==0&&Ce<=p}function Yc(Ce){var Me=typeof Ce;return Ce!=null&&(Me=="object"||Me=="function")}function Ms(Ce){return Ce!=null&&typeof Ce=="object"}function r_(Ce){if(!Ms(Ce)||Vr(Ce)!=W)return!1;var Me=Ht(Ce);if(Me===null)return!0;var ct=Ot.call(Me,"constructor")&&Me.constructor;return typeof ct=="function"&&ct instanceof ct&&qe.call(ct)==Ut}var Fl=Gt?hn(Gt):wd;function Bl(Ce){return Ml(Ce,Iu(Ce))}function Iu(Ce){return Ta(Ce)?Sa(Ce):Je(Ce)}var hm=Rr(function(Ce,Me,ct,Yt){qt(Ce,Me,ct,Yt)});function vc(Ce){return function(){return Ce}}function Ra(Ce){return Ce}function zl(){return!1}n.exports=hm})(yC,yC.exports)),yC.exports}var Fve=jve();const Op=Jg(Fve);function go(n,e=[]){const i=k.useRef(n);return k.useEffect(()=>{i.current=n}),k.useCallback((...o)=>{var l;return(l=i.current)==null?void 0:l.call(i,...o)},e)}function Gy(n,e,i,o){const l=go(i);return k.useEffect(()=>{const u=typeof n=="function"?n():n??document;if(!(!i||!u))return u.addEventListener(e,l,o),()=>{u.removeEventListener(e,l,o)}},[e,n,o,l,i]),()=>{const u=typeof n=="function"?n():n??document;u==null||u.removeEventListener(e,l,o)}}function Eee(n){const{isOpen:e,ref:i}=n,[o,l]=k.useState(e),[u,p]=k.useState(!1);return k.useEffect(()=>{u||(l(e),p(!0))},[e,u,o]),Gy(()=>i.current,"animationend",()=>{l(e)}),{present:!(e?!1:!o),onComplete(){var T;const E=cve(i.current),b=new E.CustomEvent("animationend",{bubbles:!0});(T=i.current)==null||T.dispatchEvent(b)}}}var nU,wq;function Bve(){return wq||(wq=1,nU=function(){var n=document.getSelection();if(!n.rangeCount)return function(){};for(var e=document.activeElement,i=[],o=0;o<n.rangeCount;o++)i.push(n.getRangeAt(o));switch(e.tagName.toUpperCase()){case"INPUT":case"TEXTAREA":e.blur();break;default:e=null;break}return n.removeAllRanges(),function(){n.type==="Caret"&&n.removeAllRanges(),n.rangeCount||i.forEach(function(l){n.addRange(l)}),e&&e.focus()}}),nU}var rU,Tq;function zve(){if(Tq)return rU;Tq=1;var n=Bve(),e={"text/plain":"Text","text/html":"Url",default:"Text"},i="Copy to clipboard: #{key}, Enter";function o(u){var p=(/mac os x/i.test(navigator.userAgent)?"":"Ctrl")+"+C";return u.replace(/#{\s*key\s*}/g,p)}function l(u,p){var y,E,b,T,R,O,L=!1;p||(p={}),y=p.debug||!1;try{b=n(),T=document.createRange(),R=document.getSelection(),O=document.createElement("span"),O.textContent=u,O.ariaHidden="true",O.style.all="unset",O.style.position="fixed",O.style.top=0,O.style.clip="rect(0, 0, 0, 0)",O.style.whiteSpace="pre",O.style.webkitUserSelect="text",O.style.MozUserSelect="text",O.style.msUserSelect="text",O.style.userSelect="text",O.addEventListener("copy",function(U){if(U.stopPropagation(),p.format)if(U.preventDefault(),typeof U.clipboardData>"u"){y&&console.warn("unable to use e.clipboardData"),y&&console.warn("trying IE specific stuff"),window.clipboardData.clearData();var F=e[p.format]||e.default;window.clipboardData.setData(F,u)}else U.clipboardData.clearData(),U.clipboardData.setData(p.format,u);p.onCopy&&(U.preventDefault(),p.onCopy(U.clipboardData))}),document.body.appendChild(O),T.selectNodeContents(O),R.addRange(T);var D=document.execCommand("copy");if(!D)throw new Error("copy command was unsuccessful");L=!0}catch(U){y&&console.error("unable to copy using execCommand: ",U),y&&console.warn("trying IE specific stuff");try{window.clipboardData.setData(p.format||"text",u),p.onCopy&&p.onCopy(window.clipboardData),L=!0}catch(F){y&&console.error("unable to copy using clipboardData: ",F),y&&console.error("falling back to prompt"),E=o("message"in p?p.message:i),window.prompt(E,u)}}finally{R&&(typeof R.removeRange=="function"?R.removeRange(T):R.removeAllRanges()),O&&document.body.removeChild(O),b()}return L}return rU=l,rU}var Wve=zve();const Cq=Jg(Wve);function Rq(n,e={}){const[i,o]=k.useState(!1),[l,u]=k.useState(n);k.useEffect(()=>u(n),[n]);const{timeout:p=1500,...y}=typeof e=="number"?{timeout:e}:e,E=k.useCallback(b=>{const T=typeof b=="string"?b:l;"clipboard"in navigator?navigator.clipboard.writeText(T).then(()=>o(!0)).catch(()=>o(Cq(T,y))):o(Cq(T,y))},[l,y]);return k.useEffect(()=>{let b=null;return i&&(b=window.setTimeout(()=>{o(!1)},p)),()=>{b&&window.clearTimeout(b)}},[p,i]),{value:l,setValue:u,onCopy:E,hasCopied:i}}function vee(n){const{value:e,defaultValue:i,onChange:o,shouldUpdate:l=(O,L)=>O!==L}=n,u=go(o),p=go(l),[y,E]=k.useState(i),b=e!==void 0,T=b?e:y,R=go(O=>{const D=typeof O=="function"?O(T):O;p(T,D)&&(b||E(D),u(D))},[b,u,T,p]);return[T,R]}function Gve(n={}){const{onChange:e,precision:i,defaultValue:o,value:l,step:u=1,min:p=Number.MIN_SAFE_INTEGER,max:y=Number.MAX_SAFE_INTEGER,keepWithinRange:E=!0}=n,b=go(e),[T,R]=k.useState(()=>o==null?"":iU(o,u,i)??""),O=typeof l<"u",L=O?l:T,D=See(wg(L),u),U=i??D,F=k.useCallback(ne=>{ne!==L&&(O||R(ne.toString()),b==null||b(ne.toString(),wg(ne)))},[b,O,L]),Y=k.useCallback(ne=>{let he=ne;return E&&(he=AO(he,p,y)),cj(he,U)},[U,E,y,p]),W=k.useCallback((ne=u)=>{let he;L===""?he=wg(ne):he=wg(L)+ne,he=Y(he),F(he)},[Y,u,F,L]),re=k.useCallback((ne=u)=>{let he;L===""?he=wg(-ne):he=wg(L)-ne,he=Y(he),F(he)},[Y,u,F,L]),le=k.useCallback(()=>{let ne;o==null?ne="":ne=iU(o,u,i)??p,F(ne)},[o,i,u,F,p]),ie=k.useCallback(ne=>{const he=iU(ne,u,U)??p;F(he)},[U,u,F,p]),me=wg(L);return{isOutOfRange:me>y||me<p,isAtMax:me===y,isAtMin:me===p,precision:U,value:L,valueAsNumber:me,update:F,reset:le,increment:W,decrement:re,clamp:Y,cast:ie,setValue:R}}function wg(n){return parseFloat(n.toString().replace(/[^\w.-]+/g,""))}function See(n,e){return Math.max(RV(e),RV(n))}function iU(n,e,i){const o=wg(n);if(Number.isNaN(o))return;const l=See(o,e);return cj(o,i??l)}function yu(n={}){const{onClose:e,onOpen:i,isOpen:o,id:l}=n,u=go(i),p=go(e),[y,E]=k.useState(n.defaultIsOpen||!1),b=o!==void 0?o:y,T=o!==void 0,R=k.useId(),O=l??`disclosure-${R}`,L=k.useCallback(()=>{T||E(!1),p==null||p()},[T,p]),D=k.useCallback(()=>{T||E(!0),u==null||u()},[T,u]),U=k.useCallback(()=>{b?L():D()},[b,D,L]);function F(W={}){return{...W,"aria-expanded":b,"aria-controls":O,onClick(re){var le;(le=W.onClick)==null||le.call(W,re),U()}}}function Y(W={}){return{...W,hidden:!b,id:O}}return{isOpen:b,onOpen:D,onClose:L,onToggle:U,isControlled:T,getButtonProps:F,getDisclosureProps:Y}}const xp=globalThis!=null&&globalThis.document?k.useLayoutEffect:k.useEffect,Xf=(n,e)=>{const i=k.useRef(!1),o=k.useRef(!1);k.useEffect(()=>{if(i.current&&o.current)return n();o.current=!0},e),k.useEffect(()=>(i.current=!0,()=>{i.current=!1}),[])};function Hve(n){const e=n.current;if(!e)return!1;const i=uve(e);return!i||e.contains(i)?!1:!!Cve(i)}function bee(n,e){const{shouldFocus:i,visible:o,focusRef:l}=e,u=i&&!o;Xf(()=>{if(!u||Hve(n))return;const p=(l==null?void 0:l.current)||n.current;let y;if(p)return y=requestAnimationFrame(()=>{p.focus({preventScroll:!0})}),()=>{cancelAnimationFrame(y)}},[u,n,l])}const $ve={preventScroll:!0,shouldFocus:!1};function Kve(n,e=$ve){const{focusRef:i,preventScroll:o,shouldFocus:l,visible:u}=e,p=qve(n)?n.current:n,y=l&&u,E=k.useRef(y),b=k.useRef(u);xp(()=>{!b.current&&u&&(E.current=y),b.current=u},[u,y]);const T=k.useCallback(()=>{if(!(!u||!p||!E.current)&&(E.current=!1,!p.contains(document.activeElement)))if(i!=null&&i.current)requestAnimationFrame(()=>{var R;(R=i.current)==null||R.focus({preventScroll:o})});else{const R=mee(p);R.length>0&&requestAnimationFrame(()=>{R[0].focus({preventScroll:o})})}},[u,o,p,i]);Xf(()=>{T()},[T]),Gy(p,"transitionend",T)}function qve(n){return"current"in n}function Yve(n){return"current"in n}const wee=()=>typeof window<"u";function Xve(){const n=navigator.userAgentData;return(n==null?void 0:n.platform)??navigator.platform}const Jve=n=>wee()&&n.test(navigator.vendor),Qve=n=>wee()&&n.test(Xve()),Zve=()=>Qve(/mac|iphone|ipad|ipod/i),e0e=()=>Zve()&&Jve(/apple/i);function t0e(n){const{ref:e,elements:i,enabled:o}=n,l=()=>{var u;return((u=e.current)==null?void 0:u.ownerDocument)??document};Gy(l,"pointerdown",u=>{var b,T;if(!e0e()||!o)return;const p=((T=(b=u.composedPath)==null?void 0:b.call(u))==null?void 0:T[0])??u.target,E=(i??[e]).some(R=>{const O=Yve(R)?R.current:R;return(O==null?void 0:O.contains(p))||O===p});l().activeElement!==p&&E&&(u.preventDefault(),p.focus())})}function n0e(n,e){const i=k.useId();return k.useMemo(()=>n||[e,i].filter(Boolean).join("-"),[n,e,i])}function r0e(n,...e){const i=n0e(n);return k.useMemo(()=>e.map(o=>`${o}-${i}`),[i,e])}function i0e(n,e){const i=go(n);k.useEffect(()=>{let o=null;const l=()=>i();return e!==null&&(o=window.setInterval(l,e)),()=>{o&&window.clearInterval(o)}},[e,i])}function Tee(n){const e=k.useRef(null);return e.current=n,e}function s0e(n,e){if(n!=null){if(typeof n=="function"){n(e);return}try{n.current=e}catch{throw new Error(`Cannot assign value '${e}' to ref '${n}'`)}}}function Yi(...n){return e=>{n.forEach(i=>{s0e(i,e)})}}function o0e(...n){return k.useMemo(()=>Yi(...n),n)}function Cee(n){const{ref:e,handler:i,enabled:o=!0}=n,l=go(i),p=k.useRef({isPointerDown:!1,ignoreEmulatedMouseEvents:!1}).current;k.useEffect(()=>{if(!o)return;const y=R=>{sU(R,e)&&(p.isPointerDown=!0)},E=R=>{if(p.ignoreEmulatedMouseEvents){p.ignoreEmulatedMouseEvents=!1;return}p.isPointerDown&&i&&sU(R,e)&&(p.isPointerDown=!1,l(R))},b=R=>{p.ignoreEmulatedMouseEvents=!0,i&&p.isPointerDown&&sU(R,e)&&(p.isPointerDown=!1,l(R))},T=Ree(e.current);return T.addEventListener("mousedown",y,!0),T.addEventListener("mouseup",E,!0),T.addEventListener("touchstart",y,!0),T.addEventListener("touchend",b,!0),()=>{T.removeEventListener("mousedown",y,!0),T.removeEventListener("mouseup",E,!0),T.removeEventListener("touchstart",y,!0),T.removeEventListener("touchend",b,!0)}},[i,e,l,p,o])}function sU(n,e){var o,l;const i=((o=n.composedPath)==null?void 0:o.call(n)[0])??n.target;return i&&!Ree(i).contains(i)?!1:!((l=e.current)!=null&&l.contains(i))}function Ree(n){return(n==null?void 0:n.ownerDocument)??document}function a0e(n,e){const i=go(n);k.useEffect(()=>{if(e==null)return;let o=null;return o=window.setTimeout(()=>{i()},e),()=>{o&&window.clearTimeout(o)}},[e,i])}const Iee=1/60*1e3,c0e=typeof performance<"u"?()=>performance.now():()=>Date.now(),Aee=typeof window<"u"?n=>window.requestAnimationFrame(n):n=>setTimeout(()=>n(c0e()),Iee);function l0e(n){let e=[],i=[],o=0,l=!1,u=!1;const p=new WeakSet,y={schedule:(E,b=!1,T=!1)=>{const R=T&&l,O=R?e:i;return b&&p.add(E),O.indexOf(E)===-1&&(O.push(E),R&&l&&(o=e.length)),E},cancel:E=>{const b=i.indexOf(E);b!==-1&&i.splice(b,1),p.delete(E)},process:E=>{if(l){u=!0;return}if(l=!0,[e,i]=[i,e],i.length=0,o=e.length,o)for(let b=0;b<o;b++){const T=e[b];T(E),p.has(T)&&(y.schedule(T),n())}l=!1,u&&(u=!1,y.process(E))}};return y}const u0e=40;let IV=!0,iR=!1,AV=!1;const fS={delta:0,timestamp:0},VR=["read","update","preRender","render","postRender"],iN=VR.reduce((n,e)=>(n[e]=l0e(()=>iR=!0),n),{}),d0e=VR.reduce((n,e)=>{const i=iN[e];return n[e]=(o,l=!1,u=!1)=>(iR||f0e(),i.schedule(o,l,u)),n},{}),h0e=VR.reduce((n,e)=>(n[e]=iN[e].cancel,n),{});VR.reduce((n,e)=>(n[e]=()=>iN[e].process(fS),n),{});const p0e=n=>iN[n].process(fS),Pee=n=>{iR=!1,fS.delta=IV?Iee:Math.max(Math.min(n-fS.timestamp,u0e),1),fS.timestamp=n,AV=!0,VR.forEach(p0e),AV=!1,iR&&(IV=!1,Aee(Pee))},f0e=()=>{iR=!0,IV=!0,AV||Aee(Pee)},Iq=()=>fS;var m0e=Object.defineProperty,g0e=(n,e,i)=>e in n?m0e(n,e,{enumerable:!0,configurable:!0,writable:!0,value:i}):n[e]=i,ch=(n,e,i)=>(g0e(n,typeof e!="symbol"?e+"":e,i),i);class _0e{constructor(e,i,o){if(ch(this,"history",[]),ch(this,"startEvent",null),ch(this,"lastEvent",null),ch(this,"lastEventInfo",null),ch(this,"handlers",{}),ch(this,"removeListeners",()=>{}),ch(this,"threshold",3),ch(this,"win"),ch(this,"updatePoint",()=>{if(!(this.lastEvent&&this.lastEventInfo))return;const y=oU(this.lastEventInfo,this.history),E=this.startEvent!==null,b=S0e(y.offset,{x:0,y:0})>=this.threshold;if(!E&&!b)return;const{timestamp:T}=Iq();this.history.push({...y.point,timestamp:T});const{onStart:R,onMove:O}=this.handlers;E||(R==null||R(this.lastEvent,y),this.startEvent=this.lastEvent),O==null||O(this.lastEvent,y)}),ch(this,"onPointerMove",(y,E)=>{this.lastEvent=y,this.lastEventInfo=E,d0e.update(this.updatePoint,!0)}),ch(this,"onPointerUp",(y,E)=>{const b=oU(E,this.history),{onEnd:T,onSessionEnd:R}=this.handlers;R==null||R(y,b),this.end(),!(!T||!this.startEvent)&&(T==null||T(y,b))}),this.win=e.view??window,hve(e))return;this.handlers=i,o&&(this.threshold=o),e.stopPropagation(),e.preventDefault();const l={point:dee(e)},{timestamp:u}=Iq();this.history=[{...l.point,timestamp:u}];const{onSessionStart:p}=i;p==null||p(e,oU(l,this.history)),this.removeListeners=v0e(IO(this.win,"pointermove",this.onPointerMove),IO(this.win,"pointerup",this.onPointerUp),IO(this.win,"pointercancel",this.onPointerUp))}updateHandlers(e){this.handlers=e}end(){var e;(e=this.removeListeners)==null||e.call(this),h0e.update(this.updatePoint)}}function Aq(n,e){return{x:n.x-e.x,y:n.y-e.y}}function oU(n,e){return{point:n.point,delta:Aq(n.point,e[e.length-1]),offset:Aq(n.point,e[0]),velocity:E0e(e,.1)}}const y0e=n=>n*1e3;function E0e(n,e){if(n.length<2)return{x:0,y:0};let i=n.length-1,o=null;const l=n[n.length-1];for(;i>=0&&(o=n[i],!(l.timestamp-o.timestamp>y0e(e)));)i--;if(!o)return{x:0,y:0};const u=(l.timestamp-o.timestamp)/1e3;if(u===0)return{x:0,y:0};const p={x:(l.x-o.x)/u,y:(l.y-o.y)/u};return p.x===1/0&&(p.x=0),p.y===1/0&&(p.y=0),p}function v0e(...n){return e=>n.reduce((i,o)=>o(i),e)}function aU(n,e){return Math.abs(n-e)}function Pq(n){return"x"in n&&"y"in n}function S0e(n,e){if(typeof n=="number"&&typeof e=="number")return aU(n,e);if(Pq(n)&&Pq(e)){const i=aU(n.x,e.x),o=aU(n.y,e.y);return Math.sqrt(i**2+o**2)}return 0}function b0e(n,e){const{onPan:i,onPanStart:o,onPanEnd:l,onPanSessionStart:u,onPanSessionEnd:p,threshold:y}=e,E=!!(i||o||l||u||p),b=k.useRef(null),T=Tee({onSessionStart:u,onSessionEnd:p,onStart:o,onMove:i,onEnd(R,O){b.current=null,l==null||l(R,O)}});k.useEffect(()=>{var R;(R=b.current)==null||R.updateHandlers(T.current)}),k.useEffect(()=>{const R=n.current;if(!R||!E)return;function O(L){b.current=new _0e(L,T.current,y)}return IO(R,"pointerdown",O)},[n,E,T,y]),k.useEffect(()=>()=>{var R;(R=b.current)==null||R.end(),b.current=null},[])}const Ho={open:(n,e)=>`${n}[data-open], ${n}[open], ${n}[data-state=open] ${e}`,closed:(n,e)=>`${n}[data-closed], ${n}[data-state=closed] ${e}`,hover:(n,e)=>`${n}:hover ${e}, ${n}[data-hover] ${e}`,focus:(n,e)=>`${n}:focus ${e}, ${n}[data-focus] ${e}`,focusVisible:(n,e)=>`${n}:focus-visible ${e}`,focusWithin:(n,e)=>`${n}:focus-within ${e}`,active:(n,e)=>`${n}:active ${e}, ${n}[data-active] ${e}`,disabled:(n,e)=>`${n}:disabled ${e}, ${n}[data-disabled] ${e}`,invalid:(n,e)=>`${n}:invalid ${e}, ${n}[data-invalid] ${e}`,checked:(n,e)=>`${n}:checked ${e}, ${n}[data-checked] ${e}`,placeholderShown:(n,e)=>`${n}:placeholder-shown ${e}`},vp=n=>Oee(e=>n(e,"&"),"[role=group]","[data-group]",".group"),Nf=n=>Oee(e=>n(e,"~ &"),"[data-peer]",".peer"),Oee=(n,...e)=>e.map(n).join(", "),mS={_hover:"&:hover, &[data-hover]",_active:"&:active, &[data-active]",_focus:"&:focus, &[data-focus]",_highlighted:"&[data-highlighted]",_focusWithin:"&:focus-within, &[data-focus-within]",_focusVisible:"&:focus-visible, &[data-focus-visible]",_disabled:"&:disabled, &[disabled], &[aria-disabled=true], &[data-disabled]",_readOnly:"&[aria-readonly=true], &[readonly], &[data-readonly]",_before:"&::before",_after:"&::after",_empty:"&:empty, &[data-empty]",_expanded:"&[aria-expanded=true], &[data-expanded], &[data-state=expanded]",_checked:"&[aria-checked=true], &[data-checked], &[data-state=checked]",_grabbed:"&[aria-grabbed=true], &[data-grabbed]",_pressed:"&[aria-pressed=true], &[data-pressed]",_invalid:"&[aria-invalid=true], &[data-invalid]",_valid:"&[data-valid], &[data-state=valid]",_loading:"&[data-loading], &[aria-busy=true]",_selected:"&[aria-selected=true], &[data-selected]",_hidden:"&[hidden], &[data-hidden]",_autofill:"&:-webkit-autofill",_even:"&:nth-of-type(even)",_odd:"&:nth-of-type(odd)",_first:"&:first-of-type",_firstLetter:"&::first-letter",_last:"&:last-of-type",_notFirst:"&:not(:first-of-type)",_notLast:"&:not(:last-of-type)",_visited:"&:visited",_activeLink:"&[aria-current=page]",_activeStep:"&[aria-current=step]",_indeterminate:"&:indeterminate, &[aria-checked=mixed], &[data-indeterminate], &[data-state=indeterminate]",_groupOpen:vp(Ho.open),_groupClosed:vp(Ho.closed),_groupHover:vp(Ho.hover),_peerHover:Nf(Ho.hover),_groupFocus:vp(Ho.focus),_peerFocus:Nf(Ho.focus),_groupFocusVisible:vp(Ho.focusVisible),_peerFocusVisible:Nf(Ho.focusVisible),_groupActive:vp(Ho.active),_peerActive:Nf(Ho.active),_groupDisabled:vp(Ho.disabled),_peerDisabled:Nf(Ho.disabled),_groupInvalid:vp(Ho.invalid),_peerInvalid:Nf(Ho.invalid),_groupChecked:vp(Ho.checked),_peerChecked:Nf(Ho.checked),_groupFocusWithin:vp(Ho.focusWithin),_peerFocusWithin:Nf(Ho.focusWithin),_peerPlaceholderShown:Nf(Ho.placeholderShown),_placeholder:"&::placeholder, &[data-placeholder]",_placeholderShown:"&:placeholder-shown, &[data-placeholder-shown]",_fullScreen:"&:fullscreen, &[data-fullscreen]",_selection:"&::selection",_rtl:"[dir=rtl] &, &[dir=rtl]",_ltr:"[dir=ltr] &, &[dir=ltr]",_mediaDark:"@media (prefers-color-scheme: dark)",_mediaReduceMotion:"@media (prefers-reduced-motion: reduce)",_dark:".chakra-ui-dark &:not([data-theme]),[data-theme=dark] &:not([data-theme]),&[data-theme=dark]",_light:".chakra-ui-light &:not([data-theme]),[data-theme=light] &:not([data-theme]),&[data-theme=light]",_horizontal:"&[data-orientation=horizontal]",_vertical:"&[data-orientation=vertical]",_open:"&[data-open], &[open], &[data-state=open]",_closed:"&[data-closed], &[data-state=closed]",_complete:"&[data-complete]",_incomplete:"&[data-incomplete]",_current:"&[data-current]"},kee=Object.keys(mS),w0e=n=>/!(important)?$/.test(n),Oq=n=>typeof n=="string"?n.replace(/!(important)?$/,"").trim():n,T0e=(n,e)=>i=>{const o=String(e),l=w0e(o),u=Oq(o),p=n?`${n}.${u}`:u;let y=pd(i.__cssMap)&&p in i.__cssMap?i.__cssMap[p].varRef:e;return y=Oq(y),l?`${y} !important`:y};function lj(n){const{scale:e,transform:i,compose:o}=n;return(u,p)=>{const y=T0e(e,u)(p);let E=(i==null?void 0:i(y,p))??y;return o&&(E=o(E,p)),E}}const XP=(...n)=>e=>n.reduce((i,o)=>o(i),e);function sd(n,e){return i=>{const o={property:i,scale:n};return o.transform=lj({scale:n,transform:e}),o}}const C0e=({rtl:n,ltr:e})=>i=>i.direction==="rtl"?n:e;function R0e(n){const{property:e,scale:i,transform:o}=n;return{scale:i,property:C0e(e),transform:i?lj({scale:i,compose:o}):o}}const Nee=["rotate(var(--chakra-rotate, 0))","scaleX(var(--chakra-scale-x, 1))","scaleY(var(--chakra-scale-y, 1))","skewX(var(--chakra-skew-x, 0))","skewY(var(--chakra-skew-y, 0))"];function I0e(){return["translateX(var(--chakra-translate-x, 0))","translateY(var(--chakra-translate-y, 0))",...Nee].join(" ")}function A0e(){return["translate3d(var(--chakra-translate-x, 0), var(--chakra-translate-y, 0), 0)",...Nee].join(" ")}const P0e={"--chakra-blur":"var(--chakra-empty,/*!*/ /*!*/)","--chakra-brightness":"var(--chakra-empty,/*!*/ /*!*/)","--chakra-contrast":"var(--chakra-empty,/*!*/ /*!*/)","--chakra-grayscale":"var(--chakra-empty,/*!*/ /*!*/)","--chakra-hue-rotate":"var(--chakra-empty,/*!*/ /*!*/)","--chakra-invert":"var(--chakra-empty,/*!*/ /*!*/)","--chakra-saturate":"var(--chakra-empty,/*!*/ /*!*/)","--chakra-sepia":"var(--chakra-empty,/*!*/ /*!*/)","--chakra-drop-shadow":"var(--chakra-empty,/*!*/ /*!*/)",filter:["var(--chakra-blur)","var(--chakra-brightness)","var(--chakra-contrast)","var(--chakra-grayscale)","var(--chakra-hue-rotate)","var(--chakra-invert)","var(--chakra-saturate)","var(--chakra-sepia)","var(--chakra-drop-shadow)"].join(" ")},O0e={backdropFilter:["var(--chakra-backdrop-blur)","var(--chakra-backdrop-brightness)","var(--chakra-backdrop-contrast)","var(--chakra-backdrop-grayscale)","var(--chakra-backdrop-hue-rotate)","var(--chakra-backdrop-invert)","var(--chakra-backdrop-opacity)","var(--chakra-backdrop-saturate)","var(--chakra-backdrop-sepia)"].join(" "),"--chakra-backdrop-blur":"var(--chakra-empty,/*!*/ /*!*/)","--chakra-backdrop-brightness":"var(--chakra-empty,/*!*/ /*!*/)","--chakra-backdrop-contrast":"var(--chakra-empty,/*!*/ /*!*/)","--chakra-backdrop-grayscale":"var(--chakra-empty,/*!*/ /*!*/)","--chakra-backdrop-hue-rotate":"var(--chakra-empty,/*!*/ /*!*/)","--chakra-backdrop-invert":"var(--chakra-empty,/*!*/ /*!*/)","--chakra-backdrop-opacity":"var(--chakra-empty,/*!*/ /*!*/)","--chakra-backdrop-saturate":"var(--chakra-empty,/*!*/ /*!*/)","--chakra-backdrop-sepia":"var(--chakra-empty,/*!*/ /*!*/)"};function k0e(n){return{"--chakra-ring-offset-shadow":"var(--chakra-ring-inset) 0 0 0 var(--chakra-ring-offset-width) var(--chakra-ring-offset-color)","--chakra-ring-shadow":"var(--chakra-ring-inset) 0 0 0 calc(var(--chakra-ring-width) + var(--chakra-ring-offset-width)) var(--chakra-ring-color)","--chakra-ring-width":n,boxShadow:["var(--chakra-ring-offset-shadow)","var(--chakra-ring-shadow)","var(--chakra-shadow, 0 0 #0000)"].join(", ")}}const N0e={"row-reverse":{space:"--chakra-space-x-reverse",divide:"--chakra-divide-x-reverse"},"column-reverse":{space:"--chakra-space-y-reverse",divide:"--chakra-divide-y-reverse"}},PV={"to-t":"to top","to-tr":"to top right","to-r":"to right","to-br":"to bottom right","to-b":"to bottom","to-bl":"to bottom left","to-l":"to left","to-tl":"to top left"},x0e=new Set(Object.values(PV)),OV=new Set(["none","-moz-initial","inherit","initial","revert","unset"]),D0e=n=>n.trim();function L0e(n,e){if(n==null||OV.has(n))return n;if(!(kV(n)||OV.has(n)))return`url('${n}')`;const l=/(^[a-z-A-Z]+)\((.*)\)/g.exec(n),u=l==null?void 0:l[1],p=l==null?void 0:l[2];if(!u||!p)return n;const y=u.includes("-gradient")?u:`${u}-gradient`,[E,...b]=p.split(",").map(D0e).filter(Boolean);if((b==null?void 0:b.length)===0)return n;const T=E in PV?PV[E]:E;b.unshift(T);const R=b.map(O=>{if(x0e.has(O))return O;const L=O.indexOf(" "),[D,U]=L!==-1?[O.substr(0,L),O.substr(L+1)]:[O],F=kV(U)?U:U&&U.split(" "),Y=`colors.${D}`,W=Y in e.__cssMap?e.__cssMap[Y].varRef:D;return F?[W,...Array.isArray(F)?F:[F]].join(" "):W});return`${y}(${R.join(", ")})`}const kV=n=>typeof n=="string"&&n.includes("(")&&n.includes(")"),M0e=(n,e)=>L0e(n,e??{});function U0e(n){return/^var\(--.+\)$/.test(n)}const V0e=n=>{const e=parseFloat(n.toString()),i=n.toString().replace(String(e),"");return{unitless:!i,value:e,unit:i}},Sp=n=>e=>`${n}(${e})`,Yr={filter(n){return n!=="auto"?n:P0e},backdropFilter(n){return n!=="auto"?n:O0e},ring(n){return k0e(Yr.px(n))},bgClip(n){return n==="text"?{color:"transparent",backgroundClip:"text"}:{backgroundClip:n}},transform(n){return n==="auto"?I0e():n==="auto-gpu"?A0e():n},vh(n){return n==="$100vh"?"var(--chakra-vh)":n},px(n){if(n==null)return n;const{unitless:e}=V0e(n);return e||typeof n=="number"?`${n}px`:n},fraction(n){return typeof n!="number"||n>1?n:`${n*100}%`},float(n,e){const i={left:"right",right:"left"};return e.direction==="rtl"?i[n]:n},degree(n){if(U0e(n)||n==null)return n;const e=typeof n=="string"&&!n.endsWith("deg");return typeof n=="number"||e?`${n}deg`:n},gradient:M0e,blur:Sp("blur"),opacity:Sp("opacity"),brightness:Sp("brightness"),contrast:Sp("contrast"),dropShadow:Sp("drop-shadow"),grayscale:Sp("grayscale"),hueRotate:n=>Sp("hue-rotate")(Yr.degree(n)),invert:Sp("invert"),saturate:Sp("saturate"),sepia:Sp("sepia"),bgImage(n){return n==null||kV(n)||OV.has(n)?n:`url(${n})`},outline(n){const e=String(n)==="0"||String(n)==="none";return n!==null&&e?{outline:"2px solid transparent",outlineOffset:"2px"}:{outline:n}},flexDirection(n){const{space:e,divide:i}=N0e[n]??{},o={flexDirection:n};return e&&(o[e]=1),i&&(o[i]=1),o}},Ge={borderWidths:sd("borderWidths"),borderStyles:sd("borderStyles"),colors:sd("colors"),borders:sd("borders"),gradients:sd("gradients",Yr.gradient),radii:sd("radii",Yr.px),space:sd("space",XP(Yr.vh,Yr.px)),spaceT:sd("space",XP(Yr.vh,Yr.px)),degreeT(n){return{property:n,transform:Yr.degree}},prop(n,e,i){return{property:n,scale:e,...e&&{transform:lj({scale:e,transform:i})}}},propT(n,e){return{property:n,transform:e}},sizes:sd("sizes",XP(Yr.vh,Yr.px)),sizesT:sd("sizes",XP(Yr.vh,Yr.fraction)),shadows:sd("shadows"),logical:R0e,blur:sd("blur",Yr.blur)},PO={background:Ge.colors("background"),backgroundColor:Ge.colors("backgroundColor"),backgroundImage:Ge.gradients("backgroundImage"),backgroundSize:!0,backgroundPosition:!0,backgroundRepeat:!0,backgroundAttachment:!0,backgroundClip:{transform:Yr.bgClip},bgSize:Ge.prop("backgroundSize"),bgPosition:Ge.prop("backgroundPosition"),bg:Ge.colors("background"),bgColor:Ge.colors("backgroundColor"),bgPos:Ge.prop("backgroundPosition"),bgRepeat:Ge.prop("backgroundRepeat"),bgAttachment:Ge.prop("backgroundAttachment"),bgGradient:Ge.gradients("backgroundImage"),bgClip:{transform:Yr.bgClip}};Object.assign(PO,{bgImage:PO.backgroundImage,bgImg:PO.backgroundImage});const mi={border:Ge.borders("border"),borderWidth:Ge.borderWidths("borderWidth"),borderStyle:Ge.borderStyles("borderStyle"),borderColor:Ge.colors("borderColor"),borderRadius:Ge.radii("borderRadius"),borderTop:Ge.borders("borderTop"),borderBlockStart:Ge.borders("borderBlockStart"),borderTopLeftRadius:Ge.radii("borderTopLeftRadius"),borderStartStartRadius:Ge.logical({scale:"radii",property:{ltr:"borderTopLeftRadius",rtl:"borderTopRightRadius"}}),borderEndStartRadius:Ge.logical({scale:"radii",property:{ltr:"borderBottomLeftRadius",rtl:"borderBottomRightRadius"}}),borderTopRightRadius:Ge.radii("borderTopRightRadius"),borderStartEndRadius:Ge.logical({scale:"radii",property:{ltr:"borderTopRightRadius",rtl:"borderTopLeftRadius"}}),borderEndEndRadius:Ge.logical({scale:"radii",property:{ltr:"borderBottomRightRadius",rtl:"borderBottomLeftRadius"}}),borderRight:Ge.borders("borderRight"),borderInlineEnd:Ge.borders("borderInlineEnd"),borderBottom:Ge.borders("borderBottom"),borderBlockEnd:Ge.borders("borderBlockEnd"),borderBottomLeftRadius:Ge.radii("borderBottomLeftRadius"),borderBottomRightRadius:Ge.radii("borderBottomRightRadius"),borderLeft:Ge.borders("borderLeft"),borderInlineStart:{property:"borderInlineStart",scale:"borders"},borderInlineStartRadius:Ge.logical({scale:"radii",property:{ltr:["borderTopLeftRadius","borderBottomLeftRadius"],rtl:["borderTopRightRadius","borderBottomRightRadius"]}}),borderInlineEndRadius:Ge.logical({scale:"radii",property:{ltr:["borderTopRightRadius","borderBottomRightRadius"],rtl:["borderTopLeftRadius","borderBottomLeftRadius"]}}),borderX:Ge.borders(["borderLeft","borderRight"]),borderInline:Ge.borders("borderInline"),borderY:Ge.borders(["borderTop","borderBottom"]),borderBlock:Ge.borders("borderBlock"),borderTopWidth:Ge.borderWidths("borderTopWidth"),borderBlockStartWidth:Ge.borderWidths("borderBlockStartWidth"),borderTopColor:Ge.colors("borderTopColor"),borderBlockStartColor:Ge.colors("borderBlockStartColor"),borderTopStyle:Ge.borderStyles("borderTopStyle"),borderBlockStartStyle:Ge.borderStyles("borderBlockStartStyle"),borderBottomWidth:Ge.borderWidths("borderBottomWidth"),borderBlockEndWidth:Ge.borderWidths("borderBlockEndWidth"),borderBottomColor:Ge.colors("borderBottomColor"),borderBlockEndColor:Ge.colors("borderBlockEndColor"),borderBottomStyle:Ge.borderStyles("borderBottomStyle"),borderBlockEndStyle:Ge.borderStyles("borderBlockEndStyle"),borderLeftWidth:Ge.borderWidths("borderLeftWidth"),borderInlineStartWidth:Ge.borderWidths("borderInlineStartWidth"),borderLeftColor:Ge.colors("borderLeftColor"),borderInlineStartColor:Ge.colors("borderInlineStartColor"),borderLeftStyle:Ge.borderStyles("borderLeftStyle"),borderInlineStartStyle:Ge.borderStyles("borderInlineStartStyle"),borderRightWidth:Ge.borderWidths("borderRightWidth"),borderInlineEndWidth:Ge.borderWidths("borderInlineEndWidth"),borderRightColor:Ge.colors("borderRightColor"),borderInlineEndColor:Ge.colors("borderInlineEndColor"),borderRightStyle:Ge.borderStyles("borderRightStyle"),borderInlineEndStyle:Ge.borderStyles("borderInlineEndStyle"),borderTopRadius:Ge.radii(["borderTopLeftRadius","borderTopRightRadius"]),borderBottomRadius:Ge.radii(["borderBottomLeftRadius","borderBottomRightRadius"]),borderLeftRadius:Ge.radii(["borderTopLeftRadius","borderBottomLeftRadius"]),borderRightRadius:Ge.radii(["borderTopRightRadius","borderBottomRightRadius"])};Object.assign(mi,{rounded:mi.borderRadius,roundedTop:mi.borderTopRadius,roundedTopLeft:mi.borderTopLeftRadius,roundedTopRight:mi.borderTopRightRadius,roundedTopStart:mi.borderStartStartRadius,roundedTopEnd:mi.borderStartEndRadius,roundedBottom:mi.borderBottomRadius,roundedBottomLeft:mi.borderBottomLeftRadius,roundedBottomRight:mi.borderBottomRightRadius,roundedBottomStart:mi.borderEndStartRadius,roundedBottomEnd:mi.borderEndEndRadius,roundedLeft:mi.borderLeftRadius,roundedRight:mi.borderRightRadius,roundedStart:mi.borderInlineStartRadius,roundedEnd:mi.borderInlineEndRadius,borderStart:mi.borderInlineStart,borderEnd:mi.borderInlineEnd,borderTopStartRadius:mi.borderStartStartRadius,borderTopEndRadius:mi.borderStartEndRadius,borderBottomStartRadius:mi.borderEndStartRadius,borderBottomEndRadius:mi.borderEndEndRadius,borderStartRadius:mi.borderInlineStartRadius,borderEndRadius:mi.borderInlineEndRadius,borderStartWidth:mi.borderInlineStartWidth,borderEndWidth:mi.borderInlineEndWidth,borderStartColor:mi.borderInlineStartColor,borderEndColor:mi.borderInlineEndColor,borderStartStyle:mi.borderInlineStartStyle,borderEndStyle:mi.borderInlineEndStyle});const j0e={color:Ge.colors("color"),textColor:Ge.colors("color"),fill:Ge.colors("fill"),stroke:Ge.colors("stroke"),accentColor:Ge.colors("accentColor"),textFillColor:Ge.colors("textFillColor")},lk={alignItems:!0,alignContent:!0,justifyItems:!0,justifyContent:!0,flexWrap:!0,flexDirection:{transform:Yr.flexDirection},flex:!0,flexFlow:!0,flexGrow:!0,flexShrink:!0,flexBasis:Ge.sizes("flexBasis"),justifySelf:!0,alignSelf:!0,order:!0,placeItems:!0,placeContent:!0,placeSelf:!0,gap:Ge.space("gap"),rowGap:Ge.space("rowGap"),columnGap:Ge.space("columnGap")};Object.assign(lk,{flexDir:lk.flexDirection});const ad={width:Ge.sizesT("width"),inlineSize:Ge.sizesT("inlineSize"),height:Ge.sizes("height"),blockSize:Ge.sizes("blockSize"),boxSize:Ge.sizes(["width","height"]),minWidth:Ge.sizes("minWidth"),minInlineSize:Ge.sizes("minInlineSize"),minHeight:Ge.sizes("minHeight"),minBlockSize:Ge.sizes("minBlockSize"),maxWidth:Ge.sizes("maxWidth"),maxInlineSize:Ge.sizes("maxInlineSize"),maxHeight:Ge.sizes("maxHeight"),maxBlockSize:Ge.sizes("maxBlockSize"),overflow:!0,overflowX:!0,overflowY:!0,overscrollBehavior:!0,overscrollBehaviorX:!0,overscrollBehaviorY:!0,display:!0,aspectRatio:!0,hideFrom:{scale:"breakpoints",transform:(n,e)=>{var l,u;return{[`@media screen and (min-width: ${((u=(l=e.__breakpoints)==null?void 0:l.get(n))==null?void 0:u.minW)??n})`]:{display:"none"}}}},hideBelow:{scale:"breakpoints",transform:(n,e)=>{var l,u;return{[`@media screen and (max-width: ${((u=(l=e.__breakpoints)==null?void 0:l.get(n))==null?void 0:u._minW)??n})`]:{display:"none"}}}},verticalAlign:!0,boxSizing:!0,boxDecorationBreak:!0,float:Ge.propT("float",Yr.float),objectFit:!0,objectPosition:!0,visibility:!0,isolation:!0};Object.assign(ad,{w:ad.width,h:ad.height,minW:ad.minWidth,maxW:ad.maxWidth,minH:ad.minHeight,maxH:ad.maxHeight,overscroll:ad.overscrollBehavior,overscrollX:ad.overscrollBehaviorX,overscrollY:ad.overscrollBehaviorY});const F0e={filter:{transform:Yr.filter},blur:Ge.blur("--chakra-blur"),brightness:Ge.propT("--chakra-brightness",Yr.brightness),contrast:Ge.propT("--chakra-contrast",Yr.contrast),hueRotate:Ge.propT("--chakra-hue-rotate",Yr.hueRotate),invert:Ge.propT("--chakra-invert",Yr.invert),saturate:Ge.propT("--chakra-saturate",Yr.saturate),dropShadow:Ge.propT("--chakra-drop-shadow",Yr.dropShadow),backdropFilter:{transform:Yr.backdropFilter},backdropBlur:Ge.blur("--chakra-backdrop-blur"),backdropBrightness:Ge.propT("--chakra-backdrop-brightness",Yr.brightness),backdropContrast:Ge.propT("--chakra-backdrop-contrast",Yr.contrast),backdropHueRotate:Ge.propT("--chakra-backdrop-hue-rotate",Yr.hueRotate),backdropInvert:Ge.propT("--chakra-backdrop-invert",Yr.invert),backdropSaturate:Ge.propT("--chakra-backdrop-saturate",Yr.saturate)},B0e={ring:{transform:Yr.ring},ringColor:Ge.colors("--chakra-ring-color"),ringOffset:Ge.prop("--chakra-ring-offset-width"),ringOffsetColor:Ge.colors("--chakra-ring-offset-color"),ringInset:Ge.prop("--chakra-ring-inset")},z0e={appearance:!0,cursor:!0,resize:!0,userSelect:!0,pointerEvents:!0,outline:{transform:Yr.outline},outlineOffset:!0,outlineColor:Ge.colors("outlineColor")},xee={gridGap:Ge.space("gridGap"),gridColumnGap:Ge.space("gridColumnGap"),gridRowGap:Ge.space("gridRowGap"),gridColumn:!0,gridRow:!0,gridAutoFlow:!0,gridAutoColumns:!0,gridColumnStart:!0,gridColumnEnd:!0,gridRowStart:!0,gridRowEnd:!0,gridAutoRows:!0,gridTemplate:!0,gridTemplateColumns:!0,gridTemplateRows:!0,gridTemplateAreas:!0,gridArea:!0};function W0e(n,e,i,o){const l=typeof e=="string"?e.split("."):[e];for(o=0;o<l.length&&n;o+=1)n=n[l[o]];return n===void 0?i:n}const G0e=n=>{const e=new WeakMap;return(o,l,u,p)=>{if(typeof o>"u")return n(o,l,u);e.has(o)||e.set(o,new Map);const y=e.get(o);if(y.has(l))return y.get(l);const E=n(o,l,u,p);return y.set(l,E),E}},H0e=G0e(W0e),$0e={border:"0px",clip:"rect(0, 0, 0, 0)",width:"1px",height:"1px",margin:"-1px",padding:"0px",overflow:"hidden",whiteSpace:"nowrap",position:"absolute"},K0e={position:"static",width:"auto",height:"auto",clip:"auto",padding:"0",margin:"0",overflow:"visible",whiteSpace:"normal"},cU=(n,e,i)=>{const o={},l=H0e(n,e,{});for(const u in l)u in i&&i[u]!=null||(o[u]=l[u]);return o},q0e={srOnly:{transform(n){return n===!0?$0e:n==="focusable"?K0e:{}}},layerStyle:{processResult:!0,transform:(n,e,i)=>cU(e,`layerStyles.${n}`,i)},textStyle:{processResult:!0,transform:(n,e,i)=>cU(e,`textStyles.${n}`,i)},apply:{processResult:!0,transform:(n,e,i)=>cU(e,n,i)}},MC={position:!0,pos:Ge.prop("position"),zIndex:Ge.prop("zIndex","zIndices"),inset:Ge.spaceT("inset"),insetX:Ge.spaceT(["left","right"]),insetInline:Ge.spaceT("insetInline"),insetY:Ge.spaceT(["top","bottom"]),insetBlock:Ge.spaceT("insetBlock"),top:Ge.spaceT("top"),insetBlockStart:Ge.spaceT("insetBlockStart"),bottom:Ge.spaceT("bottom"),insetBlockEnd:Ge.spaceT("insetBlockEnd"),left:Ge.spaceT("left"),insetInlineStart:Ge.logical({scale:"space",property:{ltr:"left",rtl:"right"}}),right:Ge.spaceT("right"),insetInlineEnd:Ge.logical({scale:"space",property:{ltr:"right",rtl:"left"}})};Object.assign(MC,{insetStart:MC.insetInlineStart,insetEnd:MC.insetInlineEnd});const NV={boxShadow:Ge.shadows("boxShadow"),mixBlendMode:!0,blendMode:Ge.prop("mixBlendMode"),backgroundBlendMode:!0,bgBlendMode:Ge.prop("backgroundBlendMode"),opacity:!0};Object.assign(NV,{shadow:NV.boxShadow});const cs={margin:Ge.spaceT("margin"),marginTop:Ge.spaceT("marginTop"),marginBlockStart:Ge.spaceT("marginBlockStart"),marginRight:Ge.spaceT("marginRight"),marginInlineEnd:Ge.spaceT("marginInlineEnd"),marginBottom:Ge.spaceT("marginBottom"),marginBlockEnd:Ge.spaceT("marginBlockEnd"),marginLeft:Ge.spaceT("marginLeft"),marginInlineStart:Ge.spaceT("marginInlineStart"),marginX:Ge.spaceT(["marginInlineStart","marginInlineEnd"]),marginInline:Ge.spaceT("marginInline"),marginY:Ge.spaceT(["marginTop","marginBottom"]),marginBlock:Ge.spaceT("marginBlock"),padding:Ge.space("padding"),paddingTop:Ge.space("paddingTop"),paddingBlockStart:Ge.space("paddingBlockStart"),paddingRight:Ge.space("paddingRight"),paddingBottom:Ge.space("paddingBottom"),paddingBlockEnd:Ge.space("paddingBlockEnd"),paddingLeft:Ge.space("paddingLeft"),paddingInlineStart:Ge.space("paddingInlineStart"),paddingInlineEnd:Ge.space("paddingInlineEnd"),paddingX:Ge.space(["paddingInlineStart","paddingInlineEnd"]),paddingInline:Ge.space("paddingInline"),paddingY:Ge.space(["paddingTop","paddingBottom"]),paddingBlock:Ge.space("paddingBlock")};Object.assign(cs,{m:cs.margin,mt:cs.marginTop,mr:cs.marginRight,me:cs.marginInlineEnd,marginEnd:cs.marginInlineEnd,mb:cs.marginBottom,ml:cs.marginLeft,ms:cs.marginInlineStart,marginStart:cs.marginInlineStart,mx:cs.marginX,my:cs.marginY,p:cs.padding,pt:cs.paddingTop,py:cs.paddingY,px:cs.paddingX,pb:cs.paddingBottom,pl:cs.paddingLeft,ps:cs.paddingInlineStart,paddingStart:cs.paddingInlineStart,pr:cs.paddingRight,pe:cs.paddingInlineEnd,paddingEnd:cs.paddingInlineEnd});const Y0e={scrollBehavior:!0,scrollSnapAlign:!0,scrollSnapStop:!0,scrollSnapType:!0,scrollMargin:Ge.spaceT("scrollMargin"),scrollMarginTop:Ge.spaceT("scrollMarginTop"),scrollMarginBottom:Ge.spaceT("scrollMarginBottom"),scrollMarginLeft:Ge.spaceT("scrollMarginLeft"),scrollMarginRight:Ge.spaceT("scrollMarginRight"),scrollMarginX:Ge.spaceT(["scrollMarginLeft","scrollMarginRight"]),scrollMarginY:Ge.spaceT(["scrollMarginTop","scrollMarginBottom"]),scrollPadding:Ge.spaceT("scrollPadding"),scrollPaddingTop:Ge.spaceT("scrollPaddingTop"),scrollPaddingBottom:Ge.spaceT("scrollPaddingBottom"),scrollPaddingLeft:Ge.spaceT("scrollPaddingLeft"),scrollPaddingRight:Ge.spaceT("scrollPaddingRight"),scrollPaddingX:Ge.spaceT(["scrollPaddingLeft","scrollPaddingRight"]),scrollPaddingY:Ge.spaceT(["scrollPaddingTop","scrollPaddingBottom"])},X0e={fontFamily:Ge.prop("fontFamily","fonts"),fontSize:Ge.prop("fontSize","fontSizes",Yr.px),fontWeight:Ge.prop("fontWeight","fontWeights"),lineHeight:Ge.prop("lineHeight","lineHeights"),letterSpacing:Ge.prop("letterSpacing","letterSpacings"),textAlign:!0,fontStyle:!0,textIndent:!0,wordBreak:!0,overflowWrap:!0,textOverflow:!0,textTransform:!0,whiteSpace:!0,isTruncated:{transform(n){if(n===!0)return{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"}}},noOfLines:{static:{overflow:"hidden",textOverflow:"ellipsis",display:"-webkit-box",WebkitBoxOrient:"vertical",WebkitLineClamp:"var(--chakra-line-clamp)"},property:"--chakra-line-clamp"}},J0e={textDecorationColor:Ge.colors("textDecorationColor"),textDecoration:!0,textDecor:{property:"textDecoration"},textDecorationLine:!0,textDecorationStyle:!0,textDecorationThickness:!0,textUnderlineOffset:!0,textShadow:Ge.shadows("textShadow")},Q0e={clipPath:!0,transform:Ge.propT("transform",Yr.transform),transformOrigin:!0,translateX:Ge.spaceT("--chakra-translate-x"),translateY:Ge.spaceT("--chakra-translate-y"),skewX:Ge.degreeT("--chakra-skew-x"),skewY:Ge.degreeT("--chakra-skew-y"),scaleX:Ge.prop("--chakra-scale-x"),scaleY:Ge.prop("--chakra-scale-y"),scale:Ge.prop(["--chakra-scale-x","--chakra-scale-y"]),rotate:Ge.degreeT("--chakra-rotate")},Z0e={listStyleType:!0,listStylePosition:!0,listStylePos:Ge.prop("listStylePosition"),listStyleImage:!0,listStyleImg:Ge.prop("listStyleImage")},eSe={transition:!0,transitionDelay:!0,animation:!0,willChange:!0,transitionDuration:Ge.prop("transitionDuration","transition.duration"),transitionProperty:Ge.prop("transitionProperty","transition.property"),transitionTimingFunction:Ge.prop("transitionTimingFunction","transition.easing")},uj=Op({},PO,mi,j0e,lk,ad,F0e,B0e,z0e,xee,q0e,MC,NV,cs,Y0e,X0e,J0e,Q0e,Z0e,eSe),tSe=Object.assign({},cs,ad,lk,xee,MC),nSe=Object.keys(tSe),rSe=[...Object.keys(uj),...kee],iSe={...uj,...mS},sSe=n=>n in iSe,oSe=n=>e=>{if(!e.__breakpoints)return n;const{isResponsive:i,toArrayValue:o,media:l}=e.__breakpoints,u={};for(const p in n){let y=Cl(n[p],e);if(y==null)continue;if(y=pd(y)&&i(y)?o(y):y,!Array.isArray(y)){u[p]=y;continue}const E=y.slice(0,l.length).length;for(let b=0;b<E;b+=1){const T=l==null?void 0:l[b];if(!T){u[p]=y[b];continue}u[T]=u[T]||{},y[b]!=null&&(u[T][p]=y[b])}}return u};function aSe(n){const e=[];let i="",o=!1;for(let l=0;l<n.length;l++){const u=n[l];u==="("?(o=!0,i+=u):u===")"?(o=!1,i+=u):u===","&&!o?(e.push(i),i=""):i+=u}return i=i.trim(),i&&e.push(i),e}function cSe(n){return/^var\(--.+\)$/.test(n)}const lSe=(n,e)=>n.startsWith("--")&&typeof e=="string"&&!cSe(e),uSe=(n,e)=>{if(e==null)return e;const i=p=>{var y,E;return(E=(y=n.__cssMap)==null?void 0:y[p])==null?void 0:E.varRef},o=p=>i(p)??p,[l,u]=aSe(e);return e=i(l)??o(u)??o(e),e};function dSe(n){const{configs:e={},pseudos:i={},theme:o}=n,l=(u,p=!1)=>{var T;const y=Cl(u,o),E=oSe(y)(o);let b={};for(let R in E){const O=E[R];let L=Cl(O,o);R in i&&(R=i[R]),lSe(R,L)&&(L=uSe(o,L));let D=e[R];if(D===!0&&(D={property:R}),pd(L)){b[R]=b[R]??{},b[R]=Op({},b[R],l(L,!0));continue}let U=((T=D==null?void 0:D.transform)==null?void 0:T.call(D,L,o,y))??L;U=D!=null&&D.processResult?l(U,!0):U;const F=Cl(D==null?void 0:D.property,o);if(!p&&(D!=null&&D.static)){const Y=Cl(D.static,o);b=Op({},b,Y)}if(F&&Array.isArray(F)){for(const Y of F)b[Y]=U;continue}if(F){F==="&"&&pd(U)?b=Op({},b,U):b[F]=U;continue}if(pd(U)){b=Op({},b,U);continue}b[R]=U}return b};return l}const Dee=n=>e=>dSe({theme:e,pseudos:mS,configs:uj})(n);function lHe(n){return n}function uHe(n){return n}function ts(n){return{definePartsStyle(e){return e},defineMultiStyleConfig(e){return{parts:n,...e}}}}function hSe(n,e,i){var o,l;return((l=(o=n.__cssMap)==null?void 0:o[`${e}.${i}`])==null?void 0:l.varRef)??i}function pSe(n,e){if(Array.isArray(n))return n;if(pd(n))return e(n);if(n!=null)return[n]}function fSe(n,e){for(let i=e+1;i<n.length;i++)if(n[i]!=null)return i;return-1}function mSe(n){const e=n.__breakpoints;return function(o,l,u,p){var O,L;if(!e)return;const y={},E=pSe(u,e.toArrayValue);if(!E)return y;const b=E.length,T=b===1,R=!!o.parts;for(let D=0;D<b;D++){const U=e.details[D],F=e.details[fSe(E,D)],Y=_C(U.minW,F==null?void 0:F._minW),W=Cl((O=o[l])==null?void 0:O[E[D]],p);if(W){if(R){(L=o.parts)==null||L.forEach(re=>{Op(y,{[re]:T?W[re]:{[Y]:W[re]}})});continue}if(!R){T?Op(y,W):y[Y]=W;continue}y[Y]=W}}return y}}function gSe(n){return e=>{const{variant:i,size:o,theme:l}=e,u=mSe(l);return Op({},Cl(n.baseStyle??{},e),u(n,"sizes",o,e),u(n,"variants",i,e))}}function Bi(n){return UR(n,["styleConfig","size","variant","colorScheme"])}function Lee(n){return pd(n)&&n.reference?n.reference:String(n)}const sN=(n,...e)=>e.map(Lee).join(` ${n} `).replace(/calc/g,""),kq=(...n)=>`calc(${sN("+",...n)})`,Nq=(...n)=>`calc(${sN("-",...n)})`,xV=(...n)=>`calc(${sN("*",...n)})`,xq=(...n)=>`calc(${sN("/",...n)})`,Dq=n=>{const e=Lee(n);return e!=null&&!Number.isNaN(parseFloat(e))?String(e).startsWith("-")?String(e).slice(1):`-${e}`:xV(e,-1)},Lf=Object.assign(n=>({add:(...e)=>Lf(kq(n,...e)),subtract:(...e)=>Lf(Nq(n,...e)),multiply:(...e)=>Lf(xV(n,...e)),divide:(...e)=>Lf(xq(n,...e)),negate:()=>Lf(Dq(n)),toString:()=>n.toString()}),{add:kq,subtract:Nq,multiply:xV,divide:xq,negate:Dq});function _Se(n,e="-"){return n.replace(/\s+/g,e)}function ySe(n){const e=_Se(n.toString());return vSe(ESe(e))}function ESe(n){return n.includes("\\.")?n:!Number.isInteger(parseFloat(n.toString()))?n.replace(".","\\."):n}function vSe(n){return n.replace(/[!-,/:-@[-^`{-~]/g,"\\$&")}function SSe(n,e=""){return[e,n].filter(Boolean).join("-")}function bSe(n,e){return`var(${n}${e?`, ${e}`:""})`}function wSe(n,e=""){return ySe(`--${SSe(n,e)}`)}function $n(n,e,i){const o=wSe(n,i);return{variable:o,reference:bSe(o,e)}}function TSe(n,e){const i={};for(const o of e){if(Array.isArray(o)){const[l,u]=o;i[l]=$n(`${n}-${l}`,u);continue}i[o]=$n(`${n}-${o}`)}return i}const CSe=["colors","borders","borderWidths","borderStyles","fonts","fontSizes","fontWeights","gradients","letterSpacings","lineHeights","radii","space","shadows","sizes","zIndices","transition","blur","breakpoints"];function RSe(n){return _ee(n,CSe)}function ISe(n){return n.semanticTokens}function ASe(n){const{__cssMap:e,__cssVars:i,__breakpoints:o,...l}=n;return l}function PSe(n){const e=RSe(n),i=ISe(n),o=u=>kee.includes(u)||u==="default",l={};return Sq(e,(u,p)=>{u!=null&&(l[p.join(".")]={isSemantic:!1,value:u})}),Sq(i,(u,p)=>{u!=null&&(l[p.join(".")]={isSemantic:!0,value:u})},{stop:u=>Object.keys(u).every(o)}),l}function Lq(n,e){return $n(String(n).replace(/\./g,"-"),void 0,e)}function OSe(n){var p;const e=PSe(n),i=(p=n.config)==null?void 0:p.cssVarPrefix;let o={};const l={};function u(y,E){const T=[String(y).split(".")[0],E].join(".");if(!e[T])return E;const{reference:O}=Lq(T,i);return O}for(const[y,E]of Object.entries(e)){const{isSemantic:b,value:T}=E,{variable:R,reference:O}=Lq(y,i);if(!b){if(y.startsWith("space")){const D=y.split("."),[U,...F]=D,Y=`${U}.-${F.join(".")}`,W=Lf.negate(T),re=Lf.negate(O);l[Y]={value:W,var:R,varRef:re}}o[R]=T,l[y]={value:T,var:R,varRef:O};continue}const L=pd(T)?T:{default:T};o=Op(o,Object.entries(L).reduce((D,[U,F])=>{if(!F)return D;const Y=u(y,`${F}`);if(U==="default")return D[R]=Y,D;const W=(mS==null?void 0:mS[U])??U;return D[W]={[R]:Y},D},{})),l[y]={value:O,var:R,varRef:O}}return{cssVars:o,cssMap:l}}function kSe(n){const e=ASe(n),{cssMap:i,cssVars:o}=OSe(e);return Object.assign(e,{__cssVars:{...{"--chakra-ring-inset":"var(--chakra-empty,/*!*/ /*!*/)","--chakra-ring-offset-width":"0px","--chakra-ring-offset-color":"#fff","--chakra-ring-color":"rgba(66, 153, 225, 0.6)","--chakra-ring-offset-shadow":"0 0 #0000","--chakra-ring-shadow":"0 0 #0000","--chakra-space-x-reverse":"0","--chakra-space-y-reverse":"0"},...o},__cssMap:i,__breakpoints:bve(e.breakpoints)}),e}function Si(n,e={}){let i=!1;function o(){if(!i){i=!0;return}throw new Error("[anatomy] .part(...) should only be called once. Did you mean to use .extend(...) ?")}function l(...T){o();for(const R of T)e[R]=E(R);return Si(n,e)}function u(...T){for(const R of T)R in e||(e[R]=E(R));return Si(n,e)}function p(){return Object.fromEntries(Object.entries(e).map(([R,O])=>[R,O.selector]))}function y(){return Object.fromEntries(Object.entries(e).map(([R,O])=>[R,O.className]))}function E(T){const L=`chakra-${(["container","root"].includes(T??"")?[n]:[n,T]).filter(Boolean).join("__")}`;return{className:L,selector:`.${L}`,toString:()=>T}}return{parts:l,toPart:E,extend:u,selectors:p,classnames:y,get keys(){return Object.keys(e)},__type:{}}}const NSe=Si("accordion").parts("root","container","button","panel","icon"),xSe=Si("alert").parts("title","description","container","icon","spinner"),DSe=Si("avatar").parts("label","badge","container","excessLabel","group"),LSe=Si("breadcrumb").parts("link","item","container","separator");Si("button").parts();const MSe=Si("checkbox").parts("control","icon","container","label");Si("progress").parts("track","filledTrack","label");const USe=Si("drawer").parts("overlay","dialogContainer","dialog","header","closeButton","body","footer"),VSe=Si("editable").parts("preview","input","textarea"),jSe=Si("form").parts("container","requiredIndicator","helperText"),FSe=Si("formError").parts("text","icon"),BSe=Si("input").parts("addon","field","element","group"),zSe=Si("list").parts("container","item","icon"),WSe=Si("menu").parts("button","list","item","groupTitle","icon","command","divider"),GSe=Si("modal").parts("overlay","dialogContainer","dialog","header","closeButton","body","footer"),HSe=Si("numberinput").parts("root","field","stepperGroup","stepper");Si("pininput").parts("field");const $Se=Si("popover").parts("content","header","body","footer","popper","arrow","closeButton"),KSe=Si("progress").parts("label","filledTrack","track"),qSe=Si("radio").parts("container","control","label"),YSe=Si("select").parts("field","icon"),XSe=Si("slider").parts("container","track","thumb","filledTrack","mark"),JSe=Si("stat").parts("container","label","helpText","number","icon"),QSe=Si("switch").parts("container","track","thumb","label"),ZSe=Si("table").parts("table","thead","tbody","tr","th","td","tfoot","caption"),ebe=Si("tabs").parts("root","tab","tablist","tabpanel","tabpanels","indicator"),tbe=Si("tag").parts("container","label","closeButton"),nbe=Si("card").parts("container","header","body","footer");Si("stepper").parts("stepper","step","title","description","indicator","separator","icon","number");const{definePartsStyle:rbe,defineMultiStyleConfig:ibe}=ts(NSe.keys),sbe={borderTopWidth:"1px",borderColor:"inherit",_last:{borderBottomWidth:"1px"}},obe={transitionProperty:"common",transitionDuration:"normal",fontSize:"md",_focusVisible:{boxShadow:"outline"},_hover:{bg:"blackAlpha.50"},_disabled:{opacity:.4,cursor:"not-allowed"},px:"4",py:"2"},abe={pt:"2",px:"4",pb:"5"},cbe={fontSize:"1.25em"},lbe=rbe({container:sbe,button:obe,panel:abe,icon:cbe}),ube=ibe({baseStyle:lbe});function Uy(n,e,i){return Math.min(Math.max(n,i),e)}class dbe extends Error{constructor(e){super(`Failed to parse color: "${e}"`)}}var EC=dbe;function dj(n){if(typeof n!="string")throw new EC(n);if(n.trim().toLowerCase()==="transparent")return[0,0,0,0];let e=n.trim();e=Ebe.test(n)?fbe(n):n;const i=mbe.exec(e);if(i){const p=Array.from(i).slice(1);return[...p.slice(0,3).map(y=>parseInt(sR(y,2),16)),parseInt(sR(p[3]||"f",2),16)/255]}const o=gbe.exec(e);if(o){const p=Array.from(o).slice(1);return[...p.slice(0,3).map(y=>parseInt(y,16)),parseInt(p[3]||"ff",16)/255]}const l=_be.exec(e);if(l){const p=Array.from(l).slice(1);return[...p.slice(0,3).map(y=>parseInt(y,10)),parseFloat(p[3]||"1")]}const u=ybe.exec(e);if(u){const[p,y,E,b]=Array.from(u).slice(1).map(parseFloat);if(Uy(0,100,y)!==y)throw new EC(n);if(Uy(0,100,E)!==E)throw new EC(n);return[...vbe(p,y,E),Number.isNaN(b)?1:b]}throw new EC(n)}function hbe(n){let e=5381,i=n.length;for(;i;)e=e*33^n.charCodeAt(--i);return(e>>>0)%2341}const Mq=n=>parseInt(n.replace(/_/g,""),36),pbe="1q29ehhb 1n09sgk7 1kl1ekf_ _yl4zsno 16z9eiv3 1p29lhp8 _bd9zg04 17u0____ _iw9zhe5 _to73___ _r45e31e _7l6g016 _jh8ouiv _zn3qba8 1jy4zshs 11u87k0u 1ro9yvyo 1aj3xael 1gz9zjz0 _3w8l4xo 1bf1ekf_ _ke3v___ _4rrkb__ 13j776yz _646mbhl _nrjr4__ _le6mbhl 1n37ehkb _m75f91n _qj3bzfz 1939yygw 11i5z6x8 _1k5f8xs 1509441m 15t5lwgf _ae2th1n _tg1ugcv 1lp1ugcv 16e14up_ _h55rw7n _ny9yavn _7a11xb_ 1ih442g9 _pv442g9 1mv16xof 14e6y7tu 1oo9zkds 17d1cisi _4v9y70f _y98m8kc 1019pq0v 12o9zda8 _348j4f4 1et50i2o _8epa8__ _ts6senj 1o350i2o 1mi9eiuo 1259yrp0 1ln80gnw _632xcoy 1cn9zldc _f29edu4 1n490c8q _9f9ziet 1b94vk74 _m49zkct 1kz6s73a 1eu9dtog _q58s1rz 1dy9sjiq __u89jo3 _aj5nkwg _ld89jo3 13h9z6wx _qa9z2ii _l119xgq _bs5arju 1hj4nwk9 1qt4nwk9 1ge6wau6 14j9zlcw 11p1edc_ _ms1zcxe _439shk6 _jt9y70f _754zsow 1la40eju _oq5p___ _x279qkz 1fa5r3rv _yd2d9ip _424tcku _8y1di2_ _zi2uabw _yy7rn9h 12yz980_ __39ljp6 1b59zg0x _n39zfzp 1fy9zest _b33k___ _hp9wq92 1il50hz4 _io472ub _lj9z3eo 19z9ykg0 _8t8iu3a 12b9bl4a 1ak5yw0o _896v4ku _tb8k8lv _s59zi6t _c09ze0p 1lg80oqn 1id9z8wb _238nba5 1kq6wgdi _154zssg _tn3zk49 _da9y6tc 1sg7cv4f _r12jvtt 1gq5fmkz 1cs9rvci _lp9jn1c _xw1tdnb 13f9zje6 16f6973h _vo7ir40 _bt5arjf _rc45e4t _hr4e100 10v4e100 _hc9zke2 _w91egv_ _sj2r1kk 13c87yx8 _vqpds__ _ni8ggk8 _tj9yqfb 1ia2j4r4 _7x9b10u 1fc9ld4j 1eq9zldr _5j9lhpx _ez9zl6o _md61fzm".split(" ").reduce((n,e)=>{const i=Mq(e.substring(0,3)),o=Mq(e.substring(3)).toString(16);let l="";for(let u=0;u<6-o.length;u++)l+="0";return n[i]=`${l}${o}`,n},{});function fbe(n){const e=n.toLowerCase().trim(),i=pbe[hbe(e)];if(!i)throw new EC(n);return`#${i}`}const sR=(n,e)=>Array.from(Array(e)).map(()=>n).join(""),mbe=new RegExp(`^#${sR("([a-f0-9])",3)}([a-f0-9])?$`,"i"),gbe=new RegExp(`^#${sR("([a-f0-9]{2})",3)}([a-f0-9]{2})?$`,"i"),_be=new RegExp(`^rgba?\\(\\s*(\\d+)\\s*${sR(",\\s*(\\d+)\\s*",2)}(?:,\\s*([\\d.]+))?\\s*\\)$`,"i"),ybe=/^hsla?\(\s*([\d.]+)\s*,\s*([\d.]+)%\s*,\s*([\d.]+)%(?:\s*,\s*([\d.]+))?\s*\)$/i,Ebe=/^[a-z]+$/i,Uq=n=>Math.round(n*255),vbe=(n,e,i)=>{let o=i/100;if(e===0)return[o,o,o].map(Uq);const l=(n%360+360)%360/60,u=(1-Math.abs(2*o-1))*(e/100),p=u*(1-Math.abs(l%2-1));let y=0,E=0,b=0;l>=0&&l<1?(y=u,E=p):l>=1&&l<2?(y=p,E=u):l>=2&&l<3?(E=u,b=p):l>=3&&l<4?(E=p,b=u):l>=4&&l<5?(y=p,b=u):l>=5&&l<6&&(y=u,b=p);const T=o-u/2,R=y+T,O=E+T,L=b+T;return[R,O,L].map(Uq)};function Sbe(n,e,i,o){return`rgba(${Uy(0,255,n).toFixed()}, ${Uy(0,255,e).toFixed()}, ${Uy(0,255,i).toFixed()}, ${parseFloat(Uy(0,1,o).toFixed(3))})`}function bbe(n,e){const[i,o,l,u]=dj(n);return Sbe(i,o,l,u-e)}function wbe(n){const[e,i,o,l]=dj(n);let u=p=>{const y=Uy(0,255,p).toString(16);return y.length===1?`0${y}`:y};return`#${u(e)}${u(i)}${u(o)}${l<1?u(Math.round(l*255)):""}`}const Tbe=n=>Object.keys(n).length===0;function Cbe(n,e,i,o,l){for(e=e.split?e.split("."):e,o=0;o<e.length;o++)n=n?n[e[o]]:l;return n===l?i:n}const Uc=(n,e,i)=>{const o=Cbe(n,`colors.${e}`,e);try{return wbe(o),o}catch{return i??"#000000"}},Rbe=n=>{const[e,i,o]=dj(n);return(e*299+i*587+o*114)/1e3},Ibe=n=>e=>{const i=Uc(e,n);return Rbe(i)<128?"dark":"light"},Abe=n=>e=>Ibe(n)(e)==="dark",DS=(n,e)=>i=>{const o=Uc(i,n);return bbe(o,1-e)};function Vq(n="1rem",e="rgba(255, 255, 255, 0.15)"){return{backgroundImage:`linear-gradient(
    45deg,
    ${e} 25%,
    transparent 25%,
    transparent 50%,
    ${e} 50%,
    ${e} 75%,
    transparent 75%,
    transparent
  )`,backgroundSize:`${n} ${n}`}}const Pbe=()=>`#${Math.floor(Math.random()*16777215).toString(16).padEnd(6,"0")}`;function Obe(n){const e=Pbe();return!n||Tbe(n)?e:n.string&&n.colors?Nbe(n.string,n.colors):n.string&&!n.colors?kbe(n.string):n.colors&&!n.string?xbe(n.colors):e}function kbe(n){let e=0;if(n.length===0)return e.toString();for(let o=0;o<n.length;o+=1)e=n.charCodeAt(o)+((e<<5)-e),e=e&e;let i="#";for(let o=0;o<3;o+=1){const l=e>>o*8&255;i+=`00${l.toString(16)}`.substr(-2)}return i}function Nbe(n,e){let i=0;if(n.length===0)return e[0];for(let o=0;o<n.length;o+=1)i=n.charCodeAt(o)+((i<<5)-i),i=i&i;return i=(i%e.length+e.length)%e.length,e[i]}function xbe(n){return n[Math.floor(Math.random()*n.length)]}function Hn(n,e){return i=>i.colorMode==="dark"?e:n}function hj(n){const{orientation:e,vertical:i,horizontal:o}=n;return e?e==="vertical"?i:o:{}}function Mee(n){return pd(n)&&n.reference?n.reference:String(n)}const oN=(n,...e)=>e.map(Mee).join(` ${n} `).replace(/calc/g,""),jq=(...n)=>`calc(${oN("+",...n)})`,Fq=(...n)=>`calc(${oN("-",...n)})`,DV=(...n)=>`calc(${oN("*",...n)})`,Bq=(...n)=>`calc(${oN("/",...n)})`,zq=n=>{const e=Mee(n);return e!=null&&!Number.isNaN(parseFloat(e))?String(e).startsWith("-")?String(e).slice(1):`-${e}`:DV(e,-1)},Mf=Object.assign(n=>({add:(...e)=>Mf(jq(n,...e)),subtract:(...e)=>Mf(Fq(n,...e)),multiply:(...e)=>Mf(DV(n,...e)),divide:(...e)=>Mf(Bq(n,...e)),negate:()=>Mf(zq(n)),toString:()=>n.toString()}),{add:jq,subtract:Fq,multiply:DV,divide:Bq,negate:zq});function Dbe(n){return!Number.isInteger(parseFloat(n.toString()))}function Lbe(n,e="-"){return n.replace(/\s+/g,e)}function Uee(n){const e=Lbe(n.toString());return e.includes("\\.")?n:Dbe(n)?e.replace(".","\\."):n}function Mbe(n,e=""){return[e,Uee(n)].filter(Boolean).join("-")}function Ube(n,e){return`var(${Uee(n)}${e?`, ${e}`:""})`}function Vbe(n,e=""){return`--${Mbe(n,e)}`}function Zo(n,e){const i=Vbe(n,e==null?void 0:e.prefix);return{variable:i,reference:Ube(i,jbe(e==null?void 0:e.fallback))}}function jbe(n){return n==null?void 0:n.reference}const{definePartsStyle:jR,defineMultiStyleConfig:Fbe}=ts(xSe.keys),mu=$n("alert-fg"),Jf=$n("alert-bg"),Bbe=jR({container:{bg:Jf.reference,px:"4",py:"3"},title:{fontWeight:"bold",lineHeight:"6",marginEnd:"2"},description:{lineHeight:"6"},icon:{color:mu.reference,flexShrink:0,marginEnd:"3",w:"5",h:"6"},spinner:{color:mu.reference,flexShrink:0,marginEnd:"3",w:"5",h:"5"}});function pj(n){const{theme:e,colorScheme:i}=n,o=DS(`${i}.200`,.16)(e);return{light:`colors.${i}.100`,dark:o}}const zbe=jR(n=>{const{colorScheme:e}=n,i=pj(n);return{container:{[mu.variable]:`colors.${e}.600`,[Jf.variable]:i.light,_dark:{[mu.variable]:`colors.${e}.200`,[Jf.variable]:i.dark}}}}),Wbe=jR(n=>{const{colorScheme:e}=n,i=pj(n);return{container:{[mu.variable]:`colors.${e}.600`,[Jf.variable]:i.light,_dark:{[mu.variable]:`colors.${e}.200`,[Jf.variable]:i.dark},paddingStart:"3",borderStartWidth:"4px",borderStartColor:mu.reference}}}),Gbe=jR(n=>{const{colorScheme:e}=n,i=pj(n);return{container:{[mu.variable]:`colors.${e}.600`,[Jf.variable]:i.light,_dark:{[mu.variable]:`colors.${e}.200`,[Jf.variable]:i.dark},pt:"2",borderTopWidth:"4px",borderTopColor:mu.reference}}}),Hbe=jR(n=>{const{colorScheme:e}=n;return{container:{[mu.variable]:"colors.white",[Jf.variable]:`colors.${e}.600`,_dark:{[mu.variable]:"colors.gray.900",[Jf.variable]:`colors.${e}.200`},color:mu.reference}}}),$be={subtle:zbe,"left-accent":Wbe,"top-accent":Gbe,solid:Hbe},Kbe=Fbe({baseStyle:Bbe,variants:$be,defaultProps:{variant:"subtle",colorScheme:"blue"}}),Vee={px:"1px",.5:"0.125rem",1:"0.25rem",1.5:"0.375rem",2:"0.5rem",2.5:"0.625rem",3:"0.75rem",3.5:"0.875rem",4:"1rem",5:"1.25rem",6:"1.5rem",7:"1.75rem",8:"2rem",9:"2.25rem",10:"2.5rem",12:"3rem",14:"3.5rem",16:"4rem",20:"5rem",24:"6rem",28:"7rem",32:"8rem",36:"9rem",40:"10rem",44:"11rem",48:"12rem",52:"13rem",56:"14rem",60:"15rem",64:"16rem",72:"18rem",80:"20rem",96:"24rem"},qbe={max:"max-content",min:"min-content",full:"100%","3xs":"14rem","2xs":"16rem",xs:"20rem",sm:"24rem",md:"28rem",lg:"32rem",xl:"36rem","2xl":"42rem","3xl":"48rem","4xl":"56rem","5xl":"64rem","6xl":"72rem","7xl":"80rem","8xl":"90rem",prose:"60ch"},Ybe={sm:"640px",md:"768px",lg:"1024px",xl:"1280px"},jee={...Vee,...qbe,container:Ybe},Xbe=n=>typeof n=="function";function Vc(n,...e){return Xbe(n)?n(...e):n}const{definePartsStyle:Fee,defineMultiStyleConfig:Jbe}=ts(DSe.keys),gS=$n("avatar-border-color"),UC=$n("avatar-bg"),oR=$n("avatar-font-size"),LS=$n("avatar-size"),Qbe={borderRadius:"full",border:"0.2em solid",borderColor:gS.reference,[gS.variable]:"white",_dark:{[gS.variable]:"colors.gray.800"}},Zbe={bg:UC.reference,fontSize:oR.reference,width:LS.reference,height:LS.reference,lineHeight:"1",[UC.variable]:"colors.gray.200",_dark:{[UC.variable]:"colors.whiteAlpha.400"}},ewe=n=>{const{name:e,theme:i}=n,o=e?Obe({string:e}):"colors.gray.400",l=Abe(o)(i);let u="white";return l||(u="gray.800"),{bg:UC.reference,fontSize:oR.reference,color:u,borderColor:gS.reference,verticalAlign:"top",width:LS.reference,height:LS.reference,"&:not([data-loaded])":{[UC.variable]:o},[gS.variable]:"colors.white",_dark:{[gS.variable]:"colors.gray.800"}}},twe={fontSize:oR.reference,lineHeight:"1"},nwe=Fee(n=>({badge:Vc(Qbe,n),excessLabel:Vc(Zbe,n),container:Vc(ewe,n),label:twe}));function Eg(n){const e=n!=="100%"?jee[n]:void 0;return Fee({container:{[LS.variable]:e??n,[oR.variable]:`calc(${e??n} / 2.5)`},excessLabel:{[LS.variable]:e??n,[oR.variable]:`calc(${e??n} / 2.5)`}})}const rwe={"2xs":Eg(4),xs:Eg(6),sm:Eg(8),md:Eg(12),lg:Eg(16),xl:Eg(24),"2xl":Eg(32),full:Eg("100%")},iwe=Jbe({baseStyle:nwe,sizes:rwe,defaultProps:{size:"md"}}),yo=TSe("badge",["bg","color","shadow"]),swe={px:1,textTransform:"uppercase",fontSize:"xs",borderRadius:"sm",fontWeight:"bold",bg:yo.bg.reference,color:yo.color.reference,boxShadow:yo.shadow.reference},owe=n=>{const{colorScheme:e,theme:i}=n,o=DS(`${e}.500`,.6)(i);return{[yo.bg.variable]:`colors.${e}.500`,[yo.color.variable]:"colors.white",_dark:{[yo.bg.variable]:o,[yo.color.variable]:"colors.whiteAlpha.800"}}},awe=n=>{const{colorScheme:e,theme:i}=n,o=DS(`${e}.200`,.16)(i);return{[yo.bg.variable]:`colors.${e}.100`,[yo.color.variable]:`colors.${e}.800`,_dark:{[yo.bg.variable]:o,[yo.color.variable]:`colors.${e}.200`}}},cwe=n=>{const{colorScheme:e,theme:i}=n,o=DS(`${e}.200`,.8)(i);return{[yo.color.variable]:`colors.${e}.500`,_dark:{[yo.color.variable]:o},[yo.shadow.variable]:`inset 0 0 0px 1px ${yo.color.reference}`}},lwe={solid:owe,subtle:awe,outline:cwe},VC={baseStyle:swe,variants:lwe,defaultProps:{variant:"subtle",colorScheme:"gray"}},{defineMultiStyleConfig:uwe,definePartsStyle:dwe}=ts(LSe.keys),lU=$n("breadcrumb-link-decor"),hwe={transitionProperty:"common",transitionDuration:"fast",transitionTimingFunction:"ease-out",outline:"none",color:"inherit",textDecoration:lU.reference,[lU.variable]:"none","&:not([aria-current=page])":{cursor:"pointer",_hover:{[lU.variable]:"underline"},_focusVisible:{boxShadow:"outline"}}},pwe=dwe({link:hwe}),fwe=uwe({baseStyle:pwe}),mwe={lineHeight:"1.2",borderRadius:"md",fontWeight:"semibold",transitionProperty:"common",transitionDuration:"normal",_focusVisible:{boxShadow:"outline"},_disabled:{opacity:.4,cursor:"not-allowed",boxShadow:"none"},_hover:{_disabled:{bg:"initial"}}},Bee=n=>{const{colorScheme:e,theme:i}=n;if(e==="gray")return{color:Hn("gray.800","whiteAlpha.900")(n),_hover:{bg:Hn("gray.100","whiteAlpha.200")(n)},_active:{bg:Hn("gray.200","whiteAlpha.300")(n)}};const o=DS(`${e}.200`,.12)(i),l=DS(`${e}.200`,.24)(i);return{color:Hn(`${e}.600`,`${e}.200`)(n),bg:"transparent",_hover:{bg:Hn(`${e}.50`,o)(n)},_active:{bg:Hn(`${e}.100`,l)(n)}}},gwe=n=>{const{colorScheme:e}=n,i=Hn("gray.200","whiteAlpha.300")(n);return{border:"1px solid",borderColor:e==="gray"?i:"currentColor",".chakra-button__group[data-attached][data-orientation=horizontal] > &:not(:last-of-type)":{marginEnd:"-1px"},".chakra-button__group[data-attached][data-orientation=vertical] > &:not(:last-of-type)":{marginBottom:"-1px"},...Vc(Bee,n)}},_we={yellow:{bg:"yellow.400",color:"black",hoverBg:"yellow.500",activeBg:"yellow.600"},cyan:{bg:"cyan.400",color:"black",hoverBg:"cyan.500",activeBg:"cyan.600"}},ywe=n=>{const{colorScheme:e}=n;if(e==="gray"){const y=Hn("gray.100","whiteAlpha.200")(n);return{bg:y,color:Hn("gray.800","whiteAlpha.900")(n),_hover:{bg:Hn("gray.200","whiteAlpha.300")(n),_disabled:{bg:y}},_active:{bg:Hn("gray.300","whiteAlpha.400")(n)}}}const{bg:i=`${e}.500`,color:o="white",hoverBg:l=`${e}.600`,activeBg:u=`${e}.700`}=_we[e]??{},p=Hn(i,`${e}.200`)(n);return{bg:p,color:Hn(o,"gray.800")(n),_hover:{bg:Hn(l,`${e}.300`)(n),_disabled:{bg:p}},_active:{bg:Hn(u,`${e}.400`)(n)}}},Ewe=n=>{const{colorScheme:e}=n;return{padding:0,height:"auto",lineHeight:"normal",verticalAlign:"baseline",color:Hn(`${e}.500`,`${e}.200`)(n),_hover:{textDecoration:"underline",_disabled:{textDecoration:"none"}},_active:{color:Hn(`${e}.700`,`${e}.500`)(n)}}},vwe={bg:"none",color:"inherit",display:"inline",lineHeight:"inherit",m:"0",p:"0"},Swe={ghost:Bee,outline:gwe,solid:ywe,link:Ewe,unstyled:vwe},bwe={lg:{h:"12",minW:"12",fontSize:"lg",px:"6"},md:{h:"10",minW:"10",fontSize:"md",px:"4"},sm:{h:"8",minW:"8",fontSize:"sm",px:"3"},xs:{h:"6",minW:"6",fontSize:"xs",px:"2"}},wwe={baseStyle:mwe,variants:Swe,sizes:bwe,defaultProps:{variant:"solid",size:"md",colorScheme:"gray"}},{definePartsStyle:Hy,defineMultiStyleConfig:Twe}=ts(nbe.keys),uk=$n("card-bg"),zf=$n("card-padding"),zee=$n("card-shadow"),OO=$n("card-radius"),Wee=$n("card-border-width","0"),Gee=$n("card-border-color"),Cwe=Hy({container:{[uk.variable]:"colors.chakra-body-bg",backgroundColor:uk.reference,boxShadow:zee.reference,borderRadius:OO.reference,color:"chakra-body-text",borderWidth:Wee.reference,borderColor:Gee.reference},body:{padding:zf.reference,flex:"1 1 0%"},header:{padding:zf.reference},footer:{padding:zf.reference}}),Rwe={sm:Hy({container:{[OO.variable]:"radii.base",[zf.variable]:"space.3"}}),md:Hy({container:{[OO.variable]:"radii.md",[zf.variable]:"space.5"}}),lg:Hy({container:{[OO.variable]:"radii.xl",[zf.variable]:"space.7"}})},Iwe={elevated:Hy({container:{[zee.variable]:"shadows.base",_dark:{[uk.variable]:"colors.gray.700"}}}),outline:Hy({container:{[Wee.variable]:"1px",[Gee.variable]:"colors.chakra-border-color"}}),filled:Hy({container:{[uk.variable]:"colors.chakra-subtle-bg"}}),unstyled:{body:{[zf.variable]:0},header:{[zf.variable]:0},footer:{[zf.variable]:0}}},Awe=Twe({baseStyle:Cwe,variants:Iwe,sizes:Rwe,defaultProps:{variant:"elevated",size:"md"}}),{definePartsStyle:kO,defineMultiStyleConfig:Pwe}=ts(MSe.keys),jC=$n("checkbox-size"),Owe=n=>{const{colorScheme:e}=n;return{w:jC.reference,h:jC.reference,transitionProperty:"box-shadow",transitionDuration:"normal",border:"2px solid",borderRadius:"sm",borderColor:"inherit",color:"white",_checked:{bg:Hn(`${e}.500`,`${e}.200`)(n),borderColor:Hn(`${e}.500`,`${e}.200`)(n),color:Hn("white","gray.900")(n),_hover:{bg:Hn(`${e}.600`,`${e}.300`)(n),borderColor:Hn(`${e}.600`,`${e}.300`)(n)},_disabled:{borderColor:Hn("gray.200","transparent")(n),bg:Hn("gray.200","whiteAlpha.300")(n),color:Hn("gray.500","whiteAlpha.500")(n)}},_indeterminate:{bg:Hn(`${e}.500`,`${e}.200`)(n),borderColor:Hn(`${e}.500`,`${e}.200`)(n),color:Hn("white","gray.900")(n)},_disabled:{bg:Hn("gray.100","whiteAlpha.100")(n),borderColor:Hn("gray.100","transparent")(n)},_focusVisible:{boxShadow:"outline"},_invalid:{borderColor:Hn("red.500","red.300")(n)}}},kwe={_disabled:{cursor:"not-allowed"}},Nwe={userSelect:"none",_disabled:{opacity:.4}},xwe={transitionProperty:"transform",transitionDuration:"normal"},Dwe=kO(n=>({icon:xwe,container:kwe,control:Vc(Owe,n),label:Nwe})),Lwe={sm:kO({control:{[jC.variable]:"sizes.3"},label:{fontSize:"sm"},icon:{fontSize:"3xs"}}),md:kO({control:{[jC.variable]:"sizes.4"},label:{fontSize:"md"},icon:{fontSize:"2xs"}}),lg:kO({control:{[jC.variable]:"sizes.5"},label:{fontSize:"lg"},icon:{fontSize:"2xs"}})},Cg=Pwe({baseStyle:Dwe,sizes:Lwe,defaultProps:{size:"md",colorScheme:"blue"}}),FC=Zo("close-button-size"),eC=Zo("close-button-bg"),Mwe={w:[FC.reference],h:[FC.reference],borderRadius:"md",transitionProperty:"common",transitionDuration:"normal",_disabled:{opacity:.4,cursor:"not-allowed",boxShadow:"none"},_hover:{[eC.variable]:"colors.blackAlpha.100",_dark:{[eC.variable]:"colors.whiteAlpha.100"}},_active:{[eC.variable]:"colors.blackAlpha.200",_dark:{[eC.variable]:"colors.whiteAlpha.200"}},_focusVisible:{boxShadow:"outline"},bg:eC.reference},Uwe={lg:{[FC.variable]:"sizes.10",fontSize:"md"},md:{[FC.variable]:"sizes.8",fontSize:"xs"},sm:{[FC.variable]:"sizes.6",fontSize:"2xs"}},Vwe={baseStyle:Mwe,sizes:Uwe,defaultProps:{size:"md"}},{variants:jwe,defaultProps:Fwe}=VC,Bwe={fontFamily:"mono",fontSize:"sm",px:"0.2em",borderRadius:"sm",bg:yo.bg.reference,color:yo.color.reference,boxShadow:yo.shadow.reference},zwe={baseStyle:Bwe,variants:jwe,defaultProps:Fwe},Wwe={w:"100%",mx:"auto",maxW:"prose",px:"4"},Gwe={baseStyle:Wwe},Hwe={opacity:.6,borderColor:"inherit"},$we={borderStyle:"solid"},Kwe={borderStyle:"dashed"},qwe={solid:$we,dashed:Kwe},Ywe={baseStyle:Hwe,variants:qwe,defaultProps:{variant:"solid"}},{definePartsStyle:LV,defineMultiStyleConfig:Xwe}=ts(USe.keys),uU=$n("drawer-bg"),dU=$n("drawer-box-shadow");function V0(n){return LV(n==="full"?{dialog:{maxW:"100vw",h:"100vh"}}:{dialog:{maxW:n}})}const Jwe={bg:"blackAlpha.600",zIndex:"modal"},Qwe={display:"flex",zIndex:"modal",justifyContent:"center"},Zwe=n=>{const{isFullHeight:e}=n;return{...e&&{height:"100vh"},zIndex:"modal",maxH:"100vh",color:"inherit",[uU.variable]:"colors.white",[dU.variable]:"shadows.lg",_dark:{[uU.variable]:"colors.gray.700",[dU.variable]:"shadows.dark-lg"},bg:uU.reference,boxShadow:dU.reference}},eTe={px:"6",py:"4",fontSize:"xl",fontWeight:"semibold"},tTe={position:"absolute",top:"2",insetEnd:"3"},nTe={px:"6",py:"2",flex:"1",overflow:"auto"},rTe={px:"6",py:"4"},iTe=LV(n=>({overlay:Jwe,dialogContainer:Qwe,dialog:Vc(Zwe,n),header:eTe,closeButton:tTe,body:nTe,footer:rTe})),sTe={xs:V0("xs"),sm:V0("md"),md:V0("lg"),lg:V0("2xl"),xl:V0("4xl"),full:V0("full")},oTe=Xwe({baseStyle:iTe,sizes:sTe,defaultProps:{size:"xs"}}),{definePartsStyle:aTe,defineMultiStyleConfig:cTe}=ts(VSe.keys),lTe={borderRadius:"md",py:"1",transitionProperty:"common",transitionDuration:"normal"},uTe={borderRadius:"md",py:"1",transitionProperty:"common",transitionDuration:"normal",width:"full",_focusVisible:{boxShadow:"outline"},_placeholder:{opacity:.6}},dTe={borderRadius:"md",py:"1",transitionProperty:"common",transitionDuration:"normal",width:"full",_focusVisible:{boxShadow:"outline"},_placeholder:{opacity:.6}},hTe=aTe({preview:lTe,input:uTe,textarea:dTe}),pTe=cTe({baseStyle:hTe}),{definePartsStyle:fTe,defineMultiStyleConfig:mTe}=ts(jSe.keys),_S=$n("form-control-color"),gTe={marginStart:"1",[_S.variable]:"colors.red.500",_dark:{[_S.variable]:"colors.red.300"},color:_S.reference},_Te={mt:"2",[_S.variable]:"colors.gray.600",_dark:{[_S.variable]:"colors.whiteAlpha.600"},color:_S.reference,lineHeight:"normal",fontSize:"sm"},yTe=fTe({container:{width:"100%",position:"relative"},requiredIndicator:gTe,helperText:_Te}),ETe=mTe({baseStyle:yTe}),{definePartsStyle:vTe,defineMultiStyleConfig:STe}=ts(FSe.keys),yS=$n("form-error-color"),bTe={[yS.variable]:"colors.red.500",_dark:{[yS.variable]:"colors.red.300"},color:yS.reference,mt:"2",fontSize:"sm",lineHeight:"normal"},wTe={marginEnd:"0.5em",[yS.variable]:"colors.red.500",_dark:{[yS.variable]:"colors.red.300"},color:yS.reference},TTe=vTe({text:bTe,icon:wTe}),CTe=STe({baseStyle:TTe}),RTe={fontSize:"md",marginEnd:"3",mb:"2",fontWeight:"medium",transitionProperty:"common",transitionDuration:"normal",opacity:1,_disabled:{opacity:.4}},ITe={baseStyle:RTe},ATe={fontFamily:"heading",fontWeight:"bold"},PTe={"4xl":{fontSize:["6xl",null,"7xl"],lineHeight:1},"3xl":{fontSize:["5xl",null,"6xl"],lineHeight:1},"2xl":{fontSize:["4xl",null,"5xl"],lineHeight:[1.2,null,1]},xl:{fontSize:["3xl",null,"4xl"],lineHeight:[1.33,null,1.2]},lg:{fontSize:["2xl",null,"3xl"],lineHeight:[1.33,null,1.2]},md:{fontSize:"xl",lineHeight:1.2},sm:{fontSize:"md",lineHeight:1.2},xs:{fontSize:"sm",lineHeight:1.2}},OTe={baseStyle:ATe,sizes:PTe,defaultProps:{size:"xl"}},{definePartsStyle:Vf,defineMultiStyleConfig:kTe}=ts(BSe.keys),eS=$n("input-height"),tS=$n("input-font-size"),nS=$n("input-padding"),rS=$n("input-border-radius"),NTe=Vf({addon:{height:eS.reference,fontSize:tS.reference,px:nS.reference,borderRadius:rS.reference},field:{width:"100%",height:eS.reference,fontSize:tS.reference,px:nS.reference,borderRadius:rS.reference,minWidth:0,outline:0,position:"relative",appearance:"none",transitionProperty:"common",transitionDuration:"normal",_disabled:{opacity:.4,cursor:"not-allowed"}}}),vg={lg:{[tS.variable]:"fontSizes.lg",[nS.variable]:"space.4",[rS.variable]:"radii.md",[eS.variable]:"sizes.12"},md:{[tS.variable]:"fontSizes.md",[nS.variable]:"space.4",[rS.variable]:"radii.md",[eS.variable]:"sizes.10"},sm:{[tS.variable]:"fontSizes.sm",[nS.variable]:"space.3",[rS.variable]:"radii.sm",[eS.variable]:"sizes.8"},xs:{[tS.variable]:"fontSizes.xs",[nS.variable]:"space.2",[rS.variable]:"radii.sm",[eS.variable]:"sizes.6"}},xTe={lg:Vf({field:vg.lg,group:vg.lg}),md:Vf({field:vg.md,group:vg.md}),sm:Vf({field:vg.sm,group:vg.sm}),xs:Vf({field:vg.xs,group:vg.xs})};function fj(n){const{focusBorderColor:e,errorBorderColor:i}=n;return{focusBorderColor:e||Hn("blue.500","blue.300")(n),errorBorderColor:i||Hn("red.500","red.300")(n)}}const DTe=Vf(n=>{const{theme:e}=n,{focusBorderColor:i,errorBorderColor:o}=fj(n);return{field:{border:"1px solid",borderColor:"inherit",bg:"inherit",_hover:{borderColor:Hn("gray.300","whiteAlpha.400")(n)},_readOnly:{boxShadow:"none !important",userSelect:"all"},_invalid:{borderColor:Uc(e,o),boxShadow:`0 0 0 1px ${Uc(e,o)}`},_focusVisible:{zIndex:1,borderColor:Uc(e,i),boxShadow:`0 0 0 1px ${Uc(e,i)}`}},addon:{border:"1px solid",borderColor:Hn("inherit","whiteAlpha.50")(n),bg:Hn("gray.100","whiteAlpha.300")(n)}}}),LTe=Vf(n=>{const{theme:e}=n,{focusBorderColor:i,errorBorderColor:o}=fj(n);return{field:{border:"2px solid",borderColor:"transparent",bg:Hn("gray.100","whiteAlpha.50")(n),_hover:{bg:Hn("gray.200","whiteAlpha.100")(n)},_readOnly:{boxShadow:"none !important",userSelect:"all"},_invalid:{borderColor:Uc(e,o)},_focusVisible:{bg:"transparent",borderColor:Uc(e,i)}},addon:{border:"2px solid",borderColor:"transparent",bg:Hn("gray.100","whiteAlpha.50")(n)}}}),MTe=Vf(n=>{const{theme:e}=n,{focusBorderColor:i,errorBorderColor:o}=fj(n);return{field:{borderBottom:"1px solid",borderColor:"inherit",borderRadius:"0",px:"0",bg:"transparent",_readOnly:{boxShadow:"none !important",userSelect:"all"},_invalid:{borderColor:Uc(e,o),boxShadow:`0px 1px 0px 0px ${Uc(e,o)}`},_focusVisible:{borderColor:Uc(e,i),boxShadow:`0px 1px 0px 0px ${Uc(e,i)}`}},addon:{borderBottom:"2px solid",borderColor:"inherit",borderRadius:"0",px:"0",bg:"transparent"}}}),UTe=Vf({field:{bg:"transparent",px:"0",height:"auto"},addon:{bg:"transparent",px:"0",height:"auto"}}),VTe={outline:DTe,filled:LTe,flushed:MTe,unstyled:UTe},vi=kTe({baseStyle:NTe,sizes:xTe,variants:VTe,defaultProps:{size:"md",variant:"outline"}}),hU=$n("kbd-bg"),jTe={[hU.variable]:"colors.gray.100",_dark:{[hU.variable]:"colors.whiteAlpha.100"},bg:hU.reference,borderRadius:"md",borderWidth:"1px",borderBottomWidth:"3px",fontSize:"0.8em",fontWeight:"bold",lineHeight:"normal",px:"0.4em",whiteSpace:"nowrap"},FTe={baseStyle:jTe},BTe={transitionProperty:"common",transitionDuration:"fast",transitionTimingFunction:"ease-out",cursor:"pointer",textDecoration:"none",outline:"none",color:"inherit",_hover:{textDecoration:"underline"},_focusVisible:{boxShadow:"outline"}},zTe={baseStyle:BTe},{defineMultiStyleConfig:WTe,definePartsStyle:GTe}=ts(zSe.keys),HTe={marginEnd:"2",display:"inline",verticalAlign:"text-bottom"},$Te=GTe({icon:HTe}),KTe=WTe({baseStyle:$Te}),{defineMultiStyleConfig:qTe,definePartsStyle:YTe}=ts(WSe.keys),bp=$n("menu-bg"),pU=$n("menu-shadow"),XTe={[bp.variable]:"#fff",[pU.variable]:"shadows.sm",_dark:{[bp.variable]:"colors.gray.700",[pU.variable]:"shadows.dark-lg"},color:"inherit",minW:"3xs",py:"2",zIndex:"dropdown",borderRadius:"md",borderWidth:"1px",bg:bp.reference,boxShadow:pU.reference},JTe={py:"1.5",px:"3",transitionProperty:"background",transitionDuration:"ultra-fast",transitionTimingFunction:"ease-in",_focus:{[bp.variable]:"colors.gray.100",_dark:{[bp.variable]:"colors.whiteAlpha.100"}},_active:{[bp.variable]:"colors.gray.200",_dark:{[bp.variable]:"colors.whiteAlpha.200"}},_expanded:{[bp.variable]:"colors.gray.100",_dark:{[bp.variable]:"colors.whiteAlpha.100"}},_disabled:{opacity:.4,cursor:"not-allowed"},bg:bp.reference},QTe={mx:4,my:2,fontWeight:"semibold",fontSize:"sm"},ZTe={display:"inline-flex",alignItems:"center",justifyContent:"center",flexShrink:0},eCe={opacity:.6},tCe={border:0,borderBottom:"1px solid",borderColor:"inherit",my:"2",opacity:.6},nCe={transitionProperty:"common",transitionDuration:"normal"},rCe=YTe({button:nCe,list:XTe,item:JTe,groupTitle:QTe,icon:ZTe,command:eCe,divider:tCe}),iCe=qTe({baseStyle:rCe}),{defineMultiStyleConfig:sCe,definePartsStyle:MV}=ts(GSe.keys),fU=$n("modal-bg"),mU=$n("modal-shadow"),oCe={bg:"blackAlpha.600",zIndex:"modal"},aCe=n=>{const{isCentered:e,scrollBehavior:i}=n;return{display:"flex",zIndex:"modal",justifyContent:"center",alignItems:e?"center":"flex-start",overflow:i==="inside"?"hidden":"auto",overscrollBehaviorY:"none"}},cCe=n=>{const{isCentered:e,scrollBehavior:i}=n;return{borderRadius:"md",color:"inherit",my:e?"auto":"16",mx:e?"auto":void 0,zIndex:"modal",maxH:i==="inside"?"calc(100% - 7.5rem)":void 0,[fU.variable]:"colors.white",[mU.variable]:"shadows.lg",_dark:{[fU.variable]:"colors.gray.700",[mU.variable]:"shadows.dark-lg"},bg:fU.reference,boxShadow:mU.reference}},lCe={px:"6",py:"4",fontSize:"xl",fontWeight:"semibold"},uCe={position:"absolute",top:"2",insetEnd:"3"},dCe=n=>{const{scrollBehavior:e}=n;return{px:"6",py:"2",flex:"1",overflow:e==="inside"?"auto":void 0}},hCe={px:"6",py:"4"},pCe=MV(n=>({overlay:oCe,dialogContainer:Vc(aCe,n),dialog:Vc(cCe,n),header:lCe,closeButton:uCe,body:Vc(dCe,n),footer:hCe}));function lh(n){return MV(n==="full"?{dialog:{maxW:"100vw",minH:"$100vh",my:"0",borderRadius:"0"}}:{dialog:{maxW:n}})}const fCe={xs:lh("xs"),sm:lh("sm"),md:lh("md"),lg:lh("lg"),xl:lh("xl"),"2xl":lh("2xl"),"3xl":lh("3xl"),"4xl":lh("4xl"),"5xl":lh("5xl"),"6xl":lh("6xl"),full:lh("full")},mCe=sCe({baseStyle:pCe,sizes:fCe,defaultProps:{size:"md"}}),Hee={letterSpacings:{tighter:"-0.05em",tight:"-0.025em",normal:"0",wide:"0.025em",wider:"0.05em",widest:"0.1em"},lineHeights:{normal:"normal",none:1,shorter:1.25,short:1.375,base:1.5,tall:1.625,taller:"2",3:".75rem",4:"1rem",5:"1.25rem",6:"1.5rem",7:"1.75rem",8:"2rem",9:"2.25rem",10:"2.5rem"},fontWeights:{hairline:100,thin:200,light:300,normal:400,medium:500,semibold:600,bold:700,extrabold:800,black:900},fonts:{heading:'-apple-system, BlinkMacSystemFont, "Segoe UI", Helvetica, Arial, sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol"',body:'-apple-system, BlinkMacSystemFont, "Segoe UI", Helvetica, Arial, sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol"',mono:'SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono","Courier New",monospace'},fontSizes:{"3xs":"0.45rem","2xs":"0.625rem",xs:"0.75rem",sm:"0.875rem",md:"1rem",lg:"1.125rem",xl:"1.25rem","2xl":"1.5rem","3xl":"1.875rem","4xl":"2.25rem","5xl":"3rem","6xl":"3.75rem","7xl":"4.5rem","8xl":"6rem","9xl":"8rem"}},{defineMultiStyleConfig:gCe,definePartsStyle:$ee}=ts(HSe.keys),mj=Zo("number-input-stepper-width"),Kee=Zo("number-input-input-padding"),_Ce=Mf(mj).add("0.5rem").toString(),gU=Zo("number-input-bg"),_U=Zo("number-input-color"),yU=Zo("number-input-border-color"),yCe={[mj.variable]:"sizes.6",[Kee.variable]:_Ce},ECe=n=>{var e;return((e=Vc(vi.baseStyle,n))==null?void 0:e.field)??{}},vCe={width:mj.reference},SCe={borderStart:"1px solid",borderStartColor:yU.reference,color:_U.reference,bg:gU.reference,[_U.variable]:"colors.chakra-body-text",[yU.variable]:"colors.chakra-border-color",_dark:{[_U.variable]:"colors.whiteAlpha.800",[yU.variable]:"colors.whiteAlpha.300"},_active:{[gU.variable]:"colors.gray.200",_dark:{[gU.variable]:"colors.whiteAlpha.300"}},_disabled:{opacity:.4,cursor:"not-allowed"}},bCe=$ee(n=>({root:yCe,field:Vc(ECe,n)??{},stepperGroup:vCe,stepper:SCe}));function JP(n){var u,p;const e=(u=vi.sizes)==null?void 0:u[n],i={lg:"md",md:"md",sm:"sm",xs:"sm"},o=((p=e.field)==null?void 0:p.fontSize)??"md",l=Hee.fontSizes[o];return $ee({field:{...e.field,paddingInlineEnd:Kee.reference,verticalAlign:"top"},stepper:{fontSize:Mf(l).multiply(.75).toString(),_first:{borderTopEndRadius:i[n]},_last:{borderBottomEndRadius:i[n],mt:"-1px",borderTopWidth:1}}})}const wCe={xs:JP("xs"),sm:JP("sm"),md:JP("md"),lg:JP("lg")},TCe=gCe({baseStyle:bCe,sizes:wCe,variants:vi.variants,defaultProps:vi.defaultProps});var GZ;const CCe={...(GZ=vi.baseStyle)==null?void 0:GZ.field,textAlign:"center"},RCe={lg:{fontSize:"lg",w:12,h:12,borderRadius:"md"},md:{fontSize:"md",w:10,h:10,borderRadius:"md"},sm:{fontSize:"sm",w:8,h:8,borderRadius:"sm"},xs:{fontSize:"xs",w:6,h:6,borderRadius:"sm"}};var HZ;const ICe={outline:n=>{var e,i;return((i=Vc((e=vi.variants)==null?void 0:e.outline,n))==null?void 0:i.field)??{}},flushed:n=>{var e,i;return((i=Vc((e=vi.variants)==null?void 0:e.flushed,n))==null?void 0:i.field)??{}},filled:n=>{var e,i;return((i=Vc((e=vi.variants)==null?void 0:e.filled,n))==null?void 0:i.field)??{}},unstyled:((HZ=vi.variants)==null?void 0:HZ.unstyled.field)??{}},ACe={baseStyle:CCe,sizes:RCe,variants:ICe,defaultProps:vi.defaultProps},{defineMultiStyleConfig:PCe,definePartsStyle:OCe}=ts($Se.keys),QP=Zo("popper-bg"),kCe=Zo("popper-arrow-bg"),Wq=Zo("popper-arrow-shadow-color"),NCe={zIndex:"popover"},xCe={[QP.variable]:"colors.white",bg:QP.reference,[kCe.variable]:QP.reference,[Wq.variable]:"colors.gray.200",_dark:{[QP.variable]:"colors.gray.700",[Wq.variable]:"colors.whiteAlpha.300"},width:"xs",border:"1px solid",borderColor:"inherit",borderRadius:"md",boxShadow:"sm",zIndex:"inherit",_focusVisible:{outline:0,boxShadow:"outline"}},DCe={px:3,py:2,borderBottomWidth:"1px"},LCe={px:3,py:2},MCe={px:3,py:2,borderTopWidth:"1px"},UCe={position:"absolute",borderRadius:"md",top:1,insetEnd:2,padding:2},VCe=OCe({popper:NCe,content:xCe,header:DCe,body:LCe,footer:MCe,closeButton:UCe}),jCe=PCe({baseStyle:VCe}),{defineMultiStyleConfig:FCe,definePartsStyle:vC}=ts(KSe.keys),BCe=n=>{const{colorScheme:e,theme:i,isIndeterminate:o,hasStripe:l}=n,u=Hn(Vq(),Vq("1rem","rgba(0,0,0,0.1)"))(n),p=Hn(`${e}.500`,`${e}.200`)(n),y=`linear-gradient(
    to right,
    transparent 0%,
    ${Uc(i,p)} 50%,
    transparent 100%
  )`;return{...!o&&l&&u,...o?{bgImage:y}:{bgColor:p}}},zCe={lineHeight:"1",fontSize:"0.25em",fontWeight:"bold",color:"white"},WCe=n=>({bg:Hn("gray.100","whiteAlpha.300")(n)}),GCe=n=>({transitionProperty:"common",transitionDuration:"slow",...BCe(n)}),HCe=vC(n=>({label:zCe,filledTrack:GCe(n),track:WCe(n)})),$Ce={xs:vC({track:{h:"1"}}),sm:vC({track:{h:"2"}}),md:vC({track:{h:"3"}}),lg:vC({track:{h:"4"}})},KCe=FCe({sizes:$Ce,baseStyle:HCe,defaultProps:{size:"md",colorScheme:"blue"}}),{defineMultiStyleConfig:qCe,definePartsStyle:NO}=ts(qSe.keys),YCe=n=>{var i;const e=(i=Vc(Cg.baseStyle,n))==null?void 0:i.control;return{...e,borderRadius:"full",_checked:{...e==null?void 0:e._checked,_before:{content:'""',display:"inline-block",pos:"relative",w:"50%",h:"50%",borderRadius:"50%",bg:"currentColor"}}}},XCe=NO(n=>{var e,i;return{label:(e=Cg.baseStyle)==null?void 0:e.call(Cg,n).label,container:(i=Cg.baseStyle)==null?void 0:i.call(Cg,n).container,control:YCe(n)}}),JCe={md:NO({control:{w:"4",h:"4"},label:{fontSize:"md"}}),lg:NO({control:{w:"5",h:"5"},label:{fontSize:"lg"}}),sm:NO({control:{width:"3",height:"3"},label:{fontSize:"sm"}})},QCe=qCe({baseStyle:XCe,sizes:JCe,defaultProps:{size:"md",colorScheme:"blue"}}),{defineMultiStyleConfig:ZCe,definePartsStyle:eRe}=ts(YSe.keys),ZP=$n("select-bg");var $Z;const tRe={...($Z=vi.baseStyle)==null?void 0:$Z.field,appearance:"none",paddingBottom:"1px",lineHeight:"normal",bg:ZP.reference,[ZP.variable]:"colors.white",_dark:{[ZP.variable]:"colors.gray.700"},"> option, > optgroup":{bg:ZP.reference}},nRe={width:"6",height:"100%",insetEnd:"2",position:"relative",color:"currentColor",fontSize:"xl",_disabled:{opacity:.5}},rRe=eRe({field:tRe,icon:nRe}),eO={paddingInlineEnd:"8"};var KZ,qZ,YZ,XZ,JZ,QZ,ZZ,eee;const iRe={lg:{...(KZ=vi.sizes)==null?void 0:KZ.lg,field:{...(qZ=vi.sizes)==null?void 0:qZ.lg.field,...eO}},md:{...(YZ=vi.sizes)==null?void 0:YZ.md,field:{...(XZ=vi.sizes)==null?void 0:XZ.md.field,...eO}},sm:{...(JZ=vi.sizes)==null?void 0:JZ.sm,field:{...(QZ=vi.sizes)==null?void 0:QZ.sm.field,...eO}},xs:{...(ZZ=vi.sizes)==null?void 0:ZZ.xs,field:{...(eee=vi.sizes)==null?void 0:eee.xs.field,...eO},icon:{insetEnd:"1"}}},sRe=ZCe({baseStyle:rRe,sizes:iRe,variants:vi.variants,defaultProps:vi.defaultProps}),EU=$n("skeleton-start-color"),vU=$n("skeleton-end-color"),oRe={[EU.variable]:"colors.gray.100",[vU.variable]:"colors.gray.400",_dark:{[EU.variable]:"colors.gray.800",[vU.variable]:"colors.gray.600"},background:EU.reference,borderColor:vU.reference,opacity:.7,borderRadius:"sm"},aRe={baseStyle:oRe},SU=$n("skip-link-bg"),cRe={borderRadius:"md",fontWeight:"semibold",_focusVisible:{boxShadow:"outline",padding:"4",position:"fixed",top:"6",insetStart:"6",[SU.variable]:"colors.white",_dark:{[SU.variable]:"colors.gray.700"},bg:SU.reference}},lRe={baseStyle:cRe},{defineMultiStyleConfig:uRe,definePartsStyle:aN}=ts(XSe.keys),rE=$n("slider-thumb-size"),aR=$n("slider-track-size"),Rg=$n("slider-bg"),dRe=n=>{const{orientation:e}=n;return{display:"inline-block",position:"relative",cursor:"pointer",_disabled:{opacity:.6,cursor:"default",pointerEvents:"none"},...hj({orientation:e,vertical:{h:"100%",px:Lf(rE.reference).divide(2).toString()},horizontal:{w:"100%",py:Lf(rE.reference).divide(2).toString()}})}},hRe=n=>({...hj({orientation:n.orientation,horizontal:{h:aR.reference},vertical:{w:aR.reference}}),overflow:"hidden",borderRadius:"sm",[Rg.variable]:"colors.gray.200",_dark:{[Rg.variable]:"colors.whiteAlpha.200"},_disabled:{[Rg.variable]:"colors.gray.300",_dark:{[Rg.variable]:"colors.whiteAlpha.300"}},bg:Rg.reference}),pRe=n=>{const{orientation:e}=n;return{...hj({orientation:e,vertical:{left:"50%"},horizontal:{top:"50%"}}),w:rE.reference,h:rE.reference,display:"flex",alignItems:"center",justifyContent:"center",position:"absolute",outline:0,zIndex:1,borderRadius:"full",bg:"white",boxShadow:"base",border:"1px solid",borderColor:"transparent",transitionProperty:"transform",transitionDuration:"normal",_focusVisible:{boxShadow:"outline"},_active:{"--slider-thumb-scale":"1.15"},_disabled:{bg:"gray.300"}}},fRe=n=>{const{colorScheme:e}=n;return{width:"inherit",height:"inherit",[Rg.variable]:`colors.${e}.500`,_dark:{[Rg.variable]:`colors.${e}.200`},bg:Rg.reference}},mRe=aN(n=>({container:dRe(n),track:hRe(n),thumb:pRe(n),filledTrack:fRe(n)})),gRe=aN({container:{[rE.variable]:"sizes.4",[aR.variable]:"sizes.1"}}),_Re=aN({container:{[rE.variable]:"sizes.3.5",[aR.variable]:"sizes.1"}}),yRe=aN({container:{[rE.variable]:"sizes.2.5",[aR.variable]:"sizes.0.5"}}),ERe={lg:gRe,md:_Re,sm:yRe},vRe=uRe({baseStyle:mRe,sizes:ERe,defaultProps:{size:"md",colorScheme:"blue"}}),Ly=Zo("spinner-size"),SRe={width:[Ly.reference],height:[Ly.reference]},bRe={xs:{[Ly.variable]:"sizes.3"},sm:{[Ly.variable]:"sizes.4"},md:{[Ly.variable]:"sizes.6"},lg:{[Ly.variable]:"sizes.8"},xl:{[Ly.variable]:"sizes.12"}},wRe={baseStyle:SRe,sizes:bRe,defaultProps:{size:"md"}},{defineMultiStyleConfig:TRe,definePartsStyle:qee}=ts(JSe.keys),CRe={fontWeight:"medium"},RRe={opacity:.8,marginBottom:"2"},IRe={verticalAlign:"baseline",fontWeight:"semibold"},ARe={marginEnd:1,w:"3.5",h:"3.5",verticalAlign:"middle"},PRe=qee({container:{},label:CRe,helpText:RRe,number:IRe,icon:ARe}),ORe={md:qee({label:{fontSize:"sm"},helpText:{fontSize:"sm"},number:{fontSize:"2xl"}})},kRe=TRe({baseStyle:PRe,sizes:ORe,defaultProps:{size:"md"}}),{defineMultiStyleConfig:NRe,definePartsStyle:SC}=ts(["stepper","step","title","description","indicator","separator","icon","number"]),Uf=$n("stepper-indicator-size"),iS=$n("stepper-icon-size"),sS=$n("stepper-title-font-size"),bC=$n("stepper-description-font-size"),tC=$n("stepper-accent-color"),xRe=SC(({colorScheme:n})=>({stepper:{display:"flex",justifyContent:"space-between",gap:"4","&[data-orientation=vertical]":{flexDirection:"column",alignItems:"flex-start"},"&[data-orientation=horizontal]":{flexDirection:"row",alignItems:"center"},[tC.variable]:`colors.${n}.500`,_dark:{[tC.variable]:`colors.${n}.200`}},title:{fontSize:sS.reference,fontWeight:"medium"},description:{fontSize:bC.reference,color:"chakra-subtle-text"},number:{fontSize:sS.reference},step:{flexShrink:0,position:"relative",display:"flex",gap:"2","&[data-orientation=horizontal]":{alignItems:"center"},flex:"1","&:last-of-type:not([data-stretch])":{flex:"initial"}},icon:{flexShrink:0,width:iS.reference,height:iS.reference},indicator:{flexShrink:0,borderRadius:"full",width:Uf.reference,height:Uf.reference,display:"flex",justifyContent:"center",alignItems:"center","&[data-status=active]":{borderWidth:"2px",borderColor:tC.reference},"&[data-status=complete]":{bg:tC.reference,color:"chakra-inverse-text"},"&[data-status=incomplete]":{borderWidth:"2px"}},separator:{bg:"chakra-border-color",flex:"1","&[data-status=complete]":{bg:tC.reference},"&[data-orientation=horizontal]":{width:"100%",height:"2px",marginStart:"2"},"&[data-orientation=vertical]":{width:"2px",position:"absolute",height:"100%",maxHeight:`calc(100% - ${Uf.reference} - 8px)`,top:`calc(${Uf.reference} + 4px)`,insetStart:`calc(${Uf.reference} / 2 - 1px)`}}})),DRe=NRe({baseStyle:xRe,sizes:{xs:SC({stepper:{[Uf.variable]:"sizes.4",[iS.variable]:"sizes.3",[sS.variable]:"fontSizes.xs",[bC.variable]:"fontSizes.xs"}}),sm:SC({stepper:{[Uf.variable]:"sizes.6",[iS.variable]:"sizes.4",[sS.variable]:"fontSizes.sm",[bC.variable]:"fontSizes.xs"}}),md:SC({stepper:{[Uf.variable]:"sizes.8",[iS.variable]:"sizes.5",[sS.variable]:"fontSizes.md",[bC.variable]:"fontSizes.sm"}}),lg:SC({stepper:{[Uf.variable]:"sizes.10",[iS.variable]:"sizes.6",[sS.variable]:"fontSizes.lg",[bC.variable]:"fontSizes.md"}})},defaultProps:{size:"md",colorScheme:"blue"}}),{defineMultiStyleConfig:LRe,definePartsStyle:xO}=ts(QSe.keys),BC=Zo("switch-track-width"),$y=Zo("switch-track-height"),bU=Zo("switch-track-diff"),MRe=Mf.subtract(BC,$y),UV=Zo("switch-thumb-x"),nC=Zo("switch-bg"),URe=n=>{const{colorScheme:e}=n;return{borderRadius:"full",p:"0.5",width:[BC.reference],height:[$y.reference],transitionProperty:"common",transitionDuration:"fast",[nC.variable]:"colors.gray.300",_dark:{[nC.variable]:"colors.whiteAlpha.400"},_focusVisible:{boxShadow:"outline"},_disabled:{opacity:.4,cursor:"not-allowed"},_checked:{[nC.variable]:`colors.${e}.500`,_dark:{[nC.variable]:`colors.${e}.200`}},bg:nC.reference}},VRe={bg:"white",transitionProperty:"transform",transitionDuration:"normal",borderRadius:"inherit",width:[$y.reference],height:[$y.reference],_checked:{transform:`translateX(${UV.reference})`}},jRe=xO(n=>({container:{[bU.variable]:MRe,[UV.variable]:bU.reference,_rtl:{[UV.variable]:Mf(bU).negate().toString()}},track:URe(n),thumb:VRe})),FRe={sm:xO({container:{[BC.variable]:"1.375rem",[$y.variable]:"sizes.3"}}),md:xO({container:{[BC.variable]:"1.875rem",[$y.variable]:"sizes.4"}}),lg:xO({container:{[BC.variable]:"2.875rem",[$y.variable]:"sizes.6"}})},BRe=LRe({baseStyle:jRe,sizes:FRe,defaultProps:{size:"md",colorScheme:"blue"}}),{defineMultiStyleConfig:zRe,definePartsStyle:ES}=ts(ZSe.keys),WRe=ES({table:{fontVariantNumeric:"lining-nums tabular-nums",borderCollapse:"collapse",width:"full"},th:{fontFamily:"heading",fontWeight:"bold",textTransform:"uppercase",letterSpacing:"wider",textAlign:"start"},td:{textAlign:"start"},caption:{mt:4,fontFamily:"heading",textAlign:"center",fontWeight:"medium"}}),dk={"&[data-is-numeric=true]":{textAlign:"end"}},GRe=ES(n=>{const{colorScheme:e}=n;return{th:{color:Hn("gray.600","gray.400")(n),borderBottom:"1px",borderColor:Hn(`${e}.100`,`${e}.700`)(n),...dk},td:{borderBottom:"1px",borderColor:Hn(`${e}.100`,`${e}.700`)(n),...dk},caption:{color:Hn("gray.600","gray.100")(n)},tfoot:{tr:{"&:last-of-type":{th:{borderBottomWidth:0}}}}}}),HRe=ES(n=>{const{colorScheme:e}=n;return{th:{color:Hn("gray.600","gray.400")(n),borderBottom:"1px",borderColor:Hn(`${e}.100`,`${e}.700`)(n),...dk},td:{borderBottom:"1px",borderColor:Hn(`${e}.100`,`${e}.700`)(n),...dk},caption:{color:Hn("gray.600","gray.100")(n)},tbody:{tr:{"&:nth-of-type(odd)":{"th, td":{borderBottomWidth:"1px",borderColor:Hn(`${e}.100`,`${e}.700`)(n)},td:{background:Hn(`${e}.100`,`${e}.700`)(n)}}}},tfoot:{tr:{"&:last-of-type":{th:{borderBottomWidth:0}}}}}}),$Re={simple:GRe,striped:HRe,unstyled:{}},KRe={sm:ES({th:{px:"4",py:"1",lineHeight:"4",fontSize:"xs"},td:{px:"4",py:"2",fontSize:"sm",lineHeight:"4"},caption:{px:"4",py:"2",fontSize:"xs"}}),md:ES({th:{px:"6",py:"3",lineHeight:"4",fontSize:"xs"},td:{px:"6",py:"4",lineHeight:"5"},caption:{px:"6",py:"2",fontSize:"sm"}}),lg:ES({th:{px:"8",py:"4",lineHeight:"5",fontSize:"sm"},td:{px:"8",py:"5",lineHeight:"6"},caption:{px:"6",py:"2",fontSize:"md"}})},qRe=zRe({baseStyle:WRe,variants:$Re,sizes:KRe,defaultProps:{variant:"simple",size:"md",colorScheme:"gray"}}),bl=$n("tabs-color"),ph=$n("tabs-bg"),tO=$n("tabs-border-color"),{defineMultiStyleConfig:YRe,definePartsStyle:Dp}=ts(ebe.keys),XRe=n=>{const{orientation:e}=n;return{display:e==="vertical"?"flex":"block"}},JRe=n=>{const{isFitted:e}=n;return{flex:e?1:void 0,transitionProperty:"common",transitionDuration:"normal",_focusVisible:{zIndex:1,boxShadow:"outline"},_disabled:{cursor:"not-allowed",opacity:.4}}},QRe=n=>{const{align:e="start",orientation:i}=n;return{justifyContent:{end:"flex-end",center:"center",start:"flex-start"}[e],flexDirection:i==="vertical"?"column":"row"}},ZRe={p:4},eIe=Dp(n=>({root:XRe(n),tab:JRe(n),tablist:QRe(n),tabpanel:ZRe})),tIe={sm:Dp({tab:{py:1,px:4,fontSize:"sm"}}),md:Dp({tab:{fontSize:"md",py:2,px:4}}),lg:Dp({tab:{fontSize:"lg",py:3,px:4}})},nIe=Dp(n=>{const{colorScheme:e,orientation:i}=n,o=i==="vertical",l=o?"borderStart":"borderBottom",u=o?"marginStart":"marginBottom";return{tablist:{[l]:"2px solid",borderColor:"inherit"},tab:{[l]:"2px solid",borderColor:"transparent",[u]:"-2px",_selected:{[bl.variable]:`colors.${e}.600`,_dark:{[bl.variable]:`colors.${e}.300`},borderColor:"currentColor"},_active:{[ph.variable]:"colors.gray.200",_dark:{[ph.variable]:"colors.whiteAlpha.300"}},_disabled:{_active:{bg:"none"}},color:bl.reference,bg:ph.reference}}}),rIe=Dp(n=>{const{colorScheme:e}=n;return{tab:{borderTopRadius:"md",border:"1px solid",borderColor:"transparent",mb:"-1px",[tO.variable]:"transparent",_selected:{[bl.variable]:`colors.${e}.600`,[tO.variable]:"colors.white",_dark:{[bl.variable]:`colors.${e}.300`,[tO.variable]:"colors.gray.800"},borderColor:"inherit",borderBottomColor:tO.reference},color:bl.reference},tablist:{mb:"-1px",borderBottom:"1px solid",borderColor:"inherit"}}}),iIe=Dp(n=>{const{colorScheme:e}=n;return{tab:{border:"1px solid",borderColor:"inherit",[ph.variable]:"colors.gray.50",_dark:{[ph.variable]:"colors.whiteAlpha.50"},mb:"-1px",_notLast:{marginEnd:"-1px"},_selected:{[ph.variable]:"colors.white",[bl.variable]:`colors.${e}.600`,_dark:{[ph.variable]:"colors.gray.800",[bl.variable]:`colors.${e}.300`},borderColor:"inherit",borderTopColor:"currentColor",borderBottomColor:"transparent"},color:bl.reference,bg:ph.reference},tablist:{mb:"-1px",borderBottom:"1px solid",borderColor:"inherit"}}}),sIe=Dp(n=>{const{colorScheme:e,theme:i}=n;return{tab:{borderRadius:"full",fontWeight:"semibold",color:"gray.600",_selected:{color:Uc(i,`${e}.700`),bg:Uc(i,`${e}.100`)}}}}),oIe=Dp(n=>{const{colorScheme:e}=n;return{tab:{borderRadius:"full",fontWeight:"semibold",[bl.variable]:"colors.gray.600",_dark:{[bl.variable]:"inherit"},_selected:{[bl.variable]:"colors.white",[ph.variable]:`colors.${e}.600`,_dark:{[bl.variable]:"colors.gray.800",[ph.variable]:`colors.${e}.300`}},color:bl.reference,bg:ph.reference}}}),aIe=Dp({}),cIe={line:nIe,enclosed:rIe,"enclosed-colored":iIe,"soft-rounded":sIe,"solid-rounded":oIe,unstyled:aIe},lIe=YRe({baseStyle:eIe,sizes:tIe,variants:cIe,defaultProps:{size:"md",variant:"line",colorScheme:"blue"}}),{defineMultiStyleConfig:uIe,definePartsStyle:Ky}=ts(tbe.keys),Gq=$n("tag-bg"),Hq=$n("tag-color"),wU=$n("tag-shadow"),DO=$n("tag-min-height"),LO=$n("tag-min-width"),MO=$n("tag-font-size"),UO=$n("tag-padding-inline"),dIe={fontWeight:"medium",lineHeight:1.2,outline:0,[Hq.variable]:yo.color.reference,[Gq.variable]:yo.bg.reference,[wU.variable]:yo.shadow.reference,color:Hq.reference,bg:Gq.reference,boxShadow:wU.reference,borderRadius:"md",minH:DO.reference,minW:LO.reference,fontSize:MO.reference,px:UO.reference,_focusVisible:{[wU.variable]:"shadows.outline"}},hIe={lineHeight:1.2,overflow:"visible"},pIe={fontSize:"lg",w:"5",h:"5",transitionProperty:"common",transitionDuration:"normal",borderRadius:"full",marginStart:"1.5",marginEnd:"-1",opacity:.5,_disabled:{opacity:.4},_focusVisible:{boxShadow:"outline",bg:"rgba(0, 0, 0, 0.14)"},_hover:{opacity:.8},_active:{opacity:1}},fIe=Ky({container:dIe,label:hIe,closeButton:pIe}),mIe={sm:Ky({container:{[DO.variable]:"sizes.5",[LO.variable]:"sizes.5",[MO.variable]:"fontSizes.xs",[UO.variable]:"space.2"},closeButton:{marginEnd:"-2px",marginStart:"0.35rem"}}),md:Ky({container:{[DO.variable]:"sizes.6",[LO.variable]:"sizes.6",[MO.variable]:"fontSizes.sm",[UO.variable]:"space.2"}}),lg:Ky({container:{[DO.variable]:"sizes.8",[LO.variable]:"sizes.8",[MO.variable]:"fontSizes.md",[UO.variable]:"space.3"}})},gIe={subtle:Ky(n=>{var e;return{container:(e=VC.variants)==null?void 0:e.subtle(n)}}),solid:Ky(n=>{var e;return{container:(e=VC.variants)==null?void 0:e.solid(n)}}),outline:Ky(n=>{var e;return{container:(e=VC.variants)==null?void 0:e.outline(n)}})},_Ie=uIe({variants:gIe,baseStyle:fIe,sizes:mIe,defaultProps:{size:"md",variant:"subtle",colorScheme:"gray"}});var tee;const yIe={...(tee=vi.baseStyle)==null?void 0:tee.field,paddingY:"2",minHeight:"20",lineHeight:"short",verticalAlign:"top"};var nee;const EIe={outline:n=>{var e;return((e=vi.variants)==null?void 0:e.outline(n).field)??{}},flushed:n=>{var e;return((e=vi.variants)==null?void 0:e.flushed(n).field)??{}},filled:n=>{var e;return((e=vi.variants)==null?void 0:e.filled(n).field)??{}},unstyled:((nee=vi.variants)==null?void 0:nee.unstyled.field)??{}};var ree,iee,see,oee;const vIe={xs:((ree=vi.sizes)==null?void 0:ree.xs.field)??{},sm:((iee=vi.sizes)==null?void 0:iee.sm.field)??{},md:((see=vi.sizes)==null?void 0:see.md.field)??{},lg:((oee=vi.sizes)==null?void 0:oee.lg.field)??{}},SIe={baseStyle:yIe,sizes:vIe,variants:EIe,defaultProps:{size:"md",variant:"outline"}},nO=Zo("tooltip-bg"),TU=Zo("tooltip-fg"),bIe=Zo("popper-arrow-bg"),wIe={bg:nO.reference,color:TU.reference,[nO.variable]:"colors.gray.700",[TU.variable]:"colors.whiteAlpha.900",_dark:{[nO.variable]:"colors.gray.300",[TU.variable]:"colors.gray.900"},[bIe.variable]:nO.reference,px:"2",py:"0.5",borderRadius:"sm",fontWeight:"medium",fontSize:"sm",boxShadow:"md",maxW:"xs",zIndex:"tooltip"},TIe={baseStyle:wIe},CIe={Accordion:ube,Alert:Kbe,Avatar:iwe,Badge:VC,Breadcrumb:fwe,Button:wwe,Checkbox:Cg,CloseButton:Vwe,Code:zwe,Container:Gwe,Divider:Ywe,Drawer:oTe,Editable:pTe,Form:ETe,FormError:CTe,FormLabel:ITe,Heading:OTe,Input:vi,Kbd:FTe,Link:zTe,List:KTe,Menu:iCe,Modal:mCe,NumberInput:TCe,PinInput:ACe,Popover:jCe,Progress:KCe,Radio:QCe,Select:sRe,Skeleton:aRe,SkipLink:lRe,Slider:vRe,Spinner:wRe,Stat:kRe,Switch:BRe,Table:qRe,Tabs:lIe,Tag:_Ie,Textarea:SIe,Tooltip:TIe,Card:Awe,Stepper:DRe},RIe={none:0,"1px":"1px solid","2px":"2px solid","4px":"4px solid","8px":"8px solid"},IIe={base:"0em",sm:"30em",md:"48em",lg:"62em",xl:"80em","2xl":"96em"},AIe={transparent:"transparent",current:"currentColor",black:"#000000",white:"#FFFFFF",whiteAlpha:{50:"rgba(255, 255, 255, 0.04)",100:"rgba(255, 255, 255, 0.06)",200:"rgba(255, 255, 255, 0.08)",300:"rgba(255, 255, 255, 0.16)",400:"rgba(255, 255, 255, 0.24)",500:"rgba(255, 255, 255, 0.36)",600:"rgba(255, 255, 255, 0.48)",700:"rgba(255, 255, 255, 0.64)",800:"rgba(255, 255, 255, 0.80)",900:"rgba(255, 255, 255, 0.92)"},blackAlpha:{50:"rgba(0, 0, 0, 0.04)",100:"rgba(0, 0, 0, 0.06)",200:"rgba(0, 0, 0, 0.08)",300:"rgba(0, 0, 0, 0.16)",400:"rgba(0, 0, 0, 0.24)",500:"rgba(0, 0, 0, 0.36)",600:"rgba(0, 0, 0, 0.48)",700:"rgba(0, 0, 0, 0.64)",800:"rgba(0, 0, 0, 0.80)",900:"rgba(0, 0, 0, 0.92)"},gray:{50:"#F7FAFC",100:"#EDF2F7",200:"#E2E8F0",300:"#CBD5E0",400:"#A0AEC0",500:"#718096",600:"#4A5568",700:"#2D3748",800:"#1A202C",900:"#171923"},red:{50:"#FFF5F5",100:"#FED7D7",200:"#FEB2B2",300:"#FC8181",400:"#F56565",500:"#E53E3E",600:"#C53030",700:"#9B2C2C",800:"#822727",900:"#63171B"},orange:{50:"#FFFAF0",100:"#FEEBC8",200:"#FBD38D",300:"#F6AD55",400:"#ED8936",500:"#DD6B20",600:"#C05621",700:"#9C4221",800:"#7B341E",900:"#652B19"},yellow:{50:"#FFFFF0",100:"#FEFCBF",200:"#FAF089",300:"#F6E05E",400:"#ECC94B",500:"#D69E2E",600:"#B7791F",700:"#975A16",800:"#744210",900:"#5F370E"},green:{50:"#F0FFF4",100:"#C6F6D5",200:"#9AE6B4",300:"#68D391",400:"#48BB78",500:"#38A169",600:"#2F855A",700:"#276749",800:"#22543D",900:"#1C4532"},teal:{50:"#E6FFFA",100:"#B2F5EA",200:"#81E6D9",300:"#4FD1C5",400:"#38B2AC",500:"#319795",600:"#2C7A7B",700:"#285E61",800:"#234E52",900:"#1D4044"},blue:{50:"#ebf8ff",100:"#bee3f8",200:"#90cdf4",300:"#63b3ed",400:"#4299e1",500:"#3182ce",600:"#2b6cb0",700:"#2c5282",800:"#2a4365",900:"#1A365D"},cyan:{50:"#EDFDFD",100:"#C4F1F9",200:"#9DECF9",300:"#76E4F7",400:"#0BC5EA",500:"#00B5D8",600:"#00A3C4",700:"#0987A0",800:"#086F83",900:"#065666"},purple:{50:"#FAF5FF",100:"#E9D8FD",200:"#D6BCFA",300:"#B794F4",400:"#9F7AEA",500:"#805AD5",600:"#6B46C1",700:"#553C9A",800:"#44337A",900:"#322659"},pink:{50:"#FFF5F7",100:"#FED7E2",200:"#FBB6CE",300:"#F687B3",400:"#ED64A6",500:"#D53F8C",600:"#B83280",700:"#97266D",800:"#702459",900:"#521B41"}},PIe={none:"0",sm:"0.125rem",base:"0.25rem",md:"0.375rem",lg:"0.5rem",xl:"0.75rem","2xl":"1rem","3xl":"1.5rem",full:"9999px"},OIe={xs:"0 0 0 1px rgba(0, 0, 0, 0.05)",sm:"0 1px 2px 0 rgba(0, 0, 0, 0.05)",base:"0 1px 3px 0 rgba(0, 0, 0, 0.1), 0 1px 2px 0 rgba(0, 0, 0, 0.06)",md:"0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06)",lg:"0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05)",xl:"0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04)","2xl":"0 25px 50px -12px rgba(0, 0, 0, 0.25)",outline:"0 0 0 3px rgba(66, 153, 225, 0.6)",inner:"inset 0 2px 4px 0 rgba(0,0,0,0.06)",none:"none","dark-lg":"rgba(0, 0, 0, 0.1) 0px 0px 0px 1px, rgba(0, 0, 0, 0.2) 0px 5px 10px, rgba(0, 0, 0, 0.4) 0px 15px 40px"},kIe={common:"background-color, border-color, color, fill, stroke, opacity, box-shadow, transform",colors:"background-color, border-color, color, fill, stroke",dimensions:"width, height",position:"left, right, top, bottom",background:"background-color, background-image, background-position"},NIe={"ease-in":"cubic-bezier(0.4, 0, 1, 1)","ease-out":"cubic-bezier(0, 0, 0.2, 1)","ease-in-out":"cubic-bezier(0.4, 0, 0.2, 1)"},xIe={"ultra-fast":"50ms",faster:"100ms",fast:"150ms",normal:"200ms",slow:"300ms",slower:"400ms","ultra-slow":"500ms"},DIe={property:kIe,easing:NIe,duration:xIe},LIe={hide:-1,auto:"auto",base:0,docked:10,dropdown:1e3,sticky:1100,banner:1200,overlay:1300,modal:1400,popover:1500,skipLink:1600,toast:1700,tooltip:1800},MIe={none:0,sm:"4px",base:"8px",md:"12px",lg:"16px",xl:"24px","2xl":"40px","3xl":"64px"},UIe={breakpoints:IIe,zIndices:LIe,radii:PIe,blur:MIe,colors:AIe,...Hee,sizes:jee,shadows:OIe,space:Vee,borders:RIe,transition:DIe},VIe={colors:{"chakra-body-text":{_light:"gray.800",_dark:"whiteAlpha.900"},"chakra-body-bg":{_light:"white",_dark:"gray.800"},"chakra-border-color":{_light:"gray.200",_dark:"whiteAlpha.300"},"chakra-inverse-text":{_light:"white",_dark:"gray.800"},"chakra-subtle-bg":{_light:"gray.100",_dark:"gray.700"},"chakra-subtle-text":{_light:"gray.600",_dark:"gray.400"},"chakra-placeholder-color":{_light:"gray.500",_dark:"whiteAlpha.400"}}},jIe={global:{body:{fontFamily:"body",color:"chakra-body-text",bg:"chakra-body-bg",transitionProperty:"background-color",transitionDuration:"normal",lineHeight:"base"},"*::placeholder":{color:"chakra-placeholder-color"},"*, *::before, &::after":{borderColor:"chakra-border-color"}}},FIe="ltr",BIe={useSystemColorMode:!1,initialColorMode:"light",cssVarPrefix:"chakra"},zIe={semanticTokens:VIe,direction:FIe,...UIe,components:CIe,styles:jIe,config:BIe};function WIe(n){if(n.sheet)return n.sheet;for(var e=0;e<document.styleSheets.length;e++)if(document.styleSheets[e].ownerNode===n)return document.styleSheets[e]}function GIe(n){var e=document.createElement("style");return e.setAttribute("data-emotion",n.key),n.nonce!==void 0&&e.setAttribute("nonce",n.nonce),e.appendChild(document.createTextNode("")),e.setAttribute("data-s",""),e}var HIe=(function(){function n(i){var o=this;this._insertTag=function(l){var u;o.tags.length===0?o.insertionPoint?u=o.insertionPoint.nextSibling:o.prepend?u=o.container.firstChild:u=o.before:u=o.tags[o.tags.length-1].nextSibling,o.container.insertBefore(l,u),o.tags.push(l)},this.isSpeedy=i.speedy===void 0?!0:i.speedy,this.tags=[],this.ctr=0,this.nonce=i.nonce,this.key=i.key,this.container=i.container,this.prepend=i.prepend,this.insertionPoint=i.insertionPoint,this.before=null}var e=n.prototype;return e.hydrate=function(o){o.forEach(this._insertTag)},e.insert=function(o){this.ctr%(this.isSpeedy?65e3:1)===0&&this._insertTag(GIe(this));var l=this.tags[this.tags.length-1];if(this.isSpeedy){var u=WIe(l);try{u.insertRule(o,u.cssRules.length)}catch{}}else l.appendChild(document.createTextNode(o));this.ctr++},e.flush=function(){this.tags.forEach(function(o){var l;return(l=o.parentNode)==null?void 0:l.removeChild(o)}),this.tags=[],this.ctr=0},n})(),lc="-ms-",hk="-moz-",gi="-webkit-",Yee="comm",gj="rule",_j="decl",$Ie="@import",Xee="@keyframes",KIe="@layer",qIe=Math.abs,cN=String.fromCharCode,YIe=Object.assign;function XIe(n,e){return ja(n,0)^45?(((e<<2^ja(n,0))<<2^ja(n,1))<<2^ja(n,2))<<2^ja(n,3):0}function Jee(n){return n.trim()}function JIe(n,e){return(n=e.exec(n))?n[0]:n}function _i(n,e,i){return n.replace(e,i)}function VV(n,e){return n.indexOf(e)}function ja(n,e){return n.charCodeAt(e)|0}function cR(n,e,i){return n.slice(e,i)}function Cp(n){return n.length}function yj(n){return n.length}function rO(n,e){return e.push(n),n}function QIe(n,e){return n.map(e).join("")}var lN=1,MS=1,Qee=0,Ol=0,Po=0,ob="";function uN(n,e,i,o,l,u,p){return{value:n,root:e,parent:i,type:o,props:l,children:u,line:lN,column:MS,length:p,return:""}}function rC(n,e){return YIe(uN("",null,null,"",null,null,0),n,{length:-n.length},e)}function ZIe(){return Po}function eAe(){return Po=Ol>0?ja(ob,--Ol):0,MS--,Po===10&&(MS=1,lN--),Po}function gu(){return Po=Ol<Qee?ja(ob,Ol++):0,MS++,Po===10&&(MS=1,lN++),Po}function Lp(){return ja(ob,Ol)}function VO(){return Ol}function FR(n,e){return cR(ob,n,e)}function lR(n){switch(n){case 0:case 9:case 10:case 13:case 32:return 5;case 33:case 43:case 44:case 47:case 62:case 64:case 126:case 59:case 123:case 125:return 4;case 58:return 3;case 34:case 39:case 40:case 91:return 2;case 41:case 93:return 1}return 0}function Zee(n){return lN=MS=1,Qee=Cp(ob=n),Ol=0,[]}function ete(n){return ob="",n}function jO(n){return Jee(FR(Ol-1,jV(n===91?n+2:n===40?n+1:n)))}function tAe(n){for(;(Po=Lp())&&Po<33;)gu();return lR(n)>2||lR(Po)>3?"":" "}function nAe(n,e){for(;--e&&gu()&&!(Po<48||Po>102||Po>57&&Po<65||Po>70&&Po<97););return FR(n,VO()+(e<6&&Lp()==32&&gu()==32))}function jV(n){for(;gu();)switch(Po){case n:return Ol;case 34:case 39:n!==34&&n!==39&&jV(Po);break;case 40:n===41&&jV(n);break;case 92:gu();break}return Ol}function rAe(n,e){for(;gu()&&n+Po!==57;)if(n+Po===84&&Lp()===47)break;return"/*"+FR(e,Ol-1)+"*"+cN(n===47?n:gu())}function iAe(n){for(;!lR(Lp());)gu();return FR(n,Ol)}function sAe(n){return ete(FO("",null,null,null,[""],n=Zee(n),0,[0],n))}function FO(n,e,i,o,l,u,p,y,E){for(var b=0,T=0,R=p,O=0,L=0,D=0,U=1,F=1,Y=1,W=0,re="",le=l,ie=u,me=o,q=re;F;)switch(D=W,W=gu()){case 40:if(D!=108&&ja(q,R-1)==58){VV(q+=_i(jO(W),"&","&\f"),"&\f")!=-1&&(Y=-1);break}case 34:case 39:case 91:q+=jO(W);break;case 9:case 10:case 13:case 32:q+=tAe(D);break;case 92:q+=nAe(VO()-1,7);continue;case 47:switch(Lp()){case 42:case 47:rO(oAe(rAe(gu(),VO()),e,i),E);break;default:q+="/"}break;case 123*U:y[b++]=Cp(q)*Y;case 125*U:case 59:case 0:switch(W){case 0:case 125:F=0;case 59+T:Y==-1&&(q=_i(q,/\f/g,"")),L>0&&Cp(q)-R&&rO(L>32?Kq(q+";",o,i,R-1):Kq(_i(q," ","")+";",o,i,R-2),E);break;case 59:q+=";";default:if(rO(me=$q(q,e,i,b,T,l,y,re,le=[],ie=[],R),u),W===123)if(T===0)FO(q,e,me,me,le,u,R,y,ie);else switch(O===99&&ja(q,3)===110?100:O){case 100:case 108:case 109:case 115:FO(n,me,me,o&&rO($q(n,me,me,0,0,l,y,re,l,le=[],R),ie),l,ie,R,y,o?le:ie);break;default:FO(q,me,me,me,[""],ie,0,y,ie)}}b=T=L=0,U=Y=1,re=q="",R=p;break;case 58:R=1+Cp(q),L=D;default:if(U<1){if(W==123)--U;else if(W==125&&U++==0&&eAe()==125)continue}switch(q+=cN(W),W*U){case 38:Y=T>0?1:(q+="\f",-1);break;case 44:y[b++]=(Cp(q)-1)*Y,Y=1;break;case 64:Lp()===45&&(q+=jO(gu())),O=Lp(),T=R=Cp(re=q+=iAe(VO())),W++;break;case 45:D===45&&Cp(q)==2&&(U=0)}}return u}function $q(n,e,i,o,l,u,p,y,E,b,T){for(var R=l-1,O=l===0?u:[""],L=yj(O),D=0,U=0,F=0;D<o;++D)for(var Y=0,W=cR(n,R+1,R=qIe(U=p[D])),re=n;Y<L;++Y)(re=Jee(U>0?O[Y]+" "+W:_i(W,/&\f/g,O[Y])))&&(E[F++]=re);return uN(n,e,i,l===0?gj:y,E,b,T)}function oAe(n,e,i){return uN(n,e,i,Yee,cN(ZIe()),cR(n,2,-2),0)}function Kq(n,e,i,o){return uN(n,e,i,_j,cR(n,0,o),cR(n,o+1,-1),o)}function vS(n,e){for(var i="",o=yj(n),l=0;l<o;l++)i+=e(n[l],l,n,e)||"";return i}function aAe(n,e,i,o){switch(n.type){case KIe:if(n.children.length)break;case $Ie:case _j:return n.return=n.return||n.value;case Yee:return"";case Xee:return n.return=n.value+"{"+vS(n.children,o)+"}";case gj:n.value=n.props.join(",")}return Cp(i=vS(n.children,o))?n.return=n.value+"{"+i+"}":""}function cAe(n){var e=yj(n);return function(i,o,l,u){for(var p="",y=0;y<e;y++)p+=n[y](i,o,l,u)||"";return p}}function lAe(n){return function(e){e.root||(e=e.return)&&n(e)}}var qq=function(e){var i=new WeakMap;return function(o){if(i.has(o))return i.get(o);var l=e(o);return i.set(o,l),l}};function tte(n){var e=Object.create(null);return function(i){return e[i]===void 0&&(e[i]=n(i)),e[i]}}var uAe=function(e,i,o){for(var l=0,u=0;l=u,u=Lp(),l===38&&u===12&&(i[o]=1),!lR(u);)gu();return FR(e,Ol)},dAe=function(e,i){var o=-1,l=44;do switch(lR(l)){case 0:l===38&&Lp()===12&&(i[o]=1),e[o]+=uAe(Ol-1,i,o);break;case 2:e[o]+=jO(l);break;case 4:if(l===44){e[++o]=Lp()===58?"&\f":"",i[o]=e[o].length;break}default:e[o]+=cN(l)}while(l=gu());return e},hAe=function(e,i){return ete(dAe(Zee(e),i))},Yq=new WeakMap,pAe=function(e){if(!(e.type!=="rule"||!e.parent||e.length<1)){for(var i=e.value,o=e.parent,l=e.column===o.column&&e.line===o.line;o.type!=="rule";)if(o=o.parent,!o)return;if(!(e.props.length===1&&i.charCodeAt(0)!==58&&!Yq.get(o))&&!l){Yq.set(e,!0);for(var u=[],p=hAe(i,u),y=o.props,E=0,b=0;E<p.length;E++)for(var T=0;T<y.length;T++,b++)e.props[b]=u[E]?p[E].replace(/&\f/g,y[T]):y[T]+" "+p[E]}}},fAe=function(e){if(e.type==="decl"){var i=e.value;i.charCodeAt(0)===108&&i.charCodeAt(2)===98&&(e.return="",e.value="")}};function nte(n,e){switch(XIe(n,e)){case 5103:return gi+"print-"+n+n;case 5737:case 4201:case 3177:case 3433:case 1641:case 4457:case 2921:case 5572:case 6356:case 5844:case 3191:case 6645:case 3005:case 6391:case 5879:case 5623:case 6135:case 4599:case 4855:case 4215:case 6389:case 5109:case 5365:case 5621:case 3829:return gi+n+n;case 5349:case 4246:case 4810:case 6968:case 2756:return gi+n+hk+n+lc+n+n;case 6828:case 4268:return gi+n+lc+n+n;case 6165:return gi+n+lc+"flex-"+n+n;case 5187:return gi+n+_i(n,/(\w+).+(:[^]+)/,gi+"box-$1$2"+lc+"flex-$1$2")+n;case 5443:return gi+n+lc+"flex-item-"+_i(n,/flex-|-self/,"")+n;case 4675:return gi+n+lc+"flex-line-pack"+_i(n,/align-content|flex-|-self/,"")+n;case 5548:return gi+n+lc+_i(n,"shrink","negative")+n;case 5292:return gi+n+lc+_i(n,"basis","preferred-size")+n;case 6060:return gi+"box-"+_i(n,"-grow","")+gi+n+lc+_i(n,"grow","positive")+n;case 4554:return gi+_i(n,/([^-])(transform)/g,"$1"+gi+"$2")+n;case 6187:return _i(_i(_i(n,/(zoom-|grab)/,gi+"$1"),/(image-set)/,gi+"$1"),n,"")+n;case 5495:case 3959:return _i(n,/(image-set\([^]*)/,gi+"$1$`$1");case 4968:return _i(_i(n,/(.+:)(flex-)?(.*)/,gi+"box-pack:$3"+lc+"flex-pack:$3"),/s.+-b[^;]+/,"justify")+gi+n+n;case 4095:case 3583:case 4068:case 2532:return _i(n,/(.+)-inline(.+)/,gi+"$1$2")+n;case 8116:case 7059:case 5753:case 5535:case 5445:case 5701:case 4933:case 4677:case 5533:case 5789:case 5021:case 4765:if(Cp(n)-1-e>6)switch(ja(n,e+1)){case 109:if(ja(n,e+4)!==45)break;case 102:return _i(n,/(.+:)(.+)-([^]+)/,"$1"+gi+"$2-$3$1"+hk+(ja(n,e+3)==108?"$3":"$2-$3"))+n;case 115:return~VV(n,"stretch")?nte(_i(n,"stretch","fill-available"),e)+n:n}break;case 4949:if(ja(n,e+1)!==115)break;case 6444:switch(ja(n,Cp(n)-3-(~VV(n,"!important")&&10))){case 107:return _i(n,":",":"+gi)+n;case 101:return _i(n,/(.+:)([^;!]+)(;|!.+)?/,"$1"+gi+(ja(n,14)===45?"inline-":"")+"box$3$1"+gi+"$2$3$1"+lc+"$2box$3")+n}break;case 5936:switch(ja(n,e+11)){case 114:return gi+n+lc+_i(n,/[svh]\w+-[tblr]{2}/,"tb")+n;case 108:return gi+n+lc+_i(n,/[svh]\w+-[tblr]{2}/,"tb-rl")+n;case 45:return gi+n+lc+_i(n,/[svh]\w+-[tblr]{2}/,"lr")+n}return gi+n+lc+n+n}return n}var mAe=function(e,i,o,l){if(e.length>-1&&!e.return)switch(e.type){case _j:e.return=nte(e.value,e.length);break;case Xee:return vS([rC(e,{value:_i(e.value,"@","@"+gi)})],l);case gj:if(e.length)return QIe(e.props,function(u){switch(JIe(u,/(::plac\w+|:read-\w+)/)){case":read-only":case":read-write":return vS([rC(e,{props:[_i(u,/:(read-\w+)/,":"+hk+"$1")]})],l);case"::placeholder":return vS([rC(e,{props:[_i(u,/:(plac\w+)/,":"+gi+"input-$1")]}),rC(e,{props:[_i(u,/:(plac\w+)/,":"+hk+"$1")]}),rC(e,{props:[_i(u,/:(plac\w+)/,lc+"input-$1")]})],l)}return""})}},gAe=[mAe],_Ae=function(e){var i=e.key;if(i==="css"){var o=document.querySelectorAll("style[data-emotion]:not([data-s])");Array.prototype.forEach.call(o,function(U){var F=U.getAttribute("data-emotion");F.indexOf(" ")!==-1&&(document.head.appendChild(U),U.setAttribute("data-s",""))})}var l=e.stylisPlugins||gAe,u={},p,y=[];p=e.container||document.head,Array.prototype.forEach.call(document.querySelectorAll('style[data-emotion^="'+i+' "]'),function(U){for(var F=U.getAttribute("data-emotion").split(" "),Y=1;Y<F.length;Y++)u[F[Y]]=!0;y.push(U)});var E,b=[pAe,fAe];{var T,R=[aAe,lAe(function(U){T.insert(U)})],O=cAe(b.concat(l,R)),L=function(F){return vS(sAe(F),O)};E=function(F,Y,W,re){T=W,L(F?F+"{"+Y.styles+"}":Y.styles),re&&(D.inserted[Y.name]=!0)}}var D={key:i,sheet:new HIe({key:i,container:p,nonce:e.nonce,speedy:e.speedy,prepend:e.prepend,insertionPoint:e.insertionPoint}),nonce:e.nonce,inserted:u,registered:{},insert:E};return D.sheet.hydrate(y),D};function iE(){return iE=Object.assign?Object.assign.bind():function(n){for(var e=1;e<arguments.length;e++){var i=arguments[e];for(var o in i)({}).hasOwnProperty.call(i,o)&&(n[o]=i[o])}return n},iE.apply(null,arguments)}var CU={exports:{}},Ti={};/** @license React v16.13.1
 * react-is.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Xq;function yAe(){if(Xq)return Ti;Xq=1;var n=typeof Symbol=="function"&&Symbol.for,e=n?Symbol.for("react.element"):60103,i=n?Symbol.for("react.portal"):60106,o=n?Symbol.for("react.fragment"):60107,l=n?Symbol.for("react.strict_mode"):60108,u=n?Symbol.for("react.profiler"):60114,p=n?Symbol.for("react.provider"):60109,y=n?Symbol.for("react.context"):60110,E=n?Symbol.for("react.async_mode"):60111,b=n?Symbol.for("react.concurrent_mode"):60111,T=n?Symbol.for("react.forward_ref"):60112,R=n?Symbol.for("react.suspense"):60113,O=n?Symbol.for("react.suspense_list"):60120,L=n?Symbol.for("react.memo"):60115,D=n?Symbol.for("react.lazy"):60116,U=n?Symbol.for("react.block"):60121,F=n?Symbol.for("react.fundamental"):60117,Y=n?Symbol.for("react.responder"):60118,W=n?Symbol.for("react.scope"):60119;function re(ie){if(typeof ie=="object"&&ie!==null){var me=ie.$$typeof;switch(me){case e:switch(ie=ie.type,ie){case E:case b:case o:case u:case l:case R:return ie;default:switch(ie=ie&&ie.$$typeof,ie){case y:case T:case D:case L:case p:return ie;default:return me}}case i:return me}}}function le(ie){return re(ie)===b}return Ti.AsyncMode=E,Ti.ConcurrentMode=b,Ti.ContextConsumer=y,Ti.ContextProvider=p,Ti.Element=e,Ti.ForwardRef=T,Ti.Fragment=o,Ti.Lazy=D,Ti.Memo=L,Ti.Portal=i,Ti.Profiler=u,Ti.StrictMode=l,Ti.Suspense=R,Ti.isAsyncMode=function(ie){return le(ie)||re(ie)===E},Ti.isConcurrentMode=le,Ti.isContextConsumer=function(ie){return re(ie)===y},Ti.isContextProvider=function(ie){return re(ie)===p},Ti.isElement=function(ie){return typeof ie=="object"&&ie!==null&&ie.$$typeof===e},Ti.isForwardRef=function(ie){return re(ie)===T},Ti.isFragment=function(ie){return re(ie)===o},Ti.isLazy=function(ie){return re(ie)===D},Ti.isMemo=function(ie){return re(ie)===L},Ti.isPortal=function(ie){return re(ie)===i},Ti.isProfiler=function(ie){return re(ie)===u},Ti.isStrictMode=function(ie){return re(ie)===l},Ti.isSuspense=function(ie){return re(ie)===R},Ti.isValidElementType=function(ie){return typeof ie=="string"||typeof ie=="function"||ie===o||ie===b||ie===u||ie===l||ie===R||ie===O||typeof ie=="object"&&ie!==null&&(ie.$$typeof===D||ie.$$typeof===L||ie.$$typeof===p||ie.$$typeof===y||ie.$$typeof===T||ie.$$typeof===F||ie.$$typeof===Y||ie.$$typeof===W||ie.$$typeof===U)},Ti.typeOf=re,Ti}var Jq;function EAe(){return Jq||(Jq=1,CU.exports=yAe()),CU.exports}var RU,Qq;function vAe(){if(Qq)return RU;Qq=1;var n=EAe(),e={childContextTypes:!0,contextType:!0,contextTypes:!0,defaultProps:!0,displayName:!0,getDefaultProps:!0,getDerivedStateFromError:!0,getDerivedStateFromProps:!0,mixins:!0,propTypes:!0,type:!0},i={name:!0,length:!0,prototype:!0,caller:!0,callee:!0,arguments:!0,arity:!0},o={$$typeof:!0,render:!0,defaultProps:!0,displayName:!0,propTypes:!0},l={$$typeof:!0,compare:!0,defaultProps:!0,displayName:!0,propTypes:!0,type:!0},u={};u[n.ForwardRef]=o,u[n.Memo]=l;function p(D){return n.isMemo(D)?l:u[D.$$typeof]||e}var y=Object.defineProperty,E=Object.getOwnPropertyNames,b=Object.getOwnPropertySymbols,T=Object.getOwnPropertyDescriptor,R=Object.getPrototypeOf,O=Object.prototype;function L(D,U,F){if(typeof U!="string"){if(O){var Y=R(U);Y&&Y!==O&&L(D,Y,F)}var W=E(U);b&&(W=W.concat(b(U)));for(var re=p(D),le=p(U),ie=0;ie<W.length;++ie){var me=W[ie];if(!i[me]&&!(F&&F[me])&&!(le&&le[me])&&!(re&&re[me])){var q=T(U,me);try{y(D,me,q)}catch{}}}}return D}return RU=L,RU}var SAe=vAe();const bAe=Jg(SAe);var wAe=!0;function rte(n,e,i){var o="";return i.split(" ").forEach(function(l){n[l]!==void 0?e.push(n[l]+";"):l&&(o+=l+" ")}),o}var Ej=function(e,i,o){var l=e.key+"-"+i.name;(o===!1||wAe===!1)&&e.registered[l]===void 0&&(e.registered[l]=i.styles)},vj=function(e,i,o){Ej(e,i,o);var l=e.key+"-"+i.name;if(e.inserted[i.name]===void 0){var u=i;do e.insert(i===u?"."+l:"",u,e.sheet,!0),u=u.next;while(u!==void 0)}};function TAe(n){for(var e=0,i,o=0,l=n.length;l>=4;++o,l-=4)i=n.charCodeAt(o)&255|(n.charCodeAt(++o)&255)<<8|(n.charCodeAt(++o)&255)<<16|(n.charCodeAt(++o)&255)<<24,i=(i&65535)*1540483477+((i>>>16)*59797<<16),i^=i>>>24,e=(i&65535)*1540483477+((i>>>16)*59797<<16)^(e&65535)*1540483477+((e>>>16)*59797<<16);switch(l){case 3:e^=(n.charCodeAt(o+2)&255)<<16;case 2:e^=(n.charCodeAt(o+1)&255)<<8;case 1:e^=n.charCodeAt(o)&255,e=(e&65535)*1540483477+((e>>>16)*59797<<16)}return e^=e>>>13,e=(e&65535)*1540483477+((e>>>16)*59797<<16),((e^e>>>15)>>>0).toString(36)}var CAe={animationIterationCount:1,aspectRatio:1,borderImageOutset:1,borderImageSlice:1,borderImageWidth:1,boxFlex:1,boxFlexGroup:1,boxOrdinalGroup:1,columnCount:1,columns:1,flex:1,flexGrow:1,flexPositive:1,flexShrink:1,flexNegative:1,flexOrder:1,gridRow:1,gridRowEnd:1,gridRowSpan:1,gridRowStart:1,gridColumn:1,gridColumnEnd:1,gridColumnSpan:1,gridColumnStart:1,msGridRow:1,msGridRowSpan:1,msGridColumn:1,msGridColumnSpan:1,fontWeight:1,lineHeight:1,opacity:1,order:1,orphans:1,scale:1,tabSize:1,widows:1,zIndex:1,zoom:1,WebkitLineClamp:1,fillOpacity:1,floodOpacity:1,stopOpacity:1,strokeDasharray:1,strokeDashoffset:1,strokeMiterlimit:1,strokeOpacity:1,strokeWidth:1},RAe=/[A-Z]|^ms/g,IAe=/_EMO_([^_]+?)_([^]*?)_EMO_/g,ite=function(e){return e.charCodeAt(1)===45},Zq=function(e){return e!=null&&typeof e!="boolean"},IU=tte(function(n){return ite(n)?n:n.replace(RAe,"-$&").toLowerCase()}),eY=function(e,i){switch(e){case"animation":case"animationName":if(typeof i=="string")return i.replace(IAe,function(o,l,u){return Rp={name:l,styles:u,next:Rp},l})}return CAe[e]!==1&&!ite(e)&&typeof i=="number"&&i!==0?i+"px":i};function uR(n,e,i){if(i==null)return"";var o=i;if(o.__emotion_styles!==void 0)return o;switch(typeof i){case"boolean":return"";case"object":{var l=i;if(l.anim===1)return Rp={name:l.name,styles:l.styles,next:Rp},l.name;var u=i;if(u.styles!==void 0){var p=u.next;if(p!==void 0)for(;p!==void 0;)Rp={name:p.name,styles:p.styles,next:Rp},p=p.next;var y=u.styles+";";return y}return AAe(n,e,i)}case"function":{if(n!==void 0){var E=Rp,b=i(n);return Rp=E,uR(n,e,b)}break}}var T=i;if(e==null)return T;var R=e[T];return R!==void 0?R:T}function AAe(n,e,i){var o="";if(Array.isArray(i))for(var l=0;l<i.length;l++)o+=uR(n,e,i[l])+";";else for(var u in i){var p=i[u];if(typeof p!="object"){var y=p;e!=null&&e[y]!==void 0?o+=u+"{"+e[y]+"}":Zq(y)&&(o+=IU(u)+":"+eY(u,y)+";")}else if(Array.isArray(p)&&typeof p[0]=="string"&&(e==null||e[p[0]]===void 0))for(var E=0;E<p.length;E++)Zq(p[E])&&(o+=IU(u)+":"+eY(u,p[E])+";");else{var b=uR(n,e,p);switch(u){case"animation":case"animationName":{o+=IU(u)+":"+b+";";break}default:o+=u+"{"+b+"}"}}}return o}var tY=/label:\s*([^\s;{]+)\s*(;|$)/g,Rp;function dN(n,e,i){if(n.length===1&&typeof n[0]=="object"&&n[0]!==null&&n[0].styles!==void 0)return n[0];var o=!0,l="";Rp=void 0;var u=n[0];if(u==null||u.raw===void 0)o=!1,l+=uR(i,e,u);else{var p=u;l+=p[0]}for(var y=1;y<n.length;y++)if(l+=uR(i,e,n[y]),o){var E=u;l+=E[y]}tY.lastIndex=0;for(var b="",T;(T=tY.exec(l))!==null;)b+="-"+T[1];var R=TAe(l)+b;return{name:R,styles:l,next:Rp}}var PAe=function(e){return e()},ste=dq.useInsertionEffect?dq.useInsertionEffect:!1,ote=ste||PAe,nY=ste||k.useLayoutEffect,Sj=k.createContext(typeof HTMLElement<"u"?_Ae({key:"css"}):null);Sj.Provider;var OAe=function(){return k.useContext(Sj)},bj=function(e){return k.forwardRef(function(i,o){var l=k.useContext(Sj);return e(i,l,o)})},US=k.createContext({}),kAe=function(e,i){if(typeof i=="function"){var o=i(e);return o}return iE({},e,i)},NAe=qq(function(n){return qq(function(e){return kAe(n,e)})}),xAe=function(e){var i=k.useContext(US);return e.theme!==i&&(i=NAe(i)(e.theme)),k.createElement(US.Provider,{value:i},e.children)},wj={}.hasOwnProperty,FV="__EMOTION_TYPE_PLEASE_DO_NOT_USE__",DAe=function(e,i){var o={};for(var l in i)wj.call(i,l)&&(o[l]=i[l]);return o[FV]=e,o},LAe=function(e){var i=e.cache,o=e.serialized,l=e.isStringTag;return Ej(i,o,l),ote(function(){return vj(i,o,l)}),null},MAe=bj(function(n,e,i){var o=n.css;typeof o=="string"&&e.registered[o]!==void 0&&(o=e.registered[o]);var l=n[FV],u=[o],p="";typeof n.className=="string"?p=rte(e.registered,u,n.className):n.className!=null&&(p=n.className+" ");var y=dN(u,void 0,k.useContext(US));p+=e.key+"-"+y.name;var E={};for(var b in n)wj.call(n,b)&&b!=="css"&&b!==FV&&(E[b]=n[b]);return E.className=p,i&&(E.ref=i),k.createElement(k.Fragment,null,k.createElement(LAe,{cache:e,serialized:y,isStringTag:typeof l=="string"}),k.createElement(l,E))}),UAe=MAe,rY=function(e,i){var o=arguments;if(i==null||!wj.call(i,"css"))return k.createElement.apply(void 0,o);var l=o.length,u=new Array(l);u[0]=UAe,u[1]=DAe(e,i);for(var p=2;p<l;p++)u[p]=o[p];return k.createElement.apply(null,u)};(function(n){var e;e||(e=n.JSX||(n.JSX={}))})(rY||(rY={}));var hN=bj(function(n,e){var i=n.styles,o=dN([i],void 0,k.useContext(US)),l=k.useRef();return nY(function(){var u=e.key+"-global",p=new e.sheet.constructor({key:u,nonce:e.sheet.nonce,container:e.sheet.container,speedy:e.sheet.isSpeedy}),y=!1,E=document.querySelector('style[data-emotion="'+u+" "+o.name+'"]');return e.sheet.tags.length&&(p.before=e.sheet.tags[0]),E!==null&&(y=!0,E.setAttribute("data-emotion",u),p.hydrate([E])),l.current=[p,y],function(){p.flush()}},[e]),nY(function(){var u=l.current,p=u[0],y=u[1];if(y){u[1]=!1;return}if(o.next!==void 0&&vj(e,o.next,!0),p.tags.length){var E=p.tags[p.tags.length-1].nextElementSibling;p.before=E,p.flush()}e.insert("",o,p,!1)},[e,o.name]),null});function VAe(){for(var n=arguments.length,e=new Array(n),i=0;i<n;i++)e[i]=arguments[i];return dN(e)}function BR(){var n=VAe.apply(void 0,arguments),e="animation-"+n.name;return{name:e,styles:"@keyframes "+e+"{"+n.styles+"}",anim:1,toString:function(){return"_EMO_"+this.name+"_"+this.styles+"_EMO_"}}}const Tj=k.createContext({});Tj.displayName="ColorModeContext";function pN(){const n=k.useContext(Tj);if(n===void 0)throw new Error("useColorMode must be used within a ColorModeProvider");return n}function xg(n,e){const{colorMode:i}=pN();return i==="dark"?e:n}const iO={light:"chakra-ui-light",dark:"chakra-ui-dark"};function jAe(n={}){const{preventTransition:e=!0,nonce:i}=n,o={setDataset:l=>{const u=e?o.preventTransition():void 0;document.documentElement.dataset.theme=l,document.documentElement.style.colorScheme=l,u==null||u()},setClassName(l){document.body.classList.add(l?iO.dark:iO.light),document.body.classList.remove(l?iO.light:iO.dark)},query(){return window.matchMedia("(prefers-color-scheme: dark)")},getSystemTheme(l){return o.query().matches??l==="dark"?"dark":"light"},addListener(l){const u=o.query(),p=y=>{l(y.matches?"dark":"light")};return typeof u.addListener=="function"?u.addListener(p):u.addEventListener("change",p),()=>{typeof u.removeListener=="function"?u.removeListener(p):u.removeEventListener("change",p)}},preventTransition(){const l=document.createElement("style");return l.appendChild(document.createTextNode("*{-webkit-transition:none!important;-moz-transition:none!important;-o-transition:none!important;-ms-transition:none!important;transition:none!important}")),i!==void 0&&(l.nonce=i),document.head.appendChild(l),()=>{window.getComputedStyle(document.body),requestAnimationFrame(()=>{requestAnimationFrame(()=>{document.head.removeChild(l)})})}}};return o}const FAe="chakra-ui-color-mode";function BAe(n){return{ssr:!1,type:"localStorage",get(e){if(!(globalThis!=null&&globalThis.document))return e;let i;try{i=localStorage.getItem(n)||e}catch{}return i||e},set(e){try{localStorage.setItem(n,e)}catch{}}}}const zAe=BAe(FAe),iY=()=>{},WAe=sve()?k.useLayoutEffect:k.useEffect;function sY(n,e){return n.type==="cookie"&&n.ssr?n.get(e):e}const ate=function(e){const{value:i,children:o,options:{useSystemColorMode:l,initialColorMode:u,disableTransitionOnChange:p}={},colorModeManager:y=zAe}=e,E=OAe(),b=u==="dark"?"dark":"light",[T,R]=k.useState(()=>sY(y,b)),[O,L]=k.useState(()=>sY(y)),{getSystemTheme:D,setClassName:U,setDataset:F,addListener:Y}=k.useMemo(()=>jAe({preventTransition:p,nonce:E==null?void 0:E.nonce}),[p,E==null?void 0:E.nonce]),W=u==="system"&&!T?O:T,re=k.useCallback(me=>{const q=me==="system"?D():me;R(q),U(q==="dark"),F(q),y.set(q)},[y,D,U,F]);WAe(()=>{u==="system"&&L(D())},[]),k.useEffect(()=>{const me=y.get();if(me){re(me);return}if(u==="system"){re("system");return}re(b)},[y,b,u,re]);const le=k.useCallback(()=>{re(W==="dark"?"light":"dark")},[W,re]);k.useEffect(()=>{if(l)return Y(re)},[l,Y,re]);const ie=k.useMemo(()=>({colorMode:i??W,toggleColorMode:i?iY:le,setColorMode:i?iY:re,forced:i!==void 0}),[W,le,re,i]);return S.jsx(Tj.Provider,{value:ie,children:o})};ate.displayName="ColorModeProvider";const cte=String.raw,lte=cte`
  :root,
  :host {
    --chakra-vh: 100vh;
  }

  @supports (height: -webkit-fill-available) {
    :root,
    :host {
      --chakra-vh: -webkit-fill-available;
    }
  }

  @supports (height: -moz-fill-available) {
    :root,
    :host {
      --chakra-vh: -moz-fill-available;
    }
  }

  @supports (height: 100dvh) {
    :root,
    :host {
      --chakra-vh: 100dvh;
    }
  }
`,GAe=()=>S.jsx(hN,{styles:lte}),HAe=({scope:n=""})=>S.jsx(hN,{styles:cte`
      html {
        line-height: 1.5;
        -webkit-text-size-adjust: 100%;
        font-family: system-ui, sans-serif;
        -webkit-font-smoothing: antialiased;
        text-rendering: optimizeLegibility;
        -moz-osx-font-smoothing: grayscale;
        touch-action: manipulation;
      }

      body {
        position: relative;
        min-height: 100%;
        margin: 0;
        font-feature-settings: "kern";
      }

      ${n} :where(*, *::before, *::after) {
        border-width: 0;
        border-style: solid;
        box-sizing: border-box;
        word-wrap: break-word;
      }

      main {
        display: block;
      }

      ${n} hr {
        border-top-width: 1px;
        box-sizing: content-box;
        height: 0;
        overflow: visible;
      }

      ${n} :where(pre, code, kbd,samp) {
        font-family: SFMono-Regular, Menlo, Monaco, Consolas, monospace;
        font-size: 1em;
      }

      ${n} a {
        background-color: transparent;
        color: inherit;
        text-decoration: inherit;
      }

      ${n} abbr[title] {
        border-bottom: none;
        text-decoration: underline;
        -webkit-text-decoration: underline dotted;
        text-decoration: underline dotted;
      }

      ${n} :where(b, strong) {
        font-weight: bold;
      }

      ${n} small {
        font-size: 80%;
      }

      ${n} :where(sub,sup) {
        font-size: 75%;
        line-height: 0;
        position: relative;
        vertical-align: baseline;
      }

      ${n} sub {
        bottom: -0.25em;
      }

      ${n} sup {
        top: -0.5em;
      }

      ${n} img {
        border-style: none;
      }

      ${n} :where(button, input, optgroup, select, textarea) {
        font-family: inherit;
        font-size: 100%;
        line-height: 1.15;
        margin: 0;
      }

      ${n} :where(button, input) {
        overflow: visible;
      }

      ${n} :where(button, select) {
        text-transform: none;
      }

      ${n} :where(
          button::-moz-focus-inner,
          [type="button"]::-moz-focus-inner,
          [type="reset"]::-moz-focus-inner,
          [type="submit"]::-moz-focus-inner
        ) {
        border-style: none;
        padding: 0;
      }

      ${n} fieldset {
        padding: 0.35em 0.75em 0.625em;
      }

      ${n} legend {
        box-sizing: border-box;
        color: inherit;
        display: table;
        max-width: 100%;
        padding: 0;
        white-space: normal;
      }

      ${n} progress {
        vertical-align: baseline;
      }

      ${n} textarea {
        overflow: auto;
      }

      ${n} :where([type="checkbox"], [type="radio"]) {
        box-sizing: border-box;
        padding: 0;
      }

      ${n} input[type="number"]::-webkit-inner-spin-button,
      ${n} input[type="number"]::-webkit-outer-spin-button {
        -webkit-appearance: none !important;
      }

      ${n} input[type="number"] {
        -moz-appearance: textfield;
      }

      ${n} input[type="search"] {
        -webkit-appearance: textfield;
        outline-offset: -2px;
      }

      ${n} input[type="search"]::-webkit-search-decoration {
        -webkit-appearance: none !important;
      }

      ${n} ::-webkit-file-upload-button {
        -webkit-appearance: button;
        font: inherit;
      }

      ${n} details {
        display: block;
      }

      ${n} summary {
        display: list-item;
      }

      template {
        display: none;
      }

      [hidden] {
        display: none !important;
      }

      ${n} :where(
          blockquote,
          dl,
          dd,
          h1,
          h2,
          h3,
          h4,
          h5,
          h6,
          hr,
          figure,
          p,
          pre
        ) {
        margin: 0;
      }

      ${n} button {
        background: transparent;
        padding: 0;
      }

      ${n} fieldset {
        margin: 0;
        padding: 0;
      }

      ${n} :where(ol, ul) {
        margin: 0;
        padding: 0;
      }

      ${n} textarea {
        resize: vertical;
      }

      ${n} :where(button, [role="button"]) {
        cursor: pointer;
      }

      ${n} button::-moz-focus-inner {
        border: 0 !important;
      }

      ${n} table {
        border-collapse: collapse;
      }

      ${n} :where(h1, h2, h3, h4, h5, h6) {
        font-size: inherit;
        font-weight: inherit;
      }

      ${n} :where(button, input, optgroup, select, textarea) {
        padding: 0;
        line-height: inherit;
        color: inherit;
      }

      ${n} :where(img, svg, video, canvas, audio, iframe, embed, object) {
        display: block;
      }

      ${n} :where(img, video) {
        max-width: 100%;
        height: auto;
      }

      [data-js-focus-visible]
        :focus:not([data-focus-visible-added]):not(
          [data-focus-visible-disabled]
        ) {
        outline: none;
        box-shadow: none;
      }

      ${n} select::-ms-expand {
        display: none;
      }

      ${lte}
    `});function $Ae(n){const{cssVarsRoot:e,theme:i,children:o}=n,l=k.useMemo(()=>kSe(i),[i]);return S.jsxs(xAe,{theme:l,children:[S.jsx(KAe,{root:e}),o]})}function KAe({root:n=":host, :root"}){const e=[n,"[data-theme]"].join(",");return S.jsx(hN,{styles:i=>({[e]:i.__cssVars})})}xi({name:"StylesContext",errorMessage:"useStyles: `styles` is undefined. Seems you forgot to wrap the components in `<StylesProvider />` "});function qAe(){const{colorMode:n}=pN();return S.jsx(hN,{styles:e=>{const i=gee(e,"styles.global"),o=Cl(i,{theme:e,colorMode:n});return o?Dee(o)(e):void 0}})}const[YAe,XAe]=xi({strict:!1,name:"PortalManagerContext"});function Cj(n){const{children:e,zIndex:i}=n;return S.jsx(YAe,{value:{zIndex:i},children:e})}Cj.displayName="PortalManager";const Rj=k.createContext({getDocument(){return document},getWindow(){return window}});Rj.displayName="EnvironmentContext";function JAe({defer:n}={}){const[,e]=k.useReducer(i=>i+1,0);return xp(()=>{n&&e()},[n]),k.useContext(Rj)}function ute(n){const{children:e,environment:i,disabled:o}=n,l=k.useRef(null),u=k.useMemo(()=>i||{getDocument:()=>{var y;return((y=l.current)==null?void 0:y.ownerDocument)??document},getWindow:()=>{var y;return((y=l.current)==null?void 0:y.ownerDocument.defaultView)??window}},[i]),p=!o||!i;return S.jsxs(Rj.Provider,{value:u,children:[e,p&&S.jsx("span",{id:"__chakra_env",hidden:!0,ref:l})]})}ute.displayName="EnvironmentProvider";const QAe=n=>{const{children:e,colorModeManager:i,portalZIndex:o,resetScope:l,resetCSS:u=!0,theme:p={},environment:y,cssVarsRoot:E,disableEnvironment:b,disableGlobalStyle:T}=n,R=S.jsx(ute,{environment:y,disabled:b,children:e});return S.jsx($Ae,{theme:p,cssVarsRoot:E,children:S.jsxs(ate,{colorModeManager:i,options:p.config,children:[u?S.jsx(HAe,{scope:l}):S.jsx(GAe,{}),!T&&S.jsx(qAe,{}),o?S.jsx(Cj,{zIndex:o,children:R}):R]})})},Ij=k.createContext({});function Aj(n){const e=k.useRef(null);return e.current===null&&(e.current=n()),e.current}const zR=k.createContext(null),Pj=k.createContext({transformPagePoint:n=>n,isStatic:!1,reducedMotion:"never"});class ZAe extends k.Component{getSnapshotBeforeUpdate(e){const i=this.props.childRef.current;if(i&&e.isPresent&&!this.props.isPresent){const o=this.props.sizeRef.current;o.height=i.offsetHeight||0,o.width=i.offsetWidth||0,o.top=i.offsetTop,o.left=i.offsetLeft}return null}componentDidUpdate(){}render(){return this.props.children}}function e1e({children:n,isPresent:e}){const i=k.useId(),o=k.useRef(null),l=k.useRef({width:0,height:0,top:0,left:0}),{nonce:u}=k.useContext(Pj);return k.useInsertionEffect(()=>{const{width:p,height:y,top:E,left:b}=l.current;if(e||!o.current||!p||!y)return;o.current.dataset.motionPopId=i;const T=document.createElement("style");return u&&(T.nonce=u),document.head.appendChild(T),T.sheet&&T.sheet.insertRule(`
          [data-motion-pop-id="${i}"] {
            position: absolute !important;
            width: ${p}px !important;
            height: ${y}px !important;
            top: ${E}px !important;
            left: ${b}px !important;
          }
        `),()=>{document.head.removeChild(T)}},[e]),S.jsx(ZAe,{isPresent:e,childRef:o,sizeRef:l,children:k.cloneElement(n,{ref:o})})}const t1e=({children:n,initial:e,isPresent:i,onExitComplete:o,custom:l,presenceAffectsLayout:u,mode:p})=>{const y=Aj(n1e),E=k.useId(),b=k.useCallback(R=>{y.set(R,!0);for(const O of y.values())if(!O)return;o&&o()},[y,o]),T=k.useMemo(()=>({id:E,initial:e,isPresent:i,custom:l,onExitComplete:b,register:R=>(y.set(R,!1),()=>y.delete(R))}),u?[Math.random(),b]:[i,b]);return k.useMemo(()=>{y.forEach((R,O)=>y.set(O,!1))},[i]),k.useEffect(()=>{!i&&!y.size&&o&&o()},[i]),p==="popLayout"&&(n=S.jsx(e1e,{isPresent:i,children:n})),S.jsx(zR.Provider,{value:T,children:n})};function n1e(){return new Map}function Oj(n=!0){const e=k.useContext(zR);if(e===null)return[!0,null];const{isPresent:i,onExitComplete:o,register:l}=e,u=k.useId();k.useEffect(()=>{n&&l(u)},[n]);const p=k.useCallback(()=>n&&o&&o(u),[u,o,n]);return!i&&o?[!1,p]:[!0]}function r1e(){return i1e(k.useContext(zR))}function i1e(n){return n===null?!0:n.isPresent}const sO=n=>n.key||"";function oY(n){const e=[];return k.Children.forEach(n,i=>{k.isValidElement(i)&&e.push(i)}),e}const kj=typeof window<"u",dte=kj?k.useLayoutEffect:k.useEffect,EE=({children:n,custom:e,initial:i=!0,onExitComplete:o,presenceAffectsLayout:l=!0,mode:u="sync",propagate:p=!1})=>{const[y,E]=Oj(p),b=k.useMemo(()=>oY(n),[n]),T=p&&!y?[]:b.map(sO),R=k.useRef(!0),O=k.useRef(b),L=Aj(()=>new Map),[D,U]=k.useState(b),[F,Y]=k.useState(b);dte(()=>{R.current=!1,O.current=b;for(let le=0;le<F.length;le++){const ie=sO(F[le]);T.includes(ie)?L.delete(ie):L.get(ie)!==!0&&L.set(ie,!1)}},[F,T.length,T.join("-")]);const W=[];if(b!==D){let le=[...b];for(let ie=0;ie<F.length;ie++){const me=F[ie],q=sO(me);T.includes(q)||(le.splice(ie,0,me),W.push(me))}u==="wait"&&W.length&&(le=W),Y(oY(le)),U(b);return}const{forceRender:re}=k.useContext(Ij);return S.jsx(S.Fragment,{children:F.map(le=>{const ie=sO(le),me=p&&!y?!1:b===F||T.includes(ie),q=()=>{if(L.has(ie))L.set(ie,!0);else return;let J=!0;L.forEach(Q=>{Q||(J=!1)}),J&&(re==null||re(),Y(O.current),p&&(E==null||E()),o&&o())};return S.jsx(t1e,{isPresent:me,initial:!R.current||i?void 0:!1,custom:me?void 0:e,presenceAffectsLayout:l,mode:u,onExitComplete:me?void 0:q,children:le},ie)})})},_u=n=>n;let hte=_u;function Nj(n){let e;return()=>(e===void 0&&(e=n()),e)}const VS=(n,e,i)=>{const o=e-n;return o===0?1:(i-n)/o},Wf=n=>n*1e3,Gf=n=>n/1e3,s1e={useManualTiming:!1};function o1e(n){let e=new Set,i=new Set,o=!1,l=!1;const u=new WeakSet;let p={delta:0,timestamp:0,isProcessing:!1};function y(b){u.has(b)&&(E.schedule(b),n()),b(p)}const E={schedule:(b,T=!1,R=!1)=>{const L=R&&o?e:i;return T&&u.add(b),L.has(b)||L.add(b),b},cancel:b=>{i.delete(b),u.delete(b)},process:b=>{if(p=b,o){l=!0;return}o=!0,[e,i]=[i,e],e.forEach(y),e.clear(),o=!1,l&&(l=!1,E.process(b))}};return E}const oO=["read","resolveKeyframes","update","preRender","render","postRender"],a1e=40;function pte(n,e){let i=!1,o=!0;const l={delta:0,timestamp:0,isProcessing:!1},u=()=>i=!0,p=oO.reduce((Y,W)=>(Y[W]=o1e(u),Y),{}),{read:y,resolveKeyframes:E,update:b,preRender:T,render:R,postRender:O}=p,L=()=>{const Y=performance.now();i=!1,l.delta=o?1e3/60:Math.max(Math.min(Y-l.timestamp,a1e),1),l.timestamp=Y,l.isProcessing=!0,y.process(l),E.process(l),b.process(l),T.process(l),R.process(l),O.process(l),l.isProcessing=!1,i&&e&&(o=!1,n(L))},D=()=>{i=!0,o=!0,l.isProcessing||n(L)};return{schedule:oO.reduce((Y,W)=>{const re=p[W];return Y[W]=(le,ie=!1,me=!1)=>(i||D(),re.schedule(le,ie,me)),Y},{}),cancel:Y=>{for(let W=0;W<oO.length;W++)p[oO[W]].cancel(Y)},state:l,steps:p}}const{schedule:us,cancel:Fg,state:Ua,steps:AU}=pte(typeof requestAnimationFrame<"u"?requestAnimationFrame:_u,!0),fte=k.createContext({strict:!1}),aY={animation:["animate","variants","whileHover","whileTap","exit","whileInView","whileFocus","whileDrag"],exit:["exit"],drag:["drag","dragControls"],focus:["whileFocus"],hover:["whileHover","onHoverStart","onHoverEnd"],tap:["whileTap","onTap","onTapStart","onTapCancel"],pan:["onPan","onPanStart","onPanSessionStart","onPanEnd"],inView:["whileInView","onViewportEnter","onViewportLeave"],layout:["layout","layoutId"]},jS={};for(const n in aY)jS[n]={isEnabled:e=>aY[n].some(i=>!!e[i])};function c1e(n){for(const e in n)jS[e]={...jS[e],...n[e]}}const l1e=new Set(["animate","exit","variants","initial","style","values","variants","transition","transformTemplate","custom","inherit","onBeforeLayoutMeasure","onAnimationStart","onAnimationComplete","onUpdate","onDragStart","onDrag","onDragEnd","onMeasureDragConstraints","onDirectionLock","onDragTransitionEnd","_dragX","_dragY","onHoverStart","onHoverEnd","onViewportEnter","onViewportLeave","globalTapTarget","ignoreStrict","viewport"]);function pk(n){return n.startsWith("while")||n.startsWith("drag")&&n!=="draggable"||n.startsWith("layout")||n.startsWith("onTap")||n.startsWith("onPan")||n.startsWith("onLayout")||l1e.has(n)}let mte=n=>!pk(n);function u1e(n){n&&(mte=e=>e.startsWith("on")?!pk(e):n(e))}try{u1e(require("@emotion/is-prop-valid").default)}catch{}function d1e(n,e,i){const o={};for(const l in n)l==="values"&&typeof n.values=="object"||(mte(l)||i===!0&&pk(l)||!e&&!pk(l)||n.draggable&&l.startsWith("onDrag"))&&(o[l]=n[l]);return o}function h1e(n){if(typeof Proxy>"u")return n;const e=new Map,i=(...o)=>n(...o);return new Proxy(i,{get:(o,l)=>l==="create"?n:(e.has(l)||e.set(l,n(l)),e.get(l))})}const fN=k.createContext({});function dR(n){return typeof n=="string"||Array.isArray(n)}function mN(n){return n!==null&&typeof n=="object"&&typeof n.start=="function"}const xj=["animate","whileInView","whileFocus","whileHover","whileTap","whileDrag","exit"],Dj=["initial",...xj];function gN(n){return mN(n.animate)||Dj.some(e=>dR(n[e]))}function gte(n){return!!(gN(n)||n.variants)}function p1e(n,e){if(gN(n)){const{initial:i,animate:o}=n;return{initial:i===!1||dR(i)?i:void 0,animate:dR(o)?o:void 0}}return n.inherit!==!1?e:{}}function f1e(n){const{initial:e,animate:i}=p1e(n,k.useContext(fN));return k.useMemo(()=>({initial:e,animate:i}),[cY(e),cY(i)])}function cY(n){return Array.isArray(n)?n.join(" "):n}const m1e=Symbol.for("motionComponentSymbol");function oS(n){return n&&typeof n=="object"&&Object.prototype.hasOwnProperty.call(n,"current")}function g1e(n,e,i){return k.useCallback(o=>{o&&n.onMount&&n.onMount(o),e&&(o?e.mount(o):e.unmount()),i&&(typeof i=="function"?i(o):oS(i)&&(i.current=o))},[e])}const Lj=n=>n.replace(/([a-z])([A-Z])/gu,"$1-$2").toLowerCase(),_1e="framerAppearId",_te="data-"+Lj(_1e),{schedule:Mj}=pte(queueMicrotask,!1),yte=k.createContext({});function y1e(n,e,i,o,l){var u,p;const{visualElement:y}=k.useContext(fN),E=k.useContext(fte),b=k.useContext(zR),T=k.useContext(Pj).reducedMotion,R=k.useRef(null);o=o||E.renderer,!R.current&&o&&(R.current=o(n,{visualState:e,parent:y,props:i,presenceContext:b,blockInitialAnimation:b?b.initial===!1:!1,reducedMotionConfig:T}));const O=R.current,L=k.useContext(yte);O&&!O.projection&&l&&(O.type==="html"||O.type==="svg")&&E1e(R.current,i,l,L);const D=k.useRef(!1);k.useInsertionEffect(()=>{O&&D.current&&O.update(i,b)});const U=i[_te],F=k.useRef(!!U&&!(!((u=window.MotionHandoffIsComplete)===null||u===void 0)&&u.call(window,U))&&((p=window.MotionHasOptimisedAnimation)===null||p===void 0?void 0:p.call(window,U)));return dte(()=>{O&&(D.current=!0,window.MotionIsMounted=!0,O.updateFeatures(),Mj.render(O.render),F.current&&O.animationState&&O.animationState.animateChanges())}),k.useEffect(()=>{O&&(!F.current&&O.animationState&&O.animationState.animateChanges(),F.current&&(queueMicrotask(()=>{var Y;(Y=window.MotionHandoffMarkAsComplete)===null||Y===void 0||Y.call(window,U)}),F.current=!1))}),O}function E1e(n,e,i,o){const{layoutId:l,layout:u,drag:p,dragConstraints:y,layoutScroll:E,layoutRoot:b}=e;n.projection=new i(n.latestValues,e["data-framer-portal-id"]?void 0:Ete(n.parent)),n.projection.setOptions({layoutId:l,layout:u,alwaysMeasureLayout:!!p||y&&oS(y),visualElement:n,animationType:typeof u=="string"?u:"both",initialPromotionConfig:o,layoutScroll:E,layoutRoot:b})}function Ete(n){if(n)return n.options.allowProjection!==!1?n.projection:Ete(n.parent)}function v1e({preloadedFeatures:n,createVisualElement:e,useRender:i,useVisualState:o,Component:l}){var u,p;n&&c1e(n);function y(b,T){let R;const O={...k.useContext(Pj),...b,layoutId:S1e(b)},{isStatic:L}=O,D=f1e(b),U=o(b,L);if(!L&&kj){b1e();const F=w1e(O);R=F.MeasureLayout,D.visualElement=y1e(l,U,O,e,F.ProjectionNode)}return S.jsxs(fN.Provider,{value:D,children:[R&&D.visualElement?S.jsx(R,{visualElement:D.visualElement,...O}):null,i(l,b,g1e(U,D.visualElement,T),U,L,D.visualElement)]})}y.displayName=`motion.${typeof l=="string"?l:`create(${(p=(u=l.displayName)!==null&&u!==void 0?u:l.name)!==null&&p!==void 0?p:""})`}`;const E=k.forwardRef(y);return E[m1e]=l,E}function S1e({layoutId:n}){const e=k.useContext(Ij).id;return e&&n!==void 0?e+"-"+n:n}function b1e(n,e){k.useContext(fte).strict}function w1e(n){const{drag:e,layout:i}=jS;if(!e&&!i)return{};const o={...e,...i};return{MeasureLayout:e!=null&&e.isEnabled(n)||i!=null&&i.isEnabled(n)?o.MeasureLayout:void 0,ProjectionNode:o.ProjectionNode}}const T1e=["animate","circle","defs","desc","ellipse","g","image","line","filter","marker","mask","metadata","path","pattern","polygon","polyline","rect","stop","switch","symbol","svg","text","tspan","use","view"];function Uj(n){return typeof n!="string"||n.includes("-")?!1:!!(T1e.indexOf(n)>-1||/[A-Z]/u.test(n))}function lY(n){const e=[{},{}];return n==null||n.values.forEach((i,o)=>{e[0][o]=i.get(),e[1][o]=i.getVelocity()}),e}function Vj(n,e,i,o){if(typeof e=="function"){const[l,u]=lY(o);e=e(i!==void 0?i:n.custom,l,u)}if(typeof e=="string"&&(e=n.variants&&n.variants[e]),typeof e=="function"){const[l,u]=lY(o);e=e(i!==void 0?i:n.custom,l,u)}return e}const BV=n=>Array.isArray(n),C1e=n=>!!(n&&typeof n=="object"&&n.mix&&n.toValue),R1e=n=>BV(n)?n[n.length-1]||0:n,fc=n=>!!(n&&n.getVelocity);function BO(n){const e=fc(n)?n.get():n;return C1e(e)?e.toValue():e}function I1e({scrapeMotionValuesFromProps:n,createRenderState:e,onUpdate:i},o,l,u){const p={latestValues:A1e(o,l,u,n),renderState:e()};return i&&(p.onMount=y=>i({props:o,current:y,...p}),p.onUpdate=y=>i(y)),p}const vte=n=>(e,i)=>{const o=k.useContext(fN),l=k.useContext(zR),u=()=>I1e(n,e,o,l);return i?u():Aj(u)};function A1e(n,e,i,o){const l={},u=o(n,{});for(const O in u)l[O]=BO(u[O]);let{initial:p,animate:y}=n;const E=gN(n),b=gte(n);e&&b&&!E&&n.inherit!==!1&&(p===void 0&&(p=e.initial),y===void 0&&(y=e.animate));let T=i?i.initial===!1:!1;T=T||p===!1;const R=T?y:p;if(R&&typeof R!="boolean"&&!mN(R)){const O=Array.isArray(R)?R:[R];for(let L=0;L<O.length;L++){const D=Vj(n,O[L]);if(D){const{transitionEnd:U,transition:F,...Y}=D;for(const W in Y){let re=Y[W];if(Array.isArray(re)){const le=T?re.length-1:0;re=re[le]}re!==null&&(l[W]=re)}for(const W in U)l[W]=U[W]}}}return l}const ab=["transformPerspective","x","y","z","translateX","translateY","translateZ","scale","scaleX","scaleY","rotate","rotateX","rotateY","rotateZ","skew","skewX","skewY"],vE=new Set(ab),Ste=n=>e=>typeof e=="string"&&e.startsWith(n),bte=Ste("--"),P1e=Ste("var(--"),jj=n=>P1e(n)?O1e.test(n.split("/*")[0].trim()):!1,O1e=/var\(--(?:[\w-]+\s*|[\w-]+\s*,(?:\s*[^)(\s]|\s*\((?:[^)(]|\([^)(]*\))*\))+\s*)\)$/iu,wte=(n,e)=>e&&typeof n=="number"?e.transform(n):n,Qf=(n,e,i)=>i>e?e:i<n?n:i,cb={test:n=>typeof n=="number",parse:parseFloat,transform:n=>n},hR={...cb,transform:n=>Qf(0,1,n)},aO={...cb,default:1},WR=n=>({test:e=>typeof e=="string"&&e.endsWith(n)&&e.split(" ").length===1,parse:parseFloat,transform:e=>`${e}${n}`}),Tg=WR("deg"),Mp=WR("%"),Xn=WR("px"),k1e=WR("vh"),N1e=WR("vw"),uY={...Mp,parse:n=>Mp.parse(n)/100,transform:n=>Mp.transform(n*100)},x1e={borderWidth:Xn,borderTopWidth:Xn,borderRightWidth:Xn,borderBottomWidth:Xn,borderLeftWidth:Xn,borderRadius:Xn,radius:Xn,borderTopLeftRadius:Xn,borderTopRightRadius:Xn,borderBottomRightRadius:Xn,borderBottomLeftRadius:Xn,width:Xn,maxWidth:Xn,height:Xn,maxHeight:Xn,top:Xn,right:Xn,bottom:Xn,left:Xn,padding:Xn,paddingTop:Xn,paddingRight:Xn,paddingBottom:Xn,paddingLeft:Xn,margin:Xn,marginTop:Xn,marginRight:Xn,marginBottom:Xn,marginLeft:Xn,backgroundPositionX:Xn,backgroundPositionY:Xn},D1e={rotate:Tg,rotateX:Tg,rotateY:Tg,rotateZ:Tg,scale:aO,scaleX:aO,scaleY:aO,scaleZ:aO,skew:Tg,skewX:Tg,skewY:Tg,distance:Xn,translateX:Xn,translateY:Xn,translateZ:Xn,x:Xn,y:Xn,z:Xn,perspective:Xn,transformPerspective:Xn,opacity:hR,originX:uY,originY:uY,originZ:Xn},dY={...cb,transform:Math.round},Fj={...x1e,...D1e,zIndex:dY,size:Xn,fillOpacity:hR,strokeOpacity:hR,numOctaves:dY},L1e={x:"translateX",y:"translateY",z:"translateZ",transformPerspective:"perspective"},M1e=ab.length;function U1e(n,e,i){let o="",l=!0;for(let u=0;u<M1e;u++){const p=ab[u],y=n[p];if(y===void 0)continue;let E=!0;if(typeof y=="number"?E=y===(p.startsWith("scale")?1:0):E=parseFloat(y)===0,!E||i){const b=wte(y,Fj[p]);if(!E){l=!1;const T=L1e[p]||p;o+=`${T}(${b}) `}i&&(e[p]=b)}}return o=o.trim(),i?o=i(e,l?"":o):l&&(o="none"),o}function Bj(n,e,i){const{style:o,vars:l,transformOrigin:u}=n;let p=!1,y=!1;for(const E in e){const b=e[E];if(vE.has(E)){p=!0;continue}else if(bte(E)){l[E]=b;continue}else{const T=wte(b,Fj[E]);E.startsWith("origin")?(y=!0,u[E]=T):o[E]=T}}if(e.transform||(p||i?o.transform=U1e(e,n.transform,i):o.transform&&(o.transform="none")),y){const{originX:E="50%",originY:b="50%",originZ:T=0}=u;o.transformOrigin=`${E} ${b} ${T}`}}const V1e={offset:"stroke-dashoffset",array:"stroke-dasharray"},j1e={offset:"strokeDashoffset",array:"strokeDasharray"};function F1e(n,e,i=1,o=0,l=!0){n.pathLength=1;const u=l?V1e:j1e;n[u.offset]=Xn.transform(-o);const p=Xn.transform(e),y=Xn.transform(i);n[u.array]=`${p} ${y}`}function hY(n,e,i){return typeof n=="string"?n:Xn.transform(e+i*n)}function B1e(n,e,i){const o=hY(e,n.x,n.width),l=hY(i,n.y,n.height);return`${o} ${l}`}function zj(n,{attrX:e,attrY:i,attrScale:o,originX:l,originY:u,pathLength:p,pathSpacing:y=1,pathOffset:E=0,...b},T,R){if(Bj(n,b,R),T){n.style.viewBox&&(n.attrs.viewBox=n.style.viewBox);return}n.attrs=n.style,n.style={};const{attrs:O,style:L,dimensions:D}=n;O.transform&&(D&&(L.transform=O.transform),delete O.transform),D&&(l!==void 0||u!==void 0||L.transform)&&(L.transformOrigin=B1e(D,l!==void 0?l:.5,u!==void 0?u:.5)),e!==void 0&&(O.x=e),i!==void 0&&(O.y=i),o!==void 0&&(O.scale=o),p!==void 0&&F1e(O,p,y,E,!1)}const Wj=()=>({style:{},transform:{},transformOrigin:{},vars:{}}),Tte=()=>({...Wj(),attrs:{}}),Gj=n=>typeof n=="string"&&n.toLowerCase()==="svg";function Cte(n,{style:e,vars:i},o,l){Object.assign(n.style,e,l&&l.getProjectionStyles(o));for(const u in i)n.style.setProperty(u,i[u])}const Rte=new Set(["baseFrequency","diffuseConstant","kernelMatrix","kernelUnitLength","keySplines","keyTimes","limitingConeAngle","markerHeight","markerWidth","numOctaves","targetX","targetY","surfaceScale","specularConstant","specularExponent","stdDeviation","tableValues","viewBox","gradientTransform","pathLength","startOffset","textLength","lengthAdjust"]);function Ite(n,e,i,o){Cte(n,e,void 0,o);for(const l in e.attrs)n.setAttribute(Rte.has(l)?l:Lj(l),e.attrs[l])}const fk={};function z1e(n){Object.assign(fk,n)}function Ate(n,{layout:e,layoutId:i}){return vE.has(n)||n.startsWith("origin")||(e||i!==void 0)&&(!!fk[n]||n==="opacity")}function Hj(n,e,i){var o;const{style:l}=n,u={};for(const p in l)(fc(l[p])||e.style&&fc(e.style[p])||Ate(p,n)||((o=i==null?void 0:i.getValue(p))===null||o===void 0?void 0:o.liveStyle)!==void 0)&&(u[p]=l[p]);return u}function Pte(n,e,i){const o=Hj(n,e,i);for(const l in n)if(fc(n[l])||fc(e[l])){const u=ab.indexOf(l)!==-1?"attr"+l.charAt(0).toUpperCase()+l.substring(1):l;o[u]=n[l]}return o}function W1e(n,e){try{e.dimensions=typeof n.getBBox=="function"?n.getBBox():n.getBoundingClientRect()}catch{e.dimensions={x:0,y:0,width:0,height:0}}}const pY=["x","y","width","height","cx","cy","r"],G1e={useVisualState:vte({scrapeMotionValuesFromProps:Pte,createRenderState:Tte,onUpdate:({props:n,prevProps:e,current:i,renderState:o,latestValues:l})=>{if(!i)return;let u=!!n.drag;if(!u){for(const y in l)if(vE.has(y)){u=!0;break}}if(!u)return;let p=!e;if(e)for(let y=0;y<pY.length;y++){const E=pY[y];n[E]!==e[E]&&(p=!0)}p&&us.read(()=>{W1e(i,o),us.render(()=>{zj(o,l,Gj(i.tagName),n.transformTemplate),Ite(i,o)})})}})},H1e={useVisualState:vte({scrapeMotionValuesFromProps:Hj,createRenderState:Wj})};function Ote(n,e,i){for(const o in e)!fc(e[o])&&!Ate(o,i)&&(n[o]=e[o])}function $1e({transformTemplate:n},e){return k.useMemo(()=>{const i=Wj();return Bj(i,e,n),Object.assign({},i.vars,i.style)},[e])}function K1e(n,e){const i=n.style||{},o={};return Ote(o,i,n),Object.assign(o,$1e(n,e)),o}function q1e(n,e){const i={},o=K1e(n,e);return n.drag&&n.dragListener!==!1&&(i.draggable=!1,o.userSelect=o.WebkitUserSelect=o.WebkitTouchCallout="none",o.touchAction=n.drag===!0?"none":`pan-${n.drag==="x"?"y":"x"}`),n.tabIndex===void 0&&(n.onTap||n.onTapStart||n.whileTap)&&(i.tabIndex=0),i.style=o,i}function Y1e(n,e,i,o){const l=k.useMemo(()=>{const u=Tte();return zj(u,e,Gj(o),n.transformTemplate),{...u.attrs,style:{...u.style}}},[e]);if(n.style){const u={};Ote(u,n.style,n),l.style={...u,...l.style}}return l}function X1e(n=!1){return(i,o,l,{latestValues:u},p)=>{const E=(Uj(i)?Y1e:q1e)(o,u,p,i),b=d1e(o,typeof i=="string",n),T=i!==k.Fragment?{...b,...E,ref:l}:{},{children:R}=o,O=k.useMemo(()=>fc(R)?R.get():R,[R]);return k.createElement(i,{...T,children:O})}}function J1e(n,e){return function(o,{forwardMotionProps:l}={forwardMotionProps:!1}){const p={...Uj(o)?G1e:H1e,preloadedFeatures:n,useRender:X1e(l),createVisualElement:e,Component:o};return v1e(p)}}function kte(n,e){if(!Array.isArray(e))return!1;const i=e.length;if(i!==n.length)return!1;for(let o=0;o<i;o++)if(e[o]!==n[o])return!1;return!0}function _N(n,e,i){const o=n.getProps();return Vj(o,e,i!==void 0?i:o.custom,n)}const Q1e=Nj(()=>window.ScrollTimeline!==void 0);class Z1e{constructor(e){this.stop=()=>this.runAll("stop"),this.animations=e.filter(Boolean)}get finished(){return Promise.all(this.animations.map(e=>"finished"in e?e.finished:e))}getAll(e){return this.animations[0][e]}setAll(e,i){for(let o=0;o<this.animations.length;o++)this.animations[o][e]=i}attachTimeline(e,i){const o=this.animations.map(l=>{if(Q1e()&&l.attachTimeline)return l.attachTimeline(e);if(typeof i=="function")return i(l)});return()=>{o.forEach((l,u)=>{l&&l(),this.animations[u].stop()})}}get time(){return this.getAll("time")}set time(e){this.setAll("time",e)}get speed(){return this.getAll("speed")}set speed(e){this.setAll("speed",e)}get startTime(){return this.getAll("startTime")}get duration(){let e=0;for(let i=0;i<this.animations.length;i++)e=Math.max(e,this.animations[i].duration);return e}runAll(e){this.animations.forEach(i=>i[e]())}flatten(){this.runAll("flatten")}play(){this.runAll("play")}pause(){this.runAll("pause")}cancel(){this.runAll("cancel")}complete(){this.runAll("complete")}}class ePe extends Z1e{then(e,i){return Promise.all(this.animations).then(e).catch(i)}}function $j(n,e){return n?n[e]||n.default||n:void 0}const zV=2e4;function Nte(n){let e=0;const i=50;let o=n.next(e);for(;!o.done&&e<zV;)e+=i,o=n.next(e);return e>=zV?1/0:e}function Kj(n){return typeof n=="function"}function fY(n,e){n.timeline=e,n.onfinish=null}const qj=n=>Array.isArray(n)&&typeof n[0]=="number",tPe={linearEasing:void 0};function nPe(n,e){const i=Nj(n);return()=>{var o;return(o=tPe[e])!==null&&o!==void 0?o:i()}}const mk=nPe(()=>{try{document.createElement("div").animate({opacity:0},{easing:"linear(0, 1)"})}catch{return!1}return!0},"linearEasing"),xte=(n,e,i=10)=>{let o="";const l=Math.max(Math.round(e/i),2);for(let u=0;u<l;u++)o+=n(VS(0,l-1,u))+", ";return`linear(${o.substring(0,o.length-2)})`};function Dte(n){return!!(typeof n=="function"&&mk()||!n||typeof n=="string"&&(n in WV||mk())||qj(n)||Array.isArray(n)&&n.every(Dte))}const wC=([n,e,i,o])=>`cubic-bezier(${n}, ${e}, ${i}, ${o})`,WV={linear:"linear",ease:"ease",easeIn:"ease-in",easeOut:"ease-out",easeInOut:"ease-in-out",circIn:wC([0,.65,.55,1]),circOut:wC([.55,0,1,.45]),backIn:wC([.31,.01,.66,-.59]),backOut:wC([.33,1.53,.69,.99])};function Lte(n,e){if(n)return typeof n=="function"&&mk()?xte(n,e):qj(n)?wC(n):Array.isArray(n)?n.map(i=>Lte(i,e)||WV.easeOut):WV[n]}const hh={x:!1,y:!1};function Mte(){return hh.x||hh.y}function rPe(n,e,i){var o;if(n instanceof Element)return[n];if(typeof n=="string"){let l=document;const u=(o=void 0)!==null&&o!==void 0?o:l.querySelectorAll(n);return u?Array.from(u):[]}return Array.from(n)}function Ute(n,e){const i=rPe(n),o=new AbortController,l={passive:!0,...e,signal:o.signal};return[i,l,()=>o.abort()]}function mY(n){return e=>{e.pointerType==="touch"||Mte()||n(e)}}function iPe(n,e,i={}){const[o,l,u]=Ute(n,i),p=mY(y=>{const{target:E}=y,b=e(y);if(typeof b!="function"||!E)return;const T=mY(R=>{b(R),E.removeEventListener("pointerleave",T)});E.addEventListener("pointerleave",T,l)});return o.forEach(y=>{y.addEventListener("pointerenter",p,l)}),u}const Vte=(n,e)=>e?n===e?!0:Vte(n,e.parentElement):!1,Yj=n=>n.pointerType==="mouse"?typeof n.button!="number"||n.button<=0:n.isPrimary!==!1,sPe=new Set(["BUTTON","INPUT","SELECT","TEXTAREA","A"]);function oPe(n){return sPe.has(n.tagName)||n.tabIndex!==-1}const TC=new WeakSet;function gY(n){return e=>{e.key==="Enter"&&n(e)}}function PU(n,e){n.dispatchEvent(new PointerEvent("pointer"+e,{isPrimary:!0,bubbles:!0}))}const aPe=(n,e)=>{const i=n.currentTarget;if(!i)return;const o=gY(()=>{if(TC.has(i))return;PU(i,"down");const l=gY(()=>{PU(i,"up")}),u=()=>PU(i,"cancel");i.addEventListener("keyup",l,e),i.addEventListener("blur",u,e)});i.addEventListener("keydown",o,e),i.addEventListener("blur",()=>i.removeEventListener("keydown",o),e)};function _Y(n){return Yj(n)&&!Mte()}function cPe(n,e,i={}){const[o,l,u]=Ute(n,i),p=y=>{const E=y.currentTarget;if(!_Y(y)||TC.has(E))return;TC.add(E);const b=e(y),T=(L,D)=>{window.removeEventListener("pointerup",R),window.removeEventListener("pointercancel",O),!(!_Y(L)||!TC.has(E))&&(TC.delete(E),typeof b=="function"&&b(L,{success:D}))},R=L=>{T(L,i.useGlobalTarget||Vte(E,L.target))},O=L=>{T(L,!1)};window.addEventListener("pointerup",R,l),window.addEventListener("pointercancel",O,l)};return o.forEach(y=>{!oPe(y)&&y.getAttribute("tabindex")===null&&(y.tabIndex=0),(i.useGlobalTarget?window:y).addEventListener("pointerdown",p,l),y.addEventListener("focus",b=>aPe(b,l),l)}),u}function lPe(n){return n==="x"||n==="y"?hh[n]?null:(hh[n]=!0,()=>{hh[n]=!1}):hh.x||hh.y?null:(hh.x=hh.y=!0,()=>{hh.x=hh.y=!1})}const jte=new Set(["width","height","top","left","right","bottom",...ab]);let zO;function uPe(){zO=void 0}const Up={now:()=>(zO===void 0&&Up.set(Ua.isProcessing||s1e.useManualTiming?Ua.timestamp:performance.now()),zO),set:n=>{zO=n,queueMicrotask(uPe)}};function Xj(n,e){n.indexOf(e)===-1&&n.push(e)}function Jj(n,e){const i=n.indexOf(e);i>-1&&n.splice(i,1)}class Qj{constructor(){this.subscriptions=[]}add(e){return Xj(this.subscriptions,e),()=>Jj(this.subscriptions,e)}notify(e,i,o){const l=this.subscriptions.length;if(l)if(l===1)this.subscriptions[0](e,i,o);else for(let u=0;u<l;u++){const p=this.subscriptions[u];p&&p(e,i,o)}}getSize(){return this.subscriptions.length}clear(){this.subscriptions.length=0}}function Fte(n,e){return e?n*(1e3/e):0}const yY=30,dPe=n=>!isNaN(parseFloat(n));class hPe{constructor(e,i={}){this.version="11.18.2",this.canTrackVelocity=null,this.events={},this.updateAndNotify=(o,l=!0)=>{const u=Up.now();this.updatedAt!==u&&this.setPrevFrameValue(),this.prev=this.current,this.setCurrent(o),this.current!==this.prev&&this.events.change&&this.events.change.notify(this.current),l&&this.events.renderRequest&&this.events.renderRequest.notify(this.current)},this.hasAnimated=!1,this.setCurrent(e),this.owner=i.owner}setCurrent(e){this.current=e,this.updatedAt=Up.now(),this.canTrackVelocity===null&&e!==void 0&&(this.canTrackVelocity=dPe(this.current))}setPrevFrameValue(e=this.current){this.prevFrameValue=e,this.prevUpdatedAt=this.updatedAt}onChange(e){return this.on("change",e)}on(e,i){this.events[e]||(this.events[e]=new Qj);const o=this.events[e].add(i);return e==="change"?()=>{o(),us.read(()=>{this.events.change.getSize()||this.stop()})}:o}clearListeners(){for(const e in this.events)this.events[e].clear()}attach(e,i){this.passiveEffect=e,this.stopPassiveEffect=i}set(e,i=!0){!i||!this.passiveEffect?this.updateAndNotify(e,i):this.passiveEffect(e,this.updateAndNotify)}setWithVelocity(e,i,o){this.set(i),this.prev=void 0,this.prevFrameValue=e,this.prevUpdatedAt=this.updatedAt-o}jump(e,i=!0){this.updateAndNotify(e),this.prev=e,this.prevUpdatedAt=this.prevFrameValue=void 0,i&&this.stop(),this.stopPassiveEffect&&this.stopPassiveEffect()}get(){return this.current}getPrevious(){return this.prev}getVelocity(){const e=Up.now();if(!this.canTrackVelocity||this.prevFrameValue===void 0||e-this.updatedAt>yY)return 0;const i=Math.min(this.updatedAt-this.prevUpdatedAt,yY);return Fte(parseFloat(this.current)-parseFloat(this.prevFrameValue),i)}start(e){return this.stop(),new Promise(i=>{this.hasAnimated=!0,this.animation=e(i),this.events.animationStart&&this.events.animationStart.notify()}).then(()=>{this.events.animationComplete&&this.events.animationComplete.notify(),this.clearAnimation()})}stop(){this.animation&&(this.animation.stop(),this.events.animationCancel&&this.events.animationCancel.notify()),this.clearAnimation()}isAnimating(){return!!this.animation}clearAnimation(){delete this.animation}destroy(){this.clearListeners(),this.stop(),this.stopPassiveEffect&&this.stopPassiveEffect()}}function pR(n,e){return new hPe(n,e)}function pPe(n,e,i){n.hasValue(e)?n.getValue(e).set(i):n.addValue(e,pR(i))}function fPe(n,e){const i=_N(n,e);let{transitionEnd:o={},transition:l={},...u}=i||{};u={...u,...o};for(const p in u){const y=R1e(u[p]);pPe(n,p,y)}}function mPe(n){return!!(fc(n)&&n.add)}function GV(n,e){const i=n.getValue("willChange");if(mPe(i))return i.add(e)}function Bte(n){return n.props[_te]}const zte=(n,e,i)=>(((1-3*i+3*e)*n+(3*i-6*e))*n+3*e)*n,gPe=1e-7,_Pe=12;function yPe(n,e,i,o,l){let u,p,y=0;do p=e+(i-e)/2,u=zte(p,o,l)-n,u>0?i=p:e=p;while(Math.abs(u)>gPe&&++y<_Pe);return p}function GR(n,e,i,o){if(n===e&&i===o)return _u;const l=u=>yPe(u,0,1,n,i);return u=>u===0||u===1?u:zte(l(u),e,o)}const Wte=n=>e=>e<=.5?n(2*e)/2:(2-n(2*(1-e)))/2,Gte=n=>e=>1-n(1-e),Hte=GR(.33,1.53,.69,.99),Zj=Gte(Hte),$te=Wte(Zj),Kte=n=>(n*=2)<1?.5*Zj(n):.5*(2-Math.pow(2,-10*(n-1))),eF=n=>1-Math.sin(Math.acos(n)),qte=Gte(eF),Yte=Wte(eF),Xte=n=>/^0[^.\s]+$/u.test(n);function EPe(n){return typeof n=="number"?n===0:n!==null?n==="none"||n==="0"||Xte(n):!0}const zC=n=>Math.round(n*1e5)/1e5,tF=/-?(?:\d+(?:\.\d+)?|\.\d+)/gu;function vPe(n){return n==null}const SPe=/^(?:#[\da-f]{3,8}|(?:rgb|hsl)a?\((?:-?[\d.]+%?[,\s]+){2}-?[\d.]+%?\s*(?:[,/]\s*)?(?:\b\d+(?:\.\d+)?|\.\d+)?%?\))$/iu,nF=(n,e)=>i=>!!(typeof i=="string"&&SPe.test(i)&&i.startsWith(n)||e&&!vPe(i)&&Object.prototype.hasOwnProperty.call(i,e)),Jte=(n,e,i)=>o=>{if(typeof o!="string")return o;const[l,u,p,y]=o.match(tF);return{[n]:parseFloat(l),[e]:parseFloat(u),[i]:parseFloat(p),alpha:y!==void 0?parseFloat(y):1}},bPe=n=>Qf(0,255,n),OU={...cb,transform:n=>Math.round(bPe(n))},Vy={test:nF("rgb","red"),parse:Jte("red","green","blue"),transform:({red:n,green:e,blue:i,alpha:o=1})=>"rgba("+OU.transform(n)+", "+OU.transform(e)+", "+OU.transform(i)+", "+zC(hR.transform(o))+")"};function wPe(n){let e="",i="",o="",l="";return n.length>5?(e=n.substring(1,3),i=n.substring(3,5),o=n.substring(5,7),l=n.substring(7,9)):(e=n.substring(1,2),i=n.substring(2,3),o=n.substring(3,4),l=n.substring(4,5),e+=e,i+=i,o+=o,l+=l),{red:parseInt(e,16),green:parseInt(i,16),blue:parseInt(o,16),alpha:l?parseInt(l,16)/255:1}}const HV={test:nF("#"),parse:wPe,transform:Vy.transform},aS={test:nF("hsl","hue"),parse:Jte("hue","saturation","lightness"),transform:({hue:n,saturation:e,lightness:i,alpha:o=1})=>"hsla("+Math.round(n)+", "+Mp.transform(zC(e))+", "+Mp.transform(zC(i))+", "+zC(hR.transform(o))+")"},uc={test:n=>Vy.test(n)||HV.test(n)||aS.test(n),parse:n=>Vy.test(n)?Vy.parse(n):aS.test(n)?aS.parse(n):HV.parse(n),transform:n=>typeof n=="string"?n:n.hasOwnProperty("red")?Vy.transform(n):aS.transform(n)},TPe=/(?:#[\da-f]{3,8}|(?:rgb|hsl)a?\((?:-?[\d.]+%?[,\s]+){2}-?[\d.]+%?\s*(?:[,/]\s*)?(?:\b\d+(?:\.\d+)?|\.\d+)?%?\))/giu;function CPe(n){var e,i;return isNaN(n)&&typeof n=="string"&&(((e=n.match(tF))===null||e===void 0?void 0:e.length)||0)+(((i=n.match(TPe))===null||i===void 0?void 0:i.length)||0)>0}const Qte="number",Zte="color",RPe="var",IPe="var(",EY="${}",APe=/var\s*\(\s*--(?:[\w-]+\s*|[\w-]+\s*,(?:\s*[^)(\s]|\s*\((?:[^)(]|\([^)(]*\))*\))+\s*)\)|#[\da-f]{3,8}|(?:rgb|hsl)a?\((?:-?[\d.]+%?[,\s]+){2}-?[\d.]+%?\s*(?:[,/]\s*)?(?:\b\d+(?:\.\d+)?|\.\d+)?%?\)|-?(?:\d+(?:\.\d+)?|\.\d+)/giu;function fR(n){const e=n.toString(),i=[],o={color:[],number:[],var:[]},l=[];let u=0;const y=e.replace(APe,E=>(uc.test(E)?(o.color.push(u),l.push(Zte),i.push(uc.parse(E))):E.startsWith(IPe)?(o.var.push(u),l.push(RPe),i.push(E)):(o.number.push(u),l.push(Qte),i.push(parseFloat(E))),++u,EY)).split(EY);return{values:i,split:y,indexes:o,types:l}}function ene(n){return fR(n).values}function tne(n){const{split:e,types:i}=fR(n),o=e.length;return l=>{let u="";for(let p=0;p<o;p++)if(u+=e[p],l[p]!==void 0){const y=i[p];y===Qte?u+=zC(l[p]):y===Zte?u+=uc.transform(l[p]):u+=l[p]}return u}}const PPe=n=>typeof n=="number"?0:n;function OPe(n){const e=ene(n);return tne(n)(e.map(PPe))}const Bg={test:CPe,parse:ene,createTransformer:tne,getAnimatableNone:OPe},kPe=new Set(["brightness","contrast","saturate","opacity"]);function NPe(n){const[e,i]=n.slice(0,-1).split("(");if(e==="drop-shadow")return n;const[o]=i.match(tF)||[];if(!o)return n;const l=i.replace(o,"");let u=kPe.has(e)?1:0;return o!==i&&(u*=100),e+"("+u+l+")"}const xPe=/\b([a-z-]*)\(.*?\)/gu,$V={...Bg,getAnimatableNone:n=>{const e=n.match(xPe);return e?e.map(NPe).join(" "):n}},DPe={...Fj,color:uc,backgroundColor:uc,outlineColor:uc,fill:uc,stroke:uc,borderColor:uc,borderTopColor:uc,borderRightColor:uc,borderBottomColor:uc,borderLeftColor:uc,filter:$V,WebkitFilter:$V},rF=n=>DPe[n];function nne(n,e){let i=rF(n);return i!==$V&&(i=Bg),i.getAnimatableNone?i.getAnimatableNone(e):void 0}const LPe=new Set(["auto","none","0"]);function MPe(n,e,i){let o=0,l;for(;o<n.length&&!l;){const u=n[o];typeof u=="string"&&!LPe.has(u)&&fR(u).values.length&&(l=n[o]),o++}if(l&&i)for(const u of e)n[u]=nne(i,l)}const vY=n=>n===cb||n===Xn,SY=(n,e)=>parseFloat(n.split(", ")[e]),bY=(n,e)=>(i,{transform:o})=>{if(o==="none"||!o)return 0;const l=o.match(/^matrix3d\((.+)\)$/u);if(l)return SY(l[1],e);{const u=o.match(/^matrix\((.+)\)$/u);return u?SY(u[1],n):0}},UPe=new Set(["x","y","z"]),VPe=ab.filter(n=>!UPe.has(n));function jPe(n){const e=[];return VPe.forEach(i=>{const o=n.getValue(i);o!==void 0&&(e.push([i,o.get()]),o.set(i.startsWith("scale")?1:0))}),e}const FS={width:({x:n},{paddingLeft:e="0",paddingRight:i="0"})=>n.max-n.min-parseFloat(e)-parseFloat(i),height:({y:n},{paddingTop:e="0",paddingBottom:i="0"})=>n.max-n.min-parseFloat(e)-parseFloat(i),top:(n,{top:e})=>parseFloat(e),left:(n,{left:e})=>parseFloat(e),bottom:({y:n},{top:e})=>parseFloat(e)+(n.max-n.min),right:({x:n},{left:e})=>parseFloat(e)+(n.max-n.min),x:bY(4,13),y:bY(5,14)};FS.translateX=FS.x;FS.translateY=FS.y;const qy=new Set;let KV=!1,qV=!1;function rne(){if(qV){const n=Array.from(qy).filter(o=>o.needsMeasurement),e=new Set(n.map(o=>o.element)),i=new Map;e.forEach(o=>{const l=jPe(o);l.length&&(i.set(o,l),o.render())}),n.forEach(o=>o.measureInitialState()),e.forEach(o=>{o.render();const l=i.get(o);l&&l.forEach(([u,p])=>{var y;(y=o.getValue(u))===null||y===void 0||y.set(p)})}),n.forEach(o=>o.measureEndState()),n.forEach(o=>{o.suspendedScrollY!==void 0&&window.scrollTo(0,o.suspendedScrollY)})}qV=!1,KV=!1,qy.forEach(n=>n.complete()),qy.clear()}function ine(){qy.forEach(n=>{n.readKeyframes(),n.needsMeasurement&&(qV=!0)})}function FPe(){ine(),rne()}class iF{constructor(e,i,o,l,u,p=!1){this.isComplete=!1,this.isAsync=!1,this.needsMeasurement=!1,this.isScheduled=!1,this.unresolvedKeyframes=[...e],this.onComplete=i,this.name=o,this.motionValue=l,this.element=u,this.isAsync=p}scheduleResolve(){this.isScheduled=!0,this.isAsync?(qy.add(this),KV||(KV=!0,us.read(ine),us.resolveKeyframes(rne))):(this.readKeyframes(),this.complete())}readKeyframes(){const{unresolvedKeyframes:e,name:i,element:o,motionValue:l}=this;for(let u=0;u<e.length;u++)if(e[u]===null)if(u===0){const p=l==null?void 0:l.get(),y=e[e.length-1];if(p!==void 0)e[0]=p;else if(o&&i){const E=o.readValue(i,y);E!=null&&(e[0]=E)}e[0]===void 0&&(e[0]=y),l&&p===void 0&&l.set(e[0])}else e[u]=e[u-1]}setFinalKeyframe(){}measureInitialState(){}renderEndStyles(){}measureEndState(){}complete(){this.isComplete=!0,this.onComplete(this.unresolvedKeyframes,this.finalKeyframe),qy.delete(this)}cancel(){this.isComplete||(this.isScheduled=!1,qy.delete(this))}resume(){this.isComplete||this.scheduleResolve()}}const sne=n=>/^-?(?:\d+(?:\.\d+)?|\.\d+)$/u.test(n),BPe=/^var\(--(?:([\w-]+)|([\w-]+), ?([a-zA-Z\d ()%#.,-]+))\)/u;function zPe(n){const e=BPe.exec(n);if(!e)return[,];const[,i,o,l]=e;return[`--${i??o}`,l]}function one(n,e,i=1){const[o,l]=zPe(n);if(!o)return;const u=window.getComputedStyle(e).getPropertyValue(o);if(u){const p=u.trim();return sne(p)?parseFloat(p):p}return jj(l)?one(l,e,i+1):l}const ane=n=>e=>e.test(n),WPe={test:n=>n==="auto",parse:n=>n},cne=[cb,Xn,Mp,Tg,N1e,k1e,WPe],wY=n=>cne.find(ane(n));class lne extends iF{constructor(e,i,o,l,u){super(e,i,o,l,u,!0)}readKeyframes(){const{unresolvedKeyframes:e,element:i,name:o}=this;if(!i||!i.current)return;super.readKeyframes();for(let E=0;E<e.length;E++){let b=e[E];if(typeof b=="string"&&(b=b.trim(),jj(b))){const T=one(b,i.current);T!==void 0&&(e[E]=T),E===e.length-1&&(this.finalKeyframe=b)}}if(this.resolveNoneKeyframes(),!jte.has(o)||e.length!==2)return;const[l,u]=e,p=wY(l),y=wY(u);if(p!==y)if(vY(p)&&vY(y))for(let E=0;E<e.length;E++){const b=e[E];typeof b=="string"&&(e[E]=parseFloat(b))}else this.needsMeasurement=!0}resolveNoneKeyframes(){const{unresolvedKeyframes:e,name:i}=this,o=[];for(let l=0;l<e.length;l++)EPe(e[l])&&o.push(l);o.length&&MPe(e,o,i)}measureInitialState(){const{element:e,unresolvedKeyframes:i,name:o}=this;if(!e||!e.current)return;o==="height"&&(this.suspendedScrollY=window.pageYOffset),this.measuredOrigin=FS[o](e.measureViewportBox(),window.getComputedStyle(e.current)),i[0]=this.measuredOrigin;const l=i[i.length-1];l!==void 0&&e.getValue(o,l).jump(l,!1)}measureEndState(){var e;const{element:i,name:o,unresolvedKeyframes:l}=this;if(!i||!i.current)return;const u=i.getValue(o);u&&u.jump(this.measuredOrigin,!1);const p=l.length-1,y=l[p];l[p]=FS[o](i.measureViewportBox(),window.getComputedStyle(i.current)),y!==null&&this.finalKeyframe===void 0&&(this.finalKeyframe=y),!((e=this.removedTransforms)===null||e===void 0)&&e.length&&this.removedTransforms.forEach(([E,b])=>{i.getValue(E).set(b)}),this.resolveNoneKeyframes()}}const TY=(n,e)=>e==="zIndex"?!1:!!(typeof n=="number"||Array.isArray(n)||typeof n=="string"&&(Bg.test(n)||n==="0")&&!n.startsWith("url("));function GPe(n){const e=n[0];if(n.length===1)return!0;for(let i=0;i<n.length;i++)if(n[i]!==e)return!0}function HPe(n,e,i,o){const l=n[0];if(l===null)return!1;if(e==="display"||e==="visibility")return!0;const u=n[n.length-1],p=TY(l,e),y=TY(u,e);return!p||!y?!1:GPe(n)||(i==="spring"||Kj(i))&&o}const $Pe=n=>n!==null;function yN(n,{repeat:e,repeatType:i="loop"},o){const l=n.filter($Pe),u=e&&i!=="loop"&&e%2===1?0:l.length-1;return!u||o===void 0?l[u]:o}const KPe=40;class une{constructor({autoplay:e=!0,delay:i=0,type:o="keyframes",repeat:l=0,repeatDelay:u=0,repeatType:p="loop",...y}){this.isStopped=!1,this.hasAttemptedResolve=!1,this.createdAt=Up.now(),this.options={autoplay:e,delay:i,type:o,repeat:l,repeatDelay:u,repeatType:p,...y},this.updateFinishedPromise()}calcStartTime(){return this.resolvedAt?this.resolvedAt-this.createdAt>KPe?this.resolvedAt:this.createdAt:this.createdAt}get resolved(){return!this._resolved&&!this.hasAttemptedResolve&&FPe(),this._resolved}onKeyframesResolved(e,i){this.resolvedAt=Up.now(),this.hasAttemptedResolve=!0;const{name:o,type:l,velocity:u,delay:p,onComplete:y,onUpdate:E,isGenerator:b}=this.options;if(!b&&!HPe(e,o,l,u))if(p)this.options.duration=0;else{E&&E(yN(e,this.options,i)),y&&y(),this.resolveFinishedPromise();return}const T=this.initPlayback(e,i);T!==!1&&(this._resolved={keyframes:e,finalKeyframe:i,...T},this.onPostResolved())}onPostResolved(){}then(e,i){return this.currentFinishedPromise.then(e,i)}flatten(){this.options.type="keyframes",this.options.ease="linear"}updateFinishedPromise(){this.currentFinishedPromise=new Promise(e=>{this.resolveFinishedPromise=e})}}const ks=(n,e,i)=>n+(e-n)*i;function kU(n,e,i){return i<0&&(i+=1),i>1&&(i-=1),i<1/6?n+(e-n)*6*i:i<1/2?e:i<2/3?n+(e-n)*(2/3-i)*6:n}function qPe({hue:n,saturation:e,lightness:i,alpha:o}){n/=360,e/=100,i/=100;let l=0,u=0,p=0;if(!e)l=u=p=i;else{const y=i<.5?i*(1+e):i+e-i*e,E=2*i-y;l=kU(E,y,n+1/3),u=kU(E,y,n),p=kU(E,y,n-1/3)}return{red:Math.round(l*255),green:Math.round(u*255),blue:Math.round(p*255),alpha:o}}function gk(n,e){return i=>i>0?e:n}const NU=(n,e,i)=>{const o=n*n,l=i*(e*e-o)+o;return l<0?0:Math.sqrt(l)},YPe=[HV,Vy,aS],XPe=n=>YPe.find(e=>e.test(n));function CY(n){const e=XPe(n);if(!e)return!1;let i=e.parse(n);return e===aS&&(i=qPe(i)),i}const RY=(n,e)=>{const i=CY(n),o=CY(e);if(!i||!o)return gk(n,e);const l={...i};return u=>(l.red=NU(i.red,o.red,u),l.green=NU(i.green,o.green,u),l.blue=NU(i.blue,o.blue,u),l.alpha=ks(i.alpha,o.alpha,u),Vy.transform(l))},JPe=(n,e)=>i=>e(n(i)),HR=(...n)=>n.reduce(JPe),YV=new Set(["none","hidden"]);function QPe(n,e){return YV.has(n)?i=>i<=0?n:e:i=>i>=1?e:n}function ZPe(n,e){return i=>ks(n,e,i)}function sF(n){return typeof n=="number"?ZPe:typeof n=="string"?jj(n)?gk:uc.test(n)?RY:nOe:Array.isArray(n)?dne:typeof n=="object"?uc.test(n)?RY:eOe:gk}function dne(n,e){const i=[...n],o=i.length,l=n.map((u,p)=>sF(u)(u,e[p]));return u=>{for(let p=0;p<o;p++)i[p]=l[p](u);return i}}function eOe(n,e){const i={...n,...e},o={};for(const l in i)n[l]!==void 0&&e[l]!==void 0&&(o[l]=sF(n[l])(n[l],e[l]));return l=>{for(const u in o)i[u]=o[u](l);return i}}function tOe(n,e){var i;const o=[],l={color:0,var:0,number:0};for(let u=0;u<e.values.length;u++){const p=e.types[u],y=n.indexes[p][l[p]],E=(i=n.values[y])!==null&&i!==void 0?i:0;o[u]=E,l[p]++}return o}const nOe=(n,e)=>{const i=Bg.createTransformer(e),o=fR(n),l=fR(e);return o.indexes.var.length===l.indexes.var.length&&o.indexes.color.length===l.indexes.color.length&&o.indexes.number.length>=l.indexes.number.length?YV.has(n)&&!l.values.length||YV.has(e)&&!o.values.length?QPe(n,e):HR(dne(tOe(o,l),l.values),i):gk(n,e)};function hne(n,e,i){return typeof n=="number"&&typeof e=="number"&&typeof i=="number"?ks(n,e,i):sF(n)(n,e)}const rOe=5;function pne(n,e,i){const o=Math.max(e-rOe,0);return Fte(i-n(o),e-o)}const $s={stiffness:100,damping:10,mass:1,velocity:0,duration:800,bounce:.3,visualDuration:.3,restSpeed:{granular:.01,default:2},restDelta:{granular:.005,default:.5},minDuration:.01,maxDuration:10,minDamping:.05,maxDamping:1},xU=.001;function iOe({duration:n=$s.duration,bounce:e=$s.bounce,velocity:i=$s.velocity,mass:o=$s.mass}){let l,u,p=1-e;p=Qf($s.minDamping,$s.maxDamping,p),n=Qf($s.minDuration,$s.maxDuration,Gf(n)),p<1?(l=b=>{const T=b*p,R=T*n,O=T-i,L=XV(b,p),D=Math.exp(-R);return xU-O/L*D},u=b=>{const R=b*p*n,O=R*i+i,L=Math.pow(p,2)*Math.pow(b,2)*n,D=Math.exp(-R),U=XV(Math.pow(b,2),p);return(-l(b)+xU>0?-1:1)*((O-L)*D)/U}):(l=b=>{const T=Math.exp(-b*n),R=(b-i)*n+1;return-xU+T*R},u=b=>{const T=Math.exp(-b*n),R=(i-b)*(n*n);return T*R});const y=5/n,E=oOe(l,u,y);if(n=Wf(n),isNaN(E))return{stiffness:$s.stiffness,damping:$s.damping,duration:n};{const b=Math.pow(E,2)*o;return{stiffness:b,damping:p*2*Math.sqrt(o*b),duration:n}}}const sOe=12;function oOe(n,e,i){let o=i;for(let l=1;l<sOe;l++)o=o-n(o)/e(o);return o}function XV(n,e){return n*Math.sqrt(1-e*e)}const aOe=["duration","bounce"],cOe=["stiffness","damping","mass"];function IY(n,e){return e.some(i=>n[i]!==void 0)}function lOe(n){let e={velocity:$s.velocity,stiffness:$s.stiffness,damping:$s.damping,mass:$s.mass,isResolvedFromDuration:!1,...n};if(!IY(n,cOe)&&IY(n,aOe))if(n.visualDuration){const i=n.visualDuration,o=2*Math.PI/(i*1.2),l=o*o,u=2*Qf(.05,1,1-(n.bounce||0))*Math.sqrt(l);e={...e,mass:$s.mass,stiffness:l,damping:u}}else{const i=iOe(n);e={...e,...i,mass:$s.mass},e.isResolvedFromDuration=!0}return e}function fne(n=$s.visualDuration,e=$s.bounce){const i=typeof n!="object"?{visualDuration:n,keyframes:[0,1],bounce:e}:n;let{restSpeed:o,restDelta:l}=i;const u=i.keyframes[0],p=i.keyframes[i.keyframes.length-1],y={done:!1,value:u},{stiffness:E,damping:b,mass:T,duration:R,velocity:O,isResolvedFromDuration:L}=lOe({...i,velocity:-Gf(i.velocity||0)}),D=O||0,U=b/(2*Math.sqrt(E*T)),F=p-u,Y=Gf(Math.sqrt(E/T)),W=Math.abs(F)<5;o||(o=W?$s.restSpeed.granular:$s.restSpeed.default),l||(l=W?$s.restDelta.granular:$s.restDelta.default);let re;if(U<1){const ie=XV(Y,U);re=me=>{const q=Math.exp(-U*Y*me);return p-q*((D+U*Y*F)/ie*Math.sin(ie*me)+F*Math.cos(ie*me))}}else if(U===1)re=ie=>p-Math.exp(-Y*ie)*(F+(D+Y*F)*ie);else{const ie=Y*Math.sqrt(U*U-1);re=me=>{const q=Math.exp(-U*Y*me),J=Math.min(ie*me,300);return p-q*((D+U*Y*F)*Math.sinh(J)+ie*F*Math.cosh(J))/ie}}const le={calculatedDuration:L&&R||null,next:ie=>{const me=re(ie);if(L)y.done=ie>=R;else{let q=0;U<1&&(q=ie===0?Wf(D):pne(re,ie,me));const J=Math.abs(q)<=o,Q=Math.abs(p-me)<=l;y.done=J&&Q}return y.value=y.done?p:me,y},toString:()=>{const ie=Math.min(Nte(le),zV),me=xte(q=>le.next(ie*q).value,ie,30);return ie+"ms "+me}};return le}function AY({keyframes:n,velocity:e=0,power:i=.8,timeConstant:o=325,bounceDamping:l=10,bounceStiffness:u=500,modifyTarget:p,min:y,max:E,restDelta:b=.5,restSpeed:T}){const R=n[0],O={done:!1,value:R},L=J=>y!==void 0&&J<y||E!==void 0&&J>E,D=J=>y===void 0?E:E===void 0||Math.abs(y-J)<Math.abs(E-J)?y:E;let U=i*e;const F=R+U,Y=p===void 0?F:p(F);Y!==F&&(U=Y-R);const W=J=>-U*Math.exp(-J/o),re=J=>Y+W(J),le=J=>{const Q=W(J),ne=re(J);O.done=Math.abs(Q)<=b,O.value=O.done?Y:ne};let ie,me;const q=J=>{L(O.value)&&(ie=J,me=fne({keyframes:[O.value,D(O.value)],velocity:pne(re,J,O.value),damping:l,stiffness:u,restDelta:b,restSpeed:T}))};return q(0),{calculatedDuration:null,next:J=>{let Q=!1;return!me&&ie===void 0&&(Q=!0,le(J),q(J)),ie!==void 0&&J>=ie?me.next(J-ie):(!Q&&le(J),O)}}}const uOe=GR(.42,0,1,1),dOe=GR(0,0,.58,1),mne=GR(.42,0,.58,1),hOe=n=>Array.isArray(n)&&typeof n[0]!="number",pOe={linear:_u,easeIn:uOe,easeInOut:mne,easeOut:dOe,circIn:eF,circInOut:Yte,circOut:qte,backIn:Zj,backInOut:$te,backOut:Hte,anticipate:Kte},PY=n=>{if(qj(n)){hte(n.length===4);const[e,i,o,l]=n;return GR(e,i,o,l)}else if(typeof n=="string")return pOe[n];return n};function fOe(n,e,i){const o=[],l=i||hne,u=n.length-1;for(let p=0;p<u;p++){let y=l(n[p],n[p+1]);if(e){const E=Array.isArray(e)?e[p]||_u:e;y=HR(E,y)}o.push(y)}return o}function mOe(n,e,{clamp:i=!0,ease:o,mixer:l}={}){const u=n.length;if(hte(u===e.length),u===1)return()=>e[0];if(u===2&&e[0]===e[1])return()=>e[1];const p=n[0]===n[1];n[0]>n[u-1]&&(n=[...n].reverse(),e=[...e].reverse());const y=fOe(e,o,l),E=y.length,b=T=>{if(p&&T<n[0])return e[0];let R=0;if(E>1)for(;R<n.length-2&&!(T<n[R+1]);R++);const O=VS(n[R],n[R+1],T);return y[R](O)};return i?T=>b(Qf(n[0],n[u-1],T)):b}function gOe(n,e){const i=n[n.length-1];for(let o=1;o<=e;o++){const l=VS(0,e,o);n.push(ks(i,1,l))}}function _Oe(n){const e=[0];return gOe(e,n.length-1),e}function yOe(n,e){return n.map(i=>i*e)}function EOe(n,e){return n.map(()=>e||mne).splice(0,n.length-1)}function _k({duration:n=300,keyframes:e,times:i,ease:o="easeInOut"}){const l=hOe(o)?o.map(PY):PY(o),u={done:!1,value:e[0]},p=yOe(i&&i.length===e.length?i:_Oe(e),n),y=mOe(p,e,{ease:Array.isArray(l)?l:EOe(e,l)});return{calculatedDuration:n,next:E=>(u.value=y(E),u.done=E>=n,u)}}const vOe=n=>{const e=({timestamp:i})=>n(i);return{start:()=>us.update(e,!0),stop:()=>Fg(e),now:()=>Ua.isProcessing?Ua.timestamp:Up.now()}},SOe={decay:AY,inertia:AY,tween:_k,keyframes:_k,spring:fne},bOe=n=>n/100;class oF extends une{constructor(e){super(e),this.holdTime=null,this.cancelTime=null,this.currentTime=0,this.playbackSpeed=1,this.pendingPlayState="running",this.startTime=null,this.state="idle",this.stop=()=>{if(this.resolver.cancel(),this.isStopped=!0,this.state==="idle")return;this.teardown();const{onStop:E}=this.options;E&&E()};const{name:i,motionValue:o,element:l,keyframes:u}=this.options,p=(l==null?void 0:l.KeyframeResolver)||iF,y=(E,b)=>this.onKeyframesResolved(E,b);this.resolver=new p(u,y,i,o,l),this.resolver.scheduleResolve()}flatten(){super.flatten(),this._resolved&&Object.assign(this._resolved,this.initPlayback(this._resolved.keyframes))}initPlayback(e){const{type:i="keyframes",repeat:o=0,repeatDelay:l=0,repeatType:u,velocity:p=0}=this.options,y=Kj(i)?i:SOe[i]||_k;let E,b;y!==_k&&typeof e[0]!="number"&&(E=HR(bOe,hne(e[0],e[1])),e=[0,100]);const T=y({...this.options,keyframes:e});u==="mirror"&&(b=y({...this.options,keyframes:[...e].reverse(),velocity:-p})),T.calculatedDuration===null&&(T.calculatedDuration=Nte(T));const{calculatedDuration:R}=T,O=R+l,L=O*(o+1)-l;return{generator:T,mirroredGenerator:b,mapPercentToKeyframes:E,calculatedDuration:R,resolvedDuration:O,totalDuration:L}}onPostResolved(){const{autoplay:e=!0}=this.options;this.play(),this.pendingPlayState==="paused"||!e?this.pause():this.state=this.pendingPlayState}tick(e,i=!1){const{resolved:o}=this;if(!o){const{keyframes:J}=this.options;return{done:!0,value:J[J.length-1]}}const{finalKeyframe:l,generator:u,mirroredGenerator:p,mapPercentToKeyframes:y,keyframes:E,calculatedDuration:b,totalDuration:T,resolvedDuration:R}=o;if(this.startTime===null)return u.next(0);const{delay:O,repeat:L,repeatType:D,repeatDelay:U,onUpdate:F}=this.options;this.speed>0?this.startTime=Math.min(this.startTime,e):this.speed<0&&(this.startTime=Math.min(e-T/this.speed,this.startTime)),i?this.currentTime=e:this.holdTime!==null?this.currentTime=this.holdTime:this.currentTime=Math.round(e-this.startTime)*this.speed;const Y=this.currentTime-O*(this.speed>=0?1:-1),W=this.speed>=0?Y<0:Y>T;this.currentTime=Math.max(Y,0),this.state==="finished"&&this.holdTime===null&&(this.currentTime=T);let re=this.currentTime,le=u;if(L){const J=Math.min(this.currentTime,T)/R;let Q=Math.floor(J),ne=J%1;!ne&&J>=1&&(ne=1),ne===1&&Q--,Q=Math.min(Q,L+1),!!(Q%2)&&(D==="reverse"?(ne=1-ne,U&&(ne-=U/R)):D==="mirror"&&(le=p)),re=Qf(0,1,ne)*R}const ie=W?{done:!1,value:E[0]}:le.next(re);y&&(ie.value=y(ie.value));let{done:me}=ie;!W&&b!==null&&(me=this.speed>=0?this.currentTime>=T:this.currentTime<=0);const q=this.holdTime===null&&(this.state==="finished"||this.state==="running"&&me);return q&&l!==void 0&&(ie.value=yN(E,this.options,l)),F&&F(ie.value),q&&this.finish(),ie}get duration(){const{resolved:e}=this;return e?Gf(e.calculatedDuration):0}get time(){return Gf(this.currentTime)}set time(e){e=Wf(e),this.currentTime=e,this.holdTime!==null||this.speed===0?this.holdTime=e:this.driver&&(this.startTime=this.driver.now()-e/this.speed)}get speed(){return this.playbackSpeed}set speed(e){const i=this.playbackSpeed!==e;this.playbackSpeed=e,i&&(this.time=Gf(this.currentTime))}play(){if(this.resolver.isScheduled||this.resolver.resume(),!this._resolved){this.pendingPlayState="running";return}if(this.isStopped)return;const{driver:e=vOe,onPlay:i,startTime:o}=this.options;this.driver||(this.driver=e(u=>this.tick(u))),i&&i();const l=this.driver.now();this.holdTime!==null?this.startTime=l-this.holdTime:this.startTime?this.state==="finished"&&(this.startTime=l):this.startTime=o??this.calcStartTime(),this.state==="finished"&&this.updateFinishedPromise(),this.cancelTime=this.startTime,this.holdTime=null,this.state="running",this.driver.start()}pause(){var e;if(!this._resolved){this.pendingPlayState="paused";return}this.state="paused",this.holdTime=(e=this.currentTime)!==null&&e!==void 0?e:0}complete(){this.state!=="running"&&this.play(),this.pendingPlayState=this.state="finished",this.holdTime=null}finish(){this.teardown(),this.state="finished";const{onComplete:e}=this.options;e&&e()}cancel(){this.cancelTime!==null&&this.tick(this.cancelTime),this.teardown(),this.updateFinishedPromise()}teardown(){this.state="idle",this.stopDriver(),this.resolveFinishedPromise(),this.updateFinishedPromise(),this.startTime=this.cancelTime=null,this.resolver.cancel()}stopDriver(){this.driver&&(this.driver.stop(),this.driver=void 0)}sample(e){return this.startTime=0,this.tick(e,!0)}}const wOe=new Set(["opacity","clipPath","filter","transform"]);function TOe(n,e,i,{delay:o=0,duration:l=300,repeat:u=0,repeatType:p="loop",ease:y="easeInOut",times:E}={}){const b={[e]:i};E&&(b.offset=E);const T=Lte(y,l);return Array.isArray(T)&&(b.easing=T),n.animate(b,{delay:o,duration:l,easing:Array.isArray(T)?"linear":T,fill:"both",iterations:u+1,direction:p==="reverse"?"alternate":"normal"})}const COe=Nj(()=>Object.hasOwnProperty.call(Element.prototype,"animate")),yk=10,ROe=2e4;function IOe(n){return Kj(n.type)||n.type==="spring"||!Dte(n.ease)}function AOe(n,e){const i=new oF({...e,keyframes:n,repeat:0,delay:0,isGenerator:!0});let o={done:!1,value:n[0]};const l=[];let u=0;for(;!o.done&&u<ROe;)o=i.sample(u),l.push(o.value),u+=yk;return{times:void 0,keyframes:l,duration:u-yk,ease:"linear"}}const gne={anticipate:Kte,backInOut:$te,circInOut:Yte};function POe(n){return n in gne}class OY extends une{constructor(e){super(e);const{name:i,motionValue:o,element:l,keyframes:u}=this.options;this.resolver=new lne(u,(p,y)=>this.onKeyframesResolved(p,y),i,o,l),this.resolver.scheduleResolve()}initPlayback(e,i){let{duration:o=300,times:l,ease:u,type:p,motionValue:y,name:E,startTime:b}=this.options;if(!y.owner||!y.owner.current)return!1;if(typeof u=="string"&&mk()&&POe(u)&&(u=gne[u]),IOe(this.options)){const{onComplete:R,onUpdate:O,motionValue:L,element:D,...U}=this.options,F=AOe(e,U);e=F.keyframes,e.length===1&&(e[1]=e[0]),o=F.duration,l=F.times,u=F.ease,p="keyframes"}const T=TOe(y.owner.current,E,e,{...this.options,duration:o,times:l,ease:u});return T.startTime=b??this.calcStartTime(),this.pendingTimeline?(fY(T,this.pendingTimeline),this.pendingTimeline=void 0):T.onfinish=()=>{const{onComplete:R}=this.options;y.set(yN(e,this.options,i)),R&&R(),this.cancel(),this.resolveFinishedPromise()},{animation:T,duration:o,times:l,type:p,ease:u,keyframes:e}}get duration(){const{resolved:e}=this;if(!e)return 0;const{duration:i}=e;return Gf(i)}get time(){const{resolved:e}=this;if(!e)return 0;const{animation:i}=e;return Gf(i.currentTime||0)}set time(e){const{resolved:i}=this;if(!i)return;const{animation:o}=i;o.currentTime=Wf(e)}get speed(){const{resolved:e}=this;if(!e)return 1;const{animation:i}=e;return i.playbackRate}set speed(e){const{resolved:i}=this;if(!i)return;const{animation:o}=i;o.playbackRate=e}get state(){const{resolved:e}=this;if(!e)return"idle";const{animation:i}=e;return i.playState}get startTime(){const{resolved:e}=this;if(!e)return null;const{animation:i}=e;return i.startTime}attachTimeline(e){if(!this._resolved)this.pendingTimeline=e;else{const{resolved:i}=this;if(!i)return _u;const{animation:o}=i;fY(o,e)}return _u}play(){if(this.isStopped)return;const{resolved:e}=this;if(!e)return;const{animation:i}=e;i.playState==="finished"&&this.updateFinishedPromise(),i.play()}pause(){const{resolved:e}=this;if(!e)return;const{animation:i}=e;i.pause()}stop(){if(this.resolver.cancel(),this.isStopped=!0,this.state==="idle")return;this.resolveFinishedPromise(),this.updateFinishedPromise();const{resolved:e}=this;if(!e)return;const{animation:i,keyframes:o,duration:l,type:u,ease:p,times:y}=e;if(i.playState==="idle"||i.playState==="finished")return;if(this.time){const{motionValue:b,onUpdate:T,onComplete:R,element:O,...L}=this.options,D=new oF({...L,keyframes:o,duration:l,type:u,ease:p,times:y,isGenerator:!0}),U=Wf(this.time);b.setWithVelocity(D.sample(U-yk).value,D.sample(U).value,yk)}const{onStop:E}=this.options;E&&E(),this.cancel()}complete(){const{resolved:e}=this;e&&e.animation.finish()}cancel(){const{resolved:e}=this;e&&e.animation.cancel()}static supports(e){const{motionValue:i,name:o,repeatDelay:l,repeatType:u,damping:p,type:y}=e;if(!i||!i.owner||!(i.owner.current instanceof HTMLElement))return!1;const{onUpdate:E,transformTemplate:b}=i.owner.getProps();return COe()&&o&&wOe.has(o)&&!E&&!b&&!l&&u!=="mirror"&&p!==0&&y!=="inertia"}}const OOe={type:"spring",stiffness:500,damping:25,restSpeed:10},kOe=n=>({type:"spring",stiffness:550,damping:n===0?2*Math.sqrt(550):30,restSpeed:10}),NOe={type:"keyframes",duration:.8},xOe={type:"keyframes",ease:[.25,.1,.35,1],duration:.3},DOe=(n,{keyframes:e})=>e.length>2?NOe:vE.has(n)?n.startsWith("scale")?kOe(e[1]):OOe:xOe;function LOe({when:n,delay:e,delayChildren:i,staggerChildren:o,staggerDirection:l,repeat:u,repeatType:p,repeatDelay:y,from:E,elapsed:b,...T}){return!!Object.keys(T).length}const aF=(n,e,i,o={},l,u)=>p=>{const y=$j(o,n)||{},E=y.delay||o.delay||0;let{elapsed:b=0}=o;b=b-Wf(E);let T={keyframes:Array.isArray(i)?i:[null,i],ease:"easeOut",velocity:e.getVelocity(),...y,delay:-b,onUpdate:O=>{e.set(O),y.onUpdate&&y.onUpdate(O)},onComplete:()=>{p(),y.onComplete&&y.onComplete()},name:n,motionValue:e,element:u?void 0:l};LOe(y)||(T={...T,...DOe(n,T)}),T.duration&&(T.duration=Wf(T.duration)),T.repeatDelay&&(T.repeatDelay=Wf(T.repeatDelay)),T.from!==void 0&&(T.keyframes[0]=T.from);let R=!1;if((T.type===!1||T.duration===0&&!T.repeatDelay)&&(T.duration=0,T.delay===0&&(R=!0)),R&&!u&&e.get()!==void 0){const O=yN(T.keyframes,y);if(O!==void 0)return us.update(()=>{T.onUpdate(O),T.onComplete()}),new ePe([])}return!u&&OY.supports(T)?new OY(T):new oF(T)};function MOe({protectedKeys:n,needsAnimating:e},i){const o=n.hasOwnProperty(i)&&e[i]!==!0;return e[i]=!1,o}function _ne(n,e,{delay:i=0,transitionOverride:o,type:l}={}){var u;let{transition:p=n.getDefaultTransition(),transitionEnd:y,...E}=e;o&&(p=o);const b=[],T=l&&n.animationState&&n.animationState.getState()[l];for(const R in E){const O=n.getValue(R,(u=n.latestValues[R])!==null&&u!==void 0?u:null),L=E[R];if(L===void 0||T&&MOe(T,R))continue;const D={delay:i,...$j(p||{},R)};let U=!1;if(window.MotionHandoffAnimation){const Y=Bte(n);if(Y){const W=window.MotionHandoffAnimation(Y,R,us);W!==null&&(D.startTime=W,U=!0)}}GV(n,R),O.start(aF(R,O,L,n.shouldReduceMotion&&jte.has(R)?{type:!1}:D,n,U));const F=O.animation;F&&b.push(F)}return y&&Promise.all(b).then(()=>{us.update(()=>{y&&fPe(n,y)})}),b}function JV(n,e,i={}){var o;const l=_N(n,e,i.type==="exit"?(o=n.presenceContext)===null||o===void 0?void 0:o.custom:void 0);let{transition:u=n.getDefaultTransition()||{}}=l||{};i.transitionOverride&&(u=i.transitionOverride);const p=l?()=>Promise.all(_ne(n,l,i)):()=>Promise.resolve(),y=n.variantChildren&&n.variantChildren.size?(b=0)=>{const{delayChildren:T=0,staggerChildren:R,staggerDirection:O}=u;return UOe(n,e,T+b,R,O,i)}:()=>Promise.resolve(),{when:E}=u;if(E){const[b,T]=E==="beforeChildren"?[p,y]:[y,p];return b().then(()=>T())}else return Promise.all([p(),y(i.delay)])}function UOe(n,e,i=0,o=0,l=1,u){const p=[],y=(n.variantChildren.size-1)*o,E=l===1?(b=0)=>b*o:(b=0)=>y-b*o;return Array.from(n.variantChildren).sort(VOe).forEach((b,T)=>{b.notify("AnimationStart",e),p.push(JV(b,e,{...u,delay:i+E(T)}).then(()=>b.notify("AnimationComplete",e)))}),Promise.all(p)}function VOe(n,e){return n.sortNodePosition(e)}function jOe(n,e,i={}){n.notify("AnimationStart",e);let o;if(Array.isArray(e)){const l=e.map(u=>JV(n,u,i));o=Promise.all(l)}else if(typeof e=="string")o=JV(n,e,i);else{const l=typeof e=="function"?_N(n,e,i.custom):e;o=Promise.all(_ne(n,l,i))}return o.then(()=>{n.notify("AnimationComplete",e)})}const FOe=Dj.length;function yne(n){if(!n)return;if(!n.isControllingVariants){const i=n.parent?yne(n.parent)||{}:{};return n.props.initial!==void 0&&(i.initial=n.props.initial),i}const e={};for(let i=0;i<FOe;i++){const o=Dj[i],l=n.props[o];(dR(l)||l===!1)&&(e[o]=l)}return e}const BOe=[...xj].reverse(),zOe=xj.length;function WOe(n){return e=>Promise.all(e.map(({animation:i,options:o})=>jOe(n,i,o)))}function GOe(n){let e=WOe(n),i=kY(),o=!0;const l=E=>(b,T)=>{var R;const O=_N(n,T,E==="exit"?(R=n.presenceContext)===null||R===void 0?void 0:R.custom:void 0);if(O){const{transition:L,transitionEnd:D,...U}=O;b={...b,...U,...D}}return b};function u(E){e=E(n)}function p(E){const{props:b}=n,T=yne(n.parent)||{},R=[],O=new Set;let L={},D=1/0;for(let F=0;F<zOe;F++){const Y=BOe[F],W=i[Y],re=b[Y]!==void 0?b[Y]:T[Y],le=dR(re),ie=Y===E?W.isActive:null;ie===!1&&(D=F);let me=re===T[Y]&&re!==b[Y]&&le;if(me&&o&&n.manuallyAnimateOnMount&&(me=!1),W.protectedKeys={...L},!W.isActive&&ie===null||!re&&!W.prevProp||mN(re)||typeof re=="boolean")continue;const q=HOe(W.prevProp,re);let J=q||Y===E&&W.isActive&&!me&&le||F>D&&le,Q=!1;const ne=Array.isArray(re)?re:[re];let he=ne.reduce(l(Y),{});ie===!1&&(he={});const{prevResolvedValues:de={}}=W,pe={...de,...he},Se=we=>{J=!0,O.has(we)&&(Q=!0,O.delete(we)),W.needsAnimating[we]=!0;const Re=n.getValue(we);Re&&(Re.liveStyle=!1)};for(const we in pe){const Re=he[we],Te=de[we];if(L.hasOwnProperty(we))continue;let Ne=!1;BV(Re)&&BV(Te)?Ne=!kte(Re,Te):Ne=Re!==Te,Ne?Re!=null?Se(we):O.add(we):Re!==void 0&&O.has(we)?Se(we):W.protectedKeys[we]=!0}W.prevProp=re,W.prevResolvedValues=he,W.isActive&&(L={...L,...he}),o&&n.blockInitialAnimation&&(J=!1),J&&(!(me&&q)||Q)&&R.push(...ne.map(we=>({animation:we,options:{type:Y}})))}if(O.size){const F={};O.forEach(Y=>{const W=n.getBaseTarget(Y),re=n.getValue(Y);re&&(re.liveStyle=!0),F[Y]=W??null}),R.push({animation:F})}let U=!!R.length;return o&&(b.initial===!1||b.initial===b.animate)&&!n.manuallyAnimateOnMount&&(U=!1),o=!1,U?e(R):Promise.resolve()}function y(E,b){var T;if(i[E].isActive===b)return Promise.resolve();(T=n.variantChildren)===null||T===void 0||T.forEach(O=>{var L;return(L=O.animationState)===null||L===void 0?void 0:L.setActive(E,b)}),i[E].isActive=b;const R=p(E);for(const O in i)i[O].protectedKeys={};return R}return{animateChanges:p,setActive:y,setAnimateFunction:u,getState:()=>i,reset:()=>{i=kY(),o=!0}}}function HOe(n,e){return typeof e=="string"?e!==n:Array.isArray(e)?!kte(e,n):!1}function Ay(n=!1){return{isActive:n,protectedKeys:{},needsAnimating:{},prevResolvedValues:{}}}function kY(){return{animate:Ay(!0),whileInView:Ay(),whileHover:Ay(),whileTap:Ay(),whileDrag:Ay(),whileFocus:Ay(),exit:Ay()}}class Qg{constructor(e){this.isMounted=!1,this.node=e}update(){}}class $Oe extends Qg{constructor(e){super(e),e.animationState||(e.animationState=GOe(e))}updateAnimationControlsSubscription(){const{animate:e}=this.node.getProps();mN(e)&&(this.unmountControls=e.subscribe(this.node))}mount(){this.updateAnimationControlsSubscription()}update(){const{animate:e}=this.node.getProps(),{animate:i}=this.node.prevProps||{};e!==i&&this.updateAnimationControlsSubscription()}unmount(){var e;this.node.animationState.reset(),(e=this.unmountControls)===null||e===void 0||e.call(this)}}let KOe=0;class qOe extends Qg{constructor(){super(...arguments),this.id=KOe++}update(){if(!this.node.presenceContext)return;const{isPresent:e,onExitComplete:i}=this.node.presenceContext,{isPresent:o}=this.node.prevPresenceContext||{};if(!this.node.animationState||e===o)return;const l=this.node.animationState.setActive("exit",!e);i&&!e&&l.then(()=>i(this.id))}mount(){const{register:e}=this.node.presenceContext||{};e&&(this.unmount=e(this.id))}unmount(){}}const YOe={animation:{Feature:$Oe},exit:{Feature:qOe}};function mR(n,e,i,o={passive:!0}){return n.addEventListener(e,i,o),()=>n.removeEventListener(e,i)}function $R(n){return{point:{x:n.pageX,y:n.pageY}}}const XOe=n=>e=>Yj(e)&&n(e,$R(e));function WC(n,e,i,o){return mR(n,e,XOe(i),o)}const NY=(n,e)=>Math.abs(n-e);function JOe(n,e){const i=NY(n.x,e.x),o=NY(n.y,e.y);return Math.sqrt(i**2+o**2)}class Ene{constructor(e,i,{transformPagePoint:o,contextWindow:l,dragSnapToOrigin:u=!1}={}){if(this.startEvent=null,this.lastMoveEvent=null,this.lastMoveEventInfo=null,this.handlers={},this.contextWindow=window,this.updatePoint=()=>{if(!(this.lastMoveEvent&&this.lastMoveEventInfo))return;const R=LU(this.lastMoveEventInfo,this.history),O=this.startEvent!==null,L=JOe(R.offset,{x:0,y:0})>=3;if(!O&&!L)return;const{point:D}=R,{timestamp:U}=Ua;this.history.push({...D,timestamp:U});const{onStart:F,onMove:Y}=this.handlers;O||(F&&F(this.lastMoveEvent,R),this.startEvent=this.lastMoveEvent),Y&&Y(this.lastMoveEvent,R)},this.handlePointerMove=(R,O)=>{this.lastMoveEvent=R,this.lastMoveEventInfo=DU(O,this.transformPagePoint),us.update(this.updatePoint,!0)},this.handlePointerUp=(R,O)=>{this.end();const{onEnd:L,onSessionEnd:D,resumeAnimation:U}=this.handlers;if(this.dragSnapToOrigin&&U&&U(),!(this.lastMoveEvent&&this.lastMoveEventInfo))return;const F=LU(R.type==="pointercancel"?this.lastMoveEventInfo:DU(O,this.transformPagePoint),this.history);this.startEvent&&L&&L(R,F),D&&D(R,F)},!Yj(e))return;this.dragSnapToOrigin=u,this.handlers=i,this.transformPagePoint=o,this.contextWindow=l||window;const p=$R(e),y=DU(p,this.transformPagePoint),{point:E}=y,{timestamp:b}=Ua;this.history=[{...E,timestamp:b}];const{onSessionStart:T}=i;T&&T(e,LU(y,this.history)),this.removeListeners=HR(WC(this.contextWindow,"pointermove",this.handlePointerMove),WC(this.contextWindow,"pointerup",this.handlePointerUp),WC(this.contextWindow,"pointercancel",this.handlePointerUp))}updateHandlers(e){this.handlers=e}end(){this.removeListeners&&this.removeListeners(),Fg(this.updatePoint)}}function DU(n,e){return e?{point:e(n.point)}:n}function xY(n,e){return{x:n.x-e.x,y:n.y-e.y}}function LU({point:n},e){return{point:n,delta:xY(n,vne(e)),offset:xY(n,QOe(e)),velocity:ZOe(e,.1)}}function QOe(n){return n[0]}function vne(n){return n[n.length-1]}function ZOe(n,e){if(n.length<2)return{x:0,y:0};let i=n.length-1,o=null;const l=vne(n);for(;i>=0&&(o=n[i],!(l.timestamp-o.timestamp>Wf(e)));)i--;if(!o)return{x:0,y:0};const u=Gf(l.timestamp-o.timestamp);if(u===0)return{x:0,y:0};const p={x:(l.x-o.x)/u,y:(l.y-o.y)/u};return p.x===1/0&&(p.x=0),p.y===1/0&&(p.y=0),p}const Sne=1e-4,eke=1-Sne,tke=1+Sne,bne=.01,nke=0-bne,rke=0+bne;function Eu(n){return n.max-n.min}function ike(n,e,i){return Math.abs(n-e)<=i}function DY(n,e,i,o=.5){n.origin=o,n.originPoint=ks(e.min,e.max,n.origin),n.scale=Eu(i)/Eu(e),n.translate=ks(i.min,i.max,n.origin)-n.originPoint,(n.scale>=eke&&n.scale<=tke||isNaN(n.scale))&&(n.scale=1),(n.translate>=nke&&n.translate<=rke||isNaN(n.translate))&&(n.translate=0)}function GC(n,e,i,o){DY(n.x,e.x,i.x,o?o.originX:void 0),DY(n.y,e.y,i.y,o?o.originY:void 0)}function LY(n,e,i){n.min=i.min+e.min,n.max=n.min+Eu(e)}function ske(n,e,i){LY(n.x,e.x,i.x),LY(n.y,e.y,i.y)}function MY(n,e,i){n.min=e.min-i.min,n.max=n.min+Eu(e)}function HC(n,e,i){MY(n.x,e.x,i.x),MY(n.y,e.y,i.y)}function oke(n,{min:e,max:i},o){return e!==void 0&&n<e?n=o?ks(e,n,o.min):Math.max(n,e):i!==void 0&&n>i&&(n=o?ks(i,n,o.max):Math.min(n,i)),n}function UY(n,e,i){return{min:e!==void 0?n.min+e:void 0,max:i!==void 0?n.max+i-(n.max-n.min):void 0}}function ake(n,{top:e,left:i,bottom:o,right:l}){return{x:UY(n.x,i,l),y:UY(n.y,e,o)}}function VY(n,e){let i=e.min-n.min,o=e.max-n.max;return e.max-e.min<n.max-n.min&&([i,o]=[o,i]),{min:i,max:o}}function cke(n,e){return{x:VY(n.x,e.x),y:VY(n.y,e.y)}}function lke(n,e){let i=.5;const o=Eu(n),l=Eu(e);return l>o?i=VS(e.min,e.max-o,n.min):o>l&&(i=VS(n.min,n.max-l,e.min)),Qf(0,1,i)}function uke(n,e){const i={};return e.min!==void 0&&(i.min=e.min-n.min),e.max!==void 0&&(i.max=e.max-n.min),i}const QV=.35;function dke(n=QV){return n===!1?n=0:n===!0&&(n=QV),{x:jY(n,"left","right"),y:jY(n,"top","bottom")}}function jY(n,e,i){return{min:FY(n,e),max:FY(n,i)}}function FY(n,e){return typeof n=="number"?n:n[e]||0}const BY=()=>({translate:0,scale:1,origin:0,originPoint:0}),cS=()=>({x:BY(),y:BY()}),zY=()=>({min:0,max:0}),ho=()=>({x:zY(),y:zY()});function cd(n){return[n("x"),n("y")]}function wne({top:n,left:e,right:i,bottom:o}){return{x:{min:e,max:i},y:{min:n,max:o}}}function hke({x:n,y:e}){return{top:e.min,right:n.max,bottom:e.max,left:n.min}}function pke(n,e){if(!e)return n;const i=e({x:n.left,y:n.top}),o=e({x:n.right,y:n.bottom});return{top:i.y,left:i.x,bottom:o.y,right:o.x}}function MU(n){return n===void 0||n===1}function ZV({scale:n,scaleX:e,scaleY:i}){return!MU(n)||!MU(e)||!MU(i)}function Oy(n){return ZV(n)||Tne(n)||n.z||n.rotate||n.rotateX||n.rotateY||n.skewX||n.skewY}function Tne(n){return WY(n.x)||WY(n.y)}function WY(n){return n&&n!=="0%"}function Ek(n,e,i){const o=n-i,l=e*o;return i+l}function GY(n,e,i,o,l){return l!==void 0&&(n=Ek(n,l,o)),Ek(n,i,o)+e}function e5(n,e=0,i=1,o,l){n.min=GY(n.min,e,i,o,l),n.max=GY(n.max,e,i,o,l)}function Cne(n,{x:e,y:i}){e5(n.x,e.translate,e.scale,e.originPoint),e5(n.y,i.translate,i.scale,i.originPoint)}const HY=.999999999999,$Y=1.0000000000001;function fke(n,e,i,o=!1){const l=i.length;if(!l)return;e.x=e.y=1;let u,p;for(let y=0;y<l;y++){u=i[y],p=u.projectionDelta;const{visualElement:E}=u.options;E&&E.props.style&&E.props.style.display==="contents"||(o&&u.options.layoutScroll&&u.scroll&&u!==u.root&&uS(n,{x:-u.scroll.offset.x,y:-u.scroll.offset.y}),p&&(e.x*=p.x.scale,e.y*=p.y.scale,Cne(n,p)),o&&Oy(u.latestValues)&&uS(n,u.latestValues))}e.x<$Y&&e.x>HY&&(e.x=1),e.y<$Y&&e.y>HY&&(e.y=1)}function lS(n,e){n.min=n.min+e,n.max=n.max+e}function KY(n,e,i,o,l=.5){const u=ks(n.min,n.max,l);e5(n,e,i,u,o)}function uS(n,e){KY(n.x,e.x,e.scaleX,e.scale,e.originX),KY(n.y,e.y,e.scaleY,e.scale,e.originY)}function Rne(n,e){return wne(pke(n.getBoundingClientRect(),e))}function mke(n,e,i){const o=Rne(n,i),{scroll:l}=e;return l&&(lS(o.x,l.offset.x),lS(o.y,l.offset.y)),o}const Ine=({current:n})=>n?n.ownerDocument.defaultView:null,gke=new WeakMap;class _ke{constructor(e){this.openDragLock=null,this.isDragging=!1,this.currentDirection=null,this.originPoint={x:0,y:0},this.constraints=!1,this.hasMutatedConstraints=!1,this.elastic=ho(),this.visualElement=e}start(e,{snapToCursor:i=!1}={}){const{presenceContext:o}=this.visualElement;if(o&&o.isPresent===!1)return;const l=T=>{const{dragSnapToOrigin:R}=this.getProps();R?this.pauseAnimation():this.stopAnimation(),i&&this.snapToCursor($R(T).point)},u=(T,R)=>{const{drag:O,dragPropagation:L,onDragStart:D}=this.getProps();if(O&&!L&&(this.openDragLock&&this.openDragLock(),this.openDragLock=lPe(O),!this.openDragLock))return;this.isDragging=!0,this.currentDirection=null,this.resolveConstraints(),this.visualElement.projection&&(this.visualElement.projection.isAnimationBlocked=!0,this.visualElement.projection.target=void 0),cd(F=>{let Y=this.getAxisMotionValue(F).get()||0;if(Mp.test(Y)){const{projection:W}=this.visualElement;if(W&&W.layout){const re=W.layout.layoutBox[F];re&&(Y=Eu(re)*(parseFloat(Y)/100))}}this.originPoint[F]=Y}),D&&us.postRender(()=>D(T,R)),GV(this.visualElement,"transform");const{animationState:U}=this.visualElement;U&&U.setActive("whileDrag",!0)},p=(T,R)=>{const{dragPropagation:O,dragDirectionLock:L,onDirectionLock:D,onDrag:U}=this.getProps();if(!O&&!this.openDragLock)return;const{offset:F}=R;if(L&&this.currentDirection===null){this.currentDirection=yke(F),this.currentDirection!==null&&D&&D(this.currentDirection);return}this.updateAxis("x",R.point,F),this.updateAxis("y",R.point,F),this.visualElement.render(),U&&U(T,R)},y=(T,R)=>this.stop(T,R),E=()=>cd(T=>{var R;return this.getAnimationState(T)==="paused"&&((R=this.getAxisMotionValue(T).animation)===null||R===void 0?void 0:R.play())}),{dragSnapToOrigin:b}=this.getProps();this.panSession=new Ene(e,{onSessionStart:l,onStart:u,onMove:p,onSessionEnd:y,resumeAnimation:E},{transformPagePoint:this.visualElement.getTransformPagePoint(),dragSnapToOrigin:b,contextWindow:Ine(this.visualElement)})}stop(e,i){const o=this.isDragging;if(this.cancel(),!o)return;const{velocity:l}=i;this.startAnimation(l);const{onDragEnd:u}=this.getProps();u&&us.postRender(()=>u(e,i))}cancel(){this.isDragging=!1;const{projection:e,animationState:i}=this.visualElement;e&&(e.isAnimationBlocked=!1),this.panSession&&this.panSession.end(),this.panSession=void 0;const{dragPropagation:o}=this.getProps();!o&&this.openDragLock&&(this.openDragLock(),this.openDragLock=null),i&&i.setActive("whileDrag",!1)}updateAxis(e,i,o){const{drag:l}=this.getProps();if(!o||!cO(e,l,this.currentDirection))return;const u=this.getAxisMotionValue(e);let p=this.originPoint[e]+o[e];this.constraints&&this.constraints[e]&&(p=oke(p,this.constraints[e],this.elastic[e])),u.set(p)}resolveConstraints(){var e;const{dragConstraints:i,dragElastic:o}=this.getProps(),l=this.visualElement.projection&&!this.visualElement.projection.layout?this.visualElement.projection.measure(!1):(e=this.visualElement.projection)===null||e===void 0?void 0:e.layout,u=this.constraints;i&&oS(i)?this.constraints||(this.constraints=this.resolveRefConstraints()):i&&l?this.constraints=ake(l.layoutBox,i):this.constraints=!1,this.elastic=dke(o),u!==this.constraints&&l&&this.constraints&&!this.hasMutatedConstraints&&cd(p=>{this.constraints!==!1&&this.getAxisMotionValue(p)&&(this.constraints[p]=uke(l.layoutBox[p],this.constraints[p]))})}resolveRefConstraints(){const{dragConstraints:e,onMeasureDragConstraints:i}=this.getProps();if(!e||!oS(e))return!1;const o=e.current,{projection:l}=this.visualElement;if(!l||!l.layout)return!1;const u=mke(o,l.root,this.visualElement.getTransformPagePoint());let p=cke(l.layout.layoutBox,u);if(i){const y=i(hke(p));this.hasMutatedConstraints=!!y,y&&(p=wne(y))}return p}startAnimation(e){const{drag:i,dragMomentum:o,dragElastic:l,dragTransition:u,dragSnapToOrigin:p,onDragTransitionEnd:y}=this.getProps(),E=this.constraints||{},b=cd(T=>{if(!cO(T,i,this.currentDirection))return;let R=E&&E[T]||{};p&&(R={min:0,max:0});const O=l?200:1e6,L=l?40:1e7,D={type:"inertia",velocity:o?e[T]:0,bounceStiffness:O,bounceDamping:L,timeConstant:750,restDelta:1,restSpeed:10,...u,...R};return this.startAxisValueAnimation(T,D)});return Promise.all(b).then(y)}startAxisValueAnimation(e,i){const o=this.getAxisMotionValue(e);return GV(this.visualElement,e),o.start(aF(e,o,0,i,this.visualElement,!1))}stopAnimation(){cd(e=>this.getAxisMotionValue(e).stop())}pauseAnimation(){cd(e=>{var i;return(i=this.getAxisMotionValue(e).animation)===null||i===void 0?void 0:i.pause()})}getAnimationState(e){var i;return(i=this.getAxisMotionValue(e).animation)===null||i===void 0?void 0:i.state}getAxisMotionValue(e){const i=`_drag${e.toUpperCase()}`,o=this.visualElement.getProps(),l=o[i];return l||this.visualElement.getValue(e,(o.initial?o.initial[e]:void 0)||0)}snapToCursor(e){cd(i=>{const{drag:o}=this.getProps();if(!cO(i,o,this.currentDirection))return;const{projection:l}=this.visualElement,u=this.getAxisMotionValue(i);if(l&&l.layout){const{min:p,max:y}=l.layout.layoutBox[i];u.set(e[i]-ks(p,y,.5))}})}scalePositionWithinConstraints(){if(!this.visualElement.current)return;const{drag:e,dragConstraints:i}=this.getProps(),{projection:o}=this.visualElement;if(!oS(i)||!o||!this.constraints)return;this.stopAnimation();const l={x:0,y:0};cd(p=>{const y=this.getAxisMotionValue(p);if(y&&this.constraints!==!1){const E=y.get();l[p]=lke({min:E,max:E},this.constraints[p])}});const{transformTemplate:u}=this.visualElement.getProps();this.visualElement.current.style.transform=u?u({},""):"none",o.root&&o.root.updateScroll(),o.updateLayout(),this.resolveConstraints(),cd(p=>{if(!cO(p,e,null))return;const y=this.getAxisMotionValue(p),{min:E,max:b}=this.constraints[p];y.set(ks(E,b,l[p]))})}addListeners(){if(!this.visualElement.current)return;gke.set(this.visualElement,this);const e=this.visualElement.current,i=WC(e,"pointerdown",E=>{const{drag:b,dragListener:T=!0}=this.getProps();b&&T&&this.start(E)}),o=()=>{const{dragConstraints:E}=this.getProps();oS(E)&&E.current&&(this.constraints=this.resolveRefConstraints())},{projection:l}=this.visualElement,u=l.addEventListener("measure",o);l&&!l.layout&&(l.root&&l.root.updateScroll(),l.updateLayout()),us.read(o);const p=mR(window,"resize",()=>this.scalePositionWithinConstraints()),y=l.addEventListener("didUpdate",(({delta:E,hasLayoutChanged:b})=>{this.isDragging&&b&&(cd(T=>{const R=this.getAxisMotionValue(T);R&&(this.originPoint[T]+=E[T].translate,R.set(R.get()+E[T].translate))}),this.visualElement.render())}));return()=>{p(),i(),u(),y&&y()}}getProps(){const e=this.visualElement.getProps(),{drag:i=!1,dragDirectionLock:o=!1,dragPropagation:l=!1,dragConstraints:u=!1,dragElastic:p=QV,dragMomentum:y=!0}=e;return{...e,drag:i,dragDirectionLock:o,dragPropagation:l,dragConstraints:u,dragElastic:p,dragMomentum:y}}}function cO(n,e,i){return(e===!0||e===n)&&(i===null||i===n)}function yke(n,e=10){let i=null;return Math.abs(n.y)>e?i="y":Math.abs(n.x)>e&&(i="x"),i}class Eke extends Qg{constructor(e){super(e),this.removeGroupControls=_u,this.removeListeners=_u,this.controls=new _ke(e)}mount(){const{dragControls:e}=this.node.getProps();e&&(this.removeGroupControls=e.subscribe(this.controls)),this.removeListeners=this.controls.addListeners()||_u}unmount(){this.removeGroupControls(),this.removeListeners()}}const qY=n=>(e,i)=>{n&&us.postRender(()=>n(e,i))};class vke extends Qg{constructor(){super(...arguments),this.removePointerDownListener=_u}onPointerDown(e){this.session=new Ene(e,this.createPanHandlers(),{transformPagePoint:this.node.getTransformPagePoint(),contextWindow:Ine(this.node)})}createPanHandlers(){const{onPanSessionStart:e,onPanStart:i,onPan:o,onPanEnd:l}=this.node.getProps();return{onSessionStart:qY(e),onStart:qY(i),onMove:o,onEnd:(u,p)=>{delete this.session,l&&us.postRender(()=>l(u,p))}}}mount(){this.removePointerDownListener=WC(this.node.current,"pointerdown",e=>this.onPointerDown(e))}update(){this.session&&this.session.updateHandlers(this.createPanHandlers())}unmount(){this.removePointerDownListener(),this.session&&this.session.end()}}const WO={hasAnimatedSinceResize:!0,hasEverUpdated:!1};function YY(n,e){return e.max===e.min?0:n/(e.max-e.min)*100}const iC={correct:(n,e)=>{if(!e.target)return n;if(typeof n=="string")if(Xn.test(n))n=parseFloat(n);else return n;const i=YY(n,e.target.x),o=YY(n,e.target.y);return`${i}% ${o}%`}},Ske={correct:(n,{treeScale:e,projectionDelta:i})=>{const o=n,l=Bg.parse(n);if(l.length>5)return o;const u=Bg.createTransformer(n),p=typeof l[0]!="number"?1:0,y=i.x.scale*e.x,E=i.y.scale*e.y;l[0+p]/=y,l[1+p]/=E;const b=ks(y,E,.5);return typeof l[2+p]=="number"&&(l[2+p]/=b),typeof l[3+p]=="number"&&(l[3+p]/=b),u(l)}};class bke extends k.Component{componentDidMount(){const{visualElement:e,layoutGroup:i,switchLayoutGroup:o,layoutId:l}=this.props,{projection:u}=e;z1e(wke),u&&(i.group&&i.group.add(u),o&&o.register&&l&&o.register(u),u.root.didUpdate(),u.addEventListener("animationComplete",()=>{this.safeToRemove()}),u.setOptions({...u.options,onExitComplete:()=>this.safeToRemove()})),WO.hasEverUpdated=!0}getSnapshotBeforeUpdate(e){const{layoutDependency:i,visualElement:o,drag:l,isPresent:u}=this.props,p=o.projection;return p&&(p.isPresent=u,l||e.layoutDependency!==i||i===void 0?p.willUpdate():this.safeToRemove(),e.isPresent!==u&&(u?p.promote():p.relegate()||us.postRender(()=>{const y=p.getStack();(!y||!y.members.length)&&this.safeToRemove()}))),null}componentDidUpdate(){const{projection:e}=this.props.visualElement;e&&(e.root.didUpdate(),Mj.postRender(()=>{!e.currentAnimation&&e.isLead()&&this.safeToRemove()}))}componentWillUnmount(){const{visualElement:e,layoutGroup:i,switchLayoutGroup:o}=this.props,{projection:l}=e;l&&(l.scheduleCheckAfterUnmount(),i&&i.group&&i.group.remove(l),o&&o.deregister&&o.deregister(l))}safeToRemove(){const{safeToRemove:e}=this.props;e&&e()}render(){return null}}function Ane(n){const[e,i]=Oj(),o=k.useContext(Ij);return S.jsx(bke,{...n,layoutGroup:o,switchLayoutGroup:k.useContext(yte),isPresent:e,safeToRemove:i})}const wke={borderRadius:{...iC,applyTo:["borderTopLeftRadius","borderTopRightRadius","borderBottomLeftRadius","borderBottomRightRadius"]},borderTopLeftRadius:iC,borderTopRightRadius:iC,borderBottomLeftRadius:iC,borderBottomRightRadius:iC,boxShadow:Ske};function Tke(n,e,i){const o=fc(n)?n:pR(n);return o.start(aF("",o,e,i)),o.animation}function Cke(n){return n instanceof SVGElement&&n.tagName!=="svg"}const Rke=(n,e)=>n.depth-e.depth;class Ike{constructor(){this.children=[],this.isDirty=!1}add(e){Xj(this.children,e),this.isDirty=!0}remove(e){Jj(this.children,e),this.isDirty=!0}forEach(e){this.isDirty&&this.children.sort(Rke),this.isDirty=!1,this.children.forEach(e)}}function Ake(n,e){const i=Up.now(),o=({timestamp:l})=>{const u=l-i;u>=e&&(Fg(o),n(u-e))};return us.read(o,!0),()=>Fg(o)}const Pne=["TopLeft","TopRight","BottomLeft","BottomRight"],Pke=Pne.length,XY=n=>typeof n=="string"?parseFloat(n):n,JY=n=>typeof n=="number"||Xn.test(n);function Oke(n,e,i,o,l,u){l?(n.opacity=ks(0,i.opacity!==void 0?i.opacity:1,kke(o)),n.opacityExit=ks(e.opacity!==void 0?e.opacity:1,0,Nke(o))):u&&(n.opacity=ks(e.opacity!==void 0?e.opacity:1,i.opacity!==void 0?i.opacity:1,o));for(let p=0;p<Pke;p++){const y=`border${Pne[p]}Radius`;let E=QY(e,y),b=QY(i,y);if(E===void 0&&b===void 0)continue;E||(E=0),b||(b=0),E===0||b===0||JY(E)===JY(b)?(n[y]=Math.max(ks(XY(E),XY(b),o),0),(Mp.test(b)||Mp.test(E))&&(n[y]+="%")):n[y]=b}(e.rotate||i.rotate)&&(n.rotate=ks(e.rotate||0,i.rotate||0,o))}function QY(n,e){return n[e]!==void 0?n[e]:n.borderRadius}const kke=One(0,.5,qte),Nke=One(.5,.95,_u);function One(n,e,i){return o=>o<n?0:o>e?1:i(VS(n,e,o))}function ZY(n,e){n.min=e.min,n.max=e.max}function od(n,e){ZY(n.x,e.x),ZY(n.y,e.y)}function eX(n,e){n.translate=e.translate,n.scale=e.scale,n.originPoint=e.originPoint,n.origin=e.origin}function tX(n,e,i,o,l){return n-=e,n=Ek(n,1/i,o),l!==void 0&&(n=Ek(n,1/l,o)),n}function xke(n,e=0,i=1,o=.5,l,u=n,p=n){if(Mp.test(e)&&(e=parseFloat(e),e=ks(p.min,p.max,e/100)-p.min),typeof e!="number")return;let y=ks(u.min,u.max,o);n===u&&(y-=e),n.min=tX(n.min,e,i,y,l),n.max=tX(n.max,e,i,y,l)}function nX(n,e,[i,o,l],u,p){xke(n,e[i],e[o],e[l],e.scale,u,p)}const Dke=["x","scaleX","originX"],Lke=["y","scaleY","originY"];function rX(n,e,i,o){nX(n.x,e,Dke,i?i.x:void 0,o?o.x:void 0),nX(n.y,e,Lke,i?i.y:void 0,o?o.y:void 0)}function iX(n){return n.translate===0&&n.scale===1}function kne(n){return iX(n.x)&&iX(n.y)}function sX(n,e){return n.min===e.min&&n.max===e.max}function Mke(n,e){return sX(n.x,e.x)&&sX(n.y,e.y)}function oX(n,e){return Math.round(n.min)===Math.round(e.min)&&Math.round(n.max)===Math.round(e.max)}function Nne(n,e){return oX(n.x,e.x)&&oX(n.y,e.y)}function aX(n){return Eu(n.x)/Eu(n.y)}function cX(n,e){return n.translate===e.translate&&n.scale===e.scale&&n.originPoint===e.originPoint}class Uke{constructor(){this.members=[]}add(e){Xj(this.members,e),e.scheduleRender()}remove(e){if(Jj(this.members,e),e===this.prevLead&&(this.prevLead=void 0),e===this.lead){const i=this.members[this.members.length-1];i&&this.promote(i)}}relegate(e){const i=this.members.findIndex(l=>e===l);if(i===0)return!1;let o;for(let l=i;l>=0;l--){const u=this.members[l];if(u.isPresent!==!1){o=u;break}}return o?(this.promote(o),!0):!1}promote(e,i){const o=this.lead;if(e!==o&&(this.prevLead=o,this.lead=e,e.show(),o)){o.instance&&o.scheduleRender(),e.scheduleRender(),e.resumeFrom=o,i&&(e.resumeFrom.preserveOpacity=!0),o.snapshot&&(e.snapshot=o.snapshot,e.snapshot.latestValues=o.animationValues||o.latestValues),e.root&&e.root.isUpdating&&(e.isLayoutDirty=!0);const{crossfade:l}=e.options;l===!1&&o.hide()}}exitAnimationComplete(){this.members.forEach(e=>{const{options:i,resumingFrom:o}=e;i.onExitComplete&&i.onExitComplete(),o&&o.options.onExitComplete&&o.options.onExitComplete()})}scheduleRender(){this.members.forEach(e=>{e.instance&&e.scheduleRender(!1)})}removeLeadSnapshot(){this.lead&&this.lead.snapshot&&(this.lead.snapshot=void 0)}}function Vke(n,e,i){let o="";const l=n.x.translate/e.x,u=n.y.translate/e.y,p=(i==null?void 0:i.z)||0;if((l||u||p)&&(o=`translate3d(${l}px, ${u}px, ${p}px) `),(e.x!==1||e.y!==1)&&(o+=`scale(${1/e.x}, ${1/e.y}) `),i){const{transformPerspective:b,rotate:T,rotateX:R,rotateY:O,skewX:L,skewY:D}=i;b&&(o=`perspective(${b}px) ${o}`),T&&(o+=`rotate(${T}deg) `),R&&(o+=`rotateX(${R}deg) `),O&&(o+=`rotateY(${O}deg) `),L&&(o+=`skewX(${L}deg) `),D&&(o+=`skewY(${D}deg) `)}const y=n.x.scale*e.x,E=n.y.scale*e.y;return(y!==1||E!==1)&&(o+=`scale(${y}, ${E})`),o||"none"}const ky={type:"projectionFrame",totalNodes:0,resolvedTargetDeltas:0,recalculatedProjection:0},CC=typeof window<"u"&&window.MotionDebug!==void 0,UU=["","X","Y","Z"],jke={visibility:"hidden"},lX=1e3;let Fke=0;function VU(n,e,i,o){const{latestValues:l}=e;l[n]&&(i[n]=l[n],e.setStaticValue(n,0),o&&(o[n]=0))}function xne(n){if(n.hasCheckedOptimisedAppear=!0,n.root===n)return;const{visualElement:e}=n.options;if(!e)return;const i=Bte(e);if(window.MotionHasOptimisedAnimation(i,"transform")){const{layout:l,layoutId:u}=n.options;window.MotionCancelOptimisedAnimation(i,"transform",us,!(l||u))}const{parent:o}=n;o&&!o.hasCheckedOptimisedAppear&&xne(o)}function Dne({attachResizeListener:n,defaultParent:e,measureScroll:i,checkIsScrollRoot:o,resetTransform:l}){return class{constructor(p={},y=e==null?void 0:e()){this.id=Fke++,this.animationId=0,this.children=new Set,this.options={},this.isTreeAnimating=!1,this.isAnimationBlocked=!1,this.isLayoutDirty=!1,this.isProjectionDirty=!1,this.isSharedProjectionDirty=!1,this.isTransformDirty=!1,this.updateManuallyBlocked=!1,this.updateBlockedByResize=!1,this.isUpdating=!1,this.isSVG=!1,this.needsReset=!1,this.shouldResetTransform=!1,this.hasCheckedOptimisedAppear=!1,this.treeScale={x:1,y:1},this.eventHandlers=new Map,this.hasTreeAnimated=!1,this.updateScheduled=!1,this.scheduleUpdate=()=>this.update(),this.projectionUpdateScheduled=!1,this.checkUpdateFailed=()=>{this.isUpdating&&(this.isUpdating=!1,this.clearAllSnapshots())},this.updateProjection=()=>{this.projectionUpdateScheduled=!1,CC&&(ky.totalNodes=ky.resolvedTargetDeltas=ky.recalculatedProjection=0),this.nodes.forEach(Wke),this.nodes.forEach(qke),this.nodes.forEach(Yke),this.nodes.forEach(Gke),CC&&window.MotionDebug.record(ky)},this.resolvedRelativeTargetAt=0,this.hasProjected=!1,this.isVisible=!0,this.animationProgress=0,this.sharedNodes=new Map,this.latestValues=p,this.root=y?y.root||y:this,this.path=y?[...y.path,y]:[],this.parent=y,this.depth=y?y.depth+1:0;for(let E=0;E<this.path.length;E++)this.path[E].shouldResetTransform=!0;this.root===this&&(this.nodes=new Ike)}addEventListener(p,y){return this.eventHandlers.has(p)||this.eventHandlers.set(p,new Qj),this.eventHandlers.get(p).add(y)}notifyListeners(p,...y){const E=this.eventHandlers.get(p);E&&E.notify(...y)}hasListeners(p){return this.eventHandlers.has(p)}mount(p,y=this.root.hasTreeAnimated){if(this.instance)return;this.isSVG=Cke(p),this.instance=p;const{layoutId:E,layout:b,visualElement:T}=this.options;if(T&&!T.current&&T.mount(p),this.root.nodes.add(this),this.parent&&this.parent.children.add(this),y&&(b||E)&&(this.isLayoutDirty=!0),n){let R;const O=()=>this.root.updateBlockedByResize=!1;n(p,()=>{this.root.updateBlockedByResize=!0,R&&R(),R=Ake(O,250),WO.hasAnimatedSinceResize&&(WO.hasAnimatedSinceResize=!1,this.nodes.forEach(dX))})}E&&this.root.registerSharedNode(E,this),this.options.animate!==!1&&T&&(E||b)&&this.addEventListener("didUpdate",({delta:R,hasLayoutChanged:O,hasRelativeTargetChanged:L,layout:D})=>{if(this.isTreeAnimationBlocked()){this.target=void 0,this.relativeTarget=void 0;return}const U=this.options.transition||T.getDefaultTransition()||eNe,{onLayoutAnimationStart:F,onLayoutAnimationComplete:Y}=T.getProps(),W=!this.targetLayout||!Nne(this.targetLayout,D)||L,re=!O&&L;if(this.options.layoutRoot||this.resumeFrom&&this.resumeFrom.instance||re||O&&(W||!this.currentAnimation)){this.resumeFrom&&(this.resumingFrom=this.resumeFrom,this.resumingFrom.resumingFrom=void 0),this.setAnimationOrigin(R,re);const le={...$j(U,"layout"),onPlay:F,onComplete:Y};(T.shouldReduceMotion||this.options.layoutRoot)&&(le.delay=0,le.type=!1),this.startAnimation(le)}else O||dX(this),this.isLead()&&this.options.onExitComplete&&this.options.onExitComplete();this.targetLayout=D})}unmount(){this.options.layoutId&&this.willUpdate(),this.root.nodes.remove(this);const p=this.getStack();p&&p.remove(this),this.parent&&this.parent.children.delete(this),this.instance=void 0,Fg(this.updateProjection)}blockUpdate(){this.updateManuallyBlocked=!0}unblockUpdate(){this.updateManuallyBlocked=!1}isUpdateBlocked(){return this.updateManuallyBlocked||this.updateBlockedByResize}isTreeAnimationBlocked(){return this.isAnimationBlocked||this.parent&&this.parent.isTreeAnimationBlocked()||!1}startUpdate(){this.isUpdateBlocked()||(this.isUpdating=!0,this.nodes&&this.nodes.forEach(Xke),this.animationId++)}getTransformTemplate(){const{visualElement:p}=this.options;return p&&p.getProps().transformTemplate}willUpdate(p=!0){if(this.root.hasTreeAnimated=!0,this.root.isUpdateBlocked()){this.options.onExitComplete&&this.options.onExitComplete();return}if(window.MotionCancelOptimisedAnimation&&!this.hasCheckedOptimisedAppear&&xne(this),!this.root.isUpdating&&this.root.startUpdate(),this.isLayoutDirty)return;this.isLayoutDirty=!0;for(let T=0;T<this.path.length;T++){const R=this.path[T];R.shouldResetTransform=!0,R.updateScroll("snapshot"),R.options.layoutRoot&&R.willUpdate(!1)}const{layoutId:y,layout:E}=this.options;if(y===void 0&&!E)return;const b=this.getTransformTemplate();this.prevTransformTemplateValue=b?b(this.latestValues,""):void 0,this.updateSnapshot(),p&&this.notifyListeners("willUpdate")}update(){if(this.updateScheduled=!1,this.isUpdateBlocked()){this.unblockUpdate(),this.clearAllSnapshots(),this.nodes.forEach(uX);return}this.isUpdating||this.nodes.forEach($ke),this.isUpdating=!1,this.nodes.forEach(Kke),this.nodes.forEach(Bke),this.nodes.forEach(zke),this.clearAllSnapshots();const y=Up.now();Ua.delta=Qf(0,1e3/60,y-Ua.timestamp),Ua.timestamp=y,Ua.isProcessing=!0,AU.update.process(Ua),AU.preRender.process(Ua),AU.render.process(Ua),Ua.isProcessing=!1}didUpdate(){this.updateScheduled||(this.updateScheduled=!0,Mj.read(this.scheduleUpdate))}clearAllSnapshots(){this.nodes.forEach(Hke),this.sharedNodes.forEach(Jke)}scheduleUpdateProjection(){this.projectionUpdateScheduled||(this.projectionUpdateScheduled=!0,us.preRender(this.updateProjection,!1,!0))}scheduleCheckAfterUnmount(){us.postRender(()=>{this.isLayoutDirty?this.root.didUpdate():this.root.checkUpdateFailed()})}updateSnapshot(){this.snapshot||!this.instance||(this.snapshot=this.measure())}updateLayout(){if(!this.instance||(this.updateScroll(),!(this.options.alwaysMeasureLayout&&this.isLead())&&!this.isLayoutDirty))return;if(this.resumeFrom&&!this.resumeFrom.instance)for(let E=0;E<this.path.length;E++)this.path[E].updateScroll();const p=this.layout;this.layout=this.measure(!1),this.layoutCorrected=ho(),this.isLayoutDirty=!1,this.projectionDelta=void 0,this.notifyListeners("measure",this.layout.layoutBox);const{visualElement:y}=this.options;y&&y.notify("LayoutMeasure",this.layout.layoutBox,p?p.layoutBox:void 0)}updateScroll(p="measure"){let y=!!(this.options.layoutScroll&&this.instance);if(this.scroll&&this.scroll.animationId===this.root.animationId&&this.scroll.phase===p&&(y=!1),y){const E=o(this.instance);this.scroll={animationId:this.root.animationId,phase:p,isRoot:E,offset:i(this.instance),wasRoot:this.scroll?this.scroll.isRoot:E}}}resetTransform(){if(!l)return;const p=this.isLayoutDirty||this.shouldResetTransform||this.options.alwaysMeasureLayout,y=this.projectionDelta&&!kne(this.projectionDelta),E=this.getTransformTemplate(),b=E?E(this.latestValues,""):void 0,T=b!==this.prevTransformTemplateValue;p&&(y||Oy(this.latestValues)||T)&&(l(this.instance,b),this.shouldResetTransform=!1,this.scheduleRender())}measure(p=!0){const y=this.measurePageBox();let E=this.removeElementScroll(y);return p&&(E=this.removeTransform(E)),tNe(E),{animationId:this.root.animationId,measuredBox:y,layoutBox:E,latestValues:{},source:this.id}}measurePageBox(){var p;const{visualElement:y}=this.options;if(!y)return ho();const E=y.measureViewportBox();if(!(((p=this.scroll)===null||p===void 0?void 0:p.wasRoot)||this.path.some(nNe))){const{scroll:T}=this.root;T&&(lS(E.x,T.offset.x),lS(E.y,T.offset.y))}return E}removeElementScroll(p){var y;const E=ho();if(od(E,p),!((y=this.scroll)===null||y===void 0)&&y.wasRoot)return E;for(let b=0;b<this.path.length;b++){const T=this.path[b],{scroll:R,options:O}=T;T!==this.root&&R&&O.layoutScroll&&(R.wasRoot&&od(E,p),lS(E.x,R.offset.x),lS(E.y,R.offset.y))}return E}applyTransform(p,y=!1){const E=ho();od(E,p);for(let b=0;b<this.path.length;b++){const T=this.path[b];!y&&T.options.layoutScroll&&T.scroll&&T!==T.root&&uS(E,{x:-T.scroll.offset.x,y:-T.scroll.offset.y}),Oy(T.latestValues)&&uS(E,T.latestValues)}return Oy(this.latestValues)&&uS(E,this.latestValues),E}removeTransform(p){const y=ho();od(y,p);for(let E=0;E<this.path.length;E++){const b=this.path[E];if(!b.instance||!Oy(b.latestValues))continue;ZV(b.latestValues)&&b.updateSnapshot();const T=ho(),R=b.measurePageBox();od(T,R),rX(y,b.latestValues,b.snapshot?b.snapshot.layoutBox:void 0,T)}return Oy(this.latestValues)&&rX(y,this.latestValues),y}setTargetDelta(p){this.targetDelta=p,this.root.scheduleUpdateProjection(),this.isProjectionDirty=!0}setOptions(p){this.options={...this.options,...p,crossfade:p.crossfade!==void 0?p.crossfade:!0}}clearMeasurements(){this.scroll=void 0,this.layout=void 0,this.snapshot=void 0,this.prevTransformTemplateValue=void 0,this.targetDelta=void 0,this.target=void 0,this.isLayoutDirty=!1}forceRelativeParentToResolveTarget(){this.relativeParent&&this.relativeParent.resolvedRelativeTargetAt!==Ua.timestamp&&this.relativeParent.resolveTargetDelta(!0)}resolveTargetDelta(p=!1){var y;const E=this.getLead();this.isProjectionDirty||(this.isProjectionDirty=E.isProjectionDirty),this.isTransformDirty||(this.isTransformDirty=E.isTransformDirty),this.isSharedProjectionDirty||(this.isSharedProjectionDirty=E.isSharedProjectionDirty);const b=!!this.resumingFrom||this!==E;if(!(p||b&&this.isSharedProjectionDirty||this.isProjectionDirty||!((y=this.parent)===null||y===void 0)&&y.isProjectionDirty||this.attemptToResolveRelativeTarget||this.root.updateBlockedByResize))return;const{layout:R,layoutId:O}=this.options;if(!(!this.layout||!(R||O))){if(this.resolvedRelativeTargetAt=Ua.timestamp,!this.targetDelta&&!this.relativeTarget){const L=this.getClosestProjectingParent();L&&L.layout&&this.animationProgress!==1?(this.relativeParent=L,this.forceRelativeParentToResolveTarget(),this.relativeTarget=ho(),this.relativeTargetOrigin=ho(),HC(this.relativeTargetOrigin,this.layout.layoutBox,L.layout.layoutBox),od(this.relativeTarget,this.relativeTargetOrigin)):this.relativeParent=this.relativeTarget=void 0}if(!(!this.relativeTarget&&!this.targetDelta)){if(this.target||(this.target=ho(),this.targetWithTransforms=ho()),this.relativeTarget&&this.relativeTargetOrigin&&this.relativeParent&&this.relativeParent.target?(this.forceRelativeParentToResolveTarget(),ske(this.target,this.relativeTarget,this.relativeParent.target)):this.targetDelta?(this.resumingFrom?this.target=this.applyTransform(this.layout.layoutBox):od(this.target,this.layout.layoutBox),Cne(this.target,this.targetDelta)):od(this.target,this.layout.layoutBox),this.attemptToResolveRelativeTarget){this.attemptToResolveRelativeTarget=!1;const L=this.getClosestProjectingParent();L&&!!L.resumingFrom==!!this.resumingFrom&&!L.options.layoutScroll&&L.target&&this.animationProgress!==1?(this.relativeParent=L,this.forceRelativeParentToResolveTarget(),this.relativeTarget=ho(),this.relativeTargetOrigin=ho(),HC(this.relativeTargetOrigin,this.target,L.target),od(this.relativeTarget,this.relativeTargetOrigin)):this.relativeParent=this.relativeTarget=void 0}CC&&ky.resolvedTargetDeltas++}}}getClosestProjectingParent(){if(!(!this.parent||ZV(this.parent.latestValues)||Tne(this.parent.latestValues)))return this.parent.isProjecting()?this.parent:this.parent.getClosestProjectingParent()}isProjecting(){return!!((this.relativeTarget||this.targetDelta||this.options.layoutRoot)&&this.layout)}calcProjection(){var p;const y=this.getLead(),E=!!this.resumingFrom||this!==y;let b=!0;if((this.isProjectionDirty||!((p=this.parent)===null||p===void 0)&&p.isProjectionDirty)&&(b=!1),E&&(this.isSharedProjectionDirty||this.isTransformDirty)&&(b=!1),this.resolvedRelativeTargetAt===Ua.timestamp&&(b=!1),b)return;const{layout:T,layoutId:R}=this.options;if(this.isTreeAnimating=!!(this.parent&&this.parent.isTreeAnimating||this.currentAnimation||this.pendingAnimation),this.isTreeAnimating||(this.targetDelta=this.relativeTarget=void 0),!this.layout||!(T||R))return;od(this.layoutCorrected,this.layout.layoutBox);const O=this.treeScale.x,L=this.treeScale.y;fke(this.layoutCorrected,this.treeScale,this.path,E),y.layout&&!y.target&&(this.treeScale.x!==1||this.treeScale.y!==1)&&(y.target=y.layout.layoutBox,y.targetWithTransforms=ho());const{target:D}=y;if(!D){this.prevProjectionDelta&&(this.createProjectionDeltas(),this.scheduleRender());return}!this.projectionDelta||!this.prevProjectionDelta?this.createProjectionDeltas():(eX(this.prevProjectionDelta.x,this.projectionDelta.x),eX(this.prevProjectionDelta.y,this.projectionDelta.y)),GC(this.projectionDelta,this.layoutCorrected,D,this.latestValues),(this.treeScale.x!==O||this.treeScale.y!==L||!cX(this.projectionDelta.x,this.prevProjectionDelta.x)||!cX(this.projectionDelta.y,this.prevProjectionDelta.y))&&(this.hasProjected=!0,this.scheduleRender(),this.notifyListeners("projectionUpdate",D)),CC&&ky.recalculatedProjection++}hide(){this.isVisible=!1}show(){this.isVisible=!0}scheduleRender(p=!0){var y;if((y=this.options.visualElement)===null||y===void 0||y.scheduleRender(),p){const E=this.getStack();E&&E.scheduleRender()}this.resumingFrom&&!this.resumingFrom.instance&&(this.resumingFrom=void 0)}createProjectionDeltas(){this.prevProjectionDelta=cS(),this.projectionDelta=cS(),this.projectionDeltaWithTransform=cS()}setAnimationOrigin(p,y=!1){const E=this.snapshot,b=E?E.latestValues:{},T={...this.latestValues},R=cS();(!this.relativeParent||!this.relativeParent.options.layoutRoot)&&(this.relativeTarget=this.relativeTargetOrigin=void 0),this.attemptToResolveRelativeTarget=!y;const O=ho(),L=E?E.source:void 0,D=this.layout?this.layout.source:void 0,U=L!==D,F=this.getStack(),Y=!F||F.members.length<=1,W=!!(U&&!Y&&this.options.crossfade===!0&&!this.path.some(Zke));this.animationProgress=0;let re;this.mixTargetDelta=le=>{const ie=le/1e3;hX(R.x,p.x,ie),hX(R.y,p.y,ie),this.setTargetDelta(R),this.relativeTarget&&this.relativeTargetOrigin&&this.layout&&this.relativeParent&&this.relativeParent.layout&&(HC(O,this.layout.layoutBox,this.relativeParent.layout.layoutBox),Qke(this.relativeTarget,this.relativeTargetOrigin,O,ie),re&&Mke(this.relativeTarget,re)&&(this.isProjectionDirty=!1),re||(re=ho()),od(re,this.relativeTarget)),U&&(this.animationValues=T,Oke(T,b,this.latestValues,ie,W,Y)),this.root.scheduleUpdateProjection(),this.scheduleRender(),this.animationProgress=ie},this.mixTargetDelta(this.options.layoutRoot?1e3:0)}startAnimation(p){this.notifyListeners("animationStart"),this.currentAnimation&&this.currentAnimation.stop(),this.resumingFrom&&this.resumingFrom.currentAnimation&&this.resumingFrom.currentAnimation.stop(),this.pendingAnimation&&(Fg(this.pendingAnimation),this.pendingAnimation=void 0),this.pendingAnimation=us.update(()=>{WO.hasAnimatedSinceResize=!0,this.currentAnimation=Tke(0,lX,{...p,onUpdate:y=>{this.mixTargetDelta(y),p.onUpdate&&p.onUpdate(y)},onComplete:()=>{p.onComplete&&p.onComplete(),this.completeAnimation()}}),this.resumingFrom&&(this.resumingFrom.currentAnimation=this.currentAnimation),this.pendingAnimation=void 0})}completeAnimation(){this.resumingFrom&&(this.resumingFrom.currentAnimation=void 0,this.resumingFrom.preserveOpacity=void 0);const p=this.getStack();p&&p.exitAnimationComplete(),this.resumingFrom=this.currentAnimation=this.animationValues=void 0,this.notifyListeners("animationComplete")}finishAnimation(){this.currentAnimation&&(this.mixTargetDelta&&this.mixTargetDelta(lX),this.currentAnimation.stop()),this.completeAnimation()}applyTransformsToTarget(){const p=this.getLead();let{targetWithTransforms:y,target:E,layout:b,latestValues:T}=p;if(!(!y||!E||!b)){if(this!==p&&this.layout&&b&&Lne(this.options.animationType,this.layout.layoutBox,b.layoutBox)){E=this.target||ho();const R=Eu(this.layout.layoutBox.x);E.x.min=p.target.x.min,E.x.max=E.x.min+R;const O=Eu(this.layout.layoutBox.y);E.y.min=p.target.y.min,E.y.max=E.y.min+O}od(y,E),uS(y,T),GC(this.projectionDeltaWithTransform,this.layoutCorrected,y,T)}}registerSharedNode(p,y){this.sharedNodes.has(p)||this.sharedNodes.set(p,new Uke),this.sharedNodes.get(p).add(y);const b=y.options.initialPromotionConfig;y.promote({transition:b?b.transition:void 0,preserveFollowOpacity:b&&b.shouldPreserveFollowOpacity?b.shouldPreserveFollowOpacity(y):void 0})}isLead(){const p=this.getStack();return p?p.lead===this:!0}getLead(){var p;const{layoutId:y}=this.options;return y?((p=this.getStack())===null||p===void 0?void 0:p.lead)||this:this}getPrevLead(){var p;const{layoutId:y}=this.options;return y?(p=this.getStack())===null||p===void 0?void 0:p.prevLead:void 0}getStack(){const{layoutId:p}=this.options;if(p)return this.root.sharedNodes.get(p)}promote({needsReset:p,transition:y,preserveFollowOpacity:E}={}){const b=this.getStack();b&&b.promote(this,E),p&&(this.projectionDelta=void 0,this.needsReset=!0),y&&this.setOptions({transition:y})}relegate(){const p=this.getStack();return p?p.relegate(this):!1}resetSkewAndRotation(){const{visualElement:p}=this.options;if(!p)return;let y=!1;const{latestValues:E}=p;if((E.z||E.rotate||E.rotateX||E.rotateY||E.rotateZ||E.skewX||E.skewY)&&(y=!0),!y)return;const b={};E.z&&VU("z",p,b,this.animationValues);for(let T=0;T<UU.length;T++)VU(`rotate${UU[T]}`,p,b,this.animationValues),VU(`skew${UU[T]}`,p,b,this.animationValues);p.render();for(const T in b)p.setStaticValue(T,b[T]),this.animationValues&&(this.animationValues[T]=b[T]);p.scheduleRender()}getProjectionStyles(p){var y,E;if(!this.instance||this.isSVG)return;if(!this.isVisible)return jke;const b={visibility:""},T=this.getTransformTemplate();if(this.needsReset)return this.needsReset=!1,b.opacity="",b.pointerEvents=BO(p==null?void 0:p.pointerEvents)||"",b.transform=T?T(this.latestValues,""):"none",b;const R=this.getLead();if(!this.projectionDelta||!this.layout||!R.target){const U={};return this.options.layoutId&&(U.opacity=this.latestValues.opacity!==void 0?this.latestValues.opacity:1,U.pointerEvents=BO(p==null?void 0:p.pointerEvents)||""),this.hasProjected&&!Oy(this.latestValues)&&(U.transform=T?T({},""):"none",this.hasProjected=!1),U}const O=R.animationValues||R.latestValues;this.applyTransformsToTarget(),b.transform=Vke(this.projectionDeltaWithTransform,this.treeScale,O),T&&(b.transform=T(O,b.transform));const{x:L,y:D}=this.projectionDelta;b.transformOrigin=`${L.origin*100}% ${D.origin*100}% 0`,R.animationValues?b.opacity=R===this?(E=(y=O.opacity)!==null&&y!==void 0?y:this.latestValues.opacity)!==null&&E!==void 0?E:1:this.preserveOpacity?this.latestValues.opacity:O.opacityExit:b.opacity=R===this?O.opacity!==void 0?O.opacity:"":O.opacityExit!==void 0?O.opacityExit:0;for(const U in fk){if(O[U]===void 0)continue;const{correct:F,applyTo:Y}=fk[U],W=b.transform==="none"?O[U]:F(O[U],R);if(Y){const re=Y.length;for(let le=0;le<re;le++)b[Y[le]]=W}else b[U]=W}return this.options.layoutId&&(b.pointerEvents=R===this?BO(p==null?void 0:p.pointerEvents)||"":"none"),b}clearSnapshot(){this.resumeFrom=this.snapshot=void 0}resetTree(){this.root.nodes.forEach(p=>{var y;return(y=p.currentAnimation)===null||y===void 0?void 0:y.stop()}),this.root.nodes.forEach(uX),this.root.sharedNodes.clear()}}}function Bke(n){n.updateLayout()}function zke(n){var e;const i=((e=n.resumeFrom)===null||e===void 0?void 0:e.snapshot)||n.snapshot;if(n.isLead()&&n.layout&&i&&n.hasListeners("didUpdate")){const{layoutBox:o,measuredBox:l}=n.layout,{animationType:u}=n.options,p=i.source!==n.layout.source;u==="size"?cd(R=>{const O=p?i.measuredBox[R]:i.layoutBox[R],L=Eu(O);O.min=o[R].min,O.max=O.min+L}):Lne(u,i.layoutBox,o)&&cd(R=>{const O=p?i.measuredBox[R]:i.layoutBox[R],L=Eu(o[R]);O.max=O.min+L,n.relativeTarget&&!n.currentAnimation&&(n.isProjectionDirty=!0,n.relativeTarget[R].max=n.relativeTarget[R].min+L)});const y=cS();GC(y,o,i.layoutBox);const E=cS();p?GC(E,n.applyTransform(l,!0),i.measuredBox):GC(E,o,i.layoutBox);const b=!kne(y);let T=!1;if(!n.resumeFrom){const R=n.getClosestProjectingParent();if(R&&!R.resumeFrom){const{snapshot:O,layout:L}=R;if(O&&L){const D=ho();HC(D,i.layoutBox,O.layoutBox);const U=ho();HC(U,o,L.layoutBox),Nne(D,U)||(T=!0),R.options.layoutRoot&&(n.relativeTarget=U,n.relativeTargetOrigin=D,n.relativeParent=R)}}}n.notifyListeners("didUpdate",{layout:o,snapshot:i,delta:E,layoutDelta:y,hasLayoutChanged:b,hasRelativeTargetChanged:T})}else if(n.isLead()){const{onExitComplete:o}=n.options;o&&o()}n.options.transition=void 0}function Wke(n){CC&&ky.totalNodes++,n.parent&&(n.isProjecting()||(n.isProjectionDirty=n.parent.isProjectionDirty),n.isSharedProjectionDirty||(n.isSharedProjectionDirty=!!(n.isProjectionDirty||n.parent.isProjectionDirty||n.parent.isSharedProjectionDirty)),n.isTransformDirty||(n.isTransformDirty=n.parent.isTransformDirty))}function Gke(n){n.isProjectionDirty=n.isSharedProjectionDirty=n.isTransformDirty=!1}function Hke(n){n.clearSnapshot()}function uX(n){n.clearMeasurements()}function $ke(n){n.isLayoutDirty=!1}function Kke(n){const{visualElement:e}=n.options;e&&e.getProps().onBeforeLayoutMeasure&&e.notify("BeforeLayoutMeasure"),n.resetTransform()}function dX(n){n.finishAnimation(),n.targetDelta=n.relativeTarget=n.target=void 0,n.isProjectionDirty=!0}function qke(n){n.resolveTargetDelta()}function Yke(n){n.calcProjection()}function Xke(n){n.resetSkewAndRotation()}function Jke(n){n.removeLeadSnapshot()}function hX(n,e,i){n.translate=ks(e.translate,0,i),n.scale=ks(e.scale,1,i),n.origin=e.origin,n.originPoint=e.originPoint}function pX(n,e,i,o){n.min=ks(e.min,i.min,o),n.max=ks(e.max,i.max,o)}function Qke(n,e,i,o){pX(n.x,e.x,i.x,o),pX(n.y,e.y,i.y,o)}function Zke(n){return n.animationValues&&n.animationValues.opacityExit!==void 0}const eNe={duration:.45,ease:[.4,0,.1,1]},fX=n=>typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().includes(n),mX=fX("applewebkit/")&&!fX("chrome/")?Math.round:_u;function gX(n){n.min=mX(n.min),n.max=mX(n.max)}function tNe(n){gX(n.x),gX(n.y)}function Lne(n,e,i){return n==="position"||n==="preserve-aspect"&&!ike(aX(e),aX(i),.2)}function nNe(n){var e;return n!==n.root&&((e=n.scroll)===null||e===void 0?void 0:e.wasRoot)}const rNe=Dne({attachResizeListener:(n,e)=>mR(n,"resize",e),measureScroll:()=>({x:document.documentElement.scrollLeft||document.body.scrollLeft,y:document.documentElement.scrollTop||document.body.scrollTop}),checkIsScrollRoot:()=>!0}),jU={current:void 0},Mne=Dne({measureScroll:n=>({x:n.scrollLeft,y:n.scrollTop}),defaultParent:()=>{if(!jU.current){const n=new rNe({});n.mount(window),n.setOptions({layoutScroll:!0}),jU.current=n}return jU.current},resetTransform:(n,e)=>{n.style.transform=e!==void 0?e:"none"},checkIsScrollRoot:n=>window.getComputedStyle(n).position==="fixed"}),iNe={pan:{Feature:vke},drag:{Feature:Eke,ProjectionNode:Mne,MeasureLayout:Ane}};function _X(n,e,i){const{props:o}=n;n.animationState&&o.whileHover&&n.animationState.setActive("whileHover",i==="Start");const l="onHover"+i,u=o[l];u&&us.postRender(()=>u(e,$R(e)))}class sNe extends Qg{mount(){const{current:e}=this.node;e&&(this.unmount=iPe(e,i=>(_X(this.node,i,"Start"),o=>_X(this.node,o,"End"))))}unmount(){}}class oNe extends Qg{constructor(){super(...arguments),this.isActive=!1}onFocus(){let e=!1;try{e=this.node.current.matches(":focus-visible")}catch{e=!0}!e||!this.node.animationState||(this.node.animationState.setActive("whileFocus",!0),this.isActive=!0)}onBlur(){!this.isActive||!this.node.animationState||(this.node.animationState.setActive("whileFocus",!1),this.isActive=!1)}mount(){this.unmount=HR(mR(this.node.current,"focus",()=>this.onFocus()),mR(this.node.current,"blur",()=>this.onBlur()))}unmount(){}}function yX(n,e,i){const{props:o}=n;n.animationState&&o.whileTap&&n.animationState.setActive("whileTap",i==="Start");const l="onTap"+(i==="End"?"":i),u=o[l];u&&us.postRender(()=>u(e,$R(e)))}class aNe extends Qg{mount(){const{current:e}=this.node;e&&(this.unmount=cPe(e,i=>(yX(this.node,i,"Start"),(o,{success:l})=>yX(this.node,o,l?"End":"Cancel")),{useGlobalTarget:this.node.props.globalTapTarget}))}unmount(){}}const t5=new WeakMap,FU=new WeakMap,cNe=n=>{const e=t5.get(n.target);e&&e(n)},lNe=n=>{n.forEach(cNe)};function uNe({root:n,...e}){const i=n||document;FU.has(i)||FU.set(i,{});const o=FU.get(i),l=JSON.stringify(e);return o[l]||(o[l]=new IntersectionObserver(lNe,{root:n,...e})),o[l]}function dNe(n,e,i){const o=uNe(e);return t5.set(n,i),o.observe(n),()=>{t5.delete(n),o.unobserve(n)}}const hNe={some:0,all:1};class pNe extends Qg{constructor(){super(...arguments),this.hasEnteredView=!1,this.isInView=!1}startObserver(){this.unmount();const{viewport:e={}}=this.node.getProps(),{root:i,margin:o,amount:l="some",once:u}=e,p={root:i?i.current:void 0,rootMargin:o,threshold:typeof l=="number"?l:hNe[l]},y=E=>{const{isIntersecting:b}=E;if(this.isInView===b||(this.isInView=b,u&&!b&&this.hasEnteredView))return;b&&(this.hasEnteredView=!0),this.node.animationState&&this.node.animationState.setActive("whileInView",b);const{onViewportEnter:T,onViewportLeave:R}=this.node.getProps(),O=b?T:R;O&&O(E)};return dNe(this.node.current,p,y)}mount(){this.startObserver()}update(){if(typeof IntersectionObserver>"u")return;const{props:e,prevProps:i}=this.node;["amount","margin","root"].some(fNe(e,i))&&this.startObserver()}unmount(){}}function fNe({viewport:n={}},{viewport:e={}}={}){return i=>n[i]!==e[i]}const mNe={inView:{Feature:pNe},tap:{Feature:aNe},focus:{Feature:oNe},hover:{Feature:sNe}},gNe={layout:{ProjectionNode:Mne,MeasureLayout:Ane}},n5={current:null},Une={current:!1};function _Ne(){if(Une.current=!0,!!kj)if(window.matchMedia){const n=window.matchMedia("(prefers-reduced-motion)"),e=()=>n5.current=n.matches;n.addListener(e),e()}else n5.current=!1}const yNe=[...cne,uc,Bg],ENe=n=>yNe.find(ane(n)),EX=new WeakMap;function vNe(n,e,i){for(const o in e){const l=e[o],u=i[o];if(fc(l))n.addValue(o,l);else if(fc(u))n.addValue(o,pR(l,{owner:n}));else if(u!==l)if(n.hasValue(o)){const p=n.getValue(o);p.liveStyle===!0?p.jump(l):p.hasAnimated||p.set(l)}else{const p=n.getStaticValue(o);n.addValue(o,pR(p!==void 0?p:l,{owner:n}))}}for(const o in i)e[o]===void 0&&n.removeValue(o);return e}const vX=["AnimationStart","AnimationComplete","Update","BeforeLayoutMeasure","LayoutMeasure","LayoutAnimationStart","LayoutAnimationComplete"];class SNe{scrapeMotionValuesFromProps(e,i,o){return{}}constructor({parent:e,props:i,presenceContext:o,reducedMotionConfig:l,blockInitialAnimation:u,visualState:p},y={}){this.current=null,this.children=new Set,this.isVariantNode=!1,this.isControllingVariants=!1,this.shouldReduceMotion=null,this.values=new Map,this.KeyframeResolver=iF,this.features={},this.valueSubscriptions=new Map,this.prevMotionValues={},this.events={},this.propEventSubscriptions={},this.notifyUpdate=()=>this.notify("Update",this.latestValues),this.render=()=>{this.current&&(this.triggerBuild(),this.renderInstance(this.current,this.renderState,this.props.style,this.projection))},this.renderScheduledAt=0,this.scheduleRender=()=>{const L=Up.now();this.renderScheduledAt<L&&(this.renderScheduledAt=L,us.render(this.render,!1,!0))};const{latestValues:E,renderState:b,onUpdate:T}=p;this.onUpdate=T,this.latestValues=E,this.baseTarget={...E},this.initialValues=i.initial?{...E}:{},this.renderState=b,this.parent=e,this.props=i,this.presenceContext=o,this.depth=e?e.depth+1:0,this.reducedMotionConfig=l,this.options=y,this.blockInitialAnimation=!!u,this.isControllingVariants=gN(i),this.isVariantNode=gte(i),this.isVariantNode&&(this.variantChildren=new Set),this.manuallyAnimateOnMount=!!(e&&e.current);const{willChange:R,...O}=this.scrapeMotionValuesFromProps(i,{},this);for(const L in O){const D=O[L];E[L]!==void 0&&fc(D)&&D.set(E[L],!1)}}mount(e){this.current=e,EX.set(e,this),this.projection&&!this.projection.instance&&this.projection.mount(e),this.parent&&this.isVariantNode&&!this.isControllingVariants&&(this.removeFromVariantTree=this.parent.addVariantChild(this)),this.values.forEach((i,o)=>this.bindToMotionValue(o,i)),Une.current||_Ne(),this.shouldReduceMotion=this.reducedMotionConfig==="never"?!1:this.reducedMotionConfig==="always"?!0:n5.current,this.parent&&this.parent.children.add(this),this.update(this.props,this.presenceContext)}unmount(){EX.delete(this.current),this.projection&&this.projection.unmount(),Fg(this.notifyUpdate),Fg(this.render),this.valueSubscriptions.forEach(e=>e()),this.valueSubscriptions.clear(),this.removeFromVariantTree&&this.removeFromVariantTree(),this.parent&&this.parent.children.delete(this);for(const e in this.events)this.events[e].clear();for(const e in this.features){const i=this.features[e];i&&(i.unmount(),i.isMounted=!1)}this.current=null}bindToMotionValue(e,i){this.valueSubscriptions.has(e)&&this.valueSubscriptions.get(e)();const o=vE.has(e),l=i.on("change",y=>{this.latestValues[e]=y,this.props.onUpdate&&us.preRender(this.notifyUpdate),o&&this.projection&&(this.projection.isTransformDirty=!0)}),u=i.on("renderRequest",this.scheduleRender);let p;window.MotionCheckAppearSync&&(p=window.MotionCheckAppearSync(this,e,i)),this.valueSubscriptions.set(e,()=>{l(),u(),p&&p(),i.owner&&i.stop()})}sortNodePosition(e){return!this.current||!this.sortInstanceNodePosition||this.type!==e.type?0:this.sortInstanceNodePosition(this.current,e.current)}updateFeatures(){let e="animation";for(e in jS){const i=jS[e];if(!i)continue;const{isEnabled:o,Feature:l}=i;if(!this.features[e]&&l&&o(this.props)&&(this.features[e]=new l(this)),this.features[e]){const u=this.features[e];u.isMounted?u.update():(u.mount(),u.isMounted=!0)}}}triggerBuild(){this.build(this.renderState,this.latestValues,this.props)}measureViewportBox(){return this.current?this.measureInstanceViewportBox(this.current,this.props):ho()}getStaticValue(e){return this.latestValues[e]}setStaticValue(e,i){this.latestValues[e]=i}update(e,i){(e.transformTemplate||this.props.transformTemplate)&&this.scheduleRender(),this.prevProps=this.props,this.props=e,this.prevPresenceContext=this.presenceContext,this.presenceContext=i;for(let o=0;o<vX.length;o++){const l=vX[o];this.propEventSubscriptions[l]&&(this.propEventSubscriptions[l](),delete this.propEventSubscriptions[l]);const u="on"+l,p=e[u];p&&(this.propEventSubscriptions[l]=this.on(l,p))}this.prevMotionValues=vNe(this,this.scrapeMotionValuesFromProps(e,this.prevProps,this),this.prevMotionValues),this.handleChildMotionValue&&this.handleChildMotionValue(),this.onUpdate&&this.onUpdate(this)}getProps(){return this.props}getVariant(e){return this.props.variants?this.props.variants[e]:void 0}getDefaultTransition(){return this.props.transition}getTransformPagePoint(){return this.props.transformPagePoint}getClosestVariantNode(){return this.isVariantNode?this:this.parent?this.parent.getClosestVariantNode():void 0}addVariantChild(e){const i=this.getClosestVariantNode();if(i)return i.variantChildren&&i.variantChildren.add(e),()=>i.variantChildren.delete(e)}addValue(e,i){const o=this.values.get(e);i!==o&&(o&&this.removeValue(e),this.bindToMotionValue(e,i),this.values.set(e,i),this.latestValues[e]=i.get())}removeValue(e){this.values.delete(e);const i=this.valueSubscriptions.get(e);i&&(i(),this.valueSubscriptions.delete(e)),delete this.latestValues[e],this.removeValueFromRenderState(e,this.renderState)}hasValue(e){return this.values.has(e)}getValue(e,i){if(this.props.values&&this.props.values[e])return this.props.values[e];let o=this.values.get(e);return o===void 0&&i!==void 0&&(o=pR(i===null?void 0:i,{owner:this}),this.addValue(e,o)),o}readValue(e,i){var o;let l=this.latestValues[e]!==void 0||!this.current?this.latestValues[e]:(o=this.getBaseTargetFromProps(this.props,e))!==null&&o!==void 0?o:this.readValueFromInstance(this.current,e,this.options);return l!=null&&(typeof l=="string"&&(sne(l)||Xte(l))?l=parseFloat(l):!ENe(l)&&Bg.test(i)&&(l=nne(e,i)),this.setBaseTarget(e,fc(l)?l.get():l)),fc(l)?l.get():l}setBaseTarget(e,i){this.baseTarget[e]=i}getBaseTarget(e){var i;const{initial:o}=this.props;let l;if(typeof o=="string"||typeof o=="object"){const p=Vj(this.props,o,(i=this.presenceContext)===null||i===void 0?void 0:i.custom);p&&(l=p[e])}if(o&&l!==void 0)return l;const u=this.getBaseTargetFromProps(this.props,e);return u!==void 0&&!fc(u)?u:this.initialValues[e]!==void 0&&l===void 0?void 0:this.baseTarget[e]}on(e,i){return this.events[e]||(this.events[e]=new Qj),this.events[e].add(i)}notify(e,...i){this.events[e]&&this.events[e].notify(...i)}}class Vne extends SNe{constructor(){super(...arguments),this.KeyframeResolver=lne}sortInstanceNodePosition(e,i){return e.compareDocumentPosition(i)&2?1:-1}getBaseTargetFromProps(e,i){return e.style?e.style[i]:void 0}removeValueFromRenderState(e,{vars:i,style:o}){delete i[e],delete o[e]}handleChildMotionValue(){this.childSubscription&&(this.childSubscription(),delete this.childSubscription);const{children:e}=this.props;fc(e)&&(this.childSubscription=e.on("change",i=>{this.current&&(this.current.textContent=`${i}`)}))}}function bNe(n){return window.getComputedStyle(n)}class wNe extends Vne{constructor(){super(...arguments),this.type="html",this.renderInstance=Cte}readValueFromInstance(e,i){if(vE.has(i)){const o=rF(i);return o&&o.default||0}else{const o=bNe(e),l=(bte(i)?o.getPropertyValue(i):o[i])||0;return typeof l=="string"?l.trim():l}}measureInstanceViewportBox(e,{transformPagePoint:i}){return Rne(e,i)}build(e,i,o){Bj(e,i,o.transformTemplate)}scrapeMotionValuesFromProps(e,i,o){return Hj(e,i,o)}}class TNe extends Vne{constructor(){super(...arguments),this.type="svg",this.isSVGTag=!1,this.measureInstanceViewportBox=ho}getBaseTargetFromProps(e,i){return e[i]}readValueFromInstance(e,i){if(vE.has(i)){const o=rF(i);return o&&o.default||0}return i=Rte.has(i)?i:Lj(i),e.getAttribute(i)}scrapeMotionValuesFromProps(e,i,o){return Pte(e,i,o)}build(e,i,o){zj(e,i,this.isSVGTag,o.transformTemplate)}renderInstance(e,i,o,l){Ite(e,i,o,l)}mount(e){this.isSVGTag=Gj(e.tagName),super.mount(e)}}const CNe=(n,e)=>Uj(n)?new TNe(e):new wNe(e,{allowProjection:n!==k.Fragment}),RNe=J1e({...YOe,...mNe,...iNe,...gNe},CNe),wh=h1e(RNe),INe=(n,e)=>n.find(i=>i.id===e);function SX(n,e){const i=jne(n,e),o=i?n[i].findIndex(l=>l.id===e):-1;return{position:i,index:o}}function jne(n,e){for(const[i,o]of Object.entries(n))if(INe(o,e))return i}function ANe(n){const e=n.includes("right"),i=n.includes("left");let o="center";return e&&(o="flex-end"),i&&(o="flex-start"),{display:"flex",flexDirection:"column",alignItems:o}}function PNe(n){const i=n==="top"||n==="bottom"?"0 auto":void 0,o=n.includes("top")?"env(safe-area-inset-top, 0px)":void 0,l=n.includes("bottom")?"env(safe-area-inset-bottom, 0px)":void 0,u=n.includes("left")?void 0:"env(safe-area-inset-right, 0px)",p=n.includes("right")?void 0:"env(safe-area-inset-left, 0px)";return{position:"fixed",zIndex:"var(--toast-z-index, 5500)",pointerEvents:"none",display:"flex",flexDirection:"column",margin:i,top:o,bottom:l,right:u,left:p}}var ONe=/^((children|dangerouslySetInnerHTML|key|ref|autoFocus|defaultValue|defaultChecked|innerHTML|suppressContentEditableWarning|suppressHydrationWarning|valueLink|abbr|accept|acceptCharset|accessKey|action|allow|allowUserMedia|allowPaymentRequest|allowFullScreen|allowTransparency|alt|async|autoComplete|autoPlay|capture|cellPadding|cellSpacing|challenge|charSet|checked|cite|classID|className|cols|colSpan|content|contentEditable|contextMenu|controls|controlsList|coords|crossOrigin|data|dateTime|decoding|default|defer|dir|disabled|disablePictureInPicture|disableRemotePlayback|download|draggable|encType|enterKeyHint|fetchpriority|fetchPriority|form|formAction|formEncType|formMethod|formNoValidate|formTarget|frameBorder|headers|height|hidden|high|href|hrefLang|htmlFor|httpEquiv|id|inputMode|integrity|is|keyParams|keyType|kind|label|lang|list|loading|loop|low|marginHeight|marginWidth|max|maxLength|media|mediaGroup|method|min|minLength|multiple|muted|name|nonce|noValidate|open|optimum|pattern|placeholder|playsInline|popover|popoverTarget|popoverTargetAction|poster|preload|profile|radioGroup|readOnly|referrerPolicy|rel|required|reversed|role|rows|rowSpan|sandbox|scope|scoped|scrolling|seamless|selected|shape|size|sizes|slot|span|spellCheck|src|srcDoc|srcLang|srcSet|start|step|style|summary|tabIndex|target|title|translate|type|useMap|value|width|wmode|wrap|about|datatype|inlist|prefix|property|resource|typeof|vocab|autoCapitalize|autoCorrect|autoSave|color|incremental|fallback|inert|itemProp|itemScope|itemType|itemID|itemRef|on|option|results|security|unselectable|accentHeight|accumulate|additive|alignmentBaseline|allowReorder|alphabetic|amplitude|arabicForm|ascent|attributeName|attributeType|autoReverse|azimuth|baseFrequency|baselineShift|baseProfile|bbox|begin|bias|by|calcMode|capHeight|clip|clipPathUnits|clipPath|clipRule|colorInterpolation|colorInterpolationFilters|colorProfile|colorRendering|contentScriptType|contentStyleType|cursor|cx|cy|d|decelerate|descent|diffuseConstant|direction|display|divisor|dominantBaseline|dur|dx|dy|edgeMode|elevation|enableBackground|end|exponent|externalResourcesRequired|fill|fillOpacity|fillRule|filter|filterRes|filterUnits|floodColor|floodOpacity|focusable|fontFamily|fontSize|fontSizeAdjust|fontStretch|fontStyle|fontVariant|fontWeight|format|from|fr|fx|fy|g1|g2|glyphName|glyphOrientationHorizontal|glyphOrientationVertical|glyphRef|gradientTransform|gradientUnits|hanging|horizAdvX|horizOriginX|ideographic|imageRendering|in|in2|intercept|k|k1|k2|k3|k4|kernelMatrix|kernelUnitLength|kerning|keyPoints|keySplines|keyTimes|lengthAdjust|letterSpacing|lightingColor|limitingConeAngle|local|markerEnd|markerMid|markerStart|markerHeight|markerUnits|markerWidth|mask|maskContentUnits|maskUnits|mathematical|mode|numOctaves|offset|opacity|operator|order|orient|orientation|origin|overflow|overlinePosition|overlineThickness|panose1|paintOrder|pathLength|patternContentUnits|patternTransform|patternUnits|pointerEvents|points|pointsAtX|pointsAtY|pointsAtZ|preserveAlpha|preserveAspectRatio|primitiveUnits|r|radius|refX|refY|renderingIntent|repeatCount|repeatDur|requiredExtensions|requiredFeatures|restart|result|rotate|rx|ry|scale|seed|shapeRendering|slope|spacing|specularConstant|specularExponent|speed|spreadMethod|startOffset|stdDeviation|stemh|stemv|stitchTiles|stopColor|stopOpacity|strikethroughPosition|strikethroughThickness|string|stroke|strokeDasharray|strokeDashoffset|strokeLinecap|strokeLinejoin|strokeMiterlimit|strokeOpacity|strokeWidth|surfaceScale|systemLanguage|tableValues|targetX|targetY|textAnchor|textDecoration|textRendering|textLength|to|transform|u1|u2|underlinePosition|underlineThickness|unicode|unicodeBidi|unicodeRange|unitsPerEm|vAlphabetic|vHanging|vIdeographic|vMathematical|values|vectorEffect|version|vertAdvY|vertOriginX|vertOriginY|viewBox|viewTarget|visibility|widths|wordSpacing|writingMode|x|xHeight|x1|x2|xChannelSelector|xlinkActuate|xlinkArcrole|xlinkHref|xlinkRole|xlinkShow|xlinkTitle|xlinkType|xmlBase|xmlns|xmlnsXlink|xmlLang|xmlSpace|y|y1|y2|yChannelSelector|z|zoomAndPan|for|class|autofocus)|(([Dd][Aa][Tt][Aa]|[Aa][Rr][Ii][Aa]|x)-.*))$/,kNe=tte(function(n){return ONe.test(n)||n.charCodeAt(0)===111&&n.charCodeAt(1)===110&&n.charCodeAt(2)<91}),NNe=kNe,xNe=function(e){return e!=="theme"},bX=function(e){return typeof e=="string"&&e.charCodeAt(0)>96?NNe:xNe},wX=function(e,i,o){var l;if(i){var u=i.shouldForwardProp;l=e.__emotion_forwardProp&&u?function(p){return e.__emotion_forwardProp(p)&&u(p)}:u}return typeof l!="function"&&o&&(l=e.__emotion_forwardProp),l},DNe=function(e){var i=e.cache,o=e.serialized,l=e.isStringTag;return Ej(i,o,l),ote(function(){return vj(i,o,l)}),null},LNe=function n(e,i){var o=e.__emotion_real===e,l=o&&e.__emotion_base||e,u,p;i!==void 0&&(u=i.label,p=i.target);var y=wX(e,i,o),E=y||bX(l),b=!E("as");return function(){var T=arguments,R=o&&e.__emotion_styles!==void 0?e.__emotion_styles.slice(0):[];if(u!==void 0&&R.push("label:"+u+";"),T[0]==null||T[0].raw===void 0)R.push.apply(R,T);else{var O=T[0];R.push(O[0]);for(var L=T.length,D=1;D<L;D++)R.push(T[D],O[D])}var U=bj(function(F,Y,W){var re=b&&F.as||l,le="",ie=[],me=F;if(F.theme==null){me={};for(var q in F)me[q]=F[q];me.theme=k.useContext(US)}typeof F.className=="string"?le=rte(Y.registered,ie,F.className):F.className!=null&&(le=F.className+" ");var J=dN(R.concat(ie),Y.registered,me);le+=Y.key+"-"+J.name,p!==void 0&&(le+=" "+p);var Q=b&&y===void 0?bX(re):E,ne={};for(var he in F)b&&he==="as"||Q(he)&&(ne[he]=F[he]);return ne.className=le,W&&(ne.ref=W),k.createElement(k.Fragment,null,k.createElement(DNe,{cache:Y,serialized:J,isStringTag:typeof re=="string"}),k.createElement(re,ne))});return U.displayName=u!==void 0?u:"Styled("+(typeof l=="string"?l:l.displayName||l.name||"Component")+")",U.defaultProps=e.defaultProps,U.__emotion_real=U,U.__emotion_base=l,U.__emotion_styles=R,U.__emotion_forwardProp=y,Object.defineProperty(U,"toString",{value:function(){return"."+p}}),U.withComponent=function(F,Y){var W=n(F,iE({},i,Y,{shouldForwardProp:wX(U,Y,!0)}));return W.apply(void 0,R)},U}},MNe=["a","abbr","address","area","article","aside","audio","b","base","bdi","bdo","big","blockquote","body","br","button","canvas","caption","cite","code","col","colgroup","data","datalist","dd","del","details","dfn","dialog","div","dl","dt","em","embed","fieldset","figcaption","figure","footer","form","h1","h2","h3","h4","h5","h6","head","header","hgroup","hr","html","i","iframe","img","input","ins","kbd","keygen","label","legend","li","link","main","map","mark","marquee","menu","menuitem","meta","meter","nav","noscript","object","ol","optgroup","option","output","p","param","picture","pre","progress","q","rp","rt","ruby","s","samp","script","section","select","small","source","span","strong","style","sub","summary","sup","table","tbody","td","textarea","tfoot","th","thead","time","title","tr","track","u","ul","var","video","wbr","circle","clipPath","defs","ellipse","foreignObject","g","image","line","linearGradient","mask","path","pattern","polygon","polyline","radialGradient","rect","stop","svg","text","tspan"],r5=LNe.bind(null);MNe.forEach(function(n){r5[n]=r5(n)});const UNe=new Set([...rSe,"textStyle","layerStyle","apply","noOfLines","focusBorderColor","errorBorderColor","as","__css","css","sx"]),VNe=new Set(["htmlWidth","htmlHeight","htmlSize","htmlTranslate"]);function jNe(n){return(VNe.has(n)||!UNe.has(n))&&n[0]!=="_"}const FNe=kve(r5),BNe=({baseStyle:n})=>e=>{const{theme:i,css:o,__css:l,sx:u,...p}=e,[y]=Vve(p,sSe),E=Cl(n,e),b=_ve({},l,E,oj(y),u),T=Dee(b)(e.theme);return o?[T,o]:T};function BU(n,e){const{baseStyle:i,...o}=e??{};o.shouldForwardProp||(o.shouldForwardProp=jNe);const l=BNe({baseStyle:i}),u=FNe(n,o)(l);return k.forwardRef(function(E,b){const{children:T,...R}=E,{colorMode:O,forced:L}=pN(),D=L?O:void 0;return k.createElement(u,{ref:b,"data-theme":D,...R},T)})}function zNe(){const n=new Map;return new Proxy(BU,{apply(e,i,o){return BU(...o)},get(e,i){return n.has(i)||n.set(i,BU(i)),n.get(i)}})}const Lt=zNe(),WNe={initial:n=>{const{position:e}=n,i=["top","bottom"].includes(e)?"y":"x";let o=["top-right","bottom-right"].includes(e)?1:-1;return e==="bottom"&&(o=1),{opacity:0,[i]:o*24}},animate:{opacity:1,y:0,x:0,scale:1,transition:{duration:.4,ease:[.4,0,.2,1]}},exit:{opacity:0,scale:.85,transition:{duration:.2,ease:[.4,0,1,1]}}},Fne=k.memo(n=>{const{id:e,message:i,onCloseComplete:o,onRequestRemove:l,requestClose:u=!1,position:p="bottom",duration:y=5e3,containerStyle:E,motionVariants:b=WNe,toastSpacing:T="0.5rem"}=n,[R,O]=k.useState(y),L=r1e();Xf(()=>{L||o==null||o()},[L]),Xf(()=>{O(y)},[y]);const D=()=>O(null),U=()=>O(y),F=()=>{L&&l()};k.useEffect(()=>{L&&u&&l()},[L,u,l]),a0e(F,R);const Y=k.useMemo(()=>({pointerEvents:"auto",maxWidth:560,minWidth:300,margin:T,...E}),[E,T]),W=k.useMemo(()=>ANe(p),[p]);return S.jsx(wh.div,{layout:!0,className:"chakra-toast",variants:b,initial:"initial",animate:"animate",exit:"exit",onHoverStart:D,onHoverEnd:U,custom:{position:p},style:W,children:S.jsx(Lt.div,{role:"status","aria-atomic":"true",className:"chakra-toast__inner",__css:Y,children:Cl(i,{id:e,onClose:F})})})});Fne.displayName="ToastComponent";function jt(n){return k.forwardRef(n)}var zU,TX;function GNe(){if(TX)return zU;TX=1;var n=typeof Element<"u",e=typeof Map=="function",i=typeof Set=="function",o=typeof ArrayBuffer=="function"&&!!ArrayBuffer.isView;function l(u,p){if(u===p)return!0;if(u&&p&&typeof u=="object"&&typeof p=="object"){if(u.constructor!==p.constructor)return!1;var y,E,b;if(Array.isArray(u)){if(y=u.length,y!=p.length)return!1;for(E=y;E--!==0;)if(!l(u[E],p[E]))return!1;return!0}var T;if(e&&u instanceof Map&&p instanceof Map){if(u.size!==p.size)return!1;for(T=u.entries();!(E=T.next()).done;)if(!p.has(E.value[0]))return!1;for(T=u.entries();!(E=T.next()).done;)if(!l(E.value[1],p.get(E.value[0])))return!1;return!0}if(i&&u instanceof Set&&p instanceof Set){if(u.size!==p.size)return!1;for(T=u.entries();!(E=T.next()).done;)if(!p.has(E.value[0]))return!1;return!0}if(o&&ArrayBuffer.isView(u)&&ArrayBuffer.isView(p)){if(y=u.length,y!=p.length)return!1;for(E=y;E--!==0;)if(u[E]!==p[E])return!1;return!0}if(u.constructor===RegExp)return u.source===p.source&&u.flags===p.flags;if(u.valueOf!==Object.prototype.valueOf&&typeof u.valueOf=="function"&&typeof p.valueOf=="function")return u.valueOf()===p.valueOf();if(u.toString!==Object.prototype.toString&&typeof u.toString=="function"&&typeof p.toString=="function")return u.toString()===p.toString();if(b=Object.keys(u),y=b.length,y!==Object.keys(p).length)return!1;for(E=y;E--!==0;)if(!Object.prototype.hasOwnProperty.call(p,b[E]))return!1;if(n&&u instanceof Element)return!1;for(E=y;E--!==0;)if(!((b[E]==="_owner"||b[E]==="__v"||b[E]==="__o")&&u.$$typeof)&&!l(u[b[E]],p[b[E]]))return!1;return!0}return u!==u&&p!==p}return zU=function(p,y){try{return l(p,y)}catch(E){if((E.message||"").match(/stack|recursion/i))return console.warn("react-fast-compare cannot handle circular refs"),!1;throw E}},zU}var HNe=GNe();const $Ne=Jg(HNe);function lb(){const n=k.useContext(US);if(!n)throw Error("useTheme: `theme` is undefined. Seems you forgot to wrap your app in `<ChakraProvider />` or `<ThemeProvider />`");return n}function Bne(){const n=pN(),e=lb();return{...n,theme:e}}function KNe(n,e,i){if(e==null)return e;const o=l=>{var u,p;return(p=(u=n.__cssMap)==null?void 0:u[l])==null?void 0:p.value};return o(e)??o(i)??i}function qNe(n,e,i){const o=Array.isArray(e)?e:[e],l=Array.isArray(i)?i:[i];return u=>{const p=l.filter(Boolean),y=o.map((E,b)=>{const T=`${n}.${E}`;return KNe(u,T,p[b]??E)});return Array.isArray(e)?y:y[0]}}function YNe(n){return Object.fromEntries(Object.entries(n).filter(([e,i])=>i!==void 0&&e!=="children"&&!k.isValidElement(i)))}function zne(n,e={}){const{styleConfig:i,...o}=e,{theme:l,colorMode:u}=Bne(),p=n?gee(l,`components.${n}`):void 0,y=i||p,E=Op({theme:l,colorMode:u},(y==null?void 0:y.defaultProps)??{},YNe(o),(T,R)=>T?void 0:R),b=k.useRef({});if(y){const R=gSe(y)(E);$Ne(b.current,R)||(b.current=R)}return b.current}function Su(n,e={}){return zne(n,e)}function za(n,e={}){return zne(n,e)}const CX={path:S.jsxs("g",{stroke:"currentColor",strokeWidth:"1.5",children:[S.jsx("path",{strokeLinecap:"round",fill:"none",d:"M9,9a3,3,0,1,1,4,2.829,1.5,1.5,0,0,0-1,1.415V14.25"}),S.jsx("path",{fill:"currentColor",strokeLinecap:"round",d:"M12,17.25a.375.375,0,1,0,.375.375A.375.375,0,0,0,12,17.25h0"}),S.jsx("circle",{fill:"none",strokeMiterlimit:"10",cx:"12",cy:"12",r:"11.25"})]}),viewBox:"0 0 24 24"},en=jt((n,e)=>{const{as:i,viewBox:o,color:l="currentColor",focusable:u=!1,children:p,className:y,__css:E,...b}=n,T=Sn("chakra-icon",y),R=Su("Icon",n),O={w:"1em",h:"1em",display:"inline-block",lineHeight:"1em",flexShrink:0,color:l,...E,...R},L={ref:e,focusable:u,className:T,__css:O},D=o??CX.viewBox;if(i&&typeof i!="string")return S.jsx(Lt.svg,{as:i,...L,...b});const U=p??CX.path;return S.jsx(Lt.svg,{verticalAlign:"middle",viewBox:D,...L,...b,children:U})});en.displayName="Icon";function XNe(n){return S.jsx(en,{viewBox:"0 0 24 24",...n,children:S.jsx("path",{fill:"currentColor",d:"M12,0A12,12,0,1,0,24,12,12.014,12.014,0,0,0,12,0Zm6.927,8.2-6.845,9.289a1.011,1.011,0,0,1-1.43.188L5.764,13.769a1,1,0,1,1,1.25-1.562l4.076,3.261,6.227-8.451A1,1,0,1,1,18.927,8.2Z"})})}function JNe(n){return S.jsx(en,{viewBox:"0 0 24 24",...n,children:S.jsx("path",{fill:"currentColor",d:"M12,0A12,12,0,1,0,24,12,12.013,12.013,0,0,0,12,0Zm.25,5a1.5,1.5,0,1,1-1.5,1.5A1.5,1.5,0,0,1,12.25,5ZM14.5,18.5h-4a1,1,0,0,1,0-2h.75a.25.25,0,0,0,.25-.25v-4.5a.25.25,0,0,0-.25-.25H10.5a1,1,0,0,1,0-2h1a2,2,0,0,1,2,2v4.75a.25.25,0,0,0,.25.25h.75a1,1,0,1,1,0,2Z"})})}function RX(n){return S.jsx(en,{viewBox:"0 0 24 24",...n,children:S.jsx("path",{fill:"currentColor",d:"M11.983,0a12.206,12.206,0,0,0-8.51,3.653A11.8,11.8,0,0,0,0,12.207,11.779,11.779,0,0,0,11.8,24h.214A12.111,12.111,0,0,0,24,11.791h0A11.766,11.766,0,0,0,11.983,0ZM10.5,16.542a1.476,1.476,0,0,1,1.449-1.53h.027a1.527,1.527,0,0,1,1.523,1.47,1.475,1.475,0,0,1-1.449,1.53h-.027A1.529,1.529,0,0,1,10.5,16.542ZM11,12.5v-6a1,1,0,0,1,2,0v6a1,1,0,1,1-2,0Z"})})}const QNe=BR({"0%":{transform:"rotate(0deg)"},"100%":{transform:"rotate(360deg)"}}),vd=jt((n,e)=>{const i=Su("Spinner",n),{label:o="Loading...",thickness:l="2px",speed:u="0.45s",emptyColor:p="transparent",className:y,...E}=Bi(n),b=Sn("chakra-spinner",y),T={display:"inline-block",borderColor:"currentColor",borderStyle:"solid",borderRadius:"99999px",borderWidth:l,borderBottomColor:p,borderLeftColor:p,animation:`${QNe} ${u} linear infinite`,...i};return S.jsx(Lt.div,{ref:e,__css:T,className:b,...E,children:o&&S.jsx(Lt.span,{srOnly:!0,children:o})})});vd.displayName="Spinner";const[ZNe,cF]=xi({name:"AlertContext",hookName:"useAlertContext",providerName:"<Alert />"}),[exe,lF]=xi({name:"AlertStylesContext",hookName:"useAlertStyles",providerName:"<Alert />"}),Wne={info:{icon:JNe,colorScheme:"blue"},warning:{icon:RX,colorScheme:"orange"},success:{icon:XNe,colorScheme:"green"},error:{icon:RX,colorScheme:"red"},loading:{icon:vd,colorScheme:"blue"}};function txe(n){return Wne[n].colorScheme}function nxe(n){return Wne[n].icon}const sE=jt(function(e,i){const{status:o="info",addRole:l=!0,...u}=Bi(e),p=e.colorScheme??txe(o),y=za("Alert",{...e,colorScheme:p}),E={width:"100%",display:"flex",alignItems:"center",position:"relative",overflow:"hidden",...y.container};return S.jsx(ZNe,{value:{status:o},children:S.jsx(exe,{value:y,children:S.jsx(Lt.div,{"data-status":o,role:l?"alert":void 0,ref:i,...u,className:Sn("chakra-alert",e.className),__css:E})})})});sE.displayName="Alert";function oE(n){const{status:e}=cF(),i=nxe(e),o=lF(),l=e==="loading"?o.spinner:o.icon;return S.jsx(Lt.span,{display:"inherit","data-status":e,...n,className:Sn("chakra-alert__icon",n.className),__css:l,children:n.children||S.jsx(i,{h:"100%",w:"100%"})})}oE.displayName="AlertIcon";const vk=jt(function(e,i){const o=lF(),{status:l}=cF();return S.jsx(Lt.div,{ref:i,"data-status":l,...e,className:Sn("chakra-alert__title",e.className),__css:o.title})});vk.displayName="AlertTitle";const Sk=jt(function(e,i){const{status:o}=cF(),l=lF(),u={display:"inline",...l.description};return S.jsx(Lt.div,{ref:i,"data-status":o,...e,className:Sn("chakra-alert__desc",e.className),__css:u})});Sk.displayName="AlertDescription";function rxe(n){return S.jsx(en,{focusable:"false","aria-hidden":!0,...n,children:S.jsx("path",{fill:"currentColor",d:"M.439,21.44a1.5,1.5,0,0,0,2.122,2.121L11.823,14.3a.25.25,0,0,1,.354,0l9.262,9.263a1.5,1.5,0,1,0,2.122-2.121L14.3,12.177a.25.25,0,0,1,0-.354l9.263-9.262A1.5,1.5,0,0,0,21.439.44L12.177,9.7a.25.25,0,0,1-.354,0L2.561.44A1.5,1.5,0,0,0,.439,2.561L9.7,11.823a.25.25,0,0,1,0,.354Z"})})}const uF=jt(function(e,i){const o=Su("CloseButton",e),{children:l,isDisabled:u,__css:p,...y}=Bi(e),E={outline:0,display:"flex",alignItems:"center",justifyContent:"center",flexShrink:0};return S.jsx(Lt.button,{type:"button","aria-label":"Close",ref:i,disabled:u,__css:{...E,...o,...p},...y,children:l||S.jsx(rxe,{width:"1em",height:"1em"})})});uF.displayName="CloseButton";const ixe=n=>{const{status:e,variant:i="solid",id:o,title:l,isClosable:u,onClose:p,description:y,colorScheme:E,icon:b}=n,T=o?{root:`toast-${o}`,title:`toast-${o}-title`,description:`toast-${o}-description`}:void 0;return S.jsxs(sE,{addRole:!1,status:e,variant:i,id:T==null?void 0:T.root,alignItems:"start",borderRadius:"md",boxShadow:"lg",paddingEnd:8,textAlign:"start",width:"auto",colorScheme:E,children:[S.jsx(oE,{children:b}),S.jsxs(Lt.div,{flex:"1",maxWidth:"100%",children:[l&&S.jsx(vk,{id:T==null?void 0:T.title,children:l}),y&&S.jsx(Sk,{id:T==null?void 0:T.description,display:"block",children:y})]}),u&&S.jsx(uF,{size:"sm",onClick:p,position:"absolute",insetEnd:1,top:1})]})};function Gne(n={}){const{render:e,toastComponent:i=ixe}=n;return l=>typeof e=="function"?e({...l,...n}):S.jsx(i,{...l,...n})}const sxe={top:[],"top-left":[],"top-right":[],"bottom-left":[],bottom:[],"bottom-right":[]},Ap=oxe(sxe);function oxe(n){let e=n;const i=new Set,o=l=>{e=l(e),i.forEach(u=>u())};return{getState:()=>e,subscribe:l=>(i.add(l),()=>{o(()=>n),i.delete(l)}),removeToast:(l,u)=>{o(p=>({...p,[u]:p[u].filter(y=>y.id!=l)}))},notify:(l,u)=>{const p=axe(l,u),{position:y,id:E}=p;return o(b=>{const R=y.includes("top")?[p,...b[y]??[]]:[...b[y]??[],p];return{...b,[y]:R}}),E},update:(l,u)=>{l&&o(p=>{const y={...p},{position:E,index:b}=SX(y,l);return E&&b!==-1&&(y[E][b]={...y[E][b],...u,message:Gne(u)}),y})},closeAll:({positions:l}={})=>{o(u=>(l??["bottom","bottom-right","bottom-left","top","top-left","top-right"]).reduce((E,b)=>(E[b]=u[b].map(T=>({...T,requestClose:!0})),E),{...u}))},close:l=>{o(u=>{const p=jne(u,l);return p?{...u,[p]:u[p].map(y=>y.id==l?{...y,requestClose:!0}:y)}:u})},isActive:l=>!!SX(Ap.getState(),l).position}}let IX=0;function axe(n,e={}){IX+=1;const i=e.id??IX,o=e.position??"bottom";return{id:i,message:n,position:o,duration:e.duration,onCloseComplete:e.onCloseComplete,onRequestRemove:()=>Ap.removeToast(String(i),o),status:e.status,requestClose:!1,containerStyle:e.containerStyle}}var Hne=aee();const[$ne,cxe]=xi({strict:!1,name:"PortalContext"}),dF="chakra-portal",lxe=".chakra-portal",uxe=n=>S.jsx("div",{className:"chakra-portal-zIndex",style:{position:"absolute",zIndex:n.zIndex,top:0,left:0,right:0},children:n.children}),dxe=n=>{const{appendToParentPortal:e,children:i}=n,[o,l]=k.useState(null),u=k.useRef(null),[,p]=k.useState({});k.useEffect(()=>p({}),[]);const y=cxe(),E=XAe();xp(()=>{if(!o)return;const T=o.ownerDocument,R=e?y??T.body:T.body;if(!R)return;u.current=T.createElement("div"),u.current.className=dF,R.appendChild(u.current),p({});const O=u.current;return()=>{R.contains(O)&&R.removeChild(O)}},[o]);const b=E!=null&&E.zIndex?S.jsx(uxe,{zIndex:E==null?void 0:E.zIndex,children:i}):i;return u.current?Hne.createPortal(S.jsx($ne,{value:u.current,children:b}),u.current):S.jsx("span",{ref:T=>{T&&l(T)}})},hxe=n=>{const{children:e,containerRef:i,appendToParentPortal:o}=n,l=i.current,u=l??(typeof window<"u"?document.body:void 0),p=k.useMemo(()=>{const E=l==null?void 0:l.ownerDocument.createElement("div");return E&&(E.className=dF),E},[l]),[,y]=k.useState({});return xp(()=>y({}),[]),xp(()=>{if(!(!p||!u))return u.appendChild(p),()=>{u.removeChild(p)}},[p,u]),u&&p?Hne.createPortal(S.jsx($ne,{value:o?p:null,children:e}),p):null};function Bc(n){const e={appendToParentPortal:!0,...n},{containerRef:i,...o}=e;return i?S.jsx(hxe,{containerRef:i,...o}):S.jsx(dxe,{...o})}Bc.className=dF;Bc.selector=lxe;Bc.displayName="Portal";const[pxe,fxe]=xi({name:"ToastOptionsContext",strict:!1}),mxe=n=>{const e=k.useSyncExternalStore(Ap.subscribe,Ap.getState,Ap.getState),{motionVariants:i,component:o=Fne,portalProps:l,animatePresenceProps:u}=n,y=Object.keys(e).map(E=>{const b=e[E];return S.jsx("div",{role:"region","aria-live":"polite","aria-label":`Notifications-${E}`,id:`chakra-toast-manager-${E}`,style:PNe(E),children:S.jsx(EE,{...u,initial:!1,children:b.map(T=>S.jsx(o,{motionVariants:i,...T},T.id))})},E)});return S.jsx(Bc,{...l,children:y})},gxe=n=>function({children:i,theme:o=n,toastOptions:l,...u}){return S.jsxs(QAe,{theme:o,...u,children:[S.jsx(pxe,{value:l==null?void 0:l.defaultOptions,children:i}),S.jsx(mxe,{...l})]})},_xe=gxe(zIe);function AX(n){return n.sort((e,i)=>{const o=e.compareDocumentPosition(i);if(o&Node.DOCUMENT_POSITION_FOLLOWING||o&Node.DOCUMENT_POSITION_CONTAINED_BY)return-1;if(o&Node.DOCUMENT_POSITION_PRECEDING||o&Node.DOCUMENT_POSITION_CONTAINS)return 1;if(o&Node.DOCUMENT_POSITION_DISCONNECTED||o&Node.DOCUMENT_POSITION_IMPLEMENTATION_SPECIFIC)throw Error("Cannot sort the given nodes.");return 0})}const yxe=n=>typeof n=="object"&&"nodeType"in n&&n.nodeType===Node.ELEMENT_NODE;function PX(n,e,i){let o=n+1;return i&&o>=e&&(o=0),o}function OX(n,e,i){let o=n-1;return i&&o<0&&(o=e),o}const WU=typeof window<"u"?k.useLayoutEffect:k.useEffect,kX=n=>n;var Exe=Object.defineProperty,vxe=(n,e,i)=>e in n?Exe(n,e,{enumerable:!0,configurable:!0,writable:!0,value:i}):n[e]=i,Hs=(n,e,i)=>(vxe(n,typeof e!="symbol"?e+"":e,i),i);class Sxe{constructor(){Hs(this,"descendants",new Map),Hs(this,"register",e=>{if(e!=null)return yxe(e)?this.registerNode(e):i=>{this.registerNode(i,e)}}),Hs(this,"unregister",e=>{this.descendants.delete(e);const i=AX(Array.from(this.descendants.keys()));this.assignIndex(i)}),Hs(this,"destroy",()=>{this.descendants.clear()}),Hs(this,"assignIndex",e=>{this.descendants.forEach(i=>{const o=e.indexOf(i.node);i.index=o,i.node.dataset.index=i.index.toString()})}),Hs(this,"count",()=>this.descendants.size),Hs(this,"enabledCount",()=>this.enabledValues().length),Hs(this,"values",()=>Array.from(this.descendants.values()).sort((i,o)=>i.index-o.index)),Hs(this,"enabledValues",()=>this.values().filter(e=>!e.disabled)),Hs(this,"item",e=>{if(this.count()!==0)return this.values()[e]}),Hs(this,"enabledItem",e=>{if(this.enabledCount()!==0)return this.enabledValues()[e]}),Hs(this,"first",()=>this.item(0)),Hs(this,"firstEnabled",()=>this.enabledItem(0)),Hs(this,"last",()=>this.item(this.descendants.size-1)),Hs(this,"lastEnabled",()=>{const e=this.enabledValues().length-1;return this.enabledItem(e)}),Hs(this,"indexOf",e=>{var i;return e?((i=this.descendants.get(e))==null?void 0:i.index)??-1:-1}),Hs(this,"enabledIndexOf",e=>e==null?-1:this.enabledValues().findIndex(i=>i.node.isSameNode(e))),Hs(this,"next",(e,i=!0)=>{const o=PX(e,this.count(),i);return this.item(o)}),Hs(this,"nextEnabled",(e,i=!0)=>{const o=this.item(e);if(!o)return;const l=this.enabledIndexOf(o.node),u=PX(l,this.enabledCount(),i);return this.enabledItem(u)}),Hs(this,"prev",(e,i=!0)=>{const o=OX(e,this.count()-1,i);return this.item(o)}),Hs(this,"prevEnabled",(e,i=!0)=>{const o=this.item(e);if(!o)return;const l=this.enabledIndexOf(o.node),u=OX(l,this.enabledCount()-1,i);return this.enabledItem(u)}),Hs(this,"registerNode",(e,i)=>{if(!e||this.descendants.has(e))return;const o=Array.from(this.descendants.keys()).concat(e),l=AX(o);i!=null&&i.disabled&&(i.disabled=!!i.disabled);const u={node:e,index:-1,...i};this.descendants.set(e,u),this.assignIndex(l)})}}function Kne(){const[n,e]=xi({name:"DescendantsProvider",errorMessage:"useDescendantsContext must be used within DescendantsProvider"});return[n,e,()=>{const l=k.useRef(new Sxe);return WU(()=>()=>l.current.destroy()),l.current},l=>{const u=e(),[p,y]=k.useState(-1),E=k.useRef(null);WU(()=>()=>{E.current&&u.unregister(E.current)},[]),WU(()=>{if(!E.current)return;const T=Number(E.current.dataset.index);p!=T&&!Number.isNaN(T)&&y(T)});const b=kX(l?u.register(l):u.register);return{descendants:u,index:p,enabledIndex:u.enabledIndexOf(E.current),register:Yi(b,E)}}]}const dS={ease:[.25,.1,.25,1],easeIn:[.4,0,1,1],easeOut:[0,0,.2,1]},Yy={enter:{duration:.2,ease:dS.easeOut},exit:{duration:.1,ease:dS.easeIn}},Hf={enter:(n,e)=>({...n,delay:typeof e=="number"?e:e==null?void 0:e.enter}),exit:(n,e)=>({...n,delay:typeof e=="number"?e:e==null?void 0:e.exit})},bxe=n=>n!=null&&parseInt(n.toString(),10)>0,NX={exit:{height:{duration:.2,ease:dS.ease},opacity:{duration:.3,ease:dS.ease}},enter:{height:{duration:.3,ease:dS.ease},opacity:{duration:.4,ease:dS.ease}}},wxe={exit:({animateOpacity:n,startingHeight:e,transition:i,transitionEnd:o,delay:l})=>({...n&&{opacity:bxe(e)?1:0},height:e,transitionEnd:o==null?void 0:o.exit,transition:(i==null?void 0:i.exit)??Hf.exit(NX.exit,l)}),enter:({animateOpacity:n,endingHeight:e,transition:i,transitionEnd:o,delay:l})=>({...n&&{opacity:1},height:e,transitionEnd:o==null?void 0:o.enter,transition:(i==null?void 0:i.enter)??Hf.enter(NX.enter,l)})},qne=k.forwardRef((n,e)=>{const{in:i,unmountOnExit:o,animateOpacity:l=!0,startingHeight:u=0,endingHeight:p="auto",style:y,className:E,transition:b,transitionEnd:T,animatePresenceProps:R,...O}=n,[L,D]=k.useState(!1);k.useEffect(()=>{const re=setTimeout(()=>{D(!0)});return()=>clearTimeout(re)},[]);const U=parseFloat(u.toString())>0,F={startingHeight:u,endingHeight:p,animateOpacity:l,transition:L?b:{enter:{duration:0}},transitionEnd:{enter:T==null?void 0:T.enter,exit:o?T==null?void 0:T.exit:{...T==null?void 0:T.exit,display:U?"block":"none"}}},Y=o?i:!0,W=i||o?"enter":"exit";return S.jsx(EE,{...R,initial:!1,custom:F,children:Y&&S.jsx(wh.div,{ref:e,...O,className:Sn("chakra-collapse",E),style:{overflow:"hidden",display:"block",...y},custom:F,variants:wxe,initial:o?"exit":!1,animate:W,exit:"exit"})})});qne.displayName="Collapse";const Yne=jt(function(n,e){const{ratio:i=4/3,children:o,className:l,...u}=n,p=k.Children.only(o),y=Sn("chakra-aspect-ratio",l);return S.jsx(Lt.div,{ref:e,position:"relative",className:y,_before:{height:0,content:'""',display:"block",paddingBottom:rN(i,E=>`${1/E*100}%`)},__css:{"& > *:not(style)":{overflow:"hidden",position:"absolute",top:"0",right:"0",bottom:"0",left:"0",display:"flex",justifyContent:"center",alignItems:"center",width:"100%",height:"100%"},"& > img, & > video":{objectFit:"cover"}},...u,children:p})});Yne.displayName="AspectRatio";const[Txe,Cxe]=xi({name:"AvatarStylesContext",hookName:"useAvatarStyles",providerName:"<Avatar/>"});function Rxe(n){const e=n.trim().split(" "),i=e[0]??"",o=e.length>1?e[e.length-1]:"";return i&&o?`${i.charAt(0)}${o.charAt(0)}`:i.charAt(0)}function Xne(n){const{name:e,getInitials:i,...o}=n,l=Cxe();return S.jsx(Lt.div,{role:"img","aria-label":e,...o,__css:l.label,children:e?i==null?void 0:i(e):null})}Xne.displayName="AvatarName";const Jne=n=>S.jsxs(Lt.svg,{viewBox:"0 0 128 128",color:"#fff",width:"100%",height:"100%",className:"chakra-avatar__svg",...n,children:[S.jsx("path",{fill:"currentColor",d:"M103,102.1388 C93.094,111.92 79.3504,118 64.1638,118 C48.8056,118 34.9294,111.768 25,101.7892 L25,95.2 C25,86.8096 31.981,80 40.6,80 L87.4,80 C96.019,80 103,86.8096 103,95.2 L103,102.1388 Z"}),S.jsx("path",{fill:"currentColor",d:"M63.9961647,24 C51.2938136,24 41,34.2938136 41,46.9961647 C41,59.7061864 51.2938136,70 63.9961647,70 C76.6985159,70 87,59.7061864 87,46.9961647 C87,34.2938136 76.6985159,24 63.9961647,24"})]});function Qne(n){const{loading:e,src:i,srcSet:o,onLoad:l,onError:u,crossOrigin:p,sizes:y,ignoreFallback:E}=n,[b,T]=k.useState("pending");k.useEffect(()=>{T(i?"loading":"pending")},[i]);const R=k.useRef(null),O=k.useCallback(()=>{if(!i)return;L();const D=new Image;D.src=i,p&&(D.crossOrigin=p),o&&(D.srcset=o),y&&(D.sizes=y),e&&(D.loading=e),D.onload=U=>{L(),T("loaded"),l==null||l(U)},D.onerror=U=>{L(),T("failed"),u==null||u(U)},R.current=D},[i,p,o,y,l,u,e]),L=()=>{R.current&&(R.current.onload=null,R.current.onerror=null,R.current=null)};return xp(()=>{if(!E)return b==="loading"&&O(),()=>{L()}},[b,O,E]),E?"loaded":b}const Ixe=(n,e)=>n!=="loaded"&&e==="beforeLoadOrError"||n==="failed"&&e==="onError";function Zne(n){const{src:e,srcSet:i,onError:o,onLoad:l,getInitials:u,name:p,borderRadius:y,loading:E,iconLabel:b,icon:T=S.jsx(Jne,{}),ignoreFallback:R,referrerPolicy:O,crossOrigin:L}=n,U=Qne({src:e,onError:o,crossOrigin:L,ignoreFallback:R})==="loaded";return!e||!U?p?S.jsx(Xne,{className:"chakra-avatar__initials",getInitials:u,name:p}):k.cloneElement(T,{role:"img","aria-label":b}):S.jsx(Lt.img,{src:e,srcSet:i,alt:p??b,onLoad:l,referrerPolicy:O,crossOrigin:L??void 0,className:"chakra-avatar__img",loading:E,__css:{width:"100%",height:"100%",objectFit:"cover",borderRadius:y}})}Zne.displayName="AvatarImage";const Axe={display:"inline-flex",alignItems:"center",justifyContent:"center",textAlign:"center",textTransform:"uppercase",fontWeight:"medium",position:"relative",flexShrink:0},jc=jt((n,e)=>{const i=za("Avatar",n),[o,l]=k.useState(!1),{src:u,srcSet:p,name:y,showBorder:E,borderRadius:b="full",onError:T,onLoad:R,getInitials:O=Rxe,icon:L=S.jsx(Jne,{}),iconLabel:D=" avatar",loading:U,children:F,borderColor:Y,ignoreFallback:W,crossOrigin:re,referrerPolicy:le,...ie}=Bi(n),me={borderRadius:b,borderWidth:E?"2px":void 0,...Axe,...i.container};return Y&&(me.borderColor=Y),S.jsx(Lt.span,{ref:e,...ie,className:Sn("chakra-avatar",n.className),"data-loaded":pr(o),__css:me,children:S.jsxs(Txe,{value:i,children:[S.jsx(Zne,{src:u,srcSet:p,loading:U,onLoad:jn(R,()=>{l(!0)}),onError:T,getInitials:O,name:y,borderRadius:b,icon:L,iconLabel:D,ignoreFallback:W,crossOrigin:re,referrerPolicy:le}),F]})})});jc.displayName="Avatar";const Mc=jt(function(e,i){const o=Su("Badge",e),{className:l,...u}=Bi(e);return S.jsx(Lt.span,{ref:i,className:Sn("chakra-badge",e.className),...u,__css:{display:"inline-block",whiteSpace:"nowrap",verticalAlign:"middle",...o}})});Mc.displayName="Badge";const He=Lt("div");He.displayName="Box";const[hHe,Pxe]=xi({strict:!1,name:"ButtonGroupContext"});function RC(n){const{children:e,className:i,...o}=n,l=k.isValidElement(e)?k.cloneElement(e,{"aria-hidden":!0,focusable:!1}):e,u=Sn("chakra-button__icon",i);return S.jsx(Lt.span,{display:"inline-flex",alignSelf:"center",flexShrink:0,...o,className:u,children:l})}RC.displayName="ButtonIcon";function i5(n){const{label:e,placement:i,spacing:o="0.5rem",children:l=S.jsx(vd,{color:"currentColor",width:"1em",height:"1em"}),className:u,__css:p,...y}=n,E=Sn("chakra-button__spinner",u),b=i==="start"?"marginEnd":"marginStart",T=k.useMemo(()=>({display:"flex",alignItems:"center",position:e?"relative":"absolute",[b]:e?o:0,fontSize:"1em",lineHeight:"normal",...p}),[p,e,b,o]);return S.jsx(Lt.div,{className:E,...y,__css:T,children:l})}i5.displayName="ButtonSpinner";function Oxe(n){const[e,i]=k.useState(!n);return{ref:k.useCallback(u=>{u&&i(u.tagName==="BUTTON")},[]),type:e?"button":void 0}}const On=jt((n,e)=>{const i=Pxe(),o=Su("Button",{...i,...n}),{isDisabled:l=i==null?void 0:i.isDisabled,isLoading:u,isActive:p,children:y,leftIcon:E,rightIcon:b,loadingText:T,iconSpacing:R="0.5rem",type:O,spinner:L,spinnerPlacement:D="start",className:U,as:F,shouldWrapChildren:Y,...W}=Bi(n),re=k.useMemo(()=>{const q={...o==null?void 0:o._focus,zIndex:1};return{display:"inline-flex",appearance:"none",alignItems:"center",justifyContent:"center",userSelect:"none",position:"relative",whiteSpace:"nowrap",verticalAlign:"middle",outline:"none",...o,...!!i&&{_focus:q}}},[o,i]),{ref:le,type:ie}=Oxe(F),me={rightIcon:b,leftIcon:E,iconSpacing:R,children:y,shouldWrapChildren:Y};return S.jsxs(Lt.button,{disabled:l||u,ref:o0e(e,le),as:F,type:O??ie,"data-active":pr(p),"data-loading":pr(u),__css:re,className:Sn("chakra-button",U),...W,children:[u&&D==="start"&&S.jsx(i5,{className:"chakra-button__spinner--start",label:T,placement:"start",spacing:R,children:L}),u?T||S.jsx(Lt.span,{opacity:0,children:S.jsx(xX,{...me})}):S.jsx(xX,{...me}),u&&D==="end"&&S.jsx(i5,{className:"chakra-button__spinner--end",label:T,placement:"end",spacing:R,children:L})]})});On.displayName="Button";function xX(n){const{leftIcon:e,rightIcon:i,children:o,iconSpacing:l,shouldWrapChildren:u}=n;return u?S.jsxs("span",{style:{display:"contents"},children:[e&&S.jsx(RC,{marginEnd:l,children:e}),o,i&&S.jsx(RC,{marginStart:l,children:i})]}):S.jsxs(S.Fragment,{children:[e&&S.jsx(RC,{marginEnd:l,children:e}),o,i&&S.jsx(RC,{marginStart:l,children:i})]})}const va=jt((n,e)=>{const{icon:i,children:o,isRound:l,"aria-label":u,...p}=n,y=i||o,E=k.isValidElement(y)?k.cloneElement(y,{"aria-hidden":!0,focusable:!1}):null;return S.jsx(On,{px:"0",py:"0",borderRadius:l?"full":void 0,ref:e,"aria-label":u,...p,children:E})});va.displayName="IconButton";const ere=Lt("div",{baseStyle:{display:"flex",alignItems:"center",justifyContent:"center"}});ere.displayName="Center";const kxe={horizontal:{insetStart:"50%",transform:"translateX(-50%)"},vertical:{top:"50%",transform:"translateY(-50%)"},both:{insetStart:"50%",top:"50%",transform:"translate(-50%, -50%)"}};jt(function(e,i){const{axis:o="both",...l}=e;return S.jsx(Lt.div,{ref:i,__css:kxe[o],...l,position:"absolute"})});var Nxe=()=>typeof document<"u",DX=!1,KR=null,aE=!1,s5=!1,o5=new Set;function hF(n,e){o5.forEach(i=>i(n,e))}var xxe=typeof window<"u"&&window.navigator!=null?/^Mac/.test(window.navigator.platform):!1;function Dxe(n){return!(n.metaKey||!xxe&&n.altKey||n.ctrlKey||n.key==="Control"||n.key==="Shift"||n.key==="Meta")}function LX(n){aE=!0,Dxe(n)&&(KR="keyboard",hF("keyboard",n))}function j0(n){if(KR="pointer",n.type==="mousedown"||n.type==="pointerdown"){aE=!0;const e=n.composedPath?n.composedPath()[0]:n.target;let i=!1;try{i=e.matches(":focus-visible")}catch{}if(i)return;hF("pointer",n)}}function Lxe(n){return n.mozInputSource===0&&n.isTrusted?!0:n.detail===0&&!n.pointerType}function Mxe(n){Lxe(n)&&(aE=!0,KR="virtual")}function Uxe(n){n.target===window||n.target===document||n.target instanceof Element&&n.target.hasAttribute("tabindex")||(!aE&&!s5&&(KR="virtual",hF("virtual",n)),aE=!1,s5=!1)}function Vxe(){aE=!1,s5=!0}function MX(){return KR!=="pointer"}function jxe(){if(!Nxe()||DX)return;const{focus:n}=HTMLElement.prototype;HTMLElement.prototype.focus=function(...i){aE=!0,n.apply(this,i)},document.addEventListener("keydown",LX,!0),document.addEventListener("keyup",LX,!0),document.addEventListener("click",Mxe,!0),window.addEventListener("focus",Uxe,!0),window.addEventListener("blur",Vxe,!1),typeof PointerEvent<"u"?(document.addEventListener("pointerdown",j0,!0),document.addEventListener("pointermove",j0,!0),document.addEventListener("pointerup",j0,!0)):(document.addEventListener("mousedown",j0,!0),document.addEventListener("mousemove",j0,!0),document.addEventListener("mouseup",j0,!0)),DX=!0}function Fxe(n){jxe(),n(MX());const e=()=>n(MX());return o5.add(e),()=>{o5.delete(e)}}const[Bxe,tre]=xi({name:"FormControlStylesContext",errorMessage:`useFormControlStyles returned is 'undefined'. Seems you forgot to wrap the components in "<FormControl />" `}),[zxe,ub]=xi({strict:!1,name:"FormControlContext"});function Wxe(n){const{id:e,isRequired:i,isInvalid:o,isDisabled:l,isReadOnly:u,...p}=n,y=k.useId(),E=e||`field-${y}`,b=`${E}-label`,T=`${E}-feedback`,R=`${E}-helptext`,[O,L]=k.useState(!1),[D,U]=k.useState(!1),[F,Y]=k.useState(!1),W=k.useCallback((q={},J=null)=>({id:R,...q,ref:Yi(J,Q=>{Q&&U(!0)})}),[R]),re=k.useCallback((q={},J=null)=>({...q,ref:J,"data-focus":pr(F),"data-disabled":pr(l),"data-invalid":pr(o),"data-readonly":pr(u),id:q.id!==void 0?q.id:b,htmlFor:q.htmlFor!==void 0?q.htmlFor:E}),[E,l,F,o,u,b]),le=k.useCallback((q={},J=null)=>({id:T,...q,ref:Yi(J,Q=>{Q&&L(!0)}),"aria-live":"polite"}),[T]),ie=k.useCallback((q={},J=null)=>({...q,...p,ref:J,role:"group","data-focus":pr(F),"data-disabled":pr(l),"data-invalid":pr(o),"data-readonly":pr(u)}),[p,l,F,o,u]),me=k.useCallback((q={},J=null)=>({...q,ref:J,role:"presentation","aria-hidden":!0,children:q.children||"*"}),[]);return{isRequired:!!i,isInvalid:!!o,isReadOnly:!!u,isDisabled:!!l,isFocused:!!F,onFocus:()=>Y(!0),onBlur:()=>Y(!1),hasFeedbackText:O,setHasFeedbackText:L,hasHelpText:D,setHasHelpText:U,id:E,labelId:b,feedbackId:T,helpTextId:R,htmlProps:p,getHelpTextProps:W,getErrorMessageProps:le,getRootProps:ie,getLabelProps:re,getRequiredIndicatorProps:me}}const br=jt(function(e,i){const o=za("Form",e),l=Bi(e),{getRootProps:u,htmlProps:p,...y}=Wxe(l),E=Sn("chakra-form-control",e.className);return S.jsx(zxe,{value:y,children:S.jsx(Bxe,{value:o,children:S.jsx(Lt.div,{...u({},i),className:E,__css:o.container})})})});br.displayName="FormControl";const Xy=jt(function(e,i){const o=ub(),l=tre(),u=Sn("chakra-form__helper-text",e.className);return S.jsx(Lt.div,{...o==null?void 0:o.getHelpTextProps(e,i),__css:l.helperText,className:u})});Xy.displayName="FormHelperText";function pF(n){const{isDisabled:e,isInvalid:i,isReadOnly:o,isRequired:l,...u}=fF(n);return{...u,disabled:e,readOnly:o,required:l,"aria-invalid":Bf(i),"aria-required":Bf(l),"aria-readonly":Bf(o)}}function fF(n){const e=ub(),{id:i,disabled:o,readOnly:l,required:u,isRequired:p,isInvalid:y,isReadOnly:E,isDisabled:b,onFocus:T,onBlur:R,...O}=n,L=n["aria-describedby"]?[n["aria-describedby"]]:[];return e!=null&&e.hasFeedbackText&&(e!=null&&e.isInvalid)&&L.push(e.feedbackId),e!=null&&e.hasHelpText&&L.push(e.helpTextId),{...O,"aria-describedby":L.join(" ")||void 0,id:i??(e==null?void 0:e.id),isDisabled:o??b??(e==null?void 0:e.isDisabled),isReadOnly:l??E??(e==null?void 0:e.isReadOnly),isRequired:u??p??(e==null?void 0:e.isRequired),isInvalid:y??(e==null?void 0:e.isInvalid),onFocus:jn(e==null?void 0:e.onFocus,T),onBlur:jn(e==null?void 0:e.onBlur,R)}}const Gxe={border:"0",clip:"rect(0, 0, 0, 0)",height:"1px",width:"1px",margin:"-1px",padding:"0",overflow:"hidden",whiteSpace:"nowrap",position:"absolute"};function Hxe(n={}){const e=fF(n),{isDisabled:i,isReadOnly:o,isRequired:l,isInvalid:u,id:p,onBlur:y,onFocus:E,"aria-describedby":b}=e,{defaultChecked:T,isChecked:R,isFocusable:O,onChange:L,isIndeterminate:D,name:U,value:F,tabIndex:Y=void 0,"aria-label":W,"aria-labelledby":re,"aria-invalid":le,...ie}=n,me=UR(ie,["isDisabled","isReadOnly","isRequired","isInvalid","id","onBlur","onFocus","aria-describedby"]),q=go(L),J=go(y),Q=go(E),[ne,he]=k.useState(!1),[de,pe]=k.useState(!1),[Se,Ie]=k.useState(!1),Fe=k.useRef(!1);k.useEffect(()=>Fxe(st=>{Fe.current=st}),[]);const we=k.useRef(null),[Re,Te]=k.useState(!0),[Ne,be]=k.useState(!!T),xe=R!==void 0,je=xe?R:Ne,nt=k.useCallback(st=>{if(o||i){st.preventDefault();return}xe||be(je?st.currentTarget.checked:D?!0:st.currentTarget.checked),q==null||q(st)},[o,i,je,xe,D,q]);xp(()=>{we.current&&(we.current.indeterminate=!!D)},[D]),Xf(()=>{i&&he(!1)},[i,he]),xp(()=>{const st=we.current;if(!(st!=null&&st.form))return;const hn=()=>{be(!!T)};return st.form.addEventListener("reset",hn),()=>{var an;return(an=st.form)==null?void 0:an.removeEventListener("reset",hn)}},[]);const dt=i&&!O,ft=k.useCallback(st=>{st.key===" "&&Ie(!0)},[Ie]),lt=k.useCallback(st=>{st.key===" "&&Ie(!1)},[Ie]);xp(()=>{if(!we.current)return;we.current.checked!==je&&be(we.current.checked)},[we.current]);const gt=k.useCallback((st={},hn=null)=>{const an=Ft=>{ne&&Ft.preventDefault(),Ie(!0)};return{...st,ref:hn,"data-active":pr(Se),"data-hover":pr(de),"data-checked":pr(je),"data-focus":pr(ne),"data-focus-visible":pr(ne&&Fe.current),"data-indeterminate":pr(D),"data-disabled":pr(i),"data-invalid":pr(u),"data-readonly":pr(o),"aria-hidden":!0,onMouseDown:jn(st.onMouseDown,an),onMouseUp:jn(st.onMouseUp,()=>Ie(!1)),onMouseEnter:jn(st.onMouseEnter,()=>pe(!0)),onMouseLeave:jn(st.onMouseLeave,()=>pe(!1))}},[Se,je,i,ne,de,D,u,o]),at=k.useCallback((st={},hn=null)=>({...st,ref:hn,"data-active":pr(Se),"data-hover":pr(de),"data-checked":pr(je),"data-focus":pr(ne),"data-focus-visible":pr(ne&&Fe.current),"data-indeterminate":pr(D),"data-disabled":pr(i),"data-invalid":pr(u),"data-readonly":pr(o)}),[Se,je,i,ne,de,D,u,o]),Ct=k.useCallback((st={},hn=null)=>({...me,...st,ref:Yi(hn,an=>{an&&Te(an.tagName==="LABEL")}),onClick:jn(st.onClick,()=>{var an;Re||((an=we.current)==null||an.click(),requestAnimationFrame(()=>{var Ft;(Ft=we.current)==null||Ft.focus({preventScroll:!0})}))}),"data-disabled":pr(i),"data-checked":pr(je),"data-invalid":pr(u)}),[me,i,je,u,Re]),En=k.useCallback((st={},hn=null)=>({...st,ref:Yi(we,hn),type:"checkbox",name:U,value:F,id:p,tabIndex:Y,onChange:jn(st.onChange,nt),onBlur:jn(st.onBlur,J,()=>he(!1)),onFocus:jn(st.onFocus,Q,()=>he(!0)),onKeyDown:jn(st.onKeyDown,ft),onKeyUp:jn(st.onKeyUp,lt),required:l,checked:je,disabled:dt,readOnly:o,"aria-label":W,"aria-labelledby":re,"aria-invalid":le?!!le:u,"aria-describedby":b,"aria-disabled":i,"aria-checked":D?"mixed":je,style:Gxe}),[U,F,p,Y,nt,J,Q,ft,lt,l,je,dt,o,W,re,le,u,b,i,D]),Gt=k.useCallback((st={},hn=null)=>({...st,ref:hn,onMouseDown:jn(st.onMouseDown,$xe),"data-disabled":pr(i),"data-checked":pr(je),"data-invalid":pr(u)}),[je,i,u]);return{state:{isInvalid:u,isFocused:ne,isChecked:je,isActive:Se,isHovered:de,isIndeterminate:D,isDisabled:i,isReadOnly:o,isRequired:l},getRootProps:Ct,getCheckboxProps:gt,getIndicatorProps:at,getInputProps:En,getLabelProps:Gt,htmlProps:me}}function $xe(n){n.preventDefault(),n.stopPropagation()}const a5=jt(function(e,i){const{className:o,centerContent:l,...u}=Bi(e),p=Su("Container",e);return S.jsx(Lt.div,{ref:i,className:Sn("chakra-container",o),...u,__css:{...p,...l&&{display:"flex",flexDirection:"column",alignItems:"center"}}})});a5.displayName="Container";const cE=jt(function(e,i){const{borderLeftWidth:o,borderBottomWidth:l,borderTopWidth:u,borderRightWidth:p,borderWidth:y,borderStyle:E,borderColor:b,...T}=Su("Divider",e),{className:R,orientation:O="horizontal",__css:L,...D}=Bi(e),U={vertical:{borderLeftWidth:o||p||y||"1px",height:"100%"},horizontal:{borderBottomWidth:l||u||y||"1px",width:"100%"}};return S.jsx(Lt.hr,{ref:i,"aria-orientation":O,...D,__css:{...T,border:"0",borderColor:b,borderStyle:E,...U[O],...L},className:Sn("chakra-divider",R)})});cE.displayName="Divider";const Mr=jt(function(e,i){const{direction:o,align:l,justify:u,wrap:p,basis:y,grow:E,shrink:b,...T}=e,R={display:"flex",flexDirection:o,alignItems:l,justifyContent:u,flexWrap:p,flexBasis:y,flexGrow:E,flexShrink:b};return S.jsx(Lt.div,{ref:i,__css:R,...T})});Mr.displayName="Flex";function Kxe(n,e){if(n==null)return{};var i={};for(var o in n)if({}.hasOwnProperty.call(n,o)){if(e.indexOf(o)!==-1)continue;i[o]=n[o]}return i}var GU={exports:{}},HU,UX;function qxe(){if(UX)return HU;UX=1;var n="SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED";return HU=n,HU}var $U,VX;function Yxe(){if(VX)return $U;VX=1;var n=qxe();function e(){}function i(){}return i.resetWarningCache=e,$U=function(){function o(p,y,E,b,T,R){if(R!==n){var O=new Error("Calling PropTypes validators directly is not supported by the `prop-types` package. Use PropTypes.checkPropTypes() to call them. Read more at http://fb.me/use-check-prop-types");throw O.name="Invariant Violation",O}}o.isRequired=o;function l(){return o}var u={array:o,bigint:o,bool:o,func:o,number:o,object:o,string:o,symbol:o,any:o,arrayOf:l,element:o,elementType:o,instanceOf:l,node:o,objectOf:l,oneOf:l,oneOfType:l,shape:l,exact:l,checkPropTypes:i,resetWarningCache:e};return u.PropTypes=u,u},$U}var jX;function Xxe(){return jX||(jX=1,GU.exports=Yxe()()),GU.exports}var Jxe=Xxe();const An=Jg(Jxe);var c5="data-focus-lock",nre="data-focus-lock-disabled",Qxe="data-no-focus-lock",Zxe="data-autofocus-inside",eDe="data-no-autofocus";function KU(n,e){return typeof n=="function"?n(e):n&&(n.current=e),n}function tDe(n,e){var i=k.useState(function(){return{value:n,callback:e,facade:{get current(){return i.value},set current(o){var l=i.value;l!==o&&(i.value=o,i.callback(o,l))}}}})[0];return i.callback=e,i.facade}var nDe=typeof window<"u"?k.useLayoutEffect:k.useEffect,FX=new WeakMap;function rre(n,e){var i=tDe(null,function(o){return n.forEach(function(l){return KU(l,o)})});return nDe(function(){var o=FX.get(i);if(o){var l=new Set(o),u=new Set(n),p=i.current;l.forEach(function(y){u.has(y)||KU(y,null)}),u.forEach(function(y){l.has(y)||KU(y,p)})}FX.set(i,n)},[n]),i}var qU={width:"1px",height:"0px",padding:0,overflow:"hidden",position:"fixed",top:"1px",left:"1px"},Pp=function(){return Pp=Object.assign||function(e){for(var i,o=1,l=arguments.length;o<l;o++){i=arguments[o];for(var u in i)Object.prototype.hasOwnProperty.call(i,u)&&(e[u]=i[u])}return e},Pp.apply(this,arguments)};function qR(n,e){var i={};for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&e.indexOf(o)<0&&(i[o]=n[o]);if(n!=null&&typeof Object.getOwnPropertySymbols=="function")for(var l=0,o=Object.getOwnPropertySymbols(n);l<o.length;l++)e.indexOf(o[l])<0&&Object.prototype.propertyIsEnumerable.call(n,o[l])&&(i[o[l]]=n[o[l]]);return i}function rDe(n,e,i){if(i||arguments.length===2)for(var o=0,l=e.length,u;o<l;o++)(u||!(o in e))&&(u||(u=Array.prototype.slice.call(e,0,o)),u[o]=e[o]);return n.concat(u||Array.prototype.slice.call(e))}function ire(n){return n}function sre(n,e){e===void 0&&(e=ire);var i=[],o=!1,l={read:function(){if(o)throw new Error("Sidecar: could not `read` from an `assigned` medium. `read` could be used only with `useMedium`.");return i.length?i[i.length-1]:n},useMedium:function(u){var p=e(u,o);return i.push(p),function(){i=i.filter(function(y){return y!==p})}},assignSyncMedium:function(u){for(o=!0;i.length;){var p=i;i=[],p.forEach(u)}i={push:function(y){return u(y)},filter:function(){return i}}},assignMedium:function(u){o=!0;var p=[];if(i.length){var y=i;i=[],y.forEach(u),p=i}var E=function(){var T=p;p=[],T.forEach(u)},b=function(){return Promise.resolve().then(E)};b(),i={push:function(T){p.push(T),b()},filter:function(T){return p=p.filter(T),i}}}};return l}function mF(n,e){return e===void 0&&(e=ire),sre(n,e)}function ore(n){n===void 0&&(n={});var e=sre(null);return e.options=Pp({async:!0,ssr:!1},n),e}var are=function(n){var e=n.sideCar,i=qR(n,["sideCar"]);if(!e)throw new Error("Sidecar: please provide `sideCar` property to import the right car");var o=e.read();if(!o)throw new Error("Sidecar medium not found");return k.createElement(o,Pp({},i))};are.isSideCarExport=!0;function iDe(n,e){return n.useMedium(e),are}var cre=mF({},function(n){var e=n.target,i=n.currentTarget;return{target:e,currentTarget:i}}),lre=mF(),sDe=mF(),oDe=ore({async:!0,ssr:typeof document<"u"}),aDe=k.createContext(void 0),cDe=[],gF=k.forwardRef(function(e,i){var o,l=k.useState(),u=l[0],p=l[1],y=k.useRef(),E=k.useRef(!1),b=k.useRef(null),T=k.useState({}),R=T[1],O=e.children,L=e.disabled,D=L===void 0?!1:L,U=e.noFocusGuards,F=U===void 0?!1:U,Y=e.persistentFocus,W=Y===void 0?!1:Y,re=e.crossFrame,le=re===void 0?!0:re,ie=e.autoFocus,me=ie===void 0?!0:ie;e.allowTextSelection;var q=e.group,J=e.className,Q=e.whiteList,ne=e.hasPositiveIndices,he=e.shards,de=he===void 0?cDe:he,pe=e.as,Se=pe===void 0?"div":pe,Ie=e.lockProps,Fe=Ie===void 0?{}:Ie,we=e.sideCar,Re=e.returnFocus,Te=Re===void 0?!1:Re,Ne=e.focusOptions,be=e.onActivation,xe=e.onDeactivation,je=k.useState({}),nt=je[0],dt=k.useCallback(function(an){var Ft=an.captureFocusRestore;if(!b.current){var on,bt=(on=document)==null?void 0:on.activeElement;b.current=bt,bt!==document.body&&(b.current=Ft(bt))}y.current&&be&&be(y.current),E.current=!0,R()},[be]),ft=k.useCallback(function(){E.current=!1,xe&&xe(y.current),R()},[xe]),lt=k.useCallback(function(an){var Ft=b.current;if(Ft){var on=(typeof Ft=="function"?Ft():Ft)||document.body,bt=typeof Te=="function"?Te(on):Te;if(bt){var ve=typeof bt=="object"?bt:void 0;b.current=null,an?Promise.resolve().then(function(){return on.focus(ve)}):on.focus(ve)}}},[Te]),gt=k.useCallback(function(an){E.current&&cre.useMedium(an)},[]),at=lre.useMedium,Ct=k.useCallback(function(an){y.current!==an&&(y.current=an,p(an))},[]),En=iE((o={},o[nre]=D&&"disabled",o[c5]=q,o),Fe),Gt=F!==!0,Jt=Gt&&F!=="tail",st=rre([i,Ct]),hn=k.useMemo(function(){return{observed:y,shards:de,enabled:!D,active:E.current}},[D,E.current,de,u]);return yi.createElement(k.Fragment,null,Gt&&[yi.createElement("div",{key:"guard-first","data-focus-guard":!0,tabIndex:D?-1:0,style:qU}),ne?yi.createElement("div",{key:"guard-nearest","data-focus-guard":!0,tabIndex:D?-1:1,style:qU}):null],!D&&yi.createElement(we,{id:nt,sideCar:oDe,observed:u,disabled:D,persistentFocus:W,crossFrame:le,autoFocus:me,whiteList:Q,shards:de,onActivation:dt,onDeactivation:ft,returnFocus:lt,focusOptions:Ne,noFocusGuards:F}),yi.createElement(Se,iE({ref:st},En,{className:J,onBlur:at,onFocus:gt}),yi.createElement(aDe.Provider,{value:hn},O)),Jt&&yi.createElement("div",{"data-focus-guard":!0,tabIndex:D?-1:0,style:qU}))});gF.propTypes={};function l5(n,e){return l5=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(i,o){return i.__proto__=o,i},l5(n,e)}function lDe(n,e){n.prototype=Object.create(e.prototype),n.prototype.constructor=n,l5(n,e)}function gR(n){"@babel/helpers - typeof";return gR=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},gR(n)}function uDe(n,e){if(gR(n)!="object"||!n)return n;var i=n[Symbol.toPrimitive];if(i!==void 0){var o=i.call(n,e);if(gR(o)!="object")return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(n)}function dDe(n){var e=uDe(n,"string");return gR(e)=="symbol"?e:e+""}function hDe(n,e,i){return(e=dDe(e))in n?Object.defineProperty(n,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):n[e]=i,n}function pDe(n,e){function i(o){return o.displayName||o.name||"Component"}return function(l){var u=[],p;function y(){p=n(u.map(function(b){return b.props})),e(p)}var E=(function(b){lDe(T,b);function T(){return b.apply(this,arguments)||this}T.peek=function(){return p};var R=T.prototype;return R.componentDidMount=function(){u.push(this),y()},R.componentDidUpdate=function(){y()},R.componentWillUnmount=function(){var L=u.indexOf(this);u.splice(L,1),y()},R.render=function(){return yi.createElement(l,this.props)},T})(k.PureComponent);return hDe(E,"displayName","SideEffect("+i(l)+")"),E}}var Kp=function(n){for(var e=Array(n.length),i=0;i<n.length;++i)e[i]=n[i];return e},lE=function(n){return Array.isArray(n)?n:[n]},ure=function(n){return Array.isArray(n)?n[0]:n},fDe=function(n){if(n.nodeType!==Node.ELEMENT_NODE)return!1;var e=window.getComputedStyle(n,null);return!e||!e.getPropertyValue?!1:e.getPropertyValue("display")==="none"||e.getPropertyValue("visibility")==="hidden"},dre=function(n){return n.parentNode&&n.parentNode.nodeType===Node.DOCUMENT_FRAGMENT_NODE?n.parentNode.host:n.parentNode},hre=function(n){return n===document||n&&n.nodeType===Node.DOCUMENT_NODE},mDe=function(n){return n.hasAttribute("inert")},gDe=function(n,e){return!n||hre(n)||!fDe(n)&&!mDe(n)&&e(dre(n))},pre=function(n,e){var i=n.get(e);if(i!==void 0)return i;var o=gDe(e,pre.bind(void 0,n));return n.set(e,o),o},_De=function(n,e){return n&&!hre(n)?vDe(n)?e(dre(n)):!1:!0},fre=function(n,e){var i=n.get(e);if(i!==void 0)return i;var o=_De(e,fre.bind(void 0,n));return n.set(e,o),o},mre=function(n){return n.dataset},yDe=function(n){return n.tagName==="BUTTON"},gre=function(n){return n.tagName==="INPUT"},_re=function(n){return gre(n)&&n.type==="radio"},EDe=function(n){return!((gre(n)||yDe(n))&&(n.type==="hidden"||n.disabled))},vDe=function(n){var e=n.getAttribute(eDe);return![!0,"true",""].includes(e)},_F=function(n){var e;return!!(n&&(!((e=mre(n))===null||e===void 0)&&e.focusGuard))},u5=function(n){return!_F(n)},SDe=function(n){return!!n},bDe=function(n,e){var i=Math.max(0,n.tabIndex),o=Math.max(0,e.tabIndex),l=i-o,u=n.index-e.index;if(l){if(!i)return 1;if(!o)return-1}return l||u},wDe=function(n){return n.tabIndex<0&&!n.hasAttribute("tabindex")?0:n.tabIndex},yF=function(n,e,i){return Kp(n).map(function(o,l){var u=wDe(o);return{node:o,index:l,tabIndex:i&&u===-1?(o.dataset||{}).focusGuard?0:-1:u}}).filter(function(o){return!e||o.tabIndex>=0}).sort(bDe)},TDe=["button:enabled","select:enabled","textarea:enabled","input:enabled","a[href]","area[href]","summary","iframe","object","embed","audio[controls]","video[controls]","[tabindex]","[contenteditable]","[autofocus]"],EF=TDe.join(","),CDe="".concat(EF,", [data-focus-guard]"),yre=function(n,e){return Kp((n.shadowRoot||n).children).reduce(function(i,o){return i.concat(o.matches(e?CDe:EF)?[o]:[],yre(o))},[])},RDe=function(n,e){var i;return n instanceof HTMLIFrameElement&&(!((i=n.contentDocument)===null||i===void 0)&&i.body)?BS([n.contentDocument.body],e):[n]},BS=function(n,e){return n.reduce(function(i,o){var l,u=yre(o,e),p=(l=[]).concat.apply(l,u.map(function(y){return RDe(y,e)}));return i.concat(p,o.parentNode?Kp(o.parentNode.querySelectorAll(EF)).filter(function(y){return y===o}):[])},[])},IDe=function(n){var e=n.querySelectorAll("[".concat(Zxe,"]"));return Kp(e).map(function(i){return BS([i])}).reduce(function(i,o){return i.concat(o)},[])},vF=function(n,e){return Kp(n).filter(function(i){return pre(e,i)}).filter(function(i){return EDe(i)})},BX=function(n,e){return e===void 0&&(e=new Map),Kp(n).filter(function(i){return fre(e,i)})},SF=function(n,e,i){return yF(vF(BS(n,i),e),!0,i)},_R=function(n,e){return yF(vF(BS(n),e),!1)},ADe=function(n,e){return vF(IDe(n),e)},Jy=function(n,e){return n.shadowRoot?Jy(n.shadowRoot,e):Object.getPrototypeOf(n).contains!==void 0&&Object.getPrototypeOf(n).contains.call(n,e)?!0:Kp(n.children).some(function(i){var o;if(i instanceof HTMLIFrameElement){var l=(o=i.contentDocument)===null||o===void 0?void 0:o.body;return l?Jy(l,e):!1}return Jy(i,e)})},PDe=function(n){for(var e=new Set,i=n.length,o=0;o<i;o+=1)for(var l=o+1;l<i;l+=1){var u=n[o].compareDocumentPosition(n[l]);(u&Node.DOCUMENT_POSITION_CONTAINED_BY)>0&&e.add(l),(u&Node.DOCUMENT_POSITION_CONTAINS)>0&&e.add(o)}return n.filter(function(p,y){return!e.has(y)})},Ere=function(n){return n.parentNode?Ere(n.parentNode):n},bF=function(n){var e=lE(n);return e.filter(Boolean).reduce(function(i,o){var l=o.getAttribute(c5);return i.push.apply(i,l?PDe(Kp(Ere(o).querySelectorAll("[".concat(c5,'="').concat(l,'"]:not([').concat(nre,'="disabled"])')))):[o]),i},[])},ODe=function(n){try{return n()}catch{return}},yR=function(n){if(n===void 0&&(n=document),!(!n||!n.activeElement)){var e=n.activeElement;return e.shadowRoot?yR(e.shadowRoot):e instanceof HTMLIFrameElement&&ODe(function(){return e.contentWindow.document})?yR(e.contentWindow.document):e}},kDe=function(n,e){return n===e},NDe=function(n,e){return!!Kp(n.querySelectorAll("iframe")).some(function(i){return kDe(i,e)})},vre=function(n,e){return e===void 0&&(e=yR(ure(n).ownerDocument)),!e||e.dataset&&e.dataset.focusGuard?!1:bF(n).some(function(i){return Jy(i,e)||NDe(i,e)})},xDe=function(n){n===void 0&&(n=document);var e=yR(n);return e?Kp(n.querySelectorAll("[".concat(Qxe,"]"))).some(function(i){return Jy(i,e)}):!1},DDe=function(n,e){return e.filter(_re).filter(function(i){return i.name===n.name}).filter(function(i){return i.checked})[0]||n},wF=function(n,e){return _re(n)&&n.name?DDe(n,e):n},LDe=function(n){var e=new Set;return n.forEach(function(i){return e.add(wF(i,n))}),n.filter(function(i){return e.has(i)})},zX=function(n){return n[0]&&n.length>1?wF(n[0],n):n[0]},WX=function(n,e){return n.indexOf(wF(e,n))},d5="NEW_FOCUS",MDe=function(n,e,i,o,l){var u=n.length,p=n[0],y=n[u-1],E=_F(o);if(!(o&&n.indexOf(o)>=0)){var b=o!==void 0?i.indexOf(o):-1,T=l?i.indexOf(l):b,R=l?n.indexOf(l):-1;if(b===-1)return R!==-1?R:d5;if(R===-1)return d5;var O=b-T,L=i.indexOf(p),D=i.indexOf(y),U=LDe(i),F=o!==void 0?U.indexOf(o):-1,Y=l?U.indexOf(l):F,W=U.filter(function(J){return J.tabIndex>=0}),re=o!==void 0?W.indexOf(o):-1,le=l?W.indexOf(l):re,ie=re>=0&&le>=0?le-re:Y-F;if(!O&&R>=0||e.length===0)return R;var me=WX(n,e[0]),q=WX(n,e[e.length-1]);if(b<=L&&E&&Math.abs(O)>1)return q;if(b>=D&&E&&Math.abs(O)>1)return me;if(O&&Math.abs(ie)>1)return R;if(b<=L)return q;if(b>D)return me;if(O)return Math.abs(O)>1?R:(u+R+O)%u}},UDe=function(n){return function(e){var i,o=(i=mre(e))===null||i===void 0?void 0:i.autofocus;return e.autofocus||o!==void 0&&o!=="false"||n.indexOf(e)>=0}},GX=function(n,e,i){var o=n.map(function(u){var p=u.node;return p}),l=BX(o.filter(UDe(i)));return l&&l.length?zX(l):zX(BX(e))},h5=function(n,e){return e===void 0&&(e=[]),e.push(n),n.parentNode&&h5(n.parentNode.host||n.parentNode,e),e},YU=function(n,e){for(var i=h5(n),o=h5(e),l=0;l<i.length;l+=1){var u=i[l];if(o.indexOf(u)>=0)return u}return!1},Sre=function(n,e,i){var o=lE(n),l=lE(e),u=o[0],p=!1;return l.filter(Boolean).forEach(function(y){p=YU(p||y,y)||p,i.filter(Boolean).forEach(function(E){var b=YU(u,E);b&&(!p||Jy(b,p)?p=b:p=YU(b,p))})}),p},HX=function(n,e){return n.reduce(function(i,o){return i.concat(ADe(o,e))},[])},VDe=function(n,e){var i=new Map;return e.forEach(function(o){return i.set(o.node,o)}),n.map(function(o){return i.get(o)}).filter(SDe)},jDe=function(n,e){var i=yR(lE(n).length>0?document:ure(n).ownerDocument),o=bF(n).filter(u5),l=Sre(i||n,n,o),u=new Map,p=_R(o,u),y=p.filter(function(D){var U=D.node;return u5(U)});if(y[0]){var E=_R([l],u).map(function(D){var U=D.node;return U}),b=VDe(E,y),T=b.map(function(D){var U=D.node;return U}),R=b.filter(function(D){var U=D.tabIndex;return U>=0}).map(function(D){var U=D.node;return U}),O=MDe(T,R,E,i,e);if(O===d5){var L=GX(p,R,HX(o,u))||GX(p,T,HX(o,u));if(L)return{node:L};console.warn("focus-lock: cannot find any node to move focus into");return}return O===void 0?O:b[O]}},FDe=function(n){var e=bF(n).filter(u5),i=Sre(n,n,e),o=yF(BS([i],!0),!0,!0),l=BS(e,!1);return o.map(function(u){var p=u.node,y=u.index;return{node:p,index:y,lockItem:l.indexOf(p)>=0,guard:_F(p)}})},TF=function(n,e){n&&("focus"in n&&n.focus(e),"contentWindow"in n&&n.contentWindow&&n.contentWindow.focus())},XU=0,JU=!1,bre=function(n,e,i){i===void 0&&(i={});var o=jDe(n,e);if(!JU&&o){if(XU>2){console.error("FocusLock: focus-fighting detected. Only one focus management system could be active. See https://github.com/theKashey/focus-lock/#focus-fighting"),JU=!0,setTimeout(function(){JU=!1},1);return}XU++,TF(o.node,i.focusOptions),XU--}};function sC(n){if(!n)return null;if(typeof WeakRef>"u")return function(){return n||null};var e=n?new WeakRef(n):null;return function(){return(e==null?void 0:e.deref())||null}}var BDe=function(n){if(!n)return null;for(var e=[],i=n;i&&i!==document.body;)e.push({current:sC(i),parent:sC(i.parentElement),left:sC(i.previousElementSibling),right:sC(i.nextElementSibling)}),i=i.parentElement;return{element:sC(n),stack:e,ownerDocument:n.ownerDocument}},zDe=function(n){var e,i,o,l,u;if(n)for(var p=n.stack,y=n.ownerDocument,E=new Map,b=0,T=p;b<T.length;b++){var R=T[b],O=(e=R.parent)===null||e===void 0?void 0:e.call(R);if(O&&y.contains(O)){for(var L=(i=R.left)===null||i===void 0?void 0:i.call(R),D=R.current(),U=O.contains(D)?D:void 0,F=(o=R.right)===null||o===void 0?void 0:o.call(R),Y=SF([O],E),W=(u=(l=U??(L==null?void 0:L.nextElementSibling))!==null&&l!==void 0?l:F)!==null&&u!==void 0?u:L;W;){for(var re=0,le=Y;re<le.length;re++){var ie=le[re];if(W!=null&&W.contains(ie.node))return ie.node}W=W.nextElementSibling}if(Y.length)return Y[0].node}}},wre=function(n){var e=BDe(n);return function(){return zDe(e)}},WDe=function(n,e,i){if(!n||!e)return console.error("no element or scope given"),{};var o=lE(e);if(o.every(function(p){return!Jy(p,n)}))return console.error("Active element is not contained in the scope"),{};var l=i?SF(o,new Map):_R(o,new Map),u=l.findIndex(function(p){var y=p.node;return y===n});if(u!==-1)return{prev:l[u-1],next:l[u+1],first:l[0],last:l[l.length-1]}},GDe=function(n,e){var i=e?SF(lE(n),new Map):_R(lE(n),new Map);return{first:i[0],last:i[i.length-1]}},HDe=function(n){return Object.assign({scope:document.body,cycle:!0,onlyTabbable:!0},n)},Tre=function(n,e,i){e===void 0&&(e={});var o=HDe(e),l=WDe(n,o.scope,o.onlyTabbable);if(l){var u=i(l,o.cycle);u&&TF(u.node,o.focusOptions)}},$De=function(n,e){e===void 0&&(e={}),Tre(n,e,function(i,o){var l=i.next,u=i.first;return l||o&&u})},KDe=function(n,e){e===void 0&&(e={}),Tre(n,e,function(i,o){var l=i.prev,u=i.last;return l||o&&u})},Cre=function(n,e,i){var o,l=GDe(n,(o=e.onlyTabbable)!==null&&o!==void 0?o:!0),u=l[i];u&&TF(u.node,e.focusOptions)},qDe=function(n,e){e===void 0&&(e={}),Cre(n,e,"first")},YDe=function(n,e){e===void 0&&(e={}),Cre(n,e,"last")};function CF(n){setTimeout(n,1)}var XDe=function(e){return e&&"current"in e?e.current:e},Rre=function(){return document&&document.activeElement===document.body},JDe=function(){return Rre()||xDe()},SS=null,El=null,$X=function(){return null},bS=null,ER=!1,RF=!1,QDe=function(){return!0},ZDe=function(e){return(SS.whiteList||QDe)(e)},eLe=function(e,i){bS={observerNode:e,portaledElement:i}},tLe=function(e){return bS&&bS.portaledElement===e};function KX(n,e,i,o){var l=null,u=n;do{var p=o[u];if(p.guard)p.node.dataset.focusAutoGuard&&(l=p);else if(p.lockItem){if(u!==n)return;l=null}else break}while((u+=i)!==e);l&&(l.node.tabIndex=0)}var nLe=function(e){return e?!!ER:ER==="meanwhile"},rLe=function n(e,i,o){return i&&(i.host===e&&(!i.activeElement||o.contains(i.activeElement))||i.parentNode&&n(e,i.parentNode,o))},iLe=function(e,i){return i.some(function(o){return rLe(e,o,o)})},Ire=function(e){return _R(e,new Map)},sLe=function(e){return!Ire([e.parentNode]).some(function(i){return i.node===e})},bk=function(){var e=!1;if(SS){var i=SS,o=i.observed,l=i.persistentFocus,u=i.autoFocus,p=i.shards,y=i.crossFrame,E=i.focusOptions,b=i.noFocusGuards,T=o||bS&&bS.portaledElement;if(Rre()&&El&&El!==document.body&&(!document.body.contains(El)||sLe(El))){var R=$X();R&&R.focus()}var O=document&&document.activeElement;if(T){var L=[T].concat(p.map(XDe).filter(Boolean)),D=function(){if(!nLe(y)||!b||!El||RF)return!1;var re=Ire(L),le=re.findIndex(function(ie){var me=ie.node;return me===El});return le===0||le===re.length-1};if((!O||ZDe(O))&&(l||D()||!JDe()||!El&&u)&&(T&&!(vre(L)||O&&iLe(O,L)||tLe(O))&&(document&&!El&&O&&!u?(O.blur&&O.blur(),document.body.focus()):(e=bre(L,El,{focusOptions:E}),bS={})),El=document&&document.activeElement,El!==document.body&&($X=wre(El)),ER=!1),document&&O!==document.activeElement&&document.querySelector("[data-focus-auto-guard]")){var U=document&&document.activeElement,F=FDe(L),Y=F.map(function(W){var re=W.node;return re}).indexOf(U);Y>-1&&(F.filter(function(W){var re=W.guard,le=W.node;return re&&le.dataset.focusAutoGuard}).forEach(function(W){var re=W.node;return re.removeAttribute("tabIndex")}),KX(Y,F.length,1,F),KX(Y,-1,-1,F))}}}return e},Are=function(e){bk()&&e&&(e.stopPropagation(),e.preventDefault())},IF=function(){return CF(bk)},oLe=function(e){var i=e.target,o=e.currentTarget;o.contains(i)||eLe(o,i)},aLe=function(){return null},Pre=function(){RF=!0},Ore=function(){RF=!1,ER="just",CF(function(){ER="meanwhile"})},cLe=function(){document.addEventListener("focusin",Are),document.addEventListener("focusout",IF),window.addEventListener("focus",Pre),window.addEventListener("blur",Ore)},lLe=function(){document.removeEventListener("focusin",Are),document.removeEventListener("focusout",IF),window.removeEventListener("focus",Pre),window.removeEventListener("blur",Ore)};function uLe(n){return n.filter(function(e){var i=e.disabled;return!i})}var kre={moveFocusInside:bre,focusInside:vre,focusNextElement:$De,focusPrevElement:KDe,focusFirstElement:qDe,focusLastElement:YDe,captureFocusRestore:wre};function dLe(n){var e=n.slice(-1)[0];e&&!SS&&cLe();var i=SS,o=i&&e&&e.id===i.id;SS=e,i&&!o&&(i.onDeactivation(),n.filter(function(l){var u=l.id;return u===i.id}).length||i.returnFocus(!e)),e?(El=null,(!o||i.observed!==e.observed)&&e.onActivation(kre),bk(),CF(bk)):(lLe(),El=null)}cre.assignSyncMedium(oLe);lre.assignMedium(IF);sDe.assignMedium(function(n){return n(kre)});const hLe=pDe(uLe,dLe)(aLe);var p5=k.forwardRef(function(e,i){return yi.createElement(gF,iE({sideCar:hLe,ref:i},e))}),Nre=gF.propTypes||{};Nre.sideCar;Kxe(Nre,["sideCar"]);p5.propTypes={};const pLe=p5.default??p5,xre=n=>{const{initialFocusRef:e,finalFocusRef:i,contentRef:o,restoreFocus:l,children:u,isDisabled:p,autoFocus:y,persistentFocus:E,lockFocusAcrossFrames:b}=n,T=k.useCallback(()=>{e!=null&&e.current?e.current.focus():o!=null&&o.current&&mee(o.current).length===0&&requestAnimationFrame(()=>{var D;(D=o.current)==null||D.focus()})},[e,o]),R=k.useCallback(()=>{var L;(L=i==null?void 0:i.current)==null||L.focus()},[i]),O=l&&!i;return S.jsx(pLe,{crossFrame:b,persistentFocus:E,autoFocus:y,disabled:p,onActivation:T,onDeactivation:R,returnFocus:O,children:u})};xre.displayName="FocusLock";const[fLe,mLe]=xi({name:"FormErrorStylesContext",errorMessage:`useFormErrorStyles returned is 'undefined'. Seems you forgot to wrap the components in "<FormError />" `}),Ip=jt((n,e)=>{const i=za("FormError",n),o=Bi(n),l=ub();return l!=null&&l.isInvalid?S.jsx(fLe,{value:i,children:S.jsx(Lt.div,{...l==null?void 0:l.getErrorMessageProps(o,e),className:Sn("chakra-form__error-message",n.className),__css:{display:"flex",alignItems:"center",...i.text}})}):null});Ip.displayName="FormErrorMessage";const gLe=jt((n,e)=>{const i=mLe(),o=ub();if(!(o!=null&&o.isInvalid))return null;const l=Sn("chakra-form__error-icon",n.className);return S.jsx(en,{ref:e,"aria-hidden":!0,...n,__css:i.icon,className:l,children:S.jsx("path",{fill:"currentColor",d:"M11.983,0a12.206,12.206,0,0,0-8.51,3.653A11.8,11.8,0,0,0,0,12.207,11.779,11.779,0,0,0,11.8,24h.214A12.111,12.111,0,0,0,24,11.791h0A11.766,11.766,0,0,0,11.983,0ZM10.5,16.542a1.476,1.476,0,0,1,1.449-1.53h.027a1.527,1.527,0,0,1,1.523,1.47,1.475,1.475,0,0,1-1.449,1.53h-.027A1.529,1.529,0,0,1,10.5,16.542ZM11,12.5v-6a1,1,0,0,1,2,0v6a1,1,0,1,1-2,0Z"})})});gLe.displayName="FormErrorIcon";const Ei=jt(function(e,i){const o=Su("FormLabel",e),l=Bi(e),{className:u,children:p,requiredIndicator:y=S.jsx(Dre,{}),optionalIndicator:E=null,...b}=l,T=ub(),R=(T==null?void 0:T.getLabelProps(b,i))??{ref:i,...b};return S.jsxs(Lt.label,{...R,className:Sn("chakra-form__label",l.className),__css:{display:"block",textAlign:"start",...o},children:[p,T!=null&&T.isRequired?y:E]})});Ei.displayName="FormLabel";const Dre=jt(function(e,i){const o=ub(),l=tre();if(!(o!=null&&o.isRequired))return null;const u=Sn("chakra-form__required-indicator",e.className);return S.jsx(Lt.span,{...o==null?void 0:o.getRequiredIndicatorProps(e,i),__css:l.requiredIndicator,className:u})});Dre.displayName="RequiredIndicator";const wk=jt(function(e,i){const{templateAreas:o,gap:l,rowGap:u,columnGap:p,column:y,row:E,autoFlow:b,autoRows:T,templateRows:R,autoColumns:O,templateColumns:L,...D}=e,U={display:"grid",gridTemplateAreas:o,gridGap:l,gridRowGap:u,gridColumnGap:p,gridAutoColumns:O,gridColumn:y,gridRow:E,gridAutoFlow:b,gridAutoRows:T,gridTemplateRows:R,gridTemplateColumns:L};return S.jsx(Lt.div,{ref:i,__css:U,...D})});wk.displayName="Grid";const AF=jt(function(e,i){const{columns:o,spacingX:l,spacingY:u,spacing:p,minChildWidth:y,...E}=e,b=lb(),T=y?yLe(y,b):ELe(o);return S.jsx(wk,{ref:i,gap:p,columnGap:l,rowGap:u,templateColumns:T,...E})});AF.displayName="SimpleGrid";function _Le(n){return typeof n=="number"?`${n}px`:n}function yLe(n,e){return rN(n,i=>{const o=qNe("sizes",i,_Le(i))(e);return i===null?null:`repeat(auto-fit, minmax(${o}, 1fr))`})}function ELe(n){return rN(n,e=>e===null?null:`repeat(${e}, minmax(0, 1fr))`)}function qp(n){const{viewBox:e="0 0 24 24",d:i,displayName:o,defaultProps:l={}}=n,u=k.Children.toArray(n.path),p=jt((y,E)=>S.jsx(en,{ref:E,viewBox:e,...l,...y,children:u.length?u:S.jsx("path",{fill:"currentColor",d:i})}));return p.displayName=o,p}const f5=jt(function(e,i){const{htmlWidth:o,htmlHeight:l,alt:u,...p}=e;return S.jsx("img",{width:o,height:l,ref:i,alt:u,...p})});f5.displayName="NativeImage";const kp=jt(function(e,i){const{fallbackSrc:o,fallback:l,src:u,srcSet:p,align:y,fit:E,loading:b,ignoreFallback:T,crossOrigin:R,fallbackStrategy:O="beforeLoadOrError",referrerPolicy:L,...D}=e,U=o!==void 0||l!==void 0,F=b!=null||T||!U,Y=Qne({...e,crossOrigin:R,ignoreFallback:F}),W=Ixe(Y,O),re={ref:i,objectFit:E,objectPosition:y,...F?D:UR(D,["onError","onLoad"])};return W?l||S.jsx(Lt.img,{as:f5,className:"chakra-image__placeholder",src:o,...re}):S.jsx(Lt.img,{as:f5,src:u,srcSet:p,crossOrigin:R,loading:b,referrerPolicy:L,className:"chakra-image",...re})});kp.displayName="Image";const ni=jt(function(e,i){const{htmlSize:o,...l}=e,u=za("Input",l),p=Bi(l),y=pF(p),E=Sn("chakra-input",e.className);return S.jsx(Lt.input,{size:o,...y,__css:u.field,ref:i,className:E})});ni.displayName="Input";ni.id="Input";const[vLe,Lre]=xi({name:"InputGroupStylesContext",errorMessage:`useInputGroupStyles returned is 'undefined'. Seems you forgot to wrap the components in "<InputGroup />" `}),$f=jt(function(e,i){const o=za("Input",e),{children:l,className:u,...p}=Bi(e),y=Sn("chakra-input__group",u),E={},b=nN(l),T=o.field;b.forEach(O=>{o&&(T&&O.type.id==="InputLeftElement"&&(E.paddingStart=T.height??T.h),T&&O.type.id==="InputRightElement"&&(E.paddingEnd=T.height??T.h),O.type.id==="InputRightAddon"&&(E.borderEndRadius=0),O.type.id==="InputLeftAddon"&&(E.borderStartRadius=0))});const R=b.map(O=>{var D,U;const L=oj({size:((D=O.props)==null?void 0:D.size)||e.size,variant:((U=O.props)==null?void 0:U.variant)||e.variant});return O.type.id!=="Input"?k.cloneElement(O,L):k.cloneElement(O,Object.assign(L,E,O.props))});return S.jsx(Lt.div,{className:y,ref:i,__css:{width:"100%",display:"flex",position:"relative",isolation:"isolate",...o.group},"data-group":!0,...p,children:S.jsx(vLe,{value:o,children:R})})});$f.displayName="InputGroup";const SLe={left:{marginEnd:"-1px",borderEndRadius:0,borderEndColor:"transparent"},right:{marginStart:"-1px",borderStartRadius:0,borderStartColor:"transparent"}},bLe=Lt("div",{baseStyle:{flex:"0 0 auto",width:"auto",display:"flex",alignItems:"center",whiteSpace:"nowrap"}}),PF=jt(function(e,i){const{placement:o="left",...l}=e,u=SLe[o]??{},p=Lre();return S.jsx(bLe,{ref:i,...l,__css:{...p.addon,...u}})});PF.displayName="InputAddon";const EN=jt(function(e,i){return S.jsx(PF,{ref:i,placement:"left",...e,className:Sn("chakra-input__left-addon",e.className)})});EN.displayName="InputLeftAddon";EN.id="InputLeftAddon";const Mre=jt(function(e,i){return S.jsx(PF,{ref:i,placement:"right",...e,className:Sn("chakra-input__right-addon",e.className)})});Mre.displayName="InputRightAddon";Mre.id="InputRightAddon";const wLe=Lt("div",{baseStyle:{display:"flex",alignItems:"center",justifyContent:"center",position:"absolute",top:"0",zIndex:2}}),vN=jt(function(e,i){const{placement:o="left",...l}=e,u=Lre(),p=u.field,E={[o==="left"?"insetStart":"insetEnd"]:"0",width:(p==null?void 0:p.height)??(p==null?void 0:p.h),height:(p==null?void 0:p.height)??(p==null?void 0:p.h),fontSize:p==null?void 0:p.fontSize,...u.element};return S.jsx(wLe,{ref:i,__css:E,...l})});vN.id="InputElement";vN.displayName="InputElement";const wS=jt(function(e,i){const{className:o,...l}=e,u=Sn("chakra-input__left-element",o);return S.jsx(vN,{ref:i,placement:"left",className:u,...l})});wS.id="InputLeftElement";wS.displayName="InputLeftElement";const vR=jt(function(e,i){const{className:o,...l}=e,u=Sn("chakra-input__right-element",o);return S.jsx(vN,{ref:i,placement:"right",className:u,...l})});vR.id="InputRightElement";vR.displayName="InputRightElement";const hu=jt(function(e,i){const o=Su("Link",e),{className:l,isExternal:u,...p}=Bi(e);return S.jsx(Lt.a,{target:u?"_blank":void 0,rel:u?"noopener":void 0,ref:i,className:Sn("chakra-link",l),...p,__css:o})});hu.displayName="Link";const[TLe,Ure]=xi({name:"ListStylesContext",errorMessage:`useListStyles returned is 'undefined'. Seems you forgot to wrap the components in "<List />" `}),SN=jt(function(e,i){const o=za("List",e),{children:l,styleType:u="none",stylePosition:p,spacing:y,...E}=Bi(e),b=nN(l),R=y?{"& > *:not(style) ~ *:not(style)":{mt:y}}:{};return S.jsx(TLe,{value:o,children:S.jsx(Lt.ul,{ref:i,listStyleType:u,listStylePosition:p,role:"list",__css:{...o.container,...R},...E,children:b})})});SN.displayName="List";const CLe=jt((n,e)=>{const{as:i,...o}=n;return S.jsx(SN,{ref:e,as:"ol",styleType:"decimal",marginStart:"1em",...o})});CLe.displayName="OrderedList";const RLe=jt(function(e,i){const{as:o,...l}=e;return S.jsx(SN,{ref:i,as:"ul",styleType:"initial",marginStart:"1em",...l})});RLe.displayName="UnorderedList";const Vre=jt(function(e,i){const o=Ure();return S.jsx(Lt.li,{ref:i,...e,__css:o.item})});Vre.displayName="ListItem";const ILe=jt(function(e,i){const o=Ure();return S.jsx(en,{ref:i,role:"presentation",...e,__css:o.icon})});ILe.displayName="ListIcon";function ALe(n,e={}){const{ssr:i=!0,fallback:o}=e,{getWindow:l}=JAe(),u=Array.isArray(n)?n:[n];let p=Array.isArray(o)?o:[o];p=p.filter(b=>b!=null);const[y,E]=k.useState(()=>u.map((b,T)=>({media:b,matches:i?!!p[T]:l().matchMedia(b).matches})));return k.useEffect(()=>{const b=l();E(u.map(O=>({media:O,matches:b.matchMedia(O).matches})));const T=u.map(O=>b.matchMedia(O)),R=O=>{E(L=>L.slice().map(D=>D.media===O.media?{...D,matches:O.matches}:D))};return T.forEach(O=>{typeof O.addListener=="function"?O.addListener(R):O.addEventListener("change",R)}),()=>{T.forEach(O=>{typeof O.removeListener=="function"?O.removeListener(R):O.removeEventListener("change",R)})}},[l]),y.map(b=>b.matches)}function PLe(n,e,i,o){if(e==null)return o;if(!o)return n.find(p=>i(p).toLowerCase().startsWith(e.toLowerCase()));const l=n.filter(u=>i(u).toLowerCase().startsWith(e.toLowerCase()));if(l.length>0){let u;return l.includes(o)?(u=l.indexOf(o)+1,u===l.length&&(u=0),l[u]):(u=n.indexOf(l[0]),n[u])}return o}function OLe(n){const{key:e}=n;return e.length===1||e.length>1&&/[^a-zA-Z0-9]/.test(e)}function kLe(n={}){const{timeout:e=300,preventDefault:i=()=>!0}=n,[o,l]=k.useState([]),u=k.useRef(void 0),p=()=>{u.current&&(clearTimeout(u.current),u.current=null)},y=()=>{p(),u.current=setTimeout(()=>{l([]),u.current=null},e)};k.useEffect(()=>p,[]);function E(b){return T=>{if(T.key==="Backspace"){const R=[...o];R.pop(),l(R);return}if(OLe(T)){const R=o.concat(T.key);i(T)&&(T.preventDefault(),T.stopPropagation()),l(R),b(R.join("")),y()}}}return E}var Il="top",yd="bottom",Ed="right",Al="left",OF="auto",YR=[Il,yd,Ed,Al],zS="start",SR="end",NLe="clippingParents",jre="viewport",oC="popper",xLe="reference",qX=YR.reduce(function(n,e){return n.concat([e+"-"+zS,e+"-"+SR])},[]),Fre=[].concat(YR,[OF]).reduce(function(n,e){return n.concat([e,e+"-"+zS,e+"-"+SR])},[]),DLe="beforeRead",LLe="read",MLe="afterRead",ULe="beforeMain",VLe="main",jLe="afterMain",FLe="beforeWrite",BLe="write",zLe="afterWrite",WLe=[DLe,LLe,MLe,ULe,VLe,jLe,FLe,BLe,zLe];function Hp(n){return n?(n.nodeName||"").toLowerCase():null}function vu(n){if(n==null)return window;if(n.toString()!=="[object Window]"){var e=n.ownerDocument;return e&&e.defaultView||window}return n}function uE(n){var e=vu(n).Element;return n instanceof e||n instanceof Element}function fd(n){var e=vu(n).HTMLElement;return n instanceof e||n instanceof HTMLElement}function kF(n){if(typeof ShadowRoot>"u")return!1;var e=vu(n).ShadowRoot;return n instanceof e||n instanceof ShadowRoot}function GLe(n){var e=n.state;Object.keys(e.elements).forEach(function(i){var o=e.styles[i]||{},l=e.attributes[i]||{},u=e.elements[i];!fd(u)||!Hp(u)||(Object.assign(u.style,o),Object.keys(l).forEach(function(p){var y=l[p];y===!1?u.removeAttribute(p):u.setAttribute(p,y===!0?"":y)}))})}function HLe(n){var e=n.state,i={popper:{position:e.options.strategy,left:"0",top:"0",margin:"0"},arrow:{position:"absolute"},reference:{}};return Object.assign(e.elements.popper.style,i.popper),e.styles=i,e.elements.arrow&&Object.assign(e.elements.arrow.style,i.arrow),function(){Object.keys(e.elements).forEach(function(o){var l=e.elements[o],u=e.attributes[o]||{},p=Object.keys(e.styles.hasOwnProperty(o)?e.styles[o]:i[o]),y=p.reduce(function(E,b){return E[b]="",E},{});!fd(l)||!Hp(l)||(Object.assign(l.style,y),Object.keys(u).forEach(function(E){l.removeAttribute(E)}))})}}const $Le={name:"applyStyles",enabled:!0,phase:"write",fn:GLe,effect:HLe,requires:["computeStyles"]};function Vp(n){return n.split("-")[0]}var Qy=Math.max,Tk=Math.min,WS=Math.round;function m5(){var n=navigator.userAgentData;return n!=null&&n.brands&&Array.isArray(n.brands)?n.brands.map(function(e){return e.brand+"/"+e.version}).join(" "):navigator.userAgent}function Bre(){return!/^((?!chrome|android).)*safari/i.test(m5())}function GS(n,e,i){e===void 0&&(e=!1),i===void 0&&(i=!1);var o=n.getBoundingClientRect(),l=1,u=1;e&&fd(n)&&(l=n.offsetWidth>0&&WS(o.width)/n.offsetWidth||1,u=n.offsetHeight>0&&WS(o.height)/n.offsetHeight||1);var p=uE(n)?vu(n):window,y=p.visualViewport,E=!Bre()&&i,b=(o.left+(E&&y?y.offsetLeft:0))/l,T=(o.top+(E&&y?y.offsetTop:0))/u,R=o.width/l,O=o.height/u;return{width:R,height:O,top:T,right:b+R,bottom:T+O,left:b,x:b,y:T}}function NF(n){var e=GS(n),i=n.offsetWidth,o=n.offsetHeight;return Math.abs(e.width-i)<=1&&(i=e.width),Math.abs(e.height-o)<=1&&(o=e.height),{x:n.offsetLeft,y:n.offsetTop,width:i,height:o}}function zre(n,e){var i=e.getRootNode&&e.getRootNode();if(n.contains(e))return!0;if(i&&kF(i)){var o=e;do{if(o&&n.isSameNode(o))return!0;o=o.parentNode||o.host}while(o)}return!1}function Zf(n){return vu(n).getComputedStyle(n)}function KLe(n){return["table","td","th"].indexOf(Hp(n))>=0}function Zg(n){return((uE(n)?n.ownerDocument:n.document)||window.document).documentElement}function bN(n){return Hp(n)==="html"?n:n.assignedSlot||n.parentNode||(kF(n)?n.host:null)||Zg(n)}function YX(n){return!fd(n)||Zf(n).position==="fixed"?null:n.offsetParent}function qLe(n){var e=/firefox/i.test(m5()),i=/Trident/i.test(m5());if(i&&fd(n)){var o=Zf(n);if(o.position==="fixed")return null}var l=bN(n);for(kF(l)&&(l=l.host);fd(l)&&["html","body"].indexOf(Hp(l))<0;){var u=Zf(l);if(u.transform!=="none"||u.perspective!=="none"||u.contain==="paint"||["transform","perspective"].indexOf(u.willChange)!==-1||e&&u.willChange==="filter"||e&&u.filter&&u.filter!=="none")return l;l=l.parentNode}return null}function XR(n){for(var e=vu(n),i=YX(n);i&&KLe(i)&&Zf(i).position==="static";)i=YX(i);return i&&(Hp(i)==="html"||Hp(i)==="body"&&Zf(i).position==="static")?e:i||qLe(n)||e}function xF(n){return["top","bottom"].indexOf(n)>=0?"x":"y"}function $C(n,e,i){return Qy(n,Tk(e,i))}function YLe(n,e,i){var o=$C(n,e,i);return o>i?i:o}function Wre(){return{top:0,right:0,bottom:0,left:0}}function Gre(n){return Object.assign({},Wre(),n)}function Hre(n,e){return e.reduce(function(i,o){return i[o]=n,i},{})}var XLe=function(e,i){return e=typeof e=="function"?e(Object.assign({},i.rects,{placement:i.placement})):e,Gre(typeof e!="number"?e:Hre(e,YR))};function JLe(n){var e,i=n.state,o=n.name,l=n.options,u=i.elements.arrow,p=i.modifiersData.popperOffsets,y=Vp(i.placement),E=xF(y),b=[Al,Ed].indexOf(y)>=0,T=b?"height":"width";if(!(!u||!p)){var R=XLe(l.padding,i),O=NF(u),L=E==="y"?Il:Al,D=E==="y"?yd:Ed,U=i.rects.reference[T]+i.rects.reference[E]-p[E]-i.rects.popper[T],F=p[E]-i.rects.reference[E],Y=XR(u),W=Y?E==="y"?Y.clientHeight||0:Y.clientWidth||0:0,re=U/2-F/2,le=R[L],ie=W-O[T]-R[D],me=W/2-O[T]/2+re,q=$C(le,me,ie),J=E;i.modifiersData[o]=(e={},e[J]=q,e.centerOffset=q-me,e)}}function QLe(n){var e=n.state,i=n.options,o=i.element,l=o===void 0?"[data-popper-arrow]":o;l!=null&&(typeof l=="string"&&(l=e.elements.popper.querySelector(l),!l)||zre(e.elements.popper,l)&&(e.elements.arrow=l))}const ZLe={name:"arrow",enabled:!0,phase:"main",fn:JLe,effect:QLe,requires:["popperOffsets"],requiresIfExists:["preventOverflow"]};function HS(n){return n.split("-")[1]}var e2e={top:"auto",right:"auto",bottom:"auto",left:"auto"};function t2e(n,e){var i=n.x,o=n.y,l=e.devicePixelRatio||1;return{x:WS(i*l)/l||0,y:WS(o*l)/l||0}}function XX(n){var e,i=n.popper,o=n.popperRect,l=n.placement,u=n.variation,p=n.offsets,y=n.position,E=n.gpuAcceleration,b=n.adaptive,T=n.roundOffsets,R=n.isFixed,O=p.x,L=O===void 0?0:O,D=p.y,U=D===void 0?0:D,F=typeof T=="function"?T({x:L,y:U}):{x:L,y:U};L=F.x,U=F.y;var Y=p.hasOwnProperty("x"),W=p.hasOwnProperty("y"),re=Al,le=Il,ie=window;if(b){var me=XR(i),q="clientHeight",J="clientWidth";if(me===vu(i)&&(me=Zg(i),Zf(me).position!=="static"&&y==="absolute"&&(q="scrollHeight",J="scrollWidth")),me=me,l===Il||(l===Al||l===Ed)&&u===SR){le=yd;var Q=R&&me===ie&&ie.visualViewport?ie.visualViewport.height:me[q];U-=Q-o.height,U*=E?1:-1}if(l===Al||(l===Il||l===yd)&&u===SR){re=Ed;var ne=R&&me===ie&&ie.visualViewport?ie.visualViewport.width:me[J];L-=ne-o.width,L*=E?1:-1}}var he=Object.assign({position:y},b&&e2e),de=T===!0?t2e({x:L,y:U},vu(i)):{x:L,y:U};if(L=de.x,U=de.y,E){var pe;return Object.assign({},he,(pe={},pe[le]=W?"0":"",pe[re]=Y?"0":"",pe.transform=(ie.devicePixelRatio||1)<=1?"translate("+L+"px, "+U+"px)":"translate3d("+L+"px, "+U+"px, 0)",pe))}return Object.assign({},he,(e={},e[le]=W?U+"px":"",e[re]=Y?L+"px":"",e.transform="",e))}function n2e(n){var e=n.state,i=n.options,o=i.gpuAcceleration,l=o===void 0?!0:o,u=i.adaptive,p=u===void 0?!0:u,y=i.roundOffsets,E=y===void 0?!0:y,b={placement:Vp(e.placement),variation:HS(e.placement),popper:e.elements.popper,popperRect:e.rects.popper,gpuAcceleration:l,isFixed:e.options.strategy==="fixed"};e.modifiersData.popperOffsets!=null&&(e.styles.popper=Object.assign({},e.styles.popper,XX(Object.assign({},b,{offsets:e.modifiersData.popperOffsets,position:e.options.strategy,adaptive:p,roundOffsets:E})))),e.modifiersData.arrow!=null&&(e.styles.arrow=Object.assign({},e.styles.arrow,XX(Object.assign({},b,{offsets:e.modifiersData.arrow,position:"absolute",adaptive:!1,roundOffsets:E})))),e.attributes.popper=Object.assign({},e.attributes.popper,{"data-popper-placement":e.placement})}const r2e={name:"computeStyles",enabled:!0,phase:"beforeWrite",fn:n2e,data:{}};var lO={passive:!0};function i2e(n){var e=n.state,i=n.instance,o=n.options,l=o.scroll,u=l===void 0?!0:l,p=o.resize,y=p===void 0?!0:p,E=vu(e.elements.popper),b=[].concat(e.scrollParents.reference,e.scrollParents.popper);return u&&b.forEach(function(T){T.addEventListener("scroll",i.update,lO)}),y&&E.addEventListener("resize",i.update,lO),function(){u&&b.forEach(function(T){T.removeEventListener("scroll",i.update,lO)}),y&&E.removeEventListener("resize",i.update,lO)}}const s2e={name:"eventListeners",enabled:!0,phase:"write",fn:function(){},effect:i2e,data:{}};var o2e={left:"right",right:"left",bottom:"top",top:"bottom"};function GO(n){return n.replace(/left|right|bottom|top/g,function(e){return o2e[e]})}var a2e={start:"end",end:"start"};function JX(n){return n.replace(/start|end/g,function(e){return a2e[e]})}function DF(n){var e=vu(n),i=e.pageXOffset,o=e.pageYOffset;return{scrollLeft:i,scrollTop:o}}function LF(n){return GS(Zg(n)).left+DF(n).scrollLeft}function c2e(n,e){var i=vu(n),o=Zg(n),l=i.visualViewport,u=o.clientWidth,p=o.clientHeight,y=0,E=0;if(l){u=l.width,p=l.height;var b=Bre();(b||!b&&e==="fixed")&&(y=l.offsetLeft,E=l.offsetTop)}return{width:u,height:p,x:y+LF(n),y:E}}function l2e(n){var e,i=Zg(n),o=DF(n),l=(e=n.ownerDocument)==null?void 0:e.body,u=Qy(i.scrollWidth,i.clientWidth,l?l.scrollWidth:0,l?l.clientWidth:0),p=Qy(i.scrollHeight,i.clientHeight,l?l.scrollHeight:0,l?l.clientHeight:0),y=-o.scrollLeft+LF(n),E=-o.scrollTop;return Zf(l||i).direction==="rtl"&&(y+=Qy(i.clientWidth,l?l.clientWidth:0)-u),{width:u,height:p,x:y,y:E}}function MF(n){var e=Zf(n),i=e.overflow,o=e.overflowX,l=e.overflowY;return/auto|scroll|overlay|hidden/.test(i+l+o)}function $re(n){return["html","body","#document"].indexOf(Hp(n))>=0?n.ownerDocument.body:fd(n)&&MF(n)?n:$re(bN(n))}function KC(n,e){var i;e===void 0&&(e=[]);var o=$re(n),l=o===((i=n.ownerDocument)==null?void 0:i.body),u=vu(o),p=l?[u].concat(u.visualViewport||[],MF(o)?o:[]):o,y=e.concat(p);return l?y:y.concat(KC(bN(p)))}function g5(n){return Object.assign({},n,{left:n.x,top:n.y,right:n.x+n.width,bottom:n.y+n.height})}function u2e(n,e){var i=GS(n,!1,e==="fixed");return i.top=i.top+n.clientTop,i.left=i.left+n.clientLeft,i.bottom=i.top+n.clientHeight,i.right=i.left+n.clientWidth,i.width=n.clientWidth,i.height=n.clientHeight,i.x=i.left,i.y=i.top,i}function QX(n,e,i){return e===jre?g5(c2e(n,i)):uE(e)?u2e(e,i):g5(l2e(Zg(n)))}function d2e(n){var e=KC(bN(n)),i=["absolute","fixed"].indexOf(Zf(n).position)>=0,o=i&&fd(n)?XR(n):n;return uE(o)?e.filter(function(l){return uE(l)&&zre(l,o)&&Hp(l)!=="body"}):[]}function h2e(n,e,i,o){var l=e==="clippingParents"?d2e(n):[].concat(e),u=[].concat(l,[i]),p=u[0],y=u.reduce(function(E,b){var T=QX(n,b,o);return E.top=Qy(T.top,E.top),E.right=Tk(T.right,E.right),E.bottom=Tk(T.bottom,E.bottom),E.left=Qy(T.left,E.left),E},QX(n,p,o));return y.width=y.right-y.left,y.height=y.bottom-y.top,y.x=y.left,y.y=y.top,y}function Kre(n){var e=n.reference,i=n.element,o=n.placement,l=o?Vp(o):null,u=o?HS(o):null,p=e.x+e.width/2-i.width/2,y=e.y+e.height/2-i.height/2,E;switch(l){case Il:E={x:p,y:e.y-i.height};break;case yd:E={x:p,y:e.y+e.height};break;case Ed:E={x:e.x+e.width,y};break;case Al:E={x:e.x-i.width,y};break;default:E={x:e.x,y:e.y}}var b=l?xF(l):null;if(b!=null){var T=b==="y"?"height":"width";switch(u){case zS:E[b]=E[b]-(e[T]/2-i[T]/2);break;case SR:E[b]=E[b]+(e[T]/2-i[T]/2);break}}return E}function bR(n,e){e===void 0&&(e={});var i=e,o=i.placement,l=o===void 0?n.placement:o,u=i.strategy,p=u===void 0?n.strategy:u,y=i.boundary,E=y===void 0?NLe:y,b=i.rootBoundary,T=b===void 0?jre:b,R=i.elementContext,O=R===void 0?oC:R,L=i.altBoundary,D=L===void 0?!1:L,U=i.padding,F=U===void 0?0:U,Y=Gre(typeof F!="number"?F:Hre(F,YR)),W=O===oC?xLe:oC,re=n.rects.popper,le=n.elements[D?W:O],ie=h2e(uE(le)?le:le.contextElement||Zg(n.elements.popper),E,T,p),me=GS(n.elements.reference),q=Kre({reference:me,element:re,placement:l}),J=g5(Object.assign({},re,q)),Q=O===oC?J:me,ne={top:ie.top-Q.top+Y.top,bottom:Q.bottom-ie.bottom+Y.bottom,left:ie.left-Q.left+Y.left,right:Q.right-ie.right+Y.right},he=n.modifiersData.offset;if(O===oC&&he){var de=he[l];Object.keys(ne).forEach(function(pe){var Se=[Ed,yd].indexOf(pe)>=0?1:-1,Ie=[Il,yd].indexOf(pe)>=0?"y":"x";ne[pe]+=de[Ie]*Se})}return ne}function p2e(n,e){e===void 0&&(e={});var i=e,o=i.placement,l=i.boundary,u=i.rootBoundary,p=i.padding,y=i.flipVariations,E=i.allowedAutoPlacements,b=E===void 0?Fre:E,T=HS(o),R=T?y?qX:qX.filter(function(D){return HS(D)===T}):YR,O=R.filter(function(D){return b.indexOf(D)>=0});O.length===0&&(O=R);var L=O.reduce(function(D,U){return D[U]=bR(n,{placement:U,boundary:l,rootBoundary:u,padding:p})[Vp(U)],D},{});return Object.keys(L).sort(function(D,U){return L[D]-L[U]})}function f2e(n){if(Vp(n)===OF)return[];var e=GO(n);return[JX(n),e,JX(e)]}function m2e(n){var e=n.state,i=n.options,o=n.name;if(!e.modifiersData[o]._skip){for(var l=i.mainAxis,u=l===void 0?!0:l,p=i.altAxis,y=p===void 0?!0:p,E=i.fallbackPlacements,b=i.padding,T=i.boundary,R=i.rootBoundary,O=i.altBoundary,L=i.flipVariations,D=L===void 0?!0:L,U=i.allowedAutoPlacements,F=e.options.placement,Y=Vp(F),W=Y===F,re=E||(W||!D?[GO(F)]:f2e(F)),le=[F].concat(re).reduce(function(nt,dt){return nt.concat(Vp(dt)===OF?p2e(e,{placement:dt,boundary:T,rootBoundary:R,padding:b,flipVariations:D,allowedAutoPlacements:U}):dt)},[]),ie=e.rects.reference,me=e.rects.popper,q=new Map,J=!0,Q=le[0],ne=0;ne<le.length;ne++){var he=le[ne],de=Vp(he),pe=HS(he)===zS,Se=[Il,yd].indexOf(de)>=0,Ie=Se?"width":"height",Fe=bR(e,{placement:he,boundary:T,rootBoundary:R,altBoundary:O,padding:b}),we=Se?pe?Ed:Al:pe?yd:Il;ie[Ie]>me[Ie]&&(we=GO(we));var Re=GO(we),Te=[];if(u&&Te.push(Fe[de]<=0),y&&Te.push(Fe[we]<=0,Fe[Re]<=0),Te.every(function(nt){return nt})){Q=he,J=!1;break}q.set(he,Te)}if(J)for(var Ne=D?3:1,be=function(dt){var ft=le.find(function(lt){var gt=q.get(lt);if(gt)return gt.slice(0,dt).every(function(at){return at})});if(ft)return Q=ft,"break"},xe=Ne;xe>0;xe--){var je=be(xe);if(je==="break")break}e.placement!==Q&&(e.modifiersData[o]._skip=!0,e.placement=Q,e.reset=!0)}}const g2e={name:"flip",enabled:!0,phase:"main",fn:m2e,requiresIfExists:["offset"],data:{_skip:!1}};function ZX(n,e,i){return i===void 0&&(i={x:0,y:0}),{top:n.top-e.height-i.y,right:n.right-e.width+i.x,bottom:n.bottom-e.height+i.y,left:n.left-e.width-i.x}}function eJ(n){return[Il,Ed,yd,Al].some(function(e){return n[e]>=0})}function _2e(n){var e=n.state,i=n.name,o=e.rects.reference,l=e.rects.popper,u=e.modifiersData.preventOverflow,p=bR(e,{elementContext:"reference"}),y=bR(e,{altBoundary:!0}),E=ZX(p,o),b=ZX(y,l,u),T=eJ(E),R=eJ(b);e.modifiersData[i]={referenceClippingOffsets:E,popperEscapeOffsets:b,isReferenceHidden:T,hasPopperEscaped:R},e.attributes.popper=Object.assign({},e.attributes.popper,{"data-popper-reference-hidden":T,"data-popper-escaped":R})}const y2e={name:"hide",enabled:!0,phase:"main",requiresIfExists:["preventOverflow"],fn:_2e};function E2e(n,e,i){var o=Vp(n),l=[Al,Il].indexOf(o)>=0?-1:1,u=typeof i=="function"?i(Object.assign({},e,{placement:n})):i,p=u[0],y=u[1];return p=p||0,y=(y||0)*l,[Al,Ed].indexOf(o)>=0?{x:y,y:p}:{x:p,y}}function v2e(n){var e=n.state,i=n.options,o=n.name,l=i.offset,u=l===void 0?[0,0]:l,p=Fre.reduce(function(T,R){return T[R]=E2e(R,e.rects,u),T},{}),y=p[e.placement],E=y.x,b=y.y;e.modifiersData.popperOffsets!=null&&(e.modifiersData.popperOffsets.x+=E,e.modifiersData.popperOffsets.y+=b),e.modifiersData[o]=p}const S2e={name:"offset",enabled:!0,phase:"main",requires:["popperOffsets"],fn:v2e};function b2e(n){var e=n.state,i=n.name;e.modifiersData[i]=Kre({reference:e.rects.reference,element:e.rects.popper,placement:e.placement})}const w2e={name:"popperOffsets",enabled:!0,phase:"read",fn:b2e,data:{}};function T2e(n){return n==="x"?"y":"x"}function C2e(n){var e=n.state,i=n.options,o=n.name,l=i.mainAxis,u=l===void 0?!0:l,p=i.altAxis,y=p===void 0?!1:p,E=i.boundary,b=i.rootBoundary,T=i.altBoundary,R=i.padding,O=i.tether,L=O===void 0?!0:O,D=i.tetherOffset,U=D===void 0?0:D,F=bR(e,{boundary:E,rootBoundary:b,padding:R,altBoundary:T}),Y=Vp(e.placement),W=HS(e.placement),re=!W,le=xF(Y),ie=T2e(le),me=e.modifiersData.popperOffsets,q=e.rects.reference,J=e.rects.popper,Q=typeof U=="function"?U(Object.assign({},e.rects,{placement:e.placement})):U,ne=typeof Q=="number"?{mainAxis:Q,altAxis:Q}:Object.assign({mainAxis:0,altAxis:0},Q),he=e.modifiersData.offset?e.modifiersData.offset[e.placement]:null,de={x:0,y:0};if(me){if(u){var pe,Se=le==="y"?Il:Al,Ie=le==="y"?yd:Ed,Fe=le==="y"?"height":"width",we=me[le],Re=we+F[Se],Te=we-F[Ie],Ne=L?-J[Fe]/2:0,be=W===zS?q[Fe]:J[Fe],xe=W===zS?-J[Fe]:-q[Fe],je=e.elements.arrow,nt=L&&je?NF(je):{width:0,height:0},dt=e.modifiersData["arrow#persistent"]?e.modifiersData["arrow#persistent"].padding:Wre(),ft=dt[Se],lt=dt[Ie],gt=$C(0,q[Fe],nt[Fe]),at=re?q[Fe]/2-Ne-gt-ft-ne.mainAxis:be-gt-ft-ne.mainAxis,Ct=re?-q[Fe]/2+Ne+gt+lt+ne.mainAxis:xe+gt+lt+ne.mainAxis,En=e.elements.arrow&&XR(e.elements.arrow),Gt=En?le==="y"?En.clientTop||0:En.clientLeft||0:0,Jt=(pe=he==null?void 0:he[le])!=null?pe:0,st=we+at-Jt-Gt,hn=we+Ct-Jt,an=$C(L?Tk(Re,st):Re,we,L?Qy(Te,hn):Te);me[le]=an,de[le]=an-we}if(y){var Ft,on=le==="x"?Il:Al,bt=le==="x"?yd:Ed,ve=me[ie],De=ie==="y"?"height":"width",qe=ve+F[on],Ot=ve-F[bt],vt=[Il,Al].indexOf(Y)!==-1,Pt=(Ft=he==null?void 0:he[ie])!=null?Ft:0,Ut=vt?qe:ve-q[De]-J[De]-Pt+ne.altAxis,cn=vt?ve+q[De]+J[De]-Pt-ne.altAxis:Ot,_t=L&&vt?YLe(Ut,ve,cn):$C(L?Ut:qe,ve,L?cn:Ot);me[ie]=_t,de[ie]=_t-ve}e.modifiersData[o]=de}}const R2e={name:"preventOverflow",enabled:!0,phase:"main",fn:C2e,requiresIfExists:["offset"]};function I2e(n){return{scrollLeft:n.scrollLeft,scrollTop:n.scrollTop}}function A2e(n){return n===vu(n)||!fd(n)?DF(n):I2e(n)}function P2e(n){var e=n.getBoundingClientRect(),i=WS(e.width)/n.offsetWidth||1,o=WS(e.height)/n.offsetHeight||1;return i!==1||o!==1}function O2e(n,e,i){i===void 0&&(i=!1);var o=fd(e),l=fd(e)&&P2e(e),u=Zg(e),p=GS(n,l,i),y={scrollLeft:0,scrollTop:0},E={x:0,y:0};return(o||!o&&!i)&&((Hp(e)!=="body"||MF(u))&&(y=A2e(e)),fd(e)?(E=GS(e,!0),E.x+=e.clientLeft,E.y+=e.clientTop):u&&(E.x=LF(u))),{x:p.left+y.scrollLeft-E.x,y:p.top+y.scrollTop-E.y,width:p.width,height:p.height}}function k2e(n){var e=new Map,i=new Set,o=[];n.forEach(function(u){e.set(u.name,u)});function l(u){i.add(u.name);var p=[].concat(u.requires||[],u.requiresIfExists||[]);p.forEach(function(y){if(!i.has(y)){var E=e.get(y);E&&l(E)}}),o.push(u)}return n.forEach(function(u){i.has(u.name)||l(u)}),o}function N2e(n){var e=k2e(n);return WLe.reduce(function(i,o){return i.concat(e.filter(function(l){return l.phase===o}))},[])}function x2e(n){var e;return function(){return e||(e=new Promise(function(i){Promise.resolve().then(function(){e=void 0,i(n())})})),e}}function D2e(n){var e=n.reduce(function(i,o){var l=i[o.name];return i[o.name]=l?Object.assign({},l,o,{options:Object.assign({},l.options,o.options),data:Object.assign({},l.data,o.data)}):o,i},{});return Object.keys(e).map(function(i){return e[i]})}var tJ={placement:"bottom",modifiers:[],strategy:"absolute"};function nJ(){for(var n=arguments.length,e=new Array(n),i=0;i<n;i++)e[i]=arguments[i];return!e.some(function(o){return!(o&&typeof o.getBoundingClientRect=="function")})}function L2e(n){n===void 0&&(n={});var e=n,i=e.defaultModifiers,o=i===void 0?[]:i,l=e.defaultOptions,u=l===void 0?tJ:l;return function(y,E,b){b===void 0&&(b=u);var T={placement:"bottom",orderedModifiers:[],options:Object.assign({},tJ,u),modifiersData:{},elements:{reference:y,popper:E},attributes:{},styles:{}},R=[],O=!1,L={state:T,setOptions:function(Y){var W=typeof Y=="function"?Y(T.options):Y;U(),T.options=Object.assign({},u,T.options,W),T.scrollParents={reference:uE(y)?KC(y):y.contextElement?KC(y.contextElement):[],popper:KC(E)};var re=N2e(D2e([].concat(o,T.options.modifiers)));return T.orderedModifiers=re.filter(function(le){return le.enabled}),D(),L.update()},forceUpdate:function(){if(!O){var Y=T.elements,W=Y.reference,re=Y.popper;if(nJ(W,re)){T.rects={reference:O2e(W,XR(re),T.options.strategy==="fixed"),popper:NF(re)},T.reset=!1,T.placement=T.options.placement,T.orderedModifiers.forEach(function(ne){return T.modifiersData[ne.name]=Object.assign({},ne.data)});for(var le=0;le<T.orderedModifiers.length;le++){if(T.reset===!0){T.reset=!1,le=-1;continue}var ie=T.orderedModifiers[le],me=ie.fn,q=ie.options,J=q===void 0?{}:q,Q=ie.name;typeof me=="function"&&(T=me({state:T,options:J,name:Q,instance:L})||T)}}}},update:x2e(function(){return new Promise(function(F){L.forceUpdate(),F(T)})}),destroy:function(){U(),O=!0}};if(!nJ(y,E))return L;L.setOptions(b).then(function(F){!O&&b.onFirstUpdate&&b.onFirstUpdate(F)});function D(){T.orderedModifiers.forEach(function(F){var Y=F.name,W=F.options,re=W===void 0?{}:W,le=F.effect;if(typeof le=="function"){var ie=le({state:T,name:Y,instance:L,options:re}),me=function(){};R.push(ie||me)}})}function U(){R.forEach(function(F){return F()}),R=[]}return L}}var M2e=[s2e,w2e,r2e,$Le,S2e,g2e,R2e,ZLe,y2e],U2e=L2e({defaultModifiers:M2e});const F0=(n,e)=>({var:n,varRef:e?`var(${n}, ${e})`:`var(${n})`}),Oo={arrowShadowColor:F0("--popper-arrow-shadow-color"),arrowSize:F0("--popper-arrow-size","8px"),arrowSizeHalf:F0("--popper-arrow-size-half"),arrowBg:F0("--popper-arrow-bg"),transformOrigin:F0("--popper-transform-origin"),arrowOffset:F0("--popper-arrow-offset")};function V2e(n){if(n.includes("top"))return"1px 1px 0px 0 var(--popper-arrow-shadow-color)";if(n.includes("bottom"))return"-1px -1px 0px 0 var(--popper-arrow-shadow-color)";if(n.includes("right"))return"-1px 1px 0px 0 var(--popper-arrow-shadow-color)";if(n.includes("left"))return"1px -1px 0px 0 var(--popper-arrow-shadow-color)"}const j2e={top:"bottom center","top-start":"bottom left","top-end":"bottom right",bottom:"top center","bottom-start":"top left","bottom-end":"top right",left:"right center","left-start":"right top","left-end":"right bottom",right:"left center","right-start":"left top","right-end":"left bottom"},F2e=n=>j2e[n],rJ={scroll:!0,resize:!0};function B2e(n){let e;return typeof n=="object"?e={enabled:!0,options:{...rJ,...n}}:e={enabled:n,options:rJ},e}const z2e={name:"matchWidth",enabled:!0,phase:"beforeWrite",requires:["computeStyles"],fn:({state:n})=>{n.styles.popper.width=`${n.rects.reference.width}px`},effect:({state:n})=>()=>{const e=n.elements.reference;n.elements.popper.style.width=`${e.offsetWidth}px`}},W2e={name:"transformOrigin",enabled:!0,phase:"write",fn:({state:n})=>{iJ(n)},effect:({state:n})=>()=>{iJ(n)}},iJ=n=>{n.elements.popper.style.setProperty(Oo.transformOrigin.var,F2e(n.placement))},G2e={name:"positionArrow",enabled:!0,phase:"afterWrite",fn:({state:n})=>{H2e(n)}},H2e=n=>{var i;if(!n.placement)return;const e=$2e(n.placement);if((i=n.elements)!=null&&i.arrow&&e){Object.assign(n.elements.arrow.style,{[e.property]:e.value,width:Oo.arrowSize.varRef,height:Oo.arrowSize.varRef,zIndex:-1});const o={[Oo.arrowSizeHalf.var]:`calc(${Oo.arrowSize.varRef} / 2 - 1px)`,[Oo.arrowOffset.var]:`calc(${Oo.arrowSizeHalf.varRef} * -1)`};for(const l in o)n.elements.arrow.style.setProperty(l,o[l])}},$2e=n=>{if(n.startsWith("top"))return{property:"bottom",value:Oo.arrowOffset.varRef};if(n.startsWith("bottom"))return{property:"top",value:Oo.arrowOffset.varRef};if(n.startsWith("left"))return{property:"right",value:Oo.arrowOffset.varRef};if(n.startsWith("right"))return{property:"left",value:Oo.arrowOffset.varRef}},K2e={name:"innerArrow",enabled:!0,phase:"main",requires:["arrow"],fn:({state:n})=>{sJ(n)},effect:({state:n})=>()=>{sJ(n)}},sJ=n=>{if(!n.elements.arrow)return;const e=n.elements.arrow.querySelector("[data-popper-arrow-inner]");if(!e)return;const i=V2e(n.placement);i&&e.style.setProperty("--popper-arrow-default-shadow",i),Object.assign(e.style,{transform:"rotate(45deg)",background:Oo.arrowBg.varRef,top:0,left:0,width:"100%",height:"100%",position:"absolute",zIndex:"inherit",boxShadow:"var(--popper-arrow-shadow, var(--popper-arrow-default-shadow))"})},q2e={"start-start":{ltr:"left-start",rtl:"right-start"},"start-end":{ltr:"left-end",rtl:"right-end"},"end-start":{ltr:"right-start",rtl:"left-start"},"end-end":{ltr:"right-end",rtl:"left-end"},start:{ltr:"left",rtl:"right"},end:{ltr:"right",rtl:"left"}},Y2e={"auto-start":"auto-end","auto-end":"auto-start","top-start":"top-end","top-end":"top-start","bottom-start":"bottom-end","bottom-end":"bottom-start"};function X2e(n,e="ltr"){var o;const i=((o=q2e[n])==null?void 0:o[e])||n;return e==="ltr"?i:Y2e[n]??i}function UF(n={}){const{enabled:e=!0,modifiers:i,placement:o="bottom",strategy:l="absolute",arrowPadding:u=8,eventListeners:p=!0,offset:y,gutter:E=8,flip:b=!0,boundary:T="clippingParents",preventOverflow:R=!0,matchWidth:O,direction:L="ltr"}=n,D=k.useRef(null),U=k.useRef(null),F=k.useRef(null),Y=X2e(o,L),W=k.useRef(()=>{}),re=k.useCallback(()=>{var ne;!e||!D.current||!U.current||((ne=W.current)==null||ne.call(W),F.current=U2e(D.current,U.current,{placement:Y,modifiers:[K2e,G2e,W2e,{...z2e,enabled:!!O},{name:"eventListeners",...B2e(p)},{name:"arrow",options:{padding:u}},{name:"offset",options:{offset:y??[0,E]}},{name:"flip",enabled:!!b,options:{padding:8}},{name:"preventOverflow",enabled:!!R,options:{boundary:T}},...i??[]],strategy:l}),F.current.forceUpdate(),W.current=F.current.destroy)},[Y,e,i,O,p,u,y,E,b,R,T,l]);k.useEffect(()=>()=>{var ne;!D.current&&!U.current&&((ne=F.current)==null||ne.destroy(),F.current=null)},[]);const le=k.useCallback(ne=>{D.current=ne,re()},[re]),ie=k.useCallback((ne={},he=null)=>({...ne,ref:Yi(le,he)}),[le]),me=k.useCallback(ne=>{U.current=ne,re()},[re]),q=k.useCallback((ne={},he=null)=>({...ne,ref:Yi(me,he),style:{...ne.style,position:l,minWidth:O?void 0:"max-content",inset:"0 auto auto 0"}}),[l,me,O]),J=k.useCallback((ne={},he=null)=>{const{size:de,shadowColor:pe,bg:Se,style:Ie,...Fe}=ne;return{...Fe,ref:he,"data-popper-arrow":"",style:J2e(ne)}},[]),Q=k.useCallback((ne={},he=null)=>({...ne,ref:he,"data-popper-arrow-inner":""}),[]);return{update(){var ne;(ne=F.current)==null||ne.update()},forceUpdate(){var ne;(ne=F.current)==null||ne.forceUpdate()},transformOrigin:Oo.transformOrigin.varRef,referenceRef:le,popperRef:me,getPopperProps:q,getArrowProps:J,getArrowInnerProps:Q,getReferenceProps:ie}}function J2e(n){const{size:e,shadowColor:i,bg:o,style:l}=n,u={...l,position:"absolute"};return e&&(u["--popper-arrow-size"]=e),i&&(u["--popper-arrow-shadow-color"]=i),o&&(u["--popper-arrow-bg"]=o),u}function Q2e(){const n=k.useRef(new Map),e=n.current,i=k.useCallback((l,u,p,y)=>{n.current.set(p,{type:u,el:l,options:y}),l.addEventListener(u,p,y)},[]),o=k.useCallback((l,u,p,y)=>{l.removeEventListener(u,p,y),n.current.delete(p)},[]);return k.useEffect(()=>()=>{e.forEach((l,u)=>{o(l.el,l.type,u,l.options)})},[o,e]),{add:i,remove:o}}function QU(n){var l,u;const e=((u=(l=n.composedPath)==null?void 0:l.call(n))==null?void 0:u[0])??n.target,{tagName:i,isContentEditable:o}=e;return i!=="INPUT"&&i!=="TEXTAREA"&&o!==!0}function qre(n={}){const{ref:e,isDisabled:i,isFocusable:o,clickOnEnter:l=!0,clickOnSpace:u=!0,onMouseDown:p,onMouseUp:y,onClick:E,onKeyDown:b,onKeyUp:T,tabIndex:R,onMouseOver:O,onMouseLeave:L,...D}=n,[U,F]=k.useState(!0),[Y,W]=k.useState(!1),re=Q2e(),le=we=>{we&&we.tagName!=="BUTTON"&&F(!1)},ie=U?R:R||0,me=i&&!o,q=k.useCallback(we=>{if(i){we.stopPropagation(),we.preventDefault();return}we.currentTarget.focus(),E==null||E(we)},[i,E]),J=k.useCallback(we=>{Y&&QU(we)&&(we.preventDefault(),we.stopPropagation(),W(!1),re.remove(document,"keyup",J,!1))},[Y,re]),Q=k.useCallback(we=>{if(b==null||b(we),i||we.defaultPrevented||we.metaKey||!QU(we.nativeEvent)||U)return;const Re=l&&we.key==="Enter";u&&we.key===" "&&(we.preventDefault(),W(!0)),Re&&(we.preventDefault(),we.currentTarget.click()),re.add(document,"keyup",J,!1)},[i,U,b,l,u,re,J]),ne=k.useCallback(we=>{if(T==null||T(we),i||we.defaultPrevented||we.metaKey||!QU(we.nativeEvent)||U)return;u&&we.key===" "&&(we.preventDefault(),W(!1),we.currentTarget.click())},[u,U,i,T]),he=k.useCallback(we=>{we.button===0&&(W(!1),re.remove(document,"mouseup",he,!1))},[re]),de=k.useCallback(we=>{if(we.button!==0)return;if(i){we.stopPropagation(),we.preventDefault();return}U||W(!0),we.currentTarget.focus({preventScroll:!0}),re.add(document,"mouseup",he,!1),p==null||p(we)},[i,U,p,re,he]),pe=k.useCallback(we=>{we.button===0&&(U||W(!1),y==null||y(we))},[y,U]),Se=k.useCallback(we=>{if(i){we.preventDefault();return}O==null||O(we)},[i,O]),Ie=k.useCallback(we=>{Y&&(we.preventDefault(),W(!1)),L==null||L(we)},[Y,L]),Fe=Yi(e,le);return U?{...D,ref:Fe,type:"button","aria-disabled":me?void 0:i,disabled:me,onClick:q,onMouseDown:p,onMouseUp:y,onKeyUp:T,onKeyDown:b,onMouseOver:O,onMouseLeave:L}:{...D,ref:Fe,role:"button","data-active":pr(Y),"aria-disabled":i?"true":void 0,tabIndex:me?void 0:ie,onClick:q,onMouseDown:de,onMouseUp:pe,onKeyUp:ne,onKeyDown:Q,onMouseOver:Se,onMouseLeave:Ie}}const[Z2e,eMe,tMe,nMe]=Kne(),[rMe,JR]=xi({strict:!1,name:"MenuContext"});function Yre(n){return(n==null?void 0:n.ownerDocument)??document}function iMe(n){return Yre(n).activeElement===n}function sMe(n={}){const{id:e,closeOnSelect:i=!0,closeOnBlur:o=!0,initialFocusRef:l,autoSelect:u=!0,isLazy:p,isOpen:y,defaultIsOpen:E,onClose:b,onOpen:T,placement:R="bottom-start",lazyBehavior:O="unmount",direction:L,computePositionOnMount:D=!1,...U}=n,F=k.useRef(null),Y=k.useRef(null),W=k.useRef(!0),re=tMe(),le=k.useCallback(()=>{requestAnimationFrame(()=>{var je;(je=F.current)==null||je.focus({preventScroll:!1})})},[]),ie=k.useCallback(()=>{const je=setTimeout(()=>{var nt,dt;if(l)(nt=l.current)==null||nt.focus();else if(!re.count())(dt=F.current)==null||dt.focus({preventScroll:!1});else{const ft=re.firstEnabled();ft&&Se(ft.index)}});Te.current.add(je)},[re,l]),me=k.useCallback(()=>{const je=setTimeout(()=>{var nt;if(!re.count())(nt=F.current)==null||nt.focus({preventScroll:!1});else{const dt=re.lastEnabled();dt&&Se(dt.index)}});Te.current.add(je)},[re]),q=k.useCallback(()=>{T==null||T(),u?ie():le()},[u,ie,le,T]),{isOpen:J,onOpen:Q,onClose:ne,onToggle:he}=yu({isOpen:y,defaultIsOpen:E,onClose:b,onOpen:q});Cee({enabled:J&&o,ref:F,handler:je=>{var dt,ft,lt;const nt=((ft=(dt=je.composedPath)==null?void 0:dt.call(je))==null?void 0:ft[0])??je.target;(lt=Y.current)!=null&&lt.contains(nt)||ne()}});const de=UF({...U,enabled:J||D,placement:R,direction:L}),[pe,Se]=k.useState(-1);bee(F,{focusRef:Y,visible:J,shouldFocus:!0});const Ie=Eee({isOpen:J,ref:F}),[Fe,we]=r0e(e,"menu-button","menu-list"),Re=k.useCallback(()=>{Q(),le()},[Q,le]),Te=k.useRef(new Set([]));k.useEffect(()=>{const je=Te.current;return()=>{je.forEach(nt=>clearTimeout(nt)),je.clear()}},[]),Xf(()=>{var je;J||(Se(-1),(je=F.current)==null||je.scrollTo(0,0))},[J]),Xf(()=>{J&&pe===-1&&le()},[pe,J]),k.useEffect(()=>{var nt;if(!J)return;const je=re.item(pe);(nt=je==null?void 0:je.node)==null||nt.focus({preventScroll:!W.current})},[re,pe,J]);const Ne=k.useCallback(()=>{Q(),ie()},[ie,Q]),be=k.useCallback(()=>{W.current=!0,Q(),me()},[Q,me]),xe=k.useCallback(()=>{var lt,gt;const je=Yre(F.current),nt=(lt=F.current)==null?void 0:lt.contains(je.activeElement);if(!(J&&!nt))return;const ft=(gt=re.item(pe))==null?void 0:gt.node;ft==null||ft.focus({preventScroll:!W.current})},[J,pe,re]);return{openAndFocusMenu:Re,openAndFocusFirstItem:Ne,openAndFocusLastItem:be,onTransitionEnd:xe,unstable__animationState:Ie,descendants:re,popper:de,buttonId:Fe,menuId:we,forceUpdate:de.forceUpdate,orientation:"vertical",isOpen:J,onToggle:he,onOpen:Q,onClose:ne,menuRef:F,buttonRef:Y,focusedIndex:pe,closeOnSelect:i,closeOnBlur:o,autoSelect:u,setFocusedIndex:Se,isLazy:p,lazyBehavior:O,initialFocusRef:l,scrollIntoViewRef:W}}function oMe(n={},e=null){const i=JR(),{onToggle:o,popper:l,openAndFocusFirstItem:u,openAndFocusLastItem:p,scrollIntoViewRef:y}=i,E=k.useCallback(b=>{const T=b.key,O={Enter:u,ArrowDown:u,ArrowUp:p}[T];O&&(y.current=!0,b.preventDefault(),b.stopPropagation(),O(b))},[u,p,y]);return{...n,ref:Yi(i.buttonRef,e,l.referenceRef),id:i.buttonId,"data-active":pr(i.isOpen),"aria-expanded":i.isOpen,"aria-haspopup":"menu","aria-controls":i.menuId,onClick:jn(n.onClick,o),onKeyDown:jn(n.onKeyDown,E)}}function _5(n){var e;return uMe(n)&&!!((e=n==null?void 0:n.getAttribute("role"))!=null&&e.startsWith("menuitem"))}function aMe(n={},e=null){const i=JR();if(!i)throw new Error("useMenuContext: context is undefined. Seems you forgot to wrap component within <Menu>");const{focusedIndex:o,setFocusedIndex:l,menuRef:u,isOpen:p,onClose:y,menuId:E,isLazy:b,lazyBehavior:T,scrollIntoViewRef:R,unstable__animationState:O}=i,L=eMe(),D=kLe({preventDefault:W=>W.key!==" "&&_5(W.target)}),U=k.useCallback(W=>{if(!W.currentTarget.contains(W.target))return;const re=W.key,ie={Tab:q=>q.preventDefault(),Escape:q=>{q.stopPropagation(),y()},ArrowDown:()=>{R.current=!0;const q=L.nextEnabled(o)??L.firstEnabled();q&&l(q.index)},ArrowUp:()=>{R.current=!0;const q=L.prevEnabled(o)??L.firstEnabled();q&&l(q.index)}}[re];if(ie){W.preventDefault(),ie(W);return}const me=D(q=>{const J=PLe(L.values(),q,Q=>{var ne;return((ne=Q==null?void 0:Q.node)==null?void 0:ne.textContent)??""},L.item(o));if(J){const Q=L.indexOf(J.node);l(Q)}});_5(W.target)&&me(W)},[L,o,D,y,l,R]),F=k.useRef(!1);p&&(F.current=!0);const Y=aj({wasSelected:F.current,enabled:b,mode:T,isSelected:O.present});return{...n,ref:Yi(u,e),children:Y?n.children:null,tabIndex:-1,role:"menu",id:E,style:{...n.style,transformOrigin:"var(--popper-transform-origin)"},"aria-orientation":"vertical",onKeyDown:jn(n.onKeyDown,U)}}function cMe(n={}){const{popper:e,isOpen:i}=JR();return e.getPopperProps({...n,style:{visibility:i?"visible":"hidden",...n.style}})}function lMe(n={},e=null){const{onMouseEnter:i,onMouseMove:o,onMouseLeave:l,onClick:u,onFocus:p,isDisabled:y,isFocusable:E,closeOnSelect:b,type:T,...R}=n,O=JR(),{setFocusedIndex:L,focusedIndex:D,closeOnSelect:U,onClose:F,menuId:Y,scrollIntoViewRef:W}=O,re=k.useRef(null),le=`${Y}-menuitem-${k.useId()}`,{index:ie,register:me}=nMe({disabled:y&&!E}),q=k.useCallback(Se=>{i==null||i(Se),!y&&(W.current=!1,L(ie))},[L,ie,y,i,W]),J=k.useCallback(Se=>{o==null||o(Se),re.current&&!iMe(re.current)&&q(Se)},[q,o]),Q=k.useCallback(Se=>{l==null||l(Se),!y&&L(-1)},[L,y,l]),ne=k.useCallback(Se=>{u==null||u(Se),_5(Se.currentTarget)&&(b??U)&&F()},[F,u,U,b]),he=k.useCallback(Se=>{p==null||p(Se),L(ie)},[L,p,ie]),de=ie===D,pe=qre({onClick:ne,onFocus:he,onMouseEnter:q,onMouseMove:J,onMouseLeave:Q,ref:Yi(me,re,e),isDisabled:y,isFocusable:E});return{...R,...pe,type:T??pe.type,id:le,role:"menuitem",tabIndex:de?0:-1}}function uMe(n){if(!dMe(n))return!1;const e=n.ownerDocument.defaultView??window;return n instanceof e.HTMLElement}function dMe(n){return n!=null&&typeof n=="object"&&"nodeType"in n&&n.nodeType===Node.ELEMENT_NODE}const[hMe,QR]=xi({name:"MenuStylesContext",errorMessage:`useMenuStyles returned is 'undefined'. Seems you forgot to wrap the components in "<Menu />" `}),SE=n=>{const{children:e}=n,i=za("Menu",n),o=Bi(n),{direction:l}=lb(),{descendants:u,...p}=sMe({...o,direction:l}),y=k.useMemo(()=>p,[p]),{isOpen:E,onClose:b,forceUpdate:T}=y;return S.jsx(Z2e,{value:u,children:S.jsx(rMe,{value:y,children:S.jsx(hMe,{value:i,children:Cl(e,{isOpen:E,onClose:b,forceUpdate:T})})})})};SE.displayName="Menu";const pMe=jt((n,e)=>{const i=QR();return S.jsx(Lt.button,{ref:e,...n,__css:{display:"inline-flex",appearance:"none",alignItems:"center",outline:0,...i.button}})}),bE=jt((n,e)=>{const{children:i,as:o,...l}=n,u=oMe(l,e),p=o||pMe;return S.jsx(p,{...u,className:Sn("chakra-menu__menu-button",n.className),children:S.jsx(Lt.span,{__css:{pointerEvents:"none",flex:"1 1 auto",minW:0},children:n.children})})});bE.displayName="MenuButton";const Xre=jt((n,e)=>{const i=QR();return S.jsx(Lt.span,{ref:e,...n,__css:i.command,className:"chakra-menu__command"})});Xre.displayName="MenuCommand";const Jre=n=>{const{className:e,children:i,...o}=n,l=QR(),u=k.Children.only(i),p=k.isValidElement(u)?k.cloneElement(u,{focusable:"false","aria-hidden":!0,className:Sn("chakra-menu__icon",u.props.className)}):null,y=Sn("chakra-menu__icon-wrapper",e);return S.jsx(Lt.span,{className:y,...o,__css:l.icon,children:p})};Jre.displayName="MenuIcon";const fMe=jt((n,e)=>{const{type:i,...o}=n,l=QR(),u=o.as||i?i??void 0:"button",p=k.useMemo(()=>({textDecoration:"none",color:"inherit",userSelect:"none",display:"flex",width:"100%",alignItems:"center",textAlign:"start",flex:"0 0 auto",outline:0,...l.item}),[l.item]);return S.jsx(Lt.button,{ref:e,type:u,...o,__css:p})}),fh=jt((n,e)=>{const{icon:i,iconSpacing:o="0.75rem",command:l,commandSpacing:u="0.75rem",children:p,...y}=n,E=lMe(y,e),T=i||l?S.jsx("span",{style:{pointerEvents:"none",flex:1},children:p}):p;return S.jsxs(fMe,{...E,className:Sn("chakra-menu__menuitem",E.className),children:[i&&S.jsx(Jre,{fontSize:"0.8em",marginEnd:o,children:i}),T,l&&S.jsx(Xre,{marginStart:u,children:l})]})});fh.displayName="MenuItem";const mMe={enter:{visibility:"visible",opacity:1,scale:1,transition:{duration:.2,ease:[.4,0,.2,1]}},exit:{transitionEnd:{visibility:"hidden"},opacity:0,scale:.8,transition:{duration:.1,easings:"easeOut"}}},gMe=Lt(wh.div),wE=jt(function(e,i){var O;const{rootProps:o,motionProps:l,...u}=e,{isOpen:p,onTransitionEnd:y,unstable__animationState:E}=JR(),b=aMe(u,i),T=cMe(o),R=QR();return S.jsx(Lt.div,{...T,__css:{zIndex:e.zIndex??((O=R.list)==null?void 0:O.zIndex)},children:S.jsx(gMe,{variants:mMe,initial:!1,animate:p?"enter":"exit",__css:{outline:0,...R.list},...l,...b,className:Sn("chakra-menu__menu-list",b.className),onUpdate:y,onAnimationComplete:pee(E.onComplete,b.onAnimationComplete)})})});wE.displayName="MenuList";var _Me=function(n){if(typeof document>"u")return null;var e=Array.isArray(n)?n[0]:n;return e.ownerDocument.body},B0=new WeakMap,uO=new WeakMap,dO={},ZU=0,Qre=function(n){return n&&(n.host||Qre(n.parentNode))},yMe=function(n,e){return e.map(function(i){if(n.contains(i))return i;var o=Qre(i);return o&&n.contains(o)?o:(console.error("aria-hidden",i,"in not contained inside",n,". Doing nothing"),null)}).filter(function(i){return!!i})},EMe=function(n,e,i,o){var l=yMe(e,Array.isArray(n)?n:[n]);dO[i]||(dO[i]=new WeakMap);var u=dO[i],p=[],y=new Set,E=new Set(l),b=function(R){!R||y.has(R)||(y.add(R),b(R.parentNode))};l.forEach(b);var T=function(R){!R||E.has(R)||Array.prototype.forEach.call(R.children,function(O){if(y.has(O))T(O);else try{var L=O.getAttribute(o),D=L!==null&&L!=="false",U=(B0.get(O)||0)+1,F=(u.get(O)||0)+1;B0.set(O,U),u.set(O,F),p.push(O),U===1&&D&&uO.set(O,!0),F===1&&O.setAttribute(i,"true"),D||O.setAttribute(o,"true")}catch(Y){console.error("aria-hidden: cannot operate on ",O,Y)}})};return T(e),y.clear(),ZU++,function(){p.forEach(function(R){var O=B0.get(R)-1,L=u.get(R)-1;B0.set(R,O),u.set(R,L),O||(uO.has(R)||R.removeAttribute(o),uO.delete(R)),L||R.removeAttribute(i)}),ZU--,ZU||(B0=new WeakMap,B0=new WeakMap,uO=new WeakMap,dO={})}},vMe=function(n,e,i){i===void 0&&(i="data-aria-hidden");var o=Array.from(Array.isArray(n)?n:[n]),l=_Me(n);return l?(o.push.apply(o,Array.from(l.querySelectorAll("[aria-live], script"))),EMe(o,l,i,"aria-hidden")):function(){return null}},SMe=Object.defineProperty,bMe=(n,e,i)=>e in n?SMe(n,e,{enumerable:!0,configurable:!0,writable:!0,value:i}):n[e]=i,wMe=(n,e,i)=>(bMe(n,e+"",i),i);class TMe{constructor(){wMe(this,"modals"),this.modals=new Set}add(e){return this.modals.add(e),this.modals.size}remove(e){this.modals.delete(e)}isTopModal(e){if(!e)return!1;const i=Array.from(this.modals)[this.modals.size-1];return e===i}}const y5=new TMe;function Zre(n,e){const[i,o]=k.useState(0);return k.useEffect(()=>{const l=n.current;if(l){if(e){const u=y5.add(l);o(u)}return()=>{y5.remove(l),o(0)}}},[e,n]),i}function CMe(n){const{isOpen:e,onClose:i,id:o,closeOnOverlayClick:l=!0,closeOnEsc:u=!0,useInert:p=!0,onOverlayClick:y,onEsc:E}=n,b=k.useRef(null),T=k.useRef(null),[R,O,L]=IMe(o,"chakra-modal","chakra-modal--header","chakra-modal--body");RMe(b,e&&p);const D=Zre(b,e),U=k.useRef(null),F=k.useCallback(Q=>{U.current=Q.target},[]),Y=k.useCallback(Q=>{Q.key==="Escape"&&(Q.stopPropagation(),u&&(i==null||i()),E==null||E())},[u,i,E]),[W,re]=k.useState(!1),[le,ie]=k.useState(!1),me=k.useCallback((Q={},ne=null)=>({role:"dialog",...Q,ref:Yi(ne,b),id:R,tabIndex:-1,"aria-modal":!0,"aria-labelledby":W?O:void 0,"aria-describedby":le?L:void 0,onClick:jn(Q.onClick,he=>he.stopPropagation())}),[L,le,R,O,W]),q=k.useCallback(Q=>{Q.stopPropagation(),U.current===Q.target&&y5.isTopModal(b.current)&&(l&&(i==null||i()),y==null||y())},[i,l,y]),J=k.useCallback((Q={},ne=null)=>({...Q,ref:Yi(ne,T),onClick:jn(Q.onClick,q),onKeyDown:jn(Q.onKeyDown,Y),onMouseDown:jn(Q.onMouseDown,F)}),[Y,F,q]);return{isOpen:e,onClose:i,headerId:O,bodyId:L,setBodyMounted:ie,setHeaderMounted:re,dialogRef:b,overlayRef:T,getDialogProps:me,getDialogContainerProps:J,index:D}}function RMe(n,e){const i=n.current;k.useEffect(()=>{if(!(!n.current||!e))return vMe(n.current)},[e,n,i])}function IMe(n,...e){const i=k.useId(),o=n||i;return k.useMemo(()=>e.map(l=>`${l}-${o}`),[o,e])}const[AMe,db]=xi({name:"ModalStylesContext",errorMessage:`useModalStyles returned is 'undefined'. Seems you forgot to wrap the components in "<Modal />" `}),[PMe,dE]=xi({strict:!0,name:"ModalContext",errorMessage:"useModalContext: `context` is undefined. Seems you forgot to wrap modal components in `<Modal />`"}),_s=n=>{const e={scrollBehavior:"outside",autoFocus:!0,trapFocus:!0,returnFocusOnClose:!0,blockScrollOnMount:!0,allowPinchZoom:!1,preserveScrollBarGap:!0,motionPreset:"scale",...n,lockFocusAcrossFrames:n.lockFocusAcrossFrames??!0},{portalProps:i,children:o,autoFocus:l,trapFocus:u,initialFocusRef:p,finalFocusRef:y,returnFocusOnClose:E,blockScrollOnMount:b,allowPinchZoom:T,preserveScrollBarGap:R,motionPreset:O,lockFocusAcrossFrames:L,animatePresenceProps:D,onCloseComplete:U}=e,F=za("Modal",e),W={...CMe(e),autoFocus:l,trapFocus:u,initialFocusRef:p,finalFocusRef:y,returnFocusOnClose:E,blockScrollOnMount:b,allowPinchZoom:T,preserveScrollBarGap:R,motionPreset:O,lockFocusAcrossFrames:L};return S.jsx(PMe,{value:W,children:S.jsx(AMe,{value:F,children:S.jsx(EE,{...D,onExitComplete:U,children:W.isOpen&&S.jsx(Bc,{...i,children:o})})})})};_s.displayName="Modal";var HO="right-scroll-bar-position",$O="width-before-scroll-bar",OMe="with-scroll-bars-hidden",kMe="--removed-body-scroll-bar-size",eie=ore(),eV=function(){},wN=k.forwardRef(function(n,e){var i=k.useRef(null),o=k.useState({onScrollCapture:eV,onWheelCapture:eV,onTouchMoveCapture:eV}),l=o[0],u=o[1],p=n.forwardProps,y=n.children,E=n.className,b=n.removeScrollBar,T=n.enabled,R=n.shards,O=n.sideCar,L=n.noRelative,D=n.noIsolation,U=n.inert,F=n.allowPinchZoom,Y=n.as,W=Y===void 0?"div":Y,re=n.gapMode,le=qR(n,["forwardProps","children","className","removeScrollBar","enabled","shards","sideCar","noRelative","noIsolation","inert","allowPinchZoom","as","gapMode"]),ie=O,me=rre([i,e]),q=Pp(Pp({},le),l);return k.createElement(k.Fragment,null,T&&k.createElement(ie,{sideCar:eie,removeScrollBar:b,shards:R,noRelative:L,noIsolation:D,inert:U,setCallbacks:u,allowPinchZoom:!!F,lockRef:i,gapMode:re}),p?k.cloneElement(k.Children.only(y),Pp(Pp({},q),{ref:me})):k.createElement(W,Pp({},q,{className:E,ref:me}),y))});wN.defaultProps={enabled:!0,removeScrollBar:!0,inert:!1};wN.classNames={fullWidth:$O,zeroRight:HO};var NMe=function(){if(typeof __webpack_nonce__<"u")return __webpack_nonce__};function xMe(){if(!document)return null;var n=document.createElement("style");n.type="text/css";var e=NMe();return e&&n.setAttribute("nonce",e),n}function DMe(n,e){n.styleSheet?n.styleSheet.cssText=e:n.appendChild(document.createTextNode(e))}function LMe(n){var e=document.head||document.getElementsByTagName("head")[0];e.appendChild(n)}var MMe=function(){var n=0,e=null;return{add:function(i){n==0&&(e=xMe())&&(DMe(e,i),LMe(e)),n++},remove:function(){n--,!n&&e&&(e.parentNode&&e.parentNode.removeChild(e),e=null)}}},UMe=function(){var n=MMe();return function(e,i){k.useEffect(function(){return n.add(e),function(){n.remove()}},[e&&i])}},tie=function(){var n=UMe(),e=function(i){var o=i.styles,l=i.dynamic;return n(o,l),null};return e},VMe={left:0,top:0,right:0,gap:0},tV=function(n){return parseInt(n||"",10)||0},jMe=function(n){var e=window.getComputedStyle(document.body),i=e[n==="padding"?"paddingLeft":"marginLeft"],o=e[n==="padding"?"paddingTop":"marginTop"],l=e[n==="padding"?"paddingRight":"marginRight"];return[tV(i),tV(o),tV(l)]},FMe=function(n){if(n===void 0&&(n="margin"),typeof window>"u")return VMe;var e=jMe(n),i=document.documentElement.clientWidth,o=window.innerWidth;return{left:e[0],top:e[1],right:e[2],gap:Math.max(0,o-i+e[2]-e[0])}},BMe=tie(),TS="data-scroll-locked",zMe=function(n,e,i,o){var l=n.left,u=n.top,p=n.right,y=n.gap;return i===void 0&&(i="margin"),`
  .`.concat(OMe,` {
   overflow: hidden `).concat(o,`;
   padding-right: `).concat(y,"px ").concat(o,`;
  }
  body[`).concat(TS,`] {
    overflow: hidden `).concat(o,`;
    overscroll-behavior: contain;
    `).concat([e&&"position: relative ".concat(o,";"),i==="margin"&&`
    padding-left: `.concat(l,`px;
    padding-top: `).concat(u,`px;
    padding-right: `).concat(p,`px;
    margin-left:0;
    margin-top:0;
    margin-right: `).concat(y,"px ").concat(o,`;
    `),i==="padding"&&"padding-right: ".concat(y,"px ").concat(o,";")].filter(Boolean).join(""),`
  }
  
  .`).concat(HO,` {
    right: `).concat(y,"px ").concat(o,`;
  }
  
  .`).concat($O,` {
    margin-right: `).concat(y,"px ").concat(o,`;
  }
  
  .`).concat(HO," .").concat(HO,` {
    right: 0 `).concat(o,`;
  }
  
  .`).concat($O," .").concat($O,` {
    margin-right: 0 `).concat(o,`;
  }
  
  body[`).concat(TS,`] {
    `).concat(kMe,": ").concat(y,`px;
  }
`)},oJ=function(){var n=parseInt(document.body.getAttribute(TS)||"0",10);return isFinite(n)?n:0},WMe=function(){k.useEffect(function(){return document.body.setAttribute(TS,(oJ()+1).toString()),function(){var n=oJ()-1;n<=0?document.body.removeAttribute(TS):document.body.setAttribute(TS,n.toString())}},[])},GMe=function(n){var e=n.noRelative,i=n.noImportant,o=n.gapMode,l=o===void 0?"margin":o;WMe();var u=k.useMemo(function(){return FMe(l)},[l]);return k.createElement(BMe,{styles:zMe(u,!e,l,i?"":"!important")})},E5=!1;if(typeof window<"u")try{var hO=Object.defineProperty({},"passive",{get:function(){return E5=!0,!0}});window.addEventListener("test",hO,hO),window.removeEventListener("test",hO,hO)}catch{E5=!1}var z0=E5?{passive:!1}:!1,HMe=function(n){return n.tagName==="TEXTAREA"},nie=function(n,e){if(!(n instanceof Element))return!1;var i=window.getComputedStyle(n);return i[e]!=="hidden"&&!(i.overflowY===i.overflowX&&!HMe(n)&&i[e]==="visible")},$Me=function(n){return nie(n,"overflowY")},KMe=function(n){return nie(n,"overflowX")},aJ=function(n,e){var i=e.ownerDocument,o=e;do{typeof ShadowRoot<"u"&&o instanceof ShadowRoot&&(o=o.host);var l=rie(n,o);if(l){var u=iie(n,o),p=u[1],y=u[2];if(p>y)return!0}o=o.parentNode}while(o&&o!==i.body);return!1},qMe=function(n){var e=n.scrollTop,i=n.scrollHeight,o=n.clientHeight;return[e,i,o]},YMe=function(n){var e=n.scrollLeft,i=n.scrollWidth,o=n.clientWidth;return[e,i,o]},rie=function(n,e){return n==="v"?$Me(e):KMe(e)},iie=function(n,e){return n==="v"?qMe(e):YMe(e)},XMe=function(n,e){return n==="h"&&e==="rtl"?-1:1},JMe=function(n,e,i,o,l){var u=XMe(n,window.getComputedStyle(e).direction),p=u*o,y=i.target,E=e.contains(y),b=!1,T=p>0,R=0,O=0;do{if(!y)break;var L=iie(n,y),D=L[0],U=L[1],F=L[2],Y=U-F-u*D;(D||Y)&&rie(n,y)&&(R+=Y,O+=D);var W=y.parentNode;y=W&&W.nodeType===Node.DOCUMENT_FRAGMENT_NODE?W.host:W}while(!E&&y!==document.body||E&&(e.contains(y)||e===y));return(T&&Math.abs(R)<1||!T&&Math.abs(O)<1)&&(b=!0),b},pO=function(n){return"changedTouches"in n?[n.changedTouches[0].clientX,n.changedTouches[0].clientY]:[0,0]},cJ=function(n){return[n.deltaX,n.deltaY]},lJ=function(n){return n&&"current"in n?n.current:n},QMe=function(n,e){return n[0]===e[0]&&n[1]===e[1]},ZMe=function(n){return`
  .block-interactivity-`.concat(n,` {pointer-events: none;}
  .allow-interactivity-`).concat(n,` {pointer-events: all;}
`)},eUe=0,W0=[];function tUe(n){var e=k.useRef([]),i=k.useRef([0,0]),o=k.useRef(),l=k.useState(eUe++)[0],u=k.useState(tie)[0],p=k.useRef(n);k.useEffect(function(){p.current=n},[n]),k.useEffect(function(){if(n.inert){document.body.classList.add("block-interactivity-".concat(l));var U=rDe([n.lockRef.current],(n.shards||[]).map(lJ),!0).filter(Boolean);return U.forEach(function(F){return F.classList.add("allow-interactivity-".concat(l))}),function(){document.body.classList.remove("block-interactivity-".concat(l)),U.forEach(function(F){return F.classList.remove("allow-interactivity-".concat(l))})}}},[n.inert,n.lockRef.current,n.shards]);var y=k.useCallback(function(U,F){if("touches"in U&&U.touches.length===2||U.type==="wheel"&&U.ctrlKey)return!p.current.allowPinchZoom;var Y=pO(U),W=i.current,re="deltaX"in U?U.deltaX:W[0]-Y[0],le="deltaY"in U?U.deltaY:W[1]-Y[1],ie,me=U.target,q=Math.abs(re)>Math.abs(le)?"h":"v";if("touches"in U&&q==="h"&&me.type==="range")return!1;var J=aJ(q,me);if(!J)return!0;if(J?ie=q:(ie=q==="v"?"h":"v",J=aJ(q,me)),!J)return!1;if(!o.current&&"changedTouches"in U&&(re||le)&&(o.current=ie),!ie)return!0;var Q=o.current||ie;return JMe(Q,F,U,Q==="h"?re:le)},[]),E=k.useCallback(function(U){var F=U;if(!(!W0.length||W0[W0.length-1]!==u)){var Y="deltaY"in F?cJ(F):pO(F),W=e.current.filter(function(ie){return ie.name===F.type&&(ie.target===F.target||F.target===ie.shadowParent)&&QMe(ie.delta,Y)})[0];if(W&&W.should){F.cancelable&&F.preventDefault();return}if(!W){var re=(p.current.shards||[]).map(lJ).filter(Boolean).filter(function(ie){return ie.contains(F.target)}),le=re.length>0?y(F,re[0]):!p.current.noIsolation;le&&F.cancelable&&F.preventDefault()}}},[]),b=k.useCallback(function(U,F,Y,W){var re={name:U,delta:F,target:Y,should:W,shadowParent:nUe(Y)};e.current.push(re),setTimeout(function(){e.current=e.current.filter(function(le){return le!==re})},1)},[]),T=k.useCallback(function(U){i.current=pO(U),o.current=void 0},[]),R=k.useCallback(function(U){b(U.type,cJ(U),U.target,y(U,n.lockRef.current))},[]),O=k.useCallback(function(U){b(U.type,pO(U),U.target,y(U,n.lockRef.current))},[]);k.useEffect(function(){return W0.push(u),n.setCallbacks({onScrollCapture:R,onWheelCapture:R,onTouchMoveCapture:O}),document.addEventListener("wheel",E,z0),document.addEventListener("touchmove",E,z0),document.addEventListener("touchstart",T,z0),function(){W0=W0.filter(function(U){return U!==u}),document.removeEventListener("wheel",E,z0),document.removeEventListener("touchmove",E,z0),document.removeEventListener("touchstart",T,z0)}},[]);var L=n.removeScrollBar,D=n.inert;return k.createElement(k.Fragment,null,D?k.createElement(u,{styles:ZMe(l)}):null,L?k.createElement(GMe,{noRelative:n.noRelative,gapMode:n.gapMode}):null)}function nUe(n){for(var e=null;n!==null;)n instanceof ShadowRoot&&(e=n.host,n=n.host),n=n.parentNode;return e}const rUe=iDe(eie,tUe);var sie=k.forwardRef(function(n,e){return k.createElement(wN,Pp({},n,{ref:e,sideCar:rUe}))});sie.classNames=wN.classNames;function iUe(n){const{autoFocus:e,trapFocus:i,dialogRef:o,initialFocusRef:l,blockScrollOnMount:u,allowPinchZoom:p,finalFocusRef:y,returnFocusOnClose:E,preserveScrollBarGap:b,lockFocusAcrossFrames:T,isOpen:R}=dE(),[O,L]=Oj();k.useEffect(()=>{!O&&L&&setTimeout(L)},[O,L]);const D=Zre(o,R);return S.jsx(xre,{autoFocus:e,isDisabled:!i,initialFocusRef:l,finalFocusRef:y,restoreFocus:E,contentRef:o,lockFocusAcrossFrames:T,children:S.jsx(sie,{removeScrollBar:!b,allowPinchZoom:p,enabled:D===1&&u,forwardProps:!0,children:n.children})})}const sUe={initial:({offsetX:n,offsetY:e,transition:i,transitionEnd:o,delay:l})=>({opacity:0,x:n,y:e,transition:(i==null?void 0:i.exit)??Hf.exit(Yy.exit,l),transitionEnd:o==null?void 0:o.exit}),enter:({transition:n,transitionEnd:e,delay:i})=>({opacity:1,x:0,y:0,transition:(n==null?void 0:n.enter)??Hf.enter(Yy.enter,i),transitionEnd:e==null?void 0:e.enter}),exit:({offsetY:n,offsetX:e,transition:i,transitionEnd:o,reverse:l,delay:u})=>{const p={x:e,y:n};return{opacity:0,transition:(i==null?void 0:i.exit)??Hf.exit(Yy.exit,u),...l?{...p,transitionEnd:o==null?void 0:o.exit}:{transitionEnd:{...p,...o==null?void 0:o.exit}}}}},IC={initial:"initial",animate:"enter",exit:"exit",variants:sUe},oUe=k.forwardRef(function(e,i){const{unmountOnExit:o,in:l,reverse:u=!0,className:p,offsetX:y=0,offsetY:E=8,transition:b,transitionEnd:T,delay:R,animatePresenceProps:O,...L}=e,D=o?l&&o:!0,U=l||o?"enter":"exit",F={offsetX:y,offsetY:E,reverse:u,transition:b,transitionEnd:T,delay:R};return S.jsx(EE,{...O,custom:F,children:D&&S.jsx(wh.div,{ref:i,className:Sn("chakra-offset-slide",p),custom:F,...IC,animate:U,...L})})});oUe.displayName="SlideFade";const aUe={exit:({reverse:n,initialScale:e,transition:i,transitionEnd:o,delay:l})=>({opacity:0,...n?{scale:e,transitionEnd:o==null?void 0:o.exit}:{transitionEnd:{scale:e,...o==null?void 0:o.exit}},transition:(i==null?void 0:i.exit)??Hf.exit(Yy.exit,l)}),enter:({transitionEnd:n,transition:e,delay:i})=>({opacity:1,scale:1,transition:(e==null?void 0:e.enter)??Hf.enter(Yy.enter,i),transitionEnd:n==null?void 0:n.enter})},oie={initial:"exit",animate:"enter",exit:"exit",variants:aUe},cUe=k.forwardRef(function(e,i){const{unmountOnExit:o,in:l,reverse:u=!0,initialScale:p=.95,className:y,transition:E,transitionEnd:b,delay:T,animatePresenceProps:R,...O}=e,L=o?l&&o:!0,D=l||o?"enter":"exit",U={initialScale:p,reverse:u,transition:E,transitionEnd:b,delay:T};return S.jsx(EE,{...R,custom:U,children:L&&S.jsx(wh.div,{ref:i,className:Sn("chakra-offset-slide",y),...oie,animate:D,custom:U,...O})})});cUe.displayName="ScaleFade";const lUe={slideInBottom:{...IC,custom:{offsetY:16,reverse:!0}},slideInRight:{...IC,custom:{offsetX:16,reverse:!0}},slideInTop:{...IC,custom:{offsetY:-16,reverse:!0}},slideInLeft:{...IC,custom:{offsetX:-16,reverse:!0}},scale:{...oie,custom:{initialScale:.95,reverse:!0}},none:{}},uUe=Lt(wh.section),dUe=n=>lUe[n||"none"],aie=k.forwardRef((n,e)=>{const{preset:i,motionProps:o=dUe(i),...l}=n;return S.jsx(uUe,{ref:e,...o,...l})});aie.displayName="ModalTransition";const ys=jt((n,e)=>{const{className:i,children:o,containerProps:l,motionProps:u,...p}=n,{getDialogProps:y,getDialogContainerProps:E}=dE(),b=y(p,e),T=E(l),R=Sn("chakra-modal__content",i),O=db(),L={display:"flex",flexDirection:"column",position:"relative",width:"100%",outline:0,...O.dialog},D={display:"flex",width:"100vw",height:"$100vh",position:"fixed",left:0,top:0,...O.dialogContainer},{motionPreset:U}=dE();return S.jsx(iUe,{children:S.jsx(Lt.div,{...T,className:"chakra-modal__content-container",tabIndex:-1,__css:D,children:S.jsx(aie,{preset:U,motionProps:u,className:R,...b,__css:L,children:o})})})});ys.displayName="ModalContent";const Es=jt((n,e)=>{const{className:i,...o}=n,{bodyId:l,setBodyMounted:u}=dE();k.useEffect(()=>(u(!0),()=>u(!1)),[u]);const p=Sn("chakra-modal__body",i),y=db();return S.jsx(Lt.div,{ref:e,className:p,id:l,...o,__css:y.body})});Es.displayName="ModalBody";const Ns=jt((n,e)=>{const{onClick:i,className:o,...l}=n,{onClose:u}=dE(),p=Sn("chakra-modal__close-btn",o),y=db();return S.jsx(uF,{ref:e,__css:y.closeButton,className:p,onClick:jn(i,E=>{E.stopPropagation(),u()}),...l})});Ns.displayName="ModalCloseButton";const vh=jt((n,e)=>{const{className:i,...o}=n,l=Sn("chakra-modal__footer",i),u=db(),p={display:"flex",alignItems:"center",justifyContent:"flex-end",...u.footer};return S.jsx(Lt.footer,{ref:e,...o,__css:p,className:l})});vh.displayName="ModalFooter";const Do=jt((n,e)=>{const{className:i,...o}=n,{headerId:l,setHeaderMounted:u}=dE();k.useEffect(()=>(u(!0),()=>u(!1)),[u]);const p=Sn("chakra-modal__header",i),y=db(),E={flex:0,...y.header};return S.jsx(Lt.header,{ref:e,className:p,id:l,...o,__css:E})});Do.displayName="ModalHeader";const hUe={enter:({transition:n,transitionEnd:e,delay:i}={})=>({opacity:1,transition:(n==null?void 0:n.enter)??Hf.enter(Yy.enter,i),transitionEnd:e==null?void 0:e.enter}),exit:({transition:n,transitionEnd:e,delay:i}={})=>({opacity:0,transition:(n==null?void 0:n.exit)??Hf.exit(Yy.exit,i),transitionEnd:e==null?void 0:e.exit})},cie={initial:"exit",animate:"enter",exit:"exit",variants:hUe},pUe=k.forwardRef(function(e,i){const{unmountOnExit:o,in:l,className:u,transition:p,transitionEnd:y,delay:E,animatePresenceProps:b,...T}=e,R=l||o?"enter":"exit",O=o?l&&o:!0,L={transition:p,transitionEnd:y,delay:E};return S.jsx(EE,{...b,custom:L,children:O&&S.jsx(wh.div,{ref:i,className:Sn("chakra-fade",u),custom:L,...cie,animate:R,...T})})});pUe.displayName="Fade";const fUe=Lt(wh.div),vs=jt((n,e)=>{const{className:i,transition:o,motionProps:l,...u}=n,p=Sn("chakra-modal__overlay",i),E={pos:"fixed",left:"0",top:"0",w:"100vw",h:"100vh",...db().overlay},{motionPreset:b}=dE(),R=l||(b==="none"?{}:cie);return S.jsx(fUe,{...R,__css:E,ref:e,className:p,...u})});vs.displayName="ModalOverlay";function mUe(n){const{leastDestructiveRef:e,...i}=n;return S.jsx(_s,{...i,initialFocusRef:e})}const gUe=jt((n,e)=>S.jsx(ys,{ref:e,role:"alertdialog",...n})),_Ue=n=>S.jsx(en,{viewBox:"0 0 24 24",...n,children:S.jsx("path",{fill:"currentColor",d:"M21,5H3C2.621,5,2.275,5.214,2.105,5.553C1.937,5.892,1.973,6.297,2.2,6.6l9,12 c0.188,0.252,0.485,0.4,0.8,0.4s0.611-0.148,0.8-0.4l9-12c0.228-0.303,0.264-0.708,0.095-1.047C21.725,5.214,21.379,5,21,5z"})}),yUe=n=>S.jsx(en,{viewBox:"0 0 24 24",...n,children:S.jsx("path",{fill:"currentColor",d:"M12.8,5.4c-0.377-0.504-1.223-0.504-1.6,0l-9,12c-0.228,0.303-0.264,0.708-0.095,1.047 C2.275,18.786,2.621,19,3,19h18c0.379,0,0.725-0.214,0.895-0.553c0.169-0.339,0.133-0.744-0.095-1.047L12.8,5.4z"})});function uJ(n,e,i,o){k.useEffect(()=>{if(!n.current||!o)return;const l=n.current.ownerDocument.defaultView??window,u=Array.isArray(e)?e:[e],p=new l.MutationObserver(y=>{for(const E of y)E.type==="attributes"&&E.attributeName&&u.includes(E.attributeName)&&i(E)});return p.observe(n.current,{attributes:!0,attributeFilter:u}),()=>p.disconnect()})}const EUe=50,dJ=300;function vUe(n,e){const[i,o]=k.useState(!1),[l,u]=k.useState(null),[p,y]=k.useState(!0),E=k.useRef(null),b=()=>clearTimeout(E.current);i0e(()=>{l==="increment"&&n(),l==="decrement"&&e()},i?EUe:null);const T=k.useCallback(()=>{p&&n(),E.current=setTimeout(()=>{y(!1),o(!0),u("increment")},dJ)},[n,p]),R=k.useCallback(()=>{p&&e(),E.current=setTimeout(()=>{y(!1),o(!0),u("decrement")},dJ)},[e,p]),O=k.useCallback(()=>{y(!0),o(!1),b()},[]);return k.useEffect(()=>()=>b(),[]),{up:T,down:R,stop:O,isSpinning:i}}const SUe=/^[Ee0-9+\-.]$/;function bUe(n){return SUe.test(n)}function wUe(n,e){if(n.key==null)return!0;const i=n.ctrlKey||n.altKey||n.metaKey;return!(n.key.length===1)||i?!0:e(n.key)}function TUe(n={}){const{focusInputOnChange:e=!0,clampValueOnBlur:i=!0,keepWithinRange:o=!0,min:l=Number.MIN_SAFE_INTEGER,max:u=Number.MAX_SAFE_INTEGER,step:p=1,isReadOnly:y,isDisabled:E,isRequired:b,isInvalid:T,pattern:R="[0-9]*(.[0-9]+)?",inputMode:O="decimal",allowMouseWheel:L,id:D,onChange:U,precision:F,name:Y,"aria-describedby":W,"aria-label":re,"aria-labelledby":le,onFocus:ie,onBlur:me,onInvalid:q,getAriaValueText:J,isValidCharacter:Q,format:ne,parse:he,...de}=n,pe=go(ie),Se=go(me),Ie=go(q),Fe=go(Q??bUe),we=go(J),Re=Gve(n),{update:Te,increment:Ne,decrement:be}=Re,[xe,je]=k.useState(!1),nt=!(y||E),dt=k.useRef(null),ft=k.useRef(null),lt=k.useRef(null),gt=k.useRef(null),at=k.useCallback(_t=>_t.split("").filter(Fe).join(""),[Fe]),Ct=k.useCallback(_t=>(he==null?void 0:he(_t))??_t,[he]),En=k.useCallback(_t=>((ne==null?void 0:ne(_t))??_t).toString(),[ne]);Xf(()=>{(Re.valueAsNumber>u||Re.valueAsNumber<l)&&(Ie==null||Ie("rangeOverflow",En(Re.value),Re.valueAsNumber))},[Re.valueAsNumber,Re.value,En,Ie]),xp(()=>{if(!dt.current)return;if(dt.current.value!=Re.value){const wn=Ct(dt.current.value);Re.setValue(at(wn))}},[Ct,at]);const Gt=k.useCallback((_t=p)=>{nt&&Ne(_t)},[Ne,nt,p]),Jt=k.useCallback((_t=p)=>{nt&&be(_t)},[be,nt,p]),st=vUe(Gt,Jt);uJ(lt,"disabled",st.stop,st.isSpinning),uJ(gt,"disabled",st.stop,st.isSpinning);const hn=k.useCallback(_t=>{if(_t.nativeEvent.isComposing)return;const Nt=Ct(_t.currentTarget.value);Te(at(Nt)),ft.current={start:_t.currentTarget.selectionStart,end:_t.currentTarget.selectionEnd}},[Te,at,Ct]),an=k.useCallback(_t=>{var wn;pe==null||pe(_t),ft.current&&(_t.currentTarget.selectionStart=ft.current.start??((wn=_t.currentTarget.value)==null?void 0:wn.length),_t.currentTarget.selectionEnd=ft.current.end??_t.currentTarget.selectionStart)},[pe]),Ft=k.useCallback(_t=>{if(_t.nativeEvent.isComposing)return;wUe(_t,Fe)||_t.preventDefault();const wn=on(_t)*p,Nt=_t.key,Ur={ArrowUp:()=>Gt(wn),ArrowDown:()=>Jt(wn),Home:()=>Te(l),End:()=>Te(u)}[Nt];Ur&&(_t.preventDefault(),Ur(_t))},[Fe,p,Gt,Jt,Te,l,u]),on=_t=>{let wn=1;return(_t.metaKey||_t.ctrlKey)&&(wn=.1),_t.shiftKey&&(wn=10),wn},bt=k.useMemo(()=>{const _t=we==null?void 0:we(Re.value);if(_t!=null)return _t;const wn=Re.value.toString();return wn||void 0},[Re.value,we]),ve=k.useCallback(()=>{let _t=Re.value;if(Re.value==="")return;/^[eE]/.test(Re.value.toString())?Re.setValue(""):(Re.valueAsNumber<l&&(_t=l),Re.valueAsNumber>u&&(_t=u),Re.cast(_t))},[Re,u,l]),De=k.useCallback(()=>{je(!1),i&&ve()},[i,je,ve]),qe=k.useCallback(()=>{e&&requestAnimationFrame(()=>{var _t;(_t=dt.current)==null||_t.focus()})},[e]),Ot=k.useCallback(_t=>{_t.preventDefault(),st.up(),qe()},[qe,st]),vt=k.useCallback(_t=>{_t.preventDefault(),st.down(),qe()},[qe,st]);Gy(()=>dt.current,"wheel",_t=>{var Ri;const Nt=(((Ri=dt.current)==null?void 0:Ri.ownerDocument)??document).activeElement===dt.current;if(!L||!Nt)return;_t.preventDefault();const Ht=on(_t)*p,Ur=Math.sign(_t.deltaY);Ur===-1?Gt(Ht):Ur===1&&Jt(Ht)},{passive:!1});const Pt=k.useCallback((_t={},wn=null)=>{const Nt=E||o&&Re.isAtMax;return{..._t,ref:Yi(wn,lt),role:"button",tabIndex:-1,onPointerDown:jn(_t.onPointerDown,Ht=>{Ht.button!==0||Nt||Ot(Ht)}),onPointerLeave:jn(_t.onPointerLeave,st.stop),onPointerUp:jn(_t.onPointerUp,st.stop),disabled:Nt,"aria-disabled":Bf(Nt)}},[Re.isAtMax,o,Ot,st.stop,E]),Ut=k.useCallback((_t={},wn=null)=>{const Nt=E||o&&Re.isAtMin;return{..._t,ref:Yi(wn,gt),role:"button",tabIndex:-1,onPointerDown:jn(_t.onPointerDown,Ht=>{Ht.button!==0||Nt||vt(Ht)}),onPointerLeave:jn(_t.onPointerLeave,st.stop),onPointerUp:jn(_t.onPointerUp,st.stop),disabled:Nt,"aria-disabled":Bf(Nt)}},[Re.isAtMin,o,vt,st.stop,E]),cn=k.useCallback((_t={},wn=null)=>({name:Y,inputMode:O,type:"text",pattern:R,"aria-labelledby":le,"aria-label":re,"aria-describedby":W,id:D,disabled:E,role:"spinbutton",..._t,readOnly:_t.readOnly??y,"aria-readonly":_t.readOnly??y,"aria-required":_t.required??b,required:_t.required??b,ref:Yi(dt,wn),value:En(Re.value),"aria-valuemin":l,"aria-valuemax":u,"aria-valuenow":Number.isNaN(Re.valueAsNumber)?void 0:Re.valueAsNumber,"aria-invalid":Bf(T??Re.isOutOfRange),"aria-valuetext":bt,autoComplete:"off",autoCorrect:"off",onChange:jn(_t.onChange,hn),onKeyDown:jn(_t.onKeyDown,Ft),onFocus:jn(_t.onFocus,an,()=>je(!0)),onBlur:jn(_t.onBlur,Se,De)}),[Y,O,R,le,re,En,W,D,E,b,y,T,Re.value,Re.valueAsNumber,Re.isOutOfRange,l,u,bt,hn,Ft,an,Se,De]);return{value:En(Re.value),valueAsNumber:Re.valueAsNumber,isFocused:xe,isDisabled:E,isReadOnly:y,getIncrementButtonProps:Pt,getDecrementButtonProps:Ut,getInputProps:cn,htmlProps:de}}const[CUe,TN]=xi({name:"NumberInputStylesContext",errorMessage:`useNumberInputStyles returned is 'undefined'. Seems you forgot to wrap the components in "<NumberInput />" `}),[RUe,VF]=xi({name:"NumberInputContext",errorMessage:"useNumberInputContext: `context` is undefined. Seems you forgot to wrap number-input's components within <NumberInput />"}),$o=jt(function(e,i){const o=za("NumberInput",e),l=Bi(e),u=fF(l),{htmlProps:p,...y}=TUe(u),E=k.useMemo(()=>y,[y]);return S.jsx(RUe,{value:E,children:S.jsx(CUe,{value:o,children:S.jsx(Lt.div,{...p,ref:i,className:Sn("chakra-numberinput",e.className),__css:{position:"relative",zIndex:0,...o.root}})})})});$o.displayName="NumberInput";const Ko=jt(function(e,i){const o=TN();return S.jsx(Lt.div,{"aria-hidden":!0,ref:i,...e,__css:{display:"flex",flexDirection:"column",position:"absolute",top:"0",insetEnd:"0px",margin:"1px",height:"calc(100% - 2px)",zIndex:1,...o.stepperGroup}})});Ko.displayName="NumberInputStepper";const qo=jt(function(e,i){const{getInputProps:o}=VF(),l=o(e,i),u=TN();return S.jsx(Lt.input,{...l,className:Sn("chakra-numberinput__field",e.className),__css:{width:"100%",...u.field}})});qo.displayName="NumberInputField";const lie=Lt("div",{baseStyle:{display:"flex",justifyContent:"center",alignItems:"center",flex:1,transitionProperty:"common",transitionDuration:"normal",userSelect:"none",cursor:"pointer",lineHeight:"normal"}}),Yo=jt(function(e,i){const o=TN(),{getDecrementButtonProps:l}=VF(),u=l(e,i);return S.jsx(lie,{...u,__css:o.stepper,children:e.children??S.jsx(_Ue,{})})});Yo.displayName="NumberDecrementStepper";const Xo=jt(function(e,i){const{getIncrementButtonProps:o}=VF(),l=o(e,i),u=TN();return S.jsx(lie,{...l,__css:u.stepper,children:e.children??S.jsx(yUe,{})})});Xo.displayName="NumberIncrementStepper";const[IUe,CN]=xi({name:"PopoverContext",errorMessage:"usePopoverContext: `context` is undefined. Seems you forgot to wrap all popover components within `<Popover />`"}),[AUe,uie]=xi({name:"PopoverStylesContext",errorMessage:`usePopoverStyles returned is 'undefined'. Seems you forgot to wrap the components in "<Popover />" `}),G0={click:"click",hover:"hover"};function PUe(n={}){const{closeOnBlur:e=!0,closeOnEsc:i=!0,initialFocusRef:o,id:l,returnFocusOnClose:u=!0,autoFocus:p=!0,arrowSize:y,arrowShadowColor:E,trigger:b=G0.click,openDelay:T=200,closeDelay:R=200,isLazy:O,lazyBehavior:L="unmount",computePositionOnMount:D,...U}=n,{isOpen:F,onClose:Y,onOpen:W,onToggle:re}=yu(n),[le,ie]=k.useState(u);k.useEffect(()=>ie(u),[u]);const me=k.useRef(null),q=k.useRef(null),J=k.useRef(null),Q=k.useRef(!1),ne=k.useRef(!1);F&&(ne.current=!0);const[he,de]=k.useState(!1),[pe,Se]=k.useState(!1),Ie=k.useId(),Fe=l??Ie,[we,Re,Te,Ne]=["popover-trigger","popover-content","popover-header","popover-body"].map(Ft=>`${Ft}-${Fe}`),{referenceRef:be,getArrowProps:xe,getPopperProps:je,getArrowInnerProps:nt,forceUpdate:dt}=UF({...U,enabled:F||!!D}),ft=Eee({isOpen:F,ref:J});t0e({enabled:F,ref:q}),bee(J,{focusRef:q,visible:F,shouldFocus:le&&b===G0.click}),Kve(J,{focusRef:o,visible:F,shouldFocus:p&&b===G0.click}),Cee({enabled:F&&e,ref:J,handler(Ft){var bt;const on=((bt=Ft.composedPath)==null?void 0:bt.call(Ft)[0])??[Ft.target];fO(q.current,on)||(on&&ie(!ck(on)),Y())}});const lt=aj({wasSelected:ne.current,enabled:O,mode:L,isSelected:ft.present}),gt=k.useCallback((Ft={},on=null)=>{const bt={...Ft,style:{...Ft.style,transformOrigin:Oo.transformOrigin.varRef,[Oo.arrowSize.var]:y?`${y}px`:void 0,[Oo.arrowShadowColor.var]:E},ref:Yi(J,on),children:lt?Ft.children:null,id:Re,tabIndex:-1,role:"dialog",onKeyDown:jn(Ft.onKeyDown,ve=>{ve.nativeEvent.isComposing||i&&ve.key==="Escape"&&(ve.preventDefault(),ve.stopPropagation(),Y())}),onBlur:jn(Ft.onBlur,ve=>{const De=hJ(ve),qe=fO(J.current,De),Ot=fO(q.current,De),vt=!qe&&!Ot;De&&ie(!ck(De)),F&&e&&vt&&Y()}),"aria-labelledby":he?Te:void 0,"aria-describedby":pe?Ne:void 0};return b===G0.hover&&(bt.role="tooltip",bt.onMouseEnter=jn(Ft.onMouseEnter,()=>{Q.current=!0}),bt.onMouseLeave=jn(Ft.onMouseLeave,ve=>{ve.nativeEvent.relatedTarget!==null&&(Q.current=!1,setTimeout(()=>Y(),R))})),bt},[lt,Re,he,Te,pe,Ne,b,i,Y,F,e,R,E,y]),at=k.useCallback((Ft={},on=null)=>je({...Ft,style:{visibility:F?"visible":"hidden",...Ft.style}},on),[F,je]),Ct=k.useCallback((Ft,on=null)=>({...Ft,ref:Yi(on,me,be)}),[me,be]),En=k.useRef(void 0),Gt=k.useRef(void 0),Jt=k.useCallback(Ft=>{me.current==null&&be(Ft)},[be]),st=k.useCallback((Ft={},on=null)=>{const bt={...Ft,ref:Yi(q,on,Jt),id:we,"aria-haspopup":"dialog","aria-expanded":F,"aria-controls":Re};return b===G0.click&&(bt.onClick=jn(Ft.onClick,re)),b===G0.hover&&(bt.onFocus=jn(Ft.onFocus,()=>{En.current===void 0&&W()}),bt.onBlur=jn(Ft.onBlur,ve=>{const De=hJ(ve),qe=!fO(J.current,De);F&&e&&qe&&Y()}),bt.onKeyDown=jn(Ft.onKeyDown,ve=>{ve.key==="Escape"&&Y()}),bt.onMouseEnter=jn(Ft.onMouseEnter,()=>{Q.current=!0,En.current=window.setTimeout(()=>W(),T)}),bt.onMouseLeave=jn(Ft.onMouseLeave,()=>{Q.current=!1,En.current&&(clearTimeout(En.current),En.current=void 0),Gt.current=window.setTimeout(()=>{Q.current===!1&&Y()},R)})),bt},[we,F,Re,b,Jt,re,W,e,Y,T,R]);k.useEffect(()=>()=>{En.current&&clearTimeout(En.current),Gt.current&&clearTimeout(Gt.current)},[]);const hn=k.useCallback((Ft={},on=null)=>({...Ft,id:Te,ref:Yi(on,bt=>{de(!!bt)})}),[Te]),an=k.useCallback((Ft={},on=null)=>({...Ft,id:Ne,ref:Yi(on,bt=>{Se(!!bt)})}),[Ne]);return{forceUpdate:dt,isOpen:F,onAnimationComplete:ft.onComplete,onClose:Y,getAnchorProps:Ct,getArrowProps:xe,getArrowInnerProps:nt,getPopoverPositionerProps:at,getPopoverProps:gt,getTriggerProps:st,getHeaderProps:hn,getBodyProps:an}}function fO(n,e){return n===e||(n==null?void 0:n.contains(e))}function hJ(n){const e=n.currentTarget.ownerDocument.activeElement;return n.relatedTarget??e}function die(n){const e=za("Popover",n),{children:i,...o}=Bi(n),l=lb(),u=PUe({...o,direction:l.direction});return S.jsx(IUe,{value:u,children:S.jsx(AUe,{value:e,children:Cl(i,{isOpen:u.isOpen,onClose:u.onClose,forceUpdate:u.forceUpdate})})})}die.displayName="Popover";function hie(n){var i;const e=k.version;return typeof e!="string"||e.startsWith("18.")?n==null?void 0:n.ref:(i=n==null?void 0:n.props)==null?void 0:i.ref}const pie=jt(function(e,i){const{getBodyProps:o}=CN(),l=uie();return S.jsx(Lt.div,{...o(e,i),className:Sn("chakra-popover__body",e.className),__css:l.body})});pie.displayName="PopoverBody";function OUe(n){if(n)return{enter:{...n.enter,visibility:"visible"},exit:{...n.exit,transitionEnd:{visibility:"hidden"}}}}const kUe={exit:{opacity:0,scale:.95,transition:{duration:.1,ease:[.4,0,1,1]}},enter:{scale:1,opacity:1,transition:{duration:.15,ease:[0,0,.2,1]}}},NUe=Lt(wh.section),fie=jt(function(e,i){const{variants:o=kUe,...l}=e,{isOpen:u}=CN();return S.jsx(NUe,{ref:i,variants:OUe(o),initial:!1,animate:u?"enter":"exit",...l})});fie.displayName="PopoverTransition";const mie=jt(function(e,i){const{rootProps:o,motionProps:l,...u}=e,{getPopoverProps:p,getPopoverPositionerProps:y,onAnimationComplete:E}=CN(),b=uie(),T={position:"relative",display:"flex",flexDirection:"column",...b.content};return S.jsx(Lt.div,{...y(o),__css:b.popper,className:"chakra-popover__popper",children:S.jsx(fie,{...l,...p(u,i),onAnimationComplete:pee(E,u.onAnimationComplete),className:Sn("chakra-popover__content",e.className),__css:T})})});mie.displayName="PopoverContent";function gie(n){const e=k.Children.only(n.children),{getTriggerProps:i}=CN();return S.jsx(S.Fragment,{children:k.cloneElement(e,i(e.props,hie(e)))})}gie.displayName="PopoverTrigger";function xUe(n,e,i){return(n-e)*100/(i-e)}BR({"0%":{strokeDasharray:"1, 400",strokeDashoffset:"0"},"50%":{strokeDasharray:"400, 400",strokeDashoffset:"-100"},"100%":{strokeDasharray:"400, 400",strokeDashoffset:"-260"}});BR({"0%":{transform:"rotate(0deg)"},"100%":{transform:"rotate(360deg)"}});const DUe=BR({"0%":{left:"-40%"},"100%":{left:"100%"}}),LUe=BR({from:{backgroundPosition:"1rem 0"},to:{backgroundPosition:"0 0"}});function MUe(n){const{value:e=0,min:i,max:o,valueText:l,getValueText:u,isIndeterminate:p,role:y="progressbar"}=n,E=xUe(e,i,o);return{bind:{"data-indeterminate":p?"":void 0,"aria-valuemax":o,"aria-valuemin":i,"aria-valuenow":p?void 0:e,"aria-valuetext":(()=>{if(e!=null)return typeof u=="function"?u(e,E):l})(),role:y},percent:E,value:e}}const[UUe,VUe]=xi({name:"ProgressStylesContext",errorMessage:`useProgressStyles returned is 'undefined'. Seems you forgot to wrap the components in "<Progress />" `}),jUe=jt((n,e)=>{const{min:i,max:o,value:l,isIndeterminate:u,role:p,...y}=n,E=MUe({value:l,min:i,max:o,isIndeterminate:u,role:p}),T={height:"100%",...VUe().filledTrack};return S.jsx(Lt.div,{ref:e,style:{width:`${E.percent}%`,...y.style},...E.bind,...y,__css:T})}),Zy=jt((n,e)=>{var q;const{value:i,min:o=0,max:l=100,hasStripe:u,isAnimated:p,children:y,borderRadius:E,isIndeterminate:b,"aria-label":T,"aria-labelledby":R,"aria-valuetext":O,title:L,role:D,...U}=Bi(n),F=za("Progress",n),Y=E??((q=F.track)==null?void 0:q.borderRadius),W={animation:`${LUe} 1s linear infinite`},ie={...!b&&u&&p&&W,...b&&{position:"absolute",willChange:"left",minWidth:"50%",animation:`${DUe} 1s ease infinite normal none running`}},me={overflow:"hidden",position:"relative",...F.track};return S.jsx(Lt.div,{ref:e,borderRadius:Y,__css:me,...U,children:S.jsxs(UUe,{value:F,children:[S.jsx(jUe,{"aria-label":T,"aria-labelledby":R,"aria-valuetext":O,min:o,max:l,value:i,isIndeterminate:b,css:ie,borderRadius:Y,title:L,role:D}),y]})})});Zy.displayName="Progress";const _ie=jt(function(e,i){const{children:o,placeholder:l,className:u,...p}=e;return S.jsxs(Lt.select,{...p,ref:i,className:Sn("chakra-select",u),children:[l&&S.jsx("option",{value:"",children:l}),o]})});_ie.displayName="SelectField";const yie=jt((n,e)=>{var re;const i=za("Select",n),{rootProps:o,placeholder:l,icon:u,color:p,height:y,h:E,minH:b,minHeight:T,iconColor:R,iconSize:O,...L}=Bi(n),[D,U]=Uve(L,nSe),F=pF(U),Y={width:"100%",height:"fit-content",position:"relative",color:p},W={paddingEnd:"2rem",...i.field,_focus:{zIndex:"unset",...(re=i.field)==null?void 0:re._focus}};return S.jsxs(Lt.div,{className:"chakra-select__wrapper",__css:Y,...D,...o,children:[S.jsx(_ie,{ref:e,height:E??y,minH:b??T,placeholder:l,...F,__css:W,children:n.children}),S.jsx(Eie,{"data-disabled":pr(F.disabled),...(R||p)&&{color:R||p},__css:i.icon,...O&&{fontSize:O},children:u})]})});yie.displayName="Select";const FUe=n=>S.jsx("svg",{viewBox:"0 0 24 24",...n,children:S.jsx("path",{fill:"currentColor",d:"M16.59 8.59L12 13.17 7.41 8.59 6 10l6 6 6-6z"})}),BUe=Lt("div",{baseStyle:{position:"absolute",display:"inline-flex",alignItems:"center",justifyContent:"center",pointerEvents:"none",top:"50%",transform:"translateY(-50%)"}}),Eie=n=>{const{children:e=S.jsx(FUe,{}),...i}=n,o=k.cloneElement(e,{role:"presentation",className:"chakra-select__icon",focusable:!1,"aria-hidden":!0,style:{width:"1em",height:"1em",color:"currentColor"}});return S.jsx(BUe,{...i,className:"chakra-select__icon-wrapper",children:k.isValidElement(e)?o:null})};Eie.displayName="SelectIcon";function nV(n){const{orientation:e,vertical:i,horizontal:o}=n;return e==="vertical"?i:o}function zUe(n){const{orientation:e,thumbPercents:i,isReversed:o}=n,l=L=>({position:"absolute",userSelect:"none",WebkitUserSelect:"none",MozUserSelect:"none",msUserSelect:"none",touchAction:"none",...nV({orientation:e,vertical:{bottom:`${i[L]}%`,transform:"translate(-50%, 50%) scale(var(--slider-thumb-scale, 1))"},horizontal:{left:`${i[L]}%`,transform:"translate(-50%, -50%) scale(var(--slider-thumb-scale, 1))"}})}),u={position:"relative",touchAction:"none",WebkitTapHighlightColor:"rgba(0,0,0,0)",userSelect:"none",outline:0},p={position:"absolute",...nV({orientation:e,vertical:{left:"50%",transform:"translateX(-50%)",height:"100%"},horizontal:{top:"50%",transform:"translateY(-50%)",width:"100%"}})},y=i.length===1,E=[0,o?100-i[0]:i[0]],b=y?E:i;let T=b[0];!y&&o&&(T=100-T);const R=Math.abs(b[b.length-1]-b[0]),O={...p,...nV({orientation:e,vertical:o?{height:`${R}%`,top:`${T}%`}:{height:`${R}%`,bottom:`${T}%`},horizontal:o?{width:`${R}%`,right:`${T}%`}:{width:`${R}%`,left:`${T}%`}})};return{trackStyle:p,innerTrackStyle:O,rootStyle:u,getThumbStyle:l}}function WUe(n){const{isReversed:e,direction:i,orientation:o}=n;return i==="ltr"||o==="vertical"?e:!e}function GUe(n){const{min:e=0,max:i=100,onChange:o,value:l,defaultValue:u,isReversed:p,direction:y="ltr",orientation:E="horizontal",id:b,isDisabled:T,isReadOnly:R,onChangeStart:O,onChangeEnd:L,step:D=1,getAriaValueText:U,"aria-valuetext":F,"aria-label":Y,"aria-labelledby":W,name:re,focusThumbOnChange:le=!0,...ie}=n,me=go(O),q=go(L),J=go(U),Q=WUe({isReversed:p,direction:y,orientation:E}),[ne,he]=vee({value:l,defaultValue:u??$Ue(e,i),onChange:o}),[de,pe]=k.useState(!1),[Se,Ie]=k.useState(!1),Fe=!(T||R),we=(i-e)/10,Re=D||(i-e)/100,Te=AO(ne,e,i),Ne=i-Te+e,xe=Eq(Q?Ne:Te,e,i),je=E==="vertical",nt=Tee({min:e,max:i,step:D,isDisabled:T,value:Te,isInteractive:Fe,isReversed:Q,isVertical:je,eventSource:null,focusThumbOnChange:le,orientation:E}),dt=k.useRef(null),ft=k.useRef(null),lt=k.useRef(null),gt=k.useId(),at=b??gt,[Ct,En]=[`slider-thumb-${at}`,`slider-track-${at}`],Gt=k.useCallback(Nt=>{var Mo;if(!dt.current)return;const Ht=nt.current;Ht.eventSource="pointer";const Ur=dt.current.getBoundingClientRect(),{clientX:Ri,clientY:ri}=((Mo=Nt.touches)==null?void 0:Mo[0])??Nt,zi=je?Ur.bottom-ri:Ri-Ur.left,ds=je?Ur.height:Ur.width;let Eo=zi/ds;Q&&(Eo=1-Eo);let Gr=xve(Eo,Ht.min,Ht.max);return Ht.step&&(Gr=parseFloat(vq(Gr,Ht.min,Ht.step))),Gr=AO(Gr,Ht.min,Ht.max),Gr},[je,Q,nt]),Jt=k.useCallback(Nt=>{const Ht=nt.current;Ht.isInteractive&&(Nt=parseFloat(vq(Nt,Ht.min,Re)),Nt=AO(Nt,Ht.min,Ht.max),he(Nt))},[Re,he,nt]),st=k.useMemo(()=>({stepUp(Nt=Re){const Ht=Q?Te-Nt:Te+Nt;Jt(Ht)},stepDown(Nt=Re){const Ht=Q?Te+Nt:Te-Nt;Jt(Ht)},reset(){Jt(u||0)},stepTo(Nt){Jt(Nt)}}),[Jt,Q,Te,Re,u]),hn=k.useCallback(Nt=>{const Ht=nt.current,Ri={ArrowRight:()=>st.stepUp(),ArrowUp:()=>st.stepUp(),ArrowLeft:()=>st.stepDown(),ArrowDown:()=>st.stepDown(),PageUp:()=>st.stepUp(we),PageDown:()=>st.stepDown(we),Home:()=>Jt(Ht.min),End:()=>Jt(Ht.max)}[Nt.key];Ri&&(Nt.preventDefault(),Nt.stopPropagation(),Ri(Nt),Ht.eventSource="keyboard")},[st,Jt,we,nt]),an=(J==null?void 0:J(Te))??F,{getThumbStyle:Ft,rootStyle:on,trackStyle:bt,innerTrackStyle:ve}=k.useMemo(()=>{const Nt=nt.current;return zUe({isReversed:Q,orientation:Nt.orientation,thumbPercents:[xe]})},[Q,xe,nt]),De=k.useCallback(()=>{nt.current.focusThumbOnChange&&setTimeout(()=>{var Ht;return(Ht=ft.current)==null?void 0:Ht.focus()})},[nt]);Xf(()=>{const Nt=nt.current;De(),Nt.eventSource==="keyboard"&&(q==null||q(Nt.value))},[Te,q]);function qe(Nt){const Ht=Gt(Nt);Ht!=null&&Ht!==nt.current.value&&he(Ht)}b0e(lt,{onPanSessionStart(Nt){const Ht=nt.current;Ht.isInteractive&&(pe(!0),De(),qe(Nt),me==null||me(Ht.value))},onPanSessionEnd(){const Nt=nt.current;Nt.isInteractive&&(pe(!1),q==null||q(Nt.value))},onPan(Nt){nt.current.isInteractive&&qe(Nt)}});const Ot=k.useCallback((Nt={},Ht=null)=>({...Nt,...ie,ref:Yi(Ht,lt),tabIndex:-1,"aria-disabled":Bf(T),"data-focused":pr(Se),style:{...Nt.style,...on}}),[ie,T,Se,on]),vt=k.useCallback((Nt={},Ht=null)=>({...Nt,ref:Yi(Ht,dt),id:En,"data-disabled":pr(T),style:{...Nt.style,...bt}}),[T,En,bt]),Pt=k.useCallback((Nt={},Ht=null)=>({...Nt,ref:Ht,style:{...Nt.style,...ve}}),[ve]),Ut=k.useCallback((Nt={},Ht=null)=>({...Nt,ref:Yi(Ht,ft),role:"slider",tabIndex:Fe?0:void 0,id:Ct,"data-active":pr(de),"aria-valuetext":an,"aria-valuemin":e,"aria-valuemax":i,"aria-valuenow":Te,"aria-orientation":E,"aria-disabled":Bf(T),"aria-readonly":Bf(R),"aria-label":Y,"aria-labelledby":Y?void 0:W,style:{...Nt.style,...Ft(0)},onKeyDown:jn(Nt.onKeyDown,hn),onFocus:jn(Nt.onFocus,()=>Ie(!0)),onBlur:jn(Nt.onBlur,()=>Ie(!1))}),[Fe,Ct,de,an,e,i,Te,E,T,R,Y,W,Ft,hn]),cn=k.useCallback((Nt,Ht=null)=>{const Ur=!(Nt.value<e||Nt.value>i),Ri=Te>=Nt.value,ri=Eq(Nt.value,e,i),zi={position:"absolute",pointerEvents:"none",...HUe({orientation:E,vertical:{bottom:Q?`${100-ri}%`:`${ri}%`},horizontal:{left:Q?`${100-ri}%`:`${ri}%`}})};return{...Nt,ref:Ht,role:"presentation","aria-hidden":!0,"data-disabled":pr(T),"data-invalid":pr(!Ur),"data-highlighted":pr(Ri),style:{...Nt.style,...zi}}},[T,Q,i,e,E,Te]),_t=k.useCallback((Nt={},Ht=null)=>({...Nt,ref:Ht,type:"hidden",value:Te,name:re}),[re,Te]);return{state:{value:Te,isFocused:Se,isDragging:de},actions:st,getRootProps:Ot,getTrackProps:vt,getInnerTrackProps:Pt,getThumbProps:Ut,getMarkerProps:cn,getInputProps:_t}}function HUe(n){const{orientation:e,vertical:i,horizontal:o}=n;return e==="vertical"?i:o}function $Ue(n,e){return e<n?n:n+(e-n)/2}const[KUe,RN]=xi({name:"SliderContext",hookName:"useSliderContext",providerName:"<Slider />"}),[qUe,IN]=xi({name:"SliderStylesContext",hookName:"useSliderStyles",providerName:"<Slider />"}),CS=jt((n,e)=>{const i={...n,orientation:(n==null?void 0:n.orientation)??"horizontal"},o=za("Slider",i),l=Bi(i),{direction:u}=lb();l.direction=u;const{getInputProps:p,getRootProps:y,...E}=GUe(l),b=y(),T=p({},e);return S.jsx(KUe,{value:E,children:S.jsx(qUe,{value:o,children:S.jsxs(Lt.div,{...b,className:Sn("chakra-slider",i.className),__css:o.container,children:[i.children,S.jsx("input",{...T})]})})})});CS.displayName="Slider";const RS=jt((n,e)=>{const{getThumbProps:i}=RN(),o=IN(),l=i(n,e);return S.jsx(Lt.div,{...l,className:Sn("chakra-slider__thumb",n.className),__css:o.thumb})});RS.displayName="SliderThumb";const IS=jt((n,e)=>{const{getTrackProps:i}=RN(),o=IN(),l=i(n,e);return S.jsx(Lt.div,{...l,className:Sn("chakra-slider__track",n.className),__css:o.track})});IS.displayName="SliderTrack";const AS=jt((n,e)=>{const{getInnerTrackProps:i}=RN(),o=IN(),l=i(n,e);return S.jsx(Lt.div,{...l,className:Sn("chakra-slider__filled-track",n.className),__css:o.filledTrack})});AS.displayName="SliderFilledTrack";const YUe=jt((n,e)=>{const{getMarkerProps:i}=RN(),o=IN(),l=i(n,e);return S.jsx(Lt.div,{...l,className:Sn("chakra-slider__marker",n.className),__css:o.mark})});YUe.displayName="SliderMark";const qC=Lt("div",{baseStyle:{flex:1,justifySelf:"stretch",alignSelf:"stretch"}});qC.displayName="Spacer";const vie=n=>S.jsx(Lt.div,{className:"chakra-stack__item",...n,__css:{display:"inline-block",flex:"0 0 auto",minWidth:0,...n.__css}});vie.displayName="StackItem";function XUe(n){const{spacing:e,direction:i}=n,o={column:{my:e,mx:0,borderLeftWidth:0,borderBottomWidth:"1px"},"column-reverse":{my:e,mx:0,borderLeftWidth:0,borderBottomWidth:"1px"},row:{mx:e,my:0,borderLeftWidth:"1px",borderBottomWidth:0},"row-reverse":{mx:e,my:0,borderLeftWidth:"1px",borderBottomWidth:0}};return{"&":rN(i,l=>o[l])}}const jF=jt((n,e)=>{const{isInline:i,direction:o,align:l,justify:u,spacing:p="0.5rem",wrap:y,children:E,divider:b,className:T,shouldWrapChildren:R,...O}=n,L=i?"row":o??"column",D=k.useMemo(()=>XUe({spacing:p,direction:L}),[p,L]),U=!!b,F=!R&&!U,Y=k.useMemo(()=>{const re=nN(E);return F?re:re.map((le,ie)=>{const me=typeof le.key<"u"?le.key:ie,q=ie+1===re.length,Q=R?S.jsx(vie,{children:le},me):le;if(!U)return Q;const ne=k.cloneElement(b,{__css:D}),he=q?null:ne;return S.jsxs(k.Fragment,{children:[Q,he]},me)})},[b,D,U,F,R,E]),W=Sn("chakra-stack",T);return S.jsx(Lt.div,{ref:e,display:"flex",alignItems:l,justifyContent:u,flexDirection:L,flexWrap:y,gap:U?void 0:p,className:W,...O,children:Y})});jF.displayName="Stack";const Cn=jt((n,e)=>S.jsx(jF,{align:"center",...n,direction:"row",ref:e}));Cn.displayName="HStack";const Qn=jt((n,e)=>S.jsx(jF,{align:"center",...n,direction:"column",ref:e}));Qn.displayName="VStack";const ld=jt(function(e,i){const o=za("Switch",e),{spacing:l="0.5rem",children:u,...p}=Bi(e),{getIndicatorProps:y,getInputProps:E,getCheckboxProps:b,getRootProps:T,getLabelProps:R}=Hxe(p),O=k.useMemo(()=>({display:"inline-block",position:"relative",verticalAlign:"middle",lineHeight:0,...o.container}),[o.container]),L=k.useMemo(()=>({display:"inline-flex",flexShrink:0,justifyContent:"flex-start",boxSizing:"content-box",cursor:"pointer",...o.track}),[o.track]),D=k.useMemo(()=>({userSelect:"none",marginStart:l,...o.label}),[l,o.label]);return S.jsxs(Lt.label,{...T(),className:Sn("chakra-switch",e.className),__css:O,children:[S.jsx("input",{className:"chakra-switch__input",...E({},i)}),S.jsx(Lt.span,{...b(),className:"chakra-switch__track",__css:L,children:S.jsx(Lt.span,{__css:o.thumb,className:"chakra-switch__thumb",...y()})}),u&&S.jsx(Lt.span,{className:"chakra-switch__label",...R(),__css:D,children:u})]})});ld.displayName="Switch";const[JUe,QUe,ZUe,eVe]=Kne();function tVe(n){const{defaultIndex:e,onChange:i,index:o,isManual:l,isLazy:u,lazyBehavior:p="unmount",orientation:y="horizontal",direction:E="ltr",...b}=n,[T,R]=k.useState(e??0),[O,L]=vee({defaultValue:e??0,value:o,onChange:i});k.useEffect(()=>{o!=null&&R(o)},[o]);const D=ZUe(),U=k.useId();return{id:`tabs-${n.id??U}`,selectedIndex:O,focusedIndex:T,setSelectedIndex:L,setFocusedIndex:R,isManual:l,isLazy:u,lazyBehavior:p,orientation:y,descendants:D,direction:E,htmlProps:b}}const[nVe,AN]=xi({name:"TabsContext",errorMessage:"useTabsContext: `context` is undefined. Seems you forgot to wrap all tabs components within <Tabs />"});function rVe(n){const{focusedIndex:e,orientation:i,direction:o}=AN(),l=QUe(),u=k.useCallback(p=>{const y=()=>{var re;const W=l.nextEnabled(e);W&&((re=W.node)==null||re.focus())},E=()=>{var re;const W=l.prevEnabled(e);W&&((re=W.node)==null||re.focus())},b=()=>{var re;const W=l.firstEnabled();W&&((re=W.node)==null||re.focus())},T=()=>{var re;const W=l.lastEnabled();W&&((re=W.node)==null||re.focus())},R=i==="horizontal",O=i==="vertical",L=p.key,D=o==="ltr"?"ArrowLeft":"ArrowRight",U=o==="ltr"?"ArrowRight":"ArrowLeft",Y={[D]:()=>R&&E(),[U]:()=>R&&y(),ArrowDown:()=>O&&y(),ArrowUp:()=>O&&E(),Home:b,End:T}[L];Y&&(p.preventDefault(),Y(p))},[l,e,i,o]);return{...n,role:"tablist","aria-orientation":i,onKeyDown:jn(n.onKeyDown,u)}}function iVe(n){const{isDisabled:e=!1,isFocusable:i=!1,...o}=n,{setSelectedIndex:l,isManual:u,id:p,setFocusedIndex:y,selectedIndex:E}=AN(),{index:b,register:T}=eVe({disabled:e&&!i}),R=b===E,O=()=>{l(b)},L=()=>{y(b),!u&&!(e&&i)&&l(b)};return{...qre({...o,ref:Yi(T,n.ref),isDisabled:e,isFocusable:i,onClick:jn(n.onClick,O)}),id:Sie(p,b),role:"tab",tabIndex:R?0:-1,type:"button","aria-selected":R,"aria-controls":bie(p,b),onFocus:e?void 0:jn(n.onFocus,L)}}const[sVe,oVe]=xi({});function aVe(n){const e=AN(),{id:i,selectedIndex:o}=e,u=nN(n.children).map((p,y)=>k.createElement(sVe,{key:p.key??y,value:{isSelected:y===o,id:bie(i,y),tabId:Sie(i,y),selectedIndex:o}},p));return{...n,children:u}}function cVe(n){const{children:e,...i}=n,{isLazy:o,lazyBehavior:l}=AN(),{isSelected:u,id:p,tabId:y}=oVe(),E=k.useRef(!1);u&&(E.current=!0);const b=aj({wasSelected:E.current,isSelected:u,enabled:o,mode:l});return{tabIndex:0,...i,children:b?e:null,role:"tabpanel","aria-labelledby":y,hidden:!u,id:p}}function Sie(n,e){return`${n}--tab-${e}`}function bie(n,e){return`${n}--tabpanel-${e}`}const[lVe,PN]=xi({name:"TabsStylesContext",errorMessage:`useTabsStyles returned is 'undefined'. Seems you forgot to wrap the components in "<Tabs />" `}),$S=jt(function(e,i){const o=za("Tabs",e),{children:l,className:u,...p}=Bi(e),{htmlProps:y,descendants:E,...b}=tVe(p),T=k.useMemo(()=>b,[b]),{isFitted:R,...O}=y,L={position:"relative",...o.root};return S.jsx(JUe,{value:E,children:S.jsx(nVe,{value:T,children:S.jsx(lVe,{value:o,children:S.jsx(Lt.div,{className:Sn("chakra-tabs",u),ref:i,...O,__css:L,children:l})})})})});$S.displayName="Tabs";const ya=jt(function(e,i){const o=PN(),l=iVe({...e,ref:i}),u={outline:"0",display:"flex",alignItems:"center",justifyContent:"center",...o.tab};return S.jsx(Lt.button,{...l,className:Sn("chakra-tabs__tab",e.className),__css:u})});ya.displayName="Tab";const KS=jt(function(e,i){const o=rVe({...e,ref:i}),l=PN(),u={display:"flex",...l.tablist};return S.jsx(Lt.div,{...o,className:Sn("chakra-tabs__tablist",e.className),__css:u})});KS.displayName="TabList";const dc=jt(function(e,i){const o=cVe({...e,ref:i}),l=PN();return S.jsx(Lt.div,{outline:"0",...o,className:Sn("chakra-tabs__tab-panel",e.className),__css:l.tabpanel})});dc.displayName="TabPanel";const wR=jt(function(e,i){const o=aVe(e),l=PN();return S.jsx(Lt.div,{...o,width:"100%",ref:i,className:Sn("chakra-tabs__tab-panels",e.className),__css:l.tabpanels})});wR.displayName="TabPanels";const[uVe,wie]=xi({name:"TagStylesContext",errorMessage:`useTagStyles returned is 'undefined'. Seems you forgot to wrap the components in "<Tag />" `}),Tie=jt((n,e)=>{const i=za("Tag",n),o=Bi(n),l={display:"inline-flex",verticalAlign:"top",alignItems:"center",maxWidth:"100%",...i.container};return S.jsx(uVe,{value:i,children:S.jsx(Lt.span,{ref:e,...o,__css:l})})});Tie.displayName="Tag";const Cie=jt((n,e)=>{const i=wie();return S.jsx(Lt.span,{ref:e,noOfLines:1,...n,__css:i.label})});Cie.displayName="TagLabel";const dVe=jt((n,e)=>S.jsx(en,{ref:e,verticalAlign:"top",marginEnd:"0.5rem",...n}));dVe.displayName="TagLeftIcon";const hVe=jt((n,e)=>S.jsx(en,{ref:e,verticalAlign:"top",marginStart:"0.5rem",...n}));hVe.displayName="TagRightIcon";const Rie=n=>S.jsx(en,{verticalAlign:"inherit",viewBox:"0 0 512 512",...n,children:S.jsx("path",{fill:"currentColor",d:"M289.94 256l95-95A24 24 0 00351 127l-95 95-95-95a24 24 0 00-34 34l95 95-95 95a24 24 0 1034 34l95-95 95 95a24 24 0 0034-34z"})});Rie.displayName="TagCloseIcon";const Iie=jt((n,e)=>{const{isDisabled:i,children:o,...l}=n,p={display:"flex",alignItems:"center",justifyContent:"center",outline:"0",...wie().closeButton};return S.jsx(Lt.button,{ref:e,"aria-label":"close",...l,type:"button",disabled:i,__css:p,children:o||S.jsx(Rie,{})})});Iie.displayName="TagCloseButton";const pVe=["h","minH","height","minHeight"],Aie=jt((n,e)=>{const i=Su("Textarea",n),{className:o,rows:l,...u}=Bi(n),p=pF(u),y=l?UR(i,pVe):i;return S.jsx(Lt.textarea,{ref:e,rows:l,...p,className:Sn("chakra-textarea",o),__css:y})});Aie.displayName="Textarea";function fVe(n,e){const i=n??"bottom",l={"top-start":{ltr:"top-left",rtl:"top-right"},"top-end":{ltr:"top-right",rtl:"top-left"},"bottom-start":{ltr:"bottom-left",rtl:"bottom-right"},"bottom-end":{ltr:"bottom-right",rtl:"bottom-left"}}[i];return(l==null?void 0:l[e])??i}function mVe(n,e){const i=l=>({...e,...l,position:fVe((l==null?void 0:l.position)??(e==null?void 0:e.position),n)}),o=l=>{const u=i(l),p=Gne(u);return Ap.notify(p,u)};return o.update=(l,u)=>{Ap.update(l,i(u))},o.promise=(l,u)=>{const p=o({...u.loading,status:"loading",duration:null});l.then(y=>o.update(p,{status:"success",duration:5e3,...Cl(u.success,y)})).catch(y=>o.update(p,{status:"error",duration:5e3,...Cl(u.error,y)}))},o.closeAll=Ap.closeAll,o.close=Ap.close,o.isActive=Ap.isActive,o}function ea(n){const{theme:e}=Bne(),i=fxe();return k.useMemo(()=>mVe(e.direction,{...i,...n}),[n,e.direction,i])}const gVe={exit:{scale:.85,opacity:0,transition:{opacity:{duration:.15,easings:"easeInOut"},scale:{duration:.2,easings:"easeInOut"}}},enter:{scale:1,opacity:1,transition:{opacity:{easings:"easeOut",duration:.2},scale:{duration:.2,ease:[.175,.885,.4,1.1]}}}},v5=n=>{var e;return((e=n.current)==null?void 0:e.ownerDocument)||document},KO=n=>{var e,i;return((i=(e=n.current)==null?void 0:e.ownerDocument)==null?void 0:i.defaultView)||window};function _Ve(n={}){const{openDelay:e=0,closeDelay:i=0,closeOnClick:o=!0,closeOnMouseDown:l,closeOnScroll:u,closeOnPointerDown:p=l,closeOnEsc:y=!0,onOpen:E,onClose:b,placement:T,id:R,isOpen:O,defaultIsOpen:L,arrowSize:D=10,arrowShadowColor:U,arrowPadding:F,modifiers:Y,isDisabled:W,gutter:re,offset:le,direction:ie,...me}=n,{isOpen:q,onOpen:J,onClose:Q}=yu({isOpen:O,defaultIsOpen:L,onOpen:E,onClose:b}),{referenceRef:ne,getPopperProps:he,getArrowInnerProps:de,getArrowProps:pe}=UF({enabled:q,placement:T,arrowPadding:F,modifiers:Y,gutter:re,offset:le,direction:ie}),Se=k.useId(),Fe=`tooltip-${R??Se}`,we=k.useRef(null),Re=k.useRef(void 0),Te=k.useCallback(()=>{Re.current&&(clearTimeout(Re.current),Re.current=void 0)},[]),Ne=k.useRef(void 0),be=k.useCallback(()=>{Ne.current&&(clearTimeout(Ne.current),Ne.current=void 0)},[]),xe=k.useCallback(()=>{be(),Q()},[Q,be]),je=yVe(we,xe),nt=k.useCallback(()=>{if(!W&&!Re.current){q&&je();const Gt=KO(we);Re.current=Gt.setTimeout(J,e)}},[je,W,q,J,e]),dt=k.useCallback(()=>{Te();const Gt=KO(we);Ne.current=Gt.setTimeout(xe,i)},[i,xe,Te]),ft=k.useCallback(()=>{q&&o&&dt()},[o,dt,q]),lt=k.useCallback(()=>{q&&p&&dt()},[p,dt,q]),gt=k.useCallback(Gt=>{q&&Gt.key==="Escape"&&dt()},[q,dt]);Gy(()=>v5(we),"keydown",y?gt:void 0),Gy(()=>{if(!u)return null;const Gt=we.current;if(!Gt)return null;const Jt=yee(Gt);return Jt.localName==="body"?KO(we):Jt},"scroll",()=>{q&&u&&xe()},{passive:!0,capture:!0}),k.useEffect(()=>{W&&(Te(),q&&Q())},[W,q,Q,Te]),k.useEffect(()=>()=>{Te(),be()},[Te,be]),Gy(()=>we.current,"pointerleave",dt);const at=k.useCallback((Gt={},Jt=null)=>({...Gt,ref:Yi(we,Jt,ne),onPointerEnter:jn(Gt.onPointerEnter,hn=>{hn.pointerType!=="touch"&&nt()}),onClick:jn(Gt.onClick,ft),onPointerDown:jn(Gt.onPointerDown,lt),onFocus:jn(Gt.onFocus,nt),onBlur:jn(Gt.onBlur,dt),"aria-describedby":q?Fe:void 0}),[nt,dt,lt,q,Fe,ft,ne]),Ct=k.useCallback((Gt={},Jt=null)=>he({...Gt,style:{...Gt.style,[Oo.arrowSize.var]:D?`${D}px`:void 0,[Oo.arrowShadowColor.var]:U}},Jt),[he,D,U]),En=k.useCallback((Gt={},Jt=null)=>{const st={...Gt.style,position:"relative",transformOrigin:Oo.transformOrigin.varRef};return{ref:Jt,...me,...Gt,id:Fe,role:"tooltip",style:st}},[me,Fe]);return{isOpen:q,show:nt,hide:dt,getTriggerProps:at,getTooltipProps:En,getTooltipPositionerProps:Ct,getArrowProps:pe,getArrowInnerProps:de}}const rV="chakra-ui:close-tooltip";function yVe(n,e){return k.useEffect(()=>{const i=v5(n);return i.addEventListener(rV,e),()=>i.removeEventListener(rV,e)},[e,n]),()=>{const i=v5(n),o=KO(n);i.dispatchEvent(new o.CustomEvent(rV))}}const EVe=Lt(wh.div),Kf=jt((n,e)=>{const i=Su("Tooltip",n),o=Bi(n),l=lb(),{children:u,label:p,shouldWrapChildren:y,"aria-label":E,hasArrow:b,bg:T,portalProps:R,background:O,backgroundColor:L,bgColor:D,motionProps:U,animatePresenceProps:F,...Y}=o,W=O??L??T??D;if(W){i.bg=W;const ne=hSe(l,"colors",W);i[Oo.arrowBg.var]=ne}const re=_Ve({...Y,direction:l.direction}),le=!k.isValidElement(u)||y;let ie;if(le)ie=S.jsx(Lt.span,{display:"inline-block",tabIndex:0,...re.getTriggerProps(),children:u});else{const ne=k.Children.only(u);ie=k.cloneElement(ne,re.getTriggerProps(ne.props,hie(ne)))}const me=!!E,q=re.getTooltipProps({},e),J=me?UR(q,["role","id"]):q,Q=_ee(q,["role","id"]);return p?S.jsxs(S.Fragment,{children:[ie,S.jsx(EE,{...F,children:re.isOpen&&S.jsx(Bc,{...R,children:S.jsx(Lt.div,{...re.getTooltipPositionerProps(),__css:{zIndex:i.zIndex,pointerEvents:"none"},children:S.jsxs(EVe,{variants:gVe,initial:"exit",animate:"enter",exit:"exit",...U,...J,__css:i,children:[p,me&&S.jsx(Lt.span,{srOnly:!0,...Q,children:E}),b&&S.jsx(Lt.div,{"data-popper-arrow":!0,className:"chakra-tooltip__arrow-wrapper",children:S.jsx(Lt.div,{"data-popper-arrow-inner":!0,className:"chakra-tooltip__arrow",__css:{bg:i.bg}})})]})})})})]}):S.jsx(S.Fragment,{children:u})});Kf.displayName="Tooltip";const TR=jt(function(e,i){const o=Su("Heading",e),{className:l,...u}=Bi(e);return S.jsx(Lt.h2,{ref:i,className:Sn("chakra-heading",e.className),...u,__css:o})});TR.displayName="Heading";const $e=jt(function(e,i){const o=Su("Text",e),{className:l,align:u,decoration:p,casing:y,...E}=Bi(e),b=oj({textAlign:e.align,textDecoration:e.decoration,textTransform:e.casing});return S.jsx(Lt.p,{ref:i,className:Sn("chakra-text",e.className),...b,...E,__css:o})});$e.displayName="Text";const Pie=jt(function(e,i){const{spacing:o="0.5rem",spacingX:l,spacingY:u,children:p,justify:y,direction:E,align:b,className:T,shouldWrapChildren:R,...O}=e,L=k.useMemo(()=>R?k.Children.map(p,(D,U)=>S.jsx(FF,{children:D},U)):p,[p,R]);return S.jsx(Lt.div,{ref:i,className:Sn("chakra-wrap",T),...O,children:S.jsx(Lt.ul,{className:"chakra-wrap__list",__css:{display:"flex",flexWrap:"wrap",justifyContent:y,alignItems:b,flexDirection:E,listStyleType:"none",gap:o,columnGap:l,rowGap:u,padding:"0"},children:L})})});Pie.displayName="Wrap";const FF=jt(function(e,i){const{className:o,...l}=e;return S.jsx(Lt.li,{ref:i,__css:{display:"flex",alignItems:"flex-start"},className:Sn("chakra-wrap__listitem",o),...l})});FF.displayName="WrapItem";const vVe="modulepreload",SVe=function(n,e){return new URL(n,e).href},pJ={},iV=function(e,i,o){let l=Promise.resolve();if(i&&i.length>0){let p=function(T){return Promise.all(T.map(R=>Promise.resolve(R).then(O=>({status:"fulfilled",value:O}),O=>({status:"rejected",reason:O}))))};const y=document.getElementsByTagName("link"),E=document.querySelector("meta[property=csp-nonce]"),b=(E==null?void 0:E.nonce)||(E==null?void 0:E.getAttribute("nonce"));l=p(i.map(T=>{if(T=SVe(T,o),T in pJ)return;pJ[T]=!0;const R=T.endsWith(".css"),O=R?'[rel="stylesheet"]':"";if(!!o)for(let U=y.length-1;U>=0;U--){const F=y[U];if(F.href===T&&(!R||F.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${T}"]${O}`))return;const D=document.createElement("link");if(D.rel=R?"stylesheet":vVe,R||(D.as="script"),D.crossOrigin="",D.href=T,b&&D.setAttribute("nonce",b),document.head.appendChild(D),R)return new Promise((U,F)=>{D.addEventListener("load",U),D.addEventListener("error",()=>F(new Error(`Unable to preload CSS for ${T}`)))})}))}function u(p){const y=new Event("vite:preloadError",{cancelable:!0});if(y.payload=p,window.dispatchEvent(y),!y.defaultPrevented)throw p}return l.then(p=>{for(const y of p||[])y.status==="rejected"&&u(y.reason);return e().catch(u)})},sV=()=>{const n=new Date,e=n.getHours().toString().padStart(2,"0"),i=n.getMinutes().toString().padStart(2,"0"),o=n.getSeconds().toString().padStart(2,"0"),l=n.getMilliseconds().toString().padStart(3,"0");return`${e}:${i}:${o}.${l}`},G={log:(...n)=>{n.map((e,i)=>i===0&&typeof e=="string"?`
${e}`:e)},error:(...n)=>{{const e=n.map((i,o)=>o===0&&typeof i=="string"?`
${i}`:i);console.error(`[ERROR] [${sV()}] `,...e)}},warn:(...n)=>{{const e=n.map((i,o)=>o===0&&typeof i=="string"?`
${i}`:i);console.warn(`[WARN] [${sV()}]`,...e)}},trace:n=>{console.trace(`[TRACE] [${sV()}] ${n}`)}};async function fJ(n){let e;try{switch(n){case"default":e=await iV(()=>import("./index.v0.1.5.js"),[],import.meta.url);break;default:e=await iV(()=>import("./index.v0.1.5.js"),[],import.meta.url)}return e.default}catch(i){return G.error("Failed to load theme:",i),e=await iV(()=>import("./index.v0.1.5.js"),[],import.meta.url),e.default}}const bVe=()=>{};var mJ={};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Oie=function(n){const e=[];let i=0;for(let o=0;o<n.length;o++){let l=n.charCodeAt(o);l<128?e[i++]=l:l<2048?(e[i++]=l>>6|192,e[i++]=l&63|128):(l&64512)===55296&&o+1<n.length&&(n.charCodeAt(o+1)&64512)===56320?(l=65536+((l&1023)<<10)+(n.charCodeAt(++o)&1023),e[i++]=l>>18|240,e[i++]=l>>12&63|128,e[i++]=l>>6&63|128,e[i++]=l&63|128):(e[i++]=l>>12|224,e[i++]=l>>6&63|128,e[i++]=l&63|128)}return e},wVe=function(n){const e=[];let i=0,o=0;for(;i<n.length;){const l=n[i++];if(l<128)e[o++]=String.fromCharCode(l);else if(l>191&&l<224){const u=n[i++];e[o++]=String.fromCharCode((l&31)<<6|u&63)}else if(l>239&&l<365){const u=n[i++],p=n[i++],y=n[i++],E=((l&7)<<18|(u&63)<<12|(p&63)<<6|y&63)-65536;e[o++]=String.fromCharCode(55296+(E>>10)),e[o++]=String.fromCharCode(56320+(E&1023))}else{const u=n[i++],p=n[i++];e[o++]=String.fromCharCode((l&15)<<12|(u&63)<<6|p&63)}}return e.join("")},kie={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:typeof atob=="function",encodeByteArray(n,e){if(!Array.isArray(n))throw Error("encodeByteArray takes an array as a parameter");this.init_();const i=e?this.byteToCharMapWebSafe_:this.byteToCharMap_,o=[];for(let l=0;l<n.length;l+=3){const u=n[l],p=l+1<n.length,y=p?n[l+1]:0,E=l+2<n.length,b=E?n[l+2]:0,T=u>>2,R=(u&3)<<4|y>>4;let O=(y&15)<<2|b>>6,L=b&63;E||(L=64,p||(O=64)),o.push(i[T],i[R],i[O],i[L])}return o.join("")},encodeString(n,e){return this.HAS_NATIVE_SUPPORT&&!e?btoa(n):this.encodeByteArray(Oie(n),e)},decodeString(n,e){return this.HAS_NATIVE_SUPPORT&&!e?atob(n):wVe(this.decodeStringToByteArray(n,e))},decodeStringToByteArray(n,e){this.init_();const i=e?this.charToByteMapWebSafe_:this.charToByteMap_,o=[];for(let l=0;l<n.length;){const u=i[n.charAt(l++)],y=l<n.length?i[n.charAt(l)]:0;++l;const b=l<n.length?i[n.charAt(l)]:64;++l;const R=l<n.length?i[n.charAt(l)]:64;if(++l,u==null||y==null||b==null||R==null)throw new TVe;const O=u<<2|y>>4;if(o.push(O),b!==64){const L=y<<4&240|b>>2;if(o.push(L),R!==64){const D=b<<6&192|R;o.push(D)}}}return o},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let n=0;n<this.ENCODED_VALS.length;n++)this.byteToCharMap_[n]=this.ENCODED_VALS.charAt(n),this.charToByteMap_[this.byteToCharMap_[n]]=n,this.byteToCharMapWebSafe_[n]=this.ENCODED_VALS_WEBSAFE.charAt(n),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[n]]=n,n>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(n)]=n,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(n)]=n)}}};class TVe extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}const CVe=function(n){const e=Oie(n);return kie.encodeByteArray(e,!0)},Ck=function(n){return CVe(n).replace(/\./g,"")},Nie=function(n){try{return kie.decodeString(n,!0)}catch(e){console.error("base64Decode failed: ",e)}return null};/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function RVe(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("Unable to locate global object.")}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const IVe=()=>RVe().__FIREBASE_DEFAULTS__,AVe=()=>{if(typeof process>"u"||typeof mJ>"u")return;const n=mJ.__FIREBASE_DEFAULTS__;if(n)return JSON.parse(n)},PVe=()=>{if(typeof document>"u")return;let n;try{n=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch{return}const e=n&&Nie(n[1]);return e&&JSON.parse(e)},ON=()=>{try{return bVe()||IVe()||AVe()||PVe()}catch(n){console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${n}`);return}},xie=n=>{var e,i;return(i=(e=ON())===null||e===void 0?void 0:e.emulatorHosts)===null||i===void 0?void 0:i[n]},BF=n=>{const e=xie(n);if(!e)return;const i=e.lastIndexOf(":");if(i<=0||i+1===e.length)throw new Error(`Invalid host ${e} with no separate hostname and port!`);const o=parseInt(e.substring(i+1),10);return e[0]==="["?[e.substring(1,i-1),o]:[e.substring(0,i),o]},Die=()=>{var n;return(n=ON())===null||n===void 0?void 0:n.config},Lie=n=>{var e;return(e=ON())===null||e===void 0?void 0:e[`_${n}`]};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class OVe{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((e,i)=>{this.resolve=e,this.reject=i})}wrapCallback(e){return(i,o)=>{i?this.reject(i):this.resolve(o),typeof e=="function"&&(this.promise.catch(()=>{}),e.length===1?e(i):e(i,o))}}}/**
 * @license
 * Copyright 2025 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function cm(n){try{return(n.startsWith("http://")||n.startsWith("https://")?new URL(n).hostname:n).endsWith(".cloudworkstations.dev")}catch{return!1}}async function kN(n){return(await fetch(n,{credentials:"include"})).ok}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Mie(n,e){if(n.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');const i={alg:"none",type:"JWT"},o=e||"demo-project",l=n.iat||0,u=n.sub||n.user_id;if(!u)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");const p=Object.assign({iss:`https://securetoken.google.com/${o}`,aud:o,iat:l,exp:l+3600,auth_time:l,sub:u,user_id:u,firebase:{sign_in_provider:"custom",identities:{}}},n);return[Ck(JSON.stringify(i)),Ck(JSON.stringify(p)),""].join(".")}const YC={};function kVe(){const n={prod:[],emulator:[]};for(const e of Object.keys(YC))YC[e]?n.emulator.push(e):n.prod.push(e);return n}function NVe(n){let e=document.getElementById(n),i=!1;return e||(e=document.createElement("div"),e.setAttribute("id",n),i=!0),{created:i,element:e}}let gJ=!1;function NN(n,e){if(typeof window>"u"||typeof document>"u"||!cm(window.location.host)||YC[n]===e||YC[n]||gJ)return;YC[n]=e;function i(O){return`__firebase__banner__${O}`}const o="__firebase__banner",u=kVe().prod.length>0;function p(){const O=document.getElementById(o);O&&O.remove()}function y(O){O.style.display="flex",O.style.background="#7faaf0",O.style.position="fixed",O.style.bottom="5px",O.style.left="5px",O.style.padding=".5em",O.style.borderRadius="5px",O.style.alignItems="center"}function E(O,L){O.setAttribute("width","24"),O.setAttribute("id",L),O.setAttribute("height","24"),O.setAttribute("viewBox","0 0 24 24"),O.setAttribute("fill","none"),O.style.marginLeft="-6px"}function b(){const O=document.createElement("span");return O.style.cursor="pointer",O.style.marginLeft="16px",O.style.fontSize="24px",O.innerHTML=" &times;",O.onclick=()=>{gJ=!0,p()},O}function T(O,L){O.setAttribute("id",L),O.innerText="Learn more",O.href="https://firebase.google.com/docs/studio/preview-apps#preview-backend",O.setAttribute("target","__blank"),O.style.paddingLeft="5px",O.style.textDecoration="underline"}function R(){const O=NVe(o),L=i("text"),D=document.getElementById(L)||document.createElement("span"),U=i("learnmore"),F=document.getElementById(U)||document.createElement("a"),Y=i("preprendIcon"),W=document.getElementById(Y)||document.createElementNS("http://www.w3.org/2000/svg","svg");if(O.created){const re=O.element;y(re),T(F,U);const le=b();E(W,Y),re.append(W,D,F,le),document.body.appendChild(re)}u?(D.innerText="Preview backend disconnected.",W.innerHTML=`<g clip-path="url(#clip0_6013_33858)">
<path d="M4.8 17.6L12 5.6L19.2 17.6H4.8ZM6.91667 16.4H17.0833L12 7.93333L6.91667 16.4ZM12 15.6C12.1667 15.6 12.3056 15.5444 12.4167 15.4333C12.5389 15.3111 12.6 15.1667 12.6 15C12.6 14.8333 12.5389 14.6944 12.4167 14.5833C12.3056 14.4611 12.1667 14.4 12 14.4C11.8333 14.4 11.6889 14.4611 11.5667 14.5833C11.4556 14.6944 11.4 14.8333 11.4 15C11.4 15.1667 11.4556 15.3111 11.5667 15.4333C11.6889 15.5444 11.8333 15.6 12 15.6ZM11.4 13.6H12.6V10.4H11.4V13.6Z" fill="#212121"/>
</g>
<defs>
<clipPath id="clip0_6013_33858">
<rect width="24" height="24" fill="white"/>
</clipPath>
</defs>`):(W.innerHTML=`<g clip-path="url(#clip0_6083_34804)">
<path d="M11.4 15.2H12.6V11.2H11.4V15.2ZM12 10C12.1667 10 12.3056 9.94444 12.4167 9.83333C12.5389 9.71111 12.6 9.56667 12.6 9.4C12.6 9.23333 12.5389 9.09444 12.4167 8.98333C12.3056 8.86111 12.1667 8.8 12 8.8C11.8333 8.8 11.6889 8.86111 11.5667 8.98333C11.4556 9.09444 11.4 9.23333 11.4 9.4C11.4 9.56667 11.4556 9.71111 11.5667 9.83333C11.6889 9.94444 11.8333 10 12 10ZM12 18.4C11.1222 18.4 10.2944 18.2333 9.51667 17.9C8.73889 17.5667 8.05556 17.1111 7.46667 16.5333C6.88889 15.9444 6.43333 15.2611 6.1 14.4833C5.76667 13.7056 5.6 12.8778 5.6 12C5.6 11.1111 5.76667 10.2833 6.1 9.51667C6.43333 8.73889 6.88889 8.06111 7.46667 7.48333C8.05556 6.89444 8.73889 6.43333 9.51667 6.1C10.2944 5.76667 11.1222 5.6 12 5.6C12.8889 5.6 13.7167 5.76667 14.4833 6.1C15.2611 6.43333 15.9389 6.89444 16.5167 7.48333C17.1056 8.06111 17.5667 8.73889 17.9 9.51667C18.2333 10.2833 18.4 11.1111 18.4 12C18.4 12.8778 18.2333 13.7056 17.9 14.4833C17.5667 15.2611 17.1056 15.9444 16.5167 16.5333C15.9389 17.1111 15.2611 17.5667 14.4833 17.9C13.7167 18.2333 12.8889 18.4 12 18.4ZM12 17.2C13.4444 17.2 14.6722 16.6944 15.6833 15.6833C16.6944 14.6722 17.2 13.4444 17.2 12C17.2 10.5556 16.6944 9.32778 15.6833 8.31667C14.6722 7.30555 13.4444 6.8 12 6.8C10.5556 6.8 9.32778 7.30555 8.31667 8.31667C7.30556 9.32778 6.8 10.5556 6.8 12C6.8 13.4444 7.30556 14.6722 8.31667 15.6833C9.32778 16.6944 10.5556 17.2 12 17.2Z" fill="#212121"/>
</g>
<defs>
<clipPath id="clip0_6083_34804">
<rect width="24" height="24" fill="white"/>
</clipPath>
</defs>`,D.innerText="Preview backend running in this workspace."),D.setAttribute("id",L)}document.readyState==="loading"?window.addEventListener("DOMContentLoaded",R):R()}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function gc(){return typeof navigator<"u"&&typeof navigator.userAgent=="string"?navigator.userAgent:""}function xVe(){return typeof window<"u"&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(gc())}function DVe(){var n;const e=(n=ON())===null||n===void 0?void 0:n.forceEnvironment;if(e==="node")return!0;if(e==="browser")return!1;try{return Object.prototype.toString.call(global.process)==="[object process]"}catch{return!1}}function LVe(){return typeof navigator<"u"&&navigator.userAgent==="Cloudflare-Workers"}function MVe(){const n=typeof chrome=="object"?chrome.runtime:typeof browser=="object"?browser.runtime:void 0;return typeof n=="object"&&n.id!==void 0}function UVe(){return typeof navigator=="object"&&navigator.product==="ReactNative"}function VVe(){const n=gc();return n.indexOf("MSIE ")>=0||n.indexOf("Trident/")>=0}function jVe(){return!DVe()&&!!navigator.userAgent&&navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome")}function FVe(){try{return typeof indexedDB=="object"}catch{return!1}}function BVe(){return new Promise((n,e)=>{try{let i=!0;const o="validate-browser-context-for-indexeddb-analytics-module",l=self.indexedDB.open(o);l.onsuccess=()=>{l.result.close(),i||self.indexedDB.deleteDatabase(o),n(!0)},l.onupgradeneeded=()=>{i=!1},l.onerror=()=>{var u;e(((u=l.error)===null||u===void 0?void 0:u.message)||"")}}catch(i){e(i)}})}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const zVe="FirebaseError";class Th extends Error{constructor(e,i,o){super(i),this.code=e,this.customData=o,this.name=zVe,Object.setPrototypeOf(this,Th.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,ZR.prototype.create)}}class ZR{constructor(e,i,o){this.service=e,this.serviceName=i,this.errors=o}create(e,...i){const o=i[0]||{},l=`${this.service}/${e}`,u=this.errors[e],p=u?WVe(u,o):"Error",y=`${this.serviceName}: ${p} (${l}).`;return new Th(l,y,o)}}function WVe(n,e){return n.replace(GVe,(i,o)=>{const l=e[o];return l!=null?String(l):`<${o}?>`})}const GVe=/\{\$([^}]+)}/g;function HVe(n){for(const e in n)if(Object.prototype.hasOwnProperty.call(n,e))return!1;return!0}function em(n,e){if(n===e)return!0;const i=Object.keys(n),o=Object.keys(e);for(const l of i){if(!o.includes(l))return!1;const u=n[l],p=e[l];if(_J(u)&&_J(p)){if(!em(u,p))return!1}else if(u!==p)return!1}for(const l of o)if(!i.includes(l))return!1;return!0}function _J(n){return n!==null&&typeof n=="object"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function eI(n){const e=[];for(const[i,o]of Object.entries(n))Array.isArray(o)?o.forEach(l=>{e.push(encodeURIComponent(i)+"="+encodeURIComponent(l))}):e.push(encodeURIComponent(i)+"="+encodeURIComponent(o));return e.length?"&"+e.join("&"):""}function AC(n){const e={};return n.replace(/^\?/,"").split("&").forEach(o=>{if(o){const[l,u]=o.split("=");e[decodeURIComponent(l)]=decodeURIComponent(u)}}),e}function PC(n){const e=n.indexOf("?");if(!e)return"";const i=n.indexOf("#",e);return n.substring(e,i>0?i:void 0)}function $Ve(n,e){const i=new KVe(n,e);return i.subscribe.bind(i)}class KVe{constructor(e,i){this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=i,this.task.then(()=>{e(this)}).catch(o=>{this.error(o)})}next(e){this.forEachObserver(i=>{i.next(e)})}error(e){this.forEachObserver(i=>{i.error(e)}),this.close(e)}complete(){this.forEachObserver(e=>{e.complete()}),this.close()}subscribe(e,i,o){let l;if(e===void 0&&i===void 0&&o===void 0)throw new Error("Missing Observer.");qVe(e,["next","error","complete"])?l=e:l={next:e,error:i,complete:o},l.next===void 0&&(l.next=oV),l.error===void 0&&(l.error=oV),l.complete===void 0&&(l.complete=oV);const u=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then(()=>{try{this.finalError?l.error(this.finalError):l.complete()}catch{}}),this.observers.push(l),u}unsubscribeOne(e){this.observers===void 0||this.observers[e]===void 0||(delete this.observers[e],this.observerCount-=1,this.observerCount===0&&this.onNoObservers!==void 0&&this.onNoObservers(this))}forEachObserver(e){if(!this.finalized)for(let i=0;i<this.observers.length;i++)this.sendOne(i,e)}sendOne(e,i){this.task.then(()=>{if(this.observers!==void 0&&this.observers[e]!==void 0)try{i(this.observers[e])}catch(o){typeof console<"u"&&console.error&&console.error(o)}})}close(e){this.finalized||(this.finalized=!0,e!==void 0&&(this.finalError=e),this.task.then(()=>{this.observers=void 0,this.onNoObservers=void 0}))}}function qVe(n,e){if(typeof n!="object"||n===null)return!1;for(const i of e)if(i in n&&typeof n[i]=="function")return!0;return!1}function oV(){}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ni(n){return n&&n._delegate?n._delegate:n}class tm{constructor(e,i,o){this.name=e,this.instanceFactory=i,this.type=o,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(e){return this.instantiationMode=e,this}setMultipleInstances(e){return this.multipleInstances=e,this}setServiceProps(e){return this.serviceProps=e,this}setInstanceCreatedCallback(e){return this.onInstanceCreated=e,this}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ny="[DEFAULT]";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class YVe{constructor(e,i){this.name=e,this.container=i,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(e){const i=this.normalizeInstanceIdentifier(e);if(!this.instancesDeferred.has(i)){const o=new OVe;if(this.instancesDeferred.set(i,o),this.isInitialized(i)||this.shouldAutoInitialize())try{const l=this.getOrInitializeService({instanceIdentifier:i});l&&o.resolve(l)}catch{}}return this.instancesDeferred.get(i).promise}getImmediate(e){var i;const o=this.normalizeInstanceIdentifier(e==null?void 0:e.identifier),l=(i=e==null?void 0:e.optional)!==null&&i!==void 0?i:!1;if(this.isInitialized(o)||this.shouldAutoInitialize())try{return this.getOrInitializeService({instanceIdentifier:o})}catch(u){if(l)return null;throw u}else{if(l)return null;throw Error(`Service ${this.name} is not available`)}}getComponent(){return this.component}setComponent(e){if(e.name!==this.name)throw Error(`Mismatching Component ${e.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=e,!!this.shouldAutoInitialize()){if(JVe(e))try{this.getOrInitializeService({instanceIdentifier:Ny})}catch{}for(const[i,o]of this.instancesDeferred.entries()){const l=this.normalizeInstanceIdentifier(i);try{const u=this.getOrInitializeService({instanceIdentifier:l});o.resolve(u)}catch{}}}}clearInstance(e=Ny){this.instancesDeferred.delete(e),this.instancesOptions.delete(e),this.instances.delete(e)}async delete(){const e=Array.from(this.instances.values());await Promise.all([...e.filter(i=>"INTERNAL"in i).map(i=>i.INTERNAL.delete()),...e.filter(i=>"_delete"in i).map(i=>i._delete())])}isComponentSet(){return this.component!=null}isInitialized(e=Ny){return this.instances.has(e)}getOptions(e=Ny){return this.instancesOptions.get(e)||{}}initialize(e={}){const{options:i={}}=e,o=this.normalizeInstanceIdentifier(e.instanceIdentifier);if(this.isInitialized(o))throw Error(`${this.name}(${o}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);const l=this.getOrInitializeService({instanceIdentifier:o,options:i});for(const[u,p]of this.instancesDeferred.entries()){const y=this.normalizeInstanceIdentifier(u);o===y&&p.resolve(l)}return l}onInit(e,i){var o;const l=this.normalizeInstanceIdentifier(i),u=(o=this.onInitCallbacks.get(l))!==null&&o!==void 0?o:new Set;u.add(e),this.onInitCallbacks.set(l,u);const p=this.instances.get(l);return p&&e(p,l),()=>{u.delete(e)}}invokeOnInitCallbacks(e,i){const o=this.onInitCallbacks.get(i);if(o)for(const l of o)try{l(e,i)}catch{}}getOrInitializeService({instanceIdentifier:e,options:i={}}){let o=this.instances.get(e);if(!o&&this.component&&(o=this.component.instanceFactory(this.container,{instanceIdentifier:XVe(e),options:i}),this.instances.set(e,o),this.instancesOptions.set(e,i),this.invokeOnInitCallbacks(o,e),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,e,o)}catch{}return o||null}normalizeInstanceIdentifier(e=Ny){return this.component?this.component.multipleInstances?e:Ny:e}shouldAutoInitialize(){return!!this.component&&this.component.instantiationMode!=="EXPLICIT"}}function XVe(n){return n===Ny?void 0:n}function JVe(n){return n.instantiationMode==="EAGER"}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class QVe{constructor(e){this.name=e,this.providers=new Map}addComponent(e){const i=this.getProvider(e.name);if(i.isComponentSet())throw new Error(`Component ${e.name} has already been registered with ${this.name}`);i.setComponent(e)}addOrOverwriteComponent(e){this.getProvider(e.name).isComponentSet()&&this.providers.delete(e.name),this.addComponent(e)}getProvider(e){if(this.providers.has(e))return this.providers.get(e);const i=new YVe(e,this);return this.providers.set(e,i),i}getProviders(){return Array.from(this.providers.values())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var zr;(function(n){n[n.DEBUG=0]="DEBUG",n[n.VERBOSE=1]="VERBOSE",n[n.INFO=2]="INFO",n[n.WARN=3]="WARN",n[n.ERROR=4]="ERROR",n[n.SILENT=5]="SILENT"})(zr||(zr={}));const ZVe={debug:zr.DEBUG,verbose:zr.VERBOSE,info:zr.INFO,warn:zr.WARN,error:zr.ERROR,silent:zr.SILENT},e5e=zr.INFO,t5e={[zr.DEBUG]:"log",[zr.VERBOSE]:"log",[zr.INFO]:"info",[zr.WARN]:"warn",[zr.ERROR]:"error"},n5e=(n,e,...i)=>{if(e<n.logLevel)return;const o=new Date().toISOString(),l=t5e[e];if(l)console[l](`[${o}]  ${n.name}:`,...i);else throw new Error(`Attempted to log a message with an invalid logType (value: ${e})`)};class zF{constructor(e){this.name=e,this._logLevel=e5e,this._logHandler=n5e,this._userLogHandler=null}get logLevel(){return this._logLevel}set logLevel(e){if(!(e in zr))throw new TypeError(`Invalid value "${e}" assigned to \`logLevel\``);this._logLevel=e}setLogLevel(e){this._logLevel=typeof e=="string"?ZVe[e]:e}get logHandler(){return this._logHandler}set logHandler(e){if(typeof e!="function")throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e}get userLogHandler(){return this._userLogHandler}set userLogHandler(e){this._userLogHandler=e}debug(...e){this._userLogHandler&&this._userLogHandler(this,zr.DEBUG,...e),this._logHandler(this,zr.DEBUG,...e)}log(...e){this._userLogHandler&&this._userLogHandler(this,zr.VERBOSE,...e),this._logHandler(this,zr.VERBOSE,...e)}info(...e){this._userLogHandler&&this._userLogHandler(this,zr.INFO,...e),this._logHandler(this,zr.INFO,...e)}warn(...e){this._userLogHandler&&this._userLogHandler(this,zr.WARN,...e),this._logHandler(this,zr.WARN,...e)}error(...e){this._userLogHandler&&this._userLogHandler(this,zr.ERROR,...e),this._logHandler(this,zr.ERROR,...e)}}const r5e=(n,e)=>e.some(i=>n instanceof i);let yJ,EJ;function i5e(){return yJ||(yJ=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function s5e(){return EJ||(EJ=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}const Uie=new WeakMap,S5=new WeakMap,Vie=new WeakMap,aV=new WeakMap,WF=new WeakMap;function o5e(n){const e=new Promise((i,o)=>{const l=()=>{n.removeEventListener("success",u),n.removeEventListener("error",p)},u=()=>{i(Lg(n.result)),l()},p=()=>{o(n.error),l()};n.addEventListener("success",u),n.addEventListener("error",p)});return e.then(i=>{i instanceof IDBCursor&&Uie.set(i,n)}).catch(()=>{}),WF.set(e,n),e}function a5e(n){if(S5.has(n))return;const e=new Promise((i,o)=>{const l=()=>{n.removeEventListener("complete",u),n.removeEventListener("error",p),n.removeEventListener("abort",p)},u=()=>{i(),l()},p=()=>{o(n.error||new DOMException("AbortError","AbortError")),l()};n.addEventListener("complete",u),n.addEventListener("error",p),n.addEventListener("abort",p)});S5.set(n,e)}let b5={get(n,e,i){if(n instanceof IDBTransaction){if(e==="done")return S5.get(n);if(e==="objectStoreNames")return n.objectStoreNames||Vie.get(n);if(e==="store")return i.objectStoreNames[1]?void 0:i.objectStore(i.objectStoreNames[0])}return Lg(n[e])},set(n,e,i){return n[e]=i,!0},has(n,e){return n instanceof IDBTransaction&&(e==="done"||e==="store")?!0:e in n}};function c5e(n){b5=n(b5)}function l5e(n){return n===IDBDatabase.prototype.transaction&&!("objectStoreNames"in IDBTransaction.prototype)?function(e,...i){const o=n.call(cV(this),e,...i);return Vie.set(o,e.sort?e.sort():[e]),Lg(o)}:s5e().includes(n)?function(...e){return n.apply(cV(this),e),Lg(Uie.get(this))}:function(...e){return Lg(n.apply(cV(this),e))}}function u5e(n){return typeof n=="function"?l5e(n):(n instanceof IDBTransaction&&a5e(n),r5e(n,i5e())?new Proxy(n,b5):n)}function Lg(n){if(n instanceof IDBRequest)return o5e(n);if(aV.has(n))return aV.get(n);const e=u5e(n);return e!==n&&(aV.set(n,e),WF.set(e,n)),e}const cV=n=>WF.get(n);function d5e(n,e,{blocked:i,upgrade:o,blocking:l,terminated:u}={}){const p=indexedDB.open(n,e),y=Lg(p);return o&&p.addEventListener("upgradeneeded",E=>{o(Lg(p.result),E.oldVersion,E.newVersion,Lg(p.transaction),E)}),i&&p.addEventListener("blocked",E=>i(E.oldVersion,E.newVersion,E)),y.then(E=>{u&&E.addEventListener("close",()=>u()),l&&E.addEventListener("versionchange",b=>l(b.oldVersion,b.newVersion,b))}).catch(()=>{}),y}const h5e=["get","getKey","getAll","getAllKeys","count"],p5e=["put","add","delete","clear"],lV=new Map;function vJ(n,e){if(!(n instanceof IDBDatabase&&!(e in n)&&typeof e=="string"))return;if(lV.get(e))return lV.get(e);const i=e.replace(/FromIndex$/,""),o=e!==i,l=p5e.includes(i);if(!(i in(o?IDBIndex:IDBObjectStore).prototype)||!(l||h5e.includes(i)))return;const u=async function(p,...y){const E=this.transaction(p,l?"readwrite":"readonly");let b=E.store;return o&&(b=b.index(y.shift())),(await Promise.all([b[i](...y),l&&E.done]))[0]};return lV.set(e,u),u}c5e(n=>({...n,get:(e,i,o)=>vJ(e,i)||n.get(e,i,o),has:(e,i)=>!!vJ(e,i)||n.has(e,i)}));/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class f5e{constructor(e){this.container=e}getPlatformInfoString(){return this.container.getProviders().map(i=>{if(m5e(i)){const o=i.getImmediate();return`${o.library}/${o.version}`}else return null}).filter(i=>i).join(" ")}}function m5e(n){const e=n.getComponent();return(e==null?void 0:e.type)==="VERSION"}const w5="@firebase/app",SJ="0.13.2";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const nm=new zF("@firebase/app"),g5e="@firebase/app-compat",_5e="@firebase/analytics-compat",y5e="@firebase/analytics",E5e="@firebase/app-check-compat",v5e="@firebase/app-check",S5e="@firebase/auth",b5e="@firebase/auth-compat",w5e="@firebase/database",T5e="@firebase/data-connect",C5e="@firebase/database-compat",R5e="@firebase/functions",I5e="@firebase/functions-compat",A5e="@firebase/installations",P5e="@firebase/installations-compat",O5e="@firebase/messaging",k5e="@firebase/messaging-compat",N5e="@firebase/performance",x5e="@firebase/performance-compat",D5e="@firebase/remote-config",L5e="@firebase/remote-config-compat",M5e="@firebase/storage",U5e="@firebase/storage-compat",V5e="@firebase/firestore",j5e="@firebase/ai",F5e="@firebase/firestore-compat",B5e="firebase",z5e="11.10.0";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const T5="[DEFAULT]",W5e={[w5]:"fire-core",[g5e]:"fire-core-compat",[y5e]:"fire-analytics",[_5e]:"fire-analytics-compat",[v5e]:"fire-app-check",[E5e]:"fire-app-check-compat",[S5e]:"fire-auth",[b5e]:"fire-auth-compat",[w5e]:"fire-rtdb",[T5e]:"fire-data-connect",[C5e]:"fire-rtdb-compat",[R5e]:"fire-fn",[I5e]:"fire-fn-compat",[A5e]:"fire-iid",[P5e]:"fire-iid-compat",[O5e]:"fire-fcm",[k5e]:"fire-fcm-compat",[N5e]:"fire-perf",[x5e]:"fire-perf-compat",[D5e]:"fire-rc",[L5e]:"fire-rc-compat",[M5e]:"fire-gcs",[U5e]:"fire-gcs-compat",[V5e]:"fire-fst",[F5e]:"fire-fst-compat",[j5e]:"fire-vertex","fire-js":"fire-js",[B5e]:"fire-js-all"};/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Rk=new Map,G5e=new Map,C5=new Map;function bJ(n,e){try{n.container.addComponent(e)}catch(i){nm.debug(`Component ${e.name} failed to register with FirebaseApp ${n.name}`,i)}}function zg(n){const e=n.name;if(C5.has(e))return nm.debug(`There were multiple attempts to register component ${e}.`),!1;C5.set(e,n);for(const i of Rk.values())bJ(i,n);for(const i of G5e.values())bJ(i,n);return!0}function tI(n,e){const i=n.container.getProvider("heartbeat").getImmediate({optional:!0});return i&&i.triggerHeartbeat(),n.container.getProvider(e)}function wl(n){return n==null?!1:n.settings!==void 0}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const H5e={"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}'","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","server-app-deleted":"Firebase Server App has been deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}.","finalization-registry-not-supported":"FirebaseServerApp deleteOnDeref field defined but the JS runtime does not support FinalizationRegistry.","invalid-server-app-environment":"FirebaseServerApp is not for use in browser environments."},Mg=new ZR("app","Firebase",H5e);/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class $5e{constructor(e,i,o){this._isDeleted=!1,this._options=Object.assign({},e),this._config=Object.assign({},i),this._name=i.name,this._automaticDataCollectionEnabled=i.automaticDataCollectionEnabled,this._container=o,this.container.addComponent(new tm("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this.checkDestroyed(),this._automaticDataCollectionEnabled=e}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(e){this._isDeleted=e}checkDestroyed(){if(this.isDeleted)throw Mg.create("app-deleted",{appName:this._name})}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const TE=z5e;function jie(n,e={}){let i=n;typeof e!="object"&&(e={name:e});const o=Object.assign({name:T5,automaticDataCollectionEnabled:!0},e),l=o.name;if(typeof l!="string"||!l)throw Mg.create("bad-app-name",{appName:String(l)});if(i||(i=Die()),!i)throw Mg.create("no-options");const u=Rk.get(l);if(u){if(em(i,u.options)&&em(o,u.config))return u;throw Mg.create("duplicate-app",{appName:l})}const p=new QVe(l);for(const E of C5.values())p.addComponent(E);const y=new $5e(i,o,p);return Rk.set(l,y),y}function xN(n=T5){const e=Rk.get(n);if(!e&&n===T5&&Die())return jie();if(!e)throw Mg.create("no-app",{appName:n});return e}function md(n,e,i){var o;let l=(o=W5e[n])!==null&&o!==void 0?o:n;i&&(l+=`-${i}`);const u=l.match(/\s|\//),p=e.match(/\s|\//);if(u||p){const y=[`Unable to register library "${l}" with version "${e}":`];u&&y.push(`library name "${l}" contains illegal characters (whitespace or "/")`),u&&p&&y.push("and"),p&&y.push(`version name "${e}" contains illegal characters (whitespace or "/")`),nm.warn(y.join(" "));return}zg(new tm(`${l}-version`,()=>({library:l,version:e}),"VERSION"))}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const K5e="firebase-heartbeat-database",q5e=1,CR="firebase-heartbeat-store";let uV=null;function Fie(){return uV||(uV=d5e(K5e,q5e,{upgrade:(n,e)=>{switch(e){case 0:try{n.createObjectStore(CR)}catch(i){console.warn(i)}}}}).catch(n=>{throw Mg.create("idb-open",{originalErrorMessage:n.message})})),uV}async function Y5e(n){try{const i=(await Fie()).transaction(CR),o=await i.objectStore(CR).get(Bie(n));return await i.done,o}catch(e){if(e instanceof Th)nm.warn(e.message);else{const i=Mg.create("idb-get",{originalErrorMessage:e==null?void 0:e.message});nm.warn(i.message)}}}async function wJ(n,e){try{const o=(await Fie()).transaction(CR,"readwrite");await o.objectStore(CR).put(e,Bie(n)),await o.done}catch(i){if(i instanceof Th)nm.warn(i.message);else{const o=Mg.create("idb-set",{originalErrorMessage:i==null?void 0:i.message});nm.warn(o.message)}}}function Bie(n){return`${n.name}!${n.options.appId}`}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const X5e=1024,J5e=30;class Q5e{constructor(e){this.container=e,this._heartbeatsCache=null;const i=this.container.getProvider("app").getImmediate();this._storage=new eje(i),this._heartbeatsCachePromise=this._storage.read().then(o=>(this._heartbeatsCache=o,o))}async triggerHeartbeat(){var e,i;try{const l=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),u=TJ();if(((e=this._heartbeatsCache)===null||e===void 0?void 0:e.heartbeats)==null&&(this._heartbeatsCache=await this._heartbeatsCachePromise,((i=this._heartbeatsCache)===null||i===void 0?void 0:i.heartbeats)==null)||this._heartbeatsCache.lastSentHeartbeatDate===u||this._heartbeatsCache.heartbeats.some(p=>p.date===u))return;if(this._heartbeatsCache.heartbeats.push({date:u,agent:l}),this._heartbeatsCache.heartbeats.length>J5e){const p=tje(this._heartbeatsCache.heartbeats);this._heartbeatsCache.heartbeats.splice(p,1)}return this._storage.overwrite(this._heartbeatsCache)}catch(o){nm.warn(o)}}async getHeartbeatsHeader(){var e;try{if(this._heartbeatsCache===null&&await this._heartbeatsCachePromise,((e=this._heartbeatsCache)===null||e===void 0?void 0:e.heartbeats)==null||this._heartbeatsCache.heartbeats.length===0)return"";const i=TJ(),{heartbeatsToSend:o,unsentEntries:l}=Z5e(this._heartbeatsCache.heartbeats),u=Ck(JSON.stringify({version:2,heartbeats:o}));return this._heartbeatsCache.lastSentHeartbeatDate=i,l.length>0?(this._heartbeatsCache.heartbeats=l,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),u}catch(i){return nm.warn(i),""}}}function TJ(){return new Date().toISOString().substring(0,10)}function Z5e(n,e=X5e){const i=[];let o=n.slice();for(const l of n){const u=i.find(p=>p.agent===l.agent);if(u){if(u.dates.push(l.date),CJ(i)>e){u.dates.pop();break}}else if(i.push({agent:l.agent,dates:[l.date]}),CJ(i)>e){i.pop();break}o=o.slice(1)}return{heartbeatsToSend:i,unsentEntries:o}}class eje{constructor(e){this.app=e,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return FVe()?BVe().then(()=>!0).catch(()=>!1):!1}async read(){if(await this._canUseIndexedDBPromise){const i=await Y5e(this.app);return i!=null&&i.heartbeats?i:{heartbeats:[]}}else return{heartbeats:[]}}async overwrite(e){var i;if(await this._canUseIndexedDBPromise){const l=await this.read();return wJ(this.app,{lastSentHeartbeatDate:(i=e.lastSentHeartbeatDate)!==null&&i!==void 0?i:l.lastSentHeartbeatDate,heartbeats:e.heartbeats})}else return}async add(e){var i;if(await this._canUseIndexedDBPromise){const l=await this.read();return wJ(this.app,{lastSentHeartbeatDate:(i=e.lastSentHeartbeatDate)!==null&&i!==void 0?i:l.lastSentHeartbeatDate,heartbeats:[...l.heartbeats,...e.heartbeats]})}else return}}function CJ(n){return Ck(JSON.stringify({version:2,heartbeats:n})).length}function tje(n){if(n.length===0)return-1;let e=0,i=n[0].date;for(let o=1;o<n.length;o++)n[o].date<i&&(i=n[o].date,e=o);return e}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function nje(n){zg(new tm("platform-logger",e=>new f5e(e),"PRIVATE")),zg(new tm("heartbeat",e=>new Q5e(e),"PRIVATE")),md(w5,SJ,n),md(w5,SJ,"esm2017"),md("fire-js","")}nje("");function zie(){return{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}}const rje=zie,Wie=new ZR("auth","Firebase",zie());/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ik=new zF("@firebase/auth");function ije(n,...e){Ik.logLevel<=zr.WARN&&Ik.warn(`Auth (${TE}): ${n}`,...e)}function qO(n,...e){Ik.logLevel<=zr.ERROR&&Ik.error(`Auth (${TE}): ${n}`,...e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Sh(n,...e){throw GF(n,...e)}function jp(n,...e){return GF(n,...e)}function Gie(n,e,i){const o=Object.assign(Object.assign({},rje()),{[e]:i});return new ZR("auth","Firebase",o).create(e,{appName:n.name})}function qf(n){return Gie(n,"operation-not-supported-in-this-environment","Operations that alter the current user are not supported in conjunction with FirebaseServerApp")}function GF(n,...e){if(typeof n!="string"){const i=e[0],o=[...e.slice(1)];return o[0]&&(o[0].appName=n.name),n._errorFactory.create(i,...o)}return Wie.create(n,...e)}function Zn(n,e,...i){if(!n)throw GF(e,...i)}function jf(n){const e="INTERNAL ASSERTION FAILED: "+n;throw qO(e),new Error(e)}function rm(n,e){n||jf(e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function R5(){var n;return typeof self<"u"&&((n=self.location)===null||n===void 0?void 0:n.href)||""}function sje(){return RJ()==="http:"||RJ()==="https:"}function RJ(){var n;return typeof self<"u"&&((n=self.location)===null||n===void 0?void 0:n.protocol)||null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function oje(){return typeof navigator<"u"&&navigator&&"onLine"in navigator&&typeof navigator.onLine=="boolean"&&(sje()||MVe()||"connection"in navigator)?navigator.onLine:!0}function aje(){if(typeof navigator>"u")return null;const n=navigator;return n.languages&&n.languages[0]||n.language||null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class nI{constructor(e,i){this.shortDelay=e,this.longDelay=i,rm(i>e,"Short delay should be less than long delay!"),this.isMobile=xVe()||UVe()}get(){return oje()?this.isMobile?this.longDelay:this.shortDelay:Math.min(5e3,this.shortDelay)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function HF(n,e){rm(n.emulator,"Emulator should always be set here");const{url:i}=n.emulator;return e?`${i}${e.startsWith("/")?e.slice(1):e}`:i}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Hie{static initialize(e,i,o){this.fetchImpl=e,i&&(this.headersImpl=i),o&&(this.responseImpl=o)}static fetch(){if(this.fetchImpl)return this.fetchImpl;if(typeof self<"u"&&"fetch"in self)return self.fetch;if(typeof globalThis<"u"&&globalThis.fetch)return globalThis.fetch;if(typeof fetch<"u")return fetch;jf("Could not find fetch implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static headers(){if(this.headersImpl)return this.headersImpl;if(typeof self<"u"&&"Headers"in self)return self.Headers;if(typeof globalThis<"u"&&globalThis.Headers)return globalThis.Headers;if(typeof Headers<"u")return Headers;jf("Could not find Headers implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static response(){if(this.responseImpl)return this.responseImpl;if(typeof self<"u"&&"Response"in self)return self.Response;if(typeof globalThis<"u"&&globalThis.Response)return globalThis.Response;if(typeof Response<"u")return Response;jf("Could not find Response implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const cje={CREDENTIAL_MISMATCH:"custom-token-mismatch",MISSING_CUSTOM_TOKEN:"internal-error",INVALID_IDENTIFIER:"invalid-email",MISSING_CONTINUE_URI:"internal-error",INVALID_PASSWORD:"wrong-password",MISSING_PASSWORD:"missing-password",INVALID_LOGIN_CREDENTIALS:"invalid-credential",EMAIL_EXISTS:"email-already-in-use",PASSWORD_LOGIN_DISABLED:"operation-not-allowed",INVALID_IDP_RESPONSE:"invalid-credential",INVALID_PENDING_TOKEN:"invalid-credential",FEDERATED_USER_ID_ALREADY_LINKED:"credential-already-in-use",MISSING_REQ_TYPE:"internal-error",EMAIL_NOT_FOUND:"user-not-found",RESET_PASSWORD_EXCEED_LIMIT:"too-many-requests",EXPIRED_OOB_CODE:"expired-action-code",INVALID_OOB_CODE:"invalid-action-code",MISSING_OOB_CODE:"internal-error",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"requires-recent-login",INVALID_ID_TOKEN:"invalid-user-token",TOKEN_EXPIRED:"user-token-expired",USER_NOT_FOUND:"user-token-expired",TOO_MANY_ATTEMPTS_TRY_LATER:"too-many-requests",PASSWORD_DOES_NOT_MEET_REQUIREMENTS:"password-does-not-meet-requirements",INVALID_CODE:"invalid-verification-code",INVALID_SESSION_INFO:"invalid-verification-id",INVALID_TEMPORARY_PROOF:"invalid-credential",MISSING_SESSION_INFO:"missing-verification-id",SESSION_EXPIRED:"code-expired",MISSING_ANDROID_PACKAGE_NAME:"missing-android-pkg-name",UNAUTHORIZED_DOMAIN:"unauthorized-continue-uri",INVALID_OAUTH_CLIENT_ID:"invalid-oauth-client-id",ADMIN_ONLY_OPERATION:"admin-restricted-operation",INVALID_MFA_PENDING_CREDENTIAL:"invalid-multi-factor-session",MFA_ENROLLMENT_NOT_FOUND:"multi-factor-info-not-found",MISSING_MFA_ENROLLMENT_ID:"missing-multi-factor-info",MISSING_MFA_PENDING_CREDENTIAL:"missing-multi-factor-session",SECOND_FACTOR_EXISTS:"second-factor-already-in-use",SECOND_FACTOR_LIMIT_EXCEEDED:"maximum-second-factor-count-exceeded",BLOCKING_FUNCTION_ERROR_RESPONSE:"internal-error",RECAPTCHA_NOT_ENABLED:"recaptcha-not-enabled",MISSING_RECAPTCHA_TOKEN:"missing-recaptcha-token",INVALID_RECAPTCHA_TOKEN:"invalid-recaptcha-token",INVALID_RECAPTCHA_ACTION:"invalid-recaptcha-action",MISSING_CLIENT_TYPE:"missing-client-type",MISSING_RECAPTCHA_VERSION:"missing-recaptcha-version",INVALID_RECAPTCHA_VERSION:"invalid-recaptcha-version",INVALID_REQ_TYPE:"invalid-req-type"};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const lje=["/v1/accounts:signInWithCustomToken","/v1/accounts:signInWithEmailLink","/v1/accounts:signInWithIdp","/v1/accounts:signInWithPassword","/v1/accounts:signInWithPhoneNumber","/v1/token"],uje=new nI(3e4,6e4);function lm(n,e){return n.tenantId&&!e.tenantId?Object.assign(Object.assign({},e),{tenantId:n.tenantId}):e}async function um(n,e,i,o,l={}){return $ie(n,l,async()=>{let u={},p={};o&&(e==="GET"?p=o:u={body:JSON.stringify(o)});const y=eI(Object.assign({key:n.config.apiKey},p)).slice(1),E=await n._getAdditionalHeaders();E["Content-Type"]="application/json",n.languageCode&&(E["X-Firebase-Locale"]=n.languageCode);const b=Object.assign({method:e,headers:E},u);return LVe()||(b.referrerPolicy="no-referrer"),n.emulatorConfig&&cm(n.emulatorConfig.host)&&(b.credentials="include"),Hie.fetch()(await Kie(n,n.config.apiHost,i,y),b)})}async function $ie(n,e,i){n._canInitEmulator=!1;const o=Object.assign(Object.assign({},cje),e);try{const l=new hje(n),u=await Promise.race([i(),l.promise]);l.clearNetworkTimeout();const p=await u.json();if("needConfirmation"in p)throw mO(n,"account-exists-with-different-credential",p);if(u.ok&&!("errorMessage"in p))return p;{const y=u.ok?p.errorMessage:p.error.message,[E,b]=y.split(" : ");if(E==="FEDERATED_USER_ID_ALREADY_LINKED")throw mO(n,"credential-already-in-use",p);if(E==="EMAIL_EXISTS")throw mO(n,"email-already-in-use",p);if(E==="USER_DISABLED")throw mO(n,"user-disabled",p);const T=o[E]||E.toLowerCase().replace(/[_\s]+/g,"-");if(b)throw Gie(n,T,b);Sh(n,T)}}catch(l){if(l instanceof Th)throw l;Sh(n,"network-request-failed",{message:String(l)})}}async function rI(n,e,i,o,l={}){const u=await um(n,e,i,o,l);return"mfaPendingCredential"in u&&Sh(n,"multi-factor-auth-required",{_serverResponse:u}),u}async function Kie(n,e,i,o){const l=`${e}${i}?${o}`,u=n,p=u.config.emulator?HF(n.config,l):`${n.config.apiScheme}://${l}`;return lje.includes(i)&&(await u._persistenceManagerAvailable,u._getPersistenceType()==="COOKIE")?u._getPersistence()._getFinalTarget(p).toString():p}function dje(n){switch(n){case"ENFORCE":return"ENFORCE";case"AUDIT":return"AUDIT";case"OFF":return"OFF";default:return"ENFORCEMENT_STATE_UNSPECIFIED"}}class hje{clearNetworkTimeout(){clearTimeout(this.timer)}constructor(e){this.auth=e,this.timer=null,this.promise=new Promise((i,o)=>{this.timer=setTimeout(()=>o(jp(this.auth,"network-request-failed")),uje.get())})}}function mO(n,e,i){const o={appName:n.name};i.email&&(o.email=i.email),i.phoneNumber&&(o.phoneNumber=i.phoneNumber);const l=jp(n,e,o);return l.customData._tokenResponse=i,l}function IJ(n){return n!==void 0&&n.enterprise!==void 0}class pje{constructor(e){if(this.siteKey="",this.recaptchaEnforcementState=[],e.recaptchaKey===void 0)throw new Error("recaptchaKey undefined");this.siteKey=e.recaptchaKey.split("/")[3],this.recaptchaEnforcementState=e.recaptchaEnforcementState}getProviderEnforcementState(e){if(!this.recaptchaEnforcementState||this.recaptchaEnforcementState.length===0)return null;for(const i of this.recaptchaEnforcementState)if(i.provider&&i.provider===e)return dje(i.enforcementState);return null}isProviderEnabled(e){return this.getProviderEnforcementState(e)==="ENFORCE"||this.getProviderEnforcementState(e)==="AUDIT"}isAnyProviderEnabled(){return this.isProviderEnabled("EMAIL_PASSWORD_PROVIDER")||this.isProviderEnabled("PHONE_PROVIDER")}}async function fje(n,e){return um(n,"GET","/v2/recaptchaConfig",lm(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function mje(n,e){return um(n,"POST","/v1/accounts:delete",e)}async function Ak(n,e){return um(n,"POST","/v1/accounts:lookup",e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function XC(n){if(n)try{const e=new Date(Number(n));if(!isNaN(e.getTime()))return e.toUTCString()}catch{}}async function gje(n,e=!1){const i=Ni(n),o=await i.getIdToken(e),l=$F(o);Zn(l&&l.exp&&l.auth_time&&l.iat,i.auth,"internal-error");const u=typeof l.firebase=="object"?l.firebase:void 0,p=u==null?void 0:u.sign_in_provider;return{claims:l,token:o,authTime:XC(dV(l.auth_time)),issuedAtTime:XC(dV(l.iat)),expirationTime:XC(dV(l.exp)),signInProvider:p||null,signInSecondFactor:(u==null?void 0:u.sign_in_second_factor)||null}}function dV(n){return Number(n)*1e3}function $F(n){const[e,i,o]=n.split(".");if(e===void 0||i===void 0||o===void 0)return qO("JWT malformed, contained fewer than 3 sections"),null;try{const l=Nie(i);return l?JSON.parse(l):(qO("Failed to decode base64 JWT payload"),null)}catch(l){return qO("Caught error parsing JWT payload as JSON",l==null?void 0:l.toString()),null}}function AJ(n){const e=$F(n);return Zn(e,"internal-error"),Zn(typeof e.exp<"u","internal-error"),Zn(typeof e.iat<"u","internal-error"),Number(e.exp)-Number(e.iat)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function RR(n,e,i=!1){if(i)return e;try{return await e}catch(o){throw o instanceof Th&&_je(o)&&n.auth.currentUser===n&&await n.auth.signOut(),o}}function _je({code:n}){return n==="auth/user-disabled"||n==="auth/user-token-expired"}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class yje{constructor(e){this.user=e,this.isRunning=!1,this.timerId=null,this.errorBackoff=3e4}_start(){this.isRunning||(this.isRunning=!0,this.schedule())}_stop(){this.isRunning&&(this.isRunning=!1,this.timerId!==null&&clearTimeout(this.timerId))}getInterval(e){var i;if(e){const o=this.errorBackoff;return this.errorBackoff=Math.min(this.errorBackoff*2,96e4),o}else{this.errorBackoff=3e4;const l=((i=this.user.stsTokenManager.expirationTime)!==null&&i!==void 0?i:0)-Date.now()-3e5;return Math.max(0,l)}}schedule(e=!1){if(!this.isRunning)return;const i=this.getInterval(e);this.timerId=setTimeout(async()=>{await this.iteration()},i)}async iteration(){try{await this.user.getIdToken(!0)}catch(e){(e==null?void 0:e.code)==="auth/network-request-failed"&&this.schedule(!0);return}this.schedule()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class I5{constructor(e,i){this.createdAt=e,this.lastLoginAt=i,this._initializeTime()}_initializeTime(){this.lastSignInTime=XC(this.lastLoginAt),this.creationTime=XC(this.createdAt)}_copy(e){this.createdAt=e.createdAt,this.lastLoginAt=e.lastLoginAt,this._initializeTime()}toJSON(){return{createdAt:this.createdAt,lastLoginAt:this.lastLoginAt}}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Pk(n){var e;const i=n.auth,o=await n.getIdToken(),l=await RR(n,Ak(i,{idToken:o}));Zn(l==null?void 0:l.users.length,i,"internal-error");const u=l.users[0];n._notifyReloadListener(u);const p=!((e=u.providerUserInfo)===null||e===void 0)&&e.length?qie(u.providerUserInfo):[],y=vje(n.providerData,p),E=n.isAnonymous,b=!(n.email&&u.passwordHash)&&!(y!=null&&y.length),T=E?b:!1,R={uid:u.localId,displayName:u.displayName||null,photoURL:u.photoUrl||null,email:u.email||null,emailVerified:u.emailVerified||!1,phoneNumber:u.phoneNumber||null,tenantId:u.tenantId||null,providerData:y,metadata:new I5(u.createdAt,u.lastLoginAt),isAnonymous:T};Object.assign(n,R)}async function Eje(n){const e=Ni(n);await Pk(e),await e.auth._persistUserIfCurrent(e),e.auth._notifyListenersIfCurrent(e)}function vje(n,e){return[...n.filter(o=>!e.some(l=>l.providerId===o.providerId)),...e]}function qie(n){return n.map(e=>{var{providerId:i}=e,o=qR(e,["providerId"]);return{providerId:i,uid:o.rawId||"",displayName:o.displayName||null,email:o.email||null,phoneNumber:o.phoneNumber||null,photoURL:o.photoUrl||null}})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Sje(n,e){const i=await $ie(n,{},async()=>{const o=eI({grant_type:"refresh_token",refresh_token:e}).slice(1),{tokenApiHost:l,apiKey:u}=n.config,p=await Kie(n,l,"/v1/token",`key=${u}`),y=await n._getAdditionalHeaders();y["Content-Type"]="application/x-www-form-urlencoded";const E={method:"POST",headers:y,body:o};return n.emulatorConfig&&cm(n.emulatorConfig.host)&&(E.credentials="include"),Hie.fetch()(p,E)});return{accessToken:i.access_token,expiresIn:i.expires_in,refreshToken:i.refresh_token}}async function bje(n,e){return um(n,"POST","/v2/accounts:revokeToken",lm(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class PS{constructor(){this.refreshToken=null,this.accessToken=null,this.expirationTime=null}get isExpired(){return!this.expirationTime||Date.now()>this.expirationTime-3e4}updateFromServerResponse(e){Zn(e.idToken,"internal-error"),Zn(typeof e.idToken<"u","internal-error"),Zn(typeof e.refreshToken<"u","internal-error");const i="expiresIn"in e&&typeof e.expiresIn<"u"?Number(e.expiresIn):AJ(e.idToken);this.updateTokensAndExpiration(e.idToken,e.refreshToken,i)}updateFromIdToken(e){Zn(e.length!==0,"internal-error");const i=AJ(e);this.updateTokensAndExpiration(e,null,i)}async getToken(e,i=!1){return!i&&this.accessToken&&!this.isExpired?this.accessToken:(Zn(this.refreshToken,e,"user-token-expired"),this.refreshToken?(await this.refresh(e,this.refreshToken),this.accessToken):null)}clearRefreshToken(){this.refreshToken=null}async refresh(e,i){const{accessToken:o,refreshToken:l,expiresIn:u}=await Sje(e,i);this.updateTokensAndExpiration(o,l,Number(u))}updateTokensAndExpiration(e,i,o){this.refreshToken=i||null,this.accessToken=e||null,this.expirationTime=Date.now()+o*1e3}static fromJSON(e,i){const{refreshToken:o,accessToken:l,expirationTime:u}=i,p=new PS;return o&&(Zn(typeof o=="string","internal-error",{appName:e}),p.refreshToken=o),l&&(Zn(typeof l=="string","internal-error",{appName:e}),p.accessToken=l),u&&(Zn(typeof u=="number","internal-error",{appName:e}),p.expirationTime=u),p}toJSON(){return{refreshToken:this.refreshToken,accessToken:this.accessToken,expirationTime:this.expirationTime}}_assign(e){this.accessToken=e.accessToken,this.refreshToken=e.refreshToken,this.expirationTime=e.expirationTime}_clone(){return Object.assign(new PS,this.toJSON())}_performRefresh(){return jf("not implemented")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Sg(n,e){Zn(typeof n=="string"||typeof n>"u","internal-error",{appName:e})}class _h{constructor(e){var{uid:i,auth:o,stsTokenManager:l}=e,u=qR(e,["uid","auth","stsTokenManager"]);this.providerId="firebase",this.proactiveRefresh=new yje(this),this.reloadUserInfo=null,this.reloadListener=null,this.uid=i,this.auth=o,this.stsTokenManager=l,this.accessToken=l.accessToken,this.displayName=u.displayName||null,this.email=u.email||null,this.emailVerified=u.emailVerified||!1,this.phoneNumber=u.phoneNumber||null,this.photoURL=u.photoURL||null,this.isAnonymous=u.isAnonymous||!1,this.tenantId=u.tenantId||null,this.providerData=u.providerData?[...u.providerData]:[],this.metadata=new I5(u.createdAt||void 0,u.lastLoginAt||void 0)}async getIdToken(e){const i=await RR(this,this.stsTokenManager.getToken(this.auth,e));return Zn(i,this.auth,"internal-error"),this.accessToken!==i&&(this.accessToken=i,await this.auth._persistUserIfCurrent(this),this.auth._notifyListenersIfCurrent(this)),i}getIdTokenResult(e){return gje(this,e)}reload(){return Eje(this)}_assign(e){this!==e&&(Zn(this.uid===e.uid,this.auth,"internal-error"),this.displayName=e.displayName,this.photoURL=e.photoURL,this.email=e.email,this.emailVerified=e.emailVerified,this.phoneNumber=e.phoneNumber,this.isAnonymous=e.isAnonymous,this.tenantId=e.tenantId,this.providerData=e.providerData.map(i=>Object.assign({},i)),this.metadata._copy(e.metadata),this.stsTokenManager._assign(e.stsTokenManager))}_clone(e){const i=new _h(Object.assign(Object.assign({},this),{auth:e,stsTokenManager:this.stsTokenManager._clone()}));return i.metadata._copy(this.metadata),i}_onReload(e){Zn(!this.reloadListener,this.auth,"internal-error"),this.reloadListener=e,this.reloadUserInfo&&(this._notifyReloadListener(this.reloadUserInfo),this.reloadUserInfo=null)}_notifyReloadListener(e){this.reloadListener?this.reloadListener(e):this.reloadUserInfo=e}_startProactiveRefresh(){this.proactiveRefresh._start()}_stopProactiveRefresh(){this.proactiveRefresh._stop()}async _updateTokensIfNecessary(e,i=!1){let o=!1;e.idToken&&e.idToken!==this.stsTokenManager.accessToken&&(this.stsTokenManager.updateFromServerResponse(e),o=!0),i&&await Pk(this),await this.auth._persistUserIfCurrent(this),o&&this.auth._notifyListenersIfCurrent(this)}async delete(){if(wl(this.auth.app))return Promise.reject(qf(this.auth));const e=await this.getIdToken();return await RR(this,mje(this.auth,{idToken:e})),this.stsTokenManager.clearRefreshToken(),this.auth.signOut()}toJSON(){return Object.assign(Object.assign({uid:this.uid,email:this.email||void 0,emailVerified:this.emailVerified,displayName:this.displayName||void 0,isAnonymous:this.isAnonymous,photoURL:this.photoURL||void 0,phoneNumber:this.phoneNumber||void 0,tenantId:this.tenantId||void 0,providerData:this.providerData.map(e=>Object.assign({},e)),stsTokenManager:this.stsTokenManager.toJSON(),_redirectEventId:this._redirectEventId},this.metadata.toJSON()),{apiKey:this.auth.config.apiKey,appName:this.auth.name})}get refreshToken(){return this.stsTokenManager.refreshToken||""}static _fromJSON(e,i){var o,l,u,p,y,E,b,T;const R=(o=i.displayName)!==null&&o!==void 0?o:void 0,O=(l=i.email)!==null&&l!==void 0?l:void 0,L=(u=i.phoneNumber)!==null&&u!==void 0?u:void 0,D=(p=i.photoURL)!==null&&p!==void 0?p:void 0,U=(y=i.tenantId)!==null&&y!==void 0?y:void 0,F=(E=i._redirectEventId)!==null&&E!==void 0?E:void 0,Y=(b=i.createdAt)!==null&&b!==void 0?b:void 0,W=(T=i.lastLoginAt)!==null&&T!==void 0?T:void 0,{uid:re,emailVerified:le,isAnonymous:ie,providerData:me,stsTokenManager:q}=i;Zn(re&&q,e,"internal-error");const J=PS.fromJSON(this.name,q);Zn(typeof re=="string",e,"internal-error"),Sg(R,e.name),Sg(O,e.name),Zn(typeof le=="boolean",e,"internal-error"),Zn(typeof ie=="boolean",e,"internal-error"),Sg(L,e.name),Sg(D,e.name),Sg(U,e.name),Sg(F,e.name),Sg(Y,e.name),Sg(W,e.name);const Q=new _h({uid:re,auth:e,email:O,emailVerified:le,displayName:R,isAnonymous:ie,photoURL:D,phoneNumber:L,tenantId:U,stsTokenManager:J,createdAt:Y,lastLoginAt:W});return me&&Array.isArray(me)&&(Q.providerData=me.map(ne=>Object.assign({},ne))),F&&(Q._redirectEventId=F),Q}static async _fromIdTokenResponse(e,i,o=!1){const l=new PS;l.updateFromServerResponse(i);const u=new _h({uid:i.localId,auth:e,stsTokenManager:l,isAnonymous:o});return await Pk(u),u}static async _fromGetAccountInfoResponse(e,i,o){const l=i.users[0];Zn(l.localId!==void 0,"internal-error");const u=l.providerUserInfo!==void 0?qie(l.providerUserInfo):[],p=!(l.email&&l.passwordHash)&&!(u!=null&&u.length),y=new PS;y.updateFromIdToken(o);const E=new _h({uid:l.localId,auth:e,stsTokenManager:y,isAnonymous:p}),b={uid:l.localId,displayName:l.displayName||null,photoURL:l.photoUrl||null,email:l.email||null,emailVerified:l.emailVerified||!1,phoneNumber:l.phoneNumber||null,tenantId:l.tenantId||null,providerData:u,metadata:new I5(l.createdAt,l.lastLoginAt),isAnonymous:!(l.email&&l.passwordHash)&&!(u!=null&&u.length)};return Object.assign(E,b),E}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const PJ=new Map;function Ff(n){rm(n instanceof Function,"Expected a class definition");let e=PJ.get(n);return e?(rm(e instanceof n,"Instance stored in cache mismatched with class"),e):(e=new n,PJ.set(n,e),e)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Yie{constructor(){this.type="NONE",this.storage={}}async _isAvailable(){return!0}async _set(e,i){this.storage[e]=i}async _get(e){const i=this.storage[e];return i===void 0?null:i}async _remove(e){delete this.storage[e]}_addListener(e,i){}_removeListener(e,i){}}Yie.type="NONE";const OJ=Yie;/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function YO(n,e,i){return`firebase:${n}:${e}:${i}`}class OS{constructor(e,i,o){this.persistence=e,this.auth=i,this.userKey=o;const{config:l,name:u}=this.auth;this.fullUserKey=YO(this.userKey,l.apiKey,u),this.fullPersistenceKey=YO("persistence",l.apiKey,u),this.boundEventHandler=i._onStorageEvent.bind(i),this.persistence._addListener(this.fullUserKey,this.boundEventHandler)}setCurrentUser(e){return this.persistence._set(this.fullUserKey,e.toJSON())}async getCurrentUser(){const e=await this.persistence._get(this.fullUserKey);if(!e)return null;if(typeof e=="string"){const i=await Ak(this.auth,{idToken:e}).catch(()=>{});return i?_h._fromGetAccountInfoResponse(this.auth,i,e):null}return _h._fromJSON(this.auth,e)}removeCurrentUser(){return this.persistence._remove(this.fullUserKey)}savePersistenceForRedirect(){return this.persistence._set(this.fullPersistenceKey,this.persistence.type)}async setPersistence(e){if(this.persistence===e)return;const i=await this.getCurrentUser();if(await this.removeCurrentUser(),this.persistence=e,i)return this.setCurrentUser(i)}delete(){this.persistence._removeListener(this.fullUserKey,this.boundEventHandler)}static async create(e,i,o="authUser"){if(!i.length)return new OS(Ff(OJ),e,o);const l=(await Promise.all(i.map(async b=>{if(await b._isAvailable())return b}))).filter(b=>b);let u=l[0]||Ff(OJ);const p=YO(o,e.config.apiKey,e.name);let y=null;for(const b of i)try{const T=await b._get(p);if(T){let R;if(typeof T=="string"){const O=await Ak(e,{idToken:T}).catch(()=>{});if(!O)break;R=await _h._fromGetAccountInfoResponse(e,O,T)}else R=_h._fromJSON(e,T);b!==u&&(y=R),u=b;break}}catch{}const E=l.filter(b=>b._shouldAllowMigration);return!u._shouldAllowMigration||!E.length?new OS(u,e,o):(u=E[0],y&&await u._set(p,y.toJSON()),await Promise.all(i.map(async b=>{if(b!==u)try{await b._remove(p)}catch{}})),new OS(u,e,o))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function kJ(n){const e=n.toLowerCase();if(e.includes("opera/")||e.includes("opr/")||e.includes("opios/"))return"Opera";if(Zie(e))return"IEMobile";if(e.includes("msie")||e.includes("trident/"))return"IE";if(e.includes("edge/"))return"Edge";if(Xie(e))return"Firefox";if(e.includes("silk/"))return"Silk";if(tse(e))return"Blackberry";if(nse(e))return"Webos";if(Jie(e))return"Safari";if((e.includes("chrome/")||Qie(e))&&!e.includes("edge/"))return"Chrome";if(ese(e))return"Android";{const i=/([a-zA-Z\d\.]+)\/[a-zA-Z\d\.]*$/,o=n.match(i);if((o==null?void 0:o.length)===2)return o[1]}return"Other"}function Xie(n=gc()){return/firefox\//i.test(n)}function Jie(n=gc()){const e=n.toLowerCase();return e.includes("safari/")&&!e.includes("chrome/")&&!e.includes("crios/")&&!e.includes("android")}function Qie(n=gc()){return/crios\//i.test(n)}function Zie(n=gc()){return/iemobile/i.test(n)}function ese(n=gc()){return/android/i.test(n)}function tse(n=gc()){return/blackberry/i.test(n)}function nse(n=gc()){return/webos/i.test(n)}function KF(n=gc()){return/iphone|ipad|ipod/i.test(n)||/macintosh/i.test(n)&&/mobile/i.test(n)}function wje(n=gc()){var e;return KF(n)&&!!(!((e=window.navigator)===null||e===void 0)&&e.standalone)}function Tje(){return VVe()&&document.documentMode===10}function rse(n=gc()){return KF(n)||ese(n)||nse(n)||tse(n)||/windows phone/i.test(n)||Zie(n)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ise(n,e=[]){let i;switch(n){case"Browser":i=kJ(gc());break;case"Worker":i=`${kJ(gc())}-${n}`;break;default:i=n}const o=e.length?e.join(","):"FirebaseCore-web";return`${i}/JsCore/${TE}/${o}`}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Cje{constructor(e){this.auth=e,this.queue=[]}pushCallback(e,i){const o=u=>new Promise((p,y)=>{try{const E=e(u);p(E)}catch(E){y(E)}});o.onAbort=i,this.queue.push(o);const l=this.queue.length-1;return()=>{this.queue[l]=()=>Promise.resolve()}}async runMiddleware(e){if(this.auth.currentUser===e)return;const i=[];try{for(const o of this.queue)await o(e),o.onAbort&&i.push(o.onAbort)}catch(o){i.reverse();for(const l of i)try{l()}catch{}throw this.auth._errorFactory.create("login-blocked",{originalMessage:o==null?void 0:o.message})}}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Rje(n,e={}){return um(n,"GET","/v2/passwordPolicy",lm(n,e))}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ije=6;class Aje{constructor(e){var i,o,l,u;const p=e.customStrengthOptions;this.customStrengthOptions={},this.customStrengthOptions.minPasswordLength=(i=p.minPasswordLength)!==null&&i!==void 0?i:Ije,p.maxPasswordLength&&(this.customStrengthOptions.maxPasswordLength=p.maxPasswordLength),p.containsLowercaseCharacter!==void 0&&(this.customStrengthOptions.containsLowercaseLetter=p.containsLowercaseCharacter),p.containsUppercaseCharacter!==void 0&&(this.customStrengthOptions.containsUppercaseLetter=p.containsUppercaseCharacter),p.containsNumericCharacter!==void 0&&(this.customStrengthOptions.containsNumericCharacter=p.containsNumericCharacter),p.containsNonAlphanumericCharacter!==void 0&&(this.customStrengthOptions.containsNonAlphanumericCharacter=p.containsNonAlphanumericCharacter),this.enforcementState=e.enforcementState,this.enforcementState==="ENFORCEMENT_STATE_UNSPECIFIED"&&(this.enforcementState="OFF"),this.allowedNonAlphanumericCharacters=(l=(o=e.allowedNonAlphanumericCharacters)===null||o===void 0?void 0:o.join(""))!==null&&l!==void 0?l:"",this.forceUpgradeOnSignin=(u=e.forceUpgradeOnSignin)!==null&&u!==void 0?u:!1,this.schemaVersion=e.schemaVersion}validatePassword(e){var i,o,l,u,p,y;const E={isValid:!0,passwordPolicy:this};return this.validatePasswordLengthOptions(e,E),this.validatePasswordCharacterOptions(e,E),E.isValid&&(E.isValid=(i=E.meetsMinPasswordLength)!==null&&i!==void 0?i:!0),E.isValid&&(E.isValid=(o=E.meetsMaxPasswordLength)!==null&&o!==void 0?o:!0),E.isValid&&(E.isValid=(l=E.containsLowercaseLetter)!==null&&l!==void 0?l:!0),E.isValid&&(E.isValid=(u=E.containsUppercaseLetter)!==null&&u!==void 0?u:!0),E.isValid&&(E.isValid=(p=E.containsNumericCharacter)!==null&&p!==void 0?p:!0),E.isValid&&(E.isValid=(y=E.containsNonAlphanumericCharacter)!==null&&y!==void 0?y:!0),E}validatePasswordLengthOptions(e,i){const o=this.customStrengthOptions.minPasswordLength,l=this.customStrengthOptions.maxPasswordLength;o&&(i.meetsMinPasswordLength=e.length>=o),l&&(i.meetsMaxPasswordLength=e.length<=l)}validatePasswordCharacterOptions(e,i){this.updatePasswordCharacterOptionsStatuses(i,!1,!1,!1,!1);let o;for(let l=0;l<e.length;l++)o=e.charAt(l),this.updatePasswordCharacterOptionsStatuses(i,o>="a"&&o<="z",o>="A"&&o<="Z",o>="0"&&o<="9",this.allowedNonAlphanumericCharacters.includes(o))}updatePasswordCharacterOptionsStatuses(e,i,o,l,u){this.customStrengthOptions.containsLowercaseLetter&&(e.containsLowercaseLetter||(e.containsLowercaseLetter=i)),this.customStrengthOptions.containsUppercaseLetter&&(e.containsUppercaseLetter||(e.containsUppercaseLetter=o)),this.customStrengthOptions.containsNumericCharacter&&(e.containsNumericCharacter||(e.containsNumericCharacter=l)),this.customStrengthOptions.containsNonAlphanumericCharacter&&(e.containsNonAlphanumericCharacter||(e.containsNonAlphanumericCharacter=u))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Pje{constructor(e,i,o,l){this.app=e,this.heartbeatServiceProvider=i,this.appCheckServiceProvider=o,this.config=l,this.currentUser=null,this.emulatorConfig=null,this.operations=Promise.resolve(),this.authStateSubscription=new NJ(this),this.idTokenSubscription=new NJ(this),this.beforeStateQueue=new Cje(this),this.redirectUser=null,this.isProactiveRefreshEnabled=!1,this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION=1,this._canInitEmulator=!0,this._isInitialized=!1,this._deleted=!1,this._initializationPromise=null,this._popupRedirectResolver=null,this._errorFactory=Wie,this._agentRecaptchaConfig=null,this._tenantRecaptchaConfigs={},this._projectPasswordPolicy=null,this._tenantPasswordPolicies={},this._resolvePersistenceManagerAvailable=void 0,this.lastNotifiedUid=void 0,this.languageCode=null,this.tenantId=null,this.settings={appVerificationDisabledForTesting:!1},this.frameworks=[],this.name=e.name,this.clientVersion=l.sdkClientVersion,this._persistenceManagerAvailable=new Promise(u=>this._resolvePersistenceManagerAvailable=u)}_initializeWithPersistence(e,i){return i&&(this._popupRedirectResolver=Ff(i)),this._initializationPromise=this.queue(async()=>{var o,l,u;if(!this._deleted&&(this.persistenceManager=await OS.create(this,e),(o=this._resolvePersistenceManagerAvailable)===null||o===void 0||o.call(this),!this._deleted)){if(!((l=this._popupRedirectResolver)===null||l===void 0)&&l._shouldInitProactively)try{await this._popupRedirectResolver._initialize(this)}catch{}await this.initializeCurrentUser(i),this.lastNotifiedUid=((u=this.currentUser)===null||u===void 0?void 0:u.uid)||null,!this._deleted&&(this._isInitialized=!0)}}),this._initializationPromise}async _onStorageEvent(){if(this._deleted)return;const e=await this.assertedPersistence.getCurrentUser();if(!(!this.currentUser&&!e)){if(this.currentUser&&e&&this.currentUser.uid===e.uid){this._currentUser._assign(e),await this.currentUser.getIdToken();return}await this._updateCurrentUser(e,!0)}}async initializeCurrentUserFromIdToken(e){try{const i=await Ak(this,{idToken:e}),o=await _h._fromGetAccountInfoResponse(this,i,e);await this.directlySetCurrentUser(o)}catch(i){console.warn("FirebaseServerApp could not login user with provided authIdToken: ",i),await this.directlySetCurrentUser(null)}}async initializeCurrentUser(e){var i;if(wl(this.app)){const p=this.app.settings.authIdToken;return p?new Promise(y=>{setTimeout(()=>this.initializeCurrentUserFromIdToken(p).then(y,y))}):this.directlySetCurrentUser(null)}const o=await this.assertedPersistence.getCurrentUser();let l=o,u=!1;if(e&&this.config.authDomain){await this.getOrInitRedirectPersistenceManager();const p=(i=this.redirectUser)===null||i===void 0?void 0:i._redirectEventId,y=l==null?void 0:l._redirectEventId,E=await this.tryRedirectSignIn(e);(!p||p===y)&&(E!=null&&E.user)&&(l=E.user,u=!0)}if(!l)return this.directlySetCurrentUser(null);if(!l._redirectEventId){if(u)try{await this.beforeStateQueue.runMiddleware(l)}catch(p){l=o,this._popupRedirectResolver._overrideRedirectResult(this,()=>Promise.reject(p))}return l?this.reloadAndSetCurrentUserOrClear(l):this.directlySetCurrentUser(null)}return Zn(this._popupRedirectResolver,this,"argument-error"),await this.getOrInitRedirectPersistenceManager(),this.redirectUser&&this.redirectUser._redirectEventId===l._redirectEventId?this.directlySetCurrentUser(l):this.reloadAndSetCurrentUserOrClear(l)}async tryRedirectSignIn(e){let i=null;try{i=await this._popupRedirectResolver._completeRedirectFn(this,e,!0)}catch{await this._setRedirectUser(null)}return i}async reloadAndSetCurrentUserOrClear(e){try{await Pk(e)}catch(i){if((i==null?void 0:i.code)!=="auth/network-request-failed")return this.directlySetCurrentUser(null)}return this.directlySetCurrentUser(e)}useDeviceLanguage(){this.languageCode=aje()}async _delete(){this._deleted=!0}async updateCurrentUser(e){if(wl(this.app))return Promise.reject(qf(this));const i=e?Ni(e):null;return i&&Zn(i.auth.config.apiKey===this.config.apiKey,this,"invalid-user-token"),this._updateCurrentUser(i&&i._clone(this))}async _updateCurrentUser(e,i=!1){if(!this._deleted)return e&&Zn(this.tenantId===e.tenantId,this,"tenant-id-mismatch"),i||await this.beforeStateQueue.runMiddleware(e),this.queue(async()=>{await this.directlySetCurrentUser(e),this.notifyAuthListeners()})}async signOut(){return wl(this.app)?Promise.reject(qf(this)):(await this.beforeStateQueue.runMiddleware(null),(this.redirectPersistenceManager||this._popupRedirectResolver)&&await this._setRedirectUser(null),this._updateCurrentUser(null,!0))}setPersistence(e){return wl(this.app)?Promise.reject(qf(this)):this.queue(async()=>{await this.assertedPersistence.setPersistence(Ff(e))})}_getRecaptchaConfig(){return this.tenantId==null?this._agentRecaptchaConfig:this._tenantRecaptchaConfigs[this.tenantId]}async validatePassword(e){this._getPasswordPolicyInternal()||await this._updatePasswordPolicy();const i=this._getPasswordPolicyInternal();return i.schemaVersion!==this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION?Promise.reject(this._errorFactory.create("unsupported-password-policy-schema-version",{})):i.validatePassword(e)}_getPasswordPolicyInternal(){return this.tenantId===null?this._projectPasswordPolicy:this._tenantPasswordPolicies[this.tenantId]}async _updatePasswordPolicy(){const e=await Rje(this),i=new Aje(e);this.tenantId===null?this._projectPasswordPolicy=i:this._tenantPasswordPolicies[this.tenantId]=i}_getPersistenceType(){return this.assertedPersistence.persistence.type}_getPersistence(){return this.assertedPersistence.persistence}_updateErrorMap(e){this._errorFactory=new ZR("auth","Firebase",e())}onAuthStateChanged(e,i,o){return this.registerStateListener(this.authStateSubscription,e,i,o)}beforeAuthStateChanged(e,i){return this.beforeStateQueue.pushCallback(e,i)}onIdTokenChanged(e,i,o){return this.registerStateListener(this.idTokenSubscription,e,i,o)}authStateReady(){return new Promise((e,i)=>{if(this.currentUser)e();else{const o=this.onAuthStateChanged(()=>{o(),e()},i)}})}async revokeAccessToken(e){if(this.currentUser){const i=await this.currentUser.getIdToken(),o={providerId:"apple.com",tokenType:"ACCESS_TOKEN",token:e,idToken:i};this.tenantId!=null&&(o.tenantId=this.tenantId),await bje(this,o)}}toJSON(){var e;return{apiKey:this.config.apiKey,authDomain:this.config.authDomain,appName:this.name,currentUser:(e=this._currentUser)===null||e===void 0?void 0:e.toJSON()}}async _setRedirectUser(e,i){const o=await this.getOrInitRedirectPersistenceManager(i);return e===null?o.removeCurrentUser():o.setCurrentUser(e)}async getOrInitRedirectPersistenceManager(e){if(!this.redirectPersistenceManager){const i=e&&Ff(e)||this._popupRedirectResolver;Zn(i,this,"argument-error"),this.redirectPersistenceManager=await OS.create(this,[Ff(i._redirectPersistence)],"redirectUser"),this.redirectUser=await this.redirectPersistenceManager.getCurrentUser()}return this.redirectPersistenceManager}async _redirectUserForId(e){var i,o;return this._isInitialized&&await this.queue(async()=>{}),((i=this._currentUser)===null||i===void 0?void 0:i._redirectEventId)===e?this._currentUser:((o=this.redirectUser)===null||o===void 0?void 0:o._redirectEventId)===e?this.redirectUser:null}async _persistUserIfCurrent(e){if(e===this.currentUser)return this.queue(async()=>this.directlySetCurrentUser(e))}_notifyListenersIfCurrent(e){e===this.currentUser&&this.notifyAuthListeners()}_key(){return`${this.config.authDomain}:${this.config.apiKey}:${this.name}`}_startProactiveRefresh(){this.isProactiveRefreshEnabled=!0,this.currentUser&&this._currentUser._startProactiveRefresh()}_stopProactiveRefresh(){this.isProactiveRefreshEnabled=!1,this.currentUser&&this._currentUser._stopProactiveRefresh()}get _currentUser(){return this.currentUser}notifyAuthListeners(){var e,i;if(!this._isInitialized)return;this.idTokenSubscription.next(this.currentUser);const o=(i=(e=this.currentUser)===null||e===void 0?void 0:e.uid)!==null&&i!==void 0?i:null;this.lastNotifiedUid!==o&&(this.lastNotifiedUid=o,this.authStateSubscription.next(this.currentUser))}registerStateListener(e,i,o,l){if(this._deleted)return()=>{};const u=typeof i=="function"?i:i.next.bind(i);let p=!1;const y=this._isInitialized?Promise.resolve():this._initializationPromise;if(Zn(y,this,"internal-error"),y.then(()=>{p||u(this.currentUser)}),typeof i=="function"){const E=e.addObserver(i,o,l);return()=>{p=!0,E()}}else{const E=e.addObserver(i);return()=>{p=!0,E()}}}async directlySetCurrentUser(e){this.currentUser&&this.currentUser!==e&&this._currentUser._stopProactiveRefresh(),e&&this.isProactiveRefreshEnabled&&e._startProactiveRefresh(),this.currentUser=e,e?await this.assertedPersistence.setCurrentUser(e):await this.assertedPersistence.removeCurrentUser()}queue(e){return this.operations=this.operations.then(e,e),this.operations}get assertedPersistence(){return Zn(this.persistenceManager,this,"internal-error"),this.persistenceManager}_logFramework(e){!e||this.frameworks.includes(e)||(this.frameworks.push(e),this.frameworks.sort(),this.clientVersion=ise(this.config.clientPlatform,this._getFrameworks()))}_getFrameworks(){return this.frameworks}async _getAdditionalHeaders(){var e;const i={"X-Client-Version":this.clientVersion};this.app.options.appId&&(i["X-Firebase-gmpid"]=this.app.options.appId);const o=await((e=this.heartbeatServiceProvider.getImmediate({optional:!0}))===null||e===void 0?void 0:e.getHeartbeatsHeader());o&&(i["X-Firebase-Client"]=o);const l=await this._getAppCheckToken();return l&&(i["X-Firebase-AppCheck"]=l),i}async _getAppCheckToken(){var e;if(wl(this.app)&&this.app.settings.appCheckToken)return this.app.settings.appCheckToken;const i=await((e=this.appCheckServiceProvider.getImmediate({optional:!0}))===null||e===void 0?void 0:e.getToken());return i!=null&&i.error&&ije(`Error while retrieving App Check token: ${i.error}`),i==null?void 0:i.token}}function e_(n){return Ni(n)}class NJ{constructor(e){this.auth=e,this.observer=null,this.addObserver=$Ve(i=>this.observer=i)}get next(){return Zn(this.observer,this.auth,"internal-error"),this.observer.next.bind(this.observer)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let DN={async loadJS(){throw new Error("Unable to load external scripts")},recaptchaV2Script:"",recaptchaEnterpriseScript:"",gapiScript:""};function Oje(n){DN=n}function sse(n){return DN.loadJS(n)}function kje(){return DN.recaptchaEnterpriseScript}function Nje(){return DN.gapiScript}function xje(n){return`__${n}${Math.floor(Math.random()*1e6)}`}class Dje{constructor(){this.enterprise=new Lje}ready(e){e()}execute(e,i){return Promise.resolve("token")}render(e,i){return""}}class Lje{ready(e){e()}execute(e,i){return Promise.resolve("token")}render(e,i){return""}}const Mje="recaptcha-enterprise",ose="NO_RECAPTCHA";class Uje{constructor(e){this.type=Mje,this.auth=e_(e)}async verify(e="verify",i=!1){async function o(u){if(!i){if(u.tenantId==null&&u._agentRecaptchaConfig!=null)return u._agentRecaptchaConfig.siteKey;if(u.tenantId!=null&&u._tenantRecaptchaConfigs[u.tenantId]!==void 0)return u._tenantRecaptchaConfigs[u.tenantId].siteKey}return new Promise(async(p,y)=>{fje(u,{clientType:"CLIENT_TYPE_WEB",version:"RECAPTCHA_ENTERPRISE"}).then(E=>{if(E.recaptchaKey===void 0)y(new Error("recaptcha Enterprise site key undefined"));else{const b=new pje(E);return u.tenantId==null?u._agentRecaptchaConfig=b:u._tenantRecaptchaConfigs[u.tenantId]=b,p(b.siteKey)}}).catch(E=>{y(E)})})}function l(u,p,y){const E=window.grecaptcha;IJ(E)?E.enterprise.ready(()=>{E.enterprise.execute(u,{action:e}).then(b=>{p(b)}).catch(()=>{p(ose)})}):y(Error("No reCAPTCHA enterprise script loaded."))}return this.auth.settings.appVerificationDisabledForTesting?new Dje().execute("siteKey",{action:"verify"}):new Promise((u,p)=>{o(this.auth).then(y=>{if(!i&&IJ(window.grecaptcha))l(y,u,p);else{if(typeof window>"u"){p(new Error("RecaptchaVerifier is only supported in browser"));return}let E=kje();E.length!==0&&(E+=y),sse(E).then(()=>{l(y,u,p)}).catch(b=>{p(b)})}}).catch(y=>{p(y)})})}}async function xJ(n,e,i,o=!1,l=!1){const u=new Uje(n);let p;if(l)p=ose;else try{p=await u.verify(i)}catch{p=await u.verify(i,!0)}const y=Object.assign({},e);if(i==="mfaSmsEnrollment"||i==="mfaSmsSignIn"){if("phoneEnrollmentInfo"in y){const E=y.phoneEnrollmentInfo.phoneNumber,b=y.phoneEnrollmentInfo.recaptchaToken;Object.assign(y,{phoneEnrollmentInfo:{phoneNumber:E,recaptchaToken:b,captchaResponse:p,clientType:"CLIENT_TYPE_WEB",recaptchaVersion:"RECAPTCHA_ENTERPRISE"}})}else if("phoneSignInInfo"in y){const E=y.phoneSignInInfo.recaptchaToken;Object.assign(y,{phoneSignInInfo:{recaptchaToken:E,captchaResponse:p,clientType:"CLIENT_TYPE_WEB",recaptchaVersion:"RECAPTCHA_ENTERPRISE"}})}return y}return o?Object.assign(y,{captchaResp:p}):Object.assign(y,{captchaResponse:p}),Object.assign(y,{clientType:"CLIENT_TYPE_WEB"}),Object.assign(y,{recaptchaVersion:"RECAPTCHA_ENTERPRISE"}),y}async function Ok(n,e,i,o,l){var u;if(!((u=n._getRecaptchaConfig())===null||u===void 0)&&u.isProviderEnabled("EMAIL_PASSWORD_PROVIDER")){const p=await xJ(n,e,i,i==="getOobCode");return o(n,p)}else return o(n,e).catch(async p=>{if(p.code==="auth/missing-recaptcha-token"){console.log(`${i} is protected by reCAPTCHA Enterprise for this project. Automatically triggering the reCAPTCHA flow and restarting the flow.`);const y=await xJ(n,e,i,i==="getOobCode");return o(n,y)}else return Promise.reject(p)})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Vje(n,e){const i=tI(n,"auth");if(i.isInitialized()){const l=i.getImmediate(),u=i.getOptions();if(em(u,e??{}))return l;Sh(l,"already-initialized")}return i.initialize({options:e})}function jje(n,e){const i=(e==null?void 0:e.persistence)||[],o=(Array.isArray(i)?i:[i]).map(Ff);e!=null&&e.errorMap&&n._updateErrorMap(e.errorMap),n._initializeWithPersistence(o,e==null?void 0:e.popupRedirectResolver)}function Fje(n,e,i){const o=e_(n);Zn(/^https?:\/\//.test(e),o,"invalid-emulator-scheme");const l=!1,u=ase(e),{host:p,port:y}=Bje(e),E=y===null?"":`:${y}`,b={url:`${u}//${p}${E}/`},T=Object.freeze({host:p,port:y,protocol:u.replace(":",""),options:Object.freeze({disableWarnings:l})});if(!o._canInitEmulator){Zn(o.config.emulator&&o.emulatorConfig,o,"emulator-config-failed"),Zn(em(b,o.config.emulator)&&em(T,o.emulatorConfig),o,"emulator-config-failed");return}o.config.emulator=b,o.emulatorConfig=T,o.settings.appVerificationDisabledForTesting=!0,cm(p)?(kN(`${u}//${p}${E}`),NN("Auth",!0)):zje()}function ase(n){const e=n.indexOf(":");return e<0?"":n.substr(0,e+1)}function Bje(n){const e=ase(n),i=/(\/\/)?([^?#/]+)/.exec(n.substr(e.length));if(!i)return{host:"",port:null};const o=i[2].split("@").pop()||"",l=/^(\[[^\]]+\])(:|$)/.exec(o);if(l){const u=l[1];return{host:u,port:DJ(o.substr(u.length+1))}}else{const[u,p]=o.split(":");return{host:u,port:DJ(p)}}}function DJ(n){if(!n)return null;const e=Number(n);return isNaN(e)?null:e}function zje(){function n(){const e=document.createElement("p"),i=e.style;e.innerText="Running in emulator mode. Do not use with production credentials.",i.position="fixed",i.width="100%",i.backgroundColor="#ffffff",i.border=".1em solid #000000",i.color="#b50000",i.bottom="0px",i.left="0px",i.margin="0px",i.zIndex="10000",i.textAlign="center",e.classList.add("firebase-emulator-warning"),document.body.appendChild(e)}typeof console<"u"&&typeof console.info=="function"&&console.info("WARNING: You are using the Auth Emulator, which is intended for local testing only.  Do not use with production credentials."),typeof window<"u"&&typeof document<"u"&&(document.readyState==="loading"?window.addEventListener("DOMContentLoaded",n):n())}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class qF{constructor(e,i){this.providerId=e,this.signInMethod=i}toJSON(){return jf("not implemented")}_getIdTokenResponse(e){return jf("not implemented")}_linkToIdToken(e,i){return jf("not implemented")}_getReauthenticationResolver(e){return jf("not implemented")}}async function Wje(n,e){return um(n,"POST","/v1/accounts:signUp",e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Gje(n,e){return rI(n,"POST","/v1/accounts:signInWithPassword",lm(n,e))}async function cse(n,e){return um(n,"POST","/v1/accounts:sendOobCode",lm(n,e))}async function Hje(n,e){return cse(n,e)}async function $je(n,e){return cse(n,e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Kje(n,e){return rI(n,"POST","/v1/accounts:signInWithEmailLink",lm(n,e))}async function qje(n,e){return rI(n,"POST","/v1/accounts:signInWithEmailLink",lm(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class IR extends qF{constructor(e,i,o,l=null){super("password",o),this._email=e,this._password=i,this._tenantId=l}static _fromEmailAndPassword(e,i){return new IR(e,i,"password")}static _fromEmailAndCode(e,i,o=null){return new IR(e,i,"emailLink",o)}toJSON(){return{email:this._email,password:this._password,signInMethod:this.signInMethod,tenantId:this._tenantId}}static fromJSON(e){const i=typeof e=="string"?JSON.parse(e):e;if(i!=null&&i.email&&(i!=null&&i.password)){if(i.signInMethod==="password")return this._fromEmailAndPassword(i.email,i.password);if(i.signInMethod==="emailLink")return this._fromEmailAndCode(i.email,i.password,i.tenantId)}return null}async _getIdTokenResponse(e){switch(this.signInMethod){case"password":const i={returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"};return Ok(e,i,"signInWithPassword",Gje);case"emailLink":return Kje(e,{email:this._email,oobCode:this._password});default:Sh(e,"internal-error")}}async _linkToIdToken(e,i){switch(this.signInMethod){case"password":const o={idToken:i,returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"};return Ok(e,o,"signUpPassword",Wje);case"emailLink":return qje(e,{idToken:i,email:this._email,oobCode:this._password});default:Sh(e,"internal-error")}}_getReauthenticationResolver(e){return this._getIdTokenResponse(e)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function kS(n,e){return rI(n,"POST","/v1/accounts:signInWithIdp",lm(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Yje="http://localhost";class hE extends qF{constructor(){super(...arguments),this.pendingToken=null}static _fromParams(e){const i=new hE(e.providerId,e.signInMethod);return e.idToken||e.accessToken?(e.idToken&&(i.idToken=e.idToken),e.accessToken&&(i.accessToken=e.accessToken),e.nonce&&!e.pendingToken&&(i.nonce=e.nonce),e.pendingToken&&(i.pendingToken=e.pendingToken)):e.oauthToken&&e.oauthTokenSecret?(i.accessToken=e.oauthToken,i.secret=e.oauthTokenSecret):Sh("argument-error"),i}toJSON(){return{idToken:this.idToken,accessToken:this.accessToken,secret:this.secret,nonce:this.nonce,pendingToken:this.pendingToken,providerId:this.providerId,signInMethod:this.signInMethod}}static fromJSON(e){const i=typeof e=="string"?JSON.parse(e):e,{providerId:o,signInMethod:l}=i,u=qR(i,["providerId","signInMethod"]);if(!o||!l)return null;const p=new hE(o,l);return p.idToken=u.idToken||void 0,p.accessToken=u.accessToken||void 0,p.secret=u.secret,p.nonce=u.nonce,p.pendingToken=u.pendingToken||null,p}_getIdTokenResponse(e){const i=this.buildRequest();return kS(e,i)}_linkToIdToken(e,i){const o=this.buildRequest();return o.idToken=i,kS(e,o)}_getReauthenticationResolver(e){const i=this.buildRequest();return i.autoCreate=!1,kS(e,i)}buildRequest(){const e={requestUri:Yje,returnSecureToken:!0};if(this.pendingToken)e.pendingToken=this.pendingToken;else{const i={};this.idToken&&(i.id_token=this.idToken),this.accessToken&&(i.access_token=this.accessToken),this.secret&&(i.oauth_token_secret=this.secret),i.providerId=this.providerId,this.nonce&&!this.pendingToken&&(i.nonce=this.nonce),e.postBody=eI(i)}return e}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Xje(n){switch(n){case"recoverEmail":return"RECOVER_EMAIL";case"resetPassword":return"PASSWORD_RESET";case"signIn":return"EMAIL_SIGNIN";case"verifyEmail":return"VERIFY_EMAIL";case"verifyAndChangeEmail":return"VERIFY_AND_CHANGE_EMAIL";case"revertSecondFactorAddition":return"REVERT_SECOND_FACTOR_ADDITION";default:return null}}function Jje(n){const e=AC(PC(n)).link,i=e?AC(PC(e)).deep_link_id:null,o=AC(PC(n)).deep_link_id;return(o?AC(PC(o)).link:null)||o||i||e||n}class YF{constructor(e){var i,o,l,u,p,y;const E=AC(PC(e)),b=(i=E.apiKey)!==null&&i!==void 0?i:null,T=(o=E.oobCode)!==null&&o!==void 0?o:null,R=Xje((l=E.mode)!==null&&l!==void 0?l:null);Zn(b&&T&&R,"argument-error"),this.apiKey=b,this.operation=R,this.code=T,this.continueUrl=(u=E.continueUrl)!==null&&u!==void 0?u:null,this.languageCode=(p=E.lang)!==null&&p!==void 0?p:null,this.tenantId=(y=E.tenantId)!==null&&y!==void 0?y:null}static parseLink(e){const i=Jje(e);try{return new YF(i)}catch{return null}}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class hb{constructor(){this.providerId=hb.PROVIDER_ID}static credential(e,i){return IR._fromEmailAndPassword(e,i)}static credentialWithLink(e,i){const o=YF.parseLink(i);return Zn(o,"argument-error"),IR._fromEmailAndCode(e,o.code,o.tenantId)}}hb.PROVIDER_ID="password";hb.EMAIL_PASSWORD_SIGN_IN_METHOD="password";hb.EMAIL_LINK_SIGN_IN_METHOD="emailLink";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class lse{constructor(e){this.providerId=e,this.defaultLanguageCode=null,this.customParameters={}}setDefaultLanguage(e){this.defaultLanguageCode=e}setCustomParameters(e){return this.customParameters=e,this}getCustomParameters(){return this.customParameters}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class iI extends lse{constructor(){super(...arguments),this.scopes=[]}addScope(e){return this.scopes.includes(e)||this.scopes.push(e),this}getScopes(){return[...this.scopes]}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ig extends iI{constructor(){super("facebook.com")}static credential(e){return hE._fromParams({providerId:Ig.PROVIDER_ID,signInMethod:Ig.FACEBOOK_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return Ig.credentialFromTaggedObject(e)}static credentialFromError(e){return Ig.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e)||!e.oauthAccessToken)return null;try{return Ig.credential(e.oauthAccessToken)}catch{return null}}}Ig.FACEBOOK_SIGN_IN_METHOD="facebook.com";Ig.PROVIDER_ID="facebook.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ag extends iI{constructor(){super("google.com"),this.addScope("profile")}static credential(e,i){return hE._fromParams({providerId:Ag.PROVIDER_ID,signInMethod:Ag.GOOGLE_SIGN_IN_METHOD,idToken:e,accessToken:i})}static credentialFromResult(e){return Ag.credentialFromTaggedObject(e)}static credentialFromError(e){return Ag.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthIdToken:i,oauthAccessToken:o}=e;if(!i&&!o)return null;try{return Ag.credential(i,o)}catch{return null}}}Ag.GOOGLE_SIGN_IN_METHOD="google.com";Ag.PROVIDER_ID="google.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Pg extends iI{constructor(){super("github.com")}static credential(e){return hE._fromParams({providerId:Pg.PROVIDER_ID,signInMethod:Pg.GITHUB_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return Pg.credentialFromTaggedObject(e)}static credentialFromError(e){return Pg.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e)||!e.oauthAccessToken)return null;try{return Pg.credential(e.oauthAccessToken)}catch{return null}}}Pg.GITHUB_SIGN_IN_METHOD="github.com";Pg.PROVIDER_ID="github.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Og extends iI{constructor(){super("twitter.com")}static credential(e,i){return hE._fromParams({providerId:Og.PROVIDER_ID,signInMethod:Og.TWITTER_SIGN_IN_METHOD,oauthToken:e,oauthTokenSecret:i})}static credentialFromResult(e){return Og.credentialFromTaggedObject(e)}static credentialFromError(e){return Og.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthAccessToken:i,oauthTokenSecret:o}=e;if(!i||!o)return null;try{return Og.credential(i,o)}catch{return null}}}Og.TWITTER_SIGN_IN_METHOD="twitter.com";Og.PROVIDER_ID="twitter.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Qje(n,e){return rI(n,"POST","/v1/accounts:signUp",lm(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class pE{constructor(e){this.user=e.user,this.providerId=e.providerId,this._tokenResponse=e._tokenResponse,this.operationType=e.operationType}static async _fromIdTokenResponse(e,i,o,l=!1){const u=await _h._fromIdTokenResponse(e,o,l),p=LJ(o);return new pE({user:u,providerId:p,_tokenResponse:o,operationType:i})}static async _forOperation(e,i,o){await e._updateTokensIfNecessary(o,!0);const l=LJ(o);return new pE({user:e,providerId:l,_tokenResponse:o,operationType:i})}}function LJ(n){return n.providerId?n.providerId:"phoneNumber"in n?"phone":null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class kk extends Th{constructor(e,i,o,l){var u;super(i.code,i.message),this.operationType=o,this.user=l,Object.setPrototypeOf(this,kk.prototype),this.customData={appName:e.name,tenantId:(u=e.tenantId)!==null&&u!==void 0?u:void 0,_serverResponse:i.customData._serverResponse,operationType:o}}static _fromErrorAndOperation(e,i,o,l){return new kk(e,i,o,l)}}function use(n,e,i,o){return(e==="reauthenticate"?i._getReauthenticationResolver(n):i._getIdTokenResponse(n)).catch(u=>{throw u.code==="auth/multi-factor-auth-required"?kk._fromErrorAndOperation(n,u,e,o):u})}async function Zje(n,e,i=!1){const o=await RR(n,e._linkToIdToken(n.auth,await n.getIdToken()),i);return pE._forOperation(n,"link",o)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function eFe(n,e,i=!1){const{auth:o}=n;if(wl(o.app))return Promise.reject(qf(o));const l="reauthenticate";try{const u=await RR(n,use(o,l,e,n),i);Zn(u.idToken,o,"internal-error");const p=$F(u.idToken);Zn(p,o,"internal-error");const{sub:y}=p;return Zn(n.uid===y,o,"user-mismatch"),pE._forOperation(n,l,u)}catch(u){throw(u==null?void 0:u.code)==="auth/user-not-found"&&Sh(o,"user-mismatch"),u}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function dse(n,e,i=!1){if(wl(n.app))return Promise.reject(qf(n));const o="signIn",l=await use(n,o,e),u=await pE._fromIdTokenResponse(n,o,l);return i||await n._updateCurrentUser(u.user),u}async function tFe(n,e){return dse(e_(n),e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function hse(n){const e=e_(n);e._getPasswordPolicyInternal()&&await e._updatePasswordPolicy()}async function nFe(n,e,i){const o=e_(n);await Ok(o,{requestType:"PASSWORD_RESET",email:e,clientType:"CLIENT_TYPE_WEB"},"getOobCode",$je)}async function rFe(n,e,i){if(wl(n.app))return Promise.reject(qf(n));const o=e_(n),p=await Ok(o,{returnSecureToken:!0,email:e,password:i,clientType:"CLIENT_TYPE_WEB"},"signUpPassword",Qje).catch(E=>{throw E.code==="auth/password-does-not-meet-requirements"&&hse(n),E}),y=await pE._fromIdTokenResponse(o,"signIn",p);return await o._updateCurrentUser(y.user),y}function iFe(n,e,i){return wl(n.app)?Promise.reject(qf(n)):tFe(Ni(n),hb.credential(e,i)).catch(async o=>{throw o.code==="auth/password-does-not-meet-requirements"&&hse(n),o})}async function pse(n,e){const i=Ni(n),l={requestType:"VERIFY_EMAIL",idToken:await n.getIdToken()},{email:u}=await Hje(i.auth,l);u!==n.email&&await n.reload()}function sFe(n,e,i,o){return Ni(n).onIdTokenChanged(e,i,o)}function oFe(n,e,i){return Ni(n).beforeAuthStateChanged(e,i)}function aFe(n,e,i,o){return Ni(n).onAuthStateChanged(e,i,o)}function cFe(n){return Ni(n).signOut()}const Nk="__sak";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class fse{constructor(e,i){this.storageRetriever=e,this.type=i}_isAvailable(){try{return this.storage?(this.storage.setItem(Nk,"1"),this.storage.removeItem(Nk),Promise.resolve(!0)):Promise.resolve(!1)}catch{return Promise.resolve(!1)}}_set(e,i){return this.storage.setItem(e,JSON.stringify(i)),Promise.resolve()}_get(e){const i=this.storage.getItem(e);return Promise.resolve(i?JSON.parse(i):null)}_remove(e){return this.storage.removeItem(e),Promise.resolve()}get storage(){return this.storageRetriever()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const lFe=1e3,uFe=10;class mse extends fse{constructor(){super(()=>window.localStorage,"LOCAL"),this.boundEventHandler=(e,i)=>this.onStorageEvent(e,i),this.listeners={},this.localCache={},this.pollTimer=null,this.fallbackToPolling=rse(),this._shouldAllowMigration=!0}forAllChangedKeys(e){for(const i of Object.keys(this.listeners)){const o=this.storage.getItem(i),l=this.localCache[i];o!==l&&e(i,l,o)}}onStorageEvent(e,i=!1){if(!e.key){this.forAllChangedKeys((p,y,E)=>{this.notifyListeners(p,E)});return}const o=e.key;i?this.detachListener():this.stopPolling();const l=()=>{const p=this.storage.getItem(o);!i&&this.localCache[o]===p||this.notifyListeners(o,p)},u=this.storage.getItem(o);Tje()&&u!==e.newValue&&e.newValue!==e.oldValue?setTimeout(l,uFe):l()}notifyListeners(e,i){this.localCache[e]=i;const o=this.listeners[e];if(o)for(const l of Array.from(o))l(i&&JSON.parse(i))}startPolling(){this.stopPolling(),this.pollTimer=setInterval(()=>{this.forAllChangedKeys((e,i,o)=>{this.onStorageEvent(new StorageEvent("storage",{key:e,oldValue:i,newValue:o}),!0)})},lFe)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}attachListener(){window.addEventListener("storage",this.boundEventHandler)}detachListener(){window.removeEventListener("storage",this.boundEventHandler)}_addListener(e,i){Object.keys(this.listeners).length===0&&(this.fallbackToPolling?this.startPolling():this.attachListener()),this.listeners[e]||(this.listeners[e]=new Set,this.localCache[e]=this.storage.getItem(e)),this.listeners[e].add(i)}_removeListener(e,i){this.listeners[e]&&(this.listeners[e].delete(i),this.listeners[e].size===0&&delete this.listeners[e]),Object.keys(this.listeners).length===0&&(this.detachListener(),this.stopPolling())}async _set(e,i){await super._set(e,i),this.localCache[e]=JSON.stringify(i)}async _get(e){const i=await super._get(e);return this.localCache[e]=JSON.stringify(i),i}async _remove(e){await super._remove(e),delete this.localCache[e]}}mse.type="LOCAL";const dFe=mse;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class gse extends fse{constructor(){super(()=>window.sessionStorage,"SESSION")}_addListener(e,i){}_removeListener(e,i){}}gse.type="SESSION";const _se=gse;/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function hFe(n){return Promise.all(n.map(async e=>{try{return{fulfilled:!0,value:await e}}catch(i){return{fulfilled:!1,reason:i}}}))}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class LN{constructor(e){this.eventTarget=e,this.handlersMap={},this.boundEventHandler=this.handleEvent.bind(this)}static _getInstance(e){const i=this.receivers.find(l=>l.isListeningto(e));if(i)return i;const o=new LN(e);return this.receivers.push(o),o}isListeningto(e){return this.eventTarget===e}async handleEvent(e){const i=e,{eventId:o,eventType:l,data:u}=i.data,p=this.handlersMap[l];if(!(p!=null&&p.size))return;i.ports[0].postMessage({status:"ack",eventId:o,eventType:l});const y=Array.from(p).map(async b=>b(i.origin,u)),E=await hFe(y);i.ports[0].postMessage({status:"done",eventId:o,eventType:l,response:E})}_subscribe(e,i){Object.keys(this.handlersMap).length===0&&this.eventTarget.addEventListener("message",this.boundEventHandler),this.handlersMap[e]||(this.handlersMap[e]=new Set),this.handlersMap[e].add(i)}_unsubscribe(e,i){this.handlersMap[e]&&i&&this.handlersMap[e].delete(i),(!i||this.handlersMap[e].size===0)&&delete this.handlersMap[e],Object.keys(this.handlersMap).length===0&&this.eventTarget.removeEventListener("message",this.boundEventHandler)}}LN.receivers=[];/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function XF(n="",e=10){let i="";for(let o=0;o<e;o++)i+=Math.floor(Math.random()*10);return n+i}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class pFe{constructor(e){this.target=e,this.handlers=new Set}removeMessageHandler(e){e.messageChannel&&(e.messageChannel.port1.removeEventListener("message",e.onMessage),e.messageChannel.port1.close()),this.handlers.delete(e)}async _send(e,i,o=50){const l=typeof MessageChannel<"u"?new MessageChannel:null;if(!l)throw new Error("connection_unavailable");let u,p;return new Promise((y,E)=>{const b=XF("",20);l.port1.start();const T=setTimeout(()=>{E(new Error("unsupported_event"))},o);p={messageChannel:l,onMessage(R){const O=R;if(O.data.eventId===b)switch(O.data.status){case"ack":clearTimeout(T),u=setTimeout(()=>{E(new Error("timeout"))},3e3);break;case"done":clearTimeout(u),y(O.data.response);break;default:clearTimeout(T),clearTimeout(u),E(new Error("invalid_response"));break}}},this.handlers.add(p),l.port1.addEventListener("message",p.onMessage),this.target.postMessage({eventType:e,eventId:b,data:i},[l.port2])}).finally(()=>{p&&this.removeMessageHandler(p)})}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Fp(){return window}function fFe(n){Fp().location.href=n}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function yse(){return typeof Fp().WorkerGlobalScope<"u"&&typeof Fp().importScripts=="function"}async function mFe(){if(!(navigator!=null&&navigator.serviceWorker))return null;try{return(await navigator.serviceWorker.ready).active}catch{return null}}function gFe(){var n;return((n=navigator==null?void 0:navigator.serviceWorker)===null||n===void 0?void 0:n.controller)||null}function _Fe(){return yse()?self:null}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ese="firebaseLocalStorageDb",yFe=1,xk="firebaseLocalStorage",vse="fbase_key";class sI{constructor(e){this.request=e}toPromise(){return new Promise((e,i)=>{this.request.addEventListener("success",()=>{e(this.request.result)}),this.request.addEventListener("error",()=>{i(this.request.error)})})}}function MN(n,e){return n.transaction([xk],e?"readwrite":"readonly").objectStore(xk)}function EFe(){const n=indexedDB.deleteDatabase(Ese);return new sI(n).toPromise()}function A5(){const n=indexedDB.open(Ese,yFe);return new Promise((e,i)=>{n.addEventListener("error",()=>{i(n.error)}),n.addEventListener("upgradeneeded",()=>{const o=n.result;try{o.createObjectStore(xk,{keyPath:vse})}catch(l){i(l)}}),n.addEventListener("success",async()=>{const o=n.result;o.objectStoreNames.contains(xk)?e(o):(o.close(),await EFe(),e(await A5()))})})}async function MJ(n,e,i){const o=MN(n,!0).put({[vse]:e,value:i});return new sI(o).toPromise()}async function vFe(n,e){const i=MN(n,!1).get(e),o=await new sI(i).toPromise();return o===void 0?null:o.value}function UJ(n,e){const i=MN(n,!0).delete(e);return new sI(i).toPromise()}const SFe=800,bFe=3;class Sse{constructor(){this.type="LOCAL",this._shouldAllowMigration=!0,this.listeners={},this.localCache={},this.pollTimer=null,this.pendingWrites=0,this.receiver=null,this.sender=null,this.serviceWorkerReceiverAvailable=!1,this.activeServiceWorker=null,this._workerInitializationPromise=this.initializeServiceWorkerMessaging().then(()=>{},()=>{})}async _openDb(){return this.db?this.db:(this.db=await A5(),this.db)}async _withRetries(e){let i=0;for(;;)try{const o=await this._openDb();return await e(o)}catch(o){if(i++>bFe)throw o;this.db&&(this.db.close(),this.db=void 0)}}async initializeServiceWorkerMessaging(){return yse()?this.initializeReceiver():this.initializeSender()}async initializeReceiver(){this.receiver=LN._getInstance(_Fe()),this.receiver._subscribe("keyChanged",async(e,i)=>({keyProcessed:(await this._poll()).includes(i.key)})),this.receiver._subscribe("ping",async(e,i)=>["keyChanged"])}async initializeSender(){var e,i;if(this.activeServiceWorker=await mFe(),!this.activeServiceWorker)return;this.sender=new pFe(this.activeServiceWorker);const o=await this.sender._send("ping",{},800);o&&!((e=o[0])===null||e===void 0)&&e.fulfilled&&!((i=o[0])===null||i===void 0)&&i.value.includes("keyChanged")&&(this.serviceWorkerReceiverAvailable=!0)}async notifyServiceWorker(e){if(!(!this.sender||!this.activeServiceWorker||gFe()!==this.activeServiceWorker))try{await this.sender._send("keyChanged",{key:e},this.serviceWorkerReceiverAvailable?800:50)}catch{}}async _isAvailable(){try{if(!indexedDB)return!1;const e=await A5();return await MJ(e,Nk,"1"),await UJ(e,Nk),!0}catch{}return!1}async _withPendingWrite(e){this.pendingWrites++;try{await e()}finally{this.pendingWrites--}}async _set(e,i){return this._withPendingWrite(async()=>(await this._withRetries(o=>MJ(o,e,i)),this.localCache[e]=i,this.notifyServiceWorker(e)))}async _get(e){const i=await this._withRetries(o=>vFe(o,e));return this.localCache[e]=i,i}async _remove(e){return this._withPendingWrite(async()=>(await this._withRetries(i=>UJ(i,e)),delete this.localCache[e],this.notifyServiceWorker(e)))}async _poll(){const e=await this._withRetries(l=>{const u=MN(l,!1).getAll();return new sI(u).toPromise()});if(!e)return[];if(this.pendingWrites!==0)return[];const i=[],o=new Set;if(e.length!==0)for(const{fbase_key:l,value:u}of e)o.add(l),JSON.stringify(this.localCache[l])!==JSON.stringify(u)&&(this.notifyListeners(l,u),i.push(l));for(const l of Object.keys(this.localCache))this.localCache[l]&&!o.has(l)&&(this.notifyListeners(l,null),i.push(l));return i}notifyListeners(e,i){this.localCache[e]=i;const o=this.listeners[e];if(o)for(const l of Array.from(o))l(i)}startPolling(){this.stopPolling(),this.pollTimer=setInterval(async()=>this._poll(),SFe)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}_addListener(e,i){Object.keys(this.listeners).length===0&&this.startPolling(),this.listeners[e]||(this.listeners[e]=new Set,this._get(e)),this.listeners[e].add(i)}_removeListener(e,i){this.listeners[e]&&(this.listeners[e].delete(i),this.listeners[e].size===0&&delete this.listeners[e]),Object.keys(this.listeners).length===0&&this.stopPolling()}}Sse.type="LOCAL";const wFe=Sse;new nI(3e4,6e4);/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function TFe(n,e){return e?Ff(e):(Zn(n._popupRedirectResolver,n,"argument-error"),n._popupRedirectResolver)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class JF extends qF{constructor(e){super("custom","custom"),this.params=e}_getIdTokenResponse(e){return kS(e,this._buildIdpRequest())}_linkToIdToken(e,i){return kS(e,this._buildIdpRequest(i))}_getReauthenticationResolver(e){return kS(e,this._buildIdpRequest())}_buildIdpRequest(e){const i={requestUri:this.params.requestUri,sessionId:this.params.sessionId,postBody:this.params.postBody,tenantId:this.params.tenantId,pendingToken:this.params.pendingToken,returnSecureToken:!0,returnIdpCredential:!0};return e&&(i.idToken=e),i}}function CFe(n){return dse(n.auth,new JF(n),n.bypassAuthState)}function RFe(n){const{auth:e,user:i}=n;return Zn(i,e,"internal-error"),eFe(i,new JF(n),n.bypassAuthState)}async function IFe(n){const{auth:e,user:i}=n;return Zn(i,e,"internal-error"),Zje(i,new JF(n),n.bypassAuthState)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class bse{constructor(e,i,o,l,u=!1){this.auth=e,this.resolver=o,this.user=l,this.bypassAuthState=u,this.pendingPromise=null,this.eventManager=null,this.filter=Array.isArray(i)?i:[i]}execute(){return new Promise(async(e,i)=>{this.pendingPromise={resolve:e,reject:i};try{this.eventManager=await this.resolver._initialize(this.auth),await this.onExecution(),this.eventManager.registerConsumer(this)}catch(o){this.reject(o)}})}async onAuthEvent(e){const{urlResponse:i,sessionId:o,postBody:l,tenantId:u,error:p,type:y}=e;if(p){this.reject(p);return}const E={auth:this.auth,requestUri:i,sessionId:o,tenantId:u||void 0,postBody:l||void 0,user:this.user,bypassAuthState:this.bypassAuthState};try{this.resolve(await this.getIdpTask(y)(E))}catch(b){this.reject(b)}}onError(e){this.reject(e)}getIdpTask(e){switch(e){case"signInViaPopup":case"signInViaRedirect":return CFe;case"linkViaPopup":case"linkViaRedirect":return IFe;case"reauthViaPopup":case"reauthViaRedirect":return RFe;default:Sh(this.auth,"internal-error")}}resolve(e){rm(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.resolve(e),this.unregisterAndCleanUp()}reject(e){rm(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.reject(e),this.unregisterAndCleanUp()}unregisterAndCleanUp(){this.eventManager&&this.eventManager.unregisterConsumer(this),this.pendingPromise=null,this.cleanUp()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const AFe=new nI(2e3,1e4);class hS extends bse{constructor(e,i,o,l,u){super(e,i,l,u),this.provider=o,this.authWindow=null,this.pollId=null,hS.currentPopupAction&&hS.currentPopupAction.cancel(),hS.currentPopupAction=this}async executeNotNull(){const e=await this.execute();return Zn(e,this.auth,"internal-error"),e}async onExecution(){rm(this.filter.length===1,"Popup operations only handle one event");const e=XF();this.authWindow=await this.resolver._openPopup(this.auth,this.provider,this.filter[0],e),this.authWindow.associatedEvent=e,this.resolver._originValidation(this.auth).catch(i=>{this.reject(i)}),this.resolver._isIframeWebStorageSupported(this.auth,i=>{i||this.reject(jp(this.auth,"web-storage-unsupported"))}),this.pollUserCancellation()}get eventId(){var e;return((e=this.authWindow)===null||e===void 0?void 0:e.associatedEvent)||null}cancel(){this.reject(jp(this.auth,"cancelled-popup-request"))}cleanUp(){this.authWindow&&this.authWindow.close(),this.pollId&&window.clearTimeout(this.pollId),this.authWindow=null,this.pollId=null,hS.currentPopupAction=null}pollUserCancellation(){const e=()=>{var i,o;if(!((o=(i=this.authWindow)===null||i===void 0?void 0:i.window)===null||o===void 0)&&o.closed){this.pollId=window.setTimeout(()=>{this.pollId=null,this.reject(jp(this.auth,"popup-closed-by-user"))},8e3);return}this.pollId=window.setTimeout(e,AFe.get())};e()}}hS.currentPopupAction=null;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const PFe="pendingRedirect",XO=new Map;class OFe extends bse{constructor(e,i,o=!1){super(e,["signInViaRedirect","linkViaRedirect","reauthViaRedirect","unknown"],i,void 0,o),this.eventId=null}async execute(){let e=XO.get(this.auth._key());if(!e){try{const o=await kFe(this.resolver,this.auth)?await super.execute():null;e=()=>Promise.resolve(o)}catch(i){e=()=>Promise.reject(i)}XO.set(this.auth._key(),e)}return this.bypassAuthState||XO.set(this.auth._key(),()=>Promise.resolve(null)),e()}async onAuthEvent(e){if(e.type==="signInViaRedirect")return super.onAuthEvent(e);if(e.type==="unknown"){this.resolve(null);return}if(e.eventId){const i=await this.auth._redirectUserForId(e.eventId);if(i)return this.user=i,super.onAuthEvent(e);this.resolve(null)}}async onExecution(){}cleanUp(){}}async function kFe(n,e){const i=DFe(e),o=xFe(n);if(!await o._isAvailable())return!1;const l=await o._get(i)==="true";return await o._remove(i),l}function NFe(n,e){XO.set(n._key(),e)}function xFe(n){return Ff(n._redirectPersistence)}function DFe(n){return YO(PFe,n.config.apiKey,n.name)}async function LFe(n,e,i=!1){if(wl(n.app))return Promise.reject(qf(n));const o=e_(n),l=TFe(o,e),p=await new OFe(o,l,i).execute();return p&&!i&&(delete p.user._redirectEventId,await o._persistUserIfCurrent(p.user),await o._setRedirectUser(null,e)),p}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const MFe=600*1e3;class UFe{constructor(e){this.auth=e,this.cachedEventUids=new Set,this.consumers=new Set,this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1,this.lastProcessedEventTime=Date.now()}registerConsumer(e){this.consumers.add(e),this.queuedRedirectEvent&&this.isEventForConsumer(this.queuedRedirectEvent,e)&&(this.sendToConsumer(this.queuedRedirectEvent,e),this.saveEventToCache(this.queuedRedirectEvent),this.queuedRedirectEvent=null)}unregisterConsumer(e){this.consumers.delete(e)}onEvent(e){if(this.hasEventBeenHandled(e))return!1;let i=!1;return this.consumers.forEach(o=>{this.isEventForConsumer(e,o)&&(i=!0,this.sendToConsumer(e,o),this.saveEventToCache(e))}),this.hasHandledPotentialRedirect||!VFe(e)||(this.hasHandledPotentialRedirect=!0,i||(this.queuedRedirectEvent=e,i=!0)),i}sendToConsumer(e,i){var o;if(e.error&&!wse(e)){const l=((o=e.error.code)===null||o===void 0?void 0:o.split("auth/")[1])||"internal-error";i.onError(jp(this.auth,l))}else i.onAuthEvent(e)}isEventForConsumer(e,i){const o=i.eventId===null||!!e.eventId&&e.eventId===i.eventId;return i.filter.includes(e.type)&&o}hasEventBeenHandled(e){return Date.now()-this.lastProcessedEventTime>=MFe&&this.cachedEventUids.clear(),this.cachedEventUids.has(VJ(e))}saveEventToCache(e){this.cachedEventUids.add(VJ(e)),this.lastProcessedEventTime=Date.now()}}function VJ(n){return[n.type,n.eventId,n.sessionId,n.tenantId].filter(e=>e).join("-")}function wse({type:n,error:e}){return n==="unknown"&&(e==null?void 0:e.code)==="auth/no-auth-event"}function VFe(n){switch(n.type){case"signInViaRedirect":case"linkViaRedirect":case"reauthViaRedirect":return!0;case"unknown":return wse(n);default:return!1}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function jFe(n,e={}){return um(n,"GET","/v1/projects",e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const FFe=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,BFe=/^https?/;async function zFe(n){if(n.config.emulator)return;const{authorizedDomains:e}=await jFe(n);for(const i of e)try{if(WFe(i))return}catch{}Sh(n,"unauthorized-domain")}function WFe(n){const e=R5(),{protocol:i,hostname:o}=new URL(e);if(n.startsWith("chrome-extension://")){const p=new URL(n);return p.hostname===""&&o===""?i==="chrome-extension:"&&n.replace("chrome-extension://","")===e.replace("chrome-extension://",""):i==="chrome-extension:"&&p.hostname===o}if(!BFe.test(i))return!1;if(FFe.test(n))return o===n;const l=n.replace(/\./g,"\\.");return new RegExp("^(.+\\."+l+"|"+l+")$","i").test(o)}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const GFe=new nI(3e4,6e4);function jJ(){const n=Fp().___jsl;if(n!=null&&n.H){for(const e of Object.keys(n.H))if(n.H[e].r=n.H[e].r||[],n.H[e].L=n.H[e].L||[],n.H[e].r=[...n.H[e].L],n.CP)for(let i=0;i<n.CP.length;i++)n.CP[i]=null}}function HFe(n){return new Promise((e,i)=>{var o,l,u;function p(){jJ(),gapi.load("gapi.iframes",{callback:()=>{e(gapi.iframes.getContext())},ontimeout:()=>{jJ(),i(jp(n,"network-request-failed"))},timeout:GFe.get()})}if(!((l=(o=Fp().gapi)===null||o===void 0?void 0:o.iframes)===null||l===void 0)&&l.Iframe)e(gapi.iframes.getContext());else if(!((u=Fp().gapi)===null||u===void 0)&&u.load)p();else{const y=xje("iframefcb");return Fp()[y]=()=>{gapi.load?p():i(jp(n,"network-request-failed"))},sse(`${Nje()}?onload=${y}`).catch(E=>i(E))}}).catch(e=>{throw JO=null,e})}let JO=null;function $Fe(n){return JO=JO||HFe(n),JO}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const KFe=new nI(5e3,15e3),qFe="__/auth/iframe",YFe="emulator/auth/iframe",XFe={style:{position:"absolute",top:"-100px",width:"1px",height:"1px"},"aria-hidden":"true",tabindex:"-1"},JFe=new Map([["identitytoolkit.googleapis.com","p"],["staging-identitytoolkit.sandbox.googleapis.com","s"],["test-identitytoolkit.sandbox.googleapis.com","t"]]);function QFe(n){const e=n.config;Zn(e.authDomain,n,"auth-domain-config-required");const i=e.emulator?HF(e,YFe):`https://${n.config.authDomain}/${qFe}`,o={apiKey:e.apiKey,appName:n.name,v:TE},l=JFe.get(n.config.apiHost);l&&(o.eid=l);const u=n._getFrameworks();return u.length&&(o.fw=u.join(",")),`${i}?${eI(o).slice(1)}`}async function ZFe(n){const e=await $Fe(n),i=Fp().gapi;return Zn(i,n,"internal-error"),e.open({where:document.body,url:QFe(n),messageHandlersFilter:i.iframes.CROSS_ORIGIN_IFRAMES_FILTER,attributes:XFe,dontclear:!0},o=>new Promise(async(l,u)=>{await o.restyle({setHideOnLeave:!1});const p=jp(n,"network-request-failed"),y=Fp().setTimeout(()=>{u(p)},KFe.get());function E(){Fp().clearTimeout(y),l(o)}o.ping(E).then(E,()=>{u(p)})}))}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const e3e={location:"yes",resizable:"yes",statusbar:"yes",toolbar:"no"},t3e=500,n3e=600,r3e="_blank",i3e="http://localhost";class FJ{constructor(e){this.window=e,this.associatedEvent=null}close(){if(this.window)try{this.window.close()}catch{}}}function s3e(n,e,i,o=t3e,l=n3e){const u=Math.max((window.screen.availHeight-l)/2,0).toString(),p=Math.max((window.screen.availWidth-o)/2,0).toString();let y="";const E=Object.assign(Object.assign({},e3e),{width:o.toString(),height:l.toString(),top:u,left:p}),b=gc().toLowerCase();i&&(y=Qie(b)?r3e:i),Xie(b)&&(e=e||i3e,E.scrollbars="yes");const T=Object.entries(E).reduce((O,[L,D])=>`${O}${L}=${D},`,"");if(wje(b)&&y!=="_self")return o3e(e||"",y),new FJ(null);const R=window.open(e||"",y,T);Zn(R,n,"popup-blocked");try{R.focus()}catch{}return new FJ(R)}function o3e(n,e){const i=document.createElement("a");i.href=n,i.target=e;const o=document.createEvent("MouseEvent");o.initMouseEvent("click",!0,!0,window,1,0,0,0,0,!1,!1,!1,!1,1,null),i.dispatchEvent(o)}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const a3e="__/auth/handler",c3e="emulator/auth/handler",l3e=encodeURIComponent("fac");async function BJ(n,e,i,o,l,u){Zn(n.config.authDomain,n,"auth-domain-config-required"),Zn(n.config.apiKey,n,"invalid-api-key");const p={apiKey:n.config.apiKey,appName:n.name,authType:i,redirectUrl:o,v:TE,eventId:l};if(e instanceof lse){e.setDefaultLanguage(n.languageCode),p.providerId=e.providerId||"",HVe(e.getCustomParameters())||(p.customParameters=JSON.stringify(e.getCustomParameters()));for(const[T,R]of Object.entries({}))p[T]=R}if(e instanceof iI){const T=e.getScopes().filter(R=>R!=="");T.length>0&&(p.scopes=T.join(","))}n.tenantId&&(p.tid=n.tenantId);const y=p;for(const T of Object.keys(y))y[T]===void 0&&delete y[T];const E=await n._getAppCheckToken(),b=E?`#${l3e}=${encodeURIComponent(E)}`:"";return`${u3e(n)}?${eI(y).slice(1)}${b}`}function u3e({config:n}){return n.emulator?HF(n,c3e):`https://${n.authDomain}/${a3e}`}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const hV="webStorageSupport";class d3e{constructor(){this.eventManagers={},this.iframes={},this.originValidationPromises={},this._redirectPersistence=_se,this._completeRedirectFn=LFe,this._overrideRedirectResult=NFe}async _openPopup(e,i,o,l){var u;rm((u=this.eventManagers[e._key()])===null||u===void 0?void 0:u.manager,"_initialize() not called before _openPopup()");const p=await BJ(e,i,o,R5(),l);return s3e(e,p,XF())}async _openRedirect(e,i,o,l){await this._originValidation(e);const u=await BJ(e,i,o,R5(),l);return fFe(u),new Promise(()=>{})}_initialize(e){const i=e._key();if(this.eventManagers[i]){const{manager:l,promise:u}=this.eventManagers[i];return l?Promise.resolve(l):(rm(u,"If manager is not set, promise should be"),u)}const o=this.initAndGetManager(e);return this.eventManagers[i]={promise:o},o.catch(()=>{delete this.eventManagers[i]}),o}async initAndGetManager(e){const i=await ZFe(e),o=new UFe(e);return i.register("authEvent",l=>(Zn(l==null?void 0:l.authEvent,e,"invalid-auth-event"),{status:o.onEvent(l.authEvent)?"ACK":"ERROR"}),gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER),this.eventManagers[e._key()]={manager:o},this.iframes[e._key()]=i,o}_isIframeWebStorageSupported(e,i){this.iframes[e._key()].send(hV,{type:hV},l=>{var u;const p=(u=l==null?void 0:l[0])===null||u===void 0?void 0:u[hV];p!==void 0&&i(!!p),Sh(e,"internal-error")},gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER)}_originValidation(e){const i=e._key();return this.originValidationPromises[i]||(this.originValidationPromises[i]=zFe(e)),this.originValidationPromises[i]}get _shouldInitProactively(){return rse()||Jie()||KF()}}const h3e=d3e;var zJ="@firebase/auth",WJ="1.10.8";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class p3e{constructor(e){this.auth=e,this.internalListeners=new Map}getUid(){var e;return this.assertAuthConfigured(),((e=this.auth.currentUser)===null||e===void 0?void 0:e.uid)||null}async getToken(e){return this.assertAuthConfigured(),await this.auth._initializationPromise,this.auth.currentUser?{accessToken:await this.auth.currentUser.getIdToken(e)}:null}addAuthTokenListener(e){if(this.assertAuthConfigured(),this.internalListeners.has(e))return;const i=this.auth.onIdTokenChanged(o=>{e((o==null?void 0:o.stsTokenManager.accessToken)||null)});this.internalListeners.set(e,i),this.updateProactiveRefresh()}removeAuthTokenListener(e){this.assertAuthConfigured();const i=this.internalListeners.get(e);i&&(this.internalListeners.delete(e),i(),this.updateProactiveRefresh())}assertAuthConfigured(){Zn(this.auth._initializationPromise,"dependent-sdk-initialized-before-auth")}updateProactiveRefresh(){this.internalListeners.size>0?this.auth._startProactiveRefresh():this.auth._stopProactiveRefresh()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function f3e(n){switch(n){case"Node":return"node";case"ReactNative":return"rn";case"Worker":return"webworker";case"Cordova":return"cordova";case"WebExtension":return"web-extension";default:return}}function m3e(n){zg(new tm("auth",(e,{options:i})=>{const o=e.getProvider("app").getImmediate(),l=e.getProvider("heartbeat"),u=e.getProvider("app-check-internal"),{apiKey:p,authDomain:y}=o.options;Zn(p&&!p.includes(":"),"invalid-api-key",{appName:o.name});const E={apiKey:p,authDomain:y,clientPlatform:n,apiHost:"identitytoolkit.googleapis.com",tokenApiHost:"securetoken.googleapis.com",apiScheme:"https",sdkClientVersion:ise(n)},b=new Pje(o,l,u,E);return jje(b,i),b},"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((e,i,o)=>{e.getProvider("auth-internal").initialize()})),zg(new tm("auth-internal",e=>{const i=e_(e.getProvider("auth").getImmediate());return(o=>new p3e(o))(i)},"PRIVATE").setInstantiationMode("EXPLICIT")),md(zJ,WJ,f3e(n)),md(zJ,WJ,"esm2017")}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const g3e=300,_3e=Lie("authIdTokenMaxAge")||g3e;let GJ=null;const y3e=n=>async e=>{const i=e&&await e.getIdTokenResult(),o=i&&(new Date().getTime()-Date.parse(i.issuedAtTime))/1e3;if(o&&o>_3e)return;const l=i==null?void 0:i.token;GJ!==l&&(GJ=l,await fetch(n,{method:l?"POST":"DELETE",headers:l?{Authorization:`Bearer ${l}`}:{}}))};function qS(n=xN()){const e=tI(n,"auth");if(e.isInitialized())return e.getImmediate();const i=Vje(n,{popupRedirectResolver:h3e,persistence:[wFe,dFe,_se]}),o=Lie("authTokenSyncURL");if(o&&typeof isSecureContext=="boolean"&&isSecureContext){const u=new URL(o,location.origin);if(location.origin===u.origin){const p=y3e(u.toString());oFe(i,p,()=>p(i.currentUser)),sFe(i,y=>p(y))}}const l=xie("auth");return l&&Fje(i,`http://${l}`),i}function E3e(){var n,e;return(e=(n=document.getElementsByTagName("head"))===null||n===void 0?void 0:n[0])!==null&&e!==void 0?e:document}Oje({loadJS(n){return new Promise((e,i)=>{const o=document.createElement("script");o.setAttribute("src",n),o.onload=e,o.onerror=l=>{const u=jp("internal-error");u.customData=l,i(u)},o.type="text/javascript",o.charset="UTF-8",E3e().appendChild(o)})},gapiScript:"https://apis.google.com/js/api.js",recaptchaV2Script:"https://www.google.com/recaptcha/api.js",recaptchaEnterpriseScript:"https://www.google.com/recaptcha/enterprise.js?render="});m3e("Browser");var HJ=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};/** @license
Copyright The Closure Library Authors.
SPDX-License-Identifier: Apache-2.0
*/var Ug,Tse;(function(){var n;/** @license

 Copyright The Closure Library Authors.
 SPDX-License-Identifier: Apache-2.0
*/function e(q,J){function Q(){}Q.prototype=J.prototype,q.D=J.prototype,q.prototype=new Q,q.prototype.constructor=q,q.C=function(ne,he,de){for(var pe=Array(arguments.length-2),Se=2;Se<arguments.length;Se++)pe[Se-2]=arguments[Se];return J.prototype[he].apply(ne,pe)}}function i(){this.blockSize=-1}function o(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.B=Array(this.blockSize),this.o=this.h=0,this.s()}e(o,i),o.prototype.s=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.o=this.h=0};function l(q,J,Q){Q||(Q=0);var ne=Array(16);if(typeof J=="string")for(var he=0;16>he;++he)ne[he]=J.charCodeAt(Q++)|J.charCodeAt(Q++)<<8|J.charCodeAt(Q++)<<16|J.charCodeAt(Q++)<<24;else for(he=0;16>he;++he)ne[he]=J[Q++]|J[Q++]<<8|J[Q++]<<16|J[Q++]<<24;J=q.g[0],Q=q.g[1],he=q.g[2];var de=q.g[3],pe=J+(de^Q&(he^de))+ne[0]+3614090360&4294967295;J=Q+(pe<<7&4294967295|pe>>>25),pe=de+(he^J&(Q^he))+ne[1]+3905402710&4294967295,de=J+(pe<<12&4294967295|pe>>>20),pe=he+(Q^de&(J^Q))+ne[2]+606105819&4294967295,he=de+(pe<<17&4294967295|pe>>>15),pe=Q+(J^he&(de^J))+ne[3]+3250441966&4294967295,Q=he+(pe<<22&4294967295|pe>>>10),pe=J+(de^Q&(he^de))+ne[4]+4118548399&4294967295,J=Q+(pe<<7&4294967295|pe>>>25),pe=de+(he^J&(Q^he))+ne[5]+1200080426&4294967295,de=J+(pe<<12&4294967295|pe>>>20),pe=he+(Q^de&(J^Q))+ne[6]+2821735955&4294967295,he=de+(pe<<17&4294967295|pe>>>15),pe=Q+(J^he&(de^J))+ne[7]+4249261313&4294967295,Q=he+(pe<<22&4294967295|pe>>>10),pe=J+(de^Q&(he^de))+ne[8]+1770035416&4294967295,J=Q+(pe<<7&4294967295|pe>>>25),pe=de+(he^J&(Q^he))+ne[9]+2336552879&4294967295,de=J+(pe<<12&4294967295|pe>>>20),pe=he+(Q^de&(J^Q))+ne[10]+4294925233&4294967295,he=de+(pe<<17&4294967295|pe>>>15),pe=Q+(J^he&(de^J))+ne[11]+2304563134&4294967295,Q=he+(pe<<22&4294967295|pe>>>10),pe=J+(de^Q&(he^de))+ne[12]+1804603682&4294967295,J=Q+(pe<<7&4294967295|pe>>>25),pe=de+(he^J&(Q^he))+ne[13]+4254626195&4294967295,de=J+(pe<<12&4294967295|pe>>>20),pe=he+(Q^de&(J^Q))+ne[14]+2792965006&4294967295,he=de+(pe<<17&4294967295|pe>>>15),pe=Q+(J^he&(de^J))+ne[15]+1236535329&4294967295,Q=he+(pe<<22&4294967295|pe>>>10),pe=J+(he^de&(Q^he))+ne[1]+4129170786&4294967295,J=Q+(pe<<5&4294967295|pe>>>27),pe=de+(Q^he&(J^Q))+ne[6]+3225465664&4294967295,de=J+(pe<<9&4294967295|pe>>>23),pe=he+(J^Q&(de^J))+ne[11]+643717713&4294967295,he=de+(pe<<14&4294967295|pe>>>18),pe=Q+(de^J&(he^de))+ne[0]+3921069994&4294967295,Q=he+(pe<<20&4294967295|pe>>>12),pe=J+(he^de&(Q^he))+ne[5]+3593408605&4294967295,J=Q+(pe<<5&4294967295|pe>>>27),pe=de+(Q^he&(J^Q))+ne[10]+38016083&4294967295,de=J+(pe<<9&4294967295|pe>>>23),pe=he+(J^Q&(de^J))+ne[15]+3634488961&4294967295,he=de+(pe<<14&4294967295|pe>>>18),pe=Q+(de^J&(he^de))+ne[4]+3889429448&4294967295,Q=he+(pe<<20&4294967295|pe>>>12),pe=J+(he^de&(Q^he))+ne[9]+568446438&4294967295,J=Q+(pe<<5&4294967295|pe>>>27),pe=de+(Q^he&(J^Q))+ne[14]+3275163606&4294967295,de=J+(pe<<9&4294967295|pe>>>23),pe=he+(J^Q&(de^J))+ne[3]+4107603335&4294967295,he=de+(pe<<14&4294967295|pe>>>18),pe=Q+(de^J&(he^de))+ne[8]+1163531501&4294967295,Q=he+(pe<<20&4294967295|pe>>>12),pe=J+(he^de&(Q^he))+ne[13]+2850285829&4294967295,J=Q+(pe<<5&4294967295|pe>>>27),pe=de+(Q^he&(J^Q))+ne[2]+4243563512&4294967295,de=J+(pe<<9&4294967295|pe>>>23),pe=he+(J^Q&(de^J))+ne[7]+1735328473&4294967295,he=de+(pe<<14&4294967295|pe>>>18),pe=Q+(de^J&(he^de))+ne[12]+2368359562&4294967295,Q=he+(pe<<20&4294967295|pe>>>12),pe=J+(Q^he^de)+ne[5]+4294588738&4294967295,J=Q+(pe<<4&4294967295|pe>>>28),pe=de+(J^Q^he)+ne[8]+2272392833&4294967295,de=J+(pe<<11&4294967295|pe>>>21),pe=he+(de^J^Q)+ne[11]+1839030562&4294967295,he=de+(pe<<16&4294967295|pe>>>16),pe=Q+(he^de^J)+ne[14]+4259657740&4294967295,Q=he+(pe<<23&4294967295|pe>>>9),pe=J+(Q^he^de)+ne[1]+2763975236&4294967295,J=Q+(pe<<4&4294967295|pe>>>28),pe=de+(J^Q^he)+ne[4]+1272893353&4294967295,de=J+(pe<<11&4294967295|pe>>>21),pe=he+(de^J^Q)+ne[7]+4139469664&4294967295,he=de+(pe<<16&4294967295|pe>>>16),pe=Q+(he^de^J)+ne[10]+3200236656&4294967295,Q=he+(pe<<23&4294967295|pe>>>9),pe=J+(Q^he^de)+ne[13]+681279174&4294967295,J=Q+(pe<<4&4294967295|pe>>>28),pe=de+(J^Q^he)+ne[0]+3936430074&4294967295,de=J+(pe<<11&4294967295|pe>>>21),pe=he+(de^J^Q)+ne[3]+3572445317&4294967295,he=de+(pe<<16&4294967295|pe>>>16),pe=Q+(he^de^J)+ne[6]+76029189&4294967295,Q=he+(pe<<23&4294967295|pe>>>9),pe=J+(Q^he^de)+ne[9]+3654602809&4294967295,J=Q+(pe<<4&4294967295|pe>>>28),pe=de+(J^Q^he)+ne[12]+3873151461&4294967295,de=J+(pe<<11&4294967295|pe>>>21),pe=he+(de^J^Q)+ne[15]+530742520&4294967295,he=de+(pe<<16&4294967295|pe>>>16),pe=Q+(he^de^J)+ne[2]+3299628645&4294967295,Q=he+(pe<<23&4294967295|pe>>>9),pe=J+(he^(Q|~de))+ne[0]+4096336452&4294967295,J=Q+(pe<<6&4294967295|pe>>>26),pe=de+(Q^(J|~he))+ne[7]+1126891415&4294967295,de=J+(pe<<10&4294967295|pe>>>22),pe=he+(J^(de|~Q))+ne[14]+2878612391&4294967295,he=de+(pe<<15&4294967295|pe>>>17),pe=Q+(de^(he|~J))+ne[5]+4237533241&4294967295,Q=he+(pe<<21&4294967295|pe>>>11),pe=J+(he^(Q|~de))+ne[12]+1700485571&4294967295,J=Q+(pe<<6&4294967295|pe>>>26),pe=de+(Q^(J|~he))+ne[3]+2399980690&4294967295,de=J+(pe<<10&4294967295|pe>>>22),pe=he+(J^(de|~Q))+ne[10]+4293915773&4294967295,he=de+(pe<<15&4294967295|pe>>>17),pe=Q+(de^(he|~J))+ne[1]+2240044497&4294967295,Q=he+(pe<<21&4294967295|pe>>>11),pe=J+(he^(Q|~de))+ne[8]+1873313359&4294967295,J=Q+(pe<<6&4294967295|pe>>>26),pe=de+(Q^(J|~he))+ne[15]+4264355552&4294967295,de=J+(pe<<10&4294967295|pe>>>22),pe=he+(J^(de|~Q))+ne[6]+2734768916&4294967295,he=de+(pe<<15&4294967295|pe>>>17),pe=Q+(de^(he|~J))+ne[13]+1309151649&4294967295,Q=he+(pe<<21&4294967295|pe>>>11),pe=J+(he^(Q|~de))+ne[4]+4149444226&4294967295,J=Q+(pe<<6&4294967295|pe>>>26),pe=de+(Q^(J|~he))+ne[11]+3174756917&4294967295,de=J+(pe<<10&4294967295|pe>>>22),pe=he+(J^(de|~Q))+ne[2]+718787259&4294967295,he=de+(pe<<15&4294967295|pe>>>17),pe=Q+(de^(he|~J))+ne[9]+3951481745&4294967295,q.g[0]=q.g[0]+J&4294967295,q.g[1]=q.g[1]+(he+(pe<<21&4294967295|pe>>>11))&4294967295,q.g[2]=q.g[2]+he&4294967295,q.g[3]=q.g[3]+de&4294967295}o.prototype.u=function(q,J){J===void 0&&(J=q.length);for(var Q=J-this.blockSize,ne=this.B,he=this.h,de=0;de<J;){if(he==0)for(;de<=Q;)l(this,q,de),de+=this.blockSize;if(typeof q=="string"){for(;de<J;)if(ne[he++]=q.charCodeAt(de++),he==this.blockSize){l(this,ne),he=0;break}}else for(;de<J;)if(ne[he++]=q[de++],he==this.blockSize){l(this,ne),he=0;break}}this.h=he,this.o+=J},o.prototype.v=function(){var q=Array((56>this.h?this.blockSize:2*this.blockSize)-this.h);q[0]=128;for(var J=1;J<q.length-8;++J)q[J]=0;var Q=8*this.o;for(J=q.length-8;J<q.length;++J)q[J]=Q&255,Q/=256;for(this.u(q),q=Array(16),J=Q=0;4>J;++J)for(var ne=0;32>ne;ne+=8)q[Q++]=this.g[J]>>>ne&255;return q};function u(q,J){var Q=y;return Object.prototype.hasOwnProperty.call(Q,q)?Q[q]:Q[q]=J(q)}function p(q,J){this.h=J;for(var Q=[],ne=!0,he=q.length-1;0<=he;he--){var de=q[he]|0;ne&&de==J||(Q[he]=de,ne=!1)}this.g=Q}var y={};function E(q){return-128<=q&&128>q?u(q,function(J){return new p([J|0],0>J?-1:0)}):new p([q|0],0>q?-1:0)}function b(q){if(isNaN(q)||!isFinite(q))return R;if(0>q)return F(b(-q));for(var J=[],Q=1,ne=0;q>=Q;ne++)J[ne]=q/Q|0,Q*=4294967296;return new p(J,0)}function T(q,J){if(q.length==0)throw Error("number format error: empty string");if(J=J||10,2>J||36<J)throw Error("radix out of range: "+J);if(q.charAt(0)=="-")return F(T(q.substring(1),J));if(0<=q.indexOf("-"))throw Error('number format error: interior "-" character');for(var Q=b(Math.pow(J,8)),ne=R,he=0;he<q.length;he+=8){var de=Math.min(8,q.length-he),pe=parseInt(q.substring(he,he+de),J);8>de?(de=b(Math.pow(J,de)),ne=ne.j(de).add(b(pe))):(ne=ne.j(Q),ne=ne.add(b(pe)))}return ne}var R=E(0),O=E(1),L=E(16777216);n=p.prototype,n.m=function(){if(U(this))return-F(this).m();for(var q=0,J=1,Q=0;Q<this.g.length;Q++){var ne=this.i(Q);q+=(0<=ne?ne:4294967296+ne)*J,J*=4294967296}return q},n.toString=function(q){if(q=q||10,2>q||36<q)throw Error("radix out of range: "+q);if(D(this))return"0";if(U(this))return"-"+F(this).toString(q);for(var J=b(Math.pow(q,6)),Q=this,ne="";;){var he=le(Q,J).g;Q=Y(Q,he.j(J));var de=((0<Q.g.length?Q.g[0]:Q.h)>>>0).toString(q);if(Q=he,D(Q))return de+ne;for(;6>de.length;)de="0"+de;ne=de+ne}},n.i=function(q){return 0>q?0:q<this.g.length?this.g[q]:this.h};function D(q){if(q.h!=0)return!1;for(var J=0;J<q.g.length;J++)if(q.g[J]!=0)return!1;return!0}function U(q){return q.h==-1}n.l=function(q){return q=Y(this,q),U(q)?-1:D(q)?0:1};function F(q){for(var J=q.g.length,Q=[],ne=0;ne<J;ne++)Q[ne]=~q.g[ne];return new p(Q,~q.h).add(O)}n.abs=function(){return U(this)?F(this):this},n.add=function(q){for(var J=Math.max(this.g.length,q.g.length),Q=[],ne=0,he=0;he<=J;he++){var de=ne+(this.i(he)&65535)+(q.i(he)&65535),pe=(de>>>16)+(this.i(he)>>>16)+(q.i(he)>>>16);ne=pe>>>16,de&=65535,pe&=65535,Q[he]=pe<<16|de}return new p(Q,Q[Q.length-1]&-2147483648?-1:0)};function Y(q,J){return q.add(F(J))}n.j=function(q){if(D(this)||D(q))return R;if(U(this))return U(q)?F(this).j(F(q)):F(F(this).j(q));if(U(q))return F(this.j(F(q)));if(0>this.l(L)&&0>q.l(L))return b(this.m()*q.m());for(var J=this.g.length+q.g.length,Q=[],ne=0;ne<2*J;ne++)Q[ne]=0;for(ne=0;ne<this.g.length;ne++)for(var he=0;he<q.g.length;he++){var de=this.i(ne)>>>16,pe=this.i(ne)&65535,Se=q.i(he)>>>16,Ie=q.i(he)&65535;Q[2*ne+2*he]+=pe*Ie,W(Q,2*ne+2*he),Q[2*ne+2*he+1]+=de*Ie,W(Q,2*ne+2*he+1),Q[2*ne+2*he+1]+=pe*Se,W(Q,2*ne+2*he+1),Q[2*ne+2*he+2]+=de*Se,W(Q,2*ne+2*he+2)}for(ne=0;ne<J;ne++)Q[ne]=Q[2*ne+1]<<16|Q[2*ne];for(ne=J;ne<2*J;ne++)Q[ne]=0;return new p(Q,0)};function W(q,J){for(;(q[J]&65535)!=q[J];)q[J+1]+=q[J]>>>16,q[J]&=65535,J++}function re(q,J){this.g=q,this.h=J}function le(q,J){if(D(J))throw Error("division by zero");if(D(q))return new re(R,R);if(U(q))return J=le(F(q),J),new re(F(J.g),F(J.h));if(U(J))return J=le(q,F(J)),new re(F(J.g),J.h);if(30<q.g.length){if(U(q)||U(J))throw Error("slowDivide_ only works with positive integers.");for(var Q=O,ne=J;0>=ne.l(q);)Q=ie(Q),ne=ie(ne);var he=me(Q,1),de=me(ne,1);for(ne=me(ne,2),Q=me(Q,2);!D(ne);){var pe=de.add(ne);0>=pe.l(q)&&(he=he.add(Q),de=pe),ne=me(ne,1),Q=me(Q,1)}return J=Y(q,he.j(J)),new re(he,J)}for(he=R;0<=q.l(J);){for(Q=Math.max(1,Math.floor(q.m()/J.m())),ne=Math.ceil(Math.log(Q)/Math.LN2),ne=48>=ne?1:Math.pow(2,ne-48),de=b(Q),pe=de.j(J);U(pe)||0<pe.l(q);)Q-=ne,de=b(Q),pe=de.j(J);D(de)&&(de=O),he=he.add(de),q=Y(q,pe)}return new re(he,q)}n.A=function(q){return le(this,q).h},n.and=function(q){for(var J=Math.max(this.g.length,q.g.length),Q=[],ne=0;ne<J;ne++)Q[ne]=this.i(ne)&q.i(ne);return new p(Q,this.h&q.h)},n.or=function(q){for(var J=Math.max(this.g.length,q.g.length),Q=[],ne=0;ne<J;ne++)Q[ne]=this.i(ne)|q.i(ne);return new p(Q,this.h|q.h)},n.xor=function(q){for(var J=Math.max(this.g.length,q.g.length),Q=[],ne=0;ne<J;ne++)Q[ne]=this.i(ne)^q.i(ne);return new p(Q,this.h^q.h)};function ie(q){for(var J=q.g.length+1,Q=[],ne=0;ne<J;ne++)Q[ne]=q.i(ne)<<1|q.i(ne-1)>>>31;return new p(Q,q.h)}function me(q,J){var Q=J>>5;J%=32;for(var ne=q.g.length-Q,he=[],de=0;de<ne;de++)he[de]=0<J?q.i(de+Q)>>>J|q.i(de+Q+1)<<32-J:q.i(de+Q);return new p(he,q.h)}o.prototype.digest=o.prototype.v,o.prototype.reset=o.prototype.s,o.prototype.update=o.prototype.u,Tse=o,p.prototype.add=p.prototype.add,p.prototype.multiply=p.prototype.j,p.prototype.modulo=p.prototype.A,p.prototype.compare=p.prototype.l,p.prototype.toNumber=p.prototype.m,p.prototype.toString=p.prototype.toString,p.prototype.getBits=p.prototype.i,p.fromNumber=b,p.fromString=T,Ug=p}).apply(typeof HJ<"u"?HJ:typeof self<"u"?self:typeof window<"u"?window:{});var gO=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};/** @license
Copyright The Closure Library Authors.
SPDX-License-Identifier: Apache-2.0
*/var Cse,OC,Rse,QO,P5,Ise,Ase,Pse;(function(){var n,e=typeof Object.defineProperties=="function"?Object.defineProperty:function(P,$,se){return P==Array.prototype||P==Object.prototype||(P[$]=se.value),P};function i(P){P=[typeof globalThis=="object"&&globalThis,P,typeof window=="object"&&window,typeof self=="object"&&self,typeof gO=="object"&&gO];for(var $=0;$<P.length;++$){var se=P[$];if(se&&se.Math==Math)return se}throw Error("Cannot find global object")}var o=i(this);function l(P,$){if($)e:{var se=o;P=P.split(".");for(var Ee=0;Ee<P.length-1;Ee++){var Ye=P[Ee];if(!(Ye in se))break e;se=se[Ye]}P=P[P.length-1],Ee=se[P],$=$(Ee),$!=Ee&&$!=null&&e(se,P,{configurable:!0,writable:!0,value:$})}}function u(P,$){P instanceof String&&(P+="");var se=0,Ee=!1,Ye={next:function(){if(!Ee&&se<P.length){var ht=se++;return{value:$(ht,P[ht]),done:!1}}return Ee=!0,{done:!0,value:void 0}}};return Ye[Symbol.iterator]=function(){return Ye},Ye}l("Array.prototype.values",function(P){return P||function(){return u(this,function($,se){return se})}});/** @license

 Copyright The Closure Library Authors.
 SPDX-License-Identifier: Apache-2.0
*/var p=p||{},y=this||self;function E(P){var $=typeof P;return $=$!="object"?$:P?Array.isArray(P)?"array":$:"null",$=="array"||$=="object"&&typeof P.length=="number"}function b(P){var $=typeof P;return $=="object"&&P!=null||$=="function"}function T(P,$,se){return P.call.apply(P.bind,arguments)}function R(P,$,se){if(!P)throw Error();if(2<arguments.length){var Ee=Array.prototype.slice.call(arguments,2);return function(){var Ye=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(Ye,Ee),P.apply($,Ye)}}return function(){return P.apply($,arguments)}}function O(P,$,se){return O=Function.prototype.bind&&Function.prototype.bind.toString().indexOf("native code")!=-1?T:R,O.apply(null,arguments)}function L(P,$){var se=Array.prototype.slice.call(arguments,1);return function(){var Ee=se.slice();return Ee.push.apply(Ee,arguments),P.apply(this,Ee)}}function D(P,$){function se(){}se.prototype=$.prototype,P.aa=$.prototype,P.prototype=new se,P.prototype.constructor=P,P.Qb=function(Ee,Ye,ht){for(var $t=Array(arguments.length-2),ci=2;ci<arguments.length;ci++)$t[ci-2]=arguments[ci];return $.prototype[Ye].apply(Ee,$t)}}function U(P){const $=P.length;if(0<$){const se=Array($);for(let Ee=0;Ee<$;Ee++)se[Ee]=P[Ee];return se}return[]}function F(P,$){for(let se=1;se<arguments.length;se++){const Ee=arguments[se];if(E(Ee)){const Ye=P.length||0,ht=Ee.length||0;P.length=Ye+ht;for(let $t=0;$t<ht;$t++)P[Ye+$t]=Ee[$t]}else P.push(Ee)}}class Y{constructor($,se){this.i=$,this.j=se,this.h=0,this.g=null}get(){let $;return 0<this.h?(this.h--,$=this.g,this.g=$.next,$.next=null):$=this.i(),$}}function W(P){return/^[\s\xa0]*$/.test(P)}function re(){var P=y.navigator;return P&&(P=P.userAgent)?P:""}function le(P){return le[" "](P),P}le[" "]=function(){};var ie=re().indexOf("Gecko")!=-1&&!(re().toLowerCase().indexOf("webkit")!=-1&&re().indexOf("Edge")==-1)&&!(re().indexOf("Trident")!=-1||re().indexOf("MSIE")!=-1)&&re().indexOf("Edge")==-1;function me(P,$,se){for(const Ee in P)$.call(se,P[Ee],Ee,P)}function q(P,$){for(const se in P)$.call(void 0,P[se],se,P)}function J(P){const $={};for(const se in P)$[se]=P[se];return $}const Q="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function ne(P,$){let se,Ee;for(let Ye=1;Ye<arguments.length;Ye++){Ee=arguments[Ye];for(se in Ee)P[se]=Ee[se];for(let ht=0;ht<Q.length;ht++)se=Q[ht],Object.prototype.hasOwnProperty.call(Ee,se)&&(P[se]=Ee[se])}}function he(P){var $=1;P=P.split(":");const se=[];for(;0<$&&P.length;)se.push(P.shift()),$--;return P.length&&se.push(P.join(":")),se}function de(P){y.setTimeout(()=>{throw P},0)}function pe(){var P=Te;let $=null;return P.g&&($=P.g,P.g=P.g.next,P.g||(P.h=null),$.next=null),$}class Se{constructor(){this.h=this.g=null}add($,se){const Ee=Ie.get();Ee.set($,se),this.h?this.h.next=Ee:this.g=Ee,this.h=Ee}}var Ie=new Y(()=>new Fe,P=>P.reset());class Fe{constructor(){this.next=this.g=this.h=null}set($,se){this.h=$,this.g=se,this.next=null}reset(){this.next=this.g=this.h=null}}let we,Re=!1,Te=new Se,Ne=()=>{const P=y.Promise.resolve(void 0);we=()=>{P.then(be)}};var be=()=>{for(var P;P=pe();){try{P.h.call(P.g)}catch(se){de(se)}var $=Ie;$.j(P),100>$.h&&($.h++,P.next=$.g,$.g=P)}Re=!1};function xe(){this.s=this.s,this.C=this.C}xe.prototype.s=!1,xe.prototype.ma=function(){this.s||(this.s=!0,this.N())},xe.prototype.N=function(){if(this.C)for(;this.C.length;)this.C.shift()()};function je(P,$){this.type=P,this.g=this.target=$,this.defaultPrevented=!1}je.prototype.h=function(){this.defaultPrevented=!0};var nt=(function(){if(!y.addEventListener||!Object.defineProperty)return!1;var P=!1,$=Object.defineProperty({},"passive",{get:function(){P=!0}});try{const se=()=>{};y.addEventListener("test",se,$),y.removeEventListener("test",se,$)}catch{}return P})();function dt(P,$){if(je.call(this,P?P.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,P){var se=this.type=P.type,Ee=P.changedTouches&&P.changedTouches.length?P.changedTouches[0]:null;if(this.target=P.target||P.srcElement,this.g=$,$=P.relatedTarget){if(ie){e:{try{le($.nodeName);var Ye=!0;break e}catch{}Ye=!1}Ye||($=null)}}else se=="mouseover"?$=P.fromElement:se=="mouseout"&&($=P.toElement);this.relatedTarget=$,Ee?(this.clientX=Ee.clientX!==void 0?Ee.clientX:Ee.pageX,this.clientY=Ee.clientY!==void 0?Ee.clientY:Ee.pageY,this.screenX=Ee.screenX||0,this.screenY=Ee.screenY||0):(this.clientX=P.clientX!==void 0?P.clientX:P.pageX,this.clientY=P.clientY!==void 0?P.clientY:P.pageY,this.screenX=P.screenX||0,this.screenY=P.screenY||0),this.button=P.button,this.key=P.key||"",this.ctrlKey=P.ctrlKey,this.altKey=P.altKey,this.shiftKey=P.shiftKey,this.metaKey=P.metaKey,this.pointerId=P.pointerId||0,this.pointerType=typeof P.pointerType=="string"?P.pointerType:ft[P.pointerType]||"",this.state=P.state,this.i=P,P.defaultPrevented&&dt.aa.h.call(this)}}D(dt,je);var ft={2:"touch",3:"pen",4:"mouse"};dt.prototype.h=function(){dt.aa.h.call(this);var P=this.i;P.preventDefault?P.preventDefault():P.returnValue=!1};var lt="closure_listenable_"+(1e6*Math.random()|0),gt=0;function at(P,$,se,Ee,Ye){this.listener=P,this.proxy=null,this.src=$,this.type=se,this.capture=!!Ee,this.ha=Ye,this.key=++gt,this.da=this.fa=!1}function Ct(P){P.da=!0,P.listener=null,P.proxy=null,P.src=null,P.ha=null}function En(P){this.src=P,this.g={},this.h=0}En.prototype.add=function(P,$,se,Ee,Ye){var ht=P.toString();P=this.g[ht],P||(P=this.g[ht]=[],this.h++);var $t=Jt(P,$,Ee,Ye);return-1<$t?($=P[$t],se||($.fa=!1)):($=new at($,this.src,ht,!!Ee,Ye),$.fa=se,P.push($)),$};function Gt(P,$){var se=$.type;if(se in P.g){var Ee=P.g[se],Ye=Array.prototype.indexOf.call(Ee,$,void 0),ht;(ht=0<=Ye)&&Array.prototype.splice.call(Ee,Ye,1),ht&&(Ct($),P.g[se].length==0&&(delete P.g[se],P.h--))}}function Jt(P,$,se,Ee){for(var Ye=0;Ye<P.length;++Ye){var ht=P[Ye];if(!ht.da&&ht.listener==$&&ht.capture==!!se&&ht.ha==Ee)return Ye}return-1}var st="closure_lm_"+(1e6*Math.random()|0),hn={};function an(P,$,se,Ee,Ye){if(Array.isArray($)){for(var ht=0;ht<$.length;ht++)an(P,$[ht],se,Ee,Ye);return null}return se=Pt(se),P&&P[lt]?P.K($,se,b(Ee)?!!Ee.capture:!1,Ye):Ft(P,$,se,!1,Ee,Ye)}function Ft(P,$,se,Ee,Ye,ht){if(!$)throw Error("Invalid event type");var $t=b(Ye)?!!Ye.capture:!!Ye,ci=Ot(P);if(ci||(P[st]=ci=new En(P)),se=ci.add($,se,Ee,$t,ht),se.proxy)return se;if(Ee=on(),se.proxy=Ee,Ee.src=P,Ee.listener=se,P.addEventListener)nt||(Ye=$t),Ye===void 0&&(Ye=!1),P.addEventListener($.toString(),Ee,Ye);else if(P.attachEvent)P.attachEvent(De($.toString()),Ee);else if(P.addListener&&P.removeListener)P.addListener(Ee);else throw Error("addEventListener and attachEvent are unavailable.");return se}function on(){function P(se){return $.call(P.src,P.listener,se)}const $=qe;return P}function bt(P,$,se,Ee,Ye){if(Array.isArray($))for(var ht=0;ht<$.length;ht++)bt(P,$[ht],se,Ee,Ye);else Ee=b(Ee)?!!Ee.capture:!!Ee,se=Pt(se),P&&P[lt]?(P=P.i,$=String($).toString(),$ in P.g&&(ht=P.g[$],se=Jt(ht,se,Ee,Ye),-1<se&&(Ct(ht[se]),Array.prototype.splice.call(ht,se,1),ht.length==0&&(delete P.g[$],P.h--)))):P&&(P=Ot(P))&&($=P.g[$.toString()],P=-1,$&&(P=Jt($,se,Ee,Ye)),(se=-1<P?$[P]:null)&&ve(se))}function ve(P){if(typeof P!="number"&&P&&!P.da){var $=P.src;if($&&$[lt])Gt($.i,P);else{var se=P.type,Ee=P.proxy;$.removeEventListener?$.removeEventListener(se,Ee,P.capture):$.detachEvent?$.detachEvent(De(se),Ee):$.addListener&&$.removeListener&&$.removeListener(Ee),(se=Ot($))?(Gt(se,P),se.h==0&&(se.src=null,$[st]=null)):Ct(P)}}}function De(P){return P in hn?hn[P]:hn[P]="on"+P}function qe(P,$){if(P.da)P=!0;else{$=new dt($,this);var se=P.listener,Ee=P.ha||P.src;P.fa&&ve(P),P=se.call(Ee,$)}return P}function Ot(P){return P=P[st],P instanceof En?P:null}var vt="__closure_events_fn_"+(1e9*Math.random()>>>0);function Pt(P){return typeof P=="function"?P:(P[vt]||(P[vt]=function($){return P.handleEvent($)}),P[vt])}function Ut(){xe.call(this),this.i=new En(this),this.M=this,this.F=null}D(Ut,xe),Ut.prototype[lt]=!0,Ut.prototype.removeEventListener=function(P,$,se,Ee){bt(this,P,$,se,Ee)};function cn(P,$){var se,Ee=P.F;if(Ee)for(se=[];Ee;Ee=Ee.F)se.push(Ee);if(P=P.M,Ee=$.type||$,typeof $=="string")$=new je($,P);else if($ instanceof je)$.target=$.target||P;else{var Ye=$;$=new je(Ee,P),ne($,Ye)}if(Ye=!0,se)for(var ht=se.length-1;0<=ht;ht--){var $t=$.g=se[ht];Ye=_t($t,Ee,!0,$)&&Ye}if($t=$.g=P,Ye=_t($t,Ee,!0,$)&&Ye,Ye=_t($t,Ee,!1,$)&&Ye,se)for(ht=0;ht<se.length;ht++)$t=$.g=se[ht],Ye=_t($t,Ee,!1,$)&&Ye}Ut.prototype.N=function(){if(Ut.aa.N.call(this),this.i){var P=this.i,$;for($ in P.g){for(var se=P.g[$],Ee=0;Ee<se.length;Ee++)Ct(se[Ee]);delete P.g[$],P.h--}}this.F=null},Ut.prototype.K=function(P,$,se,Ee){return this.i.add(String(P),$,!1,se,Ee)},Ut.prototype.L=function(P,$,se,Ee){return this.i.add(String(P),$,!0,se,Ee)};function _t(P,$,se,Ee){if($=P.i.g[String($)],!$)return!0;$=$.concat();for(var Ye=!0,ht=0;ht<$.length;++ht){var $t=$[ht];if($t&&!$t.da&&$t.capture==se){var ci=$t.listener,eo=$t.ha||$t.src;$t.fa&&Gt(P.i,$t),Ye=ci.call(eo,Ee)!==!1&&Ye}}return Ye&&!Ee.defaultPrevented}function wn(P,$,se){if(typeof P=="function")se&&(P=O(P,se));else if(P&&typeof P.handleEvent=="function")P=O(P.handleEvent,P);else throw Error("Invalid listener argument");return 2147483647<Number($)?-1:y.setTimeout(P,$||0)}function Nt(P){P.g=wn(()=>{P.g=null,P.i&&(P.i=!1,Nt(P))},P.l);const $=P.h;P.h=null,P.m.apply(null,$)}class Ht extends xe{constructor($,se){super(),this.m=$,this.l=se,this.h=null,this.i=!1,this.g=null}j($){this.h=arguments,this.g?this.i=!0:Nt(this)}N(){super.N(),this.g&&(y.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function Ur(P){xe.call(this),this.h=P,this.g={}}D(Ur,xe);var Ri=[];function ri(P){me(P.g,function($,se){this.g.hasOwnProperty(se)&&ve($)},P),P.g={}}Ur.prototype.N=function(){Ur.aa.N.call(this),ri(this)},Ur.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};var zi=y.JSON.stringify,ds=y.JSON.parse,Eo=class{stringify(P){return y.JSON.stringify(P,void 0)}parse(P){return y.JSON.parse(P,void 0)}};function Gr(){}Gr.prototype.h=null;function Mo(P){return P.h||(P.h=P.i())}function Wc(){}var Xr={OPEN:"a",kb:"b",Ja:"c",wb:"d"};function vo(){je.call(this,"d")}D(vo,je);function Js(){je.call(this,"c")}D(Js,je);var ns={},Gc=null;function So(){return Gc=Gc||new Ut}ns.La="serverreachability";function bu(P){je.call(this,ns.La,P)}D(bu,je);function Ga(P){const $=So();cn($,new bu($))}ns.STAT_EVENT="statevent";function Ds(P,$){je.call(this,ns.STAT_EVENT,P),this.stat=$}D(Ds,je);function Kt(P){const $=So();cn($,new Ds($,P))}ns.Ma="timingevent";function Hc(P,$){je.call(this,ns.Ma,P),this.size=$}D(Hc,je);function ta(P,$){if(typeof P!="function")throw Error("Fn must not be null and must be a function");return y.setTimeout(function(){P()},$)}function Ha(){this.g=!0}Ha.prototype.xa=function(){this.g=!1};function $c(P,$,se,Ee,Ye,ht){P.info(function(){if(P.g)if(ht)for(var $t="",ci=ht.split("&"),eo=0;eo<ci.length;eo++){var mr=ci[eo].split("=");if(1<mr.length){var bo=mr[0];mr=mr[1];var Vs=bo.split("_");$t=2<=Vs.length&&Vs[1]=="type"?$t+(bo+"="+mr+"&"):$t+(bo+"=redacted&")}}else $t=null;else $t=ht;return"XMLHTTP REQ ("+Ee+") [attempt "+Ye+"]: "+$+`
`+se+`
`+$t})}function na(P,$,se,Ee,Ye,ht,$t){P.info(function(){return"XMLHTTP RESP ("+Ee+") [ attempt "+Ye+"]: "+$+`
`+se+`
`+ht+" "+$t})}function ra(P,$,se,Ee){P.info(function(){return"XMLHTTP TEXT ("+$+"): "+Ih(P,se)+(Ee?" "+Ee:"")})}function Sd(P,$){P.info(function(){return"TIMEOUT: "+$})}Ha.prototype.info=function(){};function Ih(P,$){if(!P.g)return $;if(!$)return null;try{var se=JSON.parse($);if(se){for(P=0;P<se.length;P++)if(Array.isArray(se[P])){var Ee=se[P];if(!(2>Ee.length)){var Ye=Ee[1];if(Array.isArray(Ye)&&!(1>Ye.length)){var ht=Ye[0];if(ht!="noop"&&ht!="stop"&&ht!="close")for(var $t=1;$t<Ye.length;$t++)Ye[$t]=""}}}}return zi(se)}catch{return $}}var kl={NO_ERROR:0,gb:1,tb:2,sb:3,nb:4,rb:5,ub:6,Ia:7,TIMEOUT:8,xb:9},Ah={lb:"complete",Hb:"success",Ja:"error",Ia:"abort",zb:"ready",Ab:"readystatechange",TIMEOUT:"timeout",vb:"incrementaldata",yb:"progress",ob:"downloadprogress",Pb:"uploadprogress"},Ls;function Nl(){}D(Nl,Gr),Nl.prototype.g=function(){return new XMLHttpRequest},Nl.prototype.i=function(){return{}},Ls=new Nl;function ia(P,$,se,Ee){this.j=P,this.i=$,this.l=se,this.R=Ee||1,this.U=new Ur(this),this.I=45e3,this.H=null,this.o=!1,this.m=this.A=this.v=this.L=this.F=this.S=this.B=null,this.D=[],this.g=null,this.C=0,this.s=this.u=null,this.X=-1,this.J=!1,this.O=0,this.M=null,this.W=this.K=this.T=this.P=!1,this.h=new bd}function bd(){this.i=null,this.g="",this.h=!1}var xl={},Dl={};function Sa(P,$,se){P.L=1,P.v=Tu(di($)),P.m=se,P.P=!0,Ll(P,null)}function Ll(P,$){P.F=Date.now(),Jr(P),P.A=di(P.v);var se=P.A,Ee=P.R;Array.isArray(Ee)||(Ee=[String(Ee)]),Ru(se.i,"t",Ee),P.C=0,se=P.j.J,P.h=new bd,P.g=o_(P.j,se?$:null,!P.m),0<P.O&&(P.M=new Ht(O(P.Y,P,P.g),P.O)),$=P.U,se=P.g,Ee=P.ca;var Ye="readystatechange";Array.isArray(Ye)||(Ye&&(Ri[0]=Ye.toString()),Ye=Ri);for(var ht=0;ht<Ye.length;ht++){var $t=an(se,Ye[ht],Ee||$.handleEvent,!1,$.h||$);if(!$t)break;$.g[$t.key]=$t}$=P.H?J(P.H):{},P.m?(P.u||(P.u="POST"),$["Content-Type"]="application/x-www-form-urlencoded",P.g.ea(P.A,P.u,P.m,$)):(P.u="GET",P.g.ea(P.A,P.u,null,$)),Ga(),$c(P.i,P.u,P.A,P.l,P.R,P.m)}ia.prototype.ca=function(P){P=P.target;const $=this.M;$&&Li(P)==3?$.j():this.Y(P)},ia.prototype.Y=function(P){try{if(P==this.g)e:{const Vs=Li(this.g);var $=this.g.Ba();const Qc=this.g.Z();if(!(3>Vs)&&(Vs!=3||this.g&&(this.h.h||this.g.oa()||Zs(this.g)))){this.J||Vs!=4||$==7||($==8||0>=Qc?Ga(3):Ga(2)),Vr(this);var se=this.g.Z();this.X=se;t:if(Ph(this)){var Ee=Zs(this.g);P="";var Ye=Ee.length,ht=Li(this.g)==4;if(!this.h.i){if(typeof TextDecoder>"u"){sa(this),_c(this);var $t="";break t}this.h.i=new y.TextDecoder}for($=0;$<Ye;$++)this.h.h=!0,P+=this.h.i.decode(Ee[$],{stream:!(ht&&$==Ye-1)});Ee.length=0,this.h.g+=P,this.C=0,$t=this.h.g}else $t=this.g.oa();if(this.o=se==200,na(this.i,this.u,this.A,this.l,this.R,Vs,se),this.o){if(this.T&&!this.K){t:{if(this.g){var ci,eo=this.g;if((ci=eo.g?eo.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!W(ci)){var mr=ci;break t}}mr=null}if(se=mr)ra(this.i,this.l,se,"Initial handshake response via X-HTTP-Initial-Response"),this.K=!0,wd(this,se);else{this.o=!1,this.s=3,Kt(12),sa(this),_c(this);break e}}if(this.P){se=!0;let qa;for(;!this.J&&this.C<$t.length;)if(qa=Qs(this,$t),qa==Dl){Vs==4&&(this.s=4,Kt(14),se=!1),ra(this.i,this.l,null,"[Incomplete Response]");break}else if(qa==xl){this.s=4,Kt(15),ra(this.i,this.l,$t,"[Invalid Chunk]"),se=!1;break}else ra(this.i,this.l,qa,null),wd(this,qa);if(Ph(this)&&this.C!=0&&(this.h.g=this.h.g.slice(this.C),this.C=0),Vs!=4||$t.length!=0||this.h.h||(this.s=1,Kt(16),se=!1),this.o=this.o&&se,!se)ra(this.i,this.l,$t,"[Invalid Chunked Response]"),sa(this),_c(this);else if(0<$t.length&&!this.W){this.W=!0;var bo=this.j;bo.g==this&&bo.ba&&!bo.M&&(bo.j.info("Great, no buffering proxy detected. Bytes received: "+$t.length),s_(bo),bo.M=!0,Kt(11))}}else ra(this.i,this.l,$t,null),wd(this,$t);Vs==4&&sa(this),this.o&&!this.J&&(Vs==4?mm(this.j,this):(this.o=!1,Jr(this)))}else Xc(this.g),se==400&&0<$t.indexOf("Unknown SID")?(this.s=3,Kt(12)):(this.s=0,Kt(13)),sa(this),_c(this)}}}catch{}finally{}};function Ph(P){return P.g?P.u=="GET"&&P.L!=2&&P.j.Ca:!1}function Qs(P,$){var se=P.C,Ee=$.indexOf(`
`,se);return Ee==-1?Dl:(se=Number($.substring(se,Ee)),isNaN(se)?xl:(Ee+=1,Ee+se>$.length?Dl:($=$.slice(Ee,Ee+se),P.C=Ee+se,$)))}ia.prototype.cancel=function(){this.J=!0,sa(this)};function Jr(P){P.S=Date.now()+P.I,Oh(P,P.I)}function Oh(P,$){if(P.B!=null)throw Error("WatchDog timer not null");P.B=ta(O(P.ba,P),$)}function Vr(P){P.B&&(y.clearTimeout(P.B),P.B=null)}ia.prototype.ba=function(){this.B=null;const P=Date.now();0<=P-this.S?(Sd(this.i,this.A),this.L!=2&&(Ga(),Kt(17)),sa(this),this.s=2,_c(this)):Oh(this,this.S-P)};function _c(P){P.j.G==0||P.J||mm(P.j,P)}function sa(P){Vr(P);var $=P.M;$&&typeof $.ma=="function"&&$.ma(),P.M=null,ri(P.U),P.g&&($=P.g,P.g=null,$.abort(),$.ma())}function wd(P,$){try{var se=P.j;if(se.G!=0&&(se.g==P||Ss(se.h,P))){if(!P.K&&Ss(se.h,P)&&se.G==3){try{var Ee=se.Da.g.parse($)}catch{Ee=null}if(Array.isArray(Ee)&&Ee.length==3){var Ye=Ee;if(Ye[0]==0){e:if(!se.u){if(se.g)if(se.g.F+3e3<P.F)fm(se),Sc(se);else break e;Pu(se),Kt(18)}}else se.za=Ye[1],0<se.za-se.T&&37500>Ye[2]&&se.F&&se.v==0&&!se.C&&(se.C=ta(O(se.Za,se),6e3));if(1>=Xi(se.h)&&se.ca){try{se.ca()}catch{}se.ca=void 0}}else Ka(se,11)}else if((P.K||se.g==P)&&fm(se),!W($))for(Ye=se.Da.g.parse($),$=0;$<Ye.length;$++){let mr=Ye[$];if(se.T=mr[0],mr=mr[1],se.G==2)if(mr[0]=="c"){se.K=mr[1],se.ia=mr[2];const bo=mr[3];bo!=null&&(se.la=bo,se.j.info("VER="+se.la));const Vs=mr[4];Vs!=null&&(se.Aa=Vs,se.j.info("SVER="+se.Aa));const Qc=mr[5];Qc!=null&&typeof Qc=="number"&&0<Qc&&(Ee=1.5*Qc,se.L=Ee,se.j.info("backChannelRequestTimeoutMs_="+Ee)),Ee=se;const qa=P.g;if(qa){const Rd=qa.g?qa.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(Rd){var ht=Ee.h;ht.g||Rd.indexOf("spdy")==-1&&Rd.indexOf("quic")==-1&&Rd.indexOf("h2")==-1||(ht.j=ht.l,ht.g=new Set,ht.h&&(Kc(ht,ht.h),ht.h=null))}if(Ee.D){const gm=qa.g?qa.g.getResponseHeader("X-HTTP-Session-Id"):null;gm&&(Ee.ya=gm,hi(Ee.I,Ee.D,gm))}}se.G=3,se.l&&se.l.ua(),se.ba&&(se.R=Date.now()-P.F,se.j.info("Handshake RTT: "+se.R+"ms")),Ee=se;var $t=P;if(Ee.qa=Cd(Ee,Ee.J?Ee.ia:null,Ee.W),$t.K){kh(Ee.h,$t);var ci=$t,eo=Ee.L;eo&&(ci.I=eo),ci.B&&(Vr(ci),Jr(ci)),Ee.g=$t}else bc(Ee);0<se.i.length&&Jc(se)}else mr[0]!="stop"&&mr[0]!="close"||Ka(se,7);else se.G==3&&(mr[0]=="stop"||mr[0]=="close"?mr[0]=="stop"?Ka(se,7):Us(se):mr[0]!="noop"&&se.l&&se.l.ta(mr),se.v=0)}}Ga(4)}catch{}}var Je=class{constructor(P,$){this.g=P,this.map=$}};function qt(P){this.l=P||10,y.PerformanceNavigationTiming?(P=y.performance.getEntriesByType("navigation"),P=0<P.length&&(P[0].nextHopProtocol=="hq"||P[0].nextHopProtocol=="h2")):P=!!(y.chrome&&y.chrome.loadTimes&&y.chrome.loadTimes()&&y.chrome.loadTimes().wasFetchedViaSpdy),this.j=P?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}function qn(P){return P.h?!0:P.g?P.g.size>=P.j:!1}function Xi(P){return P.h?1:P.g?P.g.size:0}function Ss(P,$){return P.h?P.h==$:P.g?P.g.has($):!1}function Kc(P,$){P.g?P.g.add($):P.h=$}function kh(P,$){P.h&&P.h==$?P.h=null:P.g&&P.g.has($)&&P.g.delete($)}qt.prototype.cancel=function(){if(this.i=yc(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&this.g.size!==0){for(const P of this.g.values())P.cancel();this.g.clear()}};function yc(P){if(P.h!=null)return P.i.concat(P.h.D);if(P.g!=null&&P.g.size!==0){let $=P.i;for(const se of P.g.values())$=$.concat(se.D);return $}return U(P.i)}function qc(P){if(P.V&&typeof P.V=="function")return P.V();if(typeof Map<"u"&&P instanceof Map||typeof Set<"u"&&P instanceof Set)return Array.from(P.values());if(typeof P=="string")return P.split("");if(E(P)){for(var $=[],se=P.length,Ee=0;Ee<se;Ee++)$.push(P[Ee]);return $}$=[],se=0;for(Ee in P)$[se++]=P[Ee];return $}function Ml(P){if(P.na&&typeof P.na=="function")return P.na();if(!P.V||typeof P.V!="function"){if(typeof Map<"u"&&P instanceof Map)return Array.from(P.keys());if(!(typeof Set<"u"&&P instanceof Set)){if(E(P)||typeof P=="string"){var $=[];P=P.length;for(var se=0;se<P;se++)$.push(se);return $}$=[],se=0;for(const Ee in P)$[se++]=Ee;return $}}}function Rr(P,$){if(P.forEach&&typeof P.forEach=="function")P.forEach($,void 0);else if(E(P)||typeof P=="string")Array.prototype.forEach.call(P,$,void 0);else for(var se=Ml(P),Ee=qc(P),Ye=Ee.length,ht=0;ht<Ye;ht++)$.call(void 0,Ee[ht],se&&se[ht],P)}var Ul=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function Ec(P,$){if(P){P=P.split("&");for(var se=0;se<P.length;se++){var Ee=P[se].indexOf("="),Ye=null;if(0<=Ee){var ht=P[se].substring(0,Ee);Ye=P[se].substring(Ee+1)}else ht=P[se];$(ht,Ye?decodeURIComponent(Ye.replace(/\+/g," ")):"")}}}function Ji(P){if(this.g=this.o=this.j="",this.s=null,this.m=this.l="",this.h=!1,P instanceof Ji){this.h=P.h,Hr(this,P.j),this.o=P.o,this.g=P.g,Vl(this,P.s),this.l=P.l;var $=P.i,se=new ba;se.i=$.i,$.g&&(se.g=new Map($.g),se.h=$.h),wu(this,se),this.m=P.m}else P&&($=String(P).match(Ul))?(this.h=!1,Hr(this,$[1]||"",!0),this.o=yr($[2]||""),this.g=yr($[3]||"",!0),Vl(this,$[4]),this.l=yr($[5]||"",!0),wu(this,$[6]||"",!0),this.m=yr($[7]||"")):(this.h=!1,this.i=new ba(null,this.h))}Ji.prototype.toString=function(){var P=[],$=this.j;$&&P.push(jl($,xh,!0),":");var se=this.g;return(se||$=="file")&&(P.push("//"),($=this.o)&&P.push(jl($,xh,!0),"@"),P.push(encodeURIComponent(String(se)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),se=this.s,se!=null&&P.push(":",String(se))),(se=this.l)&&(this.g&&se.charAt(0)!="/"&&P.push("/"),P.push(jl(se,se.charAt(0)=="/"?dm:Cu,!0))),(se=this.i.toString())&&P.push("?",se),(se=this.m)&&P.push("#",jl(se,Jp)),P.join("")};function di(P){return new Ji(P)}function Hr(P,$,se){P.j=se?yr($,!0):$,P.j&&(P.j=P.j.replace(/:$/,""))}function Vl(P,$){if($){if($=Number($),isNaN($)||0>$)throw Error("Bad port number "+$);P.s=$}else P.s=null}function wu(P,$,se){$ instanceof ba?(P.i=$,$a(P.i,P.h)):(se||($=jl($,Xp)),P.i=new ba($,P.h))}function hi(P,$,se){P.i.set($,se)}function Tu(P){return hi(P,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),P}function yr(P,$){return P?$?decodeURI(P.replace(/%25/g,"%2525")):decodeURIComponent(P):""}function jl(P,$,se){return typeof P=="string"?(P=encodeURI(P).replace($,Nh),se&&(P=P.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),P):null}function Nh(P){return P=P.charCodeAt(0),"%"+(P>>4&15).toString(16)+(P&15).toString(16)}var xh=/[#\/\?@]/g,Cu=/[#\?:]/g,dm=/[#\?]/g,Xp=/[#\?@]/g,Jp=/#/g;function ba(P,$){this.h=this.g=null,this.i=P||null,this.j=!!$}function bs(P){P.g||(P.g=new Map,P.h=0,P.i&&Ec(P.i,function($,se){P.add(decodeURIComponent($.replace(/\+/g," ")),se)}))}n=ba.prototype,n.add=function(P,$){bs(this),this.i=null,P=Ca(this,P);var se=this.g.get(P);return se||this.g.set(P,se=[]),se.push($),this.h+=1,this};function wa(P,$){bs(P),$=Ca(P,$),P.g.has($)&&(P.i=null,P.h-=P.g.get($).length,P.g.delete($))}function Ta(P,$){return bs(P),$=Ca(P,$),P.g.has($)}n.forEach=function(P,$){bs(this),this.g.forEach(function(se,Ee){se.forEach(function(Ye){P.call($,Ye,Ee,this)},this)},this)},n.na=function(){bs(this);const P=Array.from(this.g.values()),$=Array.from(this.g.keys()),se=[];for(let Ee=0;Ee<$.length;Ee++){const Ye=P[Ee];for(let ht=0;ht<Ye.length;ht++)se.push($[Ee])}return se},n.V=function(P){bs(this);let $=[];if(typeof P=="string")Ta(this,P)&&($=$.concat(this.g.get(Ca(this,P))));else{P=Array.from(this.g.values());for(let se=0;se<P.length;se++)$=$.concat(P[se])}return $},n.set=function(P,$){return bs(this),this.i=null,P=Ca(this,P),Ta(this,P)&&(this.h-=this.g.get(P).length),this.g.set(P,[$]),this.h+=1,this},n.get=function(P,$){return P?(P=this.V(P),0<P.length?String(P[0]):$):$};function Ru(P,$,se){wa(P,$),0<se.length&&(P.i=null,P.g.set(Ca(P,$),U(se)),P.h+=se.length)}n.toString=function(){if(this.i)return this.i;if(!this.g)return"";const P=[],$=Array.from(this.g.keys());for(var se=0;se<$.length;se++){var Ee=$[se];const ht=encodeURIComponent(String(Ee)),$t=this.V(Ee);for(Ee=0;Ee<$t.length;Ee++){var Ye=ht;$t[Ee]!==""&&(Ye+="="+encodeURIComponent(String($t[Ee]))),P.push(Ye)}}return this.i=P.join("&")};function Ca(P,$){return $=String($),P.j&&($=$.toLowerCase()),$}function $a(P,$){$&&!P.j&&(bs(P),P.i=null,P.g.forEach(function(se,Ee){var Ye=Ee.toLowerCase();Ee!=Ye&&(wa(this,Ee),Ru(this,Ye,se))},P)),P.j=$}function Qp(P,$){const se=new Ha;if(y.Image){const Ee=new Image;Ee.onload=L(Ms,se,"TestLoadImage: loaded",!0,$,Ee),Ee.onerror=L(Ms,se,"TestLoadImage: error",!1,$,Ee),Ee.onabort=L(Ms,se,"TestLoadImage: abort",!1,$,Ee),Ee.ontimeout=L(Ms,se,"TestLoadImage: timeout",!1,$,Ee),y.setTimeout(function(){Ee.ontimeout&&Ee.ontimeout()},1e4),Ee.src=P}else $(!1)}function Yc(P,$){const se=new Ha,Ee=new AbortController,Ye=setTimeout(()=>{Ee.abort(),Ms(se,"TestPingServer: timeout",!1,$)},1e4);fetch(P,{signal:Ee.signal}).then(ht=>{clearTimeout(Ye),ht.ok?Ms(se,"TestPingServer: ok",!0,$):Ms(se,"TestPingServer: server error",!1,$)}).catch(()=>{clearTimeout(Ye),Ms(se,"TestPingServer: error",!1,$)})}function Ms(P,$,se,Ee,Ye){try{Ye&&(Ye.onload=null,Ye.onerror=null,Ye.onabort=null,Ye.ontimeout=null),Ee(se)}catch{}}function r_(){this.g=new Eo}function Fl(P,$,se){const Ee=se||"";try{Rr(P,function(Ye,ht){let $t=Ye;b(Ye)&&($t=zi(Ye)),$.push(Ee+ht+"="+encodeURIComponent($t))})}catch(Ye){throw $.push(Ee+"type="+encodeURIComponent("_badmap")),Ye}}function Bl(P){this.l=P.Ub||null,this.j=P.eb||!1}D(Bl,Gr),Bl.prototype.g=function(){return new Iu(this.l,this.j)},Bl.prototype.i=(function(P){return function(){return P}})({});function Iu(P,$){Ut.call(this),this.D=P,this.o=$,this.m=void 0,this.status=this.readyState=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.u=new Headers,this.h=null,this.B="GET",this.A="",this.g=!1,this.v=this.j=this.l=null}D(Iu,Ut),n=Iu.prototype,n.open=function(P,$){if(this.readyState!=0)throw this.abort(),Error("Error reopening a connection");this.B=P,this.A=$,this.readyState=1,Ra(this)},n.send=function(P){if(this.readyState!=1)throw this.abort(),Error("need to call open() first. ");this.g=!0;const $={headers:this.u,method:this.B,credentials:this.m,cache:void 0};P&&($.body=P),(this.D||y).fetch(new Request(this.A,$)).then(this.Sa.bind(this),this.ga.bind(this))},n.abort=function(){this.response=this.responseText="",this.u=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),1<=this.readyState&&this.g&&this.readyState!=4&&(this.g=!1,vc(this)),this.readyState=0},n.Sa=function(P){if(this.g&&(this.l=P,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=P.headers,this.readyState=2,Ra(this)),this.g&&(this.readyState=3,Ra(this),this.g)))if(this.responseType==="arraybuffer")P.arrayBuffer().then(this.Qa.bind(this),this.ga.bind(this));else if(typeof y.ReadableStream<"u"&&"body"in P){if(this.j=P.body.getReader(),this.o){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.v=new TextDecoder;hm(this)}else P.text().then(this.Ra.bind(this),this.ga.bind(this))};function hm(P){P.j.read().then(P.Pa.bind(P)).catch(P.ga.bind(P))}n.Pa=function(P){if(this.g){if(this.o&&P.value)this.response.push(P.value);else if(!this.o){var $=P.value?P.value:new Uint8Array(0);($=this.v.decode($,{stream:!P.done}))&&(this.response=this.responseText+=$)}P.done?vc(this):Ra(this),this.readyState==3&&hm(this)}},n.Ra=function(P){this.g&&(this.response=this.responseText=P,vc(this))},n.Qa=function(P){this.g&&(this.response=P,vc(this))},n.ga=function(){this.g&&vc(this)};function vc(P){P.readyState=4,P.l=null,P.j=null,P.v=null,Ra(P)}n.setRequestHeader=function(P,$){this.u.append(P,$)},n.getResponseHeader=function(P){return this.h&&this.h.get(P.toLowerCase())||""},n.getAllResponseHeaders=function(){if(!this.h)return"";const P=[],$=this.h.entries();for(var se=$.next();!se.done;)se=se.value,P.push(se[0]+": "+se[1]),se=$.next();return P.join(`\r
`)};function Ra(P){P.onreadystatechange&&P.onreadystatechange.call(P)}Object.defineProperty(Iu.prototype,"withCredentials",{get:function(){return this.m==="include"},set:function(P){this.m=P?"include":"same-origin"}});function zl(P){let $="";return me(P,function(se,Ee){$+=Ee,$+=":",$+=se,$+=`\r
`}),$}function Ce(P,$,se){e:{for(Ee in se){var Ee=!1;break e}Ee=!0}Ee||(se=zl(se),typeof P=="string"?se!=null&&encodeURIComponent(String(se)):hi(P,$,se))}function Me(P){Ut.call(this),this.headers=new Map,this.o=P||null,this.h=!1,this.v=this.g=null,this.D="",this.m=0,this.l="",this.j=this.B=this.u=this.A=!1,this.I=null,this.H="",this.J=!1}D(Me,Ut);var ct=/^https?$/i,Yt=["POST","PUT"];n=Me.prototype,n.Ha=function(P){this.J=P},n.ea=function(P,$,se,Ee){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.D+"; newUri="+P);$=$?$.toUpperCase():"GET",this.D=P,this.l="",this.m=0,this.A=!1,this.h=!0,this.g=this.o?this.o.g():Ls.g(),this.v=this.o?Mo(this.o):Mo(Ls),this.g.onreadystatechange=O(this.Ea,this);try{this.B=!0,this.g.open($,String(P),!0),this.B=!1}catch(ht){cr(this,ht);return}if(P=se||"",se=new Map(this.headers),Ee)if(Object.getPrototypeOf(Ee)===Object.prototype)for(var Ye in Ee)se.set(Ye,Ee[Ye]);else if(typeof Ee.keys=="function"&&typeof Ee.get=="function")for(const ht of Ee.keys())se.set(ht,Ee.get(ht));else throw Error("Unknown input type for opt_headers: "+String(Ee));Ee=Array.from(se.keys()).find(ht=>ht.toLowerCase()=="content-type"),Ye=y.FormData&&P instanceof y.FormData,!(0<=Array.prototype.indexOf.call(Yt,$,void 0))||Ee||Ye||se.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(const[ht,$t]of se)this.g.setRequestHeader(ht,$t);this.H&&(this.g.responseType=this.H),"withCredentials"in this.g&&this.g.withCredentials!==this.J&&(this.g.withCredentials=this.J);try{rr(this),this.u=!0,this.g.send(P),this.u=!1}catch(ht){cr(this,ht)}};function cr(P,$){P.h=!1,P.g&&(P.j=!0,P.g.abort(),P.j=!1),P.l=$,P.m=5,jr(P),nr(P)}function jr(P){P.A||(P.A=!0,cn(P,"complete"),cn(P,"error"))}n.abort=function(P){this.g&&this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1,this.m=P||7,cn(this,"complete"),cn(this,"abort"),nr(this))},n.N=function(){this.g&&(this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1),nr(this,!0)),Me.aa.N.call(this)},n.Ea=function(){this.s||(this.B||this.u||this.j?ai(this):this.bb())},n.bb=function(){ai(this)};function ai(P){if(P.h&&typeof p<"u"&&(!P.v[1]||Li(P)!=4||P.Z()!=2)){if(P.u&&Li(P)==4)wn(P.Ea,0,P);else if(cn(P,"readystatechange"),Li(P)==4){P.h=!1;try{const $t=P.Z();e:switch($t){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var $=!0;break e;default:$=!1}var se;if(!(se=$)){var Ee;if(Ee=$t===0){var Ye=String(P.D).match(Ul)[1]||null;!Ye&&y.self&&y.self.location&&(Ye=y.self.location.protocol.slice(0,-1)),Ee=!ct.test(Ye?Ye.toLowerCase():"")}se=Ee}if(se)cn(P,"complete"),cn(P,"success");else{P.m=6;try{var ht=2<Li(P)?P.g.statusText:""}catch{ht=""}P.l=ht+" ["+P.Z()+"]",jr(P)}}finally{nr(P)}}}}function nr(P,$){if(P.g){rr(P);const se=P.g,Ee=P.v[0]?()=>{}:null;P.g=null,P.v=null,$||cn(P,"ready");try{se.onreadystatechange=Ee}catch{}}}function rr(P){P.I&&(y.clearTimeout(P.I),P.I=null)}n.isActive=function(){return!!this.g};function Li(P){return P.g?P.g.readyState:0}n.Z=function(){try{return 2<Li(this)?this.g.status:-1}catch{return-1}},n.oa=function(){try{return this.g?this.g.responseText:""}catch{return""}},n.Oa=function(P){if(this.g){var $=this.g.responseText;return P&&$.indexOf(P)==0&&($=$.substring(P.length)),ds($)}};function Zs(P){try{if(!P.g)return null;if("response"in P.g)return P.g.response;switch(P.H){case"":case"text":return P.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in P.g)return P.g.mozResponseArrayBuffer}return null}catch{return null}}function Xc(P){const $={};P=(P.g&&2<=Li(P)&&P.g.getAllResponseHeaders()||"").split(`\r
`);for(let Ee=0;Ee<P.length;Ee++){if(W(P[Ee]))continue;var se=he(P[Ee]);const Ye=se[0];if(se=se[1],typeof se!="string")continue;se=se.trim();const ht=$[Ye]||[];$[Ye]=ht,ht.push(se)}q($,function(Ee){return Ee.join(", ")})}n.Ba=function(){return this.m},n.Ka=function(){return typeof this.l=="string"?this.l:String(this.l)};function Uo(P,$,se){return se&&se.internalChannelParams&&se.internalChannelParams[P]||$}function Au(P){this.Aa=0,this.i=[],this.j=new Ha,this.ia=this.qa=this.I=this.W=this.g=this.ya=this.D=this.H=this.m=this.S=this.o=null,this.Ya=this.U=0,this.Va=Uo("failFast",!1,P),this.F=this.C=this.u=this.s=this.l=null,this.X=!0,this.za=this.T=-1,this.Y=this.v=this.B=0,this.Ta=Uo("baseRetryDelayMs",5e3,P),this.cb=Uo("retryDelaySeedMs",1e4,P),this.Wa=Uo("forwardChannelMaxRetries",2,P),this.wa=Uo("forwardChannelRequestTimeoutMs",2e4,P),this.pa=P&&P.xmlHttpFactory||void 0,this.Xa=P&&P.Tb||void 0,this.Ca=P&&P.useFetchStreams||!1,this.L=void 0,this.J=P&&P.supportsCrossDomainXhr||!1,this.K="",this.h=new qt(P&&P.concurrentRequestLimit),this.Da=new r_,this.P=P&&P.fastHandshake||!1,this.O=P&&P.encodeInitMessageHeaders||!1,this.P&&this.O&&(this.O=!1),this.Ua=P&&P.Rb||!1,P&&P.xa&&this.j.xa(),P&&P.forceLongPolling&&(this.X=!1),this.ba=!this.P&&this.X&&P&&P.detectBufferingProxy||!1,this.ja=void 0,P&&P.longPollingTimeout&&0<P.longPollingTimeout&&(this.ja=P.longPollingTimeout),this.ca=void 0,this.R=0,this.M=!1,this.ka=this.A=null}n=Au.prototype,n.la=8,n.G=1,n.connect=function(P,$,se,Ee){Kt(0),this.W=P,this.H=$||{},se&&Ee!==void 0&&(this.H.OSID=se,this.H.OAID=Ee),this.F=this.X,this.I=Cd(this,null,this.W),Jc(this)};function Us(P){if(pm(P),P.G==3){var $=P.U++,se=di(P.I);if(hi(se,"SID",P.K),hi(se,"RID",$),hi(se,"TYPE","terminate"),Td(P,se),$=new ia(P,P.j,$),$.L=2,$.v=Tu(di(se)),se=!1,y.navigator&&y.navigator.sendBeacon)try{se=y.navigator.sendBeacon($.v.toString(),"")}catch{}!se&&y.Image&&(new Image().src=$.v,se=!0),se||($.g=o_($.j,null),$.g.ea($.v)),$.F=Date.now(),Jr($)}DE(P)}function Sc(P){P.g&&(s_(P),P.g.cancel(),P.g=null)}function pm(P){Sc(P),P.u&&(y.clearTimeout(P.u),P.u=null),fm(P),P.h.cancel(),P.s&&(typeof P.s=="number"&&y.clearTimeout(P.s),P.s=null)}function Jc(P){if(!qn(P.h)&&!P.s){P.s=!0;var $=P.Ga;we||Ne(),Re||(we(),Re=!0),Te.add($,P),P.B=0}}function i_(P,$){return Xi(P.h)>=P.h.j-(P.s?1:0)?!1:P.s?(P.i=$.D.concat(P.i),!0):P.G==1||P.G==2||P.B>=(P.Va?0:P.Wa)?!1:(P.s=ta(O(P.Ga,P,$),xE(P,P.B)),P.B++,!0)}n.Ga=function(P){if(this.s)if(this.s=null,this.G==1){if(!P){this.U=Math.floor(1e5*Math.random()),P=this.U++;const Ye=new ia(this,this.j,P);let ht=this.o;if(this.S&&(ht?(ht=J(ht),ne(ht,this.S)):ht=this.S),this.m!==null||this.O||(Ye.H=ht,ht=null),this.P)e:{for(var $=0,se=0;se<this.i.length;se++){t:{var Ee=this.i[se];if("__data__"in Ee.map&&(Ee=Ee.map.__data__,typeof Ee=="string")){Ee=Ee.length;break t}Ee=void 0}if(Ee===void 0)break;if($+=Ee,4096<$){$=se;break e}if($===4096||se===this.i.length-1){$=se+1;break e}}$=1e3}else $=1e3;$=Lh(this,Ye,$),se=di(this.I),hi(se,"RID",P),hi(se,"CVER",22),this.D&&hi(se,"X-HTTP-Session-Id",this.D),Td(this,se),ht&&(this.O?$="headers="+encodeURIComponent(String(zl(ht)))+"&"+$:this.m&&Ce(se,this.m,ht)),Kc(this.h,Ye),this.Ua&&hi(se,"TYPE","init"),this.P?(hi(se,"$req",$),hi(se,"SID","null"),Ye.T=!0,Sa(Ye,se,null)):Sa(Ye,se,$),this.G=2}}else this.G==3&&(P?Dh(this,P):this.i.length==0||qn(this.h)||Dh(this))};function Dh(P,$){var se;$?se=$.l:se=P.U++;const Ee=di(P.I);hi(Ee,"SID",P.K),hi(Ee,"RID",se),hi(Ee,"AID",P.T),Td(P,Ee),P.m&&P.o&&Ce(Ee,P.m,P.o),se=new ia(P,P.j,se,P.B+1),P.m===null&&(se.H=P.o),$&&(P.i=$.D.concat(P.i)),$=Lh(P,se,1e3),se.I=Math.round(.5*P.wa)+Math.round(.5*P.wa*Math.random()),Kc(P.h,se),Sa(se,Ee,$)}function Td(P,$){P.H&&me(P.H,function(se,Ee){hi($,Ee,se)}),P.l&&Rr({},function(se,Ee){hi($,Ee,se)})}function Lh(P,$,se){se=Math.min(P.i.length,se);var Ee=P.l?O(P.l.Na,P.l,P):null;e:{var Ye=P.i;let ht=-1;for(;;){const $t=["count="+se];ht==-1?0<se?(ht=Ye[0].g,$t.push("ofs="+ht)):ht=0:$t.push("ofs="+ht);let ci=!0;for(let eo=0;eo<se;eo++){let mr=Ye[eo].g;const bo=Ye[eo].map;if(mr-=ht,0>mr)ht=Math.max(0,Ye[eo].g-100),ci=!1;else try{Fl(bo,$t,"req"+mr+"_")}catch{Ee&&Ee(bo)}}if(ci){Ee=$t.join("&");break e}}}return P=P.i.splice(0,se),$.D=P,Ee}function bc(P){if(!P.g&&!P.u){P.Y=1;var $=P.Fa;we||Ne(),Re||(we(),Re=!0),Te.add($,P),P.v=0}}function Pu(P){return P.g||P.u||3<=P.v?!1:(P.Y++,P.u=ta(O(P.Fa,P),xE(P,P.v)),P.v++,!0)}n.Fa=function(){if(this.u=null,NE(this),this.ba&&!(this.M||this.g==null||0>=this.R)){var P=2*this.R;this.j.info("BP detection timer enabled: "+P),this.A=ta(O(this.ab,this),P)}},n.ab=function(){this.A&&(this.A=null,this.j.info("BP detection timeout reached."),this.j.info("Buffering proxy detected and switch to long-polling!"),this.F=!1,this.M=!0,Kt(10),Sc(this),NE(this))};function s_(P){P.A!=null&&(y.clearTimeout(P.A),P.A=null)}function NE(P){P.g=new ia(P,P.j,"rpc",P.Y),P.m===null&&(P.g.H=P.o),P.g.O=0;var $=di(P.qa);hi($,"RID","rpc"),hi($,"SID",P.K),hi($,"AID",P.T),hi($,"CI",P.F?"0":"1"),!P.F&&P.ja&&hi($,"TO",P.ja),hi($,"TYPE","xmlhttp"),Td(P,$),P.m&&P.o&&Ce($,P.m,P.o),P.L&&(P.g.I=P.L);var se=P.g;P=P.ia,se.L=1,se.v=Tu(di($)),se.m=null,se.P=!0,Ll(se,P)}n.Za=function(){this.C!=null&&(this.C=null,Sc(this),Pu(this),Kt(19))};function fm(P){P.C!=null&&(y.clearTimeout(P.C),P.C=null)}function mm(P,$){var se=null;if(P.g==$){fm(P),s_(P),P.g=null;var Ee=2}else if(Ss(P.h,$))se=$.D,kh(P.h,$),Ee=1;else return;if(P.G!=0){if($.o)if(Ee==1){se=$.m?$.m.length:0,$=Date.now()-$.F;var Ye=P.B;Ee=So(),cn(Ee,new Hc(Ee,se)),Jc(P)}else bc(P);else if(Ye=$.s,Ye==3||Ye==0&&0<$.X||!(Ee==1&&i_(P,$)||Ee==2&&Pu(P)))switch(se&&0<se.length&&($=P.h,$.i=$.i.concat(se)),Ye){case 1:Ka(P,5);break;case 4:Ka(P,10);break;case 3:Ka(P,6);break;default:Ka(P,2)}}}function xE(P,$){let se=P.Ta+Math.floor(Math.random()*P.cb);return P.isActive()||(se*=2),se*$}function Ka(P,$){if(P.j.info("Error code "+$),$==2){var se=O(P.fb,P),Ee=P.Xa;const Ye=!Ee;Ee=new Ji(Ee||"//www.google.com/images/cleardot.gif"),y.location&&y.location.protocol=="http"||Hr(Ee,"https"),Tu(Ee),Ye?Qp(Ee.toString(),se):Yc(Ee.toString(),se)}else Kt(2);P.G=0,P.l&&P.l.sa($),DE(P),pm(P)}n.fb=function(P){P?(this.j.info("Successfully pinged google.com"),Kt(2)):(this.j.info("Failed to ping google.com"),Kt(1))};function DE(P){if(P.G=0,P.ka=[],P.l){const $=yc(P.h);($.length!=0||P.i.length!=0)&&(F(P.ka,$),F(P.ka,P.i),P.h.i.length=0,U(P.i),P.i.length=0),P.l.ra()}}function Cd(P,$,se){var Ee=se instanceof Ji?di(se):new Ji(se);if(Ee.g!="")$&&(Ee.g=$+"."+Ee.g),Vl(Ee,Ee.s);else{var Ye=y.location;Ee=Ye.protocol,$=$?$+"."+Ye.hostname:Ye.hostname,Ye=+Ye.port;var ht=new Ji(null);Ee&&Hr(ht,Ee),$&&(ht.g=$),Ye&&Vl(ht,Ye),se&&(ht.l=se),Ee=ht}return se=P.D,$=P.ya,se&&$&&hi(Ee,se,$),hi(Ee,"VER",P.la),Td(P,Ee),Ee}function o_(P,$,se){if($&&!P.J)throw Error("Can't create secondary domain capable XhrIo object.");return $=P.Ca&&!P.pa?new Me(new Bl({eb:se})):new Me(P.pa),$.Ha(P.J),$}n.isActive=function(){return!!this.l&&this.l.isActive(this)};function a_(){}n=a_.prototype,n.ua=function(){},n.ta=function(){},n.sa=function(){},n.ra=function(){},n.isActive=function(){return!0},n.Na=function(){};function Kn(){}Kn.prototype.g=function(P,$){return new Ia(P,$)};function Ia(P,$){Ut.call(this),this.g=new Au($),this.l=P,this.h=$&&$.messageUrlParams||null,P=$&&$.messageHeaders||null,$&&$.clientProtocolHeaderRequired&&(P?P["X-Client-Protocol"]="webchannel":P={"X-Client-Protocol":"webchannel"}),this.g.o=P,P=$&&$.initMessageHeaders||null,$&&$.messageContentType&&(P?P["X-WebChannel-Content-Type"]=$.messageContentType:P={"X-WebChannel-Content-Type":$.messageContentType}),$&&$.va&&(P?P["X-WebChannel-Client-Profile"]=$.va:P={"X-WebChannel-Client-Profile":$.va}),this.g.S=P,(P=$&&$.Sb)&&!W(P)&&(this.g.m=P),this.v=$&&$.supportsCrossDomainXhr||!1,this.u=$&&$.sendRawJson||!1,($=$&&$.httpSessionIdParam)&&!W($)&&(this.g.D=$,P=this.h,P!==null&&$ in P&&(P=this.h,$ in P&&delete P[$])),this.j=new Ou(this)}D(Ia,Ut),Ia.prototype.m=function(){this.g.l=this.j,this.v&&(this.g.J=!0),this.g.connect(this.l,this.h||void 0)},Ia.prototype.close=function(){Us(this.g)},Ia.prototype.o=function(P){var $=this.g;if(typeof P=="string"){var se={};se.__data__=P,P=se}else this.u&&(se={},se.__data__=zi(P),P=se);$.i.push(new Je($.Ya++,P)),$.G==3&&Jc($)},Ia.prototype.N=function(){this.g.l=null,delete this.j,Us(this.g),delete this.g,Ia.aa.N.call(this)};function LE(P){vo.call(this),P.__headers__&&(this.headers=P.__headers__,this.statusCode=P.__status__,delete P.__headers__,delete P.__status__);var $=P.__sm__;if($){e:{for(const se in $){P=se;break e}P=void 0}(this.i=P)&&(P=this.i,$=$!==null&&P in $?$[P]:void 0),this.data=$}else this.data=P}D(LE,vo);function ME(){Js.call(this),this.status=1}D(ME,Js);function Ou(P){this.g=P}D(Ou,a_),Ou.prototype.ua=function(){cn(this.g,"a")},Ou.prototype.ta=function(P){cn(this.g,new LE(P))},Ou.prototype.sa=function(P){cn(this.g,new ME)},Ou.prototype.ra=function(){cn(this.g,"b")},Kn.prototype.createWebChannel=Kn.prototype.g,Ia.prototype.send=Ia.prototype.o,Ia.prototype.open=Ia.prototype.m,Ia.prototype.close=Ia.prototype.close,Pse=function(){return new Kn},Ase=function(){return So()},Ise=ns,P5={mb:0,pb:1,qb:2,Jb:3,Ob:4,Lb:5,Mb:6,Kb:7,Ib:8,Nb:9,PROXY:10,NOPROXY:11,Gb:12,Cb:13,Db:14,Bb:15,Eb:16,Fb:17,ib:18,hb:19,jb:20},kl.NO_ERROR=0,kl.TIMEOUT=8,kl.HTTP_ERROR=6,QO=kl,Ah.COMPLETE="complete",Rse=Ah,Wc.EventType=Xr,Xr.OPEN="a",Xr.CLOSE="b",Xr.ERROR="c",Xr.MESSAGE="d",Ut.prototype.listen=Ut.prototype.K,OC=Wc,Me.prototype.listenOnce=Me.prototype.L,Me.prototype.getLastError=Me.prototype.Ka,Me.prototype.getLastErrorCode=Me.prototype.Ba,Me.prototype.getStatus=Me.prototype.Z,Me.prototype.getResponseJson=Me.prototype.Oa,Me.prototype.getResponseText=Me.prototype.oa,Me.prototype.send=Me.prototype.ea,Me.prototype.setWithCredentials=Me.prototype.Ha,Cse=Me}).apply(typeof gO<"u"?gO:typeof self<"u"?self:typeof window<"u"?window:{});const $J="@firebase/firestore",KJ="4.8.0";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class hc{constructor(e){this.uid=e}isAuthenticated(){return this.uid!=null}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}}hc.UNAUTHENTICATED=new hc(null),hc.GOOGLE_CREDENTIALS=new hc("google-credentials-uid"),hc.FIRST_PARTY=new hc("first-party-uid"),hc.MOCK_USER=new hc("mock-user");/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let pb="11.10.0";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const fE=new zF("@firebase/firestore");function K0(){return fE.logLevel}function fn(n,...e){if(fE.logLevel<=zr.DEBUG){const i=e.map(QF);fE.debug(`Firestore (${pb}): ${n}`,...i)}}function im(n,...e){if(fE.logLevel<=zr.ERROR){const i=e.map(QF);fE.error(`Firestore (${pb}): ${n}`,...i)}}function Wg(n,...e){if(fE.logLevel<=zr.WARN){const i=e.map(QF);fE.warn(`Firestore (${pb}): ${n}`,...i)}}function QF(n){if(typeof n=="string")return n;try{/**
* @license
* Copyright 2020 Google LLC
*
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
*   http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
*/return(function(i){return JSON.stringify(i)})(n)}catch{return n}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function er(n,e,i){let o="Unexpected state";typeof e=="string"?o=e:i=e,Ose(n,o,i)}function Ose(n,e,i){let o=`FIRESTORE (${pb}) INTERNAL ASSERTION FAILED: ${e} (ID: ${n.toString(16)})`;if(i!==void 0)try{o+=" CONTEXT: "+JSON.stringify(i)}catch{o+=" CONTEXT: "+i}throw im(o),new Error(o)}function Ci(n,e,i,o){let l="Unexpected state";typeof i=="string"?l=i:o=i,n||Ose(e,l,o)}function fr(n,e){return n}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Et={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class Xt extends Th{constructor(e,i){super(e,i),this.code=e,this.message=i,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Yf{constructor(){this.promise=new Promise(((e,i)=>{this.resolve=e,this.reject=i}))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class kse{constructor(e,i){this.user=i,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${e}`)}}class v3e{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,i){e.enqueueRetryable((()=>i(hc.UNAUTHENTICATED)))}shutdown(){}}class S3e{constructor(e){this.token=e,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(e,i){this.changeListener=i,e.enqueueRetryable((()=>i(this.token.user)))}shutdown(){this.changeListener=null}}class b3e{constructor(e){this.t=e,this.currentUser=hc.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(e,i){Ci(this.o===void 0,42304);let o=this.i;const l=E=>this.i!==o?(o=this.i,i(E)):Promise.resolve();let u=new Yf;this.o=()=>{this.i++,this.currentUser=this.u(),u.resolve(),u=new Yf,e.enqueueRetryable((()=>l(this.currentUser)))};const p=()=>{const E=u;e.enqueueRetryable((async()=>{await E.promise,await l(this.currentUser)}))},y=E=>{fn("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=E,this.o&&(this.auth.addAuthTokenListener(this.o),p())};this.t.onInit((E=>y(E))),setTimeout((()=>{if(!this.auth){const E=this.t.getImmediate({optional:!0});E?y(E):(fn("FirebaseAuthCredentialsProvider","Auth not yet detected"),u.resolve(),u=new Yf)}}),0),p()}getToken(){const e=this.i,i=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(i).then((o=>this.i!==e?(fn("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):o?(Ci(typeof o.accessToken=="string",31837,{l:o}),new kse(o.accessToken,this.currentUser)):null)):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.o&&this.auth.removeAuthTokenListener(this.o),this.o=void 0}u(){const e=this.auth&&this.auth.getUid();return Ci(e===null||typeof e=="string",2055,{h:e}),new hc(e)}}class w3e{constructor(e,i,o){this.P=e,this.T=i,this.I=o,this.type="FirstParty",this.user=hc.FIRST_PARTY,this.A=new Map}R(){return this.I?this.I():null}get headers(){this.A.set("X-Goog-AuthUser",this.P);const e=this.R();return e&&this.A.set("Authorization",e),this.T&&this.A.set("X-Goog-Iam-Authorization-Token",this.T),this.A}}class T3e{constructor(e,i,o){this.P=e,this.T=i,this.I=o}getToken(){return Promise.resolve(new w3e(this.P,this.T,this.I))}start(e,i){e.enqueueRetryable((()=>i(hc.FIRST_PARTY)))}shutdown(){}invalidateToken(){}}class qJ{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&e.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class C3e{constructor(e,i){this.V=i,this.forceRefresh=!1,this.appCheck=null,this.m=null,this.p=null,wl(e)&&e.settings.appCheckToken&&(this.p=e.settings.appCheckToken)}start(e,i){Ci(this.o===void 0,3512);const o=u=>{u.error!=null&&fn("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${u.error.message}`);const p=u.token!==this.m;return this.m=u.token,fn("FirebaseAppCheckTokenProvider",`Received ${p?"new":"existing"} token.`),p?i(u.token):Promise.resolve()};this.o=u=>{e.enqueueRetryable((()=>o(u)))};const l=u=>{fn("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=u,this.o&&this.appCheck.addTokenListener(this.o)};this.V.onInit((u=>l(u))),setTimeout((()=>{if(!this.appCheck){const u=this.V.getImmediate({optional:!0});u?l(u):fn("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}}),0)}getToken(){if(this.p)return Promise.resolve(new qJ(this.p));const e=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(e).then((i=>i?(Ci(typeof i.token=="string",44558,{tokenResult:i}),this.m=i.token,new qJ(i.token)):null)):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.o&&this.appCheck.removeTokenListener(this.o),this.o=void 0}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function R3e(n){const e=typeof self<"u"&&(self.crypto||self.msCrypto),i=new Uint8Array(n);if(e&&typeof e.getRandomValues=="function")e.getRandomValues(i);else for(let o=0;o<n;o++)i[o]=Math.floor(256*Math.random());return i}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Nse(){return new TextEncoder}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ZF{static newId(){const e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",i=62*Math.floor(4.129032258064516);let o="";for(;o.length<20;){const l=R3e(40);for(let u=0;u<l.length;++u)o.length<20&&l[u]<i&&(o+=e.charAt(l[u]%62))}return o}}function kr(n,e){return n<e?-1:n>e?1:0}function O5(n,e){let i=0;for(;i<n.length&&i<e.length;){const o=n.codePointAt(i),l=e.codePointAt(i);if(o!==l){if(o<128&&l<128)return kr(o,l);{const u=Nse(),p=I3e(u.encode(YJ(n,i)),u.encode(YJ(e,i)));return p!==0?p:kr(o,l)}}i+=o>65535?2:1}return kr(n.length,e.length)}function YJ(n,e){return n.codePointAt(e)>65535?n.substring(e,e+2):n.substring(e,e+1)}function I3e(n,e){for(let i=0;i<n.length&&i<e.length;++i)if(n[i]!==e[i])return kr(n[i],e[i]);return kr(n.length,e.length)}function YS(n,e,i){return n.length===e.length&&n.every(((o,l)=>i(o,e[l])))}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const XJ="__name__";class wp{constructor(e,i,o){i===void 0?i=0:i>e.length&&er(637,{offset:i,range:e.length}),o===void 0?o=e.length-i:o>e.length-i&&er(1746,{length:o,range:e.length-i}),this.segments=e,this.offset=i,this.len=o}get length(){return this.len}isEqual(e){return wp.comparator(this,e)===0}child(e){const i=this.segments.slice(this.offset,this.limit());return e instanceof wp?e.forEach((o=>{i.push(o)})):i.push(e),this.construct(i)}limit(){return this.offset+this.length}popFirst(e){return e=e===void 0?1:e,this.construct(this.segments,this.offset+e,this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return this.length===0}isPrefixOf(e){if(e.length<this.length)return!1;for(let i=0;i<this.length;i++)if(this.get(i)!==e.get(i))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let i=0;i<this.length;i++)if(this.get(i)!==e.get(i))return!1;return!0}forEach(e){for(let i=this.offset,o=this.limit();i<o;i++)e(this.segments[i])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,i){const o=Math.min(e.length,i.length);for(let l=0;l<o;l++){const u=wp.compareSegments(e.get(l),i.get(l));if(u!==0)return u}return kr(e.length,i.length)}static compareSegments(e,i){const o=wp.isNumericId(e),l=wp.isNumericId(i);return o&&!l?-1:!o&&l?1:o&&l?wp.extractNumericId(e).compare(wp.extractNumericId(i)):O5(e,i)}static isNumericId(e){return e.startsWith("__id")&&e.endsWith("__")}static extractNumericId(e){return Ug.fromString(e.substring(4,e.length-2))}}class qi extends wp{construct(e,i,o){return new qi(e,i,o)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(...e){const i=[];for(const o of e){if(o.indexOf("//")>=0)throw new Xt(Et.INVALID_ARGUMENT,`Invalid segment (${o}). Paths must not contain // in them.`);i.push(...o.split("/").filter((l=>l.length>0)))}return new qi(i)}static emptyPath(){return new qi([])}}const A3e=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class Fa extends wp{construct(e,i,o){return new Fa(e,i,o)}static isValidIdentifier(e){return A3e.test(e)}canonicalString(){return this.toArray().map((e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),Fa.isValidIdentifier(e)||(e="`"+e+"`"),e))).join(".")}toString(){return this.canonicalString()}isKeyField(){return this.length===1&&this.get(0)===XJ}static keyField(){return new Fa([XJ])}static fromServerFormat(e){const i=[];let o="",l=0;const u=()=>{if(o.length===0)throw new Xt(Et.INVALID_ARGUMENT,`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);i.push(o),o=""};let p=!1;for(;l<e.length;){const y=e[l];if(y==="\\"){if(l+1===e.length)throw new Xt(Et.INVALID_ARGUMENT,"Path has trailing escape character: "+e);const E=e[l+1];if(E!=="\\"&&E!=="."&&E!=="`")throw new Xt(Et.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);o+=E,l+=2}else y==="`"?(p=!p,l++):y!=="."||p?(o+=y,l++):(u(),l++)}if(u(),p)throw new Xt(Et.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new Fa(i)}static emptyPath(){return new Fa([])}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class kn{constructor(e){this.path=e}static fromPath(e){return new kn(qi.fromString(e))}static fromName(e){return new kn(qi.fromString(e).popFirst(5))}static empty(){return new kn(qi.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(e){return e!==null&&qi.comparator(this.path,e.path)===0}toString(){return this.path.toString()}static comparator(e,i){return qi.comparator(e.path,i.path)}static isDocumentKey(e){return e.length%2==0}static fromSegments(e){return new kn(new qi(e.slice()))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function xse(n,e,i){if(!i)throw new Xt(Et.INVALID_ARGUMENT,`Function ${n}() cannot be called with an empty ${e}.`)}function P3e(n,e,i,o){if(e===!0&&o===!0)throw new Xt(Et.INVALID_ARGUMENT,`${n} and ${i} cannot be used together.`)}function JJ(n){if(!kn.isDocumentKey(n))throw new Xt(Et.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${n} has ${n.length}.`)}function QJ(n){if(kn.isDocumentKey(n))throw new Xt(Et.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${n} has ${n.length}.`)}function Dse(n){return typeof n=="object"&&n!==null&&(Object.getPrototypeOf(n)===Object.prototype||Object.getPrototypeOf(n)===null)}function UN(n){if(n===void 0)return"undefined";if(n===null)return"null";if(typeof n=="string")return n.length>20&&(n=`${n.substring(0,20)}...`),JSON.stringify(n);if(typeof n=="number"||typeof n=="boolean")return""+n;if(typeof n=="object"){if(n instanceof Array)return"an array";{const e=(function(o){return o.constructor?o.constructor.name:null})(n);return e?`a custom ${e} object`:"an object"}}return typeof n=="function"?"a function":er(12329,{type:typeof n})}function Pl(n,e){if("_delegate"in n&&(n=n._delegate),!(n instanceof e)){if(e.name===n.constructor.name)throw new Xt(Et.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{const i=UN(n);throw new Xt(Et.INVALID_ARGUMENT,`Expected type '${e.name}', but it was: ${i}`)}}return n}function O3e(n,e){if(e<=0)throw new Xt(Et.INVALID_ARGUMENT,`Function ${n}() requires a positive number, but it was: ${e}.`)}/**
 * @license
 * Copyright 2025 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function No(n,e){const i={typeString:n};return e&&(i.value=e),i}function oI(n,e){if(!Dse(n))throw new Xt(Et.INVALID_ARGUMENT,"JSON must be an object");let i;for(const o in e)if(e[o]){const l=e[o].typeString,u="value"in e[o]?{value:e[o].value}:void 0;if(!(o in n)){i=`JSON missing required field: '${o}'`;break}const p=n[o];if(l&&typeof p!==l){i=`JSON field '${o}' must be a ${l}.`;break}if(u!==void 0&&p!==u.value){i=`Expected '${o}' field to equal '${u.value}'`;break}}if(i)throw new Xt(Et.INVALID_ARGUMENT,i);return!0}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ZJ=-62135596800,eQ=1e6;class ls{static now(){return ls.fromMillis(Date.now())}static fromDate(e){return ls.fromMillis(e.getTime())}static fromMillis(e){const i=Math.floor(e/1e3),o=Math.floor((e-1e3*i)*eQ);return new ls(i,o)}constructor(e,i){if(this.seconds=e,this.nanoseconds=i,i<0)throw new Xt(Et.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+i);if(i>=1e9)throw new Xt(Et.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+i);if(e<ZJ)throw new Xt(Et.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e);if(e>=253402300800)throw new Xt(Et.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/eQ}_compareTo(e){return this.seconds===e.seconds?kr(this.nanoseconds,e.nanoseconds):kr(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{type:ls._jsonSchemaVersion,seconds:this.seconds,nanoseconds:this.nanoseconds}}static fromJSON(e){if(oI(e,ls._jsonSchema))return new ls(e.seconds,e.nanoseconds)}valueOf(){const e=this.seconds-ZJ;return String(e).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}ls._jsonSchemaVersion="firestore/timestamp/1.0",ls._jsonSchema={type:No("string",ls._jsonSchemaVersion),seconds:No("number"),nanoseconds:No("number")};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ur{static fromTimestamp(e){return new ur(e)}static min(){return new ur(new ls(0,0))}static max(){return new ur(new ls(253402300799,999999999))}constructor(e){this.timestamp=e}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const AR=-1;function k3e(n,e){const i=n.toTimestamp().seconds,o=n.toTimestamp().nanoseconds+1,l=ur.fromTimestamp(o===1e9?new ls(i+1,0):new ls(i,o));return new Gg(l,kn.empty(),e)}function N3e(n){return new Gg(n.readTime,n.key,AR)}class Gg{constructor(e,i,o){this.readTime=e,this.documentKey=i,this.largestBatchId=o}static min(){return new Gg(ur.min(),kn.empty(),AR)}static max(){return new Gg(ur.max(),kn.empty(),AR)}}function x3e(n,e){let i=n.readTime.compareTo(e.readTime);return i!==0?i:(i=kn.comparator(n.documentKey,e.documentKey),i!==0?i:kr(n.largestBatchId,e.largestBatchId))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const D3e="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.";class L3e{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach((e=>e()))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function fb(n){if(n.code!==Et.FAILED_PRECONDITION||n.message!==D3e)throw n;fn("LocalStore","Unexpectedly lost primary lease")}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class At{constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e((i=>{this.isDone=!0,this.result=i,this.nextCallback&&this.nextCallback(i)}),(i=>{this.isDone=!0,this.error=i,this.catchCallback&&this.catchCallback(i)}))}catch(e){return this.next(void 0,e)}next(e,i){return this.callbackAttached&&er(59440),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(i,this.error):this.wrapSuccess(e,this.result):new At(((o,l)=>{this.nextCallback=u=>{this.wrapSuccess(e,u).next(o,l)},this.catchCallback=u=>{this.wrapFailure(i,u).next(o,l)}}))}toPromise(){return new Promise(((e,i)=>{this.next(e,i)}))}wrapUserFunction(e){try{const i=e();return i instanceof At?i:At.resolve(i)}catch(i){return At.reject(i)}}wrapSuccess(e,i){return e?this.wrapUserFunction((()=>e(i))):At.resolve(i)}wrapFailure(e,i){return e?this.wrapUserFunction((()=>e(i))):At.reject(i)}static resolve(e){return new At(((i,o)=>{i(e)}))}static reject(e){return new At(((i,o)=>{o(e)}))}static waitFor(e){return new At(((i,o)=>{let l=0,u=0,p=!1;e.forEach((y=>{++l,y.next((()=>{++u,p&&u===l&&i()}),(E=>o(E)))})),p=!0,u===l&&i()}))}static or(e){let i=At.resolve(!1);for(const o of e)i=i.next((l=>l?At.resolve(l):o()));return i}static forEach(e,i){const o=[];return e.forEach(((l,u)=>{o.push(i.call(this,l,u))})),this.waitFor(o)}static mapArray(e,i){return new At(((o,l)=>{const u=e.length,p=new Array(u);let y=0;for(let E=0;E<u;E++){const b=E;i(e[b]).next((T=>{p[b]=T,++y,y===u&&o(p)}),(T=>l(T)))}}))}static doWhile(e,i){return new At(((o,l)=>{const u=()=>{e()===!0?i().next((()=>{u()}),l):o()};u()}))}}function M3e(n){const e=n.match(/Android ([\d.]+)/i),i=e?e[1].split(".").slice(0,2).join("."):"-1";return Number(i)}function mb(n){return n.name==="IndexedDbTransactionError"}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class VN{constructor(e,i){this.previousValue=e,i&&(i.sequenceNumberHandler=o=>this._e(o),this.ae=o=>i.writeSequenceNumber(o))}_e(e){return this.previousValue=Math.max(e,this.previousValue),this.previousValue}next(){const e=++this.previousValue;return this.ae&&this.ae(e),e}}VN.ue=-1;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const e3=-1;function jN(n){return n==null}function Dk(n){return n===0&&1/n==-1/0}function U3e(n){return typeof n=="number"&&Number.isInteger(n)&&!Dk(n)&&n<=Number.MAX_SAFE_INTEGER&&n>=Number.MIN_SAFE_INTEGER}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Lse="";function V3e(n){let e="";for(let i=0;i<n.length;i++)e.length>0&&(e=tQ(e)),e=j3e(n.get(i),e);return tQ(e)}function j3e(n,e){let i=e;const o=n.length;for(let l=0;l<o;l++){const u=n.charAt(l);switch(u){case"\0":i+="";break;case Lse:i+="";break;default:i+=u}}return i}function tQ(n){return n+Lse+""}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function nQ(n){let e=0;for(const i in n)Object.prototype.hasOwnProperty.call(n,i)&&e++;return e}function t_(n,e){for(const i in n)Object.prototype.hasOwnProperty.call(n,i)&&e(i,n[i])}function Mse(n){for(const e in n)if(Object.prototype.hasOwnProperty.call(n,e))return!1;return!0}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class xs{constructor(e,i){this.comparator=e,this.root=i||Va.EMPTY}insert(e,i){return new xs(this.comparator,this.root.insert(e,i,this.comparator).copy(null,null,Va.BLACK,null,null))}remove(e){return new xs(this.comparator,this.root.remove(e,this.comparator).copy(null,null,Va.BLACK,null,null))}get(e){let i=this.root;for(;!i.isEmpty();){const o=this.comparator(e,i.key);if(o===0)return i.value;o<0?i=i.left:o>0&&(i=i.right)}return null}indexOf(e){let i=0,o=this.root;for(;!o.isEmpty();){const l=this.comparator(e,o.key);if(l===0)return i+o.left.size;l<0?o=o.left:(i+=o.left.size+1,o=o.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(e){this.inorderTraversal(((i,o)=>(e(i,o),!1)))}toString(){const e=[];return this.inorderTraversal(((i,o)=>(e.push(`${i}:${o}`),!1))),`{${e.join(", ")}}`}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new _O(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new _O(this.root,e,this.comparator,!1)}getReverseIterator(){return new _O(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new _O(this.root,e,this.comparator,!0)}}class _O{constructor(e,i,o,l){this.isReverse=l,this.nodeStack=[];let u=1;for(;!e.isEmpty();)if(u=i?o(e.key,i):1,i&&l&&(u*=-1),u<0)e=this.isReverse?e.left:e.right;else{if(u===0){this.nodeStack.push(e);break}this.nodeStack.push(e),e=this.isReverse?e.right:e.left}}getNext(){let e=this.nodeStack.pop();const i={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return i}hasNext(){return this.nodeStack.length>0}peek(){if(this.nodeStack.length===0)return null;const e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}}class Va{constructor(e,i,o,l,u){this.key=e,this.value=i,this.color=o??Va.RED,this.left=l??Va.EMPTY,this.right=u??Va.EMPTY,this.size=this.left.size+1+this.right.size}copy(e,i,o,l,u){return new Va(e??this.key,i??this.value,o??this.color,l??this.left,u??this.right)}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,i,o){let l=this;const u=o(e,l.key);return l=u<0?l.copy(null,null,null,l.left.insert(e,i,o),null):u===0?l.copy(null,i,null,null,null):l.copy(null,null,null,null,l.right.insert(e,i,o)),l.fixUp()}removeMin(){if(this.left.isEmpty())return Va.EMPTY;let e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),e=e.copy(null,null,null,e.left.removeMin(),null),e.fixUp()}remove(e,i){let o,l=this;if(i(e,l.key)<0)l.left.isEmpty()||l.left.isRed()||l.left.left.isRed()||(l=l.moveRedLeft()),l=l.copy(null,null,null,l.left.remove(e,i),null);else{if(l.left.isRed()&&(l=l.rotateRight()),l.right.isEmpty()||l.right.isRed()||l.right.left.isRed()||(l=l.moveRedRight()),i(e,l.key)===0){if(l.right.isEmpty())return Va.EMPTY;o=l.right.min(),l=l.copy(o.key,o.value,null,null,l.right.removeMin())}l=l.copy(null,null,null,null,l.right.remove(e,i))}return l.fixUp()}isRed(){return this.color}fixUp(){let e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e}moveRedLeft(){let e=this.colorFlip();return e.right.left.isRed()&&(e=e.copy(null,null,null,null,e.right.rotateRight()),e=e.rotateLeft(),e=e.colorFlip()),e}moveRedRight(){let e=this.colorFlip();return e.left.left.isRed()&&(e=e.rotateRight(),e=e.colorFlip()),e}rotateLeft(){const e=this.copy(null,null,Va.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight(){const e=this.copy(null,null,Va.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip(){const e=this.left.copy(null,null,!this.left.color,null,null),i=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,i)}checkMaxDepth(){const e=this.check();return Math.pow(2,e)<=this.size+1}check(){if(this.isRed()&&this.left.isRed())throw er(43730,{key:this.key,value:this.value});if(this.right.isRed())throw er(14113,{key:this.key,value:this.value});const e=this.left.check();if(e!==this.right.check())throw er(27949);return e+(this.isRed()?0:1)}}Va.EMPTY=null,Va.RED=!0,Va.BLACK=!1;Va.EMPTY=new class{constructor(){this.size=0}get key(){throw er(57766)}get value(){throw er(16141)}get color(){throw er(16727)}get left(){throw er(29726)}get right(){throw er(36894)}copy(e,i,o,l,u){return this}insert(e,i,o){return new Va(e,i)}remove(e,i){return this}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Jo{constructor(e){this.comparator=e,this.data=new xs(this.comparator)}has(e){return this.data.get(e)!==null}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(e){this.data.inorderTraversal(((i,o)=>(e(i),!1)))}forEachInRange(e,i){const o=this.data.getIteratorFrom(e[0]);for(;o.hasNext();){const l=o.getNext();if(this.comparator(l.key,e[1])>=0)return;i(l.key)}}forEachWhile(e,i){let o;for(o=i!==void 0?this.data.getIteratorFrom(i):this.data.getIterator();o.hasNext();)if(!e(o.getNext().key))return}firstAfterOrEqual(e){const i=this.data.getIteratorFrom(e);return i.hasNext()?i.getNext().key:null}getIterator(){return new rQ(this.data.getIterator())}getIteratorFrom(e){return new rQ(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let i=this;return i.size<e.size&&(i=e,e=this),e.forEach((o=>{i=i.add(o)})),i}isEqual(e){if(!(e instanceof Jo)||this.size!==e.size)return!1;const i=this.data.getIterator(),o=e.data.getIterator();for(;i.hasNext();){const l=i.getNext().key,u=o.getNext().key;if(this.comparator(l,u)!==0)return!1}return!0}toArray(){const e=[];return this.forEach((i=>{e.push(i)})),e}toString(){const e=[];return this.forEach((i=>e.push(i))),"SortedSet("+e.toString()+")"}copy(e){const i=new Jo(this.comparator);return i.data=e,i}}class rQ{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class pu{constructor(e){this.fields=e,e.sort(Fa.comparator)}static empty(){return new pu([])}unionWith(e){let i=new Jo(Fa.comparator);for(const o of this.fields)i=i.add(o);for(const o of e)i=i.add(o);return new pu(i.toArray())}covers(e){for(const i of this.fields)if(i.isPrefixOf(e))return!0;return!1}isEqual(e){return YS(this.fields,e.fields,((i,o)=>i.isEqual(o)))}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Use extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ba{constructor(e){this.binaryString=e}static fromBase64String(e){const i=(function(l){try{return atob(l)}catch(u){throw typeof DOMException<"u"&&u instanceof DOMException?new Use("Invalid base64 string: "+u):u}})(e);return new Ba(i)}static fromUint8Array(e){const i=(function(l){let u="";for(let p=0;p<l.length;++p)u+=String.fromCharCode(l[p]);return u})(e);return new Ba(i)}[Symbol.iterator](){let e=0;return{next:()=>e<this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return(function(i){return btoa(i)})(this.binaryString)}toUint8Array(){return(function(i){const o=new Uint8Array(i.length);for(let l=0;l<i.length;l++)o[l]=i.charCodeAt(l);return o})(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(e){return kr(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}}Ba.EMPTY_BYTE_STRING=new Ba("");const F3e=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function Hg(n){if(Ci(!!n,39018),typeof n=="string"){let e=0;const i=F3e.exec(n);if(Ci(!!i,46558,{timestamp:n}),i[1]){let l=i[1];l=(l+"000000000").substr(0,9),e=Number(l)}const o=new Date(n);return{seconds:Math.floor(o.getTime()/1e3),nanos:e}}return{seconds:po(n.seconds),nanos:po(n.nanos)}}function po(n){return typeof n=="number"?n:typeof n=="string"?Number(n):0}function $g(n){return typeof n=="string"?Ba.fromBase64String(n):Ba.fromUint8Array(n)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Vse="server_timestamp",jse="__type__",Fse="__previous_value__",Bse="__local_write_time__";function FN(n){var e,i;return((i=(((e=n==null?void 0:n.mapValue)===null||e===void 0?void 0:e.fields)||{})[jse])===null||i===void 0?void 0:i.stringValue)===Vse}function BN(n){const e=n.mapValue.fields[Fse];return FN(e)?BN(e):e}function PR(n){const e=Hg(n.mapValue.fields[Bse].timestampValue);return new ls(e.seconds,e.nanos)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class B3e{constructor(e,i,o,l,u,p,y,E,b,T){this.databaseId=e,this.appId=i,this.persistenceKey=o,this.host=l,this.ssl=u,this.forceLongPolling=p,this.autoDetectLongPolling=y,this.longPollingOptions=E,this.useFetchStreams=b,this.isUsingEmulator=T}}const Lk="(default)";class OR{constructor(e,i){this.projectId=e,this.database=i||Lk}static empty(){return new OR("","")}get isDefaultDatabase(){return this.database===Lk}isEqual(e){return e instanceof OR&&e.projectId===this.projectId&&e.database===this.database}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const zse="__type__",z3e="__max__",yO={mapValue:{}},Wse="__vector__",Mk="value";function Kg(n){return"nullValue"in n?0:"booleanValue"in n?1:"integerValue"in n||"doubleValue"in n?2:"timestampValue"in n?3:"stringValue"in n?5:"bytesValue"in n?6:"referenceValue"in n?7:"geoPointValue"in n?8:"arrayValue"in n?9:"mapValue"in n?FN(n)?4:G3e(n)?9007199254740991:W3e(n)?10:11:er(28295,{value:n})}function $p(n,e){if(n===e)return!0;const i=Kg(n);if(i!==Kg(e))return!1;switch(i){case 0:case 9007199254740991:return!0;case 1:return n.booleanValue===e.booleanValue;case 4:return PR(n).isEqual(PR(e));case 3:return(function(l,u){if(typeof l.timestampValue=="string"&&typeof u.timestampValue=="string"&&l.timestampValue.length===u.timestampValue.length)return l.timestampValue===u.timestampValue;const p=Hg(l.timestampValue),y=Hg(u.timestampValue);return p.seconds===y.seconds&&p.nanos===y.nanos})(n,e);case 5:return n.stringValue===e.stringValue;case 6:return(function(l,u){return $g(l.bytesValue).isEqual($g(u.bytesValue))})(n,e);case 7:return n.referenceValue===e.referenceValue;case 8:return(function(l,u){return po(l.geoPointValue.latitude)===po(u.geoPointValue.latitude)&&po(l.geoPointValue.longitude)===po(u.geoPointValue.longitude)})(n,e);case 2:return(function(l,u){if("integerValue"in l&&"integerValue"in u)return po(l.integerValue)===po(u.integerValue);if("doubleValue"in l&&"doubleValue"in u){const p=po(l.doubleValue),y=po(u.doubleValue);return p===y?Dk(p)===Dk(y):isNaN(p)&&isNaN(y)}return!1})(n,e);case 9:return YS(n.arrayValue.values||[],e.arrayValue.values||[],$p);case 10:case 11:return(function(l,u){const p=l.mapValue.fields||{},y=u.mapValue.fields||{};if(nQ(p)!==nQ(y))return!1;for(const E in p)if(p.hasOwnProperty(E)&&(y[E]===void 0||!$p(p[E],y[E])))return!1;return!0})(n,e);default:return er(52216,{left:n})}}function kR(n,e){return(n.values||[]).find((i=>$p(i,e)))!==void 0}function XS(n,e){if(n===e)return 0;const i=Kg(n),o=Kg(e);if(i!==o)return kr(i,o);switch(i){case 0:case 9007199254740991:return 0;case 1:return kr(n.booleanValue,e.booleanValue);case 2:return(function(u,p){const y=po(u.integerValue||u.doubleValue),E=po(p.integerValue||p.doubleValue);return y<E?-1:y>E?1:y===E?0:isNaN(y)?isNaN(E)?0:-1:1})(n,e);case 3:return iQ(n.timestampValue,e.timestampValue);case 4:return iQ(PR(n),PR(e));case 5:return O5(n.stringValue,e.stringValue);case 6:return(function(u,p){const y=$g(u),E=$g(p);return y.compareTo(E)})(n.bytesValue,e.bytesValue);case 7:return(function(u,p){const y=u.split("/"),E=p.split("/");for(let b=0;b<y.length&&b<E.length;b++){const T=kr(y[b],E[b]);if(T!==0)return T}return kr(y.length,E.length)})(n.referenceValue,e.referenceValue);case 8:return(function(u,p){const y=kr(po(u.latitude),po(p.latitude));return y!==0?y:kr(po(u.longitude),po(p.longitude))})(n.geoPointValue,e.geoPointValue);case 9:return sQ(n.arrayValue,e.arrayValue);case 10:return(function(u,p){var y,E,b,T;const R=u.fields||{},O=p.fields||{},L=(y=R[Mk])===null||y===void 0?void 0:y.arrayValue,D=(E=O[Mk])===null||E===void 0?void 0:E.arrayValue,U=kr(((b=L==null?void 0:L.values)===null||b===void 0?void 0:b.length)||0,((T=D==null?void 0:D.values)===null||T===void 0?void 0:T.length)||0);return U!==0?U:sQ(L,D)})(n.mapValue,e.mapValue);case 11:return(function(u,p){if(u===yO.mapValue&&p===yO.mapValue)return 0;if(u===yO.mapValue)return 1;if(p===yO.mapValue)return-1;const y=u.fields||{},E=Object.keys(y),b=p.fields||{},T=Object.keys(b);E.sort(),T.sort();for(let R=0;R<E.length&&R<T.length;++R){const O=O5(E[R],T[R]);if(O!==0)return O;const L=XS(y[E[R]],b[T[R]]);if(L!==0)return L}return kr(E.length,T.length)})(n.mapValue,e.mapValue);default:throw er(23264,{le:i})}}function iQ(n,e){if(typeof n=="string"&&typeof e=="string"&&n.length===e.length)return kr(n,e);const i=Hg(n),o=Hg(e),l=kr(i.seconds,o.seconds);return l!==0?l:kr(i.nanos,o.nanos)}function sQ(n,e){const i=n.values||[],o=e.values||[];for(let l=0;l<i.length&&l<o.length;++l){const u=XS(i[l],o[l]);if(u)return u}return kr(i.length,o.length)}function JS(n){return k5(n)}function k5(n){return"nullValue"in n?"null":"booleanValue"in n?""+n.booleanValue:"integerValue"in n?""+n.integerValue:"doubleValue"in n?""+n.doubleValue:"timestampValue"in n?(function(i){const o=Hg(i);return`time(${o.seconds},${o.nanos})`})(n.timestampValue):"stringValue"in n?n.stringValue:"bytesValue"in n?(function(i){return $g(i).toBase64()})(n.bytesValue):"referenceValue"in n?(function(i){return kn.fromName(i).toString()})(n.referenceValue):"geoPointValue"in n?(function(i){return`geo(${i.latitude},${i.longitude})`})(n.geoPointValue):"arrayValue"in n?(function(i){let o="[",l=!0;for(const u of i.values||[])l?l=!1:o+=",",o+=k5(u);return o+"]"})(n.arrayValue):"mapValue"in n?(function(i){const o=Object.keys(i.fields||{}).sort();let l="{",u=!0;for(const p of o)u?u=!1:l+=",",l+=`${p}:${k5(i.fields[p])}`;return l+"}"})(n.mapValue):er(61005,{value:n})}function ZO(n){switch(Kg(n)){case 0:case 1:return 4;case 2:return 8;case 3:case 8:return 16;case 4:const e=BN(n);return e?16+ZO(e):16;case 5:return 2*n.stringValue.length;case 6:return $g(n.bytesValue).approximateByteSize();case 7:return n.referenceValue.length;case 9:return(function(o){return(o.values||[]).reduce(((l,u)=>l+ZO(u)),0)})(n.arrayValue);case 10:case 11:return(function(o){let l=0;return t_(o.fields,((u,p)=>{l+=u.length+ZO(p)})),l})(n.mapValue);default:throw er(13486,{value:n})}}function Uk(n,e){return{referenceValue:`projects/${n.projectId}/databases/${n.database}/documents/${e.path.canonicalString()}`}}function N5(n){return!!n&&"integerValue"in n}function t3(n){return!!n&&"arrayValue"in n}function oQ(n){return!!n&&"nullValue"in n}function aQ(n){return!!n&&"doubleValue"in n&&isNaN(Number(n.doubleValue))}function ek(n){return!!n&&"mapValue"in n}function W3e(n){var e,i;return((i=(((e=n==null?void 0:n.mapValue)===null||e===void 0?void 0:e.fields)||{})[zse])===null||i===void 0?void 0:i.stringValue)===Wse}function JC(n){if(n.geoPointValue)return{geoPointValue:Object.assign({},n.geoPointValue)};if(n.timestampValue&&typeof n.timestampValue=="object")return{timestampValue:Object.assign({},n.timestampValue)};if(n.mapValue){const e={mapValue:{fields:{}}};return t_(n.mapValue.fields,((i,o)=>e.mapValue.fields[i]=JC(o))),e}if(n.arrayValue){const e={arrayValue:{values:[]}};for(let i=0;i<(n.arrayValue.values||[]).length;++i)e.arrayValue.values[i]=JC(n.arrayValue.values[i]);return e}return Object.assign({},n)}function G3e(n){return(((n.mapValue||{}).fields||{}).__type__||{}).stringValue===z3e}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Tl{constructor(e){this.value=e}static empty(){return new Tl({mapValue:{}})}field(e){if(e.isEmpty())return this.value;{let i=this.value;for(let o=0;o<e.length-1;++o)if(i=(i.mapValue.fields||{})[e.get(o)],!ek(i))return null;return i=(i.mapValue.fields||{})[e.lastSegment()],i||null}}set(e,i){this.getFieldsMap(e.popLast())[e.lastSegment()]=JC(i)}setAll(e){let i=Fa.emptyPath(),o={},l=[];e.forEach(((p,y)=>{if(!i.isImmediateParentOf(y)){const E=this.getFieldsMap(i);this.applyChanges(E,o,l),o={},l=[],i=y.popLast()}p?o[y.lastSegment()]=JC(p):l.push(y.lastSegment())}));const u=this.getFieldsMap(i);this.applyChanges(u,o,l)}delete(e){const i=this.field(e.popLast());ek(i)&&i.mapValue.fields&&delete i.mapValue.fields[e.lastSegment()]}isEqual(e){return $p(this.value,e.value)}getFieldsMap(e){let i=this.value;i.mapValue.fields||(i.mapValue={fields:{}});for(let o=0;o<e.length;++o){let l=i.mapValue.fields[e.get(o)];ek(l)&&l.mapValue.fields||(l={mapValue:{fields:{}}},i.mapValue.fields[e.get(o)]=l),i=l}return i.mapValue.fields}applyChanges(e,i,o){t_(i,((l,u)=>e[l]=u));for(const l of o)delete e[l]}clone(){return new Tl(JC(this.value))}}function Gse(n){const e=[];return t_(n.fields,((i,o)=>{const l=new Fa([i]);if(ek(o)){const u=Gse(o.mapValue).fields;if(u.length===0)e.push(l);else for(const p of u)e.push(l.child(p))}else e.push(l)})),new pu(e)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class pc{constructor(e,i,o,l,u,p,y){this.key=e,this.documentType=i,this.version=o,this.readTime=l,this.createTime=u,this.data=p,this.documentState=y}static newInvalidDocument(e){return new pc(e,0,ur.min(),ur.min(),ur.min(),Tl.empty(),0)}static newFoundDocument(e,i,o,l){return new pc(e,1,i,ur.min(),o,l,0)}static newNoDocument(e,i){return new pc(e,2,i,ur.min(),ur.min(),Tl.empty(),0)}static newUnknownDocument(e,i){return new pc(e,3,i,ur.min(),ur.min(),Tl.empty(),2)}convertToFoundDocument(e,i){return!this.createTime.isEqual(ur.min())||this.documentType!==2&&this.documentType!==0||(this.createTime=e),this.version=e,this.documentType=1,this.data=i,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=Tl.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=Tl.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=ur.min(),this}setReadTime(e){return this.readTime=e,this}get hasLocalMutations(){return this.documentState===1}get hasCommittedMutations(){return this.documentState===2}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return this.documentType!==0}isFoundDocument(){return this.documentType===1}isNoDocument(){return this.documentType===2}isUnknownDocument(){return this.documentType===3}isEqual(e){return e instanceof pc&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}mutableCopy(){return new pc(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class QS{constructor(e,i){this.position=e,this.inclusive=i}}function cQ(n,e,i){let o=0;for(let l=0;l<n.position.length;l++){const u=e[l],p=n.position[l];if(u.field.isKeyField()?o=kn.comparator(kn.fromName(p.referenceValue),i.key):o=XS(p,i.data.field(u.field)),u.dir==="desc"&&(o*=-1),o!==0)break}return o}function lQ(n,e){if(n===null)return e===null;if(e===null||n.inclusive!==e.inclusive||n.position.length!==e.position.length)return!1;for(let i=0;i<n.position.length;i++)if(!$p(n.position[i],e.position[i]))return!1;return!0}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class NR{constructor(e,i="asc"){this.field=e,this.dir=i}}function H3e(n,e){return n.dir===e.dir&&n.field.isEqual(e.field)}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Hse{}class ko extends Hse{constructor(e,i,o){super(),this.field=e,this.op=i,this.value=o}static create(e,i,o){return e.isKeyField()?i==="in"||i==="not-in"?this.createKeyFieldInFilter(e,i,o):new K3e(e,i,o):i==="array-contains"?new X3e(e,o):i==="in"?new J3e(e,o):i==="not-in"?new Q3e(e,o):i==="array-contains-any"?new Z3e(e,o):new ko(e,i,o)}static createKeyFieldInFilter(e,i,o){return i==="in"?new q3e(e,o):new Y3e(e,o)}matches(e){const i=e.data.field(this.field);return this.op==="!="?i!==null&&i.nullValue===void 0&&this.matchesComparison(XS(i,this.value)):i!==null&&Kg(this.value)===Kg(i)&&this.matchesComparison(XS(i,this.value))}matchesComparison(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return e===0;case"!=":return e!==0;case">":return e>0;case">=":return e>=0;default:return er(47266,{operator:this.op})}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}}class bh extends Hse{constructor(e,i){super(),this.filters=e,this.op=i,this.he=null}static create(e,i){return new bh(e,i)}matches(e){return $se(this)?this.filters.find((i=>!i.matches(e)))===void 0:this.filters.find((i=>i.matches(e)))!==void 0}getFlattenedFilters(){return this.he!==null||(this.he=this.filters.reduce(((e,i)=>e.concat(i.getFlattenedFilters())),[])),this.he}getFilters(){return Object.assign([],this.filters)}}function $se(n){return n.op==="and"}function Kse(n){return $3e(n)&&$se(n)}function $3e(n){for(const e of n.filters)if(e instanceof bh)return!1;return!0}function x5(n){if(n instanceof ko)return n.field.canonicalString()+n.op.toString()+JS(n.value);if(Kse(n))return n.filters.map((e=>x5(e))).join(",");{const e=n.filters.map((i=>x5(i))).join(",");return`${n.op}(${e})`}}function qse(n,e){return n instanceof ko?(function(o,l){return l instanceof ko&&o.op===l.op&&o.field.isEqual(l.field)&&$p(o.value,l.value)})(n,e):n instanceof bh?(function(o,l){return l instanceof bh&&o.op===l.op&&o.filters.length===l.filters.length?o.filters.reduce(((u,p,y)=>u&&qse(p,l.filters[y])),!0):!1})(n,e):void er(19439)}function Yse(n){return n instanceof ko?(function(i){return`${i.field.canonicalString()} ${i.op} ${JS(i.value)}`})(n):n instanceof bh?(function(i){return i.op.toString()+" {"+i.getFilters().map(Yse).join(" ,")+"}"})(n):"Filter"}class K3e extends ko{constructor(e,i,o){super(e,i,o),this.key=kn.fromName(o.referenceValue)}matches(e){const i=kn.comparator(e.key,this.key);return this.matchesComparison(i)}}class q3e extends ko{constructor(e,i){super(e,"in",i),this.keys=Xse("in",i)}matches(e){return this.keys.some((i=>i.isEqual(e.key)))}}class Y3e extends ko{constructor(e,i){super(e,"not-in",i),this.keys=Xse("not-in",i)}matches(e){return!this.keys.some((i=>i.isEqual(e.key)))}}function Xse(n,e){var i;return(((i=e.arrayValue)===null||i===void 0?void 0:i.values)||[]).map((o=>kn.fromName(o.referenceValue)))}class X3e extends ko{constructor(e,i){super(e,"array-contains",i)}matches(e){const i=e.data.field(this.field);return t3(i)&&kR(i.arrayValue,this.value)}}class J3e extends ko{constructor(e,i){super(e,"in",i)}matches(e){const i=e.data.field(this.field);return i!==null&&kR(this.value.arrayValue,i)}}class Q3e extends ko{constructor(e,i){super(e,"not-in",i)}matches(e){if(kR(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;const i=e.data.field(this.field);return i!==null&&i.nullValue===void 0&&!kR(this.value.arrayValue,i)}}class Z3e extends ko{constructor(e,i){super(e,"array-contains-any",i)}matches(e){const i=e.data.field(this.field);return!(!t3(i)||!i.arrayValue.values)&&i.arrayValue.values.some((o=>kR(this.value.arrayValue,o)))}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class e4e{constructor(e,i=null,o=[],l=[],u=null,p=null,y=null){this.path=e,this.collectionGroup=i,this.orderBy=o,this.filters=l,this.limit=u,this.startAt=p,this.endAt=y,this.Pe=null}}function uQ(n,e=null,i=[],o=[],l=null,u=null,p=null){return new e4e(n,e,i,o,l,u,p)}function n3(n){const e=fr(n);if(e.Pe===null){let i=e.path.canonicalString();e.collectionGroup!==null&&(i+="|cg:"+e.collectionGroup),i+="|f:",i+=e.filters.map((o=>x5(o))).join(","),i+="|ob:",i+=e.orderBy.map((o=>(function(u){return u.field.canonicalString()+u.dir})(o))).join(","),jN(e.limit)||(i+="|l:",i+=e.limit),e.startAt&&(i+="|lb:",i+=e.startAt.inclusive?"b:":"a:",i+=e.startAt.position.map((o=>JS(o))).join(",")),e.endAt&&(i+="|ub:",i+=e.endAt.inclusive?"a:":"b:",i+=e.endAt.position.map((o=>JS(o))).join(",")),e.Pe=i}return e.Pe}function r3(n,e){if(n.limit!==e.limit||n.orderBy.length!==e.orderBy.length)return!1;for(let i=0;i<n.orderBy.length;i++)if(!H3e(n.orderBy[i],e.orderBy[i]))return!1;if(n.filters.length!==e.filters.length)return!1;for(let i=0;i<n.filters.length;i++)if(!qse(n.filters[i],e.filters[i]))return!1;return n.collectionGroup===e.collectionGroup&&!!n.path.isEqual(e.path)&&!!lQ(n.startAt,e.startAt)&&lQ(n.endAt,e.endAt)}function D5(n){return kn.isDocumentKey(n.path)&&n.collectionGroup===null&&n.filters.length===0}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class CE{constructor(e,i=null,o=[],l=[],u=null,p="F",y=null,E=null){this.path=e,this.collectionGroup=i,this.explicitOrderBy=o,this.filters=l,this.limit=u,this.limitType=p,this.startAt=y,this.endAt=E,this.Te=null,this.Ie=null,this.de=null,this.startAt,this.endAt}}function t4e(n,e,i,o,l,u,p,y){return new CE(n,e,i,o,l,u,p,y)}function zN(n){return new CE(n)}function dQ(n){return n.filters.length===0&&n.limit===null&&n.startAt==null&&n.endAt==null&&(n.explicitOrderBy.length===0||n.explicitOrderBy.length===1&&n.explicitOrderBy[0].field.isKeyField())}function i3(n){return n.collectionGroup!==null}function NS(n){const e=fr(n);if(e.Te===null){e.Te=[];const i=new Set;for(const u of e.explicitOrderBy)e.Te.push(u),i.add(u.field.canonicalString());const o=e.explicitOrderBy.length>0?e.explicitOrderBy[e.explicitOrderBy.length-1].dir:"asc";(function(p){let y=new Jo(Fa.comparator);return p.filters.forEach((E=>{E.getFlattenedFilters().forEach((b=>{b.isInequality()&&(y=y.add(b.field))}))})),y})(e).forEach((u=>{i.has(u.canonicalString())||u.isKeyField()||e.Te.push(new NR(u,o))})),i.has(Fa.keyField().canonicalString())||e.Te.push(new NR(Fa.keyField(),o))}return e.Te}function Bp(n){const e=fr(n);return e.Ie||(e.Ie=n4e(e,NS(n))),e.Ie}function n4e(n,e){if(n.limitType==="F")return uQ(n.path,n.collectionGroup,e,n.filters,n.limit,n.startAt,n.endAt);{e=e.map((l=>{const u=l.dir==="desc"?"asc":"desc";return new NR(l.field,u)}));const i=n.endAt?new QS(n.endAt.position,n.endAt.inclusive):null,o=n.startAt?new QS(n.startAt.position,n.startAt.inclusive):null;return uQ(n.path,n.collectionGroup,e,n.filters,n.limit,i,o)}}function L5(n,e){const i=n.filters.concat([e]);return new CE(n.path,n.collectionGroup,n.explicitOrderBy.slice(),i,n.limit,n.limitType,n.startAt,n.endAt)}function Vk(n,e,i){return new CE(n.path,n.collectionGroup,n.explicitOrderBy.slice(),n.filters.slice(),e,i,n.startAt,n.endAt)}function WN(n,e){return r3(Bp(n),Bp(e))&&n.limitType===e.limitType}function Jse(n){return`${n3(Bp(n))}|lt:${n.limitType}`}function q0(n){return`Query(target=${(function(i){let o=i.path.canonicalString();return i.collectionGroup!==null&&(o+=" collectionGroup="+i.collectionGroup),i.filters.length>0&&(o+=`, filters: [${i.filters.map((l=>Yse(l))).join(", ")}]`),jN(i.limit)||(o+=", limit: "+i.limit),i.orderBy.length>0&&(o+=`, orderBy: [${i.orderBy.map((l=>(function(p){return`${p.field.canonicalString()} (${p.dir})`})(l))).join(", ")}]`),i.startAt&&(o+=", startAt: ",o+=i.startAt.inclusive?"b:":"a:",o+=i.startAt.position.map((l=>JS(l))).join(",")),i.endAt&&(o+=", endAt: ",o+=i.endAt.inclusive?"a:":"b:",o+=i.endAt.position.map((l=>JS(l))).join(",")),`Target(${o})`})(Bp(n))}; limitType=${n.limitType})`}function GN(n,e){return e.isFoundDocument()&&(function(o,l){const u=l.key.path;return o.collectionGroup!==null?l.key.hasCollectionId(o.collectionGroup)&&o.path.isPrefixOf(u):kn.isDocumentKey(o.path)?o.path.isEqual(u):o.path.isImmediateParentOf(u)})(n,e)&&(function(o,l){for(const u of NS(o))if(!u.field.isKeyField()&&l.data.field(u.field)===null)return!1;return!0})(n,e)&&(function(o,l){for(const u of o.filters)if(!u.matches(l))return!1;return!0})(n,e)&&(function(o,l){return!(o.startAt&&!(function(p,y,E){const b=cQ(p,y,E);return p.inclusive?b<=0:b<0})(o.startAt,NS(o),l)||o.endAt&&!(function(p,y,E){const b=cQ(p,y,E);return p.inclusive?b>=0:b>0})(o.endAt,NS(o),l))})(n,e)}function r4e(n){return n.collectionGroup||(n.path.length%2==1?n.path.lastSegment():n.path.get(n.path.length-2))}function Qse(n){return(e,i)=>{let o=!1;for(const l of NS(n)){const u=i4e(l,e,i);if(u!==0)return u;o=o||l.field.isKeyField()}return 0}}function i4e(n,e,i){const o=n.field.isKeyField()?kn.comparator(e.key,i.key):(function(u,p,y){const E=p.data.field(u),b=y.data.field(u);return E!==null&&b!==null?XS(E,b):er(42886)})(n.field,e,i);switch(n.dir){case"asc":return o;case"desc":return-1*o;default:return er(19790,{direction:n.dir})}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class RE{constructor(e,i){this.mapKeyFn=e,this.equalsFn=i,this.inner={},this.innerSize=0}get(e){const i=this.mapKeyFn(e),o=this.inner[i];if(o!==void 0){for(const[l,u]of o)if(this.equalsFn(l,e))return u}}has(e){return this.get(e)!==void 0}set(e,i){const o=this.mapKeyFn(e),l=this.inner[o];if(l===void 0)return this.inner[o]=[[e,i]],void this.innerSize++;for(let u=0;u<l.length;u++)if(this.equalsFn(l[u][0],e))return void(l[u]=[e,i]);l.push([e,i]),this.innerSize++}delete(e){const i=this.mapKeyFn(e),o=this.inner[i];if(o===void 0)return!1;for(let l=0;l<o.length;l++)if(this.equalsFn(o[l][0],e))return o.length===1?delete this.inner[i]:o.splice(l,1),this.innerSize--,!0;return!1}forEach(e){t_(this.inner,((i,o)=>{for(const[l,u]of o)e(l,u)}))}isEmpty(){return Mse(this.inner)}size(){return this.innerSize}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const s4e=new xs(kn.comparator);function sm(){return s4e}const Zse=new xs(kn.comparator);function kC(...n){let e=Zse;for(const i of n)e=e.insert(i.key,i);return e}function eoe(n){let e=Zse;return n.forEach(((i,o)=>e=e.insert(i,o.overlayedDocument))),e}function jy(){return QC()}function toe(){return QC()}function QC(){return new RE((n=>n.toString()),((n,e)=>n.isEqual(e)))}const o4e=new xs(kn.comparator),a4e=new Jo(kn.comparator);function Wr(...n){let e=a4e;for(const i of n)e=e.add(i);return e}const c4e=new Jo(kr);function l4e(){return c4e}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function s3(n,e){if(n.useProto3Json){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:Dk(e)?"-0":e}}function noe(n){return{integerValue:""+n}}function u4e(n,e){return U3e(e)?noe(e):s3(n,e)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class HN{constructor(){this._=void 0}}function d4e(n,e,i){return n instanceof jk?(function(l,u){const p={fields:{[jse]:{stringValue:Vse},[Bse]:{timestampValue:{seconds:l.seconds,nanos:l.nanoseconds}}}};return u&&FN(u)&&(u=BN(u)),u&&(p.fields[Fse]=u),{mapValue:p}})(i,e):n instanceof ZS?ioe(n,e):n instanceof eb?soe(n,e):(function(l,u){const p=roe(l,u),y=hQ(p)+hQ(l.Ee);return N5(p)&&N5(l.Ee)?noe(y):s3(l.serializer,y)})(n,e)}function h4e(n,e,i){return n instanceof ZS?ioe(n,e):n instanceof eb?soe(n,e):i}function roe(n,e){return n instanceof Fk?(function(o){return N5(o)||(function(u){return!!u&&"doubleValue"in u})(o)})(e)?e:{integerValue:0}:null}class jk extends HN{}class ZS extends HN{constructor(e){super(),this.elements=e}}function ioe(n,e){const i=ooe(e);for(const o of n.elements)i.some((l=>$p(l,o)))||i.push(o);return{arrayValue:{values:i}}}class eb extends HN{constructor(e){super(),this.elements=e}}function soe(n,e){let i=ooe(e);for(const o of n.elements)i=i.filter((l=>!$p(l,o)));return{arrayValue:{values:i}}}class Fk extends HN{constructor(e,i){super(),this.serializer=e,this.Ee=i}}function hQ(n){return po(n.integerValue||n.doubleValue)}function ooe(n){return t3(n)&&n.arrayValue.values?n.arrayValue.values.slice():[]}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class aoe{constructor(e,i){this.field=e,this.transform=i}}function p4e(n,e){return n.field.isEqual(e.field)&&(function(o,l){return o instanceof ZS&&l instanceof ZS||o instanceof eb&&l instanceof eb?YS(o.elements,l.elements,$p):o instanceof Fk&&l instanceof Fk?$p(o.Ee,l.Ee):o instanceof jk&&l instanceof jk})(n.transform,e.transform)}class f4e{constructor(e,i){this.version=e,this.transformResults=i}}class gd{constructor(e,i){this.updateTime=e,this.exists=i}static none(){return new gd}static exists(e){return new gd(void 0,e)}static updateTime(e){return new gd(e)}get isNone(){return this.updateTime===void 0&&this.exists===void 0}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}}function tk(n,e){return n.updateTime!==void 0?e.isFoundDocument()&&e.version.isEqual(n.updateTime):n.exists===void 0||n.exists===e.isFoundDocument()}class $N{}function coe(n,e){if(!n.hasLocalMutations||e&&e.fields.length===0)return null;if(e===null)return n.isNoDocument()?new o3(n.key,gd.none()):new aI(n.key,n.data,gd.none());{const i=n.data,o=Tl.empty();let l=new Jo(Fa.comparator);for(let u of e.fields)if(!l.has(u)){let p=i.field(u);p===null&&u.length>1&&(u=u.popLast(),p=i.field(u)),p===null?o.delete(u):o.set(u,p),l=l.add(u)}return new n_(n.key,o,new pu(l.toArray()),gd.none())}}function m4e(n,e,i){n instanceof aI?(function(l,u,p){const y=l.value.clone(),E=fQ(l.fieldTransforms,u,p.transformResults);y.setAll(E),u.convertToFoundDocument(p.version,y).setHasCommittedMutations()})(n,e,i):n instanceof n_?(function(l,u,p){if(!tk(l.precondition,u))return void u.convertToUnknownDocument(p.version);const y=fQ(l.fieldTransforms,u,p.transformResults),E=u.data;E.setAll(loe(l)),E.setAll(y),u.convertToFoundDocument(p.version,E).setHasCommittedMutations()})(n,e,i):(function(l,u,p){u.convertToNoDocument(p.version).setHasCommittedMutations()})(0,e,i)}function ZC(n,e,i,o){return n instanceof aI?(function(u,p,y,E){if(!tk(u.precondition,p))return y;const b=u.value.clone(),T=mQ(u.fieldTransforms,E,p);return b.setAll(T),p.convertToFoundDocument(p.version,b).setHasLocalMutations(),null})(n,e,i,o):n instanceof n_?(function(u,p,y,E){if(!tk(u.precondition,p))return y;const b=mQ(u.fieldTransforms,E,p),T=p.data;return T.setAll(loe(u)),T.setAll(b),p.convertToFoundDocument(p.version,T).setHasLocalMutations(),y===null?null:y.unionWith(u.fieldMask.fields).unionWith(u.fieldTransforms.map((R=>R.field)))})(n,e,i,o):(function(u,p,y){return tk(u.precondition,p)?(p.convertToNoDocument(p.version).setHasLocalMutations(),null):y})(n,e,i)}function g4e(n,e){let i=null;for(const o of n.fieldTransforms){const l=e.data.field(o.field),u=roe(o.transform,l||null);u!=null&&(i===null&&(i=Tl.empty()),i.set(o.field,u))}return i||null}function pQ(n,e){return n.type===e.type&&!!n.key.isEqual(e.key)&&!!n.precondition.isEqual(e.precondition)&&!!(function(o,l){return o===void 0&&l===void 0||!(!o||!l)&&YS(o,l,((u,p)=>p4e(u,p)))})(n.fieldTransforms,e.fieldTransforms)&&(n.type===0?n.value.isEqual(e.value):n.type!==1||n.data.isEqual(e.data)&&n.fieldMask.isEqual(e.fieldMask))}class aI extends $N{constructor(e,i,o,l=[]){super(),this.key=e,this.value=i,this.precondition=o,this.fieldTransforms=l,this.type=0}getFieldMask(){return null}}class n_ extends $N{constructor(e,i,o,l,u=[]){super(),this.key=e,this.data=i,this.fieldMask=o,this.precondition=l,this.fieldTransforms=u,this.type=1}getFieldMask(){return this.fieldMask}}function loe(n){const e=new Map;return n.fieldMask.fields.forEach((i=>{if(!i.isEmpty()){const o=n.data.field(i);e.set(i,o)}})),e}function fQ(n,e,i){const o=new Map;Ci(n.length===i.length,32656,{Ae:i.length,Re:n.length});for(let l=0;l<i.length;l++){const u=n[l],p=u.transform,y=e.data.field(u.field);o.set(u.field,h4e(p,y,i[l]))}return o}function mQ(n,e,i){const o=new Map;for(const l of n){const u=l.transform,p=i.data.field(l.field);o.set(l.field,d4e(u,p,e))}return o}class o3 extends $N{constructor(e,i){super(),this.key=e,this.precondition=i,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}}class _4e extends $N{constructor(e,i){super(),this.key=e,this.precondition=i,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class y4e{constructor(e,i,o,l){this.batchId=e,this.localWriteTime=i,this.baseMutations=o,this.mutations=l}applyToRemoteDocument(e,i){const o=i.mutationResults;for(let l=0;l<this.mutations.length;l++){const u=this.mutations[l];u.key.isEqual(e.key)&&m4e(u,e,o[l])}}applyToLocalView(e,i){for(const o of this.baseMutations)o.key.isEqual(e.key)&&(i=ZC(o,e,i,this.localWriteTime));for(const o of this.mutations)o.key.isEqual(e.key)&&(i=ZC(o,e,i,this.localWriteTime));return i}applyToLocalDocumentSet(e,i){const o=toe();return this.mutations.forEach((l=>{const u=e.get(l.key),p=u.overlayedDocument;let y=this.applyToLocalView(p,u.mutatedFields);y=i.has(l.key)?null:y;const E=coe(p,y);E!==null&&o.set(l.key,E),p.isValidDocument()||p.convertToNoDocument(ur.min())})),o}keys(){return this.mutations.reduce(((e,i)=>e.add(i.key)),Wr())}isEqual(e){return this.batchId===e.batchId&&YS(this.mutations,e.mutations,((i,o)=>pQ(i,o)))&&YS(this.baseMutations,e.baseMutations,((i,o)=>pQ(i,o)))}}class a3{constructor(e,i,o,l){this.batch=e,this.commitVersion=i,this.mutationResults=o,this.docVersions=l}static from(e,i,o){Ci(e.mutations.length===o.length,58842,{Ve:e.mutations.length,me:o.length});let l=(function(){return o4e})();const u=e.mutations;for(let p=0;p<u.length;p++)l=l.insert(u[p].key,o[p].version);return new a3(e,i,o,l)}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class E4e{constructor(e,i){this.largestBatchId=e,this.mutation=i}getKey(){return this.mutation.key}isEqual(e){return e!==null&&this.mutation===e.mutation}toString(){return`Overlay{
      largestBatchId: ${this.largestBatchId},
      mutation: ${this.mutation.toString()}
    }`}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class v4e{constructor(e,i){this.count=e,this.unchangedNames=i}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Io,ti;function S4e(n){switch(n){case Et.OK:return er(64938);case Et.CANCELLED:case Et.UNKNOWN:case Et.DEADLINE_EXCEEDED:case Et.RESOURCE_EXHAUSTED:case Et.INTERNAL:case Et.UNAVAILABLE:case Et.UNAUTHENTICATED:return!1;case Et.INVALID_ARGUMENT:case Et.NOT_FOUND:case Et.ALREADY_EXISTS:case Et.PERMISSION_DENIED:case Et.FAILED_PRECONDITION:case Et.ABORTED:case Et.OUT_OF_RANGE:case Et.UNIMPLEMENTED:case Et.DATA_LOSS:return!0;default:return er(15467,{code:n})}}function uoe(n){if(n===void 0)return im("GRPC error has no .code"),Et.UNKNOWN;switch(n){case Io.OK:return Et.OK;case Io.CANCELLED:return Et.CANCELLED;case Io.UNKNOWN:return Et.UNKNOWN;case Io.DEADLINE_EXCEEDED:return Et.DEADLINE_EXCEEDED;case Io.RESOURCE_EXHAUSTED:return Et.RESOURCE_EXHAUSTED;case Io.INTERNAL:return Et.INTERNAL;case Io.UNAVAILABLE:return Et.UNAVAILABLE;case Io.UNAUTHENTICATED:return Et.UNAUTHENTICATED;case Io.INVALID_ARGUMENT:return Et.INVALID_ARGUMENT;case Io.NOT_FOUND:return Et.NOT_FOUND;case Io.ALREADY_EXISTS:return Et.ALREADY_EXISTS;case Io.PERMISSION_DENIED:return Et.PERMISSION_DENIED;case Io.FAILED_PRECONDITION:return Et.FAILED_PRECONDITION;case Io.ABORTED:return Et.ABORTED;case Io.OUT_OF_RANGE:return Et.OUT_OF_RANGE;case Io.UNIMPLEMENTED:return Et.UNIMPLEMENTED;case Io.DATA_LOSS:return Et.DATA_LOSS;default:return er(39323,{code:n})}}(ti=Io||(Io={}))[ti.OK=0]="OK",ti[ti.CANCELLED=1]="CANCELLED",ti[ti.UNKNOWN=2]="UNKNOWN",ti[ti.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",ti[ti.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",ti[ti.NOT_FOUND=5]="NOT_FOUND",ti[ti.ALREADY_EXISTS=6]="ALREADY_EXISTS",ti[ti.PERMISSION_DENIED=7]="PERMISSION_DENIED",ti[ti.UNAUTHENTICATED=16]="UNAUTHENTICATED",ti[ti.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",ti[ti.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",ti[ti.ABORTED=10]="ABORTED",ti[ti.OUT_OF_RANGE=11]="OUT_OF_RANGE",ti[ti.UNIMPLEMENTED=12]="UNIMPLEMENTED",ti[ti.INTERNAL=13]="INTERNAL",ti[ti.UNAVAILABLE=14]="UNAVAILABLE",ti[ti.DATA_LOSS=15]="DATA_LOSS";/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const b4e=new Ug([4294967295,4294967295],0);function gQ(n){const e=Nse().encode(n),i=new Tse;return i.update(e),new Uint8Array(i.digest())}function _Q(n){const e=new DataView(n.buffer),i=e.getUint32(0,!0),o=e.getUint32(4,!0),l=e.getUint32(8,!0),u=e.getUint32(12,!0);return[new Ug([i,o],0),new Ug([l,u],0)]}class c3{constructor(e,i,o){if(this.bitmap=e,this.padding=i,this.hashCount=o,i<0||i>=8)throw new NC(`Invalid padding: ${i}`);if(o<0)throw new NC(`Invalid hash count: ${o}`);if(e.length>0&&this.hashCount===0)throw new NC(`Invalid hash count: ${o}`);if(e.length===0&&i!==0)throw new NC(`Invalid padding when bitmap length is 0: ${i}`);this.fe=8*e.length-i,this.ge=Ug.fromNumber(this.fe)}pe(e,i,o){let l=e.add(i.multiply(Ug.fromNumber(o)));return l.compare(b4e)===1&&(l=new Ug([l.getBits(0),l.getBits(1)],0)),l.modulo(this.ge).toNumber()}ye(e){return!!(this.bitmap[Math.floor(e/8)]&1<<e%8)}mightContain(e){if(this.fe===0)return!1;const i=gQ(e),[o,l]=_Q(i);for(let u=0;u<this.hashCount;u++){const p=this.pe(o,l,u);if(!this.ye(p))return!1}return!0}static create(e,i,o){const l=e%8==0?0:8-e%8,u=new Uint8Array(Math.ceil(e/8)),p=new c3(u,l,i);return o.forEach((y=>p.insert(y))),p}insert(e){if(this.fe===0)return;const i=gQ(e),[o,l]=_Q(i);for(let u=0;u<this.hashCount;u++){const p=this.pe(o,l,u);this.we(p)}}we(e){const i=Math.floor(e/8),o=e%8;this.bitmap[i]|=1<<o}}class NC extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class KN{constructor(e,i,o,l,u){this.snapshotVersion=e,this.targetChanges=i,this.targetMismatches=o,this.documentUpdates=l,this.resolvedLimboDocuments=u}static createSynthesizedRemoteEventForCurrentChange(e,i,o){const l=new Map;return l.set(e,cI.createSynthesizedTargetChangeForCurrentChange(e,i,o)),new KN(ur.min(),l,new xs(kr),sm(),Wr())}}class cI{constructor(e,i,o,l,u){this.resumeToken=e,this.current=i,this.addedDocuments=o,this.modifiedDocuments=l,this.removedDocuments=u}static createSynthesizedTargetChangeForCurrentChange(e,i,o){return new cI(o,i,Wr(),Wr(),Wr())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class nk{constructor(e,i,o,l){this.Se=e,this.removedTargetIds=i,this.key=o,this.be=l}}class doe{constructor(e,i){this.targetId=e,this.De=i}}class hoe{constructor(e,i,o=Ba.EMPTY_BYTE_STRING,l=null){this.state=e,this.targetIds=i,this.resumeToken=o,this.cause=l}}class yQ{constructor(){this.ve=0,this.Ce=EQ(),this.Fe=Ba.EMPTY_BYTE_STRING,this.Me=!1,this.xe=!0}get current(){return this.Me}get resumeToken(){return this.Fe}get Oe(){return this.ve!==0}get Ne(){return this.xe}Be(e){e.approximateByteSize()>0&&(this.xe=!0,this.Fe=e)}Le(){let e=Wr(),i=Wr(),o=Wr();return this.Ce.forEach(((l,u)=>{switch(u){case 0:e=e.add(l);break;case 2:i=i.add(l);break;case 1:o=o.add(l);break;default:er(38017,{changeType:u})}})),new cI(this.Fe,this.Me,e,i,o)}ke(){this.xe=!1,this.Ce=EQ()}qe(e,i){this.xe=!0,this.Ce=this.Ce.insert(e,i)}Qe(e){this.xe=!0,this.Ce=this.Ce.remove(e)}$e(){this.ve+=1}Ue(){this.ve-=1,Ci(this.ve>=0,3241,{ve:this.ve})}Ke(){this.xe=!0,this.Me=!0}}class w4e{constructor(e){this.We=e,this.Ge=new Map,this.ze=sm(),this.je=EO(),this.Je=EO(),this.He=new xs(kr)}Ye(e){for(const i of e.Se)e.be&&e.be.isFoundDocument()?this.Ze(i,e.be):this.Xe(i,e.key,e.be);for(const i of e.removedTargetIds)this.Xe(i,e.key,e.be)}et(e){this.forEachTarget(e,(i=>{const o=this.tt(i);switch(e.state){case 0:this.nt(i)&&o.Be(e.resumeToken);break;case 1:o.Ue(),o.Oe||o.ke(),o.Be(e.resumeToken);break;case 2:o.Ue(),o.Oe||this.removeTarget(i);break;case 3:this.nt(i)&&(o.Ke(),o.Be(e.resumeToken));break;case 4:this.nt(i)&&(this.rt(i),o.Be(e.resumeToken));break;default:er(56790,{state:e.state})}}))}forEachTarget(e,i){e.targetIds.length>0?e.targetIds.forEach(i):this.Ge.forEach(((o,l)=>{this.nt(l)&&i(l)}))}it(e){const i=e.targetId,o=e.De.count,l=this.st(i);if(l){const u=l.target;if(D5(u))if(o===0){const p=new kn(u.path);this.Xe(i,p,pc.newNoDocument(p,ur.min()))}else Ci(o===1,20013,{expectedCount:o});else{const p=this.ot(i);if(p!==o){const y=this._t(e),E=y?this.ut(y,e,p):1;if(E!==0){this.rt(i);const b=E===2?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch";this.He=this.He.insert(i,b)}}}}}_t(e){const i=e.De.unchangedNames;if(!i||!i.bits)return null;const{bits:{bitmap:o="",padding:l=0},hashCount:u=0}=i;let p,y;try{p=$g(o).toUint8Array()}catch(E){if(E instanceof Use)return Wg("Decoding the base64 bloom filter in existence filter failed ("+E.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw E}try{y=new c3(p,l,u)}catch(E){return Wg(E instanceof NC?"BloomFilter error: ":"Applying bloom filter failed: ",E),null}return y.fe===0?null:y}ut(e,i,o){return i.De.count===o-this.ht(e,i.targetId)?0:2}ht(e,i){const o=this.We.getRemoteKeysForTarget(i);let l=0;return o.forEach((u=>{const p=this.We.lt(),y=`projects/${p.projectId}/databases/${p.database}/documents/${u.path.canonicalString()}`;e.mightContain(y)||(this.Xe(i,u,null),l++)})),l}Pt(e){const i=new Map;this.Ge.forEach(((u,p)=>{const y=this.st(p);if(y){if(u.current&&D5(y.target)){const E=new kn(y.target.path);this.Tt(E).has(p)||this.It(p,E)||this.Xe(p,E,pc.newNoDocument(E,e))}u.Ne&&(i.set(p,u.Le()),u.ke())}}));let o=Wr();this.Je.forEach(((u,p)=>{let y=!0;p.forEachWhile((E=>{const b=this.st(E);return!b||b.purpose==="TargetPurposeLimboResolution"||(y=!1,!1)})),y&&(o=o.add(u))})),this.ze.forEach(((u,p)=>p.setReadTime(e)));const l=new KN(e,i,this.He,this.ze,o);return this.ze=sm(),this.je=EO(),this.Je=EO(),this.He=new xs(kr),l}Ze(e,i){if(!this.nt(e))return;const o=this.It(e,i.key)?2:0;this.tt(e).qe(i.key,o),this.ze=this.ze.insert(i.key,i),this.je=this.je.insert(i.key,this.Tt(i.key).add(e)),this.Je=this.Je.insert(i.key,this.dt(i.key).add(e))}Xe(e,i,o){if(!this.nt(e))return;const l=this.tt(e);this.It(e,i)?l.qe(i,1):l.Qe(i),this.Je=this.Je.insert(i,this.dt(i).delete(e)),this.Je=this.Je.insert(i,this.dt(i).add(e)),o&&(this.ze=this.ze.insert(i,o))}removeTarget(e){this.Ge.delete(e)}ot(e){const i=this.tt(e).Le();return this.We.getRemoteKeysForTarget(e).size+i.addedDocuments.size-i.removedDocuments.size}$e(e){this.tt(e).$e()}tt(e){let i=this.Ge.get(e);return i||(i=new yQ,this.Ge.set(e,i)),i}dt(e){let i=this.Je.get(e);return i||(i=new Jo(kr),this.Je=this.Je.insert(e,i)),i}Tt(e){let i=this.je.get(e);return i||(i=new Jo(kr),this.je=this.je.insert(e,i)),i}nt(e){const i=this.st(e)!==null;return i||fn("WatchChangeAggregator","Detected inactive target",e),i}st(e){const i=this.Ge.get(e);return i&&i.Oe?null:this.We.Et(e)}rt(e){this.Ge.set(e,new yQ),this.We.getRemoteKeysForTarget(e).forEach((i=>{this.Xe(e,i,null)}))}It(e,i){return this.We.getRemoteKeysForTarget(e).has(i)}}function EO(){return new xs(kn.comparator)}function EQ(){return new xs(kn.comparator)}const T4e={asc:"ASCENDING",desc:"DESCENDING"},C4e={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},R4e={and:"AND",or:"OR"};class I4e{constructor(e,i){this.databaseId=e,this.useProto3Json=i}}function M5(n,e){return n.useProto3Json||jN(e)?e:{value:e}}function Bk(n,e){return n.useProto3Json?`${new Date(1e3*e.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+e.nanoseconds).slice(-9)}Z`:{seconds:""+e.seconds,nanos:e.nanoseconds}}function poe(n,e){return n.useProto3Json?e.toBase64():e.toUint8Array()}function A4e(n,e){return Bk(n,e.toTimestamp())}function zp(n){return Ci(!!n,49232),ur.fromTimestamp((function(i){const o=Hg(i);return new ls(o.seconds,o.nanos)})(n))}function l3(n,e){return U5(n,e).canonicalString()}function U5(n,e){const i=(function(l){return new qi(["projects",l.projectId,"databases",l.database])})(n).child("documents");return e===void 0?i:i.child(e)}function foe(n){const e=qi.fromString(n);return Ci(Eoe(e),10190,{key:e.toString()}),e}function V5(n,e){return l3(n.databaseId,e.path)}function pV(n,e){const i=foe(e);if(i.get(1)!==n.databaseId.projectId)throw new Xt(Et.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+i.get(1)+" vs "+n.databaseId.projectId);if(i.get(3)!==n.databaseId.database)throw new Xt(Et.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+i.get(3)+" vs "+n.databaseId.database);return new kn(goe(i))}function moe(n,e){return l3(n.databaseId,e)}function P4e(n){const e=foe(n);return e.length===4?qi.emptyPath():goe(e)}function j5(n){return new qi(["projects",n.databaseId.projectId,"databases",n.databaseId.database]).canonicalString()}function goe(n){return Ci(n.length>4&&n.get(4)==="documents",29091,{key:n.toString()}),n.popFirst(5)}function vQ(n,e,i){return{name:V5(n,e),fields:i.value.mapValue.fields}}function O4e(n,e){let i;if("targetChange"in e){e.targetChange;const o=(function(b){return b==="NO_CHANGE"?0:b==="ADD"?1:b==="REMOVE"?2:b==="CURRENT"?3:b==="RESET"?4:er(39313,{state:b})})(e.targetChange.targetChangeType||"NO_CHANGE"),l=e.targetChange.targetIds||[],u=(function(b,T){return b.useProto3Json?(Ci(T===void 0||typeof T=="string",58123),Ba.fromBase64String(T||"")):(Ci(T===void 0||T instanceof Buffer||T instanceof Uint8Array,16193),Ba.fromUint8Array(T||new Uint8Array))})(n,e.targetChange.resumeToken),p=e.targetChange.cause,y=p&&(function(b){const T=b.code===void 0?Et.UNKNOWN:uoe(b.code);return new Xt(T,b.message||"")})(p);i=new hoe(o,l,u,y||null)}else if("documentChange"in e){e.documentChange;const o=e.documentChange;o.document,o.document.name,o.document.updateTime;const l=pV(n,o.document.name),u=zp(o.document.updateTime),p=o.document.createTime?zp(o.document.createTime):ur.min(),y=new Tl({mapValue:{fields:o.document.fields}}),E=pc.newFoundDocument(l,u,p,y),b=o.targetIds||[],T=o.removedTargetIds||[];i=new nk(b,T,E.key,E)}else if("documentDelete"in e){e.documentDelete;const o=e.documentDelete;o.document;const l=pV(n,o.document),u=o.readTime?zp(o.readTime):ur.min(),p=pc.newNoDocument(l,u),y=o.removedTargetIds||[];i=new nk([],y,p.key,p)}else if("documentRemove"in e){e.documentRemove;const o=e.documentRemove;o.document;const l=pV(n,o.document),u=o.removedTargetIds||[];i=new nk([],u,l,null)}else{if(!("filter"in e))return er(11601,{At:e});{e.filter;const o=e.filter;o.targetId;const{count:l=0,unchangedNames:u}=o,p=new v4e(l,u),y=o.targetId;i=new doe(y,p)}}return i}function k4e(n,e){let i;if(e instanceof aI)i={update:vQ(n,e.key,e.value)};else if(e instanceof o3)i={delete:V5(n,e.key)};else if(e instanceof n_)i={update:vQ(n,e.key,e.data),updateMask:F4e(e.fieldMask)};else{if(!(e instanceof _4e))return er(16599,{Rt:e.type});i={verify:V5(n,e.key)}}return e.fieldTransforms.length>0&&(i.updateTransforms=e.fieldTransforms.map((o=>(function(u,p){const y=p.transform;if(y instanceof jk)return{fieldPath:p.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(y instanceof ZS)return{fieldPath:p.field.canonicalString(),appendMissingElements:{values:y.elements}};if(y instanceof eb)return{fieldPath:p.field.canonicalString(),removeAllFromArray:{values:y.elements}};if(y instanceof Fk)return{fieldPath:p.field.canonicalString(),increment:y.Ee};throw er(20930,{transform:p.transform})})(0,o)))),e.precondition.isNone||(i.currentDocument=(function(l,u){return u.updateTime!==void 0?{updateTime:A4e(l,u.updateTime)}:u.exists!==void 0?{exists:u.exists}:er(27497)})(n,e.precondition)),i}function N4e(n,e){return n&&n.length>0?(Ci(e!==void 0,14353),n.map((i=>(function(l,u){let p=l.updateTime?zp(l.updateTime):zp(u);return p.isEqual(ur.min())&&(p=zp(u)),new f4e(p,l.transformResults||[])})(i,e)))):[]}function x4e(n,e){return{documents:[moe(n,e.path)]}}function D4e(n,e){const i={structuredQuery:{}},o=e.path;let l;e.collectionGroup!==null?(l=o,i.structuredQuery.from=[{collectionId:e.collectionGroup,allDescendants:!0}]):(l=o.popLast(),i.structuredQuery.from=[{collectionId:o.lastSegment()}]),i.parent=moe(n,l);const u=(function(b){if(b.length!==0)return yoe(bh.create(b,"and"))})(e.filters);u&&(i.structuredQuery.where=u);const p=(function(b){if(b.length!==0)return b.map((T=>(function(O){return{field:Y0(O.field),direction:U4e(O.dir)}})(T)))})(e.orderBy);p&&(i.structuredQuery.orderBy=p);const y=M5(n,e.limit);return y!==null&&(i.structuredQuery.limit=y),e.startAt&&(i.structuredQuery.startAt=(function(b){return{before:b.inclusive,values:b.position}})(e.startAt)),e.endAt&&(i.structuredQuery.endAt=(function(b){return{before:!b.inclusive,values:b.position}})(e.endAt)),{Vt:i,parent:l}}function L4e(n){let e=P4e(n.parent);const i=n.structuredQuery,o=i.from?i.from.length:0;let l=null;if(o>0){Ci(o===1,65062);const T=i.from[0];T.allDescendants?l=T.collectionId:e=e.child(T.collectionId)}let u=[];i.where&&(u=(function(R){const O=_oe(R);return O instanceof bh&&Kse(O)?O.getFilters():[O]})(i.where));let p=[];i.orderBy&&(p=(function(R){return R.map((O=>(function(D){return new NR(X0(D.field),(function(F){switch(F){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}})(D.direction))})(O)))})(i.orderBy));let y=null;i.limit&&(y=(function(R){let O;return O=typeof R=="object"?R.value:R,jN(O)?null:O})(i.limit));let E=null;i.startAt&&(E=(function(R){const O=!!R.before,L=R.values||[];return new QS(L,O)})(i.startAt));let b=null;return i.endAt&&(b=(function(R){const O=!R.before,L=R.values||[];return new QS(L,O)})(i.endAt)),t4e(e,l,p,u,y,"F",E,b)}function M4e(n,e){const i=(function(l){switch(l){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return er(28987,{purpose:l})}})(e.purpose);return i==null?null:{"goog-listen-tags":i}}function _oe(n){return n.unaryFilter!==void 0?(function(i){switch(i.unaryFilter.op){case"IS_NAN":const o=X0(i.unaryFilter.field);return ko.create(o,"==",{doubleValue:NaN});case"IS_NULL":const l=X0(i.unaryFilter.field);return ko.create(l,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":const u=X0(i.unaryFilter.field);return ko.create(u,"!=",{doubleValue:NaN});case"IS_NOT_NULL":const p=X0(i.unaryFilter.field);return ko.create(p,"!=",{nullValue:"NULL_VALUE"});case"OPERATOR_UNSPECIFIED":return er(61313);default:return er(60726)}})(n):n.fieldFilter!==void 0?(function(i){return ko.create(X0(i.fieldFilter.field),(function(l){switch(l){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";case"OPERATOR_UNSPECIFIED":return er(58110);default:return er(50506)}})(i.fieldFilter.op),i.fieldFilter.value)})(n):n.compositeFilter!==void 0?(function(i){return bh.create(i.compositeFilter.filters.map((o=>_oe(o))),(function(l){switch(l){case"AND":return"and";case"OR":return"or";default:return er(1026)}})(i.compositeFilter.op))})(n):er(30097,{filter:n})}function U4e(n){return T4e[n]}function V4e(n){return C4e[n]}function j4e(n){return R4e[n]}function Y0(n){return{fieldPath:n.canonicalString()}}function X0(n){return Fa.fromServerFormat(n.fieldPath)}function yoe(n){return n instanceof ko?(function(i){if(i.op==="=="){if(aQ(i.value))return{unaryFilter:{field:Y0(i.field),op:"IS_NAN"}};if(oQ(i.value))return{unaryFilter:{field:Y0(i.field),op:"IS_NULL"}}}else if(i.op==="!="){if(aQ(i.value))return{unaryFilter:{field:Y0(i.field),op:"IS_NOT_NAN"}};if(oQ(i.value))return{unaryFilter:{field:Y0(i.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:Y0(i.field),op:V4e(i.op),value:i.value}}})(n):n instanceof bh?(function(i){const o=i.getFilters().map((l=>yoe(l)));return o.length===1?o[0]:{compositeFilter:{op:j4e(i.op),filters:o}}})(n):er(54877,{filter:n})}function F4e(n){const e=[];return n.fields.forEach((i=>e.push(i.canonicalString()))),{fieldPaths:e}}function Eoe(n){return n.length>=4&&n.get(0)==="projects"&&n.get(2)==="databases"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Dg{constructor(e,i,o,l,u=ur.min(),p=ur.min(),y=Ba.EMPTY_BYTE_STRING,E=null){this.target=e,this.targetId=i,this.purpose=o,this.sequenceNumber=l,this.snapshotVersion=u,this.lastLimboFreeSnapshotVersion=p,this.resumeToken=y,this.expectedCount=E}withSequenceNumber(e){return new Dg(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(e,i){return new Dg(this.target,this.targetId,this.purpose,this.sequenceNumber,i,this.lastLimboFreeSnapshotVersion,e,null)}withExpectedCount(e){return new Dg(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,e)}withLastLimboFreeSnapshotVersion(e){return new Dg(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken,this.expectedCount)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class B4e{constructor(e){this.gt=e}}function z4e(n){const e=L4e({parent:n.parent,structuredQuery:n.structuredQuery});return n.limitType==="LAST"?Vk(e,e.limit,"L"):e}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class W4e{constructor(){this.Dn=new G4e}addToCollectionParentIndex(e,i){return this.Dn.add(i),At.resolve()}getCollectionParents(e,i){return At.resolve(this.Dn.getEntries(i))}addFieldIndex(e,i){return At.resolve()}deleteFieldIndex(e,i){return At.resolve()}deleteAllFieldIndexes(e){return At.resolve()}createTargetIndexes(e,i){return At.resolve()}getDocumentsMatchingTarget(e,i){return At.resolve(null)}getIndexType(e,i){return At.resolve(0)}getFieldIndexes(e,i){return At.resolve([])}getNextCollectionGroupToUpdate(e){return At.resolve(null)}getMinOffset(e,i){return At.resolve(Gg.min())}getMinOffsetFromCollectionGroup(e,i){return At.resolve(Gg.min())}updateCollectionGroup(e,i,o){return At.resolve()}updateIndexEntries(e,i){return At.resolve()}}class G4e{constructor(){this.index={}}add(e){const i=e.lastSegment(),o=e.popLast(),l=this.index[i]||new Jo(qi.comparator),u=!l.has(o);return this.index[i]=l.add(o),u}has(e){const i=e.lastSegment(),o=e.popLast(),l=this.index[i];return l&&l.has(o)}getEntries(e){return(this.index[e]||new Jo(qi.comparator)).toArray()}}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const SQ={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0},voe=41943040;class Sl{static withCacheSize(e){return new Sl(e,Sl.DEFAULT_COLLECTION_PERCENTILE,Sl.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}constructor(e,i,o){this.cacheSizeCollectionThreshold=e,this.percentileToCollect=i,this.maximumSequenceNumbersToCollect=o}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */Sl.DEFAULT_COLLECTION_PERCENTILE=10,Sl.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,Sl.DEFAULT=new Sl(voe,Sl.DEFAULT_COLLECTION_PERCENTILE,Sl.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),Sl.DISABLED=new Sl(-1,0,0);/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class tb{constructor(e){this._r=e}next(){return this._r+=2,this._r}static ar(){return new tb(0)}static ur(){return new tb(-1)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const bQ="LruGarbageCollector",H4e=1048576;function wQ([n,e],[i,o]){const l=kr(n,i);return l===0?kr(e,o):l}class $4e{constructor(e){this.Tr=e,this.buffer=new Jo(wQ),this.Ir=0}dr(){return++this.Ir}Er(e){const i=[e,this.dr()];if(this.buffer.size<this.Tr)this.buffer=this.buffer.add(i);else{const o=this.buffer.last();wQ(i,o)<0&&(this.buffer=this.buffer.delete(o).add(i))}}get maxValue(){return this.buffer.last()[0]}}class K4e{constructor(e,i,o){this.garbageCollector=e,this.asyncQueue=i,this.localStore=o,this.Ar=null}start(){this.garbageCollector.params.cacheSizeCollectionThreshold!==-1&&this.Rr(6e4)}stop(){this.Ar&&(this.Ar.cancel(),this.Ar=null)}get started(){return this.Ar!==null}Rr(e){fn(bQ,`Garbage collection scheduled in ${e}ms`),this.Ar=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",e,(async()=>{this.Ar=null;try{await this.localStore.collectGarbage(this.garbageCollector)}catch(i){mb(i)?fn(bQ,"Ignoring IndexedDB error during garbage collection: ",i):await fb(i)}await this.Rr(3e5)}))}}class q4e{constructor(e,i){this.Vr=e,this.params=i}calculateTargetCount(e,i){return this.Vr.mr(e).next((o=>Math.floor(i/100*o)))}nthSequenceNumber(e,i){if(i===0)return At.resolve(VN.ue);const o=new $4e(i);return this.Vr.forEachTarget(e,(l=>o.Er(l.sequenceNumber))).next((()=>this.Vr.gr(e,(l=>o.Er(l))))).next((()=>o.maxValue))}removeTargets(e,i,o){return this.Vr.removeTargets(e,i,o)}removeOrphanedDocuments(e,i){return this.Vr.removeOrphanedDocuments(e,i)}collect(e,i){return this.params.cacheSizeCollectionThreshold===-1?(fn("LruGarbageCollector","Garbage collection skipped; disabled"),At.resolve(SQ)):this.getCacheSize(e).next((o=>o<this.params.cacheSizeCollectionThreshold?(fn("LruGarbageCollector",`Garbage collection skipped; Cache size ${o} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),SQ):this.pr(e,i)))}getCacheSize(e){return this.Vr.getCacheSize(e)}pr(e,i){let o,l,u,p,y,E,b;const T=Date.now();return this.calculateTargetCount(e,this.params.percentileToCollect).next((R=>(R>this.params.maximumSequenceNumbersToCollect?(fn("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${R}`),l=this.params.maximumSequenceNumbersToCollect):l=R,p=Date.now(),this.nthSequenceNumber(e,l)))).next((R=>(o=R,y=Date.now(),this.removeTargets(e,o,i)))).next((R=>(u=R,E=Date.now(),this.removeOrphanedDocuments(e,o)))).next((R=>(b=Date.now(),K0()<=zr.DEBUG&&fn("LruGarbageCollector",`LRU Garbage Collection
	Counted targets in ${p-T}ms
	Determined least recently used ${l} in `+(y-p)+`ms
	Removed ${u} targets in `+(E-y)+`ms
	Removed ${R} documents in `+(b-E)+`ms
Total Duration: ${b-T}ms`),At.resolve({didRun:!0,sequenceNumbersCollected:l,targetsRemoved:u,documentsRemoved:R}))))}}function Y4e(n,e){return new q4e(n,e)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class X4e{constructor(){this.changes=new RE((e=>e.toString()),((e,i)=>e.isEqual(i))),this.changesApplied=!1}addEntry(e){this.assertNotApplied(),this.changes.set(e.key,e)}removeEntry(e,i){this.assertNotApplied(),this.changes.set(e,pc.newInvalidDocument(e).setReadTime(i))}getEntry(e,i){this.assertNotApplied();const o=this.changes.get(i);return o!==void 0?At.resolve(o):this.getFromCache(e,i)}getEntries(e,i){return this.getAllFromCache(e,i)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class J4e{constructor(e,i){this.overlayedDocument=e,this.mutatedFields=i}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Q4e{constructor(e,i,o,l){this.remoteDocumentCache=e,this.mutationQueue=i,this.documentOverlayCache=o,this.indexManager=l}getDocument(e,i){let o=null;return this.documentOverlayCache.getOverlay(e,i).next((l=>(o=l,this.remoteDocumentCache.getEntry(e,i)))).next((l=>(o!==null&&ZC(o.mutation,l,pu.empty(),ls.now()),l)))}getDocuments(e,i){return this.remoteDocumentCache.getEntries(e,i).next((o=>this.getLocalViewOfDocuments(e,o,Wr()).next((()=>o))))}getLocalViewOfDocuments(e,i,o=Wr()){const l=jy();return this.populateOverlays(e,l,i).next((()=>this.computeViews(e,i,l,o).next((u=>{let p=kC();return u.forEach(((y,E)=>{p=p.insert(y,E.overlayedDocument)})),p}))))}getOverlayedDocuments(e,i){const o=jy();return this.populateOverlays(e,o,i).next((()=>this.computeViews(e,i,o,Wr())))}populateOverlays(e,i,o){const l=[];return o.forEach((u=>{i.has(u)||l.push(u)})),this.documentOverlayCache.getOverlays(e,l).next((u=>{u.forEach(((p,y)=>{i.set(p,y)}))}))}computeViews(e,i,o,l){let u=sm();const p=QC(),y=(function(){return QC()})();return i.forEach(((E,b)=>{const T=o.get(b.key);l.has(b.key)&&(T===void 0||T.mutation instanceof n_)?u=u.insert(b.key,b):T!==void 0?(p.set(b.key,T.mutation.getFieldMask()),ZC(T.mutation,b,T.mutation.getFieldMask(),ls.now())):p.set(b.key,pu.empty())})),this.recalculateAndSaveOverlays(e,u).next((E=>(E.forEach(((b,T)=>p.set(b,T))),i.forEach(((b,T)=>{var R;return y.set(b,new J4e(T,(R=p.get(b))!==null&&R!==void 0?R:null))})),y)))}recalculateAndSaveOverlays(e,i){const o=QC();let l=new xs(((p,y)=>p-y)),u=Wr();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(e,i).next((p=>{for(const y of p)y.keys().forEach((E=>{const b=i.get(E);if(b===null)return;let T=o.get(E)||pu.empty();T=y.applyToLocalView(b,T),o.set(E,T);const R=(l.get(y.batchId)||Wr()).add(E);l=l.insert(y.batchId,R)}))})).next((()=>{const p=[],y=l.getReverseIterator();for(;y.hasNext();){const E=y.getNext(),b=E.key,T=E.value,R=toe();T.forEach((O=>{if(!u.has(O)){const L=coe(i.get(O),o.get(O));L!==null&&R.set(O,L),u=u.add(O)}})),p.push(this.documentOverlayCache.saveOverlays(e,b,R))}return At.waitFor(p)})).next((()=>o))}recalculateAndSaveOverlaysForDocumentKeys(e,i){return this.remoteDocumentCache.getEntries(e,i).next((o=>this.recalculateAndSaveOverlays(e,o)))}getDocumentsMatchingQuery(e,i,o,l){return(function(p){return kn.isDocumentKey(p.path)&&p.collectionGroup===null&&p.filters.length===0})(i)?this.getDocumentsMatchingDocumentQuery(e,i.path):i3(i)?this.getDocumentsMatchingCollectionGroupQuery(e,i,o,l):this.getDocumentsMatchingCollectionQuery(e,i,o,l)}getNextDocuments(e,i,o,l){return this.remoteDocumentCache.getAllFromCollectionGroup(e,i,o,l).next((u=>{const p=l-u.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(e,i,o.largestBatchId,l-u.size):At.resolve(jy());let y=AR,E=u;return p.next((b=>At.forEach(b,((T,R)=>(y<R.largestBatchId&&(y=R.largestBatchId),u.get(T)?At.resolve():this.remoteDocumentCache.getEntry(e,T).next((O=>{E=E.insert(T,O)}))))).next((()=>this.populateOverlays(e,b,u))).next((()=>this.computeViews(e,E,b,Wr()))).next((T=>({batchId:y,changes:eoe(T)})))))}))}getDocumentsMatchingDocumentQuery(e,i){return this.getDocument(e,new kn(i)).next((o=>{let l=kC();return o.isFoundDocument()&&(l=l.insert(o.key,o)),l}))}getDocumentsMatchingCollectionGroupQuery(e,i,o,l){const u=i.collectionGroup;let p=kC();return this.indexManager.getCollectionParents(e,u).next((y=>At.forEach(y,(E=>{const b=(function(R,O){return new CE(O,null,R.explicitOrderBy.slice(),R.filters.slice(),R.limit,R.limitType,R.startAt,R.endAt)})(i,E.child(u));return this.getDocumentsMatchingCollectionQuery(e,b,o,l).next((T=>{T.forEach(((R,O)=>{p=p.insert(R,O)}))}))})).next((()=>p))))}getDocumentsMatchingCollectionQuery(e,i,o,l){let u;return this.documentOverlayCache.getOverlaysForCollection(e,i.path,o.largestBatchId).next((p=>(u=p,this.remoteDocumentCache.getDocumentsMatchingQuery(e,i,o,u,l)))).next((p=>{u.forEach(((E,b)=>{const T=b.getKey();p.get(T)===null&&(p=p.insert(T,pc.newInvalidDocument(T)))}));let y=kC();return p.forEach(((E,b)=>{const T=u.get(E);T!==void 0&&ZC(T.mutation,b,pu.empty(),ls.now()),GN(i,b)&&(y=y.insert(E,b))})),y}))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Z4e{constructor(e){this.serializer=e,this.Br=new Map,this.Lr=new Map}getBundleMetadata(e,i){return At.resolve(this.Br.get(i))}saveBundleMetadata(e,i){return this.Br.set(i.id,(function(l){return{id:l.id,version:l.version,createTime:zp(l.createTime)}})(i)),At.resolve()}getNamedQuery(e,i){return At.resolve(this.Lr.get(i))}saveNamedQuery(e,i){return this.Lr.set(i.name,(function(l){return{name:l.name,query:z4e(l.bundledQuery),readTime:zp(l.readTime)}})(i)),At.resolve()}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class e6e{constructor(){this.overlays=new xs(kn.comparator),this.kr=new Map}getOverlay(e,i){return At.resolve(this.overlays.get(i))}getOverlays(e,i){const o=jy();return At.forEach(i,(l=>this.getOverlay(e,l).next((u=>{u!==null&&o.set(l,u)})))).next((()=>o))}saveOverlays(e,i,o){return o.forEach(((l,u)=>{this.wt(e,i,u)})),At.resolve()}removeOverlaysForBatchId(e,i,o){const l=this.kr.get(o);return l!==void 0&&(l.forEach((u=>this.overlays=this.overlays.remove(u))),this.kr.delete(o)),At.resolve()}getOverlaysForCollection(e,i,o){const l=jy(),u=i.length+1,p=new kn(i.child("")),y=this.overlays.getIteratorFrom(p);for(;y.hasNext();){const E=y.getNext().value,b=E.getKey();if(!i.isPrefixOf(b.path))break;b.path.length===u&&E.largestBatchId>o&&l.set(E.getKey(),E)}return At.resolve(l)}getOverlaysForCollectionGroup(e,i,o,l){let u=new xs(((b,T)=>b-T));const p=this.overlays.getIterator();for(;p.hasNext();){const b=p.getNext().value;if(b.getKey().getCollectionGroup()===i&&b.largestBatchId>o){let T=u.get(b.largestBatchId);T===null&&(T=jy(),u=u.insert(b.largestBatchId,T)),T.set(b.getKey(),b)}}const y=jy(),E=u.getIterator();for(;E.hasNext()&&(E.getNext().value.forEach(((b,T)=>y.set(b,T))),!(y.size()>=l)););return At.resolve(y)}wt(e,i,o){const l=this.overlays.get(o.key);if(l!==null){const p=this.kr.get(l.largestBatchId).delete(o.key);this.kr.set(l.largestBatchId,p)}this.overlays=this.overlays.insert(o.key,new E4e(i,o));let u=this.kr.get(i);u===void 0&&(u=Wr(),this.kr.set(i,u)),this.kr.set(i,u.add(o.key))}}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class t6e{constructor(){this.sessionToken=Ba.EMPTY_BYTE_STRING}getSessionToken(e){return At.resolve(this.sessionToken)}setSessionToken(e,i){return this.sessionToken=i,At.resolve()}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class u3{constructor(){this.qr=new Jo(Ea.Qr),this.$r=new Jo(Ea.Ur)}isEmpty(){return this.qr.isEmpty()}addReference(e,i){const o=new Ea(e,i);this.qr=this.qr.add(o),this.$r=this.$r.add(o)}Kr(e,i){e.forEach((o=>this.addReference(o,i)))}removeReference(e,i){this.Wr(new Ea(e,i))}Gr(e,i){e.forEach((o=>this.removeReference(o,i)))}zr(e){const i=new kn(new qi([])),o=new Ea(i,e),l=new Ea(i,e+1),u=[];return this.$r.forEachInRange([o,l],(p=>{this.Wr(p),u.push(p.key)})),u}jr(){this.qr.forEach((e=>this.Wr(e)))}Wr(e){this.qr=this.qr.delete(e),this.$r=this.$r.delete(e)}Jr(e){const i=new kn(new qi([])),o=new Ea(i,e),l=new Ea(i,e+1);let u=Wr();return this.$r.forEachInRange([o,l],(p=>{u=u.add(p.key)})),u}containsKey(e){const i=new Ea(e,0),o=this.qr.firstAfterOrEqual(i);return o!==null&&e.isEqual(o.key)}}class Ea{constructor(e,i){this.key=e,this.Hr=i}static Qr(e,i){return kn.comparator(e.key,i.key)||kr(e.Hr,i.Hr)}static Ur(e,i){return kr(e.Hr,i.Hr)||kn.comparator(e.key,i.key)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class n6e{constructor(e,i){this.indexManager=e,this.referenceDelegate=i,this.mutationQueue=[],this.er=1,this.Yr=new Jo(Ea.Qr)}checkEmpty(e){return At.resolve(this.mutationQueue.length===0)}addMutationBatch(e,i,o,l){const u=this.er;this.er++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];const p=new y4e(u,i,o,l);this.mutationQueue.push(p);for(const y of l)this.Yr=this.Yr.add(new Ea(y.key,u)),this.indexManager.addToCollectionParentIndex(e,y.key.path.popLast());return At.resolve(p)}lookupMutationBatch(e,i){return At.resolve(this.Zr(i))}getNextMutationBatchAfterBatchId(e,i){const o=i+1,l=this.Xr(o),u=l<0?0:l;return At.resolve(this.mutationQueue.length>u?this.mutationQueue[u]:null)}getHighestUnacknowledgedBatchId(){return At.resolve(this.mutationQueue.length===0?e3:this.er-1)}getAllMutationBatches(e){return At.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(e,i){const o=new Ea(i,0),l=new Ea(i,Number.POSITIVE_INFINITY),u=[];return this.Yr.forEachInRange([o,l],(p=>{const y=this.Zr(p.Hr);u.push(y)})),At.resolve(u)}getAllMutationBatchesAffectingDocumentKeys(e,i){let o=new Jo(kr);return i.forEach((l=>{const u=new Ea(l,0),p=new Ea(l,Number.POSITIVE_INFINITY);this.Yr.forEachInRange([u,p],(y=>{o=o.add(y.Hr)}))})),At.resolve(this.ei(o))}getAllMutationBatchesAffectingQuery(e,i){const o=i.path,l=o.length+1;let u=o;kn.isDocumentKey(u)||(u=u.child(""));const p=new Ea(new kn(u),0);let y=new Jo(kr);return this.Yr.forEachWhile((E=>{const b=E.key.path;return!!o.isPrefixOf(b)&&(b.length===l&&(y=y.add(E.Hr)),!0)}),p),At.resolve(this.ei(y))}ei(e){const i=[];return e.forEach((o=>{const l=this.Zr(o);l!==null&&i.push(l)})),i}removeMutationBatch(e,i){Ci(this.ti(i.batchId,"removed")===0,55003),this.mutationQueue.shift();let o=this.Yr;return At.forEach(i.mutations,(l=>{const u=new Ea(l.key,i.batchId);return o=o.delete(u),this.referenceDelegate.markPotentiallyOrphaned(e,l.key)})).next((()=>{this.Yr=o}))}rr(e){}containsKey(e,i){const o=new Ea(i,0),l=this.Yr.firstAfterOrEqual(o);return At.resolve(i.isEqual(l&&l.key))}performConsistencyCheck(e){return this.mutationQueue.length,At.resolve()}ti(e,i){return this.Xr(e)}Xr(e){return this.mutationQueue.length===0?0:e-this.mutationQueue[0].batchId}Zr(e){const i=this.Xr(e);return i<0||i>=this.mutationQueue.length?null:this.mutationQueue[i]}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class r6e{constructor(e){this.ni=e,this.docs=(function(){return new xs(kn.comparator)})(),this.size=0}setIndexManager(e){this.indexManager=e}addEntry(e,i){const o=i.key,l=this.docs.get(o),u=l?l.size:0,p=this.ni(i);return this.docs=this.docs.insert(o,{document:i.mutableCopy(),size:p}),this.size+=p-u,this.indexManager.addToCollectionParentIndex(e,o.path.popLast())}removeEntry(e){const i=this.docs.get(e);i&&(this.docs=this.docs.remove(e),this.size-=i.size)}getEntry(e,i){const o=this.docs.get(i);return At.resolve(o?o.document.mutableCopy():pc.newInvalidDocument(i))}getEntries(e,i){let o=sm();return i.forEach((l=>{const u=this.docs.get(l);o=o.insert(l,u?u.document.mutableCopy():pc.newInvalidDocument(l))})),At.resolve(o)}getDocumentsMatchingQuery(e,i,o,l){let u=sm();const p=i.path,y=new kn(p.child("__id-9223372036854775808__")),E=this.docs.getIteratorFrom(y);for(;E.hasNext();){const{key:b,value:{document:T}}=E.getNext();if(!p.isPrefixOf(b.path))break;b.path.length>p.length+1||x3e(N3e(T),o)<=0||(l.has(T.key)||GN(i,T))&&(u=u.insert(T.key,T.mutableCopy()))}return At.resolve(u)}getAllFromCollectionGroup(e,i,o,l){er(9500)}ri(e,i){return At.forEach(this.docs,(o=>i(o)))}newChangeBuffer(e){return new i6e(this)}getSize(e){return At.resolve(this.size)}}class i6e extends X4e{constructor(e){super(),this.Or=e}applyChanges(e){const i=[];return this.changes.forEach(((o,l)=>{l.isValidDocument()?i.push(this.Or.addEntry(e,l)):this.Or.removeEntry(o)})),At.waitFor(i)}getFromCache(e,i){return this.Or.getEntry(e,i)}getAllFromCache(e,i){return this.Or.getEntries(e,i)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class s6e{constructor(e){this.persistence=e,this.ii=new RE((i=>n3(i)),r3),this.lastRemoteSnapshotVersion=ur.min(),this.highestTargetId=0,this.si=0,this.oi=new u3,this.targetCount=0,this._i=tb.ar()}forEachTarget(e,i){return this.ii.forEach(((o,l)=>i(l))),At.resolve()}getLastRemoteSnapshotVersion(e){return At.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return At.resolve(this.si)}allocateTargetId(e){return this.highestTargetId=this._i.next(),At.resolve(this.highestTargetId)}setTargetsMetadata(e,i,o){return o&&(this.lastRemoteSnapshotVersion=o),i>this.si&&(this.si=i),At.resolve()}hr(e){this.ii.set(e.target,e);const i=e.targetId;i>this.highestTargetId&&(this._i=new tb(i),this.highestTargetId=i),e.sequenceNumber>this.si&&(this.si=e.sequenceNumber)}addTargetData(e,i){return this.hr(i),this.targetCount+=1,At.resolve()}updateTargetData(e,i){return this.hr(i),At.resolve()}removeTargetData(e,i){return this.ii.delete(i.target),this.oi.zr(i.targetId),this.targetCount-=1,At.resolve()}removeTargets(e,i,o){let l=0;const u=[];return this.ii.forEach(((p,y)=>{y.sequenceNumber<=i&&o.get(y.targetId)===null&&(this.ii.delete(p),u.push(this.removeMatchingKeysForTargetId(e,y.targetId)),l++)})),At.waitFor(u).next((()=>l))}getTargetCount(e){return At.resolve(this.targetCount)}getTargetData(e,i){const o=this.ii.get(i)||null;return At.resolve(o)}addMatchingKeys(e,i,o){return this.oi.Kr(i,o),At.resolve()}removeMatchingKeys(e,i,o){this.oi.Gr(i,o);const l=this.persistence.referenceDelegate,u=[];return l&&i.forEach((p=>{u.push(l.markPotentiallyOrphaned(e,p))})),At.waitFor(u)}removeMatchingKeysForTargetId(e,i){return this.oi.zr(i),At.resolve()}getMatchingKeysForTargetId(e,i){const o=this.oi.Jr(i);return At.resolve(o)}containsKey(e,i){return At.resolve(this.oi.containsKey(i))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Soe{constructor(e,i){this.ai={},this.overlays={},this.ui=new VN(0),this.ci=!1,this.ci=!0,this.li=new t6e,this.referenceDelegate=e(this),this.hi=new s6e(this),this.indexManager=new W4e,this.remoteDocumentCache=(function(l){return new r6e(l)})((o=>this.referenceDelegate.Pi(o))),this.serializer=new B4e(i),this.Ti=new Z4e(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.ci=!1,Promise.resolve()}get started(){return this.ci}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(e){return this.indexManager}getDocumentOverlayCache(e){let i=this.overlays[e.toKey()];return i||(i=new e6e,this.overlays[e.toKey()]=i),i}getMutationQueue(e,i){let o=this.ai[e.toKey()];return o||(o=new n6e(i,this.referenceDelegate),this.ai[e.toKey()]=o),o}getGlobalsCache(){return this.li}getTargetCache(){return this.hi}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.Ti}runTransaction(e,i,o){fn("MemoryPersistence","Starting transaction:",e);const l=new o6e(this.ui.next());return this.referenceDelegate.Ii(),o(l).next((u=>this.referenceDelegate.di(l).next((()=>u)))).toPromise().then((u=>(l.raiseOnCommittedEvent(),u)))}Ei(e,i){return At.or(Object.values(this.ai).map((o=>()=>o.containsKey(e,i))))}}class o6e extends L3e{constructor(e){super(),this.currentSequenceNumber=e}}class d3{constructor(e){this.persistence=e,this.Ai=new u3,this.Ri=null}static Vi(e){return new d3(e)}get mi(){if(this.Ri)return this.Ri;throw er(60996)}addReference(e,i,o){return this.Ai.addReference(o,i),this.mi.delete(o.toString()),At.resolve()}removeReference(e,i,o){return this.Ai.removeReference(o,i),this.mi.add(o.toString()),At.resolve()}markPotentiallyOrphaned(e,i){return this.mi.add(i.toString()),At.resolve()}removeTarget(e,i){this.Ai.zr(i.targetId).forEach((l=>this.mi.add(l.toString())));const o=this.persistence.getTargetCache();return o.getMatchingKeysForTargetId(e,i.targetId).next((l=>{l.forEach((u=>this.mi.add(u.toString())))})).next((()=>o.removeTargetData(e,i)))}Ii(){this.Ri=new Set}di(e){const i=this.persistence.getRemoteDocumentCache().newChangeBuffer();return At.forEach(this.mi,(o=>{const l=kn.fromPath(o);return this.fi(e,l).next((u=>{u||i.removeEntry(l,ur.min())}))})).next((()=>(this.Ri=null,i.apply(e))))}updateLimboDocument(e,i){return this.fi(e,i).next((o=>{o?this.mi.delete(i.toString()):this.mi.add(i.toString())}))}Pi(e){return 0}fi(e,i){return At.or([()=>At.resolve(this.Ai.containsKey(i)),()=>this.persistence.getTargetCache().containsKey(e,i),()=>this.persistence.Ei(e,i)])}}class zk{constructor(e,i){this.persistence=e,this.gi=new RE((o=>V3e(o.path)),((o,l)=>o.isEqual(l))),this.garbageCollector=Y4e(this,i)}static Vi(e,i){return new zk(e,i)}Ii(){}di(e){return At.resolve()}forEachTarget(e,i){return this.persistence.getTargetCache().forEachTarget(e,i)}mr(e){const i=this.yr(e);return this.persistence.getTargetCache().getTargetCount(e).next((o=>i.next((l=>o+l))))}yr(e){let i=0;return this.gr(e,(o=>{i++})).next((()=>i))}gr(e,i){return At.forEach(this.gi,((o,l)=>this.Sr(e,o,l).next((u=>u?At.resolve():i(l)))))}removeTargets(e,i,o){return this.persistence.getTargetCache().removeTargets(e,i,o)}removeOrphanedDocuments(e,i){let o=0;const l=this.persistence.getRemoteDocumentCache(),u=l.newChangeBuffer();return l.ri(e,(p=>this.Sr(e,p,i).next((y=>{y||(o++,u.removeEntry(p,ur.min()))})))).next((()=>u.apply(e))).next((()=>o))}markPotentiallyOrphaned(e,i){return this.gi.set(i,e.currentSequenceNumber),At.resolve()}removeTarget(e,i){const o=i.withSequenceNumber(e.currentSequenceNumber);return this.persistence.getTargetCache().updateTargetData(e,o)}addReference(e,i,o){return this.gi.set(o,e.currentSequenceNumber),At.resolve()}removeReference(e,i,o){return this.gi.set(o,e.currentSequenceNumber),At.resolve()}updateLimboDocument(e,i){return this.gi.set(i,e.currentSequenceNumber),At.resolve()}Pi(e){let i=e.key.toString().length;return e.isFoundDocument()&&(i+=ZO(e.data.value)),i}Sr(e,i,o){return At.or([()=>this.persistence.Ei(e,i),()=>this.persistence.getTargetCache().containsKey(e,i),()=>{const l=this.gi.get(i);return At.resolve(l!==void 0&&l>o)}])}getCacheSize(e){return this.persistence.getRemoteDocumentCache().getSize(e)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class h3{constructor(e,i,o,l){this.targetId=e,this.fromCache=i,this.Is=o,this.ds=l}static Es(e,i){let o=Wr(),l=Wr();for(const u of i.docChanges)switch(u.type){case 0:o=o.add(u.doc.key);break;case 1:l=l.add(u.doc.key)}return new h3(e,i.fromCache,o,l)}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class a6e{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(e){this._documentReadCount+=e}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class c6e{constructor(){this.As=!1,this.Rs=!1,this.Vs=100,this.fs=(function(){return jVe()?8:M3e(gc())>0?6:4})()}initialize(e,i){this.gs=e,this.indexManager=i,this.As=!0}getDocumentsMatchingQuery(e,i,o,l){const u={result:null};return this.ps(e,i).next((p=>{u.result=p})).next((()=>{if(!u.result)return this.ys(e,i,l,o).next((p=>{u.result=p}))})).next((()=>{if(u.result)return;const p=new a6e;return this.ws(e,i,p).next((y=>{if(u.result=y,this.Rs)return this.Ss(e,i,p,y.size)}))})).next((()=>u.result))}Ss(e,i,o,l){return o.documentReadCount<this.Vs?(K0()<=zr.DEBUG&&fn("QueryEngine","SDK will not create cache indexes for query:",q0(i),"since it only creates cache indexes for collection contains","more than or equal to",this.Vs,"documents"),At.resolve()):(K0()<=zr.DEBUG&&fn("QueryEngine","Query:",q0(i),"scans",o.documentReadCount,"local documents and returns",l,"documents as results."),o.documentReadCount>this.fs*l?(K0()<=zr.DEBUG&&fn("QueryEngine","The SDK decides to create cache indexes for query:",q0(i),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(e,Bp(i))):At.resolve())}ps(e,i){if(dQ(i))return At.resolve(null);let o=Bp(i);return this.indexManager.getIndexType(e,o).next((l=>l===0?null:(i.limit!==null&&l===1&&(i=Vk(i,null,"F"),o=Bp(i)),this.indexManager.getDocumentsMatchingTarget(e,o).next((u=>{const p=Wr(...u);return this.gs.getDocuments(e,p).next((y=>this.indexManager.getMinOffset(e,o).next((E=>{const b=this.bs(i,y);return this.Ds(i,b,p,E.readTime)?this.ps(e,Vk(i,null,"F")):this.vs(e,b,i,E)}))))})))))}ys(e,i,o,l){return dQ(i)||l.isEqual(ur.min())?At.resolve(null):this.gs.getDocuments(e,o).next((u=>{const p=this.bs(i,u);return this.Ds(i,p,o,l)?At.resolve(null):(K0()<=zr.DEBUG&&fn("QueryEngine","Re-using previous result from %s to execute query: %s",l.toString(),q0(i)),this.vs(e,p,i,k3e(l,AR)).next((y=>y)))}))}bs(e,i){let o=new Jo(Qse(e));return i.forEach(((l,u)=>{GN(e,u)&&(o=o.add(u))})),o}Ds(e,i,o,l){if(e.limit===null)return!1;if(o.size!==i.size)return!0;const u=e.limitType==="F"?i.last():i.first();return!!u&&(u.hasPendingWrites||u.version.compareTo(l)>0)}ws(e,i,o){return K0()<=zr.DEBUG&&fn("QueryEngine","Using full collection scan to execute query:",q0(i)),this.gs.getDocumentsMatchingQuery(e,i,Gg.min(),o)}vs(e,i,o,l){return this.gs.getDocumentsMatchingQuery(e,o,l).next((u=>(i.forEach((p=>{u=u.insert(p.key,p)})),u)))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const p3="LocalStore",l6e=3e8;class u6e{constructor(e,i,o,l){this.persistence=e,this.Cs=i,this.serializer=l,this.Fs=new xs(kr),this.Ms=new RE((u=>n3(u)),r3),this.xs=new Map,this.Os=e.getRemoteDocumentCache(),this.hi=e.getTargetCache(),this.Ti=e.getBundleCache(),this.Ns(o)}Ns(e){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(e),this.indexManager=this.persistence.getIndexManager(e),this.mutationQueue=this.persistence.getMutationQueue(e,this.indexManager),this.localDocuments=new Q4e(this.Os,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.Os.setIndexManager(this.indexManager),this.Cs.initialize(this.localDocuments,this.indexManager)}collectGarbage(e){return this.persistence.runTransaction("Collect garbage","readwrite-primary",(i=>e.collect(i,this.Fs)))}}function d6e(n,e,i,o){return new u6e(n,e,i,o)}async function boe(n,e){const i=fr(n);return await i.persistence.runTransaction("Handle user change","readonly",(o=>{let l;return i.mutationQueue.getAllMutationBatches(o).next((u=>(l=u,i.Ns(e),i.mutationQueue.getAllMutationBatches(o)))).next((u=>{const p=[],y=[];let E=Wr();for(const b of l){p.push(b.batchId);for(const T of b.mutations)E=E.add(T.key)}for(const b of u){y.push(b.batchId);for(const T of b.mutations)E=E.add(T.key)}return i.localDocuments.getDocuments(o,E).next((b=>({Bs:b,removedBatchIds:p,addedBatchIds:y})))}))}))}function h6e(n,e){const i=fr(n);return i.persistence.runTransaction("Acknowledge batch","readwrite-primary",(o=>{const l=e.batch.keys(),u=i.Os.newChangeBuffer({trackRemovals:!0});return(function(y,E,b,T){const R=b.batch,O=R.keys();let L=At.resolve();return O.forEach((D=>{L=L.next((()=>T.getEntry(E,D))).next((U=>{const F=b.docVersions.get(D);Ci(F!==null,48541),U.version.compareTo(F)<0&&(R.applyToRemoteDocument(U,b),U.isValidDocument()&&(U.setReadTime(b.commitVersion),T.addEntry(U)))}))})),L.next((()=>y.mutationQueue.removeMutationBatch(E,R)))})(i,o,e,u).next((()=>u.apply(o))).next((()=>i.mutationQueue.performConsistencyCheck(o))).next((()=>i.documentOverlayCache.removeOverlaysForBatchId(o,l,e.batch.batchId))).next((()=>i.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(o,(function(y){let E=Wr();for(let b=0;b<y.mutationResults.length;++b)y.mutationResults[b].transformResults.length>0&&(E=E.add(y.batch.mutations[b].key));return E})(e)))).next((()=>i.localDocuments.getDocuments(o,l)))}))}function woe(n){const e=fr(n);return e.persistence.runTransaction("Get last remote snapshot version","readonly",(i=>e.hi.getLastRemoteSnapshotVersion(i)))}function p6e(n,e){const i=fr(n),o=e.snapshotVersion;let l=i.Fs;return i.persistence.runTransaction("Apply remote event","readwrite-primary",(u=>{const p=i.Os.newChangeBuffer({trackRemovals:!0});l=i.Fs;const y=[];e.targetChanges.forEach(((T,R)=>{const O=l.get(R);if(!O)return;y.push(i.hi.removeMatchingKeys(u,T.removedDocuments,R).next((()=>i.hi.addMatchingKeys(u,T.addedDocuments,R))));let L=O.withSequenceNumber(u.currentSequenceNumber);e.targetMismatches.get(R)!==null?L=L.withResumeToken(Ba.EMPTY_BYTE_STRING,ur.min()).withLastLimboFreeSnapshotVersion(ur.min()):T.resumeToken.approximateByteSize()>0&&(L=L.withResumeToken(T.resumeToken,o)),l=l.insert(R,L),(function(U,F,Y){return U.resumeToken.approximateByteSize()===0||F.snapshotVersion.toMicroseconds()-U.snapshotVersion.toMicroseconds()>=l6e?!0:Y.addedDocuments.size+Y.modifiedDocuments.size+Y.removedDocuments.size>0})(O,L,T)&&y.push(i.hi.updateTargetData(u,L))}));let E=sm(),b=Wr();if(e.documentUpdates.forEach((T=>{e.resolvedLimboDocuments.has(T)&&y.push(i.persistence.referenceDelegate.updateLimboDocument(u,T))})),y.push(f6e(u,p,e.documentUpdates).next((T=>{E=T.Ls,b=T.ks}))),!o.isEqual(ur.min())){const T=i.hi.getLastRemoteSnapshotVersion(u).next((R=>i.hi.setTargetsMetadata(u,u.currentSequenceNumber,o)));y.push(T)}return At.waitFor(y).next((()=>p.apply(u))).next((()=>i.localDocuments.getLocalViewOfDocuments(u,E,b))).next((()=>E))})).then((u=>(i.Fs=l,u)))}function f6e(n,e,i){let o=Wr(),l=Wr();return i.forEach((u=>o=o.add(u))),e.getEntries(n,o).next((u=>{let p=sm();return i.forEach(((y,E)=>{const b=u.get(y);E.isFoundDocument()!==b.isFoundDocument()&&(l=l.add(y)),E.isNoDocument()&&E.version.isEqual(ur.min())?(e.removeEntry(y,E.readTime),p=p.insert(y,E)):!b.isValidDocument()||E.version.compareTo(b.version)>0||E.version.compareTo(b.version)===0&&b.hasPendingWrites?(e.addEntry(E),p=p.insert(y,E)):fn(p3,"Ignoring outdated watch update for ",y,". Current version:",b.version," Watch version:",E.version)})),{Ls:p,ks:l}}))}function m6e(n,e){const i=fr(n);return i.persistence.runTransaction("Get next mutation batch","readonly",(o=>(e===void 0&&(e=e3),i.mutationQueue.getNextMutationBatchAfterBatchId(o,e))))}function g6e(n,e){const i=fr(n);return i.persistence.runTransaction("Allocate target","readwrite",(o=>{let l;return i.hi.getTargetData(o,e).next((u=>u?(l=u,At.resolve(l)):i.hi.allocateTargetId(o).next((p=>(l=new Dg(e,p,"TargetPurposeListen",o.currentSequenceNumber),i.hi.addTargetData(o,l).next((()=>l)))))))})).then((o=>{const l=i.Fs.get(o.targetId);return(l===null||o.snapshotVersion.compareTo(l.snapshotVersion)>0)&&(i.Fs=i.Fs.insert(o.targetId,o),i.Ms.set(e,o.targetId)),o}))}async function F5(n,e,i){const o=fr(n),l=o.Fs.get(e),u=i?"readwrite":"readwrite-primary";try{i||await o.persistence.runTransaction("Release target",u,(p=>o.persistence.referenceDelegate.removeTarget(p,l)))}catch(p){if(!mb(p))throw p;fn(p3,`Failed to update sequence numbers for target ${e}: ${p}`)}o.Fs=o.Fs.remove(e),o.Ms.delete(l.target)}function TQ(n,e,i){const o=fr(n);let l=ur.min(),u=Wr();return o.persistence.runTransaction("Execute query","readwrite",(p=>(function(E,b,T){const R=fr(E),O=R.Ms.get(T);return O!==void 0?At.resolve(R.Fs.get(O)):R.hi.getTargetData(b,T)})(o,p,Bp(e)).next((y=>{if(y)return l=y.lastLimboFreeSnapshotVersion,o.hi.getMatchingKeysForTargetId(p,y.targetId).next((E=>{u=E}))})).next((()=>o.Cs.getDocumentsMatchingQuery(p,e,i?l:ur.min(),i?u:Wr()))).next((y=>(_6e(o,r4e(e),y),{documents:y,qs:u})))))}function _6e(n,e,i){let o=n.xs.get(e)||ur.min();i.forEach(((l,u)=>{u.readTime.compareTo(o)>0&&(o=u.readTime)})),n.xs.set(e,o)}class CQ{constructor(){this.activeTargetIds=l4e()}Gs(e){this.activeTargetIds=this.activeTargetIds.add(e)}zs(e){this.activeTargetIds=this.activeTargetIds.delete(e)}Ws(){const e={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(e)}}class y6e{constructor(){this.Fo=new CQ,this.Mo={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,i,o){}addLocalQueryTarget(e,i=!0){return i&&this.Fo.Gs(e),this.Mo[e]||"not-current"}updateQueryState(e,i,o){this.Mo[e]=i}removeLocalQueryTarget(e){this.Fo.zs(e)}isLocalQueryTarget(e){return this.Fo.activeTargetIds.has(e)}clearQueryState(e){delete this.Mo[e]}getAllActiveQueryTargets(){return this.Fo.activeTargetIds}isActiveQueryTarget(e){return this.Fo.activeTargetIds.has(e)}start(){return this.Fo=new CQ,Promise.resolve()}handleUserChange(e,i,o){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(e){}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class E6e{xo(e){}shutdown(){}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const RQ="ConnectivityMonitor";class IQ{constructor(){this.Oo=()=>this.No(),this.Bo=()=>this.Lo(),this.ko=[],this.qo()}xo(e){this.ko.push(e)}shutdown(){window.removeEventListener("online",this.Oo),window.removeEventListener("offline",this.Bo)}qo(){window.addEventListener("online",this.Oo),window.addEventListener("offline",this.Bo)}No(){fn(RQ,"Network connectivity changed: AVAILABLE");for(const e of this.ko)e(0)}Lo(){fn(RQ,"Network connectivity changed: UNAVAILABLE");for(const e of this.ko)e(1)}static C(){return typeof window<"u"&&window.addEventListener!==void 0&&window.removeEventListener!==void 0}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let vO=null;function B5(){return vO===null?vO=(function(){return 268435456+Math.round(2147483648*Math.random())})():vO++,"0x"+vO.toString(16)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const fV="RestConnection",v6e={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"};class S6e{get Qo(){return!1}constructor(e){this.databaseInfo=e,this.databaseId=e.databaseId;const i=e.ssl?"https":"http",o=encodeURIComponent(this.databaseId.projectId),l=encodeURIComponent(this.databaseId.database);this.$o=i+"://"+e.host,this.Uo=`projects/${o}/databases/${l}`,this.Ko=this.databaseId.database===Lk?`project_id=${o}`:`project_id=${o}&database_id=${l}`}Wo(e,i,o,l,u){const p=B5(),y=this.Go(e,i.toUriEncodedString());fn(fV,`Sending RPC '${e}' ${p}:`,y,o);const E={"google-cloud-resource-prefix":this.Uo,"x-goog-request-params":this.Ko};this.zo(E,l,u);const{host:b}=new URL(y),T=cm(b);return this.jo(e,y,E,o,T).then((R=>(fn(fV,`Received RPC '${e}' ${p}: `,R),R)),(R=>{throw Wg(fV,`RPC '${e}' ${p} failed with error: `,R,"url: ",y,"request:",o),R}))}Jo(e,i,o,l,u,p){return this.Wo(e,i,o,l,u)}zo(e,i,o){e["X-Goog-Api-Client"]=(function(){return"gl-js/ fire/"+pb})(),e["Content-Type"]="text/plain",this.databaseInfo.appId&&(e["X-Firebase-GMPID"]=this.databaseInfo.appId),i&&i.headers.forEach(((l,u)=>e[u]=l)),o&&o.headers.forEach(((l,u)=>e[u]=l))}Go(e,i){const o=v6e[e];return`${this.$o}/v1/${i}:${o}`}terminate(){}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class b6e{constructor(e){this.Ho=e.Ho,this.Yo=e.Yo}Zo(e){this.Xo=e}e_(e){this.t_=e}n_(e){this.r_=e}onMessage(e){this.i_=e}close(){this.Yo()}send(e){this.Ho(e)}s_(){this.Xo()}o_(){this.t_()}__(e){this.r_(e)}a_(e){this.i_(e)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const cc="WebChannelConnection";class w6e extends S6e{constructor(e){super(e),this.u_=[],this.forceLongPolling=e.forceLongPolling,this.autoDetectLongPolling=e.autoDetectLongPolling,this.useFetchStreams=e.useFetchStreams,this.longPollingOptions=e.longPollingOptions}jo(e,i,o,l,u){const p=B5();return new Promise(((y,E)=>{const b=new Cse;b.setWithCredentials(!0),b.listenOnce(Rse.COMPLETE,(()=>{try{switch(b.getLastErrorCode()){case QO.NO_ERROR:const R=b.getResponseJson();fn(cc,`XHR for RPC '${e}' ${p} received:`,JSON.stringify(R)),y(R);break;case QO.TIMEOUT:fn(cc,`RPC '${e}' ${p} timed out`),E(new Xt(Et.DEADLINE_EXCEEDED,"Request time out"));break;case QO.HTTP_ERROR:const O=b.getStatus();if(fn(cc,`RPC '${e}' ${p} failed with status:`,O,"response text:",b.getResponseText()),O>0){let L=b.getResponseJson();Array.isArray(L)&&(L=L[0]);const D=L==null?void 0:L.error;if(D&&D.status&&D.message){const U=(function(Y){const W=Y.toLowerCase().replace(/_/g,"-");return Object.values(Et).indexOf(W)>=0?W:Et.UNKNOWN})(D.status);E(new Xt(U,D.message))}else E(new Xt(Et.UNKNOWN,"Server responded with status "+b.getStatus()))}else E(new Xt(Et.UNAVAILABLE,"Connection failed."));break;default:er(9055,{c_:e,streamId:p,l_:b.getLastErrorCode(),h_:b.getLastError()})}}finally{fn(cc,`RPC '${e}' ${p} completed.`)}}));const T=JSON.stringify(l);fn(cc,`RPC '${e}' ${p} sending request:`,l),b.send(i,"POST",T,o,15)}))}P_(e,i,o){const l=B5(),u=[this.$o,"/","google.firestore.v1.Firestore","/",e,"/channel"],p=Pse(),y=Ase(),E={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},b=this.longPollingOptions.timeoutSeconds;b!==void 0&&(E.longPollingTimeout=Math.round(1e3*b)),this.useFetchStreams&&(E.useFetchStreams=!0),this.zo(E.initMessageHeaders,i,o),E.encodeInitMessageHeaders=!0;const T=u.join("");fn(cc,`Creating RPC '${e}' stream ${l}: ${T}`,E);const R=p.createWebChannel(T,E);this.T_(R);let O=!1,L=!1;const D=new b6e({Ho:F=>{L?fn(cc,`Not sending because RPC '${e}' stream ${l} is closed:`,F):(O||(fn(cc,`Opening RPC '${e}' stream ${l} transport.`),R.open(),O=!0),fn(cc,`RPC '${e}' stream ${l} sending:`,F),R.send(F))},Yo:()=>R.close()}),U=(F,Y,W)=>{F.listen(Y,(re=>{try{W(re)}catch(le){setTimeout((()=>{throw le}),0)}}))};return U(R,OC.EventType.OPEN,(()=>{L||(fn(cc,`RPC '${e}' stream ${l} transport opened.`),D.s_())})),U(R,OC.EventType.CLOSE,(()=>{L||(L=!0,fn(cc,`RPC '${e}' stream ${l} transport closed`),D.__(),this.I_(R))})),U(R,OC.EventType.ERROR,(F=>{L||(L=!0,Wg(cc,`RPC '${e}' stream ${l} transport errored. Name:`,F.name,"Message:",F.message),D.__(new Xt(Et.UNAVAILABLE,"The operation could not be completed")))})),U(R,OC.EventType.MESSAGE,(F=>{var Y;if(!L){const W=F.data[0];Ci(!!W,16349);const re=W,le=(re==null?void 0:re.error)||((Y=re[0])===null||Y===void 0?void 0:Y.error);if(le){fn(cc,`RPC '${e}' stream ${l} received error:`,le);const ie=le.status;let me=(function(Q){const ne=Io[Q];if(ne!==void 0)return uoe(ne)})(ie),q=le.message;me===void 0&&(me=Et.INTERNAL,q="Unknown error status: "+ie+" with message "+le.message),L=!0,D.__(new Xt(me,q)),R.close()}else fn(cc,`RPC '${e}' stream ${l} received:`,W),D.a_(W)}})),U(y,Ise.STAT_EVENT,(F=>{F.stat===P5.PROXY?fn(cc,`RPC '${e}' stream ${l} detected buffering proxy`):F.stat===P5.NOPROXY&&fn(cc,`RPC '${e}' stream ${l} detected no buffering proxy`)})),setTimeout((()=>{D.o_()}),0),D}terminate(){this.u_.forEach((e=>e.close())),this.u_=[]}T_(e){this.u_.push(e)}I_(e){this.u_=this.u_.filter((i=>i===e))}}function mV(){return typeof document<"u"?document:null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function qN(n){return new I4e(n,!0)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Toe{constructor(e,i,o=1e3,l=1.5,u=6e4){this.Fi=e,this.timerId=i,this.d_=o,this.E_=l,this.A_=u,this.R_=0,this.V_=null,this.m_=Date.now(),this.reset()}reset(){this.R_=0}f_(){this.R_=this.A_}g_(e){this.cancel();const i=Math.floor(this.R_+this.p_()),o=Math.max(0,Date.now()-this.m_),l=Math.max(0,i-o);l>0&&fn("ExponentialBackoff",`Backing off for ${l} ms (base delay: ${this.R_} ms, delay with jitter: ${i} ms, last attempt: ${o} ms ago)`),this.V_=this.Fi.enqueueAfterDelay(this.timerId,l,(()=>(this.m_=Date.now(),e()))),this.R_*=this.E_,this.R_<this.d_&&(this.R_=this.d_),this.R_>this.A_&&(this.R_=this.A_)}y_(){this.V_!==null&&(this.V_.skipDelay(),this.V_=null)}cancel(){this.V_!==null&&(this.V_.cancel(),this.V_=null)}p_(){return(Math.random()-.5)*this.R_}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const AQ="PersistentStream";class Coe{constructor(e,i,o,l,u,p,y,E){this.Fi=e,this.w_=o,this.S_=l,this.connection=u,this.authCredentialsProvider=p,this.appCheckCredentialsProvider=y,this.listener=E,this.state=0,this.b_=0,this.D_=null,this.v_=null,this.stream=null,this.C_=0,this.F_=new Toe(e,i)}M_(){return this.state===1||this.state===5||this.x_()}x_(){return this.state===2||this.state===3}start(){this.C_=0,this.state!==4?this.auth():this.O_()}async stop(){this.M_()&&await this.close(0)}N_(){this.state=0,this.F_.reset()}B_(){this.x_()&&this.D_===null&&(this.D_=this.Fi.enqueueAfterDelay(this.w_,6e4,(()=>this.L_())))}k_(e){this.q_(),this.stream.send(e)}async L_(){if(this.x_())return this.close(0)}q_(){this.D_&&(this.D_.cancel(),this.D_=null)}Q_(){this.v_&&(this.v_.cancel(),this.v_=null)}async close(e,i){this.q_(),this.Q_(),this.F_.cancel(),this.b_++,e!==4?this.F_.reset():i&&i.code===Et.RESOURCE_EXHAUSTED?(im(i.toString()),im("Using maximum backoff delay to prevent overloading the backend."),this.F_.f_()):i&&i.code===Et.UNAUTHENTICATED&&this.state!==3&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),this.stream!==null&&(this.U_(),this.stream.close(),this.stream=null),this.state=e,await this.listener.n_(i)}U_(){}auth(){this.state=1;const e=this.K_(this.b_),i=this.b_;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then((([o,l])=>{this.b_===i&&this.W_(o,l)}),(o=>{e((()=>{const l=new Xt(Et.UNKNOWN,"Fetching auth token failed: "+o.message);return this.G_(l)}))}))}W_(e,i){const o=this.K_(this.b_);this.stream=this.z_(e,i),this.stream.Zo((()=>{o((()=>this.listener.Zo()))})),this.stream.e_((()=>{o((()=>(this.state=2,this.v_=this.Fi.enqueueAfterDelay(this.S_,1e4,(()=>(this.x_()&&(this.state=3),Promise.resolve()))),this.listener.e_())))})),this.stream.n_((l=>{o((()=>this.G_(l)))})),this.stream.onMessage((l=>{o((()=>++this.C_==1?this.j_(l):this.onNext(l)))}))}O_(){this.state=5,this.F_.g_((async()=>{this.state=0,this.start()}))}G_(e){return fn(AQ,`close with error: ${e}`),this.stream=null,this.close(4,e)}K_(e){return i=>{this.Fi.enqueueAndForget((()=>this.b_===e?i():(fn(AQ,"stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve())))}}}class T6e extends Coe{constructor(e,i,o,l,u,p){super(e,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",i,o,l,p),this.serializer=u}z_(e,i){return this.connection.P_("Listen",e,i)}j_(e){return this.onNext(e)}onNext(e){this.F_.reset();const i=O4e(this.serializer,e),o=(function(u){if(!("targetChange"in u))return ur.min();const p=u.targetChange;return p.targetIds&&p.targetIds.length?ur.min():p.readTime?zp(p.readTime):ur.min()})(e);return this.listener.J_(i,o)}H_(e){const i={};i.database=j5(this.serializer),i.addTarget=(function(u,p){let y;const E=p.target;if(y=D5(E)?{documents:x4e(u,E)}:{query:D4e(u,E).Vt},y.targetId=p.targetId,p.resumeToken.approximateByteSize()>0){y.resumeToken=poe(u,p.resumeToken);const b=M5(u,p.expectedCount);b!==null&&(y.expectedCount=b)}else if(p.snapshotVersion.compareTo(ur.min())>0){y.readTime=Bk(u,p.snapshotVersion.toTimestamp());const b=M5(u,p.expectedCount);b!==null&&(y.expectedCount=b)}return y})(this.serializer,e);const o=M4e(this.serializer,e);o&&(i.labels=o),this.k_(i)}Y_(e){const i={};i.database=j5(this.serializer),i.removeTarget=e,this.k_(i)}}class C6e extends Coe{constructor(e,i,o,l,u,p){super(e,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",i,o,l,p),this.serializer=u}get Z_(){return this.C_>0}start(){this.lastStreamToken=void 0,super.start()}U_(){this.Z_&&this.X_([])}z_(e,i){return this.connection.P_("Write",e,i)}j_(e){return Ci(!!e.streamToken,31322),this.lastStreamToken=e.streamToken,Ci(!e.writeResults||e.writeResults.length===0,55816),this.listener.ea()}onNext(e){Ci(!!e.streamToken,12678),this.lastStreamToken=e.streamToken,this.F_.reset();const i=N4e(e.writeResults,e.commitTime),o=zp(e.commitTime);return this.listener.ta(o,i)}na(){const e={};e.database=j5(this.serializer),this.k_(e)}X_(e){const i={streamToken:this.lastStreamToken,writes:e.map((o=>k4e(this.serializer,o)))};this.k_(i)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class R6e{}class I6e extends R6e{constructor(e,i,o,l){super(),this.authCredentials=e,this.appCheckCredentials=i,this.connection=o,this.serializer=l,this.ra=!1}ia(){if(this.ra)throw new Xt(Et.FAILED_PRECONDITION,"The client has already been terminated.")}Wo(e,i,o,l){return this.ia(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then((([u,p])=>this.connection.Wo(e,U5(i,o),l,u,p))).catch((u=>{throw u.name==="FirebaseError"?(u.code===Et.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),u):new Xt(Et.UNKNOWN,u.toString())}))}Jo(e,i,o,l,u){return this.ia(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then((([p,y])=>this.connection.Jo(e,U5(i,o),l,p,y,u))).catch((p=>{throw p.name==="FirebaseError"?(p.code===Et.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),p):new Xt(Et.UNKNOWN,p.toString())}))}terminate(){this.ra=!0,this.connection.terminate()}}class A6e{constructor(e,i){this.asyncQueue=e,this.onlineStateHandler=i,this.state="Unknown",this.sa=0,this.oa=null,this._a=!0}aa(){this.sa===0&&(this.ua("Unknown"),this.oa=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,(()=>(this.oa=null,this.ca("Backend didn't respond within 10 seconds."),this.ua("Offline"),Promise.resolve()))))}la(e){this.state==="Online"?this.ua("Unknown"):(this.sa++,this.sa>=1&&(this.ha(),this.ca(`Connection failed 1 times. Most recent error: ${e.toString()}`),this.ua("Offline")))}set(e){this.ha(),this.sa=0,e==="Online"&&(this._a=!1),this.ua(e)}ua(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}ca(e){const i=`Could not reach Cloud Firestore backend. ${e}
This typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this._a?(im(i),this._a=!1):fn("OnlineStateTracker",i)}ha(){this.oa!==null&&(this.oa.cancel(),this.oa=null)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const mE="RemoteStore";class P6e{constructor(e,i,o,l,u){this.localStore=e,this.datastore=i,this.asyncQueue=o,this.remoteSyncer={},this.Pa=[],this.Ta=new Map,this.Ia=new Set,this.da=[],this.Ea=u,this.Ea.xo((p=>{o.enqueueAndForget((async()=>{IE(this)&&(fn(mE,"Restarting streams for network reachability change."),await(async function(E){const b=fr(E);b.Ia.add(4),await lI(b),b.Aa.set("Unknown"),b.Ia.delete(4),await YN(b)})(this))}))})),this.Aa=new A6e(o,l)}}async function YN(n){if(IE(n))for(const e of n.da)await e(!0)}async function lI(n){for(const e of n.da)await e(!1)}function Roe(n,e){const i=fr(n);i.Ta.has(e.targetId)||(i.Ta.set(e.targetId,e),_3(i)?g3(i):gb(i).x_()&&m3(i,e))}function f3(n,e){const i=fr(n),o=gb(i);i.Ta.delete(e),o.x_()&&Ioe(i,e),i.Ta.size===0&&(o.x_()?o.B_():IE(i)&&i.Aa.set("Unknown"))}function m3(n,e){if(n.Ra.$e(e.targetId),e.resumeToken.approximateByteSize()>0||e.snapshotVersion.compareTo(ur.min())>0){const i=n.remoteSyncer.getRemoteKeysForTarget(e.targetId).size;e=e.withExpectedCount(i)}gb(n).H_(e)}function Ioe(n,e){n.Ra.$e(e),gb(n).Y_(e)}function g3(n){n.Ra=new w4e({getRemoteKeysForTarget:e=>n.remoteSyncer.getRemoteKeysForTarget(e),Et:e=>n.Ta.get(e)||null,lt:()=>n.datastore.serializer.databaseId}),gb(n).start(),n.Aa.aa()}function _3(n){return IE(n)&&!gb(n).M_()&&n.Ta.size>0}function IE(n){return fr(n).Ia.size===0}function Aoe(n){n.Ra=void 0}async function O6e(n){n.Aa.set("Online")}async function k6e(n){n.Ta.forEach(((e,i)=>{m3(n,e)}))}async function N6e(n,e){Aoe(n),_3(n)?(n.Aa.la(e),g3(n)):n.Aa.set("Unknown")}async function x6e(n,e,i){if(n.Aa.set("Online"),e instanceof hoe&&e.state===2&&e.cause)try{await(async function(l,u){const p=u.cause;for(const y of u.targetIds)l.Ta.has(y)&&(await l.remoteSyncer.rejectListen(y,p),l.Ta.delete(y),l.Ra.removeTarget(y))})(n,e)}catch(o){fn(mE,"Failed to remove targets %s: %s ",e.targetIds.join(","),o),await Wk(n,o)}else if(e instanceof nk?n.Ra.Ye(e):e instanceof doe?n.Ra.it(e):n.Ra.et(e),!i.isEqual(ur.min()))try{const o=await woe(n.localStore);i.compareTo(o)>=0&&await(function(u,p){const y=u.Ra.Pt(p);return y.targetChanges.forEach(((E,b)=>{if(E.resumeToken.approximateByteSize()>0){const T=u.Ta.get(b);T&&u.Ta.set(b,T.withResumeToken(E.resumeToken,p))}})),y.targetMismatches.forEach(((E,b)=>{const T=u.Ta.get(E);if(!T)return;u.Ta.set(E,T.withResumeToken(Ba.EMPTY_BYTE_STRING,T.snapshotVersion)),Ioe(u,E);const R=new Dg(T.target,E,b,T.sequenceNumber);m3(u,R)})),u.remoteSyncer.applyRemoteEvent(y)})(n,i)}catch(o){fn(mE,"Failed to raise snapshot:",o),await Wk(n,o)}}async function Wk(n,e,i){if(!mb(e))throw e;n.Ia.add(1),await lI(n),n.Aa.set("Offline"),i||(i=()=>woe(n.localStore)),n.asyncQueue.enqueueRetryable((async()=>{fn(mE,"Retrying IndexedDB access"),await i(),n.Ia.delete(1),await YN(n)}))}function Poe(n,e){return e().catch((i=>Wk(n,i,e)))}async function XN(n){const e=fr(n),i=qg(e);let o=e.Pa.length>0?e.Pa[e.Pa.length-1].batchId:e3;for(;D6e(e);)try{const l=await m6e(e.localStore,o);if(l===null){e.Pa.length===0&&i.B_();break}o=l.batchId,L6e(e,l)}catch(l){await Wk(e,l)}Ooe(e)&&koe(e)}function D6e(n){return IE(n)&&n.Pa.length<10}function L6e(n,e){n.Pa.push(e);const i=qg(n);i.x_()&&i.Z_&&i.X_(e.mutations)}function Ooe(n){return IE(n)&&!qg(n).M_()&&n.Pa.length>0}function koe(n){qg(n).start()}async function M6e(n){qg(n).na()}async function U6e(n){const e=qg(n);for(const i of n.Pa)e.X_(i.mutations)}async function V6e(n,e,i){const o=n.Pa.shift(),l=a3.from(o,e,i);await Poe(n,(()=>n.remoteSyncer.applySuccessfulWrite(l))),await XN(n)}async function j6e(n,e){e&&qg(n).Z_&&await(async function(o,l){if((function(p){return S4e(p)&&p!==Et.ABORTED})(l.code)){const u=o.Pa.shift();qg(o).N_(),await Poe(o,(()=>o.remoteSyncer.rejectFailedWrite(u.batchId,l))),await XN(o)}})(n,e),Ooe(n)&&koe(n)}async function PQ(n,e){const i=fr(n);i.asyncQueue.verifyOperationInProgress(),fn(mE,"RemoteStore received new credentials");const o=IE(i);i.Ia.add(3),await lI(i),o&&i.Aa.set("Unknown"),await i.remoteSyncer.handleCredentialChange(e),i.Ia.delete(3),await YN(i)}async function F6e(n,e){const i=fr(n);e?(i.Ia.delete(2),await YN(i)):e||(i.Ia.add(2),await lI(i),i.Aa.set("Unknown"))}function gb(n){return n.Va||(n.Va=(function(i,o,l){const u=fr(i);return u.ia(),new T6e(o,u.connection,u.authCredentials,u.appCheckCredentials,u.serializer,l)})(n.datastore,n.asyncQueue,{Zo:O6e.bind(null,n),e_:k6e.bind(null,n),n_:N6e.bind(null,n),J_:x6e.bind(null,n)}),n.da.push((async e=>{e?(n.Va.N_(),_3(n)?g3(n):n.Aa.set("Unknown")):(await n.Va.stop(),Aoe(n))}))),n.Va}function qg(n){return n.ma||(n.ma=(function(i,o,l){const u=fr(i);return u.ia(),new C6e(o,u.connection,u.authCredentials,u.appCheckCredentials,u.serializer,l)})(n.datastore,n.asyncQueue,{Zo:()=>Promise.resolve(),e_:M6e.bind(null,n),n_:j6e.bind(null,n),ea:U6e.bind(null,n),ta:V6e.bind(null,n)}),n.da.push((async e=>{e?(n.ma.N_(),await XN(n)):(await n.ma.stop(),n.Pa.length>0&&(fn(mE,`Stopping write stream with ${n.Pa.length} pending writes`),n.Pa=[]))}))),n.ma}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class y3{constructor(e,i,o,l,u){this.asyncQueue=e,this.timerId=i,this.targetTimeMs=o,this.op=l,this.removalCallback=u,this.deferred=new Yf,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch((p=>{}))}get promise(){return this.deferred.promise}static createAndSchedule(e,i,o,l,u){const p=Date.now()+o,y=new y3(e,i,p,l,u);return y.start(o),y}start(e){this.timerHandle=setTimeout((()=>this.handleDelayElapsed()),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){this.timerHandle!==null&&(this.clearTimeout(),this.deferred.reject(new Xt(Et.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget((()=>this.timerHandle!==null?(this.clearTimeout(),this.op().then((e=>this.deferred.resolve(e)))):Promise.resolve()))}clearTimeout(){this.timerHandle!==null&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function E3(n,e){if(im("AsyncQueue",`${e}: ${n}`),mb(n))return new Xt(Et.UNAVAILABLE,`${e}: ${n}`);throw n}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class xS{static emptySet(e){return new xS(e.comparator)}constructor(e){this.comparator=e?(i,o)=>e(i,o)||kn.comparator(i.key,o.key):(i,o)=>kn.comparator(i.key,o.key),this.keyedMap=kC(),this.sortedSet=new xs(this.comparator)}has(e){return this.keyedMap.get(e)!=null}get(e){return this.keyedMap.get(e)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(e){const i=this.keyedMap.get(e);return i?this.sortedSet.indexOf(i):-1}get size(){return this.sortedSet.size}forEach(e){this.sortedSet.inorderTraversal(((i,o)=>(e(i),!1)))}add(e){const i=this.delete(e.key);return i.copy(i.keyedMap.insert(e.key,e),i.sortedSet.insert(e,null))}delete(e){const i=this.get(e);return i?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(i)):this}isEqual(e){if(!(e instanceof xS)||this.size!==e.size)return!1;const i=this.sortedSet.getIterator(),o=e.sortedSet.getIterator();for(;i.hasNext();){const l=i.getNext().key,u=o.getNext().key;if(!l.isEqual(u))return!1}return!0}toString(){const e=[];return this.forEach((i=>{e.push(i.toString())})),e.length===0?"DocumentSet ()":`DocumentSet (
  `+e.join(`  
`)+`
)`}copy(e,i){const o=new xS;return o.comparator=this.comparator,o.keyedMap=e,o.sortedSet=i,o}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class OQ{constructor(){this.fa=new xs(kn.comparator)}track(e){const i=e.doc.key,o=this.fa.get(i);o?e.type!==0&&o.type===3?this.fa=this.fa.insert(i,e):e.type===3&&o.type!==1?this.fa=this.fa.insert(i,{type:o.type,doc:e.doc}):e.type===2&&o.type===2?this.fa=this.fa.insert(i,{type:2,doc:e.doc}):e.type===2&&o.type===0?this.fa=this.fa.insert(i,{type:0,doc:e.doc}):e.type===1&&o.type===0?this.fa=this.fa.remove(i):e.type===1&&o.type===2?this.fa=this.fa.insert(i,{type:1,doc:o.doc}):e.type===0&&o.type===1?this.fa=this.fa.insert(i,{type:2,doc:e.doc}):er(63341,{At:e,ga:o}):this.fa=this.fa.insert(i,e)}pa(){const e=[];return this.fa.inorderTraversal(((i,o)=>{e.push(o)})),e}}class nb{constructor(e,i,o,l,u,p,y,E,b){this.query=e,this.docs=i,this.oldDocs=o,this.docChanges=l,this.mutatedKeys=u,this.fromCache=p,this.syncStateChanged=y,this.excludesMetadataChanges=E,this.hasCachedResults=b}static fromInitialDocuments(e,i,o,l,u){const p=[];return i.forEach((y=>{p.push({type:0,doc:y})})),new nb(e,i,xS.emptySet(i),p,o,l,!0,!1,u)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(e){if(!(this.fromCache===e.fromCache&&this.hasCachedResults===e.hasCachedResults&&this.syncStateChanged===e.syncStateChanged&&this.mutatedKeys.isEqual(e.mutatedKeys)&&WN(this.query,e.query)&&this.docs.isEqual(e.docs)&&this.oldDocs.isEqual(e.oldDocs)))return!1;const i=this.docChanges,o=e.docChanges;if(i.length!==o.length)return!1;for(let l=0;l<i.length;l++)if(i[l].type!==o[l].type||!i[l].doc.isEqual(o[l].doc))return!1;return!0}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class B6e{constructor(){this.ya=void 0,this.wa=[]}Sa(){return this.wa.some((e=>e.ba()))}}class z6e{constructor(){this.queries=kQ(),this.onlineState="Unknown",this.Da=new Set}terminate(){(function(i,o){const l=fr(i),u=l.queries;l.queries=kQ(),u.forEach(((p,y)=>{for(const E of y.wa)E.onError(o)}))})(this,new Xt(Et.ABORTED,"Firestore shutting down"))}}function kQ(){return new RE((n=>Jse(n)),WN)}async function v3(n,e){const i=fr(n);let o=3;const l=e.query;let u=i.queries.get(l);u?!u.Sa()&&e.ba()&&(o=2):(u=new B6e,o=e.ba()?0:1);try{switch(o){case 0:u.ya=await i.onListen(l,!0);break;case 1:u.ya=await i.onListen(l,!1);break;case 2:await i.onFirstRemoteStoreListen(l)}}catch(p){const y=E3(p,`Initialization of query '${q0(e.query)}' failed`);return void e.onError(y)}i.queries.set(l,u),u.wa.push(e),e.va(i.onlineState),u.ya&&e.Ca(u.ya)&&b3(i)}async function S3(n,e){const i=fr(n),o=e.query;let l=3;const u=i.queries.get(o);if(u){const p=u.wa.indexOf(e);p>=0&&(u.wa.splice(p,1),u.wa.length===0?l=e.ba()?0:1:!u.Sa()&&e.ba()&&(l=2))}switch(l){case 0:return i.queries.delete(o),i.onUnlisten(o,!0);case 1:return i.queries.delete(o),i.onUnlisten(o,!1);case 2:return i.onLastRemoteStoreUnlisten(o);default:return}}function W6e(n,e){const i=fr(n);let o=!1;for(const l of e){const u=l.query,p=i.queries.get(u);if(p){for(const y of p.wa)y.Ca(l)&&(o=!0);p.ya=l}}o&&b3(i)}function G6e(n,e,i){const o=fr(n),l=o.queries.get(e);if(l)for(const u of l.wa)u.onError(i);o.queries.delete(e)}function b3(n){n.Da.forEach((e=>{e.next()}))}var z5,NQ;(NQ=z5||(z5={})).Fa="default",NQ.Cache="cache";class w3{constructor(e,i,o){this.query=e,this.Ma=i,this.xa=!1,this.Oa=null,this.onlineState="Unknown",this.options=o||{}}Ca(e){if(!this.options.includeMetadataChanges){const o=[];for(const l of e.docChanges)l.type!==3&&o.push(l);e=new nb(e.query,e.docs,e.oldDocs,o,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0,e.hasCachedResults)}let i=!1;return this.xa?this.Na(e)&&(this.Ma.next(e),i=!0):this.Ba(e,this.onlineState)&&(this.La(e),i=!0),this.Oa=e,i}onError(e){this.Ma.error(e)}va(e){this.onlineState=e;let i=!1;return this.Oa&&!this.xa&&this.Ba(this.Oa,e)&&(this.La(this.Oa),i=!0),i}Ba(e,i){if(!e.fromCache||!this.ba())return!0;const o=i!=="Offline";return(!this.options.ka||!o)&&(!e.docs.isEmpty()||e.hasCachedResults||i==="Offline")}Na(e){if(e.docChanges.length>0)return!0;const i=this.Oa&&this.Oa.hasPendingWrites!==e.hasPendingWrites;return!(!e.syncStateChanged&&!i)&&this.options.includeMetadataChanges===!0}La(e){e=nb.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache,e.hasCachedResults),this.xa=!0,this.Ma.next(e)}ba(){return this.options.source!==z5.Cache}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Noe{constructor(e){this.key=e}}class xoe{constructor(e){this.key=e}}class H6e{constructor(e,i){this.query=e,this.Ha=i,this.Ya=null,this.hasCachedResults=!1,this.current=!1,this.Za=Wr(),this.mutatedKeys=Wr(),this.Xa=Qse(e),this.eu=new xS(this.Xa)}get tu(){return this.Ha}nu(e,i){const o=i?i.ru:new OQ,l=i?i.eu:this.eu;let u=i?i.mutatedKeys:this.mutatedKeys,p=l,y=!1;const E=this.query.limitType==="F"&&l.size===this.query.limit?l.last():null,b=this.query.limitType==="L"&&l.size===this.query.limit?l.first():null;if(e.inorderTraversal(((T,R)=>{const O=l.get(T),L=GN(this.query,R)?R:null,D=!!O&&this.mutatedKeys.has(O.key),U=!!L&&(L.hasLocalMutations||this.mutatedKeys.has(L.key)&&L.hasCommittedMutations);let F=!1;O&&L?O.data.isEqual(L.data)?D!==U&&(o.track({type:3,doc:L}),F=!0):this.iu(O,L)||(o.track({type:2,doc:L}),F=!0,(E&&this.Xa(L,E)>0||b&&this.Xa(L,b)<0)&&(y=!0)):!O&&L?(o.track({type:0,doc:L}),F=!0):O&&!L&&(o.track({type:1,doc:O}),F=!0,(E||b)&&(y=!0)),F&&(L?(p=p.add(L),u=U?u.add(T):u.delete(T)):(p=p.delete(T),u=u.delete(T)))})),this.query.limit!==null)for(;p.size>this.query.limit;){const T=this.query.limitType==="F"?p.last():p.first();p=p.delete(T.key),u=u.delete(T.key),o.track({type:1,doc:T})}return{eu:p,ru:o,Ds:y,mutatedKeys:u}}iu(e,i){return e.hasLocalMutations&&i.hasCommittedMutations&&!i.hasLocalMutations}applyChanges(e,i,o,l){const u=this.eu;this.eu=e.eu,this.mutatedKeys=e.mutatedKeys;const p=e.ru.pa();p.sort(((T,R)=>(function(L,D){const U=F=>{switch(F){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return er(20277,{At:F})}};return U(L)-U(D)})(T.type,R.type)||this.Xa(T.doc,R.doc))),this.su(o),l=l!=null&&l;const y=i&&!l?this.ou():[],E=this.Za.size===0&&this.current&&!l?1:0,b=E!==this.Ya;return this.Ya=E,p.length!==0||b?{snapshot:new nb(this.query,e.eu,u,p,e.mutatedKeys,E===0,b,!1,!!o&&o.resumeToken.approximateByteSize()>0),_u:y}:{_u:y}}va(e){return this.current&&e==="Offline"?(this.current=!1,this.applyChanges({eu:this.eu,ru:new OQ,mutatedKeys:this.mutatedKeys,Ds:!1},!1)):{_u:[]}}au(e){return!this.Ha.has(e)&&!!this.eu.has(e)&&!this.eu.get(e).hasLocalMutations}su(e){e&&(e.addedDocuments.forEach((i=>this.Ha=this.Ha.add(i))),e.modifiedDocuments.forEach((i=>{})),e.removedDocuments.forEach((i=>this.Ha=this.Ha.delete(i))),this.current=e.current)}ou(){if(!this.current)return[];const e=this.Za;this.Za=Wr(),this.eu.forEach((o=>{this.au(o.key)&&(this.Za=this.Za.add(o.key))}));const i=[];return e.forEach((o=>{this.Za.has(o)||i.push(new xoe(o))})),this.Za.forEach((o=>{e.has(o)||i.push(new Noe(o))})),i}uu(e){this.Ha=e.qs,this.Za=Wr();const i=this.nu(e.documents);return this.applyChanges(i,!0)}cu(){return nb.fromInitialDocuments(this.query,this.eu,this.mutatedKeys,this.Ya===0,this.hasCachedResults)}}const T3="SyncEngine";class $6e{constructor(e,i,o){this.query=e,this.targetId=i,this.view=o}}class K6e{constructor(e){this.key=e,this.lu=!1}}class q6e{constructor(e,i,o,l,u,p){this.localStore=e,this.remoteStore=i,this.eventManager=o,this.sharedClientState=l,this.currentUser=u,this.maxConcurrentLimboResolutions=p,this.hu={},this.Pu=new RE((y=>Jse(y)),WN),this.Tu=new Map,this.Iu=new Set,this.du=new xs(kn.comparator),this.Eu=new Map,this.Au=new u3,this.Ru={},this.Vu=new Map,this.mu=tb.ur(),this.onlineState="Unknown",this.fu=void 0}get isPrimaryClient(){return this.fu===!0}}async function Y6e(n,e,i=!0){const o=joe(n);let l;const u=o.Pu.get(e);return u?(o.sharedClientState.addLocalQueryTarget(u.targetId),l=u.view.cu()):l=await Doe(o,e,i,!0),l}async function X6e(n,e){const i=joe(n);await Doe(i,e,!0,!1)}async function Doe(n,e,i,o){const l=await g6e(n.localStore,Bp(e)),u=l.targetId,p=n.sharedClientState.addLocalQueryTarget(u,i);let y;return o&&(y=await J6e(n,e,u,p==="current",l.resumeToken)),n.isPrimaryClient&&i&&Roe(n.remoteStore,l),y}async function J6e(n,e,i,o,l){n.gu=(R,O,L)=>(async function(U,F,Y,W){let re=F.view.nu(Y);re.Ds&&(re=await TQ(U.localStore,F.query,!1).then((({documents:q})=>F.view.nu(q,re))));const le=W&&W.targetChanges.get(F.targetId),ie=W&&W.targetMismatches.get(F.targetId)!=null,me=F.view.applyChanges(re,U.isPrimaryClient,le,ie);return DQ(U,F.targetId,me._u),me.snapshot})(n,R,O,L);const u=await TQ(n.localStore,e,!0),p=new H6e(e,u.qs),y=p.nu(u.documents),E=cI.createSynthesizedTargetChangeForCurrentChange(i,o&&n.onlineState!=="Offline",l),b=p.applyChanges(y,n.isPrimaryClient,E);DQ(n,i,b._u);const T=new $6e(e,i,p);return n.Pu.set(e,T),n.Tu.has(i)?n.Tu.get(i).push(e):n.Tu.set(i,[e]),b.snapshot}async function Q6e(n,e,i){const o=fr(n),l=o.Pu.get(e),u=o.Tu.get(l.targetId);if(u.length>1)return o.Tu.set(l.targetId,u.filter((p=>!WN(p,e)))),void o.Pu.delete(e);o.isPrimaryClient?(o.sharedClientState.removeLocalQueryTarget(l.targetId),o.sharedClientState.isActiveQueryTarget(l.targetId)||await F5(o.localStore,l.targetId,!1).then((()=>{o.sharedClientState.clearQueryState(l.targetId),i&&f3(o.remoteStore,l.targetId),W5(o,l.targetId)})).catch(fb)):(W5(o,l.targetId),await F5(o.localStore,l.targetId,!0))}async function Z6e(n,e){const i=fr(n),o=i.Pu.get(e),l=i.Tu.get(o.targetId);i.isPrimaryClient&&l.length===1&&(i.sharedClientState.removeLocalQueryTarget(o.targetId),f3(i.remoteStore,o.targetId))}async function eBe(n,e,i){const o=aBe(n);try{const l=await(function(p,y){const E=fr(p),b=ls.now(),T=y.reduce(((L,D)=>L.add(D.key)),Wr());let R,O;return E.persistence.runTransaction("Locally write mutations","readwrite",(L=>{let D=sm(),U=Wr();return E.Os.getEntries(L,T).next((F=>{D=F,D.forEach(((Y,W)=>{W.isValidDocument()||(U=U.add(Y))}))})).next((()=>E.localDocuments.getOverlayedDocuments(L,D))).next((F=>{R=F;const Y=[];for(const W of y){const re=g4e(W,R.get(W.key).overlayedDocument);re!=null&&Y.push(new n_(W.key,re,Gse(re.value.mapValue),gd.exists(!0)))}return E.mutationQueue.addMutationBatch(L,b,Y,y)})).next((F=>{O=F;const Y=F.applyToLocalDocumentSet(R,U);return E.documentOverlayCache.saveOverlays(L,F.batchId,Y)}))})).then((()=>({batchId:O.batchId,changes:eoe(R)})))})(o.localStore,e);o.sharedClientState.addPendingMutation(l.batchId),(function(p,y,E){let b=p.Ru[p.currentUser.toKey()];b||(b=new xs(kr)),b=b.insert(y,E),p.Ru[p.currentUser.toKey()]=b})(o,l.batchId,i),await uI(o,l.changes),await XN(o.remoteStore)}catch(l){const u=E3(l,"Failed to persist write");i.reject(u)}}async function Loe(n,e){const i=fr(n);try{const o=await p6e(i.localStore,e);e.targetChanges.forEach(((l,u)=>{const p=i.Eu.get(u);p&&(Ci(l.addedDocuments.size+l.modifiedDocuments.size+l.removedDocuments.size<=1,22616),l.addedDocuments.size>0?p.lu=!0:l.modifiedDocuments.size>0?Ci(p.lu,14607):l.removedDocuments.size>0&&(Ci(p.lu,42227),p.lu=!1))})),await uI(i,o,e)}catch(o){await fb(o)}}function xQ(n,e,i){const o=fr(n);if(o.isPrimaryClient&&i===0||!o.isPrimaryClient&&i===1){const l=[];o.Pu.forEach(((u,p)=>{const y=p.view.va(e);y.snapshot&&l.push(y.snapshot)})),(function(p,y){const E=fr(p);E.onlineState=y;let b=!1;E.queries.forEach(((T,R)=>{for(const O of R.wa)O.va(y)&&(b=!0)})),b&&b3(E)})(o.eventManager,e),l.length&&o.hu.J_(l),o.onlineState=e,o.isPrimaryClient&&o.sharedClientState.setOnlineState(e)}}async function tBe(n,e,i){const o=fr(n);o.sharedClientState.updateQueryState(e,"rejected",i);const l=o.Eu.get(e),u=l&&l.key;if(u){let p=new xs(kn.comparator);p=p.insert(u,pc.newNoDocument(u,ur.min()));const y=Wr().add(u),E=new KN(ur.min(),new Map,new xs(kr),p,y);await Loe(o,E),o.du=o.du.remove(u),o.Eu.delete(e),C3(o)}else await F5(o.localStore,e,!1).then((()=>W5(o,e,i))).catch(fb)}async function nBe(n,e){const i=fr(n),o=e.batch.batchId;try{const l=await h6e(i.localStore,e);Uoe(i,o,null),Moe(i,o),i.sharedClientState.updateMutationState(o,"acknowledged"),await uI(i,l)}catch(l){await fb(l)}}async function rBe(n,e,i){const o=fr(n);try{const l=await(function(p,y){const E=fr(p);return E.persistence.runTransaction("Reject batch","readwrite-primary",(b=>{let T;return E.mutationQueue.lookupMutationBatch(b,y).next((R=>(Ci(R!==null,37113),T=R.keys(),E.mutationQueue.removeMutationBatch(b,R)))).next((()=>E.mutationQueue.performConsistencyCheck(b))).next((()=>E.documentOverlayCache.removeOverlaysForBatchId(b,T,y))).next((()=>E.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(b,T))).next((()=>E.localDocuments.getDocuments(b,T)))}))})(o.localStore,e);Uoe(o,e,i),Moe(o,e),o.sharedClientState.updateMutationState(e,"rejected",i),await uI(o,l)}catch(l){await fb(l)}}function Moe(n,e){(n.Vu.get(e)||[]).forEach((i=>{i.resolve()})),n.Vu.delete(e)}function Uoe(n,e,i){const o=fr(n);let l=o.Ru[o.currentUser.toKey()];if(l){const u=l.get(e);u&&(i?u.reject(i):u.resolve(),l=l.remove(e)),o.Ru[o.currentUser.toKey()]=l}}function W5(n,e,i=null){n.sharedClientState.removeLocalQueryTarget(e);for(const o of n.Tu.get(e))n.Pu.delete(o),i&&n.hu.pu(o,i);n.Tu.delete(e),n.isPrimaryClient&&n.Au.zr(e).forEach((o=>{n.Au.containsKey(o)||Voe(n,o)}))}function Voe(n,e){n.Iu.delete(e.path.canonicalString());const i=n.du.get(e);i!==null&&(f3(n.remoteStore,i),n.du=n.du.remove(e),n.Eu.delete(i),C3(n))}function DQ(n,e,i){for(const o of i)o instanceof Noe?(n.Au.addReference(o.key,e),iBe(n,o)):o instanceof xoe?(fn(T3,"Document no longer in limbo: "+o.key),n.Au.removeReference(o.key,e),n.Au.containsKey(o.key)||Voe(n,o.key)):er(19791,{yu:o})}function iBe(n,e){const i=e.key,o=i.path.canonicalString();n.du.get(i)||n.Iu.has(o)||(fn(T3,"New document in limbo: "+i),n.Iu.add(o),C3(n))}function C3(n){for(;n.Iu.size>0&&n.du.size<n.maxConcurrentLimboResolutions;){const e=n.Iu.values().next().value;n.Iu.delete(e);const i=new kn(qi.fromString(e)),o=n.mu.next();n.Eu.set(o,new K6e(i)),n.du=n.du.insert(i,o),Roe(n.remoteStore,new Dg(Bp(zN(i.path)),o,"TargetPurposeLimboResolution",VN.ue))}}async function uI(n,e,i){const o=fr(n),l=[],u=[],p=[];o.Pu.isEmpty()||(o.Pu.forEach(((y,E)=>{p.push(o.gu(E,e,i).then((b=>{var T;if((b||i)&&o.isPrimaryClient){const R=b?!b.fromCache:(T=i==null?void 0:i.targetChanges.get(E.targetId))===null||T===void 0?void 0:T.current;o.sharedClientState.updateQueryState(E.targetId,R?"current":"not-current")}if(b){l.push(b);const R=h3.Es(E.targetId,b);u.push(R)}})))})),await Promise.all(p),o.hu.J_(l),await(async function(E,b){const T=fr(E);try{await T.persistence.runTransaction("notifyLocalViewChanges","readwrite",(R=>At.forEach(b,(O=>At.forEach(O.Is,(L=>T.persistence.referenceDelegate.addReference(R,O.targetId,L))).next((()=>At.forEach(O.ds,(L=>T.persistence.referenceDelegate.removeReference(R,O.targetId,L)))))))))}catch(R){if(!mb(R))throw R;fn(p3,"Failed to update sequence numbers: "+R)}for(const R of b){const O=R.targetId;if(!R.fromCache){const L=T.Fs.get(O),D=L.snapshotVersion,U=L.withLastLimboFreeSnapshotVersion(D);T.Fs=T.Fs.insert(O,U)}}})(o.localStore,u))}async function sBe(n,e){const i=fr(n);if(!i.currentUser.isEqual(e)){fn(T3,"User change. New user:",e.toKey());const o=await boe(i.localStore,e);i.currentUser=e,(function(u,p){u.Vu.forEach((y=>{y.forEach((E=>{E.reject(new Xt(Et.CANCELLED,p))}))})),u.Vu.clear()})(i,"'waitForPendingWrites' promise is rejected due to a user change."),i.sharedClientState.handleUserChange(e,o.removedBatchIds,o.addedBatchIds),await uI(i,o.Bs)}}function oBe(n,e){const i=fr(n),o=i.Eu.get(e);if(o&&o.lu)return Wr().add(o.key);{let l=Wr();const u=i.Tu.get(e);if(!u)return l;for(const p of u){const y=i.Pu.get(p);l=l.unionWith(y.view.tu)}return l}}function joe(n){const e=fr(n);return e.remoteStore.remoteSyncer.applyRemoteEvent=Loe.bind(null,e),e.remoteStore.remoteSyncer.getRemoteKeysForTarget=oBe.bind(null,e),e.remoteStore.remoteSyncer.rejectListen=tBe.bind(null,e),e.hu.J_=W6e.bind(null,e.eventManager),e.hu.pu=G6e.bind(null,e.eventManager),e}function aBe(n){const e=fr(n);return e.remoteStore.remoteSyncer.applySuccessfulWrite=nBe.bind(null,e),e.remoteStore.remoteSyncer.rejectFailedWrite=rBe.bind(null,e),e}class Gk{constructor(){this.kind="memory",this.synchronizeTabs=!1}async initialize(e){this.serializer=qN(e.databaseInfo.databaseId),this.sharedClientState=this.bu(e),this.persistence=this.Du(e),await this.persistence.start(),this.localStore=this.vu(e),this.gcScheduler=this.Cu(e,this.localStore),this.indexBackfillerScheduler=this.Fu(e,this.localStore)}Cu(e,i){return null}Fu(e,i){return null}vu(e){return d6e(this.persistence,new c6e,e.initialUser,this.serializer)}Du(e){return new Soe(d3.Vi,this.serializer)}bu(e){return new y6e}async terminate(){var e,i;(e=this.gcScheduler)===null||e===void 0||e.stop(),(i=this.indexBackfillerScheduler)===null||i===void 0||i.stop(),this.sharedClientState.shutdown(),await this.persistence.shutdown()}}Gk.provider={build:()=>new Gk};class cBe extends Gk{constructor(e){super(),this.cacheSizeBytes=e}Cu(e,i){Ci(this.persistence.referenceDelegate instanceof zk,46915);const o=this.persistence.referenceDelegate.garbageCollector;return new K4e(o,e.asyncQueue,i)}Du(e){const i=this.cacheSizeBytes!==void 0?Sl.withCacheSize(this.cacheSizeBytes):Sl.DEFAULT;return new Soe((o=>zk.Vi(o,i)),this.serializer)}}class G5{async initialize(e,i){this.localStore||(this.localStore=e.localStore,this.sharedClientState=e.sharedClientState,this.datastore=this.createDatastore(i),this.remoteStore=this.createRemoteStore(i),this.eventManager=this.createEventManager(i),this.syncEngine=this.createSyncEngine(i,!e.synchronizeTabs),this.sharedClientState.onlineStateHandler=o=>xQ(this.syncEngine,o,1),this.remoteStore.remoteSyncer.handleCredentialChange=sBe.bind(null,this.syncEngine),await F6e(this.remoteStore,this.syncEngine.isPrimaryClient))}createEventManager(e){return(function(){return new z6e})()}createDatastore(e){const i=qN(e.databaseInfo.databaseId),o=(function(u){return new w6e(u)})(e.databaseInfo);return(function(u,p,y,E){return new I6e(u,p,y,E)})(e.authCredentials,e.appCheckCredentials,o,i)}createRemoteStore(e){return(function(o,l,u,p,y){return new P6e(o,l,u,p,y)})(this.localStore,this.datastore,e.asyncQueue,(i=>xQ(this.syncEngine,i,0)),(function(){return IQ.C()?new IQ:new E6e})())}createSyncEngine(e,i){return(function(l,u,p,y,E,b,T){const R=new q6e(l,u,p,y,E,b);return T&&(R.fu=!0),R})(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,e.initialUser,e.maxConcurrentLimboResolutions,i)}async terminate(){var e,i;await(async function(l){const u=fr(l);fn(mE,"RemoteStore shutting down."),u.Ia.add(5),await lI(u),u.Ea.shutdown(),u.Aa.set("Unknown")})(this.remoteStore),(e=this.datastore)===null||e===void 0||e.terminate(),(i=this.eventManager)===null||i===void 0||i.terminate()}}G5.provider={build:()=>new G5};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class R3{constructor(e){this.observer=e,this.muted=!1}next(e){this.muted||this.observer.next&&this.xu(this.observer.next,e)}error(e){this.muted||(this.observer.error?this.xu(this.observer.error,e):im("Uncaught Error in snapshot listener:",e.toString()))}Ou(){this.muted=!0}xu(e,i){setTimeout((()=>{this.muted||e(i)}),0)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Yg="FirestoreClient";class lBe{constructor(e,i,o,l,u){this.authCredentials=e,this.appCheckCredentials=i,this.asyncQueue=o,this.databaseInfo=l,this.user=hc.UNAUTHENTICATED,this.clientId=ZF.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this._uninitializedComponentsProvider=u,this.authCredentials.start(o,(async p=>{fn(Yg,"Received user=",p.uid),await this.authCredentialListener(p),this.user=p})),this.appCheckCredentials.start(o,(p=>(fn(Yg,"Received new app check token=",p),this.appCheckCredentialListener(p,this.user))))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(e){this.authCredentialListener=e}setAppCheckTokenChangeListener(e){this.appCheckCredentialListener=e}terminate(){this.asyncQueue.enterRestrictedMode();const e=new Yf;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted((async()=>{try{this._onlineComponents&&await this._onlineComponents.terminate(),this._offlineComponents&&await this._offlineComponents.terminate(),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),e.resolve()}catch(i){const o=E3(i,"Failed to shutdown persistence");e.reject(o)}})),e.promise}}async function gV(n,e){n.asyncQueue.verifyOperationInProgress(),fn(Yg,"Initializing OfflineComponentProvider");const i=n.configuration;await e.initialize(i);let o=i.initialUser;n.setCredentialChangeListener((async l=>{o.isEqual(l)||(await boe(e.localStore,l),o=l)})),e.persistence.setDatabaseDeletedListener((()=>{Wg("Terminating Firestore due to IndexedDb database deletion"),n.terminate().then((()=>{fn("Terminating Firestore due to IndexedDb database deletion completed successfully")})).catch((l=>{Wg("Terminating Firestore due to IndexedDb database deletion failed",l)}))})),n._offlineComponents=e}async function LQ(n,e){n.asyncQueue.verifyOperationInProgress();const i=await uBe(n);fn(Yg,"Initializing OnlineComponentProvider"),await e.initialize(i,n.configuration),n.setCredentialChangeListener((o=>PQ(e.remoteStore,o))),n.setAppCheckTokenChangeListener(((o,l)=>PQ(e.remoteStore,l))),n._onlineComponents=e}async function uBe(n){if(!n._offlineComponents)if(n._uninitializedComponentsProvider){fn(Yg,"Using user provided OfflineComponentProvider");try{await gV(n,n._uninitializedComponentsProvider._offline)}catch(e){const i=e;if(!(function(l){return l.name==="FirebaseError"?l.code===Et.FAILED_PRECONDITION||l.code===Et.UNIMPLEMENTED:!(typeof DOMException<"u"&&l instanceof DOMException)||l.code===22||l.code===20||l.code===11})(i))throw i;Wg("Error using user provided cache. Falling back to memory cache: "+i),await gV(n,new Gk)}}else fn(Yg,"Using default OfflineComponentProvider"),await gV(n,new cBe(void 0));return n._offlineComponents}async function Foe(n){return n._onlineComponents||(n._uninitializedComponentsProvider?(fn(Yg,"Using user provided OnlineComponentProvider"),await LQ(n,n._uninitializedComponentsProvider._online)):(fn(Yg,"Using default OnlineComponentProvider"),await LQ(n,new G5))),n._onlineComponents}function dBe(n){return Foe(n).then((e=>e.syncEngine))}async function Hk(n){const e=await Foe(n),i=e.eventManager;return i.onListen=Y6e.bind(null,e.syncEngine),i.onUnlisten=Q6e.bind(null,e.syncEngine),i.onFirstRemoteStoreListen=X6e.bind(null,e.syncEngine),i.onLastRemoteStoreUnlisten=Z6e.bind(null,e.syncEngine),i}function hBe(n,e,i={}){const o=new Yf;return n.asyncQueue.enqueueAndForget((async()=>(function(u,p,y,E,b){const T=new R3({next:O=>{T.Ou(),p.enqueueAndForget((()=>S3(u,R)));const L=O.docs.has(y);!L&&O.fromCache?b.reject(new Xt(Et.UNAVAILABLE,"Failed to get document because the client is offline.")):L&&O.fromCache&&E&&E.source==="server"?b.reject(new Xt(Et.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):b.resolve(O)},error:O=>b.reject(O)}),R=new w3(zN(y.path),T,{includeMetadataChanges:!0,ka:!0});return v3(u,R)})(await Hk(n),n.asyncQueue,e,i,o))),o.promise}function pBe(n,e,i={}){const o=new Yf;return n.asyncQueue.enqueueAndForget((async()=>(function(u,p,y,E,b){const T=new R3({next:O=>{T.Ou(),p.enqueueAndForget((()=>S3(u,R))),O.fromCache&&E.source==="server"?b.reject(new Xt(Et.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):b.resolve(O)},error:O=>b.reject(O)}),R=new w3(y,T,{includeMetadataChanges:!0,ka:!0});return v3(u,R)})(await Hk(n),n.asyncQueue,e,i,o))),o.promise}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Boe(n){const e={};return n.timeoutSeconds!==void 0&&(e.timeoutSeconds=n.timeoutSeconds),e}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const MQ=new Map;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const zoe="firestore.googleapis.com",UQ=!0;class VQ{constructor(e){var i,o;if(e.host===void 0){if(e.ssl!==void 0)throw new Xt(Et.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host=zoe,this.ssl=UQ}else this.host=e.host,this.ssl=(i=e.ssl)!==null&&i!==void 0?i:UQ;if(this.isUsingEmulator=e.emulatorOptions!==void 0,this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,this.localCache=e.localCache,e.cacheSizeBytes===void 0)this.cacheSizeBytes=voe;else{if(e.cacheSizeBytes!==-1&&e.cacheSizeBytes<H4e)throw new Xt(Et.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=e.cacheSizeBytes}P3e("experimentalForceLongPolling",e.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",e.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:e.experimentalAutoDetectLongPolling===void 0?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!e.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=Boe((o=e.experimentalLongPollingOptions)!==null&&o!==void 0?o:{}),(function(u){if(u.timeoutSeconds!==void 0){if(isNaN(u.timeoutSeconds))throw new Xt(Et.INVALID_ARGUMENT,`invalid long polling timeout: ${u.timeoutSeconds} (must not be NaN)`);if(u.timeoutSeconds<5)throw new Xt(Et.INVALID_ARGUMENT,`invalid long polling timeout: ${u.timeoutSeconds} (minimum allowed value is 5)`);if(u.timeoutSeconds>30)throw new Xt(Et.INVALID_ARGUMENT,`invalid long polling timeout: ${u.timeoutSeconds} (maximum allowed value is 30)`)}})(this.experimentalLongPollingOptions),this.useFetchStreams=!!e.useFetchStreams}isEqual(e){return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&(function(o,l){return o.timeoutSeconds===l.timeoutSeconds})(this.experimentalLongPollingOptions,e.experimentalLongPollingOptions)&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}}class JN{constructor(e,i,o,l){this._authCredentials=e,this._appCheckCredentials=i,this._databaseId=o,this._app=l,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new VQ({}),this._settingsFrozen=!1,this._emulatorOptions={},this._terminateTask="notTerminated"}get app(){if(!this._app)throw new Xt(Et.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return this._terminateTask!=="notTerminated"}_setSettings(e){if(this._settingsFrozen)throw new Xt(Et.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new VQ(e),this._emulatorOptions=e.emulatorOptions||{},e.credentials!==void 0&&(this._authCredentials=(function(o){if(!o)return new v3e;switch(o.type){case"firstParty":return new T3e(o.sessionIndex||"0",o.iamToken||null,o.authTokenFactory||null);case"provider":return o.client;default:throw new Xt(Et.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}})(e.credentials))}_getSettings(){return this._settings}_getEmulatorOptions(){return this._emulatorOptions}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask==="notTerminated"&&(this._terminateTask=this._terminate()),this._terminateTask}async _restart(){this._terminateTask==="notTerminated"?await this._terminate():this._terminateTask="notTerminated"}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return(function(i){const o=MQ.get(i);o&&(fn("ComponentProvider","Removing Datastore"),MQ.delete(i),o.terminate())})(this),Promise.resolve()}}function fBe(n,e,i,o={}){var l;n=Pl(n,JN);const u=cm(e),p=n._getSettings(),y=Object.assign(Object.assign({},p),{emulatorOptions:n._getEmulatorOptions()}),E=`${e}:${i}`;u&&(kN(`https://${E}`),NN("Firestore",!0)),p.host!==zoe&&p.host!==E&&Wg("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used.");const b=Object.assign(Object.assign({},p),{host:E,ssl:u,emulatorOptions:o});if(!em(b,y)&&(n._setSettings(b),o.mockUserToken)){let T,R;if(typeof o.mockUserToken=="string")T=o.mockUserToken,R=hc.MOCK_USER;else{T=Mie(o.mockUserToken,(l=n._app)===null||l===void 0?void 0:l.options.projectId);const O=o.mockUserToken.sub||o.mockUserToken.user_id;if(!O)throw new Xt(Et.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");R=new hc(O)}n._authCredentials=new S3e(new kse(T,R))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Yp{constructor(e,i,o){this.converter=i,this._query=o,this.type="query",this.firestore=e}withConverter(e){return new Yp(this.firestore,e,this._query)}}class Ks{constructor(e,i,o){this.converter=i,this._key=o,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new Vg(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new Ks(this.firestore,e,this._key)}toJSON(){return{type:Ks._jsonSchemaVersion,referencePath:this._key.toString()}}static fromJSON(e,i,o){if(oI(i,Ks._jsonSchema))return new Ks(e,o||null,new kn(qi.fromString(i.referencePath)))}}Ks._jsonSchemaVersion="firestore/documentReference/1.0",Ks._jsonSchema={type:No("string",Ks._jsonSchemaVersion),referencePath:No("string")};class Vg extends Yp{constructor(e,i,o){super(e,i,zN(o)),this._path=o,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){const e=this._path.popLast();return e.isEmpty()?null:new Ks(this.firestore,null,new kn(e))}withConverter(e){return new Vg(this.firestore,e,this._path)}}function mc(n,e,...i){if(n=Ni(n),xse("collection","path",e),n instanceof JN){const o=qi.fromString(e,...i);return QJ(o),new Vg(n,null,o)}{if(!(n instanceof Ks||n instanceof Vg))throw new Xt(Et.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const o=n._path.child(qi.fromString(e,...i));return QJ(o),new Vg(n.firestore,null,o)}}function dr(n,e,...i){if(n=Ni(n),arguments.length===1&&(e=ZF.newId()),xse("doc","path",e),n instanceof JN){const o=qi.fromString(e,...i);return JJ(o),new Ks(n,null,new kn(o))}{if(!(n instanceof Ks||n instanceof Vg))throw new Xt(Et.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const o=n._path.child(qi.fromString(e,...i));return JJ(o),new Ks(n.firestore,n instanceof Vg?n.converter:null,new kn(o))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const jQ="AsyncQueue";class FQ{constructor(e=Promise.resolve()){this.Zu=[],this.Xu=!1,this.ec=[],this.tc=null,this.nc=!1,this.rc=!1,this.sc=[],this.F_=new Toe(this,"async_queue_retry"),this.oc=()=>{const o=mV();o&&fn(jQ,"Visibility state changed to "+o.visibilityState),this.F_.y_()},this._c=e;const i=mV();i&&typeof i.addEventListener=="function"&&i.addEventListener("visibilitychange",this.oc)}get isShuttingDown(){return this.Xu}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.ac(),this.uc(e)}enterRestrictedMode(e){if(!this.Xu){this.Xu=!0,this.rc=e||!1;const i=mV();i&&typeof i.removeEventListener=="function"&&i.removeEventListener("visibilitychange",this.oc)}}enqueue(e){if(this.ac(),this.Xu)return new Promise((()=>{}));const i=new Yf;return this.uc((()=>this.Xu&&this.rc?Promise.resolve():(e().then(i.resolve,i.reject),i.promise))).then((()=>i.promise))}enqueueRetryable(e){this.enqueueAndForget((()=>(this.Zu.push(e),this.cc())))}async cc(){if(this.Zu.length!==0){try{await this.Zu[0](),this.Zu.shift(),this.F_.reset()}catch(e){if(!mb(e))throw e;fn(jQ,"Operation failed with retryable error: "+e)}this.Zu.length>0&&this.F_.g_((()=>this.cc()))}}uc(e){const i=this._c.then((()=>(this.nc=!0,e().catch((o=>{throw this.tc=o,this.nc=!1,im("INTERNAL UNHANDLED ERROR: ",BQ(o)),o})).then((o=>(this.nc=!1,o))))));return this._c=i,i}enqueueAfterDelay(e,i,o){this.ac(),this.sc.indexOf(e)>-1&&(i=0);const l=y3.createAndSchedule(this,e,i,o,(u=>this.lc(u)));return this.ec.push(l),l}ac(){this.tc&&er(47125,{hc:BQ(this.tc)})}verifyOperationInProgress(){}async Pc(){let e;do e=this._c,await e;while(e!==this._c)}Tc(e){for(const i of this.ec)if(i.timerId===e)return!0;return!1}Ic(e){return this.Pc().then((()=>{this.ec.sort(((i,o)=>i.targetTimeMs-o.targetTimeMs));for(const i of this.ec)if(i.skipDelay(),e!=="all"&&i.timerId===e)break;return this.Pc()}))}dc(e){this.sc.push(e)}lc(e){const i=this.ec.indexOf(e);this.ec.splice(i,1)}}function BQ(n){let e=n.message||"";return n.stack&&(e=n.stack.includes(n.message)?n.stack:n.message+`
`+n.stack),e}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function zQ(n){return(function(i,o){if(typeof i!="object"||i===null)return!1;const l=i;for(const u of o)if(u in l&&typeof l[u]=="function")return!0;return!1})(n,["next","error","complete"])}class om extends JN{constructor(e,i,o,l){super(e,i,o,l),this.type="firestore",this._queue=new FQ,this._persistenceKey=(l==null?void 0:l.name)||"[DEFAULT]"}async _terminate(){if(this._firestoreClient){const e=this._firestoreClient.terminate();this._queue=new FQ(e),this._firestoreClient=void 0,await e}}}function J0(n,e){const i=typeof n=="object"?n:xN(),o=typeof n=="string"?n:Lk,l=tI(i,"firestore").getImmediate({identifier:o});if(!l._initialized){const u=BF("firestore");u&&fBe(l,...u)}return l}function QN(n){if(n._terminated)throw new Xt(Et.FAILED_PRECONDITION,"The client has already been terminated.");return n._firestoreClient||mBe(n),n._firestoreClient}function mBe(n){var e,i,o;const l=n._freezeSettings(),u=(function(y,E,b,T){return new B3e(y,E,b,T.host,T.ssl,T.experimentalForceLongPolling,T.experimentalAutoDetectLongPolling,Boe(T.experimentalLongPollingOptions),T.useFetchStreams,T.isUsingEmulator)})(n._databaseId,((e=n._app)===null||e===void 0?void 0:e.options.appId)||"",n._persistenceKey,l);n._componentsProvider||!((i=l.localCache)===null||i===void 0)&&i._offlineComponentProvider&&(!((o=l.localCache)===null||o===void 0)&&o._onlineComponentProvider)&&(n._componentsProvider={_offline:l.localCache._offlineComponentProvider,_online:l.localCache._onlineComponentProvider}),n._firestoreClient=new lBe(n._authCredentials,n._appCheckCredentials,n._queue,u,n._componentsProvider&&(function(y){const E=y==null?void 0:y._online.build();return{_offline:y==null?void 0:y._offline.build(E),_online:E}})(n._componentsProvider))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class dd{constructor(e){this._byteString=e}static fromBase64String(e){try{return new dd(Ba.fromBase64String(e))}catch(i){throw new Xt(Et.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+i)}}static fromUint8Array(e){return new dd(Ba.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}toJSON(){return{type:dd._jsonSchemaVersion,bytes:this.toBase64()}}static fromJSON(e){if(oI(e,dd._jsonSchema))return dd.fromBase64String(e.bytes)}}dd._jsonSchemaVersion="firestore/bytes/1.0",dd._jsonSchema={type:No("string",dd._jsonSchemaVersion),bytes:No("string")};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ZN{constructor(...e){for(let i=0;i<e.length;++i)if(e[i].length===0)throw new Xt(Et.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new Fa(e)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class dI{constructor(e){this._methodName=e}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Wp{constructor(e,i){if(!isFinite(e)||e<-90||e>90)throw new Xt(Et.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(i)||i<-180||i>180)throw new Xt(Et.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+i);this._lat=e,this._long=i}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}_compareTo(e){return kr(this._lat,e._lat)||kr(this._long,e._long)}toJSON(){return{latitude:this._lat,longitude:this._long,type:Wp._jsonSchemaVersion}}static fromJSON(e){if(oI(e,Wp._jsonSchema))return new Wp(e.latitude,e.longitude)}}Wp._jsonSchemaVersion="firestore/geoPoint/1.0",Wp._jsonSchema={type:No("string",Wp._jsonSchemaVersion),latitude:No("number"),longitude:No("number")};/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Gp{constructor(e){this._values=(e||[]).map((i=>i))}toArray(){return this._values.map((e=>e))}isEqual(e){return(function(o,l){if(o.length!==l.length)return!1;for(let u=0;u<o.length;++u)if(o[u]!==l[u])return!1;return!0})(this._values,e._values)}toJSON(){return{type:Gp._jsonSchemaVersion,vectorValues:this._values}}static fromJSON(e){if(oI(e,Gp._jsonSchema)){if(Array.isArray(e.vectorValues)&&e.vectorValues.every((i=>typeof i=="number")))return new Gp(e.vectorValues);throw new Xt(Et.INVALID_ARGUMENT,"Expected 'vectorValues' field to be a number array")}}}Gp._jsonSchemaVersion="firestore/vectorValue/1.0",Gp._jsonSchema={type:No("string",Gp._jsonSchemaVersion),vectorValues:No("object")};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const gBe=/^__.*__$/;class _Be{constructor(e,i,o){this.data=e,this.fieldMask=i,this.fieldTransforms=o}toMutation(e,i){return this.fieldMask!==null?new n_(e,this.data,this.fieldMask,i,this.fieldTransforms):new aI(e,this.data,i,this.fieldTransforms)}}class Woe{constructor(e,i,o){this.data=e,this.fieldMask=i,this.fieldTransforms=o}toMutation(e,i){return new n_(e,this.data,this.fieldMask,i,this.fieldTransforms)}}function Goe(n){switch(n){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw er(40011,{Ec:n})}}class ex{constructor(e,i,o,l,u,p){this.settings=e,this.databaseId=i,this.serializer=o,this.ignoreUndefinedProperties=l,u===void 0&&this.Ac(),this.fieldTransforms=u||[],this.fieldMask=p||[]}get path(){return this.settings.path}get Ec(){return this.settings.Ec}Rc(e){return new ex(Object.assign(Object.assign({},this.settings),e),this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}Vc(e){var i;const o=(i=this.path)===null||i===void 0?void 0:i.child(e),l=this.Rc({path:o,mc:!1});return l.fc(e),l}gc(e){var i;const o=(i=this.path)===null||i===void 0?void 0:i.child(e),l=this.Rc({path:o,mc:!1});return l.Ac(),l}yc(e){return this.Rc({path:void 0,mc:!0})}wc(e){return $k(e,this.settings.methodName,this.settings.Sc||!1,this.path,this.settings.bc)}contains(e){return this.fieldMask.find((i=>e.isPrefixOf(i)))!==void 0||this.fieldTransforms.find((i=>e.isPrefixOf(i.field)))!==void 0}Ac(){if(this.path)for(let e=0;e<this.path.length;e++)this.fc(this.path.get(e))}fc(e){if(e.length===0)throw this.wc("Document fields must not be empty");if(Goe(this.Ec)&&gBe.test(e))throw this.wc('Document fields cannot begin and end with "__"')}}class yBe{constructor(e,i,o){this.databaseId=e,this.ignoreUndefinedProperties=i,this.serializer=o||qN(e)}Dc(e,i,o,l=!1){return new ex({Ec:e,methodName:i,bc:o,path:Fa.emptyPath(),mc:!1,Sc:l},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}}function hI(n){const e=n._freezeSettings(),i=qN(n._databaseId);return new yBe(n._databaseId,!!e.ignoreUndefinedProperties,i)}function Hoe(n,e,i,o,l,u={}){const p=n.Dc(u.merge||u.mergeFields?2:0,e,i,l);P3("Data must be an object, but it was:",p,o);const y=qoe(o,p);let E,b;if(u.merge)E=new pu(p.fieldMask),b=p.fieldTransforms;else if(u.mergeFields){const T=[];for(const R of u.mergeFields){const O=H5(e,R,i);if(!p.contains(O))throw new Xt(Et.INVALID_ARGUMENT,`Field '${O}' is specified in your field mask but missing from your input data.`);Xoe(T,O)||T.push(O)}E=new pu(T),b=p.fieldTransforms.filter((R=>E.covers(R.field)))}else E=null,b=p.fieldTransforms;return new _Be(new Tl(y),E,b)}class tx extends dI{_toFieldTransform(e){if(e.Ec!==2)throw e.Ec===1?e.wc(`${this._methodName}() can only appear at the top level of your update data`):e.wc(`${this._methodName}() cannot be used with set() unless you pass {merge:true}`);return e.fieldMask.push(e.path),null}isEqual(e){return e instanceof tx}}function $oe(n,e,i){return new ex({Ec:3,bc:e.settings.bc,methodName:n._methodName,mc:i},e.databaseId,e.serializer,e.ignoreUndefinedProperties)}class I3 extends dI{constructor(e,i){super(e),this.vc=i}_toFieldTransform(e){const i=$oe(this,e,!0),o=this.vc.map((u=>AE(u,i))),l=new ZS(o);return new aoe(e.path,l)}isEqual(e){return e instanceof I3&&em(this.vc,e.vc)}}class A3 extends dI{constructor(e,i){super(e),this.vc=i}_toFieldTransform(e){const i=$oe(this,e,!0),o=this.vc.map((u=>AE(u,i))),l=new eb(o);return new aoe(e.path,l)}isEqual(e){return e instanceof A3&&em(this.vc,e.vc)}}function EBe(n,e,i,o){const l=n.Dc(1,e,i);P3("Data must be an object, but it was:",l,o);const u=[],p=Tl.empty();t_(o,((E,b)=>{const T=O3(e,E,i);b=Ni(b);const R=l.gc(T);if(b instanceof tx)u.push(T);else{const O=AE(b,R);O!=null&&(u.push(T),p.set(T,O))}}));const y=new pu(u);return new Woe(p,y,l.fieldTransforms)}function vBe(n,e,i,o,l,u){const p=n.Dc(1,e,i),y=[H5(e,o,i)],E=[l];if(u.length%2!=0)throw new Xt(Et.INVALID_ARGUMENT,`Function ${e}() needs to be called with an even number of arguments that alternate between field names and values.`);for(let O=0;O<u.length;O+=2)y.push(H5(e,u[O])),E.push(u[O+1]);const b=[],T=Tl.empty();for(let O=y.length-1;O>=0;--O)if(!Xoe(b,y[O])){const L=y[O];let D=E[O];D=Ni(D);const U=p.gc(L);if(D instanceof tx)b.push(L);else{const F=AE(D,U);F!=null&&(b.push(L),T.set(L,F))}}const R=new pu(b);return new Woe(T,R,p.fieldTransforms)}function Koe(n,e,i,o=!1){return AE(i,n.Dc(o?4:3,e))}function AE(n,e){if(Yoe(n=Ni(n)))return P3("Unsupported field value:",e,n),qoe(n,e);if(n instanceof dI)return(function(o,l){if(!Goe(l.Ec))throw l.wc(`${o._methodName}() can only be used with update() and set()`);if(!l.path)throw l.wc(`${o._methodName}() is not currently supported inside arrays`);const u=o._toFieldTransform(l);u&&l.fieldTransforms.push(u)})(n,e),null;if(n===void 0&&e.ignoreUndefinedProperties)return null;if(e.path&&e.fieldMask.push(e.path),n instanceof Array){if(e.settings.mc&&e.Ec!==4)throw e.wc("Nested arrays are not supported");return(function(o,l){const u=[];let p=0;for(const y of o){let E=AE(y,l.yc(p));E==null&&(E={nullValue:"NULL_VALUE"}),u.push(E),p++}return{arrayValue:{values:u}}})(n,e)}return(function(o,l){if((o=Ni(o))===null)return{nullValue:"NULL_VALUE"};if(typeof o=="number")return u4e(l.serializer,o);if(typeof o=="boolean")return{booleanValue:o};if(typeof o=="string")return{stringValue:o};if(o instanceof Date){const u=ls.fromDate(o);return{timestampValue:Bk(l.serializer,u)}}if(o instanceof ls){const u=new ls(o.seconds,1e3*Math.floor(o.nanoseconds/1e3));return{timestampValue:Bk(l.serializer,u)}}if(o instanceof Wp)return{geoPointValue:{latitude:o.latitude,longitude:o.longitude}};if(o instanceof dd)return{bytesValue:poe(l.serializer,o._byteString)};if(o instanceof Ks){const u=l.databaseId,p=o.firestore._databaseId;if(!p.isEqual(u))throw l.wc(`Document reference is for database ${p.projectId}/${p.database} but should be for database ${u.projectId}/${u.database}`);return{referenceValue:l3(o.firestore._databaseId||l.databaseId,o._key.path)}}if(o instanceof Gp)return(function(p,y){return{mapValue:{fields:{[zse]:{stringValue:Wse},[Mk]:{arrayValue:{values:p.toArray().map((b=>{if(typeof b!="number")throw y.wc("VectorValues must only contain numeric values.");return s3(y.serializer,b)}))}}}}}})(o,l);throw l.wc(`Unsupported field value: ${UN(o)}`)})(n,e)}function qoe(n,e){const i={};return Mse(n)?e.path&&e.path.length>0&&e.fieldMask.push(e.path):t_(n,((o,l)=>{const u=AE(l,e.Vc(o));u!=null&&(i[o]=u)})),{mapValue:{fields:i}}}function Yoe(n){return!(typeof n!="object"||n===null||n instanceof Array||n instanceof Date||n instanceof ls||n instanceof Wp||n instanceof dd||n instanceof Ks||n instanceof dI||n instanceof Gp)}function P3(n,e,i){if(!Yoe(i)||!Dse(i)){const o=UN(i);throw o==="an object"?e.wc(n+" a custom object"):e.wc(n+" "+o)}}function H5(n,e,i){if((e=Ni(e))instanceof ZN)return e._internalPath;if(typeof e=="string")return O3(n,e);throw $k("Field path arguments must be of type string or ",n,!1,void 0,i)}const SBe=new RegExp("[~\\*/\\[\\]]");function O3(n,e,i){if(e.search(SBe)>=0)throw $k(`Invalid field path (${e}). Paths must not contain '~', '*', '/', '[', or ']'`,n,!1,void 0,i);try{return new ZN(...e.split("."))._internalPath}catch{throw $k(`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,n,!1,void 0,i)}}function $k(n,e,i,o,l){const u=o&&!o.isEmpty(),p=l!==void 0;let y=`Function ${e}() called with invalid data`;i&&(y+=" (via `toFirestore()`)"),y+=". ";let E="";return(u||p)&&(E+=" (found",u&&(E+=` in field ${o}`),p&&(E+=` in document ${l}`),E+=")"),new Xt(Et.INVALID_ARGUMENT,y+n+E)}function Xoe(n,e){return n.some((i=>i.isEqual(e)))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class k3{constructor(e,i,o,l,u){this._firestore=e,this._userDataWriter=i,this._key=o,this._document=l,this._converter=u}get id(){return this._key.path.lastSegment()}get ref(){return new Ks(this._firestore,this._converter,this._key)}exists(){return this._document!==null}data(){if(this._document){if(this._converter){const e=new bBe(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}return this._userDataWriter.convertValue(this._document.data.value)}}get(e){if(this._document){const i=this._document.data.field(nx("DocumentSnapshot.get",e));if(i!==null)return this._userDataWriter.convertValue(i)}}}class bBe extends k3{data(){return super.data()}}function nx(n,e){return typeof e=="string"?O3(n,e):e instanceof ZN?e._internalPath:e._delegate._internalPath}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Joe(n){if(n.limitType==="L"&&n.explicitOrderBy.length===0)throw new Xt(Et.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}class N3{}class rx extends N3{}function xR(n,e,...i){let o=[];e instanceof N3&&o.push(e),o=o.concat(i),(function(u){const p=u.filter((E=>E instanceof x3)).length,y=u.filter((E=>E instanceof ix)).length;if(p>1||p>0&&y>0)throw new Xt(Et.INVALID_ARGUMENT,"InvalidQuery. When using composite filters, you cannot use more than one filter at the top level. Consider nesting the multiple filters within an `and(...)` statement. For example: change `query(query, where(...), or(...))` to `query(query, and(where(...), or(...)))`.")})(o);for(const l of o)n=l._apply(n);return n}class ix extends rx{constructor(e,i,o){super(),this._field=e,this._op=i,this._value=o,this.type="where"}static _create(e,i,o){return new ix(e,i,o)}_apply(e){const i=this._parse(e);return eae(e._query,i),new Yp(e.firestore,e.converter,L5(e._query,i))}_parse(e){const i=hI(e.firestore);return(function(u,p,y,E,b,T,R){let O;if(b.isKeyField()){if(T==="array-contains"||T==="array-contains-any")throw new Xt(Et.INVALID_ARGUMENT,`Invalid Query. You can't perform '${T}' queries on documentId().`);if(T==="in"||T==="not-in"){HQ(R,T);const D=[];for(const U of R)D.push(GQ(E,u,U));O={arrayValue:{values:D}}}else O=GQ(E,u,R)}else T!=="in"&&T!=="not-in"&&T!=="array-contains-any"||HQ(R,T),O=Koe(y,p,R,T==="in"||T==="not-in");return ko.create(b,T,O)})(e._query,"where",i,e.firestore._databaseId,this._field,this._op,this._value)}}function WQ(n,e,i){const o=e,l=nx("where",n);return ix._create(l,o,i)}class x3 extends N3{constructor(e,i){super(),this.type=e,this._queryConstraints=i}static _create(e,i){return new x3(e,i)}_parse(e){const i=this._queryConstraints.map((o=>o._parse(e))).filter((o=>o.getFilters().length>0));return i.length===1?i[0]:bh.create(i,this._getOperator())}_apply(e){const i=this._parse(e);return i.getFilters().length===0?e:((function(l,u){let p=l;const y=u.getFlattenedFilters();for(const E of y)eae(p,E),p=L5(p,E)})(e._query,i),new Yp(e.firestore,e.converter,L5(e._query,i)))}_getQueryConstraints(){return this._queryConstraints}_getOperator(){return this.type==="and"?"and":"or"}}class D3 extends rx{constructor(e,i){super(),this._field=e,this._direction=i,this.type="orderBy"}static _create(e,i){return new D3(e,i)}_apply(e){const i=(function(l,u,p){if(l.startAt!==null)throw new Xt(Et.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(l.endAt!==null)throw new Xt(Et.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");return new NR(u,p)})(e._query,this._field,this._direction);return new Yp(e.firestore,e.converter,(function(l,u){const p=l.explicitOrderBy.concat([u]);return new CE(l.path,l.collectionGroup,p,l.filters.slice(),l.limit,l.limitType,l.startAt,l.endAt)})(e._query,i))}}function Qoe(n,e="asc"){const i=e,o=nx("orderBy",n);return D3._create(o,i)}class L3 extends rx{constructor(e,i,o){super(),this.type=e,this._limit=i,this._limitType=o}static _create(e,i,o){return new L3(e,i,o)}_apply(e){return new Yp(e.firestore,e.converter,Vk(e._query,this._limit,this._limitType))}}function Zoe(n){return O3e("limit",n),L3._create("limit",n,"F")}class M3 extends rx{constructor(e,i,o){super(),this.type=e,this._docOrFields=i,this._inclusive=o}static _create(e,i,o){return new M3(e,i,o)}_apply(e){const i=TBe(e,this.type,this._docOrFields,this._inclusive);return new Yp(e.firestore,e.converter,(function(l,u){return new CE(l.path,l.collectionGroup,l.explicitOrderBy.slice(),l.filters.slice(),l.limit,l.limitType,u,l.endAt)})(e._query,i))}}function wBe(...n){return M3._create("startAt",n,!0)}function TBe(n,e,i,o){if(i[0]=Ni(i[0]),i[0]instanceof k3)return(function(u,p,y,E,b){if(!E)throw new Xt(Et.NOT_FOUND,`Can't use a DocumentSnapshot that doesn't exist for ${y}().`);const T=[];for(const R of NS(u))if(R.field.isKeyField())T.push(Uk(p,E.key));else{const O=E.data.field(R.field);if(FN(O))throw new Xt(Et.INVALID_ARGUMENT,'Invalid query. You are trying to start or end a query using a document for which the field "'+R.field+'" is an uncommitted server timestamp. (Since the value of this field is unknown, you cannot start/end a query with it.)');if(O===null){const L=R.field.canonicalString();throw new Xt(Et.INVALID_ARGUMENT,`Invalid query. You are trying to start or end a query using a document for which the field '${L}' (used as the orderBy) does not exist.`)}T.push(O)}return new QS(T,b)})(n._query,n.firestore._databaseId,e,i[0]._document,o);{const l=hI(n.firestore);return(function(p,y,E,b,T,R){const O=p.explicitOrderBy;if(T.length>O.length)throw new Xt(Et.INVALID_ARGUMENT,`Too many arguments provided to ${b}(). The number of arguments must be less than or equal to the number of orderBy() clauses`);const L=[];for(let D=0;D<T.length;D++){const U=T[D];if(O[D].field.isKeyField()){if(typeof U!="string")throw new Xt(Et.INVALID_ARGUMENT,`Invalid query. Expected a string for document ID in ${b}(), but got a ${typeof U}`);if(!i3(p)&&U.indexOf("/")!==-1)throw new Xt(Et.INVALID_ARGUMENT,`Invalid query. When querying a collection and ordering by documentId(), the value passed to ${b}() must be a plain document ID, but '${U}' contains a slash.`);const F=p.path.child(qi.fromString(U));if(!kn.isDocumentKey(F))throw new Xt(Et.INVALID_ARGUMENT,`Invalid query. When querying a collection group and ordering by documentId(), the value passed to ${b}() must result in a valid document path, but '${F}' is not because it contains an odd number of segments.`);const Y=new kn(F);L.push(Uk(y,Y))}else{const F=Koe(E,b,U);L.push(F)}}return new QS(L,R)})(n._query,n.firestore._databaseId,l,e,i,o)}}function GQ(n,e,i){if(typeof(i=Ni(i))=="string"){if(i==="")throw new Xt(Et.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!i3(e)&&i.indexOf("/")!==-1)throw new Xt(Et.INVALID_ARGUMENT,`Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '${i}' contains a '/' character.`);const o=e.path.child(qi.fromString(i));if(!kn.isDocumentKey(o))throw new Xt(Et.INVALID_ARGUMENT,`Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '${o}' is not because it has an odd number of segments (${o.length}).`);return Uk(n,new kn(o))}if(i instanceof Ks)return Uk(n,i._key);throw new Xt(Et.INVALID_ARGUMENT,`Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ${UN(i)}.`)}function HQ(n,e){if(!Array.isArray(n)||n.length===0)throw new Xt(Et.INVALID_ARGUMENT,`Invalid Query. A non-empty array is required for '${e.toString()}' filters.`)}function eae(n,e){const i=(function(l,u){for(const p of l)for(const y of p.getFlattenedFilters())if(u.indexOf(y.op)>=0)return y.op;return null})(n.filters,(function(l){switch(l){case"!=":return["!=","not-in"];case"array-contains-any":case"in":return["not-in"];case"not-in":return["array-contains-any","in","not-in","!="];default:return[]}})(e.op));if(i!==null)throw i===e.op?new Xt(Et.INVALID_ARGUMENT,`Invalid query. You cannot use more than one '${e.op.toString()}' filter.`):new Xt(Et.INVALID_ARGUMENT,`Invalid query. You cannot use '${e.op.toString()}' filters with '${i.toString()}' filters.`)}class CBe{convertValue(e,i="none"){switch(Kg(e)){case 0:return null;case 1:return e.booleanValue;case 2:return po(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,i);case 5:return e.stringValue;case 6:return this.convertBytes($g(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,i);case 11:return this.convertObject(e.mapValue,i);case 10:return this.convertVectorValue(e.mapValue);default:throw er(62114,{value:e})}}convertObject(e,i){return this.convertObjectMap(e.fields,i)}convertObjectMap(e,i="none"){const o={};return t_(e,((l,u)=>{o[l]=this.convertValue(u,i)})),o}convertVectorValue(e){var i,o,l;const u=(l=(o=(i=e.fields)===null||i===void 0?void 0:i[Mk].arrayValue)===null||o===void 0?void 0:o.values)===null||l===void 0?void 0:l.map((p=>po(p.doubleValue)));return new Gp(u)}convertGeoPoint(e){return new Wp(po(e.latitude),po(e.longitude))}convertArray(e,i){return(e.values||[]).map((o=>this.convertValue(o,i)))}convertServerTimestamp(e,i){switch(i){case"previous":const o=BN(e);return o==null?null:this.convertValue(o,i);case"estimate":return this.convertTimestamp(PR(e));default:return null}}convertTimestamp(e){const i=Hg(e);return new ls(i.seconds,i.nanos)}convertDocumentKey(e,i){const o=qi.fromString(e);Ci(Eoe(o),9688,{name:e});const l=new OR(o.get(1),o.get(3)),u=new kn(o.popFirst(5));return l.isEqual(i)||im(`Document ${u} contains a document reference within a different database (${l.projectId}/${l.database}) which is not supported. It will be treated as a reference in the current database (${i.projectId}/${i.database}) instead.`),u}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function tae(n,e,i){let o;return o=n?i&&(i.merge||i.mergeFields)?n.toFirestore(e,i):n.toFirestore(e):e,o}class xC{constructor(e,i){this.hasPendingWrites=e,this.fromCache=i}isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}}class eE extends k3{constructor(e,i,o,l,u,p){super(e,i,o,l,p),this._firestore=e,this._firestoreImpl=e,this.metadata=u}exists(){return super.exists()}data(e={}){if(this._document){if(this._converter){const i=new rk(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(i,e)}return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps)}}get(e,i={}){if(this._document){const o=this._document.data.field(nx("DocumentSnapshot.get",e));if(o!==null)return this._userDataWriter.convertValue(o,i.serverTimestamps)}}toJSON(){if(this.metadata.hasPendingWrites)throw new Xt(Et.FAILED_PRECONDITION,"DocumentSnapshot.toJSON() attempted to serialize a document with pending writes. Await waitForPendingWrites() before invoking toJSON().");const e=this._document,i={};return i.type=eE._jsonSchemaVersion,i.bundle="",i.bundleSource="DocumentSnapshot",i.bundleName=this._key.toString(),!e||!e.isValidDocument()||!e.isFoundDocument()?i:(this._userDataWriter.convertObjectMap(e.data.value.mapValue.fields,"previous"),i.bundle=(this._firestore,this.ref.path,"NOT SUPPORTED"),i)}}eE._jsonSchemaVersion="firestore/documentSnapshot/1.0",eE._jsonSchema={type:No("string",eE._jsonSchemaVersion),bundleSource:No("string","DocumentSnapshot"),bundleName:No("string"),bundle:No("string")};class rk extends eE{data(e={}){return super.data(e)}}class tE{constructor(e,i,o,l){this._firestore=e,this._userDataWriter=i,this._snapshot=l,this.metadata=new xC(l.hasPendingWrites,l.fromCache),this.query=o}get docs(){const e=[];return this.forEach((i=>e.push(i))),e}get size(){return this._snapshot.docs.size}get empty(){return this.size===0}forEach(e,i){this._snapshot.docs.forEach((o=>{e.call(i,new rk(this._firestore,this._userDataWriter,o.key,o,new xC(this._snapshot.mutatedKeys.has(o.key),this._snapshot.fromCache),this.query.converter))}))}docChanges(e={}){const i=!!e.includeMetadataChanges;if(i&&this._snapshot.excludesMetadataChanges)throw new Xt(Et.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===i||(this._cachedChanges=(function(l,u){if(l._snapshot.oldDocs.isEmpty()){let p=0;return l._snapshot.docChanges.map((y=>{const E=new rk(l._firestore,l._userDataWriter,y.doc.key,y.doc,new xC(l._snapshot.mutatedKeys.has(y.doc.key),l._snapshot.fromCache),l.query.converter);return y.doc,{type:"added",doc:E,oldIndex:-1,newIndex:p++}}))}{let p=l._snapshot.oldDocs;return l._snapshot.docChanges.filter((y=>u||y.type!==3)).map((y=>{const E=new rk(l._firestore,l._userDataWriter,y.doc.key,y.doc,new xC(l._snapshot.mutatedKeys.has(y.doc.key),l._snapshot.fromCache),l.query.converter);let b=-1,T=-1;return y.type!==0&&(b=p.indexOf(y.doc.key),p=p.delete(y.doc.key)),y.type!==1&&(p=p.add(y.doc),T=p.indexOf(y.doc.key)),{type:RBe(y.type),doc:E,oldIndex:b,newIndex:T}}))}})(this,i),this._cachedChangesIncludeMetadataChanges=i),this._cachedChanges}toJSON(){if(this.metadata.hasPendingWrites)throw new Xt(Et.FAILED_PRECONDITION,"QuerySnapshot.toJSON() attempted to serialize a document with pending writes. Await waitForPendingWrites() before invoking toJSON().");const e={};e.type=tE._jsonSchemaVersion,e.bundleSource="QuerySnapshot",e.bundleName=ZF.newId(),this._firestore._databaseId.database,this._firestore._databaseId.projectId;const i=[],o=[],l=[];return this.docs.forEach((u=>{u._document!==null&&(i.push(u._document),o.push(this._userDataWriter.convertObjectMap(u._document.data.value.mapValue.fields,"previous")),l.push(u.ref.path))})),e.bundle=(this._firestore,this.query._query,e.bundleName,"NOT SUPPORTED"),e}}function RBe(n){switch(n){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return er(61501,{type:n})}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Qo(n){n=Pl(n,Ks);const e=Pl(n.firestore,om);return hBe(QN(e),n._key).then((i=>rae(e,n,i)))}tE._jsonSchemaVersion="firestore/querySnapshot/1.0",tE._jsonSchema={type:No("string",tE._jsonSchemaVersion),bundleSource:No("string","QuerySnapshot"),bundleName:No("string"),bundle:No("string")};class U3 extends CBe{constructor(e){super(),this.firestore=e}convertBytes(e){return new dd(e)}convertReference(e){const i=this.convertDocumentKey(e,this.firestore._databaseId);return new Ks(this.firestore,null,i)}}function _d(n){n=Pl(n,Yp);const e=Pl(n.firestore,om),i=QN(e),o=new U3(e);return Joe(n._query),pBe(i,n._query).then((l=>new tE(e,o,n,l)))}function Xg(n,e,i){n=Pl(n,Ks);const o=Pl(n.firestore,om),l=tae(n.converter,e,i);return ax(o,[Hoe(hI(o),"setDoc",n._key,l,n.converter!==null,i).toMutation(n._key,gd.none())])}function qs(n,e,i,...o){n=Pl(n,Ks);const l=Pl(n.firestore,om),u=hI(l);let p;return p=typeof(e=Ni(e))=="string"||e instanceof ZN?vBe(u,"updateDoc",n._key,e,i,o):EBe(u,"updateDoc",n._key,e),ax(l,[p.toMutation(n._key,gd.exists(!0))])}function sx(n){return ax(Pl(n.firestore,om),[new o3(n._key,gd.none())])}function nae(n,e){const i=Pl(n.firestore,om),o=dr(n),l=tae(n.converter,e);return ax(i,[Hoe(hI(n.firestore),"addDoc",o._key,l,n.converter!==null,{}).toMutation(o._key,gd.exists(!1))]).then((()=>o))}function ox(n,...e){var i,o,l;n=Ni(n);let u={includeMetadataChanges:!1,source:"default"},p=0;typeof e[p]!="object"||zQ(e[p])||(u=e[p++]);const y={includeMetadataChanges:u.includeMetadataChanges,source:u.source};if(zQ(e[p])){const R=e[p];e[p]=(i=R.next)===null||i===void 0?void 0:i.bind(R),e[p+1]=(o=R.error)===null||o===void 0?void 0:o.bind(R),e[p+2]=(l=R.complete)===null||l===void 0?void 0:l.bind(R)}let E,b,T;if(n instanceof Ks)b=Pl(n.firestore,om),T=zN(n._key.path),E={next:R=>{e[p]&&e[p](rae(b,n,R))},error:e[p+1],complete:e[p+2]};else{const R=Pl(n,Yp);b=Pl(R.firestore,om),T=R._query;const O=new U3(b);E={next:L=>{e[p]&&e[p](new tE(b,O,R,L))},error:e[p+1],complete:e[p+2]},Joe(n._query)}return(function(O,L,D,U){const F=new R3(U),Y=new w3(L,F,D);return O.asyncQueue.enqueueAndForget((async()=>v3(await Hk(O),Y))),()=>{F.Ou(),O.asyncQueue.enqueueAndForget((async()=>S3(await Hk(O),Y)))}})(QN(b),T,y,E)}function ax(n,e){return(function(o,l){const u=new Yf;return o.asyncQueue.enqueueAndForget((async()=>eBe(await dBe(o),l,u))),u.promise})(QN(n),e)}function rae(n,e,i){const o=i.docs.get(e._key),l=new U3(n);return new eE(n,l,e._key,o,new xC(i.hasPendingWrites,i.fromCache),e.converter)}function IBe(...n){return new I3("arrayUnion",n)}function iae(...n){return new A3("arrayRemove",n)}(function(e,i=!0){(function(l){pb=l})(TE),zg(new tm("firestore",((o,{instanceIdentifier:l,options:u})=>{const p=o.getProvider("app").getImmediate(),y=new om(new b3e(o.getProvider("auth-internal")),new C3e(p,o.getProvider("app-check-internal")),(function(b,T){if(!Object.prototype.hasOwnProperty.apply(b.options,["projectId"]))throw new Xt(Et.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new OR(b.options.projectId,T)})(p,l),p);return u=Object.assign({useFetchStreams:i},u),y._setSettings(u),y}),"PUBLIC").setMultipleInstances(!0)),md($J,KJ,e),md($J,KJ,"esm2017")})();var ABe="firebase",PBe="11.10.0";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */md(ABe,PBe,"app");/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const OBe="type.googleapis.com/google.protobuf.Int64Value",kBe="type.googleapis.com/google.protobuf.UInt64Value";function sae(n,e){const i={};for(const o in n)n.hasOwnProperty(o)&&(i[o]=e(n[o]));return i}function Kk(n){if(n==null)return null;if(n instanceof Number&&(n=n.valueOf()),typeof n=="number"&&isFinite(n)||n===!0||n===!1||Object.prototype.toString.call(n)==="[object String]")return n;if(n instanceof Date)return n.toISOString();if(Array.isArray(n))return n.map(e=>Kk(e));if(typeof n=="function"||typeof n=="object")return sae(n,e=>Kk(e));throw new Error("Data cannot be encoded in JSON: "+n)}function rb(n){if(n==null)return n;if(n["@type"])switch(n["@type"]){case OBe:case kBe:{const e=Number(n.value);if(isNaN(e))throw new Error("Data cannot be decoded from JSON: "+n);return e}default:throw new Error("Data cannot be decoded from JSON: "+n)}return Array.isArray(n)?n.map(e=>rb(e)):typeof n=="function"||typeof n=="object"?sae(n,e=>rb(e)):n}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const V3="functions";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const $Q={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class Rl extends Th{constructor(e,i,o){super(`${V3}/${e}`,i||""),this.details=o,Object.setPrototypeOf(this,Rl.prototype)}}function NBe(n){if(n>=200&&n<300)return"ok";switch(n){case 0:return"internal";case 400:return"invalid-argument";case 401:return"unauthenticated";case 403:return"permission-denied";case 404:return"not-found";case 409:return"aborted";case 429:return"resource-exhausted";case 499:return"cancelled";case 500:return"internal";case 501:return"unimplemented";case 503:return"unavailable";case 504:return"deadline-exceeded"}return"unknown"}function qk(n,e){let i=NBe(n),o=i,l;try{const u=e&&e.error;if(u){const p=u.status;if(typeof p=="string"){if(!$Q[p])return new Rl("internal","internal");i=$Q[p],o=p}const y=u.message;typeof y=="string"&&(o=y),l=u.details,l!==void 0&&(l=rb(l))}}catch{}return i==="ok"?null:new Rl(i,o,l)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class xBe{constructor(e,i,o,l){this.app=e,this.auth=null,this.messaging=null,this.appCheck=null,this.serverAppAppCheckToken=null,wl(e)&&e.settings.appCheckToken&&(this.serverAppAppCheckToken=e.settings.appCheckToken),this.auth=i.getImmediate({optional:!0}),this.messaging=o.getImmediate({optional:!0}),this.auth||i.get().then(u=>this.auth=u,()=>{}),this.messaging||o.get().then(u=>this.messaging=u,()=>{}),this.appCheck||l==null||l.get().then(u=>this.appCheck=u,()=>{})}async getAuthToken(){if(this.auth)try{const e=await this.auth.getToken();return e==null?void 0:e.accessToken}catch{return}}async getMessagingToken(){if(!(!this.messaging||!("Notification"in self)||Notification.permission!=="granted"))try{return await this.messaging.getToken()}catch{return}}async getAppCheckToken(e){if(this.serverAppAppCheckToken)return this.serverAppAppCheckToken;if(this.appCheck){const i=e?await this.appCheck.getLimitedUseToken():await this.appCheck.getToken();return i.error?null:i.token}return null}async getContext(e){const i=await this.getAuthToken(),o=await this.getMessagingToken(),l=await this.getAppCheckToken(e);return{authToken:i,messagingToken:o,appCheckToken:l}}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const $5="us-central1",DBe=/^data: (.*?)(?:\n|$)/;function LBe(n){let e=null;return{promise:new Promise((i,o)=>{e=setTimeout(()=>{o(new Rl("deadline-exceeded","deadline-exceeded"))},n)}),cancel:()=>{e&&clearTimeout(e)}}}class MBe{constructor(e,i,o,l,u=$5,p=(...y)=>fetch(...y)){this.app=e,this.fetchImpl=p,this.emulatorOrigin=null,this.contextProvider=new xBe(e,i,o,l),this.cancelAllRequests=new Promise(y=>{this.deleteService=()=>Promise.resolve(y())});try{const y=new URL(u);this.customDomain=y.origin+(y.pathname==="/"?"":y.pathname),this.region=$5}catch{this.customDomain=null,this.region=u}}_delete(){return this.deleteService()}_url(e){const i=this.app.options.projectId;return this.emulatorOrigin!==null?`${this.emulatorOrigin}/${i}/${this.region}/${e}`:this.customDomain!==null?`${this.customDomain}/${e}`:`https://${this.region}-${i}.cloudfunctions.net/${e}`}}function UBe(n,e,i){const o=cm(e);n.emulatorOrigin=`http${o?"s":""}://${e}:${i}`,o&&(kN(n.emulatorOrigin),NN("Functions",!0))}function VBe(n,e,i){const o=l=>FBe(n,e,l,{});return o.stream=(l,u)=>zBe(n,e,l,u),o}async function jBe(n,e,i,o){i["Content-Type"]="application/json";let l;try{l=await o(n,{method:"POST",body:JSON.stringify(e),headers:i})}catch{return{status:0,json:null}}let u=null;try{u=await l.json()}catch{}return{status:l.status,json:u}}async function oae(n,e){const i={},o=await n.contextProvider.getContext(e.limitedUseAppCheckTokens);return o.authToken&&(i.Authorization="Bearer "+o.authToken),o.messagingToken&&(i["Firebase-Instance-ID-Token"]=o.messagingToken),o.appCheckToken!==null&&(i["X-Firebase-AppCheck"]=o.appCheckToken),i}function FBe(n,e,i,o){const l=n._url(e);return BBe(n,l,i,o)}async function BBe(n,e,i,o){i=Kk(i);const l={data:i},u=await oae(n,o),p=o.timeout||7e4,y=LBe(p),E=await Promise.race([jBe(e,l,u,n.fetchImpl),y.promise,n.cancelAllRequests]);if(y.cancel(),!E)throw new Rl("cancelled","Firebase Functions instance was deleted.");const b=qk(E.status,E.json);if(b)throw b;if(!E.json)throw new Rl("internal","Response is not valid JSON object.");let T=E.json.data;if(typeof T>"u"&&(T=E.json.result),typeof T>"u")throw new Rl("internal","Response is missing data field.");return{data:rb(T)}}function zBe(n,e,i,o){const l=n._url(e);return WBe(n,l,i,o||{})}async function WBe(n,e,i,o){var l;i=Kk(i);const u={data:i},p=await oae(n,o);p["Content-Type"]="application/json",p.Accept="text/event-stream";let y;try{y=await n.fetchImpl(e,{method:"POST",body:JSON.stringify(u),headers:p,signal:o==null?void 0:o.signal})}catch(L){if(L instanceof Error&&L.name==="AbortError"){const U=new Rl("cancelled","Request was cancelled.");return{data:Promise.reject(U),stream:{[Symbol.asyncIterator](){return{next(){return Promise.reject(U)}}}}}}const D=qk(0,null);return{data:Promise.reject(D),stream:{[Symbol.asyncIterator](){return{next(){return Promise.reject(D)}}}}}}let E,b;const T=new Promise((L,D)=>{E=L,b=D});(l=o==null?void 0:o.signal)===null||l===void 0||l.addEventListener("abort",()=>{const L=new Rl("cancelled","Request was cancelled.");b(L)});const R=y.body.getReader(),O=GBe(R,E,b,o==null?void 0:o.signal);return{stream:{[Symbol.asyncIterator](){const L=O.getReader();return{async next(){const{value:D,done:U}=await L.read();return{value:D,done:U}},async return(){return await L.cancel(),{done:!0,value:void 0}}}}},data:T}}function GBe(n,e,i,o){const l=(p,y)=>{const E=p.match(DBe);if(!E)return;const b=E[1];try{const T=JSON.parse(b);if("result"in T){e(rb(T.result));return}if("message"in T){y.enqueue(rb(T.message));return}if("error"in T){const R=qk(0,T);y.error(R),i(R);return}}catch(T){if(T instanceof Rl){y.error(T),i(T);return}}},u=new TextDecoder;return new ReadableStream({start(p){let y="";return E();async function E(){if(o!=null&&o.aborted){const b=new Rl("cancelled","Request was cancelled");return p.error(b),i(b),Promise.resolve()}try{const{value:b,done:T}=await n.read();if(T){y.trim()&&l(y.trim(),p),p.close();return}if(o!=null&&o.aborted){const O=new Rl("cancelled","Request was cancelled");p.error(O),i(O),await n.cancel();return}y+=u.decode(b,{stream:!0});const R=y.split(`
`);y=R.pop()||"";for(const O of R)O.trim()&&l(O.trim(),p);return E()}catch(b){const T=b instanceof Rl?b:qk(0,null);p.error(T),i(T)}}},cancel(){return n.cancel()}})}const KQ="@firebase/functions",qQ="0.12.9";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const HBe="auth-internal",$Be="app-check-internal",KBe="messaging-internal";function qBe(n){const e=(i,{instanceIdentifier:o})=>{const l=i.getProvider("app").getImmediate(),u=i.getProvider(HBe),p=i.getProvider(KBe),y=i.getProvider($Be);return new MBe(l,u,p,y,o)};zg(new tm(V3,e,"PUBLIC").setMultipleInstances(!0)),md(KQ,qQ,n),md(KQ,qQ,"esm2017")}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function YBe(n=xN(),e=$5){const o=tI(Ni(n),V3).getImmediate({identifier:e}),l=BF("functions");return l&&XBe(o,...l),o}function XBe(n,e,i){UBe(Ni(n),e,i)}function j3(n,e,i){return VBe(Ni(n),e)}qBe();const JBe=[{key:"VITE_FIREBASE_API_KEY",value:"AIzaSyCaxoNKRIMaXhotGzdAjXc5gkARoqtS3bU"},{key:"VITE_FIREBASE_AUTH_DOMAIN",value:"disruptive-metaverse.firebaseapp.com"},{key:"VITE_FIREBASE_PROJECT_ID",value:"disruptive-metaverse"},{key:"VITE_FIREBASE_STORAGE_BUCKET",value:"disruptive-metaverse.appspot.com"},{key:"VITE_FIREBASE_MESSAGING_SENDER_ID",value:"294433070603"},{key:"VITE_FIREBASE_APP_ID",value:"1:294433070603:web:136cddd196eea9614fb10e"}],QBe=JBe.filter(n=>!n.value),ik={apiKey:"AIzaSyCaxoNKRIMaXhotGzdAjXc5gkARoqtS3bU",authDomain:"disruptive-metaverse.firebaseapp.com",projectId:"disruptive-metaverse",storageBucket:"disruptive-metaverse.appspot.com",messagingSenderId:"294433070603",appId:"1:294433070603:web:136cddd196eea9614fb10e"};if(!ik.apiKey||!ik.authDomain||!ik.projectId){const n="CRITICAL: Missing required Firebase configuration. In development, set environment variables. In production builds, config should be available.";throw G.error(n),console.error(n),new Error("Missing required Firebase configuration")}QBe.length>0?G.log("Firebase: Using fallback configuration for production build (this is normal)"):G.log("Firebase: Initializing with environment configuration");let SO,F3,Fn,cx;try{SO=jie(ik),F3=qS(SO),Fn=J0(SO),cx=YBe(SO),G.log("Firebase initialized successfully")}catch(n){G.error("Failed to initialize Firebase:",n),console.error("Failed to initialize Firebase:",n)}const ud=n=>!0,YQ=(n,e)=>{const o=(n+e.charAt(0)).toLowerCase().replace(/[^a-z0-9]/g,"").substring(0,11),l=Math.floor(1e3+Math.random()*9e3);return o+l},DR=async n=>{try{if(!n||typeof n!="string"||n.trim()==="")return G.error("userFirestore: Invalid username provided to isUsernameTaken"),!0;const e=n.toLowerCase().trim();G.log(`userFirestore: Checking if username "${e}" is taken`);const i=mc(Fn,"users"),o=xR(i,Zoe(100)),l=await _d(o);let u=!1;return l.forEach(p=>{const y=p.data();y.username&&y.username.toLowerCase()===e&&(u=!0)}),G.log(`userFirestore: Username "${e}" is ${u?"taken":"available"}`),u}catch(e){return G.error("userFirestore: Error checking username availability:",e),!0}},ZBe=async(n,e)=>{let i=YQ(n,e),o=0;const l=10;for(;o<l;){if(!await DR(i))return i;i=YQ(n,e),o++}return i+Math.floor(Math.random()*100)},Fc=async n=>{try{G.log("userFirestore: Get user PUBLIC profile data for user ID: "+n);const e=dr(Fn,"users",n),i=await Qo(e);if(i.exists()){const o=i.data();return G.log("userFirestore: Found PUBLIC Profile for : "+o.Nickname),delete o.email,delete o.emailVerified,o}else return G.error("userFirestore: user profile document not found"),null}catch(e){throw G.error("userFirestore: Error fetching user public profile data:",e),e}},e8e=async(n,e,i)=>{try{if(G.log("userFirestore: Starting registerUser process"),G.log("userFirestore: Fields in additionalData:",Object.keys(i||{}).join(", ")),!i)throw G.error("userFirestore: additionalData is null or undefined"),new Error("Registration data is missing");const o={firstName:i.firstName||"",lastName:i.lastName||"",companyName:i.companyName||"",linkedInProfile:i.linkedInProfile||"",username:i.username||"",Nickname:i.Nickname||"",rpmURL:i.rpmURL||"https://models.readyplayer.me/67c8408d38f7924e15a8bd0a.glb"};G.log("userFirestore: Critical fields captured for registration"),G.log("userFirestore: Creating user auth record");const u=(await rFe(F3,n,e)).user;await pse(u),G.log("userFirestore: Verification email sent"),G.log("userFirestore: Waiting for Cloud Function to create initial document..."),await new Promise(L=>setTimeout(L,5e3));const p=dr(Fn,"users",u.uid),y=await Qo(p);if(y.exists()){G.log("userFirestore: Found document created by Cloud Function, updating with missing fields");const L=y.data(),D={};L.firstName||(D.firstName=o.firstName),L.lastName||(D.lastName=o.lastName),L.Nickname||(D.Nickname=o.Nickname),L.username||(D.username=o.username),L.companyName||(D.companyName=o.companyName),L.linkedInProfile||(D.linkedInProfile=o.linkedInProfile),L.rpmURL||(D.rpmURL=o.rpmURL),Object.keys(D).length>0&&(G.log("userFirestore: Updating document with fields:",Object.keys(D).join(", ")),await qs(p,{...D,lastUpdated:new Date}))}else{G.error("userFirestore: Cloud Function failed to create user document, creating manually"),await Xg(p,{...o,id:u.uid,groups:["users"],createdAt:new Date,lastUpdated:new Date});const L=dr(Fn,"users",u.uid,"private","data");await Xg(L,{email:u.email,emailVerified:!1})}const E=await Qo(p);if(!E.exists())throw new Error("User document does not exist even after creation attempts");let b=E.data();b.firstName||(b.firstName=o.firstName),b.lastName||(b.lastName=o.lastName),b.Nickname||(b.Nickname=o.Nickname),b.username||(b.username=o.username),b.companyName||(b.companyName=o.companyName);let T=!1,R={};for(const L in o)(!b[L]||b[L]==="")&&(R[L]=o[L],T=!0);(!b.groups||!b.groups.includes("users"))&&(R.groups=b.groups?[...b.groups,"users"]:["users"],T=!0,G.log("userFirestore: Adding user to users group")),T&&(G.log("userFirestore: Updating user document with missing fields"),G.log("userFirestore: Fields being updated:",Object.keys(R).join(", ")),await qs(p,R),b=(await Qo(p)).data());const O={...u,...b,firstName:o.firstName,lastName:o.lastName,Nickname:o.Nickname,username:o.username,companyName:o.companyName,linkedInProfile:o.linkedInProfile};return G.log("userFirestore: Registration complete, returning user data"),G.log("userFirestore: Fields included in return data:",Object.keys(O).join(", ")),O}catch(o){throw G.error("userFirestore: Error creating user:",o),o}},aae=async(n,e)=>{try{G.log(`userFirestore: Updating rpmURL for user ID: ${n}`);const i=dr(Fn,"users",n);await qs(i,{rpmURL:e,lastUpdated:new Date().toISOString()}),G.log("userFirestore: rpmURL updated successfully.")}catch(i){throw G.error("userFirestore: Error updating rpmURL:",i),i}},t8e=async(n,e)=>{try{const i=await Fc(n);return i&&i.groups?i.groups.includes(e):!1}catch(i){return G.error("userFirestore: Error checking group membership:",i),!1}},n8e=async(n,e)=>{try{if(ud(e),await DR(e))throw new Error("Username is already taken");const o=dr(Fn,"users",n);return await qs(o,{username:e,lastUpdated:new Date}),G.log(`userFirestore: Username updated for user ${n}`),!0}catch(i){throw G.error("userFirestore: Error updating username:",i),i}};var r8e={};const XQ=()=>{const n=typeof process<"u"&&r8e&&!1;return typeof window<"u"&&new URLSearchParams(window.location.search).has("dev_mode"),n};typeof XQ=="function"&&XQ();const i8e=async(n,e)=>{if(!n||!n.uid)return!1;try{if(n.groups){const l=`space_${e}_owners`;if(n.groups.includes(l))return!0}const o=qS().currentUser;if(o&&o.uid===n.uid)try{const u=(await o.getIdTokenResult(!0)).claims.groups||[],p=`space_${e}_owners`;if(u.includes(p))return!0}catch(l){console.error("Error getting token result:",l)}return!1}catch(i){return G.error("Error checking space owner permissions:",i),!1}},lx=async(n,e)=>{try{if(G.log(`userPermissions: Checking if user ${n} belongs to group ${e}`),e==="users")return G.log(`userPermissions: TESTING MODE - Always allowing access to 'users' group for user ${n}`),!0;if(n){const i=await Fc(n);if(G.log(`userPermissions: User profile for ${n}:`,i),i&&i.groups&&Array.isArray(i.groups)){if(G.log(`userPermissions: User ${n} has groups:`,i.groups),i.groups.includes(e))return G.log(`userPermissions: User ${n} belongs to group ${e} (from user document)`),!0}else G.log(`userPermissions: User ${n} has no groups or groups is not an array`);if(e==="disruptiveAdmin")try{const l=qS().currentUser;if(l&&l.uid===n){const u=await l.getIdTokenResult();if(G.log(`userPermissions: Token claims for ${n}:`,u.claims),u.claims&&u.claims.groups&&Array.isArray(u.claims.groups)&&u.claims.groups.includes(e))return G.log(`userPermissions: User ${n} belongs to group ${e} (from token claims)`),!0}}catch(o){G.error("userPermissions: Error checking token claims:",o)}}return G.log(`userPermissions: User ${n} does not belong to group ${e}`),!1}catch(i){return G.error("userPermissions: Error checking if user belongs to group:",i),!1}},s8e=["name","rpmURL","Nickname","username","created_on","height_cm","companyName","firstName","lastName","linkedInProfile","groups","isGuest","guestSpaceId","guestSessionStart"],yh={sendUserToUnity:"sendUserToUnity",playerInstantiated:"playerInstantiated",firstSceneLoaded:"firstSceneLoaded"};class o8e{constructor(){this.events={}}subscribe(e,i){this.events[e]||(this.events[e]=[]),this.events[e].push(i)}publish(e,i){const o=this.events[e];o?(o.forEach(l=>{l(i)}),G.log(`EventBus: Published event '${e}'`)):G.log(`EventBus: No subscribers for event '${e}'`)}unsubscribe(e,i){var l;const o=(l=this.events[e])==null?void 0:l.indexOf(i);o>-1&&this.events[e].splice(o,1)}}const Eh=new o8e;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const cae="firebasestorage.googleapis.com",lae="storageBucket",a8e=120*1e3,c8e=600*1e3;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Xs extends Th{constructor(e,i,o=0){super(_V(e),`Firebase Storage: ${i} (${_V(e)})`),this.status_=o,this.customData={serverResponse:null},this._baseMessage=this.message,Object.setPrototypeOf(this,Xs.prototype)}get status(){return this.status_}set status(e){this.status_=e}_codeEquals(e){return _V(e)===this.code}get serverResponse(){return this.customData.serverResponse}set serverResponse(e){this.customData.serverResponse=e,this.customData.serverResponse?this.message=`${this._baseMessage}
${this.customData.serverResponse}`:this.message=this._baseMessage}}var Ys;(function(n){n.UNKNOWN="unknown",n.OBJECT_NOT_FOUND="object-not-found",n.BUCKET_NOT_FOUND="bucket-not-found",n.PROJECT_NOT_FOUND="project-not-found",n.QUOTA_EXCEEDED="quota-exceeded",n.UNAUTHENTICATED="unauthenticated",n.UNAUTHORIZED="unauthorized",n.UNAUTHORIZED_APP="unauthorized-app",n.RETRY_LIMIT_EXCEEDED="retry-limit-exceeded",n.INVALID_CHECKSUM="invalid-checksum",n.CANCELED="canceled",n.INVALID_EVENT_NAME="invalid-event-name",n.INVALID_URL="invalid-url",n.INVALID_DEFAULT_BUCKET="invalid-default-bucket",n.NO_DEFAULT_BUCKET="no-default-bucket",n.CANNOT_SLICE_BLOB="cannot-slice-blob",n.SERVER_FILE_WRONG_SIZE="server-file-wrong-size",n.NO_DOWNLOAD_URL="no-download-url",n.INVALID_ARGUMENT="invalid-argument",n.INVALID_ARGUMENT_COUNT="invalid-argument-count",n.APP_DELETED="app-deleted",n.INVALID_ROOT_OPERATION="invalid-root-operation",n.INVALID_FORMAT="invalid-format",n.INTERNAL_ERROR="internal-error",n.UNSUPPORTED_ENVIRONMENT="unsupported-environment"})(Ys||(Ys={}));function _V(n){return"storage/"+n}function B3(){const n="An unknown error occurred, please check the error payload for server response.";return new Xs(Ys.UNKNOWN,n)}function l8e(n){return new Xs(Ys.OBJECT_NOT_FOUND,"Object '"+n+"' does not exist.")}function u8e(n){return new Xs(Ys.QUOTA_EXCEEDED,"Quota for bucket '"+n+"' exceeded, please view quota on https://firebase.google.com/pricing/.")}function d8e(){const n="User is not authenticated, please authenticate using Firebase Authentication and try again.";return new Xs(Ys.UNAUTHENTICATED,n)}function h8e(){return new Xs(Ys.UNAUTHORIZED_APP,"This app does not have permission to access Firebase Storage on this project.")}function p8e(n){return new Xs(Ys.UNAUTHORIZED,"User does not have permission to access '"+n+"'.")}function f8e(){return new Xs(Ys.RETRY_LIMIT_EXCEEDED,"Max retry time for operation exceeded, please try again.")}function m8e(){return new Xs(Ys.CANCELED,"User canceled the upload/download.")}function g8e(n){return new Xs(Ys.INVALID_URL,"Invalid URL '"+n+"'.")}function _8e(n){return new Xs(Ys.INVALID_DEFAULT_BUCKET,"Invalid default bucket '"+n+"'.")}function y8e(){return new Xs(Ys.NO_DEFAULT_BUCKET,"No default bucket found. Did you set the '"+lae+"' property when initializing the app?")}function E8e(){return new Xs(Ys.CANNOT_SLICE_BLOB,"Cannot slice blob for upload. Please retry the upload.")}function v8e(){return new Xs(Ys.NO_DOWNLOAD_URL,"The given file does not have any download URLs.")}function S8e(n){return new Xs(Ys.UNSUPPORTED_ENVIRONMENT,`${n} is missing. Make sure to install the required polyfills. See https://firebase.google.com/docs/web/environments-js-sdk#polyfills for more information.`)}function K5(n){return new Xs(Ys.INVALID_ARGUMENT,n)}function uae(){return new Xs(Ys.APP_DELETED,"The Firebase app was deleted.")}function b8e(n){return new Xs(Ys.INVALID_ROOT_OPERATION,"The operation '"+n+"' cannot be performed on a root reference, create a non-root reference using child, such as .child('file.png').")}function eR(n,e){return new Xs(Ys.INVALID_FORMAT,"String does not match format '"+n+"': "+e)}function aC(n){throw new Xs(Ys.INTERNAL_ERROR,"Internal error: "+n)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class fu{constructor(e,i){this.bucket=e,this.path_=i}get path(){return this.path_}get isRoot(){return this.path.length===0}fullServerUrl(){const e=encodeURIComponent;return"/b/"+e(this.bucket)+"/o/"+e(this.path)}bucketOnlyServerUrl(){return"/b/"+encodeURIComponent(this.bucket)+"/o"}static makeFromBucketSpec(e,i){let o;try{o=fu.makeFromUrl(e,i)}catch{return new fu(e,"")}if(o.path==="")return o;throw _8e(e)}static makeFromUrl(e,i){let o=null;const l="([A-Za-z0-9.\\-_]+)";function u(le){le.path.charAt(le.path.length-1)==="/"&&(le.path_=le.path_.slice(0,-1))}const p="(/(.*))?$",y=new RegExp("^gs://"+l+p,"i"),E={bucket:1,path:3};function b(le){le.path_=decodeURIComponent(le.path)}const T="v[A-Za-z0-9_]+",R=i.replace(/[.]/g,"\\."),O="(/([^?#]*).*)?$",L=new RegExp(`^https?://${R}/${T}/b/${l}/o${O}`,"i"),D={bucket:1,path:3},U=i===cae?"(?:storage.googleapis.com|storage.cloud.google.com)":i,F="([^?#]*)",Y=new RegExp(`^https?://${U}/${l}/${F}`,"i"),re=[{regex:y,indices:E,postModify:u},{regex:L,indices:D,postModify:b},{regex:Y,indices:{bucket:1,path:2},postModify:b}];for(let le=0;le<re.length;le++){const ie=re[le],me=ie.regex.exec(e);if(me){const q=me[ie.indices.bucket];let J=me[ie.indices.path];J||(J=""),o=new fu(q,J),ie.postModify(o);break}}if(o==null)throw g8e(e);return o}}class w8e{constructor(e){this.promise_=Promise.reject(e)}getPromise(){return this.promise_}cancel(e=!1){}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function T8e(n,e,i){let o=1,l=null,u=null,p=!1,y=0;function E(){return y===2}let b=!1;function T(...F){b||(b=!0,e.apply(null,F))}function R(F){l=setTimeout(()=>{l=null,n(L,E())},F)}function O(){u&&clearTimeout(u)}function L(F,...Y){if(b){O();return}if(F){O(),T.call(null,F,...Y);return}if(E()||p){O(),T.call(null,F,...Y);return}o<64&&(o*=2);let re;y===1?(y=2,re=0):re=(o+Math.random())*1e3,R(re)}let D=!1;function U(F){D||(D=!0,O(),!b&&(l!==null?(F||(y=2),clearTimeout(l),R(0)):F||(y=1)))}return R(0),u=setTimeout(()=>{p=!0,U(!0)},i),U}function C8e(n){n(!1)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function R8e(n){return n!==void 0}function I8e(n){return typeof n=="object"&&!Array.isArray(n)}function z3(n){return typeof n=="string"||n instanceof String}function JQ(n){return W3()&&n instanceof Blob}function W3(){return typeof Blob<"u"}function QQ(n,e,i,o){if(o<e)throw K5(`Invalid value for '${n}'. Expected ${e} or greater.`);if(o>i)throw K5(`Invalid value for '${n}'. Expected ${i} or less.`)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ux(n,e,i){let o=e;return i==null&&(o=`https://${e}`),`${i}://${o}/v0${n}`}function dae(n){const e=encodeURIComponent;let i="?";for(const o in n)if(n.hasOwnProperty(o)){const l=e(o)+"="+e(n[o]);i=i+l+"&"}return i=i.slice(0,-1),i}var nE;(function(n){n[n.NO_ERROR=0]="NO_ERROR",n[n.NETWORK_ERROR=1]="NETWORK_ERROR",n[n.ABORT=2]="ABORT"})(nE||(nE={}));/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function A8e(n,e){const i=n>=500&&n<600,l=[408,429].indexOf(n)!==-1,u=e.indexOf(n)!==-1;return i||l||u}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class P8e{constructor(e,i,o,l,u,p,y,E,b,T,R,O=!0,L=!1){this.url_=e,this.method_=i,this.headers_=o,this.body_=l,this.successCodes_=u,this.additionalRetryCodes_=p,this.callback_=y,this.errorCallback_=E,this.timeout_=b,this.progressCallback_=T,this.connectionFactory_=R,this.retry=O,this.isUsingEmulator=L,this.pendingConnection_=null,this.backoffId_=null,this.canceled_=!1,this.appDelete_=!1,this.promise_=new Promise((D,U)=>{this.resolve_=D,this.reject_=U,this.start_()})}start_(){const e=(o,l)=>{if(l){o(!1,new bO(!1,null,!0));return}const u=this.connectionFactory_();this.pendingConnection_=u;const p=y=>{const E=y.loaded,b=y.lengthComputable?y.total:-1;this.progressCallback_!==null&&this.progressCallback_(E,b)};this.progressCallback_!==null&&u.addUploadProgressListener(p),u.send(this.url_,this.method_,this.isUsingEmulator,this.body_,this.headers_).then(()=>{this.progressCallback_!==null&&u.removeUploadProgressListener(p),this.pendingConnection_=null;const y=u.getErrorCode()===nE.NO_ERROR,E=u.getStatus();if(!y||A8e(E,this.additionalRetryCodes_)&&this.retry){const T=u.getErrorCode()===nE.ABORT;o(!1,new bO(!1,null,T));return}const b=this.successCodes_.indexOf(E)!==-1;o(!0,new bO(b,u))})},i=(o,l)=>{const u=this.resolve_,p=this.reject_,y=l.connection;if(l.wasSuccessCode)try{const E=this.callback_(y,y.getResponse());R8e(E)?u(E):u()}catch(E){p(E)}else if(y!==null){const E=B3();E.serverResponse=y.getErrorText(),this.errorCallback_?p(this.errorCallback_(y,E)):p(E)}else if(l.canceled){const E=this.appDelete_?uae():m8e();p(E)}else{const E=f8e();p(E)}};this.canceled_?i(!1,new bO(!1,null,!0)):this.backoffId_=T8e(e,i,this.timeout_)}getPromise(){return this.promise_}cancel(e){this.canceled_=!0,this.appDelete_=e||!1,this.backoffId_!==null&&C8e(this.backoffId_),this.pendingConnection_!==null&&this.pendingConnection_.abort()}}class bO{constructor(e,i,o){this.wasSuccessCode=e,this.connection=i,this.canceled=!!o}}function O8e(n,e){e!==null&&e.length>0&&(n.Authorization="Firebase "+e)}function k8e(n,e){n["X-Firebase-Storage-Version"]="webjs/"+(e??"AppManager")}function N8e(n,e){e&&(n["X-Firebase-GMPID"]=e)}function x8e(n,e){e!==null&&(n["X-Firebase-AppCheck"]=e)}function D8e(n,e,i,o,l,u,p=!0,y=!1){const E=dae(n.urlParams),b=n.url+E,T=Object.assign({},n.headers);return N8e(T,e),O8e(T,i),k8e(T,u),x8e(T,o),new P8e(b,n.method,T,n.body,n.successCodes,n.additionalRetryCodes,n.handler,n.errorHandler,n.timeout,n.progressCallback,l,p,y)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function L8e(){return typeof BlobBuilder<"u"?BlobBuilder:typeof WebKitBlobBuilder<"u"?WebKitBlobBuilder:void 0}function M8e(...n){const e=L8e();if(e!==void 0){const i=new e;for(let o=0;o<n.length;o++)i.append(n[o]);return i.getBlob()}else{if(W3())return new Blob(n);throw new Xs(Ys.UNSUPPORTED_ENVIRONMENT,"This browser doesn't seem to support creating Blobs")}}function U8e(n,e,i){return n.webkitSlice?n.webkitSlice(e,i):n.mozSlice?n.mozSlice(e,i):n.slice?n.slice(e,i):null}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function V8e(n){if(typeof atob>"u")throw S8e("base-64");return atob(n)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Np={RAW:"raw",BASE64:"base64",BASE64URL:"base64url",DATA_URL:"data_url"};class yV{constructor(e,i){this.data=e,this.contentType=i||null}}function j8e(n,e){switch(n){case Np.RAW:return new yV(hae(e));case Np.BASE64:case Np.BASE64URL:return new yV(pae(n,e));case Np.DATA_URL:return new yV(B8e(e),z8e(e))}throw B3()}function hae(n){const e=[];for(let i=0;i<n.length;i++){let o=n.charCodeAt(i);if(o<=127)e.push(o);else if(o<=2047)e.push(192|o>>6,128|o&63);else if((o&64512)===55296)if(!(i<n.length-1&&(n.charCodeAt(i+1)&64512)===56320))e.push(239,191,189);else{const u=o,p=n.charCodeAt(++i);o=65536|(u&1023)<<10|p&1023,e.push(240|o>>18,128|o>>12&63,128|o>>6&63,128|o&63)}else(o&64512)===56320?e.push(239,191,189):e.push(224|o>>12,128|o>>6&63,128|o&63)}return new Uint8Array(e)}function F8e(n){let e;try{e=decodeURIComponent(n)}catch{throw eR(Np.DATA_URL,"Malformed data URL.")}return hae(e)}function pae(n,e){switch(n){case Np.BASE64:{const l=e.indexOf("-")!==-1,u=e.indexOf("_")!==-1;if(l||u)throw eR(n,"Invalid character '"+(l?"-":"_")+"' found: is it base64url encoded?");break}case Np.BASE64URL:{const l=e.indexOf("+")!==-1,u=e.indexOf("/")!==-1;if(l||u)throw eR(n,"Invalid character '"+(l?"+":"/")+"' found: is it base64 encoded?");e=e.replace(/-/g,"+").replace(/_/g,"/");break}}let i;try{i=V8e(e)}catch(l){throw l.message.includes("polyfill")?l:eR(n,"Invalid character found")}const o=new Uint8Array(i.length);for(let l=0;l<i.length;l++)o[l]=i.charCodeAt(l);return o}class fae{constructor(e){this.base64=!1,this.contentType=null;const i=e.match(/^data:([^,]+)?,/);if(i===null)throw eR(Np.DATA_URL,"Must be formatted 'data:[<mediatype>][;base64],<data>");const o=i[1]||null;o!=null&&(this.base64=W8e(o,";base64"),this.contentType=this.base64?o.substring(0,o.length-7):o),this.rest=e.substring(e.indexOf(",")+1)}}function B8e(n){const e=new fae(n);return e.base64?pae(Np.BASE64,e.rest):F8e(e.rest)}function z8e(n){return new fae(n).contentType}function W8e(n,e){return n.length>=e.length?n.substring(n.length-e.length)===e:!1}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class kg{constructor(e,i){let o=0,l="";JQ(e)?(this.data_=e,o=e.size,l=e.type):e instanceof ArrayBuffer?(i?this.data_=new Uint8Array(e):(this.data_=new Uint8Array(e.byteLength),this.data_.set(new Uint8Array(e))),o=this.data_.length):e instanceof Uint8Array&&(i?this.data_=e:(this.data_=new Uint8Array(e.length),this.data_.set(e)),o=e.length),this.size_=o,this.type_=l}size(){return this.size_}type(){return this.type_}slice(e,i){if(JQ(this.data_)){const o=this.data_,l=U8e(o,e,i);return l===null?null:new kg(l)}else{const o=new Uint8Array(this.data_.buffer,e,i-e);return new kg(o,!0)}}static getBlob(...e){if(W3()){const i=e.map(o=>o instanceof kg?o.data_:o);return new kg(M8e.apply(null,i))}else{const i=e.map(p=>z3(p)?j8e(Np.RAW,p).data:p.data_);let o=0;i.forEach(p=>{o+=p.byteLength});const l=new Uint8Array(o);let u=0;return i.forEach(p=>{for(let y=0;y<p.length;y++)l[u++]=p[y]}),new kg(l,!0)}}uploadData(){return this.data_}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function mae(n){let e;try{e=JSON.parse(n)}catch{return null}return I8e(e)?e:null}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function G8e(n){if(n.length===0)return null;const e=n.lastIndexOf("/");return e===-1?"":n.slice(0,e)}function H8e(n,e){const i=e.split("/").filter(o=>o.length>0).join("/");return n.length===0?i:n+"/"+i}function gae(n){const e=n.lastIndexOf("/",n.length-2);return e===-1?n:n.slice(e+1)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function $8e(n,e){return e}class Dc{constructor(e,i,o,l){this.server=e,this.local=i||e,this.writable=!!o,this.xform=l||$8e}}let wO=null;function K8e(n){return!z3(n)||n.length<2?n:gae(n)}function _ae(){if(wO)return wO;const n=[];n.push(new Dc("bucket")),n.push(new Dc("generation")),n.push(new Dc("metageneration")),n.push(new Dc("name","fullPath",!0));function e(u,p){return K8e(p)}const i=new Dc("name");i.xform=e,n.push(i);function o(u,p){return p!==void 0?Number(p):p}const l=new Dc("size");return l.xform=o,n.push(l),n.push(new Dc("timeCreated")),n.push(new Dc("updated")),n.push(new Dc("md5Hash",null,!0)),n.push(new Dc("cacheControl",null,!0)),n.push(new Dc("contentDisposition",null,!0)),n.push(new Dc("contentEncoding",null,!0)),n.push(new Dc("contentLanguage",null,!0)),n.push(new Dc("contentType",null,!0)),n.push(new Dc("metadata","customMetadata",!0)),wO=n,wO}function q8e(n,e){function i(){const o=n.bucket,l=n.fullPath,u=new fu(o,l);return e._makeStorageReference(u)}Object.defineProperty(n,"ref",{get:i})}function Y8e(n,e,i){const o={};o.type="file";const l=i.length;for(let u=0;u<l;u++){const p=i[u];o[p.local]=p.xform(o,e[p.server])}return q8e(o,n),o}function yae(n,e,i){const o=mae(e);return o===null?null:Y8e(n,o,i)}function X8e(n,e,i,o){const l=mae(e);if(l===null||!z3(l.downloadTokens))return null;const u=l.downloadTokens;if(u.length===0)return null;const p=encodeURIComponent;return u.split(",").map(b=>{const T=n.bucket,R=n.fullPath,O="/b/"+p(T)+"/o/"+p(R),L=ux(O,i,o),D=dae({alt:"media",token:b});return L+D})[0]}function J8e(n,e){const i={},o=e.length;for(let l=0;l<o;l++){const u=e[l];u.writable&&(i[u.server]=n[u.local])}return JSON.stringify(i)}class G3{constructor(e,i,o,l){this.url=e,this.method=i,this.handler=o,this.timeout=l,this.urlParams={},this.headers={},this.body=null,this.errorHandler=null,this.progressCallback=null,this.successCodes=[200],this.additionalRetryCodes=[]}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Eae(n){if(!n)throw B3()}function Q8e(n,e){function i(o,l){const u=yae(n,l,e);return Eae(u!==null),u}return i}function Z8e(n,e){function i(o,l){const u=yae(n,l,e);return Eae(u!==null),X8e(u,l,n.host,n._protocol)}return i}function vae(n){function e(i,o){let l;return i.getStatus()===401?i.getErrorText().includes("Firebase App Check token is invalid")?l=h8e():l=d8e():i.getStatus()===402?l=u8e(n.bucket):i.getStatus()===403?l=p8e(n.path):l=o,l.status=i.getStatus(),l.serverResponse=o.serverResponse,l}return e}function Sae(n){const e=vae(n);function i(o,l){let u=e(o,l);return o.getStatus()===404&&(u=l8e(n.path)),u.serverResponse=l.serverResponse,u}return i}function eze(n,e,i){const o=e.fullServerUrl(),l=ux(o,n.host,n._protocol),u="GET",p=n.maxOperationRetryTime,y=new G3(l,u,Z8e(n,i),p);return y.errorHandler=Sae(e),y}function tze(n,e){const i=e.fullServerUrl(),o=ux(i,n.host,n._protocol),l="DELETE",u=n.maxOperationRetryTime;function p(E,b){}const y=new G3(o,l,p,u);return y.successCodes=[200,204],y.errorHandler=Sae(e),y}function nze(n,e){return n&&n.contentType||e&&e.type()||"application/octet-stream"}function rze(n,e,i){const o=Object.assign({},i);return o.fullPath=n.path,o.size=e.size(),o.contentType||(o.contentType=nze(null,e)),o}function ize(n,e,i,o,l){const u=e.bucketOnlyServerUrl(),p={"X-Goog-Upload-Protocol":"multipart"};function y(){let re="";for(let le=0;le<2;le++)re=re+Math.random().toString().slice(2);return re}const E=y();p["Content-Type"]="multipart/related; boundary="+E;const b=rze(e,o,l),T=J8e(b,i),R="--"+E+`\r
Content-Type: application/json; charset=utf-8\r
\r
`+T+`\r
--`+E+`\r
Content-Type: `+b.contentType+`\r
\r
`,O=`\r
--`+E+"--",L=kg.getBlob(R,o,O);if(L===null)throw E8e();const D={name:b.fullPath},U=ux(u,n.host,n._protocol),F="POST",Y=n.maxUploadRetryTime,W=new G3(U,F,Q8e(n,i),Y);return W.urlParams=D,W.headers=p,W.body=L.uploadData(),W.errorHandler=vae(e),W}class sze{constructor(){this.sent_=!1,this.xhr_=new XMLHttpRequest,this.initXhr(),this.errorCode_=nE.NO_ERROR,this.sendPromise_=new Promise(e=>{this.xhr_.addEventListener("abort",()=>{this.errorCode_=nE.ABORT,e()}),this.xhr_.addEventListener("error",()=>{this.errorCode_=nE.NETWORK_ERROR,e()}),this.xhr_.addEventListener("load",()=>{e()})})}send(e,i,o,l,u){if(this.sent_)throw aC("cannot .send() more than once");if(cm(e)&&o&&(this.xhr_.withCredentials=!0),this.sent_=!0,this.xhr_.open(i,e,!0),u!==void 0)for(const p in u)u.hasOwnProperty(p)&&this.xhr_.setRequestHeader(p,u[p].toString());return l!==void 0?this.xhr_.send(l):this.xhr_.send(),this.sendPromise_}getErrorCode(){if(!this.sent_)throw aC("cannot .getErrorCode() before sending");return this.errorCode_}getStatus(){if(!this.sent_)throw aC("cannot .getStatus() before sending");try{return this.xhr_.status}catch{return-1}}getResponse(){if(!this.sent_)throw aC("cannot .getResponse() before sending");return this.xhr_.response}getErrorText(){if(!this.sent_)throw aC("cannot .getErrorText() before sending");return this.xhr_.statusText}abort(){this.xhr_.abort()}getResponseHeader(e){return this.xhr_.getResponseHeader(e)}addUploadProgressListener(e){this.xhr_.upload!=null&&this.xhr_.upload.addEventListener("progress",e)}removeUploadProgressListener(e){this.xhr_.upload!=null&&this.xhr_.upload.removeEventListener("progress",e)}}class oze extends sze{initXhr(){this.xhr_.responseType="text"}}function H3(){return new oze}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class gE{constructor(e,i){this._service=e,i instanceof fu?this._location=i:this._location=fu.makeFromUrl(i,e.host)}toString(){return"gs://"+this._location.bucket+"/"+this._location.path}_newRef(e,i){return new gE(e,i)}get root(){const e=new fu(this._location.bucket,"");return this._newRef(this._service,e)}get bucket(){return this._location.bucket}get fullPath(){return this._location.path}get name(){return gae(this._location.path)}get storage(){return this._service}get parent(){const e=G8e(this._location.path);if(e===null)return null;const i=new fu(this._location.bucket,e);return new gE(this._service,i)}_throwIfRoot(e){if(this._location.path==="")throw b8e(e)}}function aze(n,e,i){n._throwIfRoot("uploadBytes");const o=ize(n.storage,n._location,_ae(),new kg(e,!0),i);return n.storage.makeRequestWithTokens(o,H3).then(l=>({metadata:l,ref:n}))}function cze(n){n._throwIfRoot("getDownloadURL");const e=eze(n.storage,n._location,_ae());return n.storage.makeRequestWithTokens(e,H3).then(i=>{if(i===null)throw v8e();return i})}function lze(n){n._throwIfRoot("deleteObject");const e=tze(n.storage,n._location);return n.storage.makeRequestWithTokens(e,H3)}function uze(n,e){const i=H8e(n._location.path,e),o=new fu(n._location.bucket,i);return new gE(n.storage,o)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function dze(n){return/^[A-Za-z]+:\/\//.test(n)}function hze(n,e){return new gE(n,e)}function bae(n,e){if(n instanceof $3){const i=n;if(i._bucket==null)throw y8e();const o=new gE(i,i._bucket);return e!=null?bae(o,e):o}else return e!==void 0?uze(n,e):n}function pze(n,e){if(e&&dze(e)){if(n instanceof $3)return hze(n,e);throw K5("To use ref(service, url), the first argument must be a Storage instance.")}else return bae(n,e)}function ZQ(n,e){const i=e==null?void 0:e[lae];return i==null?null:fu.makeFromBucketSpec(i,n)}function fze(n,e,i,o={}){n.host=`${e}:${i}`;const l=cm(e);l&&(kN(`https://${n.host}/b`),NN("Storage",!0)),n._isUsingEmulator=!0,n._protocol=l?"https":"http";const{mockUserToken:u}=o;u&&(n._overrideAuthToken=typeof u=="string"?u:Mie(u,n.app.options.projectId))}class $3{constructor(e,i,o,l,u,p=!1){this.app=e,this._authProvider=i,this._appCheckProvider=o,this._url=l,this._firebaseVersion=u,this._isUsingEmulator=p,this._bucket=null,this._host=cae,this._protocol="https",this._appId=null,this._deleted=!1,this._maxOperationRetryTime=a8e,this._maxUploadRetryTime=c8e,this._requests=new Set,l!=null?this._bucket=fu.makeFromBucketSpec(l,this._host):this._bucket=ZQ(this._host,this.app.options)}get host(){return this._host}set host(e){this._host=e,this._url!=null?this._bucket=fu.makeFromBucketSpec(this._url,e):this._bucket=ZQ(e,this.app.options)}get maxUploadRetryTime(){return this._maxUploadRetryTime}set maxUploadRetryTime(e){QQ("time",0,Number.POSITIVE_INFINITY,e),this._maxUploadRetryTime=e}get maxOperationRetryTime(){return this._maxOperationRetryTime}set maxOperationRetryTime(e){QQ("time",0,Number.POSITIVE_INFINITY,e),this._maxOperationRetryTime=e}async _getAuthToken(){if(this._overrideAuthToken)return this._overrideAuthToken;const e=this._authProvider.getImmediate({optional:!0});if(e){const i=await e.getToken();if(i!==null)return i.accessToken}return null}async _getAppCheckToken(){if(wl(this.app)&&this.app.settings.appCheckToken)return this.app.settings.appCheckToken;const e=this._appCheckProvider.getImmediate({optional:!0});return e?(await e.getToken()).token:null}_delete(){return this._deleted||(this._deleted=!0,this._requests.forEach(e=>e.cancel()),this._requests.clear()),Promise.resolve()}_makeStorageReference(e){return new gE(this,e)}_makeRequest(e,i,o,l,u=!0){if(this._deleted)return new w8e(uae());{const p=D8e(e,this._appId,o,l,i,this._firebaseVersion,u,this._isUsingEmulator);return this._requests.add(p),p.getPromise().then(()=>this._requests.delete(p),()=>this._requests.delete(p)),p}}async makeRequestWithTokens(e,i){const[o,l]=await Promise.all([this._getAuthToken(),this._getAppCheckToken()]);return this._makeRequest(e,i,o,l).getPromise()}}const eZ="@firebase/storage",tZ="0.13.14";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const wae="storage";function K3(n,e,i){return n=Ni(n),aze(n,e,i)}function dx(n){return n=Ni(n),cze(n)}function q3(n){return n=Ni(n),lze(n)}function PE(n,e){return n=Ni(n),pze(n,e)}function OE(n=xN(),e){n=Ni(n);const o=tI(n,wae).getImmediate({identifier:e}),l=BF("storage");return l&&mze(o,...l),o}function mze(n,e,i,o={}){fze(n,e,i,o)}function gze(n,{instanceIdentifier:e}){const i=n.getProvider("app").getImmediate(),o=n.getProvider("auth-internal"),l=n.getProvider("app-check-internal");return new $3(i,o,l,e,TE)}function _ze(){zg(new tm(wae,gze,"PUBLIC").setMultipleInstances(!0)),md(eZ,tZ,""),md(eZ,tZ,"esm2017")}_ze();const sk=async n=>{const e=OE(),i=PE(e,n);try{return await dx(i)}catch(o){throw G.error("Failed to fetch HTTP URL from gs:// URL:","/src/packages/shared/firebase/firebaseStorage.js",o),o}},Tae="rateLimits",yze={guestUserCreate:{windowMs:60*1e3,maxAttempts:10},fileUpload:{windowMs:60*1e3,maxAttempts:10},chatMessage:{windowMs:10*1e3,maxAttempts:20},spaceJoin:{windowMs:60*1e3,maxAttempts:5}};function Eze(){try{const n=localStorage.getItem(Tae);return n?JSON.parse(n):{}}catch(n){return console.error("Error reading rate limit data:",n),{}}}function vze(n){try{localStorage.setItem(Tae,JSON.stringify(n))}catch(e){console.error("Error saving rate limit data:",e)}}function Y3(n,e=""){const i=yze[n];if(!i)return console.warn(`No rate limit config for action type: ${n}`),{allowed:!0,retryAfter:null,message:null};const o=Date.now(),l=e?`${n}_${e}`:n,u=Eze(),p=u[l]||{attempts:[]},y=o-i.windowMs,E=p.attempts.filter(b=>b>y);if(E.length>=i.maxAttempts){const b=E[0],T=Math.ceil((b+i.windowMs-o)/1e3);return{allowed:!1,retryAfter:T,message:`Too many attempts. Please wait ${T} seconds before trying again.`}}return E.push(o),u[l]={attempts:E},vze(u),{allowed:!0,retryAfter:null,message:null}}let q5={};const _o=async(n,e=0)=>{var p,y,E,b,T;const u=R=>R?300*Math.pow(2,e):300*(e+1);try{if(e===0){const L=qS();if(L.currentUser)try{await L.currentUser.getIdToken(!0),await new Promise(D=>setTimeout(D,300))}catch{await new Promise(U=>setTimeout(U,300))}else await new Promise(D=>setTimeout(D,800))}const R=dr(Fn,"spaces",n),O=await Promise.race([Qo(R),new Promise((L,D)=>setTimeout(()=>D(new Error("Firestore query timeout")),8e3))]);if(O.exists()){let L=O.data();const D=L.name,U=L.description;if(L.webglBuildId){const F=dr(Fn,"webglBuilds",L.webglBuildId),Y=await Qo(F);if(Y.exists()){const W=Y.data();L={...L,...W,name:D||W.name,description:U||W.description}}else G.warn(`spacesFirestore: No document found for webglBuildId: ${L.webglBuildId}`)}return L=await Sze(L),L=bze(L),G.log(`spacesFirestore: Caching space data for: ${n}`),q5[n]=L,L}else{if(e<4){const L=u(!1);return G.log(`spacesFirestore: Space not found, retrying (${e+1}/4) after ${L}ms: ${n} - might be timing/permission issue`),await new Promise(D=>setTimeout(D,L)),_o(n,e+1)}return G.warn(`spacesFirestore: No document found for item ID: ${n} (after 4 attempts)`),null}}catch(R){const O=R.code==="permission-denied"||R.code==="permissions"||((p=R.message)==null?void 0:p.toLowerCase().includes("permission"))||((y=R.message)==null?void 0:y.toLowerCase().includes("insufficient permissions"));if(G.log(`spacesFirestore: Error fetching space (attempt ${e+1}):`,{code:R.code,message:R.message,itemId:n,isPermissionError:O}),e<4&&(R.code==="unavailable"||R.code==="deadline-exceeded"||O||(E=R.message)!=null&&E.includes("network")||(b=R.message)!=null&&b.includes("timeout")||(T=R.message)!=null&&T.includes("Firestore query timeout"))){const L=u(O);if(G.log(`spacesFirestore: ${O?"Permission":"Transient"} error, retrying (${e+1}/4) after ${L}ms: ${R.code||R.message}`),O){const D=qS();if(D.currentUser){const U=e===0?500:300;if(await new Promise(F=>setTimeout(F,U)),e===0)try{await D.currentUser.getIdToken(!0),await new Promise(F=>setTimeout(F,300))}catch{}}else{const U=1200*Math.pow(2,e);G.log(`spacesFirestore: Guest user permission error, waiting ${U}ms for Firestore rules to evaluate (attempt ${e+1})`),await new Promise(F=>setTimeout(F,U))}}return await new Promise(D=>setTimeout(D,L)),_o(n,e+1)}throw G.error("spacesFirestore: Error fetching item data (final):",R),R}},Sze=async n=>{const i=["gsUrlCode","gsUrlData","gsUrlFramework","gsUrlLoader","gsUrlLoadingBackground"].map(async o=>{const l=n[o];l&&l.startsWith("gs://")&&(n[o]=await sk(l))});return await Promise.all(i),n},bze=n=>{const{gsUrlCode:e,gsUrlData:i,gsUrlFramework:o,gsUrlLoader:l,...u}=n;return{...u,codeUrl:e,dataUrl:i,frameworkUrl:o,loaderUrl:l}};let EV={};const Cae=async n=>{G.log("spacesFirestore: Get Videos from Firestore for space: ",n);try{if(EV[n])return G.log("spacesFirestore: Returning cached videos for space:",n),EV[n];const e=mc(Fn,`spaces/${n}/videos`),i=await _d(e),o=[];return i.forEach(l=>{o.push({id:l.id,...l.data()})}),EV[n]=o,o}catch(e){throw G.error("spacesFirestore: Error fetching Space videos from Firestore:",e),e}},wze=async(n,e)=>{try{const i=Y3("fileUpload",n);if(!i.allowed)throw new Error(i.message);if(!n||!e)throw new Error("Missing required parameters: spaceId and logoFile");if(!e.type.startsWith("image/"))throw new Error("File must be an image");const o=5*1024*1024;if(e.size>o)throw new Error("File size must be less than 5MB");const l=OE(),u=Date.now(),p=e.name.split(".").pop(),y=`logo_${u}.${p}`,E=PE(l,`spaces/${n}/logo/${y}`);G.log(`Uploading logo for space ${n}`);const b=await K3(E,e),T=await dx(b.ref),R=dr(Fn,"spaces",n);return await qs(R,{logoUrl:T,logoGsUrl:`gs://${b.ref.bucket}/${b.ref.fullPath}`,logoFileName:y,updatedAt:new Date().toISOString()}),G.log(`Successfully uploaded logo for space ${n}`),T}catch(i){throw G.error("Error uploading space logo:",i),i}},Tze=async n=>{try{const e=dr(Fn,"spaces",n),i=await Qo(e);if(!i.exists())return G.warn(`No space found with ID: ${n}`),!1;const o=i.data();if(o.logoGsUrl){const l=OE(),u=PE(l,o.logoGsUrl);try{await q3(u),G.log(`Deleted logo file from storage: ${o.logoGsUrl}`)}catch(p){G.warn(`Could not delete logo file from storage: ${p.message}`)}}return await qs(e,{logoUrl:null,logoGsUrl:null,logoFileName:null,updatedAt:new Date().toISOString()}),G.log(`Successfully removed logo for space ${n}`),!0}catch(e){throw G.error("Error deleting space logo:",e),e}},Cze=async(n,e)=>{try{const i=Y3("fileUpload",n);if(!i.allowed)throw new Error(i.message);if(!n||!e)throw new Error("Missing required parameters: spaceId and backgroundFile");if(!e.type.startsWith("image/"))throw new Error("File must be an image");const o=10*1024*1024;if(e.size>o)throw new Error("File size must be less than 10MB");const l=OE(),u=Date.now(),p=e.name.split(".").pop(),y=`background_${u}.${p}`,E=PE(l,`spaces/${n}/background/${y}`);G.log(`Uploading background for space ${n}`);const b=await K3(E,e),T=await dx(b.ref),R=dr(Fn,"spaces",n);return await qs(R,{backgroundUrl:T,backgroundGsUrl:`gs://${b.ref.bucket}/${b.ref.fullPath}`,backgroundFileName:y,gsUrlLoadingBackground:`gs://${b.ref.bucket}/${b.ref.fullPath}`,updatedAt:new Date().toISOString()}),G.log(`Successfully uploaded background for space ${n}`),T}catch(i){throw G.error("Error uploading space background:",i),i}},Rze=async n=>{try{const e=dr(Fn,"spaces",n),i=await Qo(e);if(!i.exists())return G.warn(`No space found with ID: ${n}`),!1;const o=i.data();if(o.backgroundGsUrl){const l=OE(),u=PE(l,o.backgroundGsUrl);try{await q3(u),G.log(`Deleted background file from storage: ${o.backgroundGsUrl}`)}catch(p){G.warn(`Could not delete background file from storage: ${p.message}`)}}return await qs(e,{backgroundUrl:null,backgroundGsUrl:null,backgroundFileName:null,gsUrlLoadingBackground:null,updatedAt:new Date().toISOString()}),G.log(`Successfully removed background for space ${n}`),!0}catch(e){throw G.error("Error deleting space background:",e),e}},Ize=async(n,e)=>{try{if(!n||!e||!e.uid)throw new Error("Missing required parameters");const i=dr(Fn,`spaces/${n}/BannedUsers`,e.uid),o=Object.entries({...e,bannedAt:e.bannedAt||new Date().toISOString()}).reduce((l,[u,p])=>(p!==void 0&&(l[u]=p),l),{});await Xg(i,o);try{const l=dr(Fn,"users",e.uid),u=await Qo(l);if(u.exists()){const p=u.data(),y=Array.isArray(p.groups)?p.groups:[],E=`space_${n}_banned`;y.includes(E)||await qs(l,{groups:[...y,E]})}}catch(l){G.error("spacesFirestore: failed to add banned group to user",l)}return G.log(`spacesFirestore: Added banned user ${e.uid} to space ${n}`),!0}catch(i){throw G.error("spacesFirestore: Error adding banned user:",i),i}},pS=async(n,e)=>{try{G.log(`spacesFirestore: Updating settings for space: ${n}`,e);const i=dr(Fn,"spaces",n);return await qs(i,{...e,updatedAt:new Date().toISOString()}),q5[n]&&delete q5[n],!0}catch(i){throw G.error("spacesFirestore: Error updating space settings:",i),i}},Aze=async(n,e)=>pS(n,{accessibleToAllUsers:e}),Y5=async(n,e)=>pS(n,{HLSStreamURL:e}),Rae=async n=>{try{const e=dr(Fn,"spaces",n),i=await Qo(e);return i.exists()&&i.data().HLSStreamURL||null}catch(e){throw G.error("spacesFirestore: Error getting HLS stream:",e),e}},Pze=async(n,e)=>(G.warn("uploadSpaceVideoBackground: Not implemented in simplified stub."),null),Oze=async n=>(G.warn("deleteSpaceVideoBackground: Not implemented in simplified stub."),null),kze=["https://models.readyplayer.me/682b6c39994f7261dd46350d.glb","https://models.readyplayer.me/67c8408d38f7924e15a8bd0a.glb","https://models.readyplayer.me/67c8576838e3cf57cc697c15.glb","https://models.readyplayer.me/67c884144c4878c55e515ff5.glb","https://models.readyplayer.me/67c885af25f4d62e75c0ff1e.glb","https://models.readyplayer.me/67c8860f4c4878c55e5189b6.glb","https://models.readyplayer.me/67c8869db6d0b438b7abd822.glb","https://models.readyplayer.me/67c886ed28ee0e0bfac89688.glb","https://models.readyplayer.me/67c88731795ea3e2e6ea84db.glb","https://models.readyplayer.me/67c8878b0cdc0f22383f0f8f.glb"],Nze=()=>Math.floor(1e3+Math.random()*9e3).toString(),xze=()=>`Visitor_${Nze()}`,Dze=()=>kze[0],Lze=()=>{const n=Date.now(),e=Math.floor(Math.random()*1e4);return`guest_${n}_${e}`},nZ=n=>{const e=Lze(),i=xze(),o=Dze(),l=new Date().toISOString(),u={uid:e,email:null,emailVerified:!1,name:i,username:i,Nickname:i,displayName:i,firstName:"Guest",lastName:"User",companyName:"",linkedInProfile:"",rpmURL:o,groups:["guests"],created_on:l,isGuest:!0,guestSpaceId:n,guestSessionStart:l,height_cm:null};return G.log("guestUserGenerator: Created guest user:",{uid:e,username:i,rpmURL:o,spaceId:n}),G.log("guestUserGenerator: FULL guest user object:",u),G.log("guestUserGenerator: Environment check - window.location:",window.location.href),G.log("guestUserGenerator: Nickname field:",u.Nickname),G.log("guestUserGenerator: rpmURL field:",u.rpmURL),u},Mze=n=>n&&(n.isGuest===!0||n.uid&&n.uid.startsWith("guest_")),Di=k.createContext(null),Uze=k.createContext(null),Vze=({children:n})=>{const[e,i]=k.useState(null),o=k.useRef(null),[l,u]=k.useState(!0),[p,y]=k.useState(!1),[E,b]=k.useState(null),T=k.useRef(null),R=qS(),O=Se=>Se?Se.Nickname?Se.Nickname:`${Se.firstName} ${Se.lastName}`:"Anon",L=async()=>{try{const Se=D();if(!Se){G.log("UserProvider: No space ID found, skipping guest user creation");return}if(E&&E.guestSpaceId===Se){G.log("UserProvider: Guest user already exists for this space");return}const Ie=Y3("guestUserCreate",Se);if(!Ie.allowed){G.warn("UserProvider: Guest user creation rate limited:",Ie.message),console.warn(Ie.message);return}try{const we=await _o(Se);if(!we){G.log("UserProvider: Space data not found, denying guest access");return}if(!we.allowGuestUsers){G.log("UserProvider: Guest users explicitly not allowed for this space");return}G.log("UserProvider: Guest users confirmed allowed for space:",Se)}catch{G.log("UserProvider: Cannot verify space guest settings, denying guest access for security");return}const Fe=nZ(Se);b(Fe),T.current=Fe,G.log("UserProvider: Created guest user:",Fe.username),W(Fe)}catch(Se){G.error("UserProvider: Error creating guest user:",Se)}},D=()=>{try{const Se=document.getElementById("webgl-root");if(Se){const be=Se.getAttribute("data-space-id");if(be)return G.log("UserProvider: Found space ID from webgl-root element:",be),be}const Ie=window.location.href,Fe=window.location.pathname,we=window.location.search;G.log("UserProvider: No space ID in DOM element, trying URL extraction"),G.log("UserProvider: URL:",Ie);const Re=Fe.match(/\/(w|embed)\/([^\/]+)/);if(Re)return G.log("UserProvider: Found space ID from path pattern:",Re[2]),Re[2];const Te=new URLSearchParams(we),Ne=Te.get("spaceId")||Te.get("space");return Ne?(G.log("UserProvider: Found space ID from URL params:",Ne),Ne):Ie.includes("localhost")||Ie.includes("web.app")||Ie.includes("firebaseapp.com")?(G.log("UserProvider: Using default space ID for development/hosting"),"SpacesMetaverse_SDK"):(G.log("UserProvider: No space ID found"),null)}catch(Se){return G.error("UserProvider: Error getting space ID:",Se),null}};k.useEffect(()=>{let Se=!0;const Ie=aFe(R,async we=>{var Re;if(G.log("UserProvider: Firebase onAuthStateChanged() fired"),we){const Te={uid:we.uid,email:we.email,emailVerified:we.emailVerified,displayName:((Re=we.email)==null?void 0:Re.split("@")[0])||"User"};Se&&(i(Te),o.current=Te,u(!1));try{const Ne=await Fc(we.uid);if(!Se)return;const be=O(Ne),xe={uid:we.uid,email:we.email,emailVerified:we.emailVerified,...Ne,displayName:be||Te.displayName};G.log(`UserProvider: User authenticated: ${we.uid}`),i(xe),o.current=xe,W(xe)}catch(Ne){G.warn("UserProvider: Profile fetch failed, using minimal user data:",Ne.message),Se&&W(Te)}}else{if(!Se)return;i(null),o.current=null,u(!1),L().catch(Te=>{G.error("UserProvider: Error creating guest user:",Te)})}}),Fe=we=>{G.log("UserProvider: Override settings updated, refreshing user data for Unity"),W()};return window.addEventListener("SpaceOverrideUpdated",Fe),()=>{Se=!1,Ie&&Ie(),window.removeEventListener("SpaceOverrideUpdated",Fe)}},[]);const U=async(Se,Ie,Fe)=>{try{y(!0),G.log("UserProvider: Starting registration process"),G.log("UserProvider: Registration includes fields:",Object.keys(Fe||{}).join(", "));const we={...Fe},Re=["firstName","lastName","username","companyName","linkedInProfile"],Te=Re.filter(ft=>!we[ft]);Te.length>0&&G.warn(`UserProvider: Registration missing fields: ${Te.join(", ")}`);const Ne=we.firstName&&we.lastName?`${we.firstName}${we.lastName.charAt(0).toUpperCase()}`:"";G.log("UserProvider: Generated default nickname for registration");const be={firstName:"",lastName:"",companyName:"",linkedInProfile:"",username:"",Nickname:we.Nickname||Ne,groups:["users"],rpmURL:"https://models.readyplayer.me/67c8408d38f7924e15a8bd0a.glb",...we};G.log("UserProvider: Prepared registration data with fields:",Object.keys(be).join(", "));const xe=await e8e(Se,Ie,be);G.log("UserProvider: Registration successful, received user data");const je=Re.filter(ft=>!xe[ft]);je.length>0&&G.warn(`UserProvider: Returned user data missing fields: ${je.join(", ")}`),["firstName","lastName","Nickname","username","companyName"].forEach(ft=>{xe[ft]||(G.warn(`UserProvider: ${ft} is missing in returned data, using original value`),xe[ft]=be[ft])});const dt={uid:xe.uid,email:xe.email,...xe,displayName:O(xe)};return G.log("UserProvider: Created user object with fields:",Object.keys(dt).join(", ")),i(dt),o.current=dt,G.log("UserProvider: User registered successfully with groups:",be.groups),await new Promise(ft=>setTimeout(ft,2e3)),y(!1),dt}catch(we){throw y(!1),G.error("UserProvider: Error during registration:",we),we}},F=async(Se,Ie,Fe)=>{try{if(G.log("UserProvider: Signing in user"),!Fe)throw new Error("CAPTCHA verification is required");const Re=(await iFe(R,Se,Ie)).user;return G.log("UserProvider: User signed in successfully:",Re.uid),Re}catch(we){throw G.error("UserProvider: Error signing in:",we),we}},Y=async()=>{try{await cFe(R),i(null),G.log("UserProvider: User signed out.")}catch(Se){throw G.error("UserProvider: Error signing out:",Se),Se}},W=async(Se=null)=>{let Ie=Se||o.current||T.current;if(!Ie&&!Se&&(G.log("UserProvider: No user available, attempting to create guest user for Unity request"),await L(),Ie=T.current),Ie){const Fe=re(Ie);try{const we=D();if(we){const Re=await _o(we);if(Re&&Re.Override&&Re.Override.enabled===!0)if(G.log("UserProvider: Override is enabled for space:",we),Re.Override.customPlayers&&Re.Override.customPlayers.length>0){const Te=Math.floor(Math.random()*Re.Override.customPlayers.length),Ne=Re.Override.customPlayers[Te].url;Ne&&(G.log("UserProvider: Applying Override RPM URL:",Ne),G.log("UserProvider: Original RPM URL was:",Fe.rpmURL),Fe.rpmURL=Ne)}else G.log("UserProvider: Override enabled but no custom player URLs configured")}}catch(we){G.error("UserProvider: Error checking Override settings, using original RPM URL:",we)}G.log("UserProvider: sendUserToUnity() - Raw user data:",{uid:Ie.uid,username:Ie.username,Nickname:Ie.Nickname,displayName:Ie.displayName,rpmURL:Ie.rpmURL,isGuest:Ie.isGuest||!1}),G.log("UserProvider: sendUserToUnity() - Filtered data being sent to Unity:",Fe),Ie.isGuest&&(G.log("UserProvider: GUEST USER - Verifying required fields:"),G.log("UserProvider: GUEST - Nickname in filtered data:",Fe.Nickname),G.log("UserProvider: GUEST - rpmURL in filtered data:",Fe.rpmURL),G.log("UserProvider: GUEST - uid in filtered data:",Fe.uid),(!Fe.Nickname||!Fe.rpmURL)&&(G.error("UserProvider: GUEST USER MISSING REQUIRED FIELDS!"),G.error("UserProvider: Missing Nickname:",!Fe.Nickname),G.error("UserProvider: Missing rpmURL:",!Fe.rpmURL))),Eh.publish(yh.sendUserToUnity,Fe)}else G.log("UserProvider: No current user or guest user to send to Unity.")},re=Se=>{const Ie={},Fe=[...s8e,"uid"];return G.log("UserProvider: Properties to send to Unity:",Fe),G.log("UserProvider: Available properties in user object:",Object.keys(Se)),Fe.forEach(we=>{Se.hasOwnProperty(we)?(Ie[we]=Se[we],G.log(`UserProvider: Including field '${we}' with value:`,Se[we])):G.log(`UserProvider: Field '${we}' not found in user object`)}),G.log("UserProvider: Final filtered user object:",Ie),Ie},le=async Se=>!e||!e.uid?!1:await lx(e.uid,Se),ie=async Se=>{try{return!e||!e.uid?!1:e.groups&&e.groups.includes(`space_${Se}_banned`)?!0:(await Qo(dr(Fn,`spaces/${Se}/BannedUsers`,e.uid))).exists()}catch(Ie){return Ie.code!=="permission-denied"&&G.error("UserProvider: isUserBannedFromSpace error:",Ie),!1}},me=async Se=>{if(!e||!e.uid)return!1;try{if(await ie(Se))return G.warn(`UserProvider: User ${e.uid} banned from ${Se}`),!1;const Ie=await _o(Se);if(Ie.usersAllowed.includes(e.uid)||Ie.userAdmin.includes(e.uid)||Ie.usersModerators.includes(e.uid))return!0;if(e.groups&&Array.isArray(e.groups)){const we=`space_${Se}_owners`,Re=`space_${Se}_hosts`;if(e.groups.includes(we)||e.groups.includes(Re))return G.log(`UserProvider: User ${e.uid} has access to space ${Se} as owner/host`),!0}return Ie.accessibleToAllUsers===!0&&e.groups?e.groups.includes("users"):!1}catch(Ie){return G.error("UserProvider: Error verifying user access to space:",Ie),!1}},q=async Se=>{if(!e||!e.uid)return!1;try{return(await _o(Se)).userAdmin.includes(e.uid)}catch(Ie){return G.error("UserProvider: Error verifying user admin status for space:",Ie),!1}},J=async Se=>{if(!e||!e.uid)return!1;try{return(await _o(Se)).usersModerators.includes(e.uid)}catch(Ie){return G.error("UserProvider: Error verifying user moderator status for space:",Ie),!1}},Q=async()=>{try{const Se=R.currentUser;return Se&&!Se.emailVerified?(await pse(Se),G.log("UserProvider: Verification email resent to user:",Se.uid),!0):!1}catch(Se){throw G.error("UserProvider: Error resending verification email:",Se),Se}},ne=async()=>{try{const Se=R.currentUser;if(!Se)return G.warn("UserProvider: updateUser called but no current user exists"),null;G.log("UserProvider: Updating user data from Firestore");const Ie=await Fc(Se.uid);if(!Ie)return G.error("UserProvider: Failed to fetch updated user profile"),null;const Fe=O(Ie),we={uid:Se.uid,email:Se.email,emailVerified:Se.emailVerified,...Ie,displayName:Fe};return G.log("UserProvider: User data updated with fields:",Object.keys(we).join(", ")),i(we),o.current=we,W(we),we}catch(Se){throw G.error("UserProvider: Error updating user data:",Se),Se}},he=()=>e||E,de=async Se=>{try{const Ie=nZ(Se);return b(Ie),T.current=Ie,W(Ie),Ie}catch(Ie){throw G.error("UserProvider: Error creating manual guest user:",Ie),Ie}},pe=()=>{b(null),T.current=null,G.log("UserProvider: Guest user cleared")};return S.jsx(Uze.Provider,{value:{registrationInProgress:p},children:S.jsx(Di.Provider,{value:{user:e,guestUser:E,currentUser:he(),loading:l,register:U,signIn:F,signOut:Y,sendUserToUnity:W,isUserInGroup:le,userHasAccessToSpace:me,userIsAdminOfSpace:q,userIsModeratorOfSpace:J,resendVerificationEmail:Q,updateUser:ne,isUserBannedFromSpace:ie,createGuestUser:de,clearGuestUser:pe,isGuestUser:Se=>Mze(Se||he())},children:n})})},Iae=k.createContext(),Ch=()=>k.useContext(Iae),jze=({children:n})=>{const[e,i]=k.useState(!1),o=k.useRef(null),[l,u]=k.useState(!1);k.useEffect(()=>{const E=()=>{const b=/iPhone|iPad|iPod|Android/i.test(navigator.userAgent);u(b)};return E(),window.addEventListener("resize",E),()=>window.removeEventListener("resize",E)},[]);const p=k.useCallback(E=>{o.current=E},[]),y=k.useCallback(()=>{const E=o.current;if(!E)return;const b=document.fullscreenElement||document.webkitFullscreenElement||document.mozFullScreenElement||document.msFullscreenElement;if(l){const T=E.querySelector("video")||E;if(/iPhone|iPad|iPod/i.test(navigator.userAgent)){if(T.webkitEnterFullscreen)try{T.webkitEnterFullscreen(),i(!0);return}catch(R){console.error("iOS fullscreen error:",R)}try{if(T.webkitRequestFullscreen){T.webkitRequestFullscreen(),i(!0);return}}catch(R){console.error("iOS fallback fullscreen error:",R)}}if(/Android/i.test(navigator.userAgent))try{b?(document.exitFullscreen?document.exitFullscreen():document.webkitExitFullscreen?document.webkitExitFullscreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.msExitFullscreen&&document.msExitFullscreen(),i(!1)):(E.requestFullscreen?E.requestFullscreen():E.webkitRequestFullscreen?E.webkitRequestFullscreen():E.mozRequestFullScreen?E.mozRequestFullScreen():E.msRequestFullscreen&&E.msRequestFullscreen(),i(!0));return}catch(R){console.error("Android fullscreen error:",R)}}try{b?document.exitFullscreen?document.exitFullscreen().then(()=>{i(!1)}).catch(T=>console.error("Error exiting fullscreen:",T)):document.webkitExitFullscreen?(document.webkitExitFullscreen(),i(!1)):document.mozCancelFullScreen?(document.mozCancelFullScreen(),i(!1)):document.msExitFullscreen&&(document.msExitFullscreen(),i(!1)):E.requestFullscreen?E.requestFullscreen().then(()=>{i(!0)}).catch(T=>console.error("Error entering fullscreen:",T)):E.webkitRequestFullscreen?(E.webkitRequestFullscreen(),i(!0)):E.mozRequestFullScreen?(E.mozRequestFullScreen(),i(!0)):E.msRequestFullscreen&&(E.msRequestFullscreen(),i(!0))}catch(T){console.error("Fullscreen error:",T)}},[l]);return k.useEffect(()=>{const E=()=>{const b=document.fullscreenElement||document.webkitFullscreenElement||document.mozFullScreenElement||document.msFullscreenElement;i(!!b)};return document.addEventListener("fullscreenchange",E),document.addEventListener("webkitfullscreenchange",E),document.addEventListener("mozfullscreenchange",E),document.addEventListener("MSFullscreenChange",E),()=>{document.removeEventListener("fullscreenchange",E),document.removeEventListener("webkitfullscreenchange",E),document.removeEventListener("mozfullscreenchange",E),document.removeEventListener("MSFullscreenChange",E)}},[]),S.jsx(Iae.Provider,{value:{isFullscreen:e,toggleFullscreen:y,fullscreenRef:o,setFullscreenRef:p,isMobile:l},children:S.jsx("div",{ref:p,style:{position:"relative",zIndex:1,width:"100%",height:"100%",overflow:"hidden"},children:n})})},Fze=qp({d:"M0,12a1.5,1.5,0,0,0,1.5,1.5h8.75a.25.25,0,0,1,.25.25V22.5a1.5,1.5,0,0,0,3,0V13.75a.25.25,0,0,1,.25-.25H22.5a1.5,1.5,0,0,0,0-3H13.75a.25.25,0,0,1-.25-.25V1.5a1.5,1.5,0,0,0-3,0v8.75a.25.25,0,0,1-.25.25H1.5A1.5,1.5,0,0,0,0,12Z",displayName:"AddIcon"}),Bze=qp({viewBox:"0 0 14 14",d:"M14,7.77 L14,6.17 L12.06,5.53 L11.61,4.44 L12.49,2.6 L11.36,1.47 L9.55,2.38 L8.46,1.93 L7.77,0.01 L6.17,0.01 L5.54,1.95 L4.43,2.4 L2.59,1.52 L1.46,2.65 L2.37,4.46 L1.92,5.55 L0,6.23 L0,7.82 L1.94,8.46 L2.39,9.55 L1.51,11.39 L2.64,12.52 L4.45,11.61 L5.54,12.06 L6.23,13.98 L7.82,13.98 L8.45,12.04 L9.56,11.59 L11.4,12.47 L12.53,11.34 L11.61,9.53 L12.08,8.44 L14,7.75 L14,7.77 Z M7,10 C5.34,10 4,8.66 4,7 C4,5.34 5.34,4 7,4 C8.66,4 10,5.34 10,7 C10,8.66 8.66,10 7,10 Z",displayName:"SettingsIcon"}),zze=qp({d:"M19.5,9.5h-.75V6.75a6.75,6.75,0,0,0-13.5,0V9.5H4.5a2,2,0,0,0-2,2V22a2,2,0,0,0,2,2h15a2,2,0,0,0,2-2V11.5A2,2,0,0,0,19.5,9.5Zm-9.5,6a2,2,0,1,1,3,1.723V19.5a1,1,0,0,1-2,0V17.223A1.994,1.994,0,0,1,10,15.5ZM7.75,6.75a4.25,4.25,0,0,1,8.5,0V9a.5.5,0,0,1-.5.5H8.25a.5.5,0,0,1-.5-.5Z",displayName:"LockIcon"}),Aae=qp({displayName:"ChevronDownIcon",d:"M16.59 8.59L12 13.17 7.41 8.59 6 10l6 6 6-6z"}),Wze=qp({d:"M12 4l-1.41 1.41L16.17 11H4v2h12.17l-5.58 5.59L12 20l8-8z",displayName:"ArrowForwardIcon"}),rZ=qp({d:"M0.913134,0.920639 C1.49851,0.331726 2.29348,0 3.12342,0 L10.8766,0 C11.7065,0 12.5015,0.331725 13.0869,0.920639 C13.6721,1.50939 14,2.30689 14,3.13746 L14,8.12943 C13.9962,8.51443 13.9059,8.97125 13.7629,9.32852 C13.6128,9.683 13.3552,10.0709 13.0869,10.3462 C12.813,10.6163 12.4265,10.8761 12.0734,11.0274 C11.7172,11.1716 11.2607,11.263 10.8766,11.2669 L10.1234,11.2669 L10.1234,12.5676 L10.1209,12.5676 C10.1204,12.793 10.0633,13.0791 9.97807,13.262 C9.8627,13.466 9.61158,13.7198 9.40818,13.8382 L9.40824,13.8383 C9.4077,13.8386 9.40716,13.8388 9.40661,13.8391 C9.40621,13.8393 9.4058,13.8396 9.40539,13.8398 L9.40535,13.8397 C9.22958,13.9254 8.94505,13.9951 8.75059,14 L8.74789,14 C8.35724,13.9963 7.98473,13.8383 7.71035,13.5617 L5.39553,11.2669 L3.12342,11.2669 C2.29348,11.2669 1.49851,10.9352 0.913134,10.3462 C0.644826,10.0709 0.387187,9.683 0.23711,9.32852 C0.0941235,8.97125 0.00379528,8.51443 0,8.12943 L0,3.13746 C0,2.30689 0.327915,1.50939 0.913134,0.920639 Z M3.12342,1.59494 C2.71959,1.59494 2.33133,1.75628 2.04431,2.04503 C1.75713,2.33395 1.59494,2.72681 1.59494,3.13746 L1.59494,8.12943 C1.59114,8.35901 1.62114,8.51076 1.71193,8.72129 C1.79563,8.9346 1.88065,9.06264 2.04431,9.22185 C2.33133,9.5106 2.71959,9.67195 3.12342,9.67195 L5.72383,9.67195 C5.93413,9.67195 6.13592,9.75502 6.28527,9.90308 L8.52848,12.1269 L8.52848,10.4694 C8.52848,10.029 8.88552,9.67195 9.32595,9.67195 L10.8766,9.67195 C11.1034,9.67583 11.2517,9.64614 11.4599,9.55518 C11.6712,9.47132 11.7976,9.38635 11.9557,9.22185 C12.1193,9.06264 12.2044,8.9346 12.2881,8.72129 C12.3789,8.51076 12.4089,8.35901 12.4051,8.12943 L12.4051,3.13746 C12.4051,2.72681 12.2429,2.33394 11.9557,2.04503 C11.6687,1.75628 11.2804,1.59494 10.8766,1.59494 L3.12342,1.59494 Z",displayName:"ChatIcon",viewBox:"0 0 14 14"}),iZ=qp({displayName:"EmailIcon",path:S.jsxs("g",{fill:"currentColor",children:[S.jsx("path",{d:"M11.114,14.556a1.252,1.252,0,0,0,1.768,0L22.568,4.87a.5.5,0,0,0-.281-.849A1.966,1.966,0,0,0,22,4H2a1.966,1.966,0,0,0-.289.021.5.5,0,0,0-.281.849Z"}),S.jsx("path",{d:"M23.888,5.832a.182.182,0,0,0-.2.039l-6.2,6.2a.251.251,0,0,0,0,.354l5.043,5.043a.75.75,0,1,1-1.06,1.061l-5.043-5.043a.25.25,0,0,0-.354,0l-2.129,2.129a2.75,2.75,0,0,1-3.888,0L7.926,13.488a.251.251,0,0,0-.354,0L2.529,18.531a.75.75,0,0,1-1.06-1.061l5.043-5.043a.251.251,0,0,0,0-.354l-6.2-6.2a.18.18,0,0,0-.2-.039A.182.182,0,0,0,0,6V18a2,2,0,0,0,2,2H22a2,2,0,0,0,2-2V6A.181.181,0,0,0,23.888,5.832Z"})]})}),Gze=qp({displayName:"CloseIcon",d:"M.439,21.44a1.5,1.5,0,0,0,2.122,2.121L11.823,14.3a.25.25,0,0,1,.354,0l9.262,9.263a1.5,1.5,0,1,0,2.122-2.121L14.3,12.177a.25.25,0,0,1,0-.354l9.263-9.262A1.5,1.5,0,0,0,21.439.44L12.177,9.7a.25.25,0,0,1-.354,0L2.561.44A1.5,1.5,0,0,0,.439,2.561L9.7,11.823a.25.25,0,0,1,0,.354Z"}),Hze=qp({displayName:"QuestionOutlineIcon",path:S.jsxs("g",{stroke:"currentColor",strokeWidth:"1.5",children:[S.jsx("path",{strokeLinecap:"round",fill:"none",d:"M9,9a3,3,0,1,1,4,2.829,1.5,1.5,0,0,0-1,1.415V14.25"}),S.jsx("path",{fill:"none",strokeLinecap:"round",d:"M12,17.25a.375.375,0,1,0,.375.375A.375.375,0,0,0,12,17.25h0"}),S.jsx("circle",{fill:"none",strokeMiterlimit:"10",cx:"12",cy:"12",r:"11.25"})]})}),$ze=qp({displayName:"HamburgerIcon",viewBox:"0 0 24 24",d:"M 3 5 A 1.0001 1.0001 0 1 0 3 7 L 21 7 A 1.0001 1.0001 0 1 0 21 5 L 3 5 z M 3 11 A 1.0001 1.0001 0 1 0 3 13 L 21 13 A 1.0001 1.0001 0 1 0 21 11 L 3 11 z M 3 17 A 1.0001 1.0001 0 1 0 3 19 L 21 19 A 1.0001 1.0001 0 1 0 21 17 L 3 17 z"});var pI=n=>n.type==="checkbox",Fy=n=>n instanceof Date,Lc=n=>n==null;const Pae=n=>typeof n=="object";var xo=n=>!Lc(n)&&!Array.isArray(n)&&Pae(n)&&!Fy(n),Kze=n=>xo(n)&&n.target?pI(n.target)?n.target.checked:n.target.value:n,qze=n=>n.substring(0,n.search(/\.\d+(\.|$)/))||n,Yze=(n,e)=>n.has(qze(e)),Xze=n=>{const e=n.constructor&&n.constructor.prototype;return xo(e)&&e.hasOwnProperty("isPrototypeOf")},X3=typeof window<"u"&&typeof window.HTMLElement<"u"&&typeof document<"u";function _a(n){let e;const i=Array.isArray(n),o=typeof FileList<"u"?n instanceof FileList:!1;if(n instanceof Date)e=new Date(n);else if(!(X3&&(n instanceof Blob||o))&&(i||xo(n)))if(e=i?[]:Object.create(Object.getPrototypeOf(n)),!i&&!Xze(n))e=n;else for(const l in n)n.hasOwnProperty(l)&&(e[l]=_a(n[l]));else return n;return e}var hx=n=>/^\w*$/.test(n),Ao=n=>n===void 0,J3=n=>Array.isArray(n)?n.filter(Boolean):[],Q3=n=>J3(n.replace(/["|']|\]/g,"").split(/\.|\[/)),Tn=(n,e,i)=>{if(!e||!xo(n))return i;const o=(hx(e)?[e]:Q3(e)).reduce((l,u)=>Lc(l)?l:l[u],n);return Ao(o)||o===n?Ao(n[e])?i:n[e]:o},Tp=n=>typeof n=="boolean",gs=(n,e,i)=>{let o=-1;const l=hx(e)?[e]:Q3(e),u=l.length,p=u-1;for(;++o<u;){const y=l[o];let E=i;if(o!==p){const b=n[y];E=xo(b)||Array.isArray(b)?b:isNaN(+l[o+1])?{}:[]}if(y==="__proto__"||y==="constructor"||y==="prototype")return;n[y]=E,n=n[y]}};const sZ={BLUR:"blur",FOCUS_OUT:"focusout"},mh={onBlur:"onBlur",onChange:"onChange",onSubmit:"onSubmit",onTouched:"onTouched",all:"all"},xf={max:"max",min:"min",maxLength:"maxLength",minLength:"minLength",pattern:"pattern",required:"required",validate:"validate"},Jze=yi.createContext(null);Jze.displayName="HookFormContext";var Qze=(n,e,i,o=!0)=>{const l={defaultValues:e._defaultValues};for(const u in n)Object.defineProperty(l,u,{get:()=>{const p=u;return e._proxyFormState[p]!==mh.all&&(e._proxyFormState[p]=!o||mh.all),n[p]}});return l};const Zze=typeof window<"u"?yi.useLayoutEffect:yi.useEffect;var du=n=>typeof n=="string",e9e=(n,e,i,o,l)=>du(n)?(o&&e.watch.add(n),Tn(i,n,l)):Array.isArray(n)?n.map(u=>(o&&e.watch.add(u),Tn(i,u))):(o&&(e.watchAll=!0),i),X5=n=>Lc(n)||!Pae(n);function Ng(n,e,i=new WeakSet){if(X5(n)||X5(e))return n===e;if(Fy(n)&&Fy(e))return n.getTime()===e.getTime();const o=Object.keys(n),l=Object.keys(e);if(o.length!==l.length)return!1;if(i.has(n)||i.has(e))return!0;i.add(n),i.add(e);for(const u of o){const p=n[u];if(!l.includes(u))return!1;if(u!=="ref"){const y=e[u];if(Fy(p)&&Fy(y)||xo(p)&&xo(y)||Array.isArray(p)&&Array.isArray(y)?!Ng(p,y,i):p!==y)return!1}}return!0}var t9e=(n,e,i,o,l)=>e?{...i[n],types:{...i[n]&&i[n].types?i[n].types:{},[o]:l||!0}}:{},tR=n=>Array.isArray(n)?n:[n],oZ=()=>{let n=[];return{get observers(){return n},next:l=>{for(const u of n)u.next&&u.next(l)},subscribe:l=>(n.push(l),{unsubscribe:()=>{n=n.filter(u=>u!==l)}}),unsubscribe:()=>{n=[]}}};function Oae(n,e){const i={};for(const o in n)if(n.hasOwnProperty(o)){const l=n[o],u=e[o];if(l&&xo(l)&&u){const p=Oae(l,u);xo(p)&&(i[o]=p)}else n[o]&&(i[o]=u)}return i}var vl=n=>xo(n)&&!Object.keys(n).length,Z3=n=>n.type==="file",gh=n=>typeof n=="function",Yk=n=>{if(!X3)return!1;const e=n?n.ownerDocument:0;return n instanceof(e&&e.defaultView?e.defaultView.HTMLElement:HTMLElement)},kae=n=>n.type==="select-multiple",e4=n=>n.type==="radio",n9e=n=>e4(n)||pI(n),vV=n=>Yk(n)&&n.isConnected;function r9e(n,e){const i=e.slice(0,-1).length;let o=0;for(;o<i;)n=Ao(n)?o++:n[e[o++]];return n}function i9e(n){for(const e in n)if(n.hasOwnProperty(e)&&!Ao(n[e]))return!1;return!0}function Ro(n,e){const i=Array.isArray(e)?e:hx(e)?[e]:Q3(e),o=i.length===1?n:r9e(n,i),l=i.length-1,u=i[l];return o&&delete o[u],l!==0&&(xo(o)&&vl(o)||Array.isArray(o)&&i9e(o))&&Ro(n,i.slice(0,-1)),n}var s9e=n=>{for(const e in n)if(gh(n[e]))return!0;return!1};function Nae(n){return Array.isArray(n)||xo(n)&&!s9e(n)}function J5(n,e={}){for(const i in n)Nae(n[i])?(e[i]=Array.isArray(n[i])?[]:{},J5(n[i],e[i])):Lc(n[i])||(e[i]=!0);return e}function Q0(n,e,i){i||(i=J5(e));for(const o in n)Nae(n[o])?Ao(e)||X5(i[o])?i[o]=J5(n[o],Array.isArray(n[o])?[]:{}):Q0(n[o],Lc(e)?{}:e[o],i[o]):i[o]=!Ng(n[o],e[o]);return i}const aZ={value:!1,isValid:!1},cZ={value:!0,isValid:!0};var xae=n=>{if(Array.isArray(n)){if(n.length>1){const e=n.filter(i=>i&&i.checked&&!i.disabled).map(i=>i.value);return{value:e,isValid:!!e.length}}return n[0].checked&&!n[0].disabled?n[0].attributes&&!Ao(n[0].attributes.value)?Ao(n[0].value)||n[0].value===""?cZ:{value:n[0].value,isValid:!0}:cZ:aZ}return aZ},Dae=(n,{valueAsNumber:e,valueAsDate:i,setValueAs:o})=>Ao(n)?n:e?n===""?NaN:n&&+n:i&&du(n)?new Date(n):o?o(n):n;const lZ={isValid:!1,value:null};var Lae=n=>Array.isArray(n)?n.reduce((e,i)=>i&&i.checked&&!i.disabled?{isValid:!0,value:i.value}:e,lZ):lZ;function uZ(n){const e=n.ref;return Z3(e)?e.files:e4(e)?Lae(n.refs).value:kae(e)?[...e.selectedOptions].map(({value:i})=>i):pI(e)?xae(n.refs).value:Dae(Ao(e.value)?n.ref.value:e.value,n)}var o9e=(n,e,i,o)=>{const l={};for(const u of n){const p=Tn(e,u);p&&gs(l,u,p._f)}return{criteriaMode:i,names:[...n],fields:l,shouldUseNativeValidation:o}},Xk=n=>n instanceof RegExp,cC=n=>Ao(n)?n:Xk(n)?n.source:xo(n)?Xk(n.value)?n.value.source:n.value:n,dZ=n=>({isOnSubmit:!n||n===mh.onSubmit,isOnBlur:n===mh.onBlur,isOnChange:n===mh.onChange,isOnAll:n===mh.all,isOnTouch:n===mh.onTouched});const hZ="AsyncFunction";var a9e=n=>!!n&&!!n.validate&&!!(gh(n.validate)&&n.validate.constructor.name===hZ||xo(n.validate)&&Object.values(n.validate).find(e=>e.constructor.name===hZ)),c9e=n=>n.mount&&(n.required||n.min||n.max||n.maxLength||n.minLength||n.pattern||n.validate),pZ=(n,e,i)=>!i&&(e.watchAll||e.watch.has(n)||[...e.watch].some(o=>n.startsWith(o)&&/^\.\w+/.test(n.slice(o.length))));const nR=(n,e,i,o)=>{for(const l of i||Object.keys(n)){const u=Tn(n,l);if(u){const{_f:p,...y}=u;if(p){if(p.refs&&p.refs[0]&&e(p.refs[0],l)&&!o)return!0;if(p.ref&&e(p.ref,p.name)&&!o)return!0;if(nR(y,e))break}else if(xo(y)&&nR(y,e))break}}};function fZ(n,e,i){const o=Tn(n,i);if(o||hx(i))return{error:o,name:i};const l=i.split(".");for(;l.length;){const u=l.join("."),p=Tn(e,u),y=Tn(n,u);if(p&&!Array.isArray(p)&&i!==u)return{name:i};if(y&&y.type)return{name:u,error:y};if(y&&y.root&&y.root.type)return{name:`${u}.root`,error:y.root};l.pop()}return{name:i}}var l9e=(n,e,i,o)=>{i(n);const{name:l,...u}=n;return vl(u)||Object.keys(u).length>=Object.keys(e).length||Object.keys(u).find(p=>e[p]===(!o||mh.all))},u9e=(n,e,i)=>!n||!e||n===e||tR(n).some(o=>o&&(i?o===e:o.startsWith(e)||e.startsWith(o))),d9e=(n,e,i,o,l)=>l.isOnAll?!1:!i&&l.isOnTouch?!(e||n):(i?o.isOnBlur:l.isOnBlur)?!n:(i?o.isOnChange:l.isOnChange)?n:!0,h9e=(n,e)=>!J3(Tn(n,e)).length&&Ro(n,e),p9e=(n,e,i)=>{const o=tR(Tn(n,i));return gs(o,"root",e[i]),gs(n,i,o),n};function mZ(n,e,i="validate"){if(du(n)||Array.isArray(n)&&n.every(du)||Tp(n)&&!n)return{type:i,message:du(n)?n:"",ref:e}}var H0=n=>xo(n)&&!Xk(n)?n:{value:n,message:""},gZ=async(n,e,i,o,l,u)=>{const{ref:p,refs:y,required:E,maxLength:b,minLength:T,min:R,max:O,pattern:L,validate:D,name:U,valueAsNumber:F,mount:Y}=n._f,W=Tn(i,U);if(!Y||e.has(U))return{};const re=y?y[0]:p,le=de=>{l&&re.reportValidity&&(re.setCustomValidity(Tp(de)?"":de||""),re.reportValidity())},ie={},me=e4(p),q=pI(p),J=me||q,Q=(F||Z3(p))&&Ao(p.value)&&Ao(W)||Yk(p)&&p.value===""||W===""||Array.isArray(W)&&!W.length,ne=t9e.bind(null,U,o,ie),he=(de,pe,Se,Ie=xf.maxLength,Fe=xf.minLength)=>{const we=de?pe:Se;ie[U]={type:de?Ie:Fe,message:we,ref:p,...ne(de?Ie:Fe,we)}};if(u?!Array.isArray(W)||!W.length:E&&(!J&&(Q||Lc(W))||Tp(W)&&!W||q&&!xae(y).isValid||me&&!Lae(y).isValid)){const{value:de,message:pe}=du(E)?{value:!!E,message:E}:H0(E);if(de&&(ie[U]={type:xf.required,message:pe,ref:re,...ne(xf.required,pe)},!o))return le(pe),ie}if(!Q&&(!Lc(R)||!Lc(O))){let de,pe;const Se=H0(O),Ie=H0(R);if(!Lc(W)&&!isNaN(W)){const Fe=p.valueAsNumber||W&&+W;Lc(Se.value)||(de=Fe>Se.value),Lc(Ie.value)||(pe=Fe<Ie.value)}else{const Fe=p.valueAsDate||new Date(W),we=Ne=>new Date(new Date().toDateString()+" "+Ne),Re=p.type=="time",Te=p.type=="week";du(Se.value)&&W&&(de=Re?we(W)>we(Se.value):Te?W>Se.value:Fe>new Date(Se.value)),du(Ie.value)&&W&&(pe=Re?we(W)<we(Ie.value):Te?W<Ie.value:Fe<new Date(Ie.value))}if((de||pe)&&(he(!!de,Se.message,Ie.message,xf.max,xf.min),!o))return le(ie[U].message),ie}if((b||T)&&!Q&&(du(W)||u&&Array.isArray(W))){const de=H0(b),pe=H0(T),Se=!Lc(de.value)&&W.length>+de.value,Ie=!Lc(pe.value)&&W.length<+pe.value;if((Se||Ie)&&(he(Se,de.message,pe.message),!o))return le(ie[U].message),ie}if(L&&!Q&&du(W)){const{value:de,message:pe}=H0(L);if(Xk(de)&&!W.match(de)&&(ie[U]={type:xf.pattern,message:pe,ref:p,...ne(xf.pattern,pe)},!o))return le(pe),ie}if(D){if(gh(D)){const de=await D(W,i),pe=mZ(de,re);if(pe&&(ie[U]={...pe,...ne(xf.validate,pe.message)},!o))return le(pe.message),ie}else if(xo(D)){let de={};for(const pe in D){if(!vl(de)&&!o)break;const Se=mZ(await D[pe](W,i),re,pe);Se&&(de={...Se,...ne(pe,Se.message)},le(Se.message),o&&(ie[U]=de))}if(!vl(de)&&(ie[U]={ref:re,...de},!o))return ie}}return le(!0),ie};const f9e={mode:mh.onSubmit,reValidateMode:mh.onChange,shouldFocusError:!0};function m9e(n={}){let e={...f9e,...n},i={submitCount:0,isDirty:!1,isReady:!1,isLoading:gh(e.defaultValues),isValidating:!1,isSubmitted:!1,isSubmitting:!1,isSubmitSuccessful:!1,isValid:!1,touchedFields:{},dirtyFields:{},validatingFields:{},errors:e.errors||{},disabled:e.disabled||!1},o={},l=xo(e.defaultValues)||xo(e.values)?_a(e.defaultValues||e.values)||{}:{},u=e.shouldUnregister?{}:_a(l),p={action:!1,mount:!1,watch:!1},y={mount:new Set,disabled:new Set,unMount:new Set,array:new Set,watch:new Set},E,b=0;const T={isDirty:!1,dirtyFields:!1,validatingFields:!1,touchedFields:!1,isValidating:!1,isValid:!1,errors:!1};let R={...T};const O={array:oZ(),state:oZ()},L=e.criteriaMode===mh.all,D=ve=>De=>{clearTimeout(b),b=setTimeout(ve,De)},U=async ve=>{if(!e.disabled&&(T.isValid||R.isValid||ve)){const De=e.resolver?vl((await q()).errors):await Q(o,!0);De!==i.isValid&&O.state.next({isValid:De})}},F=(ve,De)=>{!e.disabled&&(T.isValidating||T.validatingFields||R.isValidating||R.validatingFields)&&((ve||Array.from(y.mount)).forEach(qe=>{qe&&(De?gs(i.validatingFields,qe,De):Ro(i.validatingFields,qe))}),O.state.next({validatingFields:i.validatingFields,isValidating:!vl(i.validatingFields)}))},Y=(ve,De=[],qe,Ot,vt=!0,Pt=!0)=>{if(Ot&&qe&&!e.disabled){if(p.action=!0,Pt&&Array.isArray(Tn(o,ve))){const Ut=qe(Tn(o,ve),Ot.argA,Ot.argB);vt&&gs(o,ve,Ut)}if(Pt&&Array.isArray(Tn(i.errors,ve))){const Ut=qe(Tn(i.errors,ve),Ot.argA,Ot.argB);vt&&gs(i.errors,ve,Ut),h9e(i.errors,ve)}if((T.touchedFields||R.touchedFields)&&Pt&&Array.isArray(Tn(i.touchedFields,ve))){const Ut=qe(Tn(i.touchedFields,ve),Ot.argA,Ot.argB);vt&&gs(i.touchedFields,ve,Ut)}(T.dirtyFields||R.dirtyFields)&&(i.dirtyFields=Q0(l,u)),O.state.next({name:ve,isDirty:he(ve,De),dirtyFields:i.dirtyFields,errors:i.errors,isValid:i.isValid})}else gs(u,ve,De)},W=(ve,De)=>{gs(i.errors,ve,De),O.state.next({errors:i.errors})},re=ve=>{i.errors=ve,O.state.next({errors:i.errors,isValid:!1})},le=(ve,De,qe,Ot)=>{const vt=Tn(o,ve);if(vt){const Pt=Tn(u,ve,Ao(qe)?Tn(l,ve):qe);Ao(Pt)||Ot&&Ot.defaultChecked||De?gs(u,ve,De?Pt:uZ(vt._f)):Se(ve,Pt),p.mount&&U()}},ie=(ve,De,qe,Ot,vt)=>{let Pt=!1,Ut=!1;const cn={name:ve};if(!e.disabled){if(!qe||Ot){(T.isDirty||R.isDirty)&&(Ut=i.isDirty,i.isDirty=cn.isDirty=he(),Pt=Ut!==cn.isDirty);const _t=Ng(Tn(l,ve),De);Ut=!!Tn(i.dirtyFields,ve),_t?Ro(i.dirtyFields,ve):gs(i.dirtyFields,ve,!0),cn.dirtyFields=i.dirtyFields,Pt=Pt||(T.dirtyFields||R.dirtyFields)&&Ut!==!_t}if(qe){const _t=Tn(i.touchedFields,ve);_t||(gs(i.touchedFields,ve,qe),cn.touchedFields=i.touchedFields,Pt=Pt||(T.touchedFields||R.touchedFields)&&_t!==qe)}Pt&&vt&&O.state.next(cn)}return Pt?cn:{}},me=(ve,De,qe,Ot)=>{const vt=Tn(i.errors,ve),Pt=(T.isValid||R.isValid)&&Tp(De)&&i.isValid!==De;if(e.delayError&&qe?(E=D(()=>W(ve,qe)),E(e.delayError)):(clearTimeout(b),E=null,qe?gs(i.errors,ve,qe):Ro(i.errors,ve)),(qe?!Ng(vt,qe):vt)||!vl(Ot)||Pt){const Ut={...Ot,...Pt&&Tp(De)?{isValid:De}:{},errors:i.errors,name:ve};i={...i,...Ut},O.state.next(Ut)}},q=async ve=>{F(ve,!0);const De=await e.resolver(u,e.context,o9e(ve||y.mount,o,e.criteriaMode,e.shouldUseNativeValidation));return F(ve),De},J=async ve=>{const{errors:De}=await q(ve);if(ve)for(const qe of ve){const Ot=Tn(De,qe);Ot?gs(i.errors,qe,Ot):Ro(i.errors,qe)}else i.errors=De;return De},Q=async(ve,De,qe={valid:!0})=>{for(const Ot in ve){const vt=ve[Ot];if(vt){const{_f:Pt,...Ut}=vt;if(Pt){const cn=y.array.has(Pt.name),_t=vt._f&&a9e(vt._f);_t&&T.validatingFields&&F([Pt.name],!0);const wn=await gZ(vt,y.disabled,u,L,e.shouldUseNativeValidation&&!De,cn);if(_t&&T.validatingFields&&F([Pt.name]),wn[Pt.name]&&(qe.valid=!1,De))break;!De&&(Tn(wn,Pt.name)?cn?p9e(i.errors,wn,Pt.name):gs(i.errors,Pt.name,wn[Pt.name]):Ro(i.errors,Pt.name))}!vl(Ut)&&await Q(Ut,De,qe)}}return qe.valid},ne=()=>{for(const ve of y.unMount){const De=Tn(o,ve);De&&(De._f.refs?De._f.refs.every(qe=>!vV(qe)):!vV(De._f.ref))&&lt(ve)}y.unMount=new Set},he=(ve,De)=>!e.disabled&&(ve&&De&&gs(u,ve,De),!Ng(Ne(),l)),de=(ve,De,qe)=>e9e(ve,y,{...p.mount?u:Ao(De)?l:du(ve)?{[ve]:De}:De},qe,De),pe=ve=>J3(Tn(p.mount?u:l,ve,e.shouldUnregister?Tn(l,ve,[]):[])),Se=(ve,De,qe={})=>{const Ot=Tn(o,ve);let vt=De;if(Ot){const Pt=Ot._f;Pt&&(!Pt.disabled&&gs(u,ve,Dae(De,Pt)),vt=Yk(Pt.ref)&&Lc(De)?"":De,kae(Pt.ref)?[...Pt.ref.options].forEach(Ut=>Ut.selected=vt.includes(Ut.value)):Pt.refs?pI(Pt.ref)?Pt.refs.forEach(Ut=>{(!Ut.defaultChecked||!Ut.disabled)&&(Array.isArray(vt)?Ut.checked=!!vt.find(cn=>cn===Ut.value):Ut.checked=vt===Ut.value||!!vt)}):Pt.refs.forEach(Ut=>Ut.checked=Ut.value===vt):Z3(Pt.ref)?Pt.ref.value="":(Pt.ref.value=vt,Pt.ref.type||O.state.next({name:ve,values:_a(u)})))}(qe.shouldDirty||qe.shouldTouch)&&ie(ve,vt,qe.shouldTouch,qe.shouldDirty,!0),qe.shouldValidate&&Te(ve)},Ie=(ve,De,qe)=>{for(const Ot in De){if(!De.hasOwnProperty(Ot))return;const vt=De[Ot],Pt=ve+"."+Ot,Ut=Tn(o,Pt);(y.array.has(ve)||xo(vt)||Ut&&!Ut._f)&&!Fy(vt)?Ie(Pt,vt,qe):Se(Pt,vt,qe)}},Fe=(ve,De,qe={})=>{const Ot=Tn(o,ve),vt=y.array.has(ve),Pt=_a(De);gs(u,ve,Pt),vt?(O.array.next({name:ve,values:_a(u)}),(T.isDirty||T.dirtyFields||R.isDirty||R.dirtyFields)&&qe.shouldDirty&&O.state.next({name:ve,dirtyFields:Q0(l,u),isDirty:he(ve,Pt)})):Ot&&!Ot._f&&!Lc(Pt)?Ie(ve,Pt,qe):Se(ve,Pt,qe),pZ(ve,y)&&O.state.next({...i,name:ve}),O.state.next({name:p.mount?ve:void 0,values:_a(u)})},we=async ve=>{p.mount=!0;const De=ve.target;let qe=De.name,Ot=!0;const vt=Tn(o,qe),Pt=_t=>{Ot=Number.isNaN(_t)||Fy(_t)&&isNaN(_t.getTime())||Ng(_t,Tn(u,qe,_t))},Ut=dZ(e.mode),cn=dZ(e.reValidateMode);if(vt){let _t,wn;const Nt=De.type?uZ(vt._f):Kze(ve),Ht=ve.type===sZ.BLUR||ve.type===sZ.FOCUS_OUT,Ur=!c9e(vt._f)&&!e.resolver&&!Tn(i.errors,qe)&&!vt._f.deps||d9e(Ht,Tn(i.touchedFields,qe),i.isSubmitted,cn,Ut),Ri=pZ(qe,y,Ht);gs(u,qe,Nt),Ht?(!De||!De.readOnly)&&(vt._f.onBlur&&vt._f.onBlur(ve),E&&E(0)):vt._f.onChange&&vt._f.onChange(ve);const ri=ie(qe,Nt,Ht),zi=!vl(ri)||Ri;if(!Ht&&O.state.next({name:qe,type:ve.type,values:_a(u)}),Ur)return(T.isValid||R.isValid)&&(e.mode==="onBlur"?Ht&&U():Ht||U()),zi&&O.state.next({name:qe,...Ri?{}:ri});if(!Ht&&Ri&&O.state.next({...i}),e.resolver){const{errors:ds}=await q([qe]);if(Pt(Nt),Ot){const Eo=fZ(i.errors,o,qe),Gr=fZ(ds,o,Eo.name||qe);_t=Gr.error,qe=Gr.name,wn=vl(ds)}}else F([qe],!0),_t=(await gZ(vt,y.disabled,u,L,e.shouldUseNativeValidation))[qe],F([qe]),Pt(Nt),Ot&&(_t?wn=!1:(T.isValid||R.isValid)&&(wn=await Q(o,!0)));Ot&&(vt._f.deps&&(!Array.isArray(vt._f.deps)||vt._f.deps.length>0)&&Te(vt._f.deps),me(qe,wn,_t,ri))}},Re=(ve,De)=>{if(Tn(i.errors,De)&&ve.focus)return ve.focus(),1},Te=async(ve,De={})=>{let qe,Ot;const vt=tR(ve);if(e.resolver){const Pt=await J(Ao(ve)?ve:vt);qe=vl(Pt),Ot=ve?!vt.some(Ut=>Tn(Pt,Ut)):qe}else ve?(Ot=(await Promise.all(vt.map(async Pt=>{const Ut=Tn(o,Pt);return await Q(Ut&&Ut._f?{[Pt]:Ut}:Ut)}))).every(Boolean),!(!Ot&&!i.isValid)&&U()):Ot=qe=await Q(o);return O.state.next({...!du(ve)||(T.isValid||R.isValid)&&qe!==i.isValid?{}:{name:ve},...e.resolver||!ve?{isValid:qe}:{},errors:i.errors}),De.shouldFocus&&!Ot&&nR(o,Re,ve?vt:y.mount),Ot},Ne=(ve,De)=>{let qe={...p.mount?u:l};return De&&(qe=Oae(De.dirtyFields?i.dirtyFields:i.touchedFields,qe)),Ao(ve)?qe:du(ve)?Tn(qe,ve):ve.map(Ot=>Tn(qe,Ot))},be=(ve,De)=>({invalid:!!Tn((De||i).errors,ve),isDirty:!!Tn((De||i).dirtyFields,ve),error:Tn((De||i).errors,ve),isValidating:!!Tn(i.validatingFields,ve),isTouched:!!Tn((De||i).touchedFields,ve)}),xe=ve=>{ve&&tR(ve).forEach(De=>Ro(i.errors,De)),O.state.next({errors:ve?i.errors:{}})},je=(ve,De,qe)=>{const Ot=(Tn(o,ve,{_f:{}})._f||{}).ref,vt=Tn(i.errors,ve)||{},{ref:Pt,message:Ut,type:cn,..._t}=vt;gs(i.errors,ve,{..._t,...De,ref:Ot}),O.state.next({name:ve,errors:i.errors,isValid:!1}),qe&&qe.shouldFocus&&Ot&&Ot.focus&&Ot.focus()},nt=(ve,De)=>gh(ve)?O.state.subscribe({next:qe=>"values"in qe&&ve(de(void 0,De),qe)}):de(ve,De,!0),dt=ve=>O.state.subscribe({next:De=>{u9e(ve.name,De.name,ve.exact)&&l9e(De,ve.formState||T,Ft,ve.reRenderRoot)&&ve.callback({values:{...u},...i,...De,defaultValues:l})}}).unsubscribe,ft=ve=>(p.mount=!0,R={...R,...ve.formState},dt({...ve,formState:R})),lt=(ve,De={})=>{for(const qe of ve?tR(ve):y.mount)y.mount.delete(qe),y.array.delete(qe),De.keepValue||(Ro(o,qe),Ro(u,qe)),!De.keepError&&Ro(i.errors,qe),!De.keepDirty&&Ro(i.dirtyFields,qe),!De.keepTouched&&Ro(i.touchedFields,qe),!De.keepIsValidating&&Ro(i.validatingFields,qe),!e.shouldUnregister&&!De.keepDefaultValue&&Ro(l,qe);O.state.next({values:_a(u)}),O.state.next({...i,...De.keepDirty?{isDirty:he()}:{}}),!De.keepIsValid&&U()},gt=({disabled:ve,name:De})=>{(Tp(ve)&&p.mount||ve||y.disabled.has(De))&&(ve?y.disabled.add(De):y.disabled.delete(De))},at=(ve,De={})=>{let qe=Tn(o,ve);const Ot=Tp(De.disabled)||Tp(e.disabled);return gs(o,ve,{...qe||{},_f:{...qe&&qe._f?qe._f:{ref:{name:ve}},name:ve,mount:!0,...De}}),y.mount.add(ve),qe?gt({disabled:Tp(De.disabled)?De.disabled:e.disabled,name:ve}):le(ve,!0,De.value),{...Ot?{disabled:De.disabled||e.disabled}:{},...e.progressive?{required:!!De.required,min:cC(De.min),max:cC(De.max),minLength:cC(De.minLength),maxLength:cC(De.maxLength),pattern:cC(De.pattern)}:{},name:ve,onChange:we,onBlur:we,ref:vt=>{if(vt){at(ve,De),qe=Tn(o,ve);const Pt=Ao(vt.value)&&vt.querySelectorAll&&vt.querySelectorAll("input,select,textarea")[0]||vt,Ut=n9e(Pt),cn=qe._f.refs||[];if(Ut?cn.find(_t=>_t===Pt):Pt===qe._f.ref)return;gs(o,ve,{_f:{...qe._f,...Ut?{refs:[...cn.filter(vV),Pt,...Array.isArray(Tn(l,ve))?[{}]:[]],ref:{type:Pt.type,name:ve}}:{ref:Pt}}}),le(ve,!1,void 0,Pt)}else qe=Tn(o,ve,{}),qe._f&&(qe._f.mount=!1),(e.shouldUnregister||De.shouldUnregister)&&!(Yze(y.array,ve)&&p.action)&&y.unMount.add(ve)}}},Ct=()=>e.shouldFocusError&&nR(o,Re,y.mount),En=ve=>{Tp(ve)&&(O.state.next({disabled:ve}),nR(o,(De,qe)=>{const Ot=Tn(o,qe);Ot&&(De.disabled=Ot._f.disabled||ve,Array.isArray(Ot._f.refs)&&Ot._f.refs.forEach(vt=>{vt.disabled=Ot._f.disabled||ve}))},0,!1))},Gt=(ve,De)=>async qe=>{let Ot;qe&&(qe.preventDefault&&qe.preventDefault(),qe.persist&&qe.persist());let vt=_a(u);if(O.state.next({isSubmitting:!0}),e.resolver){const{errors:Pt,values:Ut}=await q();i.errors=Pt,vt=_a(Ut)}else await Q(o);if(y.disabled.size)for(const Pt of y.disabled)Ro(vt,Pt);if(Ro(i.errors,"root"),vl(i.errors)){O.state.next({errors:{}});try{await ve(vt,qe)}catch(Pt){Ot=Pt}}else De&&await De({...i.errors},qe),Ct(),setTimeout(Ct);if(O.state.next({isSubmitted:!0,isSubmitting:!1,isSubmitSuccessful:vl(i.errors)&&!Ot,submitCount:i.submitCount+1,errors:i.errors}),Ot)throw Ot},Jt=(ve,De={})=>{Tn(o,ve)&&(Ao(De.defaultValue)?Fe(ve,_a(Tn(l,ve))):(Fe(ve,De.defaultValue),gs(l,ve,_a(De.defaultValue))),De.keepTouched||Ro(i.touchedFields,ve),De.keepDirty||(Ro(i.dirtyFields,ve),i.isDirty=De.defaultValue?he(ve,_a(Tn(l,ve))):he()),De.keepError||(Ro(i.errors,ve),T.isValid&&U()),O.state.next({...i}))},st=(ve,De={})=>{const qe=ve?_a(ve):l,Ot=_a(qe),vt=vl(ve),Pt=vt?l:Ot;if(De.keepDefaultValues||(l=qe),!De.keepValues){if(De.keepDirtyValues){const Ut=new Set([...y.mount,...Object.keys(Q0(l,u))]);for(const cn of Array.from(Ut))Tn(i.dirtyFields,cn)?gs(Pt,cn,Tn(u,cn)):Fe(cn,Tn(Pt,cn))}else{if(X3&&Ao(ve))for(const Ut of y.mount){const cn=Tn(o,Ut);if(cn&&cn._f){const _t=Array.isArray(cn._f.refs)?cn._f.refs[0]:cn._f.ref;if(Yk(_t)){const wn=_t.closest("form");if(wn){wn.reset();break}}}}if(De.keepFieldsRef)for(const Ut of y.mount)Fe(Ut,Tn(Pt,Ut));else o={}}u=e.shouldUnregister?De.keepDefaultValues?_a(l):{}:_a(Pt),O.array.next({values:{...Pt}}),O.state.next({values:{...Pt}})}y={mount:De.keepDirtyValues?y.mount:new Set,unMount:new Set,array:new Set,disabled:new Set,watch:new Set,watchAll:!1,focus:""},p.mount=!T.isValid||!!De.keepIsValid||!!De.keepDirtyValues,p.watch=!!e.shouldUnregister,O.state.next({submitCount:De.keepSubmitCount?i.submitCount:0,isDirty:vt?!1:De.keepDirty?i.isDirty:!!(De.keepDefaultValues&&!Ng(ve,l)),isSubmitted:De.keepIsSubmitted?i.isSubmitted:!1,dirtyFields:vt?{}:De.keepDirtyValues?De.keepDefaultValues&&u?Q0(l,u):i.dirtyFields:De.keepDefaultValues&&ve?Q0(l,ve):De.keepDirty?i.dirtyFields:{},touchedFields:De.keepTouched?i.touchedFields:{},errors:De.keepErrors?i.errors:{},isSubmitSuccessful:De.keepIsSubmitSuccessful?i.isSubmitSuccessful:!1,isSubmitting:!1,defaultValues:l})},hn=(ve,De)=>st(gh(ve)?ve(u):ve,De),an=(ve,De={})=>{const qe=Tn(o,ve),Ot=qe&&qe._f;if(Ot){const vt=Ot.refs?Ot.refs[0]:Ot.ref;vt.focus&&(vt.focus(),De.shouldSelect&&gh(vt.select)&&vt.select())}},Ft=ve=>{i={...i,...ve}},bt={control:{register:at,unregister:lt,getFieldState:be,handleSubmit:Gt,setError:je,_subscribe:dt,_runSchema:q,_focusError:Ct,_getWatch:de,_getDirty:he,_setValid:U,_setFieldArray:Y,_setDisabledField:gt,_setErrors:re,_getFieldArray:pe,_reset:st,_resetDefaultValues:()=>gh(e.defaultValues)&&e.defaultValues().then(ve=>{hn(ve,e.resetOptions),O.state.next({isLoading:!1})}),_removeUnmounted:ne,_disableForm:En,_subjects:O,_proxyFormState:T,get _fields(){return o},get _formValues(){return u},get _state(){return p},set _state(ve){p=ve},get _defaultValues(){return l},get _names(){return y},set _names(ve){y=ve},get _formState(){return i},get _options(){return e},set _options(ve){e={...e,...ve}}},subscribe:ft,trigger:Te,register:at,handleSubmit:Gt,watch:nt,setValue:Fe,getValues:Ne,reset:hn,resetField:Jt,clearErrors:xe,unregister:lt,setError:je,setFocus:an,getFieldState:be};return{...bt,formControl:bt}}function Mae(n={}){const e=yi.useRef(void 0),i=yi.useRef(void 0),[o,l]=yi.useState({isDirty:!1,isValidating:!1,isLoading:gh(n.defaultValues),isSubmitted:!1,isSubmitting:!1,isSubmitSuccessful:!1,isValid:!1,submitCount:0,dirtyFields:{},touchedFields:{},validatingFields:{},errors:n.errors||{},disabled:n.disabled||!1,isReady:!1,defaultValues:gh(n.defaultValues)?void 0:n.defaultValues});if(!e.current)if(n.formControl)e.current={...n.formControl,formState:o},n.defaultValues&&!gh(n.defaultValues)&&n.formControl.reset(n.defaultValues,n.resetOptions);else{const{formControl:p,...y}=m9e(n);e.current={...y,formState:o}}const u=e.current.control;return u._options=n,Zze(()=>{const p=u._subscribe({formState:u._proxyFormState,callback:()=>l({...u._formState}),reRenderRoot:!0});return l(y=>({...y,isReady:!0})),u._formState.isReady=!0,p},[u]),yi.useEffect(()=>u._disableForm(n.disabled),[u,n.disabled]),yi.useEffect(()=>{n.mode&&(u._options.mode=n.mode),n.reValidateMode&&(u._options.reValidateMode=n.reValidateMode)},[u,n.mode,n.reValidateMode]),yi.useEffect(()=>{n.errors&&(u._setErrors(n.errors),u._focusError())},[u,n.errors]),yi.useEffect(()=>{n.shouldUnregister&&u._subjects.state.next({values:u._getWatch()})},[u,n.shouldUnregister]),yi.useEffect(()=>{if(u._proxyFormState.isDirty){const p=u._getDirty();p!==o.isDirty&&u._subjects.state.next({isDirty:p})}},[u,o.isDirty]),yi.useEffect(()=>{n.values&&!Ng(n.values,i.current)?(u._reset(n.values,{keepFieldsRef:!0,...u._options.resetOptions}),i.current=n.values,l(p=>({...p}))):u._resetDefaultValues()},[u,n.values]),yi.useEffect(()=>{u._state.mount||(u._setValid(),u._state.mount=!0),u._state.watch&&(u._state.watch=!1,u._subjects.state.next({...u._formState})),u._removeUnmounted()}),e.current.formState=Qze(o,u),e.current}var g9e=["sitekey","onChange","theme","type","tabindex","onExpired","onErrored","size","stoken","grecaptcha","badge","hl","isolated"];function Q5(){return Q5=Object.assign?Object.assign.bind():function(n){for(var e=1;e<arguments.length;e++){var i=arguments[e];for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(n[o]=i[o])}return n},Q5.apply(this,arguments)}function _9e(n,e){if(n==null)return{};var i={},o=Object.keys(n),l,u;for(u=0;u<o.length;u++)l=o[u],!(e.indexOf(l)>=0)&&(i[l]=n[l]);return i}function TO(n){if(n===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return n}function y9e(n,e){n.prototype=Object.create(e.prototype),n.prototype.constructor=n,Z5(n,e)}function Z5(n,e){return Z5=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(o,l){return o.__proto__=l,o},Z5(n,e)}var px=(function(n){y9e(e,n);function e(){var o;return o=n.call(this)||this,o.handleExpired=o.handleExpired.bind(TO(o)),o.handleErrored=o.handleErrored.bind(TO(o)),o.handleChange=o.handleChange.bind(TO(o)),o.handleRecaptchaRef=o.handleRecaptchaRef.bind(TO(o)),o}var i=e.prototype;return i.getCaptchaFunction=function(l){return this.props.grecaptcha?this.props.grecaptcha.enterprise?this.props.grecaptcha.enterprise[l]:this.props.grecaptcha[l]:null},i.getValue=function(){var l=this.getCaptchaFunction("getResponse");return l&&this._widgetId!==void 0?l(this._widgetId):null},i.getWidgetId=function(){return this.props.grecaptcha&&this._widgetId!==void 0?this._widgetId:null},i.execute=function(){var l=this.getCaptchaFunction("execute");if(l&&this._widgetId!==void 0)return l(this._widgetId);this._executeRequested=!0},i.executeAsync=function(){var l=this;return new Promise(function(u,p){l.executionResolve=u,l.executionReject=p,l.execute()})},i.reset=function(){var l=this.getCaptchaFunction("reset");l&&this._widgetId!==void 0&&l(this._widgetId)},i.forceReset=function(){var l=this.getCaptchaFunction("reset");l&&l()},i.handleExpired=function(){this.props.onExpired?this.props.onExpired():this.handleChange(null)},i.handleErrored=function(){this.props.onErrored&&this.props.onErrored(),this.executionReject&&(this.executionReject(),delete this.executionResolve,delete this.executionReject)},i.handleChange=function(l){this.props.onChange&&this.props.onChange(l),this.executionResolve&&(this.executionResolve(l),delete this.executionReject,delete this.executionResolve)},i.explicitRender=function(){var l=this.getCaptchaFunction("render");if(l&&this._widgetId===void 0){var u=document.createElement("div");this._widgetId=l(u,{sitekey:this.props.sitekey,callback:this.handleChange,theme:this.props.theme,type:this.props.type,tabindex:this.props.tabindex,"expired-callback":this.handleExpired,"error-callback":this.handleErrored,size:this.props.size,stoken:this.props.stoken,hl:this.props.hl,badge:this.props.badge,isolated:this.props.isolated}),this.captcha.appendChild(u)}this._executeRequested&&this.props.grecaptcha&&this._widgetId!==void 0&&(this._executeRequested=!1,this.execute())},i.componentDidMount=function(){this.explicitRender()},i.componentDidUpdate=function(){this.explicitRender()},i.handleRecaptchaRef=function(l){this.captcha=l},i.render=function(){var l=this.props;l.sitekey,l.onChange,l.theme,l.type,l.tabindex,l.onExpired,l.onErrored,l.size,l.stoken,l.grecaptcha,l.badge,l.hl,l.isolated;var u=_9e(l,g9e);return k.createElement("div",Q5({},u,{ref:this.handleRecaptchaRef}))},e})(k.Component);px.displayName="ReCAPTCHA";px.propTypes={sitekey:An.string.isRequired,onChange:An.func,grecaptcha:An.object,theme:An.oneOf(["dark","light"]),type:An.oneOf(["image","audio"]),tabindex:An.number,onExpired:An.func,onErrored:An.func,size:An.oneOf(["compact","normal","invisible"]),stoken:An.string,hl:An.string,badge:An.oneOf(["bottomright","bottomleft","inline"]),isolated:An.bool};px.defaultProps={onChange:function(){},theme:"light",type:"image",tabindex:0,size:"normal",badge:"bottomright"};function ej(){return ej=Object.assign||function(n){for(var e=1;e<arguments.length;e++){var i=arguments[e];for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(n[o]=i[o])}return n},ej.apply(this,arguments)}function E9e(n,e){if(n==null)return{};var i={},o=Object.keys(n),l,u;for(u=0;u<o.length;u++)l=o[u],!(e.indexOf(l)>=0)&&(i[l]=n[l]);return i}function v9e(n,e){n.prototype=Object.create(e.prototype),n.prototype.constructor=n,n.__proto__=e}var uh={},S9e=0;function b9e(n,e){return e=e||{},function(o){var l=o.displayName||o.name||"Component",u=(function(y){v9e(E,y);function E(T,R){var O;return O=y.call(this,T,R)||this,O.state={},O.__scriptURL="",O}var b=E.prototype;return b.asyncScriptLoaderGetScriptLoaderID=function(){return this.__scriptLoaderID||(this.__scriptLoaderID="async-script-loader-"+S9e++),this.__scriptLoaderID},b.setupScriptURL=function(){return this.__scriptURL=typeof n=="function"?n():n,this.__scriptURL},b.asyncScriptLoaderHandleLoad=function(R){var O=this;this.setState(R,function(){return O.props.asyncScriptOnLoad&&O.props.asyncScriptOnLoad(O.state)})},b.asyncScriptLoaderTriggerOnScriptLoaded=function(){var R=uh[this.__scriptURL];if(!R||!R.loaded)throw new Error("Script is not loaded.");for(var O in R.observers)R.observers[O](R);delete window[e.callbackName]},b.componentDidMount=function(){var R=this,O=this.setupScriptURL(),L=this.asyncScriptLoaderGetScriptLoaderID(),D=e,U=D.globalName,F=D.callbackName,Y=D.scriptId;if(U&&typeof window[U]<"u"&&(uh[O]={loaded:!0,observers:{}}),uh[O]){var W=uh[O];if(W&&(W.loaded||W.errored)){this.asyncScriptLoaderHandleLoad(W);return}W.observers[L]=function(q){return R.asyncScriptLoaderHandleLoad(q)};return}var re={};re[L]=function(q){return R.asyncScriptLoaderHandleLoad(q)},uh[O]={loaded:!1,observers:re};var le=document.createElement("script");le.src=O,le.async=!0;for(var ie in e.attributes)le.setAttribute(ie,e.attributes[ie]);Y&&(le.id=Y);var me=function(J){if(uh[O]){var Q=uh[O],ne=Q.observers;for(var he in ne)J(ne[he])&&delete ne[he]}};F&&typeof window<"u"&&(window[F]=function(){return R.asyncScriptLoaderTriggerOnScriptLoaded()}),le.onload=function(){var q=uh[O];q&&(q.loaded=!0,me(function(J){return F?!1:(J(q),!0)}))},le.onerror=function(){var q=uh[O];q&&(q.errored=!0,me(function(J){return J(q),!0}))},document.body.appendChild(le)},b.componentWillUnmount=function(){var R=this.__scriptURL;if(e.removeOnUnmount===!0)for(var O=document.getElementsByTagName("script"),L=0;L<O.length;L+=1)O[L].src.indexOf(R)>-1&&O[L].parentNode&&O[L].parentNode.removeChild(O[L]);var D=uh[R];D&&(delete D.observers[this.asyncScriptLoaderGetScriptLoaderID()],e.removeOnUnmount===!0&&delete uh[R])},b.render=function(){var R=e.globalName,O=this.props;O.asyncScriptOnLoad;var L=O.forwardedRef,D=E9e(O,["asyncScriptOnLoad","forwardedRef"]);return R&&typeof window<"u"&&(D[R]=typeof window[R]<"u"?window[R]:void 0),D.ref=L,k.createElement(o,D)},E})(k.Component),p=k.forwardRef(function(y,E){return k.createElement(u,ej({},y,{forwardedRef:E}))});return p.displayName="AsyncScriptLoader("+l+")",p.propTypes={asyncScriptOnLoad:An.func},bAe(p,o)}}var tj="onloadcallback",w9e="grecaptcha";function nj(){return typeof window<"u"&&window.recaptchaOptions||{}}function T9e(){var n=nj(),e=n.useRecaptchaNet?"recaptcha.net":"www.google.com";return n.enterprise?"https://"+e+"/recaptcha/enterprise.js?onload="+tj+"&render=explicit":"https://"+e+"/recaptcha/api.js?onload="+tj+"&render=explicit"}const Uae=b9e(T9e,{callbackName:tj,globalName:w9e,attributes:nj().nonce?{nonce:nj().nonce}:{}})(px),fx=(n,e="generic-modal")=>{k.useEffect(()=>{if(!window.unityInstance)return;const i=()=>{try{window.unityInstance.SendMessage("WebGLInputManager","Disable"),G.log(`Unity input disabled for ${e}`),document.body.classList.add("unity-input-disabled"),window.unityInputDisabled=!0,window.unityInputDisabledBy=e}catch(l){G.error(`Failed to disable Unity input for ${e}:`,l)}},o=()=>{try{window.unityInputDisabledBy===e?(window.unityInstance.SendMessage("WebGLInputManager","Enable"),G.log(`Unity input re-enabled (was disabled by ${e})`),document.body.classList.remove("unity-input-disabled"),window.unityInputDisabled=!1,window.unityInputDisabledBy=null):G.log(`Not re-enabling Unity input for ${e} because it was disabled by ${window.unityInputDisabledBy}`)}catch(l){G.error(`Failed to enable Unity input for ${e}:`,l)}};return n?i():o(),()=>{n&&o()}},[n,e])},Vae=({isOpen:n,onClose:e,userData:i,onConfirm:o,fullscreenRef:l})=>{const[u,p]=k.useState((i==null?void 0:i.username)||""),[y,E]=k.useState((i==null?void 0:i.Nickname)||""),[b,T]=k.useState(!1),[R,O]=k.useState(null),[L,D]=k.useState(!1),U=ea(),F=le=>!(!le||le.trim()===""||!/^[a-z0-9]{1,15}$/.test(le)),Y=async le=>{var ie,me;if(!F(le))return!le||le.trim()===""?O("Username cannot be empty"):O("Username must be 1-15 characters, lowercase letters and numbers only"),!1;T(!0),O(null);try{let q=!1,J=0;const Q=3;for(;J<Q;)try{q=await DR(le);break}catch(ne){if(G.error(`Attempt ${J+1}: Error checking username:`,ne),J++,J>=Q)throw ne;await new Promise(he=>setTimeout(he,1e3))}return q?(O("Username is already taken"),!1):!0}catch(q){return G.error("Error checking username after retries:",q),q.code==="permission-denied"||(ie=q.message)!=null&&ie.includes("permissions")?O("Username check unavailable. Please try again or pick a unique name."):O("Error checking username availability. Please try again."),q.code==="permission-denied"||((me=q.message)==null?void 0:me.includes("permissions"))}finally{T(!1)}};k.useEffect(()=>{if(!u){O("Username cannot be empty");return}if(u!==(i==null?void 0:i.username)){const le=setTimeout(async()=>{await Y(u)},500);return()=>clearTimeout(le)}},[u]),k.useEffect(()=>{if(i&&i.firstName&&i.lastName){const le=`${i.firstName}${i.lastName.charAt(0).toUpperCase()}`;E(le)}},[i]);const W=async()=>{D(!0);try{if(!await Y(u)){D(!1);return}if(y.length>15){O("Display Name must be at most 15 characters"),D(!1);return}ud(y),G.log("UsernameConfirmation: Preparing to confirm user registration");const ie=i.firstName&&i.lastName?`${i.firstName}${i.lastName.charAt(0).toUpperCase()}`:"",me={...i,firstName:i.firstName||"",lastName:i.lastName||"",companyName:i.companyName||"",linkedInProfile:i.linkedInProfile||"",username:u,Nickname:y||ie,email:i.email,password:i.password};G.log("UsernameConfirmation: Processed registration data with fields:",Object.keys(me).join(", ")),await o(me),e()}catch(le){G.error("Error during username confirmation:",le),U({title:"Error",description:"An error occurred. Please try again.",status:"error",duration:3e3,isClosable:!0})}finally{D(!1)}},re=()=>{L||e()};return S.jsxs(_s,{isOpen:n,onClose:re,size:"md",portalProps:{containerRef:l},isCentered:!0,motionPreset:"slideInBottom",closeOnOverlayClick:!L,closeOnEsc:!L,children:[S.jsx(vs,{bg:"blackAlpha.800",backdropFilter:"blur(5px)"}),S.jsxs(ys,{bg:"gray.800",borderRadius:"xl",boxShadow:"xl",color:"white",maxW:"md",mx:4,position:"relative",children:[S.jsxs(Do,{children:[S.jsx(TR,{size:"lg",mb:2,children:"Customize Your Profile"}),S.jsx($e,{fontSize:"sm",color:"gray.400",children:"Set your username and nickname"})]}),S.jsx(Ns,{color:"gray.400",isDisabled:L}),S.jsx(Es,{children:S.jsxs(Qn,{spacing:6,align:"stretch",children:[S.jsxs(br,{isInvalid:!!R,children:[S.jsx(Ei,{children:"Username"}),S.jsxs($f,{children:[S.jsx(EN,{bg:"gray.700",color:"gray.400",border:"none",children:"@"}),S.jsx(ni,{placeholder:"username",value:u,onChange:le=>p(le.target.value.toLowerCase()),bg:"gray.700",border:"none",color:"white",_placeholder:{color:"gray.500"},_hover:{bg:"gray.600"},_focus:{bg:"gray.600",boxShadow:"0 0 0 1px var(--chakra-colors-blue-400)"},maxLength:15})]}),R?S.jsx(Ip,{children:R}):S.jsx(Xy,{color:"gray.400",children:"Lowercase letters and numbers only, max 15 characters"})]}),S.jsxs(br,{children:[S.jsx(Ei,{children:"Nickname"}),S.jsx(ni,{placeholder:"Nickname",value:y,onChange:le=>E(le.target.value),bg:"gray.700",border:"none",color:"white",_placeholder:{color:"gray.500"},_hover:{bg:"gray.600"},_focus:{bg:"gray.600",boxShadow:"0 0 0 1px var(--chakra-colors-blue-400)"},maxLength:15}),S.jsx(Xy,{color:"gray.400",children:"This is the name shown to others, max 15 characters"})]})]})}),S.jsx(vh,{children:S.jsxs(Mr,{gap:3,width:"100%",children:[S.jsx(On,{variant:"outline",onClick:re,flex:"1",isDisabled:L,children:"Back"}),S.jsx(On,{colorScheme:"blue",onClick:W,isLoading:L||b,isDisabled:!!R||!u||L,flex:"2",children:"Finish"})]})})]})]})};Vae.propTypes={isOpen:An.bool.isRequired,onClose:An.func.isRequired,userData:An.object.isRequired,onConfirm:An.func.isRequired,fullscreenRef:An.object};const C9e="6Le4oQUrAAAAAHe0GMH5Z0tpuqTV2qqDzK9Yk4Uv";function mx({mode:n,label:e,buttonProps:i={},isOpen:o,onClose:l}){const{register:u,handleSubmit:p,formState:{errors:y}}=Mae(),{register:E}=k.useContext(Di),b=ea(),{fullscreenRef:T}=Ch(),[R,O]=k.useState(!1),[L,D]=k.useState(!1),[U,F]=k.useState(null),Y=k.useRef(null),[W,re]=k.useState(!1),[le,ie]=k.useState(null),[me,q]=k.useState(!1),J=o!==void 0?o:R,Q=l||(()=>O(!1));fx(J||W),k.useEffect(()=>{!J&&Y.current&&(Y.current.reset(),F(null))},[J]);const ne=Ie=>{F(Ie)},he=async Ie=>{G.log("Register.jsx: Processing registration form submission");const{email:Fe,password:we,confirmPassword:Re,...Te}=Ie;if(G.log("Register.jsx: Registration data fields:",Object.keys(Te).join(", ")),!U){b({title:"Verification Required",description:"Please complete the reCAPTCHA verification.",status:"error",duration:3e3,isClosable:!0,position:"top"});return}if(we!==Re){b({title:"Error",description:"Passwords do not match.",status:"error",duration:3e3,isClosable:!0,position:"top"});return}ud(Te.firstName),ud(Te.lastName),ud(Te.companyName),D(!0);try{const Ne=await ZBe(Te.firstName||"",Te.lastName||""),be=Te.firstName&&Te.lastName?`${Te.firstName}${Te.lastName.charAt(0).toUpperCase()}`:"";be&&ud(be),G.log("Register.jsx: Generated username and nickname for new user");const xe={...Te,firstName:Te.firstName||"",lastName:Te.lastName||"",companyName:Te.companyName||"",linkedInProfile:Te.linkedInProfile||"",email:Fe,password:we,username:Ne,Nickname:be,captchaToken:U};G.log("Register.jsx: Prepared registration data with fields:",Object.keys(xe).join(", ")),ie(xe),re(!0)}catch(Ne){G.error("User: Registration Error:",Ne);let be="An error occurred during registration. Please try again.",xe=!1;Ne.code==="auth/email-already-in-use"?(be="This email address is already registered. Please sign in instead.",xe=!0):Ne.code==="auth/invalid-email"?be="The email address is not valid. Please check and try again.":Ne.code==="auth/weak-password"?be="The password is too weak. Please choose a stronger password.":Ne.message&&(be=Ne.message),b({title:"Registration Failed",description:S.jsxs(S.Fragment,{children:[be,xe&&S.jsx($e,{mt:2,children:S.jsx(hu,{color:"blue.400",onClick:()=>{Q(),window.dispatchEvent(new CustomEvent("openSignInModal"))},children:"Go to Sign In"})})]}),status:"error",duration:5e3,isClosable:!0,position:"top"})}finally{D(!1),Y.current&&Y.current.reset()}},de=async Ie=>{D(!0);try{G.log("Register.jsx: Completing registration with confirmed username");const{email:Fe,password:we,...Re}=Ie,Te={...Re,firstName:Re.firstName||"",lastName:Re.lastName||"",companyName:Re.companyName||"",linkedInProfile:Re.linkedInProfile||"",username:Re.username||"",Nickname:Re.Nickname||""};G.log("Register.jsx: Final registration data includes fields:",Object.keys(Te).join(", "));const Ne=await E(Fe,we,Te);Q(),re(!1),G.log("User: Registration process complete."),b({title:"Registration Successful",description:"Please check your email for a verification link. You'll need to verify your email before signing in.",status:"success",duration:8e3,isClosable:!0,position:"top"}),ie(null),q(!1)}catch(Fe){G.error("User: Registration Error during final step:",Fe);let we="An error occurred during registration. Please try again.";Fe.code==="auth/email-already-in-use"?we="This email address is already in use. Please try another one.":Fe.message&&(we=Fe.message),b({title:"Registration Failed",description:we,status:"error",duration:5e3,isClosable:!0,position:"top"}),re(!1),ie(null),q(!1)}finally{D(!1)}},pe=()=>{l?l():O(!R)},Se=n==="link"?S.jsx(hu,{variant:"header",onClick:pe,children:e}):S.jsx(On,{onClick:pe,...i,children:e});return S.jsxs(S.Fragment,{children:[!o&&Se,S.jsxs(_s,{isOpen:J&&!W,onClose:Q,size:"md",portalProps:{containerRef:T},isCentered:!0,motionPreset:"slideInBottom",blockScrollOnMount:!1,children:[S.jsx(vs,{bg:"blackAlpha.800",backdropFilter:"blur(5px)"}),S.jsxs(ys,{bg:"gray.800",borderRadius:"xl",boxShadow:"xl",color:"white",maxW:"md",mx:4,position:"relative",zIndex:9999,sx:{isolation:"isolate","& input":{position:"relative",zIndex:1e4,isolation:"isolate"},"& *":{pointerEvents:"auto !important"}},onKeyDown:Ie=>{Ie.stopPropagation()},children:[S.jsxs(Do,{p:8,textAlign:"center",children:[S.jsx(TR,{size:"lg",mb:2,color:"white",children:"Create Account"}),S.jsx($e,{fontSize:"sm",color:"gray.400",children:"Fill in your details to get started"})]}),S.jsx(Ns,{color:"white",bg:"rgba(255,255,255,0.1)",_hover:{color:"gray.400",bg:"transparent"},borderRadius:"full",size:"sm",top:2,right:3}),S.jsx(Es,{px:8,children:S.jsx("form",{onSubmit:p(he),children:S.jsxs(Qn,{spacing:4,children:[S.jsxs(br,{isInvalid:y.companyName,isRequired:!0,children:[S.jsx(ni,{placeholder:"Company Name",bg:"gray.700",border:"none",color:"white",_placeholder:{color:"gray.500"},_hover:{bg:"gray.600"},_focus:{bg:"gray.600",boxShadow:"0 0 0 1px var(--chakra-colors-blue-400)"},...u("companyName",{required:"Company name is required",setValueAs:Ie=>Ie===""?"":Ie})}),S.jsx(Ip,{children:y.companyName&&y.companyName.message})]}),S.jsxs(Mr,{gap:4,w:"100%",children:[S.jsxs(br,{isInvalid:y.firstName,isRequired:!0,children:[S.jsx(ni,{placeholder:"First Name",bg:"gray.700",border:"none",color:"white",_placeholder:{color:"gray.500"},_hover:{bg:"gray.600"},_focus:{bg:"gray.600",boxShadow:"0 0 0 1px var(--chakra-colors-blue-400)"},...u("firstName",{required:"First name is required",setValueAs:Ie=>Ie===""?"":Ie})}),S.jsx(Ip,{children:y.firstName&&y.firstName.message})]}),S.jsxs(br,{isInvalid:y.lastName,isRequired:!0,children:[S.jsx(ni,{placeholder:"Last Name",bg:"gray.700",border:"none",color:"white",_placeholder:{color:"gray.500"},_hover:{bg:"gray.600"},_focus:{bg:"gray.600",boxShadow:"0 0 0 1px var(--chakra-colors-blue-400)"},...u("lastName",{required:"Last name is required",setValueAs:Ie=>Ie===""?"":Ie})}),S.jsx(Ip,{children:y.lastName&&y.lastName.message})]})]}),S.jsxs(br,{isInvalid:y.email,isRequired:!0,children:[S.jsx(ni,{type:"email",placeholder:"Work Email Address",bg:"gray.700",border:"none",color:"white",_placeholder:{color:"gray.500"},_hover:{bg:"gray.600"},_focus:{bg:"gray.600",boxShadow:"0 0 0 1px var(--chakra-colors-blue-400)"},...u("email",{required:"Email is required",pattern:{value:/^[^@ \t\r\n]+@[^@ \t\r\n]+\.[^@ \t\r\n]+$/,message:"Invalid email address"}})}),S.jsx(Ip,{children:y.email&&y.email.message})]}),S.jsxs(Mr,{gap:4,w:"100%",children:[S.jsxs(br,{isInvalid:y.password,isRequired:!0,children:[S.jsx(ni,{type:"password",placeholder:"Password",bg:"gray.700",border:"none",color:"white",_placeholder:{color:"gray.500"},_hover:{bg:"gray.600"},_focus:{bg:"gray.600",boxShadow:"0 0 0 1px var(--chakra-colors-blue-400)"},...u("password",{required:"Password is required",minLength:{value:8,message:"Password must be at least 8 characters long"}})}),S.jsx(Ip,{children:y.password&&y.password.message})]}),S.jsxs(br,{isInvalid:y.confirmPassword,isRequired:!0,children:[S.jsx(ni,{type:"password",placeholder:"Confirm Password",bg:"gray.700",border:"none",color:"white",_placeholder:{color:"gray.500"},_hover:{bg:"gray.600"},_focus:{bg:"gray.600",boxShadow:"0 0 0 1px var(--chakra-colors-blue-400)"},...u("confirmPassword",{required:"Confirm password is required"})}),S.jsx(Ip,{children:y.confirmPassword&&y.confirmPassword.message})]})]}),S.jsx(br,{children:S.jsx(ni,{placeholder:"LinkedIn Profile (optional)",bg:"gray.700",border:"none",color:"white",_placeholder:{color:"gray.500"},_hover:{bg:"gray.600"},_focus:{bg:"gray.600",boxShadow:"0 0 0 1px var(--chakra-colors-blue-400)"},...u("linkedInProfile",{setValueAs:Ie=>Ie===""?"":Ie})})}),S.jsx(He,{width:"100%",display:"flex",justifyContent:"center",my:4,children:S.jsx(Uae,{ref:Y,sitekey:C9e,onChange:ne,theme:"dark"})})]})})}),S.jsxs(vh,{px:8,pb:8,flexDirection:"column",gap:4,children:[S.jsx(On,{type:"submit",colorScheme:"blue",size:"lg",width:"100%",onClick:p(he),isLoading:L,loadingText:"Processing",isDisabled:!U,children:"Next: Set Your Username"}),S.jsxs($e,{fontSize:"sm",color:"gray.400",textAlign:"center",children:["Already have an account?"," ",S.jsx(hu,{color:"blue.400",onClick:()=>{Q(),window.dispatchEvent(new CustomEvent("openSignInModal"))},children:"Sign In"})]})]})]})]}),W&&S.jsx(Vae,{isOpen:W,onClose:()=>re(!1),userData:le,onConfirm:de,fullscreenRef:T,isRegistering:me})]})}mx.propTypes={mode:An.oneOf(["button","link"]),label:An.string,buttonProps:An.object,isOpen:An.bool,onClose:An.func};const R9e="6Le4oQUrAAAAAHe0GMH5Z0tpuqTV2qqDzK9Yk4Uv";function ib({mode:n="button",label:e="Sign In",buttonProps:i={},initialIsOpen:o=!1}){const{signIn:l,createGuestUser:u}=k.useContext(Di),{fullscreenRef:p}=Ch(),y=ea(),{register:E,handleSubmit:b,formState:{errors:T}}=Mae(),[R,O]=k.useState(!1),[L,D]=k.useState(o),[U,F]=k.useState(!1),[Y,W]=k.useState(!1),[re,le]=k.useState(""),[ie,me]=k.useState(!1),[q,J]=k.useState(null),[Q,ne]=k.useState(!1),[he,de]=k.useState(!1),pe=k.useRef(null);fx(L||Y),k.useEffect(()=>{L&&(async()=>{try{const nt=window.location.pathname.match(/\/(w|embed)\/([^\/]+)/);if(nt){const dt=nt[2],ft=await _o(dt);ne((ft==null?void 0:ft.allowGuestUsers)||!1)}}catch(je){G.error("SignIn: Error checking guest access:",je),ne(!1)}})()},[L]),k.useEffect(()=>{const xe=()=>{D(!0)};return window.addEventListener("openSignInModal",xe),()=>{window.removeEventListener("openSignInModal",xe)}},[]);const Se=xe=>{J(xe)},Ie=async xe=>{if(!q){y({title:"Verification Required",description:"Please complete the reCAPTCHA verification.",status:"error",duration:3e3,isClosable:!0,position:"top"});return}O(!0);try{await l(xe.email,xe.password,q),G.log("User: Sign-in process complete."),D(!1),window.location.reload()}catch(je){G.error("User: SignIn Error:",je);const nt=je.message||"An error occurred while logging in. Please check your credentials.",dt=nt.includes("verify your email");y({title:dt?"Email Verification Required":"Error",description:nt,status:dt?"warning":"error",duration:1e4,isClosable:!0,position:"top",container:p.current})}finally{O(!1),pe.current&&pe.current.reset()}},Fe=async()=>{if(!re){y({title:"Email Required",description:"Please enter your email address to reset your password.",status:"warning",duration:3e3,isClosable:!0,position:"top",container:p.current});return}try{me(!0),await nFe(F3,re),y({title:"Password Reset Email Sent",description:"Check your email for instructions to reset your password.",status:"success",duration:5e3,isClosable:!0,position:"top",container:p.current}),W(!1)}catch(xe){G.error("User: Reset Password Error:",xe),y({title:"Error",description:xe.message||"Failed to send password reset email. Please try again.",status:"error",duration:5e3,isClosable:!0,position:"top",container:p.current})}finally{me(!1)}},we=()=>D(xe=>!xe),Re=()=>{D(!1),F(!0)},Te=()=>{W(!0)},Ne=async()=>{try{de(!0);const je=window.location.pathname.match(/\/(w|embed)\/([^\/]+)/);if(je){const nt=je[2];await u(nt),y({title:"Welcome, Guest!",description:"You're now entering as a guest user.",status:"success",duration:3e3,isClosable:!0,position:"top",container:p.current}),D(!1),window.location.reload()}}catch(xe){G.error("SignIn: Error creating guest user:",xe),y({title:"Error",description:"Failed to create guest user. Please try again.",status:"error",duration:5e3,isClosable:!0,position:"top",container:p.current})}finally{de(!1)}},be=n==="link"?S.jsx(hu,{variant:"header",onClick:we,children:e}):S.jsx(On,{onClick:we,...i,children:e});return S.jsxs(S.Fragment,{children:[be,S.jsxs(_s,{isOpen:L,onClose:we,size:"md",portalProps:{containerRef:p},isCentered:!0,motionPreset:"slideInBottom",blockScrollOnMount:!1,children:[S.jsx(vs,{bg:"blackAlpha.800",backdropFilter:"blur(5px)"}),S.jsx("form",{onSubmit:b(Ie),children:S.jsxs(ys,{bg:"gray.800",borderRadius:"xl",boxShadow:"xl",color:"white",maxW:"md",mx:4,position:"relative",zIndex:9999,sx:{isolation:"isolate","& input":{position:"relative",zIndex:1e4,isolation:"isolate"},"& *":{pointerEvents:"auto !important"}},onKeyDown:xe=>{xe.stopPropagation()},children:[S.jsxs(Do,{p:8,textAlign:"center",children:[S.jsx(TR,{size:"lg",mb:2,color:"white",children:"Welcome Back"}),S.jsx($e,{fontSize:"sm",color:"gray.400",children:"Enter your credentials to access your account"})]}),S.jsx(Ns,{color:"white",bg:"rgba(255,255,255,0.1)",_hover:{color:"gray.400",bg:"transparent"},borderRadius:"full",size:"sm",top:2,right:3}),S.jsx(Es,{px:8,pb:8,children:S.jsxs(Qn,{spacing:4,children:[S.jsxs(br,{isInvalid:T.email,children:[S.jsxs($f,{children:[S.jsx(wS,{pointerEvents:"none",children:S.jsx(iZ,{color:"gray.500"})}),S.jsx(ni,{type:"email",placeholder:"Email",bg:"gray.700",border:"none",color:"white",_placeholder:{color:"gray.500"},_hover:{bg:"gray.600"},_focus:{bg:"gray.600",boxShadow:"0 0 0 1px var(--chakra-colors-blue-400)"},...E("email",{required:"Email is required."})})]}),S.jsx(Ip,{children:T.email&&T.email.message})]}),S.jsxs(br,{isInvalid:T.password,children:[S.jsxs($f,{children:[S.jsx(wS,{pointerEvents:"none",children:S.jsx(zze,{color:"gray.500"})}),S.jsx(ni,{type:"password",placeholder:"Password",bg:"gray.700",border:"none",color:"white",_placeholder:{color:"gray.500"},_hover:{bg:"gray.600"},_focus:{bg:"gray.600",boxShadow:"0 0 0 1px var(--chakra-colors-blue-400)"},...E("password",{required:"Password is required."})})]}),S.jsx(Ip,{children:T.password&&T.password.message})]}),S.jsx(He,{alignSelf:"flex-end",children:S.jsx(hu,{color:"blue.400",fontSize:"sm",onClick:Te,children:"Forgot Password?"})}),S.jsx(Mr,{width:"100%",justifyContent:"center",my:4,children:S.jsx(Uae,{ref:pe,sitekey:R9e,onChange:Se,theme:"dark"})})]})}),S.jsxs(vh,{px:8,pb:8,flexDirection:"column",gap:4,children:[S.jsx(On,{type:"submit",colorScheme:"blue",size:"lg",width:"100%",isLoading:R,loadingText:"Signing In",isDisabled:!q,children:"Sign In"}),Q&&S.jsx(On,{colorScheme:"gray",variant:"outline",size:"lg",width:"100%",onClick:Ne,isLoading:he,loadingText:"Creating Guest Account...",_hover:{bg:"gray.700"},children:"Continue as Guest"}),S.jsxs($e,{fontSize:"sm",color:"gray.400",textAlign:"center",children:["Don't have an account?"," ",S.jsx(hu,{color:"blue.400",onClick:Re,children:"Sign Up"})]})]})]})})]}),S.jsxs(_s,{isOpen:Y,onClose:()=>W(!1),size:"md",portalProps:{containerRef:p},isCentered:!0,motionPreset:"slideInBottom",blockScrollOnMount:!1,children:[S.jsx(vs,{bg:"blackAlpha.800",backdropFilter:"blur(5px)"}),S.jsxs(ys,{bg:"gray.800",borderRadius:"xl",boxShadow:"xl",color:"white",maxW:"md",mx:4,position:"relative",zIndex:9999,sx:{isolation:"isolate","& input":{position:"relative",zIndex:1e4,isolation:"isolate"},"& *":{pointerEvents:"auto !important"}},onKeyDown:xe=>{xe.stopPropagation()},children:[S.jsxs(Do,{p:8,textAlign:"center",children:[S.jsx(TR,{size:"lg",mb:2,color:"white",children:"Reset Password"}),S.jsx($e,{fontSize:"sm",color:"gray.400",children:"Enter your email to receive password reset instructions"})]}),S.jsx(Ns,{color:"white",bg:"rgba(255,255,255,0.1)",_hover:{color:"gray.400",bg:"transparent"},borderRadius:"full",size:"sm",top:2,right:3}),S.jsx(Es,{px:8,pb:4,children:S.jsx(br,{children:S.jsxs($f,{children:[S.jsx(wS,{pointerEvents:"none",children:S.jsx(iZ,{color:"gray.500"})}),S.jsx(ni,{type:"email",placeholder:"Email",bg:"gray.700",border:"none",color:"white",_placeholder:{color:"gray.500"},_hover:{bg:"gray.600"},_focus:{bg:"gray.600",boxShadow:"0 0 0 1px var(--chakra-colors-blue-400)"},value:re,onChange:xe=>le(xe.target.value)})]})})}),S.jsxs(vh,{px:8,pb:8,flexDirection:"column",gap:4,children:[S.jsx(On,{colorScheme:"blue",size:"lg",width:"100%",onClick:Fe,isLoading:ie,loadingText:"Sending",children:"Send Reset Link"}),S.jsxs($e,{fontSize:"sm",color:"gray.400",textAlign:"center",children:["Remember your password?"," ",S.jsx(hu,{color:"blue.400",onClick:()=>W(!1),children:"Back to Sign In"})]})]})]})]}),S.jsx(mx,{mode:"link",isOpen:U,onClose:()=>F(!1)})]})}ib.propTypes={mode:An.oneOf(["button","link"]),label:An.string,buttonProps:An.object,initialIsOpen:An.bool};function t4({mode:n="button",label:e="Sign Out"}){const i=ea(),{signOut:o}=k.useContext(Di),{fullscreenRef:l}=Ch(),u=async()=>{try{await o(),i({title:"Logged Out",description:"You have been successfully logged out.",status:"success",duration:3e3,isClosable:!0,position:"top",container:l.current}),window.location.href="/"}catch(y){console.error("SignOut Error:",y),i({title:"Error",description:"An error occurred while logging out.",status:"error",duration:3e3,isClosable:!0,position:"top",container:l.current})}},p=n==="link"?S.jsx(hu,{variant:"header",onClick:u,style:{cursor:"pointer"},children:e}):null;return S.jsx(S.Fragment,{children:p})}t4.propTypes={mode:An.oneOf(["button","link"]),label:An.string};const sb=()=>window.unityInstance||window.gameInstance||window.reactUnityInstance,n4=()=>{document.body.classList.add("unity-focused");const n=["ArrowUp","ArrowDown","ArrowLeft","ArrowRight","Space","PageUp","PageDown","Home","End"],e=o=>{if(n.includes(o.key)){const l=o.target.tagName==="INPUT"||o.target.tagName==="TEXTAREA"||o.target.isContentEditable,u=document.querySelector("canvas")||document.getElementById("unity-canvas"),p=o.target.closest("canvas")||o.target.closest("#webgl-root"),y=document.activeElement===u;!l&&(p||y)&&o.preventDefault()}},i=o=>{document.querySelector("canvas")||document.getElementById("unity-canvas"),document.getElementById("unity-container")||document.getElementById("webgl-root"),o.target.closest("canvas")||o.target.closest("#webgl-root")?document.body.classList.add("unity-focused"):document.body.classList.remove("unity-focused")};return document.addEventListener("keydown",e),document.addEventListener("click",i),()=>{document.body.classList.remove("unity-focused"),document.removeEventListener("keydown",e),document.removeEventListener("click",i)}},jae=()=>{document.body.classList.remove("unity-focused")};function Jk(n){return n?(document.body.classList.add("unity-focused"),window.unityKeyboardEnabled=!0):(document.body.classList.remove("unity-focused"),window.unityKeyboardEnabled=!1),n?n4():jae(),new Promise(e=>{try{const i=sb();if(i){try{n?i.SendMessage("WebGLInput","EnableKeyboardCapture"):i.SendMessage("WebGLInput","DisableKeyboardCapture"),e(!0);return}catch{}try{i.SendMessage("WebGLInput","SetCaptureAllKeyboardInput",n),e(!0);return}catch{}if(i.Module){!n&&i.Module.WebGLInputHandler&&!window._originalWebGLInputHandler&&(window._originalWebGLInputHandler=i.Module.WebGLInputHandler),n&&window._originalWebGLInputHandler?(i.Module.WebGLInputHandler=window._originalWebGLInputHandler,window._originalWebGLInputHandler=null):n||(i.Module.WebGLInputHandler=null),e(!0);return}}else window.__pendingKeyboardCaptureState=n,document.getElementById("webgl-root")&&rj(n),e(!0)}catch(i){console.error("Error setting Unity keyboard capture:",i),e(!1)}})}function rj(n){window.__unityInstancePoller&&clearTimeout(window.__unityInstancePoller);const e=20;let i=0;const o=()=>{i++;const l=sb();if(l)try{n?l.SendMessage("WebGLInput","EnableKeyboardCapture"):l.SendMessage("WebGLInput","DisableKeyboardCapture"),window.__pendingKeyboardCaptureState=null}catch{try{l.SendMessage("WebGLInput","SetCaptureAllKeyboardInput",n),window.__pendingKeyboardCaptureState=null}catch(p){console.error("Unity keyboard: Failed to apply keyboard state",p)}}else if(i<e){const u=Math.min(500*Math.pow(1.2,i),5e3);window.__unityInstancePoller=setTimeout(o,u)}else window.__pendingKeyboardCaptureState=null};window.__unityInstancePoller=setTimeout(o,500)}function I9e(){const n=sb();if(!n)return!1;const e=document.querySelector("canvas")||document.getElementById("unity-canvas");return!!(e&&document.activeElement===e||n.Module&&n.Module.WebGLInputHandler)}function By(n=!0){return n?n4():jae(),new Promise(e=>{try{const i=document.querySelector("canvas")||document.getElementById("unity-canvas");if(i){try{i.focus({preventScroll:!0})}catch{i.focus()}if(i.style.pointerEvents="auto",n){Jk(!0).then(e);return}e(!0)}else e(!1)}catch(i){console.error("Error focusing Unity canvas:",i),e(!1)}})}function hd(n=!0){return n4(),new Promise(e=>{try{if(n)Jk(!1).then(i=>{var u;const o=document.querySelector("canvas")||document.getElementById("unity-canvas");o&&(o.blur(),o.style.pointerEvents="none"),window.__keyEventHandler||(window.__keyEventHandler=p=>{window.__blockKeyboardInput&&!["INPUT","TEXTAREA","SELECT"].includes(p.target.tagName)&&p.stopPropagation()},document.addEventListener("keydown",window.__keyEventHandler,!0),document.addEventListener("keyup",window.__keyEventHandler,!0),document.addEventListener("keypress",window.__keyEventHandler,!0)),window.__blockKeyboardInput=!0;const l=sb();(u=l==null?void 0:l.Module)!=null&&u.WebGLInputHandler&&(window._savedWebGLInputHandler=l.Module.WebGLInputHandler,l.Module.WebGLInputHandler=null),e(!0)});else{window.__blockKeyboardInput=!1,window.__keyEventHandler&&(document.removeEventListener("keydown",window.__keyEventHandler,!0),document.removeEventListener("keyup",window.__keyEventHandler,!0),document.removeEventListener("keypress",window.__keyEventHandler,!0),window.__keyEventHandler=null);const i=sb();i!=null&&i.Module&&window._savedWebGLInputHandler&&(i.Module.WebGLInputHandler=window._savedWebGLInputHandler,window._savedWebGLInputHandler=null);const o=document.querySelector("canvas")||document.getElementById("unity-canvas");o&&(o.style.pointerEvents="auto"),Jk(!0).then(()=>{e(!0)})}}catch(i){console.error("Error in blockUnityKeyboardInput:",i),e(!1)}})}function A9e(n){if(n){if(window.unityInstance=n,typeof window.__pendingKeyboardCaptureState=="boolean")try{const e=window.__pendingKeyboardCaptureState;try{e?n.SendMessage("WebGLInput","EnableKeyboardCapture"):n.SendMessage("WebGLInput","DisableKeyboardCapture"),window.__pendingKeyboardCaptureState=null}catch{try{n.SendMessage("WebGLInput","SetCaptureAllKeyboardInput",e),window.__pendingKeyboardCaptureState=null}catch(o){console.error("Unity keyboard: Failed to apply keyboard state",o)}}}catch(e){console.error("Unity keyboard: Error applying keyboard state:",e)}window.__unityInstancePoller&&(clearTimeout(window.__unityInstancePoller),window.__unityInstancePoller=null)}}function P9e(){if(window.setUnityKeyboardCapture=Jk,window.focusUnity=By,window.blockUnityKeyboardInput=hd,window.hasUnityKeyboardFocus=I9e,window.getUnityInstance=sb,window.registerUnityInstance=A9e,document.getElementById("webgl-root")){const n=new MutationObserver(e=>{for(const i of e)if(i.addedNodes.length)for(let o=0;o<i.addedNodes.length;o++){const l=i.addedNodes[o];if(l.nodeName==="CANVAS"||l.querySelector&&l.querySelector("canvas")){rj(!0),n.disconnect();break}}});n.observe(document.body,{childList:!0,subtree:!0}),document.querySelector("canvas")&&rj(!0)}if(typeof window<"u"&&typeof require=="function")try{const n=require("react");window.useUnityKeyboardFocus=function(){const[i,o]=n.useState(!1);return n.useEffect(()=>(i?(hd(!0),window.dispatchEvent(new CustomEvent("modal-opened"))):(hd(!1),window.dispatchEvent(new CustomEvent("modal-closed"))),()=>{i&&(hd(!1),window.dispatchEvent(new CustomEvent("modal-closed")))}),[i]),[i,o]}}catch{}}typeof window<"u"&&setTimeout(P9e,0);const O9e=({isOpen:n,onClose:e,user:i,profileImageUrl:o})=>{const[l,u]=k.useState(!1),[p,y]=k.useState({Nickname:(i==null?void 0:i.Nickname)||"",username:(i==null?void 0:i.username)||"",companyName:(i==null?void 0:i.companyName)||"",firstName:(i==null?void 0:i.firstName)||"",lastName:(i==null?void 0:i.lastName)||"",linkedInProfile:(i==null?void 0:i.linkedInProfile)||""}),[E,b]=k.useState(!1),[T,R]=k.useState(!1),[O,L]=k.useState(""),[D,U]=k.useState(!1),F=ea(),{sendUserToUnity:Y,updateUser:W}=k.useContext(Di),re=k.useRef(null);k.useEffect(()=>{y({Nickname:(i==null?void 0:i.Nickname)||"",username:(i==null?void 0:i.username)||"",companyName:(i==null?void 0:i.companyName)||"",firstName:(i==null?void 0:i.firstName)||"",lastName:(i==null?void 0:i.lastName)||"",linkedInProfile:(i==null?void 0:i.linkedInProfile)||""})},[i]),k.useEffect(()=>(n?(hd(!0),window.dispatchEvent(new CustomEvent("modal-opened"))):(hd(!1).then(()=>{setTimeout(()=>{By(!0)},100)}),window.dispatchEvent(new CustomEvent("modal-closed"))),()=>{n&&(hd(!1),window.dispatchEvent(new CustomEvent("modal-closed")))}),[n]),k.useEffect(()=>{if(l&&re.current){const Q=()=>{re.current.focus(),R(!0),hd(!0)};Q();const ne=setTimeout(Q,100),he=setTimeout(Q,300);return()=>{clearTimeout(ne),clearTimeout(he)}}else R(!1)},[l]),k.useEffect(()=>{const ne=setTimeout(async()=>{if(p.username&&p.username!==(i==null?void 0:i.username)){U(!0),L("");try{if(!/^[a-z0-9]{1,15}$/.test(p.username)){L("Username must be 1-15 characters, lowercase letters and numbers only"),U(!1);return}ud(p.username),await DR(p.username)&&L("Username is already taken")}catch(he){G.error("Error checking username:",he),L("Error checking username availability")}finally{U(!1)}}},500);return()=>clearTimeout(ne)},[p.username,i==null?void 0:i.username]);const le=()=>{u(!1),R(!1),e()},ie=Q=>{const{name:ne,value:he}=Q.target;if(ne==="username"){const de=he.toLowerCase().replace(/[^a-z0-9]/g,"");y(pe=>({...pe,[ne]:de}))}else y(de=>({...de,[ne]:he}))},me=async()=>{if(p.Nickname.trim()===""){F({title:"Error",description:"Display Name cannot be empty",status:"error",duration:3e3,isClosable:!0});return}if(ud(p.Nickname),p.firstName&&ud(p.firstName),p.lastName&&ud(p.lastName),p.companyName&&ud(p.companyName),O){F({title:"Error",description:O,status:"error",duration:3e3,isClosable:!0});return}b(!0);try{if(p.username!==i.username&&(ud(p.username),await DR(p.username))){L("Username is already taken"),F({title:"Error",description:"Username is already taken",status:"error",duration:3e3,isClosable:!0}),b(!1);return}const Q=dr(Fn,"users",i.uid);if(p.username!==i.username)try{if(G.log("ProfileModal: Updating username from",i.username,"to",p.username),!await n8e(i.uid,p.username))throw new Error("Failed to update username");G.log("ProfileModal: Username updated successfully")}catch(ne){G.error("Error updating username:",ne),F({title:"Error",description:"Failed to update username: "+(ne.message||"Please try again"),status:"error",duration:3e3,isClosable:!0}),b(!1);return}G.log("ProfileModal: Updating user profile");try{const ne={Nickname:p.Nickname,companyName:p.companyName,firstName:p.firstName,lastName:p.lastName,linkedInProfile:p.linkedInProfile,username:p.username,lastUpdated:new Date().toISOString()};await qs(Q,ne),G.log("ProfileModal: Profile updated successfully");const he=ox(Q,de=>{if(de.exists()&&de.data().Nickname===p.Nickname){try{Y()}catch(Se){G.error("Error sending user to Unity:",Se)}he()}},de=>{G.error("Error in profile update listener:",de)});try{await W()}catch(de){G.error("Error updating user context:",de)}y({Nickname:p.Nickname,username:p.username,companyName:p.companyName,firstName:p.firstName,lastName:p.lastName,linkedInProfile:p.linkedInProfile}),F({title:"Success",description:"Profile updated successfully",status:"success",duration:3e3,isClosable:!0}),u(!1)}catch(ne){G.error("Error updating profile data:",ne),F({title:"Error",description:"Failed to update profile: "+(ne.message||"Please try again"),status:"error",duration:3e3,isClosable:!0})}}catch(Q){G.error("Error in handleSave:",Q),F({title:"Error",description:"An unexpected error occurred: "+(Q.message||"Please try again"),status:"error",duration:3e3,isClosable:!0})}finally{b(!1)}},q=()=>S.jsxs(Qn,{spacing:4,align:"stretch",w:"100%",children:[S.jsxs(Mr,{direction:"column",align:"center",gap:2,children:[S.jsx($e,{fontSize:"2xl",fontWeight:"bold",children:i.Nickname}),S.jsxs($e,{fontSize:"md",color:"gray.400",children:["@",i.username]})]}),S.jsxs(Qn,{spacing:3,align:"stretch",bg:"gray.700",p:4,borderRadius:"md",children:[S.jsxs(Mr,{direction:"column",children:[S.jsx($e,{color:"gray.400",fontSize:"sm",children:"Company"}),S.jsx($e,{children:i.companyName||"Not specified"})]}),S.jsxs(Mr,{direction:"column",children:[S.jsx($e,{color:"gray.400",fontSize:"sm",children:"Full Name"}),S.jsx($e,{children:`${i.firstName||""} ${i.lastName||""}`.trim()||"Not specified"})]}),S.jsxs(Mr,{direction:"column",children:[S.jsx($e,{color:"gray.400",fontSize:"sm",children:"LinkedIn"}),S.jsx($e,{children:i.linkedInProfile||"Not specified"})]})]}),S.jsx(On,{onClick:()=>u(!0),size:"sm",variant:"outline",_hover:{bg:"gray.700"},color:"white",borderColor:"gray.600",children:"Edit Profile"})]}),J=()=>S.jsxs(Qn,{spacing:4,align:"stretch",w:"100%",children:[S.jsxs(br,{children:[S.jsx(Ei,{color:"gray.400",fontSize:"sm",children:"Display Name"}),S.jsx(ni,{ref:re,name:"Nickname",value:p.Nickname,onChange:ie,onFocus:()=>{R(!0),hd(!0)},placeholder:"Enter display name",bg:"gray.700",border:"none",color:"white",_placeholder:{color:"gray.500"},_hover:{bg:"gray.600"},_focus:{bg:"gray.600",boxShadow:"0 0 0 1px var(--chakra-colors-blue-400)"},maxLength:15})]}),S.jsxs(br,{isInvalid:!!O,children:[S.jsx(Ei,{color:"gray.400",fontSize:"sm",children:"Username"}),S.jsxs($f,{children:[S.jsx(EN,{bg:"gray.700",color:"gray.400",border:"none",children:"@"}),S.jsx(ni,{name:"username",value:p.username,onChange:ie,placeholder:"username",bg:"gray.700",border:"none",color:"white",_placeholder:{color:"gray.500"},_hover:{bg:"gray.600"},_focus:{bg:"gray.600",boxShadow:"0 0 0 1px var(--chakra-colors-blue-400)"},maxLength:15,isDisabled:D})]}),O&&S.jsx($e,{color:"red.400",fontSize:"sm",mt:1,children:O}),S.jsx(Xy,{color:"gray.400",children:"Lowercase letters and numbers only, max 15 characters"})]}),S.jsxs(br,{children:[S.jsx(Ei,{color:"gray.400",fontSize:"sm",children:"Company Name"}),S.jsx(ni,{name:"companyName",value:p.companyName,onChange:ie,placeholder:"Enter company name",bg:"gray.700",border:"none",color:"white",_placeholder:{color:"gray.500"},_hover:{bg:"gray.600"},_focus:{bg:"gray.600",boxShadow:"0 0 0 1px var(--chakra-colors-blue-400)"}})]}),S.jsxs(Mr,{gap:4,children:[S.jsxs(br,{children:[S.jsx(Ei,{color:"gray.400",fontSize:"sm",children:"First Name"}),S.jsx(ni,{name:"firstName",value:p.firstName,onChange:ie,placeholder:"Enter first name",bg:"gray.700",border:"none",color:"white",_placeholder:{color:"gray.500"},_hover:{bg:"gray.600"},_focus:{bg:"gray.600",boxShadow:"0 0 0 1px var(--chakra-colors-blue-400)"}})]}),S.jsxs(br,{children:[S.jsx(Ei,{color:"gray.400",fontSize:"sm",children:"Last Name"}),S.jsx(ni,{name:"lastName",value:p.lastName,onChange:ie,placeholder:"Enter last name",bg:"gray.700",border:"none",color:"white",_placeholder:{color:"gray.500"},_hover:{bg:"gray.600"},_focus:{bg:"gray.600",boxShadow:"0 0 0 1px var(--chakra-colors-blue-400)"}})]})]}),S.jsxs(br,{children:[S.jsx(Ei,{color:"gray.400",fontSize:"sm",children:"LinkedIn Profile"}),S.jsx(ni,{name:"linkedInProfile",value:p.linkedInProfile,onChange:ie,placeholder:"Enter LinkedIn profile URL",bg:"gray.700",border:"none",color:"white",_placeholder:{color:"gray.500"},_hover:{bg:"gray.600"},_focus:{bg:"gray.600",boxShadow:"0 0 0 1px var(--chakra-colors-blue-400)"}})]}),S.jsxs(Mr,{gap:2,justify:"flex-end",mt:2,children:[S.jsx(On,{onClick:()=>{y({Nickname:(i==null?void 0:i.Nickname)||"",username:(i==null?void 0:i.username)||"",companyName:(i==null?void 0:i.companyName)||"",firstName:(i==null?void 0:i.firstName)||"",lastName:(i==null?void 0:i.lastName)||"",linkedInProfile:(i==null?void 0:i.linkedInProfile)||""}),u(!1),L("")},variant:"outline",size:"sm",isDisabled:E,color:"white",borderColor:"gray.600",_hover:{bg:"gray.700"},children:"Cancel"}),S.jsx(On,{onClick:me,colorScheme:"blue",size:"sm",isLoading:E||D,isDisabled:!!O||D,children:"Save Changes"})]})]});return S.jsxs(_s,{isOpen:n,onClose:le,isCentered:!0,closeOnOverlayClick:!l,trapFocus:!0,blockScrollOnMount:!1,size:"md",children:[S.jsx(vs,{bg:"rgba(0, 0, 0, 0.8)",backdropFilter:"blur(8px)"}),S.jsxs(ys,{bg:"#1a1a1a",color:"white",borderRadius:"xl",border:"1px solid #333",children:[S.jsx(Do,{fontSize:"md",fontWeight:"600",pb:1,pt:3,px:4,color:"white",children:"Profile"}),S.jsx(Ns,{color:"white",bg:"rgba(255,255,255,0.1)",_hover:{color:"gray.400",bg:"transparent"},borderRadius:"full",size:"sm",top:2,right:3}),S.jsx(Es,{pb:6,children:S.jsxs(Qn,{spacing:6,children:[S.jsx(jc,{src:o,size:"2xl",borderRadius:"full"}),l?J():q(),!l&&S.jsx(On,{variant:"ghost",size:"sm",colorScheme:"blue",width:"100%",onClick:()=>window.open("https://support.spacesmetaverse.com/","_blank"),children:"Visit Support Site"})]})})]})]})},CO={bg:"white",color:"black",borderRadius:"full",px:"6",py:"2",height:"auto",fontSize:"md",fontWeight:"medium",_hover:{bg:"gray.100"},display:"flex",alignItems:"center",gap:2},k9e=()=>{var T;const{user:n,updateUser:e}=k.useContext(Di),[i,o]=k.useState(!0),{isOpen:l,onOpen:u,onClose:p}=yu();k.useEffect(()=>{const R=setTimeout(()=>{o(!1)},500);return()=>clearTimeout(R)},[]);const y=()=>{p(),e()},E=n!=null&&n.rpmURL?n.rpmURL.replace(".glb",".png?scene=fullbody-portrait-closeupfront&w=640&q=75"):null,b=(T=n==null?void 0:n.groups)==null?void 0:T.includes("disruptiveAdmin");return i?null:S.jsx(Mr,{align:"center",gap:"4",children:n?S.jsxs(S.Fragment,{children:[S.jsx(O9e,{isOpen:l,onClose:y,user:n,profileImageUrl:E}),S.jsxs(SE,{children:[S.jsx(bE,{as:He,cursor:"pointer",children:S.jsx(Mr,{align:"center",height:"40px",px:4,borderRadius:"full",border:"1px solid rgba(255, 255, 255, 0.3)",transition:"all 0.2s",sx:{"&:hover":{border:"2px solid white"}},children:S.jsxs(Mr,{align:"center",gap:"3",children:[S.jsx(He,{width:"28px",height:"28px",borderRadius:"full",overflow:"hidden",bg:"white",display:"flex",alignItems:"center",justifyContent:"center",children:S.jsx(jc,{src:E,width:"100%",height:"100%",borderRadius:"full"})}),S.jsx($e,{color:"white",fontWeight:"medium",children:n.Nickname}),S.jsx(He,{display:"flex",alignItems:"center",height:"28px",children:S.jsx(Aae,{color:"white",w:4,h:4})})]})})}),S.jsx(Bc,{children:S.jsxs(wE,{bg:"gray.800",borderColor:"gray.700",zIndex:9999,children:[S.jsxs(He,{p:4,display:"flex",alignItems:"center",gap:3,children:[S.jsx(jc,{src:E,size:"md",borderRadius:"full"}),S.jsx($e,{fontSize:"xl",fontWeight:"bold",color:"white",children:n.Nickname})]}),S.jsx(cE,{borderColor:"gray.700"}),b&&S.jsx(fh,{as:"a",href:"/myadmin",_hover:{bg:"gray.700"},color:"white",bg:"gray.800",children:"My Admin"}),S.jsx(fh,{_hover:{bg:"gray.700"},color:"white",bg:"gray.800",children:"My Spaces"}),S.jsx(fh,{onClick:u,_hover:{bg:"gray.700"},color:"white",bg:"gray.800",children:"View Profile"}),S.jsx(cE,{borderColor:"gray.700"}),S.jsx(fh,{_hover:{bg:"gray.700"},color:"white",bg:"gray.800",children:"Support"}),S.jsx(fh,{_hover:{bg:"gray.700"},color:"white",bg:"gray.800",children:S.jsx(t4,{mode:"link",label:"Log out",linkProps:{color:"white",_hover:{textDecoration:"none"}}})})]})})]})]}):S.jsxs(S.Fragment,{children:[S.jsx(mx,{mode:"button",label:"Register",buttonProps:{...CO,width:["100%","auto"]},customButton:S.jsxs(On,{...CO,children:[S.jsx(He,{as:"span",fontSize:"xl",children:""}),"Register"]})}),S.jsx(ib,{mode:"button",label:"Sign In",buttonProps:{...CO,width:["100%","auto"]},customButton:S.jsxs(On,{...CO,children:[S.jsx(He,{as:"span",fontSize:"xl",children:""}),"Sign In"]})})]})})};var SV={},Df={},lC={},_Z;function N9e(){if(_Z)return lC;_Z=1,Object.defineProperty(lC,"__esModule",{value:!0}),lC.useCanvasIdentifier=void 0;var n=am(),e=0,i="react-unity-webgl-canvas",o=function(l){var u=(0,n.useState)(0),p=u[0],y=u[1],E=(0,n.useCallback)(function(){y(function(T){return T+1})},[]);if(l!==void 0)return[l,E];var b=(0,n.useMemo)(function(){return[i,e].join("-")},[p]);return[b,E]};return lC.useCanvasIdentifier=o,lC}var uC={},dC={},yZ;function Fae(){return yZ||(yZ=1,Object.defineProperty(dC,"__esModule",{value:!0}),dC.isBrowserEnvironment=void 0,dC.isBrowserEnvironment=typeof window<"u"&&typeof document<"u"),dC}var EZ;function x9e(){if(EZ)return uC;EZ=1,Object.defineProperty(uC,"__esModule",{value:!0}),uC.useUnityLoader=void 0;var n=am(),e=Fae(),i=function(o){var l=(0,n.useState)("Loading"),u=l[0],p=l[1];return(0,n.useEffect)(function(){if(e.isBrowserEnvironment!==!1){if(o===null){p("Idle");return}var y=window.document.querySelector('script[src="'.concat(o,'"]'));y===null?(y=window.document.createElement("script"),y.type="text/javascript",y.src=o,y.async=!0,y.setAttribute("data-status","loading"),window.document.body.appendChild(y),y.addEventListener("load",function(){return y==null?void 0:y.setAttribute("data-status","loaded")}),y.addEventListener("error",function(){return y==null?void 0:y.setAttribute("data-status","error")})):p(y.getAttribute("data-status")==="loaded"?"Loaded":"Error");var E=function(b){return p(b.type==="load"?"Loaded":"Error")};return y.addEventListener("load",E),y.addEventListener("error",E),function(){y!==null&&(y.removeEventListener("load",E),y.removeEventListener("error",E),y.remove())}}},[o]),u};return uC.useUnityLoader=i,uC}var vZ;function D9e(){if(vZ)return Df;vZ=1;var n=Df&&Df.__awaiter||function(p,y,E,b){function T(R){return R instanceof E?R:new E(function(O){O(R)})}return new(E||(E=Promise))(function(R,O){function L(F){try{U(b.next(F))}catch(Y){O(Y)}}function D(F){try{U(b.throw(F))}catch(Y){O(Y)}}function U(F){F.done?R(F.value):T(F.value).then(L,D)}U((b=b.apply(p,y||[])).next())})},e=Df&&Df.__generator||function(p,y){var E={label:0,sent:function(){if(R[0]&1)throw R[1];return R[1]},trys:[],ops:[]},b,T,R,O=Object.create((typeof Iterator=="function"?Iterator:Object).prototype);return O.next=L(0),O.throw=L(1),O.return=L(2),typeof Symbol=="function"&&(O[Symbol.iterator]=function(){return this}),O;function L(U){return function(F){return D([U,F])}}function D(U){if(b)throw new TypeError("Generator is already executing.");for(;O&&(O=0,U[0]&&(E=0)),E;)try{if(b=1,T&&(R=U[0]&2?T.return:U[0]?T.throw||((R=T.return)&&R.call(T),0):T.next)&&!(R=R.call(T,U[1])).done)return R;switch(T=0,R&&(U=[U[0]&2,R.value]),U[0]){case 0:case 1:R=U;break;case 4:return E.label++,{value:U[1],done:!1};case 5:E.label++,T=U[1],U=[0];continue;case 7:U=E.ops.pop(),E.trys.pop();continue;default:if(R=E.trys,!(R=R.length>0&&R[R.length-1])&&(U[0]===6||U[0]===2)){E=0;continue}if(U[0]===3&&(!R||U[1]>R[0]&&U[1]<R[3])){E.label=U[1];break}if(U[0]===6&&E.label<R[1]){E.label=R[1],R=U;break}if(R&&E.label<R[2]){E.label=R[2],E.ops.push(U);break}R[2]&&E.ops.pop(),E.trys.pop();continue}U=y.call(p,E)}catch(F){U=[6,F],T=0}finally{b=R=0}if(U[0]&5)throw U[1];return{value:U[0]?U[1]:void 0,done:!0}}};Object.defineProperty(Df,"__esModule",{value:!0}),Df.Unity=void 0;var i=am(),o=N9e(),l=x9e(),u=(0,i.forwardRef)(function(p,y){var E=(0,i.useState)(null),b=E[0],T=E[1],R=(0,i.useState)(null),O=R[0],L=R[1],D=(0,o.useCanvasIdentifier)(p.id),U=D[0],F=D[1],Y=(0,l.useUnityLoader)(p.unityProvider.loaderUrl),W=(0,i.useCallback)(function(re){p.unityProvider.setLoadingProgression(re),re===1&&p.unityProvider.setIsLoaded(!0)},[p.unityProvider]);return(0,i.useEffect)(function(){var re=function(){return n(void 0,void 0,void 0,function(){var ie,me,q,J,Q;return e(this,function(ne){switch(ne.label){case 0:if(!b||O||Y!=="Loaded")return[2];console.log("React Unity WebGL: Initializing Unity instance..."),p.unityProvider.setUnityInstance(null),L(null),p.unityProvider.setLoadingProgression(0),(Q=(J=p.unityProvider).setIsLoaded)===null||Q===void 0||Q.call(J,!1),p.unityProvider.setInitialisationError(void 0),F(),ie={companyName:p.unityProvider.companyName,productName:p.unityProvider.productName,productVersion:p.unityProvider.productVersion,dataUrl:p.unityProvider.dataUrl,frameworkUrl:p.unityProvider.frameworkUrl,codeUrl:p.unityProvider.codeUrl,workerUrl:p.unityProvider.workerUrl,memoryUrl:p.unityProvider.memoryUrl,symbolsUrl:p.unityProvider.symbolsUrl,streamingAssetsUrl:p.unityProvider.streamingAssetsUrl,devicePixelRatio:p.devicePixelRatio,webglContextAttributes:p.unityProvider.webglContextAttributes,cacheControl:p.unityProvider.cacheControl,autoSyncPersistentDataPath:p.unityProvider.autoSyncPersistentDataPath,matchWebGLToCanvasSize:p.matchWebGLToCanvasSize,disabledCanvasEvents:p.disabledCanvasEvents},Object.keys(ie).forEach(function(he){(ie[he]===null||ie[he]===void 0)&&delete ie[he]}),ne.label=1;case 1:return ne.trys.push([1,3,,4]),[4,window.createUnityInstance(b,ie,W)];case 2:return me=ne.sent(),L(me),p.unityProvider.setUnityInstance(me),[3,4];case 3:return q=ne.sent(),console.error("React Unity WebGL: Error initializing Unity instance:",q),p.unityProvider.setInitialisationError(q),[3,4];case 4:return[2]}})})},le=function(){return n(void 0,void 0,void 0,function(){var ie,me,q;return e(this,function(J){switch(J.label){case 0:return!O||!b?[2]:(console.log("React Unity WebGL: Detaching Unity instance..."),p.unityProvider.setUnityInstance(null),L(null),p.unityProvider.setLoadingProgression(0),(q=(me=p.unityProvider).setIsLoaded)===null||q===void 0||q.call(me,!1),p.unityProvider.setInitialisationError(void 0),ie=document.createElement("canvas"),ie.id=b.id,ie.setAttribute("react-unity-webgl-role","cleanup"),ie.style.display="none",document.body.appendChild(ie),O.Module.canvas=ie,L(null),[4,O.Quit()]);case 1:return J.sent(),document.body.removeChild(ie),[2]}})})};return re(),function(){le()}},[b,O,Y,p.unityProvider]),(0,i.useImperativeHandle)(y,function(){return b}),(0,i.createElement)("canvas",{ref:T,id:U,style:p.style,className:p.className,tabIndex:p.tabIndex})});return Df.Unity=u,Df}var hC={},Py={},SZ;function L9e(){if(SZ)return Py;SZ=1;var n=Py&&Py.__spreadArray||function(p,y,E){if(E||arguments.length===2)for(var b=0,T=y.length,R;b<T;b++)(R||!(b in y))&&(R||(R=Array.prototype.slice.call(y,0,b)),R[b]=y[b]);return p.concat(R||Array.prototype.slice.call(y))};Object.defineProperty(Py,"__esModule",{value:!0}),Py.useEventSystem=void 0;var e=am(),i=Fae(),o=[],l=function(p){for(var y=[],E=1;E<arguments.length;E++)y[E-1]=arguments[E];var b=void 0;return o.forEach(function(T){b=T.apply(void 0,n([p],y,!1))}),b};i.isBrowserEnvironment===!0&&(window.dispatchReactUnityEvent=l);var u=function(){var p=(0,e.useRef)([]),y=(0,e.useCallback)(function(T,R){p.current=n(n([],p.current,!0),[{eventName:T,callback:R}],!1)},[p]),E=(0,e.useCallback)(function(T,R){p.current=p.current.filter(function(O){return O.eventName!==T&&O.callback!==R})},[p]),b=(0,e.useCallback)(function(T){for(var R=[],O=1;O<arguments.length;O++)R[O-1]=arguments[O];var L=p.current.find(function(D){return D.eventName===T});if(!(typeof L>"u"))return L.callback.apply(L,R)},[p]);return(0,e.useEffect)(function(){return o.push(b),function(){o.splice(o.indexOf(b),1)}},[b]),{addEventListener:y,removeEventListener:E}};return Py.useEventSystem=u,Py}var bZ;function M9e(){if(bZ)return hC;bZ=1,Object.defineProperty(hC,"__esModule",{value:!0}),hC.useUnityContext=void 0;var n=am(),e=L9e(),i=function(o){var l=(0,n.useState)(null),u=l[0],p=l[1],y=(0,n.useState)(0),E=y[0],b=y[1],T=(0,n.useState)(!1),R=T[0],O=T[1],L=(0,n.useState)(),D=L[0],U=L[1],F=(0,e.useEventSystem)(),Y=(0,n.useRef)({companyName:o.companyName,productName:o.productName,productVersion:o.productVersion,codeUrl:o.codeUrl,dataUrl:o.dataUrl,frameworkUrl:o.frameworkUrl,loaderUrl:o.loaderUrl,memoryUrl:o.memoryUrl,symbolsUrl:o.symbolsUrl,streamingAssetsUrl:o.streamingAssetsUrl,workerUrl:o.workerUrl,webglContextAttributes:o.webglContextAttributes,cacheControl:o.cacheControl,autoSyncPersistentDataPath:o.autoSyncPersistentDataPath,setUnityInstance:p,setLoadingProgression:b,setIsLoaded:O,setInitialisationError:U}),W=(0,n.useCallback)(function(J){return u==null?void 0:u.SetFullscreen(J?1:0)},[u]),re=(0,n.useCallback)(function(){var J;return(J=u==null?void 0:u.Module.canvas)===null||J===void 0?void 0:J.requestPointerLock()},[u]),le=(0,n.useCallback)(function(J,Q,ne){return u==null?void 0:u.SendMessage(J,Q,ne)},[u]),ie=(0,n.useCallback)(function(J,Q){var ne;return(ne=u==null?void 0:u.Module.canvas)===null||ne===void 0?void 0:ne.toDataURL(J,Q)},[u]),me=(0,n.useCallback)(function(){var J;return(J=u==null?void 0:u.Quit())!==null&&J!==void 0?J:Promise.reject()},[u]),q=(0,n.useCallback)(function(){var J;return(J=u==null?void 0:u.GetMetricsInfo)===null||J===void 0?void 0:J.call(u)},[u]);return{unityProvider:Y.current,loadingProgression:E,isLoaded:R,initialisationError:D,requestFullscreen:W,requestPointerLock:re,sendMessage:le,takeScreenshot:ie,unload:me,getMetricsInfo:q,addEventListener:F.addEventListener,removeEventListener:F.removeEventListener,UNSAFE__unityInstance:u}};return hC.useUnityContext=i,hC}var pC={},wZ;function U9e(){if(wZ)return pC;wZ=1,Object.defineProperty(pC,"__esModule",{value:!0}),pC.useUnityMetricsInfo=void 0;var n=am(),e=function(i,o){var l=(0,n.useState)({}),u=l[0],p=l[1];return(0,n.useEffect)(function(){var y=setInterval(function(){var E=i();typeof E>"u"||p(E)},o.interval||1e3);return function(){clearInterval(y)}},[i,o.interval]),u};return pC.useUnityMetricsInfo=e,pC}var TZ;function V9e(){return TZ||(TZ=1,(function(n){Object.defineProperty(n,"__esModule",{value:!0}),n.useUnityMetricsInfo=n.useUnityContext=n.Unity=void 0;var e=D9e();Object.defineProperty(n,"Unity",{enumerable:!0,get:function(){return e.Unity}});var i=M9e();Object.defineProperty(n,"useUnityContext",{enumerable:!0,get:function(){return i.useUnityContext}});var o=U9e();Object.defineProperty(n,"useUnityMetricsInfo",{enumerable:!0,get:function(){return o.useUnityMetricsInfo}})})(SV)),SV}var Bae=V9e();const dh="[UnityProvider]",ij=k.createContext(),j9e=({spaceID:n,children:e,loaderUrl:i,dataUrl:o,frameworkUrl:l,codeUrl:u,loadingBackground:p,showLoginButton:y,showDisruptiveLogo:E})=>{G.log(`${dh} Initializing with spaceID:`,n),G.log(`${dh} Unity URLs:`,{loaderUrl:i,dataUrl:o,frameworkUrl:l,codeUrl:u});const{unityProvider:b,loadingProgression:T,isLoaded:R,sendMessage:O,addEventListener:L,removeEventListener:D,error:U}=Bae.useUnityContext({loaderUrl:i,dataUrl:o,frameworkUrl:l,codeUrl:u}),F={unityProvider:b,loadingProgression:T,isLoaded:R,sendMessage:O,addEventListener:L,removeEventListener:D,error:U,spaceID:n},Y=k.useRef(null),W=k.useRef(Date.now());k.useEffect(()=>{const me=()=>{document.hidden?(G.log(`${dh} Page hidden, starting keep-alive`),re()):(G.log(`${dh} Page visible, stopping keep-alive`),le())};return document.addEventListener("visibilitychange",me),()=>{document.removeEventListener("visibilitychange",me),le()}},[]),k.useEffect(()=>{const me=()=>{W.current=Date.now(),document.hidden&&O("WebGLInputManager","KeepAlive")};return window.addEventListener("mousemove",me),window.addEventListener("keydown",me),window.addEventListener("touchstart",me),()=>{window.removeEventListener("mousemove",me),window.removeEventListener("keydown",me),window.removeEventListener("touchstart",me)}},[O]);const re=()=>{Y.current||(Y.current=setInterval(()=>{R&&document.hidden&&(O("WebGLInputManager","KeepAlive"),G.debug(`${dh} Sent keep-alive message`))},1e4))},le=()=>{Y.current&&(clearInterval(Y.current),Y.current=null)};k.useEffect(()=>(G.log(`${dh} Component mounted`),()=>{G.log(`${dh} Component unmounting`),le()}),[]),k.useEffect(()=>{G.log(`${dh} Loading progress:`,T)},[T]),k.useEffect(()=>{if(R){G.log(`${dh} Unity instance loaded for:`,n);const me={SendMessage:O,Module:b==null?void 0:b.Module};window.unityInstance=me,window.registerUnityInstance&&window.registerUnityInstance(me),document.hidden&&re()}},[R,n,O,b]),k.useEffect(()=>{U&&G.error(`${dh} Unity error:`,U)},[U]),G.log(`${dh} Rendering provider with instance:`,F),k.useEffect(()=>{G.log("UnityProvider: Unity build URLs:",{loaderUrl:i,dataUrl:o,frameworkUrl:l,codeUrl:u})},[i,o,l,u]);const ie=[];if(i||ie.push("loaderUrl"),o||ie.push("dataUrl"),l||ie.push("frameworkUrl"),u||ie.push("codeUrl"),ie.length>0)return G.error(`UnityProvider: Missing required Unity build URLs: ${ie.join(", ")}`),S.jsx(ij.Provider,{value:{unityProvider:null,loadingProgression:0,isLoaded:!1,sendMessage:()=>{},addEventListener:()=>{},removeEventListener:()=>{},error:new Error(`Missing required Unity build URLs: ${ie.join(", ")}`),spaceID:n},children:e});try{return k.useEffect(()=>{G.log("UnityProvider: Unity context created:",b),b?G.log("UnityProvider: Unity provider is available"):G.error("UnityProvider: Unity provider is not available"),R?G.log("UnityProvider: Unity is loaded"):G.log("UnityProvider: Unity is not loaded yet")},[b,R]),S.jsx(ij.Provider,{value:F,children:e})}catch(me){return G.error("UnityProvider: Error creating Unity context:",me),S.jsxs("div",{style:{padding:"20px",color:"red",backgroundColor:"#ffeeee",border:"1px solid red",borderRadius:"5px"},children:[S.jsx("h3",{children:"Unity Error"}),S.jsxs("p",{children:["Error creating Unity context: ",me.message]}),S.jsx("p",{children:"Please check the console for more details."})]})}},Lo=()=>k.useContext(ij);var zae={color:void 0,size:void 0,className:void 0,style:void 0,attr:void 0},CZ=yi.createContext&&yi.createContext(zae),jg=function(){return jg=Object.assign||function(n){for(var e,i=1,o=arguments.length;i<o;i++){e=arguments[i];for(var l in e)Object.prototype.hasOwnProperty.call(e,l)&&(n[l]=e[l])}return n},jg.apply(this,arguments)},F9e=function(n,e){var i={};for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&e.indexOf(o)<0&&(i[o]=n[o]);if(n!=null&&typeof Object.getOwnPropertySymbols=="function")for(var l=0,o=Object.getOwnPropertySymbols(n);l<o.length;l++)e.indexOf(o[l])<0&&Object.prototype.propertyIsEnumerable.call(n,o[l])&&(i[o[l]]=n[o[l]]);return i};function Wae(n){return n&&n.map(function(e,i){return yi.createElement(e.tag,jg({key:i},e.attr),Wae(e.child))})}function sr(n){return function(e){return yi.createElement(B9e,jg({attr:jg({},n.attr)},e),Wae(n.child))}}function B9e(n){var e=function(i){var o=n.attr,l=n.size,u=n.title,p=F9e(n,["attr","size","title"]),y=l||i.size||"1em",E;return i.className&&(E=i.className),n.className&&(E=(E?E+" ":"")+n.className),yi.createElement("svg",jg({stroke:"currentColor",fill:"currentColor",strokeWidth:"0"},i.attr,o,p,{className:E,style:jg(jg({color:n.color||i.color},i.style),n.style),height:y,width:y,xmlns:"http://www.w3.org/2000/svg"}),u&&yi.createElement("title",null,u),n.children)};return CZ!==void 0?yi.createElement(CZ.Consumer,null,function(i){return e(i)}):e(zae)}function Gae(n){return sr({attr:{viewBox:"0 0 448 512"},child:[{tag:"path",attr:{d:"M416 32H31.9C14.3 32 0 46.5 0 64.3v383.4C0 465.5 14.3 480 31.9 480H416c17.6 0 32-14.5 32-32.3V64.3c0-17.8-14.4-32.3-32-32.3zM135.4 416H69V202.2h66.5V416zm-33.2-243c-21.3 0-38.5-17.3-38.5-38.5S80.9 96 102.2 96c21.2 0 38.5 17.3 38.5 38.5 0 21.3-17.2 38.5-38.5 38.5zm282.1 243h-66.4V312c0-24.8-.5-56.7-34.5-56.7-34.6 0-39.9 27-39.9 54.9V416h-66.4V202.2h63.7v29.2h.9c8.9-16.8 30.6-34.5 62.9-34.5 67.2 0 79.7 44.3 79.7 101.9V416z"}}]})(n)}function z9e(n){return sr({attr:{viewBox:"0 0 448 512"},child:[{tag:"path",attr:{d:"M257.5 445.1l-22.2 22.2c-9.4 9.4-24.6 9.4-33.9 0L7 273c-9.4-9.4-9.4-24.6 0-33.9L201.4 44.7c9.4-9.4 24.6-9.4 33.9 0l22.2 22.2c9.5 9.5 9.3 25-.4 34.3L136.6 216H424c13.3 0 24 10.7 24 24v32c0 13.3-10.7 24-24 24H136.6l120.5 114.8c9.8 9.3 10 24.8.4 34.3z"}}]})(n)}function W9e(n){return sr({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M256 8C119.034 8 8 119.033 8 256s111.034 248 248 248 248-111.034 248-248S392.967 8 256 8zm130.108 117.892c65.448 65.448 70 165.481 20.677 235.637L150.47 105.216c70.204-49.356 170.226-44.735 235.638 20.676zM125.892 386.108c-65.448-65.448-70-165.481-20.677-235.637L361.53 406.784c-70.203 49.356-170.226 44.736-235.638-20.676z"}}]})(n)}function RZ(n){return sr({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M173.898 439.404l-166.4-166.4c-9.997-9.997-9.997-26.206 0-36.204l36.203-36.204c9.997-9.998 26.207-9.998 36.204 0L192 312.69 432.095 72.596c9.997-9.997 26.207-9.997 36.204 0l36.203 36.204c9.997 9.997 9.997 26.206 0 36.204l-294.4 294.401c-9.998 9.997-26.207 9.997-36.204-.001z"}}]})(n)}function G9e(n){return sr({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M256,8C119,8,8,119,8,256S119,504,256,504,504,393,504,256,393,8,256,8Zm92.49,313h0l-20,25a16,16,0,0,1-22.49,2.5h0l-67-49.72a40,40,0,0,1-15-31.23V112a16,16,0,0,1,16-16h32a16,16,0,0,1,16,16V256l58,42.5A16,16,0,0,1,348.49,321Z"}}]})(n)}function IZ(n){return sr({attr:{viewBox:"0 0 448 512"},child:[{tag:"path",attr:{d:"M320 448v40c0 13.255-10.745 24-24 24H24c-13.255 0-24-10.745-24-24V120c0-13.255 10.745-24 24-24h72v296c0 30.879 25.121 56 56 56h168zm0-344V0H152c-13.255 0-24 10.745-24 24v368c0 13.255 10.745 24 24 24h272c13.255 0 24-10.745 24-24V128H344c-13.2 0-24-10.8-24-24zm120.971-31.029L375.029 7.029A24 24 0 0 0 358.059 0H352v96h96v-6.059a24 24 0 0 0-7.029-16.97z"}}]})(n)}function H9e(n){return sr({attr:{viewBox:"0 0 640 512"},child:[{tag:"path",attr:{d:"M160 224v64h320v-64c0-35.3 28.7-64 64-64h32c0-53-43-96-96-96H160c-53 0-96 43-96 96h32c35.3 0 64 28.7 64 64zm416-32h-32c-17.7 0-32 14.3-32 32v96H128v-96c0-17.7-14.3-32-32-32H64c-35.3 0-64 28.7-64 64 0 23.6 13 44 32 55.1V432c0 8.8 7.2 16 16 16h64c8.8 0 16-7.2 16-16v-16h384v16c0 8.8 7.2 16 16 16h64c8.8 0 16-7.2 16-16V311.1c19-11.1 32-31.5 32-55.1 0-35.3-28.7-64-64-64z"}}]})(n)}function Qk(n){return sr({attr:{viewBox:"0 0 640 512"},child:[{tag:"path",attr:{d:"M528 448H112c-8.8 0-16 7.2-16 16v32c0 8.8 7.2 16 16 16h416c8.8 0 16-7.2 16-16v-32c0-8.8-7.2-16-16-16zm64-320c-26.5 0-48 21.5-48 48 0 7.1 1.6 13.7 4.4 19.8L476 239.2c-15.4 9.2-35.3 4-44.2-11.6L350.3 85C361 76.2 368 63 368 48c0-26.5-21.5-48-48-48s-48 21.5-48 48c0 15 7 28.2 17.7 37l-81.5 142.6c-8.9 15.6-28.9 20.8-44.2 11.6l-72.3-43.4c2.7-6 4.4-12.7 4.4-19.8 0-26.5-21.5-48-48-48S0 149.5 0 176s21.5 48 48 48c2.6 0 5.2-.4 7.7-.8L128 416h384l72.3-192.8c2.5.4 5.1.8 7.7.8 26.5 0 48-21.5 48-48s-21.5-48-48-48z"}}]})(n)}function $9e(n){return sr({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M239.1 6.3l-208 78c-18.7 7-31.1 25-31.1 45v225.1c0 18.2 10.3 34.8 26.5 42.9l208 104c13.5 6.8 29.4 6.8 42.9 0l208-104c16.3-8.1 26.5-24.8 26.5-42.9V129.3c0-20-12.4-37.9-31.1-44.9l-208-78C262 2.2 250 2.2 239.1 6.3zM256 68.4l192 72v1.1l-192 78-192-78v-1.1l192-72zm32 356V275.5l160-65v133.9l-160 80z"}}]})(n)}function K9e(n){return sr({attr:{viewBox:"0 0 640 512"},child:[{tag:"path",attr:{d:"M624 448h-80V113.45C544 86.19 522.47 64 496 64H384v64h96v384h144c8.84 0 16-7.16 16-16v-32c0-8.84-7.16-16-16-16zM312.24 1.01l-192 49.74C105.99 54.44 96 67.7 96 82.92V448H16c-8.84 0-16 7.16-16 16v32c0 8.84 7.16 16 16 16h336V33.18c0-21.58-19.56-37.41-39.76-32.17zM264 288c-13.25 0-24-14.33-24-32s10.75-32 24-32 24 14.33 24 32-10.75 32-24 32z"}}]})(n)}function Hae(n){return sr({attr:{viewBox:"0 0 192 512"},child:[{tag:"path",attr:{d:"M96 184c39.8 0 72 32.2 72 72s-32.2 72-72 72-72-32.2-72-72 32.2-72 72-72zM24 80c0 39.8 32.2 72 72 72s72-32.2 72-72S135.8 8 96 8 24 40.2 24 80zm0 352c0 39.8 32.2 72 72 72s72-32.2 72-72-32.2-72-72-72-72 32.2-72 72z"}}]})(n)}function q9e(n){return sr({attr:{viewBox:"0 0 640 512"},child:[{tag:"path",attr:{d:"M480.07 96H160a160 160 0 1 0 114.24 272h91.52A160 160 0 1 0 480.07 96zM248 268a12 12 0 0 1-12 12h-52v52a12 12 0 0 1-12 12h-24a12 12 0 0 1-12-12v-52H84a12 12 0 0 1-12-12v-24a12 12 0 0 1 12-12h52v-52a12 12 0 0 1 12-12h24a12 12 0 0 1 12 12v52h52a12 12 0 0 1 12 12zm216 76a40 40 0 1 1 40-40 40 40 0 0 1-40 40zm64-96a40 40 0 1 1 40-40 40 40 0 0 1-40 40z"}}]})(n)}function $ae(n){return sr({attr:{viewBox:"0 0 496 512"},child:[{tag:"path",attr:{d:"M336.5 160C322 70.7 287.8 8 248 8s-74 62.7-88.5 152h177zM152 256c0 22.2 1.2 43.5 3.3 64h185.3c2.1-20.5 3.3-41.8 3.3-64s-1.2-43.5-3.3-64H155.3c-2.1 20.5-3.3 41.8-3.3 64zm324.7-96c-28.6-67.9-86.5-120.4-158-141.6 24.4 33.8 41.2 84.7 50 141.6h108zM177.2 18.4C105.8 39.6 47.8 92.1 19.3 160h108c8.7-56.9 25.5-107.8 49.9-141.6zM487.4 192H372.7c2.1 21 3.3 42.5 3.3 64s-1.2 43-3.3 64h114.6c5.5-20.5 8.6-41.8 8.6-64s-3.1-43.5-8.5-64zM120 256c0-21.5 1.2-43 3.3-64H8.6C3.2 212.5 0 233.8 0 256s3.2 43.5 8.6 64h114.6c-2-21-3.2-42.5-3.2-64zm39.5 96c14.5 89.3 48.7 152 88.5 152s74-62.7 88.5-152h-177zm159.3 141.6c71.4-21.2 129.4-73.7 158-141.6h-108c-8.8 56.9-25.6 107.8-50 141.6zM19.3 352c28.6 67.9 86.5 120.4 158 141.6-24.4-33.8-41.2-84.7-50-141.6h-108z"}}]})(n)}function Y9e(n){return sr({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M256 8C119.043 8 8 119.083 8 256c0 136.997 111.043 248 248 248s248-111.003 248-248C504 119.083 392.957 8 256 8zm0 110c23.196 0 42 18.804 42 42s-18.804 42-42 42-42-18.804-42-42 18.804-42 42-42zm56 254c0 6.627-5.373 12-12 12h-88c-6.627 0-12-5.373-12-12v-24c0-6.627 5.373-12 12-12h12v-64h-12c-6.627 0-12-5.373-12-12v-24c0-6.627 5.373-12 12-12h64c6.627 0 12 5.373 12 12v100h12c6.627 0 12 5.373 12 12v24z"}}]})(n)}function X9e(n){return sr({attr:{viewBox:"0 0 576 512"},child:[{tag:"path",attr:{d:"M528 448H48c-26.51 0-48-21.49-48-48V112c0-26.51 21.49-48 48-48h480c26.51 0 48 21.49 48 48v288c0 26.51-21.49 48-48 48zM128 180v-40c0-6.627-5.373-12-12-12H76c-6.627 0-12 5.373-12 12v40c0 6.627 5.373 12 12 12h40c6.627 0 12-5.373 12-12zm96 0v-40c0-6.627-5.373-12-12-12h-40c-6.627 0-12 5.373-12 12v40c0 6.627 5.373 12 12 12h40c6.627 0 12-5.373 12-12zm96 0v-40c0-6.627-5.373-12-12-12h-40c-6.627 0-12 5.373-12 12v40c0 6.627 5.373 12 12 12h40c6.627 0 12-5.373 12-12zm96 0v-40c0-6.627-5.373-12-12-12h-40c-6.627 0-12 5.373-12 12v40c0 6.627 5.373 12 12 12h40c6.627 0 12-5.373 12-12zm96 0v-40c0-6.627-5.373-12-12-12h-40c-6.627 0-12 5.373-12 12v40c0 6.627 5.373 12 12 12h40c6.627 0 12-5.373 12-12zm-336 96v-40c0-6.627-5.373-12-12-12h-40c-6.627 0-12 5.373-12 12v40c0 6.627 5.373 12 12 12h40c6.627 0 12-5.373 12-12zm96 0v-40c0-6.627-5.373-12-12-12h-40c-6.627 0-12 5.373-12 12v40c0 6.627 5.373 12 12 12h40c6.627 0 12-5.373 12-12zm96 0v-40c0-6.627-5.373-12-12-12h-40c-6.627 0-12 5.373-12 12v40c0 6.627 5.373 12 12 12h40c6.627 0 12-5.373 12-12zm96 0v-40c0-6.627-5.373-12-12-12h-40c-6.627 0-12 5.373-12 12v40c0 6.627 5.373 12 12 12h40c6.627 0 12-5.373 12-12zm-336 96v-40c0-6.627-5.373-12-12-12H76c-6.627 0-12 5.373-12 12v40c0 6.627 5.373 12 12 12h40c6.627 0 12-5.373 12-12zm288 0v-40c0-6.627-5.373-12-12-12H172c-6.627 0-12 5.373-12 12v40c0 6.627 5.373 12 12 12h232c6.627 0 12-5.373 12-12zm96 0v-40c0-6.627-5.373-12-12-12h-40c-6.627 0-12 5.373-12 12v40c0 6.627 5.373 12 12 12h40c6.627 0 12-5.373 12-12z"}}]})(n)}function Kae(n){return sr({attr:{viewBox:"0 0 640 512"},child:[{tag:"path",attr:{d:"M633.82 458.1l-157.8-121.96C488.61 312.13 496 285.01 496 256v-48c0-8.84-7.16-16-16-16h-16c-8.84 0-16 7.16-16 16v48c0 17.92-3.96 34.8-10.72 50.2l-26.55-20.52c3.1-9.4 5.28-19.22 5.28-29.67V96c0-53.02-42.98-96-96-96s-96 42.98-96 96v45.36L45.47 3.37C38.49-2.05 28.43-.8 23.01 6.18L3.37 31.45C-2.05 38.42-.8 48.47 6.18 53.9l588.36 454.73c6.98 5.43 17.03 4.17 22.46-2.81l19.64-25.27c5.41-6.97 4.16-17.02-2.82-22.45zM400 464h-56v-33.77c11.66-1.6 22.85-4.54 33.67-8.31l-50.11-38.73c-6.71.4-13.41.87-20.35.2-55.85-5.45-98.74-48.63-111.18-101.85L144 241.31v6.85c0 89.64 63.97 169.55 152 181.69V464h-56c-8.84 0-16 7.16-16 16v16c0 8.84 7.16 16 16 16h160c8.84 0 16-7.16 16-16v-16c0-8.84-7.16-16-16-16z"}}]})(n)}function qae(n){return sr({attr:{viewBox:"0 0 352 512"},child:[{tag:"path",attr:{d:"M176 352c53.02 0 96-42.98 96-96V96c0-53.02-42.98-96-96-96S80 42.98 80 96v160c0 53.02 42.98 96 96 96zm160-160h-16c-8.84 0-16 7.16-16 16v48c0 74.8-64.49 134.82-140.79 127.38C96.71 376.89 48 317.11 48 250.3V208c0-8.84-7.16-16-16-16H16c-8.84 0-16 7.16-16 16v40.16c0 89.64 63.97 169.55 152 181.69V464H96c-8.84 0-16 7.16-16 16v16c0 8.84 7.16 16 16 16h160c8.84 0 16-7.16 16-16v-16c0-8.84-7.16-16-16-16h-56v-33.77C285.71 418.47 352 344.9 352 256v-48c0-8.84-7.16-16-16-16z"}}]})(n)}function J9e(n){return sr({attr:{viewBox:"0 0 384 512"},child:[{tag:"path",attr:{d:"M0 352a160 160 0 0 0 160 160h64a160 160 0 0 0 160-160V224H0zM176 0h-16A160 160 0 0 0 0 160v32h176zm48 0h-16v192h176v-32A160 160 0 0 0 224 0z"}}]})(n)}function Q9e(n){return sr({attr:{viewBox:"0 0 448 512"},child:[{tag:"path",attr:{d:"M416 208H272V64c0-17.67-14.33-32-32-32h-32c-17.67 0-32 14.33-32 32v144H32c-17.67 0-32 14.33-32 32v32c0 17.67 14.33 32 32 32h144v144c0 17.67 14.33 32 32 32h32c17.67 0 32-14.33 32-32V304h144c17.67 0 32-14.33 32-32v-32c0-17.67-14.33-32-32-32z"}}]})(n)}function Z9e(n){return sr({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M466.5 83.7l-192-80a48.15 48.15 0 0 0-36.9 0l-192 80C27.7 91.1 16 108.6 16 128c0 198.5 114.5 335.7 221.5 380.3 11.8 4.9 25.1 4.9 36.9 0C360.1 472.6 496 349.3 496 128c0-19.4-11.7-36.9-29.5-44.3zM256.1 446.3l-.1-381 175.9 73.3c-3.3 151.4-82.1 261.1-175.8 307.7z"}}]})(n)}function Zk(n){return sr({attr:{viewBox:"0 0 576 512"},child:[{tag:"path",attr:{d:"M259.3 17.8L194 150.2 47.9 171.5c-26.2 3.8-36.7 36.1-17.7 54.6l105.7 103-25 145.5c-4.5 26.3 23.2 46 46.4 33.7L288 439.6l130.7 68.7c23.2 12.2 50.9-7.4 46.4-33.7l-25-145.5 105.7-103c19-18.5 8.5-50.8-17.7-54.6L382 150.2 316.7 17.8c-11.7-23.6-45.6-23.9-57.4 0z"}}]})(n)}function eWe(n){return sr({attr:{viewBox:"0 0 448 512"},child:[{tag:"path",attr:{d:"M432 32H312l-9.4-18.7A24 24 0 0 0 281.1 0H166.8a23.72 23.72 0 0 0-21.4 13.3L136 32H16A16 16 0 0 0 0 48v32a16 16 0 0 0 16 16h416a16 16 0 0 0 16-16V48a16 16 0 0 0-16-16zM53.2 467a48 48 0 0 0 47.9 45h245.8a48 48 0 0 0 47.9-45L416 128H32z"}}]})(n)}function tWe(n){return sr({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M296 384h-80c-13.3 0-24-10.7-24-24V192h-87.7c-17.8 0-26.7-21.5-14.1-34.1L242.3 5.7c7.5-7.5 19.8-7.5 27.3 0l152.2 152.2c12.6 12.6 3.7 34.1-14.1 34.1H320v168c0 13.3-10.7 24-24 24zm216-8v112c0 13.3-10.7 24-24 24H24c-13.3 0-24-10.7-24-24V376c0-13.3 10.7-24 24-24h136v8c0 30.9 25.1 56 56 56h80c30.9 0 56-25.1 56-56v-8h136c13.3 0 24 10.7 24 24zm-124 88c0-11-9-20-20-20s-20 9-20 20 9 20 20 20 20-9 20-20zm64 0c0-11-9-20-20-20s-20 9-20 20 9 20 20 20 20-9 20-20z"}}]})(n)}function nWe(n){return sr({attr:{viewBox:"0 0 640 512"},child:[{tag:"path",attr:{d:"M624 208H432c-8.8 0-16 7.2-16 16v32c0 8.8 7.2 16 16 16h192c8.8 0 16-7.2 16-16v-32c0-8.8-7.2-16-16-16zm-400 48c70.7 0 128-57.3 128-128S294.7 0 224 0 96 57.3 96 128s57.3 128 128 128zm89.6 32h-16.7c-22.2 10.2-46.9 16-72.9 16s-50.6-5.8-72.9-16h-16.7C60.2 288 0 348.2 0 422.4V464c0 26.5 21.5 48 48 48h352c26.5 0 48-21.5 48-48v-41.6c0-74.2-60.2-134.4-134.4-134.4z"}}]})(n)}function rWe(n){return sr({attr:{viewBox:"0 0 640 512"},child:[{tag:"path",attr:{d:"M96 224c35.3 0 64-28.7 64-64s-28.7-64-64-64-64 28.7-64 64 28.7 64 64 64zm448 0c35.3 0 64-28.7 64-64s-28.7-64-64-64-64 28.7-64 64 28.7 64 64 64zm32 32h-64c-17.6 0-33.5 7.1-45.1 18.6 40.3 22.1 68.9 62 75.1 109.4h66c17.7 0 32-14.3 32-32v-32c0-35.3-28.7-64-64-64zm-256 0c61.9 0 112-50.1 112-112S381.9 32 320 32 208 82.1 208 144s50.1 112 112 112zm76.8 32h-8.3c-20.8 10-43.9 16-68.5 16s-47.6-6-68.5-16h-8.3C179.6 288 128 339.6 128 403.2V432c0 26.5 21.5 48 48 48h288c26.5 0 48-21.5 48-48v-28.8c0-63.6-51.6-115.2-115.2-115.2zm-223.7-13.4C161.5 263.1 145.6 256 128 256H64c-35.3 0-64 28.7-64 64v32c0 17.7 14.3 32 32 32h65.9c6.3-47.4 34.9-87.3 75.2-109.4z"}}]})(n)}function iWe(n){return sr({attr:{viewBox:"0 0 640 512"},child:[{tag:"path",attr:{d:"M634.91 154.88C457.74-8.99 182.19-8.93 5.09 154.88c-6.66 6.16-6.79 16.59-.35 22.98l34.24 33.97c6.14 6.1 16.02 6.23 22.4.38 145.92-133.68 371.3-133.71 517.25 0 6.38 5.85 16.26 5.71 22.4-.38l34.24-33.97c6.43-6.39 6.3-16.82-.36-22.98zM320 352c-35.35 0-64 28.65-64 64s28.65 64 64 64 64-28.65 64-64-28.65-64-64-64zm202.67-83.59c-115.26-101.93-290.21-101.82-405.34 0-6.9 6.1-7.12 16.69-.57 23.15l34.44 33.99c6 5.92 15.66 6.32 22.05.8 83.95-72.57 209.74-72.41 293.49 0 6.39 5.52 16.05 5.13 22.05-.8l34.44-33.99c6.56-6.46 6.33-17.06-.56-23.15z"}}]})(n)}function sWe(n){return sr({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M507.73 109.1c-2.24-9.03-13.54-12.09-20.12-5.51l-74.36 74.36-67.88-11.31-11.31-67.88 74.36-74.36c6.62-6.62 3.43-17.9-5.66-20.16-47.38-11.74-99.55.91-136.58 37.93-39.64 39.64-50.55 97.1-34.05 147.2L18.74 402.76c-24.99 24.99-24.99 65.51 0 90.5 24.99 24.99 65.51 24.99 90.5 0l213.21-213.21c50.12 16.71 107.47 5.68 147.37-34.22 37.07-37.07 49.7-89.32 37.91-136.73zM64 472c-13.25 0-24-10.75-24-24 0-13.26 10.75-24 24-24s24 10.74 24 24c0 13.25-10.75 24-24 24z"}}]})(n)}const Wa=()=>{const{sendMessage:n,isLoaded:e}=Lo(),i=k.useRef([]),o=k.useCallback(()=>{if(e)for(;i.current.length>0;){const{eventName:u,data:p}=i.current.shift();G.log("useSendUnityEvent: Processing queued event to Unity:",u,p);try{n("ReactIncomingEvent","HandleEvent",JSON.stringify({eventName:u,data:JSON.stringify(p)}))}catch(y){G.error("useSendUnityEvent: Error sending event to Unity:",y),i.current.unshift({eventName:u,data:p});break}}},[n,e]);return k.useEffect(()=>{const u=setInterval(()=>{o()},1e3);return()=>clearInterval(u)},[o]),k.useCallback((u,p)=>{G.log("useSendUnityEvent: Queuing event for Unity:",u),i.current.push({eventName:u,data:p}),o()},[o])},zc=()=>{const{addEventListener:n,removeEventListener:e}=Lo();return k.useCallback((i,o)=>{const l=u=>{G.log(i+" unity message received.");let p=null;if(u)try{p=JSON.parse(u)}catch(y){G.warn("Failed to parse JSON data from Unity message:",y)}o(p)};return n(i,l),()=>{e(i,l)}},[n,e])},Yae=()=>{const[n,e]=k.useState({}),[i,o]=k.useState(!1),[l,u]=k.useState(null),[p,y]=k.useState(0),E=Wa(),b=zc(),{spaceID:T,sendMessage:R,isLoaded:O}=Lo(),L=k.useCallback((Y,W)=>{if(!Y)return;G.log(`useHLSStream: Sending stream URL to Unity: ${Y} for player ${W}`);const re={identifier:"LiveProjector",playerIndex:W.toString(),streamUrl:Y};if(E("SetHLSStream",re),O&&R)try{G.log("useHLSStream: Sending with ReactIncomingEvent approach"),R("ReactIncomingEvent","HandleEvent",JSON.stringify({eventName:"SetHLSStream",data:JSON.stringify(re)})),G.log("useHLSStream: Sending with direct HLSStream approach"),R("HLSStream","SetHLSStream",JSON.stringify({identifier:"LiveProjector",playerIndex:W.toString(),streamUrl:Y})),G.log("useHLSStream: Sending with most direct approach possible"),R("LiveProjector","SetStreamUrl",Y),R("HLSStreamClient","SetStreamUrl",JSON.stringify({Index:W.toString(),Url:Y}))}catch(le){G.error("useHLSStream: Error with direct message:",le)}else G.warn("useHLSStream: Unity not loaded, could not send direct message")},[E,R,O]);k.useEffect(()=>{T&&D(T)},[T]);const D=async Y=>{try{if(!Y){G.warn("useHLSStream: Cannot load stream from Firebase - no spaceID");return}o(!0),G.log(`useHLSStream: Loading stream from Firebase for space ${Y}`);const W=await Rae(Y);if(W&&W.streamUrl)if(G.log(`useHLSStream: Loaded stream data from Firebase for space ${Y}`,W),u(W),O)G.log("useHLSStream: Unity is loaded, sending stream URL to Unity after delay"),setTimeout(()=>{L(W.streamUrl,W.playerIndex||"0")},500),setTimeout(()=>{G.log("useHLSStream: Sending backup stream URL to Unity after longer delay"),L(W.streamUrl,W.playerIndex||"0")},2e3);else{G.warn("useHLSStream: Unity is not loaded yet, will try again later");const re=setInterval(()=>{O&&(G.log("useHLSStream: Unity is now loaded, sending stream URL to Unity"),L(W.streamUrl,W.playerIndex||"0"),clearInterval(re))},1e3);setTimeout(()=>{clearInterval(re)},3e4)}else G.log(`useHLSStream: No saved stream found for space ${Y}`),u(null)}catch(W){G.error(`useHLSStream: Error loading stream from Firebase for space ${Y}`,W)}finally{o(!1)}},U=k.useCallback(async()=>{T&&(G.log(`useHLSStream: Forcing reload of stream data for space ${T}`),y(Y=>Y+1),await D(T))},[T]),F=k.useCallback(async(Y,W=0,re={})=>{try{if(!Y||!Y.trim()){G.error("useHLSStream: Invalid stream URL");return}o(!0),G.log(`useHLSStream: Setting HLS stream URL for LiveProjector[${W}]`,Y);const{enabled:le=!0,rtmpUrl:ie="",streamKey:me="",skipSendToUnity:q=!1}=re;if(q||L(Y,W),T)try{const J={streamUrl:Y,playerIndex:W.toString(),enabled:le,rtmpUrl:ie,streamKey:me,updatedAt:new Date().toISOString()};G.log(`useHLSStream: Saving stream URL to Firebase for space ${T}`,J),await Y5(T,J),u(J)}catch(J){throw G.error(`useHLSStream: Error saving stream URL to Firebase for space ${T}`,J),J}else G.warn("useHLSStream: No spaceID available, stream URL not saved to Firebase")}finally{o(!1)}},[L,T]);return k.useEffect(()=>{const W=b("SetHLSStream",re=>{if(re)try{G.log("useHLSStream: Received player status update",re);const{identifier:le,playerIndex:ie,isReady:me,isPlaying:q}=re,J=`${le}_${ie}`;e(Q=>({...Q,[J]:{identifier:le,playerIndex:ie,isReady:me,isPlaying:q}}))}catch(le){G.error("useHLSStream: Error handling player status update",le)}});return()=>{W()}},[b]),k.useEffect(()=>{if(l&&l.streamUrl){G.log("useHLSStream: Resending saved stream URL to Unity");const Y=setTimeout(()=>{L(l.streamUrl,l.playerIndex||"0")},1e3);return()=>clearTimeout(Y)}},[l,n,L,p]),k.useEffect(()=>{const Y=W=>{if(W.detail){if(G.log("useHLSStream: Received stream update event",W.detail),T===W.detail.spaceId)G.log(`useHLSStream: Stream update is for our space ${T}, loading stream data`),D(T);else if(W.detail.streamUrl){G.log(`useHLSStream: Using stream URL directly from event: ${W.detail.streamUrl}`);const re=W.detail.playerIndex||"0";L(W.detail.streamUrl,re),u(W.detail)}}};return window.addEventListener("SpaceHLSStreamUpdated",Y),window.addEventListener("SpaceStreamUpdated",Y),()=>{window.removeEventListener("SpaceHLSStreamUpdated",Y),window.removeEventListener("SpaceStreamUpdated",Y)}},[T,L]),{setHLSStreamUrl:F,playerStatus:n,isLoading:i,savedStreamData:l,reloadStreamData:U}},oWe=()=>{const[n,e]=k.useState(!1),i=zc();return k.useEffect(()=>{const l=i("FirstSceneLoaded",()=>{G.log("FirstSceneLoaded unity message received."),e(!0)});return()=>{l()}},[i]),n},aWe=()=>{const[n,e]=k.useState(null),i=zc();return k.useEffect(()=>{const u=i("OpenNameplateModal",p=>{if(!p){G.warn("Received empty data in nameplate click handler");return}try{const y=typeof p=="string"?JSON.parse(p):p;let E=y.uid||y.playerId;E&&E.startsWith("[Player:")&&(G.warn("PlayerId is in [Player:X] format, cannot extract UID"),E=null),e({playerName:y.playerName,playerId:y.playerId,uid:E,isLocalPlayer:y.isLocalPlayer})}catch(y){G.error("Error processing nameplate data:",y)}});return()=>{typeof u=="function"&&u()}},[i]),[n,()=>{e(null)}]},cWe=()=>{const n=zc(),{sendUserToUnity:e}=k.useContext(Di);return k.useEffect(()=>{const o=n("RequestUserForUnity",async()=>{G.log("React: Request from Unity to send user data"),await e()});return()=>{o()}},[n,e]),!0},AZ=async(n,e,i,o={})=>{try{const{mediaType:l="image",displayAsVideo:u=!1,directUrl:p=null}=o;if(!n||!e)throw new Error("Missing required parameters: spaceId and mediaScreenId");let y=null;if(i){const E=checkClientRateLimit("fileUpload",n);if(!E.allowed)throw new Error(E.message);if(!i.type.startsWith("image/"))throw new Error("File must be an image");const b=10*1024*1024;if(i.size>b)throw new Error("File size must be less than 10MB");const T=OE(),R=Date.now(),O=i.name.split(".").pop(),L=`${e}_${R}.${O}`,D=PE(T,`spaces/${n}/mediaScreens/${L}`);G.log(`Uploading image for media screen ${e} in space ${n}`);const U=await K3(D,i);y=await dx(U.ref);const F=dr(Fn,`spaces/${n}/mediaScreens`,e);await Xg(F,{imageUrl:y,gsUrl:`gs://${U.ref.bucket}/${U.ref.fullPath}`,fileName:L,mediaType:l,displayAsVideo:u,uploadedAt:new Date().toISOString(),updatedAt:new Date().toISOString()},{merge:!0})}else if(p){y=p;const E=dr(Fn,`spaces/${n}/mediaScreens`,e);await Xg(E,{videoUrl:p,mediaType:l,displayAsVideo:u,uploadedAt:new Date().toISOString(),updatedAt:new Date().toISOString()},{merge:!0})}else throw new Error("Either imageFile or directUrl must be provided");return G.log(`Successfully uploaded ${l} for media screen ${e} (display as video: ${u})`),y}catch(l){throw G.error(`Error uploading media screen ${(o==null?void 0:o.mediaType)||"image"}:`,l),l}},r4=async n=>{G.log(`Getting media screen images for space: ${n}`);try{const e=mc(Fn,`spaces/${n}/mediaScreens`),i=await _d(e),o=[];return i.forEach(l=>{o.push({id:l.id,...l.data()})}),o}catch(e){throw G.error("Error fetching media screen images from Firestore:",e),e}},_E=async(n,e)=>{try{const i=dr(Fn,`spaces/${n}/mediaScreens`,e),o=await Qo(i);return o.exists()?{id:o.id,...o.data()}:(G.warn(`No media screen found with ID: ${e}`),null)}catch(i){throw G.error("Error fetching media screen image:",i),i}},lWe=async(n,e)=>{try{const i=await _E(n,e);if(!i)return G.warn(`No media screen found with ID: ${e} to delete`),!1;if(i.gsUrl){const l=OE(),u=PE(l,i.gsUrl);try{await q3(u),G.log(`Deleted file from storage: ${i.gsUrl}`)}catch(p){G.warn(`Could not delete file from storage: ${p.message}`)}}const o=dr(Fn,`spaces/${n}/mediaScreens`,e);return i.mediaType==="video"?(await qs(o,{videoUrl:null,mediaType:null,displayAsVideo:!1,deletedAt:new Date().toISOString(),updatedAt:new Date().toISOString()}),G.log(`Successfully removed video for media screen ${e}`)):(await qs(o,{imageUrl:null,gsUrl:null,fileName:null,mediaType:null,displayAsVideo:!1,deletedAt:new Date().toISOString(),updatedAt:new Date().toISOString()}),G.log(`Successfully removed image for media screen ${e}`)),!0}catch(i){throw G.error("Error deleting media screen image:",i),i}},uWe=async(n,e,i)=>{try{if(!n||!e||typeof i!="boolean")throw new Error("Missing or invalid required parameters");const o=await _E(n,e);if(!o||!o.imageUrl&&!o.videoUrl)return G.warn(`No media screen content found with ID: ${e} to update`),!1;const l=dr(Fn,`spaces/${n}/mediaScreens`,e);return await qs(l,{displayAsVideo:i,updatedAt:new Date().toISOString()}),G.log(`Successfully updated display mode for media screen ${e} to ${i?"video":"image"}`),!0}catch(o){throw G.error("Error updating media screen display mode:",o),o}},dWe=n=>{if(!n)return null;try{if(n.includes("firebasestorage.googleapis.com")){const e=new URL(n),i=e.searchParams.get("alt"),o=e.searchParams.get("token");return e.search="",i&&e.searchParams.set("alt",i),o&&e.searchParams.set("token",o),e.toString()}return n}catch(e){return console.error("Error cleaning Firebase URL:",e),n}},Xae=()=>{const{spaceID:n}=Lo(),e=Wa(),[i,o]=k.useState(!1);k.useEffect(()=>{if(window.isPlayerInstantiated){G.log("useUnityMediaScreenImages: Unity already ready (via window flag)"),o(!0);return}const l=()=>{G.log("useUnityMediaScreenImages: Unity is now ready (PlayerInstantiated event)"),o(!0)};return window.addEventListener("PlayerInstantiated",l),()=>{window.removeEventListener("PlayerInstantiated",l)}},[]),k.useEffect(()=>{if(!i){G.log("useUnityMediaScreenImages: Waiting for Unity to be ready before loading media screens");return}G.log("useUnityMediaScreenImages: Unity is ready, now loading media screens"),(async()=>{try{if(!n)throw new Error("spaceID is not defined.");const u=await r4(n);G.log("Fetched Media Screen Images",u),u.forEach(p=>{const{id:y,imageUrl:E,displayAsVideo:b,videoUrl:T}=p;let R=null;(!b||!T)&&(R=E?dWe(E):null),e("SetMediaScreenImage",{mediaScreenId:y,imageUrl:R,videoUrl:T||null,displayAsVideo:b||!1,timestamp:Date.now()}),G.log(`Sent media screen data for ${y} to Unity (displayAsVideo: ${b})`),b&&T&&(e("SetMediaScreenDisplayMode",{mediaScreenId:y,displayAsVideo:!0,videoUrl:T,timestamp:Date.now()}),G.log(`Set display mode to video for screen ${y}`))})}catch(u){G.error("Error fetching media screen images:",u)}})()},[e,n,i])},hWe=()=>{const{spaceID:n}=Lo(),e=Wa(),[i,o]=k.useState(!1);k.useEffect(()=>{if(window.isPlayerInstantiated){G.log("useUnityThumbnails: Unity already ready (via window flag)"),o(!0);return}const l=()=>{G.log("useUnityThumbnails: Unity is now ready (PlayerInstantiated event)"),o(!0)};return window.addEventListener("PlayerInstantiated",l),()=>{window.removeEventListener("PlayerInstantiated",l)}},[]),k.useEffect(()=>{if(!i){G.log("useUnityThumbnails: Waiting for Unity to be ready before loading thumbnails");return}G.log("useUnityThumbnails: Unity is ready, now loading thumbnails"),(async()=>{try{if(!n)throw new Error("spaceID is not defined.");const u=await Cae(n),p=async b=>{const T=`https://vimeo.com/api/oembed.json?url=${b}`,R=await fetch(T);if(!R.ok)throw new Error(`Failed to fetch thumbnail: ${R.statusText}`);const O=await R.json(),L=O.thumbnail_url.replace(/_\d+x\d+/,""),D=["640x360","295x166"];let U=null;for(let F of D){const Y=`https://i.vimeocdn.com/filter/overlay?src0=${encodeURIComponent(`${L}_${F}`)}&src1=http://f.vimeocdn.com/p/images/crawler_play.png`;try{if((await fetch(Y,{method:"HEAD"})).ok){U=Y;break}}catch(W){console.warn(`Failed to validate thumbnail URL: ${Y}`,W)}}return U||O.thumbnail_url},y=u.map(async b=>{const T=await p(b.url);return{gameObjectName:b.id,thumbnailUrl:T}}),E=await Promise.all(y);G.log("Fetched Thumbnails",E),E.forEach(({gameObjectName:b,thumbnailUrl:T})=>{e("SetThumbnail",{gameObjectName:b,thumbnailUrl:T})})}catch(u){G.error("Error fetching thumbnails:",u)}})()},[e,n,i])},Jae=()=>{const[n,e]=k.useState([]),i=zc();return k.useEffect(()=>{let o=!0,l=null;const u=()=>{window.unityInstance&&(G.log("Requesting fresh player list"),window.unityInstance.SendMessage("NetworkManager","RequestPlayerList"))},p=L=>{if(o){G.log("UpdatePlayerList unity message received.");try{let D=[];if(typeof L=="object"&&L!==null?D=L.players||[]:D=JSON.parse(L).players||[],Array.isArray(D)){const U=Array.from(new Map(D.map(F=>[F.playerId,F])).values());e(U),l&&(clearTimeout(l),l=null)}}catch(D){G.error("Error handling player list data:",D),l||(l=setTimeout(u,1e3))}}},y=()=>{G.log("Player disconnected, requesting fresh player list"),u()},E=()=>{G.log("Player left, requesting fresh player list"),u()};u();const b=i("UpdatePlayerList",p),T=i("PlayerDisconnected",y),R=i("PlayerLeft",E),O=setInterval(u,5e3);return()=>{o=!1,l&&clearTimeout(l),typeof b=="function"&&b(),typeof T=="function"&&T(),typeof R=="function"&&R(),clearInterval(O)}},[i]),n},Qae=()=>{const n=Wa(),e=k.useCallback((o,l,u,p,y,E)=>{const b=u||{x:0,y:1.5,z:0},T=p||{x:0,y:0,z:0},R=y||{x:1,y:1,z:1};try{const O={portalId:o,prefabName:l||"PortalObjectPrefab",position:b,rotation:T,scale:R,initialImageUrl:E};return G.log("Sending portal placement to Unity:",O),n("PlacePortalPrefab",O),!0}catch(O){return G.error("Error placing portal:",O),!1}},[n]),i=k.useCallback((o,l,u,p,y,E)=>{const b=u||{x:0,y:1.5,z:0},T=p||{x:0,y:0,z:0},R=y||{x:1,y:1,z:1};try{const O={portalId:o,prefabName:l||"PortalObjectPrefab",position:b,rotation:T,scale:R,initialImageUrl:E},L={eventName:"PlacePortalPrefab",data:JSON.stringify(O)};return G.log("Directly sending portal placement to Unity:",O),window.unityInstance.SendMessage("ReactIncomingEvent","HandleEvent",JSON.stringify(L)),!0}catch(O){return G.error("Error directly placing portal:",O),!1}},[]);return{placePortal:e,directPlacePortal:i,isUnityLoaded:!0}},Zae=()=>{const n=Wa(),e=k.useCallback((o,l,u,p,y)=>{const E=u||{x:0,y:0,z:0},b=p||{x:0,y:0,z:0},T=y||{x:1,y:1,z:1};try{const R={hotspotId:o,glbUrl:l,position:E,rotation:b,scale:T};return G.log("Sending seating hotspot placement to Unity:",R),n("SeatingHotspot",R),!0}catch(R){return G.error("Error placing seating hotspot:",R),!1}},[n]),i=k.useCallback((o,l,u,p,y)=>{const E=u||{x:0,y:0,z:0},b=p||{x:0,y:0,z:0},T=y||{x:1,y:1,z:1};try{const R={hotspotId:o,glbUrl:l,position:E,rotation:b,scale:T},O={eventName:"SeatingHotspot",data:JSON.stringify(R)};return G.log("Directly sending seating hotspot placement to Unity:",R),window.unityInstance.SendMessage("ReactIncomingEvent","HandleEvent",JSON.stringify(O)),!0}catch(R){return G.error("Error directly placing seating hotspot:",R),!1}},[]);return{placeCatalogueItem:e,directPlaceCatalogueItem:i,isUnityLoaded:!0}},pWe=j3(cx,"trackAnalytics"),fWe=j3(cx,"createAnalyticsSession"),mWe=j3(cx,"endAnalyticsSession"),gWe=async(n,e={})=>{try{G.log(`Creating secure analytics session for space ${n}`);const i=await fWe({spaceId:n,sessionData:{userAgent:typeof navigator<"u"?navigator.userAgent:"unknown",deviceType:typeof navigator<"u"&&/Mobile|Android|iPhone|iPad/.test(navigator.userAgent)?"mobile":"desktop",sessionType:"webgl",startUrl:typeof window<"u"?window.location.href:"unknown",referrer:typeof document<"u"?document.referrer:"unknown",...e}});return G.log(`Secure analytics session created: ${i.data.sessionId}`),i.data.sessionId}catch(i){throw G.error("Error creating secure analytics session:",i),i}},_We=async(n,e,i,o={})=>{try{G.log(`Tracking secure analytics event: ${i} in space ${n}`);const l=await pWe({spaceId:n,sessionId:e,eventType:i,eventData:{...o,timestamp:new Date().toISOString(),clientSide:!0}});return G.log(`Secure analytics event tracked: ${i} (${l.data.eventId})`),l.data.eventId}catch(l){throw G.error("Error tracking secure analytics event:",l),l}},yWe=async(n,e)=>{try{if(G.log(`Ending secure analytics session: ${e} in space ${n}`),!n||!e)throw G.error("endAnalyticsSessionSecure: Missing required parameters",{spaceId:n,sessionId:e,spaceIdType:typeof n,sessionIdType:typeof e}),new Error(`Missing required parameters: spaceId=${n}, sessionId=${e}`);await mWe({spaceId:n,sessionId:e}),G.log(`Secure analytics session ended: ${e}`)}catch(i){throw G.error("Error ending secure analytics session:",i),i}},fo={UNITY:{VIDEO_PLAY:"unity_video_play",VIDEO_PAUSE:"unity_video_pause",VIDEO_COMPLETE:"unity_video_complete",PORTAL_CLICK:"unity_portal_click",PORTAL_NAVIGATE:"unity_portal_navigate",MEDIA_SCREEN_CLICK:"unity_media_screen_click",NAMEPLATE_CLICK:"unity_nameplate_click",OBJECT_INTERACT:"unity_object_interact",PLAYER_MOVE:"unity_player_move",PLAYER_SPAWN:"unity_player_spawn",SPACE_LOAD:"unity_space_load",SPACE_READY:"unity_space_ready"},REACT:{MODAL_OPEN:"react_modal_open",MODAL_CLOSE:"react_modal_close",UI_CLICK:"react_ui_click",USER_LOGIN:"react_user_login",USER_LOGOUT:"react_user_logout",SPACE_ENTER:"react_space_enter",SPACE_EXIT:"react_space_exit",CHAT_MESSAGE:"react_chat_message",UPLOAD_START:"react_upload_start",UPLOAD_COMPLETE:"react_upload_complete",SETTINGS_CHANGE:"react_settings_change",VIDEO_CLICK:"react_video_click",VIDEO_CLOSE:"react_video_close",BUTTON_CLICK:"react_button_click",FORM_SUBMIT:"react_form_submit",ERROR_OCCURRED:"react_error_occurred"}},mo={NAVIGATION:"navigation",MEDIA_INTERACTION:"media_interaction",SOCIAL_INTERACTION:"social_interaction",UI_INTERACTION:"ui_interaction",SYSTEM_EVENT:"system_event",USER_BEHAVIOR:"user_behavior",CONTENT_INTERACTION:"content_interaction",PERFORMANCE:"performance"},EWe=async(n,e,i={})=>{try{return G.log(`Creating secure analytics session for user ${e} in space ${n}`),await gWe(n,i)}catch(o){throw G.error("Error creating analytics session:",o),o}},DC=async(n,e,i,o={})=>{try{return G.log(`Tracking secure analytics event: ${i} in space ${n}`),await _We(n,e,i,o)}catch(l){throw G.error("Error tracking analytics event:",l),l}},PZ=async(n,e)=>{try{G.log(`Ending secure analytics session: ${e} in space ${n}`),await yWe(n,e)}catch(i){throw G.error("Error ending analytics session:",i),i}},vWe=async(n,e,i,o)=>DC(n,e,fo.UNITY.VIDEO_PLAY,{userId:i,category:mo.MEDIA_INTERACTION,source:"unity",videoId:o.gameObjectName,videoUrl:o.videoUrl,spaceId:n,...o}),kE=(n,e={})=>{const{user:i}=k.useContext(Di),o=k.useRef(null),[l,u]=k.useState(!1),[p,y]=k.useState(!1),E=k.useRef(!1),b=k.useRef(!1),T=k.useRef(!1),R=k.useRef(!1),{autoStart:O=!0,sessionMetadata:L={},enableDebugLogs:D=!1}=e;k.useEffect(()=>(i&&n&&O&&!o.current&&!T.current&&U(),()=>{o.current&&!R.current&&(D&&G.log("Component unmounting, ending analytics session"),F())}),[i,n,O,D]),k.useEffect(()=>{const q=()=>{document.hidden&&o.current&&!R.current&&(D&&G.log("Page hidden, ending analytics session"),F())},J=()=>{o.current&&!R.current&&(D&&G.log("Page unloading, ending analytics session"),F())};return document.addEventListener("visibilitychange",q),window.addEventListener("beforeunload",J),()=>{document.removeEventListener("visibilitychange",q),window.removeEventListener("beforeunload",J)}},[D]);const U=k.useCallback(async()=>{if(!i||!n||o.current||T.current){D&&G.log("Analytics session already initializing or initialized, skipping");return}try{T.current=!0,y(!0);const q=await EWe(n,i.uid,{unityVersion:window.unityVersion||"unknown",reactVersion:"18.x",startUrl:window.location.href,referrer:document.referrer,...L});o.current=q,u(!0),E.current?D&&G.log(" Analytics: Space entry already tracked for this session, skipping duplicate"):(await DC(n,q,fo.REACT.SPACE_ENTER,{userId:i.uid,category:mo.NAVIGATION,source:"react",spaceId:n,timestamp:new Date().toISOString()}),E.current=!0,D&&G.log(` Analytics: Space entry tracked for session ${q}`)),D&&G.log(`Analytics session initialized: ${q} for space ${n}`)}catch(q){G.error("Failed to initialize analytics session:",q),y(!1)}finally{T.current=!1}},[i,n,L,D]),F=k.useCallback(async()=>{if(D&&G.log("endSession called with:",{sessionId:o.current,spaceId:n,sessionIdType:typeof o.current,spaceIdType:typeof n}),!o.current||!n){D&&G.log("endSession: Missing required parameters, skipping",{sessionId:o.current,spaceId:n});return}if(R.current){D&&G.log("endSession: Already ending session, skipping duplicate call");return}try{R.current=!0,b.current?D&&G.log(" Analytics: Space exit already tracked for this session, skipping duplicate"):(await DC(n,o.current,fo.REACT.SPACE_EXIT,{userId:i==null?void 0:i.uid,category:mo.NAVIGATION,source:"react",spaceId:n,timestamp:new Date().toISOString()}),b.current=!0,D&&G.log(` Analytics: Space exit tracked for session ${o.current}`));const q=o.current;q&&n&&(await PZ(n,q),D&&G.log(`Analytics session ended: ${q}`)),o.current=null,u(!1),y(!1),E.current=!1,b.current=!1}catch(q){G.error("Failed to end analytics session:",q)}finally{R.current=!1}},[n,i==null?void 0:i.uid,D,DC,PZ]),Y=k.useCallback(async(q,J={})=>{if(!o.current||!n||!p)return D&&G.warn("Cannot track event: No active analytics session"),null;try{const Q=await DC(n,o.current,q,{userId:i==null?void 0:i.uid,spaceId:n,timestamp:new Date().toISOString(),...J});return D&&G.log(`Analytics event tracked: ${q}`,J),Q}catch(Q){return G.error("Failed to track analytics event:",Q),null}},[n,i==null?void 0:i.uid,p,D]),W=k.useCallback(async q=>{if(!o.current||!n||!p)return D&&G.warn("Cannot track video play: No active analytics session"),null;try{const J=await vWe(n,o.current,i==null?void 0:i.uid,q);return D&&G.log("Video play event tracked:",q),J}catch(J){return G.error("Failed to track video play event:",J),null}},[n,i==null?void 0:i.uid,p,D]),re=k.useCallback(async(q,J={})=>Y(q,{...J,source:"unity",category:J.category||mo.USER_BEHAVIOR}),[Y]),le=k.useCallback(async(q,J={})=>Y(q,{...J,source:"react",category:J.category||mo.UI_INTERACTION}),[Y]),ie=k.useCallback(async(q,J,Q={})=>{const ne=q==="open"?fo.REACT.MODAL_OPEN:fo.REACT.MODAL_CLOSE;return le(ne,{modalName:J,action:q,category:mo.UI_INTERACTION,...Q})},[le]),me=k.useCallback(async()=>{o.current&&await F(),await U()},[F,U]);return{isInitialized:l,isTracking:p,sessionId:o.current,track:Y,trackVideoPlay:W,trackUnityEvent:re,trackReactEvent:le,trackModal:ie,initializeSession:U,endSession:F,restartSession:me,isReady:l&&p&&o.current!==null}},SWe=n=>{const[e,i]=k.useState(null),{user:o}=k.useContext(Di),l=zc(),{spaceID:u}=Lo(),{trackUnityEvent:p,isReady:y}=kE(u,{enableDebugLogs:!0});return k.useEffect(()=>{let b=!0;const R=l("PlayVideo",async O=>{try{const{gameObjectName:L}=O;if(!L){G.error("Game object name is missing in Unity event data.");return}const D=await Cae(u);G.log("SPACES VIDEOS",D);const U=D.find(F=>F.id===L);U&&b?(i(U.url),G.log("Video URL set to:",U.url),y&&o&&(p(fo.UNITY.VIDEO_PLAY,{category:mo.MEDIA_INTERACTION,videoId:L,videoUrl:U.url,videoTitle:U.title||U.name||L,isEditMode:!1,spaceId:u,timestamp:new Date().toISOString(),videoData:{gameObjectName:L,videoMetadata:U}}),G.log(" Analytics: Video play event tracked for:",L))):console.error("Video not found for game object:",L)}catch(L){console.error("Error fetching space videos:",L)}});return()=>{b=!1,R()}},[l,u,n]),[e,()=>{i(null)}]},bWe=()=>{const[n,e]=k.useState(null),[i,o]=k.useState(!1),[l,u]=k.useState(null),p=zc(),y=Wa();k.useEffect(()=>p("KickPlayerResult",R=>{G.log("KickPlayerResult event received:",R),R?(e(R),o(!1),R.success?u(null):u(R.errorMessage||"Failed to kick player")):(G.error("Invalid KickPlayerResult data from Unity"),u("Invalid result from Unity"),o(!1))}),[p]);const E=k.useCallback((T,R)=>{var O;try{if(!T){u("Player UID is required");return}o(!0),u(null),e(null);const L={uid:T,requestedBy:R||((O=window.currentUser)==null?void 0:O.uid)};G.log("Sending KickPlayer event to Unity:",L),y("KickPlayer",L)}catch(L){G.error("Error kicking player:",L),u(L.message||"Failed to send kick request"),o(!1)}},[y]),b=k.useCallback(()=>{e(null),u(null),o(!1)},[]);return{kickPlayer:E,isKicking:i,kickResult:n,error:l,resetKickState:b}},wWe=n=>{const{placePortal:e}=Qae();k.useEffect(()=>{const i=async()=>{try{const o=mc(Fn,"spaces",n,"portals"),l=await _d(o);if(l.empty){G.log("useSpacePortals: No portals found for space:",n);return}G.log(`useSpacePortals: Found ${l.size} portals for space ${n}`),l.forEach(u=>{const p=u.data();G.log(`useSpacePortals: Placing portal ${p.portalId} in Unity:`,p),e(p.portalId,p.prefabName,p.position,p.rotation,p.scale)})}catch(o){G.error("useSpacePortals: Error loading portals:",o)}};if(window.unityInstance)G.log("useSpacePortals: Unity is ready, loading portals"),i();else{const o=()=>{G.log("useSpacePortals: Unity ready event received, loading portals"),i()};return window.addEventListener("PlayerInstantiated",o),()=>{window.removeEventListener("PlayerInstantiated",o)}}},[n,e])},ece=async(n,e)=>{let i=null,o=null;try{if(!n||!e)throw new Error(`Invalid parameters: spaceId=${n}, portalId=${e}`);const u=dr(Fn,"spaces",n,"portals",e),p=await Qo(u);if(p.exists()){const y=p.data();i=y.targetSpaceId,o=y.targetSpaceName}else{console.warn(" Portal document not found in Firestore for:",e);const y=e.split("_");y.length>=3&&(i=y[2])}}catch(u){console.error(" Error fetching portal data from Firestore:",u);const p=e.split("_");p.length>=3&&(i=p[2])}return{targetSpaceId:i,targetSpaceName:o}},TWe=()=>{const[n,e]=k.useState(null),{user:i}=k.useContext(Di),o=zc(),{spaceID:l}=Lo(),{trackUnityEvent:u,isReady:p}=kE(l,{enableDebugLogs:!0});return k.useEffect(()=>{const b=o("PortalClicked",async T=>{try{const R=typeof T=="string"?JSON.parse(T):T;if(e(R),p&&i&&R&&R.portalId)try{const{targetSpaceId:O,targetSpaceName:L}=await ece(l,R.portalId);await u(fo.UNITY.PORTAL_CLICK,{category:mo.NAVIGATION,portalId:R.portalId,targetSpaceId:O,targetSpaceName:L,sourceSpaceId:l,isEditMode:!0,timestamp:new Date().toISOString()})}catch(O){console.error(" Analytics: Error tracking portal click:",O);try{await u(fo.UNITY.PORTAL_CLICK,{category:mo.NAVIGATION,portalId:R.portalId,targetSpaceId:null,targetSpaceName:null,sourceSpaceId:l,isEditMode:!0,timestamp:new Date().toISOString()})}catch(L){console.error(" Analytics: Failed to track portal click even with fallback:",L)}}}catch(R){console.error("Error parsing portal click data:",R,"Data:",T)}});return()=>{typeof b=="function"&&b()}},[o,p,i,l,u]),{clickedPortal:n,clearClickedPortal:()=>{e(null)},isAnalyticsReady:p,trackPortalClick:u}},CWe=()=>{const{user:n}=k.useContext(Di),e=zc(),{spaceID:i}=Lo(),{trackUnityEvent:o,isReady:l}=kE(i,{enableDebugLogs:!0});k.useEffect(()=>{const p=e("PortalNavigate",async y=>{try{const E=typeof y=="string"?JSON.parse(y):y;if(!E.portalId){console.error("Portal ID is missing from portal data");return}let b=null,T=null;try{const R=await ece(i,E.portalId);b=R.targetSpaceId,T=R.targetSpaceName}catch(R){console.error("Error fetching portal analytics data:",R);const O=E.portalId.split("_");O.length>=3&&(b=O[2])}if(b){if(l&&n&&E)try{await o(fo.UNITY.PORTAL_NAVIGATE,{category:mo.NAVIGATION,portalId:E.portalId,targetSpaceId:b,targetSpaceName:T,sourceSpaceId:i,isEditMode:!1,navigationType:"direct",timestamp:new Date().toISOString()})}catch(R){console.error(" Analytics: Error tracking portal navigation:",R)}window.location.href=`/?spaceId=${b}`}else console.error("Could not determine target space ID from portal:",E.portalId)}catch(E){console.error("Error handling portal navigation:",E)}});return()=>{typeof p=="function"&&p()}},[e,l,n,i,o])},RWe=n=>{const{placeCatalogueItem:e}=Zae(),i=Wa();k.useEffect(()=>{const o=async()=>{try{const l=mc(Fn,"spaces",n,"catalogue"),u=await _d(l);u.empty||(G.log(`useSpaceCatalogueItems: Initial load ${u.size} items for space ${n}`),u.forEach(p=>{const y=p.data();e(y.itemId,y.glbUrl,y.position,y.rotation,y.scale)})),ox(l,p=>{p.docChanges().forEach(y=>{const E=y.doc.data();if(y.type==="added")G.log("useSpaceCatalogueItems: Realtime add",E.itemId),e(E.itemId,E.glbUrl,E.position,E.rotation,E.scale);else if(y.type==="modified")G.log("useSpaceCatalogueItems: Realtime modify",E.itemId),i("UpdateCatalogueItem",{hotspotId:E.itemId,position:E.position,rotation:E.rotation,scale:E.scale});else if(y.type==="removed"){const b=(E==null?void 0:E.itemId)||y.doc.id;G.log("useSpaceCatalogueItems: Realtime remove",b),i("DeleteCatalogueItem",{hotspotId:b})}})})}catch(l){G.error("useSpaceCatalogueItems: Error loading catalogue items:",l)}};if(window.unityInstance)G.log("useSpaceCatalogueItems: Unity is ready, loading catalogue items"),o();else{const l=()=>{G.log("useSpaceCatalogueItems: Unity ready event received, loading catalogue items"),o()};return window.addEventListener("PlayerInstantiated",l),()=>{window.removeEventListener("PlayerInstantiated",l)}}},[n,e,i])},tce=()=>{const[n,e]=k.useState(null),i=zc();return k.useEffect(()=>{G.log("Setting up seating hotspot click listener...");const u=i("SeatingHotspotClicked",async p=>{G.log(" Seating hotspot click event received from Unity:",p);try{const y=typeof p=="string"?JSON.parse(p):p;G.log(" Parsed Unity click data:",y);const E=y.hotspotId.split("_");if(E.length>=3){const b=E.slice(1,-1).join("_");G.log(" Extracted spaceId:",b);const T=dr(Fn,"spaces",b,"catalogue",y.hotspotId);G.log(" Fetching from Firebase path:",`spaces/${b}/catalogue/${y.hotspotId}`);const R=await Qo(T);if(R.exists()){const O=R.data();G.log(" Fetched Firebase data:",O),G.log(" Firebase position:",O.position),G.log(" Unity position:",y.position);const L={...y,position:O.position||y.position,rotation:O.rotation||y.rotation,scale:O.scale||y.scale};G.log(" Combined data being set:",L),e(L)}else G.warn(" Item not found in Firebase:",y.hotspotId),e(y)}else G.error(" Invalid hotspot ID format:",y.hotspotId),e(y)}catch(y){G.error(" Error handling seating hotspot click:",y,"Data:",p)}});return()=>{G.log("Cleaning up seating hotspot click listener"),typeof u=="function"&&u()}},[i]),{clickedItem:n,clearClickedItem:()=>{G.log("Clearing clicked item state"),e(null)}}},IWe=n=>({opacity:1});function AWe(){const{loadingProgression:n,isLoaded:e,error:i,spaceID:o}=Lo(),{user:l}=k.useContext(Di),[u,p]=k.useState(!1),[y,E]=k.useState(!1),[b,T]=k.useState(!1),[R,O]=k.useState(!1),L=k.useRef(!1),D=k.useRef(!1),U=k.useRef(null),F=k.useRef(null),Y=k.useRef(null),W=zc(),re=k.useRef(null),le=k.useRef(null),ie=k.useRef(null);k.useRef(null),k.useEffect(()=>{(async()=>{if(!l&&n===0)try{const Q=await _o(o);Q&&Q.allowGuestUsers===!0?p(!1):p(!0)}catch(Q){console.error("LoaderProgress: Cannot verify space guest access, showing sign-in prompt for security:",Q),p(!0)}else p(!1)})()},[l,n,o]),k.useEffect(()=>{const J=document.createElement("style");return J.textContent=`
      /* Set initial Unity canvas styles */
      #unity-canvas, #unity-container {
        opacity: 0 !important;
        transition: opacity 1s ease-in-out;
        z-index: 1 !important; /* Ensure Unity is below our loader */
      }
      
      /* Loader overlay styles */
      .loader-overlay {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(0, 0, 0, 0.5);
        z-index: 99999 !important; /* Extremely high z-index */
        display: flex;
        align-items: center;
        justify-content: center;
        transition: opacity 1.5s ease-in-out;
        pointer-events: auto !important;
        transform: translateZ(0); /* Create stacking context */
      }
      
      /* Loader content styles */
      .loader-content {
        background-color: rgba(0, 0, 0, 0.8);
        padding: 1rem;
        border-radius: 0.5rem;
        color: white;
        text-align: center;
        z-index: 100000 !important; /* Even higher z-index */
      }
    `,document.head.appendChild(J),re.current=J,()=>{re.current&&document.head.removeChild(re.current)}},[]),k.useEffect(()=>{const J=()=>{const Q=document.getElementById("unity-canvas"),ne=document.getElementById("unity-container");Q&&(U.current=Q,Q.style.zIndex="1"),ne&&(F.current=ne,ne.style.zIndex="1"),Q&&ne&&ie.current&&(clearInterval(ie.current),ie.current=null)};return J(),ie.current=setInterval(J,100),()=>{ie.current&&(clearInterval(ie.current),ie.current=null)}},[]),k.useEffect(()=>{window.isFirstSceneLoaded&&(D.current=!0,O(!0));const Q=W("FirstSceneLoaded",()=>{D.current=!0,O(!0),window.isFirstSceneLoaded=!0}),ne=setTimeout(()=>{D.current||(D.current=!0,O(!0),window.isFirstSceneLoaded=!0)},1e4);return()=>{Q(),clearTimeout(ne)}},[W]),k.useEffect(()=>{window.isPlayerInstantiated&&(L.current=!0,T(!0),D.current||(D.current=!0,O(!0),window.isFirstSceneLoaded=!0));const J=()=>{L.current=!0,T(!0),D.current||(D.current=!0,O(!0),window.isFirstSceneLoaded=!0)};window.addEventListener("PlayerInstantiated",J);const Q=W("PlayerInstantiated",J),ne=setTimeout(()=>{L.current||(L.current=!0,T(!0),D.current||(D.current=!0,O(!0),window.isFirstSceneLoaded=!0))},2e4);return()=>{window.removeEventListener("PlayerInstantiated",J),Q(),clearTimeout(ne)}},[W]),k.useEffect(()=>(R&&b&&(le.current&&clearTimeout(le.current),le.current=setTimeout(()=>{U.current&&(U.current.style.opacity="1",U.current.style.removeProperty("opacity")),F.current&&(F.current.style.opacity="1",F.current.style.removeProperty("opacity")),Y.current&&(Y.current.style.opacity="0",Y.current.style.pointerEvents="none",setTimeout(()=>{Y.current&&(Y.current.style.display="none")},1500))},2e3)),()=>{le.current&&clearTimeout(le.current)}),[R,b]);const me=()=>e?e&&!R&&!b?"Scene initializing":R&&!b?"Player initializing":"Ready":"World loading",q=()=>e?e&&!R&&!b?85:R&&!b?95:100:n*80;return S.jsx(S.Fragment,{children:u?S.jsx(He,{position:"absolute",zIndex:"99999",width:"100%",height:"100%",display:"flex",alignItems:"center",justifyContent:"center",style:{transform:"translateZ(0)"},children:S.jsxs(Qn,{spacing:4,padding:6,borderRadius:"md",backgroundColor:"rgba(0, 0, 0, 0.8)",color:"white",children:[S.jsx($e,{fontSize:"xl",fontWeight:"bold",children:"Sign In Required"}),S.jsx($e,{textAlign:"center",children:"Please sign in to enter The Disruptive Spaces"}),S.jsx(On,{colorScheme:"blue",size:"lg",width:"200px",onClick:()=>E(!0),children:"Sign In"})]})}):S.jsx(He,{ref:Y,className:"loader-overlay",style:{transform:"translateZ(0)",zIndex:99999},children:S.jsxs(Mr,{className:"loader-content",flexDirection:"column",alignItems:"center",width:"300px",style:{zIndex:1e5},children:[S.jsx($e,{fontWeight:"bold",children:"Entering The Spaces Metaverse"}),S.jsx($e,{fontSize:"sm",children:me()}),S.jsx(Zy,{value:q(),size:"lg",width:"100%",marginY:2})]})})})}function PWe(){const{user:n,currentUser:e,isGuestUser:i}=k.useContext(Di),[o,l]=k.useState(!1),[u,p]=k.useState(!1),[y,E]=k.useState(!0),[b,T]=k.useState(null);return k.useEffect(()=>{const O=(()=>{try{const L=document.getElementById("webgl-root");if(L){const W=L.getAttribute("data-space-id");if(W)return W}const U=window.location.pathname.match(/\/(w|embed)\/([^\/]+)/);if(U)return U[2];const F=new URLSearchParams(window.location.search),Y=F.get("spaceId")||F.get("space");return Y||null}catch(L){return console.error("AuthenticationButton: Error getting space ID:",L),null}})();T(O)},[]),k.useEffect(()=>{const R=async()=>{if(b)try{const L=await _o(b);l((L==null?void 0:L.allowGuestUsers)||!1),p((L==null?void 0:L.hideGuestSignInButton)||!1),E((L==null?void 0:L.showAuthButton)!==void 0?L.showAuthButton:!0)}catch(L){console.error("AuthenticationButton: Error fetching space data:",L),l(!1),p(!1)}};R();const O=()=>{R()};return window.addEventListener("SpaceSettingsChanged",O),()=>{window.removeEventListener("SpaceSettingsChanged",O)}},[b]),n&&e&&!i(e)?y?S.jsx("div",{children:S.jsx(t4,{})}):null:e&&i(e)?u?null:S.jsx("div",{children:S.jsx(ib,{mode:"button",label:"Sign In",buttonProps:{bg:"black",color:"white",borderRadius:"lg",_hover:{bg:"gray.800"},_active:{bg:"gray.900"}}})}):o||!y?null:S.jsxs("div",{children:[S.jsx(mx,{}),S.jsx(ib,{})]})}function OWe(){const{fullscreenRef:n}=Ch(),[e,i]=k.useState(!1),o=()=>{i(!e)};return S.jsxs(S.Fragment,{children:[S.jsx(Kf,{label:"Help",hasArrow:!0,placement:"top",closeOnClick:!0,portalProps:{containerRef:n},children:S.jsx(va,{"aria-label":"Controller Help",icon:S.jsx(Hze,{}),onClick:o,variant:"iconButton"})}),S.jsxs(_s,{isOpen:e,onClose:o,size:"md",portalProps:{containerRef:n},children:[S.jsx(vs,{}),S.jsxs(ys,{children:[S.jsx(Do,{children:"Notes"}),S.jsx(Ns,{}),S.jsx(Es,{children:S.jsx($e,{variant:"formIntro",children:"The help button is showing so we can see the blur and transparency styles on the button."})}),S.jsx(vh,{children:S.jsx(On,{variant:"primary",onClick:o,children:"Close"})})]})]})]})}function nce({open:n,onClose:e}){const i=k.useRef(null),o=Wa(),{user:l}=k.useContext(Di),u=E=>{i.current&&!i.current.contains(E.target)&&e()},p=async E=>{const b=y(E);if((b==null?void 0:b.source)==="readyplayerme"&&(b.eventName==="v1.frame.ready"&&i.current.contentWindow.postMessage(JSON.stringify({target:"readyplayerme",type:"subscribe",eventName:"v1.**"}),"*"),b.eventName==="v1.avatar.exported")){const T=b.data.url;if(o("AvatarUrlFromReact",{url:T}),l&&l.uid)try{await aae(l.uid,T),e()}catch(R){console.error("Error updating RPM URL:",R)}else console.error("No authenticated user found to update rpmURL.")}},y=E=>{try{return JSON.parse(E.data)}catch{return null}};return k.useEffect(()=>(n&&(document.addEventListener("mousedown",u),window.addEventListener("message",p)),()=>{document.removeEventListener("mousedown",u),window.removeEventListener("message",p)}),[n]),n&&S.jsx(Bc,{children:S.jsx(He,{position:"fixed",top:"0",left:"0",width:"100%",height:"100%",bg:"rgba(0, 0, 0, 0.8)",zIndex:1e4,display:"flex",justifyContent:"center",alignItems:"center",onClick:E=>E.stopPropagation(),children:S.jsx(He,{position:"relative",maxWidth:"1080px",maxHeight:"800px",width:"90%",height:"90%",children:S.jsx("iframe",{ref:i,src:"https://spacesmetaverse.readyplayer.me/avatar?frameApi",title:"Ready Player Me",width:"100%",height:"100%",style:{border:"none",borderRadius:"8px"},allow:"camera *; microphone *; clipboard-write"})})})})}function kWe({isOpen:n,onClose:e}){const[i,o]=k.useState(!1),[l,u]=k.useState(null),{user:p}=k.useContext(Di),y=Wa(),E=D=>{D.stopPropagation(),o(!0)},b=()=>{o(!1),e()},T=async D=>{if(u(D),p&&p.uid)try{await aae(p.uid,D.url),y("AvatarUrlFromReact",{url:D.url}),e()}catch(U){console.error("Error updating RPM URL:",U)}else console.error("No authenticated user found to update rpmURL.")},R=xg("gray.200","whiteAlpha.300"),O="rgba(0, 0, 0, 0.3)",L=[{id:1,url:"https://models.readyplayer.me/67c8408d38f7924e15a8bd0a.glb",name:"Default Avatar 1"},{id:2,url:"https://models.readyplayer.me/67c8576838e3cf57cc697c15.glb",name:"Default Avatar 2"},{id:3,url:"https://models.readyplayer.me/67c884144c4878c55e515ff5.glb",name:"Default Avatar 3"},{id:4,url:"https://models.readyplayer.me/67c885af25f4d62e75c0ff1e.glb",name:"Default Avatar 4"},{id:5,url:"https://models.readyplayer.me/67c8860f4c4878c55e5189b6.glb",name:"Default Avatar 5"},{id:6,url:"https://models.readyplayer.me/67c8869db6d0b438b7abd822.glb",name:"Default Avatar 6"},{id:7,url:"https://models.readyplayer.me/67c886ed28ee0e0bfac89688.glb",name:"Default Avatar 7"},{id:8,url:"https://models.readyplayer.me/67c88731795ea3e2e6ea84db.glb",name:"Default Avatar 8"},{id:9,url:"https://models.readyplayer.me/67c8878b0cdc0f22383f0f8f.glb",name:"Default Avatar 9"}];return S.jsxs(S.Fragment,{children:[S.jsx(Bc,{children:S.jsxs(_s,{isOpen:n,onClose:e,isCentered:!0,size:"xl",zIndex:9999,children:[S.jsx(vs,{bg:"rgba(0, 0, 0, 0.8)",backdropFilter:"blur(8px)"}),S.jsxs(ys,{bg:"#1a1a1a",color:"white",borderRadius:"xl",border:"1px solid #333",maxW:"900px",children:[S.jsx(Do,{fontSize:"md",fontWeight:"600",pb:1,pt:3,px:4,color:"white",children:"Customise Your Avatar"}),S.jsx(Ns,{color:"white",bg:"rgba(255,255,255,0.1)",_hover:{color:"gray.400",bg:"transparent"},borderRadius:"full",size:"sm",top:2,right:3}),S.jsx(Es,{pb:4,children:S.jsxs(Qn,{spacing:4,align:"stretch",children:[S.jsx($e,{fontSize:"sm",children:"Choose from our collection or create your own unique avatar"}),S.jsxs(AF,{columns:5,spacing:2,children:[S.jsx(He,{position:"relative",cursor:"pointer",borderWidth:"2px",borderStyle:"dashed",borderColor:R,borderRadius:"lg",overflow:"hidden",onClick:E,_hover:{bg:O},transition:"all 0.2s",display:"flex",alignItems:"center",justifyContent:"center",aspectRatio:"1",children:S.jsxs(Qn,{spacing:1,children:[S.jsx(en,{as:Q9e,boxSize:4}),S.jsx($e,{fontSize:"xs",children:"Create Custom Avatar"})]})}),L.map(D=>S.jsxs(He,{position:"relative",cursor:"pointer",borderWidth:"2px",borderColor:(l==null?void 0:l.id)===D.id?"blue.400":R,borderRadius:"lg",overflow:"hidden",onClick:()=>T(D),_hover:{bg:O},transition:"all 0.2s",aspectRatio:"1",children:[S.jsx(kp,{src:D.url.replace(".glb",".png?scene=fullbody-portrait-closeupfront&w=640&q=75"),alt:D.name,width:"100%",height:"100%",objectFit:"cover"}),S.jsx(He,{position:"absolute",bottom:"0",left:"0",right:"0",p:1,bg:"rgba(0, 0, 0, 0.7)",children:S.jsx($e,{fontSize:"xs",children:D.name})})]},D.id))]})]})})]})]})}),i&&S.jsx(nce,{open:i,onClose:b})]})}function NWe(){const{fullscreenRef:n}=Ch(),[e,i]=k.useState(!1),[o,l]=k.useState(!1),[u,p]=k.useState(!1),[y,E]=k.useState(!1),{user:b,currentUser:T,isGuestUser:R}=k.useContext(Di),[O,L]=k.useState(null),[D,U]=k.useState(!0),F=(ie,me)=>!ie||!me?"?":`${ie.charAt(0)}${me.charAt(0)}`.toUpperCase(),Y=ie=>{if(!ie)return"G";if(ie.startsWith("Visitor_")){const me=ie.split("_")[1];return`V${me?me.charAt(0):""}`}return ie.charAt(0).toUpperCase()},W=async()=>{if(U(!0),b!=null&&b.uid)try{const ie=await Fc(b.uid);L({rpmURL:ie.rpmURL?ie.rpmURL.replace(".glb",".png?scene=fullbody-portrait-closeupfront&w=640&q=75"):null,firstName:ie.firstName,lastName:ie.lastName,isGuest:!1})}catch(ie){console.error("Error fetching profile data:",ie)}else T&&R(T)&&L({rpmURL:T.rpmURL?T.rpmURL.replace(".glb",".png?scene=fullbody-portrait-closeupfront&w=640&q=75"):null,firstName:"Guest",lastName:"User",username:T.username||T.Nickname,isGuest:!0});U(!1)};k.useEffect(()=>{W()},[b==null?void 0:b.uid,T==null?void 0:T.uid,T==null?void 0:T.rpmURL]),k.useEffect(()=>{const ie=()=>{i(!0)};return window.addEventListener("PlayerInstantiated",ie),()=>{window.removeEventListener("PlayerInstantiated",ie)}},[]);const re=()=>l(!o),le=()=>{l(!1),W()};return e?S.jsxs(S.Fragment,{children:[S.jsx(Kf,{label:O!=null&&O.isGuest?"Guest Avatar":"Edit Avatar",hasArrow:!0,placement:"top",closeOnClick:!0,isOpen:y,portalProps:{containerRef:n},children:S.jsxs(He,{position:"relative",onMouseEnter:()=>{p(!0),E(!0)},onMouseLeave:()=>{p(!1),E(!1)},cursor:O!=null&&O.isGuest?"default":"pointer",onClick:O!=null&&O.isGuest?void 0:re,children:[S.jsx(jc,{src:D||O==null?void 0:O.rpmURL,size:"md",borderRadius:"full",bg:"white",name:!D&&O?O.isGuest?Y(O.username):F(O.firstName,O.lastName):" ",borderWidth:"1px",borderColor:"whiteAlpha.300"}),u&&!(O!=null&&O.isGuest)&&S.jsx(He,{position:"absolute",top:"0",left:"0",right:"0",bottom:"0",display:"flex",alignItems:"center",justifyContent:"center",bg:"rgba(0, 0, 0, 0.4)",borderRadius:"full",children:S.jsx($e,{fontSize:"xs",fontWeight:"bold",color:"white",children:"Edit"})})]})}),S.jsx(kWe,{isOpen:o,onClose:le})]}):null}function xWe(n){return sr({attr:{viewBox:"0 0 1024 1024"},child:[{tag:"path",attr:{d:"M391 240.9c-.8-6.6-8.9-9.4-13.6-4.7l-43.7 43.7L200 146.3a8.03 8.03 0 0 0-11.3 0l-42.4 42.3a8.03 8.03 0 0 0 0 11.3L280 333.6l-43.9 43.9a8.01 8.01 0 0 0 4.7 13.6L401 410c5.1.6 9.5-3.7 8.9-8.9L391 240.9zm10.1 373.2L240.8 633c-6.6.8-9.4 8.9-4.7 13.6l43.9 43.9L146.3 824a8.03 8.03 0 0 0 0 11.3l42.4 42.3c3.1 3.1 8.2 3.1 11.3 0L333.7 744l43.7 43.7A8.01 8.01 0 0 0 391 783l18.9-160.1c.6-5.1-3.7-9.4-8.8-8.8zm221.8-204.2L783.2 391c6.6-.8 9.4-8.9 4.7-13.6L744 333.6 877.7 200c3.1-3.1 3.1-8.2 0-11.3l-42.4-42.3a8.03 8.03 0 0 0-11.3 0L690.3 279.9l-43.7-43.7a8.01 8.01 0 0 0-13.6 4.7L614.1 401c-.6 5.2 3.7 9.5 8.8 8.9zM744 690.4l43.9-43.9a8.01 8.01 0 0 0-4.7-13.6L623 614c-5.1-.6-9.5 3.7-8.9 8.9L633 783.1c.8 6.6 8.9 9.4 13.6 4.7l43.7-43.7L824 877.7c3.1 3.1 8.2 3.1 11.3 0l42.4-42.3c3.1-3.1 3.1-8.2 0-11.3L744 690.4z"}}]})(n)}function DWe(n){return sr({attr:{viewBox:"0 0 1024 1024"},child:[{tag:"path",attr:{d:"M290 236.4l43.9-43.9a8.01 8.01 0 0 0-4.7-13.6L169 160c-5.1-.6-9.5 3.7-8.9 8.9L179 329.1c.8 6.6 8.9 9.4 13.6 4.7l43.7-43.7L370 423.7c3.1 3.1 8.2 3.1 11.3 0l42.4-42.3c3.1-3.1 3.1-8.2 0-11.3L290 236.4zm352.7 187.3c3.1 3.1 8.2 3.1 11.3 0l133.7-133.6 43.7 43.7a8.01 8.01 0 0 0 13.6-4.7L863.9 169c.6-5.1-3.7-9.5-8.9-8.9L694.8 179c-6.6.8-9.4 8.9-4.7 13.6l43.9 43.9L600.3 370a8.03 8.03 0 0 0 0 11.3l42.4 42.4zM845 694.9c-.8-6.6-8.9-9.4-13.6-4.7l-43.7 43.7L654 600.3a8.03 8.03 0 0 0-11.3 0l-42.4 42.3a8.03 8.03 0 0 0 0 11.3L734 787.6l-43.9 43.9a8.01 8.01 0 0 0 4.7 13.6L855 864c5.1.6 9.5-3.7 8.9-8.9L845 694.9zm-463.7-94.6a8.03 8.03 0 0 0-11.3 0L236.3 733.9l-43.7-43.7a8.01 8.01 0 0 0-13.6 4.7L160.1 855c-.6 5.1 3.7 9.5 8.9 8.9L329.2 845c6.6-.8 9.4-8.9 4.7-13.6L290 787.6 423.7 654c3.1-3.1 3.1-8.2 0-11.3l-42.4-42.4z"}}]})(n)}function LWe(){const{isFullscreen:n,toggleFullscreen:e,fullscreenRef:i,isMobile:o}=Ch(),l=ea();k.useEffect(()=>{const p=y=>{console.error("Fullscreen error:",y),l({title:"Fullscreen Error",description:"Could not enter fullscreen mode. Try tapping the button again or use the browser's fullscreen option.",status:"error",duration:5e3,isClosable:!0,position:"top"})};return document.addEventListener("fullscreenerror",p),document.addEventListener("webkitfullscreenerror",p),document.addEventListener("mozfullscreenerror",p),document.addEventListener("MSFullscreenError",p),()=>{document.removeEventListener("fullscreenerror",p),document.removeEventListener("webkitfullscreenerror",p),document.removeEventListener("mozfullscreenerror",p),document.removeEventListener("MSFullscreenError",p)}},[l]);const u=()=>{i.current?(o&&/iPhone|iPad|iPod/i.test(navigator.userAgent)&&!n&&l({title:"Mobile Fullscreen",description:"Tap the button again if fullscreen doesn't activate. For iOS, you may need to use the browser's share button and 'Add to Home Screen' for the best experience.",status:"info",duration:5e3,isClosable:!0,position:"top"}),e()):(console.error("Fullscreen target not set"),l({title:"Fullscreen Error",description:"Could not find fullscreen target element.",status:"error",duration:3e3,isClosable:!0,position:"top"}))};return S.jsx(Kf,{label:n?"Exit Fullscreen":"Enter Fullscreen",hasArrow:!0,placement:"bottom",closeOnClick:!0,portalProps:{containerRef:i},children:S.jsx(va,{"aria-label":n?"Exit Fullscreen":"Enter Fullscreen",icon:n?S.jsx(xWe,{}):S.jsx(DWe,{}),onClick:u,variant:"iconButton",size:o?"lg":"md"})})}const OZ={iframeContainer:{position:"relative",paddingBottom:"56.25%",height:0,overflow:"hidden",width:"100%"},iframe:{position:"absolute",top:0,left:0,width:"100%",height:"100%",border:"none"}};function MWe(){const{isOpen:n,onOpen:e,onClose:i}=yu(),{fullscreenRef:o}=Ch(),[l,u]=SWe(!1),{user:p}=k.useContext(Di),{spaceID:y}=Lo(),{trackReactEvent:E,isReady:b}=kE(y,{enableDebugLogs:!0});k.useEffect(()=>{G.log("VideoPlayer: Current video URL:",l),l&&(G.log("VideoPlayer: Opening modal for video URL:",l),e(),b&&p&&(E(fo.REACT.VIDEO_CLICK,{category:mo.MEDIA_INTERACTION,action:"video_player_open",videoUrl:l,context:"video_player_modal",spaceId:y,timestamp:new Date().toISOString()}),G.log(" Analytics: Video click event tracked for modal open:",l)))},[l,e,E,b,p,y]);const T=()=>{G.log("VideoPlayer: Closing modal"),b&&p&&l&&(E(fo.REACT.VIDEO_CLOSE,{category:mo.MEDIA_INTERACTION,action:"video_player_close",videoUrl:l,context:"video_player_modal",spaceId:y,timestamp:new Date().toISOString()}),G.log(" Analytics: Video close event tracked for modal close:",l)),u(),i()};return S.jsx(Bc,{containerRef:o,children:S.jsxs(_s,{isOpen:n,onClose:T,size:"lg",isCentered:!0,portalProps:{containerRef:o},children:[S.jsx(vs,{bg:"rgba(0, 0, 0, 0.8)"}),S.jsxs(ys,{bg:"gray.900",color:"white",borderRadius:"lg",overflow:"hidden",maxWidth:"80vw",maxHeight:"80vh",display:"flex",justifyContent:"center",alignItems:"center",position:"relative",zIndex:"modal",children:[S.jsx(Ns,{size:"lg",bg:"gray.700",color:"white",borderRadius:"full",zIndex:"modal",_hover:{bg:"gray.600"},_focus:{boxShadow:"none"},position:"absolute",top:"10px",right:"10px"}),S.jsx(Es,{p:0,width:"100%",children:l&&S.jsx(He,{style:OZ.iframeContainer,children:S.jsx("iframe",{src:l,style:OZ.iframe,allow:"autoplay; fullscreen",allowFullScreen:!0,title:"Video Player"})})})]})]})})}function UWe({isOpen:n,onClose:e,playerName:i,playerId:o,uid:l}){const[u,p]=k.useState(null),[y,E]=k.useState(!0),[b,T]=k.useState(null),R=()=>{const L=window.location.pathname.split("/");return L[L.length-1]||window.spaceID||"default-space-id"};k.useEffect(()=>{n&&(async()=>{var D,U;if(E(!0),T(null),!l){G.warn("NameplateModal: No UID provided for player:",i),T("No user ID available for this player"),E(!1);return}try{G.log("NameplateModal: Fetching profile for UID:",l);const F=await Fc(l);if(!F)T("Could not find profile data for this player");else{const Y=R(),W=`space_${Y}_owners`,re=`space_${Y}_hosts`,le=(D=F.groups)!=null&&D.includes(W)?"owner":(U=F.groups)!=null&&U.includes(re)?"host":null;p({firstName:F.firstName,lastName:F.lastName,linkedInProfile:F.linkedInProfile,websiteUrl:F.websiteUrl,rpmURL:F.rpmURL?F.rpmURL.replace(".glb",".png?scene=fullbody-portrait-closeupfront&w=640&q=75"):null,role:le})}}catch(F){G.error("Error fetching profile data:",F),T("Error loading profile data")}finally{E(!1)}})()},[l,n,i]);const O=({role:L})=>L==="owner"?S.jsxs(Cn,{spacing:1,bg:"green.800",px:3,py:1,borderRadius:"md",children:[S.jsx(en,{as:Qk,color:"green.300"}),S.jsx(Mc,{colorScheme:"green",variant:"solid",children:"Owner"})]}):L==="host"?S.jsxs(Cn,{spacing:1,bg:"purple.800",px:3,py:1,borderRadius:"md",children:[S.jsx(en,{as:Zk,color:"purple.300"}),S.jsx(Mc,{colorScheme:"purple",variant:"solid",children:"Host"})]}):null;return S.jsxs(_s,{isOpen:n,onClose:e,isCentered:!0,size:"md",children:[S.jsx(vs,{backdropFilter:"blur(4px)"}),S.jsxs(ys,{bg:"rgba(0,0,0,0.85)",color:"white",border:"none",borderRadius:"xl",children:[S.jsx(Ns,{}),S.jsx(Es,{p:6,children:y?S.jsx(ere,{py:8,children:S.jsx(vd,{size:"xl",color:"blue.400"})}):b?S.jsxs(sE,{status:"warning",variant:"solid",borderRadius:"md",children:[S.jsx(oE,{}),b]}):S.jsxs(Qn,{align:"center",spacing:3,children:[S.jsx(jc,{size:"lg",src:u==null?void 0:u.rpmURL,bg:"whiteAlpha.400",name:i}),S.jsx($e,{fontWeight:"bold",children:i}),S.jsx(O,{role:u==null?void 0:u.role}),(u==null?void 0:u.firstName)&&S.jsxs($e,{fontSize:"sm",color:"gray.300",children:[u.firstName," ",u.lastName]}),S.jsxs(Cn,{spacing:4,pt:2,children:[(u==null?void 0:u.linkedInProfile)&&S.jsx(hu,{href:u.linkedInProfile,isExternal:!0,children:S.jsx(en,{as:Gae,boxSize:5})}),(u==null?void 0:u.websiteUrl)&&S.jsx(hu,{href:u.websiteUrl,isExternal:!0,children:S.jsx(en,{as:$ae,boxSize:5})})]})]})})]})]})}const VWe=({isVisible:n,onToggleVisibility:e,spaceID:i})=>{const[o]=ALe("(max-width: 768px)"),[l,u]=k.useState(!1);k.useEffect(()=>{u(/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent||""))},[]);const p=o||l,y=Jae(),[E,b]=k.useState(!1),[T,R]=k.useState([]),[O,L]=k.useState(!1),[D,U]=k.useState({}),[F,Y]=k.useState({}),[W,re]=k.useState(!1),le=ea(),[ie,me]=k.useState(null),[q,J]=k.useState(null),{isOpen:Q,onOpen:ne,onClose:he}=yu(),[de,pe]=k.useState(null),{isOpen:Se,onOpen:Ie,onClose:Fe}=yu(),[we,Re]=k.useState(null),Te=window.currentUser||{},be=i||window.spaceID||window.location.pathname.split("/").pop()||"fallback-space-id";k.useEffect(()=>{_o(be).then(st=>re(!!(st!=null&&st.voiceDisabled)))},[be]),k.useEffect(()=>{const st=()=>b(!0);return window.addEventListener("PlayerInstantiated",st),window.isPlayerInstantiated&&b(!0),()=>window.removeEventListener("PlayerInstantiated",st)},[]),k.useEffect(()=>{const st={};y.forEach(hn=>{var an;hn.uid&&((an=window.agoraClient)!=null&&an.client)&&(st[hn.uid]=hn.isLocalPlayer?window.agoraClient.client.uid:hn.uid)}),Y(st)},[y]),k.useEffect(()=>{const st=setInterval(()=>{var hn;if(window.agoraClient){L(!!window.agoraClient.isVoiceEnabled);const an={};(hn=window.agoraClient.client)==null||hn.remoteUsers.forEach(Ft=>{an[Ft.uid]=!!Ft.audioTrack&&!Ft.audioTrack.muted}),U(an)}},500);return()=>clearInterval(st)},[]),k.useEffect(()=>{(async()=>{const hn=await Promise.all(y.map(async an=>{var Ft,on;if(!an.uid)return an;try{const bt=await Fc(an.uid),ve=`space_${be}_owners`,De=`space_${be}_hosts`,qe=(Ft=bt.groups)!=null&&Ft.includes(ve)?"owner":(on=bt.groups)!=null&&on.includes(De)?"host":null,Ot=bt.rpmURL?bt.rpmURL.replace(".glb",".png?scene=fullbody-portrait-closeupfront&w=640&q=75"):void 0;return{...an,...bt,rpmURL:Ot,role:qe}}catch{return an}}));R(hn)})()},[y,be]);const{kickPlayer:xe,isKicking:je,kickResult:nt,error:dt,resetKickState:ft}=bWe();k.useEffect(()=>{nt!=null&&nt.success&&(ie||we)&&(ie&&(le({title:"Remove Successful",description:`${ie} has been removed.`,status:"success",duration:3e3,isClosable:!0}),me(null)),we&&(le({title:"Ban Successful",description:`${we} has been banned.`,status:"success",duration:3e3,isClosable:!0}),Re(null)),ft()),dt&&(le({title:"Error",description:dt,status:"error",duration:3e3,isClosable:!0}),me(null),Re(null),ft())},[nt,dt,ie,we,le,ft]);const lt=st=>st.isLocalPlayer||st.uid===Te.uid,gt=st=>lt(st)?O:D[F[st.uid]],at=({role:st})=>st==="owner"?S.jsx(en,{as:Qk,color:"green.400",boxSize:3,ml:1}):st==="host"?S.jsx(en,{as:Zk,color:"purple.400",boxSize:3,ml:1}):null,Ct=({role:st})=>st==="owner"?S.jsxs(Cn,{spacing:1,bg:"green.800",px:3,py:1,borderRadius:"md",children:[S.jsx(en,{as:Qk,color:"green.300"}),S.jsx(Mc,{colorScheme:"green",variant:"solid",children:"Owner"})]}):st==="host"?S.jsxs(Cn,{spacing:1,bg:"purple.800",px:3,py:1,borderRadius:"md",children:[S.jsx(en,{as:Zk,color:"purple.300"}),S.jsx(Mc,{colorScheme:"purple",variant:"solid",children:"Host"})]}):null,En=()=>{q&&(me(q.playerName),xe(q.uid,Te.uid),he())},Gt=async()=>{de&&(Re(de.playerName),await Ize(be,{uid:de.uid,playerName:de.playerName,bannedAt:new Date().toISOString(),...Te.uid&&{bannedBy:Te.uid}}),xe(de.uid,Te.uid),Fe())},Jt=(st,hn)=>{var Ft;if(!(((Ft=T.find(on=>on.isLocalPlayer))==null?void 0:Ft.role)==="owner"))return le({title:"Permission Denied",status:"error",duration:3e3,isClosable:!0});st==="remove"?(J(hn),ne()):st==="ban"&&(pe(hn),Ie())};return S.jsxs(S.Fragment,{children:[S.jsxs(He,{position:"absolute",top:"100px",right:"20px",zIndex:"1",bg:"rgba(0,0,0,0.4)",p:4,borderRadius:"md",color:"white",minWidth:"200px",maxHeight:"300px",visibility:E&&n&&!p?"visible":"hidden",role:"group",children:[S.jsx(He,{position:"absolute",top:2,right:2,opacity:0,_groupHover:{opacity:1},transition:"opacity 0.2s",children:S.jsx(va,{icon:S.jsx(Gze,{boxSize:3}),size:"xs","aria-label":"Close list",variant:"unstyled",color:"white",onClick:e})}),S.jsxs($e,{fontWeight:"bold",mb:2,fontSize:"sm",children:["People Online: ",y.length]}),S.jsx(He,{maxHeight:"200px",overflowY:"auto",css:{"&::-webkit-scrollbar":{width:"4px"},"&::-webkit-scrollbar-thumb":{background:"rgba(255,255,255,0.3)",borderRadius:"2px"}},children:S.jsx(Qn,{align:"stretch",spacing:1,width:"100%",children:T.sort((st,hn)=>st.isLocalPlayer?-1:hn.isLocalPlayer?1:0).map((st,hn)=>{var bt;const an=lt(st),Ft=((bt=T.find(ve=>ve.isLocalPlayer))==null?void 0:bt.role)==="owner"&&!an&&st.role!=="owner",on=!W&&gt(st);return S.jsx(He,{children:S.jsxs(die,{placement:"left",trigger:"hover",children:[S.jsx(gie,{children:S.jsxs(Cn,{p:1,borderRadius:"md",_hover:{bg:"whiteAlpha.200"},children:[S.jsx(jc,{size:"xs",bg:"whiteAlpha.400",src:st.rpmURL,name:" ",borderWidth:"1px",borderColor:"whiteAlpha.300"}),S.jsx($e,{fontSize:"xs",children:st.playerName}),S.jsx(at,{role:st.role}),S.jsx(qC,{}),!W&&(on?S.jsx(He,{color:"green.400",children:S.jsx(qae,{})}):S.jsx(He,{color:"red.400",children:S.jsx(Kae,{})})),an?S.jsx($e,{fontSize:"xs",color:"gray.300",ml:1,children:"(you)"}):Ft?S.jsxs(SE,{children:[S.jsx(bE,{as:va,"aria-label":"Options",icon:S.jsx(Hae,{}),variant:"ghost",size:"xs",color:"gray.300",ml:1,minW:"16px",h:"16px",p:0}),S.jsxs(wE,{bg:"rgba(0,0,0,0.8)",borderColor:"whiteAlpha.300",minW:"120px",zIndex:10001,children:[S.jsx(fh,{icon:S.jsx(nWe,{}),onClick:()=>Jt("remove",st),bg:"black",color:"white",_hover:{bg:"gray.800"},fontSize:"sm",children:"Remove"}),S.jsx(fh,{icon:S.jsx(W9e,{}),onClick:()=>Jt("ban",st),bg:"black",color:"white",_hover:{bg:"gray.800"},fontSize:"sm",children:"Ban"})]})]}):null]})}),S.jsx(mie,{bg:"rgba(0,0,0,0.85)",color:"white",border:"none",p:4,minW:"220px",children:S.jsx(pie,{children:S.jsxs(Qn,{align:"center",spacing:3,children:[S.jsx(jc,{size:"lg",src:st.rpmURL}),S.jsx($e,{fontWeight:"bold",children:st.playerName}),S.jsx(Ct,{role:st.role}),st.firstName&&S.jsxs($e,{fontSize:"sm",color:"gray.300",children:[st.firstName," ",st.lastName]}),S.jsxs(Cn,{spacing:4,pt:2,children:[st.linkedInProfile&&S.jsx(hu,{href:st.linkedInProfile,isExternal:!0,children:S.jsx(en,{as:Gae})}),st.websiteUrl&&S.jsx(hu,{href:st.websiteUrl,isExternal:!0,children:S.jsx(en,{as:$ae})})]})]})})})]})},hn)})})})]}),S.jsxs(_s,{isOpen:Q,onClose:he,isCentered:!0,children:[S.jsx(vs,{}),S.jsxs(ys,{bg:"gray.800",color:"white",children:[S.jsx(Do,{children:"Confirm Removal"}),S.jsx(Ns,{}),S.jsx(Es,{children:S.jsxs($e,{children:["Remove ",q==null?void 0:q.playerName," from the room?"]})}),S.jsxs(vh,{children:[S.jsx(On,{colorScheme:"red",onClick:En,isLoading:je,mr:3,children:"Remove"}),S.jsx(On,{bg:"white",color:"gray.800",onClick:he,_hover:{bg:"gray.200"},children:"Cancel"})]})]})]}),S.jsxs(_s,{isOpen:Se,onClose:Fe,isCentered:!0,children:[S.jsx(vs,{}),S.jsxs(ys,{bg:"gray.800",color:"white",children:[S.jsx(Do,{children:"Confirm Ban"}),S.jsx(Ns,{}),S.jsx(Es,{children:S.jsxs($e,{children:["Ban ",de==null?void 0:de.playerName," from the room? They will not be able to re-enter."]})}),S.jsxs(vh,{children:[S.jsx(On,{colorScheme:"red",onClick:Gt,isLoading:je,mr:3,children:"Ban"}),S.jsx(On,{bg:"white",color:"gray.800",onClick:Fe,_hover:{bg:"gray.200"},children:"Cancel"})]})]})]})]})};var ok={exports:{}},jWe=ok.exports,kZ;function FWe(){return kZ||(kZ=1,(function(n,e){(function(i,o){n.exports=o()})(jWe,(function(){function i(t,r){return r.forEach((function(s){s&&typeof s!="string"&&!Array.isArray(s)&&Object.keys(s).forEach((function(a){if(a!=="default"&&!(a in t)){var c=Object.getOwnPropertyDescriptor(s,a);Object.defineProperty(t,a,c.get?c:{enumerable:!0,get:function(){return s[a]}})}}))})),Object.freeze(t)}var o=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof My<"u"?My:typeof self<"u"?self:{};function l(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var u=function(t){try{return!!t()}catch{return!0}},p=!u((function(){var t=(function(){}).bind();return typeof t!="function"||t.hasOwnProperty("prototype")})),y=p,E=Function.prototype,b=E.call,T=y&&E.bind.bind(b,b),R=y?T:function(t){return function(){return b.apply(t,arguments)}},O=R({}.isPrototypeOf),L=function(t){return t&&t.Math===Math&&t},D=L(typeof globalThis=="object"&&globalThis)||L(typeof window=="object"&&window)||L(typeof self=="object"&&self)||L(typeof o=="object"&&o)||L(typeof o=="object"&&o)||(function(){return this})()||Function("return this")(),U=p,F=Function.prototype,Y=F.apply,W=F.call,re=typeof Reflect=="object"&&Reflect.apply||(U?W.bind(Y):function(){return W.apply(Y,arguments)}),le=R,ie=le({}.toString),me=le("".slice),q=function(t){return me(ie(t),8,-1)},J=q,Q=R,ne=function(t){if(J(t)==="Function")return Q(t)},he=typeof document=="object"&&document.all,de=he===void 0&&he!==void 0?function(t){return typeof t=="function"||t===he}:function(t){return typeof t=="function"},pe={},Se=!u((function(){return Object.defineProperty({},1,{get:function(){return 7}})[1]!==7})),Ie=p,Fe=Function.prototype.call,we=Ie?Fe.bind(Fe):function(){return Fe.apply(Fe,arguments)},Re={},Te={}.propertyIsEnumerable,Ne=Object.getOwnPropertyDescriptor,be=Ne&&!Te.call({1:2},1);Re.f=be?function(t){var r=Ne(this,t);return!!r&&r.enumerable}:Te;var xe,je,nt=function(t,r){return{enumerable:!(1&t),configurable:!(2&t),writable:!(4&t),value:r}},dt=u,ft=q,lt=Object,gt=R("".split),at=dt((function(){return!lt("z").propertyIsEnumerable(0)}))?function(t){return ft(t)==="String"?gt(t,""):lt(t)}:lt,Ct=function(t){return t==null},En=Ct,Gt=TypeError,Jt=function(t){if(En(t))throw new Gt("Can't call method on "+t);return t},st=at,hn=Jt,an=function(t){return st(hn(t))},Ft=de,on=function(t){return typeof t=="object"?t!==null:Ft(t)},bt={},ve=bt,De=D,qe=de,Ot=function(t){return qe(t)?t:void 0},vt=function(t,r){return arguments.length<2?Ot(ve[t])||Ot(De[t]):ve[t]&&ve[t][r]||De[t]&&De[t][r]},Pt=D.navigator,Ut=Pt&&Pt.userAgent,cn=Ut?String(Ut):"",_t=D,wn=cn,Nt=_t.process,Ht=_t.Deno,Ur=Nt&&Nt.versions||Ht&&Ht.version,Ri=Ur&&Ur.v8;Ri&&(je=(xe=Ri.split("."))[0]>0&&xe[0]<4?1:+(xe[0]+xe[1])),!je&&wn&&(!(xe=wn.match(/Edge\/(\d+)/))||xe[1]>=74)&&(xe=wn.match(/Chrome\/(\d+)/))&&(je=+xe[1]);var ri=je,zi=ri,ds=u,Eo=D.String,Gr=!!Object.getOwnPropertySymbols&&!ds((function(){var t=Symbol("symbol detection");return!Eo(t)||!(Object(t)instanceof Symbol)||!Symbol.sham&&zi&&zi<41})),Mo=Gr&&!Symbol.sham&&typeof Symbol.iterator=="symbol",Wc=vt,Xr=de,vo=O,Js=Object,ns=Mo?function(t){return typeof t=="symbol"}:function(t){var r=Wc("Symbol");return Xr(r)&&vo(r.prototype,Js(t))},Gc=String,So=function(t){try{return Gc(t)}catch{return"Object"}},bu=de,Ga=So,Ds=TypeError,Kt=function(t){if(bu(t))return t;throw new Ds(Ga(t)+" is not a function")},Hc=Kt,ta=Ct,Ha=function(t,r){var s=t[r];return ta(s)?void 0:Hc(s)},$c=we,na=de,ra=on,Sd=TypeError,Ih={exports:{}},kl=D,Ah=Object.defineProperty,Ls=D,Nl=function(t,r){try{Ah(kl,t,{value:r,configurable:!0,writable:!0})}catch{kl[t]=r}return r},ia="__core-js_shared__",bd=Ih.exports=Ls[ia]||Nl(ia,{});(bd.versions||(bd.versions=[])).push({version:"3.42.0",mode:"pure",copyright:" 2014-2025 Denis Pushkarev (zloirock.ru)",license:"https://github.com/zloirock/core-js/blob/v3.42.0/LICENSE",source:"https://github.com/zloirock/core-js"});var xl=Ih.exports,Dl=xl,Sa=function(t,r){return Dl[t]||(Dl[t]=r||{})},Ll=Jt,Ph=Object,Qs=function(t){return Ph(Ll(t))},Jr=Qs,Oh=R({}.hasOwnProperty),Vr=Object.hasOwn||function(t,r){return Oh(Jr(t),r)},_c=R,sa=0,wd=Math.random(),Je=_c(1 .toString),qt=function(t){return"Symbol("+(t===void 0?"":t)+")_"+Je(++sa+wd,36)},qn=Sa,Xi=Vr,Ss=qt,Kc=Gr,kh=Mo,yc=D.Symbol,qc=qn("wks"),Ml=kh?yc.for||yc:yc&&yc.withoutSetter||Ss,Rr=function(t){return Xi(qc,t)||(qc[t]=Kc&&Xi(yc,t)?yc[t]:Ml("Symbol."+t)),qc[t]},Ul=we,Ec=on,Ji=ns,di=Ha,Hr=function(t,r){var s,a;if(na(s=t.toString)&&!ra(a=$c(s,t))||na(s=t.valueOf)&&!ra(a=$c(s,t)))return a;throw new Sd("Can't convert object to primitive value")},Vl=TypeError,wu=Rr("toPrimitive"),hi=function(t,r){if(!Ec(t)||Ji(t))return t;var s,a=di(t,wu);if(a){if(s=Ul(a,t,r),!Ec(s)||Ji(s))return s;throw new Vl("Can't convert object to primitive value")}return Hr(t)},Tu=ns,yr=function(t){var r=hi(t,"string");return Tu(r)?r:r+""},jl=on,Nh=D.document,xh=jl(Nh)&&jl(Nh.createElement),Cu=function(t){return xh?Nh.createElement(t):{}},dm=Cu,Xp=!Se&&!u((function(){return Object.defineProperty(dm("div"),"a",{get:function(){return 7}}).a!==7})),Jp=Se,ba=we,bs=Re,wa=nt,Ta=an,Ru=yr,Ca=Vr,$a=Xp,Qp=Object.getOwnPropertyDescriptor;pe.f=Jp?Qp:function(t,r){if(t=Ta(t),r=Ru(r),$a)try{return Qp(t,r)}catch{}if(Ca(t,r))return wa(!ba(bs.f,t,r),t[r])};var Yc=u,Ms=de,r_=/#|\.prototype\./,Fl=function(t,r){var s=Iu[Bl(t)];return s===vc||s!==hm&&(Ms(r)?Yc(r):!!r)},Bl=Fl.normalize=function(t){return String(t).replace(r_,".").toLowerCase()},Iu=Fl.data={},hm=Fl.NATIVE="N",vc=Fl.POLYFILL="P",Ra=Fl,zl=Kt,Ce=p,Me=ne(ne.bind),ct=function(t,r){return zl(t),r===void 0?t:Ce?Me(t,r):function(){return t.apply(r,arguments)}},Yt={},cr=Se&&u((function(){return Object.defineProperty((function(){}),"prototype",{value:42,writable:!1}).prototype!==42})),jr=on,ai=String,nr=TypeError,rr=function(t){if(jr(t))return t;throw new nr(ai(t)+" is not an object")},Li=Se,Zs=Xp,Xc=cr,Uo=rr,Au=yr,Us=TypeError,Sc=Object.defineProperty,pm=Object.getOwnPropertyDescriptor,Jc="enumerable",i_="configurable",Dh="writable";Yt.f=Li?Xc?function(t,r,s){if(Uo(t),r=Au(r),Uo(s),typeof t=="function"&&r==="prototype"&&"value"in s&&Dh in s&&!s[Dh]){var a=pm(t,r);a&&a[Dh]&&(t[r]=s.value,s={configurable:i_ in s?s[i_]:a[i_],enumerable:Jc in s?s[Jc]:a[Jc],writable:!1})}return Sc(t,r,s)}:Sc:function(t,r,s){if(Uo(t),r=Au(r),Uo(s),Zs)try{return Sc(t,r,s)}catch{}if("get"in s||"set"in s)throw new Us("Accessors not supported");return"value"in s&&(t[r]=s.value),t};var Td=Yt,Lh=nt,bc=Se?function(t,r,s){return Td.f(t,r,Lh(1,s))}:function(t,r,s){return t[r]=s,t},Pu=D,s_=re,NE=ne,fm=de,mm=pe.f,xE=Ra,Ka=bt,DE=ct,Cd=bc,o_=Vr,a_=function(t){var r=function(s,a,c){if(this instanceof r){switch(arguments.length){case 0:return new t;case 1:return new t(s);case 2:return new t(s,a)}return new t(s,a,c)}return s_(t,this,arguments)};return r.prototype=t.prototype,r},Kn=function(t,r){var s,a,c,d,h,m,g,v,w,I=t.target,A=t.global,N=t.stat,H=t.proto,B=A?Pu:N?Pu[I]:Pu[I]&&Pu[I].prototype,z=A?Ka:Ka[I]||Cd(Ka,I,{})[I],ee=z.prototype;for(d in r)a=!(s=xE(A?d:I+(N?".":"#")+d,t.forced))&&B&&o_(B,d),m=z[d],a&&(g=t.dontCallGetSet?(w=mm(B,d))&&w.value:B[d]),h=a&&g?g:r[d],(s||H||typeof m!=typeof h)&&(v=t.bind&&a?DE(h,Pu):t.wrap&&a?a_(h):H&&fm(h)?NE(h):h,(t.sham||h&&h.sham||m&&m.sham)&&Cd(v,"sham",!0),Cd(z,d,v),H&&(o_(Ka,c=I+"Prototype")||Cd(Ka,c,{}),Cd(Ka[c],d,h),t.real&&ee&&(s||!ee[d])&&Cd(ee,d,h)))},Ia=Math.ceil,LE=Math.floor,ME=Math.trunc||function(t){var r=+t;return(r>0?LE:Ia)(r)},Ou=ME,P=function(t){var r=+t;return r!=r||r===0?0:Ou(r)},$=P,se=Math.max,Ee=Math.min,Ye=function(t,r){var s=$(t);return s<0?se(s+r,0):Ee(s,r)},ht=P,$t=Math.min,ci=function(t){var r=ht(t);return r>0?$t(r,9007199254740991):0},eo=ci,mr=function(t){return eo(t.length)},bo=an,Vs=Ye,Qc=mr,qa=function(t){return function(r,s,a){var c=bo(r),d=Qc(c);if(d===0)return!t&&-1;var h,m=Vs(a,d);if(t&&s!=s){for(;d>m;)if((h=c[m++])!=h)return!0}else for(;d>m;m++)if((t||m in c)&&c[m]===s)return t||m||0;return!t&&-1}},Rd={includes:qa(!0),indexOf:qa(!1)},gm=Rd.includes;Kn({target:"Array",proto:!0,forced:u((function(){return!Array(1).includes()}))},{includes:function(t){return gm(this,t,arguments.length>1?arguments[1]:void 0)}});var fI=D,mI=bt,wc=function(t,r){var s=mI[t+"Prototype"],a=s&&s[r];if(a)return a;var c=fI[t],d=c&&c.prototype;return d&&d[r]},_m=wc("Array","includes"),_x=on,yx=q,Ex=Rr("match"),_b=function(t){var r;return _x(t)&&((r=t[Ex])!==void 0?!!r:yx(t)==="RegExp")},gI=_b,c_=TypeError,ym={};ym[Rr("toStringTag")]="z";var yb=String(ym)==="[object z]",UE=yb,vx=de,l_=q,Eb=Rr("toStringTag"),vb=Object,_I=l_((function(){return arguments})())==="Arguments",Id=UE?l_:function(t){var r,s,a;return t===void 0?"Undefined":t===null?"Null":typeof(s=(function(c,d){try{return c[d]}catch{}})(r=vb(t),Eb))=="string"?s:_I?l_(r):(a=l_(r))==="Object"&&vx(r.callee)?"Arguments":a},yI=Id,Sx=String,Ya=function(t){if(yI(t)==="Symbol")throw new TypeError("Cannot convert a Symbol value to a string");return Sx(t)},bx=Rr("match"),wx=Kn,Tx=function(t){if(gI(t))throw new c_("The method doesn't accept regular expressions");return t},Wl=Jt,Em=Ya,EI=function(t){var r=/./;try{"/./"[t](r)}catch{try{return r[bx]=!1,"/./"[t](r)}catch{}}return!1},vI=R("".indexOf);wx({target:"String",proto:!0,forced:!EI("includes")},{includes:function(t){return!!~vI(Em(Wl(this)),Em(Tx(t)),arguments.length>1?arguments[1]:void 0)}});var SI=wc("String","includes"),Sb=O,bb=_m,Cx=SI,wb=Array.prototype,Mh=String.prototype,Tb=function(t){var r=t.includes;return t===wb||Sb(wb,t)&&r===wb.includes?bb:typeof t=="string"||t===Mh||Sb(Mh,t)&&r===Mh.includes?Cx:r},rt=l(Tb),Cb=Kt,bI=Qs,VE=at,vm=mr,jE=TypeError,Rb="Reduce of empty array with no initial value",FE=function(t){return function(r,s,a,c){var d=bI(r),h=VE(d),m=vm(d);if(Cb(s),m===0&&a<2)throw new jE(Rb);var g=t?m-1:0,v=t?-1:1;if(a<2)for(;;){if(g in h){c=h[g],g+=v;break}if(g+=v,t?g<0:m<=g)throw new jE(Rb)}for(;t?g>=0:m>g;g+=v)g in h&&(c=s(c,h[g],g,d));return c}},wI={left:FE(!1)},TI=u,u_=function(t,r){var s=[][t];return!!s&&TI((function(){s.call(null,r||function(){return 1},1)}))},Sm=D,CI=cn,RI=q,Gl=function(t){return CI.slice(0,t.length)===t},d_=Gl("Bun/")?"BUN":Gl("Cloudflare-Workers")?"CLOUDFLARE":Gl("Deno/")?"DENO":Gl("Node.js/")?"NODE":Sm.Bun&&typeof Bun.version=="string"?"BUN":Sm.Deno&&typeof Deno.version=="object"?"DENO":RI(Sm.process)==="process"?"NODE":Sm.window&&Sm.document?"BROWSER":"REST",bm=d_==="NODE",Rx=wI.left;Kn({target:"Array",proto:!0,forced:!bm&&ri>79&&ri<83||!u_("reduce")},{reduce:function(t){var r=arguments.length;return Rx(this,t,r,r>1?arguments[1]:void 0)}});var Ix=wc("Array","reduce"),h_=O,Ax=Ix,BE=Array.prototype,II=function(t){var r=t.reduce;return t===BE||h_(BE,t)&&r===BE.reduce?Ax:r},Mi=II,Xa=l(Mi),zE=q,Ad=Array.isArray||function(t){return zE(t)==="Array"},AI=Kn,Ib=Ad,p_=R([].reverse),f_=[1,2];AI({target:"Array",proto:!0,forced:String(f_)===String(f_.reverse())},{reverse:function(){return Ib(this)&&(this.length=this.length),p_(this)}});var wm=wc("Array","reverse"),PI=O,Px=wm,Ab=Array.prototype,OI=function(t){var r=t.reverse;return t===Ab||PI(Ab,t)&&r===Ab.reverse?Px:r},m_=OI,g_=l(m_),Pb=qt,WE=Sa("keys"),Tm=function(t){return WE[t]||(WE[t]=Pb(t))},Ob=!u((function(){function t(){}return t.prototype.constructor=null,Object.getPrototypeOf(new t)!==t.prototype})),Ox=Vr,kI=de,kx=Qs,Nx=Ob,GE=Tm("IE_PROTO"),ku=Object,NI=ku.prototype,Uh=Nx?ku.getPrototypeOf:function(t){var r=kx(t);if(Ox(r,GE))return r[GE];var s=r.constructor;return kI(s)&&r instanceof s?s.prototype:r instanceof ku?NI:null},Nu=R,__=Kt,Pd=on,kb=function(t){return Pd(t)||t===null},xx=String,Dx=TypeError,Zp=function(t,r,s){try{return Nu(__(Object.getOwnPropertyDescriptor(t,r)[s]))}catch{}},y_=on,Cm=Jt,HE=function(t){if(kb(t))return t;throw new Dx("Can't set "+xx(t)+" as a prototype")},Nb=Object.setPrototypeOf||("__proto__"in{}?(function(){var t,r=!1,s={};try{(t=Zp(Object.prototype,"__proto__","set"))(s,[]),r=s instanceof Array}catch{}return function(a,c){return Cm(a),HE(c),y_(a)&&(r?t(a,c):a.__proto__=c),a}})():void 0),Od={},Hl={},Ii=Vr,Ui=an,Vh=Rd.indexOf,oa=Hl,Aa=R([].push),jh=function(t,r){var s,a=Ui(t),c=0,d=[];for(s in a)!Ii(oa,s)&&Ii(a,s)&&Aa(d,s);for(;r.length>c;)Ii(a,s=r[c++])&&(~Vh(d,s)||Aa(d,s));return d},Fh=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"],Ja=jh,$E=Fh.concat("length","prototype");Od.f=Object.getOwnPropertyNames||function(t){return Ja(t,$E)};var Rm={};Rm.f=Object.getOwnPropertySymbols;var xI=vt,KE=Od,DI=Rm,kd=rr,qE=R([].concat),xb=xI("Reflect","ownKeys")||function(t){var r=KE.f(kd(t)),s=DI.f;return s?qE(r,s(t)):r},Db=Vr,Lx=xb,Bh=pe,Im=Yt,zh={},YE=jh,XE=Fh,Pa=Object.keys||function(t){return YE(t,XE)},Zc=Se,ef=cr,Nd=Yt,xd=rr,tf=an,LI=Pa;zh.f=Zc&&!ef?Object.defineProperties:function(t,r){xd(t);for(var s,a=tf(r),c=LI(r),d=c.length,h=0;d>h;)Nd.f(t,s=c[h++],a[s]);return t};var Am,JE=vt("document","documentElement"),Tc=rr,Cc=zh,Wi=Fh,$l=Hl,MI=JE,UI=Cu,E_="prototype",v_="script",Lb=Tm("IE_PROTO"),Pm=function(){},Mb=function(t){return"<"+v_+">"+t+"</"+v_+">"},nf=function(t){t.write(Mb("")),t.close();var r=t.parentWindow.Object;return t=null,r},Om=function(){try{Am=new ActiveXObject("htmlfile")}catch{}var t,r,s;Om=typeof document<"u"?document.domain&&Am?nf(Am):(r=UI("iframe"),s="java"+v_+":",r.style.display="none",MI.appendChild(r),r.src=String(s),(t=r.contentWindow.document).open(),t.write(Mb("document.F=Object")),t.close(),t.F):nf(Am);for(var a=Wi.length;a--;)delete Om[E_][Wi[a]];return Om()};$l[Lb]=!0;var S_=Object.create||function(t,r){var s;return t!==null?(Pm[E_]=Tc(t),s=new Pm,Pm[E_]=null,s[Lb]=t):s=Om(),r===void 0?s:Cc.f(s,r)},b_=on,QE=bc,Ub=Error,VI=R("".replace),km=String(new Ub("zxcasd").stack),Vb=/\n\s*at [^:]*:[^\n]*/,ZE=Vb.test(km),ev=nt,Nm=!u((function(){var t=new Error("a");return!("stack"in t)||(Object.defineProperty(t,"stack",ev(1,7)),t.stack!==7)})),jb=bc,Fb=function(t,r){if(ZE&&typeof t=="string"&&!Ub.prepareStackTrace)for(;r--;)t=VI(t,Vb,"");return t},Bb=Nm,tv=Error.captureStackTrace,Kl={},el=Kl,rf=Rr("iterator"),zb=Array.prototype,Wb=function(t){return t!==void 0&&(el.Array===t||zb[rf]===t)},Dd=Id,Ld=Ha,Gb=Ct,jI=Kl,Md=Rr("iterator"),ql=function(t){if(!Gb(t))return Ld(t,Md)||Ld(t,"@@iterator")||jI[Dd(t)]},nv=we,FI=Kt,rv=rr,BI=So,w_=ql,xu=TypeError,sf=function(t,r){var s=arguments.length<2?w_(t):r;if(FI(s))return rv(nv(s,t));throw new xu(BI(t)+" is not iterable")},T_=we,Wh=rr,Hb=Ha,of=function(t,r,s){var a,c;Wh(t);try{if(!(a=Hb(t,"return"))){if(r==="throw")throw s;return s}a=T_(a,t)}catch(d){c=!0,a=d}if(r==="throw")throw s;if(c)throw a;return Wh(a),s},zI=ct,$b=we,rs=rr,iv=So,Kb=Wb,qb=mr,C_=O,Yb=sf,af=ql,Qi=of,to=TypeError,ws=function(t,r){this.stopped=t,this.result=r},R_=ws.prototype,Ud=function(t,r,s){var a,c,d,h,m,g,v,w=s&&s.that,I=!(!s||!s.AS_ENTRIES),A=!(!s||!s.IS_RECORD),N=!(!s||!s.IS_ITERATOR),H=!(!s||!s.INTERRUPTED),B=zI(r,w),z=function(Z){return a&&Qi(a,"normal",Z),new ws(!0,Z)},ee=function(Z){return I?(rs(Z),H?B(Z[0],Z[1],z):B(Z[0],Z[1])):H?B(Z,z):B(Z)};if(A)a=t.iterator;else if(N)a=t;else{if(!(c=af(t)))throw new to(iv(t)+" is not iterable");if(Kb(c)){for(d=0,h=qb(t);h>d;d++)if((m=ee(t[d]))&&C_(R_,m))return m;return new ws(!1)}a=Yb(t,c)}for(g=A?t.next:a.next;!(v=$b(g,a)).done;){try{m=ee(v.value)}catch(Z){Qi(a,"throw",Z)}if(typeof m=="object"&&m&&C_(R_,m))return m}return new ws(!1)},I_=Ya,Mx=Kn,aa=O,Xb=Uh,xm=Nb,Jb=function(t,r,s){for(var a=Lx(r),c=Im.f,d=Bh.f,h=0;h<a.length;h++){var m=a[h];Db(t,m)||s&&Db(s,m)||c(t,m,d(r,m))}},Yl=S_,Qa=bc,cf=nt,Qb=function(t,r){b_(r)&&"cause"in r&&QE(t,"cause",r.cause)},Zb=function(t,r,s,a){Bb&&(tv?tv(t,r):jb(t,"stack",Fb(s,a)))},WI=Ud,GI=function(t,r){return t===void 0?arguments.length<2?"":r:I_(t)},HI=Rr("toStringTag"),A_=Error,$I=[].push,lf=function(t,r){var s,a=aa(sv,this);xm?s=xm(new A_,a?Xb(this):sv):(s=a?this:Yl(sv),Qa(s,HI,"Error")),r!==void 0&&Qa(s,"message",GI(r)),Zb(s,lf,s.stack,1),arguments.length>2&&Qb(s,arguments[2]);var c=[];return WI(t,$I,{that:c}),Qa(s,"errors",c),s};xm?xm(lf,A_):Jb(lf,A_,{name:!0});var sv=lf.prototype=Yl(A_.prototype,{constructor:cf(1,lf),message:cf(1,""),name:cf(1,"AggregateError")});Mx({global:!0},{AggregateError:lf});var P_,Vd,O_,ov=de,k_=D.WeakMap,KI=ov(k_)&&/native code/.test(String(k_)),av=D,qI=on,YI=bc,cv=Vr,lv=xl,ew=Tm,XI=Hl,tw="Object already initialized",uv=av.TypeError,Ux=av.WeakMap;if(KI||lv.state){var Xl=lv.state||(lv.state=new Ux);Xl.get=Xl.get,Xl.has=Xl.has,Xl.set=Xl.set,P_=function(t,r){if(Xl.has(t))throw new uv(tw);return r.facade=t,Xl.set(t,r),r},Vd=function(t){return Xl.get(t)||{}},O_=function(t){return Xl.has(t)}}else{var Dm=ew("state");XI[Dm]=!0,P_=function(t,r){if(cv(t,Dm))throw new uv(tw);return r.facade=t,YI(t,Dm,r),r},Vd=function(t){return cv(t,Dm)?t[Dm]:{}},O_=function(t){return cv(t,Dm)}}var uf,nw,rw,Gh={set:P_,get:Vd,has:O_,enforce:function(t){return O_(t)?Vd(t):P_(t,{})},getterFor:function(t){return function(r){var s;if(!qI(r)||(s=Vd(r)).type!==t)throw new uv("Incompatible receiver, "+t+" required");return s}}},Lm=Se,Vx=Vr,JI=Function.prototype,jx=Lm&&Object.getOwnPropertyDescriptor,tl=Vx(JI,"name"),dv={PROPER:tl&&(function(){}).name==="something",CONFIGURABLE:tl&&(!Lm||Lm&&jx(JI,"name").configurable)},hv=bc,jd=function(t,r,s,a){return a&&a.enumerable?t[r]=s:hv(t,r,s),t},QI=u,ZI=de,iw=on,Mm=S_,pv=Uh,sw=jd,ow=Rr("iterator"),aw=!1;[].keys&&("next"in(rw=[].keys())?(nw=pv(pv(rw)))!==Object.prototype&&(uf=nw):aw=!0);var eA=!iw(uf)||QI((function(){var t={};return uf[ow].call(t)!==t}));ZI((uf=eA?{}:Mm(uf))[ow])||sw(uf,ow,(function(){return this}));var cw={IteratorPrototype:uf,BUGGY_SAFARI_ITERATORS:aw},tA=Id,nA=yb?{}.toString:function(){return"[object "+tA(this)+"]"},Fx=yb,Za=Yt.f,Oa=bc,rA=Vr,iA=nA,lw=Rr("toStringTag"),Du=function(t,r,s,a){var c=s?t:t&&t.prototype;c&&(rA(c,lw)||Za(c,lw,{configurable:!0,value:r}),a&&!Fx&&Oa(c,"toString",iA))},sA=cw.IteratorPrototype,uw=S_,oA=nt,dw=Du,aA=Kl,cA=function(){return this},N_=function(t,r,s,a){var c=r+" Iterator";return t.prototype=uw(sA,{next:oA(+!a,s)}),dw(t,c,!1,!0),aA[c]=cA,t},hw=Kn,lA=we,pw=dv,fv=N_,Bx=Uh,uA=Du,mv=jd,fw=Kl,gv=cw,Fd=pw.PROPER,_v=gv.BUGGY_SAFARI_ITERATORS,yv=Rr("iterator"),Ev="keys",x_="values",mw="entries",D_=function(){return this},Vo=function(t,r,s,a,c,d,h){fv(s,r,a);var m,g,v,w=function(ee){if(ee===c&&B)return B;if(!_v&&ee&&ee in N)return N[ee];switch(ee){case Ev:case x_:case mw:return function(){return new s(this,ee)}}return function(){return new s(this)}},I=r+" Iterator",A=!1,N=t.prototype,H=N[yv]||N["@@iterator"]||c&&N[c],B=!_v&&H||w(c),z=r==="Array"&&N.entries||H;if(z&&(m=Bx(z.call(new t)))!==Object.prototype&&m.next&&(uA(m,I,!0,!0),fw[I]=D_),Fd&&c===x_&&H&&H.name!==x_&&(A=!0,B=function(){return lA(H,this)}),c)if(g={values:w(x_),keys:d?B:w(Ev),entries:w(mw)},h)for(v in g)(_v||A||!(v in N))&&mv(N,v,g[v]);else hw({target:r,proto:!0,forced:_v||A},g);return h&&N[yv]!==B&&mv(N,yv,B,{}),fw[r]=B,g},vv=function(t,r){return{value:t,done:r}},zx=an,L_=Kl,jo=Gh;Yt.f;var Wx=Vo,dn=vv,df="Array Iterator",gw=jo.set,dA=jo.getterFor(df);Wx(Array,"Array",(function(t,r){gw(this,{type:df,target:zx(t),index:0,kind:r})}),(function(){var t=dA(this),r=t.target,s=t.index++;if(!r||s>=r.length)return t.target=null,dn(void 0,!0);switch(t.kind){case"keys":return dn(s,!1);case"values":return dn(r[s],!1)}return dn([s,r[s]],!1)}),"values"),L_.Arguments=L_.Array;var Gx=Yt,Hh=function(t,r,s){return Gx.f(t,r,s)},Sv=vt,_w=Hh,hA=Se,yw=Rr("species"),pA=O,Ew=TypeError,M_=function(t,r){if(pA(r,t))return t;throw new Ew("Incorrect invocation")},Fo=de,Rc=xl,$h=R(Function.toString);Fo(Rc.inspectSource)||(Rc.inspectSource=function(t){return $h(t)});var vw=Rc.inspectSource,fA=R,Jl=u,Sw=de,Lu=Id,Hx=vw,bw=function(){},ww=vt("Reflect","construct"),bv=/^\s*(?:class|function)\b/,mA=fA(bv.exec),$x=!bv.test(bw),Kh=function(t){if(!Sw(t))return!1;try{return ww(bw,[],t),!0}catch{return!1}},wv=function(t){if(!Sw(t))return!1;switch(Lu(t)){case"AsyncFunction":case"GeneratorFunction":case"AsyncGeneratorFunction":return!1}try{return $x||!!mA(bv,Hx(t))}catch{return!0}};wv.sham=!0;var ca,Ir,no,hs,js=!ww||Jl((function(){var t;return Kh(Kh.call)||!Kh(Object)||!Kh((function(){t=!0}))||t}))?wv:Kh,Ic=js,Um=So,ro=TypeError,Vm=rr,hf=function(t){if(Ic(t))return t;throw new ro(Um(t)+" is not a constructor")},Tv=Ct,Tw=Rr("species"),pf=function(t,r){var s,a=Vm(t).constructor;return a===void 0||Tv(s=Vm(a)[Tw])?r:hf(s)},Ts=R([].slice),Cw=TypeError,nl=function(t,r){if(t<r)throw new Cw("Not enough arguments");return t},Mu=/(?:ipad|iphone|ipod).*applewebkit/i.test(cn),la=D,Rw=re,qh=ct,U_=de,Yh=Vr,V_=u,jm=JE,Iw=Ts,j_=Cu,Cv=nl,ka=Mu,Xh=bm,Ac=la.setImmediate,ua=la.clearImmediate,gA=la.process,F_=la.Dispatch,Aw=la.Function,_A=la.MessageChannel,Jh=la.String,Rv=0,ff={},Qh="onreadystatechange";V_((function(){ca=la.location}));var B_=function(t){if(Yh(ff,t)){var r=ff[t];delete ff[t],r()}},Bd=function(t){return function(){B_(t)}},Pw=function(t){B_(t.data)},Ow=function(t){la.postMessage(Jh(t),ca.protocol+"//"+ca.host)};Ac&&ua||(Ac=function(t){Cv(arguments.length,1);var r=U_(t)?t:Aw(t),s=Iw(arguments,1);return ff[++Rv]=function(){Rw(r,void 0,s)},Ir(Rv),Rv},ua=function(t){delete ff[t]},Xh?Ir=function(t){gA.nextTick(Bd(t))}:F_&&F_.now?Ir=function(t){F_.now(Bd(t))}:_A&&!ka?(hs=(no=new _A).port2,no.port1.onmessage=Pw,Ir=qh(hs.postMessage,hs)):la.addEventListener&&U_(la.postMessage)&&!la.importScripts&&ca&&ca.protocol!=="file:"&&!V_(Ow)?(Ir=Ow,la.addEventListener("message",Pw,!1)):Ir=Qh in j_("script")?function(t){jm.appendChild(j_("script"))[Qh]=function(){jm.removeChild(this),B_(t)}}:function(t){setTimeout(Bd(t),0)});var Fm={set:Ac,clear:ua},z_=D,Kx=Se,qx=Object.getOwnPropertyDescriptor,kw=function(t){if(!Kx)return z_[t];var r=qx(z_,t);return r&&r.value},Nw=function(){this.head=null,this.tail=null};Nw.prototype={add:function(t){var r={item:t,next:null},s=this.tail;s?s.next=r:this.head=r,this.tail=r},get:function(){var t=this.head;if(t)return(this.head=t.next)===null&&(this.tail=null),t.item}};var rl,xw,Zh,Iv,is,yA=Nw,EA=/ipad|iphone|ipod/i.test(cn)&&typeof Pebble<"u",Yx=/web0s(?!.*chrome)/i.test(cn),Bm=D,vA=kw,Dw=ct,Lw=Fm.set,il=yA,Mw=Mu,Xx=EA,ep=Yx,zm=bm,tp=Bm.MutationObserver||Bm.WebKitMutationObserver,W_=Bm.document,Av=Bm.process,Wm=Bm.Promise,Uw=vA("queueMicrotask");if(!Uw){var Gm=new il,Pv=function(){var t,r;for(zm&&(t=Av.domain)&&t.exit();r=Gm.get();)try{r()}catch(s){throw Gm.head&&rl(),s}t&&t.enter()};Mw||zm||ep||!tp||!W_?!Xx&&Wm&&Wm.resolve?((Iv=Wm.resolve(void 0)).constructor=Wm,is=Dw(Iv.then,Iv),rl=function(){is(Pv)}):zm?rl=function(){Av.nextTick(Pv)}:(Lw=Dw(Lw,Bm),rl=function(){Lw(Pv)}):(xw=!0,Zh=W_.createTextNode(""),new tp(Pv).observe(Zh,{characterData:!0}),rl=function(){Zh.data=xw=!xw}),Uw=function(t){Gm.head||rl(),Gm.add(t)}}var Vw=Uw,mf=function(t){try{return{error:!1,value:t()}}catch(r){return{error:!0,value:r}}},Uu=D.Promise,Ov=D,Hm=Uu,jw=de,Jx=Ra,SA=vw,Fw=Rr,G_=d_,H_=ri,$_=Hm&&Hm.prototype,bA=Fw("species"),wA=jw(Ov.PromiseRejectionEvent),kv=Jx("Promise",(function(){var t=SA(Hm),r=t!==String(Hm);if(!r&&H_===66||!$_.catch||!$_.finally)return!0;if(!H_||H_<51||!/native code/.test(t)){var s=new Hm((function(c){c(1)})),a=function(c){c((function(){}),(function(){}))};if((s.constructor={})[bA]=a,!(s.then((function(){}))instanceof a))return!0}return!(r||G_!=="BROWSER"&&G_!=="DENO"||wA)})),K_={CONSTRUCTOR:kv,REJECTION_EVENT:wA},ec={},TA=Kt,Nv=TypeError,f=function(t){var r,s;this.promise=new t((function(a,c){if(r!==void 0||s!==void 0)throw new Nv("Bad Promise constructor");r=a,s=c})),this.resolve=TA(r),this.reject=TA(s)};ec.f=function(t){return new f(t)};var _,C,x=Kn,j=bm,K=D,fe=we,Oe=jd,Ve=Du,ut=function(t){var r=Sv(t);hA&&r&&!r[yw]&&_w(r,yw,{configurable:!0,get:function(){return this}})},xt=Kt,Dt=de,kt=on,ln=M_,gn=pf,yn=Fm.set,ss=Vw,Qe=function(t,r){try{arguments.length===1?console.error(t):console.error(t,r)}catch{}},Be=mf,it=yA,Vt=Gh,vn=Uu,xn=K_,Dn=ec,Bn="Promise",io=xn.CONSTRUCTOR,Qr=xn.REJECTION_EVENT,Vu=Vt.getterFor(Bn),Qx=Vt.set,_ce=vn&&vn.prototype,Bw=vn,Zx=_ce,a4=K.TypeError,eD=K.document,tD=K.process,nD=Dn.f,yce=nD,Ece=!!(eD&&eD.createEvent&&K.dispatchEvent),c4="unhandledrejection",l4=function(t){var r;return!(!kt(t)||!Dt(r=t.then))&&r},u4=function(t,r){var s,a,c,d=r.value,h=r.state===1,m=h?t.ok:t.fail,g=t.resolve,v=t.reject,w=t.domain;try{m?(h||(r.rejection===2&&Sce(r),r.rejection=1),m===!0?s=d:(w&&w.enter(),s=m(d),w&&(w.exit(),c=!0)),s===t.promise?v(new a4("Promise-chain cycle")):(a=l4(s))?fe(a,s,g,v):g(s)):v(d)}catch(I){w&&!c&&w.exit(),v(I)}},d4=function(t,r){t.notified||(t.notified=!0,ss((function(){for(var s,a=t.reactions;s=a.get();)u4(s,t);t.notified=!1,r&&!t.rejection&&vce(t)})))},h4=function(t,r,s){var a,c;Ece?((a=eD.createEvent("Event")).promise=r,a.reason=s,a.initEvent(t,!1,!0),K.dispatchEvent(a)):a={promise:r,reason:s},!Qr&&(c=K["on"+t])?c(a):t===c4&&Qe("Unhandled promise rejection",s)},vce=function(t){fe(yn,K,(function(){var r,s=t.facade,a=t.value;if(p4(t)&&(r=Be((function(){j?tD.emit("unhandledRejection",a,s):h4(c4,s,a)})),t.rejection=j||p4(t)?2:1,r.error))throw r.value}))},p4=function(t){return t.rejection!==1&&!t.parent},Sce=function(t){fe(yn,K,(function(){var r=t.facade;j?tD.emit("rejectionHandled",r):h4("rejectionhandled",r,t.value)}))},xv=function(t,r,s){return function(a){t(r,a,s)}},Dv=function(t,r,s){t.done||(t.done=!0,s&&(t=s),t.value=r,t.state=2,d4(t,!0))},rD=function(t,r,s){if(!t.done){t.done=!0,s&&(t=s);try{if(t.facade===r)throw new a4("Promise can't be resolved itself");var a=l4(r);a?ss((function(){var c={done:!1};try{fe(a,r,xv(rD,c,t),xv(Dv,c,t))}catch(d){Dv(c,d,t)}})):(t.value=r,t.state=1,d4(t,!1))}catch(c){Dv({done:!1},c,t)}}};io&&(Zx=(Bw=function(t){ln(this,Zx),xt(t),fe(_,this);var r=Vu(this);try{t(xv(rD,r),xv(Dv,r))}catch(s){Dv(r,s)}}).prototype,(_=function(t){Qx(this,{type:Bn,done:!1,notified:!1,parent:!1,reactions:new it,rejection:!1,state:0,value:null})}).prototype=Oe(Zx,"then",(function(t,r){var s=Vu(this),a=nD(gn(this,Bw));return s.parent=!0,a.ok=!Dt(t)||t,a.fail=Dt(r)&&r,a.domain=j?tD.domain:void 0,s.state===0?s.reactions.add(a):ss((function(){u4(a,s)})),a.promise})),C=function(){var t=new _,r=Vu(t);this.promise=t,this.resolve=xv(rD,r),this.reject=xv(Dv,r)},Dn.f=nD=function(t){return t===Bw||t===void 0?new C(t):yce(t)}),x({global:!0,wrap:!0,forced:io},{Promise:Bw}),Ve(Bw,Bn,!1,!0),ut(Bn);var f4=Rr("iterator"),m4=!1;try{var bce=0,g4={next:function(){return{done:!!bce++}},return:function(){m4=!0}};g4[f4]=function(){return this},Array.from(g4,(function(){throw 2}))}catch{}var wce=Uu,Tce=function(t,r){try{if(!r&&!m4)return!1}catch{return!1}var s=!1;try{var a={};a[f4]=function(){return{next:function(){return{done:s=!0}}}},t(a)}catch{}return s},CA=K_.CONSTRUCTOR||!Tce((function(t){wce.all(t).then(void 0,(function(){}))})),Cce=we,Rce=Kt,Ice=ec,Ace=mf,Pce=Ud;Kn({target:"Promise",stat:!0,forced:CA},{all:function(t){var r=this,s=Ice.f(r),a=s.resolve,c=s.reject,d=Ace((function(){var h=Rce(r.resolve),m=[],g=0,v=1;Pce(t,(function(w){var I=g++,A=!1;v++,Cce(h,r,w).then((function(N){A||(A=!0,m[I]=N,--v||a(m))}),c)})),--v||a(m)}));return d.error&&c(d.value),s.promise}});var Oce=Kn,kce=K_.CONSTRUCTOR;Uu&&Uu.prototype,Oce({target:"Promise",proto:!0,forced:kce,real:!0},{catch:function(t){return this.then(void 0,t)}});var Nce=we,xce=Kt,Dce=ec,Lce=mf,Mce=Ud;Kn({target:"Promise",stat:!0,forced:CA},{race:function(t){var r=this,s=Dce.f(r),a=s.reject,c=Lce((function(){var d=xce(r.resolve);Mce(t,(function(h){Nce(d,r,h).then(s.resolve,a)}))}));return c.error&&a(c.value),s.promise}});var Uce=ec;Kn({target:"Promise",stat:!0,forced:K_.CONSTRUCTOR},{reject:function(t){var r=Uce.f(this);return(0,r.reject)(t),r.promise}});var Vce=rr,jce=on,Fce=ec,_4=function(t,r){if(Vce(t),jce(r)&&r.constructor===t)return r;var s=Fce.f(t);return(0,s.resolve)(r),s.promise},Bce=Kn,zce=Uu,Wce=K_.CONSTRUCTOR,Gce=_4,Hce=vt("Promise"),$ce=!Wce;Bce({target:"Promise",stat:!0,forced:!0},{resolve:function(t){return Gce($ce&&this===Hce?zce:this,t)}});var Kce=we,qce=Kt,Yce=ec,Xce=mf,Jce=Ud;Kn({target:"Promise",stat:!0,forced:CA},{allSettled:function(t){var r=this,s=Yce.f(r),a=s.resolve,c=s.reject,d=Xce((function(){var h=qce(r.resolve),m=[],g=0,v=1;Jce(t,(function(w){var I=g++,A=!1;v++,Kce(h,r,w).then((function(N){A||(A=!0,m[I]={status:"fulfilled",value:N},--v||a(m))}),(function(N){A||(A=!0,m[I]={status:"rejected",reason:N},--v||a(m))}))})),--v||a(m)}));return d.error&&c(d.value),s.promise}});var Qce=we,Zce=Kt,ele=vt,tle=ec,nle=mf,rle=Ud,y4="No one promise resolved";Kn({target:"Promise",stat:!0,forced:CA},{any:function(t){var r=this,s=ele("AggregateError"),a=tle.f(r),c=a.resolve,d=a.reject,h=nle((function(){var m=Zce(r.resolve),g=[],v=0,w=1,I=!1;rle(t,(function(A){var N=v++,H=!1;w++,Qce(m,r,A).then((function(B){H||I||(I=!0,c(B))}),(function(B){H||I||(H=!0,g[N]=B,--w||d(new s(g,y4)))}))})),--w||d(new s(g,y4))}));return h.error&&d(h.value),a.promise}});var ile=Kn,sle=re,ole=Ts,ale=ec,cle=Kt,E4=mf,iD=D.Promise,v4=!1;ile({target:"Promise",stat:!0,forced:!iD||!iD.try||E4((function(){iD.try((function(t){v4=t===8}),8)})).error||!v4},{try:function(t){var r=arguments.length>1?ole(arguments,1):[],s=ale.f(this),a=E4((function(){return sle(cle(t),void 0,r)}));return(a.error?s.reject:s.resolve)(a.value),s.promise}});var lle=ec;Kn({target:"Promise",stat:!0},{withResolvers:function(){var t=lle.f(this);return{promise:t.promise,resolve:t.resolve,reject:t.reject}}});var ule=Kn,sD=Uu,dle=u,hle=vt,ple=de,fle=pf,S4=_4,mle=sD&&sD.prototype;ule({target:"Promise",proto:!0,real:!0,forced:!!sD&&dle((function(){mle.finally.call({then:function(){}},(function(){}))}))},{finally:function(t){var r=fle(this,hle("Promise")),s=ple(t);return this.then(s?function(a){return S4(r,t()).then((function(){return a}))}:t,s?function(a){return S4(r,t()).then((function(){throw a}))}:t)}});var oD=R,gle=P,_le=Ya,yle=Jt,Ele=oD("".charAt),b4=oD("".charCodeAt),vle=oD("".slice),w4=function(t){return function(r,s){var a,c,d=_le(yle(r)),h=gle(s),m=d.length;return h<0||h>=m?t?"":void 0:(a=b4(d,h))<55296||a>56319||h+1===m||(c=b4(d,h+1))<56320||c>57343?t?Ele(d,h):a:t?vle(d,h,h+2):c-56320+(a-55296<<10)+65536}},aD={codeAt:w4(!1),charAt:w4(!0)},Sle=aD.charAt,ble=Ya,T4=Gh,wle=Vo,C4=vv,R4="String Iterator",Tle=T4.set,Cle=T4.getterFor(R4);wle(String,"String",(function(t){Tle(this,{type:R4,string:ble(t),index:0})}),(function(){var t,r=Cle(this),s=r.string,a=r.index;return a>=s.length?C4(void 0,!0):(t=Sle(s,a),r.index+=t.length,C4(t,!1))}));var Rle=bt.Promise,Ile={CSSRuleList:0,CSSStyleDeclaration:0,CSSValueList:0,ClientRectList:0,DOMRectList:0,DOMStringList:0,DOMTokenList:1,DataTransferItemList:0,FileList:0,HTMLAllCollection:0,HTMLCollection:0,HTMLFormElement:0,HTMLSelectElement:0,MediaList:0,MimeTypeArray:0,NamedNodeMap:0,NodeList:1,PaintRequestList:0,Plugin:0,PluginArray:0,SVGLengthList:0,SVGNumberList:0,SVGPathSegList:0,SVGPointList:0,SVGStringList:0,SVGTransformList:0,SourceBufferList:0,StyleSheetList:0,TextTrackCueList:0,TextTrackList:0,TouchList:0},Ale=D,Ple=Du,I4=Kl;for(var cD in Ile)Ple(Ale[cD],cD),I4[cD]=I4.Array;var A4=Rle,mt=l(A4),Ole=wc("Array","values"),kle=Id,Nle=Vr,xle=O,Dle=Ole,lD=Array.prototype,Lle={DOMTokenList:!0,NodeList:!0},Mle=function(t){var r=t.values;return t===lD||xle(lD,t)&&r===lD.values||Nle(Lle,kle(t))?Dle:r},Pc=l(Mle),P4=So,Ule=TypeError,O4=Ts,Vle=Math.floor,uD=function(t,r){var s=t.length;if(s<8)for(var a,c,d=1;d<s;){for(c=d,a=t[d];c&&r(t[c-1],a)>0;)t[c]=t[--c];c!==d++&&(t[c]=a)}else for(var h=Vle(s/2),m=uD(O4(t,0,h),r),g=uD(O4(t,h),r),v=m.length,w=g.length,I=0,A=0;I<v||A<w;)t[I+A]=I<v&&A<w?r(m[I],g[A])<=0?m[I++]:g[A++]:I<v?m[I++]:g[A++];return t},k4=uD,N4=cn.match(/firefox\/(\d+)/i),jle=!!N4&&+N4[1],Fle=/MSIE|Trident/.test(cn),x4=cn.match(/AppleWebKit\/(\d+)\./),Ble=!!x4&&+x4[1],zle=Kn,D4=R,Wle=Kt,Gle=Qs,L4=mr,Hle=function(t,r){if(!delete t[r])throw new Ule("Cannot delete property "+P4(r)+" of "+P4(t))},M4=Ya,dD=u,$le=k4,Kle=u_,U4=jle,qle=Fle,V4=ri,j4=Ble,$m=[],F4=D4($m.sort),Yle=D4($m.push),Xle=dD((function(){$m.sort(void 0)})),Jle=dD((function(){$m.sort(null)})),Qle=Kle("sort"),B4=!dD((function(){if(V4)return V4<70;if(!(U4&&U4>3)){if(qle)return!0;if(j4)return j4<603;var t,r,s,a,c="";for(t=65;t<76;t++){switch(r=String.fromCharCode(t),t){case 66:case 69:case 70:case 72:s=3;break;case 68:case 71:s=4;break;default:s=2}for(a=0;a<47;a++)$m.push({k:r+a,v:s})}for($m.sort((function(d,h){return h.v-d.v})),a=0;a<$m.length;a++)r=$m[a].k.charAt(0),c.charAt(c.length-1)!==r&&(c+=r);return c!=="DGBEFHACIJK"}}));zle({target:"Array",proto:!0,forced:Xle||!Jle||!Qle||!B4},{sort:function(t){t!==void 0&&Wle(t);var r=Gle(this);if(B4)return t===void 0?F4(r):F4(r,t);var s,a,c=[],d=L4(r);for(a=0;a<d;a++)a in r&&Yle(c,r[a]);for($le(c,(function(h){return function(m,g){return g===void 0?-1:m===void 0?1:h!==void 0?+h(m,g)||0:M4(m)>M4(g)?1:-1}})(t)),s=L4(c),a=0;a<s;)r[a]=c[a++];for(;a<d;)Hle(r,a++);return r}});var Zle=wc("Array","sort"),eue=O,tue=Zle,hD=Array.prototype,nue=function(t){var r=t.sort;return t===hD||eue(hD,t)&&r===hD.sort?tue:r},q_=l(nue),rue=Kn,iue=R,sue=Ye,oue=RangeError,z4=String.fromCharCode,W4=String.fromCodePoint,aue=iue([].join);rue({target:"String",stat:!0,forced:!!W4&&W4.length!==1},{fromCodePoint:function(t){for(var r,s=[],a=arguments.length,c=0;a>c;){if(r=+arguments[c++],sue(r,1114111)!==r)throw new oue(r+" is not a valid code point");s[c]=r<65536?z4(r):z4(55296+((r-=65536)>>10),r%1024+56320)}return aue(s,"")}});var cue=u,lue=Rr("iterator"),RA=!cue((function(){var t=new URL("b?a=1&b=2&c=3","https://a"),r=t.searchParams,s=new URLSearchParams("a=1&a=2&b=3"),a="";return t.pathname="c%20d",r.forEach((function(c,d){r.delete("b"),a+=d+c})),s.delete("a",2),s.delete("b",void 0),!t.toJSON||!s.has("a",1)||s.has("a",2)||!s.has("a",void 0)||s.has("b")||!r.size&&!0||!r.sort||t.href!=="https://a/c%20d?a=1&c=3"||r.get("c")!=="3"||String(new URLSearchParams("?a=1"))!=="a=1"||!r[lue]||new URL("https://a@b").username!=="a"||new URLSearchParams(new URLSearchParams("a=b")).get("a")!=="b"||new URL("https://").host!=="xn--e1aybc"||new URL("https://a#").hash!=="#%D0%B1"||a!=="a1c3"||new URL("https://x",void 0).host!=="x"})),uue=jd,pD=Kn,G4=D,fD=kw,due=vt,IA=we,zd=R,zw=Se,H4=RA,$4=jd,hue=Hh,pue=function(t,r,s){for(var a in r)s&&s.unsafe&&t[a]?t[a]=r[a]:uue(t,a,r[a],s);return t},fue=Du,mue=N_,mD=Gh,K4=M_,gD=de,gue=Vr,_ue=ct,yue=Id,Eue=rr,q4=on,Oc=Ya,vue=S_,Y4=nt,X4=sf,Sue=ql,AA=vv,Lv=nl,bue=k4,wue=Rr("iterator"),Mv="URLSearchParams",J4=Mv+"Iterator",Q4=mD.set,ju=mD.getterFor(Mv),Tue=mD.getterFor(J4),Z4=fD("fetch"),PA=fD("Request"),Ww=fD("Headers"),_D=PA&&PA.prototype,e6=Ww&&Ww.prototype,Cue=G4.TypeError,Rue=G4.encodeURIComponent,Iue=String.fromCharCode,Aue=due("String","fromCodePoint"),Pue=parseInt,OA=zd("".charAt),t6=zd([].join),Km=zd([].push),n6=zd("".replace),Oue=zd([].shift),r6=zd([].splice),i6=zd("".split),s6=zd("".slice),kue=zd(/./.exec),Nue=/\+/g,xue=/^[0-9a-f]+$/i,o6=function(t,r){var s=s6(t,r,r+2);return kue(xue,s)?Pue(s,16):NaN},Due=function(t){for(var r=0,s=128;s>0&&(t&s)!=0;s>>=1)r++;return r},Lue=function(t){var r=null;switch(t.length){case 1:r=t[0];break;case 2:r=(31&t[0])<<6|63&t[1];break;case 3:r=(15&t[0])<<12|(63&t[1])<<6|63&t[2];break;case 4:r=(7&t[0])<<18|(63&t[1])<<12|(63&t[2])<<6|63&t[3]}return r>1114111?null:r},a6=function(t){for(var r=(t=n6(t,Nue," ")).length,s="",a=0;a<r;){var c=OA(t,a);if(c==="%"){if(OA(t,a+1)==="%"||a+3>r){s+="%",a++;continue}var d=o6(t,a+1);if(d!=d){s+=c,a++;continue}a+=2;var h=Due(d);if(h===0)c=Iue(d);else{if(h===1||h>4){s+="",a++;continue}for(var m=[d],g=1;g<h&&!(++a+3>r||OA(t,a)!=="%");){var v=o6(t,a+1);if(v!=v){a+=3;break}if(v>191||v<128)break;Km(m,v),a+=2,g++}if(m.length!==h){s+="";continue}var w=Lue(m);w===null?s+="":c=Aue(w)}}s+=c,a++}return s},Mue=/[!'()~]|%20/g,Uue={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+"},Vue=function(t){return Uue[t]},c6=function(t){return n6(Rue(t),Mue,Vue)},yD=mue((function(t,r){Q4(this,{type:J4,target:ju(t).entries,index:0,kind:r})}),Mv,(function(){var t=Tue(this),r=t.target,s=t.index++;if(!r||s>=r.length)return t.target=null,AA(void 0,!0);var a=r[s];switch(t.kind){case"keys":return AA(a.key,!1);case"values":return AA(a.value,!1)}return AA([a.key,a.value],!1)}),!0),l6=function(t){this.entries=[],this.url=null,t!==void 0&&(q4(t)?this.parseObject(t):this.parseQuery(typeof t=="string"?OA(t,0)==="?"?s6(t,1):t:Oc(t)))};l6.prototype={type:Mv,bindURL:function(t){this.url=t,this.update()},parseObject:function(t){var r,s,a,c,d,h,m,g=this.entries,v=Sue(t);if(v)for(s=(r=X4(t,v)).next;!(a=IA(s,r)).done;){if(d=(c=X4(Eue(a.value))).next,(h=IA(d,c)).done||(m=IA(d,c)).done||!IA(d,c).done)throw new Cue("Expected sequence with length 2");Km(g,{key:Oc(h.value),value:Oc(m.value)})}else for(var w in t)gue(t,w)&&Km(g,{key:w,value:Oc(t[w])})},parseQuery:function(t){if(t)for(var r,s,a=this.entries,c=i6(t,"&"),d=0;d<c.length;)(r=c[d++]).length&&(s=i6(r,"="),Km(a,{key:a6(Oue(s)),value:a6(t6(s,"="))}))},serialize:function(){for(var t,r=this.entries,s=[],a=0;a<r.length;)t=r[a++],Km(s,c6(t.key)+"="+c6(t.value));return t6(s,"&")},update:function(){this.entries.length=0,this.parseQuery(this.url.query)},updateURL:function(){this.url&&this.url.update()}};var kA=function(){K4(this,Uv);var t=Q4(this,new l6(arguments.length>0?arguments[0]:void 0));zw||(this.size=t.entries.length)},Uv=kA.prototype;if(pue(Uv,{append:function(t,r){var s=ju(this);Lv(arguments.length,2),Km(s.entries,{key:Oc(t),value:Oc(r)}),zw||this.length++,s.updateURL()},delete:function(t){for(var r=ju(this),s=Lv(arguments.length,1),a=r.entries,c=Oc(t),d=s<2?void 0:arguments[1],h=d===void 0?d:Oc(d),m=0;m<a.length;){var g=a[m];if(g.key!==c||h!==void 0&&g.value!==h)m++;else if(r6(a,m,1),h!==void 0)break}zw||(this.size=a.length),r.updateURL()},get:function(t){var r=ju(this).entries;Lv(arguments.length,1);for(var s=Oc(t),a=0;a<r.length;a++)if(r[a].key===s)return r[a].value;return null},getAll:function(t){var r=ju(this).entries;Lv(arguments.length,1);for(var s=Oc(t),a=[],c=0;c<r.length;c++)r[c].key===s&&Km(a,r[c].value);return a},has:function(t){for(var r=ju(this).entries,s=Lv(arguments.length,1),a=Oc(t),c=s<2?void 0:arguments[1],d=c===void 0?c:Oc(c),h=0;h<r.length;){var m=r[h++];if(m.key===a&&(d===void 0||m.value===d))return!0}return!1},set:function(t,r){var s=ju(this);Lv(arguments.length,1);for(var a,c=s.entries,d=!1,h=Oc(t),m=Oc(r),g=0;g<c.length;g++)(a=c[g]).key===h&&(d?r6(c,g--,1):(d=!0,a.value=m));d||Km(c,{key:h,value:m}),zw||(this.size=c.length),s.updateURL()},sort:function(){var t=ju(this);bue(t.entries,(function(r,s){return r.key>s.key?1:-1})),t.updateURL()},forEach:function(t){for(var r,s=ju(this).entries,a=_ue(t,arguments.length>1?arguments[1]:void 0),c=0;c<s.length;)a((r=s[c++]).value,r.key,this)},keys:function(){return new yD(this,"keys")},values:function(){return new yD(this,"values")},entries:function(){return new yD(this,"entries")}},{enumerable:!0}),$4(Uv,wue,Uv.entries,{}),$4(Uv,"toString",(function(){return ju(this).serialize()}),{enumerable:!0}),zw&&hue(Uv,"size",{get:function(){return ju(this).entries.length},configurable:!0,enumerable:!0}),fue(kA,Mv),pD({global:!0,forced:!H4},{URLSearchParams:kA}),!H4&&gD(Ww)){var jue=zd(e6.has),Fue=zd(e6.set),u6=function(t){if(q4(t)){var r,s=t.body;if(yue(s)===Mv)return r=t.headers?new Ww(t.headers):new Ww,jue(r,"content-type")||Fue(r,"content-type","application/x-www-form-urlencoded;charset=UTF-8"),vue(t,{body:Y4(0,Oc(s)),headers:Y4(0,r)})}return t};if(gD(Z4)&&pD({global:!0,dontCallGetSet:!0,forced:!0},{fetch:function(t){return Z4(t,arguments.length>1?u6(arguments[1]):{})}}),gD(PA)){var ED=function(t){return K4(this,_D),new PA(t,arguments.length>1?u6(arguments[1]):{})};_D.constructor=ED,ED.prototype=_D,pD({global:!0,dontCallGetSet:!0,forced:!0},{Request:ED})}}var Fu,Bue={URLSearchParams:kA,getState:ju},zue=bt.URLSearchParams,d6=Se,Wue=R,Gue=we,Hue=u,vD=Pa,$ue=Rm,Kue=Re,que=Qs,Yue=at,Vv=Object.assign,h6=Object.defineProperty,Xue=Wue([].concat),Jue=!Vv||Hue((function(){if(d6&&Vv({b:1},Vv(h6({},"a",{enumerable:!0,get:function(){h6(this,"b",{value:3,enumerable:!1})}}),{b:2})).b!==1)return!0;var t={},r={},s=Symbol("assign detection"),a="abcdefghijklmnopqrst";return t[s]=7,a.split("").forEach((function(c){r[c]=c})),Vv({},t)[s]!==7||vD(Vv({},r)).join("")!==a}))?function(t,r){for(var s=que(t),a=arguments.length,c=1,d=$ue.f,h=Kue.f;a>c;)for(var m,g=Yue(arguments[c++]),v=d?Xue(vD(g),d(g)):vD(g),w=v.length,I=0;w>I;)m=v[I++],d6&&!Gue(h,g,m)||(s[m]=g[m]);return s}:Vv,Que=rr,Zue=of,ede=Se,tde=Yt,nde=nt,SD=function(t,r,s){ede?tde.f(t,r,nde(0,s)):t[r]=s},rde=ct,ide=we,sde=Qs,ode=function(t,r,s,a){try{return a?r(Que(s)[0],s[1]):r(s)}catch(c){Zue(t,"throw",c)}},ade=Wb,cde=js,lde=mr,p6=SD,ude=sf,dde=ql,f6=Array,Y_=R,bD=2147483647,hde=/[^\0-\u007E]/,m6=/[.\u3002\uFF0E\uFF61]/g,g6="Overflow: input needs wider integers to process",_6=RangeError,pde=Y_(m6.exec),jv=Math.floor,wD=String.fromCharCode,y6=Y_("".charCodeAt),E6=Y_([].join),qm=Y_([].push),fde=Y_("".replace),mde=Y_("".split),gde=Y_("".toLowerCase),v6=function(t){return t+22+75*(t<26)},_de=function(t,r,s){var a=0;for(t=s?jv(t/700):t>>1,t+=jv(t/r);t>455;)t=jv(t/35),a+=36;return jv(a+36*t/(t+38))},yde=function(t){var r=[];t=(function(ee){for(var Z=[],ae=0,ye=ee.length;ae<ye;){var _e=y6(ee,ae++);if(_e>=55296&&_e<=56319&&ae<ye){var ue=y6(ee,ae++);(64512&ue)==56320?qm(Z,((1023&_e)<<10)+(1023&ue)+65536):(qm(Z,_e),ae--)}else qm(Z,_e)}return Z})(t);var s,a,c=t.length,d=128,h=0,m=72;for(s=0;s<t.length;s++)(a=t[s])<128&&qm(r,wD(a));var g=r.length,v=g;for(g&&qm(r,"-");v<c;){var w=bD;for(s=0;s<t.length;s++)(a=t[s])>=d&&a<w&&(w=a);var I=v+1;if(w-d>jv((bD-h)/I))throw new _6(g6);for(h+=(w-d)*I,d=w,s=0;s<t.length;s++){if((a=t[s])<d&&++h>bD)throw new _6(g6);if(a===d){for(var A=h,N=36;;){var H=N<=m?1:N>=m+26?26:N-m;if(A<H)break;var B=A-H,z=36-H;qm(r,wD(v6(H+B%z))),A=jv(B/z),N+=36}qm(r,wD(v6(A))),m=_de(h,I,v===g),h=0,v++}}h++,d++}return E6(r,"")},Ede=Kn,TD=Se,vde=RA,CD=D,S6=ct,Bu=R,NA=jd,zu=Hh,Sde=M_,RD=Vr,ID=Jue,Fv=function(t){var r=sde(t),s=cde(this),a=arguments.length,c=a>1?arguments[1]:void 0,d=c!==void 0;d&&(c=rde(c,a>2?arguments[2]:void 0));var h,m,g,v,w,I,A=dde(r),N=0;if(!A||this===f6&&ade(A))for(h=lde(r),m=s?new this(h):f6(h);h>N;N++)I=d?c(r[N],N):r[N],p6(m,N,I);else for(m=s?new this:[],w=(v=ude(r,A)).next;!(g=ide(w,v)).done;N++)I=d?ode(v,c,[g.value,N],!0):g.value,p6(m,N,I);return m.length=N,m},Wd=Ts,bde=aD.codeAt,wde=function(t){var r,s,a=[],c=mde(fde(gde(t),m6,"."),".");for(r=0;r<c.length;r++)s=c[r],qm(a,pde(hde,s)?"xn--"+yde(s):s);return E6(a,".")},gf=Ya,Tde=Du,Cde=nl,b6=Bue,w6=Gh,Rde=w6.set,xA=w6.getterFor("URL"),Ide=b6.URLSearchParams,Ade=b6.getState,Gw=CD.URL,AD=CD.TypeError,DA=CD.parseInt,Pde=Math.floor,T6=Math.pow,Wu=Bu("".charAt),Gd=Bu(/./.exec),Hw=Bu([].join),Ode=Bu(1 .toString),kde=Bu([].pop),Bv=Bu([].push),PD=Bu("".replace),Nde=Bu([].shift),xde=Bu("".split),$w=Bu("".slice),LA=Bu("".toLowerCase),Dde=Bu([].unshift),OD="Invalid scheme",X_="Invalid host",C6="Invalid port",R6=/[a-z]/i,Lde=/[\d+-.a-z]/i,kD=/\d/,Mde=/^0x/i,Ude=/^[0-7]+$/,Vde=/^\d+$/,I6=/^[\da-f]+$/i,jde=/[\0\t\n\r #%/:<>?@[\\\]^|]/,Fde=/[\0\t\n\r #/:<>?@[\\\]^|]/,Bde=/^[\u0000-\u0020]+/,zde=/(^|[^\u0000-\u0020])[\u0000-\u0020]+$/,Wde=/[\t\n\r]/g,Kw=function(t){var r,s,a,c;if(typeof t=="number"){for(r=[],s=0;s<4;s++)Dde(r,t%256),t=Pde(t/256);return Hw(r,".")}if(typeof t=="object"){for(r="",a=(function(d){for(var h=null,m=1,g=null,v=0,w=0;w<8;w++)d[w]!==0?(v>m&&(h=g,m=v),g=null,v=0):(g===null&&(g=w),++v);return v>m?g:h})(t),s=0;s<8;s++)c&&t[s]===0||(c&&(c=!1),a===s?(r+=s?":":"::",c=!0):(r+=Ode(t[s],16),s<7&&(r+=":")));return"["+r+"]"}return t},MA={},A6=ID({},MA,{" ":1,'"':1,"<":1,">":1,"`":1}),P6=ID({},A6,{"#":1,"?":1,"{":1,"}":1}),ND=ID({},P6,{"/":1,":":1,";":1,"=":1,"@":1,"[":1,"\\":1,"]":1,"^":1,"|":1}),Ym=function(t,r){var s=bde(t,0);return s>32&&s<127&&!RD(r,t)?t:encodeURIComponent(t)},UA={ftp:21,file:null,http:80,https:443,ws:80,wss:443},qw=function(t,r){var s;return t.length===2&&Gd(R6,Wu(t,0))&&((s=Wu(t,1))===":"||!r&&s==="|")},O6=function(t){var r;return t.length>1&&qw($w(t,0,2))&&(t.length===2||(r=Wu(t,2))==="/"||r==="\\"||r==="?"||r==="#")},Gde=function(t){return t==="."||LA(t)==="%2e"},xD={},k6={},DD={},N6={},x6={},LD={},D6={},L6={},VA={},jA={},MD={},UD={},VD={},jD={},M6={},FD={},zv={},np={},U6={},J_={},_f={},BD=function(t,r,s){var a,c,d,h=gf(t);if(r){if(c=this.parse(h))throw new AD(c);this.searchParams=null}else{if(s!==void 0&&(a=new BD(s,!0)),c=this.parse(h,null,a))throw new AD(c);(d=Ade(new Ide)).bindURL(this),this.searchParams=d}};BD.prototype={type:"URL",parse:function(t,r,s){var a,c,d,h,m,g=this,v=r||xD,w=0,I="",A=!1,N=!1,H=!1;for(t=gf(t),r||(g.scheme="",g.username="",g.password="",g.host=null,g.port=null,g.path=[],g.query=null,g.fragment=null,g.cannotBeABaseURL=!1,t=PD(t,Bde,""),t=PD(t,zde,"$1")),t=PD(t,Wde,""),a=Fv(t);w<=a.length;){switch(c=a[w],v){case xD:if(!c||!Gd(R6,c)){if(r)return OD;v=DD;continue}I+=LA(c),v=k6;break;case k6:if(c&&(Gd(Lde,c)||c==="+"||c==="-"||c==="."))I+=LA(c);else{if(c!==":"){if(r)return OD;I="",v=DD,w=0;continue}if(r&&(g.isSpecial()!==RD(UA,I)||I==="file"&&(g.includesCredentials()||g.port!==null)||g.scheme==="file"&&!g.host))return;if(g.scheme=I,r)return void(g.isSpecial()&&UA[g.scheme]===g.port&&(g.port=null));I="",g.scheme==="file"?v=jD:g.isSpecial()&&s&&s.scheme===g.scheme?v=N6:g.isSpecial()?v=L6:a[w+1]==="/"?(v=x6,w++):(g.cannotBeABaseURL=!0,Bv(g.path,""),v=U6)}break;case DD:if(!s||s.cannotBeABaseURL&&c!=="#")return OD;if(s.cannotBeABaseURL&&c==="#"){g.scheme=s.scheme,g.path=Wd(s.path),g.query=s.query,g.fragment="",g.cannotBeABaseURL=!0,v=_f;break}v=s.scheme==="file"?jD:LD;continue;case N6:if(c!=="/"||a[w+1]!=="/"){v=LD;continue}v=VA,w++;break;case x6:if(c==="/"){v=jA;break}v=np;continue;case LD:if(g.scheme=s.scheme,c===Fu)g.username=s.username,g.password=s.password,g.host=s.host,g.port=s.port,g.path=Wd(s.path),g.query=s.query;else if(c==="/"||c==="\\"&&g.isSpecial())v=D6;else if(c==="?")g.username=s.username,g.password=s.password,g.host=s.host,g.port=s.port,g.path=Wd(s.path),g.query="",v=J_;else{if(c!=="#"){g.username=s.username,g.password=s.password,g.host=s.host,g.port=s.port,g.path=Wd(s.path),g.path.length--,v=np;continue}g.username=s.username,g.password=s.password,g.host=s.host,g.port=s.port,g.path=Wd(s.path),g.query=s.query,g.fragment="",v=_f}break;case D6:if(!g.isSpecial()||c!=="/"&&c!=="\\"){if(c!=="/"){g.username=s.username,g.password=s.password,g.host=s.host,g.port=s.port,v=np;continue}v=jA}else v=VA;break;case L6:if(v=VA,c!=="/"||Wu(I,w+1)!=="/")continue;w++;break;case VA:if(c!=="/"&&c!=="\\"){v=jA;continue}break;case jA:if(c==="@"){A&&(I="%40"+I),A=!0,d=Fv(I);for(var B=0;B<d.length;B++){var z=d[B];if(z!==":"||H){var ee=Ym(z,ND);H?g.password+=ee:g.username+=ee}else H=!0}I=""}else if(c===Fu||c==="/"||c==="?"||c==="#"||c==="\\"&&g.isSpecial()){if(A&&I==="")return"Invalid authority";w-=Fv(I).length+1,I="",v=MD}else I+=c;break;case MD:case UD:if(r&&g.scheme==="file"){v=FD;continue}if(c!==":"||N){if(c===Fu||c==="/"||c==="?"||c==="#"||c==="\\"&&g.isSpecial()){if(g.isSpecial()&&I==="")return X_;if(r&&I===""&&(g.includesCredentials()||g.port!==null))return;if(h=g.parseHost(I))return h;if(I="",v=zv,r)return;continue}c==="["?N=!0:c==="]"&&(N=!1),I+=c}else{if(I==="")return X_;if(h=g.parseHost(I))return h;if(I="",v=VD,r===UD)return}break;case VD:if(!Gd(kD,c)){if(c===Fu||c==="/"||c==="?"||c==="#"||c==="\\"&&g.isSpecial()||r){if(I!==""){var Z=DA(I,10);if(Z>65535)return C6;g.port=g.isSpecial()&&Z===UA[g.scheme]?null:Z,I=""}if(r)return;v=zv;continue}return C6}I+=c;break;case jD:if(g.scheme="file",c==="/"||c==="\\")v=M6;else{if(!s||s.scheme!=="file"){v=np;continue}switch(c){case Fu:g.host=s.host,g.path=Wd(s.path),g.query=s.query;break;case"?":g.host=s.host,g.path=Wd(s.path),g.query="",v=J_;break;case"#":g.host=s.host,g.path=Wd(s.path),g.query=s.query,g.fragment="",v=_f;break;default:O6(Hw(Wd(a,w),""))||(g.host=s.host,g.path=Wd(s.path),g.shortenPath()),v=np;continue}}break;case M6:if(c==="/"||c==="\\"){v=FD;break}s&&s.scheme==="file"&&!O6(Hw(Wd(a,w),""))&&(qw(s.path[0],!0)?Bv(g.path,s.path[0]):g.host=s.host),v=np;continue;case FD:if(c===Fu||c==="/"||c==="\\"||c==="?"||c==="#"){if(!r&&qw(I))v=np;else if(I===""){if(g.host="",r)return;v=zv}else{if(h=g.parseHost(I))return h;if(g.host==="localhost"&&(g.host=""),r)return;I="",v=zv}continue}I+=c;break;case zv:if(g.isSpecial()){if(v=np,c!=="/"&&c!=="\\")continue}else if(r||c!=="?")if(r||c!=="#"){if(c!==Fu&&(v=np,c!=="/"))continue}else g.fragment="",v=_f;else g.query="",v=J_;break;case np:if(c===Fu||c==="/"||c==="\\"&&g.isSpecial()||!r&&(c==="?"||c==="#")){if((m=LA(m=I))===".."||m==="%2e."||m===".%2e"||m==="%2e%2e"?(g.shortenPath(),c==="/"||c==="\\"&&g.isSpecial()||Bv(g.path,"")):Gde(I)?c==="/"||c==="\\"&&g.isSpecial()||Bv(g.path,""):(g.scheme==="file"&&!g.path.length&&qw(I)&&(g.host&&(g.host=""),I=Wu(I,0)+":"),Bv(g.path,I)),I="",g.scheme==="file"&&(c===Fu||c==="?"||c==="#"))for(;g.path.length>1&&g.path[0]==="";)Nde(g.path);c==="?"?(g.query="",v=J_):c==="#"&&(g.fragment="",v=_f)}else I+=Ym(c,P6);break;case U6:c==="?"?(g.query="",v=J_):c==="#"?(g.fragment="",v=_f):c!==Fu&&(g.path[0]+=Ym(c,MA));break;case J_:r||c!=="#"?c!==Fu&&(c==="'"&&g.isSpecial()?g.query+="%27":g.query+=c==="#"?"%23":Ym(c,MA)):(g.fragment="",v=_f);break;case _f:c!==Fu&&(g.fragment+=Ym(c,A6))}w++}},parseHost:function(t){var r,s,a;if(Wu(t,0)==="["){if(Wu(t,t.length-1)!=="]"||(r=(function(c){var d,h,m,g,v,w,I,A=[0,0,0,0,0,0,0,0],N=0,H=null,B=0,z=function(){return Wu(c,B)};if(z()===":"){if(Wu(c,1)!==":")return;B+=2,H=++N}for(;z();){if(N===8)return;if(z()!==":"){for(d=h=0;h<4&&Gd(I6,z());)d=16*d+DA(z(),16),B++,h++;if(z()==="."){if(h===0||(B-=h,N>6))return;for(m=0;z();){if(g=null,m>0){if(!(z()==="."&&m<4))return;B++}if(!Gd(kD,z()))return;for(;Gd(kD,z());){if(v=DA(z(),10),g===null)g=v;else{if(g===0)return;g=10*g+v}if(g>255)return;B++}A[N]=256*A[N]+g,++m!=2&&m!==4||N++}if(m!==4)return;break}if(z()===":"){if(B++,!z())return}else if(z())return;A[N++]=d}else{if(H!==null)return;B++,H=++N}}if(H!==null)for(w=N-H,N=7;N!==0&&w>0;)I=A[N],A[N--]=A[H+w-1],A[H+--w]=I;else if(N!==8)return;return A})($w(t,1,-1)),!r))return X_;this.host=r}else if(this.isSpecial()){if(t=wde(t),Gd(jde,t)||(r=(function(c){var d,h,m,g,v,w,I,A=xde(c,".");if(A.length&&A[A.length-1]===""&&A.length--,(d=A.length)>4)return c;for(h=[],m=0;m<d;m++){if((g=A[m])==="")return c;if(v=10,g.length>1&&Wu(g,0)==="0"&&(v=Gd(Mde,g)?16:8,g=$w(g,v===8?1:2)),g==="")w=0;else{if(!Gd(v===10?Vde:v===8?Ude:I6,g))return c;w=DA(g,v)}Bv(h,w)}for(m=0;m<d;m++)if(w=h[m],m===d-1){if(w>=T6(256,5-d))return null}else if(w>255)return null;for(I=kde(h),m=0;m<h.length;m++)I+=h[m]*T6(256,3-m);return I})(t),r===null))return X_;this.host=r}else{if(Gd(Fde,t))return X_;for(r="",s=Fv(t),a=0;a<s.length;a++)r+=Ym(s[a],MA);this.host=r}},cannotHaveUsernamePasswordPort:function(){return!this.host||this.cannotBeABaseURL||this.scheme==="file"},includesCredentials:function(){return this.username!==""||this.password!==""},isSpecial:function(){return RD(UA,this.scheme)},shortenPath:function(){var t=this.path,r=t.length;!r||this.scheme==="file"&&r===1&&qw(t[0],!0)||t.length--},serialize:function(){var t=this,r=t.scheme,s=t.username,a=t.password,c=t.host,d=t.port,h=t.path,m=t.query,g=t.fragment,v=r+":";return c!==null?(v+="//",t.includesCredentials()&&(v+=s+(a?":"+a:"")+"@"),v+=Kw(c),d!==null&&(v+=":"+d)):r==="file"&&(v+="//"),v+=t.cannotBeABaseURL?h[0]:h.length?"/"+Hw(h,"/"):"",m!==null&&(v+="?"+m),g!==null&&(v+="#"+g),v},setHref:function(t){var r=this.parse(t);if(r)throw new AD(r);this.searchParams.update()},getOrigin:function(){var t=this.scheme,r=this.port;if(t==="blob")try{return new Wv(t.path[0]).origin}catch{return"null"}return t!=="file"&&this.isSpecial()?t+"://"+Kw(this.host)+(r!==null?":"+r:""):"null"},getProtocol:function(){return this.scheme+":"},setProtocol:function(t){this.parse(gf(t)+":",xD)},getUsername:function(){return this.username},setUsername:function(t){var r=Fv(gf(t));if(!this.cannotHaveUsernamePasswordPort()){this.username="";for(var s=0;s<r.length;s++)this.username+=Ym(r[s],ND)}},getPassword:function(){return this.password},setPassword:function(t){var r=Fv(gf(t));if(!this.cannotHaveUsernamePasswordPort()){this.password="";for(var s=0;s<r.length;s++)this.password+=Ym(r[s],ND)}},getHost:function(){var t=this.host,r=this.port;return t===null?"":r===null?Kw(t):Kw(t)+":"+r},setHost:function(t){this.cannotBeABaseURL||this.parse(t,MD)},getHostname:function(){var t=this.host;return t===null?"":Kw(t)},setHostname:function(t){this.cannotBeABaseURL||this.parse(t,UD)},getPort:function(){var t=this.port;return t===null?"":gf(t)},setPort:function(t){this.cannotHaveUsernamePasswordPort()||((t=gf(t))===""?this.port=null:this.parse(t,VD))},getPathname:function(){var t=this.path;return this.cannotBeABaseURL?t[0]:t.length?"/"+Hw(t,"/"):""},setPathname:function(t){this.cannotBeABaseURL||(this.path=[],this.parse(t,zv))},getSearch:function(){var t=this.query;return t?"?"+t:""},setSearch:function(t){(t=gf(t))===""?this.query=null:(Wu(t,0)==="?"&&(t=$w(t,1)),this.query="",this.parse(t,J_)),this.searchParams.update()},getSearchParams:function(){return this.searchParams.facade},getHash:function(){var t=this.fragment;return t?"#"+t:""},setHash:function(t){(t=gf(t))!==""?(Wu(t,0)==="#"&&(t=$w(t,1)),this.fragment="",this.parse(t,_f)):this.fragment=null},update:function(){this.query=this.searchParams.serialize()||null}};var Wv=function(t){var r=Sde(this,kc),s=Cde(arguments.length,1)>1?arguments[1]:void 0,a=Rde(r,new BD(t,!1,s));TD||(r.href=a.serialize(),r.origin=a.getOrigin(),r.protocol=a.getProtocol(),r.username=a.getUsername(),r.password=a.getPassword(),r.host=a.getHost(),r.hostname=a.getHostname(),r.port=a.getPort(),r.pathname=a.getPathname(),r.search=a.getSearch(),r.searchParams=a.getSearchParams(),r.hash=a.getHash())},kc=Wv.prototype,Gu=function(t,r){return{get:function(){return xA(this)[t]()},set:r&&function(s){return xA(this)[r](s)},configurable:!0,enumerable:!0}};if(TD&&(zu(kc,"href",Gu("serialize","setHref")),zu(kc,"origin",Gu("getOrigin")),zu(kc,"protocol",Gu("getProtocol","setProtocol")),zu(kc,"username",Gu("getUsername","setUsername")),zu(kc,"password",Gu("getPassword","setPassword")),zu(kc,"host",Gu("getHost","setHost")),zu(kc,"hostname",Gu("getHostname","setHostname")),zu(kc,"port",Gu("getPort","setPort")),zu(kc,"pathname",Gu("getPathname","setPathname")),zu(kc,"search",Gu("getSearch","setSearch")),zu(kc,"searchParams",Gu("getSearchParams")),zu(kc,"hash",Gu("getHash","setHash"))),NA(kc,"toJSON",(function(){return xA(this).serialize()}),{enumerable:!0}),NA(kc,"toString",(function(){return xA(this).serialize()}),{enumerable:!0}),Gw){var V6=Gw.createObjectURL,j6=Gw.revokeObjectURL;V6&&NA(Wv,"createObjectURL",S6(V6,Gw)),j6&&NA(Wv,"revokeObjectURL",S6(j6,Gw))}Tde(Wv,"URL"),Ede({global:!0,forced:!vde,sham:!TD},{URL:Wv});var Hde=Kn,F6=u,$de=nl,B6=Ya,Kde=RA,zD=vt("URL"),qde=Kde&&F6((function(){zD.canParse()})),Yde=F6((function(){return zD.canParse.length!==1}));Hde({target:"URL",stat:!0,forced:!qde||Yde},{canParse:function(t){var r=$de(arguments.length,1),s=B6(t),a=r<2||arguments[1]===void 0?void 0:B6(arguments[1]);try{return!!new zD(s,a)}catch{return!1}}});var Xde=Kn,Jde=nl,z6=Ya,Qde=RA,Zde=vt("URL");Xde({target:"URL",stat:!0,forced:!Qde},{parse:function(t){var r=Jde(arguments.length,1),s=z6(t),a=r<2||arguments[1]===void 0?void 0:z6(arguments[1]);try{return new Zde(s,a)}catch{return null}}});var FA=l(bt.URL);let W6=!0,G6=!0;function BA(t,r,s){const a=t.match(r);return a&&a.length>=s&&parseInt(a[s],10)}function Q_(t,r,s){if(!t.RTCPeerConnection)return;const a=t.RTCPeerConnection.prototype,c=a.addEventListener;a.addEventListener=function(h,m){if(h!==r)return c.apply(this,arguments);const g=v=>{const w=s(v);w&&(m.handleEvent?m.handleEvent(w):m(w))};return this._eventMap=this._eventMap||{},this._eventMap[r]||(this._eventMap[r]=new Map),this._eventMap[r].set(m,g),c.apply(this,[h,g])};const d=a.removeEventListener;a.removeEventListener=function(h,m){if(h!==r||!this._eventMap||!this._eventMap[r])return d.apply(this,arguments);if(!this._eventMap[r].has(m))return d.apply(this,arguments);const g=this._eventMap[r].get(m);return this._eventMap[r].delete(m),this._eventMap[r].size===0&&delete this._eventMap[r],Object.keys(this._eventMap).length===0&&delete this._eventMap,d.apply(this,[h,g])},Object.defineProperty(a,"on"+r,{get(){return this["_on"+r]},set(h){this["_on"+r]&&(this.removeEventListener(r,this["_on"+r]),delete this["_on"+r]),h&&this.addEventListener(r,this["_on"+r]=h)},enumerable:!0,configurable:!0})}function ehe(t){return typeof t!="boolean"?new Error("Argument type: "+typeof t+". Please use a boolean."):(W6=t,t?"adapter.js logging disabled":"adapter.js logging enabled")}function the(t){return typeof t!="boolean"?new Error("Argument type: "+typeof t+". Please use a boolean."):(G6=!t,"adapter.js deprecation warnings "+(t?"disabled":"enabled"))}function H6(){if(typeof window=="object"){if(W6)return;typeof console<"u"&&typeof console.log=="function"&&console.log.apply(console,arguments)}}function WD(t,r){G6&&console.warn(t+" is deprecated, please use "+r+" instead.")}function $6(t){return Object.prototype.toString.call(t)==="[object Object]"}function K6(t){var r;return $6(t)?Xa(r=Object.keys(t)).call(r,(function(s,a){const c=$6(t[a]),d=c?K6(t[a]):t[a],h=c&&!Object.keys(d).length;return d===void 0||h?s:Object.assign(s,{[a]:d})}),{}):t}function GD(t,r,s){r&&!s.has(r.id)&&(s.set(r.id,r),Object.keys(r).forEach((a=>{a.endsWith("Id")?GD(t,t.get(r[a]),s):a.endsWith("Ids")&&r[a].forEach((c=>{GD(t,t.get(c),s)}))})))}function q6(t,r,s){const a=s?"outbound-rtp":"inbound-rtp",c=new Map;if(r===null)return c;const d=[];return t.forEach((h=>{h.type==="track"&&h.trackIdentifier===r.id&&d.push(h)})),d.forEach((h=>{t.forEach((m=>{m.type===a&&m.trackId===h.id&&GD(t,m,c)}))})),c}const Y6=H6;function X6(t,r){const s=t&&t.navigator;if(!s.mediaDevices)return;const a=function(h){if(typeof h!="object"||h.mandatory||h.optional)return h;const m={};return Object.keys(h).forEach((g=>{if(g==="require"||g==="advanced"||g==="mediaSource")return;const v=typeof h[g]=="object"?h[g]:{ideal:h[g]};v.exact!==void 0&&typeof v.exact=="number"&&(v.min=v.max=v.exact);const w=function(I,A){return I?I+A.charAt(0).toUpperCase()+A.slice(1):A==="deviceId"?"sourceId":A};if(v.ideal!==void 0){m.optional=m.optional||[];let I={};typeof v.ideal=="number"?(I[w("min",g)]=v.ideal,m.optional.push(I),I={},I[w("max",g)]=v.ideal,m.optional.push(I)):(I[w("",g)]=v.ideal,m.optional.push(I))}v.exact!==void 0&&typeof v.exact!="number"?(m.mandatory=m.mandatory||{},m.mandatory[w("",g)]=v.exact):["min","max"].forEach((I=>{v[I]!==void 0&&(m.mandatory=m.mandatory||{},m.mandatory[w(I,g)]=v[I])}))})),h.advanced&&(m.optional=(m.optional||[]).concat(h.advanced)),m},c=function(h,m){if(r.version>=61)return m(h);if((h=JSON.parse(JSON.stringify(h)))&&typeof h.audio=="object"){const g=function(v,w,I){w in v&&!(I in v)&&(v[I]=v[w],delete v[w])};g((h=JSON.parse(JSON.stringify(h))).audio,"autoGainControl","googAutoGainControl"),g(h.audio,"noiseSuppression","googNoiseSuppression"),h.audio=a(h.audio)}if(h&&typeof h.video=="object"){let g=h.video.facingMode;g=g&&(typeof g=="object"?g:{ideal:g});const v=r.version<66;if(g&&(g.exact==="user"||g.exact==="environment"||g.ideal==="user"||g.ideal==="environment")&&(!s.mediaDevices.getSupportedConstraints||!s.mediaDevices.getSupportedConstraints().facingMode||v)){let w;if(delete h.video.facingMode,g.exact==="environment"||g.ideal==="environment"?w=["back","rear"]:g.exact!=="user"&&g.ideal!=="user"||(w=["front"]),w)return s.mediaDevices.enumerateDevices().then((I=>{I=I.filter((N=>N.kind==="videoinput"));let A=I.find((N=>w.some((H=>{var B;return rt(B=N.label.toLowerCase()).call(B,H)}))));return!A&&I.length&&rt(w).call(w,"back")&&(A=I[I.length-1]),A&&(h.video.deviceId=g.exact?{exact:A.deviceId}:{ideal:A.deviceId}),h.video=a(h.video),Y6("chrome: "+JSON.stringify(h)),m(h)}))}h.video=a(h.video)}return Y6("chrome: "+JSON.stringify(h)),m(h)},d=function(h){return r.version>=64?h:{name:{PermissionDeniedError:"NotAllowedError",PermissionDismissedError:"NotAllowedError",InvalidStateError:"NotAllowedError",DevicesNotFoundError:"NotFoundError",ConstraintNotSatisfiedError:"OverconstrainedError",TrackStartError:"NotReadableError",MediaDeviceFailedDueToShutdown:"NotAllowedError",MediaDeviceKillSwitchOn:"NotAllowedError",TabCaptureError:"AbortError",ScreenCaptureError:"AbortError",DeviceCaptureError:"AbortError"}[h.name]||h.name,message:h.message,constraint:h.constraint||h.constraintName,toString(){return this.name+(this.message&&": ")+this.message}}};if(s.getUserMedia=(function(h,m,g){c(h,(v=>{s.webkitGetUserMedia(v,m,(w=>{g&&g(d(w))}))}))}).bind(s),s.mediaDevices.getUserMedia){const h=s.mediaDevices.getUserMedia.bind(s.mediaDevices);s.mediaDevices.getUserMedia=function(m){return c(m,(g=>h(g).then((v=>{if(g.audio&&!v.getAudioTracks().length||g.video&&!v.getVideoTracks().length)throw v.getTracks().forEach((w=>{w.stop()})),new DOMException("","NotFoundError");return v}),(v=>mt.reject(d(v))))))}}}function J6(t){t.MediaStream=t.MediaStream||t.webkitMediaStream}function Q6(t){if(typeof t=="object"&&t.RTCPeerConnection&&!("ontrack"in t.RTCPeerConnection.prototype)){Object.defineProperty(t.RTCPeerConnection.prototype,"ontrack",{get(){return this._ontrack},set(s){this._ontrack&&this.removeEventListener("track",this._ontrack),this.addEventListener("track",this._ontrack=s)},enumerable:!0,configurable:!0});const r=t.RTCPeerConnection.prototype.setRemoteDescription;t.RTCPeerConnection.prototype.setRemoteDescription=function(){return this._ontrackpoly||(this._ontrackpoly=s=>{s.stream.addEventListener("addtrack",(a=>{let c;c=t.RTCPeerConnection.prototype.getReceivers?this.getReceivers().find((h=>h.track&&h.track.id===a.track.id)):{track:a.track};const d=new Event("track");d.track=a.track,d.receiver=c,d.transceiver={receiver:c},d.streams=[s.stream],this.dispatchEvent(d)})),s.stream.getTracks().forEach((a=>{let c;c=t.RTCPeerConnection.prototype.getReceivers?this.getReceivers().find((h=>h.track&&h.track.id===a.id)):{track:a};const d=new Event("track");d.track=a,d.receiver=c,d.transceiver={receiver:c},d.streams=[s.stream],this.dispatchEvent(d)}))},this.addEventListener("addstream",this._ontrackpoly)),r.apply(this,arguments)}}else Q_(t,"track",(r=>(r.transceiver||Object.defineProperty(r,"transceiver",{value:{receiver:r.receiver}}),r)))}function Z6(t){if(typeof t=="object"&&t.RTCPeerConnection&&!("getSenders"in t.RTCPeerConnection.prototype)&&"createDTMFSender"in t.RTCPeerConnection.prototype){const r=function(c,d){return{track:d,get dtmf(){return this._dtmf===void 0&&(d.kind==="audio"?this._dtmf=c.createDTMFSender(d):this._dtmf=null),this._dtmf},_pc:c}};if(!t.RTCPeerConnection.prototype.getSenders){t.RTCPeerConnection.prototype.getSenders=function(){return this._senders=this._senders||[],this._senders.slice()};const c=t.RTCPeerConnection.prototype.addTrack;t.RTCPeerConnection.prototype.addTrack=function(h,m){let g=c.apply(this,arguments);return g||(g=r(this,h),this._senders.push(g)),g};const d=t.RTCPeerConnection.prototype.removeTrack;t.RTCPeerConnection.prototype.removeTrack=function(h){d.apply(this,arguments);const m=this._senders.indexOf(h);m!==-1&&this._senders.splice(m,1)}}const s=t.RTCPeerConnection.prototype.addStream;t.RTCPeerConnection.prototype.addStream=function(c){this._senders=this._senders||[],s.apply(this,[c]),c.getTracks().forEach((d=>{this._senders.push(r(this,d))}))};const a=t.RTCPeerConnection.prototype.removeStream;t.RTCPeerConnection.prototype.removeStream=function(c){this._senders=this._senders||[],a.apply(this,[c]),c.getTracks().forEach((d=>{const h=this._senders.find((m=>m.track===d));h&&this._senders.splice(this._senders.indexOf(h),1)}))}}else if(typeof t=="object"&&t.RTCPeerConnection&&"getSenders"in t.RTCPeerConnection.prototype&&"createDTMFSender"in t.RTCPeerConnection.prototype&&t.RTCRtpSender&&!("dtmf"in t.RTCRtpSender.prototype)){const r=t.RTCPeerConnection.prototype.getSenders;t.RTCPeerConnection.prototype.getSenders=function(){const s=r.apply(this,[]);return s.forEach((a=>a._pc=this)),s},Object.defineProperty(t.RTCRtpSender.prototype,"dtmf",{get(){return this._dtmf===void 0&&(this.track.kind==="audio"?this._dtmf=this._pc.createDTMFSender(this.track):this._dtmf=null),this._dtmf}})}}function eB(t){if(!t.RTCPeerConnection)return;const r=t.RTCPeerConnection.prototype.getStats;t.RTCPeerConnection.prototype.getStats=function(){const[s,a,c]=arguments;if(arguments.length>0&&typeof s=="function")return r.apply(this,arguments);if(r.length===0&&(arguments.length===0||typeof s!="function"))return r.apply(this,[]);const d=function(m){const g={};return m.result().forEach((v=>{const w={id:v.id,timestamp:v.timestamp,type:{localcandidate:"local-candidate",remotecandidate:"remote-candidate"}[v.type]||v.type};v.names().forEach((I=>{w[I]=v.stat(I)})),g[w.id]=w})),g},h=function(m){return new Map(Object.keys(m).map((g=>[g,m[g]])))};if(arguments.length>=2){const m=function(g){a(h(d(g)))};return r.apply(this,[m,s])}return new mt(((m,g)=>{r.apply(this,[function(v){m(h(d(v)))},g])})).then(a,c)}}function tB(t){if(!(typeof t=="object"&&t.RTCPeerConnection&&t.RTCRtpSender&&t.RTCRtpReceiver))return;if(!("getStats"in t.RTCRtpSender.prototype)){const s=t.RTCPeerConnection.prototype.getSenders;s&&(t.RTCPeerConnection.prototype.getSenders=function(){const c=s.apply(this,[]);return c.forEach((d=>d._pc=this)),c});const a=t.RTCPeerConnection.prototype.addTrack;a&&(t.RTCPeerConnection.prototype.addTrack=function(){const c=a.apply(this,arguments);return c._pc=this,c}),t.RTCRtpSender.prototype.getStats=function(){const c=this;return this._pc.getStats().then((d=>q6(d,c.track,!0)))}}if(!("getStats"in t.RTCRtpReceiver.prototype)){const s=t.RTCPeerConnection.prototype.getReceivers;s&&(t.RTCPeerConnection.prototype.getReceivers=function(){const a=s.apply(this,[]);return a.forEach((c=>c._pc=this)),a}),Q_(t,"track",(a=>(a.receiver._pc=a.srcElement,a))),t.RTCRtpReceiver.prototype.getStats=function(){const a=this;return this._pc.getStats().then((c=>q6(c,a.track,!1)))}}if(!("getStats"in t.RTCRtpSender.prototype)||!("getStats"in t.RTCRtpReceiver.prototype))return;const r=t.RTCPeerConnection.prototype.getStats;t.RTCPeerConnection.prototype.getStats=function(){if(arguments.length>0&&arguments[0]instanceof t.MediaStreamTrack){const s=arguments[0];let a,c,d;return this.getSenders().forEach((h=>{h.track===s&&(a?d=!0:a=h)})),this.getReceivers().forEach((h=>(h.track===s&&(c?d=!0:c=h),h.track===s))),d||a&&c?mt.reject(new DOMException("There are more than one sender or receiver for the track.","InvalidAccessError")):a?a.getStats():c?c.getStats():mt.reject(new DOMException("There is no sender or receiver for the track.","InvalidAccessError"))}return r.apply(this,arguments)}}function nB(t){t.RTCPeerConnection.prototype.getLocalStreams=function(){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},Object.keys(this._shimmedLocalStreams).map((d=>this._shimmedLocalStreams[d][0]))};const r=t.RTCPeerConnection.prototype.addTrack;t.RTCPeerConnection.prototype.addTrack=function(d,h){if(!h)return r.apply(this,arguments);this._shimmedLocalStreams=this._shimmedLocalStreams||{};const m=r.apply(this,arguments);return this._shimmedLocalStreams[h.id]?this._shimmedLocalStreams[h.id].indexOf(m)===-1&&this._shimmedLocalStreams[h.id].push(m):this._shimmedLocalStreams[h.id]=[h,m],m};const s=t.RTCPeerConnection.prototype.addStream;t.RTCPeerConnection.prototype.addStream=function(d){this._shimmedLocalStreams=this._shimmedLocalStreams||{},d.getTracks().forEach((g=>{if(this.getSenders().find((w=>w.track===g)))throw new DOMException("Track already exists.","InvalidAccessError")}));const h=this.getSenders();s.apply(this,arguments);const m=this.getSenders().filter((g=>h.indexOf(g)===-1));this._shimmedLocalStreams[d.id]=[d].concat(m)};const a=t.RTCPeerConnection.prototype.removeStream;t.RTCPeerConnection.prototype.removeStream=function(d){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},delete this._shimmedLocalStreams[d.id],a.apply(this,arguments)};const c=t.RTCPeerConnection.prototype.removeTrack;t.RTCPeerConnection.prototype.removeTrack=function(d){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},d&&Object.keys(this._shimmedLocalStreams).forEach((h=>{const m=this._shimmedLocalStreams[h].indexOf(d);m!==-1&&this._shimmedLocalStreams[h].splice(m,1),this._shimmedLocalStreams[h].length===1&&delete this._shimmedLocalStreams[h]})),c.apply(this,arguments)}}function rB(t,r){if(!t.RTCPeerConnection)return;if(t.RTCPeerConnection.prototype.addTrack&&r.version>=65)return nB(t);const s=t.RTCPeerConnection.prototype.getLocalStreams;t.RTCPeerConnection.prototype.getLocalStreams=function(){const g=s.apply(this);return this._reverseStreams=this._reverseStreams||{},g.map((v=>this._reverseStreams[v.id]))};const a=t.RTCPeerConnection.prototype.addStream;t.RTCPeerConnection.prototype.addStream=function(g){if(this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},g.getTracks().forEach((v=>{if(this.getSenders().find((I=>I.track===v)))throw new DOMException("Track already exists.","InvalidAccessError")})),!this._reverseStreams[g.id]){const v=new t.MediaStream(g.getTracks());this._streams[g.id]=v,this._reverseStreams[v.id]=g,g=v}a.apply(this,[g])};const c=t.RTCPeerConnection.prototype.removeStream;function d(g,v){let w=v.sdp;return Object.keys(g._reverseStreams||[]).forEach((I=>{const A=g._reverseStreams[I],N=g._streams[A.id];w=w.replace(new RegExp(N.id,"g"),A.id)})),new RTCSessionDescription({type:v.type,sdp:w})}t.RTCPeerConnection.prototype.removeStream=function(g){this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},c.apply(this,[this._streams[g.id]||g]),delete this._reverseStreams[this._streams[g.id]?this._streams[g.id].id:g.id],delete this._streams[g.id]},t.RTCPeerConnection.prototype.addTrack=function(g,v){if(this.signalingState==="closed")throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");const w=[].slice.call(arguments,1);if(w.length!==1||!w[0].getTracks().find((N=>N===g)))throw new DOMException("The adapter.js addTrack polyfill only supports a single  stream which is associated with the specified track.","NotSupportedError");if(this.getSenders().find((N=>N.track===g)))throw new DOMException("Track already exists.","InvalidAccessError");this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{};const A=this._streams[v.id];if(A)A.addTrack(g),mt.resolve().then((()=>{this.dispatchEvent(new Event("negotiationneeded"))}));else{const N=new t.MediaStream([g]);this._streams[v.id]=N,this._reverseStreams[N.id]=v,this.addStream(N)}return this.getSenders().find((N=>N.track===g))},["createOffer","createAnswer"].forEach((function(g){const v=t.RTCPeerConnection.prototype[g],w={[g](){const I=arguments;return arguments.length&&typeof arguments[0]=="function"?v.apply(this,[A=>{const N=d(this,A);I[0].apply(null,[N])},A=>{I[1]&&I[1].apply(null,A)},arguments[2]]):v.apply(this,arguments).then((A=>d(this,A)))}};t.RTCPeerConnection.prototype[g]=w[g]}));const h=t.RTCPeerConnection.prototype.setLocalDescription;t.RTCPeerConnection.prototype.setLocalDescription=function(){return arguments.length&&arguments[0].type?(arguments[0]=(function(g,v){let w=v.sdp;return Object.keys(g._reverseStreams||[]).forEach((I=>{const A=g._reverseStreams[I],N=g._streams[A.id];w=w.replace(new RegExp(A.id,"g"),N.id)})),new RTCSessionDescription({type:v.type,sdp:w})})(this,arguments[0]),h.apply(this,arguments)):h.apply(this,arguments)};const m=Object.getOwnPropertyDescriptor(t.RTCPeerConnection.prototype,"localDescription");Object.defineProperty(t.RTCPeerConnection.prototype,"localDescription",{get(){const g=m.get.apply(this);return g.type===""?g:d(this,g)}}),t.RTCPeerConnection.prototype.removeTrack=function(g){if(this.signalingState==="closed")throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");if(!g._pc)throw new DOMException("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.","TypeError");if(g._pc!==this)throw new DOMException("Sender was not created by this connection.","InvalidAccessError");let v;this._streams=this._streams||{},Object.keys(this._streams).forEach((w=>{this._streams[w].getTracks().find((I=>g.track===I))&&(v=this._streams[w])})),v&&(v.getTracks().length===1?this.removeStream(this._reverseStreams[v.id]):v.removeTrack(g.track),this.dispatchEvent(new Event("negotiationneeded")))}}function HD(t,r){!t.RTCPeerConnection&&t.webkitRTCPeerConnection&&(t.RTCPeerConnection=t.webkitRTCPeerConnection),t.RTCPeerConnection&&r.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach((function(s){const a=t.RTCPeerConnection.prototype[s],c={[s](){return arguments[0]=new(s==="addIceCandidate"?t.RTCIceCandidate:t.RTCSessionDescription)(arguments[0]),a.apply(this,arguments)}};t.RTCPeerConnection.prototype[s]=c[s]}))}function iB(t,r){Q_(t,"negotiationneeded",(s=>{const a=s.target;if(!(r.version<72||a.getConfiguration&&a.getConfiguration().sdpSemantics==="plan-b")||a.signalingState==="stable")return s}))}var sB=Object.freeze({__proto__:null,fixNegotiationNeeded:iB,shimAddTrackRemoveTrack:rB,shimAddTrackRemoveTrackWithNative:nB,shimGetDisplayMedia:function(t,r){t.navigator.mediaDevices&&"getDisplayMedia"in t.navigator.mediaDevices||t.navigator.mediaDevices&&(typeof r=="function"?t.navigator.mediaDevices.getDisplayMedia=function(s){return r(s).then((a=>{const c=s.video&&s.video.width,d=s.video&&s.video.height,h=s.video&&s.video.frameRate;return s.video={mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:a,maxFrameRate:h||3}},c&&(s.video.mandatory.maxWidth=c),d&&(s.video.mandatory.maxHeight=d),t.navigator.mediaDevices.getUserMedia(s)}))}:console.error("shimGetDisplayMedia: getSourceId argument is not a function"))},shimGetSendersWithDtmf:Z6,shimGetStats:eB,shimGetUserMedia:X6,shimMediaStream:J6,shimOnTrack:Q6,shimPeerConnection:HD,shimSenderReceiverGetStats:tB});function oB(t,r){const s=t&&t.navigator,a=t&&t.MediaStreamTrack;if(s.getUserMedia=function(c,d,h){WD("navigator.getUserMedia","navigator.mediaDevices.getUserMedia"),s.mediaDevices.getUserMedia(c).then(d,h)},!(r.version>55&&"autoGainControl"in s.mediaDevices.getSupportedConstraints())){const c=function(h,m,g){m in h&&!(g in h)&&(h[g]=h[m],delete h[m])},d=s.mediaDevices.getUserMedia.bind(s.mediaDevices);if(s.mediaDevices.getUserMedia=function(h){return typeof h=="object"&&typeof h.audio=="object"&&(h=JSON.parse(JSON.stringify(h)),c(h.audio,"autoGainControl","mozAutoGainControl"),c(h.audio,"noiseSuppression","mozNoiseSuppression")),d(h)},a&&a.prototype.getSettings){const h=a.prototype.getSettings;a.prototype.getSettings=function(){const m=h.apply(this,arguments);return c(m,"mozAutoGainControl","autoGainControl"),c(m,"mozNoiseSuppression","noiseSuppression"),m}}if(a&&a.prototype.applyConstraints){const h=a.prototype.applyConstraints;a.prototype.applyConstraints=function(m){return this.kind==="audio"&&typeof m=="object"&&(m=JSON.parse(JSON.stringify(m)),c(m,"autoGainControl","mozAutoGainControl"),c(m,"noiseSuppression","mozNoiseSuppression")),h.apply(this,[m])}}}}function aB(t){typeof t=="object"&&t.RTCTrackEvent&&"receiver"in t.RTCTrackEvent.prototype&&!("transceiver"in t.RTCTrackEvent.prototype)&&Object.defineProperty(t.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function $D(t,r){if(typeof t!="object"||!t.RTCPeerConnection&&!t.mozRTCPeerConnection)return;!t.RTCPeerConnection&&t.mozRTCPeerConnection&&(t.RTCPeerConnection=t.mozRTCPeerConnection),r.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach((function(c){const d=t.RTCPeerConnection.prototype[c],h={[c](){return arguments[0]=new(c==="addIceCandidate"?t.RTCIceCandidate:t.RTCSessionDescription)(arguments[0]),d.apply(this,arguments)}};t.RTCPeerConnection.prototype[c]=h[c]}));const s={inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"},a=t.RTCPeerConnection.prototype.getStats;t.RTCPeerConnection.prototype.getStats=function(){const[c,d,h]=arguments;return a.apply(this,[c||null]).then((m=>{if(r.version<53&&!d)try{m.forEach((g=>{g.type=s[g.type]||g.type}))}catch(g){if(g.name!=="TypeError")throw g;m.forEach(((v,w)=>{m.set(w,Object.assign({},v,{type:s[v.type]||v.type}))}))}return m})).then(d,h)}}function cB(t){if(typeof t!="object"||!t.RTCPeerConnection||!t.RTCRtpSender||t.RTCRtpSender&&"getStats"in t.RTCRtpSender.prototype)return;const r=t.RTCPeerConnection.prototype.getSenders;r&&(t.RTCPeerConnection.prototype.getSenders=function(){const a=r.apply(this,[]);return a.forEach((c=>c._pc=this)),a});const s=t.RTCPeerConnection.prototype.addTrack;s&&(t.RTCPeerConnection.prototype.addTrack=function(){const a=s.apply(this,arguments);return a._pc=this,a}),t.RTCRtpSender.prototype.getStats=function(){return this.track?this._pc.getStats(this.track):mt.resolve(new Map)}}function lB(t){if(typeof t!="object"||!t.RTCPeerConnection||!t.RTCRtpSender||t.RTCRtpSender&&"getStats"in t.RTCRtpReceiver.prototype)return;const r=t.RTCPeerConnection.prototype.getReceivers;r&&(t.RTCPeerConnection.prototype.getReceivers=function(){const s=r.apply(this,[]);return s.forEach((a=>a._pc=this)),s}),Q_(t,"track",(s=>(s.receiver._pc=s.srcElement,s))),t.RTCRtpReceiver.prototype.getStats=function(){return this._pc.getStats(this.track)}}function uB(t){t.RTCPeerConnection&&!("removeStream"in t.RTCPeerConnection.prototype)&&(t.RTCPeerConnection.prototype.removeStream=function(r){WD("removeStream","removeTrack"),this.getSenders().forEach((s=>{var a;s.track&&rt(a=r.getTracks()).call(a,s.track)&&this.removeTrack(s)}))})}function dB(t){t.DataChannel&&!t.RTCDataChannel&&(t.RTCDataChannel=t.DataChannel)}function hB(t){if(typeof t!="object"||!t.RTCPeerConnection)return;const r=t.RTCPeerConnection.prototype.addTransceiver;r&&(t.RTCPeerConnection.prototype.addTransceiver=function(){this.setParametersPromises=[];let s=arguments[1]&&arguments[1].sendEncodings;s===void 0&&(s=[]),s=[...s];const a=s.length>0;a&&s.forEach((d=>{if("rid"in d&&!/^[a-z0-9]{0,16}$/i.test(d.rid))throw new TypeError("Invalid RID value provided.");if("scaleResolutionDownBy"in d&&!(parseFloat(d.scaleResolutionDownBy)>=1))throw new RangeError("scale_resolution_down_by must be >= 1.0");if("maxFramerate"in d&&!(parseFloat(d.maxFramerate)>=0))throw new RangeError("max_framerate must be >= 0.0")}));const c=r.apply(this,arguments);if(a){const{sender:d}=c,h=d.getParameters();(!("encodings"in h)||h.encodings.length===1&&Object.keys(h.encodings[0]).length===0)&&(h.encodings=s,d.sendEncodings=s,this.setParametersPromises.push(d.setParameters(h).then((()=>{delete d.sendEncodings})).catch((()=>{delete d.sendEncodings}))))}return c})}function pB(t){if(typeof t!="object"||!t.RTCRtpSender)return;const r=t.RTCRtpSender.prototype.getParameters;r&&(t.RTCRtpSender.prototype.getParameters=function(){const s=r.apply(this,arguments);return"encodings"in s||(s.encodings=[].concat(this.sendEncodings||[{}])),s})}function fB(t){if(typeof t!="object"||!t.RTCPeerConnection)return;const r=t.RTCPeerConnection.prototype.createOffer;t.RTCPeerConnection.prototype.createOffer=function(){return this.setParametersPromises&&this.setParametersPromises.length?mt.all(this.setParametersPromises).then((()=>r.apply(this,arguments))).finally((()=>{this.setParametersPromises=[]})):r.apply(this,arguments)}}function mB(t){if(typeof t!="object"||!t.RTCPeerConnection)return;const r=t.RTCPeerConnection.prototype.createAnswer;t.RTCPeerConnection.prototype.createAnswer=function(){return this.setParametersPromises&&this.setParametersPromises.length?mt.all(this.setParametersPromises).then((()=>r.apply(this,arguments))).finally((()=>{this.setParametersPromises=[]})):r.apply(this,arguments)}}var gB=Object.freeze({__proto__:null,shimAddTransceiver:hB,shimCreateAnswer:mB,shimCreateOffer:fB,shimGetDisplayMedia:function(t,r){t.navigator.mediaDevices&&"getDisplayMedia"in t.navigator.mediaDevices||t.navigator.mediaDevices&&(t.navigator.mediaDevices.getDisplayMedia=function(s){if(!s||!s.video){const a=new DOMException("getDisplayMedia without video constraints is undefined");return a.name="NotFoundError",a.code=8,mt.reject(a)}return s.video===!0?s.video={mediaSource:r}:s.video.mediaSource=r,t.navigator.mediaDevices.getUserMedia(s)})},shimGetParameters:pB,shimGetUserMedia:oB,shimOnTrack:aB,shimPeerConnection:$D,shimRTCDataChannel:dB,shimReceiverGetStats:lB,shimRemoveStream:uB,shimSenderGetStats:cB});function _B(t){if(typeof t=="object"&&t.RTCPeerConnection){if("getLocalStreams"in t.RTCPeerConnection.prototype||(t.RTCPeerConnection.prototype.getLocalStreams=function(){return this._localStreams||(this._localStreams=[]),this._localStreams}),!("addStream"in t.RTCPeerConnection.prototype)){const r=t.RTCPeerConnection.prototype.addTrack;t.RTCPeerConnection.prototype.addStream=function(s){var a;this._localStreams||(this._localStreams=[]),rt(a=this._localStreams).call(a,s)||this._localStreams.push(s),s.getAudioTracks().forEach((c=>r.call(this,c,s))),s.getVideoTracks().forEach((c=>r.call(this,c,s)))},t.RTCPeerConnection.prototype.addTrack=function(s){for(var a=arguments.length,c=new Array(a>1?a-1:0),d=1;d<a;d++)c[d-1]=arguments[d];return c&&c.forEach((h=>{var m;this._localStreams?rt(m=this._localStreams).call(m,h)||this._localStreams.push(h):this._localStreams=[h]})),r.apply(this,arguments)}}"removeStream"in t.RTCPeerConnection.prototype||(t.RTCPeerConnection.prototype.removeStream=function(r){this._localStreams||(this._localStreams=[]);const s=this._localStreams.indexOf(r);if(s===-1)return;this._localStreams.splice(s,1);const a=r.getTracks();this.getSenders().forEach((c=>{rt(a).call(a,c.track)&&this.removeTrack(c)}))})}}function yB(t){if(typeof t=="object"&&t.RTCPeerConnection&&("getRemoteStreams"in t.RTCPeerConnection.prototype||(t.RTCPeerConnection.prototype.getRemoteStreams=function(){return this._remoteStreams?this._remoteStreams:[]}),!("onaddstream"in t.RTCPeerConnection.prototype))){Object.defineProperty(t.RTCPeerConnection.prototype,"onaddstream",{get(){return this._onaddstream},set(s){this._onaddstream&&(this.removeEventListener("addstream",this._onaddstream),this.removeEventListener("track",this._onaddstreampoly)),this.addEventListener("addstream",this._onaddstream=s),this.addEventListener("track",this._onaddstreampoly=a=>{a.streams.forEach((c=>{var d;if(this._remoteStreams||(this._remoteStreams=[]),rt(d=this._remoteStreams).call(d,c))return;this._remoteStreams.push(c);const h=new Event("addstream");h.stream=c,this.dispatchEvent(h)}))})}});const r=t.RTCPeerConnection.prototype.setRemoteDescription;t.RTCPeerConnection.prototype.setRemoteDescription=function(){const s=this;return this._onaddstreampoly||this.addEventListener("track",this._onaddstreampoly=function(a){a.streams.forEach((c=>{if(s._remoteStreams||(s._remoteStreams=[]),s._remoteStreams.indexOf(c)>=0)return;s._remoteStreams.push(c);const d=new Event("addstream");d.stream=c,s.dispatchEvent(d)}))}),r.apply(s,arguments)}}}function EB(t){if(typeof t!="object"||!t.RTCPeerConnection)return;const r=t.RTCPeerConnection.prototype,s=r.createOffer,a=r.createAnswer,c=r.setLocalDescription,d=r.setRemoteDescription,h=r.addIceCandidate;r.createOffer=function(g,v){const w=arguments.length>=2?arguments[2]:arguments[0],I=s.apply(this,[w]);return v?(I.then(g,v),mt.resolve()):I},r.createAnswer=function(g,v){const w=arguments.length>=2?arguments[2]:arguments[0],I=a.apply(this,[w]);return v?(I.then(g,v),mt.resolve()):I};let m=function(g,v,w){const I=c.apply(this,[g]);return w?(I.then(v,w),mt.resolve()):I};r.setLocalDescription=m,m=function(g,v,w){const I=d.apply(this,[g]);return w?(I.then(v,w),mt.resolve()):I},r.setRemoteDescription=m,m=function(g,v,w){const I=h.apply(this,[g]);return w?(I.then(v,w),mt.resolve()):I},r.addIceCandidate=m}function vB(t){const r=t&&t.navigator;if(r.mediaDevices&&r.mediaDevices.getUserMedia){const s=r.mediaDevices,a=s.getUserMedia.bind(s);r.mediaDevices.getUserMedia=c=>a(SB(c))}!r.getUserMedia&&r.mediaDevices&&r.mediaDevices.getUserMedia&&(r.getUserMedia=(function(s,a,c){r.mediaDevices.getUserMedia(s).then(a,c)}).bind(r))}function SB(t){return t&&t.video!==void 0?Object.assign({},t,{video:K6(t.video)}):t}function bB(t){if(!t.RTCPeerConnection)return;const r=t.RTCPeerConnection;t.RTCPeerConnection=function(s,a){if(s&&s.iceServers){const c=[];for(let d=0;d<s.iceServers.length;d++){let h=s.iceServers[d];!h.hasOwnProperty("urls")&&h.hasOwnProperty("url")?(WD("RTCIceServer.url","RTCIceServer.urls"),h=JSON.parse(JSON.stringify(h)),h.urls=h.url,delete h.url,c.push(h)):c.push(s.iceServers[d])}s.iceServers=c}return new r(s,a)},t.RTCPeerConnection.prototype=r.prototype,"generateCertificate"in r&&Object.defineProperty(t.RTCPeerConnection,"generateCertificate",{get:()=>r.generateCertificate})}function wB(t){typeof t=="object"&&t.RTCTrackEvent&&"receiver"in t.RTCTrackEvent.prototype&&!("transceiver"in t.RTCTrackEvent.prototype)&&Object.defineProperty(t.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function TB(t){const r=t.RTCPeerConnection.prototype.createOffer;t.RTCPeerConnection.prototype.createOffer=function(s){if(s){s.offerToReceiveAudio!==void 0&&(s.offerToReceiveAudio=!!s.offerToReceiveAudio);const a=this.getTransceivers().find((d=>d.receiver.track.kind==="audio"));s.offerToReceiveAudio===!1&&a?a.direction==="sendrecv"?a.setDirection?a.setDirection("sendonly"):a.direction="sendonly":a.direction==="recvonly"&&(a.setDirection?a.setDirection("inactive"):a.direction="inactive"):s.offerToReceiveAudio!==!0||a||this.addTransceiver("audio",{direction:"recvonly"}),s.offerToReceiveVideo!==void 0&&(s.offerToReceiveVideo=!!s.offerToReceiveVideo);const c=this.getTransceivers().find((d=>d.receiver.track.kind==="video"));s.offerToReceiveVideo===!1&&c?c.direction==="sendrecv"?c.setDirection?c.setDirection("sendonly"):c.direction="sendonly":c.direction==="recvonly"&&(c.setDirection?c.setDirection("inactive"):c.direction="inactive"):s.offerToReceiveVideo!==!0||c||this.addTransceiver("video",{direction:"recvonly"})}return r.apply(this,arguments)}}function CB(t){typeof t!="object"||t.AudioContext||(t.AudioContext=t.webkitAudioContext)}var RB=Object.freeze({__proto__:null,shimAudioContext:CB,shimCallbacksAPI:EB,shimConstraints:SB,shimCreateOfferLegacy:TB,shimGetUserMedia:vB,shimLocalStreamsAPI:_B,shimRTCIceServerUrls:bB,shimRemoteStreamsAPI:yB,shimTrackEventTransceiver:wB}),IB=`	
\v\f\r \u2028\u2029\uFEFF`,nhe=Jt,rhe=Ya,KD=IB,AB=R("".replace),ihe=RegExp("^["+KD+"]+"),she=RegExp("(^|[^"+KD+"])["+KD+"]+$"),ohe=function(t){return function(r){var s=rhe(nhe(r));return 1&t&&(s=AB(s,ihe,"")),2&t&&(s=AB(s,she,"$1")),s}},ahe={trim:ohe(3)},che=dv.PROPER,lhe=u,PB=IB,uhe=ahe.trim;Kn({target:"String",proto:!0,forced:(function(t){return lhe((function(){return!!PB[t]()||""[t]()!==""||che&&PB[t].name!==t}))})("trim")},{trim:function(){return uhe(this)}});var dhe=wc("String","trim"),hhe=O,phe=dhe,qD=String.prototype,fhe=function(t){var r=t.trim;return typeof t=="string"||t===qD||hhe(qD,t)&&r===qD.trim?phe:r},Bo=l(fhe),OB={exports:{}};(function(t){const r={generateIdentifier:function(){return Math.random().toString(36).substring(2,12)}};r.localCName=r.generateIdentifier(),r.splitLines=function(s){return s.trim().split(`
`).map((a=>a.trim()))},r.splitSections=function(s){return s.split(`
m=`).map(((a,c)=>(c>0?"m="+a:a).trim()+`\r
`))},r.getDescription=function(s){const a=r.splitSections(s);return a&&a[0]},r.getMediaSections=function(s){const a=r.splitSections(s);return a.shift(),a},r.matchPrefix=function(s,a){return r.splitLines(s).filter((c=>c.indexOf(a)===0))},r.parseCandidate=function(s){let a;a=s.indexOf("a=candidate:")===0?s.substring(12).split(" "):s.substring(10).split(" ");const c={foundation:a[0],component:{1:"rtp",2:"rtcp"}[a[1]]||a[1],protocol:a[2].toLowerCase(),priority:parseInt(a[3],10),ip:a[4],address:a[4],port:parseInt(a[5],10),type:a[7]};for(let d=8;d<a.length;d+=2)switch(a[d]){case"raddr":c.relatedAddress=a[d+1];break;case"rport":c.relatedPort=parseInt(a[d+1],10);break;case"tcptype":c.tcpType=a[d+1];break;case"ufrag":c.ufrag=a[d+1],c.usernameFragment=a[d+1];break;default:c[a[d]]===void 0&&(c[a[d]]=a[d+1])}return c},r.writeCandidate=function(s){const a=[];a.push(s.foundation);const c=s.component;c==="rtp"?a.push(1):c==="rtcp"?a.push(2):a.push(c),a.push(s.protocol.toUpperCase()),a.push(s.priority),a.push(s.address||s.ip),a.push(s.port);const d=s.type;return a.push("typ"),a.push(d),d!=="host"&&s.relatedAddress&&s.relatedPort&&(a.push("raddr"),a.push(s.relatedAddress),a.push("rport"),a.push(s.relatedPort)),s.tcpType&&s.protocol.toLowerCase()==="tcp"&&(a.push("tcptype"),a.push(s.tcpType)),(s.usernameFragment||s.ufrag)&&(a.push("ufrag"),a.push(s.usernameFragment||s.ufrag)),"candidate:"+a.join(" ")},r.parseIceOptions=function(s){return s.substring(14).split(" ")},r.parseRtpMap=function(s){let a=s.substring(9).split(" ");const c={payloadType:parseInt(a.shift(),10)};return a=a[0].split("/"),c.name=a[0],c.clockRate=parseInt(a[1],10),c.channels=a.length===3?parseInt(a[2],10):1,c.numChannels=c.channels,c},r.writeRtpMap=function(s){let a=s.payloadType;s.preferredPayloadType!==void 0&&(a=s.preferredPayloadType);const c=s.channels||s.numChannels||1;return"a=rtpmap:"+a+" "+s.name+"/"+s.clockRate+(c!==1?"/"+c:"")+`\r
`},r.parseExtmap=function(s){const a=s.substring(9).split(" ");return{id:parseInt(a[0],10),direction:a[0].indexOf("/")>0?a[0].split("/")[1]:"sendrecv",uri:a[1],attributes:a.slice(2).join(" ")}},r.writeExtmap=function(s){return"a=extmap:"+(s.id||s.preferredId)+(s.direction&&s.direction!=="sendrecv"?"/"+s.direction:"")+" "+s.uri+(s.attributes?" "+s.attributes:"")+`\r
`},r.parseFmtp=function(s){const a={};let c;const d=s.substring(s.indexOf(" ")+1).split(";");for(let h=0;h<d.length;h++)c=d[h].trim().split("="),a[c[0].trim()]=c[1];return a},r.writeFmtp=function(s){let a="",c=s.payloadType;if(s.preferredPayloadType!==void 0&&(c=s.preferredPayloadType),s.parameters&&Object.keys(s.parameters).length){const d=[];Object.keys(s.parameters).forEach((h=>{s.parameters[h]!==void 0?d.push(h+"="+s.parameters[h]):d.push(h)})),a+="a=fmtp:"+c+" "+d.join(";")+`\r
`}return a},r.parseRtcpFb=function(s){const a=s.substring(s.indexOf(" ")+1).split(" ");return{type:a.shift(),parameter:a.join(" ")}},r.writeRtcpFb=function(s){let a="",c=s.payloadType;return s.preferredPayloadType!==void 0&&(c=s.preferredPayloadType),s.rtcpFeedback&&s.rtcpFeedback.length&&s.rtcpFeedback.forEach((d=>{a+="a=rtcp-fb:"+c+" "+d.type+(d.parameter&&d.parameter.length?" "+d.parameter:"")+`\r
`})),a},r.parseSsrcMedia=function(s){const a=s.indexOf(" "),c={ssrc:parseInt(s.substring(7,a),10)},d=s.indexOf(":",a);return d>-1?(c.attribute=s.substring(a+1,d),c.value=s.substring(d+1)):c.attribute=s.substring(a+1),c},r.parseSsrcGroup=function(s){const a=s.substring(13).split(" ");return{semantics:a.shift(),ssrcs:a.map((c=>parseInt(c,10)))}},r.getMid=function(s){const a=r.matchPrefix(s,"a=mid:")[0];if(a)return a.substring(6)},r.parseFingerprint=function(s){const a=s.substring(14).split(" ");return{algorithm:a[0].toLowerCase(),value:a[1].toUpperCase()}},r.getDtlsParameters=function(s,a){return{role:"auto",fingerprints:r.matchPrefix(s+a,"a=fingerprint:").map(r.parseFingerprint)}},r.writeDtlsParameters=function(s,a){let c="a=setup:"+a+`\r
`;return s.fingerprints.forEach((d=>{c+="a=fingerprint:"+d.algorithm+" "+d.value+`\r
`})),c},r.parseCryptoLine=function(s){const a=s.substring(9).split(" ");return{tag:parseInt(a[0],10),cryptoSuite:a[1],keyParams:a[2],sessionParams:a.slice(3)}},r.writeCryptoLine=function(s){return"a=crypto:"+s.tag+" "+s.cryptoSuite+" "+(typeof s.keyParams=="object"?r.writeCryptoKeyParams(s.keyParams):s.keyParams)+(s.sessionParams?" "+s.sessionParams.join(" "):"")+`\r
`},r.parseCryptoKeyParams=function(s){if(s.indexOf("inline:")!==0)return null;const a=s.substring(7).split("|");return{keyMethod:"inline",keySalt:a[0],lifeTime:a[1],mkiValue:a[2]?a[2].split(":")[0]:void 0,mkiLength:a[2]?a[2].split(":")[1]:void 0}},r.writeCryptoKeyParams=function(s){return s.keyMethod+":"+s.keySalt+(s.lifeTime?"|"+s.lifeTime:"")+(s.mkiValue&&s.mkiLength?"|"+s.mkiValue+":"+s.mkiLength:"")},r.getCryptoParameters=function(s,a){return r.matchPrefix(s+a,"a=crypto:").map(r.parseCryptoLine)},r.getIceParameters=function(s,a){const c=r.matchPrefix(s+a,"a=ice-ufrag:")[0],d=r.matchPrefix(s+a,"a=ice-pwd:")[0];return c&&d?{usernameFragment:c.substring(12),password:d.substring(10)}:null},r.writeIceParameters=function(s){let a="a=ice-ufrag:"+s.usernameFragment+`\r
a=ice-pwd:`+s.password+`\r
`;return s.iceLite&&(a+=`a=ice-lite\r
`),a},r.parseRtpParameters=function(s){const a={codecs:[],headerExtensions:[],fecMechanisms:[],rtcp:[]},c=r.splitLines(s)[0].split(" ");a.profile=c[2];for(let h=3;h<c.length;h++){const m=c[h],g=r.matchPrefix(s,"a=rtpmap:"+m+" ")[0];if(g){const v=r.parseRtpMap(g),w=r.matchPrefix(s,"a=fmtp:"+m+" ");switch(v.parameters=w.length?r.parseFmtp(w[0]):{},v.rtcpFeedback=r.matchPrefix(s,"a=rtcp-fb:"+m+" ").map(r.parseRtcpFb),a.codecs.push(v),v.name.toUpperCase()){case"RED":case"ULPFEC":a.fecMechanisms.push(v.name.toUpperCase())}}}r.matchPrefix(s,"a=extmap:").forEach((h=>{a.headerExtensions.push(r.parseExtmap(h))}));const d=r.matchPrefix(s,"a=rtcp-fb:* ").map(r.parseRtcpFb);return a.codecs.forEach((h=>{d.forEach((m=>{h.rtcpFeedback.find((g=>g.type===m.type&&g.parameter===m.parameter))||h.rtcpFeedback.push(m)}))})),a},r.writeRtpDescription=function(s,a){let c="";c+="m="+s+" ",c+=a.codecs.length>0?"9":"0",c+=" "+(a.profile||"UDP/TLS/RTP/SAVPF")+" ",c+=a.codecs.map((h=>h.preferredPayloadType!==void 0?h.preferredPayloadType:h.payloadType)).join(" ")+`\r
`,c+=`c=IN IP4 0.0.0.0\r
`,c+=`a=rtcp:9 IN IP4 0.0.0.0\r
`,a.codecs.forEach((h=>{c+=r.writeRtpMap(h),c+=r.writeFmtp(h),c+=r.writeRtcpFb(h)}));let d=0;return a.codecs.forEach((h=>{h.maxptime>d&&(d=h.maxptime)})),d>0&&(c+="a=maxptime:"+d+`\r
`),a.headerExtensions&&a.headerExtensions.forEach((h=>{c+=r.writeExtmap(h)})),c},r.parseRtpEncodingParameters=function(s){const a=[],c=r.parseRtpParameters(s),d=c.fecMechanisms.indexOf("RED")!==-1,h=c.fecMechanisms.indexOf("ULPFEC")!==-1,m=r.matchPrefix(s,"a=ssrc:").map((A=>r.parseSsrcMedia(A))).filter((A=>A.attribute==="cname")),g=m.length>0&&m[0].ssrc;let v;const w=r.matchPrefix(s,"a=ssrc-group:FID").map((A=>A.substring(17).split(" ").map((N=>parseInt(N,10)))));w.length>0&&w[0].length>1&&w[0][0]===g&&(v=w[0][1]),c.codecs.forEach((A=>{if(A.name.toUpperCase()==="RTX"&&A.parameters.apt){let N={ssrc:g,codecPayloadType:parseInt(A.parameters.apt,10)};g&&v&&(N.rtx={ssrc:v}),a.push(N),d&&(N=JSON.parse(JSON.stringify(N)),N.fec={ssrc:g,mechanism:h?"red+ulpfec":"red"},a.push(N))}})),a.length===0&&g&&a.push({ssrc:g});let I=r.matchPrefix(s,"b=");return I.length&&(I=I[0].indexOf("b=TIAS:")===0?parseInt(I[0].substring(7),10):I[0].indexOf("b=AS:")===0?1e3*parseInt(I[0].substring(5),10)*.95-16e3:void 0,a.forEach((A=>{A.maxBitrate=I}))),a},r.parseRtcpParameters=function(s){const a={},c=r.matchPrefix(s,"a=ssrc:").map((m=>r.parseSsrcMedia(m))).filter((m=>m.attribute==="cname"))[0];c&&(a.cname=c.value,a.ssrc=c.ssrc);const d=r.matchPrefix(s,"a=rtcp-rsize");a.reducedSize=d.length>0,a.compound=d.length===0;const h=r.matchPrefix(s,"a=rtcp-mux");return a.mux=h.length>0,a},r.writeRtcpParameters=function(s){let a="";return s.reducedSize&&(a+=`a=rtcp-rsize\r
`),s.mux&&(a+=`a=rtcp-mux\r
`),s.ssrc!==void 0&&s.cname&&(a+="a=ssrc:"+s.ssrc+" cname:"+s.cname+`\r
`),a},r.parseMsid=function(s){let a;const c=r.matchPrefix(s,"a=msid:");if(c.length===1)return a=c[0].substring(7).split(" "),{stream:a[0],track:a[1]};const d=r.matchPrefix(s,"a=ssrc:").map((h=>r.parseSsrcMedia(h))).filter((h=>h.attribute==="msid"));return d.length>0?(a=d[0].value.split(" "),{stream:a[0],track:a[1]}):void 0},r.parseSctpDescription=function(s){const a=r.parseMLine(s),c=r.matchPrefix(s,"a=max-message-size:");let d;c.length>0&&(d=parseInt(c[0].substring(19),10)),isNaN(d)&&(d=65536);const h=r.matchPrefix(s,"a=sctp-port:");if(h.length>0)return{port:parseInt(h[0].substring(12),10),protocol:a.fmt,maxMessageSize:d};const m=r.matchPrefix(s,"a=sctpmap:");if(m.length>0){const g=m[0].substring(10).split(" ");return{port:parseInt(g[0],10),protocol:g[1],maxMessageSize:d}}},r.writeSctpDescription=function(s,a){let c=[];return c=s.protocol!=="DTLS/SCTP"?["m="+s.kind+" 9 "+s.protocol+" "+a.protocol+`\r
`,`c=IN IP4 0.0.0.0\r
`,"a=sctp-port:"+a.port+`\r
`]:["m="+s.kind+" 9 "+s.protocol+" "+a.port+`\r
`,`c=IN IP4 0.0.0.0\r
`,"a=sctpmap:"+a.port+" "+a.protocol+` 65535\r
`],a.maxMessageSize!==void 0&&c.push("a=max-message-size:"+a.maxMessageSize+`\r
`),c.join("")},r.generateSessionId=function(){return Math.random().toString().substr(2,22)},r.writeSessionBoilerplate=function(s,a,c){let d;const h=a!==void 0?a:2;return d=s||r.generateSessionId(),`v=0\r
o=`+(c||"thisisadapterortc")+" "+d+" "+h+` IN IP4 127.0.0.1\r
s=-\r
t=0 0\r
`},r.getDirection=function(s,a){const c=r.splitLines(s);for(let d=0;d<c.length;d++)switch(c[d]){case"a=sendrecv":case"a=sendonly":case"a=recvonly":case"a=inactive":return c[d].substring(2)}return a?r.getDirection(a):"sendrecv"},r.getKind=function(s){return r.splitLines(s)[0].split(" ")[0].substring(2)},r.isRejected=function(s){return s.split(" ",2)[1]==="0"},r.parseMLine=function(s){const a=r.splitLines(s)[0].substring(2).split(" ");return{kind:a[0],port:parseInt(a[1],10),protocol:a[2],fmt:a.slice(3).join(" ")}},r.parseOLine=function(s){const a=r.matchPrefix(s,"o=")[0].substring(2).split(" ");return{username:a[0],sessionId:a[1],sessionVersion:parseInt(a[2],10),netType:a[3],addressType:a[4],address:a[5]}},r.isValidSDP=function(s){if(typeof s!="string"||s.length===0)return!1;const a=r.splitLines(s);for(let c=0;c<a.length;c++)if(a[c].length<2||a[c].charAt(1)!=="=")return!1;return!0},t.exports=r})(OB);var kB=OB.exports,Gv=l(kB),mhe=i({__proto__:null,default:Gv},[kB]);function zA(t){if(!t.RTCIceCandidate||t.RTCIceCandidate&&"foundation"in t.RTCIceCandidate.prototype)return;const r=t.RTCIceCandidate;t.RTCIceCandidate=function(s){if(typeof s=="object"&&s.candidate&&s.candidate.indexOf("a=")===0&&((s=JSON.parse(JSON.stringify(s))).candidate=s.candidate.substr(2)),s.candidate&&s.candidate.length){const a=new r(s),c=Gv.parseCandidate(s.candidate),d=Object.assign(a,c);return d.toJSON=function(){return{candidate:d.candidate,sdpMid:d.sdpMid,sdpMLineIndex:d.sdpMLineIndex,usernameFragment:d.usernameFragment}},d}return new r(s)},t.RTCIceCandidate.prototype=r.prototype,Q_(t,"icecandidate",(s=>(s.candidate&&Object.defineProperty(s,"candidate",{value:new t.RTCIceCandidate(s.candidate),writable:"false"}),s)))}function YD(t){!t.RTCIceCandidate||t.RTCIceCandidate&&"relayProtocol"in t.RTCIceCandidate.prototype||Q_(t,"icecandidate",(r=>{if(r.candidate){const s=Gv.parseCandidate(r.candidate.candidate);s.type==="relay"&&(r.candidate.relayProtocol={0:"tls",1:"tcp",2:"udp"}[s.priority>>24])}return r}))}function WA(t,r){if(!t.RTCPeerConnection)return;"sctp"in t.RTCPeerConnection.prototype||Object.defineProperty(t.RTCPeerConnection.prototype,"sctp",{get(){return this._sctp===void 0?null:this._sctp}});const s=function(m){if(!m||!m.sdp)return!1;const g=Gv.splitSections(m.sdp);return g.shift(),g.some((v=>{const w=Gv.parseMLine(v);return w&&w.kind==="application"&&w.protocol.indexOf("SCTP")!==-1}))},a=function(m){const g=m.sdp.match(/mozilla...THIS_IS_SDPARTA-(\d+)/);if(g===null||g.length<2)return-1;const v=parseInt(g[1],10);return v!=v?-1:v},c=function(m){let g=65536;return r.browser==="firefox"&&(g=r.version<57?m===-1?16384:2147483637:r.version<60?r.version===57?65535:65536:2147483637),g},d=function(m,g){let v=65536;r.browser==="firefox"&&r.version===57&&(v=65535);const w=Gv.matchPrefix(m.sdp,"a=max-message-size:");return w.length>0?v=parseInt(w[0].substr(19),10):r.browser==="firefox"&&g!==-1&&(v=2147483637),v},h=t.RTCPeerConnection.prototype.setRemoteDescription;t.RTCPeerConnection.prototype.setRemoteDescription=function(){if(this._sctp=null,r.browser==="chrome"&&r.version>=76){const{sdpSemantics:m}=this.getConfiguration();m==="plan-b"&&Object.defineProperty(this,"sctp",{get(){return this._sctp===void 0?null:this._sctp},enumerable:!0,configurable:!0})}if(s(arguments[0])){const m=a(arguments[0]),g=c(m),v=d(arguments[0],m);let w;w=g===0&&v===0?Number.POSITIVE_INFINITY:g===0||v===0?Math.max(g,v):Math.min(g,v);const I={};Object.defineProperty(I,"maxMessageSize",{get:()=>w}),this._sctp=I}return h.apply(this,arguments)}}function GA(t){if(!t.RTCPeerConnection||!("createDataChannel"in t.RTCPeerConnection.prototype))return;function r(a,c){const d=a.send;a.send=function(){const h=arguments[0],m=h.length||h.size||h.byteLength;if(a.readyState==="open"&&c.sctp&&m>c.sctp.maxMessageSize)throw new TypeError("Message too large (can send a maximum of "+c.sctp.maxMessageSize+" bytes)");return d.apply(a,arguments)}}const s=t.RTCPeerConnection.prototype.createDataChannel;t.RTCPeerConnection.prototype.createDataChannel=function(){const a=s.apply(this,arguments);return r(a,this),a},Q_(t,"datachannel",(a=>(r(a.channel,a.target),a)))}function XD(t){if(!t.RTCPeerConnection||"connectionState"in t.RTCPeerConnection.prototype)return;const r=t.RTCPeerConnection.prototype;Object.defineProperty(r,"connectionState",{get(){return{completed:"connected",checking:"connecting"}[this.iceConnectionState]||this.iceConnectionState},enumerable:!0,configurable:!0}),Object.defineProperty(r,"onconnectionstatechange",{get(){return this._onconnectionstatechange||null},set(s){this._onconnectionstatechange&&(this.removeEventListener("connectionstatechange",this._onconnectionstatechange),delete this._onconnectionstatechange),s&&this.addEventListener("connectionstatechange",this._onconnectionstatechange=s)},enumerable:!0,configurable:!0}),["setLocalDescription","setRemoteDescription"].forEach((s=>{const a=r[s];r[s]=function(){return this._connectionstatechangepoly||(this._connectionstatechangepoly=c=>{const d=c.target;if(d._lastConnectionState!==d.connectionState){d._lastConnectionState=d.connectionState;const h=new Event("connectionstatechange",c);d.dispatchEvent(h)}return c},this.addEventListener("iceconnectionstatechange",this._connectionstatechangepoly)),a.apply(this,arguments)}}))}function JD(t,r){if(!t.RTCPeerConnection||r.browser==="chrome"&&r.version>=71||r.browser==="safari"&&r.version>=605)return;const s=t.RTCPeerConnection.prototype.setRemoteDescription;t.RTCPeerConnection.prototype.setRemoteDescription=function(a){if(a&&a.sdp&&a.sdp.indexOf(`
a=extmap-allow-mixed`)!==-1){const c=a.sdp.split(`
`).filter((d=>Bo(d).call(d)!=="a=extmap-allow-mixed")).join(`
`);t.RTCSessionDescription&&a instanceof t.RTCSessionDescription?arguments[0]=new t.RTCSessionDescription({type:a.type,sdp:c}):a.sdp=c}return s.apply(this,arguments)}}function HA(t,r){if(!t.RTCPeerConnection||!t.RTCPeerConnection.prototype)return;const s=t.RTCPeerConnection.prototype.addIceCandidate;s&&s.length!==0&&(t.RTCPeerConnection.prototype.addIceCandidate=function(){return arguments[0]?(r.browser==="chrome"&&r.version<78||r.browser==="firefox"&&r.version<68||r.browser==="safari")&&arguments[0]&&arguments[0].candidate===""?mt.resolve():s.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),mt.resolve())})}function $A(t,r){if(!t.RTCPeerConnection||!t.RTCPeerConnection.prototype)return;const s=t.RTCPeerConnection.prototype.setLocalDescription;s&&s.length!==0&&(t.RTCPeerConnection.prototype.setLocalDescription=function(){let a=arguments[0]||{};if(typeof a!="object"||a.type&&a.sdp)return s.apply(this,arguments);if(a={type:a.type,sdp:a.sdp},!a.type)switch(this.signalingState){case"stable":case"have-local-offer":case"have-remote-pranswer":a.type="offer";break;default:a.type="answer"}return a.sdp||a.type!=="offer"&&a.type!=="answer"?s.apply(this,[a]):(a.type==="offer"?this.createOffer:this.createAnswer).apply(this).then((c=>s.apply(this,[c])))})}var ghe=Object.freeze({__proto__:null,removeExtmapAllowMixed:JD,shimAddIceCandidateNullOrEmpty:HA,shimConnectionState:XD,shimMaxMessageSize:WA,shimParameterlessSetLocalDescription:$A,shimRTCIceCandidate:zA,shimRTCIceCandidateRelayProtocol:YD,shimSendThrowTypeError:GA});(function(){let{window:t}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{shimChrome:!0,shimFirefox:!0,shimSafari:!0};const s=H6,a=(function(d){const h={browser:null,version:null};if(d===void 0||!d.navigator)return h.browser="Not a browser.",h;const{navigator:m}=d;if(m.mozGetUserMedia)h.browser="firefox",h.version=BA(m.userAgent,/Firefox\/(\d+)\./,1);else if(m.webkitGetUserMedia||d.isSecureContext===!1&&d.webkitRTCPeerConnection)h.browser="chrome",h.version=BA(m.userAgent,/Chrom(e|ium)\/(\d+)\./,2);else{if(!d.RTCPeerConnection||!m.userAgent.match(/AppleWebKit\/(\d+)\./))return h.browser="Not a supported browser.",h;h.browser="safari",h.version=BA(m.userAgent,/AppleWebKit\/(\d+)\./,1),h.supportsUnifiedPlan=d.RTCRtpTransceiver&&"currentDirection"in d.RTCRtpTransceiver.prototype}return h})(t),c={browserDetails:a,commonShim:ghe,extractVersion:BA,disableLog:ehe,disableWarnings:the,sdp:mhe};switch(a.browser){case"chrome":if(!sB||!HD||!r.shimChrome)return s("Chrome shim is not included in this adapter release."),c;if(a.version===null)return s("Chrome shim can not determine version, not shimming."),c;s("adapter.js shimming chrome."),c.browserShim=sB,HA(t,a),$A(t),X6(t,a),J6(t),HD(t,a),Q6(t),rB(t,a),Z6(t),eB(t),tB(t),iB(t,a),zA(t),YD(t),XD(t),WA(t,a),GA(t),JD(t,a);break;case"firefox":if(!gB||!$D||!r.shimFirefox)return s("Firefox shim is not included in this adapter release."),c;s("adapter.js shimming firefox."),c.browserShim=gB,HA(t,a),$A(t),oB(t,a),$D(t,a),aB(t),uB(t),cB(t),lB(t),dB(t),hB(t),pB(t),fB(t),mB(t),zA(t),XD(t),WA(t,a),GA(t);break;case"safari":if(!RB||!r.shimSafari)return s("Safari shim is not included in this adapter release."),c;s("adapter.js shimming safari."),c.browserShim=RB,HA(t,a),$A(t),bB(t),TB(t),EB(t),_B(t),yB(t),wB(t),vB(t),CB(t),zA(t),YD(t),WA(t,a),GA(t),JD(t,a);break;default:s("Unsupported browser!")}})({window:typeof window>"u"?void 0:window});var QD=D;Kn({global:!0,forced:QD.globalThis!==QD},{globalThis:QD});var NB=l(D),ZD={exports:{}};(function(t,r){(function(s,a){var c="function",d="undefined",h="object",m="string",g="major",v="model",w="name",I="type",A="vendor",N="version",H="architecture",B="console",z="mobile",ee="tablet",Z="smarttv",ae="wearable",ye="embedded",_e="Amazon",ue="Apple",Ae="ASUS",Ue="BlackBerry",We="Browser",Ze="Chrome",_n="Firefox",bn="Google",Zt="Huawei",ir="LG",Jn="Microsoft",uo="Motorola",ze="Opera",ot="Samsung",wt="Sharp",Ke="Sony",V="Xiaomi",ce="Zebra",ge="Facebook",tt="Chromium OS",un="Mac OS",Ar=" Browser",$i=function(Fi){for(var Ki={},Dr=0;Dr<Fi.length;Dr++)Ki[Fi[Dr].toUpperCase()]=Fi[Dr];return Ki},cu=function(Fi,Ki){return typeof Fi===m&&id(Ki).indexOf(id(Fi))!==-1},id=function(Fi){return Fi.toLowerCase()},QT=function(Fi,Ki){if(typeof Fi===m)return Fi=Fi.replace(/^\s\s*/,""),typeof Ki===d?Fi:Fi.substring(0,500)},Ry=function(Fi,Ki){for(var Dr,ac,oh,wi,kf,Vn,ah=0;ah<Ki.length&&!kf;){var Iy=Ki[ah],Ep=Ki[ah+1];for(Dr=ac=0;Dr<Iy.length&&!kf&&Iy[Dr];)if(kf=Iy[Dr++].exec(Fi))for(oh=0;oh<Ep.length;oh++)Vn=kf[++ac],typeof(wi=Ep[oh])===h&&wi.length>0?wi.length===2?typeof wi[1]==c?this[wi[0]]=wi[1].call(this,Vn):this[wi[0]]=wi[1]:wi.length===3?typeof wi[1]!==c||wi[1].exec&&wi[1].test?this[wi[0]]=Vn?Vn.replace(wi[1],wi[2]):a:this[wi[0]]=Vn?wi[1].call(this,Vn,wi[2]):a:wi.length===4&&(this[wi[0]]=Vn?wi[3].call(this,Vn.replace(wi[1],wi[2])):a):this[wi]=Vn||a;ah+=2}},U0=function(Fi,Ki){for(var Dr in Ki)if(typeof Ki[Dr]===h&&Ki[Dr].length>0){for(var ac=0;ac<Ki[Dr].length;ac++)if(cu(Ki[Dr][ac],Fi))return Dr==="?"?a:Dr}else if(cu(Ki[Dr],Fi))return Dr==="?"?a:Dr;return Ki.hasOwnProperty("*")?Ki["*"]:Fi},$P={ME:"4.90","NT 3.11":"NT3.51","NT 4.0":"NT4.0",2e3:"NT 5.0",XP:["NT 5.1","NT 5.2"],Vista:"NT 6.0",7:"NT 6.1",8:"NT 6.2",8.1:"NT 6.3",10:["NT 6.4","NT 10.0"],RT:"ARM"},KP={browser:[[/\b(?:crmo|crios)\/([\w\.]+)/i],[N,[w,"Chrome"]],[/edg(?:e|ios|a)?\/([\w\.]+)/i],[N,[w,"Edge"]],[/(opera mini)\/([-\w\.]+)/i,/(opera [mobiletab]{3,6})\b.+version\/([-\w\.]+)/i,/(opera)(?:.+version\/|[\/ ]+)([\w\.]+)/i],[w,N],[/opios[\/ ]+([\w\.]+)/i],[N,[w,ze+" Mini"]],[/\bop(?:rg)?x\/([\w\.]+)/i],[N,[w,ze+" GX"]],[/\bopr\/([\w\.]+)/i],[N,[w,ze]],[/\bb[ai]*d(?:uhd|[ub]*[aekoprswx]{5,6})[\/ ]?([\w\.]+)/i],[N,[w,"Baidu"]],[/\b(?:mxbrowser|mxios|myie2)\/?([-\w\.]*)\b/i],[N,[w,"Maxthon"]],[/(kindle)\/([\w\.]+)/i,/(lunascape|maxthon|netfront|jasmine|blazer|sleipnir)[\/ ]?([\w\.]*)/i,/(avant|iemobile|slim(?:browser|boat|jet))[\/ ]?([\d\.]*)/i,/(?:ms|\()(ie) ([\w\.]+)/i,/(flock|rockmelt|midori|epiphany|silk|skyfire|ovibrowser|bolt|iron|vivaldi|iridium|phantomjs|bowser|qupzilla|falkon|rekonq|puffin|brave|whale(?!.+naver)|qqbrowserlite|duckduckgo|klar|helio|(?=comodo_)?dragon)\/([-\w\.]+)/i,/(heytap|ovi|115)browser\/([\d\.]+)/i,/(weibo)__([\d\.]+)/i],[w,N],[/quark(?:pc)?\/([-\w\.]+)/i],[N,[w,"Quark"]],[/\bddg\/([\w\.]+)/i],[N,[w,"DuckDuckGo"]],[/(?:\buc? ?browser|(?:juc.+)ucweb)[\/ ]?([\w\.]+)/i],[N,[w,"UC"+We]],[/microm.+\bqbcore\/([\w\.]+)/i,/\bqbcore\/([\w\.]+).+microm/i,/micromessenger\/([\w\.]+)/i],[N,[w,"WeChat"]],[/konqueror\/([\w\.]+)/i],[N,[w,"Konqueror"]],[/trident.+rv[: ]([\w\.]{1,9})\b.+like gecko/i],[N,[w,"IE"]],[/ya(?:search)?browser\/([\w\.]+)/i],[N,[w,"Yandex"]],[/slbrowser\/([\w\.]+)/i],[N,[w,"Smart Lenovo "+We]],[/(avast|avg)\/([\w\.]+)/i],[[w,/(.+)/,"$1 Secure "+We],N],[/\bfocus\/([\w\.]+)/i],[N,[w,_n+" Focus"]],[/\bopt\/([\w\.]+)/i],[N,[w,ze+" Touch"]],[/coc_coc\w+\/([\w\.]+)/i],[N,[w,"Coc Coc"]],[/dolfin\/([\w\.]+)/i],[N,[w,"Dolphin"]],[/coast\/([\w\.]+)/i],[N,[w,ze+" Coast"]],[/miuibrowser\/([\w\.]+)/i],[N,[w,"MIUI"+Ar]],[/fxios\/([\w\.-]+)/i],[N,[w,_n]],[/\bqihoobrowser\/?([\w\.]*)/i],[N,[w,"360"]],[/\b(qq)\/([\w\.]+)/i],[[w,/(.+)/,"$1Browser"],N],[/(oculus|sailfish|huawei|vivo|pico)browser\/([\w\.]+)/i],[[w,/(.+)/,"$1"+Ar],N],[/samsungbrowser\/([\w\.]+)/i],[N,[w,ot+" Internet"]],[/metasr[\/ ]?([\d\.]+)/i],[N,[w,"Sogou Explorer"]],[/(sogou)mo\w+\/([\d\.]+)/i],[[w,"Sogou Mobile"],N],[/(electron)\/([\w\.]+) safari/i,/(tesla)(?: qtcarbrowser|\/(20\d\d\.[-\w\.]+))/i,/m?(qqbrowser|2345(?=browser|chrome|explorer))\w*[\/ ]?v?([\w\.]+)/i],[w,N],[/(lbbrowser|rekonq)/i,/\[(linkedin)app\]/i],[w],[/ome\/([\w\.]+) \w* ?(iron) saf/i,/ome\/([\w\.]+).+qihu (360)[es]e/i],[N,w],[/((?:fban\/fbios|fb_iab\/fb4a)(?!.+fbav)|;fbav\/([\w\.]+);)/i],[[w,ge],N],[/(Klarna)\/([\w\.]+)/i,/(kakao(?:talk|story))[\/ ]([\w\.]+)/i,/(naver)\(.*?(\d+\.[\w\.]+).*\)/i,/safari (line)\/([\w\.]+)/i,/\b(line)\/([\w\.]+)\/iab/i,/(alipay)client\/([\w\.]+)/i,/(twitter)(?:and| f.+e\/([\w\.]+))/i,/(chromium|instagram|snapchat)[\/ ]([-\w\.]+)/i],[w,N],[/\bgsa\/([\w\.]+) .*safari\//i],[N,[w,"GSA"]],[/musical_ly(?:.+app_?version\/|_)([\w\.]+)/i],[N,[w,"TikTok"]],[/headlesschrome(?:\/([\w\.]+)| )/i],[N,[w,Ze+" Headless"]],[/ wv\).+(chrome)\/([\w\.]+)/i],[[w,Ze+" WebView"],N],[/droid.+ version\/([\w\.]+)\b.+(?:mobile safari|safari)/i],[N,[w,"Android "+We]],[/(chrome|omniweb|arora|[tizenoka]{5} ?browser)\/v?([\w\.]+)/i],[w,N],[/version\/([\w\.\,]+) .*mobile\/\w+ (safari)/i],[N,[w,"Mobile Safari"]],[/version\/([\w(\.|\,)]+) .*(mobile ?safari|safari)/i],[N,w],[/webkit.+?(mobile ?safari|safari)(\/[\w\.]+)/i],[w,[N,U0,{"1.0":"/8",1.2:"/1",1.3:"/3","2.0":"/412","2.0.2":"/416","2.0.3":"/417","2.0.4":"/419","?":"/"}]],[/(webkit|khtml)\/([\w\.]+)/i],[w,N],[/(navigator|netscape\d?)\/([-\w\.]+)/i],[[w,"Netscape"],N],[/(wolvic|librewolf)\/([\w\.]+)/i],[w,N],[/mobile vr; rv:([\w\.]+)\).+firefox/i],[N,[w,_n+" Reality"]],[/ekiohf.+(flow)\/([\w\.]+)/i,/(swiftfox)/i,/(icedragon|iceweasel|camino|chimera|fennec|maemo browser|minimo|conkeror)[\/ ]?([\w\.\+]+)/i,/(seamonkey|k-meleon|icecat|iceape|firebird|phoenix|palemoon|basilisk|waterfox)\/([-\w\.]+)$/i,/(firefox)\/([\w\.]+)/i,/(mozilla)\/([\w\.]+) .+rv\:.+gecko\/\d+/i,/(polaris|lynx|dillo|icab|doris|amaya|w3m|netsurf|obigo|mosaic|(?:go|ice|up)[\. ]?browser)[-\/ ]?v?([\w\.]+)/i,/(links) \(([\w\.]+)/i],[w,[N,/_/g,"."]],[/(cobalt)\/([\w\.]+)/i],[w,[N,/master.|lts./,""]]],cpu:[[/(?:(amd|x(?:(?:86|64)[-_])?|wow|win)64)[;\)]/i],[[H,"amd64"]],[/(ia32(?=;))/i],[[H,id]],[/((?:i[346]|x)86)[;\)]/i],[[H,"ia32"]],[/\b(aarch64|arm(v?8e?l?|_?64))\b/i],[[H,"arm64"]],[/\b(arm(?:v[67])?ht?n?[fl]p?)\b/i],[[H,"armhf"]],[/windows (ce|mobile); ppc;/i],[[H,"arm"]],[/((?:ppc|powerpc)(?:64)?)(?: mac|;|\))/i],[[H,/ower/,"",id]],[/(sun4\w)[;\)]/i],[[H,"sparc"]],[/((?:avr32|ia64(?=;))|68k(?=\))|\barm(?=v(?:[1-7]|[5-7]1)l?|;|eabi)|(?=atmel )avr|(?:irix|mips|sparc)(?:64)?\b|pa-risc)/i],[[H,id]]],device:[[/\b(sch-i[89]0\d|shw-m380s|sm-[ptx]\w{2,4}|gt-[pn]\d{2,4}|sgh-t8[56]9|nexus 10)/i],[v,[A,ot],[I,ee]],[/\b((?:s[cgp]h|gt|sm)-(?![lr])\w+|sc[g-]?[\d]+a?|galaxy nexus)/i,/samsung[- ]((?!sm-[lr])[-\w]+)/i,/sec-(sgh\w+)/i],[v,[A,ot],[I,z]],[/(?:\/|\()(ip(?:hone|od)[\w, ]*)(?:\/|;)/i],[v,[A,ue],[I,z]],[/\((ipad);[-\w\),; ]+apple/i,/applecoremedia\/[\w\.]+ \((ipad)/i,/\b(ipad)\d\d?,\d\d?[;\]].+ios/i],[v,[A,ue],[I,ee]],[/(macintosh);/i],[v,[A,ue]],[/\b(sh-?[altvz]?\d\d[a-ekm]?)/i],[v,[A,wt],[I,z]],[/(?:honor)([-\w ]+)[;\)]/i],[v,[A,"Honor"],[I,z]],[/\b((?:ag[rs][23]?|bah2?|sht?|btv)-a?[lw]\d{2})\b(?!.+d\/s)/i],[v,[A,Zt],[I,ee]],[/(?:huawei)([-\w ]+)[;\)]/i,/\b(nexus 6p|\w{2,4}e?-[atu]?[ln][\dx][012359c][adn]?)\b(?!.+d\/s)/i],[v,[A,Zt],[I,z]],[/\b(poco[\w ]+|m2\d{3}j\d\d[a-z]{2})(?: bui|\))/i,/\b; (\w+) build\/hm\1/i,/\b(hm[-_ ]?note?[_ ]?(?:\d\w)?) bui/i,/\b(redmi[\-_ ]?(?:note|k)?[\w_ ]+)(?: bui|\))/i,/oid[^\)]+; (m?[12][0-389][01]\w{3,6}[c-y])( bui|; wv|\))/i,/\b(mi[-_ ]?(?:a\d|one|one[_ ]plus|note lte|max|cc)?[_ ]?(?:\d?\w?)[_ ]?(?:plus|se|lite|pro)?)(?: bui|\))/i],[[v,/_/g," "],[A,V],[I,z]],[/oid[^\)]+; (2\d{4}(283|rpbf)[cgl])( bui|\))/i,/\b(mi[-_ ]?(?:pad)(?:[\w_ ]+))(?: bui|\))/i],[[v,/_/g," "],[A,V],[I,ee]],[/; (\w+) bui.+ oppo/i,/\b(cph[12]\d{3}|p(?:af|c[al]|d\w|e[ar])[mt]\d0|x9007|a101op)\b/i],[v,[A,"OPPO"],[I,z]],[/\b(opd2\d{3}a?) bui/i],[v,[A,"OPPO"],[I,ee]],[/vivo (\w+)(?: bui|\))/i,/\b(v[12]\d{3}\w?[at])(?: bui|;)/i],[v,[A,"Vivo"],[I,z]],[/\b(rmx[1-3]\d{3})(?: bui|;|\))/i],[v,[A,"Realme"],[I,z]],[/\b(milestone|droid(?:[2-4x]| (?:bionic|x2|pro|razr))?:?( 4g)?)\b[\w ]+build\//i,/\bmot(?:orola)?[- ](\w*)/i,/((?:moto[\w\(\) ]+|xt\d{3,4}|nexus 6)(?= bui|\)))/i],[v,[A,uo],[I,z]],[/\b(mz60\d|xoom[2 ]{0,2}) build\//i],[v,[A,uo],[I,ee]],[/((?=lg)?[vl]k\-?\d{3}) bui| 3\.[-\w; ]{10}lg?-([06cv9]{3,4})/i],[v,[A,ir],[I,ee]],[/(lm(?:-?f100[nv]?|-[\w\.]+)(?= bui|\))|nexus [45])/i,/\blg[-e;\/ ]+((?!browser|netcast|android tv)\w+)/i,/\blg-?([\d\w]+) bui/i],[v,[A,ir],[I,z]],[/(ideatab[-\w ]+)/i,/lenovo ?(s[56]000[-\w]+|tab(?:[\w ]+)|yt[-\d\w]{6}|tb[-\d\w]{6})/i],[v,[A,"Lenovo"],[I,ee]],[/(?:maemo|nokia).*(n900|lumia \d+)/i,/nokia[-_ ]?([-\w\.]*)/i],[[v,/_/g," "],[A,"Nokia"],[I,z]],[/(pixel c)\b/i],[v,[A,bn],[I,ee]],[/droid.+; (pixel[\daxl ]{0,6})(?: bui|\))/i],[v,[A,bn],[I,z]],[/droid.+; (a?\d[0-2]{2}so|[c-g]\d{4}|so[-gl]\w+|xq-a\w[4-7][12])(?= bui|\).+chrome\/(?![1-6]{0,1}\d\.))/i],[v,[A,Ke],[I,z]],[/sony tablet [ps]/i,/\b(?:sony)?sgp\w+(?: bui|\))/i],[[v,"Xperia Tablet"],[A,Ke],[I,ee]],[/ (kb2005|in20[12]5|be20[12][59])\b/i,/(?:one)?(?:plus)? (a\d0\d\d)(?: b|\))/i],[v,[A,"OnePlus"],[I,z]],[/(alexa)webm/i,/(kf[a-z]{2}wi|aeo(?!bc)\w\w)( bui|\))/i,/(kf[a-z]+)( bui|\)).+silk\//i],[v,[A,_e],[I,ee]],[/((?:sd|kf)[0349hijorstuw]+)( bui|\)).+silk\//i],[[v,/(.+)/g,"Fire Phone $1"],[A,_e],[I,z]],[/(playbook);[-\w\),; ]+(rim)/i],[v,A,[I,ee]],[/\b((?:bb[a-f]|st[hv])100-\d)/i,/\(bb10; (\w+)/i],[v,[A,Ue],[I,z]],[/(?:\b|asus_)(transfo[prime ]{4,10} \w+|eeepc|slider \w+|nexus 7|padfone|p00[cj])/i],[v,[A,Ae],[I,ee]],[/ (z[bes]6[027][012][km][ls]|zenfone \d\w?)\b/i],[v,[A,Ae],[I,z]],[/(nexus 9)/i],[v,[A,"HTC"],[I,ee]],[/(htc)[-;_ ]{1,2}([\w ]+(?=\)| bui)|\w+)/i,/(zte)[- ]([\w ]+?)(?: bui|\/|\))/i,/(alcatel|geeksphone|nexian|panasonic(?!(?:;|\.))|sony(?!-bra))[-_ ]?([-\w]*)/i],[A,[v,/_/g," "],[I,z]],[/droid [\w\.]+; ((?:8[14]9[16]|9(?:0(?:48|60|8[01])|1(?:3[27]|66)|2(?:6[69]|9[56])|466))[gqswx])\w*(\)| bui)/i],[v,[A,"TCL"],[I,ee]],[/(itel) ((\w+))/i],[[A,id],v,[I,U0,{tablet:["p10001l","w7001"],"*":"mobile"}]],[/droid.+; ([ab][1-7]-?[0178a]\d\d?)/i],[v,[A,"Acer"],[I,ee]],[/droid.+; (m[1-5] note) bui/i,/\bmz-([-\w]{2,})/i],[v,[A,"Meizu"],[I,z]],[/; ((?:power )?armor(?:[\w ]{0,8}))(?: bui|\))/i],[v,[A,"Ulefone"],[I,z]],[/; (energy ?\w+)(?: bui|\))/i,/; energizer ([\w ]+)(?: bui|\))/i],[v,[A,"Energizer"],[I,z]],[/; cat (b35);/i,/; (b15q?|s22 flip|s48c|s62 pro)(?: bui|\))/i],[v,[A,"Cat"],[I,z]],[/((?:new )?andromax[\w- ]+)(?: bui|\))/i],[v,[A,"Smartfren"],[I,z]],[/droid.+; (a(?:015|06[35]|142p?))/i],[v,[A,"Nothing"],[I,z]],[/(blackberry|benq|palm(?=\-)|sonyericsson|acer|asus|dell|meizu|motorola|polytron|infinix|tecno|micromax|advan)[-_ ]?([-\w]*)/i,/; (imo) ((?!tab)[\w ]+?)(?: bui|\))/i,/(hp) ([\w ]+\w)/i,/(asus)-?(\w+)/i,/(microsoft); (lumia[\w ]+)/i,/(lenovo)[-_ ]?([-\w]+)/i,/(jolla)/i,/(oppo) ?([\w ]+) bui/i],[A,v,[I,z]],[/(imo) (tab \w+)/i,/(kobo)\s(ereader|touch)/i,/(archos) (gamepad2?)/i,/(hp).+(touchpad(?!.+tablet)|tablet)/i,/(kindle)\/([\w\.]+)/i,/(nook)[\w ]+build\/(\w+)/i,/(dell) (strea[kpr\d ]*[\dko])/i,/(le[- ]+pan)[- ]+(\w{1,9}) bui/i,/(trinity)[- ]*(t\d{3}) bui/i,/(gigaset)[- ]+(q\w{1,9}) bui/i,/(vodafone) ([\w ]+)(?:\)| bui)/i],[A,v,[I,ee]],[/(surface duo)/i],[v,[A,Jn],[I,ee]],[/droid [\d\.]+; (fp\du?)(?: b|\))/i],[v,[A,"Fairphone"],[I,z]],[/(u304aa)/i],[v,[A,"AT&T"],[I,z]],[/\bsie-(\w*)/i],[v,[A,"Siemens"],[I,z]],[/\b(rct\w+) b/i],[v,[A,"RCA"],[I,ee]],[/\b(venue[\d ]{2,7}) b/i],[v,[A,"Dell"],[I,ee]],[/\b(q(?:mv|ta)\w+) b/i],[v,[A,"Verizon"],[I,ee]],[/\b(?:barnes[& ]+noble |bn[rt])([\w\+ ]*) b/i],[v,[A,"Barnes & Noble"],[I,ee]],[/\b(tm\d{3}\w+) b/i],[v,[A,"NuVision"],[I,ee]],[/\b(k88) b/i],[v,[A,"ZTE"],[I,ee]],[/\b(nx\d{3}j) b/i],[v,[A,"ZTE"],[I,z]],[/\b(gen\d{3}) b.+49h/i],[v,[A,"Swiss"],[I,z]],[/\b(zur\d{3}) b/i],[v,[A,"Swiss"],[I,ee]],[/\b((zeki)?tb.*\b) b/i],[v,[A,"Zeki"],[I,ee]],[/\b([yr]\d{2}) b/i,/\b(dragon[- ]+touch |dt)(\w{5}) b/i],[[A,"Dragon Touch"],v,[I,ee]],[/\b(ns-?\w{0,9}) b/i],[v,[A,"Insignia"],[I,ee]],[/\b((nxa|next)-?\w{0,9}) b/i],[v,[A,"NextBook"],[I,ee]],[/\b(xtreme\_)?(v(1[045]|2[015]|[3469]0|7[05])) b/i],[[A,"Voice"],v,[I,z]],[/\b(lvtel\-)?(v1[12]) b/i],[[A,"LvTel"],v,[I,z]],[/\b(ph-1) /i],[v,[A,"Essential"],[I,z]],[/\b(v(100md|700na|7011|917g).*\b) b/i],[v,[A,"Envizen"],[I,ee]],[/\b(trio[-\w\. ]+) b/i],[v,[A,"MachSpeed"],[I,ee]],[/\btu_(1491) b/i],[v,[A,"Rotor"],[I,ee]],[/(shield[\w ]+) b/i],[v,[A,"Nvidia"],[I,ee]],[/(sprint) (\w+)/i],[A,v,[I,z]],[/(kin\.[onetw]{3})/i],[[v,/\./g," "],[A,Jn],[I,z]],[/droid.+; (cc6666?|et5[16]|mc[239][23]x?|vc8[03]x?)\)/i],[v,[A,ce],[I,ee]],[/droid.+; (ec30|ps20|tc[2-8]\d[kx])\)/i],[v,[A,ce],[I,z]],[/smart-tv.+(samsung)/i],[A,[I,Z]],[/hbbtv.+maple;(\d+)/i],[[v,/^/,"SmartTV"],[A,ot],[I,Z]],[/(nux; netcast.+smarttv|lg (netcast\.tv-201\d|android tv))/i],[[A,ir],[I,Z]],[/(apple) ?tv/i],[A,[v,ue+" TV"],[I,Z]],[/crkey/i],[[v,Ze+"cast"],[A,bn],[I,Z]],[/droid.+aft(\w+)( bui|\))/i],[v,[A,_e],[I,Z]],[/\(dtv[\);].+(aquos)/i,/(aquos-tv[\w ]+)\)/i],[v,[A,wt],[I,Z]],[/(bravia[\w ]+)( bui|\))/i],[v,[A,Ke],[I,Z]],[/(mitv-\w{5}) bui/i],[v,[A,V],[I,Z]],[/Hbbtv.*(technisat) (.*);/i],[A,v,[I,Z]],[/\b(roku)[\dx]*[\)\/]((?:dvp-)?[\d\.]*)/i,/hbbtv\/\d+\.\d+\.\d+ +\([\w\+ ]*; *([\w\d][^;]*);([^;]*)/i],[[A,QT],[v,QT],[I,Z]],[/\b(android tv|smart[- ]?tv|opera tv|tv; rv:)\b/i],[[I,Z]],[/(ouya)/i,/(nintendo) ([wids3utch]+)/i],[A,v,[I,B]],[/droid.+; (shield) bui/i],[v,[A,"Nvidia"],[I,B]],[/(playstation [345portablevi]+)/i],[v,[A,Ke],[I,B]],[/\b(xbox(?: one)?(?!; xbox))[\); ]/i],[v,[A,Jn],[I,B]],[/\b(sm-[lr]\d\d[05][fnuw]?s?)\b/i],[v,[A,ot],[I,ae]],[/((pebble))app/i],[A,v,[I,ae]],[/(watch)(?: ?os[,\/]|\d,\d\/)[\d\.]+/i],[v,[A,ue],[I,ae]],[/droid.+; (glass) \d/i],[v,[A,bn],[I,ae]],[/droid.+; (wt63?0{2,3})\)/i],[v,[A,ce],[I,ae]],[/droid.+; (glass) \d/i],[v,[A,bn],[I,ae]],[/(pico) (4|neo3(?: link|pro)?)/i],[A,v,[I,ae]],[/; (quest( \d| pro)?)/i],[v,[A,ge],[I,ae]],[/(tesla)(?: qtcarbrowser|\/[-\w\.]+)/i],[A,[I,ye]],[/(aeobc)\b/i],[v,[A,_e],[I,ye]],[/droid .+?; ([^;]+?)(?: bui|; wv\)|\) applew).+? mobile safari/i],[v,[I,z]],[/droid .+?; ([^;]+?)(?: bui|\) applew).+?(?! mobile) safari/i],[v,[I,ee]],[/\b((tablet|tab)[;\/]|focus\/\d(?!.+mobile))/i],[[I,ee]],[/(phone|mobile(?:[;\/]| [ \w\/\.]*safari)|pda(?=.+windows ce))/i],[[I,z]],[/(android[-\w\. ]{0,9});.+buil/i],[v,[A,"Generic"]]],engine:[[/windows.+ edge\/([\w\.]+)/i],[N,[w,"EdgeHTML"]],[/(arkweb)\/([\w\.]+)/i],[w,N],[/webkit\/537\.36.+chrome\/(?!27)([\w\.]+)/i],[N,[w,"Blink"]],[/(presto)\/([\w\.]+)/i,/(webkit|trident|netfront|netsurf|amaya|lynx|w3m|goanna|servo)\/([\w\.]+)/i,/ekioh(flow)\/([\w\.]+)/i,/(khtml|tasman|links)[\/ ]\(?([\w\.]+)/i,/(icab)[\/ ]([23]\.[\d\.]+)/i,/\b(libweb)/i],[w,N],[/rv\:([\w\.]{1,9})\b.+(gecko)/i],[N,w]],os:[[/microsoft (windows) (vista|xp)/i],[w,N],[/(windows (?:phone(?: os)?|mobile))[\/ ]?([\d\.\w ]*)/i],[w,[N,U0,$P]],[/windows nt 6\.2; (arm)/i,/windows[\/ ]?([ntce\d\. ]+\w)(?!.+xbox)/i,/(?:win(?=3|9|n)|win 9x )([nt\d\.]+)/i],[[N,U0,$P],[w,"Windows"]],[/ip[honead]{2,4}\b(?:.*os ([\w]+) like mac|; opera)/i,/(?:ios;fbsv\/|iphone.+ios[\/ ])([\d\.]+)/i,/cfnetwork\/.+darwin/i],[[N,/_/g,"."],[w,"iOS"]],[/(mac os x) ?([\w\. ]*)/i,/(macintosh|mac_powerpc\b)(?!.+haiku)/i],[[w,un],[N,/_/g,"."]],[/droid ([\w\.]+)\b.+(android[- ]x86|harmonyos)/i],[N,w],[/(android|webos|qnx|bada|rim tablet os|maemo|meego|sailfish|openharmony)[-\/ ]?([\w\.]*)/i,/(blackberry)\w*\/([\w\.]*)/i,/(tizen|kaios)[\/ ]([\w\.]+)/i,/\((series40);/i],[w,N],[/\(bb(10);/i],[N,[w,Ue]],[/(?:symbian ?os|symbos|s60(?=;)|series60)[-\/ ]?([\w\.]*)/i],[N,[w,"Symbian"]],[/mozilla\/[\d\.]+ \((?:mobile|tablet|tv|mobile; [\w ]+); rv:.+ gecko\/([\w\.]+)/i],[N,[w,_n+" OS"]],[/web0s;.+rt(tv)/i,/\b(?:hp)?wos(?:browser)?\/([\w\.]+)/i],[N,[w,"webOS"]],[/watch(?: ?os[,\/]|\d,\d\/)([\d\.]+)/i],[N,[w,"watchOS"]],[/crkey\/([\d\.]+)/i],[N,[w,Ze+"cast"]],[/(cros) [\w]+(?:\)| ([\w\.]+)\b)/i],[[w,tt],N],[/panasonic;(viera)/i,/(netrange)mmh/i,/(nettv)\/(\d+\.[\w\.]+)/i,/(nintendo|playstation) ([wids345portablevuch]+)/i,/(xbox); +xbox ([^\);]+)/i,/\b(joli|palm)\b ?(?:os)?\/?([\w\.]*)/i,/(mint)[\/\(\) ]?(\w*)/i,/(mageia|vectorlinux)[; ]/i,/([kxln]?ubuntu|debian|suse|opensuse|gentoo|arch(?= linux)|slackware|fedora|mandriva|centos|pclinuxos|red ?hat|zenwalk|linpus|raspbian|plan 9|minix|risc os|contiki|deepin|manjaro|elementary os|sabayon|linspire)(?: gnu\/linux)?(?: enterprise)?(?:[- ]linux)?(?:-gnu)?[-\/ ]?(?!chrom|package)([-\w\.]*)/i,/(hurd|linux) ?([\w\.]*)/i,/(gnu) ?([\w\.]*)/i,/\b([-frentopcghs]{0,5}bsd|dragonfly)[\/ ]?(?!amd|[ix346]{1,2}86)([\w\.]*)/i,/(haiku) (\w+)/i],[w,N],[/(sunos) ?([\w\.\d]*)/i],[[w,"Solaris"],N],[/((?:open)?solaris)[-\/ ]?([\w\.]*)/i,/(aix) ((\d)(?=\.|\)| )[\w\.])*/i,/\b(beos|os\/2|amigaos|morphos|openvms|fuchsia|hp-ux|serenityos)/i,/(unix) ?([\w\.]*)/i],[w,N]]},lu=function(Fi,Ki){if(typeof Fi===h&&(Ki=Fi,Fi=a),!(this instanceof lu))return new lu(Fi,Ki).getResult();var Dr=typeof s!==d&&s.navigator?s.navigator:a,ac=Fi||(Dr&&Dr.userAgent?Dr.userAgent:""),oh=Dr&&Dr.userAgentData?Dr.userAgentData:a,wi=Ki?(function(Vn,ah){var Iy={};for(var Ep in Vn)ah[Ep]&&ah[Ep].length%2==0?Iy[Ep]=ah[Ep].concat(Vn[Ep]):Iy[Ep]=Vn[Ep];return Iy})(KP,Ki):KP,kf=Dr&&Dr.userAgent==ac;return this.getBrowser=function(){var Vn={};return Vn[w]=a,Vn[N]=a,Ry.call(Vn,ac,wi.browser),Vn[g]=(function(ah){return typeof ah===m?ah.replace(/[^\d\.]/g,"").split(".")[0]:a})(Vn[N]),kf&&Dr&&Dr.brave&&typeof Dr.brave.isBrave==c&&(Vn[w]="Brave"),Vn},this.getCPU=function(){var Vn={};return Vn[H]=a,Ry.call(Vn,ac,wi.cpu),Vn},this.getDevice=function(){var Vn={};return Vn[A]=a,Vn[v]=a,Vn[I]=a,Ry.call(Vn,ac,wi.device),kf&&!Vn[I]&&oh&&oh.mobile&&(Vn[I]=z),kf&&Vn[v]=="Macintosh"&&Dr&&typeof Dr.standalone!==d&&Dr.maxTouchPoints&&Dr.maxTouchPoints>2&&(Vn[v]="iPad",Vn[I]=ee),Vn},this.getEngine=function(){var Vn={};return Vn[w]=a,Vn[N]=a,Ry.call(Vn,ac,wi.engine),Vn},this.getOS=function(){var Vn={};return Vn[w]=a,Vn[N]=a,Ry.call(Vn,ac,wi.os),kf&&!Vn[w]&&oh&&oh.platform&&oh.platform!="Unknown"&&(Vn[w]=oh.platform.replace(/chrome os/i,tt).replace(/macos/i,un)),Vn},this.getResult=function(){return{ua:this.getUA(),browser:this.getBrowser(),engine:this.getEngine(),os:this.getOS(),device:this.getDevice(),cpu:this.getCPU()}},this.getUA=function(){return ac},this.setUA=function(Vn){return ac=typeof Vn===m&&Vn.length>500?QT(Vn,500):Vn,this},this.setUA(ac),this};lu.VERSION="0.7.40",lu.BROWSER=$i([w,N,g]),lu.CPU=$i([H]),lu.DEVICE=$i([v,A,I,B,z,Z,ee,ae,ye]),lu.ENGINE=lu.OS=$i([w,N]),t.exports&&(r=t.exports=lu),r.UAParser=lu;var Of=typeof s!==d&&(s.jQuery||s.Zepto);if(Of&&!Of.ua){var qP=new lu;Of.ua=qP.getResult(),Of.ua.get=function(){return qP.getUA()},Of.ua.set=function(Fi){qP.setUA(Fi);var Ki=qP.getResult();for(var Dr in Ki)Of.ua[Dr]=Ki[Dr]}}})(typeof window=="object"?window:o)})(ZD,ZD.exports);var _he=l(ZD.exports),xB=Fm.clear;Kn({global:!0,bind:!0,forced:D.clearImmediate!==xB},{clearImmediate:xB});var DB=D,yhe=re,Ehe=de,vhe=d_,She=cn,bhe=Ts,whe=nl,The=DB.Function,Che=/MSIE .\./.test(She)||vhe==="BUN"&&(function(){var t=DB.Bun.version.split(".");return t.length<3||t[0]==="0"&&(t[1]<3||t[1]==="3"&&t[2]==="0")})(),Rhe=Kn,LB=D,MB=Fm.set,Ihe=function(t,r){var s=1;return Che?function(a,c){var d=whe(arguments.length,1)>s,h=Ehe(a)?a:The(a),m=d?bhe(arguments,s):[],g=d?function(){yhe(h,this,m)}:h;return t(g)}:t},UB=LB.setImmediate?Ihe(MB):MB;Rhe({global:!0,bind:!0,forced:LB.setImmediate!==UB},{setImmediate:UB});var VB=l(bt.setImmediate),Ahe=D,Phe=Vw,Ohe=Kt,khe=nl,Nhe=Se;Kn({global:!0,dontCallGetSet:!0,forced:u((function(){return Nhe&&Object.getOwnPropertyDescriptor(Ahe,"queueMicrotask").value.length!==1}))},{queueMicrotask:function(t){khe(arguments.length,1),Phe(Ohe(t))}});var jB=l(bt.queueMicrotask);function FB(t,r){return function(){return t.apply(r,arguments)}}const{toString:xhe}=Object.prototype,{getPrototypeOf:eL}=Object,{iterator:KA,toStringTag:BB}=Symbol,qA=(tL=Object.create(null),t=>{const r=xhe.call(t);return tL[r]||(tL[r]=r.slice(8,-1).toLowerCase())});var tL;const Hd=t=>(t=t.toLowerCase(),r=>qA(r)===t),YA=t=>r=>typeof r===t,{isArray:Hv}=Array,Yw=YA("undefined"),zB=Hd("ArrayBuffer"),Dhe=YA("string"),sl=YA("function"),WB=YA("number"),XA=t=>t!==null&&typeof t=="object",JA=t=>{if(qA(t)!=="object")return!1;const r=eL(t);return!(r!==null&&r!==Object.prototype&&Object.getPrototypeOf(r)!==null||BB in t||KA in t)},Lhe=Hd("Date"),Mhe=Hd("File"),Uhe=Hd("Blob"),Vhe=Hd("FileList"),jhe=Hd("URLSearchParams"),[Fhe,Bhe,zhe,Whe]=["ReadableStream","Request","Response","Headers"].map(Hd);function Xw(t,r){let s,a,{allOwnKeys:c=!1}=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};if(t!=null)if(typeof t!="object"&&(t=[t]),Hv(t))for(s=0,a=t.length;s<a;s++)r.call(null,t[s],s,t);else{const d=c?Object.getOwnPropertyNames(t):Object.keys(t),h=d.length;let m;for(s=0;s<h;s++)m=d[s],r.call(null,t[m],m,t)}}function GB(t,r){r=r.toLowerCase();const s=Object.keys(t);let a,c=s.length;for(;c-- >0;)if(a=s[c],r===a.toLowerCase())return a;return null}const Z_=NB!==void 0?NB:typeof self<"u"?self:typeof window<"u"?window:My,HB=t=>!Yw(t)&&t!==Z_,Ghe=(nL=typeof Uint8Array<"u"&&eL(Uint8Array),t=>nL&&t instanceof nL);var nL;const Hhe=Hd("HTMLFormElement"),$B=(t=>{let{hasOwnProperty:r}=t;return(s,a)=>r.call(s,a)})(Object.prototype),$he=Hd("RegExp"),KB=(t,r)=>{const s=Object.getOwnPropertyDescriptors(t),a={};Xw(s,((c,d)=>{let h;(h=r(c,d,t))!==!1&&(a[d]=h||c)})),Object.defineProperties(t,a)},Khe=Hd("AsyncFunction"),qB=(YB=typeof VB=="function",XB=sl(Z_.postMessage),YB?VB:XB?(rL="axios@".concat(Math.random()),QA=[],Z_.addEventListener("message",(t=>{let{source:r,data:s}=t;r===Z_&&s===rL&&QA.length&&QA.shift()()}),!1),t=>{QA.push(t),Z_.postMessage(rL,"*")}):t=>setTimeout(t));var YB,XB,rL,QA;const qhe=jB!==void 0?jB.bind(Z_):typeof process<"u"&&process.nextTick||qB;var pt={isArray:Hv,isArrayBuffer:zB,isBuffer:function(t){return t!==null&&!Yw(t)&&t.constructor!==null&&!Yw(t.constructor)&&sl(t.constructor.isBuffer)&&t.constructor.isBuffer(t)},isFormData:t=>{let r;return t&&(typeof FormData=="function"&&t instanceof FormData||sl(t.append)&&((r=qA(t))==="formdata"||r==="object"&&sl(t.toString)&&t.toString()==="[object FormData]"))},isArrayBufferView:function(t){let r;return r=typeof ArrayBuffer<"u"&&ArrayBuffer.isView?ArrayBuffer.isView(t):t&&t.buffer&&zB(t.buffer),r},isString:Dhe,isNumber:WB,isBoolean:t=>t===!0||t===!1,isObject:XA,isPlainObject:JA,isReadableStream:Fhe,isRequest:Bhe,isResponse:zhe,isHeaders:Whe,isUndefined:Yw,isDate:Lhe,isFile:Mhe,isBlob:Uhe,isRegExp:$he,isFunction:sl,isStream:t=>XA(t)&&sl(t.pipe),isURLSearchParams:jhe,isTypedArray:Ghe,isFileList:Vhe,forEach:Xw,merge:function t(){const{caseless:r}=HB(this)&&this||{},s={},a=(c,d)=>{const h=r&&GB(s,d)||d;JA(s[h])&&JA(c)?s[h]=t(s[h],c):JA(c)?s[h]=t({},c):Hv(c)?s[h]=c.slice():s[h]=c};for(let c=0,d=arguments.length;c<d;c++)arguments[c]&&Xw(arguments[c],a);return s},extend:function(t,r,s){let{allOwnKeys:a}=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{};return Xw(r,((c,d)=>{s&&sl(c)?t[d]=FB(c,s):t[d]=c}),{allOwnKeys:a}),t},trim:t=>Bo(t)?Bo(t).call(t):t.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,""),stripBOM:t=>(t.charCodeAt(0)===65279&&(t=t.slice(1)),t),inherits:(t,r,s,a)=>{t.prototype=Object.create(r.prototype,a),t.prototype.constructor=t,Object.defineProperty(t,"super",{value:r.prototype}),s&&Object.assign(t.prototype,s)},toFlatObject:(t,r,s,a)=>{let c,d,h;const m={};if(r=r||{},t==null)return r;do{for(c=Object.getOwnPropertyNames(t),d=c.length;d-- >0;)h=c[d],a&&!a(h,t,r)||m[h]||(r[h]=t[h],m[h]=!0);t=s!==!1&&eL(t)}while(t&&(!s||s(t,r))&&t!==Object.prototype);return r},kindOf:qA,kindOfTest:Hd,endsWith:(t,r,s)=>{t=String(t),(s===void 0||s>t.length)&&(s=t.length),s-=r.length;const a=t.indexOf(r,s);return a!==-1&&a===s},toArray:t=>{if(!t)return null;if(Hv(t))return t;let r=t.length;if(!WB(r))return null;const s=new Array(r);for(;r-- >0;)s[r]=t[r];return s},forEachEntry:(t,r)=>{const s=(t&&t[KA]).call(t);let a;for(;(a=s.next())&&!a.done;){const c=a.value;r.call(t,c[0],c[1])}},matchAll:(t,r)=>{let s;const a=[];for(;(s=t.exec(r))!==null;)a.push(s);return a},isHTMLForm:Hhe,hasOwnProperty:$B,hasOwnProp:$B,reduceDescriptors:KB,freezeMethods:t=>{KB(t,((r,s)=>{if(sl(t)&&["arguments","caller","callee"].indexOf(s)!==-1)return!1;const a=t[s];sl(a)&&(r.enumerable=!1,"writable"in r?r.writable=!1:r.set||(r.set=()=>{throw Error("Can not rewrite read-only method '"+s+"'")}))}))},toObjectSet:(t,r)=>{const s={},a=c=>{c.forEach((d=>{s[d]=!0}))};return Hv(t)?a(t):a(String(t).split(r)),s},toCamelCase:t=>t.toLowerCase().replace(/[-_\s]([a-z\d])(\w*)/g,(function(r,s,a){return s.toUpperCase()+a})),noop:()=>{},toFiniteNumber:(t,r)=>t!=null&&Number.isFinite(t=+t)?t:r,findKey:GB,global:Z_,isContextDefined:HB,isSpecCompliantForm:function(t){return!!(t&&sl(t.append)&&t[BB]==="FormData"&&t[KA])},toJSONObject:t=>{const r=new Array(10),s=(a,c)=>{if(XA(a)){if(r.indexOf(a)>=0)return;if(!("toJSON"in a)){r[c]=a;const d=Hv(a)?[]:{};return Xw(a,((h,m)=>{const g=s(h,c+1);!Yw(g)&&(d[m]=g)})),r[c]=void 0,d}}return a};return s(t,0)},isAsyncFn:Khe,isThenable:t=>t&&(XA(t)||sl(t))&&sl(t.then)&&sl(t.catch),setImmediate:qB,asap:qhe,isIterable:t=>t!=null&&sl(t[KA])};function Er(t,r,s,a,c){Error.call(this),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=new Error().stack,this.message=t,this.name="AxiosError",r&&(this.code=r),s&&(this.config=s),a&&(this.request=a),c&&(this.response=c,this.status=c.status?c.status:null)}pt.inherits(Er,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:pt.toJSONObject(this.config),code:this.code,status:this.status}}});const JB=Er.prototype,QB={};["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED","ERR_NOT_SUPPORT","ERR_INVALID_URL"].forEach((t=>{QB[t]={value:t}})),Object.defineProperties(Er,QB),Object.defineProperty(JB,"isAxiosError",{value:!0}),Er.from=(t,r,s,a,c,d)=>{const h=Object.create(JB);return pt.toFlatObject(t,h,(function(m){return m!==Error.prototype}),(m=>m!=="isAxiosError")),Er.call(h,t.message,r,s,a,c),h.cause=t,h.name=t.name,d&&Object.assign(h,d),h};function iL(t){return pt.isPlainObject(t)||pt.isArray(t)}function ZB(t){return pt.endsWith(t,"[]")?t.slice(0,-2):t}function e8(t,r,s){return t?t.concat(r).map((function(a,c){return a=ZB(a),!s&&c?"["+a+"]":a})).join(s?".":""):r}const Yhe=pt.toFlatObject(pt,{},null,(function(t){return/^is[A-Z]/.test(t)}));function ZA(t,r,s){if(!pt.isObject(t))throw new TypeError("target must be an object");r=r||new FormData;const a=(s=pt.toFlatObject(s,{metaTokens:!0,dots:!1,indexes:!1},!1,(function(A,N){return!pt.isUndefined(N[A])}))).metaTokens,c=s.visitor||v,d=s.dots,h=s.indexes,m=(s.Blob||typeof Blob<"u"&&Blob)&&pt.isSpecCompliantForm(r);if(!pt.isFunction(c))throw new TypeError("visitor must be a function");function g(A){if(A===null)return"";if(pt.isDate(A))return A.toISOString();if(!m&&pt.isBlob(A))throw new Er("Blob is not supported. Use a Buffer instead.");return pt.isArrayBuffer(A)||pt.isTypedArray(A)?m&&typeof Blob=="function"?new Blob([A]):Buffer.from(A):A}function v(A,N,H){let B=A;if(A&&!H&&typeof A=="object"){if(pt.endsWith(N,"{}"))N=a?N:N.slice(0,-2),A=JSON.stringify(A);else if(pt.isArray(A)&&(function(z){return pt.isArray(z)&&!z.some(iL)})(A)||(pt.isFileList(A)||pt.endsWith(N,"[]"))&&(B=pt.toArray(A)))return N=ZB(N),B.forEach((function(z,ee){!pt.isUndefined(z)&&z!==null&&r.append(h===!0?e8([N],ee,d):h===null?N:N+"[]",g(z))})),!1}return!!iL(A)||(r.append(e8(H,N,d),g(A)),!1)}const w=[],I=Object.assign(Yhe,{defaultVisitor:v,convertValue:g,isVisitable:iL});if(!pt.isObject(t))throw new TypeError("data must be an object");return(function A(N,H){if(!pt.isUndefined(N)){if(w.indexOf(N)!==-1)throw Error("Circular reference detected in "+H.join("."));w.push(N),pt.forEach(N,(function(B,z){(!(pt.isUndefined(B)||B===null)&&c.call(r,B,pt.isString(z)?Bo(z).call(z):z,H,I))===!0&&A(B,H?H.concat(z):[z])})),w.pop()}})(t),r}function t8(t){const r={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+","%00":"\0"};return encodeURIComponent(t).replace(/[!'()~]|%20|%00/g,(function(s){return r[s]}))}function sL(t,r){this._pairs=[],t&&ZA(t,this,r)}const n8=sL.prototype;function Xhe(t){return encodeURIComponent(t).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}function r8(t,r,s){if(!r)return t;const a=s&&s.encode||Xhe;pt.isFunction(s)&&(s={serialize:s});const c=s&&s.serialize;let d;if(d=c?c(r,s):pt.isURLSearchParams(r)?r.toString():new sL(r,s).toString(a),d){const h=t.indexOf("#");h!==-1&&(t=t.slice(0,h)),t+=(t.indexOf("?")===-1?"?":"&")+d}return t}n8.append=function(t,r){this._pairs.push([t,r])},n8.toString=function(t){const r=t?function(s){return t.call(this,s,t8)}:t8;return this._pairs.map((function(s){return r(s[0])+"="+r(s[1])}),"").join("&")};var i8=class{constructor(){this.handlers=[]}use(t,r,s){return this.handlers.push({fulfilled:t,rejected:r,synchronous:!!s&&s.synchronous,runWhen:s?s.runWhen:null}),this.handlers.length-1}eject(t){this.handlers[t]&&(this.handlers[t]=null)}clear(){this.handlers&&(this.handlers=[])}forEach(t){pt.forEach(this.handlers,(function(r){r!==null&&t(r)}))}},s8={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},o8={exports:{}},Jhe=Kn,Qhe=Se,a8=Yt.f;Jhe({target:"Object",stat:!0,forced:Object.defineProperty!==a8,sham:!Qhe},{defineProperty:a8});var c8=bt.Object,Zhe=o8.exports=function(t,r,s){return c8.defineProperty(t,r,s)};c8.defineProperty.sham&&(Zhe.sham=!0);var l8=l(o8.exports),epe=TypeError,u8=Ad,tpe=js,npe=on,rpe=Rr("species"),d8=Array,ipe=function(t){var r;return u8(t)&&(r=t.constructor,(tpe(r)&&(r===d8||u8(r.prototype))||npe(r)&&(r=r[rpe])===null)&&(r=void 0)),r===void 0?d8:r},h8=function(t,r){return new(ipe(t))(r===0?0:r)},spe=u,ope=ri,ape=Rr("species"),p8=function(t){return ope>=51||!spe((function(){var r=[];return(r.constructor={})[ape]=function(){return{foo:1}},r[t](Boolean).foo!==1}))},cpe=Kn,lpe=u,upe=Ad,dpe=on,hpe=Qs,ppe=mr,f8=function(t){if(t>9007199254740991)throw epe("Maximum allowed index exceeded");return t},m8=SD,fpe=h8,mpe=p8,gpe=ri,g8=Rr("isConcatSpreadable"),_pe=gpe>=51||!lpe((function(){var t=[];return t[g8]=!1,t.concat()[0]!==t})),ype=function(t){if(!dpe(t))return!1;var r=t[g8];return r!==void 0?!!r:upe(t)};cpe({target:"Array",proto:!0,forced:!_pe||!mpe("concat")},{concat:function(t){var r,s,a,c,d,h=hpe(this),m=fpe(h,0),g=0;for(r=-1,a=arguments.length;r<a;r++)if(ype(d=r===-1?h:arguments[r]))for(c=ppe(d),f8(g+c),s=0;s<c;s++,g++)s in d&&m8(m,g,d[s]);else f8(g+1),m8(m,g++,d);return m.length=g,m}});var _8={},Epe=q,vpe=an,y8=Od.f,Spe=Ts,E8=typeof window=="object"&&window&&Object.getOwnPropertyNames?Object.getOwnPropertyNames(window):[];_8.f=function(t){return E8&&Epe(t)==="Window"?(function(r){try{return y8(r)}catch{return Spe(E8)}})(t):y8(vpe(t))};var $v={},bpe=Rr;$v.f=bpe;var v8=bt,wpe=Vr,Tpe=$v,Cpe=Yt.f,Cs=function(t){var r=v8.Symbol||(v8.Symbol={});wpe(r,t)||Cpe(r,t,{value:Tpe.f(t)})},Rpe=we,Ipe=vt,Ape=Rr,Ppe=jd,S8=function(){var t=Ipe("Symbol"),r=t&&t.prototype,s=r&&r.valueOf,a=Ape("toPrimitive");r&&!r[a]&&Ppe(r,a,(function(c){return Rpe(s,this)}),{})},Ope=ct,kpe=at,Npe=Qs,xpe=mr,Dpe=h8,b8=R([].push),Lpe=function(t){var r=t===1,s=t===2,a=t===3,c=t===4,d=t===6,h=t===7,m=t===5||d;return function(g,v,w,I){for(var A,N,H=Npe(g),B=kpe(H),z=xpe(B),ee=Ope(v,w),Z=0,ae=I||Dpe,ye=r?ae(g,z):s||h?ae(g,0):void 0;z>Z;Z++)if((m||Z in B)&&(N=ee(A=B[Z],Z,H),t))if(r)ye[Z]=N;else if(N)switch(t){case 3:return!0;case 5:return A;case 6:return Z;case 2:b8(ye,A)}else switch(t){case 4:return!1;case 7:b8(ye,A)}return d?-1:a||c?c:ye}},w8={forEach:Lpe(0)},e1=Kn,Jw=D,oL=we,Mpe=R,Kv=Se,qv=Gr,Upe=u,da=Vr,Vpe=O,aL=rr,t1=an,cL=yr,jpe=Ya,lL=nt,Yv=S_,T8=Pa,Fpe=Od,C8=_8,Bpe=Rm,R8=pe,I8=Yt,zpe=zh,A8=Re,P8=jd,Wpe=Hh,uL=Sa,O8=Hl,k8=qt,Gpe=Rr,Hpe=$v,$pe=Cs,Kpe=S8,qpe=Du,N8=Gh,n1=w8.forEach,ol=Tm("hidden"),r1="Symbol",Qw="prototype",Ype=N8.set,x8=N8.getterFor(r1),$d=Object[Qw],ey=Jw.Symbol,i1=ey&&ey[Qw],Xpe=Jw.RangeError,Jpe=Jw.TypeError,dL=Jw.QObject,D8=R8.f,ty=I8.f,L8=C8.f,Qpe=A8.f,M8=Mpe([].push),yf=uL("symbols"),Zw=uL("op-symbols"),Zpe=uL("wks"),hL=!dL||!dL[Qw]||!dL[Qw].findChild,U8=function(t,r,s){var a=D8($d,r);a&&delete $d[r],ty(t,r,s),a&&t!==$d&&ty($d,r,a)},pL=Kv&&Upe((function(){return Yv(ty({},"a",{get:function(){return ty(this,"a",{value:7}).a}})).a!==7}))?U8:ty,fL=function(t,r){var s=yf[t]=Yv(i1);return Ype(s,{type:r1,tag:t,description:r}),Kv||(s.description=r),s},s1=function(t,r,s){t===$d&&s1(Zw,r,s),aL(t);var a=cL(r);return aL(s),da(yf,a)?(s.enumerable?(da(t,ol)&&t[ol][a]&&(t[ol][a]=!1),s=Yv(s,{enumerable:lL(0,!1)})):(da(t,ol)||ty(t,ol,lL(1,Yv(null))),t[ol][a]=!0),pL(t,a,s)):ty(t,a,s)},mL=function(t,r){aL(t);var s=t1(r),a=T8(s).concat(B8(s));return n1(a,(function(c){Kv&&!oL(V8,s,c)||s1(t,c,s[c])})),t},V8=function(t){var r=cL(t),s=oL(Qpe,this,r);return!(this===$d&&da(yf,r)&&!da(Zw,r))&&(!(s||!da(this,r)||!da(yf,r)||da(this,ol)&&this[ol][r])||s)},j8=function(t,r){var s=t1(t),a=cL(r);if(s!==$d||!da(yf,a)||da(Zw,a)){var c=D8(s,a);return!c||!da(yf,a)||da(s,ol)&&s[ol][a]||(c.enumerable=!0),c}},F8=function(t){var r=L8(t1(t)),s=[];return n1(r,(function(a){da(yf,a)||da(O8,a)||M8(s,a)})),s},B8=function(t){var r=t===$d,s=L8(r?Zw:t1(t)),a=[];return n1(s,(function(c){!da(yf,c)||r&&!da($d,c)||M8(a,yf[c])})),a};qv||(ey=function(){if(Vpe(i1,this))throw new Jpe("Symbol is not a constructor");var t=arguments.length&&arguments[0]!==void 0?jpe(arguments[0]):void 0,r=k8(t),s=function(a){var c=this===void 0?Jw:this;c===$d&&oL(s,Zw,a),da(c,ol)&&da(c[ol],r)&&(c[ol][r]=!1);var d=lL(1,a);try{pL(c,r,d)}catch(h){if(!(h instanceof Xpe))throw h;U8(c,r,d)}};return Kv&&hL&&pL($d,r,{configurable:!0,set:s}),fL(r,t)},P8(i1=ey[Qw],"toString",(function(){return x8(this).tag})),P8(ey,"withoutSetter",(function(t){return fL(k8(t),t)})),A8.f=V8,I8.f=s1,zpe.f=mL,R8.f=j8,Fpe.f=C8.f=F8,Bpe.f=B8,Hpe.f=function(t){return fL(Gpe(t),t)},Kv&&Wpe(i1,"description",{configurable:!0,get:function(){return x8(this).description}})),e1({global:!0,wrap:!0,forced:!qv,sham:!qv},{Symbol:ey}),n1(T8(Zpe),(function(t){$pe(t)})),e1({target:r1,stat:!0,forced:!qv},{useSetter:function(){hL=!0},useSimple:function(){hL=!1}}),e1({target:"Object",stat:!0,forced:!qv,sham:!Kv},{create:function(t,r){return r===void 0?Yv(t):mL(Yv(t),r)},defineProperty:s1,defineProperties:mL,getOwnPropertyDescriptor:j8}),e1({target:"Object",stat:!0,forced:!qv},{getOwnPropertyNames:F8}),Kpe(),qpe(ey,r1),O8[ol]=!0;var z8=Gr&&!!Symbol.for&&!!Symbol.keyFor,efe=Kn,tfe=vt,nfe=Vr,rfe=Ya,W8=Sa,ife=z8,gL=W8("string-to-symbol-registry"),sfe=W8("symbol-to-string-registry");efe({target:"Symbol",stat:!0,forced:!ife},{for:function(t){var r=rfe(t);if(nfe(gL,r))return gL[r];var s=tfe("Symbol")(r);return gL[r]=s,sfe[s]=r,s}});var ofe=Kn,afe=Vr,cfe=ns,lfe=So,ufe=z8,G8=Sa("symbol-to-string-registry");ofe({target:"Symbol",stat:!0,forced:!ufe},{keyFor:function(t){if(!cfe(t))throw new TypeError(lfe(t)+" is not a symbol");if(afe(G8,t))return G8[t]}});var H8=Ad,dfe=de,$8=q,hfe=Ya,K8=R([].push),pfe=Kn,q8=vt,Y8=re,ffe=we,eT=R,X8=u,J8=de,Q8=ns,Z8=Ts,mfe=function(t){if(dfe(t))return t;if(H8(t)){for(var r=t.length,s=[],a=0;a<r;a++){var c=t[a];typeof c=="string"?K8(s,c):typeof c!="number"&&$8(c)!=="Number"&&$8(c)!=="String"||K8(s,hfe(c))}var d=s.length,h=!0;return function(m,g){if(h)return h=!1,g;if(H8(this))return g;for(var v=0;v<d;v++)if(s[v]===m)return g}}},gfe=Gr,_fe=String,Xm=q8("JSON","stringify"),o1=eT(/./.exec),ez=eT("".charAt),yfe=eT("".charCodeAt),Efe=eT("".replace),vfe=eT(1 .toString),Sfe=/[\uD800-\uDFFF]/g,tz=/^[\uD800-\uDBFF]$/,nz=/^[\uDC00-\uDFFF]$/,rz=!gfe||X8((function(){var t=q8("Symbol")("stringify detection");return Xm([t])!=="[null]"||Xm({a:t})!=="{}"||Xm(Object(t))!=="{}"})),iz=X8((function(){return Xm("\uDF06\uD834")!=='"\\udf06\\ud834"'||Xm("\uDEAD")!=='"\\udead"'})),bfe=function(t,r){var s=Z8(arguments),a=mfe(r);if(J8(a)||t!==void 0&&!Q8(t))return s[1]=function(c,d){if(J8(a)&&(d=ffe(a,this,_fe(c),d)),!Q8(d))return d},Y8(Xm,null,s)},wfe=function(t,r,s){var a=ez(s,r-1),c=ez(s,r+1);return o1(tz,t)&&!o1(nz,c)||o1(nz,t)&&!o1(tz,a)?"\\u"+vfe(yfe(t,0),16):t};Xm&&pfe({target:"JSON",stat:!0,forced:rz||iz},{stringify:function(t,r,s){var a=Z8(arguments),c=Y8(rz?bfe:Xm,null,a);return iz&&typeof c=="string"?Efe(c,Sfe,wfe):c}});var sz=Rm,Tfe=Qs;Kn({target:"Object",stat:!0,forced:!Gr||u((function(){sz.f(1)}))},{getOwnPropertySymbols:function(t){var r=sz.f;return r?r(Tfe(t)):[]}}),Cs("asyncIterator"),Cs("hasInstance"),Cs("isConcatSpreadable"),Cs("iterator"),Cs("match"),Cs("matchAll"),Cs("replace"),Cs("search"),Cs("species"),Cs("split");var Cfe=S8;Cs("toPrimitive"),Cfe();var Rfe=vt,Ife=Du;Cs("toStringTag"),Ife(Rfe("Symbol"),"Symbol"),Cs("unscopables"),Du(D.JSON,"JSON",!0);var Afe=bt.Symbol,Pfe=Rr,Ofe=Yt.f,oz=Pfe("metadata"),az=Function.prototype;az[oz]===void 0&&Ofe(az,oz,{value:null}),Cs("asyncDispose"),Cs("dispose"),Cs("metadata");var kfe=Afe,Nfe=R,_L=vt("Symbol"),xfe=_L.keyFor,Dfe=Nfe(_L.prototype.valueOf),cz=_L.isRegisteredSymbol||function(t){try{return xfe(Dfe(t))!==void 0}catch{return!1}};Kn({target:"Symbol",stat:!0},{isRegisteredSymbol:cz});for(var Lfe=Sa,lz=vt,Mfe=R,Ufe=ns,Vfe=Rr,a1=lz("Symbol"),uz=a1.isWellKnownSymbol,dz=lz("Object","getOwnPropertyNames"),jfe=Mfe(a1.prototype.valueOf),hz=Lfe("wks"),yL=0,pz=dz(a1),Ffe=pz.length;yL<Ffe;yL++)try{var fz=pz[yL];Ufe(a1[fz])&&Vfe(fz)}catch{}var mz=function(t){if(uz&&uz(t))return!0;try{for(var r=jfe(t),s=0,a=dz(hz),c=a.length;s<c;s++)if(hz[a[s]]==r)return!0}catch{}return!1};Kn({target:"Symbol",stat:!0,forced:!0},{isWellKnownSymbol:mz}),Cs("customMatcher"),Cs("observable"),Kn({target:"Symbol",stat:!0},{isRegistered:cz}),Kn({target:"Symbol",stat:!0,forced:!0},{isWellKnown:mz}),Cs("matcher"),Cs("metadataKey"),Cs("patternMatch"),Cs("replaceAll");var Xv=l(kfe),gz=l($v.f("iterator"));function tT(t){return tT=typeof Xv=="function"&&typeof gz=="symbol"?function(r){return typeof r}:function(r){return r&&typeof Xv=="function"&&r.constructor===Xv&&r!==Xv.prototype?"symbol":typeof r},tT(t)}var Bfe=l($v.f("toPrimitive"));function zfe(t){var r=(function(s,a){if(tT(s)!="object"||!s)return s;var c=s[Bfe];if(c!==void 0){var d=c.call(s,a);if(tT(d)!="object")return d;throw new TypeError("@@toPrimitive must return a primitive value.")}return(a==="string"?String:Number)(s)})(t,"string");return tT(r)=="symbol"?r:r+""}function X(t,r,s){return(r=zfe(r))in t?l8(t,r,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[r]=s,t}var _z=l(zue),Wfe={isBrowser:!0,classes:{URLSearchParams:_z!==void 0?_z:sL,FormData:typeof FormData<"u"?FormData:null,Blob:typeof Blob<"u"?Blob:null},protocols:["http","https","file","blob","url","data"]};const EL=typeof window<"u"&&typeof document<"u",vL=typeof navigator=="object"&&navigator||void 0,Gfe=EL&&(!vL||["ReactNative","NativeScript","NS"].indexOf(vL.product)<0),Hfe=typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope&&typeof self.importScripts=="function",$fe=EL&&window.location.href||"http://localhost";function yz(t,r){var s=Object.keys(t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);r&&(a=a.filter((function(c){return Object.getOwnPropertyDescriptor(t,c).enumerable}))),s.push.apply(s,a)}return s}function Ez(t){for(var r=1;r<arguments.length;r++){var s=arguments[r]!=null?arguments[r]:{};r%2?yz(Object(s),!0).forEach((function(a){X(t,a,s[a])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(s)):yz(Object(s)).forEach((function(a){Object.defineProperty(t,a,Object.getOwnPropertyDescriptor(s,a))}))}return t}var tc=Ez(Ez({},Object.freeze({__proto__:null,hasBrowserEnv:EL,hasStandardBrowserEnv:Gfe,hasStandardBrowserWebWorkerEnv:Hfe,navigator:vL,origin:$fe})),Wfe),Kfe=rr,qfe=we,Yfe=Vr,Xfe=O,Jfe=function(){var t=Kfe(this),r="";return t.hasIndices&&(r+="d"),t.global&&(r+="g"),t.ignoreCase&&(r+="i"),t.multiline&&(r+="m"),t.dotAll&&(r+="s"),t.unicode&&(r+="u"),t.unicodeSets&&(r+="v"),t.sticky&&(r+="y"),r},vz=RegExp.prototype,Sz=function(t){var r=t.flags;return r!==void 0||"flags"in vz||Yfe(t,"flags")||!Xfe(vz,t)?r:qfe(Jfe,t)},Qfe=aD.charAt,bz=we,Zfe=rr,eme=de,tme=q,nme=/./.exec,rme=TypeError,ime=Kn,wz=we,Tz=ne,sme=N_,c1=vv,Cz=Jt,Rz=ci,nT=Ya,ome=rr,ame=on,cme=q,lme=_b,Iz=Sz,ume=Ha,dme=u,hme=pf,pme=function(t,r,s){return r+(s?Qfe(t,r).length:1)},fme=function(t,r){var s=t.exec;if(eme(s)){var a=bz(s,t,r);return a!==null&&Zfe(a),a}if(tme(t)==="RegExp")return bz(nme,t,r);throw new rme("RegExp#exec called on incompatible receiver")},Az=Gh,mme=Rr("matchAll"),Pz="RegExp String",Oz=Pz+" Iterator",gme=Az.set,_me=Az.getterFor(Oz),yme=TypeError,SL=Tz("".indexOf),l1=Tz("".matchAll),bL=!!l1&&!dme((function(){l1("a",/./)})),Eme=sme((function(t,r,s,a){gme(this,{type:Oz,regexp:t,string:r,global:s,unicode:a,done:!1})}),Pz,(function(){var t=_me(this);if(t.done)return c1(void 0,!0);var r=t.regexp,s=t.string,a=fme(r,s);return a===null?(t.done=!0,c1(void 0,!0)):t.global?(nT(a[0])===""&&(r.lastIndex=pme(s,Rz(r.lastIndex),t.unicode)),c1(a,!1)):(t.done=!0,c1(a,!1))})),kz=function(t){var r,s,a,c=ome(this),d=nT(t),h=hme(c,RegExp),m=nT(Iz(c));return r=new h(h===RegExp?c.source:c,m),s=!!~SL(m,"g"),a=!!~SL(m,"u"),r.lastIndex=Rz(c.lastIndex),new Eme(r,d,s,a)};ime({target:"String",proto:!0,forced:bL},{matchAll:function(t){var r,s,a,c,d=Cz(this);if(ame(t)){if(lme(t)&&(r=nT(Cz(Iz(t))),!~SL(r,"g")))throw new yme("`.matchAll` does not allow non-global regexes");if(bL)return l1(d,t);if((a=ume(t,mme))===void 0&&cme(t)==="RegExp"&&(a=kz),a)return wz(a,t,d)}else if(bL)return l1(d,t);return s=nT(d),c=new RegExp(t,"g"),wz(kz,c,s)}});var vme=wc("String","matchAll"),Sme=O,bme=vme,wL=String.prototype,wme=function(t){var r=t.matchAll;return typeof t=="string"||t===wL||Sme(wL,t)&&r===wL.matchAll?bme:r},Tme=l(wme);function Nz(t){function r(s,a,c,d){let h=s[d++];if(h==="__proto__")return!0;const m=Number.isFinite(+h),g=d>=s.length;return h=!h&&pt.isArray(c)?c.length:h,g?(pt.hasOwnProp(c,h)?c[h]=[c[h],a]:c[h]=a,!m):(c[h]&&pt.isObject(c[h])||(c[h]=[]),r(s,a,c[h],d)&&pt.isArray(c[h])&&(c[h]=(function(v){const w={},I=Object.keys(v);let A;const N=I.length;let H;for(A=0;A<N;A++)H=I[A],w[H]=v[H];return w})(c[h])),!m)}if(pt.isFormData(t)&&pt.isFunction(t.entries)){const s={};return pt.forEachEntry(t,((a,c)=>{r((function(d){return Tme(pt).call(pt,/\w+|\[(\w*)]/g,d).map((h=>h[0]==="[]"?"":h[1]||h[0]))})(a),c,s,0)})),s}return null}const TL={transitional:s8,adapter:["xhr","http","fetch"],transformRequest:[function(t,r){const s=r.getContentType()||"",a=s.indexOf("application/json")>-1,c=pt.isObject(t);if(c&&pt.isHTMLForm(t)&&(t=new FormData(t)),pt.isFormData(t))return a?JSON.stringify(Nz(t)):t;if(pt.isArrayBuffer(t)||pt.isBuffer(t)||pt.isStream(t)||pt.isFile(t)||pt.isBlob(t)||pt.isReadableStream(t))return t;if(pt.isArrayBufferView(t))return t.buffer;if(pt.isURLSearchParams(t))return r.setContentType("application/x-www-form-urlencoded;charset=utf-8",!1),t.toString();let d;if(c){if(s.indexOf("application/x-www-form-urlencoded")>-1)return(function(h,m){return ZA(h,new tc.classes.URLSearchParams,Object.assign({visitor:function(g,v,w,I){return tc.isNode&&pt.isBuffer(g)?(this.append(v,g.toString("base64")),!1):I.defaultVisitor.apply(this,arguments)}},m))})(t,this.formSerializer).toString();if((d=pt.isFileList(t))||s.indexOf("multipart/form-data")>-1){const h=this.env&&this.env.FormData;return ZA(d?{"files[]":t}:t,h&&new h,this.formSerializer)}}return c||a?(r.setContentType("application/json",!1),(function(h,m,g){if(pt.isString(h))try{return(m||JSON.parse)(h),Bo(pt).call(pt,h)}catch(v){if(v.name!=="SyntaxError")throw v}return(g||JSON.stringify)(h)})(t)):t}],transformResponse:[function(t){const r=this.transitional||TL.transitional,s=r&&r.forcedJSONParsing,a=this.responseType==="json";if(pt.isResponse(t)||pt.isReadableStream(t))return t;if(t&&pt.isString(t)&&(s&&!this.responseType||a)){const c=!(r&&r.silentJSONParsing)&&a;try{return JSON.parse(t)}catch(d){if(c)throw d.name==="SyntaxError"?Er.from(d,Er.ERR_BAD_RESPONSE,this,null,this.response):d}}return t}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:tc.classes.FormData,Blob:tc.classes.Blob},validateStatus:function(t){return t>=200&&t<300},headers:{common:{Accept:"application/json, text/plain, */*","Content-Type":void 0}}};pt.forEach(["delete","get","head","post","put","patch"],(t=>{TL.headers[t]={}}));var CL=TL;const Cme=pt.toObjectSet(["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"]),xz=Symbol("internals");function rT(t){var r;return t&&Bo(r=String(t)).call(r).toLowerCase()}function u1(t){return t===!1||t==null?t:pt.isArray(t)?t.map(u1):String(t)}function RL(t,r,s,a,c){return pt.isFunction(a)?a.call(this,r,s):(c&&(r=s),pt.isString(r)?pt.isString(a)?r.indexOf(a)!==-1:pt.isRegExp(a)?a.test(r):void 0:void 0)}class d1{constructor(r){r&&this.set(r)}set(r,s,a){const c=this;function d(g,v,w){const I=rT(v);if(!I)throw new Error("header name must be a non-empty string");const A=pt.findKey(c,I);(!A||c[A]===void 0||w===!0||w===void 0&&c[A]!==!1)&&(c[A||v]=u1(g))}const h=(g,v)=>pt.forEach(g,((w,I)=>d(w,I,v)));if(pt.isPlainObject(r)||r instanceof this.constructor)h(r,s);else if(pt.isString(r)&&(r=Bo(r).call(r))&&!/^[-_a-zA-Z0-9^`|~,!#$%&'*+.]+$/.test(Bo(m=r).call(m)))h((g=>{const v={};let w,I,A;return g&&g.split(`
`).forEach((function(N){var H,B;A=N.indexOf(":"),w=Bo(H=N.substring(0,A)).call(H).toLowerCase(),I=Bo(B=N.substring(A+1)).call(B),!w||v[w]&&Cme[w]||(w==="set-cookie"?v[w]?v[w].push(I):v[w]=[I]:v[w]=v[w]?v[w]+", "+I:I)})),v})(r),s);else if(pt.isObject(r)&&pt.isIterable(r)){let g,v,w={};for(const I of r){if(!pt.isArray(I))throw TypeError("Object iterator must return a key-value pair");w[v=I[0]]=(g=w[v])?pt.isArray(g)?[...g,I[1]]:[g,I[1]]:I[1]}h(w,s)}else r!=null&&d(s,r,a);var m;return this}get(r,s){if(r=rT(r)){const a=pt.findKey(this,r);if(a){const c=this[a];if(!s)return c;if(s===!0)return(function(d){const h=Object.create(null),m=/([^\s,;=]+)\s*(?:=\s*([^,;]+))?/g;let g;for(;g=m.exec(d);)h[g[1]]=g[2];return h})(c);if(pt.isFunction(s))return s.call(this,c,a);if(pt.isRegExp(s))return s.exec(c);throw new TypeError("parser must be boolean|regexp|function")}}}has(r,s){if(r=rT(r)){const a=pt.findKey(this,r);return!(!a||this[a]===void 0||s&&!RL(0,this[a],a,s))}return!1}delete(r,s){const a=this;let c=!1;function d(h){if(h=rT(h)){const m=pt.findKey(a,h);!m||s&&!RL(0,a[m],m,s)||(delete a[m],c=!0)}}return pt.isArray(r)?r.forEach(d):d(r),c}clear(r){const s=Object.keys(this);let a=s.length,c=!1;for(;a--;){const d=s[a];r&&!RL(0,this[d],d,r,!0)||(delete this[d],c=!0)}return c}normalize(r){const s=this,a={};return pt.forEach(this,((c,d)=>{var h;const m=pt.findKey(a,d);if(m)return s[m]=u1(c),void delete s[d];const g=r?(function(v){return Bo(v).call(v).toLowerCase().replace(/([a-z\d])(\w*)/g,((w,I,A)=>I.toUpperCase()+A))})(d):Bo(h=String(d)).call(h);g!==d&&delete s[d],s[g]=u1(c),a[g]=!0})),this}concat(){for(var r=arguments.length,s=new Array(r),a=0;a<r;a++)s[a]=arguments[a];return this.constructor.concat(this,...s)}toJSON(r){const s=Object.create(null);return pt.forEach(this,((a,c)=>{a!=null&&a!==!1&&(s[c]=r&&pt.isArray(a)?a.join(", "):a)})),s}[Symbol.iterator](){return Object.entries(this.toJSON())[Symbol.iterator]()}toString(){return Object.entries(this.toJSON()).map((r=>{let[s,a]=r;return s+": "+a})).join(`
`)}getSetCookie(){return this.get("set-cookie")||[]}get[Symbol.toStringTag](){return"AxiosHeaders"}static from(r){return r instanceof this?r:new this(r)}static concat(r){const s=new this(r);for(var a=arguments.length,c=new Array(a>1?a-1:0),d=1;d<a;d++)c[d-1]=arguments[d];return c.forEach((h=>s.set(h))),s}static accessor(r){const s=(this[xz]=this[xz]={accessors:{}}).accessors,a=this.prototype;function c(d){const h=rT(d);s[h]||((function(m,g){const v=pt.toCamelCase(" "+g);["get","set","has"].forEach((w=>{Object.defineProperty(m,w+v,{value:function(I,A,N){return this[w].call(this,g,I,A,N)},configurable:!0})}))})(a,d),s[h]=!0)}return pt.isArray(r)?r.forEach(c):c(r),this}}d1.accessor(["Content-Type","Content-Length","Accept","Accept-Encoding","User-Agent","Authorization"]),pt.reduceDescriptors(d1.prototype,((t,r)=>{let{value:s}=t,a=r[0].toUpperCase()+r.slice(1);return{get:()=>s,set(c){this[a]=c}}})),pt.freezeMethods(d1);var Kd=d1;function IL(t,r){const s=this||CL,a=r||s,c=Kd.from(a.headers);let d=a.data;return pt.forEach(t,(function(h){d=h.call(s,d,c.normalize(),r?r.status:void 0)})),c.normalize(),d}function Dz(t){return!(!t||!t.__CANCEL__)}function Jv(t,r,s){Er.call(this,t??"canceled",Er.ERR_CANCELED,r,s),this.name="CanceledError"}function Lz(t,r,s){const a=s.config.validateStatus;s.status&&a&&!a(s.status)?r(new Er("Request failed with status code "+s.status,[Er.ERR_BAD_REQUEST,Er.ERR_BAD_RESPONSE][Math.floor(s.status/100)-4],s.config,s.request,s)):t(s)}pt.inherits(Jv,Er,{__CANCEL__:!0});const h1=function(t,r){let s=arguments.length>2&&arguments[2]!==void 0?arguments[2]:3,a=0;const c=(function(d,h){d=d||10;const m=new Array(d),g=new Array(d);let v,w=0,I=0;return h=h!==void 0?h:1e3,function(A){const N=Date.now(),H=g[I];v||(v=N),m[w]=A,g[w]=N;let B=I,z=0;for(;B!==w;)z+=m[B++],B%=d;if(w=(w+1)%d,w===I&&(I=(I+1)%d),N-v<h)return;const ee=H&&N-H;return ee?Math.round(1e3*z/ee):void 0}})(50,250);return(function(d,h){let m,g,v=0,w=1e3/h;const I=function(A){v=arguments.length>1&&arguments[1]!==void 0?arguments[1]:Date.now(),m=null,g&&(clearTimeout(g),g=null),d.apply(null,A)};return[function(){const A=Date.now(),N=A-v;for(var H=arguments.length,B=new Array(H),z=0;z<H;z++)B[z]=arguments[z];N>=w?I(B,A):(m=B,g||(g=setTimeout((()=>{g=null,I(m)}),w-N)))},()=>m&&I(m)]})((d=>{const h=d.loaded,m=d.lengthComputable?d.total:void 0,g=h-a,v=c(g);a=h,t({loaded:h,total:m,progress:m?h/m:void 0,bytes:g,rate:v||void 0,estimated:v&&m&&h<=m?(m-h)/v:void 0,event:d,lengthComputable:m!=null,[r?"download":"upload"]:!0})}),s)},Mz=(t,r)=>{const s=t!=null;return[a=>r[0]({lengthComputable:s,total:t,loaded:a}),r[1]]},Uz=t=>function(){for(var r=arguments.length,s=new Array(r),a=0;a<r;a++)s[a]=arguments[a];return pt.asap((()=>t(...s)))};var Rme=tc.hasStandardBrowserEnv?((t,r)=>s=>(s=new FA(s,tc.origin),t.protocol===s.protocol&&t.host===s.host&&(r||t.port===s.port)))(new FA(tc.origin),tc.navigator&&/(msie|trident)/i.test(tc.navigator.userAgent)):()=>!0,Ime=tc.hasStandardBrowserEnv?{write(t,r,s,a,c,d){const h=[t+"="+encodeURIComponent(r)];pt.isNumber(s)&&h.push("expires="+new Date(s).toGMTString()),pt.isString(a)&&h.push("path="+a),pt.isString(c)&&h.push("domain="+c),d===!0&&h.push("secure"),document.cookie=h.join("; ")},read(t){const r=document.cookie.match(new RegExp("(^|;\\s*)("+t+")=([^;]*)"));return r?decodeURIComponent(r[3]):null},remove(t){this.write(t,"",Date.now()-864e5)}}:{write(){},read:()=>null,remove(){}};function Vz(t,r,s){let a=!(function(c){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(c)})(r);return t&&(a||s==0)?(function(c,d){return d?c.replace(/\/?\/$/,"")+"/"+d.replace(/^\/+/,""):c})(t,r):r}function jz(t,r){var s=Object.keys(t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);r&&(a=a.filter((function(c){return Object.getOwnPropertyDescriptor(t,c).enumerable}))),s.push.apply(s,a)}return s}const Fz=t=>t instanceof Kd?(function(r){for(var s=1;s<arguments.length;s++){var a=arguments[s]!=null?arguments[s]:{};s%2?jz(Object(a),!0).forEach((function(c){X(r,c,a[c])})):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(a)):jz(Object(a)).forEach((function(c){Object.defineProperty(r,c,Object.getOwnPropertyDescriptor(a,c))}))}return r})({},t):t;function ny(t,r){r=r||{};const s={};function a(v,w,I,A){return pt.isPlainObject(v)&&pt.isPlainObject(w)?pt.merge.call({caseless:A},v,w):pt.isPlainObject(w)?pt.merge({},w):pt.isArray(w)?w.slice():w}function c(v,w,I,A){return pt.isUndefined(w)?pt.isUndefined(v)?void 0:a(void 0,v,0,A):a(v,w,0,A)}function d(v,w){if(!pt.isUndefined(w))return a(void 0,w)}function h(v,w){return pt.isUndefined(w)?pt.isUndefined(v)?void 0:a(void 0,v):a(void 0,w)}function m(v,w,I){return I in r?a(v,w):I in t?a(void 0,v):void 0}const g={url:d,method:d,data:d,baseURL:h,transformRequest:h,transformResponse:h,paramsSerializer:h,timeout:h,timeoutMessage:h,withCredentials:h,withXSRFToken:h,adapter:h,responseType:h,xsrfCookieName:h,xsrfHeaderName:h,onUploadProgress:h,onDownloadProgress:h,decompress:h,maxContentLength:h,maxBodyLength:h,beforeRedirect:h,transport:h,httpAgent:h,httpsAgent:h,cancelToken:h,socketPath:h,responseEncoding:h,validateStatus:m,headers:(v,w,I)=>c(Fz(v),Fz(w),0,!0)};return pt.forEach(Object.keys(Object.assign({},t,r)),(function(v){const w=g[v]||c,I=w(t[v],r[v],v);pt.isUndefined(I)&&w!==m||(s[v]=I)})),s}var Bz=t=>{const r=ny({},t);let s,{data:a,withXSRFToken:c,xsrfHeaderName:d,xsrfCookieName:h,headers:m,auth:g}=r;if(r.headers=m=Kd.from(m),r.url=r8(Vz(r.baseURL,r.url,r.allowAbsoluteUrls),t.params,t.paramsSerializer),g&&m.set("Authorization","Basic "+btoa((g.username||"")+":"+(g.password?unescape(encodeURIComponent(g.password)):""))),pt.isFormData(a)){if(tc.hasStandardBrowserEnv||tc.hasStandardBrowserWebWorkerEnv)m.setContentType(void 0);else if((s=m.getContentType())!==!1){const[v,...w]=s?s.split(";").map((I=>Bo(I).call(I))).filter(Boolean):[];m.setContentType([v||"multipart/form-data",...w].join("; "))}}if(tc.hasStandardBrowserEnv&&(c&&pt.isFunction(c)&&(c=c(r)),c||c!==!1&&Rme(r.url))){const v=d&&h&&Ime.read(h);v&&m.set(d,v)}return r},Ame=typeof XMLHttpRequest<"u"&&function(t){return new mt((function(r,s){const a=Bz(t);let c=a.data;const d=Kd.from(a.headers).normalize();let h,m,g,v,w,{responseType:I,onUploadProgress:A,onDownloadProgress:N}=a;function H(){v&&v(),w&&w(),a.cancelToken&&a.cancelToken.unsubscribe(h),a.signal&&a.signal.removeEventListener("abort",h)}let B=new XMLHttpRequest;function z(){if(!B)return;const Z=Kd.from("getAllResponseHeaders"in B&&B.getAllResponseHeaders());Lz((function(ae){r(ae),H()}),(function(ae){s(ae),H()}),{data:I&&I!=="text"&&I!=="json"?B.response:B.responseText,status:B.status,statusText:B.statusText,headers:Z,config:t,request:B}),B=null}B.open(a.method.toUpperCase(),a.url,!0),B.timeout=a.timeout,"onloadend"in B?B.onloadend=z:B.onreadystatechange=function(){B&&B.readyState===4&&(B.status!==0||B.responseURL&&B.responseURL.indexOf("file:")===0)&&setTimeout(z)},B.onabort=function(){B&&(s(new Er("Request aborted",Er.ECONNABORTED,t,B)),B=null)},B.onerror=function(){s(new Er("Network Error",Er.ERR_NETWORK,t,B)),B=null},B.ontimeout=function(){let Z=a.timeout?"timeout of "+a.timeout+"ms exceeded":"timeout exceeded";const ae=a.transitional||s8;a.timeoutErrorMessage&&(Z=a.timeoutErrorMessage),s(new Er(Z,ae.clarifyTimeoutError?Er.ETIMEDOUT:Er.ECONNABORTED,t,B)),B=null},c===void 0&&d.setContentType(null),"setRequestHeader"in B&&pt.forEach(d.toJSON(),(function(Z,ae){B.setRequestHeader(ae,Z)})),pt.isUndefined(a.withCredentials)||(B.withCredentials=!!a.withCredentials),I&&I!=="json"&&(B.responseType=a.responseType),N&&([g,w]=h1(N,!0),B.addEventListener("progress",g)),A&&B.upload&&([m,v]=h1(A),B.upload.addEventListener("progress",m),B.upload.addEventListener("loadend",v)),(a.cancelToken||a.signal)&&(h=Z=>{B&&(s(!Z||Z.type?new Jv(null,t,B):Z),B.abort(),B=null)},a.cancelToken&&a.cancelToken.subscribe(h),a.signal&&(a.signal.aborted?h():a.signal.addEventListener("abort",h)));const ee=(function(Z){const ae=/^([-+\w]{1,25})(:?\/\/|:)/.exec(Z);return ae&&ae[1]||""})(a.url);ee&&tc.protocols.indexOf(ee)===-1?s(new Er("Unsupported protocol "+ee+":",Er.ERR_BAD_REQUEST,t)):B.send(c||null)}))},Pme=(t,r)=>{const{length:s}=t=t?t.filter(Boolean):[];if(r||s){let a,c=new AbortController;const d=function(v){if(!a){a=!0,m();const w=v instanceof Error?v:this.reason;c.abort(w instanceof Er?w:new Jv(w instanceof Error?w.message:w))}};let h=r&&setTimeout((()=>{h=null,d(new Er("timeout ".concat(r," of ms exceeded"),Er.ETIMEDOUT))}),r);const m=()=>{t&&(h&&clearTimeout(h),h=null,t.forEach((v=>{v.unsubscribe?v.unsubscribe(d):v.removeEventListener("abort",d)})),t=null)};t.forEach((v=>v.addEventListener("abort",d)));const{signal:g}=c;return g.unsubscribe=()=>pt.asap(m),g}},AL=l(A4),zz=$v.f("asyncIterator"),Ome=l(zz);function PL(t,r){this.v=t,this.k=r}function Ql(t){return function(){return new iT(t.apply(this,arguments))}}function iT(t){var r,s;function a(d,h){try{var m=t[d](h),g=m.value,v=g instanceof PL;AL.resolve(v?g.v:g).then((function(w){if(v){var I=d==="return"?"return":"next";if(!g.k||w.done)return a(I,w);w=t[I](w).value}c(m.done?"return":"normal",w)}),(function(w){a("throw",w)}))}catch(w){c("throw",w)}}function c(d,h){switch(d){case"return":r.resolve({value:h,done:!0});break;case"throw":r.reject(h);break;default:r.resolve({value:h,done:!1})}(r=r.next)?a(r.key,r.arg):s=null}this._invoke=function(d,h){return new AL((function(m,g){var v={key:d,arg:h,resolve:m,reject:g,next:null};s?s=s.next=v:(r=s=v,a(d,h))}))},typeof t.return!="function"&&(this.return=void 0)}function zn(t){return new PL(t,0)}function p1(t){var r={},s=!1;function a(c,d){return s=!0,d=new AL((function(h){h(t[c](d))})),{done:!1,value:new PL(d,1)}}return r[Xv!==void 0&&gz||"@@iterator"]=function(){return this},r.next=function(c){return s?(s=!1,c):a("next",c)},typeof t.throw=="function"&&(r.throw=function(c){if(s)throw s=!1,c;return a("throw",c)}),typeof t.return=="function"&&(r.return=function(c){return s?(s=!1,c):a("return",c)}),r}iT.prototype[typeof Xv=="function"&&Ome||"@@asyncIterator"]=function(){return this},iT.prototype.next=function(t){return this._invoke("next",t)},iT.prototype.throw=function(t){return this._invoke("throw",t)},iT.prototype.return=function(t){return this._invoke("return",t)};var OL=l(zz);function kL(t){var r,s,a,c=2;for(typeof Symbol<"u"&&(s=OL,a=Symbol.iterator);c--;){if(s&&(r=t[s])!=null)return r.call(t);if(a&&(r=t[a])!=null)return new f1(r.call(t));s="@@asyncIterator",a="@@iterator"}throw new TypeError("Object is not async iterable")}function f1(t){function r(s){if(Object(s)!==s)return mt.reject(new TypeError(s+" is not an object."));var a=s.done;return mt.resolve(s.value).then((function(c){return{value:c,done:a}}))}return f1=function(s){this.s=s,this.n=s.next},f1.prototype={s:null,n:null,next:function(){return r(this.n.apply(this.s,arguments))},return:function(s){var a=this.s.return;return a===void 0?mt.resolve({value:s,done:!0}):r(a.apply(this.s,arguments))},throw:function(s){var a=this.s.return;return a===void 0?mt.reject(s):r(a.apply(this.s,arguments))}},new f1(t)}const kme=function*(t,r){let s=t.byteLength;if(!r||s<r)return void(yield t);let a,c=0;for(;c<s;)a=c+r,yield t.slice(c,a),c=a},Nme=(function(){var t=Ql((function*(r,s){var a,c=!1,d=!1;try{for(var h,m=kL(xme(r));c=!(h=yield zn(m.next())).done;c=!1){const g=h.value;yield*p1(kL(kme(g,s)))}}catch(g){d=!0,a=g}finally{try{c&&m.return!=null&&(yield zn(m.return()))}finally{if(d)throw a}}}));return function(r,s){return t.apply(this,arguments)}})(),xme=(function(){var t=Ql((function*(r){if(r[OL])return void(yield*p1(kL(r)));const s=r.getReader();try{for(;;){const{done:a,value:c}=yield zn(s.read());if(a)break;yield c}}finally{yield zn(s.cancel())}}));return function(r){return t.apply(this,arguments)}})(),Wz=(t,r,s,a)=>{const c=Nme(t,r);let d,h=0,m=g=>{d||(d=!0,a&&a(g))};return new ReadableStream({async pull(g){try{const{done:v,value:w}=await c.next();if(v)return m(),void g.close();let I=w.byteLength;if(s){let A=h+=I;s(A)}g.enqueue(new Uint8Array(w))}catch(v){throw m(v),v}},cancel:g=>(m(g),c.return())},{highWaterMark:2})};function Gz(t,r){var s=Object.keys(t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);r&&(a=a.filter((function(c){return Object.getOwnPropertyDescriptor(t,c).enumerable}))),s.push.apply(s,a)}return s}function Hz(t){for(var r=1;r<arguments.length;r++){var s=arguments[r]!=null?arguments[r]:{};r%2?Gz(Object(s),!0).forEach((function(a){X(t,a,s[a])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(s)):Gz(Object(s)).forEach((function(a){Object.defineProperty(t,a,Object.getOwnPropertyDescriptor(s,a))}))}return t}const m1=typeof fetch=="function"&&typeof Request=="function"&&typeof Response=="function",$z=m1&&typeof ReadableStream=="function",Dme=m1&&(typeof TextEncoder=="function"?(Kz=new TextEncoder,t=>Kz.encode(t)):async t=>new Uint8Array(await new Response(t).arrayBuffer()));var Kz;const qz=function(t){try{for(var r=arguments.length,s=new Array(r>1?r-1:0),a=1;a<r;a++)s[a-1]=arguments[a];return!!t(...s)}catch{return!1}},Lme=$z&&qz((()=>{let t=!1;const r=new Request(tc.origin,{body:new ReadableStream,method:"POST",get duplex(){return t=!0,"half"}}).headers.has("Content-Type");return t&&!r})),NL=$z&&qz((()=>pt.isReadableStream(new Response("").body))),g1={stream:NL&&(t=>t.body)};var Yz;m1&&(Yz=new Response,["text","arrayBuffer","blob","formData","stream"].forEach((t=>{!g1[t]&&(g1[t]=pt.isFunction(Yz[t])?r=>r[t]():(r,s)=>{throw new Er("Response type '".concat(t,"' is not supported"),Er.ERR_NOT_SUPPORT,s)})})));const Mme=async(t,r)=>{const s=pt.toFiniteNumber(t.getContentLength());return s??(async a=>a==null?0:pt.isBlob(a)?a.size:pt.isSpecCompliantForm(a)?(await new Request(tc.origin,{method:"POST",body:a}).arrayBuffer()).byteLength:pt.isArrayBufferView(a)||pt.isArrayBuffer(a)?a.byteLength:(pt.isURLSearchParams(a)&&(a+=""),pt.isString(a)?(await Dme(a)).byteLength:void 0))(r)};var Ume=m1&&(async t=>{let{url:r,method:s,data:a,signal:c,cancelToken:d,timeout:h,onDownloadProgress:m,onUploadProgress:g,responseType:v,headers:w,withCredentials:I="same-origin",fetchOptions:A}=Bz(t);v=v?(v+"").toLowerCase():"text";let N,H=Pme([c,d&&d.toAbortSignal()],h);const B=H&&H.unsubscribe&&(()=>{H.unsubscribe()});let z;try{if(g&&Lme&&s!=="get"&&s!=="head"&&(z=await Mme(w,a))!==0){let _e,ue=new Request(r,{method:"POST",body:a,duplex:"half"});if(pt.isFormData(a)&&(_e=ue.headers.get("content-type"))&&w.setContentType(_e),ue.body){const[Ae,Ue]=Mz(z,h1(Uz(g)));a=Wz(ue.body,65536,Ae,Ue)}}pt.isString(I)||(I=I?"include":"omit");const ee="credentials"in Request.prototype;N=new Request(r,Hz(Hz({},A),{},{signal:H,method:s.toUpperCase(),headers:w.normalize().toJSON(),body:a,duplex:"half",credentials:ee?I:void 0}));let Z=await fetch(N);const ae=NL&&(v==="stream"||v==="response");if(NL&&(m||ae&&B)){const _e={};["status","statusText","headers"].forEach((We=>{_e[We]=Z[We]}));const ue=pt.toFiniteNumber(Z.headers.get("content-length")),[Ae,Ue]=m&&Mz(ue,h1(Uz(m),!0))||[];Z=new Response(Wz(Z.body,65536,Ae,(()=>{Ue&&Ue(),B&&B()})),_e)}v=v||"text";let ye=await g1[pt.findKey(g1,v)||"text"](Z,t);return!ae&&B&&B(),await new mt(((_e,ue)=>{Lz(_e,ue,{data:ye,headers:Kd.from(Z.headers),status:Z.status,statusText:Z.statusText,config:t,request:N})}))}catch(ee){throw B&&B(),ee&&ee.name==="TypeError"&&/Load failed|fetch/i.test(ee.message)?Object.assign(new Er("Network Error",Er.ERR_NETWORK,t,N),{cause:ee.cause||ee}):Er.from(ee,ee&&ee.code,t,N)}});const xL={http:null,xhr:Ame,fetch:Ume};pt.forEach(xL,((t,r)=>{if(t){try{Object.defineProperty(t,"name",{value:r})}catch{}Object.defineProperty(t,"adapterName",{value:r})}}));const Xz=t=>"- ".concat(t),Vme=t=>pt.isFunction(t)||t===null||t===!1;var Jz={getAdapter:t=>{t=pt.isArray(t)?t:[t];const{length:r}=t;let s,a;const c={};for(let d=0;d<r;d++){let h;if(s=t[d],a=s,!Vme(s)&&(a=xL[(h=String(s)).toLowerCase()],a===void 0))throw new Er("Unknown adapter '".concat(h,"'"));if(a)break;c[h||"#"+d]=a}if(!a){const d=Object.entries(c).map((h=>{let[m,g]=h;return"adapter ".concat(m," ")+(g===!1?"is not supported by the environment":"is not available in the build")}));throw new Er("There is no suitable adapter to dispatch the request "+(r?d.length>1?`since :
`+d.map(Xz).join(`
`):" "+Xz(d[0]):"as no adapter specified"),"ERR_NOT_SUPPORT")}return a},adapters:xL};function DL(t){if(t.cancelToken&&t.cancelToken.throwIfRequested(),t.signal&&t.signal.aborted)throw new Jv(null,t)}function Qz(t){return DL(t),t.headers=Kd.from(t.headers),t.data=IL.call(t,t.transformRequest),["post","put","patch"].indexOf(t.method)!==-1&&t.headers.setContentType("application/x-www-form-urlencoded",!1),Jz.getAdapter(t.adapter||CL.adapter)(t).then((function(r){return DL(t),r.data=IL.call(t,t.transformResponse,r),r.headers=Kd.from(r.headers),r}),(function(r){return Dz(r)||(DL(t),r&&r.response&&(r.response.data=IL.call(t,t.transformResponse,r.response),r.response.headers=Kd.from(r.response.headers))),mt.reject(r)}))}const Zz="1.9.0",_1={};["object","boolean","number","function","string","symbol"].forEach(((t,r)=>{_1[t]=function(s){return typeof s===t||"a"+(r<1?"n ":" ")+t}}));const e9={};_1.transitional=function(t,r,s){function a(c,d){return"[Axios v"+Zz+"] Transitional option '"+c+"'"+d+(s?". "+s:"")}return(c,d,h)=>{if(t===!1)throw new Er(a(d," has been removed"+(r?" in "+r:"")),Er.ERR_DEPRECATED);return r&&!e9[d]&&(e9[d]=!0,console.warn(a(d," has been deprecated since v"+r+" and will be removed in the near future"))),!t||t(c,d,h)}},_1.spelling=function(t){return(r,s)=>(console.warn("".concat(s," is likely a misspelling of ").concat(t)),!0)};var y1={assertOptions:function(t,r,s){if(typeof t!="object")throw new Er("options must be an object",Er.ERR_BAD_OPTION_VALUE);const a=Object.keys(t);let c=a.length;for(;c-- >0;){const d=a[c],h=r[d];if(h){const m=t[d],g=m===void 0||h(m,d,t);if(g!==!0)throw new Er("option "+d+" must be "+g,Er.ERR_BAD_OPTION_VALUE)}else if(s!==!0)throw new Er("Unknown option "+d,Er.ERR_BAD_OPTION)}},validators:_1};const rp=y1.validators;let E1=class{constructor(t){this.defaults=t||{},this.interceptors={request:new i8,response:new i8}}async request(t,r){try{return await this._request(t,r)}catch(s){if(s instanceof Error){let a={};Error.captureStackTrace?Error.captureStackTrace(a):a=new Error;const c=a.stack?a.stack.replace(/^.+\n/,""):"";try{s.stack?c&&!String(s.stack).endsWith(c.replace(/^.+\n.+\n/,""))&&(s.stack+=`
`+c):s.stack=c}catch{}}throw s}}_request(t,r){typeof t=="string"?(r=r||{}).url=t:r=t||{},r=ny(this.defaults,r);const{transitional:s,paramsSerializer:a,headers:c}=r;s!==void 0&&y1.assertOptions(s,{silentJSONParsing:rp.transitional(rp.boolean),forcedJSONParsing:rp.transitional(rp.boolean),clarifyTimeoutError:rp.transitional(rp.boolean)},!1),a!=null&&(pt.isFunction(a)?r.paramsSerializer={serialize:a}:y1.assertOptions(a,{encode:rp.function,serialize:rp.function},!0)),r.allowAbsoluteUrls!==void 0||(this.defaults.allowAbsoluteUrls!==void 0?r.allowAbsoluteUrls=this.defaults.allowAbsoluteUrls:r.allowAbsoluteUrls=!0),y1.assertOptions(r,{baseUrl:rp.spelling("baseURL"),withXsrfToken:rp.spelling("withXSRFToken")},!0),r.method=(r.method||this.defaults.method||"get").toLowerCase();let d=c&&pt.merge(c.common,c[r.method]);c&&pt.forEach(["delete","get","head","post","put","patch","common"],(N=>{delete c[N]})),r.headers=Kd.concat(d,c);const h=[];let m=!0;this.interceptors.request.forEach((function(N){typeof N.runWhen=="function"&&N.runWhen(r)===!1||(m=m&&N.synchronous,h.unshift(N.fulfilled,N.rejected))}));const g=[];let v;this.interceptors.response.forEach((function(N){g.push(N.fulfilled,N.rejected)}));let w,I=0;if(!m){const N=[Qz.bind(this),void 0];for(N.unshift.apply(N,h),N.push.apply(N,g),w=N.length,v=mt.resolve(r);I<w;)v=v.then(N[I++],N[I++]);return v}w=h.length;let A=r;for(I=0;I<w;){const N=h[I++],H=h[I++];try{A=N(A)}catch(B){H.call(this,B);break}}try{v=Qz.call(this,A)}catch(N){return mt.reject(N)}for(I=0,w=g.length;I<w;)v=v.then(g[I++],g[I++]);return v}getUri(t){return r8(Vz((t=ny(this.defaults,t)).baseURL,t.url,t.allowAbsoluteUrls),t.params,t.paramsSerializer)}};pt.forEach(["delete","get","head","options"],(function(t){E1.prototype[t]=function(r,s){return this.request(ny(s||{},{method:t,url:r,data:(s||{}).data}))}})),pt.forEach(["post","put","patch"],(function(t){function r(s){return function(a,c,d){return this.request(ny(d||{},{method:t,headers:s?{"Content-Type":"multipart/form-data"}:{},url:a,data:c}))}}E1.prototype[t]=r(),E1.prototype[t+"Form"]=r(!0)}));var v1=E1;class LL{constructor(r){if(typeof r!="function")throw new TypeError("executor must be a function.");let s;this.promise=new mt((function(c){s=c}));const a=this;this.promise.then((c=>{if(!a._listeners)return;let d=a._listeners.length;for(;d-- >0;)a._listeners[d](c);a._listeners=null})),this.promise.then=c=>{let d;const h=new mt((m=>{a.subscribe(m),d=m})).then(c);return h.cancel=function(){a.unsubscribe(d)},h},r((function(c,d,h){a.reason||(a.reason=new Jv(c,d,h),s(a.reason))}))}throwIfRequested(){if(this.reason)throw this.reason}subscribe(r){this.reason?r(this.reason):this._listeners?this._listeners.push(r):this._listeners=[r]}unsubscribe(r){if(!this._listeners)return;const s=this._listeners.indexOf(r);s!==-1&&this._listeners.splice(s,1)}toAbortSignal(){const r=new AbortController,s=a=>{r.abort(a)};return this.subscribe(s),r.signal.unsubscribe=()=>this.unsubscribe(s),r.signal}static source(){let r;return{token:new LL((function(a){r=a})),cancel:r}}}var jme=LL;const ML={Continue:100,SwitchingProtocols:101,Processing:102,EarlyHints:103,Ok:200,Created:201,Accepted:202,NonAuthoritativeInformation:203,NoContent:204,ResetContent:205,PartialContent:206,MultiStatus:207,AlreadyReported:208,ImUsed:226,MultipleChoices:300,MovedPermanently:301,Found:302,SeeOther:303,NotModified:304,UseProxy:305,Unused:306,TemporaryRedirect:307,PermanentRedirect:308,BadRequest:400,Unauthorized:401,PaymentRequired:402,Forbidden:403,NotFound:404,MethodNotAllowed:405,NotAcceptable:406,ProxyAuthenticationRequired:407,RequestTimeout:408,Conflict:409,Gone:410,LengthRequired:411,PreconditionFailed:412,PayloadTooLarge:413,UriTooLong:414,UnsupportedMediaType:415,RangeNotSatisfiable:416,ExpectationFailed:417,ImATeapot:418,MisdirectedRequest:421,UnprocessableEntity:422,Locked:423,FailedDependency:424,TooEarly:425,UpgradeRequired:426,PreconditionRequired:428,TooManyRequests:429,RequestHeaderFieldsTooLarge:431,UnavailableForLegalReasons:451,InternalServerError:500,NotImplemented:501,BadGateway:502,ServiceUnavailable:503,GatewayTimeout:504,HttpVersionNotSupported:505,VariantAlsoNegotiates:506,InsufficientStorage:507,LoopDetected:508,NotExtended:510,NetworkAuthenticationRequired:511};Object.entries(ML).forEach((t=>{let[r,s]=t;ML[s]=r}));var Fme=ML;const wo=(function t(r){const s=new v1(r),a=FB(v1.prototype.request,s);return pt.extend(a,v1.prototype,s,{allOwnKeys:!0}),pt.extend(a,s,null,{allOwnKeys:!0}),a.create=function(c){return t(ny(r,c))},a})(CL);wo.Axios=v1,wo.CanceledError=Jv,wo.CancelToken=jme,wo.isCancel=Dz,wo.VERSION=Zz,wo.toFormData=ZA,wo.AxiosError=Er,wo.Cancel=wo.CanceledError,wo.all=function(t){return mt.all(t)},wo.spread=function(t){return function(r){return t.apply(null,r)}},wo.isAxiosError=function(t){return pt.isObject(t)&&t.isAxiosError===!0},wo.mergeConfig=ny,wo.AxiosHeaders=Kd,wo.formToJSON=t=>Nz(pt.isHTMLForm(t)?new FormData(t):t),wo.getAdapter=Jz.getAdapter,wo.HttpStatusCode=Fme,wo.default=wo;var Na=wo;const Bme=()=>{};function sT(){const t={promise:void 0,isResolved:!1,isRejected:!1,isFinished:!1,resolve:void 0,reject:void 0,cancel:Bme};return t.promise=new mt(((r,s)=>{t.resolve=a=>{t.isFinished||(t.isResolved=!0,t.isFinished=!0,r(a),t.value=a)},t.reject=a=>{t.isFinished||(t.isRejected=!0,t.isFinished=!0,s(a))}})),t}const S1=new Map,b1=new Map,ip=new Map;let os=(function(t){return t.WIN_10="Windows 10",t.WIN_81="Windows 8.1",t.WIN_8="Windows 8",t.WIN_7="Windows 7",t.WIN_VISTA="Windows Vista",t.WIN_SERVER_2003="Windows Server 2003",t.WIN_XP="Windows XP",t.WIN_2000="Windows 2000",t.ANDROID="Android",t.HARMONY_OS="HarmonyOS",t.OPEN_BSD="Open BSD",t.SUN_OS="Sun OS",t.LINUX="Linux",t.IOS="iOS",t.MAC_OS="Mac OS",t.CHROMIUM_OS="Chromium OS",t.QNX="QNX",t.UNIX="UNIX",t.BEOS="BeOS",t.OS_2="OS/2",t.SEARCH_BOT="Search Bot",t})({}),Yn=(function(t){return t.CHROME="Chrome",t.SAFARI="Safari",t.EDGE="Edge",t.FIREFOX="Firefox",t.OPERA="OPR",t.QQ="QQBrowser",t.WECHAT="MicroMessenger",t})({});const t9=new _he;let qd=t9.getResult(),UL=null;function Mn(t){if(!UL){qd=t9.getResult();const r=(function(m){if(m.engine.name==="Blink"&&m.browser.name!=="WeChat")return Yn.CHROME;switch(m.browser.name){case"Chrome Headless":case"Chrome":case"Chromium":return Yn.CHROME;case"Safari":case"Mobile Safari":return Yn.SAFARI;case"Edge":return Yn.EDGE;case"Firefox":return Yn.FIREFOX;case"QQ":case"QQBrowser":return Yn.QQ;case"Opera":return Yn.OPERA;case"WeChat":return Yn.WECHAT;default:return m.browser.name||""}})(qd),s=n9(qd),a=(function(m){return m.os.name==="Windows"?m.os.version?m.os.name+" "+m.os.version:m.os.name:m.os.name||""})(qd),c=qd.os.version,d=n9(qd,!1),h=qd.device.type;if(!(r&&s&&a&&c))return{name:r,version:s,os:a,osVersion:c,browserVersion:d,deviceType:h};UL={name:r,version:s,os:a,osVersion:c,browserVersion:d,deviceType:h}}return UL}function n9(t){let r,s=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1];return r=t.engine.name==="Blink"?t.engine.version||"":t.browser.version||"",s?r.split(".")[0]:r}function w1(){return Mn().os}function r9(){const t=Mn();return"".concat(t.os," ").concat(t.osVersion)}function T1(){const t=Mn();return!!(qd.engine.name==="WebKit"&&t.os===os.MAC_OS&&navigator.maxTouchPoints&&navigator.maxTouchPoints>0&&t.name!==Yn.SAFARI||To()&&t.name!==Yn.SAFARI)}function Ef(){return Mn().name===Yn.CHROME}function Fs(){return Mn().name===Yn.SAFARI}function i9(){const t=Mn();if(t.name!==Yn.SAFARI||!t.browserVersion)return!1;const r=t.browserVersion.split(".");return Number(r[0])>15||Number(r[0])===15&&Number(r[1])>=4}function s9(){return Mn().name===Yn.EDGE}function ii(){return Mn().name===Yn.FIREFOX}function To(){return Mn().os===os.IOS}function Qv(t){const r=Mn();return!(r.name!==Yn.CHROME||!r.osVersion)&&Number(r.version)>=t}function o9(t){const r=Mn();return!(r.name!==Yn.CHROME||!r.osVersion)&&Number(r.version)<t}function VL(t,r,s){const a=Mn();return!(a.name!==t||!a.osVersion)&&(s?Number(a.version)>=r&&Number(a.version)<=s:Number(a.version)===r)}function jL(t){const r=Mn();return!(r.name!==Yn.EDGE||!r.osVersion)&&Number(r.version)>=t}function FL(t){const r=Mn();return!(r.name!==Yn.FIREFOX||!r.osVersion)&&Number(r.version)>=t}function a9(t){const r=Mn();return!(r.name!==Yn.SAFARI||!r.osVersion)&&Number(r.version)>=t}function c9(t,r,s){const a=Mn();if(a.os!==os.IOS||!a.osVersion)return!1;const c=a.osVersion.split(".");return s?r&&Number(c[0])===t&&Number(c[1])>r||Number(c[0])>t:r?Number(c[0])===t&&Number(c[1])>=r||Number(c[0])>t:Number(c[0])>=t}function l9(t,r,s){const a=Mn();if(a.os!==os.IOS||!a.osVersion)return!1;const c=a.osVersion.split(".");return r&&Number(c[0])===t&&Number(c[1])<r||Number(c[0])<t}function BL(t,r,s){const a=Mn();if(a.name!==Yn.SAFARI||!a.osVersion||!a.browserVersion)return!1;const c=a.browserVersion.split(".");return s?r&&Number(c[0])===t&&Number(c[1])<r||Number(c[0])<t:r?Number(c[0])===t&&Number(c[1])<=r||Number(c[0])<t:Number(c[0])<=t}function zL(t){const r=Mn();return!(r.name!==Yn.OPERA||!r.osVersion)&&Number(r.version)>=t}function u9(){const t=Mn();if(t.os!==os.IOS||!t.osVersion)return!1;const r=t.osVersion.split(".");return Number(r[0])<14||Number(r[0])===14&&Number(r[1])<=6}function Zv(){const t=Mn();if(t.os!==os.IOS||!t.osVersion)return!1;const r=t.osVersion.split(".");return Number(r[0])===15}function WL(){const t=Mn();if(t.os!==os.IOS||!t.osVersion)return!1;const r=t.osVersion.split(".");return Number(r[0])===16}function d9(){const t=Mn();if(t.os!==os.IOS||!t.osVersion)return!1;const r=t.osVersion.split(".");return Number(r[0])===15&&Number(r[1])>=1}function Hu(){return Fs()&&navigator.maxTouchPoints>0}function h9(){return Mn().name===Yn.WECHAT}function p9(){return window.navigator.appVersion&&window.navigator.appVersion.match(/Chrome\/([\w\W]*?)\./)!==null&&window.navigator.appVersion.match(/Chrome\/([\w\W]*?)\./)[1]<=35}function GL(){const t=w1();return(function(){const{deviceType:r}=Mn();return r==="mobile"||r==="tablet"})()||t===os.ANDROID||t===os.IOS||t===os.HARMONY_OS}function vf(){const t=Mn();return t.name!==Yn.EDGE&&t.name!==Yn.SAFARI&&!!navigator.userAgent.toLocaleLowerCase().match(/chrome\/[\d]./i)}function C1(){return w1()===os.ANDROID}function oT(){const t=Mn();return C1()&&(t.name===Yn.CHROME||t.name===Yn.WECHAT||/chrome|chromium/i.test(navigator.userAgent))}function nn(t,r,s){return(r=(function(a){var c=(function(d,h){if(typeof d!="object"||!d)return d;var m=d[Symbol.toPrimitive];if(m!==void 0){var g=m.call(d,"string");if(typeof g!="object")return g;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(d)})(a);return typeof c=="symbol"?c:c+""})(r))in t?Object.defineProperty(t,r,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[r]=s,t}function f9(t,r){var s=Object.keys(t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);r&&(a=a.filter((function(c){return Object.getOwnPropertyDescriptor(t,c).enumerable}))),s.push.apply(s,a)}return s}function et(t){for(var r=1;r<arguments.length;r++){var s=arguments[r]!=null?arguments[r]:{};r%2?f9(Object(s),!0).forEach((function(a){nn(t,a,s[a])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(s)):f9(Object(s)).forEach((function(a){Object.defineProperty(t,a,Object.getOwnPropertyDescriptor(s,a))}))}return t}let te=(function(t){return t.UNEXPECTED_ERROR="UNEXPECTED_ERROR",t.UNEXPECTED_RESPONSE="UNEXPECTED_RESPONSE",t.TIMEOUT="TIMEOUT",t.INVALID_PARAMS="INVALID_PARAMS",t.NOT_READABLE="NOT_READABLE",t.NOT_SUPPORTED="NOT_SUPPORTED",t.INVALID_OPERATION="INVALID_OPERATION",t.OPERATION_ABORTED="OPERATION_ABORTED",t.WEB_SECURITY_RESTRICT="WEB_SECURITY_RESTRICT",t.EXCHANGE_SDP_FAILED="EXCHANGE_SDP_FAILED",t.ADD_CANDIDATE_FAILED="ADD_CANDIDATE_FAILED",t.DATACHANNEL_FAILED="DATACHANNEL_FAILED",t.NETWORK_ERROR="NETWORK_ERROR",t.NETWORK_TIMEOUT="NETWORK_TIMEOUT",t.NETWORK_RESPONSE_ERROR="NETWORK_RESPONSE_ERROR",t.API_INVOKE_TIMEOUT="API_INVOKE_TIMEOUT",t.ENUMERATE_DEVICES_FAILED="ENUMERATE_DEVICES_FAILED",t.DEVICE_NOT_FOUND="DEVICE_NOT_FOUND",t.ELECTRON_IS_NULL="ELECTRON_IS_NULL",t.ELECTRON_DESKTOP_CAPTURER_GET_SOURCES_ERROR="ELECTRON_DESKTOP_CAPTURER_GET_SOURCES_ERROR",t.CHROME_PLUGIN_NO_RESPONSE="CHROME_PLUGIN_NO_RESPONSE",t.CHROME_PLUGIN_NOT_INSTALL="CHROME_PLUGIN_NOT_INSTALL",t.MEDIA_OPTION_INVALID="MEDIA_OPTION_INVALID",t.PERMISSION_DENIED="PERMISSION_DENIED",t.CONSTRAINT_NOT_SATISFIED="CONSTRAINT_NOT_SATISFIED",t.TRACK_IS_DISABLED="TRACK_IS_DISABLED",t.GET_VIDEO_ELEMENT_VISIBLE_ERROR="GET_VIDEO_ELEMENT_VISIBLE_ERROR",t.SHARE_AUDIO_NOT_ALLOWED="SHARE_AUDIO_NOT_ALLOWED",t.LOW_STREAM_ENCODING_ERROR="LOW_STREAM_ENCODING_ERROR",t.SET_ENCODING_PARAMETER_ERROR="SET_ENCODING_PARAMETER_ERROR",t.TRACK_STATE_UNREACHABLE="TRACK_STATE_UNREACHABLE",t.INVALID_UINT_UID_FROM_STRING_UID="INVALID_UINT_UID_FROM_STRING_UID",t.CAN_NOT_GET_PROXY_SERVER="CAN_NOT_GET_PROXY_SERVER",t.CAN_NOT_GET_GATEWAY_SERVER="CAN_NOT_GET_GATEWAY_SERVER",t.VOID_GATEWAY_ADDRESS="VOID_GATEWAY_ADDRESS",t.UID_CONFLICT="UID_CONFLICT",t.MULTI_UNILBS_RESPONSE_ERROR="MULTI_UNILBS_RESPONSE_ERROR",t.UPDATE_TICKET_FAILED="UPDATE_TICKET_FAILED",t.TOKEN_EXPIRE="TOKEN_EXPIRE",t.INVALID_LOCAL_TRACK="INVALID_LOCAL_TRACK",t.INVALID_TRACK="INVALID_TRACK",t.SENDER_NOT_FOUND="SENDER_NOT_FOUND",t.CREATE_OFFER_FAILED="CREATE_OFFER_FAILED",t.SET_ANSWER_FAILED="SET_ANSWER_FAILED",t.ICE_FAILED="ICE_FAILED",t.PC_CLOSED="PC_CLOSED",t.SENDER_REPLACE_FAILED="SENDER_REPLACE_FAILED",t.GET_LOCAL_CAPABILITIES_FAILED="GET_LOCAL_CAPABILITIES_FAILED",t.GET_LOCAL_CONNECTION_PARAMS_FAILED="GET_LOCAL_CONNECTION_PARAMS_FAILED",t.SUBSCRIBE_FAILED="SUBSCRIBE_FAILED",t.UNSUBSCRIBE_FAILED="UNSUBSCRIBE_FAILED",t.GATEWAY_P2P_LOST="GATEWAY_P2P_LOST",t.NO_ICE_CANDIDATE="NO_ICE_CANDIDATE",t.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS="CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS",t.EXIST_DISABLED_VIDEO_TRACK="EXIST_DISABLED_VIDEO_TRACK",t.INVALID_REMOTE_USER="INVALID_REMOTE_USER",t.REMOTE_USER_IS_NOT_PUBLISHED="REMOTE_USER_IS_NOT_PUBLISHED",t.CUSTOM_REPORT_SEND_FAILED="CUSTOM_REPORT_SEND_FAILED",t.CUSTOM_REPORT_FREQUENCY_TOO_HIGH="CUSTOM_REPORT_FREQUENCY_TOO_HIGH",t.FETCH_AUDIO_FILE_FAILED="FETCH_AUDIO_FILE_FAILED",t.READ_LOCAL_AUDIO_FILE_ERROR="READ_LOCAL_AUDIO_FILE_ERROR",t.DECODE_AUDIO_FILE_FAILED="DECODE_AUDIO_FILE_FAILED",t.WS_ABORT="WS_ABORT",t.WS_DISCONNECT="WS_DISCONNECT",t.WS_ERR="WS_ERR",t.EXTERNAL_SIGNAL_ABORT="EXTERNAL_SIGNAL_ABORT",t.LIVE_STREAMING_TASK_CONFLICT="LIVE_STREAMING_TASK_CONFLICT",t.LIVE_STREAMING_INVALID_ARGUMENT="LIVE_STREAMING_INVALID_ARGUMENT",t.LIVE_STREAMING_INTERNAL_SERVER_ERROR="LIVE_STREAMING_INTERNAL_SERVER_ERROR",t.LIVE_STREAMING_PUBLISH_STREAM_NOT_AUTHORIZED="LIVE_STREAMING_PUBLISH_STREAM_NOT_AUTHORIZED",t.LIVE_STREAMING_TRANSCODING_NOT_SUPPORTED="LIVE_STREAMING_TRANSCODING_NOT_SUPPORTED",t.LIVE_STREAMING_CDN_ERROR="LIVE_STREAMING_CDN_ERROR",t.LIVE_STREAMING_INVALID_RAW_STREAM="LIVE_STREAMING_INVALID_RAW_STREAM",t.LIVE_STREAMING_WARN_STREAM_NUM_REACH_LIMIT="LIVE_STREAMING_WARN_STREAM_NUM_REACH_LIMIT",t.LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE="LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE",t.LIVE_STREAMING_WARN_FREQUENT_REQUEST="LIVE_STREAMING_WARN_FREQUENT_REQUEST",t.WEBGL_INTERNAL_ERROR="WEBGL_INTERNAL_ERROR",t.BEAUTY_PROCESSOR_INTERNAL_ERROR="BEAUTY_PROCESSOR_INTERNAL_ERROR",t.CROSS_CHANNEL_WAIT_STATUS_ERROR="CROSS_CHANNEL_WAIT_STATUS_ERROR",t.CROSS_CHANNEL_FAILED_JOIN_SRC="CROSS_CHANNEL_FAILED_JOIN_SEC",t.CROSS_CHANNEL_FAILED_JOIN_DEST="CROSS_CHANNEL_FAILED_JOIN_DEST",t.CROSS_CHANNEL_FAILED_PACKET_SENT_TO_DEST="CROSS_CHANNEL_FAILED_PACKET_SENT_TO_DEST",t.CROSS_CHANNEL_SERVER_ERROR_RESPONSE="CROSS_CHANNEL_SERVER_ERROR_RESPONSE",t.METADATA_OUT_OF_RANGE="METADATA_OUT_OF_RANGE",t.LOCAL_AEC_ERROR="LOCAL_AEC_ERROR",t.INVALID_PLUGIN="INVALID_PLUGIN",t.DISCONNECT_P2P="DISCONNECT_P2P",t.CONVERTING_IMAGEDATA_TO_BLOB_FAILED="CONVERTING_IMAGEDATA_TO_BLOB_FAILED",t.CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED="CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED",t.INIT_DATACHANNEL_TIMEOUT="INIT_DATACHANNEL_TIMEOUT",t.CREATE_DATACHANNEL_ERROR="CREATE_DATACHANNEL_ERROR",t.DATACHANNEL_CONNECTION_TIMEOUT="DATACHANNEL_CONNECTION_TIMEOUT",t.PROHIBITED_OPERATION="PROHIBITED_OPERATION",t.IMAGE_MODERATION_UPLOAD_FAILED="IMAGE_MODERATION_UPLOAD_FAILED",t.P2P_MESSAGE_FAILED="P2P_MESSAGE_FAILED",t})({}),Le=class extends Error{constructor(t){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"",s=arguments.length>2?arguments[2]:void 0;super(r),nn(this,"code",void 0),nn(this,"message",void 0),nn(this,"data",void 0),nn(this,"name","AgoraRTCException"),this.code=t,this.message="AgoraRTCError ".concat(this.code,": ").concat(r),this.data=s}toString(){return this.data?"".concat(this.message,`
data: `).concat(JSON.stringify(this.data)):this.message}print(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"error",r=arguments.length>1?arguments[1]:void 0;return t==="error"&&(r||console).error(this.toString()),t==="warning"&&(r||console).warn(this.toString()),this}throw(t){throw this.print("error",t),this}};function Yd(t,r){if(typeof t!="boolean")throw new Le(te.INVALID_PARAMS,"Invalid ".concat(r,": The value is of the boolean type."))}function Zi(t,r,s){if(!rt(s).call(s,t))throw new Le(te.INVALID_PARAMS,"".concat(r," can only be set as ").concat(JSON.stringify(s)))}function vr(t,r){let s=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1,a=arguments.length>3&&arguments[3]!==void 0?arguments[3]:1e4;if(t<s||t>a||(!(arguments.length>4&&arguments[4]!==void 0)||arguments[4])&&!(function(c){return typeof c=="number"&&c%1==0})(t))throw new Le(te.INVALID_PARAMS,"invalid ".concat(r,": the value range is [").concat(s,", ").concat(a,"]. integer only"))}function HL(t,r){if(typeof t!="number"){if(!(t.min||t.max||t.ideal||t.exact))throw new Le(te.INVALID_PARAMS,"".concat(r," is not a valid ConstrainLong"));t.min!==void 0&&vr(t.min,"".concat(r,".min"),0,1/0),t.max!==void 0&&vr(t.max,"".concat(r,".max"),1,1/0),t.exact!==void 0&&vr(t.exact,"".concat(r,".exact"),1,1/0),t.ideal!==void 0&&vr(t.ideal,"".concat(r,".ideal"),1,1/0)}else vr(t,r,1,1/0)}function Rs(t,r){let s=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1,a=arguments.length>3&&arguments[3]!==void 0?arguments[3]:255,c=!(arguments.length>4&&arguments[4]!==void 0)||arguments[4];if(t==null)throw new Le(te.INVALID_PARAMS,"".concat(r||"param"," cannot be empty"));if(!m9(t,s,a,c))throw new Le(te.INVALID_PARAMS,"Invalid ".concat(r||"string param",": Length of the string: [").concat(s,",").concat(a,"].").concat(c?" ASCII characters only.":""))}function Sf(t,r){if(!Array.isArray(t))throw new Le(te.INVALID_PARAMS,"".concat(r," should be an array"))}function si(t){return t==null}function m9(t){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1,s=arguments.length>2&&arguments[2]!==void 0?arguments[2]:255,a=!(arguments.length>3&&arguments[3]!==void 0)||arguments[3];return typeof t=="string"&&t.length<=s&&t.length>=r&&(!a||(function(c){if(typeof c!="string")return!1;for(let d=0;d<c.length;d+=1){const h=c.charCodeAt(d);if(h<0||h>255)return!1}return!0})(t))}var aT=(function(t){return t.COVERED="COVERED",t.POSITION="POSITION",t.SIZE="SIZE",t.STYLE="STYLE",t})(aT||{}),$L=(function(t){return t.UNMOUNTED="UNMOUNTED",t.INVALID_HTML_ELEMENT="INVALID_HTML_ELEMENT",t})($L||{});const g9=new class{constructor(){nn(this,"_clientSize",null),nn(this,"getClientWidth",(()=>document.documentElement?document.documentElement.clientWidth:document.body.clientWidth)),nn(this,"getClientHeight",(()=>document.documentElement?document.documentElement.clientHeight:document.body.clientHeight)),nn(this,"getStyle",(t=>window.getComputedStyle(t,null))),nn(this,"checkCssVisibleProperty",(t=>{var r;let s=!0;const a=this.getStyle(t),{display:c,visibility:d,opacity:h,filter:m}=a;return(c==="none"||rt(r=["hidden","collapse"]).call(r,d)||Number(h)<.1)&&(s=!1),!!s&&(m&&m.split(" ").filter((g=>{var v;const w=g.split("(")[0];return rt(v=["brightness","blur","opacity"]).call(v,w)})).map((g=>{const[v,w]=g.split(/\(|\)/);return[v,Number(w.match(/^[0-9\.]+/))]})).forEach((g=>{const[v,w]=g;switch(v){case"brightness":(w<.1||w>3)&&(s=!1);break;case"blur":w>3&&(s=!1);break;case"opacity":w<.1&&(s=!1)}})),s)})),nn(this,"checkPropertyUpToAllParentNodes",((t,r)=>{let s=!0,a=!0;const c=h=>r(h);let d=t;for(;d&&a;)c(d)||(s=!1,a=!1),d=d.parentElement,d||(a=!1);return s})),nn(this,"checkActualCssVisibleIncludeInherit",(t=>this.checkPropertyUpToAllParentNodes(t,this.checkCssVisibleProperty))),nn(this,"getSizeAboutClient",(t=>{const{width:r,height:s,left:a,right:c,top:d,bottom:h}=t.getBoundingClientRect(),m=this.getClientWidth(),g=this.getClientHeight();return{width:r,height:s,left:a,right:c,top:d,bottom:h,clientWidth:m,clientHeight:g,clientMin:Math.min(m,g)}})),nn(this,"checkActualSize",(()=>{const{width:t,height:r,clientMin:s}=this._clientSize;return this.checkSizeIsVisible(t,r,s)})),nn(this,"elementFromPoint",((t,r)=>document.elementFromPoint?document.elementFromPoint(t,r):null)),nn(this,"checkCoverForAPoint",((t,r,s)=>{const a=this.elementFromPoint(t,r);return a!==null&&a!==s})),nn(this,"getPointPositionList",(()=>{const{width:t,height:r,left:s,top:a}=this._clientSize,c=t/6,d=r/6,h=[],m=10**6;for(let g=0;g<5;g++)for(let v=0;v<5;v++){const w=(s*m+(g===0?.1:g===4?(c*g*m-1e5)/m:c*g)*m)/m,I=(a*m+(v===0?.1:v===4?(d*v*m-1e5)/m:d*v)*m)/m;h.push({x:w,y:I})}return[...h]})),nn(this,"checkElementCover",(t=>this.getPointPositionList().map((r=>this.checkCoverForAPoint(r.x,r.y,t))).filter((r=>!!r)).length>6)),nn(this,"checkSizeIsVisible",((t,r,s)=>(t>50||s/t<=10)&&(r>50||s/r<=10))),nn(this,"checkSizeOfPartInClient",(()=>{const{left:t,right:r,top:s,bottom:a,clientHeight:c,clientWidth:d,clientMin:h}=this._clientSize;let m,g,v,w;if(t<0)m=0;else{if(!(t<d))return!1;m=t}if(r<0)return!1;if(g=r<d?r:d,s<0)v=0;else{if(!(s<c))return!1;v=s}if(a<0)return!1;w=a<c?a:c;const I=g-m,A=w-v;return this.checkSizeIsVisible(I,A,h)})),nn(this,"returnHiddenResult",(t=>(this._clientSize=null,{visible:!1,reason:t}))),nn(this,"checkOneElementVisible",(t=>{if(t instanceof HTMLElement){if(this.checkElementIsMountedOnDom(t)){if(this.checkActualCssVisibleIncludeInherit(t)){if(this._clientSize=this.getSizeAboutClient(t),this.checkElementCover(t))return this.returnHiddenResult(aT.COVERED);{const r=this.checkActualSize(),s=this.checkSizeOfPartInClient();return r&&!s?this.returnHiddenResult(aT.POSITION):r?(this._clientSize=null,{visible:!0}):this.returnHiddenResult(aT.SIZE)}}return this.returnHiddenResult(aT.STYLE)}return this.returnHiddenResult($L.UNMOUNTED)}return this.returnHiddenResult($L.INVALID_HTML_ELEMENT)})),nn(this,"checkElementIsMountedOnDom",(t=>this.checkPropertyUpToAllParentNodes(t,(r=>r.nodeName.toUpperCase()!=="HTML"?r.parentElement!==null:!!document.documentElement))))}};function KL(t){return new TextEncoder().encode(t)}const _9=function(t,r){const s=new Uint8Array(t.byteLength+r.byteLength);return s.set(new Uint8Array(t),0),s.set(new Uint8Array(r),t.byteLength),s},qL=async t=>(function(r,s){let a="";return new Uint8Array(r).forEach((c=>{a+=c.toString(s).padStart(2,"0")})),a})(await crypto.subtle.digest("SHA-256",KL(t)),16);class Zr{constructor(){nn(this,"_events",{}),nn(this,"addListener",this.on)}getListeners(r){return this._events[r]?this._events[r].map((s=>s.listener)):[]}on(r,s){this._events[r]||(this._events[r]=[]);const a=this._events[r];this._indexOfListener(a,s)===-1&&a.push({listener:s,once:!1})}once(r,s){this._events[r]||(this._events[r]=[]);const a=this._events[r];this._indexOfListener(a,s)===-1&&a.push({listener:s,once:!0})}off(r,s){if(!this._events[r])return;const a=this._events[r],c=this._indexOfListener(a,s);c!==-1&&a.splice(c,1),this._events[r].length===0&&delete this._events[r]}removeAllListeners(r){r?delete this._events[r]:this._events={}}emit(r){this._events[r]||(this._events[r]=[]);const s=this._events[r].map((h=>h));for(var a=arguments.length,c=new Array(a>1?a-1:0),d=1;d<a;d++)c[d-1]=arguments[d];for(let h=0;h<s.length;h+=1){const m=s[h];m.once&&this.off(r,m.listener),m.listener.apply(this,c||[])}}safeEmit(r){for(var s=arguments.length,a=new Array(s>1?s-1:0),c=1;c<s;c++)a[c-1]=arguments[c];[...this._events[r]||[]].forEach((d=>{d.once&&this.off(r,d.listener);try{d.listener.apply(this,a)}catch(h){console.error("safeEmit event:".concat(r," error ").concat(h==null?void 0:h.toString()))}}))}_indexOfListener(r,s){let a=r.length;for(;a--;)if(r[a].listener===s)return a;return-1}}let cT=null;function y9(){if(cT)return cT;if(window.electron)return cT=window.electron;if(!window.require)return null;try{return cT=window.require("electron"),cT}catch{return null}}let pi=(function(t){return t.CREATE_CLIENT="createClient",t.CHECK_SYSTEM_REQUIREMENTS="checkSystemRequirements",t.SET_AREA="setArea",t.PRELOAD="PRELOAD",t.CHECK_VIDEO_TRACK_IS_ACTIVE="checkVideoTrackIsActive",t.CHECK_AUDIO_TRACK_IS_ACTIVE="checkAudioTrackIsActive",t.CREATE_MIC_AUDIO_TRACK="createMicrophoneAudioTrack",t.CREATE_CUSTOM_AUDIO_TRACK="createCustomAudioTrack",t.CREATE_BUFFER_AUDIO_TRACK="createBufferSourceAudioTrack",t.CREATE_CAM_VIDEO_TRACK="createCameraVideoTrack",t.CREATE_CUSTOM_VIDEO_TRACK="createCustomVideoTrack",t.CREATE_MIC_AND_CAM_TRACKS="createMicrophoneAndCameraTracks",t.CREATE_SCREEN_VIDEO_TRACK="createScreenVideoTrack",t.SET_ENCRYPTION_CONFIG="Client.setEncryptionConfig",t.START_PROXY_SERVER="Client.startProxyServer",t.STOP_PROXY_SERVER="Client.stopProxyServer",t.SET_PROXY_SERVER="Client.setProxyServer",t.SET_TURN_SERVER="Client.setTurnServer",t.SET_CLIENT_ROLE="Client.setClientRole",t.SET_LOW_STREAM_PARAMETER="Client.setLowStreamParameter",t.ENABLE_DUAL_STREAM="Client.enableDualStream",t.DISABLE_DUAL_STREAM="Client.disableDualStream",t.JOIN="Client.join",t.LEAVE="Client.leave",t.PUBLISH="Client.publish",t.UNPUBLISH="Client.unpublish",t.SUBSCRIBE="Client.subscribe",t.MASS_SUBSCRIBE="Client.massSubscribe",t.MASS_UNSUBSCRIBE="Client.massUnsubscribe",t.UNSUBSCRIBE="Client.unsubscribe",t.RENEW_TOKEN="Client.renewToken",t.SET_REMOTE_VIDEO_STREAM_TYPE="Client.setRemoteVideoStreamType",t.SET_STREAM_FALLBACK_OPTION="Client.setStreamFallbackOption",t.ENABLE_AUDIO_VOLUME_INDICATOR="Client.enableAudioVolumeIndicator",t.SEND_CUSTOM_REPORT_MESSAGE="Client.sendCustomReportMessage",t.INSPECT_VIDEO_CONTENT="Client.inspectVideoContent",t.STOP_INSPECT_VIDEO_CONTENT="Client.stopInspectVideoContent",t.JOIN_FALLBACK_TO_PROXY="Client._joinFallbackToProxy",t.ON_LIVE_STREAM_WARNING="Client.onLiveStreamWarning",t.ON_LIVE_STREAM_ERROR="Client.onLiveStreamingError",t.START_LIVE_STREAMING="Client.startLiveStreaming",t.SET_LIVE_TRANSCODING="Client.setLiveTranscoding",t.STOP_LIVE_STREAMING="Client.stopLiveStreaming",t.START_CHANNEL_MEDIA_RELAY="Client.startChannelMediaRelay",t.UPDATE_CHANNEL_MEDIA_RELAY="Client.updateChannelMediaRelay",t.STOP_CHANNEL_MEDIA_RELAY="Client.stopChannelMediaRelay",t.REQUEST_CONFIG_DISTRIBUTE="_config-distribute-request",t.SET_CONFIG_DISTRIBUTE="_configDistribute",t.LOCAL_TRACK_SET_MUTED="LocalTrack.setMute",t.LOCAL_AUDIO_TRACK_PLAY="LocalAudioTrack.play",t.LOCAL_AUDIO_TRACK_PLAY_IN_ELEMENT="LocalAudioTrack.playInElement",t.LOCAL_AUDIO_TRACK_STOP="LocalAudioTrack.stop",t.LOCAL_AUDIO_TRACK_SET_VOLUME="LocalAudioTrack.setVolume",t.MIC_AUDIO_TRACK_SET_DEVICE="MicrophoneAudioTrack.setDevice",t.BUFFER_AUDIO_TRACK_START="BufferSourceAudioTrack.startProcessAudioBuffer",t.BUFFER_AUDIO_TRACK_STOP="BufferSourceAudioTrack.stopProcessAudioBuffer",t.BUFFER_AUDIO_TRACK_PAUSE="BufferSourceAudioTrack.pauseProcessAudioBuffer",t.BUFFER_AUDIO_TRACK_RESUME="BufferSourceAudioTrack.resumeProcessAudioBuffer",t.BUFFER_AUDIO_TRACK_SEEK="BufferSourceAudioTrack.seekAudioBuffer",t.LOCAL_VIDEO_TRACK_PLAY="LocalVideoTrack.play",t.LOCAL_VIDEO_TRACK_STOP="LocalVideoTrack.stop",t.LOCAL_VIDEO_TRACK_GET_VIDEO_VISIBLE="LocalVideoTrack.getVideoElementVisibleStatus",t.LOCAL_VIDEO_TRACK_BEAUTY="LocalVideoTrack.setBeautyEffect",t.LOCAL_VIDEO_SEND_SEI_DATA="LocalVideoTrack.sendSeiData",t.CAM_VIDEO_TRACK_SET_DEVICE="CameraVideoTrack.setDevice",t.CAM_VIDEO_TRACK_SET_ENCODER_CONFIG="CameraVideoTrack.setEncoderConfiguration",t.REMOTE_VIDEO_TRACK_PLAY="RemoteVideoTrack.play",t.REMOTE_VIDEO_TRACK_STOP="RemoteVideoTrack.stop",t.REMOTE_VIDEO_TRACK_GET_VIDEO_VISIBLE="RemoteVideoTrack.getVideoElementVisibleStatus",t.REMOTE_AUDIO_TRACK_PLAY="RemoteAudioTrack.play",t.REMOTE_AUDIO_TRACK_STOP="RemoteAudioTrack.stop",t.REMOTE_AUDIO_SET_VOLUME="RemoteAudioTrack.setVolume",t.REMOTE_AUDIO_SET_OUTPUT_DEVICE="RemoteAudioTrack.setOutputDevice",t.GET_MEDIA_STREAM_TRACK="Track.getMediaStreamTrack",t.STREAM_TYPE_CHANGE="streamTypeChange",t.CONNECTION_STATE_CHANGE="connectionStateChange",t.LOAD_CONFIG_FROM_LOCALSTORAGE="loadConfigFromLocalStorage",t.IMAGE_MODERATION_UPLOAD="imageModerationUpload",t.REPUB_AFTER_PC_CONNECTED="repubAfterPCConnected",t.PRELOAD_MEDIA_FAILED="preloadMediaFailed",t.MISMATCH_DTLS_PARAMETERS="mismatchDtlsParameters",t})({}),$r=(function(t){return t.TRACER="tracer",t})({});function E9(t){return vr(t.timeout,"config.timeout",0,1e5),vr(t.timeoutFactor,"config.timeoutFactor",0,100,!1),vr(t.maxRetryCount,"config.maxRetryConfig",0,1/0),vr(t.maxRetryTimeout,"config.maxRetryTimeout",0,1/0),!0}let zme=(function(t){return t[t.AUDIENCE_LEVEL_LOW_LATENCY=1]="AUDIENCE_LEVEL_LOW_LATENCY",t[t.AUDIENCE_LEVEL_ULTRA_LOW_LATENCY=2]="AUDIENCE_LEVEL_ULTRA_LOW_LATENCY",t[t.AUDIENCE_LEVEL_SYNC_LATENCY=3]="AUDIENCE_LEVEL_SYNC_LATENCY",t})({}),or=(function(t){return t.LEAVE="LEAVE",t.NETWORK_ERROR="NETWORK_ERROR",t.SERVER_ERROR="SERVER_ERROR",t.UID_BANNED="UID_BANNED",t.FALLBACK="FALLBACK",t.IP_BANNED="IP_BANNED",t.CHANNEL_BANNED="CHANNEL_BANNED",t.LICENSE_MISSING="LICENSE_MISSING",t.LICENSE_EXPIRED="LICENSE_EXPIRED",t.LICENSE_MINUTES_EXCEEDED="LICENSE_MINUTES_EXCEEDED",t.LICENSE_PERIOD_INVALID="LICENSE_PERIOD_INVALID",t.LICENSE_MULTIPLE_SDK_SERVICE="LICENSE_MULTIPLE_SDK_SERVICE",t.LICENSE_ILLEGAL="LICENSE_ILLEGAL",t.TOKEN_EXPIRE="TOKEN_EXPIRE",t})({});function lT(t){if(!Array.isArray(t)||t.length<1)return!1;try{t.forEach((r=>{if(!r.urls)throw Error()}))}catch{return!1}return!0}function v9(t){return Rs(t.turnServerURL,"turnServerURL"),Rs(t.username,"username"),Rs(t.password,"password"),t.udpport&&vr(t.udpport,"udpport",1,99999,!0),t.forceturn&&Yd(t.forceturn,"forceturn"),t.security&&Yd(t.security,"security"),t.tcpport&&vr(t.tcpport,"tcpport",1,99999,!0),!0}function YL(t){return t.level!==void 0&&Zi(t.level,"level",[1,2,3]),t.delay!==void 0&&vr(t.delay,"delay",0,3e3,!0),!0}let Pn=(function(t){return t.PEERCONNECTION_STATE_CHANGE="peerconnection-state-change",t.AUDIO_METADATA="audio-metadata",t.AUDIO_PTS="audio-pts",t.CONNECTION_STATE_CHANGE="connection-state-change",t.MEDIA_RECONNECT_START="media-reconnect-start",t.MEDIA_RECONNECT_END="media-reconnect-end",t.IS_USING_CLOUD_PROXY="is-using-cloud-proxy",t.USER_JOINED="user-joined",t.USER_LEAVED="user-left",t.USER_PUBLISHED="user-published",t.USER_UNPUBLISHED="user-unpublished",t.USER_INFO_UPDATED="user-info-updated",t.CLIENT_BANNED="client-banned",t.CHANNEL_MEDIA_RELAY_STATE="channel-media-relay-state",t.CHANNEL_MEDIA_RELAY_EVENT="channel-media-relay-event",t.VOLUME_INDICATOR="volume-indicator",t.CRYPT_ERROR="crypt-error",t.ON_TOKEN_PRIVILEGE_WILL_EXPIRE="token-privilege-will-expire",t.ON_TOKEN_PRIVILEGE_DID_EXPIRE="token-privilege-did-expire",t.NETWORK_QUALITY="network-quality",t.STREAM_TYPE_CHANGED="stream-type-changed",t.STREAM_FALLBACK="stream-fallback",t.RECEIVE_METADATA="receive-metadata",t.STREAM_MESSAGE="stream-message",t.LIVE_STREAMING_ERROR="live-streaming-error",t.LIVE_STREAMING_WARNING="live-streaming-warning",t.EXCEPTION="exception",t.ERROR="error",t.P2P_LOST="p2p_lost",t.JOIN_FALLBACK_TO_PROXY="join-fallback-to-proxy",t.CHANNEL_FALLBACK_TO_WEBSOCKET="channel-fallback-to-websocket",t.MEDIA_CONNECTION_TYPE_CHANGE="media-connection-type-change",t.PUBLISHED_USER_LIST="published-user-list",t.CONTENT_INSPECT_CONNECTION_STATE_CHANGE="content-inspect-connection-state-change",t.CONTENT_INSPECT_ERROR="content-inspect-error",t.CONTENT_INSPECT_RESULT="content-inspect-result",t.IMAGE_MODERATION_CONNECTION_STATE_CHANGE="image-moderation-connection-state-change",t})({}),Bs=(function(t){return t.NETWORK_ERROR="NETWORK_ERROR",t.SERVER_ERROR="SERVER_ERROR",t.MULTI_IP="MULTI_IP",t.TIMEOUT="TIMEOUT",t.OFFLINE="OFFLINE",t.LEAVE="LEAVE",t.P2P_FAILED="P2P_FAILED",t.FALLBACK="FALLBACK",t.REGIONAL_DISTRIBUTION="REGIONAL_DISTRIBUTION",t})({}),Nc=(function(t){return t.ONLINE="ONLINE",t.OFFLINE="OFFLINE",t})({}),e0=(function(t){return t.NETWORK_STATE_CHANGE="NETWORK_STATE_CHANGE",t.ONLINE="ONLINE",t.OFFLINE="OFFLINE",t})({});function zs(t,r){for(var s=arguments.length,a=new Array(s>2?s-2:0),c=2;c<s;c++)a[c-2]=arguments[c];return t.getListeners(r).length===0?mt.reject(new Le(te.UNEXPECTED_ERROR,"can not emit promise")):new mt(((d,h)=>{t.emit(r,...a,d,h)}))}function wr(t,r){if(t.getListeners(r).length===0)return mt.resolve();for(var s=arguments.length,a=new Array(s>2?s-2:0),c=2;c<s;c++)a[c-2]=arguments[c];return zs(t,r,...a)}function al(t,r){if(t.getListeners(r).length===0)return null;for(var s=arguments.length,a=new Array(s>2?s-2:0),c=2;c<s;c++)a[c-2]=arguments[c];return uT(t,r,...a)}function uT(t,r){let s=null,a=null;for(var c=arguments.length,d=new Array(c>2?c-2:0),h=2;h<c;h++)d[h-2]=arguments[h];if(t.emit(r,...d,(m=>{s=m}),(m=>{a=m})),a!==null)throw a;if(s===null)throw new Le(te.UNEXPECTED_ERROR,"handler is not sync");return s}const Ai=new class extends Zr{set networkState(t){this.emit(e0.NETWORK_STATE_CHANGE,t,this._networkState),t===Nc.ONLINE?this.emit(e0.ONLINE):t===Nc.OFFLINE&&(this.onlineWaiter=new mt((r=>{this.once(e0.ONLINE,(()=>{this.onlineWaiter=void 0,r(Nc.ONLINE)}))})),this.emit(e0.OFFLINE)),this._networkState=t}get networkState(){return this._networkState}get isOnline(){return this._networkState===Nc.ONLINE}constructor(){super(),nn(this,"_moduleName","network-indicator"),nn(this,"_networkState",Nc.ONLINE),nn(this,"onlineWaiter",void 0),window.addEventListener("online",(()=>{this.networkState=Nc.ONLINE})),window.addEventListener("offline",(()=>{this.networkState=Nc.OFFLINE}))}};function R1(t,r){const s=t.indexOf(r);s!==-1&&t.splice(s,1)}function t0(t){const r=[];return t.forEach((s=>{r.indexOf(s)===-1&&r.push(s)})),r}function I1(t){mt!==void 0?mt.resolve().then(t):setTimeout(t,0)}function Kr(t){return JSON.parse(JSON.stringify(t))}function ry(t){try{return Kr(t)}catch{return t}}const S9={};function Jm(t,r){S9[r]||(S9[r]=!0,t())}function iy(t){const r=window.atob(t),s=new Uint8Array(new ArrayBuffer(r.length));for(let a=0;a<r.length;a+=1)s[a]=r.charCodeAt(a);return s}function Qm(t){let r="";for(let s=0;s<t.length;s+=1)r+=String.fromCharCode(t[s]);return window.btoa(r)}function b9(t){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:16,s=new TextEncoder().encode(t);if(s.length>r)s=s.slice(0,r);else if(s.length<r){const a=new Uint8Array(r);a.set(s),s=a}return s}function w9(){for(var t=arguments.length,r=new Array(t),s=0;s<t;s++)r[s]=arguments[s];const a=Xa(r).call(r,((h,m)=>h+m.length),0),c=new Uint8Array(new ArrayBuffer(a));let d=0;return r.forEach((h=>{c.set(h,d),d+=h.length})),c}function sp(t){return window.TextEncoder?new TextEncoder().encode(t).length:t.length}function T9(t){let r=0;return(/DingTalk/i.test(navigator.userAgent)||/AliApp/i.test(navigator.userAgent))&&t.realFormData&&(t=t.realFormData),t.forEach((s=>{r+=typeof s=="string"?sp(s):s.size})),r+138}function Wme(t){const r=new Le(te.TIMEOUT,"timeout");return new mt(((s,a)=>{window.setTimeout((()=>a(r)),t)}))}function Is(t){return new mt((r=>{window.setTimeout(r,t)}))}function Tr(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:7,r=arguments.length>1?arguments[1]:void 0;const s=Math.random().toString(16).substr(2,t).toLowerCase();return s.length===t?"".concat(r).concat(s):"".concat(r).concat(s)+Tr(t-s.length,"")}function sy(){return Tr(32,"").toUpperCase()}const A1=()=>{},C9=new class{constructor(){nn(this,"fnMap",new Map)}throttleByKey(t,r,s,a){for(var c=arguments.length,d=new Array(c>4?c-4:0),h=4;h<c;h++)d[h-4]=arguments[h];if(this.fnMap.has(r)){const m=this.fnMap.get(r);if(m.threshold!==s){m.fn(...m.args),clearTimeout(m.timer);const g=window.setTimeout((()=>{const v=this.fnMap.get(r);v&&v.fn(...v.args),this.fnMap.delete(r)}),s);this.fnMap.set(r,{fn:t,threshold:s,timer:g,args:d,skipFn:a})}else m.skipFn&&m.skipFn(...m.args),this.fnMap.set(r,et(et({},m),{},{fn:t,args:d,skipFn:a}))}else{const m=window.setTimeout((()=>{const g=this.fnMap.get(r);g&&g.fn(...g.args),this.fnMap.delete(r)}),s);this.fnMap.set(r,{fn:t,threshold:s,timer:m,args:d,skipFn:a})}}},R9=C9.throttleByKey.bind(C9);function I9(t){return typeof t=="object"&&t!==null&&!(t instanceof RegExp)}function XL(t,r){if(!I9(t)||!I9(r)||Array.isArray(t)&&!Array.isArray(r)||!Array.isArray(t)&&Array.isArray(r))return r;if(Array.isArray(r)&&Array.isArray(t)){const s=[...t];for(let a=0;a<r.length;a++)s[a]=XL(t[a],r[a]);return s}{const s=et({},t);for(const a in r)Object.prototype.hasOwnProperty.call(r,a)&&(Object.prototype.hasOwnProperty.call(t,a)?s[a]=XL(t[a],r[a]):s[a]=r[a]);return s}}function A9(t,r){let s=[0];if(s=new Array(r).fill(0),t===0)return s;let a=0;for(;t>0&&(s[a]=255&t,t>>=8,a++,a!==r););return s}function n0(t){return typeof t=="number"?t:t.exact||t.ideal||t.max||t.min||0}function JL(t){return Xa(t).call(t,((r,s)=>r+s),0)}function P9(t){const r="0123456789abcdef";function s(ae){let ye,_e="";for(ye=0;ye<=3;ye++)_e+=r.charAt(ae>>8*ye+4&15)+r.charAt(ae>>8*ye&15);return _e}function a(ae,ye){const _e=(65535&ae)+(65535&ye);return(ae>>16)+(ye>>16)+(_e>>16)<<16|65535&_e}function c(ae,ye,_e,ue,Ae,Ue){return a((function(We,Ze){return We<<Ze|We>>>32-Ze})(a(a(ye,ae),a(ue,Ue)),Ae),_e)}function d(ae,ye,_e,ue,Ae,Ue,We){return c(ye&_e|~ye&ue,ae,ye,Ae,Ue,We)}function h(ae,ye,_e,ue,Ae,Ue,We){return c(ye&ue|_e&~ue,ae,ye,Ae,Ue,We)}function m(ae,ye,_e,ue,Ae,Ue,We){return c(ye^_e^ue,ae,ye,Ae,Ue,We)}function g(ae,ye,_e,ue,Ae,Ue,We){return c(_e^(ye|~ue),ae,ye,Ae,Ue,We)}const v=(function(ae){let ye;const _e=1+(ae.length+8>>6),ue=new Array(16*_e);for(ye=0;ye<16*_e;ye++)ue[ye]=0;for(ye=0;ye<ae.length;ye++)ue[ye>>2]|=ae.charCodeAt(ye)<<ye%4*8;return ue[ye>>2]|=128<<ye%4*8,ue[16*_e-2]=8*ae.length,ue})(t);let w,I,A,N,H,B=1732584193,z=-271733879,ee=-1732584194,Z=271733878;for(w=0;w<v.length;w+=16)I=B,A=z,N=ee,H=Z,B=d(B,z,ee,Z,v[w+0],7,-680876936),Z=d(Z,B,z,ee,v[w+1],12,-389564586),ee=d(ee,Z,B,z,v[w+2],17,606105819),z=d(z,ee,Z,B,v[w+3],22,-1044525330),B=d(B,z,ee,Z,v[w+4],7,-176418897),Z=d(Z,B,z,ee,v[w+5],12,1200080426),ee=d(ee,Z,B,z,v[w+6],17,-1473231341),z=d(z,ee,Z,B,v[w+7],22,-45705983),B=d(B,z,ee,Z,v[w+8],7,1770035416),Z=d(Z,B,z,ee,v[w+9],12,-1958414417),ee=d(ee,Z,B,z,v[w+10],17,-42063),z=d(z,ee,Z,B,v[w+11],22,-1990404162),B=d(B,z,ee,Z,v[w+12],7,1804603682),Z=d(Z,B,z,ee,v[w+13],12,-40341101),ee=d(ee,Z,B,z,v[w+14],17,-1502002290),z=d(z,ee,Z,B,v[w+15],22,1236535329),B=h(B,z,ee,Z,v[w+1],5,-165796510),Z=h(Z,B,z,ee,v[w+6],9,-1069501632),ee=h(ee,Z,B,z,v[w+11],14,643717713),z=h(z,ee,Z,B,v[w+0],20,-373897302),B=h(B,z,ee,Z,v[w+5],5,-701558691),Z=h(Z,B,z,ee,v[w+10],9,38016083),ee=h(ee,Z,B,z,v[w+15],14,-660478335),z=h(z,ee,Z,B,v[w+4],20,-405537848),B=h(B,z,ee,Z,v[w+9],5,568446438),Z=h(Z,B,z,ee,v[w+14],9,-1019803690),ee=h(ee,Z,B,z,v[w+3],14,-187363961),z=h(z,ee,Z,B,v[w+8],20,1163531501),B=h(B,z,ee,Z,v[w+13],5,-1444681467),Z=h(Z,B,z,ee,v[w+2],9,-51403784),ee=h(ee,Z,B,z,v[w+7],14,1735328473),z=h(z,ee,Z,B,v[w+12],20,-1926607734),B=m(B,z,ee,Z,v[w+5],4,-378558),Z=m(Z,B,z,ee,v[w+8],11,-2022574463),ee=m(ee,Z,B,z,v[w+11],16,1839030562),z=m(z,ee,Z,B,v[w+14],23,-35309556),B=m(B,z,ee,Z,v[w+1],4,-1530992060),Z=m(Z,B,z,ee,v[w+4],11,1272893353),ee=m(ee,Z,B,z,v[w+7],16,-155497632),z=m(z,ee,Z,B,v[w+10],23,-1094730640),B=m(B,z,ee,Z,v[w+13],4,681279174),Z=m(Z,B,z,ee,v[w+0],11,-358537222),ee=m(ee,Z,B,z,v[w+3],16,-722521979),z=m(z,ee,Z,B,v[w+6],23,76029189),B=m(B,z,ee,Z,v[w+9],4,-640364487),Z=m(Z,B,z,ee,v[w+12],11,-421815835),ee=m(ee,Z,B,z,v[w+15],16,530742520),z=m(z,ee,Z,B,v[w+2],23,-995338651),B=g(B,z,ee,Z,v[w+0],6,-198630844),Z=g(Z,B,z,ee,v[w+7],10,1126891415),ee=g(ee,Z,B,z,v[w+14],15,-1416354905),z=g(z,ee,Z,B,v[w+5],21,-57434055),B=g(B,z,ee,Z,v[w+12],6,1700485571),Z=g(Z,B,z,ee,v[w+3],10,-1894986606),ee=g(ee,Z,B,z,v[w+10],15,-1051523),z=g(z,ee,Z,B,v[w+1],21,-2054922799),B=g(B,z,ee,Z,v[w+8],6,1873313359),Z=g(Z,B,z,ee,v[w+15],10,-30611744),ee=g(ee,Z,B,z,v[w+6],15,-1560198380),z=g(z,ee,Z,B,v[w+13],21,1309151649),B=g(B,z,ee,Z,v[w+4],6,-145523070),Z=g(Z,B,z,ee,v[w+11],10,-1120210379),ee=g(ee,Z,B,z,v[w+2],15,718787259),z=g(z,ee,Z,B,v[w+9],21,-343485551),B=a(B,I),z=a(z,A),ee=a(ee,N),Z=a(Z,H);return s(B)+s(z)+s(ee)+s(Z)}let Gme=1,O9=console,so=class{static setLogger(t){O9=t}constructor(t,r){nn(this,"id",void 0),nn(this,"lockingPromise",mt.resolve()),nn(this,"locks",0),nn(this,"name",""),nn(this,"lockId",void 0),this.lockId=Gme++,t&&(this.name=t),r&&(this.id=r),this.logger("created")}logger(t,r){const s=(this.id?"[".concat(this.id,"]"):"")+"[lock-".concat(this.name,"-").concat(this.lockId,"]"),a=t==="created"?"is ".concat(t,"."):"is ".concat(t,", current queue ").concat(this.locks,". ").concat(r??"");O9.debug("".concat(s," ").concat(a))}setId(t){this.id=t}get isLocked(){return this.locks>0}lock(t){let r;this.locks+=1,this.logger("locked",t);const s=new mt((c=>{r=()=>{this.locks-=1,this.logger("unlocked",t),c()}})),a=this.lockingPromise.then((()=>r));return this.lockingPromise=this.lockingPromise.then((()=>s)),a}};function r0(t,r){return function(s,a,c){const d=c.value;if(typeof d!="function")throw new Error("Cannot use mutex on object property.");return c.value=async function(){const h=this[r];if(!h)throw new Error("mutex property key ".concat(r," doesn't exist on ").concat(t));const m=await h.lock("From ".concat(t,".").concat(a));try{for(var g=arguments.length,v=new Array(g),w=0;w<g;w++)v[w]=arguments[w];return await d.apply(this,v)}finally{m()}},c}}const Vi={timeout:500,timeoutFactor:1.5,maxRetryCount:1/0,maxRetryTimeout:1e4};function QL(t,r){const s=Math.floor(r.timeout*Math.pow(r.timeoutFactor,t));return Math.min(r.maxRetryTimeout,s)}function Xd(t,r,s,a){const c=Object.assign({},Vi,a);let d=c.timeout;const h=async()=>{await(function(v){return new mt((w=>{window.setTimeout(w,v)}))})(d),d*=c.timeoutFactor,d=Math.min(c.maxRetryTimeout,d)};let m=!1;const g=new mt((async(v,w)=>{r=r||(()=>!1),s=s||(()=>!0);for(let I=0;I<c.maxRetryCount;I+=1){if(m)return w(new Le(te.OPERATION_ABORTED));try{const A=await t();if(!r(A,I)||I+1===c.maxRetryCount)return v(A);await h()}catch(A){if(!s(A,I)||I+1===c.maxRetryCount)return w(A);await h()}}}));return g.cancel=()=>m=!0,g}let P1,k9=class{constructor(t){nn(this,"input",[]),nn(this,"size",void 0),this.size=t}add(t){this.input.push(t),this.input.length>this.size&&this.input.splice(0,1)}mean(){var t;return this.input.length===0?0:Xa(t=this.input).call(t,((r,s)=>r+s))/this.input.length}},O1=0,ZL=0;function e2(t,r,s,a){return new mt(((c,d)=>{r.responseType=r.responseType||"json",r.data&&!s?(r.data=JSON.stringify(r.data),O1+=sp(r.data)):s&&(r.data.size?O1+=r.data.size:r.data instanceof FormData?O1+=T9(r.data):O1+=sp(JSON.stringify(r.data))),r.headers=r.headers||{},r.headers["Content-Type"]=r.headers["Content-Type"]||"application/json",r.method="POST",r.url=t,Na.request(r).then((h=>{typeof h.data=="string"?ZL+=sp(h.data):h.data instanceof ArrayBuffer||h.data instanceof Uint8Array?ZL+=h.data.byteLength:ZL+=sp(JSON.stringify(h.data)),c(h.data)})).catch((h=>{Na.isCancel(h)?d(new Le(te.OPERATION_ABORTED,"cancel token canceled")):h.code==="ECONNABORTED"?d(new Le(te.NETWORK_TIMEOUT,h.message)):h.response?d(new Le(te.NETWORK_RESPONSE_ERROR,h.response.status)):d(new Le(te.NETWORK_ERROR,h.message))}))}))}async function Hme(t,r){const s=new Blob([r.data],{type:"buffer"});return await e2(t,et(et({},r),{},{data:s,headers:{"Content-Type":"application/octet-stream"}}),!0)}const N9=()=>window.isSecureContext!==void 0;function $u(t){if(Array.isArray(t))return t.map((s=>s));if(!x9(t))return t;const r={};for(const s in t){const a=t[s];x9(a)||Array.isArray(a)?r[s]=$u(a):r[s]=a}return r}function x9(t){return!(typeof t!="object"||Array.isArray(t)||!t)}let t2=class{constructor(t){nn(this,"input",[]),nn(this,"size",void 0),this.size=t}add(t){this.input.push(t),this.input.length>this.size&&this.input.splice(0,1)}diffMean(){return this.input.length===0?0:(this.input[this.input.length-1]-this.input[0])/this.input.length}};const op={address:"unknown",candidateType:"unknown",id:"unknown",port:0,priority:0,protocol:"unknown",type:"unknown"},dT={timestamp:0,bitrate:{actualEncoded:0,transmit:0},sendPacketLossRate:0,recvPacketLossRate:0,videoRecv:[],videoSend:[],audioRecv:[],audioSend:[],selectedCandidatePair:{id:"unknown",localCandidate:op,remoteCandidate:op},updateInterval:0},D9={firsCount:0,nacksCount:0,plisCount:0,framesDecodeCount:0,framesDecodeInterval:0,framesDecodeFreezeTime:0,decodeFrameRate:0,bytes:0,packetsLost:0,packetLostRate:0,packets:0,ssrc:0,qpSumPerFrame:0,framesDroppedCount:0,outputFrameRate:0,packetsDiscarded:0,framesAssembledFromMultiplePackets:0,totalProcessingDelay:0,avgDecodeMs:0,avgFramesAssembledFromMultiplePacketsMs:0,avgProcessingDelayMs:0,avgInterFrameDelayMs:0,totalAssemblyTime:0},L9={firsCount:0,nacksCount:0,plisCount:0,frameCount:0,bytes:0,packets:0,packetsLost:0,packetLostRate:0,ssrc:0,rttMs:0,jitterMs:0,qpSumPerFrame:0},M9={bytes:0,packets:0,packetsLost:0,packetLostRate:0,ssrc:0,rttMs:0,jitterMs:0},U9={jitterBufferMs:0,jitterMs:0,bytes:0,packetsLost:0,packetLostRate:0,packetsDiscarded:0,packets:0,ssrc:0,receivedFrames:0,droppedFrames:0,concealedSamples:0,totalSamplesReceived:0,silentConcealedSamples:0,concealmentEvents:0,freezeMs80:0,freezeMs200:0,freezeSamples80:0,freezeSamples200:0};let n2=class{constructor(t,r){nn(this,"onFirstVideoReceived",void 0),nn(this,"onFirstVideoDecoded",void 0),nn(this,"onFirstAudioReceived",void 0),nn(this,"onFirstVideoDecodedTimeout",void 0),nn(this,"onFirstAudioDecoded",void 0),nn(this,"onSelectedLocalCandidateChanged",void 0),nn(this,"onSelectedRemoteCandidateChanged",void 0),nn(this,"videoIsReady",!1),nn(this,"videoIsReady2",{}),nn(this,"pc",void 0),nn(this,"options",void 0),nn(this,"intervalTimer",void 0),nn(this,"stats",$u(dT)),nn(this,"isFirstVideoReceived",{}),nn(this,"isFirstVideoDecoded",{}),nn(this,"isFirstAudioReceived",{}),nn(this,"isFirstAudioDecoded",{}),nn(this,"isFirstVideoDecodedTimeout",{}),nn(this,"lossRateWindowStats",[]),this.pc=t,this.options=r,this.intervalTimer=window.setInterval((async()=>{this.updateStats()}),this.options.updateInterval)}getStats(){return this.stats}getSelectedCandidatePair(){return new mt((t=>{t({local:et({},op),remote:et({},op)})}))}setVideoIsReady(t){this.videoIsReady=t}setVideoIsReady2(t,r){this.videoIsReady2[t]=r}getVideoIsReady(t){return this.videoIsReady2[t]||!1}setIsFirstAudioDecoded(t){}destroy(){window.clearInterval(this.intervalTimer),this.pc=void 0}calcLossRate(t){this.lossRateWindowStats.push(t),this.lossRateWindowStats.length>this.options.lossRateInterval&&this.lossRateWindowStats.splice(0,1);const r=this.lossRateWindowStats.length,s=["videoSend","audioSend","videoRecv","audioRecv"];let a=0,c=0,d=0,h=0;for(const m of s)t[m].forEach(((g,v)=>{if(!this.lossRateWindowStats[r-1][m][v]||!this.lossRateWindowStats[0][m][v])return;const w=this.lossRateWindowStats[r-1][m][v].packets-this.lossRateWindowStats[0][m][v].packets,I=this.lossRateWindowStats[r-1][m][v].packetsLost-this.lossRateWindowStats[0][m][v].packetsLost;m==="videoSend"||m==="audioSend"?(a+=w,d+=I):(c+=w,h+=I),Number.isNaN(w)||Number.isNaN(w)?g.packetLostRate=0:g.packetLostRate=w<=0||I<=0?0:I/(w+I)}));t.sendPacketLossRate=a<=0||d<=0?0:d/(a+d),t.recvPacketLossRate=c<=0||h<=0?0:h/(c+h)}},$me=class extends n2{constructor(){super(...arguments),nn(this,"_stats",dT),nn(this,"lastDecodeVideoReceiverStats",new Map)}async updateStats(){const t=await this._getStats(),r=this.statsResponsesToObjects(t);this._stats=$u(dT);const s=r.filter((c=>c.type==="ssrc"));this.processSSRCStats(s);const a=r.find((c=>c.type==="VideoBwe"));a&&this.processBandwidthStats(a),this._stats.timestamp=Date.now(),this.calcLossRate(this._stats),this.stats=this._stats}processBandwidthStats(t){this._stats.bitrate={actualEncoded:Number(t.googActualEncBitrate),targetEncoded:Number(t.googTargetEncBitrate),retransmit:Number(t.googRetransmitBitrate),transmit:Number(t.googTransmitBitrate)},this._stats.sendBandwidth=Number(t.googAvailableSendBandwidth)}processSSRCStats(t){t.forEach((r=>{var s;const a=rt(s=r.id).call(s,"send");switch("".concat(r.mediaType,"_").concat(a?"send":"recv")){case"video_send":{const c=$u(L9);c.codec=r.googCodecName,c.adaptionChangeReason="none",r.googCpuLimitedResolution&&(c.adaptionChangeReason="cpu"),r.googBandwidthLimitedResolution&&(c.adaptionChangeReason="bandwidth"),c.avgEncodeMs=Number(r.googAvgEncodeMs),c.inputFrame={width:Number(r.googFrameWidthInput)||Number(r.googFrameWidthSent),height:Number(r.googFrameHeightInput)||Number(r.googFrameHeightSent),frameRate:Number(r.googFrameRateInput)},c.sentFrame={width:Number(r.googFrameWidthSent),height:Number(r.googFrameHeightSent),frameRate:Number(r.googFrameRateInput)},c.firsCount=Number(r.googFirReceived),c.nacksCount=Number(r.googNacksReceived),c.plisCount=Number(r.googPlisReceived),c.frameCount=Number(r.framesEncoded),c.bytes=Number(r.bytesSent),c.packets=Number(r.packetsSent),c.packetsLost=Number(r.packetsLost),c.ssrc=Number(r.ssrc),c.rttMs=Number(r.googRtt||0),this._stats.videoSend.push(c),this._stats.rtt=c.rttMs;break}case"video_recv":{const c=$u(D9),d=this.lastDecodeVideoReceiverStats.get(Number(r.ssrc));if(c.codec=r.googCodecName,c.targetDelayMs=Number(r.googTargetDelayMs),c.renderDelayMs=Number(r.googRenderDelayMs),c.currentDelayMs=Number(r.googCurrentDelayMs),c.minPlayoutDelayMs=Number(r.googMinPlayoutDelayMs),c.decodeMs=Number(r.googDecodeMs),c.maxDecodeMs=Number(r.googMaxDecodeMs),c.receivedFrame={width:Number(r.googFrameWidthReceived),height:Number(r.googFrameHeightReceived),frameRate:Number(r.googFrameRateReceived)},c.decodedFrame={width:Number(r.googFrameWidthReceived),height:Number(r.googFrameHeightReceived),frameRate:Number(r.googFrameRateDecoded)},c.decodeFrameRate=Number(r.googFrameRateDecoded),c.outputFrame={width:Number(r.googFrameWidthReceived),height:Number(r.googFrameHeightReceived),frameRate:Number(r.googFrameRateOutput)},c.jitterBufferMs=Number(r.googJitterBufferMs),c.firsCount=Number(r.googFirsSent),c.nacksCount=Number(r.googNacksSent),c.plisCount=Number(r.googPlisSent),c.framesDecodeCount=Number(r.framesDecoded),c.bytes=Number(r.bytesReceived),c.packets=Number(r.packetsReceived),c.packetsLost=Number(r.packetsLost),c.ssrc=Number(r.ssrc),c.packets>0&&!this.isFirstVideoReceived[c.ssrc]&&(this.onFirstVideoReceived&&this.onFirstVideoReceived(c.ssrc),this.isFirstVideoReceived[c.ssrc]=!0),c.framesDecodeCount>0&&!this.isFirstVideoDecoded[c.ssrc]&&(this.onFirstVideoDecoded&&this.onFirstVideoDecoded(c.ssrc,c.decodedFrame.width,c.decodedFrame.height),this.isFirstVideoDecoded[c.ssrc]=!0),d){const h=d.stats,m=Date.now()-d.lts;c.framesDecodeFreezeTime=h.framesDecodeFreezeTime,c.framesDecodeInterval=h.framesDecodeInterval,c.framesDecodeCount>h.framesDecodeCount&&this.isFirstVideoDecoded[c.ssrc]?(d.lts=Date.now(),c.framesDecodeInterval=m,c.framesDecodeInterval>=this.options.freezeRateLimit&&(this.getVideoIsReady(parseInt(r.ssrc,10))?c.framesDecodeFreezeTime+=c.framesDecodeInterval:this.setVideoIsReady2(parseInt(r.ssrc,10),!0))):c.framesDecodeCount<d.stats.framesDecodeCount&&(c.framesDecodeInterval=0)}this.lastDecodeVideoReceiverStats.set(c.ssrc,{stats:et({},c),lts:Date.now()}),this._stats.videoRecv.push(c);break}case"audio_recv":{const c=$u(U9);c.codec=r.googCodecName,c.outputLevel=Math.abs(Number(r.audioOutputLevel))/32767,c.decodingCNG=Number(r.googDecodingCNG),c.decodingCTN=Number(r.googDecodingCTN),c.decodingCTSG=Number(r.googDecodingCTSG),c.decodingNormal=Number(r.googDecodingNormal),c.decodingPLC=Number(r.googDecodingPLC),c.decodingPLCCNG=Number(r.googDecodingPLCCNG),c.expandRate=Number(r.googExpandRate),c.accelerateRate=Number(r.googAccelerateRate),c.preemptiveExpandRate=Number(r.googPreemptiveExpandRate),c.secondaryDecodedRate=Number(r.googSecondaryDecodedRate),c.speechExpandRate=Number(r.googSpeechExpandRate),c.preferredJitterBufferMs=Number(r.googPreferredJitterBufferMs),c.jitterBufferMs=Number(r.googJitterBufferMs),c.jitterMs=Number(r.googJitterReceived),c.bytes=Number(r.bytesReceived),c.packets=Number(r.packetsReceived),c.packetsLost=Number(r.packetsLost),c.ssrc=Number(r.ssrc),c.receivedFrames=Number(r.googDecodingCTN)||Number(r.packetsReceived),c.droppedFrames=Number(r.googDecodingPLC)+Number(r.googDecodingPLCCNG)||Number(r.packetsLost),c.receivedFrames>0&&!this.isFirstAudioReceived[c.ssrc]&&(this.onFirstAudioReceived&&this.onFirstAudioReceived(c.ssrc),this.isFirstAudioReceived[c.ssrc]=!0),c.decodingNormal>0&&!this.isFirstAudioDecoded[c.ssrc]&&(this.onFirstAudioDecoded&&this.onFirstAudioDecoded(c.ssrc),this.isFirstAudioDecoded[c.ssrc]=!0),this._stats.audioRecv.push(c);break}case"audio_send":{const c=$u(M9);c.codec=r.googCodecName,c.inputLevel=Math.abs(Number(r.audioInputLevel))/32767,c.aecReturnLoss=Number(r.googEchoCancellationReturnLoss||0),c.aecReturnLossEnhancement=Number(r.googEchoCancellationReturnLossEnhancement||0),c.residualEchoLikelihood=Number(r.googResidualEchoLikelihood||0),c.residualEchoLikelihoodRecentMax=Number(r.googResidualEchoLikelihoodRecentMax||0),c.bytes=Number(r.bytesSent),c.packets=Number(r.packetsSent),c.packetsLost=Number(r.packetsLost),c.ssrc=Number(r.ssrc),c.rttMs=Number(r.googRtt||0),this._stats.rtt=c.rttMs,this._stats.audioSend.push(c);break}}}))}_getStats(){return new mt(((t,r)=>{this.pc.getStats(t,r)}))}statsResponsesToObjects(t){const r=[];return t.result().forEach((s=>{const a={id:s.id,timestamp:s.timestamp.valueOf().toString(),type:s.type};s.names().forEach((c=>{a[c]=s.stat(c)})),r.push(a)})),r}},hT=(function(t){return t.BANDWIDTH="bandwidth",t.CPU="cpu",t.NONE="none",t.OTHER="other",t})({}),k1=(function(t){return t.L1T1="L1T1",t.L1T2="L1T2",t.L1T3="L1T3",t.L1T3_KEY="L1T3_KEY",t.L2T1_KEY="L2T1_KEY",t.L2T2_KEY="L2T2_KEY",t.L2T3_KEY="L2T3_KEY",t.L3T1_KEY="L3T1_KEY",t.L3T2_KEY="L3T2_KEY",t.L3T3_KEY="L3T3_KEY",t})({}),r2=(function(t){return t[t.new=0]="new",t[t.connecting=1]="connecting",t[t.connected=2]="connected",t[t.disconnected=3]="disconnected",t[t.failed=4]="failed",t[t.closed=5]="closed",t})({}),cl=(function(t){return t.CERTIFICATE="certificate",t.CODEC="codec",t.CANDIDATE_PAIR="candidate-pair",t.LOCAL_CANDIDATE="local-candidate",t.REMOTE_CANDIDATE="remote-candidate",t.INBOUND="inbound-rtp",t.TRACK="track",t.OUTBOUND="outbound-rtp",t.PC="peer-connection",t.REMOTE_INBOUND="remote-inbound-rtp",t.REMOTE_OUTBOUND="remote-outbound-rtp",t.TRANSPORT="transport",t.CSRC="csrc",t.DATA_CHANNEL="data-channel",t.STREAM="stream",t.SENDER="sender",t.RECEIVER="receiver",t})({});var i0=(function(t){return t[t.kNone=1]="kNone",t[t.kMillisecondsFromSeconds=1e3]="kMillisecondsFromSeconds",t[t.kBytesToBits=8]="kBytesToBits",t})(i0||{});function pT(t,r,s,a){let c=arguments.length>4&&arguments[4]!==void 0?arguments[4]:i0.kNone;if(!r)return;const d=Number(r[s]);if(typeof d!="number")return;const h=Number(r[a]);if(typeof h!="number")return;if(!t)return h?d/h*c:void 0;const m=Number(t[s]);if(typeof m!="number")return;const g=Number(t[a]);if(typeof g!="number")return;const v=h-g;return v?(d-m)/v*c:void 0}let V9=class extends n2{constructor(){super(...arguments),nn(this,"_stats",dT),nn(this,"report",void 0),nn(this,"lastDecodeVideoReceiverStats",new Map),nn(this,"lastVideoFramesRecv",new Map),nn(this,"lastVideoFramesSent",new Map),nn(this,"lastVideoFramesDecode",new Map),nn(this,"lastVideoFramesOutput",new Map),nn(this,"lastVideoJBDelay",new Map),nn(this,"lastAudioJBDelay",new Map),nn(this,"mediaBytesSent",new Map),nn(this,"mediaBytesRetransmit",new Map),nn(this,"mediaBytesTargetEncode",new Map),nn(this,"lastDecodeAudioReceiverStats",new Map),nn(this,"lastAudioConcealment",new Map),nn(this,"lastEncoderMs",new Map)}async updateStats(){this.report=await this.pc.getStats(),this._stats=$u(dT),this.report.forEach((t=>{switch(t.type){case cl.OUTBOUND:case cl.INBOUND:{const r=t.mediaType||t.kind,s=!r&&"frameWidth"in t,a=!r&&!("frameWidth"in t);t.type===cl.OUTBOUND?r==="audio"||a?this.processAudioOutboundStats(t):(r==="video"||s)&&this.processVideoOutboundStats(t):t.type===cl.INBOUND&&(r==="audio"||a?this.processAudioInboundStats(t):(r==="video"||s)&&this.processVideoInboundStats(t));break}case cl.TRANSPORT:{const r=this.report.get(t.selectedCandidatePairId);r&&this.processCandidatePairStats(r);break}case cl.CANDIDATE_PAIR:t.selected&&this.processCandidatePairStats(t)}})),this.updateSendBitrate(),this._stats.updateInterval=Date.now()-this.stats.timestamp,this._stats.timestamp=Date.now(),this.calcLossRate(this._stats),this.stats=this._stats}async getSelectedCandidatePair(){const t=await this.pc.getStats(),r={local:et({},op),remote:et({},op)};return t.forEach((s=>{let a;if(s.type===cl.TRANSPORT&&(a=t.get(s.selectedCandidatePairId)),s.type===cl.CANDIDATE_PAIR&&s.selected&&(a=s),a){const c=(d,h)=>{d.type=h.type,d.id=h.id,h.address&&(d.address=h.address),h.candidateType&&(d.candidateType=h.candidateType),h.port&&(d.port=h.port),h.priority&&(d.priority=h.priority),h.protocol&&(d.protocol=h.protocol),h.relayProtocol&&(d.relayProtocol=h.relayProtocol)};if(a.localCandidateId){const d=t.get(a.localCandidateId);d&&c(r.local,d)}if(a.remoteCandidateId){const d=t.get(a.remoteCandidateId);d&&c(r.remote,d)}}})),r}processCandidatePairStats(t){if(this._stats.sendBandwidth=t.availableOutgoingBitrate||0,t.currentRoundTripTime&&(this._stats.rtt=1e3*t.currentRoundTripTime),this._stats.videoSend.forEach((r=>{t.currentRoundTripTime&&(r.rttMs=1e3*t.currentRoundTripTime)})),this._stats.audioSend.forEach((r=>{t.currentRoundTripTime&&(r.rttMs=1e3*t.currentRoundTripTime)})),this._stats.selectedCandidatePair.id=t.id,t.localCandidateId){const r=this.report.get(t.localCandidateId);r&&this.processCandidateStats(r)}if(t.remoteCandidateId){const r=this.report.get(t.remoteCandidateId);r&&this.processCandidateStats(r)}}processCandidateStats(t){let r;t.type===cl.LOCAL_CANDIDATE&&(r=this._stats.selectedCandidatePair.localCandidate),t.type===cl.REMOTE_CANDIDATE&&(r=this._stats.selectedCandidatePair.remoteCandidate),r&&(r.type=t.type,r.id=t.id,t.address&&(r.address=t.address),t.candidateType&&(r.candidateType=t.candidateType),t.port&&(r.port=t.port),t.priority&&(r.priority=t.priority),t.protocol&&(r.protocol=t.protocol),t.relayProtocol&&(r.relayProtocol=t.relayProtocol),t.type===cl.LOCAL_CANDIDATE&&this.stats.selectedCandidatePair.localCandidate.id!==r.id&&this.onSelectedLocalCandidateChanged&&this.onSelectedLocalCandidateChanged(et({},r),et({},this.stats.selectedCandidatePair.localCandidate)),t.type===cl.REMOTE_CANDIDATE&&this.stats.selectedCandidatePair.remoteCandidate.id!==r.id&&this.onSelectedRemoteCandidateChanged&&this.onSelectedRemoteCandidateChanged(et({},r),et({},this.stats.selectedCandidatePair.remoteCandidate)))}processAudioInboundStats(t){let r=this._stats.audioRecv.find((a=>a.ssrc===t.ssrc));r||(r=$u(U9),this._stats.audioRecv.push(r)),r.ssrc=t.ssrc,r.packets=t.packetsReceived,r.packetsLost=t.packetsLost,r.packetsDiscarded=t.packetsDiscarded,r.bytes=t.bytesReceived,r.jitterMs=1e3*t.jitter,r.retransmittedBytesReceived=t.retransmittedBytesReceived,r.retransmittedPacketsReceived=t.retransmittedPacketsReceived,r.totalProcessingDelay=t.totalProcessingDelay,r.jitterBufferEmittedCount=t.jitterBufferEmittedCount;const s=this.lastDecodeAudioReceiverStats.get(r.ssrc);r.avgProcessingDelayMs=pT(s,r,"totalProcessingDelay","jitterBufferEmittedCount",i0.kMillisecondsFromSeconds),this.processAudioTrackReceiverStats(t,t.trackId,r),this.calculateAudioFreeze(r,s,t),t.codecId&&(r.codec=this.getCodecFromCodecStats(t.codecId)),r.receivedFrames||(r.receivedFrames=t.packetsReceived),r.droppedFrames||(r.droppedFrames=t.packetsLost),r.receivedFrames>0&&!this.isFirstAudioReceived[r.ssrc]&&(this.onFirstAudioReceived&&this.onFirstAudioReceived(r.ssrc),this.isFirstAudioReceived[r.ssrc]=!0),r.outputLevel&&r.outputLevel>0&&!this.isFirstAudioDecoded[r.ssrc]&&(this.onFirstAudioDecoded&&this.onFirstAudioDecoded(r.ssrc),this.isFirstAudioDecoded[r.ssrc]=!0),typeof t.concealedSamples=="number"&&(r.concealedSamples=t.concealedSamples),this.lastDecodeAudioReceiverStats.set(r.ssrc,et({},r))}calculateAudioFreeze(t,r,s){const a=this.lastAudioConcealment.get(t.ssrc);if(r!=null&&a!=null){const c=a.lts,d=s.timestamp,h=d-c;if(h<=0)return;const m=t.concealedSamples-r.concealedSamples-0,g=a.nonSilent+m,v=t.totalSamplesReceived-r.totalSamplesReceived;if(v<=0)return;const w=80*v/h,I=200*v/h,A=h/v;let N=0;t.freezeSamples80=r.freezeSamples80,t.freezeMs80=r.freezeMs80,g>w&&(a.plc80>0?(t.freezeSamples80+=m,t.freezeMs80+=Math.round(m*A)):(t.freezeSamples80+=g,t.freezeMs80+=Math.round(g*A)),N=a.plc80+1);let H=0;t.freezeSamples200=r.freezeSamples200,t.freezeMs200=r.freezeMs200,g>I&&(a.plc200>0?(t.freezeSamples200+=m,t.freezeMs200+=Math.round(m*A)):(t.freezeSamples200+=g,t.freezeMs200+=Math.round(g*A)),H=a.plc200+1),this.lastAudioConcealment.set(t.ssrc,{nonSilent:m,lts:d,plc80:N,plc200:H})}else t.freezeSamples80=0,t.freezeSamples200=0,t.freezeMs80=0,t.freezeMs200=0,this.lastAudioConcealment.set(t.ssrc,{nonSilent:0,lts:s.timestamp,plc80:0,plc200:0})}processVideoInboundStats(t){let r=this._stats.videoRecv.find((h=>h.ssrc===t.ssrc));r||(r=$u(D9),this._stats.videoRecv.push(r)),r.ssrc=t.ssrc,r.packets=t.packetsReceived,r.packetsLost=t.packetsLost,r.bytes=t.bytesReceived,r.firsCount=t.firCount,r.nacksCount=t.nackCount,r.plisCount=t.pliCount,r.framesDecodeCount=t.framesDecoded,r.framesDroppedCount=t.framesDropped,r.totalInterFrameDelay=t.totalInterFrameDelay,r.totalSquaredInterFrameDelay=t.totalSquaredInterFrameDelay,r.totalFreezesDuration=t.totalFreezesDuration,r.totalProcessingDelay=t.totalProcessingDelay,r.packetsDiscarded=t.packetsDiscarded,r.framesAssembledFromMultiplePackets=t.framesAssembledFromMultiplePackets,r.totalAssemblyTime=t.totalAssemblyTime,r.keyFramesDecoded=t.keyFramesDecoded,r.retransmittedBytesReceived=t.retransmittedBytesReceived,r.retransmittedPacketsReceived=t.retransmittedPacketsReceived;const s=this.lastDecodeVideoReceiverStats.get(r.ssrc),a=this.lastVideoFramesDecode.get(r.ssrc),c=this.lastVideoFramesOutput.get(r.ssrc),d=Date.now();if(r.framesDecodeCount>0&&!this.isFirstVideoDecoded[r.ssrc]){const h=r.decodedFrame?r.decodedFrame.width:0,m=r.decodedFrame?r.decodedFrame.height:0;this.onFirstVideoDecoded&&this.onFirstVideoDecoded(r.ssrc,h,m),this.isFirstVideoDecoded[r.ssrc]=!0}if(s){const h=s.stats,m=d-s.lts;r.framesDecodeFreezeTime=h.framesDecodeFreezeTime,r.framesDecodeInterval=h.framesDecodeInterval,!this.isFirstVideoDecoded[r.ssrc]&&m>this.options.firstVideoDecodedTimeout&&!this.isFirstVideoDecodedTimeout[r.ssrc]&&(this.onFirstVideoDecodedTimeout&&this.onFirstVideoDecodedTimeout(r.ssrc),this.isFirstVideoDecodedTimeout[r.ssrc]=!0),r.framesDecodeCount>h.framesDecodeCount&&this.isFirstVideoDecoded[r.ssrc]?(s.lts=Date.now(),r.framesDecodeInterval=m,r.framesDecodeInterval>=this.options.freezeRateLimit&&(this.getVideoIsReady(parseInt(t.ssrc))?r.framesDecodeFreezeTime+=r.framesDecodeInterval:this.setVideoIsReady2(parseInt(t.ssrc,10),!0))):r.framesDecodeCount<h.framesDecodeCount&&(r.framesDecodeInterval=0),t.framesDecoded&&t.qpSum&&(s.stats.framesDecodeCount>t.framesDecoded?r.qpSumPerFrame=t.qpSum/t.framesDecoded:r.qpSumPerFrame=(t.qpSum-s.qpSum)/(t.framesDecoded-s.stats.framesDecodeCount))}t.totalDecodeTime&&(r.decodeMs=1e3*t.totalDecodeTime,r.avgDecodeMs=pT(s==null?void 0:s.stats,r,"decodeMs","framesDecodeCount")),r.avgProcessingDelayMs=pT(s==null?void 0:s.stats,r,"totalProcessingDelay","framesDecodeCount",i0.kMillisecondsFromSeconds),r.avgFramesAssembledFromMultiplePacketsMs=pT(s==null?void 0:s.stats,r,"totalAssemblyTime","framesAssembledFromMultiplePackets",i0.kMillisecondsFromSeconds),r.avgInterFrameDelayMs=pT(s==null?void 0:s.stats,r,"totalInterFrameDelay","framesDecodeCount",i0.kMillisecondsFromSeconds),a&&d-a.lts>=800?(r.decodeFrameRate=Math.round((r.framesDecodeCount-a.count)/((d-a.lts)/1e3)),this.lastVideoFramesDecode.set(r.ssrc,{count:r.framesDecodeCount,lts:d,rate:r.decodeFrameRate})):a?r.decodeFrameRate=a.rate:this.lastVideoFramesDecode.set(r.ssrc,{count:r.framesDecodeCount,lts:d,rate:0}),r.framesDroppedCount&&t.framesReceived&&(c&&d-c.lts>=800?(r.outputFrameRate=Math.round((t.framesReceived-r.framesDroppedCount-c.count)/((d-c.lts)/1e3)),this.lastVideoFramesOutput.set(r.ssrc,{count:t.framesReceived-r.framesDroppedCount,lts:d,rate:Math.max(r.outputFrameRate,0)})):c?r.outputFrameRate=c.rate:this.lastVideoFramesOutput.set(r.ssrc,{count:t.framesReceived-r.framesDroppedCount,lts:d,rate:0})),this.processVideoTrackReceiverStats(t,t.trackId,r),t.codecId&&(r.codec=this.getCodecFromCodecStats(t.codecId)),t.framerateMean&&(r.framesRateFirefox=t.framerateMean),r.packets>0&&!this.isFirstVideoReceived[r.ssrc]&&(this.onFirstVideoReceived&&this.onFirstVideoReceived(r.ssrc),this.isFirstVideoReceived[r.ssrc]=!0),this.lastDecodeVideoReceiverStats.set(r.ssrc,{stats:et({},r),lts:s?s.lts:Date.now(),qpSum:t.qpSum})}processVideoOutboundStats(t){let r=this._stats.videoSend.find((a=>a.ssrc===t.ssrc));r||(r=$u(L9),this._stats.videoSend.push(r));const s=this.mediaBytesSent.get(t.ssrc);if(s)s.add(t.bytesSent);else{const a=new t2(10);a.add(t.bytesSent),this.mediaBytesSent.set(t.ssrc,a)}if(t.retransmittedBytesSent!==void 0){const a=this.mediaBytesRetransmit.get(t.ssrc);if(a)a.add(t.retransmittedBytesSent);else{const c=new t2(10);c.add(t.retransmittedBytesSent),this.mediaBytesRetransmit.set(t.ssrc,c)}}if(t.totalEncodedBytesTarget){const a=this.mediaBytesTargetEncode.get(t.ssrc);if(a)a.add(t.totalEncodedBytesTarget);else{const c=new t2(10);c.add(t.totalEncodedBytesTarget),this.mediaBytesTargetEncode.set(t.ssrc,c)}}if(r.ssrc=t.ssrc,r.bytes=t.bytesSent,r.packets=t.packetsSent,r.firsCount=t.firCount,r.nacksCount=t.nackCount,r.plisCount=t.pliCount,r.frameCount=t.framesEncoded,r.adaptionChangeReason=t.qualityLimitationReason,r.scalabilityMode=t.scalabilityMode,r.retransmittedBytesSent=t.retransmittedBytesSent,r.retransmittedPacketsSent=t.retransmittedPacketsSent,r.hugeFramesSent=t.hugeFramesSent,r.keyFramesEncoded=t.keyFramesEncoded,r.targetBitrate=t.targetBitrate,t.totalEncodeTime&&t.framesEncoded){const a=this.lastEncoderMs.get(t.ssrc);if(!a||a.lastFrameCount>t.framesEncoded)r.avgEncodeMs=1e3*t.totalEncodeTime/t.framesEncoded;else{const c=t.framesEncoded-a.lastFrameCount,d=t.totalEncodeTime-a.lastEncoderTime;r.avgEncodeMs=1e3*d/c}}if(t.framesEncoded&&t.qpSum){const a=this.lastEncoderMs.get(t.ssrc);!a||a.lastFrameCount>t.framesEncoded?r.qpSumPerFrame=t.qpSum/t.framesEncoded:r.qpSumPerFrame=(t.qpSum-a.lastQpSum)/(t.framesEncoded-a.lastFrameCount)}if(this.lastEncoderMs.set(t.ssrc,{lastFrameCount:t.framesEncoded,lastEncoderTime:t.totalEncodeTime,lastQpSum:t.qpSum,lts:Date.now()}),t.codecId&&(r.codec=this.getCodecFromCodecStats(t.codecId)),t.mediaSourceId&&this.processVideoMediaSource(t.mediaSourceId,r),this.processVideoTrackSenderStats(t,t.trackId,r),t.remoteId)this.processRemoteInboundStats(t.remoteId,r);else{const a=this.findRemoteStatsId(t.ssrc,cl.REMOTE_INBOUND);a&&this.processRemoteInboundStats(a,r)}}processAudioOutboundStats(t){let r=this._stats.audioSend.find((s=>s.ssrc===t.ssrc));if(r||(r=$u(M9),this._stats.audioSend.push(r)),r.ssrc=t.ssrc,r.packets=t.packetsSent,r.bytes=t.bytesSent,r.retransmittedBytesSent=t.retransmittedBytesSent,r.retransmittedPacketsSent=t.retransmittedPacketsSent,t.mediaSourceId&&this.processAudioMediaSource(t.mediaSourceId,r),t.codecId&&(r.codec=this.getCodecFromCodecStats(t.codecId)),this.processAudioTrackSenderStats(t,t.trackId,r),t.remoteId)this.processRemoteInboundStats(t.remoteId,r);else{const s=this.findRemoteStatsId(t.ssrc,cl.REMOTE_INBOUND);s&&this.processRemoteInboundStats(s,r)}}findRemoteStatsId(t,r){var s;const a=Array.from(Pc(s=this.report).call(s)).find((c=>c.type===r&&c.ssrc===t));return a?a.id:null}processVideoMediaSource(t,r){const s=this.report.get(t);s&&s.width&&s.height&&s.framesPerSecond&&(r.inputFrame={width:s.width,height:s.height,frameRate:s.framesPerSecond})}processAudioMediaSource(t,r){const s=this.report.get(t);s&&(r.inputLevel=s.audioLevel)}processVideoTrackSenderStats(t,r,s){var a,c,d,h;const m=r?this.report.get(r):void 0,g=(a=m==null?void 0:m.framesSent)!==null&&a!==void 0?a:t.framesSent;if(typeof g!="number")return;let v=(c=m==null?void 0:m.frameWidth)!==null&&c!==void 0?c:t.frameWidth,w=(d=m==null?void 0:m.frameHeight)!==null&&d!==void 0?d:t.frameHeight,I=(h=m==null?void 0:m.framesPerSecond)!==null&&h!==void 0?h:t.framesPerSecond;if(typeof v=="number"&&typeof w=="number"||(v=0,w=0),I==null){const A=Date.now(),N=this.lastVideoFramesSent.get(s.ssrc);N&&A-N.lts>=800?(I=Math.round((g-N.count)/((A-N.lts)/1e3)),this.lastVideoFramesSent.set(s.ssrc,{count:g,lts:A,rate:I})):N?I=N.rate:this.lastVideoFramesSent.set(s.ssrc,{count:g,lts:A,rate:0})}s.sentFrame={width:v,height:w,frameRate:Math.max(0,I)}}processVideoTrackReceiverStats(t,r,s){var a,c,d,h,m;const g=r?this.report.get(r):void 0,v=(a=g==null?void 0:g.framesReceived)!==null&&a!==void 0?a:t.framesReceived,w=(c=g==null?void 0:g.frameWidth)!==null&&c!==void 0?c:t.frameWidth,I=(d=g==null?void 0:g.frameHeight)!==null&&d!==void 0?d:t.frameHeight,A=(h=g==null?void 0:g.jitterBufferDelay)!==null&&h!==void 0?h:t.jitterBufferDelay,N=(m=g==null?void 0:g.jitterBufferEmittedCount)!==null&&m!==void 0?m:t.jitterBufferEmittedCount;if(typeof v=="number"){const H=this.lastVideoFramesRecv.get(s.ssrc),B=Date.now();s.framesReceivedCount=v;let z=0;H&&B-H.lts>=800?(z=Math.round((v-H.count)/((B-H.lts)/1e3)),this.lastVideoFramesRecv.set(s.ssrc,{count:v,lts:B,rate:z})):H?z=H.rate:this.lastVideoFramesRecv.set(s.ssrc,{count:v,lts:B,rate:0}),s.receivedFrame={width:w||0,height:I||0,frameRate:z||0},s.decodedFrame={width:w||0,height:I||0,frameRate:s.decodeFrameRate||0},s.outputFrame={width:w||0,height:I||0,frameRate:s.outputFrameRate||s.decodeFrameRate||0}}if(A&&N){const H=this.lastVideoJBDelay.get(s.ssrc)||{jitterBufferDelay:0,jitterBufferEmittedCount:0,jitterBufferMs:0};let B=H.jitterBufferMs;const z=N-H.jitterBufferEmittedCount;z>0&&(B=1e3*(A-H.jitterBufferDelay)/z),s.jitterBufferMs=B,s.currentDelayMs=Math.round(B),this.lastVideoJBDelay.set(s.ssrc,{jitterBufferDelay:A,jitterBufferEmittedCount:N,jitterBufferMs:s.currentDelayMs})}}processAudioTrackSenderStats(t,r,s){var a,c,d,h;const m=r?this.report.get(r):void 0,g=(a=(c=m==null?void 0:m.echoReturnLoss)!==null&&c!==void 0?c:t.echoReturnLoss)!==null&&a!==void 0?a:0,v=(d=(h=m==null?void 0:m.echoReturnLossEnhancement)!==null&&h!==void 0?h:t.echoReturnLossEnhancement)!==null&&d!==void 0?d:0;s.aecReturnLoss=g,s.aecReturnLossEnhancement=v}processAudioTrackReceiverStats(t,r,s){var a,c,d,h,m,g,v,w,I;const A=r?this.report.get(r):void 0,N=(a=A==null?void 0:A.removedSamplesForAcceleration)!==null&&a!==void 0?a:t.removedSamplesForAcceleration,H=(c=A==null?void 0:A.totalSamplesReceived)!==null&&c!==void 0?c:t.totalSamplesReceived,B=(d=A==null?void 0:A.jitterBufferDelay)!==null&&d!==void 0?d:t.jitterBufferDelay,z=(h=A==null?void 0:A.jitterBufferEmittedCount)!==null&&h!==void 0?h:t.jitterBufferEmittedCount,ee=(m=A==null?void 0:A.audioLevel)!==null&&m!==void 0?m:t==null?void 0:t.audioLevel,Z=(g=A==null?void 0:A.totalSamplesDuration)!==null&&g!==void 0?g:t==null?void 0:t.totalSamplesDuration,ae=(v=A==null?void 0:A.concealedSamples)!==null&&v!==void 0?v:t.concealedSamples,ye=(w=A==null?void 0:A.silentConcealedSamples)!==null&&w!==void 0?w:t.silentConcealedSamples,_e=(I=A==null?void 0:A.concealmentEvents)!==null&&I!==void 0?I:t.concealmentEvents;if(typeof H=="number"&&(s.totalSamplesReceived=H),typeof ye=="number"&&(s.silentConcealedSamples=ye),typeof _e=="number"&&(s.concealmentEvents=_e),typeof ae=="number"&&(s.concealedSamples=ae),N&&H&&(s.accelerateRate=N/H),B&&z){const Ae=this.lastAudioJBDelay.get(s.ssrc)||{jitterBufferDelay:0,jitterBufferEmittedCount:0,jitterBufferMs:0};let Ue=Ae.jitterBufferMs;const We=z-Ae.jitterBufferEmittedCount;We>0&&(Ue=1e3*(B-Ae.jitterBufferDelay)/We),s.jitterBufferMs=Math.round(Ue),this.lastAudioJBDelay.set(s.ssrc,{jitterBufferDelay:B,jitterBufferEmittedCount:z,jitterBufferMs:s.jitterBufferMs})}s.outputLevel=ee;let ue=1920;Z&&H&&(ue=H/Z/50,s.receivedFrames=Math.round(H/ue)),ae&&(s.droppedFrames=Math.round(ae/ue))}processRemoteInboundStats(t,r){const s=this.report.get(t);s&&(r.packetsLost=s.packetsLost,s.roundTripTime&&(r.rttMs=1e3*s.roundTripTime),s.jitter&&(r.jitterMs=1e3*s.jitter),s.timestamp&&(r.timestamp=s.timestamp))}getCodecFromCodecStats(t){const r=this.report.get(t);if(!r)return"";const s=r.mimeType.match(/\/(.*)$/);return s&&s[1]?s[1]:""}updateSendBitrate(){let t=0,r=null,s=null;this.mediaBytesSent.forEach((c=>{t+=c.diffMean()})),this.mediaBytesRetransmit.forEach((c=>{r=r===null?c.diffMean():r+c.diffMean()})),this.mediaBytesTargetEncode.forEach((c=>{s=s===null?c.diffMean():s+c.diffMean()}));const a=r!==null?t-r:t;this._stats.bitrate={actualEncoded:8*a/(this.options.updateInterval/1e3),transmit:8*t/(this.options.updateInterval/1e3)},r!==null&&(this._stats.bitrate.retransmit=8*r/(this.options.updateInterval/1e3)),s!==null&&(this._stats.bitrate.targetEncoded=8*s/(this.options.updateInterval/1e3))}},Kme=class extends n2{updateStats(){return mt.resolve()}};function i2(t){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:250,s=arguments.length>2&&arguments[2]!==void 0?arguments[2]:8,a=arguments.length>3&&arguments[3]!==void 0?arguments[3]:500,c=arguments.length>4&&arguments[4]!==void 0?arguments[4]:1e4;const d=(function(){const h=navigator.userAgent.toLocaleLowerCase().match(/chrome\/[\d]*/i);return h&&h[0]?Number(h[0].split("/")[1]):null})();return d?d<76?new $me(t,{updateInterval:r,lossRateInterval:s,freezeRateLimit:a,firstVideoDecodedTimeout:c}):new V9(t,{updateInterval:r,lossRateInterval:s,freezeRateLimit:a,firstVideoDecodedTimeout:c}):(function(h){if(!window.RTCStatsReport)return!1;const m=h.getStats();return!!(m instanceof mt||(function(g){return!!g&&(typeof g=="object"||typeof g=="function")&&typeof g.then=="function"})(m))})(t)?new V9(t,{updateInterval:r,lossRateInterval:s,freezeRateLimit:a,firstVideoDecodedTimeout:c}):new Kme(t,{updateInterval:r,lossRateInterval:s,freezeRateLimit:a,firstVideoDecodedTimeout:c})}const j9="websdk_ng_install_id";function s2(){try{if(oe("INSTALL_ID"))return oe("INSTALL_ID");let t=window.localStorage.getItem(j9);return t||(t=sy(),window.localStorage.setItem(j9,t)),gr("INSTALL_ID",t),t}catch{return}}const Zl=(function(t){if(t.match(/[0-9]+\.[0-9]+\.[0-9]+$/))return t;const r=t.match(/([0-9]+\.[0-9]+\.[0-9]+)\-([0-9]+)/);if(r&&r[1]&&r[2]){const s=r[1],a=r[2];return"".concat(s,".").concat(a)}return"4.0.0.999"})("4.24.0"),o2=(function(){try{return JSON.parse("true")===!0}catch{return!0}})();let oy=(function(t){return t.Default="default",t.Auto="auto",t.Relay="relay",t.SdRtn="sd-rtn",t})({});const Ws=(function(){const t="us".concat("erna","me"),r="pa".concat("sswo","rd"),s=["t","s","t"];s.splice(1,0,"e");const a=s.join(""),c=[];for(let m=0;m<6;m++)c.push("1");const d=c.join(""),h={};return h[t]=a,h[r]=d,Object.assign(h,{turnServerURL:"",tcpport:3433,udpport:3478,forceturn:!1})})();window.DEFAULT_TURN_CONFIG=Ws;const N1={ENABLE_PUBLISHED_USER_LIST:!0,MAX_SUBSCRIPTION:50,SUBSCRIBE_AUDIO_FILTER_TOPN:void 0,ENABLE_PUBLISH_AUDIO_FILTER:void 0,ENABLE_USER_LICENSE_CHECK:!0,DISABLE_FEC:void 0,ENABLE_NTP_REPORT:!1,ENABLE_INSTANT_VIDEO:!1,ENABLE_USER_AUTO_REBALANCE_CHECK:!0,ENABLE_LOSSBASED_BWE:!0,ENABLE_AUT_CC:!0,FORCE_ENABLE_AUT_CC:!1,ENABLE_CC_FALLBACK:void 0,SUBSCRIBE_TWCC:!0,PUBLISH_TWCC:!1,ENABLE_SVC_DEFAULT_CODECS:["H264","VP8","VP9","AV1"],SVC:[],ENABLE_FULL_LINK_AV_SYNC:!1,SVC_MODE:null,PRE_SUB_NUM:1,ENABLE_AUT_FEEDBACK:!0,SVC_EXTENDED:["VP9"]},a2={MIN_FRAME_RATE:1,MAX_FRAME_RATE:30,MAX_THRESHOLD_FRAMERATE:30,BITRATE_MIN_THRESHOLD:100,BITRATE_MAX_THRESHOLD:100,MAX_SCALE:5,BWE_SCALE_UP_THRESHOLD:.6,BWE_SCALE_DOWN_THRESHOLD:.6,PERF_SCALE_UP_THRESHOLD:.7,PERF_SCALE_DOWN_THRESHOLD:.6,MOTION_RESOLUTION_FACTOR:.8,MOTION_BITRATE_FACTOR:.6,DETAIL_FRAMERATE_FACTOR:.8,DETAIL_BITRATE_FACTOR:.6,BALANCE_RESOLUTION_FACTOR:.9,BALANCE_FRAMERATE_FACTOR:.9,BALANCE_BITRATE_FACTOR:.6,OVERUSE_TIMES_THRESHOLD:10,UNDERUSE_TIMES_THRESHOLD:40},c2="v4.24.0-0-gf2267710-dirty(7/31/2025, 7:00:42 PM)",l2={ENABLE_EVENT_REPORT:!0,UPLOAD_LOG:!1,ENABLE_AG_ADAPTATION:!0,FORCE_AG_HIGH_FRAMERATE:!1,FORCE_SUPPORT_AG_ADAPTATION:!1,ENCODER_CONFIG_LIMIT:{},CAMERA_CAPTURE_CONFIG:void 0,ENABLE_PRELOAD:!0,NEW_ICE_RESTART:!0,ICE_RESTART_INTERVAL:1e4,RESTART_SEQUENCE:["udp_tcp_relay","relay"],FIRST_TCP_CANDIDATE:!1,FIRST_TCP_CANDIDATE_INTERVAL:1e3,TURN_DOMAIN:"edge.agora.io",USE_TURN_IP:!0,NEW_TURN_MODE:4,NEW_FORCE_TURN:!1,USE_NEW_RENDER_FREEZE_TIME:!1,ENCODE_EXCEPTION_TIMES:5,ENABLE_ENCODE_EXCEPTION:!0,ENCODE_EXCEPTION_VALIDATE_CODEC:["h264"],VIDEO_ENCODER_CONFIG_LIST:[{width:240,height:180},{width:320,height:240},{width:400,height:300},{width:480,height:360},{width:560,height:420},{width:640,height:480}],DELETE_NEQ_AFTER_USER_LEAVE:!0},Fr=et(et(et(et({},l2),{},{PROCESS_ID:"",ENCRYPT_AES:!0,AREAS:["CHINA","GLOBAL"],WEBCS_DOMAIN:["webrtc2-ap-web-1.agora.io","webrtc2-2.ap.sd-rtn.com"],WEBCS_DOMAIN_BACKUP_LIST:["webrtc2-ap-web-3.agora.io","webrtc2-4.ap.sd-rtn.com"],PROXY_CS:["ap-proxy-1.agora.io","ap-proxy-2.agora.io"],CDS_AP:["cds-ap-web-1.agora.io","cds-web-2.ap.sd-rtn.com","cds-ap-web-3.agora.io","cds-web-4.ap.sd-rtn.com"],ACCOUNT_REGISTER:["sua-ap-web-1.agora.io","sua-web-2.ap.sd-rtn.com","sua-ap-web-3.agora.io","sua-web-4.ap.sd-rtn.com"],UAP_AP:["uap-ap-web-1.agora.io","uap-web-2.ap.sd-rtn.com","uap-ap-web-3.agora.io","uap-web-4.ap.sd-rtn.com"],LOG_UPLOAD_SERVER:"logservice.agora.io",EVENT_REPORT_DOMAIN:"statscollector-1.agora.io",EVENT_REPORT_BACKUP_DOMAIN:"web-2.statscollector.sd-rtn.com",GATEWAY_ADDRESS:[],GATEWAY_WSS_ADDRESS:"",LIVE_STREAMING_ADDRESS:"",HTTP_CONNECT_TIMEOUT:5e3,SIGNAL_REQUEST_TIMEOUT:1e4,REPORT_STATS:!0,NOT_REPORT_EVENT:[],PING_PONG_TIME_OUT:10,WEBSOCKET_TIMEOUT_MIN:1e4,EVENT_REPORT_SEND_INTERVAL:3e3,CONFIG_DISTRIBUTE_INTERVAL:3e5,ENABLE_CONFIG_DISTRIBUTE:!0,CANDIDATE_TIMEOUT:5e3,SHOW_REPORT_INVOKER_LOG:!1,SHOW_REPORT_USER_INVOKER_LOG:!0,JOIN_EXTEND:"",PUB_EXTEND:"",SUB_EXTEND:"",FORCE_TURN:!1,TURN_ENABLE_TCP:!0,TURN_ENABLE_UDP:!0,MAX_UPLOAD_CACHE:50,UPLOAD_CACHE_INTERVAL:2e3,AJAX_REQUEST_CONCURRENT:3,REPORT_APP_SCENARIO:void 0,GATEWAY_DOMAINS:["edge.agora.io","edge.sd-rtn.com"],CONNECT_GATEWAY_WITHOUT_DOMAIN:!1,WORKER_DOMAIN:"edge.agora.io",EVENT_REPORT_RETRY:!0,CHROME_FORCE_PLAN_B:!1,AUDIO_SOURCE_VOLUME_UPDATE_INTERVAL:400,AUDIO_SOURCE_AVG_VOLUME_DURATION:3e3,AUDIO_VOLUME_INDICATION_INTERVAL:2e3,VOLUME_VOICE_WEIGHT:10,GET_VOLUME_OF_MUTED_AUDIO_TRACK:!1,STATS_UPDATE_INTERVAL:250,NORMAL_EVENT_QUEUE_CAPACITY:100,CUSTOM_REPORT:!0,CUSTOM_REPORT_LIMIT:20,PROXY_SERVER_TYPE2:"webnginx-proxy.agora.io",PROXY_SERVER_TYPE3:["webrtc-cloud-proxy.sd-rtn.com","webrtc-cloud-proxy.agora.io"],CUSTOM_PUB_ANSWER_MODIFIER:null,CUSTOM_SUB_ANSWER_MODIFIER:null,CUSTOM_PUB_OFFER_MODIFIER:null,CUSTOM_SUB_OFFER_MODIFIER:null,DSCP_TYPE:"high",REMOVE_NEW_CODECS:!0,FRAGEMENT_LENGTH:3,WEBSOCKET_COMPRESS:!1,SIMULCAST:!1,CHECK_VIDEO_VISIBLE_INTERVAL:3e4,CHECK_LOCAL_STATS_INTERVAL:250,PROFILE_SWITCH_INTERVAL:2e3,UNSUPPORTED_VIDEO_CODEC:[],ENUMERATE_DEVICES_INTERVAL:!1,ENUMERATE_DEVICES_INTERVAL_TIME:1e4,USE_NEW_TOKEN:!1,CLOSE_AFB_FOR_LOCAL_AP:!0,JOIN_MAX_CONCURRENCY:6,JOIN_WITH_FALLBACK_SIGNAL_PROXY:!0,JOIN_WITH_FALLBACK_MEDIA_PROXY:!0,JOIN_WITH_FALLBACK_MEDIA_PROXY_FORCE:!1,JOIN_GATEWAY_TRY_443PORT_DURATION:2e3,JOIN_GATEWAY_USE_443PORT_ONLY:!1,JOIN_GATEWAY_USE_DUAL_DOMAIN:!0,JOIN_GATEWAY_FALLBACK_PORT:443,USE_TURN_SERVER_OF_GATEWAY:!1,H264_PROFILE_LEVEL_ID:"",USE_NEW_LOG:!1,LOG_VERSION:3,MEDIA_DEVICE_CONSTRAINTS:null,ENCRYPT_PROXY_USERNAME_AND_PSW:!0,SDP_LOGGING:!1,CSP_DETECTED_HOSTNAME_LIST:["agora.io","sd-rtn.com"],REMOTE_AUDIO_TRACK_USES_WEB_AUDIO:!1,LOCAL_AUDIO_TRACK_USES_WEB_AUDIO:!1,BITRATE_ADAPTER_TYPE:"STANDARD_BITRATE",AI_DENOISER_PARAMETERS:{excludedLinks:[]},ADJUST_3A_FROM_PLUGINS:!0,RAISE_H264_BASELINE_PRIORITY:!0,FILTER_SEND_H264_BASELINE:!1,FIRST_H264_PROFILE_LEVEL_ID:"42001f",FIRST_PACKETIZATION_MODE:"",X_GOOGLE_START_BITRATE:void 0,NEW_REPORT_SERVER:!1,NEW_REPORT_SERVER_DOMAINS:["data-reporting.agora.io","data-reporting.agora.io"],VIDEO_INSPECT_WORKER_MESSAGE_LENGTH_LIMIT:3e5,VIDEO_INSPECT_INTERVAL_MINIMUM:1e3,VIDEO_INSPECT_QUALITY_RATIO:.9,VIDEO_INSPECT_WORKER_MANAGER_HOST:"edge.agora.io",VIDEO_INSPECT_WORKER_MANAGER_PORT:"",VIDEO_INSPECT_WORKER_PORT:"",SHOW_VIDEO_INSPECT_WORKER_MESSAGE:!1,STATS_COLLECTOR_PORT:443,FORCE_TURN_TCP:!1,WEBAUDIO_INIT_OPTIONS:void 0,FILTER_VIDEO_FEC:!0,FILTER_AUDIO_FEC:!1,CHROME_DUAL_STREAM_USE_ENCODING:!0,DISABLE_DUAL_STREAM_USE_ENCODING:!1,EXTENSION_USAGE_UPLOAD_INTERVAL:1e4,ICE_RESTART:!0,FINGERPRINT:null,ENABLE_VIDEO_FRAME_CALLBACK:!0,VIDEO_FREEZE_DURATION:500,SPATIALIZER_PARAMETERS:{},UPLOAD_LOG_INTERVAL:3e3,UPLOAD_LOG_REQUEST_RETRY_INTERVAL:2e3,UPLOAD_LOG_REQUEST_MAX_RETRY_INTERVAL:2e4,UPLOAD_LOG_TRY_INTERVAL_WHILE_OFF:5e3,UPLOAD_LOG_RETRY_INTERVAL_V1:1e4,UPLOAD_LOG_TWICE_RETRY_INTERVAL_V1:200,UPLOAD_LOG_LENGTH_EACH_TIME:10,APP_TYPE:0,DISABLE_WEBAUDIO:!1,CHANNEL_MEDIA_RELAY_SERVERS:void 0,KEEP_LAST_FRAME:!0,FORWARD_P2P_CREATION:!0,SYNC_GROUP:!0,BLOCK_LOCAL_CLIENT:!1,ENABLE_AUDIO_TOPN:!1,ENABLE_AUDIO_METADATA:!1,ENABLE_AUDIO_PTS:!1,TOPN_SMOOTH_LEVEL:void 0,TOPN_NEW_SPEAKER_DELAY:void 0,TOPN_SWITCH_HOLD_MS:void 0,TOPN_AUDIO_GAIN:void 0,TOPN_SILENCE_THRESHOLD:250,AP_AREA:!0,ENABLE_ENCODED_TRANSFORM:!1,ENABLE_VIDEO_SEI:!1,IMAGE_MODERATION_WORKER_HOST:"edge.agora.io",IMAGE_MODERATION_WORKER_MESSAGE_LENGTH_LIMIT:3e5,IMAGE_MODERATION_INTERVAL_MINIMUM:1e3,SHOW_IMAGE_MODERATION_WORKER_MESSAGE:!1,IMAGE_MODERATION_QUALITY_RATIO:.9,IMAGE_MODERATION_UPLOAD_REPORT_INTERVAL:5e3,SHOW_GLOBAL_CLIENT_LIST:!1,DATASTREAM_MAX_RETRANSMITS:10,TCP_CANDIDATE_ONLY:!1,EXTERNAL_SIGNAL_REQUEST_TIMEOUT:3e3,SHOW_P2P_LOG:!1,MAX_P2P_TIMEOUT:3e4,P2P_TOKEN_INTERVAL:1e3,SHOW_DATASTREAM2_LOG:!1,RESTRICTION_SET_PLAYBACK_DEVICE:!0,USE_PURE_ENCRYPTION_MASTER_KEY:!1,ENABLE_AUDIO_RED:!1,OPUS_PTIME:void 0,AUDIO_DUPLICATE_NUM:void 0,ENABLE_ABSSENDTIME_AS_SENTTS:!0,ACCOUNT_REGISTER_RETRY_TIMEOUT:1,ACCOUNT_REGISTER_RETRY_RATIO:2,ACCOUNT_REGISTER_RETRY_TIMEOUT_MAX:6e4,ACCOUNT_REGISTER_RETRY_COUNT_MAX:1e5,AUDIO_CONTEXT:null,WEBCS_BACKUP_CONNECT_TIMEOUT:6e3,PLAYER_STATE_DEFER:2e3,SIGNAL_REQUEST_WATCH_INTERVAL:1e3,FILEPATH_LENMAX:255,DUALSTREAM_OPERATION_CHECK:!0,MEDIA_ELEMENT_EXISTS_DEPTH:3,SHIM_CANDIDATE:!1,LEAVE_MSG_TIMEOUT:2e3,STATS_FILTER:{transportId:!0,googTrackId:!0},FILTER_VIDEO_CODEC:[],UNSUPPORTED_VIDEO_UPLINK_CODEC:[],UNSUPPORTED_VIDEO_DOWNLINK_CODEC:[],USE_NEW_NETWORK_CONFIG:!1,AUTO_RESET_AUDIO_ROUTE:!1,PLUGIN_INFO:[],OVERUSE_DETECTOR_PARAMS:a2,CUSTOM_ADAPTATION_DEFAULT_MODE:"",HIDE_NO_POSTER:!1,AP_CACHE_NUM:10,AP_UPDATE_INTERVAL:12e4,AP_CACHE_LIFETIME:12e4,MAX_PRELOAD_ASYNC_LENGTH:3,DISABLE_SCREEN_SHARE_REMB:!1},N1),{},{USE_CANDIDATE_FROM_AP_DETAIL:!1,AP_REQUEST_DETAIL:void 0,ENABLE_ROLE_SELECT_EDGE:!1,CLIENT_ROLE_OPTIONS:void 0,COMPATIBLE_SDP_EXTENSION:["gdpr_forbidden"],LIMIT_BITRATE:void 0,EXPERIMENTS:{},USE_PUB_RTX:!0,USE_SUB_RTX:!0,ENABLE_DATASTREAM_2:!1,USE_XR:!0,ENABLE_PREALLOC_PC:!1,ENABLE_PRE_SUB:!1,ENABLE_SVC:!1,ENABLE_PRE_RENDER:!1,FORCE_DISABLE_AUTO_SUB:!1,ENABLE_PRE_SUB_WITH_PRE_PC:!1,PRE_USE_LOCAL_CODECS:!0},{INSTALL_ID:""}),{},{K_MIN_RENDER_DELAY:66,USE_STANDARD_BITRATE_DEFAULT:!1,VIDEO_NEW_BITRATE_RATIO:void 0,VIDEO_STANDARD_BITRATE_VERSION:2,BASELINE_MORE_H264_BITRATE_RATIO:1.1});function gr(t,r,s){var a,c,d;rt(a=Object.keys(Fr)).call(a,t)&&(!s&&rt(c=Object.keys(Jd)).call(c,t)||(Fr[t]=r,t!=="ENABLE_VIDEO_SEI"&&t!=="ENABLE_AUDIO_TOPN"&&t!=="ENABLE_AUDIO_METADATA"&&t!=="ENABLE_AUDIO_PTS"||r!==!0||(Fr.ENABLE_ENCODED_TRANSFORM=!0),t==="USE_NEW_NETWORK_CONFIG"&&r&&(d=!!r,Fr.USE_NEW_NETWORK_CONFIG=d,d&&(Fr.WEBCS_DOMAIN=["webrtc2-2.ap.sd-rtn.com"],Fr.WEBCS_DOMAIN_BACKUP_LIST=["webrtc2-4.ap.sd-rtn.com"],Fr.CDS_AP=["cds-web-2.ap.sd-rtn.com","cds-web-4.ap.sd-rtn.com"],Fr.ACCOUNT_REGISTER=["sua-web-2.ap.sd-rtn.com","sua-web-4.ap.sd-rtn.com"],Fr.EVENT_REPORT_DOMAIN="web-2.statscollector.sd-rtn.com",Fr.EVENT_REPORT_BACKUP_DOMAIN="statscollector-1.agora.io",Fr.GATEWAY_DOMAINS=["edge.sd-rtn.com"])),t==="ENABLE_PRE_SUB"&&r&&(Fr.ENABLE_INSTANT_VIDEO=!0,Fr.ENABLE_PREALLOC_PC=!0),t==="ENABLE_SVC"&&r&&(Fr.ENABLE_AUT_CC=!0),t==="NEW_FORCE_TURN"&&r&&(Fr.NEW_TURN_MODE||(Fr.NEW_TURN_MODE=4))))}function oe(t){return Fr[t]}o2||(Fr.WEBCS_DOMAIN=["ap-web-1-oversea.agora.io","ap-web-1-north-america.agora.io"],Fr.WEBCS_DOMAIN_BACKUP_LIST=["ap-web-2-oversea.agora.io","ap-web-2-north-america.agora.io"],Fr.PROXY_CS=["proxy-ap-web-oversea.agora.io","proxy-ap-web-america.agora.io"],Fr.CDS_AP=["cds-ap-web-oversea.agora.io","cds-ap-web-america.agora.io","cds-ap-web-america2.agora.io"],Fr.ACCOUNT_REGISTER=["sua-ap-web-oversea.agora.io","sua-ap-web-america.agora.io","sua-ap-web-america2.agora.io"],Fr.UAP_AP=["uap-ap-web-oversea.agora.io","uap-ap-web-america.agora.io","uap-ap-web-america2.agora.io"],Fr.LOG_UPLOAD_SERVER="logservice-oversea.agora.io",Fr.EVENT_REPORT_DOMAIN="statscollector-1-oversea.agora.io",Fr.EVENT_REPORT_BACKUP_DOMAIN="statscollector-2-oversea.agora.io",Fr.PROXY_SERVER_TYPE3="webrtc-cloud-proxy.agora.io",Fr.AREAS=["NORTH_AMERICA","OVERSEA"]);let F9=(function(t){return t[t.REALTIME=1]="REALTIME",t})({});const Jd={};var rn=(function(t){return t.SET_SESSION_ID="SET_SESSION_ID",t.SET_P2P_ID="SET_P2P_id",t.SET_DC_ID="SET_DC_id",t.SET_UID="SET_UID",t.SET_INT_UID="SET_INT_UID",t.SET_PUB_ID="SET_PUB_ID",t.SET_CLOUD_PROXY_SERVER_MODE="SET_CLOUD_PROXY_SERVER_MODE",t.KEY_METRIC_CLIENT_CREATED="KEY_METRIC_CLIENT_CREATED",t.KEY_METRIC_JOIN_START="KEY_METRIC_JOIN_START",t.KEY_METRIC_PRELOAD_START="KEY_METRIC_PRELOAD_START",t.KEY_METRIC_PRELOAD_END="KEY_METRIC_PRELOAD_END",t.KEY_METRIC_JOIN_END="KEY_METRIC_JOIN_END",t.KEY_METRIC_REQUEST_AP_START="KEY_METRIC_REQUEST_AP_START",t.KEY_METRIC_REQUEST_AP_END="KEY_METRIC_REQUEST_AP_END",t.KEY_METRIC_REQUEST_SUA_END="KEY_METRIC_REQUEST_SUA_END",t.KEY_METRIC_BEFORE_CONNECT="KEY_METRIC_BEFORE_CONNECT",t.KEY_METRIC_PEER_RECEIVER="KEY_METRIC_PEER_RECEIVER",t.KEY_METRIC_SIGNAL_CONNECTED="KEY_METRIC_SIGNAL_CONNECTED",t.KEY_METRIC_JOIN_REQ="KEY_METRIC_JOIN_REQ",t.KEY_METRIC_JOIN_REP="KEY_METRIC_JOIN_REP",t.KEY_METRIC_JOIN_GATEWAY_START="KEY_METRIC_JOIN_GATEWAY_START",t.KEY_METRIC_JOIN_GATEWAY_END="KEY_METRIC_JOIN_GATEWAY_END",t.KEY_METRIC_PEER_CONNECTION_START="KEY_METRIC_PEER_CONNECTION_START",t.KEY_METRIC_PEER_CONNECTION_END="KEY_METRIC_PEER_CONNECTION_END",t.KEY_METRIC_FIRST_VIDEO_FRAME_DECODED="KEY_METRIC_FIRST_VIDEO_FRAME_DECODED",t.KEY_METRIC_DESCRIPTION_START="KEY_METRIC_DESCRIPTION_START",t.KEY_METRIC_ICE_CONNECTION_END="KEY_METRIC_ICE_CONNECTION_END",t.KEY_METRIC_SIGNAL_CHANNEL_OPEN="KEY_METRIC_SIGNAL_CHANNEL_OPEN",t.KEY_METRIC_PUBLISH="KEY_METRIC_PUBLISH",t.KEY_METRIC_SUBSCRIBE="KEY_METRIC_SUBSCRIBE",t.RECORD_JOIN_CHANNEL_SERVICE="RECORD_JOIN_CHANNEL_SERVICE",t.RESET_JOIN_CHANNEL_SERVICE_RECORDS="RESET_JOIN_CHANNEL_SERVICE_RECORDS",t.RESET_KEY_METRICS="RESET_KEY_METRICS",t.RESET_FIRST_VIDEO_FRAME_DECODED="RESET_FIRST_VIDEO_FRAME_DECODED",t.SET_USE_P2P="SET_USE_P2P",t.SET_TRANSPORT_TYPE="SET_TRANSPORT_TYPE",t})(rn||{});let fT=(function(t){return t.h264="h264",t.h265="h265",t.vp8="vp8",t.vp9="vp9",t.av1="av1",t})({});(function(t){t.opus="opus",t.pcma="pcma",t.pcmu="pcmu",t.g722="g722"})({});const B9=128,qme=96,z9=1e3,s0=10;let Yme=0;var W9=(()=>{var t={8:(a,c,d)=>{d.r(c),d.d(c,{Parser:()=>We,Printer:()=>ir,parse:()=>ot,print:()=>wt});const h=`
`,m="".concat("\r").concat(h),g=" ";let v;function w(Ke){return Ke>="0"&&Ke<="9"}function I(Ke){return Ke>="!"&&Ke<="~"}function A(Ke){return I(Ke)||Ke>=""&&Ke<=""}function N(Ke){return Ke==="!"||Ke>="#"&&Ke<="'"||Ke>="*"&&Ke<="+"||Ke>="-"&&Ke<="."||Ke>="0"&&Ke<="9"||Ke>="A"&&Ke<="Z"||Ke>="^"&&Ke<="~"}function H(Ke){return Ke>="1"&&Ke<="9"}function B(Ke){return Ke>="A"&&Ke<="Z"||Ke>="a"&&Ke<="z"}function z(Ke){return Ke==="d"||Ke==="h"||Ke==="m"||Ke==="s"}function ee(Ke){return Ke>""&&Ke<"	"||Ke>"\v"&&Ke<"\f"||Ke>""&&Ke<""}function Z(Ke){return B(Ke)||w(Ke)||Ke==="+"||Ke==="/"}function ae(Ke){return w(Ke)||B(Ke)||Ke==="+"||Ke==="/"||Ke==="-"||Ke==="_"}function ye(Ke){return B(Ke)||w(Ke)||Ke==="+"||Ke==="/"}function _e(Ke,V){var ce=Object.keys(Ke);if(Object.getOwnPropertySymbols){var ge=Object.getOwnPropertySymbols(Ke);V&&(ge=ge.filter((function(tt){return Object.getOwnPropertyDescriptor(Ke,tt).enumerable}))),ce.push.apply(ce,ge)}return ce}function ue(Ke){for(var V=1;V<arguments.length;V++){var ce=arguments[V]!=null?arguments[V]:{};V%2?_e(Object(ce),!0).forEach((function(ge){Ae(Ke,ge,ce[ge])})):Object.getOwnPropertyDescriptors?Object.defineProperties(Ke,Object.getOwnPropertyDescriptors(ce)):_e(Object(ce)).forEach((function(ge){Object.defineProperty(Ke,ge,Object.getOwnPropertyDescriptor(ce,ge))}))}return Ke}function Ae(Ke,V,ce){return V in Ke?Object.defineProperty(Ke,V,{value:ce,enumerable:!0,configurable:!0,writable:!0}):Ke[V]=ce,Ke}(function(Ke){Ke.VERSION="v",Ke.ORIGIN="o",Ke.SESSION_NAME="s",Ke.INFORMATION="i",Ke.URI="u",Ke.EMAIL="e",Ke.PHONE="p",Ke.CONNECTION="c",Ke.BANDWIDTH="b",Ke.TIME="t",Ke.REPEAT="r",Ke.ZONE_ADJUSTMENTS="z",Ke.KEY="k",Ke.ATTRIBUTE="a",Ke.MEDIA="m"})(v||(v={}));class Ue{consumeText(V,ce){let ge=ce;for(;ge<V.length;){const tt=V[ge];if(tt==="\0"||tt==="\r"||tt===h)break;ge+=1}if(ge-ce==0)throw new Error("Invalid text, at ".concat(V));return ge}consumeUnicastAddress(V,ce,ge){return this.consumeTill(V,ce,g)}consumeOneOrMore(V,ce,ge){let tt=ce;for(;ge(V[tt]);)tt++;if(tt-ce==0)throw new Error("Invalid rule at ".concat(ce,"."));return tt}consumeSpace(V,ce){if(V[ce]===g)return ce+1;throw new Error("Invalid space at ".concat(ce,"."))}consumeIP4Address(V,ce){let ge=ce;for(let tt=0;tt<4;tt++)if(ge=this.consumeDecimalUChar(V,ge),tt!==3){if(V[ge]!==".")throw new Error("Invalid IP4 address.");ge++}return ge}consumeDecimalUChar(V,ce){let ge=ce;for(let un=0;un<3&&w(V[ge]);un++,ge++);if(ge-ce==0)throw new Error("Invalid decimal uchar.");const tt=parseInt(V.slice(ce,ge));if(tt>=0&&tt<=255)return ge;throw new Error("Invalid decimal uchar")}consumeIP6Address(V,ce){let ge=this.consumeHexpart(V,ce);return V[ge]===":"&&(ge+=1,ge=this.consumeIP4Address(V,ge)),ge}consumeHexpart(V,ce){let ge=ce;if(V[ge]===":"&&V[ge+1]===":"){ge+=2;try{ge=this.consumeHexseq(V,ge)}catch{}return ge}if(ge=this.consumeHexseq(V,ge),V[ge]===":"&&V[ge+1]===":"){ge+=2;try{ge=this.consumeHexseq(V,ge)}catch{}return ge}return ge}consumeHexseq(V,ce){let ge=ce;for(;ge=this.consumeHex4(V,ge),V[ge]===":"&&V[ge+1]!==":";)ge+=1;return ge}consumeHex4(V,ce){let ge=0;for(;ge<4;ge++)if(!((tt=V[ce+ge])>="0"&&tt<="9"||tt>="a"&&tt<="f"||tt>="A"&&tt<="F")){if(ge===0)throw new Error("Invalid hex 4");break}var tt;return ce+ge}consumeFQDN(V,ce){let ge=ce;for(;w(V[ge])||B(V[ge])||V[ge]==="-"||V[ge]===".";)ge+=1;if(ge-ce<4)throw new Error("Invalid FQDN");return ge}consumeExtnAddr(V,ce){return this.consumeOneOrMore(V,ce,A)}consumeMulticastAddress(V,ce,ge){switch(ge){case"IP4":case"ip4":return this.consumeIP4MulticastAddress(V,ce);case"IP6":case"ip6":return this.consumeIP6MulticastAddress(V,ce);default:try{return this.consumeFQDN(V,ce)}catch{return this.consumeExtnAddr(V,ce)}}}consumeIP6MulticastAddress(V,ce){const ge=this.consumeHexpart(V,ce);return V[ge]==="/"?this.consumeInteger(V,ge+1):ge}consumeIP4MulticastAddress(V,ce){let ge=ce+3;const tt=V.slice(ce,ge),un=parseInt(tt);if(un<224||un>239)throw new Error("Invalid IP4 multicast address, IPv4 multicast addresses may be in the range 224.0.0.0 to 239.255.255.255.");for(let Ar=0;Ar<3;Ar++){if(V[ge]!==".")throw new Error("Invalid IP4 multicast address.");ge+=1,ge=this.consumeDecimalUChar(V,ge)}return V[ge]==="/"&&(ge+=1),ge=this.consumeTTL(V,ge),V[ge]==="/"&&(ge=this.consumeInteger(V,ge)),ge}consumeInteger(V,ce){if(!H(V[ce]))throw new Error("Invalid integer.");for(ce+=1;w(V[ce]);)ce+=1;return ce}consumeTTL(V,ce){if(V[ce]==="0")return ce+1;if(!H(V[ce]))throw new Error("Invalid TTL.");ce+=1;for(let ge=0;ge<2&&w(V[ce]);ge++)ce+=1;return ce}consumeToken(V,ce){return this.consumeOneOrMore(V,ce,N)}consumeTime(V,ce){let ge=ce;if(V[ge]==="0")return ge+1;for(H(V[ge])&&(ge+=1);w(V[ge]);)ge++;if(ge-ce<10)throw new Error("Invalid time");return ge}consumeAddress(V,ce){return this.consumeTill(V,ce,g)}consumeTypedTime(V,ce){let ge=ce;return ge=this.consumeOneOrMore(V,ge,w),z(V[ge])?ge+1:ge}consumeRepeatInterval(V,ce){if(!H(V[ce]))throw new Error("Invalid repeat interval");for(ce+=1;w(V[ce]);)ce+=1;return z(V[ce])&&(ce+=1),ce}consumePort(V,ce){return this.consumeOneOrMore(V,ce,w)}consume(V,ce,ge){for(let tt=0;tt<ge.length;tt++){if(ce+tt>=V.length)throw new Error("consume exceeding value length");if(V[ce+tt]!==ge[tt])throw new Error("consume ".concat(ge," failed at ").concat(tt))}return ce+ge.length}consumeTill(V,ce,ge){let tt=ce;for(;tt<V.length&&(typeof ge!="string"||V[tt]!==ge)&&(typeof ge!="function"||!ge(V[tt]));)tt++;return tt}}class We extends Ue{constructor(){super(),Ae(this,"records",[]),Ae(this,"currentLine",0)}parse(V){const ce=this.probeEOL(V);this.records=V.split(ce).filter((Of=>!!Bo(Of).call(Of))).map(this.parseLine),this.currentLine=0;const ge=this.parseVersion(),tt=this.parseOrigin(),un=this.parseSessionName(),Ar=this.parseInformation(),$i=this.parseUri(),cu=this.parseEmail(),id=this.parsePhone(),QT=this.parseConnection(),Ry=this.parseBandWidth(),U0=this.parseTimeFields(),$P=this.parseKey(),KP=this.parseSessionAttribute(),lu=this.parseMediaDescription();if(this.currentLine!==this.records.length)throw new Error("parsing failed, non exhaustive sdp lines.");return{version:ge,origin:tt,sessionName:un,information:Ar,uri:$i,emails:cu,phones:id,connection:QT,bandwidths:Ry,timeFields:U0,key:$P,attributes:KP,mediaDescriptions:lu}}getCurrentRecord(){const V=this.records[this.currentLine];if(!V)throw new Error("Record doesn't exit.");return V}probeEOL(V){for(let ce=0;ce<V.length;ce++)if(V[ce]===h)return V[ce-1]==="\r"?m:h;throw new Error("Invalid newline character.")}parseLine(V,ce){if(V.length<2)throw new Error("Invalid sdp line, sdp line should be of form <type>=<value>.");const ge=V[0];if(V[1]!=="=")throw new Error('Invalid sdp line, <type> should be a single character followed by an "=" sign.');return{type:ge,value:V.slice(2),line:ce,cur:0}}parseSessionAttribute(){const V=new _n;for(;this.currentLine<this.records.length;){const ce=this.getCurrentRecord();if(ce.type!==v.ATTRIBUTE)break;const ge={attField:this.extractOneOrMore(ce,(tt=>N(tt)&&tt!==":")),_cur:0};ce.value[ce.cur]===":"&&(ce.cur+=1,ge.attValue=this.extractOneOrMore(ce,ee)),V.parse(ge),this.currentLine++}return V.digest()}parseMediaAttributes(V){const ce=new bn(V);for(;this.currentLine<this.records.length;){const ge=this.getCurrentRecord();if(ge.type!==v.ATTRIBUTE)break;const tt={attField:this.extractOneOrMore(ge,(un=>N(un)&&un!==":")),_cur:0};ge.value[ge.cur]===":"&&(ge.cur+=1,tt.attValue=this.extractOneOrMore(ge,ee)),ce.parse(tt),this.currentLine++}return ce.digest()}parseKey(){const V=this.getCurrentRecord();if(V.type===v.KEY){if(V.value==="prompt"||V.value==="clear:"||V.value==="base64:"||V.value==="uri:")return V.value;throw this.currentLine++,new Error("Invalid key.")}}parseZone(){const V=this.getCurrentRecord();if(V.type===v.ZONE_ADJUSTMENTS){const ce=[];for(;;)try{const ge=this.extract(V,this.consumeTime);this.consumeSpaceForRecord(V);let tt=!1;V.value[V.cur]==="-"&&(tt=!0,V.cur+=1);const un=this.extract(V,this.consumeTypedTime);ce.push({time:ge,typedTime:un,back:tt})}catch{break}if(ce.length===0)throw new Error("Invalid zone adjustments");return this.currentLine++,ce}return[]}parseRepeat(){const V=[];for(;;){const ce=this.getCurrentRecord();if(ce.type!==v.REPEAT)break;{const ge=this.extract(ce,this.consumeRepeatInterval),tt=this.parseTypedTime(ce);V.push({repeatInterval:ge,typedTimes:tt}),this.currentLine++}}return V}parseTypedTime(V){const ce=[];for(;;)try{this.consumeSpaceForRecord(V),ce.push(this.extract(V,this.consumeTypedTime))}catch{break}if(ce.length===0)throw new Error("Invalid typed time.");return ce}parseTime(){const V=this.getCurrentRecord(),ce=this.extract(V,this.consumeTime);this.consumeSpaceForRecord(V);const ge=this.extract(V,this.consumeTime);return this.currentLine++,{startTime:ce,stopTime:ge}}parseBandWidth(){const V=[];for(;this.currentLine<this.records.length;){const ce=this.getCurrentRecord();if(ce.type!==v.BANDWIDTH)break;{const ge=this.extractOneOrMore(ce,N);if(ce.value[ce.cur]!==":")throw new Error("Invalid bandwidth field.");ce.cur++;const tt=this.extractOneOrMore(ce,w);V.push({bwtype:ge,bandwidth:tt}),this.currentLine++}}return V}parseVersion(){const V=this.getCurrentRecord();if(V.type!==v.VERSION)throw new Error("first sdp record must be version");const ce=V.value.slice(0,this.consumeOneOrMore(V.value,0,w));if(ce.length!==V.value.length)throw new Error('invalid proto version, "v='.concat(V.value,'"'));return this.currentLine++,ce}parseOrigin(){const V=this.getCurrentRecord();if(V.type!==v.ORIGIN)throw new Error("second line of sdp must be origin");const ce=this.extractOneOrMore(V,A);this.consumeSpaceForRecord(V);const ge=this.extractOneOrMore(V,w);this.consumeSpaceForRecord(V);const tt=this.extractOneOrMore(V,w);this.consumeSpaceForRecord(V);const un=this.extractOneOrMore(V,N);this.consumeSpaceForRecord(V);const Ar=this.extractOneOrMore(V,N);this.consumeSpaceForRecord(V);const $i=this.extract(V,this.consumeUnicastAddress);return this.currentLine++,{username:ce,sessId:ge,sessVersion:tt,nettype:un,addrtype:Ar,unicastAddress:$i}}parseSessionName(){const V=this.getCurrentRecord();if(V.type===v.SESSION_NAME){const ce=this.extract(V,this.consumeText);return this.currentLine++,ce}}parseInformation(){const V=this.getCurrentRecord();if(V.type!==v.INFORMATION)return;const ce=this.extract(V,this.consumeText);return this.currentLine++,ce}parseUri(){const V=this.getCurrentRecord();if(V.type===v.URI)return this.currentLine++,V.value}parseEmail(){const V=[];for(;;){const ce=this.getCurrentRecord();if(ce.type!==v.EMAIL)break;V.push(ce.value),this.currentLine++}return V}parsePhone(){const V=[];for(;;){const ce=this.getCurrentRecord();if(ce.type!==v.PHONE)break;V.push(ce.value),this.currentLine++}return V}parseConnection(){const V=this.getCurrentRecord();if(V.type===v.CONNECTION){const ce=this.extractOneOrMore(V,N);this.consumeSpaceForRecord(V);const ge=this.extractOneOrMore(V,N);this.consumeSpaceForRecord(V);const tt=this.extract(V,this.consumeAddress);return this.currentLine++,{nettype:ce,addrtype:ge,address:tt}}}parseMedia(){const V=this.getCurrentRecord(),ce=this.extract(V,this.consumeToken);this.consumeSpaceForRecord(V);let ge=this.extract(V,this.consumePort);V.value[V.cur]==="/"&&(V.cur+=1,ge+=this.extract(V,this.consumeInteger)),this.consumeSpaceForRecord(V);const tt=[];for(tt.push(this.extract(V,this.consumeToken));V.value[V.cur]==="/";)V.cur+=1,tt.push(this.extract(V,this.consumeToken));if(tt.length===0)throw new Error("Invalid proto");const un=this.parseFmt(V);return this.currentLine++,{mediaType:ce,port:ge,protos:tt,fmts:un}}parseTimeFields(){const V=[];for(;this.getCurrentRecord().type===v.TIME;){const ce=this.parseTime(),ge=this.parseRepeat(),tt=this.parseZone();V.push({time:ce,repeats:ge,zones:tt})}return V}parseMediaDescription(){const V=[];for(;this.currentLine<this.records.length&&this.getCurrentRecord().type===v.MEDIA;){const ce=this.parseMedia(),ge=this.parseInformation(),tt=this.parseConnections(),un=this.parseBandWidth(),Ar=this.parseKey(),$i=this.parseMediaAttributes(ce);V.push({media:ce,information:ge,connections:tt,bandwidths:un,key:Ar,attributes:$i})}return V}parseConnections(){const V=[];for(;this.currentLine<this.records.length&&this.getCurrentRecord().type===v.CONNECTION;)V.push(this.parseConnection());return V}parseFmt(V){const ce=[];for(;;)try{this.consumeSpaceForRecord(V),ce.push(this.extract(V,this.consumeToken))}catch{break}if(ce.length===0)throw new Error("Invalid fmts");return ce}extract(V,ce){for(var ge=arguments.length,tt=new Array(ge>2?ge-2:0),un=2;un<ge;un++)tt[un-2]=arguments[un];const Ar=ce.call(this,V.value,V.cur,...tt),$i=V.value.slice(V.cur,Ar);return V.cur=Ar,$i}extractOneOrMore(V,ce){const ge=this.consumeOneOrMore(V.value,V.cur,ce),tt=V.value.slice(V.cur,ge);return V.cur=ge,tt}consumeSpaceForRecord(V){if(V.value[V.cur]!==g)throw new Error("Invalid space at ".concat(V.cur,"."));V.cur+=1}}class Ze extends Ue{constructor(){super(...arguments),Ae(this,"attributes",void 0),Ae(this,"digested",!1)}extractOneOrMore(V,ce,ge){const tt=this.consumeOneOrMore(V.attValue,V._cur,ce),un=V.attValue.slice(V._cur,tt),[Ar,$i]=ge||[];if(typeof Ar=="number"&&un.length<Ar)throw new Error("error in length, should be more or equal than ".concat(Ar," characters."));if(typeof $i=="number"&&un.length>$i)throw new Error("error in length, should be less or equal than ".concat($i," characters."));return V._cur=tt,un}consumeAttributeSpace(V){if(V.attValue[V._cur]!==g)throw new Error("Invalid space at ".concat(V._cur,"."));V._cur+=1}extract(V,ce){if(!V.attValue)throw new Error("Nothing to extract from attValue.");for(var ge=arguments.length,tt=new Array(ge>2?ge-2:0),un=2;un<ge;un++)tt[un-2]=arguments[un];const Ar=ce.call(this,V.attValue,V._cur,...tt),$i=V.attValue.slice(V._cur,Ar);return V._cur=Ar,$i}atEnd(V){if(!V.attValue)throw new Error;return V._cur>=V.attValue.length}peekChar(V){if(!V.attValue)throw new Error;return V.attValue[V._cur]}peek(V,ce){if(!V.attValue)throw new Error;for(let ge=0;ge<ce.length;ge++)if(ce[ge]!==V.attValue[V._cur+ge])return!1;return!0}parseIceUfrag(V){if(this.attributes.iceUfrag)throw new Error("Invalid ice-ufrag, should be only a single line if 'a=ice-ufrag'");this.attributes.iceUfrag=this.extractOneOrMore(V,Z,[4,256])}parseIcePwd(V){if(this.attributes.icePwd)throw new Error("Invalid ice-pwd, should be only a single line if 'a=ice-pwd'");this.attributes.icePwd=this.extractOneOrMore(V,Z,[22,256])}parseIceOptions(V){if(this.attributes.iceOptions)throw new Error("Invalid ice-options, should be only one 'ice-options' line");const ce=[];for(;!this.atEnd(V);){ce.push(this.extractOneOrMore(V,Z));try{this.consumeAttributeSpace(V)}catch(ge){if(this.atEnd(V))break;throw ge}}this.attributes.iceOptions=ce}parseFingerprint(V){const ce=this.extract(V,this.consumeToken);this.consumeAttributeSpace(V);const ge=this.extract(V,this.consumeTill);this.attributes.fingerprints.push({hashFunction:ce,fingerprint:ge})}parseExtmap(V){const ce=this.extractOneOrMore(V,w);let ge;this.peekChar(V)==="/"&&(this.extract(V,this.consume,"/"),ge=this.extract(V,this.consumeToken)),this.consumeAttributeSpace(V);const tt=this.extract(V,this.consumeTill,g),un=ue(ue({entry:parseInt(ce,10)},ge&&{direction:ge}),{},{extensionName:tt});this.peekChar(V)===g&&(this.consumeAttributeSpace(V),un.extensionAttributes=this.extract(V,this.consumeTill)),this.attributes.extmaps.push(un)}parseSetup(V){if(this.attributes.setup)throw new Error("must only be one single 'a=setup' line.");const ce=this.extract(V,this.consumeTill);if(ce!=="active"&&ce!=="passive"&&ce!=="actpass"&&ce!=="holdconn")throw new Error("role must be one of 'active', 'passive', 'actpass', 'holdconn'.");this.attributes.setup=ce}}class _n extends Ze{constructor(){super(...arguments),Ae(this,"attributes",{unrecognized:[],groups:[],extmaps:[],fingerprints:[],identities:[]})}parse(V){if(this.digested)throw new Error("already digested");try{switch(V.attField){case"group":this.parseGroup(V);break;case"ice-lite":this.parseIceLite();break;case"ice-ufrag":this.parseIceUfrag(V);break;case"ice-pwd":this.parseIcePwd(V);break;case"ice-options":this.parseIceOptions(V);break;case"fingerprint":this.parseFingerprint(V);break;case"setup":this.parseSetup(V);break;case"tls-id":this.parseTlsId(V);break;case"identity":this.parseIdentity(V);break;case"extmap":this.parseExtmap(V);break;case"msid-semantic":this.parseMsidSemantic(V);break;default:V.ignored=!0,this.attributes.unrecognized.push(V)}}catch(ce){throw console.error("parsing session attribute ".concat(V.attField,' error, "a=').concat(V.attField,":").concat(V.attValue,'"')),ce}if(!V.ignored&&V.attValue&&!this.atEnd(V))throw new Error("attribute parsing error")}digest(){return this.digested=!0,this.attributes}parseGroup(V){const ce=this.extract(V,this.consumeToken),ge=[];for(;!this.atEnd(V)&&this.peekChar(V)===g;)this.consumeAttributeSpace(V),ge.push(this.extract(V,this.consumeToken));this.attributes.groups.push({semantic:ce,identificationTag:ge})}parseIceLite(){if(this.attributes.iceLite)throw new Error("Invalid ice-lite, should be only a single line of 'a=ice-lite'");this.attributes.iceLite=!0}parseTlsId(V){if(this.attributes.tlsId)throw new Error("must be only one tld-id line");this.attributes.tlsId=this.extractOneOrMore(V,ae)}parseIdentity(V){const ce=this.extractOneOrMore(V,ye),ge=[];for(;!this.atEnd(V)&&this.peekChar(V)===g;){this.consumeAttributeSpace(V);const tt=this.extract(V,this.consumeToken);this.extract(V,this.consume,"=");const un=this.extractOneOrMore(V,(Ar=>Ar!==g&&ee(Ar)));ge.push({name:tt,value:un})}this.attributes.identities.push({assertionValue:ce,extensions:ge})}parseMsidSemantic(V){this.peekChar(V)===g&&this.consumeAttributeSpace(V);const ce={semantic:this.extract(V,this.consumeToken),identifierList:[]};for(;;){try{this.consumeAttributeSpace(V)}catch{break}if(this.peekChar(V)==="*"){this.extract(V,this.consume,"*"),ce.applyForAll=!0;break}{const ge=this.extract(V,this.consumeTill,g);ce.identifierList.push(ge)}}this.attributes.msidSemantic=ce}}class bn extends Ze{constructor(V){super(),Ae(this,"attributes",void 0),V.protos.indexOf("RTP")!==-1||V.protos.indexOf("rtp"),this.attributes={unrecognized:[],candidates:[],extmaps:[],fingerprints:[],imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:[],ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:[]}}parse(V){if(this.digested)throw new Error("already digested");try{switch(V.attField){case"extmap":this.parseExtmap(V);break;case"setup":this.parseSetup(V);break;case"ice-ufrag":this.parseIceUfrag(V);break;case"ice-pwd":this.parseIcePwd(V);break;case"ice-options":this.parseIceOptions(V);break;case"candidate":this.parseCandidate(V);break;case"remote-candidate":this.parseRemoteCandidate(V);break;case"end-of-candidates":this.parseEndOfCandidates();break;case"fingerprint":this.parseFingerprint(V);break;case"rtpmap":this.parseRtpmap(V);break;case"ptime":this.parsePtime(V);break;case"maxptime":this.parseMaxPtime(V);break;case"sendrecv":case"recvonly":case"sendonly":case"inactive":this.parseDirection(V);break;case"ssrc":this.parseSSRC(V);break;case"fmtp":this.parseFmtp(V);break;case"rtcp-fb":this.parseRtcpFb(V);break;case"rtcp-mux":this.parseRTCPMux();break;case"rtcp-mux-only":this.parseRTCPMuxOnly();break;case"rtcp-rsize":this.parseRTCPRsize();break;case"rtcp":this.parseRTCP(V);break;case"mid":this.parseMid(V);break;case"msid":this.parseMsid(V);break;case"imageattr":this.parseImageAttr(V);break;case"rid":this.parseRid(V);break;case"simulcast":this.parseSimulcast(V);break;case"sctp-port":this.parseSctpPort(V);break;case"max-message-size":this.parseMaxMessageSize(V);break;case"ssrc-group":this.parseSSRCGroup(V);break;default:V.ignored=!0,this.attributes.unrecognized.push(V)}}catch(ce){throw console.error("parsing media attribute ".concat(V.attField,' error, "a=').concat(V.attField,":").concat(V.attValue,'"')),ce}if(!V.ignored&&V.attValue&&!this.atEnd(V))throw new Error("attribute parsing error")}parseCandidate(V){const ce=this.extractOneOrMore(V,Z,[1,32]);this.consumeAttributeSpace(V);const ge=this.extractOneOrMore(V,w,[1,5]);this.consumeAttributeSpace(V);const tt=this.extract(V,this.consumeToken);this.consumeAttributeSpace(V);const un=this.extractOneOrMore(V,w,[1,10]);this.consumeAttributeSpace(V);const Ar=this.extract(V,this.consumeAddress);this.consumeAttributeSpace(V);const $i=this.extract(V,this.consumePort);this.consumeAttributeSpace(V),this.extract(V,this.consume,"typ"),this.consumeAttributeSpace(V);const cu={foundation:ce,componentId:ge,transport:tt,priority:un,connectionAddress:Ar,port:$i,type:this.extract(V,this.consumeToken),extension:{}};for(this.peek(V," raddr")&&(this.extract(V,this.consume," raddr"),this.consumeAttributeSpace(V),cu.relAddr=this.extract(V,this.consumeAddress)),this.peek(V," rport")&&(this.extract(V,this.consume," rport"),this.consumeAttributeSpace(V),cu.relPort=this.extract(V,this.consumePort));this.peekChar(V)===g;){this.consumeAttributeSpace(V);const id=this.extract(V,this.consumeToken);this.consumeAttributeSpace(V),cu.extension[id]=this.extractOneOrMore(V,I)}this.attributes.candidates.push(cu)}parseRemoteCandidate(V){const ce=[];for(;;){const ge=this.extractOneOrMore(V,w,[1,5]);this.consumeAttributeSpace(V);const tt=this.extract(V,this.consumeAddress);this.consumeAttributeSpace(V);const un=this.extract(V,this.consumePort);ce.push({componentId:ge,connectionAddress:tt,port:un});try{this.consumeAttributeSpace(V)}catch{break}}this.attributes.remoteCandidatesList.push(ce)}parseEndOfCandidates(){if(this.attributes.endOfCandidates)throw new Error("must be only one line of end-of-candidates");this.attributes.endOfCandidates=!0}parseRtpmap(V){const ce=this.extract(V,this.consumeToken);this.consumeAttributeSpace(V);const ge=this.extract(V,this.consumeTill,"/");this.extract(V,this.consume,"/");const tt={encodingName:ge,clockRate:this.extractOneOrMore(V,w)};this.atEnd(V)||this.peekChar(V)!=="/"||(this.extract(V,this.consume,"/"),tt.encodingParameters=parseInt(this.extract(V,this.consumeTill),10));const un=this.attributes.payloads.find((Ar=>Ar.payloadType===parseInt(ce,10)));un?un.rtpMap=tt:this.attributes.payloads.push({payloadType:parseInt(ce,10),rtpMap:tt,rtcpFeedbacks:[]})}parsePtime(V){if(this.attributes.ptime)throw new Error("must be only one line of ptime");this.attributes.ptime=this.extract(V,this.consumeTill)}parseMaxPtime(V){if(this.attributes.maxPtime)throw new Error("must be only one line of ptime");this.attributes.maxPtime=this.extract(V,this.consumeTill)}parseDirection(V){if(this.attributes.direction)throw new Error("must be only one line of direction info");this.attributes.direction=V.attField}parseSSRC(V){const ce=this.extractOneOrMore(V,w);this.consumeAttributeSpace(V);const ge=this.extract(V,this.consumeTill,":");let tt;this.peekChar(V)===":"&&(this.extract(V,this.consume,":"),tt=this.extract(V,this.consumeTill));const un=this.attributes.ssrcs.find((Ar=>Ar.ssrcId===parseInt(ce,10)));un?un.attributes[ge]=tt:this.attributes.ssrcs.push({ssrcId:parseInt(ce,10),attributes:{[ge]:tt}})}parseFmtp(V){const ce=this.extract(V,this.consumeTill,g);this.consumeAttributeSpace(V);const ge=this.extract(V,this.consumeTill),tt={};ge.split(";").forEach((Ar=>{let[$i,cu]=Ar.split("=");$i=Bo($i).call($i);const id=typeof cu=="string"?Bo(cu).call(cu):null;typeof $i=="string"&&$i.length>0&&(tt[$i]=id)}));const un=this.attributes.payloads.find((Ar=>Ar.payloadType===parseInt(ce,10)));un?un.fmtp={parameters:tt}:this.attributes.payloads.push({payloadType:parseInt(ce,10),rtcpFeedbacks:[],fmtp:{parameters:tt}})}parseFmtParameters(V){const ce={},ge=this.extract(V,this.consumeTill,"=");V._cur++;const tt=this.extract(V,this.consumeTill,";");for(ce[ge]=tt;V.attValue[V._cur]===";";){const un=this.extract(V,this.consumeTill,"=");V._cur++;const Ar=this.extract(V,this.consumeTill,";");ce[un]=Ar}return ce}parseRtcpFb(V){let ce="";ce=this.peekChar(V)==="*"?this.extract(V,this.consume,"*"):this.extract(V,this.consumeTill,g),this.consumeAttributeSpace(V);const ge=this.extract(V,this.consumeTill,g);let tt;if(ge==="trr-int")tt={type:ge,interval:this.extract(V,this.consumeTill)};else{const un={type:ge};this.peekChar(V)===g&&(this.consumeAttributeSpace(V),un.parameter=this.extract(V,this.consumeToken),this.peekChar(V)===g&&(un.additional=this.extract(V,this.consumeTill))),tt=un}if(ce==="*")this.attributes.rtcpFeedbackWildcards.push(tt);else{const un=this.attributes.payloads.find((Ar=>Ar.payloadType===parseInt(ce,10)));un?un.rtcpFeedbacks.push(tt):this.attributes.payloads.push({payloadType:parseInt(ce,10),rtcpFeedbacks:[tt]})}}parseRTCPMux(){if(this.attributes.rtcpMux)throw new Error("must be single line of rtcp-mux");this.attributes.rtcpMux=!0}parseRTCPMuxOnly(){if(this.attributes.rtcpMuxOnly)throw new Error("must be single line of rtcp-only");this.attributes.rtcpMuxOnly=!0}parseRTCPRsize(){if(this.attributes.rtcpRsize)throw new Error("must be single line of rtcp-rsize");this.attributes.rtcpRsize=!0}parseRTCP(V){if(this.attributes.rtcp)throw new Error("must be single line of rtcp");const ce={port:this.extract(V,this.consumePort)};this.peekChar(V)===g&&(this.consumeAttributeSpace(V),ce.netType=this.extractOneOrMore(V,N),this.consumeAttributeSpace(V),ce.addressType=this.extractOneOrMore(V,N),this.consumeAttributeSpace(V),ce.address=this.extract(V,this.consumeAddress)),this.attributes.rtcp=ce}parseMsid(V){const ce={id:this.extractOneOrMore(V,N,[1,64])};this.peekChar(V)===g&&(this.consumeAttributeSpace(V),ce.appdata=this.extractOneOrMore(V,N,[1,64])),this.attributes.msids.push(ce)}parseImageAttr(V){this.attributes.imageattr.push(V.attValue)}parseRid(V){const ce=this.extractOneOrMore(V,(tt=>B(tt)||w(tt)||tt==="_"||tt==="-"));this.consumeAttributeSpace(V);const ge={id:ce,direction:this.extract(V,this.consumeToken),params:[]};if(this.peekChar(V)===g){if(this.consumeAttributeSpace(V),this.peek(V,"pt=")){this.extract(V,this.consume,"pt=");const tt=[];for(;;){const un=this.extract(V,this.consumeToken);tt.push(un);try{this.extract(V,this.consume,",")}catch{break}}ge.payloads=tt,this.peekChar(V)===g&&this.extract(V,this.consume,g)}for(;;){const tt=this.extract(V,this.consumeToken);switch(tt){case"depend":{const un={type:tt,rids:this.extract(V,this.consume,"=").split(",")};ge.params.push(un);break}default:{const un={type:tt};this.peekChar(V)==="="&&(this.extract(V,this.consume,"="),un.val=this.extract(V,this.consumeTill,";")),ge.params.push(un)}}try{this.extract(V,this.consume,";")}catch{break}}}this.attributes.rids.push(ge)}parseSimulcast(V){if(this.attributes.simulcast)throw new Error("must be single line of simulcast");this.attributes.simulcast=V.attValue,this.extract(V,this.consumeTill)}parseSctpPort(V){this.attributes.sctpPort=this.extractOneOrMore(V,w,[1,5])}parseMaxMessageSize(V){this.attributes.maxMessageSize=this.extractOneOrMore(V,w,[1,void 0])}digest(){return this.digested=!0,this.attributes}parseMid(V){this.attributes.mid=this.extract(V,this.consumeToken)}parseSSRCGroup(V){const ce=this.extract(V,this.consumeToken),ge=[];for(;;)try{this.consumeAttributeSpace(V);const tt=this.extract(V,this.consumeInteger);ge.push(parseInt(tt,10))}catch{break}this.attributes.ssrcGroups.push({semantic:ce,ssrcIds:ge})}}function Zt(Ke,V,ce){return V in Ke?Object.defineProperty(Ke,V,{value:ce,enumerable:!0,configurable:!0,writable:!0}):Ke[V]=ce,Ke}class ir{constructor(){Zt(this,"eol",m)}print(V,ce){let ge="";return ce&&(this.eol=ce),ge+=this.printVersion(V.version),ge+=this.printOrigin(V.origin),ge+=this.printSessionName(V.sessionName),ge+=this.printInformation(V.information),ge+=this.printUri(V.uri),ge+=this.printEmail(V.emails),ge+=this.printPhone(V.phones),ge+=this.printConnection(V.connection),ge+=this.printBandwidth(V.bandwidths),ge+=this.printTimeFields(V.timeFields),ge+=this.printKey(V.key),ge+=this.printSessionAttributes(V.attributes),ge+=this.printMediaDescription(V.mediaDescriptions),ge}printVersion(V){return"v=".concat(V).concat(this.eol)}printOrigin(V){return"o=".concat(V.username," ").concat(V.sessId," ").concat(V.sessVersion," ").concat(V.nettype," ").concat(V.addrtype," ").concat(V.unicastAddress).concat(this.eol)}printSessionName(V){return V?"s=".concat(V).concat(this.eol):""}printInformation(V){return V?"i=".concat(V).concat(this.eol):""}printUri(V){return V?"u=".concat(V).concat(this.eol):""}printEmail(V){let ce="";for(const ge of V)ce+="e=".concat(ge).concat(this.eol);return ce}printPhone(V){let ce="";for(const ge of V)ce+="e=".concat(ge).concat(this.eol);return ce}printConnection(V){return V?"c=".concat(V.nettype," ").concat(V.addrtype," ").concat(V.address).concat(this.eol):""}printBandwidth(V){let ce="";for(const ge of V)ce+="b=".concat(ge.bwtype,":").concat(ge.bandwidth).concat(this.eol);return ce}printTimeFields(V){let ce="";for(const ge of V){ce+="t=".concat(ge.time.startTime," ").concat(ge.time.startTime).concat(this.eol);for(const tt of ge.repeats)ce+="r=".concat(tt.repeatInterval," ").concat(tt.typedTimes.join(" ")).concat(this.eol);ge.zoneAdjustments&&(ce+="z=",ce+="z=".concat(ge.zoneAdjustments.map((tt=>"".concat(tt.time," ").concat(tt.back?"-":""," ").concat(tt.typedTime))).join(" ")).concat(this.eol),ce+=this.eol)}return ce}printKey(V){return V?"k=".concat(V).concat(this.eol):""}printAttributes(V){let ce="";for(const ge of V)ce+="a=".concat(ge.attField).concat(ge.attValue?":".concat(ge.attValue):"").concat(this.eol);return ce}printMediaDescription(V){let ce="";for(const ge of V)ce+=this.printMedia(ge.media),ce+=this.printInformation(ge.information),ce+=this.printConnections(ge.connections),ce+=this.printBandwidth(ge.bandwidths),ce+=this.printKey(ge.key),ce+=this.printMediaAttributes(ge);return ce}printConnections(V){let ce="";for(const ge of V)ce+=this.printConnection(ge);return ce}printMedia(V){return"m=".concat(V.mediaType," ").concat(V.port," ").concat(V.protos.join("/")," ").concat(V.fmts.join(" ")).concat(this.eol)}printSessionAttributes(V){return new uo(this.eol).print(V)}printMediaAttributes(V){return new ze(this.eol).print(V)}}class Jn{constructor(V){Zt(this,"eol",void 0),this.eol=V}printIceUfrag(V){return V===void 0?"":"a=ice-ufrag:".concat(V).concat(this.eol)}printIcePwd(V){return V===void 0?"":"a=ice-pwd:".concat(V).concat(this.eol)}printIceOptions(V){return V===void 0?"":"a=ice-options:".concat(V.join(g)).concat(this.eol)}printFingerprints(V){return V.length>0?V.map((ce=>"a=fingerprint:".concat(ce.hashFunction).concat(g).concat(ce.fingerprint))).join(this.eol)+this.eol:""}printExtmap(V){return V.map((ce=>"a=extmap:".concat(ce.entry).concat(ce.direction?"/".concat(ce.direction):"").concat(g).concat(ce.extensionName).concat(ce.extensionAttributes?"".concat(g).concat(ce.extensionAttributes):"").concat(this.eol))).join("")}printSetup(V){return V===void 0?"":"a=setup:".concat(V).concat(this.eol)}printUnrecognized(V){return V.map((ce=>"a=".concat(ce.attField).concat(ce.attValue?":".concat(ce.attValue):"").concat(this.eol))).join("")}}class uo extends Jn{print(V){let ce="";return ce+=this.printGroups(V.groups),ce+=this.printMsidSemantic(V.msidSemantic),ce+=this.printIceLite(V.iceLite),ce+=this.printIceUfrag(V.iceUfrag),ce+=this.printIcePwd(V.icePwd),ce+=this.printIceOptions(V.iceOptions),ce+=this.printFingerprints(V.fingerprints),ce+=this.printSetup(V.setup),ce+=this.printTlsId(V.tlsId),ce+=this.printIdentity(V.identities),ce+=this.printExtmap(V.extmaps),ce+=this.printUnrecognized(V.unrecognized),ce}printGroups(V){let ce="";return V.length>0&&(ce+=V.map((ge=>"a=group:".concat(ge.semantic).concat(ge.identificationTag.map((tt=>"".concat(g).concat(tt))).join("")).concat(this.eol))).join("")),ce}printIceLite(V){return V===void 0?"":"a=ice-lite"+this.eol}printTlsId(V){return V?"a=tls-id:".concat(V).concat(this.eol):""}printIdentity(V){return V.length===0?"":V.map((ce=>"a=identity:".concat(ce.assertionValue).concat(ce.extensions.map((ge=>"".concat(g).concat(ge.name).concat(ge.value?"=".concat(ge.value):"")))))).join(this.eol)+this.eol}printMsidSemantic(V){if(!V)return"";let ce="a=msid-semantic:".concat(V.semantic);return V.applyForAll?ce+="".concat(g,"*"):V.identifierList.length>0&&(ce+=V.identifierList.map((ge=>"".concat(g).concat(ge)))),ce+this.eol}}class ze extends Jn{print(V){const ce=V.attributes;let ge="";return ge+=this.printRTCP(ce.rtcp),ge+=this.printIceUfrag(ce.iceUfrag),ge+=this.printIcePwd(ce.icePwd),ge+=this.printIceOptions(ce.iceOptions),ge+=this.printCandidates(ce.candidates),ge+=this.printRemoteCandidatesList(ce.remoteCandidatesList),ge+=this.printEndOfCandidates(ce.endOfCandidates),ge+=this.printFingerprints(ce.fingerprints),ge+=this.printSetup(ce.setup),ge+=this.printMid(ce.mid),ge+=this.printExtmap(ce.extmaps),ge+=this.printRTPRelated(ce),ge+=this.printPtime(ce.ptime),ge+=this.printMaxPtime(ce.maxPtime),ge+=this.printDirection(ce.direction),ge+=this.printSSRCGroups(ce.ssrcGroups),ge+=this.printSSRC(ce.ssrcs),ge+=this.printRTCPMux(ce.rtcpMux),ge+=this.printRTCPMuxOnly(ce.rtcpMuxOnly),ge+=this.printRTCPRsize(ce.rtcpRsize),ge+=this.printMSId(ce.msids),ge+=this.printImageattr(ce.imageattr),ge+=this.printRid(ce.rids),ge+=this.printSimulcast(ce.simulcast),ge+=this.printSCTPPort(ce.sctpPort),ge+=this.printMaxMessageSize(ce.maxMessageSize),ge+=this.printUnrecognized(ce.unrecognized),ge}printCandidates(V){return V.map((ce=>"a=candidate:".concat(ce.foundation).concat(g).concat(ce.componentId).concat(g).concat(ce.transport).concat(g).concat(ce.priority).concat(g).concat(ce.connectionAddress).concat(g).concat(ce.port).concat(g,"typ").concat(g).concat(ce.type).concat(ce.relAddr?"".concat(g,"raddr").concat(g).concat(ce.relAddr):"").concat(ce.relPort?"".concat(g,"rport").concat(g).concat(ce.relPort):"").concat(Object.keys(ce.extension).map((ge=>"".concat(g).concat(ge).concat(g).concat(ce.extension[ge]))).join("")).concat(this.eol))).join("")}printRemoteCandidatesList(V){return V.map((ce=>"a=remote-candidates:".concat(ce.join(g)).concat(this.eol))).join("")}printEndOfCandidates(V){return V===void 0?"":"a=end-of-candidates"+this.eol}printRTPRelated(V){if(!V.payloads)return"";const ce=V.payloads;let ge="";ge+=V.rtcpFeedbackWildcards.map((tt=>this.printRTCPFeedback("*",tt))).join("");for(const tt of ce)ge+=this.printRtpMap(tt.payloadType,tt.rtpMap),ge+=this.printFmtp(tt.payloadType,tt.fmtp),ge+=tt.rtcpFeedbacks.map((un=>this.printRTCPFeedback(tt.payloadType,un))).join("");return ge}printFmtp(V,ce){if(!ce)return"";const ge=Object.keys(ce.parameters);return ge.length===1&&ce.parameters[ge[0]]===null?"a=fmtp:".concat(V).concat(g).concat(ge[0]).concat(this.eol):"a=fmtp:".concat(V).concat(g).concat(Object.keys(ce.parameters).map((tt=>"".concat(tt,"=").concat(ce.parameters[tt]))).join(";")).concat(this.eol)}printRtpMap(V,ce){return ce?"a=rtpmap:".concat(V).concat(g).concat(ce.encodingName,"/").concat(ce.clockRate).concat(ce.encodingParameters?"/".concat(ce.encodingParameters):"").concat(this.eol):""}printRTCPFeedback(V,ce){let ge="a=rtcp-fb:".concat(V).concat(g),tt=ce;return tt.type==="trr-int"?ge+="ttr-int".concat(g).concat(tt.interval):(ge+="".concat(tt.type),tt.parameter&&(ge+="".concat(g).concat(tt.parameter),tt.additional&&(ge+="".concat(g).concat(tt.additional)))),ge+this.eol}printPtime(V){return V===void 0?"":"a=ptime:".concat(V).concat(this.eol)}printMaxPtime(V){return V===void 0?"":"a=maxptime:".concat(V).concat(this.eol)}printDirection(V){return V===void 0?"":"a=".concat(V).concat(this.eol)}printSSRC(V){return V.map((ce=>Object.keys(ce.attributes).map((ge=>"a=ssrc:".concat(ce.ssrcId.toString(10)).concat(g).concat(ge).concat(ce.attributes[ge]?":".concat(ce.attributes[ge]):"").concat(this.eol))).join(""))).join("")}printRTCPMux(V){return V===void 0?"":"a=rtcp-mux".concat(this.eol)}printRTCPMuxOnly(V){return V===void 0?"":"a=rtcp-mux-only".concat(this.eol)}printRTCPRsize(V){return V===void 0?"":"a=rtcp-rsize".concat(this.eol)}printRTCP(V){if(V===void 0)return"";let ce="a=rtcp:".concat(V.port);return V.netType&&(ce+="".concat(g).concat(V.netType)),V.addressType&&(ce+="".concat(g).concat(V.addressType)),V.address&&(ce+="".concat(g).concat(V.address)),ce+this.eol}printMSId(V){return V.map((ce=>"a=msid:".concat(ce.id).concat(ce.appdata?"".concat(g).concat(ce.appdata):"").concat(this.eol))).join("")}printImageattr(V){return V.map((ce=>"a=imageattr:".concat(ce).concat(this.eol))).join("")}printRid(V){return V.map((ce=>{let ge="a=rid:".concat(ce.id).concat(g).concat(ce.direction);return ce.payloads&&(ge+="".concat(g,"pt=").concat(ce.payloads.join(","))),ce.params.length>0&&(ge+="".concat(g).concat(ce.params.map((tt=>tt.type==="depend"?"depend=".concat(tt.rids.join(",")):"".concat(tt.type,"=").concat(tt.val))).join(";"))),ge+this.eol})).join("")}printSimulcast(V){return V===void 0?"":"a=simulcast:".concat(V).concat(this.eol)}printSCTPPort(V){return V===void 0?"":"a=sctp-port:".concat(V).concat(this.eol)}printMaxMessageSize(V){return V===void 0?"":"a=max-message-size:".concat(V).concat(this.eol)}printMid(V){return V===void 0?"":"a=mid:".concat(V).concat(this.eol)}printSSRCGroups(V){return V.map((ce=>"a=ssrc-group:".concat(ce.semantic).concat(ce.ssrcIds.map((ge=>"".concat(g).concat(ge.toString(10)))).join("")).concat(this.eol))).join("")}}function ot(Ke){return new We().parse(Ke)}function wt(Ke,V){return new ir().print(Ke,V)}}},r={};function s(a){if(r[a])return r[a].exports;var c=r[a]={exports:{}};return t[a](c,c.exports,s),c.exports}return s.d=(a,c)=>{for(var d in c)s.o(c,d)&&!s.o(a,d)&&Object.defineProperty(a,d,{enumerable:!0,get:c[d]})},s.o=(a,c)=>Object.prototype.hasOwnProperty.call(a,c),s.r=a=>{typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(a,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(a,"__esModule",{value:!0})},s(8)})();function nc(t){return W9.parse(t)}function Zm(t,r){return W9.print(t,r)}var Xme=wc("Array","keys"),Jme=Id,Qme=Vr,Zme=O,ege=Xme,u2=Array.prototype,tge={DOMTokenList:!0,NodeList:!0},nge=function(t){var r=t.keys;return t===u2||Zme(u2,t)&&r===u2.keys||Qme(tge,Jme(t))?ege:r},rc=l(nge);function oi(t,r,s){return(r=(function(a){var c=(function(d,h){if(typeof d!="object"||!d)return d;var m=d[Symbol.toPrimitive];if(m!==void 0){var g=m.call(d,"string");if(typeof g!="object")return g;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(d)})(a);return typeof c=="symbol"?c:c+""})(r))in t?Object.defineProperty(t,r,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[r]=s,t}function G9(t,r){var s=Object.keys(t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);r&&(a=a.filter((function(c){return Object.getOwnPropertyDescriptor(t,c).enumerable}))),s.push.apply(s,a)}return s}function mn(t){for(var r=1;r<arguments.length;r++){var s=arguments[r]!=null?arguments[r]:{};r%2?G9(Object(s),!0).forEach((function(a){oi(t,a,s[a])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(s)):G9(Object(s)).forEach((function(a){Object.defineProperty(t,a,Object.getOwnPropertyDescriptor(s,a))}))}return t}const H9=new class extends Zr{constructor(){super(...arguments),oi(this,"currentUploadLogID",0)}reportLogUploadError(t){const{errorRange:r}=t;r[r.length-1]&&r[r.length-1]>this.currentUploadLogID&&(this.currentUploadLogID=r[r.length-1],this.emit("REPORT_LOG_UPLOAD",t))}};class rge{constructor(r){oi(this,"logger",void 0),oi(this,"prefixLists",[]),this.logger=r}debug(){for(var r=arguments.length,s=new Array(r),a=0;a<r;a++)s[a]=arguments[a];this.logger.debug(...this.prefixLists,...s)}info(){for(var r=arguments.length,s=new Array(r),a=0;a<r;a++)s[a]=arguments[a];this.logger.info(...this.prefixLists,...s)}warning(){for(var r=arguments.length,s=new Array(r),a=0;a<r;a++)s[a]=arguments[a];this.logger.warning(...this.prefixLists,...s)}error(){for(var r=arguments.length,s=new Array(r),a=0;a<r;a++)s[a]=arguments[a];this.logger.error(...this.prefixLists,...s)}prefix(r){return this.prefixLists.push(r),this}popPrefix(){return this.prefixLists.pop(),this}}function d2(){const t=new Date;return t.toTimeString().split(" ")[0]+":"+t.getMilliseconds()}function $9(){const t=new Date,r=/((\d+:){2}\d+)/.exec(new Date().toUTCString());return r?(r==null?void 0:r[0])+":"+t.getUTCMilliseconds():t.toTimeString().split(" ")[0]+":"+t.getMilliseconds()}const eu={DEBUG:0,INFO:1,WARNING:2,ERROR:3,NONE:4},x1=Date.now(),mT=t=>{for(const r in eu)if(Object.prototype.hasOwnProperty.call(eu,r)&&eu[r]===t)return r;return"DEFAULT"},M=new class{constructor(){oi(this,"proxyServerURL",void 0),oi(this,"logLevel",eu.DEBUG),oi(this,"uploadState","collecting"),oi(this,"uploadLogWaitingList",[]),oi(this,"uploadLogUploadingList",[]),oi(this,"uploadErrorCount",0),oi(this,"currentLogID",0),oi(this,"url",void 0),oi(this,"extLog",((t,r)=>{this.appendLogToWaitingList(t,...r)}))}debug(){for(var t=arguments.length,r=new Array(t),s=0;s<t;s++)r[s]=arguments[s];const a=[eu.DEBUG].concat(r);this.log.apply(this,a)}info(){for(var t=arguments.length,r=new Array(t),s=0;s<t;s++)r[s]=arguments[s];const a=[eu.INFO].concat(r);this.log.apply(this,a)}warning(){for(var t=arguments.length,r=new Array(t),s=0;s<t;s++)r[s]=arguments[s];const a=[eu.WARNING].concat(r);this.log.apply(this,a)}warn(){this.warning(...arguments)}error(){for(var t=arguments.length,r=new Array(t),s=0;s<t;s++)r[s]=arguments[s];const a=[eu.ERROR].concat(r);this.log.apply(this,a)}upload(){for(var t=arguments.length,r=new Array(t),s=0;s<t;s++)r[s]=arguments[s];const a=[eu.DEBUG].concat(r);this.uploadLog.apply(this,a)}setLogLevel(t){t=Math.min(Math.max(0,t),4),this.logLevel=t}enableLogUpload(){gr("UPLOAD_LOG",!0)}disableLogUpload(){gr("UPLOAD_LOG",!1),this.uploadLogUploadingList=[],this.uploadLogWaitingList=[]}setProxyServer(t){this.proxyServerURL=t}prefix(t){return new rge(this).prefix(t)}log(){for(var t=arguments.length,r=new Array(t),s=0;s<t;s++)r[s]=arguments[s];if(Date.now()-x1<100)return void setTimeout((()=>{this.log(...r)}),Date.now()-x1);const a=Math.max(0,Math.min(4,r[0]));if(r[0]=d2()+" Agora-SDK [".concat(mT(a),"]:"),this.appendLogToWaitingList(a,...r),a<this.logLevel)return;const c=d2()+" %cAgora-SDK [".concat(mT(a),"]:");let d=[];if(!oe("USE_NEW_LOG"))switch(a){case eu.DEBUG:d=[c,"color: #64B5F6;"].concat(r.slice(1)),console.log.apply(console,d);break;case eu.INFO:d=[c,"color: #1E88E5; font-weight: bold;"].concat(r.slice(1)),console.log.apply(console,d);break;case eu.WARNING:d=[c,"color: #FB8C00; font-weight: bold;"].concat(r.slice(1)),console.warn.apply(console,d);break;case eu.ERROR:d=[c,"color: #B00020; font-weight: bold;"].concat(r.slice(1)),console.error.apply(console,d)}}uploadLog(){for(var t=arguments.length,r=new Array(t),s=0;s<t;s++)r[s]=arguments[s];if(Date.now()-x1<100)return void setTimeout((()=>{this.uploadLog(...r)}),Date.now()-x1);const a=Math.max(0,Math.min(4,r[0]));r[0]=d2()+" Agora-SDK [".concat(mT(a),"]:"),this.appendLogToWaitingList(a,...r)}appendLogToWaitingList(t){if(!oe("UPLOAD_LOG"))return;for(var r=arguments.length,s=new Array(r>1?r-1:0),a=1;a<r;a++)s[a-1]=arguments[a];Array.isArray(s[0])?s[0][0]=$9()+" Agora-SDK [".concat(mT(t),"]:"):s[0]=$9()+" Agora-SDK [".concat(mT(t),"]:");let c="";s.forEach((d=>{typeof d=="object"&&(d=JSON.stringify(d)),c+="".concat(d," ")})),this.uploadLogWaitingList.push({payload_str:c,log_level:t,log_item_id:this.currentLogID++}),this.uploadState==="uploading"&&this.uploadLogUploadingList.length===0&&this.uploadLogInterval()}startUpload(){this.uploadState="uploading",this.uploadLogUploadingList.length===0&&this.uploadLogInterval()}async uploadLogs(){const t=this.uploadLogUploadingList,r={sdk_version:Zl,process_id:oe("PROCESS_ID"),payload:JSON.stringify(t)};return Xd((async()=>{const s=await Na.post(this.url||(this.proxyServerURL?"https://".concat(this.proxyServerURL,"/ls/?h=").concat(oe("LOG_UPLOAD_SERVER"),"&p=443&d=upload/v1"):"https://".concat(oe("LOG_UPLOAD_SERVER"),"/upload/v1")),r,{responseType:"text"});if(s.data!=="OK"){const a=new Error("unexpected upload log response");throw a.response=s,a}}),(()=>(this.uploadLogUploadingList=[],!1)),(s=>{const a={status:-1,message:s.message,errorRange:t.map((c=>c.log_item_id))};return s.response?(a.status=s.response.status,a.data=s.response.data,a.headers=s.response.headers):s.request&&(a.status=s.request.status),H9.reportLogUploadError(a),!0}),{timeout:oe("UPLOAD_LOG_REQUEST_RETRY_INTERVAL"),maxRetryTimeout:oe("UPLOAD_LOG_REQUEST_MAX_RETRY_INTERVAL")})}uploadLogInterval(){this.uploadLogUploadingList.length===0&&this.uploadLogWaitingList.length===0||(this.uploadLogUploadingList.length===0&&(this.uploadLogUploadingList=this.uploadLogWaitingList.splice(0,oe("UPLOAD_LOG_LENGTH_EACH_TIME"))),this.uploadLogs().then((()=>{this.uploadErrorCount=0,this.uploadLogWaitingList.length>0&&window.setTimeout((()=>this.uploadLogInterval()),oe("UPLOAD_LOG_INTERVAL"))})).catch((t=>{this.uploadErrorCount+=1,this.uploadErrorCount<2?window.setTimeout((()=>this.uploadLogInterval()),oe("UPLOAD_LOG_TWICE_RETRY_INTERVAL_V1")):window.setTimeout((()=>this.uploadLogInterval()),oe("UPLOAD_LOG_RETRY_INTERVAL_V1"))})))}};var K9;function ige(t){return Rs(t.reportId,"params.reportId",0,100,!1),Rs(t.category,"params.category",0,100,!1),Rs(t.event,"params.event",0,100,!1),Rs(t.label,"params.label",0,100,!1),vr(t.value,"params.value",Number.MIN_SAFE_INTEGER,Number.MAX_SAFE_INTEGER,!1),!0}(K9={}).FREE="free",K9.UPLOADING="uploading",(function(t){t[t.MISC=0]="MISC",t[t.INTERNAL_EVENT=1]="INTERNAL_EVENT",t[t.PUBLIC_EVENT=2]="PUBLIC_EVENT",t[t.WEB_EVENT=3]="WEB_EVENT",t[t.INTERNAL_API=4]="INTERNAL_API",t[t.WEB_API=5]="WEB_API",t[t.PUBLIC_API=6]="PUBLIC_API"})({});const sge={sid:"",lts:0,success:null,cname:null,uid:null,peer:null,cid:null,elapse:null,extend:null,vid:0};let es=(function(t){return t.PUBLISH="publish",t.SUBSCRIBE="subscribe",t.WS_COMPRESSOR_INIT="ws_compressor_init",t.SESSION_INIT="session_init",t.JOIN_CHOOSE_SERVER="join_choose_server",t.REQ_USER_ACCOUNT="req_user_account",t.JOIN_GATEWAY="join_gateway",t.REJOIN_GATEWAY="rejoin_gateway",t.STREAM_SWITCH="stream_switch",t.REQUEST_PROXY_WORKER_MANAGER="request_proxy_worker_manager",t.REQUEST_PROXY_APPCENTER="request_proxy_appcenter",t.FIRST_VIDEO_RECEIVED="first_video_received",t.FIRST_AUDIO_RECEIVED="first_audio_received",t.FIRST_VIDEO_DECODE="first_video_decode",t.FIRST_AUDIO_DECODE="first_audio_decode",t.XLA_PEER_FIRST_VIDEO_FRAME="xla_peer_first_video_frame",t.ON_ADD_AUDIO_STREAM="on_add_audio_stream",t.ON_ADD_VIDEO_STREAM="on_add_video_stream",t.ON_UPDATE_STREAM="on_update_stream",t.ON_REMOVE_STREAM="on_remove_stream",t.USER_ANALYTICS="req_user_analytics",t.PC_STATS="pc_stats",t.UPDATE_REMOTE_RTPCAPABILITIES="update_remote_rtpCapabilities",t.AB_TEST="ab_test",t})({}),Br=(function(t){return t.SESSION="io.agora.pb.Wrtc.Session",t.JOIN_CHOOSE_SERVER="io.agora.pb.Wrtc.JoinChooseServer",t.REQ_USER_ACCOUNT="io.agora.pb.Wrtc.ReqUserAccount",t.JOIN_GATEWAY="io.agora.pb.Wrtc.JoinGateway",t.RE_JOIN_GATEWAY="io.agora.pb.Wrtc.ReJoinGateway",t.PUBLISH="io.agora.pb.Wrtc.Publish",t.SUBSCRIBE="io.agora.pb.Wrtc.Subscribe",t.WS_COMPRESSOR_INIT="io.agora.pb.Wrtc.WsCompressorInit",t.STREAM_SWITCH="io.agora.pb.Wrtc.StreamSwitch",t.AUDIO_SENDING_STOPPED="io.agora.pb.Wrtc.AudioSendingStopped",t.VIDEO_SENDING_STOPPED="io.agora.pb.Wrtc.VideoSendingStopped",t.REQUEST_PROXY_APPCENTER="io.agora.pb.Wrtc.RequestProxyAppCenter",t.REQUEST_PROXY_WORKER_MANAGER="io.agora.pb.Wrtc.RequestProxyWorkerManager",t.API_INVOKE="io.agora.pb.Wrtc.ApiInvoke",t.FIRST_VIDEO_RECEIVED="io.agora.pb.Wrtc.FirstVideoReceived",t.FIRST_AUDIO_RECEIVED="io.agora.pb.Wrtc.FirstAudioReceived",t.FIRST_VIDEO_DECODE="io.agora.pb.Wrtc.FirstVideoDecode",t.FIRST_AUDIO_DECODE="io.agora.pb.Wrtc.FirstAudioDecode",t.XLA_PEER_FIRST_VIDEO_FRAME="io.agora.pb.Wrtc.XLAPeerFirstVideoFrame",t.ON_ADD_AUDIO_STREAM="io.agora.pb.Wrtc.OnAddAudioStream",t.ON_ADD_VIDEO_STREAM="io.agora.pb.Wrtc.OnAddVideoStream",t.ON_UPDATE_STREAM="io.agora.pb.Wrtc.OnUpdateStream",t.ON_REMOVE_STREAM="io.agora.pb.Wrtc.OnRemoveStream",t.JOIN_CHANNEL_TIMEOUT="io.agora.pb.Wrtc.JoinChannelTimeout",t.PEER_PUBLISH_STATUS="io.agora.pb.Wrtc.PeerPublishStatus",t.WORKER_EVENT="io.agora.pb.Wrtc.WorkerEvent",t.AP_WORKER_EVENT="io.agora.pb.Wrtc.APWorkerEvent",t.JOIN_WEB_PROXY_AP="io.agora.pb.Wrtc.JoinWebProxyAP",t.WEBSOCKET_QUIT="io.agora.pb.Wrtc.WebSocketQuit",t.USER_ANALYTICS="io.agora.pb.Wrtc.UserAnalytics",t.AUTOPLAY_FAILED="io.agora.pb.Wrtc.AutoplayFailed",t.PC_STATS="io.agora.pb.Wrtc.PCStats",t.UPDATE_REMOTE_RTPCAPABILITIES="io.agora.pb.Wrtc.UpdateRemoteRTPCapabilities",t.AB_TEST="io.agora.pb.Wrtc.ABTest",t})({});(function(t){t[t.WORKER_EVENT=156]="WORKER_EVENT",t[t.AP_WORKER_EVENT=160]="AP_WORKER_EVENT"})({});let oge=(function(t){return t[t.SESSION=26]="SESSION",t[t.JOIN_CHOOSE_SERVER=27]="JOIN_CHOOSE_SERVER",t[t.REQ_USER_ACCOUNT=196]="REQ_USER_ACCOUNT",t[t.JOIN_GATEWAY=28]="JOIN_GATEWAY",t[t.PUBLISH=30]="PUBLISH",t[t.SUBSCRIBE=29]="SUBSCRIBE",t[t.WS_COMPRESSOR_INIT=9430]="WS_COMPRESSOR_INIT",t[t.STREAM_SWITCH=32]="STREAM_SWITCH",t[t.AUDIO_SENDING_STOPPED=33]="AUDIO_SENDING_STOPPED",t[t.VIDEO_SENDING_STOPPED=34]="VIDEO_SENDING_STOPPED",t[t.REQUEST_PROXY_APPCENTER=35]="REQUEST_PROXY_APPCENTER",t[t.REQUEST_PROXY_WORKER_MANAGER=36]="REQUEST_PROXY_WORKER_MANAGER",t[t.API_INVOKE=41]="API_INVOKE",t[t.FIRST_VIDEO_RECEIVED=348]="FIRST_VIDEO_RECEIVED",t[t.FIRST_AUDIO_RECEIVED=349]="FIRST_AUDIO_RECEIVED",t[t.FIRST_VIDEO_DECODE=350]="FIRST_VIDEO_DECODE",t[t.FIRST_AUDIO_DECODE=351]="FIRST_AUDIO_DECODE",t[t.ON_ADD_AUDIO_STREAM=352]="ON_ADD_AUDIO_STREAM",t[t.ON_ADD_VIDEO_STREAM=353]="ON_ADD_VIDEO_STREAM",t[t.ON_UPDATE_STREAM=356]="ON_UPDATE_STREAM",t[t.ON_REMOVE_STREAM=355]="ON_REMOVE_STREAM",t[t.JOIN_CHANNEL_TIMEOUT=407]="JOIN_CHANNEL_TIMEOUT",t[t.PEER_PUBLISH_STATUS=408]="PEER_PUBLISH_STATUS",t[t.WORKER_EVENT=156]="WORKER_EVENT",t[t.AP_WORKER_EVENT=160]="AP_WORKER_EVENT",t[t.JOIN_WEB_PROXY_AP=700]="JOIN_WEB_PROXY_AP",t[t.WEBSOCKET_QUIT=671]="WEBSOCKET_QUIT",t[t.USER_ANALYTICS=1e4]="USER_ANALYTICS",t[t.AUTOPLAY_FAILED=9178]="AUTOPLAY_FAILED",t})({});function Wt(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return function(r,s,a){const c=a.value;if(typeof c=="function"){const d=t.className||r.__className__||(r.constructor.name==="AgoraRTCClient"?"Client":r.constructor.name);a.value=function(){for(var h,m=arguments.length,g=new Array(m),v=0;v<m;v++)g[v]=arguments[v];let w=g;if(t.argsMap)try{w=t.argsMap(this,...g)}catch(A){M.warning(A),w=[]}try{JSON.stringify(w)}catch{M.warning("arguments for method ".concat(d,".").concat(String(s)," not serializable for apiInvoke.")),w=[]}const I=(t.report||It).reportApiInvoke(this._sessionId||null,{id:this._clientId||((h=this.store)===null||h===void 0?void 0:h.clientId)||this._ID,name:"".concat(d,".").concat(String(s)),options:w,tag:$r.TRACER,reportResult:t.reportResult},t.throttleTime);try{const A=c.apply(this,g);return A instanceof mt?A.then((N=>(I.onSuccess(t.reportResult&&N),N))).catch((N=>{throw I.onError(N),N})):(I.onSuccess(t.reportResult&&A),A)}catch(A){throw I.onError(A),A}}}return a}}const It=new class{constructor(){oi(this,"baseInfoMap",new Map),oi(this,"proxyServer",void 0),oi(this,"eventUploadTimer",void 0),oi(this,"setSessionIdTimer",void 0),oi(this,"url",void 0),oi(this,"sids",new Set),oi(this,"backupUrl",void 0),oi(this,"_appId",void 0),oi(this,"_aid",0),oi(this,"keyEventUploadPendingItems",[]),oi(this,"normalEventUploadPendingItems",[]),oi(this,"apiInvokeUploadPendingItems",[]),oi(this,"apiInvokeCount",0),oi(this,"apiInvokeLoggedCount",0),oi(this,"ltsList",[]),oi(this,"lastSendNormalEventTime",Date.now()),oi(this,"customReportCounterTimer",void 0),oi(this,"customReportCount",0),oi(this,"extApiInvoke",(async t=>{for(const r of t){const s=mn(mn({},r),{},{sid:null,invokeId:++this.apiInvokeCount,tag:$r.TRACER});this.sendApiInvoke(s)}})),this.eventUploadTimer=window.setInterval(this.doSend.bind(this),oe("EVENT_REPORT_SEND_INTERVAL")),this.setSessionIdTimer=window.setInterval(this.appendSessionId.bind(this),oe("EVENT_REPORT_SEND_INTERVAL"))}getBaseInfoBySessionId(t){return this.baseInfoMap.get(t)}setAppId(t){this._appId=t,this._aid=parseInt(t.replace(/[a-fA-F0-9]{8}/g,(r=>{let[s,a]=r;return s+a})),16)||0}reportApiInvoke(t,r,s){r.timeout=r.timeout||6e4,r.reportResult=r.reportResult===void 0||r.reportResult;const a=Date.now();this.apiInvokeCount+=1;const c=this.apiInvokeCount,d=!!oe("SHOW_REPORT_INVOKER_LOG"),h=!!oe("SHOW_REPORT_USER_INVOKER_LOG"),m=d||h&&r.id;m&&(this.apiInvokeLoggedCount+=1);const g=this.apiInvokeLoggedCount;function v(N,H){if(m){let B="[apiInvoke-".concat(g,"]");if(r.id&&(B+="[".concat(r.id,"]")),r.name&&(B+="[".concat(r.name,"]"),r.name===pi.JOIN))return M.info("".concat(B," ").concat(N));M.info("".concat(B," ").concat(N),N==="start"?r.options:H||"")}}const w=()=>({tag:r.tag,invokeId:c,sid:t,name:r.name,apiInvokeTime:a,options:r.options,states:r.states||null});v("start");let I=!1;Is(r.timeout).then((()=>{I||(this.sendApiInvoke(mn(mn({},w()),{},{error:te.API_INVOKE_TIMEOUT,success:!1})),v("timeout"))}));const A=new Le(te.UNEXPECTED_ERROR,"".concat(r.name,": this api invoke is end"));return{onSuccess:N=>{const H=()=>{if(I)throw A;return I=!0,this.sendApiInvoke(mn(mn({},w()),{},{success:!0},r.reportResult&&{result:N})),v("onSuccess"),N};return s?R9(H,r.name+"Success",s,(()=>I=!0)):H()},onError:N=>{const H=()=>{if(I)throw N;I=!0,this.sendApiInvoke(mn(mn({},w()),{},{success:!1,error:N})),v("onFailure",N.toString())};return s?R9(H,r.name+"Error",s,(()=>I=!0)):H()}}}sessionInit(t,r){if(this.baseInfoMap.has(t))return;const s=Date.now(),a=this.createBaseInfo(t,s);a.cname=r.cname;const c=Object.assign({},{willUploadConsoleLog:oe("UPLOAD_LOG"),maxTouchPoints:navigator.maxTouchPoints,areaVersion:o2?"global":"oversea",areas:oe("AREAS")&&oe("AREAS").join(",")},r.extend),{stringUid:d,channelProfile:h,channelMode:m,isABTestSuccess:g,lsid:v,clientRole:w}=r,I=Date.now(),A=mn(mn({},a),{},{eventType:es.SESSION_INIT,appid:r.appid,browser:navigator.userAgent,buildFormat:r.buildFormat,build:c2,lts:I,elapse:I-s,extend:JSON.stringify(c),mode:r.mode,process:oe("PROCESS_ID"),appType:oe("APP_TYPE"),success:!0,version:Zl,stringUid:d,channelProfile:h,channelMode:m,isABTestSuccess:g,lsid:v,clientType:rt(N=window.navigator.userAgent).call(N,"AgoraWebView")?42:20,clientRole:w,serviceId:oe("PROCESS_ID"),extensionID:oe("PLUGIN_INFO").join(",")||""});var N;this.send({type:Br.SESSION,data:A},!0)}joinChooseServer(t,r){const s=this.baseInfoMap.get(t);if(!s)return;const a=s.info,c=Date.now(),d=mn(mn({},a),{},{role:r.role,eventType:es.JOIN_CHOOSE_SERVER,lts:c,eventElapse:r.elapse||c-r.lts,chooseServerAddr:r.csAddr,errorCode:r.ec,elapse:c-s.startTime,success:r.succ,chooseServerAddrList:JSON.stringify(r.serverList),uid:r.uid?parseInt(r.uid):null,cid:r.cid?parseInt(r.cid):null,chooseServerIp:r.csIp||"",opid:r.opid,unilbsServerIds:r.unilbsServerIds,extend:r.extend||void 0,isHttp3:r.isHttp3,corssRegionTagReq:r.corssRegionTagReq||void 0,corssRegionTagRes:r.corssRegionTagRes||void 0,resourceTimingInfo:r.resourceTimingInfo||void 0});this.send({type:Br.JOIN_CHOOSE_SERVER,data:d},!0)}reqUserAccount(t,r){const s=this.baseInfoMap.get(t);if(!s)return;const a=s.info,c=Date.now(),d=mn(mn({},a),{},{eventType:es.REQ_USER_ACCOUNT,lts:c,success:r.success,serverAddress:r.serverAddr,stringUid:r.stringUid,uid:r.uid,errorCode:r.errorCode,elapse:r.elapse||c-s.startTime,eventElapse:c-r.lts,extend:JSON.stringify(r.extend)});this.send({type:Br.REQ_USER_ACCOUNT,data:d},!0)}joinGateway(t,r){const s=this.baseInfoMap.get(t);if(!s)return;const a=s.info;r.vid&&(a.vid=r.vid),a.uid=r.uid,a.cid=r.cid;const c=Date.now(),{firstSuccess:d,addr:h,isProxy:m}=r,g=c-s.startTime,v=mn(mn({},a),{},{eventType:es.JOIN_GATEWAY,lts:c,gatewayAddr:r.addr,success:r.succ,errorCode:r.ec,errorMsg:r.errorMsg||"",elapse:g,eventElapse:c-r.lts,firstSuccess:d,signalChannel:r.signalChannel,preload:r.preload?1:0,installId:s2(),isABTestSuccess:r.isABTestSuccess?1:0}),w=v.success?1:0;if(r.succ&&(s.lastJoinSuccessTime=c),d)this.send({type:Br.JOIN_GATEWAY,data:v},!0);else{let I;if(h)if(m){const N=h.match(/h=(\d{1,3}-){3}\d{1,3}/g),H=h.match(/p=[0-9]{1,6}/g);I={isSuccess:w,gatewayIp:N&&N.length?N[0].split("=")[1].replace(/-/g,"."):"",port:H&&H.length?H[0].split("=")[1]:"",isProxy:m?1:0}}else{const N=h.match(/wss:\/\/(\d{1,3}-){3}\d{1,3}/g),H=h.match(/(:|p=)[0-9]{1,6}/g);I={isSuccess:w,gatewayIp:N&&N.length?N[0].split("//")[1].replace(/-/g,"."):"",port:H&&H.length?H[0].split(/:|p=/g)[1]:"",isProxy:m?1:0}}else I={isSuccess:w,gatewayIp:"",port:"",isProxy:m?1:0};delete v.success,delete v.eventType,delete v.firstSuccess,v.vid=Number(v.vid);const A=Object.assign({},v,I,{eventType:es.REJOIN_GATEWAY});this.send({type:Br.RE_JOIN_GATEWAY,data:A},!0)}}joinChannelTimeout(t,r){const s=this.baseInfoMap.get(t);if(!s)return;const a=Date.now(),c=mn(mn({},s.info),{},{lts:a,timeout:r,elapse:a-s.startTime});this.send({type:Br.JOIN_CHANNEL_TIMEOUT,data:c},!0)}publish(t,r){const s=this.baseInfoMap.get(t);if(!s)return;const a=s.info,c=Date.now(),d=mn(mn({},a),{},{eventType:es.PUBLISH,lts:c,eventElapse:r.eventElapse,elapse:c-s.startTime,success:r.succ,errorCode:r.ec,videoName:r.videoName,audioName:r.audioName,screenName:r.screenName,screenshare:r.screenshare,audio:r.audio,video:r.video,p2pid:r.p2pid,publishRequestid:r.publishRequestid});this.send({type:Br.PUBLISH,data:d},!0)}subscribe(t,r,s){const a=this.baseInfoMap.get(t);if(!a)return;const c=a.info,d=Date.now(),h=mn(mn({},c),{},{eventType:es.SUBSCRIBE,lts:d,eventElapse:r.eventElapse,elapse:d-a.startTime,success:r.succ,errorCode:r.ec,video:r.video,audio:r.audio,subscribeRequestid:r.subscribeRequestid,p2pid:r.p2pid,preSsrc:r.preSsrc?1:0},s&&{extend:JSON.stringify({isMassSubscribe:!0})});typeof r.peerid=="string"?h.peerSuid=r.peerid:h.peer=r.peerid,this.send({type:Br.SUBSCRIBE,data:h},!0)}wsCompressorInit(t){var r;const s=[...rc(r=this.baseInfoMap).call(r)],a=s.length?s[0]:"UnableToGetSid",c=this.baseInfoMap.get(a);if(!c)return;const d=c.info,h=Date.now(),m=mn(mn({},d),{},{eventType:es.WS_COMPRESSOR_INIT,lts:h,eventElapse:t.eventElapse,elapse:h-c.startTime,status:t.status?1:2});this.send({type:Br.WS_COMPRESSOR_INIT,data:m},!0)}firstXLAPeerFirstVideoFrame(t,r){const s=this.baseInfoMap.get(t);if(!s)return;const a=s.info,c=Date.now(),d=r.peerPubStatusMs-(s.lastJoinSuccessTime||c),h=mn(mn({},a),{},{elapse:c-s.startTime,eventType:es.XLA_PEER_FIRST_VIDEO_FRAME,lts:c,peer:r.peer,width:r.width,height:r.height,ssrc:r.ssrc,p2pid:r.p2pid,peerPublishDuration:r.peerPublishDuration,joinChannelSuccessElapse:d,peerPubStatusMs:r.peerPubStatusMs-r.joinChannelStart,availablePublish:r.peerPublishDuration>d?1:0,preloadStart:Math.max(r.preloadStart-r.joinChannelStart,0),preloadEnd:Math.max(r.preloadEnd-r.joinChannelStart,0),encrypt:Math.max(r.apStart-r.joinChannelStart,0),ap:Math.max(r.apEnd-r.joinChannelStart,0),sua:Math.max(r.suaEnd-r.joinChannelStart,0),beforeConnect:Math.max(r.beforeConnect-r.joinChannelStart,0),peerRecevier:Math.max(r.peerReceiver-r.joinChannelStart,0),ice:Math.max(r.ice-r.joinChannelStart,0),pc:Math.max(r.pc-r.joinChannelStart,0),signalConnected:Math.max(r.signalConnected-r.joinChannelStart,0),joinReq:Math.max(r.joinReq-r.joinChannelStart,0),joinRes:Math.max(r.joinRes-r.joinChannelStart,0),userJoinNotify:Math.max(r.userJoinNotify-r.joinChannelStart,0),videoSsrcNotify:Math.max(r.videoAddNotify-r.joinChannelStart,0),subscribeDelayMs:Math.max(r.subscribeStart-r.videoAddNotify,0),subscribeStart:Math.max(r.subscribeStart-r.joinChannelStart,0),subscribeEnd:Math.max(r.subscribeEnd-r.joinChannelStart,0),firstReceived:Math.max(r.firstReceived-r.joinChannelStart,0),firstDecoded:Math.max(r.firstDecoded-r.joinChannelStart,0),firstPreRender:Math.max(r.firstPreRender-r.joinChannelStart,0),firstRender:Math.max(r.firstRender-r.joinChannelStart,0),playDelayMs:Math.max(r.playStart-r.subscribeEnd,0),playStart:Math.max(r.playStart-r.joinChannelStart,0),playEnd:Math.max(r.playEnd-r.joinChannelStart,0),isPreSub:r.isPreSub?1:0,isPrePc:r.isPrePc?1:0,isPreInstantVideo:r.isPreInstantVideo?1:0});this.send({type:Br.XLA_PEER_FIRST_VIDEO_FRAME,data:h},!0)}firstRemoteVideoDecode(t,r,s,a){const c=this.baseInfoMap.get(t);if(!c)return;const d=c.info,h=Date.now(),m=mn(mn(mn({},d),a),{},{elapse:h-c.startTime,eventType:r,lts:h,firstDecodeFrame:Math.max((a.firstFrame||h)-c.startTime,0),apEnd:Math.max(a.apEnd-c.startTime,0),apStart:Math.max(a.apStart-c.startTime,0),joinGwEnd:Math.max(a.joinGwEnd-c.startTime,0),joinGwStart:Math.max(a.joinGwStart-c.startTime,0),pcEnd:Math.max(a.pcEnd-c.startTime,0),pcStart:Math.max(a.pcStart-c.startTime,0),subscriberEnd:Math.max(a.subscriberEnd-c.startTime,0),subscriberStart:Math.max(a.subscriberStart-c.startTime,0),videoAddNotify:Math.max(a.videoAddNotify-c.startTime,0)});this.send({type:s,data:m},!0)}firstRemoteFrame(t,r,s,a){const c=this.baseInfoMap.get(t);if(!c)return;const d=c.info,h=Date.now(),m=mn(mn(mn({},d),a),{},{elapse:h-c.startTime,eventType:r,lts:h});this.send({type:s,data:m},!0)}abTest(t,r){const s=this.baseInfoMap.get(t);if(!s)return;const a=s.info,c=Date.now(),d=mn(mn(mn({},a),r),{},{vid:a.vid===void 0?0:Number(a.vid),elapse:c-s.startTime,eventType:es.AB_TEST,lts:c});this.send({type:Br.AB_TEST,data:d},!0)}pcStats(t,r){const s=this.baseInfoMap.get(t);if(!s)return;const a=s.info,c=Date.now(),d=mn(mn(mn({},a),r),{},{vid:a.vid===void 0?0:Number(a.vid),elapse:c-s.startTime,eventType:es.PC_STATS,lts:c,preallocation:r.preallocation?1:0});this.send({type:Br.PC_STATS,data:d},!0)}updateRemoteRTPCapabilities(t,r){if(t){const s=this.baseInfoMap.get(t);if(!s)return;const a=s.info,c=Date.now(),d=mn(mn(mn({},a),r),{},{vid:a.vid===void 0?0:Number(a.vid),eventType:es.UPDATE_REMOTE_RTPCAPABILITIES,lts:c});this.send({type:Br.UPDATE_REMOTE_RTPCAPABILITIES,data:d},!0)}}onGatewayStream(t,r,s,a){const c=this.baseInfoMap.get(t);if(!c)return;const d=c.info,h=Date.now(),m=mn(mn(mn({},d),a),{},{eventType:r,lts:h});this.send({type:s,data:m},!0)}streamSwitch(t,r){const s=this.baseInfoMap.get(t);if(!s)return;const a=s.info,c=Date.now(),d=mn(mn({},a),{},{eventType:es.STREAM_SWITCH,lts:c,isDual:r.isdual,elapse:c-s.startTime,success:r.succ});this.send({type:Br.STREAM_SWITCH,data:d},!0)}requestProxyAppCenter(t,r){const s=this.baseInfoMap.get(t);if(!s)return;const a=s.info,c=Date.now(),d=mn(mn({},a),{},{eventType:es.REQUEST_PROXY_APPCENTER,lts:c,eventElapse:c-r.lts,elapse:c-s.startTime,APAddr:r.APAddr,workerManagerList:r.workerManagerList,response:r.response,errorCode:r.ec,success:r.succ});this.send({type:Br.REQUEST_PROXY_APPCENTER,data:d},!0)}requestProxyWorkerManager(t,r){const s=this.baseInfoMap.get(t);if(!s)return;const a=s.info,c=Date.now(),d=mn(mn({},a),{},{eventType:es.REQUEST_PROXY_WORKER_MANAGER,lts:c,eventElapse:c-r.lts,elapse:c-s.startTime,workerManagerAddr:r.workerManagerAddr,response:r.response,errorCode:r.ec,success:r.succ});this.send({type:Br.REQUEST_PROXY_WORKER_MANAGER,data:d},!0)}setProxyServer(t){this.proxyServer=t,t?M.debug("reportProxyServerurl: ".concat(t)):M.debug("disable reportProxyServerurl: ".concat(t))}peerPublishStatus(t,r){const s=this.baseInfoMap.get(t);if(!s)return;const a=s.info,c=Date.now(),d=mn(mn({},a),{},{subscribeElapse:r.subscribeElapse,peer:r.peer,peerPublishDuration:Math.max(r.audioPublishDuration,r.videoPublishDuration),audiotag:r.audioPublishDuration>0?1:-1,videotag:r.videoPublishDuration>0?1:-1,lts:c,elapse:c-s.startTime,joinChannelSuccessElapse:c-(s.lastJoinSuccessTime||c),peerPublishDurationVideo:r.videoPublishDuration,peerPublishDurationAudio:r.audioPublishDuration});this.send({type:Br.PEER_PUBLISH_STATUS,data:d},!0)}workerEvent(t,r){const s=this.baseInfoMap.get(t);if(!s)return;const a=s.info,c=Date.now();(function(d,h,m){const g=d[h];if(!g||typeof g!="string")return[d];d[h]="";const v=sp(JSON.stringify(d));let w=0;const I=[];let A=0;for(let N=0;N<g.length;N++)A+=g.charCodeAt(N)<=127?1:3,A<=m-v||(I[I.length]=et(et({},d),{},{[h]:g.substring(w,N)}),w=N,A=g.charCodeAt(N)<=127?1:3);return w!==g.length-1&&(I[I.length]=et(et({},d),{},{[h]:g.substring(w)})),I})(mn(mn(mn({},a),r),{},{elapse:c-s.startTime,lts:c,productType:"WebRTC"}),"payload",1300).forEach((d=>this.send({type:Br.WORKER_EVENT,data:d},!0)))}apworkerEvent(t,r){const s=this.baseInfoMap.get(t);if(!s)return;const a=s.info,c=Date.now(),d=mn(mn(mn({},a),r),{},{elapse:c-s.startTime,lts:c});this.send({type:Br.AP_WORKER_EVENT,data:d},!0)}joinWebProxyAP(t,r){const s=this.baseInfoMap.get(t);if(!s)return;const a=s.info,c=Date.now(),d=mn(mn(mn({},a),r),{},{elapse:c-s.startTime,lts:c,extend:r.extend||void 0});this.send({type:Br.JOIN_WEB_PROXY_AP,data:d},!0)}WebSocketQuit(t,r){const s=this.baseInfoMap.get(t);if(!s)return;const a=s.info,c=Date.now(),d=mn(mn(mn({},a),r),{},{elapse:c-s.startTime,lts:c});this.send({type:Br.WEBSOCKET_QUIT,data:d},!0)}async sendCustomReportMessage(t,r){if(this.customReportCount+=r.length,this.customReportCount>oe("CUSTOM_REPORT_LIMIT"))throw new Le(te.CUSTOM_REPORT_FREQUENCY_TOO_HIGH);this.customReportCounterTimer||(this.customReportCounterTimer=window.setInterval((()=>{this.customReportCount=0}),5e3));const s=Date.now(),a=r.map((c=>({type:Br.USER_ANALYTICS,data:mn(mn({sid:t},c),{},{lts:s})})));try{oe("NEW_REPORT_SERVER")?await this.postDataToStatsCollector2(a):await this.postDataToStatsCollector(a)}catch(c){throw M.error("send custom report message failed",c.toString()),new Le(te.CUSTOM_REPORT_SEND_FAILED,c.message)}}sendApiInvoke(t){const r=oe("NOT_REPORT_EVENT");if(t.tag&&rt(r)&&rt(r).call(r,t.tag))return!1;if(t.sid===null)return this.apiInvokeUploadPendingItems.push(t),!1;const s=this.baseInfoMap.get(t.sid);if(!s)return this.apiInvokeUploadPendingItems.push(t),!1;const{cname:a,uid:c,cid:d}=s.info;let h;if(t.lts=t.lts||Date.now(),t.error)if(t.error instanceof Le){const{code:g,message:v}=t.error;h=g||v||t.error.toString()}else h=t.error.toString();const m={invokeId:t.invokeId,sid:t.sid,cname:a,cid:d,uid:c,lts:t.lts,success:t.success,elapse:t.lts-s.startTime,execElapse:t.lts-t.apiInvokeTime,apiName:t.name,options:t.options?JSON.stringify(t.options):void 0,execStates:t.states?JSON.stringify(t.states):void 0,execResult:t.result?JSON.stringify(t.result):void 0,errorCode:t.error?h:void 0,errorMsg:t.error?JSON.stringify(t.error):void 0};return this.send({type:Br.API_INVOKE,data:m},!1),!0}addSid(t){this.sids.add(t)}removeSid(t){this.sids.delete(t)}appendSessionId(){const t=this.apiInvokeUploadPendingItems;if(t.length===0)return;const r=Array.from(this.sids).find((s=>s!==null));r&&t.forEach((s=>{s&&(s.sid=r,this.sendApiInvoke(Object.assign({},s)))})),t.length=0}send(t,r){if(r)return this.keyEventUploadPendingItems.push(t),void this.sendItems(this.keyEventUploadPendingItems,!0);this.normalEventUploadPendingItems.push(t),this.normalEventUploadPendingItems.length>oe("NORMAL_EVENT_QUEUE_CAPACITY")&&this.normalEventUploadPendingItems.splice(0,1),this.normalEventUploadPendingItems.length>=10&&this.sendItems(this.normalEventUploadPendingItems,!1)}doSend(){this.keyEventUploadPendingItems.length>0&&this.sendItems(this.keyEventUploadPendingItems,!0),this.normalEventUploadPendingItems.length>0&&Date.now()-this.lastSendNormalEventTime>=5e3&&this.sendItems(this.normalEventUploadPendingItems,!1)}sendItems(t,r){const s=[],a=[];for(;t.length;){const d=t.shift();s.length<20?s.push(d):a.push(d)}t.push(...a);for(const d of[...s]){var c;this.ltsList.indexOf(d.data.lts)!==-1?(d.data.lts=this.ltsList[this.ltsList.length-1]+1,this.ltsList.push(d.data.lts)):(this.ltsList.push(d.data.lts),q_(c=this.ltsList).call(c,((h,m)=>h-m)))}return r||(this.lastSendNormalEventTime=Date.now()),oe("ENABLE_EVENT_REPORT")&&s.length&&(oe("NEW_REPORT_SERVER")?this.postDataToStatsCollector2(s):this.postDataToStatsCollector(s)).catch((d=>h=>{oe("EVENT_REPORT_RETRY")&&(r?this.keyEventUploadPendingItems=this.keyEventUploadPendingItems.concat(d):(this.normalEventUploadPendingItems=this.normalEventUploadPendingItems.concat(d),this.normalEventUploadPendingItems.length>oe("NORMAL_EVENT_QUEUE_CAPACITY")&&(this.normalEventUploadPendingItems.splice(0,this.normalEventUploadPendingItems.length-oe("NORMAL_EVENT_QUEUE_CAPACITY")),M.warning("report: drop normal events"))))})(s)),t}async postDataToStatsCollector2(t){Ai.networkState===Nc.OFFLINE&&await mt.race([Ai.onlineWaiter,Is(2*Vi.maxRetryTimeout)]);const r=c=>{let d=new Uint8Array;return c.forEach((h=>{const m=KL(JSON.stringify(h.data)),g=new ArrayBuffer(5),v=(I=>{let A=0;return Object.entries(Br).forEach((N=>{let[H,B]=N;B===I.type&&(A=oge[H])})),A})(h),w=new DataView(g);w.setUint16(0,m.byteLength,!0),w.setUint8(2,255&v),w.setUint8(3,v>>>8&255),w.setUint8(4,v>>>16&255),d=_9(d,new Uint8Array(g)),d=_9(d,m)})),d},s="event";let a=this.proxyServer?"https://".concat(this.proxyServer,"/rs/?h=").concat(oe("NEW_REPORT_SERVER_DOMAINS")[0],"&p=443&d=").concat(s):"https://".concat(oe("NEW_REPORT_SERVER_DOMAINS")[0],"/").concat(s);for(let c=0;c<2;c+=1){c===1&&(a=this.proxyServer?"https://".concat(this.proxyServer,"/rs/?h=").concat(oe("NEW_REPORT_SERVER_DOMAINS")[1],"&p=443&d=").concat(s):"https://".concat(oe("NEW_REPORT_SERVER_DOMAINS")[1],"/").concat(s));try{await e2(a,{timeout:1e4,data:r(t),headers:mn(mn({biz:"webrtc",sendts:Math.round(Date.now()/1e3),debug:"false"},this._appId&&{appid:this._appId}),{},{"Content-Type":"application/octet-stream"})},!0)}catch(d){if(c===1)throw d;continue}return}}async postDataToStatsCollector(t){let r=arguments.length>1&&arguments[1]!==void 0&&arguments[1];const s=(m=>{const g=m&&m.data.sid&&this.baseInfoMap.get(m.data.sid);return g&&g.info.vid&&+g.info.vid||0})(t[0]),a=s?void 0:this._aid,c={msgType:"EventMessages",sentTs:Math.round(Date.now()/1e3),payloads:t.map((m=>JSON.stringify(m))),vid:s,aid:a};Ai.networkState===Nc.OFFLINE&&await mt.race([Ai.onlineWaiter,Is(2*Vi.maxRetryTimeout)]);const d=r?"/events/proto-raws":"/events/messages";let h=this.url||(this.proxyServer?"https://".concat(this.proxyServer,"/rs/?h=").concat(oe("EVENT_REPORT_DOMAIN"),"&p=").concat(oe("STATS_COLLECTOR_PORT"),"&d=").concat(d):"https://".concat(oe("EVENT_REPORT_DOMAIN"),":").concat(oe("STATS_COLLECTOR_PORT")).concat(d));for(let m=0;m<2;m+=1){m===1&&(h=this.backupUrl||(this.proxyServer?"https://".concat(this.proxyServer,"/rs/?h=").concat(oe("EVENT_REPORT_BACKUP_DOMAIN"),"&p=").concat(oe("STATS_COLLECTOR_PORT"),"&d=").concat(d):"https://".concat(oe("EVENT_REPORT_BACKUP_DOMAIN"),":").concat(oe("STATS_COLLECTOR_PORT")).concat(d)));try{r?await Hme(h,{timeout:1e4,data:c}):await e2(h,{timeout:1e4,data:c})}catch(g){if(m===1)throw g;continue}return}}createBaseInfo(t,r){const s=Object.assign({},sge);return s.sid=t,this.baseInfoMap.set(t,{info:s,startTime:r}),s}reportResourceTiming(t,r){const s=performance.getEntriesByName(t),a=s[s.length-1];a&&this.reportApiInvoke(r,{name:"Client.resourceTiming",options:a,tag:$r.TRACER}).onSuccess()}};H9.on("REPORT_LOG_UPLOAD",(t=>{t.networkState=Ai.networkState,It.reportApiInvoke(null,{name:"logUploadError",options:t,tag:$r.TRACER}).onSuccess("logUploadError")}));class ke extends Le{constructor(r){super(r,arguments.length>1&&arguments[1]!==void 0?arguments[1]:"",arguments.length>2?arguments[2]:void 0),oi(this,"name","AgoraRTCException")}print(){let r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"error";return super.print(r,M)}throw(){super.throw(M)}}const As={getDisplayMedia:!1,getStreamFromExtension:!1,supportUnifiedPlan:!1,supportMinBitrate:!1,supportSetRtpSenderParameters:!1,supportDualStream:!0,webAudioMediaStreamDest:!1,supportReplaceTrack:!1,supportWebGL:!1,webAudioWithAEC:!1,supportRequestFrame:!1,supportShareAudio:!1,supportDualStreamEncoding:!1,supportDataChannel:!1,supportPCSetConfiguration:!1,supportWebRTCEncodedTransform:!1,supportWebRTCInsertableStream:!1,supportRequestVideoFrameCallback:!1,supportWebCrypto:!1};function Wn(){return As}function q9(){return"setSinkId"in HTMLAudioElement.prototype&&(!oe("RESTRICTION_SET_PLAYBACK_DEVICE")||(Ef()||s9())&&!GL())}function D1(){return!As.supportUnifiedPlan||oe("CHROME_FORCE_PLAN_B")&&vf()}function h2(t){return!(ii()||o9(87)||D1()||!oe("ENABLE_PRE_SUB")&&(t==null||!t.autoSubscribe||oe("FORCE_DISABLE_AUTO_SUB")))}function Y9(t){return!!oe("ENABLE_INSTANT_VIDEO")||!(t==null||!t.autoSubscribe||oe("FORCE_DISABLE_AUTO_SUB"))}let Ps=(function(t){return t.IOS_15_16_INTERRUPTION_START="ios15_16-interruption-start",t.IOS_15_16_INTERRUPTION_END="ios15_16-interruption-end",t.IOS_INTERRUPTION_START="ios-interruption-start",t.IOS_INTERRUPTION_END="ios-interruption-end",t.STATE_CHANGE="state-change",t})({});function o0(t,r,s){return{sampleRate:t,stereo:r,bitrate:s}}function Gn(t,r,s,a,c){return{width:t,height:r,frameRate:s,bitrateMin:a,bitrateMax:c}}function Ku(t,r,s,a,c){return{width:{max:t},height:{max:r},frameRate:s,bitrateMin:a,bitrateMax:c}}function p2(t,r){return{numSpatialLayers:t,numTemporalLayers:r}}const age={"90p":Gn(160,90),"90p_1":Gn(160,90),"120p":Gn(160,120,15,30,65),"120p_1":Gn(160,120,15,30,65),"120p_3":Gn(120,120,15,30,50),"120p_4":Gn(212,120),"180p":Gn(320,180,15,30,140),"180p_1":Gn(320,180,15,30,140),"180p_3":Gn(180,180,15,30,100),"180p_4":Gn(240,180,15,30,120),"240p":Gn(320,240,15,40,200),"240p_1":Gn(320,240,15,40,200),"240p_3":Gn(240,240,15,40,140),"240p_4":Gn(424,240,15,40,220),"360p":Gn(640,360,15,80,400),"360p_1":Gn(640,360,15,80,400),"360p_3":Gn(360,360,15,80,260),"360p_4":Gn(640,360,30,80,600),"360p_6":Gn(360,360,30,80,400),"360p_7":Gn(480,360,15,80,320),"360p_8":Gn(480,360,30,80,490),"360p_9":Gn(640,360,15,80,800),"360p_10":Gn(640,360,24,80,800),"360p_11":Gn(640,360,24,80,1e3),"480p":Gn(640,480,15,100,500),"480p_1":Gn(640,480,15,100,500),"480p_2":Gn(640,480,30,100,1e3),"480p_3":Gn(480,480,15,100,400),"480p_4":Gn(640,480,30,100,750),"480p_6":Gn(480,480,30,100,600),"480p_8":Gn(848,480,15,100,610),"480p_9":Gn(848,480,30,100,930),"480p_10":Gn(640,480,10,100,400),"720p":Gn(1280,720,15,120,1130),"720p_auto":Gn(1280,720,30,900,3e3),"720p_1":Gn(1280,720,15,120,1130),"720p_2":Gn(1280,720,30,120,2e3),"720p_3":Gn(1280,720,30,120,1710),"720p_5":Gn(960,720,15,120,910),"720p_6":Gn(960,720,30,120,1380),"1080p":Gn(1920,1080,15,120,2080),"1080p_1":Gn(1920,1080,15,120,2080),"1080p_2":Gn(1920,1080,30,120,3e3),"1080p_3":Gn(1920,1080,30,120,3150),"1080p_5":Gn(1920,1080,60,120,4780),"1440p":Gn(2560,1440,30,120,4850),"1440p_1":Gn(2560,1440,30,120,4850),"1440p_2":Gn(2560,1440,60,120,7350),"4k":Gn(3840,2160,30,120,8910),"4k_1":Gn(3840,2160,30,120,8910),"4k_3":Gn(3840,2160,60,120,13500)},cge={"480p":Ku(640,480,5),"480p_1":Ku(640,480,5),"480p_2":Ku(640,480,30),"480p_3":Ku(640,480,15),"720p":Ku(1280,720,5),"720p_auto":Gn(1280,720,30,900,3e3),"720p_1":Ku(1280,720,5),"720p_2":Ku(1280,720,30),"720p_3":Ku(1280,720,15),"1080p":Ku(1920,1080,5),"1080p_1":Ku(1920,1080,5),"1080p_2":Ku(1920,1080,30),"1080p_3":Ku(1920,1080,15)},lge={"1SL1TL":p2(1,1),"3SL3TL":p2(3,3),"2SL3TL":p2(2,3)};function qu(t){return t||(t="480p_1"),typeof t=="string"?Object.assign({},age[t]):t}function f2(t){return typeof t=="string"?Object.assign({},cge[t]):t}function L1(t){return typeof t=="string"?Object.assign({},lge[t]):t}const uge={speech_low_quality:o0(16e3,!1),speech_standard:o0(32e3,!1,18),music_standard:o0(48e3,!1),standard_stereo:o0(48e3,!0,56),high_quality:o0(48e3,!1,128),high_quality_stereo:o0(48e3,!0,192)};function M1(t){return typeof t=="string"?Object.assign({},uge[t]):t}const a0=[];function X9(t){return Zi(t,"mediaSource",["screen","window","application"]),!0}let Tt=(function(t){return t.NEED_RENEGOTIATE="@need_renegotiate",t.NEED_REPLACE_TRACK="@need_replace_track",t.NEED_REPLACE_MIXING_TRACK="@need_replace_mixing_track",t.NEED_CLOSE="@need_close",t.NEED_ENABLE_TRACK="@need_enable_track",t.NEED_DISABLE_TRACK="@need_disable_track",t.NEED_SESSION_ID="@need_sid",t.SET_OPTIMIZATION_MODE="@set_optimization_mode",t.GET_STATS="@get_stats",t.GET_RTC_STATS="@get_rtc_stats",t.GET_LOW_VIDEO_TRACK="@get_low_video_track",t.NEED_RESET_REMOTE_SDP="@need_reset_remote_sdp",t.NEED_UPDATE_VIDEO_ENCODER="@need_update_video_encoder",t.NEED_UPDATE_VIDEO_SEND_PARAMETERS="@need_update_video_send_parameters",t.NEED_MUTE_TRACK="@need_mute_track",t.NEED_UNMUTE_TRACK="@need_unmute_track",t})({}),Sr=(function(t){return t.SCREEN_TRACK="screen_track",t.CUSTOM_TRACK="custome_track",t.LOW_STREAM="low_stream",t.SCREEN_LOW_TRACK="screen_low_track",t})({}),c0=(function(t){return t[t.HIGH_STREAM=0]="HIGH_STREAM",t[t.LOW_STREAM=1]="LOW_STREAM",t})({}),dge=(function(t){return t[t.HIGH_STREAM=0]="HIGH_STREAM",t[t.LOW_STREAM=1]="LOW_STREAM",t[t.HIGH_STREAM_LAYER1=4]="HIGH_STREAM_LAYER1",t[t.HIGH_STREAM_LAYER2=5]="HIGH_STREAM_LAYER2",t[t.HIGH_STREAM_LAYER3=6]="HIGH_STREAM_LAYER3",t[t.HIGH_STREAM_LAYER4=7]="HIGH_STREAM_LAYER4",t[t.HIGH_STREAM_LAYER5=8]="HIGH_STREAM_LAYER5",t[t.HIGH_STREAM_LAYER6=9]="HIGH_STREAM_LAYER6",t})({}),hge=(function(t){return t[t.DISABLE=0]="DISABLE",t[t.LOW_STREAM=1]="LOW_STREAM",t[t.AUDIO_ONLY=2]="AUDIO_ONLY",t[t.HIGH_STREAM_LAYER1=3]="HIGH_STREAM_LAYER1",t[t.HIGH_STREAM_LAYER2=4]="HIGH_STREAM_LAYER2",t[t.HIGH_STREAM_LAYER3=5]="HIGH_STREAM_LAYER3",t[t.HIGH_STREAM_LAYER4=6]="HIGH_STREAM_LAYER4",t[t.HIGH_STREAM_LAYER5=7]="HIGH_STREAM_LAYER5",t[t.HIGH_STREAM_LAYER6=8]="HIGH_STREAM_LAYER6",t})({}),ay=(function(t){return t.TRANSCEIVER_UPDATED="transceiver-updated",t.SEI_TO_SEND="sei-to-send",t.SEI_RECEIVED="sei-received",t.TRACK_UPDATED="track-updated",t})({}),l0=(function(t){return t.SOURCE_STATE_CHANGE="source-state-change",t.TRACK_ENDED="track-ended",t.BEAUTY_EFFECT_OVERLOAD="beauty-effect-overload",t.VIDEO_ELEMENT_VISIBLE_STATUS="video-element-visible-status",t.CLOSED="closed",t})({}),tu=(function(t){return t.FIRST_FRAME_DECODED="first-frame-decoded",t.VIDEO_ELEMENT_VISIBLE_STATUS="video-element-visible-status",t.VIDEO_STATE_CHANGED="video-state-changed",t.PLAY_START="play-start",t.PLAY_END="play-end",t.FIRST_FRAME_RENDER="first-frame-render",t})({}),u0=(function(t){return t.AUDIO="audio",t.VIDEO="video",t.DATA="data",t})({}),ll=(function(t){return t.AUDIO_SOURCE_STATE_CHANGE="audio_source_state_change",t.RECEIVE_TRACK_BUFFER="receive_track_buffer",t.ON_AUDIO_BUFFER="on_audio_buffer",t.UPDATE_SOURCE="update_source",t})({});(function(t){t.UPDATE_TRACK_SOURCE="update-track-source"})({});const m2={sendVolumeLevel:0,sendBitrate:0,sendBytes:0,sendPackets:0,sendPacketsLost:0,sendJitterMs:0,sendRttMs:0,currentPacketLossRate:0},g2={sendBytes:0,sendBitrate:0,sendPackets:0,sendPacketsLost:0,sendJitterMs:0,sendRttMs:0,sendResolutionHeight:0,sendResolutionWidth:0,captureResolutionHeight:0,captureResolutionWidth:0,targetSendBitrate:0,totalDuration:0,totalFreezeTime:0,currentPacketLossRate:0},J9={transportDelay:0,end2EndDelay:0,receiveBitrate:0,receiveLevel:0,receiveBytes:0,receiveDelay:0,receivePackets:0,receivePacketsLost:0,receivePacketsDiscarded:0,totalDuration:0,totalFreezeTime:0,freezeRate:0,packetLossRate:0,currentPacketLossRate:0,publishDuration:-1},pge={uplinkNetworkQuality:0,downlinkNetworkQuality:0},Q9={transportDelay:0,end2EndDelay:0,receiveBitrate:0,receiveBytes:0,receiveDelay:0,receivePackets:0,receivePacketsLost:0,receiveResolutionHeight:0,receiveResolutionWidth:0,totalDuration:0,totalFreezeTime:0,freezeRate:0,packetLossRate:0,currentPacketLossRate:0,publishDuration:-1};let ha=(function(t){return t.ON_TRACK="on_track",t.ON_NODE="on_node",t})({}),ul=(function(t){return t.REQUEST_UPDATE_CONSTRAINTS="request_update_constraints",t.REQUEST_CONSTRAINTS="request_constraints",t})({}),gT=(function(t){return t.IDLE="IDLE",t.INITING="INITING",t.INITEND="INITEND",t})({}),cy=(function(t){return t.STATE_CHANGE="state_change",t.RECORDING_DEVICE_CHANGED="recordingDeviceChanged",t.PLAYOUT_DEVICE_CHANGED="playoutDeviceChanged",t.CAMERA_DEVICE_CHANGED="cameraDeviceChanged",t})({}),oo=(function(t){return t.NONE="none",t.INIT="init",t.CANPLAY="canplay",t.PLAYING="playing",t.PAUSED="paused",t.SUSPEND="suspend",t.STALLED="stalled",t.WAITING="waiting",t.ERROR="error",t.DESTROYED="destroyed",t.ABORT="abort",t.ENDED="ended",t.EMPTIED="emptied",t.LOADEDDATA="loadeddata",t})({}),ap=(function(t){return t[t.VideoStateStopped=0]="VideoStateStopped",t[t.VideoStateStarting=1]="VideoStateStarting",t[t.VideoStateDecoding=2]="VideoStateDecoding",t[t.VideoStateFrozen=3]="VideoStateFrozen",t})({});const _2={uninit:100,none:110,init:120,loadeddata:130,canplay:200,playing:210,paused:220,suspend:300,stalled:310,waiting:320,error:330,destroyed:340,abort:350,ended:360,emptied:370};let U1=(function(t){return t.OPEN="open",t.MESSAGE="message",t.CLOSE="close",t.CLOSING="closing",t.ERROR="error",t})({});function Ln(t,r,s,a,c){var d,h,m={};return Object.keys(a).forEach((function(g){m[g]=a[g]})),m.enumerable=!!m.enumerable,m.configurable=!!m.configurable,("value"in m||m.initializer)&&(m.writable=!0),m=Xa(d=g_(h=s.slice()).call(h)).call(d,(function(g,v){return v(t,r,g)||g}),m),c&&m.initializer!==void 0&&(m.value=m.initializer?m.initializer.call(c):void 0,m.initializer=void 0),m.initializer===void 0?(Object.defineProperty(t,r,m),null):m}function Pe(t,r,s){return(r=(function(a){var c=(function(d,h){if(typeof d!="object"||!d)return d;var m=d[Symbol.toPrimitive];if(m!==void 0){var g=m.call(d,"string");if(typeof g!="object")return g;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(d)})(a);return typeof c=="symbol"?c:c+""})(r))in t?Object.defineProperty(t,r,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[r]=s,t}function Z9(t,r){var s=Object.keys(t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);r&&(a=a.filter((function(c){return Object.getOwnPropertyDescriptor(t,c).enumerable}))),s.push.apply(s,a)}return s}function Pr(t){for(var r=1;r<arguments.length;r++){var s=arguments[r]!=null?arguments[r]:{};r%2?Z9(Object(s),!0).forEach((function(a){Pe(t,a,s[a])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(s)):Z9(Object(s)).forEach((function(a){Object.defineProperty(t,a,Object.getOwnPropertyDescriptor(s,a))}))}return t}class eW extends Zr{set _mediaStreamTrack(r){r!==this.mediaStreamTrack&&(this.safeEmit(ay.TRACK_UPDATED,r),this.mediaStreamTrack=r)}get _mediaStreamTrack(){return this.mediaStreamTrack}constructor(r,s){super(),Pe(this,"trackMediaType",void 0),Pe(this,"_ID",void 0),Pe(this,"_rtpTransceiver",void 0),Pe(this,"_lowRtpTransceiver",void 0),Pe(this,"_hints",[]),Pe(this,"_isClosed",!1),Pe(this,"_originMediaStreamTrack",void 0),Pe(this,"mediaStreamTrack",void 0),Pe(this,"_external",{}),this._ID=s||Tr(8,"track-"),this._originMediaStreamTrack=r,this.mediaStreamTrack=r,(function(a){rt(a0).call(a0,a)||a0.push(a)})(this)}toString(){return this._ID}getTrackId(){return this._ID}getMediaStreamTrack(r){return r||Jm((()=>{var s;It.reportApiInvoke(null,{name:pi.GET_MEDIA_STREAM_TRACK,options:[],tag:$r.TRACER}).onSuccess(((s=this._mediaStreamTrack)===null||s===void 0?void 0:s.label)||"")}),this.mediaStreamTrack.id||this.getTrackId()),this._mediaStreamTrack}getRTCRtpTransceiver(r){return r===c0.LOW_STREAM?this._lowRtpTransceiver:this._rtpTransceiver}getMediaStreamTrackSettings(){return this.getMediaStreamTrack(!0).getSettings()}close(){this._isClosed=!0,this._lowRtpTransceiver=void 0,this._rtpTransceiver=void 0,(function(r){const s=a0.indexOf(r);s!==-1&&a0.splice(s,1)})(this),this.emit(l0.CLOSED),this.removeAllListeners(ay.SEI_RECEIVED)}_updateRtpTransceiver(r,s){if(s===c0.LOW_STREAM){if(this._lowRtpTransceiver===r)return;this._lowRtpTransceiver=r}else{if(this._rtpTransceiver===r)return;this._rtpTransceiver=r}this.emit(ay.TRANSCEIVER_UPDATED,r,s)}}class d0 extends eW{get isExternalTrack(){return this._isExternalTrack}get muted(){return this._muted}get enabled(){return this._enabled}get processorContext(){return this._processorContext}constructor(r,s){super(r,s),Pe(this,"_enabled",!0),Pe(this,"_muted",!1),Pe(this,"_isExternalTrack",!1),Pe(this,"_isClosed",!1),Pe(this,"_enabledMutex",void 0),Pe(this,"processor",void 0),Pe(this,"_processorContext",void 0),Pe(this,"_handleTrackEnded",(()=>{this.onTrackEnded()})),this._enabledMutex=new so("".concat(this.getTrackId())),r.addEventListener("ended",this._handleTrackEnded)}getTrackLabel(){var r,s;return(r=(s=this._originMediaStreamTrack)===null||s===void 0?void 0:s.label)!==null&&r!==void 0?r:""}close(){this._isClosed||(this.stop(),this._originMediaStreamTrack.stop(),this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack.stop(),this._mediaStreamTrack=null),this._originMediaStreamTrack=null,this._enabledMutex=null,M.debug("[".concat(this.getTrackId(),"] close")),this.emit(Tt.NEED_CLOSE),super.close())}async _updateOriginMediaStreamTrack(r,s){let a=arguments.length>2&&arguments[2]!==void 0&&arguments[2];this._isExternalTrack=a,r!==this._originMediaStreamTrack&&(this._originMediaStreamTrack&&(this._originMediaStreamTrack.removeEventListener("ended",this._handleTrackEnded),s&&this._originMediaStreamTrack.stop()),r.addEventListener("ended",this._handleTrackEnded),this._originMediaStreamTrack=r,this._muted&&(this._originMediaStreamTrack.enabled=!1),this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource(),await wr(this,Tt.NEED_REPLACE_TRACK,this),this.processor&&this._processorContext&&this.processor.updateInput({track:this._originMediaStreamTrack,context:this._processorContext}))}_getDefaultPlayerConfig(){return{}}onTrackEnded(){M.debug("[".concat(this.getTrackId(),"] track ended")),this.safeEmit(l0.TRACK_ENDED)}stateCheck(r,s){if(M.debug("check track state, [muted: ".concat(this._muted,", enabled: ").concat(this._enabled,"] to [").concat(r,": ").concat(s,"]")),Yd(s,r),this._enabled&&this._muted&&r==="enabled"&&s===!1)throw new Le(te.TRACK_STATE_UNREACHABLE,"cannot set enabled while the track is muted").print("error",M);if(!this._enabled&&!this._muted&&r==="muted"&&s===!0)throw new Le(te.TRACK_STATE_UNREACHABLE,"cannot set muted while the track is disabled").print("error",M)}getProcessorStats(){return this._processorContext&&this._processorContext.gatherStats()||[]}getProcessorUsage(){return this._processorContext?this._processorContext.gatherUsage():mt.resolve([])}}const tW=window.AudioContext||window.webkitAudioContext;let dl=null;const _r=new class extends Zr{constructor(){super(...arguments),Pe(this,"prevState",void 0),Pe(this,"curState",void 0),Pe(this,"currentTime",void 0),Pe(this,"currentTimeStuckAt",void 0),Pe(this,"interruptDetectorTrack",void 0),Pe(this,"onLocalAudioTrackMute",(()=>{M.info("ios15-interruption-start"),this.emit(Ps.IOS_15_16_INTERRUPTION_START)})),Pe(this,"onLocalAudioTrackUnmute",(async()=>{M.info("ios15-interruption-end"),this.curState!=="running"||this.duringInterruption?M.info("ios15-interruption-end-canceled"):(dl&&await dl.suspend(),this.emit(Ps.IOS_15_16_INTERRUPTION_END))}))}get duringInterruption(){return this.prevState==="running"&&this.curState==="interrupted"}bindInterruptDetectorTrack(t){M.debug("webaudio bindInterruptDetectorTrack ".concat(t.getTrackId())),this.interruptDetectorTrack||(this.interruptDetectorTrack=t,this.interruptDetectorTrack._mediaStreamTrack.onmute=this.onLocalAudioTrackMute,this.interruptDetectorTrack._mediaStreamTrack.onunmute=this.onLocalAudioTrackUnmute)}unbindInterruptDetectorTrack(t){M.debug("webaudio unbindInterruptDetectorTrack ".concat(t.getTrackId())),this.interruptDetectorTrack&&this.interruptDetectorTrack===t&&(this.interruptDetectorTrack._mediaStreamTrack&&(this.interruptDetectorTrack._mediaStreamTrack.onmute=null,this.interruptDetectorTrack._mediaStreamTrack.onunmute=null),this.interruptDetectorTrack=void 0)}};function h0(){if(!dl){if((function(){if(!tW)return void M.error("your browser is not support web audio");M.info("create audio context");const t=Pr({},oe("WEBAUDIO_INIT_OPTIONS"));M.debug("audio context init option:",JSON.stringify(t)),dl=new tW(t),_r.curState=dl.state,dl.onstatechange=()=>{_r.prevState=_r.curState,_r.curState=dl?dl.state:void 0;const{prevState:r,curState:s}=_r,a=s==="running",c=s==="interrupted",d=r==="running",h=r==="suspended",m=r==="interrupted",g=Mn().osVersion;(To()||Hu())&&d&&c&&(M.info("ios".concat(g,"-interruption-start")),_r.emit(Ps.IOS_INTERRUPTION_START)),(To()||Hu())&&(h||m)&&a&&(M.info("ios".concat(g,"-interruption-end")),_r.emit(Ps.IOS_INTERRUPTION_END)),r!==s&&_r.emit(Ps.STATE_CHANGE,s,r)},setInterval((()=>{var r;const s=(r=dl)===null||r===void 0?void 0:r.currentTime;_r.currentTime!==s?(_r.currentTimeStuckAt&&(M.debug("AudioContext current time resume at ".concat(s)),_r.currentTimeStuckAt=void 0),_r.currentTime=s):(s!==_r.currentTimeStuckAt&&(It.reportApiInvoke(null,{name:"WEB_AUDIO_CURRENT_TIME_STUCK",options:{currentTime:s},tag:$r.TRACER}).onSuccess(),M.warning("AudioContext current time stuck at ".concat(s))),_r.currentTimeStuckAt=s)}),5e3),(async function(r){const s=["click","contextmenu","auxclick","dblclick","mousedown","mouseup","touchend","keydown","keyup"];let a,c=!1,d=!1,h=!1;function m(B){r.state==="running"?g(!1):To()||Hu()?r.state==="suspended"&&(g(!0),B&&r.resume().then(v,v)):r.state!=="closed"&&(g(!0),B&&r.resume().then(v,v))}function g(B){if(c!==B){c=B;for(let z=0,ee=s;z<ee.length;z+=1){const Z=ee[z];B?window.addEventListener(Z,w,{capture:!0,passive:!0}):window.removeEventListener(Z,w,{capture:!0,passive:!0})}}}function v(){m(!1)}function w(){m(!0)}function I(B){if(!h)if(a.paused)if(B){let z;A(!1),h=!0;try{z=a.play(),z?z.then(N,N):(a.addEventListener("playing",N),a.addEventListener("abort",N),a.addEventListener("error",N))}catch{N()}}else A(!0);else A(!1)}function A(B){if(d!==B){d=B;for(let z=0,ee=s;z<ee.length;z++){const Z=ee[z];B?window.addEventListener(Z,H,{capture:!0,passive:!0}):window.removeEventListener(Z,H,{capture:!0,passive:!0})}}}function N(){a.removeEventListener("playing",N),a.removeEventListener("abort",N),a.removeEventListener("error",N),h=!1,I(!1)}function H(){I(!0)}if(To()){const B=r.createMediaStreamDestination(),z=document.createElement("div");z.innerHTML="<audio x-webkit-airplay='deny'></audio>",a=z.children.item(0),a.controls=!1,a.disableRemotePlayback=!0,a.preload="auto",a.srcObject=B.stream,I(!0)}_r.on(Ps.STATE_CHANGE,(function(){m(!0)})),m(!1)})(dl)})(),!dl)throw new Le(te.NOT_SUPPORTED,"can not create audio context");return dl}return dl}function ly(t){if((function(){if(y2!==null)return y2;const a=h0(),c=a.createBufferSource(),d=a.createGain(),h=a.createGain();c.connect(d),c.connect(h),c.disconnect(d);let m=!1;try{c.disconnect(d)}catch{m=!0}return c.disconnect(),y2=m,m})())return;const r=t.connect,s=t.disconnect;t.connect=(a,c,d)=>{var h;return t._inputNodes||(t._inputNodes=[]),rt(h=t._inputNodes).call(h,a)||(a instanceof AudioNode?(t._inputNodes.push(a),r.call(t,a,c,d)):r.call(t,a,c)),t},t.disconnect=(a,c,d)=>{s.call(t),a?R1(t._inputNodes,a):t._inputNodes=[];for(const h of t._inputNodes)r.call(t,h)}}let y2=null;function E2(t,r){let s=!1;const a=1/r;if(oe("DISABLE_WEBAUDIO")){const c=window.setInterval((()=>{s?window.clearInterval(c):t(performance.now()/1e3)}),1e3*a)}else{const c=h0();let d=c.createGain();d.gain.value=0,d.connect(c.destination);const h=()=>{if(s)return void(d=null);const m=c.createOscillator();m.onended=h,m.connect(d),m.start(0),m.stop(c.currentTime+a),t(c.currentTime)};h()}return()=>{s=!0}}class nW{constructor(){Pe(this,"context",void 0),Pe(this,"analyserNode",void 0),Pe(this,"sourceNode",void 0),this.context=h0(),this.analyserNode=this.context.createAnalyser(),this.analyserNode.fftSize=2048,this.analyserNode.smoothingTimeConstant=.4}updateSource(r){if(r!==this.sourceNode){if(this.sourceNode)try{this.sourceNode.disconnect(this.analyserNode)}catch{}this.sourceNode=r,r==null||r.connect(this.analyserNode)}}getVolumeLevel(){if(!this.sourceNode||(!this.context||To()||Hu()||this.context.state!=="running"&&this.context.resume(),!this.analyserNode))return 0;const r=new Float32Array(this.analyserNode.fftSize);if(this.analyserNode.getFloatTimeDomainData)this.analyserNode.getFloatTimeDomainData(r);else{const a=new Uint8Array(this.analyserNode.fftSize);this.analyserNode.getByteTimeDomainData(a);for(let c=0;c<r.length;++c)r[c]=a[c]/128-1}const s=Xa(r).call(r,((a,c)=>a+c*c),0)/r.length;return Math.max(10*Math.log10(s)+100,0)/100}getAnalyserNode(){return this.analyserNode}rebuildAnalyser(){try{var r,s;(r=this.sourceNode)===null||r===void 0||r.disconnect(this.analyserNode),this.analyserNode=this.context.createAnalyser(),this.analyserNode.fftSize=2048,this.analyserNode.smoothingTimeConstant=.4,(s=this.sourceNode)===null||s===void 0||s.connect(this.analyserNode)}catch{M.warning("rebuild analyser node failed.")}}destroy(){this.updateSource(void 0)}}class rW extends Zr{get processSourceNode(){return this.sourceNode}set processedNode(r){var s;if(!this.isDestroyed&&this._processedNode!==r){try{var a;(a=this.sourceNode)===null||a===void 0||a.disconnect(this.outputNode)}catch{}(s=this._processedNode)===null||s===void 0||s.disconnect(),this._processedNode=r,this.connect()}}get processedNode(){return this._processedNode}constructor(){super(),Pe(this,"outputNode",void 0),Pe(this,"outputTrack",void 0),Pe(this,"isPlayed",!1),Pe(this,"sourceNode",void 0),Pe(this,"context",void 0),Pe(this,"audioBufferNode",void 0),Pe(this,"destNode",void 0),Pe(this,"audioOutputLevel",0),Pe(this,"volumeLevelAnalyser",void 0),Pe(this,"_processedNode",void 0),Pe(this,"playNode",void 0),Pe(this,"isDestroyed",!1),Pe(this,"onNoAudioInput",void 0),Pe(this,"isNoAudioInput",!1),Pe(this,"_noAudioInputCount",0),this.context=h0(),this.playNode=this.context.destination,this.outputNode=this.context.createGain(),ly(this.outputNode),this.volumeLevelAnalyser=new nW}startGetAudioBuffer(r){this.audioBufferNode||(this.audioBufferNode=this.context.createScriptProcessor(r),this.outputNode.connect(this.audioBufferNode),this.audioBufferNode.connect(this.context.destination),this.audioBufferNode.onaudioprocess=s=>{this.emit(ll.ON_AUDIO_BUFFER,(function(a){for(let c=0;c<a.outputBuffer.numberOfChannels;c+=1){const d=a.outputBuffer.getChannelData(c);for(let h=0;h<d.length;h+=1)d[h]=0}return a.inputBuffer})(s))})}stopGetAudioBuffer(){this.audioBufferNode&&(this.audioBufferNode.onaudioprocess=null,this.outputNode.disconnect(this.audioBufferNode),this.audioBufferNode=void 0)}createOutputTrack(){if(!Wn().webAudioMediaStreamDest)throw new Le(te.NOT_SUPPORTED,"your browser is not support audio processor");return this.destNode&&this.outputTrack||(this.destNode=this.context.createMediaStreamDestination(),this.outputNode.connect(this.destNode),this.outputTrack=this.destNode.stream.getAudioTracks()[0]),this.outputTrack}play(r){this.context.state!=="running"&&I1((()=>{_r.emit("autoplay-failed")})),this.isPlayed=!0,this.playNode=r||this.context.destination,this.outputNode.connect(this.playNode)}stop(){if(this.isPlayed)try{this.outputNode.disconnect(this.playNode)}catch{}this.isPlayed=!1}getAccurateVolumeLevel(){return this.volumeLevelAnalyser.getVolumeLevel()}async checkHasAudioInput(){let r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;if(r>5)return this.isNoAudioInput=!0,this.onNoAudioInput&&this.onNoAudioInput(),!1;To()||Hu()?this.context.state==="suspended"&&this.context.resume():this.context.state!=="running"&&this.context.resume();const s=this.volumeLevelAnalyser.getAnalyserNode();let a;s.getFloatTimeDomainData?(a=new Float32Array(s.fftSize),s.getFloatTimeDomainData(a)):(a=new Uint8Array(s.fftSize),s.getByteTimeDomainData(a));let c=!1;for(let d=0;d<a.length;d++)a[d]!==0&&(c=!0);return c?(this.isNoAudioInput=!1,!0):(await Is(200),await this.checkHasAudioInput(r?r+1:1)&&c)}getAudioVolume(){return this.outputNode.gain.value}setVolume(r){this.outputNode.gain.setValueAtTime(r,this.context.currentTime)}destroy(){this.disconnect(),this.stop(),this.isDestroyed=!0,this.onNoAudioInput=void 0}disconnect(){var r,s;(r=this.processedNode)===null||r===void 0||r.disconnect(),(s=this.sourceNode)===null||s===void 0||s.disconnect(),this.outputNode&&this.outputNode.disconnect()}connect(){var r;this.processedNode?(r=this.processedNode)===null||r===void 0||r.connect(this.outputNode):this.sourceNode&&this.sourceNode.connect(this.outputNode),this.volumeLevelAnalyser.updateSource(this.outputNode)}}class iW extends rW{get isFreeze(){return!1}constructor(r,s,a){var c;if(super(),Pe(this,"sourceNode",void 0),Pe(this,"track",void 0),Pe(this,"clonedTrack",void 0),Pe(this,"audioElement",void 0),Pe(this,"isCurrentTrackCloned",!1),Pe(this,"isRemoteTrack",!1),Pe(this,"originVolumeLevelAnalyser",void 0),Pe(this,"rebuildWebAudio",(async()=>{if(M.debug("ready to rebuild web audio, state:",this.context.state),this.isNoAudioInput&&await this.checkHasAudioInput(),!this.isNoAudioInput||this.isDestroyed)return document.body.removeEventListener("click",this.rebuildWebAudio,!0),void M.debug("rebuild web audio success, current volume status",this.getAccurateVolumeLevel());this.context.resume().then((()=>M.info("resume success"))),M.debug("rebuild web audio because of ios 12 bugs"),this.disconnect();const m=this.track;this.track=this.track.clone(),this.isCurrentTrackCloned?m.stop():this.isCurrentTrackCloned=!0;const g=new MediaStream([this.track]);this.sourceNode=this.context.createMediaStreamSource(g),ly(this.sourceNode),this.volumeLevelAnalyser.rebuildAnalyser();const v=this.outputNode.gain.value;this.outputNode=this.context.createGain(),this.outputNode.gain.setValueAtTime(v,this.context.currentTime),ly(this.outputNode),this.emit(ll.UPDATE_SOURCE),this.connect(),this.audioElement.srcObject=g,this.isPlayed&&this.play(this.playNode),this.checkHasAudioInput()})),r.kind!=="audio")throw new Le(te.UNEXPECTED_ERROR);this.track=r;const d=new MediaStream([this.track]);if(this.isRemoteTrack=!!s,this.sourceNode=this.context.createMediaStreamSource(d),ly(this.sourceNode),a){const m=a.clone();m.enabled=!0,this.clonedTrack=m,M.debug("create an unmuted track ".concat(m.id," from the original track ").concat(a.id," to get the volume"));const g=this.context.createMediaStreamSource(new MediaStream([m]));ly(g),this.originVolumeLevelAnalyser=new nW,this.originVolumeLevelAnalyser.updateSource(g)}this.connect(),this.audioElement=document.createElement("audio"),this.audioElement.srcObject=d;const h=Mn();s&&h.os===os.IOS&&Number((c=h.osVersion)===null||c===void 0?void 0:c.split(".")[0])<15&&(_r.on(Ps.STATE_CHANGE,(()=>{this.context.state==="suspended"?document.body.addEventListener("click",this.rebuildWebAudio,!0):this.context.state==="running"&&this.rebuildWebAudio()})),this.checkHasAudioInput().then((m=>{m||document.body.addEventListener("click",this.rebuildWebAudio,!0)})))}updateTrack(r){this.sourceNode.disconnect(),this.track=r,this.isCurrentTrackCloned=!1;const s=new MediaStream([r]);this.sourceNode=this.context.createMediaStreamSource(s),ly(this.sourceNode),this.processedNode||this.sourceNode.connect(this.outputNode),this.emit(ll.UPDATE_SOURCE),this.audioElement.srcObject=s}destroy(){var r;this.audioElement.srcObject=null,this.audioElement.remove(),_r.off("state-change",this.rebuildWebAudio),(r=this.originVolumeLevelAnalyser)===null||r===void 0||r.destroy(),this.clonedTrack=void 0,super.destroy()}createMediaStreamSourceNode(r){return this.context.createMediaStreamSource(new MediaStream([r]))}updateOriginTrack(r){const s=r.clone();s.enabled=!0,this.clonedTrack&&(this.clonedTrack.stop(),this.clonedTrack=s),M.debug("create an unmuted track ".concat(s.id," from the original track ").concat(r.id," to get the volume"));const a=this.context.createMediaStreamSource(new MediaStream([s]));ly(a),this.originVolumeLevelAnalyser&&this.originVolumeLevelAnalyser.updateSource(a)}getOriginVolumeLevel(){return this.originVolumeLevelAnalyser?this.originVolumeLevelAnalyser.getVolumeLevel():this.getAccurateVolumeLevel()}}async function sW(t,r,s){const a=(d,h)=>d?typeof d!="number"?d.max||d.exact||d.ideal||d.min||h:d:h,c={audio:!!s&&{mandatory:{chromeMediaSource:"desktop"}},video:{mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:t,maxHeight:a(r.height,1080),maxWidth:a(r.width,1920)}}};return r.frameRate&&typeof r.frameRate!="number"?(c.video.mandatory.maxFrameRate=r.frameRate.max,c.video.mandatory.minFrameRate=r.frameRate.min):typeof r.frameRate=="number"&&(c.video.mandatory.maxFrameRate=r.frameRate),await navigator.mediaDevices.getUserMedia(c)}async function fge(t,r){const s=await oW(t.mediaSource),{sourceId:a,audio:c}=await(function(d){let h=arguments.length>1&&arguments[1]!==void 0&&arguments[1];return new mt(((m,g)=>{const v=document.createElement("div");v.innerText="share screen",v.setAttribute("style","text-align: center; height: 25px; line-height: 25px; border-radius: 4px 4px 0 0; background: #D4D2D4; border-bottom:  solid 1px #B9B8B9;");const w=document.createElement("div");w.setAttribute("style","width: 100%; height: 500px; padding: 15px 25px ; box-sizing: border-box;");const I=document.createElement("div");I.innerText="Agora Web Screensharing wants to share the contents of your screen with webdemo.agorabeckon.com. Choose what you'd like to share.",I.setAttribute("style","height: 12%;");const A=document.createElement("div");A.setAttribute("style","width: 100%; height: 80%; background: #FFF; border:  solid 1px #CBCBCB; display: flex; flex-wrap: wrap; justify-content: space-around; overflow-y: scroll; padding: 0 15px; box-sizing: border-box;");const N=document.createElement("div");N.setAttribute("style","display: flex; justify-content: space-between; padding: 16px 0;");const H=document.createElement("button");H.innerHTML="cancel",H.setAttribute("style","width: 85px;"),H.onclick=()=>{document.body.removeChild(ee);const Z=new Error("NotAllowedError");Z.name="NotAllowedError",g(Z)};let B=h;const z=document.createElement("div");if(h){const Z=document.createElement("input");Z.setAttribute("type","checkbox");const ae=document.createElement("span");Z.setAttribute("style","margin-right: 6px;"),ae.innerText="Share audio",Z.checked=B,Z.onchange=()=>{B=Z.checked},z.appendChild(Z),z.appendChild(ae)}N.appendChild(z),N.appendChild(H),w.appendChild(I),w.appendChild(A),w.appendChild(N);const ee=document.createElement("div");ee.setAttribute("style","position: fixed; z-index: 99999999; top: 50%; left: 50%; width: 620px; height: 525px; background: #ECECEC; border-radius: 4px; -webkit-transform: translate(-50%,-50%); transform: translate(-50%,-50%);"),ee.appendChild(v),ee.appendChild(w),document.body.appendChild(ee),d.map((Z=>{if(Z.id){const ae=document.createElement("div");ae.setAttribute("style","width: 30%; height: 160px; padding: 20px 0; text-align: center;box-sizing: content-box;");let ye=Z.thumbnail;try{const{width:_e}=ye.getSize();_e>1920&&(ye=ye.resize({width:1920}))}catch(_e){throw _e&&_e.message.startsWith("Illegal invocation")&&console.error("Operate thumbnail error, please try to set contextIsolation: false. (https://github.com/electron/electron/issues/34953)"),_e}ae.innerHTML='<div style="height: 120px; display: table-cell; vertical-align: middle;"><img style="width: 100%; background: #333333; box-shadow: 1px 1px 1px 1px rgba(0, 0, 0, 0.2);" src='+ye.toDataURL()+' /></div><span style="	height: 40px; line-height: 40px; display: inline-block; width: 70%; word-break: keep-all; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;">'+Z.name.replace(/[\u00A0-\u9999<>\&]/g,(function(_e){return"&#"+_e.charCodeAt(0)+";"}))+"</span>",ae.onclick=()=>{document.body.removeChild(ee),m({sourceId:Z.id,audio:B})},A.appendChild(ae)}}))}))})(s,r);return await sW(a,t,c)}async function oW(t){let r=["window","screen"];t!=="application"&&t!=="window"||(r=["window"]),t==="screen"&&(r=["screen"]);const s=y9();if(!s)throw console.error("failed to fetch electron, please mount it to window"),new Le(te.ELECTRON_IS_NULL);let a=null;try{var c;a=((c=s.desktopCapturer)===null||c===void 0?void 0:c.getSources({types:r}))||s.ipcRenderer.invoke("DESKTOP_CAPTURER_GET_SOURCES",{types:r})}catch{a=null}a&&a.then||(a=new mt(((d,h)=>{s.desktopCapturer.getSources({types:r},((m,g)=>{m?h(m):d(g)}))})));try{return await a}catch(d){throw new Le(te.ELECTRON_DESKTOP_CAPTURER_GET_SOURCES_ERROR,d.toString())}}const v2=new so("safari");let aW=!1,cW=!1;async function hl(t,r){let s=0,a=null;for(;s<2;)try{a=await mge(t,r,s>0);break}catch(c){if(c instanceof Le)throw M.error("[".concat(r,"] ").concat(c.toString())),c;const d=V1(c.name||c.code||c,c.message);if(d.code===te.MEDIA_OPTION_INVALID){M.debug("[".concat(r,"] detect media option invalid, retry")),s+=1,await Is(500);continue}throw M.error("[".concat(r,"] ").concat(d.toString())),d}if(!a)throw new Le(te.UNEXPECTED_ERROR,"can not find stream after getUserMedia");return a}async function mge(t,r,s){if(!navigator.mediaDevices||!navigator.mediaDevices.getUserMedia)throw new Le(te.NOT_SUPPORTED,"can not find getUserMedia");s&&(t.video&&(delete t.video.width,delete t.video.height),t.screen&&(delete t.screen.width,delete t.screen.height));const a=Wn(),c=new MediaStream;if(t.audioSource&&c.addTrack(t.audioSource),t.videoSource&&c.addTrack(t.videoSource),!t.audio&&!t.video&&!t.screen)return M.debug("Using Video Source/ Audio Source"),c;if(t.screen)if(y9())t.screen.sourceId?p0(c,await sW(t.screen.sourceId,t.screen,!!t.screenAudio)):p0(c,await fge(t.screen,!!t.screenAudio));else if(Ef()&&t.screen.extensionId&&t.screen.mandatory){if(!a.getStreamFromExtension)throw new Le(te.NOT_SUPPORTED,"This browser does not support screen sharing");M.debug("[".concat(r,'] Screen access on chrome stable, looking for extension"'));const A=await(h=t.screen.extensionId,m=r,new mt(((N,H)=>{try{chrome.runtime.sendMessage(h,{getStream:!0},(B=>{if(!B||!B.streamId)return M.error("[".concat(m,"] No response from Chrome Plugin. Plugin not installed properly"),B),void H(new Le(te.CHROME_PLUGIN_NO_RESPONSE,"No response from Chrome Plugin. Plugin not installed properly"));N(B.streamId)}))}catch(B){M.error("[".concat(m,"] AgoraRTC screensharing plugin is not accessible(").concat(h,")"),B.toString()),H(new Le(te.CHROME_PLUGIN_NOT_INSTALL))}})));t.screen.mandatory.chromeMediaSourceId=A,p0(c,await navigator.mediaDevices.getUserMedia({video:{mandatory:t.screen.mandatory}}))}else if(a.getDisplayMedia){var d;t.screen.mediaSource&&X9(t.screen.mediaSource);const A={width:t.screen.width,height:t.screen.height,frameRate:t.screen.frameRate,displaySurface:(d=t.screen.displaySurface)!==null&&d!==void 0?d:t.screen.mediaSource==="screen"?"monitor":t.screen.mediaSource},{selfBrowserSurface:N,surfaceSwitching:H,systemAudio:B,preferCurrentTab:z}=t.screen,ee={selfBrowserSurface:N,surfaceSwitching:H,systemAudio:B,preferCurrentTab:z};!N&&delete ee.selfBrowserSurface,!H&&delete ee.surfaceSwitching,!B&&delete ee.systemAudio,!z&&delete ee.preferCurrentTab,M.debug("[".concat(r,"] getDisplayMedia:"),JSON.stringify({video:A,audio:t.screenAudio,controls:ee})),p0(c,await navigator.mediaDevices.getDisplayMedia(Pr({video:A,audio:t.screenAudio},ee)))}else{if(!ii())throw M.error("[".concat(r,"] This browser does not support screenSharing")),new Le(te.NOT_SUPPORTED,"This browser does not support screen sharing");{t.screen.mediaSource&&X9(t.screen.mediaSource);const A={video:{mediaSource:t.screen.mediaSource,width:t.screen.width,height:t.screen.height,frameRate:t.screen.frameRate}};M.debug("[".concat(r,"] getUserMedia: ").concat(JSON.stringify(A))),p0(c,await navigator.mediaDevices.getUserMedia(A))}}var h,m;if(!t.video&&!t.audio)return c;let g={video:t.video,audio:t.audio},v=oe("MEDIA_DEVICE_CONSTRAINTS");if(v)try{typeof v=="string"&&(v=JSON.parse(v)),g=XL(g,v)}catch{}M.debug("[".concat(r,"] GetUserMedia"),JSON.stringify(g)),Mn();let w,I=null;(Fs()||To()||T1())&&(I=await v2.lock());try{w=await navigator.mediaDevices.getUserMedia(g)}catch(A){throw I&&I(),A}return g.audio&&(aW=!0),g.video&&(cW=!0),p0(c,w),I&&I(),c}function V1(t,r){switch(t){case"Starting video failed":case"OverconstrainedError":case"TrackStartError":return new Le(te.MEDIA_OPTION_INVALID,"".concat(t,": ").concat(r));case"NotFoundError":case"DevicesNotFoundError":return new Le(te.DEVICE_NOT_FOUND,"".concat(t,": ").concat(r));case"NotSupportedError":return new Le(te.NOT_SUPPORTED,"".concat(t,": ").concat(r));case"NotReadableError":return new Le(te.NOT_READABLE,"".concat(t,": ").concat(r));case"InvalidStateError":case"NotAllowedError":case"PERMISSION_DENIED":case"PermissionDeniedError":return new Le(te.PERMISSION_DENIED,"".concat(t,": ").concat(r));case"ConstraintNotSatisfiedError":return new Le(te.CONSTRAINT_NOT_SATISFIED,"".concat(t,": ").concat(r));default:return M.error("getUserMedia unexpected error",t),new Le(te.UNEXPECTED_ERROR,"".concat(t,": ").concat(r))}}function p0(t,r){const s=t.getVideoTracks()[0],a=t.getAudioTracks()[0],c=r.getVideoTracks()[0],d=r.getAudioTracks()[0];d&&(a&&t.removeTrack(a),t.addTrack(d)),c&&(s&&t.removeTrack(s),t.addTrack(c))}const pl=new class extends Zr{get state(){return this._state}set state(t){t!==this._state&&(this.emit(cy.STATE_CHANGE,t),this._state=t)}constructor(){super(),Pe(this,"_state",gT.IDLE),Pe(this,"isAccessMicrophonePermission",!1),Pe(this,"isAccessCameraPermission",!1),Pe(this,"lastAccessMicrophonePermission",!1),Pe(this,"lastAccessCameraPermission",!1),Pe(this,"checkdeviceMatched",!1),Pe(this,"deviceInfoMap",new Map),this.init().then((()=>{navigator.mediaDevices.addEventListener&&navigator.mediaDevices.addEventListener("devicechange",this.updateDevicesInfo.bind(this)),window.setInterval((()=>{(oe("ENUMERATE_DEVICES_INTERVAL")||(C1()||w1()===os.HARMONY_OS)&&vf())&&this.updateDevicesInfo()}),oe("ENUMERATE_DEVICES_INTERVAL_TIME"))})).catch((t=>M.error(t.toString())))}async enumerateDevices(t,r){let s=arguments.length>2&&arguments[2]!==void 0&&arguments[2];if(!navigator.mediaDevices||!navigator.mediaDevices.enumerateDevices)return new Le(te.NOT_SUPPORTED,"enumerateDevices() not supported.").throw();const a=await navigator.mediaDevices.enumerateDevices(),c=this.checkMediaDeviceInfoIsOk(a);let d=!this.isAccessMicrophonePermission&&t,h=!this.isAccessCameraPermission&&r;c.audio&&(d=!1),c.video&&(h=!1);let m=null,g=null,v=null;if(!s&&(d||h)){if(v2.isLocked&&(M.debug("[device manager] wait GUM lock"),(await v2.lock())(),M.debug("[device manager] GUM unlock")),aW&&(d=!1,this.isAccessMicrophonePermission=!0),cW&&(h=!1,this.isAccessCameraPermission=!0),M.debug("[device manager] check media device permissions",t,r,d,h),d&&h){try{v=await navigator.mediaDevices.getUserMedia({audio:!0,video:!0})}catch(w){const I=V1(w.name||w.code||w,w.message);if(I.code===te.PERMISSION_DENIED)throw I;M.warning("getUserMedia failed in getDevices",I)}this.isAccessCameraPermission=!0,this.isAccessMicrophonePermission=!0}else if(d){try{m=await navigator.mediaDevices.getUserMedia({audio:t})}catch(w){const I=V1(w.name||w.code||w,w.message);if(I.code===te.PERMISSION_DENIED)throw I;M.warning("getUserMedia failed in getDevices",I)}this.isAccessMicrophonePermission=!0}else if(h){try{g=await navigator.mediaDevices.getUserMedia({video:r})}catch(w){const I=V1(w.name||w.code||w,w.message);if(I.code===te.PERMISSION_DENIED)throw I;M.warning("getUserMedia failed in getDevices",I)}this.isAccessCameraPermission=!0}M.debug("[device manager] mic permission",t,"cam permission",r)}try{const w=await navigator.mediaDevices.enumerateDevices();return m&&m.getTracks().forEach((I=>I.stop())),g&&g.getTracks().forEach((I=>I.stop())),v&&v.getTracks().forEach((I=>I.stop())),m=null,g=null,v=null,w}catch(w){return m&&m.getTracks().forEach((I=>I.stop())),g&&g.getTracks().forEach((I=>I.stop())),v&&v.getTracks().forEach((I=>I.stop())),m=null,g=null,v=null,new Le(te.ENUMERATE_DEVICES_FAILED,w.toString()).throw()}}async getRecordingDevices(){let t=arguments.length>0&&arguments[0]!==void 0&&arguments[0];return(await this.enumerateDevices(!0,!1,t)).filter((r=>r.kind==="audioinput"))}async getCamerasDevices(){let t=arguments.length>0&&arguments[0]!==void 0&&arguments[0];return(await this.enumerateDevices(!1,!0,t)).filter((r=>r.kind==="videoinput"))}async getSpeakers(){let t=arguments.length>0&&arguments[0]!==void 0&&arguments[0];return(await this.enumerateDevices(!0,!1,t)).filter((r=>r.kind==="audiooutput"))}searchDeviceIdByName(t){let r=null;return this.deviceInfoMap.forEach((s=>{s.device.label===t&&(r=s.device.deviceId)})),r}async getDeviceById(t){const r=(await this.enumerateDevices(!0,!0,!0)).find((s=>s.deviceId===t));if(!r)throw new Le(te.DEVICE_NOT_FOUND,"deviceId: ".concat(t));return r}async init(){this.state=gT.INITING;try{await this.updateDevicesInfo(),this.state=gT.INITEND}catch(t){throw M.warning("Device Detection functionality cannot start properly.",t.toString()),this.state=gT.IDLE,(typeof isSecureContext=="boolean"?isSecureContext:location.protocol==="https:"||location.protocol==="file:"||location.hostname==="localhost"||location.hostname==="127.0.0.1"||location.hostname==="::1")||new Le(te.WEB_SECURITY_RESTRICT,"Your context is limited by web security, please try using https protocol or localhost.").throw(),t}}async updateDevicesInfo(){const t=await this.enumerateDevices(!0,!0,!0),r=Date.now(),s=[];if(t[0]&&t[0].label&&this.checkdeviceMatched===!1){this.checkdeviceMatched=!0;const c=t.find((h=>h.kind==="audioinput"&&h.deviceId==="default")),d=t.find((h=>h.kind==="audiooutput"&&h.deviceId==="default"));c&&d?d.groupId===c.groupId?M.debug("[device-check] default input ".concat(c.label," and output ").concat(d.label," is the same group")):M.debug("[device-check] default input ".concat(c.label," and output ").concat(d.label," is not the same group")):M.debug("[device-check] default input or output not found")}const a=this.checkMediaDeviceInfoIsOk(t);if(t.forEach((c=>{if(!c.deviceId)return;const d=this.deviceInfoMap.get("".concat(c.kind,"_").concat(c.deviceId));if((d?d.state:"INACTIVE")!=="ACTIVE"){const h={initAt:r,updateAt:r,device:c,state:"ACTIVE"};this.deviceInfoMap.set("".concat(c.kind,"_").concat(c.deviceId),h),s.push(h)}d&&(d.updateAt=r)})),this.deviceInfoMap.forEach(((c,d)=>{c.state==="ACTIVE"&&c.updateAt!==r&&(c.state="INACTIVE",s.push(c))})),this.state!==gT.INITEND)return a.audio&&(this.lastAccessMicrophonePermission=!0,this.isAccessMicrophonePermission=!0),void(a.video&&(this.lastAccessCameraPermission=!0,this.isAccessCameraPermission=!0));s.forEach((c=>{switch(c.device.kind){case"audioinput":this.lastAccessMicrophonePermission&&this.isAccessMicrophonePermission&&this.emit(cy.RECORDING_DEVICE_CHANGED,c);break;case"videoinput":this.lastAccessCameraPermission&&this.isAccessCameraPermission&&this.emit(cy.CAMERA_DEVICE_CHANGED,c);break;case"audiooutput":this.lastAccessMicrophonePermission&&this.isAccessMicrophonePermission&&this.emit(cy.PLAYOUT_DEVICE_CHANGED,c)}})),a.audio&&(this.lastAccessMicrophonePermission=!0,this.isAccessMicrophonePermission=!0),a.video&&(this.lastAccessCameraPermission=!0,this.isAccessCameraPermission=!0)}checkMediaDeviceInfoIsOk(t){const r=t.filter((c=>c.kind==="audioinput")),s=t.filter((c=>c.kind==="videoinput")),a={audio:!1,video:!1};for(const c of r)if(c.label&&c.deviceId){a.audio=!0;break}for(const c of s)if(c.label&&c.deviceId){a.video=!0;break}return a}};let S2=!1;const fl=new class extends Zr{constructor(){super(...arguments),Pe(this,"onAutoplayFailed",void 0),Pe(this,"onAudioAutoplayFailed",void 0)}};function lW(){if(Mn(),!S2){const t=r=>{r.preventDefault(),S2=!1,oT()?document.body.removeEventListener("click",t,!0):(document.body.removeEventListener("touchstart",t,!0),document.body.removeEventListener("mousedown",t,!0))};S2=!0,oT()?document.body.addEventListener("click",t,!0):(document.body.addEventListener("touchstart",t,!0),document.body.addEventListener("mousedown",t,!0)),M.info("detect media autoplay failed, document: https://docs.agora.io/cn/Voice/autoplay_policy_web_ng?platform=Web"),fl.onAutoplayFailed?fl.onAutoplayFailed():fl.onAudioAutoplayFailed?M.warning(`AgoraRTC.onAudioAutoplayFailed has been deprecated in favor of AgoraRTC.onAutoplayFailed.

  Please refer to the Agora document to migrate the newer API, https://docs.agora.io/en/Voice/autoplay_policy_web_ng?platform=Web .`):M.warning(`We have detected a media autoplay failed event, and found out that you haven't implemented AgoraRTC.onAutoplayFailed callback yet.

  It will cause audio/video element not playing automatically on some browsers without user interaction, possibly hurting user experiences.

  Please refer to the Agora document to properly handle autoplay failed event, https://docs.agora.io/en/Voice/autoplay_policy_web_ng?platform=Web .`),fl.emit("autoplay-failed")}}function uW(t,r,s,a){if(!t)return;const c=It.getBaseInfoBySessionId(t);if(!c)return;const d=c.info,h=Date.now(),m=Pr(Pr({},d),{},{vid:d.vid===void 0?0:Number(d.vid),lts:h,elapse:h-c.startTime,cbRegistered:fl.onAutoplayFailed||fl.onAudioAutoplayFailed?1:-1,errorMsg:s,mediaType:r,trackId:a,extend:void 0});It.send({type:Br.AUTOPLAY_FAILED,data:m},!0)}const gge=["play","playing","loadeddata","canplay","pause","stalled","suspend","waiting","abort","emptied","ended","error"],xa=new class{constructor(){Pe(this,"onAutoplayFailed",void 0),Pe(this,"elementMap",new Map),Pe(this,"elementStateMap",new Map),Pe(this,"elementsNeedToResume",[]),Pe(this,"sinkIdMap",new Map),Pe(this,"autoResumeAfterInterruption",(t=>{Array.from(this.elementMap.entries()).forEach((r=>{let[s,a]=r;const c=this.elementStateMap.get(s),d=a.srcObject.getAudioTracks()[0],h=d&&d.readyState;if(M.debug("resume after interrupted, ele: ".concat(c," audio: ").concat(h," ").concat(t)),h==="live"){if(t)return a.pause(),void a.play();if(_r.curState==="running")return Zv()?(a.pause(),void a.play()):void(c&&c==="paused"&&a.play())}}))})),Pe(this,"autoResumeAfterInterruptionOnIOS15_16",(()=>{Array.from(this.elementMap.entries()).forEach((t=>{let[r,s]=t;const a=s.srcObject.getAudioTracks()[0];a&&a.readyState==="live"&&(M.debug("auto resume after interruption inside autoResumeAfterInterruptionOnIOS15"),s.pause(),s.play())}))})),this.autoResumeAudioElement(),_r.on(Ps.IOS_INTERRUPTION_END,this.autoResumeAfterInterruption),_r.on(Ps.IOS_15_16_INTERRUPTION_END,this.autoResumeAfterInterruptionOnIOS15_16),_r.on(Ps.STATE_CHANGE,(()=>{To()&&_r.prevState==="suspended"&&_r.curState==="running"&&this.autoResumeAfterInterruption()}))}async setSinkID(t,r){const s=this.elementMap.get(t);if(this.sinkIdMap.set(t,r),s)try{await s.setSinkId(r)}catch(a){throw new Le(te.PERMISSION_DENIED,"can not set sink id: "+a.toString())}}play(t,r,s,a){if(this.elementMap.has(r))return;const c=document.createElement("audio");c.autoplay=!0,c.srcObject=new MediaStream([t]),this.bindAudioElementEvents(r,c),this.elementMap.set(r,c),this.elementStateMap.set(r,oo.INIT),this.setVolume(r,s);const d=this.sinkIdMap.get(r);if(d)try{c.setSinkId(d).catch((m=>{M.warning("[".concat(r,"] set sink id failed"),m.toString())}))}catch(m){M.warning("[".concat(r,"] set sink id failed"),m.toString())}const h=c.play();h&&h.then&&h.catch((m=>{a&&uW(a,"audio",m.message,r),M.warning("audio element play warning",m.toString()),this.elementMap.has(r)&&m.name==="NotAllowedError"&&(M.warning("detected audio element autoplay failed"),this.elementsNeedToResume.push(c),I1((()=>{this.onAutoplayFailed&&this.onAutoplayFailed(),lW()})))}))}updateTrack(t,r){const s=this.elementMap.get(t);s&&(s.srcObject=new MediaStream([r]))}isPlaying(t){return this.elementMap.has(t)&&this.elementStateMap.get(t)==="playing"}setVolume(t,r){const s=this.elementMap.get(t);s&&(r=Math.max(0,Math.min(100,r)),s.volume=r/100)}stop(t){const r=this.elementMap.get(t);if(this.sinkIdMap.delete(t),!r)return;const s=this.elementsNeedToResume.indexOf(r);this.elementsNeedToResume.splice(s,1),r.srcObject=null,r.remove(),this.elementMap.delete(t),this.elementStateMap.delete(t)}bindAudioElementEvents(t,r){gge.forEach((s=>{r.addEventListener(s,(a=>{const c=this.elementStateMap.get(t),d=a.type==="pause"?"paused":a.type;if(M.debug("[".concat(t,"] audio-element-status change ").concat(c," => ").concat(d)),a.type==="error"){const h=r==null?void 0:r.error;h&&M.error("[".concat(t,"] media error, code: ").concat(h.code,", message: ").concat(h.message))}this.elementStateMap.set(t,d)}))}))}getPlayerState(t){return this.elementStateMap.get(t)||"uninit"}autoResumeAudioElement(){const t=()=>{this.elementsNeedToResume.forEach((r=>{r.play().then((s=>{M.debug("Auto resume audio element success")})).catch((s=>{M.warning("Auto resume audio element failed!",s)}))})),this.elementsNeedToResume=[]};new mt((r=>{document.body?r():window.addEventListener("load",(()=>r()))})).then((()=>{oT()?document.body.addEventListener("click",t,!0):(document.body.addEventListener("touchstart",t,!0),document.body.addEventListener("mousedown",t,!0))}))}};function li(){return function(t,r,s){const a=s.value;return typeof a=="function"&&(s.value=function(){this._isClosed&&new Le(te.INVALID_OPERATION,"[".concat(this.getTrackId(),"] cannot operate a closed track")).print("warning",M);for(var c=arguments.length,d=new Array(c),h=0;h<c;h++)d[h]=arguments[h];const m=a.apply(this,d);return m instanceof mt?new mt(((g,v)=>{m.then(g).catch(v)})):m}),s}}class dW extends Zr{constructor(r){super(),Pe(this,"name","VideoProcessorDestination"),Pe(this,"ID","0"),Pe(this,"_source",void 0),Pe(this,"videoContext",void 0),Pe(this,"inputTrack",void 0),this.videoContext=r}get kind(){return"video"}get enabled(){return!0}pipe(){throw new Le(te.NOT_SUPPORTED,"VideoProcessor cannot pipe to any other Processor")}unpipe(){throw new Le(te.NOT_SUPPORTED,"VideoProcessor cannot unpipe to any other Processor")}enable(){}disable(){}updateInput(r){if(r.context!==this.videoContext)throw new Error(`ProcessorContext passed to VideoTrack.processorDestination doesn't match it's belonging VideoTrack's context.
Probably you are making pipeline like this:
videoTrack1.pipe(processor).pipe(videoTrack2.processorDestination).`);r.track&&r.track!==this.inputTrack&&(this.videoContext.chained=!0,this.inputTrack=r.track,this.emit(ha.ON_TRACK,r.track))}reset(){this.inputTrack=void 0,this.videoContext.chained=!1,this.emit(ha.ON_TRACK,void 0)}}class hW extends Zr{set chained(r){this._chained=r}get chained(){return this._chained}constructor(r,s){super(),Pe(this,"constraintsMap",new Map),Pe(this,"statsRegistry",[]),Pe(this,"usageRegistry",[]),Pe(this,"trackId",void 0),Pe(this,"direction",void 0),Pe(this,"_chained",!1),this.trackId=r,this.direction=s}async getConstraints(){return await zs(this,ul.REQUEST_CONSTRAINTS)}async requestApplyConstraints(r,s){var a;return M.info("processor ".concat(s.name," requestApplyConstraints for ").concat(this.trackId)),r&&this.constraintsMap.set(s,r),wr(this,ul.REQUEST_UPDATE_CONSTRAINTS,Array.from(Pc(a=this.constraintsMap).call(a)))}async requestRevertConstraints(r){var s;if(this.constraintsMap.has(r))return M.info("processor ".concat(r.name," requestRevertConstraints for ").concat(this.trackId)),this.constraintsMap.delete(r),wr(this,ul.REQUEST_UPDATE_CONSTRAINTS,Array.from(Pc(s=this.constraintsMap).call(s)))}registerStats(r,s,a){this.statsRegistry.find((c=>c.processorID===r.ID&&c.processorName===r.name&&c.type===s))||this.statsRegistry.push({processorName:r.name,processorID:r.ID,type:s,cb:a})}unregisterStats(r,s){const a=this.statsRegistry.findIndex((c=>c.processorID===r.ID&&c.processorName===r.name&&c.type===s));a!==-1&&this.statsRegistry.splice(a,1)}gatherStats(){const r=[];for(const{processorID:s,processorName:a,type:c,cb:d}of this.statsRegistry)try{const h=d();r.push({processorID:s,processorName:a,type:c,stats:h})}catch(h){M.error(new Le(te.UNEXPECTED_ERROR,h.message))}return r}registerUsage(r,s){this.usageRegistry.find((a=>a.processorID===r.ID&&a.processorName===r.name))||this.usageRegistry.push({processorID:r.ID,processorName:r.name,cb:s})}unregisterUsage(r){const s=this.usageRegistry.findIndex((a=>a.processorID===r.ID&&a.processorName===r.name));s!==-1&&this.usageRegistry.splice(s,1)}async gatherUsage(){const r=[];if(!this.chained)return[];for(const{cb:s}of this.usageRegistry)try{let a=s();a instanceof mt&&(a=await a),r.push(Pr(Pr({},a),{},{direction:this.direction}))}catch(a){M.error("gather extension usage error",a)}return r}getDirection(){return this.direction}}class pW extends Zr{constructor(r){super(),Pe(this,"name","AudioProcessorDestination"),Pe(this,"ID","0"),Pe(this,"inputTrack",void 0),Pe(this,"inputNode",void 0),Pe(this,"audioProcessorContext",void 0),Pe(this,"_source",void 0),this.audioProcessorContext=r}get kind(){return"audio"}get enabled(){return!0}pipe(){throw new Le(te.NOT_SUPPORTED,"AudioProcessorDestination cannot pipe to any other Processor")}unpipe(){throw new Le(te.NOT_SUPPORTED,"AudioProcessor cannot unpipe to any other Processor")}enable(){}disable(){}reset(){this.inputTrack=void 0,this.inputNode=void 0,this.audioProcessorContext.chained=!1,this.emit(ha.ON_TRACK,void 0),this.emit(ha.ON_NODE,void 0)}updateInput(r){if(r.context!==this.audioProcessorContext)throw new Error(`ProcessorContext passed to AudioTrack.processorDestination doesn't match it's belonging AudioTrack's context.
        Probably you are making pipeline like this: audioTrack1.pipe(processor).pipe(audioTrack2.processorDestination).`);r.track&&this.inputTrack!==r.track&&(this.audioProcessorContext.chained=!0,this.inputTrack=r.track,this.emit(ha.ON_TRACK,this.inputTrack)),r.node&&this.inputNode!==r.node&&(this.audioProcessorContext.chained=!0,this.inputNode=r.node,this.emit(ha.ON_NODE,this.inputNode))}}class fW extends Zr{set chained(r){this._chained=r}get chained(){return this._chained}constructor(r,s,a){super(),Pe(this,"constraintsMap",new Map),Pe(this,"statsRegistry",[]),Pe(this,"audioContext",void 0),Pe(this,"trackId",void 0),Pe(this,"direction",void 0),Pe(this,"usageRegistry",[]),Pe(this,"_chained",!1),this.audioContext=r,this.trackId=s,this.direction=a}async getConstraints(){return zs(this,ul.REQUEST_CONSTRAINTS)}getAudioContext(){return this.audioContext}async requestApplyConstraints(r,s){var a;return M.info("processor ".concat(s.name," requestApplyConstraints for ").concat(this.trackId)),r&&this.constraintsMap.set(s,r),wr(this,ul.REQUEST_UPDATE_CONSTRAINTS,Array.from(Pc(a=this.constraintsMap).call(a)))}async requestRevertConstraints(r){var s;if(this.constraintsMap.has(r))return this.constraintsMap.delete(r),wr(this,ul.REQUEST_UPDATE_CONSTRAINTS,Array.from(Pc(s=this.constraintsMap).call(s)))}registerStats(r,s,a){this.statsRegistry.find((c=>c.processorID===r.ID&&c.processorName===r.name&&c.type===s))||this.statsRegistry.push({processorName:r.name,processorID:r.ID,type:s,cb:a})}unregisterStats(r,s){const a=this.statsRegistry.findIndex((c=>c.processorID===r.ID&&c.processorName===r.name&&c.type===s));a!==-1&&this.statsRegistry.splice(a,1)}gatherStats(){const r=[];for(const{processorID:s,processorName:a,type:c,cb:d}of this.statsRegistry)try{const h=d();r.push({processorID:s,processorName:a,type:c,stats:h})}catch(h){M.error(new Le(te.UNEXPECTED_ERROR,h.message))}return r}registerUsage(r,s){this.usageRegistry.find((a=>a.processorID===r.ID&&a.processorName===r.name))||this.usageRegistry.push({processorID:r.ID,processorName:r.name,cb:s})}unregisterUsage(r){const s=this.usageRegistry.findIndex((a=>a.processorID===r.ID&&a.processorName===r.name));s!==-1&&this.usageRegistry.splice(s,1)}async gatherUsage(){const r=[];if(!this.chained)return[];for(const{cb:s}of this.usageRegistry)try{let a=s();a instanceof mt&&(a=await a),r.push(Pr(Pr({},a),{},{direction:this.direction}))}catch(a){M.error("gather extension usage error",a)}return r}getDirection(){return this.direction}}class b2 extends Zr{get isPlayed(){return!0}get isFreeze(){return!1}constructor(){super(),Pe(this,"context",void 0),Pe(this,"processSourceNode",void 0),Pe(this,"outputTrack",void 0),Pe(this,"processedNode",void 0),Pe(this,"clonedTrack",void 0),Pe(this,"outputNode",void 0),this.outputNode=new _ge}setVolume(){}createOutputTrack(){throw new Le(te.NOT_SUPPORTED,"can not create output MediaStreamTrack when WebAudio disabled")}getOriginVolumeLevel(){return 0}getAccurateVolumeLevel(){return 0}stopGetAudioBuffer(){}startGetAudioBuffer(){}play(){}stop(){}destroy(){}updateTrack(){}updateOriginTrack(){}createMediaStreamSourceNode(){}}class _ge{disconnect(){}connect(){}}function mW(t){return new mt(((r,s)=>{let a=!1;const c=document.createElement("video");c.setAttribute("autoplay",""),c.setAttribute("muted",""),c.muted=!0,c.autoplay=!0,c.setAttribute("playsinline",""),c.setAttribute("style","position: fixed; top: 0; left: 0; width: 1px; height: 1px"),document.body.appendChild(c);const d=To()?"canplay":"playing";c.addEventListener(d,(()=>{const h=c.videoWidth,m=c.videoHeight;!h&&ii()||(a=!0,c.srcObject=null,c.remove(),r([h,m]))})),c.srcObject=new MediaStream([t]),c.play().catch(A1),setTimeout((()=>{a||(c.srcObject=null,c.remove(),r([c.videoWidth,c.videoHeight]))}),4e3)}))}function j1(t){const r={};t.facingMode&&(r.facingMode=t.facingMode),t.cameraId&&(r.deviceId={exact:t.cameraId});const s=qu(t.encoderConfig);return s.width!=null&&(r.width=s.width),s.height!=null&&(r.height=s.height),!p9()&&s.frameRate&&(r.frameRate=s.frameRate),s9()&&typeof r.frameRate=="object"&&(r.frameRate.max=60),ii()&&(r.frameRate={ideal:30,max:30}),r}function gW(t){const r={};return p9()||(t.AGC!==void 0&&(r.autoGainControl=t.AGC),t.AEC!==void 0&&(r.echoCancellation=t.AEC),t.ANS!==void 0&&(r.noiseSuppression=t.ANS,Ef()&&t.ANS&&(r.googHighpassFilter=t.ANS))),r}function _W(t){const r=gW(t);if(t.encoderConfig){const s=M1(t.encoderConfig);r.channelCount=s.stereo?2:1,r.sampleRate=s.sampleRate,r.sampleSize=s.sampleSize}return t.microphoneId&&(r.deviceId={exact:t.microphoneId}),C1()&&(r.sampleRate=void 0),r}const yge=t=>{const r=t._encoderConfig;if(!r)return;const{frameRate:s,width:a,height:c}=t.getMediaStreamTrackSettings();let{frameRate:d=s,width:h=a,height:m=c}=r;if(!d||!h||!m)return;h=n0(h),m=n0(m),d=n0(d);const{max:g,min:v}=(function(N,H,B){const z=200*Math.pow(B/15,.6)*Math.pow(N*H/640/360,.75);return{min:Math.floor(z),max:Math.floor(4*z)}})(h,m,d),{bitrateMax:w,bitrateMin:I}=r||{};w||M.debug("calculate bitrate: [w: ".concat(h,", h: ").concat(m,", fps: ").concat(d,"] => [brMax: ").concat(w,", brMin: ").concat(I,"]"));const{maxFramerate:A}=oe("ENCODER_CONFIG_LIMIT");return A&&typeof A=="number"&&(d=Math.min(d,A)),{frameRate:d,bitrateMax:w||g,bitrateMin:I||v,scaleResolutionDownBy:1,scale:0}},yW=async(t,r,s)=>await(async(a,c,d)=>{const h=(function(v){const w=[];for(let I=0;I<v.length;I+=2)w.push(parseInt(v.slice(I,I+2),16));return Uint8Array.from(w)})(P9(""+c+d)).slice(0,16),m=h.slice(0,12),g=await window.crypto.subtle.importKey("raw",h,"AES-GCM",!0,["encrypt"]);return new Uint8Array(await window.crypto.subtle.encrypt({name:"AES-GCM",iv:m},g,a))})(t.buffer,r,s),w2=t=>{const r=document.createElement("canvas");return r.width=2,r.height=2,new mt(((s,a)=>{r.toBlob((async c=>{if(r.remove(),c){const d=await EW(c);s({buffer:d,width:r.width,height:r.height})}else a(new Le(te.CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED))}),t,1)}))},EW=async t=>{const r=await t.arrayBuffer();return new Uint8Array(r)};var vW,SW,bW,wW,TW,CW,RW,IW,AW,PW,OW,kW,NW,xW,DW,LW,MW,UW,ei,VW,jW,FW,BW,zW,WW,cp,GW,HW,$W,KW,qW,YW,XW,JW,QW,ZW,eG,tG,nG,Gs;let ui=(vW=Wt({argsMap:(t,r)=>[t.getTrackId(),r],throttleTime:300}),SW=Wt({argsMap:(t,r)=>[t.getTrackId(),r]}),bW=li(),wW=r0("LocalAudioTrack","_enabledMutex"),TW=Wt({argsMap:(t,r)=>[t.getTrackId(),r]}),CW=li(),RW=r0("LocalAudioTrack","_enabledMutex"),IW=Wt({argsMap:(t,r)=>[t.getTrackId(),r]}),AW=li(),PW=li(),OW=li(),kW=Wt({argsMap:t=>[t.getTrackId()]}),NW=li(),xW=Wt({argsMap:t=>[t.getTrackId()]}),DW=li(),LW=Wt({argsMap:t=>[t.getTrackId()]}),MW=Wt({argsMap:(t,r)=>[t.getTrackId(),r.name]}),UW=Wt({argsMap:t=>[t.getTrackId()]}),Ln((ei=class extends d0{get _source(){return this.initWebAudio()}set _source(t){this._trackSource=t}get processorContext(){return this._processorContext||(this._processorContext=this.initProcessor().processorContext),this._processorContext}get processorDestination(){return this._processorDestination||(this._processorDestination=this.initProcessor().processorDestination),this._processorDestination}get isPlaying(){return this._useAudioElement?xa.isPlaying(this.getTrackId()):this._source.isPlayed}get __className__(){return"LocalAudioTrack"}constructor(t,r,s,a){super(t,s),Pe(this,"trackMediaType",u0.AUDIO),Pe(this,"_encoderConfig",void 0),Pe(this,"_trackSource",void 0),Pe(this,"metadata",[]),Pe(this,"_enabled",!0),Pe(this,"_volume",100),Pe(this,"_useAudioElement",!0),Pe(this,"_bypassWebAudio",!1),Pe(this,"processor",void 0),Pe(this,"_processorContext",void 0),Pe(this,"_processorDestination",void 0),Pe(this,"_getOriginVolumeLevel",void 0),this._encoderConfig=r,this._getOriginVolumeLevel=!!a,this._trackSource=new b2,oe("DISABLE_WEBAUDIO")&&(this._bypassWebAudio=!0),oe("LOCAL_AUDIO_TRACK_USES_WEB_AUDIO")&&(this._useAudioElement=!1),Fs()&&!dl?setTimeout((()=>this.initWebAudio())):this.initWebAudio()}setVolume(t){vr(t,"volume",0,1e3),this._volume=t,this._source.setVolume(t/100),this._useAudioElement&&xa.setVolume(this.getTrackId(),t);try{if(this._bypassWebAudio)return void M.debug("[".concat(this.getTrackId(),"] setVolume returned because no pass through WebAudio."));const r=this._source.createOutputTrack();this._mediaStreamTrack!==r&&(this._mediaStreamTrack=r,wr(this,Tt.NEED_REPLACE_TRACK,this).then((()=>{M.debug("[".concat(this.getTrackId(),"] replace web audio track success"))})).catch((s=>{M.warning("[".concat(this.getTrackId(),"] replace web audio track failed"),s)})))}catch{}}getVolumeLevel(){return this._muted&&this.enabled&&this._getOriginVolumeLevel?this._source.getOriginVolumeLevel():this._source.getAccurateVolumeLevel()}async setPlaybackDevice(t){if(!this._useAudioElement||!q9())throw new Le(te.NOT_SUPPORTED,"your browser does not support setting the audio output device");await xa.setSinkID(this.getTrackId(),t)}async setEnabled(t,r,s){return this._setEnabled(t,r,s)}async _setEnabled(t,r,s){if(!s){if(t===this._enabled)return;this.stateCheck("enabled",t)}if(M.info("[".concat(this.getTrackId(),"] start setEnabled"),t),t){this._originMediaStreamTrack.enabled=!0;try{s||(this._enabled=!0),await wr(this,Tt.NEED_ENABLE_TRACK,this),M.info("[".concat(this.getTrackId(),"] setEnabled to ").concat(t," success"))}catch(a){throw s||(this._enabled=!1),M.error("[".concat(this.getTrackId(),"] setEnabled to true error"),a.toString()),a}}else{this._originMediaStreamTrack.enabled=!1,s||(this._enabled=!1);try{await wr(this,Tt.NEED_DISABLE_TRACK,this)}catch(a){throw s||(this._enabled=!0),M.error("[".concat(this.getTrackId(),"] setEnabled to false error"),a.toString()),a}}}async setMuted(t){t!==this._muted&&(this.stateCheck("muted",t),this._muted=t,this._originMediaStreamTrack.enabled=!t,M.debug("[".concat(this.getTrackId(),"] start set muted: ").concat(t)),t?await wr(this,Tt.NEED_MUTE_TRACK,this):await wr(this,Tt.NEED_UNMUTE_TRACK,this))}getStats(){return Jm((()=>{M.warning("[deprecated] LocalAudioTrack.getStats will be removed in the future, use AgoraRTCClient.getLocalAudioStats instead")}),"localAudioTrackGetStatsWarning"),al(this,Tt.GET_STATS)||Pr({},m2)}setAudioFrameCallback(t){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:4096;if(!t)return this._source.removeAllListeners(ll.ON_AUDIO_BUFFER),void this._source.stopGetAudioBuffer();this._source.startGetAudioBuffer(r),this._source.removeAllListeners(ll.ON_AUDIO_BUFFER),this._source.on(ll.ON_AUDIO_BUFFER,(s=>t(s)))}play(){M.debug("[".concat(this.getTrackId(),"] start audio playback")),this._useAudioElement?(M.debug("[".concat(this.getTrackId(),"] start audio playback in element")),xa.play(this._mediaStreamTrack,this.getTrackId(),this._volume)):this._source.play()}stop(){M.debug("[".concat(this.getTrackId(),"] stop audio playback")),this._useAudioElement?xa.stop(this.getTrackId()):this._source.stop()}close(){super.close(),this._processorDestination&&this.unbindProcessorDestinationEvents(this._processorDestination),this._processorContext&&this.unbindProcessorContextEvents(this._processorContext),this.unpipe(),this._processorDestination&&this._processorDestination._source&&this._processorDestination._source.unpipe(),this._source.destroy()}_updatePlayerSource(){let t=!(arguments.length>0&&arguments[0]!==void 0)||arguments[0];M.debug("[".concat(this.getTrackId(),"] update player source track")),t&&this._source.updateTrack(this._mediaStreamTrack),this._useAudioElement&&xa.updateTrack(this.getTrackId(),this._mediaStreamTrack)}async _updateOriginMediaStreamTrack(t,r){this._originMediaStreamTrack!==t&&(this._originMediaStreamTrack&&(this._originMediaStreamTrack.removeEventListener("ended",this._handleTrackEnded),r&&this._originMediaStreamTrack.stop()),t.addEventListener("ended",this._handleTrackEnded),this._originMediaStreamTrack=t,this._muted&&(this._originMediaStreamTrack.enabled=!1),this.processor&&this._processorContext&&this.processor.updateInput({track:t,context:this._processorContext}),this._mediaStreamTrack!==this._source.outputTrack?(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource(),await wr(this,Tt.NEED_REPLACE_TRACK,this)):this._source.updateTrack(this._originMediaStreamTrack),this._getOriginVolumeLevel&&this._source.updateOriginTrack(t))}renewMediaStreamTrack(t){return mt.resolve(void 0)}pipe(t){if(this._bypassWebAudio)throw new Le(te.INVALID_OPERATION,"Can not process AudioTrack when bypassWebAudio set to true.");if(this.processor===t)return t;if(t._source)throw new Le(te.INVALID_OPERATION,"Processor ".concat(t.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=t,this.processor._source=this,t.updateInput({track:this._originMediaStreamTrack,node:this._source.processSourceNode,context:this.processorContext}),t}unpipe(){var t;if(!this.processor)return;const r=this.processor;(t=this._source.processSourceNode)===null||t===void 0||t.disconnect(),this.processor._source=!1,this.processor=void 0,r.reset()}bindProcessorDestinationEvents(t){t.on(ha.ON_TRACK,(async r=>{r?r!==this._mediaStreamTrack&&(this._mediaStreamTrack=r,this._updatePlayerSource(!1),this._source.processedNode=this._source.createMediaStreamSourceNode(r),await wr(this,Tt.NEED_REPLACE_TRACK,this)):this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource(),await wr(this,Tt.NEED_REPLACE_TRACK,this))})),t.on(ha.ON_NODE,(r=>{this._source.processedNode=r}))}unbindProcessorDestinationEvents(t){t.removeAllListeners(ha.ON_TRACK),t.removeAllListeners(ha.ON_NODE)}bindProcessorContextEvents(t){t.on(ul.REQUEST_CONSTRAINTS,(async r=>{r(this._originMediaStreamTrack.getSettings())}))}unbindProcessorContextEvents(t){t.removeAllListeners(ul.REQUEST_CONSTRAINTS)}initWebAudio(){return this._trackSource instanceof b2&&(this._trackSource=new iW(this._mediaStreamTrack,!1,this._getOriginVolumeLevel?this._mediaStreamTrack:void 0)),this._trackSource}initProcessor(){const t=new fW(this._source.context,this.getTrackId(),"local"),r=new pW(t);return this._processorContext=t,this._processorDestination=r,this.bindProcessorContextEvents(t),this.bindProcessorDestinationEvents(r),this._source.on(ll.UPDATE_SOURCE,(()=>{this.processor&&this.processor.updateInput({node:this._source.processSourceNode,context:t})})),this._useAudioElement&&(this._useAudioElement=!1,this.isPlaying&&(xa.stop(this.getTrackId()),this._source.play()),wr(this,Tt.NEED_REPLACE_MIXING_TRACK,this).then((()=>{M.debug("[".concat(this.getTrackId(),"] replace from origin track to web audio track success"))})).catch((s=>{M.warning("[".concat(this.getTrackId(),"] replace from origin track to web audio track failed"),s)}))),{processorContext:t,processorDestination:r}}}).prototype,"setVolume",[vW],Object.getOwnPropertyDescriptor(ei.prototype,"setVolume"),ei.prototype),Ln(ei.prototype,"setPlaybackDevice",[SW,bW],Object.getOwnPropertyDescriptor(ei.prototype,"setPlaybackDevice"),ei.prototype),Ln(ei.prototype,"setEnabled",[wW,TW,CW],Object.getOwnPropertyDescriptor(ei.prototype,"setEnabled"),ei.prototype),Ln(ei.prototype,"setMuted",[RW,IW,AW],Object.getOwnPropertyDescriptor(ei.prototype,"setMuted"),ei.prototype),Ln(ei.prototype,"getStats",[PW],Object.getOwnPropertyDescriptor(ei.prototype,"getStats"),ei.prototype),Ln(ei.prototype,"setAudioFrameCallback",[OW],Object.getOwnPropertyDescriptor(ei.prototype,"setAudioFrameCallback"),ei.prototype),Ln(ei.prototype,"play",[kW,NW],Object.getOwnPropertyDescriptor(ei.prototype,"play"),ei.prototype),Ln(ei.prototype,"stop",[xW,DW],Object.getOwnPropertyDescriptor(ei.prototype,"stop"),ei.prototype),Ln(ei.prototype,"close",[LW],Object.getOwnPropertyDescriptor(ei.prototype,"close"),ei.prototype),Ln(ei.prototype,"pipe",[MW],Object.getOwnPropertyDescriptor(ei.prototype,"pipe"),ei.prototype),Ln(ei.prototype,"unpipe",[UW],Object.getOwnPropertyDescriptor(ei.prototype,"unpipe"),ei.prototype),ei),_T=(VW=Wt({argsMap:(t,r)=>[t.getTrackId(),r]}),jW=li(),FW=r0("MicrophoneAudioTrack","_enabledMutex"),BW=Wt({argsMap:(t,r,s)=>[t.getTrackId(),r,s]}),zW=li(),WW=Wt({argsMap:t=>[t.getTrackId()]}),Ln((cp=class extends ui{get __className__(){return"MicrophoneAudioTrack"}constructor(t,r,s,a){super(t,r.encoderConfig?M1(r.encoderConfig):{},a,oe("GET_VOLUME_OF_MUTED_AUDIO_TRACK")),Pe(this,"_config",void 0),Pe(this,"_deviceName","default"),Pe(this,"_constraints",void 0),Pe(this,"_originalConstraints",void 0),Pe(this,"_enabled",!0),this._config=r,this._constraints=s,this._originalConstraints=s,this._deviceName=t.label,typeof r.bypassWebAudio=="boolean"&&(this._bypassWebAudio=r.bypassWebAudio),(Zv()||WL())&&_r.bindInterruptDetectorTrack(this)}async setDevice(t){if(M.info("[".concat(this.getTrackId(),"] start set device to ").concat(t)),this._enabled)try{const r=await pl.getDeviceById(t),s={};s.audio=Pr({},this._constraints),s.audio.deviceId={exact:t},this._originMediaStreamTrack.stop();let a=null;try{a=await hl(s,this.getTrackId())}catch(c){throw M.error("[".concat(this.getTrackId(),"] setDevice failed"),c.toString()),a=await hl({audio:this._constraints},this.getTrackId()),await this._updateOriginMediaStreamTrack(a.getAudioTracks()[0],!1),c}await this._updateOriginMediaStreamTrack(a.getAudioTracks()[0],!1),this._deviceName=r.label,this._config.microphoneId=t,this._constraints.deviceId={exact:t}}catch(r){throw M.error("[".concat(this.getTrackId(),"] setDevice error"),r.toString()),r}else try{const r=await pl.getDeviceById(t);this._deviceName=r.label,this._config.microphoneId=t,this._constraints.deviceId={exact:t}}catch(r){throw M.error("[".concat(this.getTrackId(),"] setDevice error"),r.toString()),r}M.info("[".concat(this.getTrackId(),"] set device to ").concat(t," success"))}async setEnabled(t,r,s){if(r)return M.debug("[".concat(this.getTrackId(),"] setEnabled false (do not close microphone)")),await super._setEnabled(t);if(!s){if(t===this._enabled)return;this.stateCheck("enabled",t)}if(M.info("[".concat(this.getTrackId(),"] start setEnabled"),t),oe("AUTO_RESET_AUDIO_ROUTE")&&(To()||Hu())){const h=navigator.audioSession;h&&(t||(h.type="playback"),h.type="auto")}if(!t){var a;this._originMediaStreamTrack.onended=null,this._originMediaStreamTrack.stop(),(a=this._source.clonedTrack)===null||a===void 0||a.stop(),s||(this._enabled=!1);try{await wr(this,Tt.NEED_DISABLE_TRACK,this)}catch(h){throw M.error("[".concat(this.getTrackId(),"] setEnabled false failed"),h.toString()),h}return}const c=Pr({},this._constraints),d=pl.searchDeviceIdByName(this._deviceName);d&&!c.deviceId&&(c.deviceId=d);try{s||(this._enabled=!0);const h=await hl({audio:this._constraints},this.getTrackId());await this._updateOriginMediaStreamTrack(h.getAudioTracks()[0],!1),await wr(this,Tt.NEED_ENABLE_TRACK,this)}catch(h){throw s||(this._enabled=!1),M.error("[".concat(this.getTrackId(),"] setEnabled true failed"),h.toString()),h}M.info("[".concat(this.getTrackId(),"] setEnabled success"))}close(){super.close(),(Zv()||WL())&&_r.unbindInterruptDetectorTrack(this)}onTrackEnded(){if((To()||Hu())&&this._enabled&&!this._isClosed&&_r.duringInterruption){const t=async()=>{_r.off(Ps.IOS_INTERRUPTION_END,t),this._enabled&&!this._isClosed&&(M.debug("[".concat(this.getTrackId(),"] try capture microphone media device for interrupted iOS device.")),await this.setEnabled(!1),await this.setEnabled(!0))};_r.on(Ps.IOS_INTERRUPTION_END,t)}else M.debug("[".concat(this.getTrackId(),"] track ended")),this.safeEmit(l0.TRACK_ENDED)}async renewMediaStreamTrack(t){const r=t||this._constraints,s=pl.searchDeviceIdByName(this._deviceName);if(s&&!r.deviceId&&(r.deviceId=s),this._constraints=r,this._enabled){this._originMediaStreamTrack.stop();const a=await hl({audio:this._constraints},this.getTrackId());await this._updateOriginMediaStreamTrack(a.getAudioTracks()[0],!0)}}bindProcessorContextEvents(t){super.bindProcessorContextEvents(t),t.on(ul.REQUEST_UPDATE_CONSTRAINTS,(async(r,s,a)=>{try{const c=Object.assign({},this._originalConstraints,...r);await this.renewMediaStreamTrack(c),s()}catch(c){a(c)}}))}unbindProcessorContextEvents(t){super.unbindProcessorContextEvents(t),t.removeAllListeners(ul.REQUEST_UPDATE_CONSTRAINTS)}}).prototype,"setDevice",[VW,jW],Object.getOwnPropertyDescriptor(cp.prototype,"setDevice"),cp.prototype),Ln(cp.prototype,"setEnabled",[FW,BW,zW],Object.getOwnPropertyDescriptor(cp.prototype,"setEnabled"),cp.prototype),Ln(cp.prototype,"close",[WW],Object.getOwnPropertyDescriptor(cp.prototype,"close"),cp.prototype),cp),Ege=(GW=Wt({argsMap:(t,r)=>[t.getTrackId(),r,t.duration]}),HW=li(),$W=Wt({argsMap:t=>[t.getTrackId()]}),KW=li(),qW=Wt({argsMap:t=>[t.getTrackId()]}),YW=li(),XW=Wt({argsMap:t=>[t.getTrackId()]}),JW=li(),QW=Wt({argsMap:t=>[t.getTrackId()]}),ZW=li(),eG=Wt({argsMap:t=>[t.getTrackId()]}),tG=Wt({argsMap:t=>[t.getTrackId()]}),nG=li(),Ln((Gs=class extends ui{get __className__(){return"BufferSourceAudioTrack"}constructor(t,r,s,a){super(r.createOutputTrack(),s,a),Pe(this,"source",void 0),Pe(this,"_bufferSource",void 0),this._useAudioElement=!1,this.source=t,this._bufferSource=r,this._bufferSource.on(ll.AUDIO_SOURCE_STATE_CHANGE,(c=>{this.safeEmit(l0.SOURCE_STATE_CHANGE,c)}));try{this._mediaStreamTrack=this._source.createOutputTrack()}catch{}}get currentState(){return this._bufferSource.currentState}get duration(){return this._bufferSource.duration}get playbackSpeed(){return this._bufferSource.playbackSpeed}getCurrentTime(){return this._bufferSource.currentTime}startProcessAudioBuffer(t){t&&this._bufferSource.updateOptions(t),this._bufferSource.startProcessAudioBuffer()}pauseProcessAudioBuffer(){this._bufferSource.pauseProcessAudioBuffer()}seekAudioBuffer(t){this._bufferSource.seekAudioBuffer(t)}resumeProcessAudioBuffer(){this._bufferSource.resumeProcessAudioBuffer()}stopProcessAudioBuffer(){this._bufferSource.stopProcessAudioBuffer()}close(){this.source=null,this._bufferSource.destroy(),super.close()}setAudioBufferPlaybackSpeed(t){vr(t,"speed",0),this._bufferSource.setAudioBufferPlaybackSpeed(t)}}).prototype,"startProcessAudioBuffer",[GW,HW],Object.getOwnPropertyDescriptor(Gs.prototype,"startProcessAudioBuffer"),Gs.prototype),Ln(Gs.prototype,"pauseProcessAudioBuffer",[$W,KW],Object.getOwnPropertyDescriptor(Gs.prototype,"pauseProcessAudioBuffer"),Gs.prototype),Ln(Gs.prototype,"seekAudioBuffer",[qW,YW],Object.getOwnPropertyDescriptor(Gs.prototype,"seekAudioBuffer"),Gs.prototype),Ln(Gs.prototype,"resumeProcessAudioBuffer",[XW,JW],Object.getOwnPropertyDescriptor(Gs.prototype,"resumeProcessAudioBuffer"),Gs.prototype),Ln(Gs.prototype,"stopProcessAudioBuffer",[QW,ZW],Object.getOwnPropertyDescriptor(Gs.prototype,"stopProcessAudioBuffer"),Gs.prototype),Ln(Gs.prototype,"close",[eG],Object.getOwnPropertyDescriptor(Gs.prototype,"close"),Gs.prototype),Ln(Gs.prototype,"setAudioBufferPlaybackSpeed",[tG,nG],Object.getOwnPropertyDescriptor(Gs.prototype,"setAudioBufferPlaybackSpeed"),Gs.prototype),Gs);class Gi extends ui{get __className__(){return"MixingAudioTrack"}get isActive(){for(const r of this.trackList)if(r._enabled&&!r._isClosed&&!r.muted)return!0;return!1}constructor(){const r=h0().createMediaStreamDestination();super(r.stream.getAudioTracks()[0],void 0,Tr(8,"track-mix-")),Pe(this,"trackList",void 0),Pe(this,"destNode",void 0),this._useAudioElement=!1;try{this._mediaStreamTrack=this._source.createOutputTrack()}catch{}this.destNode=r,this.trackList=[]}hasAudioTrack(r){return this.trackList.indexOf(r)!==-1}addAudioTrack(r){this.trackList.indexOf(r)===-1?(M.debug("add ".concat(r.getTrackId()," to mixing track")),r._source.outputNode.connect(this.destNode),this.trackList.push(r),this.updateEncoderConfig()):M.debug("track ".concat(r.getTrackId()," is already added"))}removeAudioTrack(r){if(this.trackList.indexOf(r)!==-1){M.debug("remove ".concat(r.getTrackId()," from mixing track"));try{r._source.outputNode.disconnect(this.destNode)}catch{}R1(this.trackList,r),this.updateEncoderConfig()}}updateEncoderConfig(){const r={};this.trackList.forEach((s=>{s._encoderConfig&&((s._encoderConfig.bitrate||0)>(r.bitrate||0)&&(r.bitrate=s._encoderConfig.bitrate),(s._encoderConfig.sampleRate||0)>(r.sampleRate||0)&&(r.sampleRate=s._encoderConfig.sampleRate),(s._encoderConfig.sampleSize||0)>(r.sampleSize||0)&&(r.sampleSize=s._encoderConfig.sampleSize),s._encoderConfig.stereo&&(r.stereo=!0))})),this._encoderConfig=r}_updateRtpTransceiver(r){this._rtpTransceiver!==r&&(this._rtpTransceiver=r,this.trackList.forEach((s=>{s instanceof Gi?s.emit(ay.TRANSCEIVER_UPDATED,r):s._updateRtpTransceiver(r)})))}}class vge extends rW{set currentState(r){r!==this._currentState&&(this._currentState=r,this.safeEmit(ll.AUDIO_SOURCE_STATE_CHANGE,this._currentState))}get currentState(){return this._currentState}constructor(r){let s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};super(),Pe(this,"audioBuffer",void 0),Pe(this,"sourceNode",void 0),Pe(this,"startPlayTime",0),Pe(this,"startPlayOffset",0),Pe(this,"pausePlayTime",0),Pe(this,"options",void 0),Pe(this,"currentLoopCount",0),Pe(this,"currentPlaybackSpeed",100),Pe(this,"_currentState","stopped"),this.audioBuffer=r,this.options=s,this.startPlayOffset=this.options.startPlayTime||0}createWebAudioDiagram(){return this.context.createGain()}get duration(){return this.audioBuffer?this.audioBuffer.duration:0}get playbackSpeed(){return this.currentPlaybackSpeed}get currentTime(){return this.audioBuffer?this.currentState==="stopped"?0:this.currentState==="paused"?this.pausePlayTime:((this.context.currentTime-this.startPlayTime)*(this.playbackSpeed/100)+this.startPlayOffset)%this.audioBuffer.duration:0}updateOptions(r){this.currentState==="stopped"?(this.options=r,this.startPlayOffset=this.options.startPlayTime||0):M.warning("can not set audio source options")}startProcessAudioBuffer(){this.sourceNode&&this.stopProcessAudioBuffer(),this.sourceNode=this.createSourceNode(),this.startSourceNode(),this.currentState="playing"}pauseProcessAudioBuffer(){this.sourceNode&&this.currentState==="playing"&&(this.pausePlayTime=this.currentTime,this.sourceNode.onended=null,this.sourceNode.stop(),this.sourceNode.buffer=null,this.sourceNode=this.createSourceNode(),this.currentState="paused")}seekAudioBuffer(r){this.sourceNode&&(this.sourceNode.onended=null,this.currentState==="playing"&&this.sourceNode.stop(),this.sourceNode=this.createSourceNode(),this.currentState==="playing"?(this.startPlayOffset=r,this.startSourceNode()):this.currentState==="paused"&&(this.pausePlayTime=r))}resumeProcessAudioBuffer(){this.currentState==="paused"&&this.sourceNode&&(this.startPlayOffset=this.pausePlayTime,this.pausePlayTime=0,this.startSourceNode(),this.currentState="playing")}stopProcessAudioBuffer(){if(this.sourceNode){this.sourceNode.onended=null;try{this.sourceNode.stop()}catch{}this.reset()}}destroy(){this.audioBuffer=null,super.destroy()}setAudioBufferPlaybackSpeed(r){this.sourceNode&&(this.currentState==="playing"&&(this.startPlayOffset=this.currentTime,this.startPlayTime=this.context.currentTime),this.sourceNode.playbackRate.value=r/100),this.currentPlaybackSpeed=r}startSourceNode(){this.sourceNode&&this.sourceNode.buffer&&(this.sourceNode.start(0,this.startPlayOffset),this.startPlayTime=this.context.currentTime,this.sourceNode.onended=this.handleSourceNodeEnded.bind(this))}createSourceNode(){const r=this.context.createBufferSource();return r.buffer=this.audioBuffer,r.loop=!!this.options.loop,r.connect(this.outputNode),r.playbackRate.value=this.currentPlaybackSpeed/100,r}handleSourceNodeEnded(){if(this.currentLoopCount+=1,this.options.cycle&&this.options.cycle>this.currentLoopCount)return this.startPlayOffset=0,this.sourceNode=void 0,void this.startProcessAudioBuffer();this.reset()}reset(){this.startPlayOffset=this.options.startPlayTime||0,this.currentState="stopped",this.sourceNode&&(this.sourceNode.disconnect(),this.sourceNode=void 0),this.currentLoopCount=0}}const rG=new Map;function iG(t,r){if(t.length===0||r.length===0)return 1/0;const s=JL(t),a=JL(r);return Math.floor(a/s)}class T2{get rendFrameRate(){const r=Math.max(1,iG(this._render_interframe_delays_sizes,this._render_interframe_delays));return Math.floor(1e3/r)}get videoElementStatus(){return this._isInPage?this._videoElementStatus:oo.DESTROYED}set videoElementStatus(r){r!==this._videoElementStatus&&(M.debug("[".concat(this.trackId,"] video-element-status change ").concat(this._videoElementStatus," => ").concat(r)),this._videoElementStatus=r)}get videoState(){return this._videoState}set videoState(r){var s;r!==this._videoState&&(this._videoState=r,(s=this.onVideoStateChanged)===null||s===void 0||s.call(this,this.videoState))}constructor(r){Pe(this,"trackId",void 0),Pe(this,"config",void 0),Pe(this,"onFirstVideoFrameDecoded",void 0),Pe(this,"onFirstVideoFrameRender",void 0),Pe(this,"onVideoStateChanged",void 0),Pe(this,"freezeTimeCounterList",[]),Pe(this,"renderFreezeAccTime",0),Pe(this,"renderFreezeAccTime2",0),Pe(this,"isKeepLastFrame",!1),Pe(this,"isDestroyed",!1),Pe(this,"timeUpdatedCount",0),Pe(this,"freezeTime",0),Pe(this,"playbackTime",0),Pe(this,"lastTimeUpdatedTime",0),Pe(this,"autoplayFailed",!1),Pe(this,"videoTrack",void 0),Pe(this,"videoElement",void 0),Pe(this,"cacheVideoElement",void 0),Pe(this,"internal",!1),Pe(this,"_render_interframe_delays",[]),Pe(this,"_render_interframe_delays_sizes",[]),Pe(this,"_videoState",ap.VideoStateStopped),Pe(this,"videoElementCheckInterval",void 0),Pe(this,"videoElementFreezeTimeout",void 0),Pe(this,"_videoElementStatus",oo.NONE),Pe(this,"_isInPage",!0),Pe(this,"isGettingVideoDimensions",!1),Pe(this,"startGetVideoDimensions",(()=>{const s=()=>{if(this.isGettingVideoDimensions=!0,this.videoElement.videoWidth*this.videoElement.videoHeight>4)return M.debug("[".concat(this.trackId,"] current video dimensions:"),this.videoElement.videoWidth,this.videoElement.videoHeight),void(this.isGettingVideoDimensions=!1);setTimeout(s,500)};!this.isGettingVideoDimensions&&s()})),Pe(this,"autoResumeAfterInterruption",(()=>{this.videoTrack&&this.videoTrack.readyState==="live"&&_r.curState==="running"&&(M.debug("[track-".concat(this.trackId,"] video element paused, auto resume for ").concat(r9())),d9()?(this.videoElement.srcObject=null,this.videoElement.srcObject=new MediaStream([this.videoTrack]),this.videoElement.play()):(this.videoElement.pause(),this.videoElement.play()))})),Pe(this,"handleVideoEvents",(s=>{switch(s.type){case"play":case"playing":s.type==="play"&&M.debug("[".concat(this.trackId,"] video element status: play")),this.startGetVideoDimensions(),this.videoElementStatus=oo.PLAYING;break;case"loadeddata":if(this.videoState=ap.VideoStateStarting,this.onFirstVideoFrameRender&&this.onFirstVideoFrameRender(),this.onFirstVideoFrameDecoded&&this.onFirstVideoFrameDecoded(),this.cacheVideoElement){try{this.cacheVideoElement.srcObject=null,this.cacheVideoElement.remove()}catch{}this.cacheVideoElement=void 0}break;case"canplay":this.videoElementStatus=oo.CANPLAY;break;case"stalled":this.videoElementStatus=oo.STALLED;break;case"suspend":this.videoElementStatus=oo.SUSPEND;break;case"pause":this.videoElementStatus=oo.PAUSED,To()||Hu()||Fs()&&this.autoplayFailed||!this.videoTrack||this.videoTrack.readyState!=="live"||(M.debug("[track-".concat(this.trackId,"] video element paused, auto resume")),this.videoElement.play());break;case"waiting":this.videoElementStatus=oo.WAITING;break;case"abort":this.videoElementStatus=oo.ABORT;break;case"ended":this.videoElementStatus=oo.ENDED;break;case"emptied":this.videoElementStatus=oo.EMPTIED;break;case"error":{const a=this.videoElement.error;a&&(this.videoElementStatus=oo.ERROR,M.error("[".concat(this.trackId,"] media error: ").concat(a.message," (").concat(a.code,")")));break}case"timeupdate":{const a=performance.now();if(this.timeUpdatedCount+=1,this.timeUpdatedCount<10)return void(this.lastTimeUpdatedTime=a);const c=a-this.lastTimeUpdatedTime,d=this.lastTimeUpdatedTime;if(this.lastTimeUpdatedTime=a,lp.lastVisibleTime<lp.lastHiddenTime||d<lp.lastHiddenTime||d<lp.lastVisibleTime||this.isSkipCalcRenderFreezeTime())return;for(c>oe("VIDEO_FREEZE_DURATION")&&(this.freezeTime+=c),this.playbackTime+=c;this.playbackTime>=6e3;){this.playbackTime-=6e3;const h=Math.min(6e3,this.freezeTime);this.freezeTimeCounterList.push(h),this.freezeTime=Math.max(0,this.freezeTime-6e3)}break}}})),Pe(this,"autoResumeAfterInterruptionOnIOS15_16",(()=>{this.videoTrack&&this.videoTrack.readyState==="live"&&(M.debug("[track-".concat(this.trackId,"] video element paused, auto resume for ").concat(r9())),d9()?(this.videoElement.srcObject=null,this.videoElement.srcObject=new MediaStream([this.videoTrack]),this.videoElement.play()):(this.videoElement.pause(),this.videoElement.play()))})),this.trackId=r.trackId,this.config=r,r.element instanceof HTMLVideoElement?this.videoElement=r.element:this.videoElement=document.createElement("video"),_r.on(Ps.IOS_INTERRUPTION_END,this.autoResumeAfterInterruption),_r.on(Ps.IOS_15_16_INTERRUPTION_END,this.autoResumeAfterInterruptionOnIOS15_16)}getVideoElement(){return this.videoElement}getContainerElement(){var r;return(r=this.videoElement.parentElement)!==null&&r!==void 0?r:void 0}updateConfig(r){this.config=r,this.trackId=r.trackId,r.element!==this.videoElement&&(this.destroy(),this.videoElement=r.element),this.videoTrack&&this.initVideoElement()}updateVideoTrack(r){this.videoTrack!==r&&(this.videoTrack=r,this.initVideoElement())}play(r){const s=this.videoElement.play();s&&s.catch&&s.catch((c=>{r&&uW(r,"video",c.message,this.trackId),c.name==="NotAllowedError"?(M.warning("detected video element autoplay failed",c),this.autoplayFailed=!0,this.handleAutoPlayFailed()):M.warning("[".concat(this.trackId,"] play warning: "),c)}));const a=Mn();if((a.name==="Safari"&&Number(a.version)===15||Zv())&&s&&s.then){const c=()=>{this.config.mirror&&(this.videoElement.style.transform="rotateY(180deg)")};s.then(c).catch(c)}}getCurrentFrame(){const r=document.createElement("canvas");r.width=this.videoElement.videoWidth,r.height=this.videoElement.videoHeight;const s=r.getContext("2d");if(!s)return M.error("create canvas context failed!"),new ImageData(2,2);s.drawImage(this.videoElement,0,0,r.width,r.height);const a=s.getImageData(0,0,r.width,r.height);return r.remove(),a}async getCurrentFrameToUint8Array(r){let s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1;const a=document.createElement("canvas");a.width=this.videoElement.videoWidth,a.height=this.videoElement.videoHeight;const c=a.getContext("2d");return c?(c.drawImage(this.videoElement,0,0,a.width,a.height),new mt(((d,h)=>{a.toBlob((async m=>{if(a.remove(),m){const g=await EW(m);d({buffer:g,width:a.width,height:a.height})}else h(new Le(te.CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED))}),r,s<0?.1:s>1?1:s)}))):await w2(r)}destroy(){this.isDestroyed=!0,_r.off(Ps.IOS_INTERRUPTION_END,this.autoResumeAfterInterruption),_r.off(Ps.IOS_15_16_INTERRUPTION_END,this.autoResumeAfterInterruptionOnIOS15_16),this.videoElement.srcObject=null,this.resetVideoElement(),this.freezeTimeCounterList=[],this.videoState=ap.VideoStateStopped}initVideoElement(){if(this.videoElementStatus=oo.INIT,!this.videoElementCheckInterval&&(sG.forEach((d=>{this.videoElement.addEventListener(d,this.handleVideoEvents)})),this.videoElementCheckInterval=window.setInterval((()=>{this._isInPage=(function(d){return d!==document.body&&document.body.contains(d)})(this.videoElement)}),1e3),oe("ENABLE_VIDEO_FRAME_CALLBACK"))){var r,s;let d;const h=()=>{document.visibilityState==="visible"&&(document.removeEventListener("visibilitychange",h),this.videoElementFreezeTimeout=window.setTimeout(m,oe("VIDEO_FREEZE_DURATION")))},m=()=>{this.videoElementFreezeTimeout=void 0,this.videoState===ap.VideoStateDecoding&&(document.visibilityState==="visible"?this.videoState=ap.VideoStateFrozen:document.addEventListener("visibilitychange",h))},g=(v,w)=>{if(this.videoElementStatus===oo.PLAYING){if(d){const N=w.presentationTime-d.presentationTime,H=w.presentedFrames-d.presentedFrames;this._render_interframe_delays_sizes.push(H),this._render_interframe_delays.push(N);const B=JL(this._render_interframe_delays_sizes),z=B-this._render_interframe_delays_sizes[0];if(B>30&&z>5&&(this._render_interframe_delays_sizes.shift(),this._render_interframe_delays.shift()),this.videoState===ap.VideoStateStarting&&(this.videoState=ap.VideoStateDecoding),this.videoState===ap.VideoStateDecoding&&this.onVideoStateChanged&&(this.videoElementFreezeTimeout&&window.clearTimeout(this.videoElementFreezeTimeout),this.videoElementFreezeTimeout=window.setTimeout(m,oe("VIDEO_FREEZE_DURATION"))),N<oe("VIDEO_FREEZE_DURATION")&&this.videoState===ap.VideoStateFrozen&&(this.videoState=ap.VideoStateDecoding),N>oe("VIDEO_FREEZE_DURATION")&&lp.lastVisibleTime>=lp.lastHiddenTime&&d.timestamp>lp.lastVisibleTime&&d.timestamp>lp.lastHiddenTime){const ee=Math.min(66,iG(this._render_interframe_delays_sizes,this._render_interframe_delays)),Z=Math.max(0,N-(H-1)*ee);this.renderFreezeAccTime2+=Z>ee?Z:0,this.renderFreezeAccTime+=N}}d=Pr(Pr({},w),{},{timestamp:v})}else this.isSkipCalcRenderFreezeTime()&&(d=Pr(Pr({},w),{},{timestamp:v}));var I,A;oe("ENABLE_VIDEO_FRAME_CALLBACK")&&((I=(A=this.videoElement).requestVideoFrameCallback)===null||I===void 0||I.call(A,g))};(r=(s=this.videoElement).requestVideoFrameCallback)===null||r===void 0||r.call(s,g)}this.videoElement.controls=!1,this.videoElement.setAttribute("playsinline",""),C1()&&!oe("HIDE_NO_POSTER")&&(this.videoElement.poster="noposter");const a=Mn();a.name==="Safari"&&Number(a.version)===15||Zv()||!this.config.mirror||(this.videoElement.style.transform="rotateY(180deg)"),this.config.fit?this.videoElement.style.objectFit=this.config.fit:this.videoElement.style.objectFit="cover",this.videoElement.setAttribute("muted",""),this.videoElement.muted=!0,this.videoElement.srcObject&&this.videoElement.srcObject instanceof MediaStream?this.videoElement.srcObject.getVideoTracks()[0]!==this.videoTrack&&(this.videoElement.srcObject=this.videoTrack?new MediaStream([this.videoTrack]):null,ii()&&this.videoElement.load()):(this.videoElement.srcObject=this.videoTrack?new MediaStream([this.videoTrack]):null,ii()&&this.videoElement.load());const c=this.videoElement.play();c!==void 0&&c.catch((d=>{M.debug("[".concat(this.trackId,"] playback interrupted"),d.toString())}))}resetVideoElement(){sG.forEach((r=>{this.videoElement&&this.videoElement.removeEventListener(r,this.handleVideoEvents)})),this.videoElementCheckInterval&&(window.clearInterval(this.videoElementCheckInterval),this.videoElementCheckInterval=void 0),this.videoElementStatus=oo.NONE}isSkipCalcRenderFreezeTime(){return this.videoElementStatus===oo.DESTROYED||this.internal}handleAutoPlayFailed(){const r=s=>{s.preventDefault(),this.videoElement.play().then((()=>{M.debug("[".concat(this.trackId,"] Video element for trackId:").concat(this.trackId," autoplay resumed."))})).catch((a=>{M.error(a)})),this.autoplayFailed=!1,oT()?document.body.removeEventListener("click",r,!0):(document.body.removeEventListener("touchstart",r,!0),document.body.removeEventListener("mousedown",r,!0))};oT()?document.body.addEventListener("click",r,!0):(document.body.addEventListener("touchstart",r,!0),document.body.addEventListener("mousedown",r,!0)),lW()}}const sG=["play","playing","loadeddata","canplay","pause","stalled","suspend","waiting","abort","emptied","ended","timeupdate","error"];class C2 extends T2{constructor(r){let s=arguments.length>1&&arguments[1]!==void 0&&arguments[1];super(r),Pe(this,"container",void 0),Pe(this,"slot",void 0),this.slot=r.element,this.internal=s,this.updateConfig(r)}updateConfig(r){this.config=r,this.trackId=r.trackId;const s=r.element;var a;!this.internal||this.slot?(s!==this.slot&&(this.destroy(),this.slot=s),this.createElements()):(this.slot=s,s&&this.container?(this.internal=!1,this.container.id="agora-video-player-".concat(this.trackId),this.videoElement.id="video_".concat(this.trackId),this.config.fit?this.videoElement.style.objectFit=this.config.fit:this.videoElement.style.objectFit="cover",(a=this.slot)===null||a===void 0||a.appendChild(this.container)):this.createElements())}updateVideoTrack(r){this.videoTrack!==r&&(this.videoTrack=r,this.createElements())}play(r){var s;(s=this.container)!==null&&s!==void 0&&s.contains(this.videoElement)&&super.play(r)}getCurrentFrame(){var r;return(r=this.container)!==null&&r!==void 0&&r.contains(this.videoElement)?super.getCurrentFrame():new ImageData(2,2)}async getCurrentFrameToUint8Array(r){var s;let a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1;return(s=this.container)!==null&&s!==void 0&&s.contains(this.videoElement)?await super.getCurrentFrameToUint8Array(r,a):await w2(r)}destroy(){if(super.destroy(),this.videoElement.remove(),this.videoElement=document.createElement("video"),this.container){try{var r;this.container.remove(),(r=this.slot)===null||r===void 0||r.removeChild(this.container)}catch{}this.container=void 0}}createElements(){var r;this.container||(this.container=document.createElement("div")),this.container.id="agora-video-player-".concat(this.trackId),this.container.style.width="100%",this.container.style.height="100%",this.container.style.position="relative",this.container.style.overflow="hidden",this.videoTrack?(this.container.style.backgroundColor="black",oe("KEEP_LAST_FRAME")&&this.isKeepLastFrame&&this.videoElement.paused&&this.resetVideoElement(),this.mountedVideoElement()):this.unmountedVideoElement(),(r=this.slot)===null||r===void 0||r.appendChild(this.container)}mountedVideoElement(){var r;!this.container||(r=this.container)!==null&&r!==void 0&&r.contains(this.videoElement)||this.container.appendChild(this.videoElement),super.initVideoElement(),this.videoElement.id="video_".concat(this.trackId),this.videoElement.className="agora_video_player",this.videoElement.style.width="100%",this.videoElement.style.height="100%",this.videoElement.style.position="absolute",this.videoElement.style.left="0",this.videoElement.style.top="0"}unmountedVideoElement(){var r;if((r=this.container)!==null&&r!==void 0&&r.contains(this.videoElement)){super.resetVideoElement();try{this.container&&this.container.removeChild(this.videoElement)}catch{}this.videoElement=document.createElement("video")}}resetVideoElement(){var r;(r=this.container)!==null&&r!==void 0&&r.contains(this.videoElement)&&(super.resetVideoElement(),this.cacheVideoElement=this.videoElement,this.videoElement=document.createElement("video"))}getContainerElement(){return this.container}}var oG,aG,cG,lG,uG,dG,hG,pG,fG,mG,gG,_G,yG,EG,vG,SG,bG,wG,TG,CG,RG,IG,AG,PG,OG,kG,NG,xG,Rn,DG,LG,MG,UG,VG,jG,FG,BG,ml;let Nr=(oG=Wt({argsMap:(t,r,s)=>[t.getTrackId(),typeof r=="string"?r:r instanceof HTMLVideoElement?"HTMLVideoElement":"HTMLElement",s]}),aG=li(),cG=Wt({argsMap:t=>[t.getTrackId()]}),lG=r0("LocalVideoTrack","_enabledMutex"),uG=Wt({argsMap:(t,r)=>[t.getTrackId(),r]}),dG=li(),hG=r0("LocalVideoTrack","_enabledMutex"),pG=Wt({argsMap:(t,r)=>[t.getTrackId(),r]}),fG=li(),mG=Wt({argsMap:(t,r)=>[t.getTrackId(),r,t._saveEncodeBitrateRatio]}),gG=li(),_G=Wt({argsMap:(t,r)=>[t.getTrackId(),r]}),yG=li(),EG=li(),vG=Wt({argsMap:(t,r,s)=>[t.getTrackId(),r,s]}),SG=li(),bG=li(),wG=li(),TG=Wt({argsMap:t=>[t.getTrackId()]}),CG=li(),RG=li(),IG=li(),AG=li(),PG=li(),OG=Wt({argsMap:(t,r)=>[t.getTrackId(),r.name]}),kG=Wt({argsMap:t=>[t.getTrackId()]}),NG=Wt({argsMap:t=>[t.getTrackId()]}),xG=Wt({argsMap:(t,r,s)=>[t.getTrackId(),r.label,s]}),Rn=class rce extends d0{get videoHeight(){if(Fs()){const{height:r}=this._mediaStreamTrack.getSettings();return this._videoHeight=r,this._videoHeight}return this._videoHeight}get videoWidth(){if(Fs()){const{width:r}=this._mediaStreamTrack.getSettings();return this._videoWidth=r,this._videoWidth}return this._videoWidth}get isPlaying(){return!(!this._player||this._player.videoElementStatus!==oo.PLAYING)}get processorDestination(){return this._processorDestination}get processorContext(){return this._processorContext}set processorContext(r){this._processorContext=r}get __className__(){return"LocalVideoTrack"}constructor(r,s,a,c,d,h){if(super(r,d),Pe(this,"trackMediaType",u0.VIDEO),Pe(this,"_player",void 0),Pe(this,"isUseScaleResolutionDownBy",!1),Pe(this,"_videoVisibleTimer",null),Pe(this,"_previousVideoVisibleStatus",void 0),Pe(this,"_clearPreviousVideoVisibleStatus",(()=>this._previousVideoVisibleStatus=void 0)),Pe(this,"_encoderConfig",void 0),Pe(this,"_scalabilityMode",{numSpatialLayers:1,numTemporalLayers:1}),Pe(this,"_optimizationMode",void 0),Pe(this,"_saveEncodeBitrateRatio",1),Pe(this,"_videoHeight",void 0),Pe(this,"_videoWidth",void 0),Pe(this,"_forceBitrateLimit",void 0),Pe(this,"_enabled",!0),Pe(this,"_processorDestination",void 0),Pe(this,"_processorContext",void 0),Fs()){const{width:m,height:g}=r.getSettings();this._videoWidth=m,this._videoHeight=g}else this.updateMediaStreamTrackResolution();if(this._scalabilityMode=a,this._optimizationMode=c,this._hints=h||[],s&&this._hints.indexOf(Sr.CUSTOM_TRACK)!==-1?this._encoderConfig=Kr(s):this._encoderConfig=s,this._hints.indexOf(Sr.SCREEN_TRACK)===-1)this.updateBitrateFromProfile();else if(VL(Yn.CHROME,115)&&w1().indexOf("Windows")!==-1){const m=(function(g,v){if("VideoFrame"in window&&"TransformStream"in window&&Wn().supportWebRTCInsertableStream){const w=new MediaStreamTrackProcessor(g),I=new MediaStreamTrackGenerator({kind:"video"});let A,N,H=Date.now();const B=()=>{z&&(clearInterval(z),z=void 0),A&&(A.close(),A=void 0),g.stop(),N=void 0,I.removeEventListener("ended",B)};let z=window.setInterval((()=>{if(N&&A&&Date.now()-H>1e3)try{I.readyState==="live"?N.enqueue(A.clone()):B()}catch{B()}}),1e3);const ee=new TransformStream({transform:(Z,ae)=>{I.readyState==="live"?(N=ae,H=Date.now(),A===void 0?(A=Z,ae.enqueue(Z.clone())):(ae.enqueue(A),A=Z)):Z.close()}});return I.addEventListener("ended",B),w.readable.pipeThrough(ee).pipeTo(I.writable),I}})(r);m&&(M.info("local screen video track begin to inject frame"),this._mediaStreamTrack=m)}s&&this._hints.indexOf(Sr.CUSTOM_TRACK)!==-1&&this.setEncoderConfiguration(s),this._processorContext=new hW(this.getTrackId(),"local"),this._processorDestination=new dW(this.processorContext),this.bindProcessorDestinationEvents()}play(r){let s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(typeof r=="string"){const c=document.getElementById(r);c?r=c:(M.warning("[".concat(this.getTrackId(),'] can not find "#').concat(r,'" element, use document.body')),r=document.body)}M.debug("[".concat(this.getTrackId(),"] start video playback in ").concat(r instanceof HTMLVideoElement?"HTMLVideoElement":"HTMLElement"),JSON.stringify(s));const a=Pr(Pr(Pr({},this._getDefaultPlayerConfig()),s),{},{trackId:this.getTrackId(),element:r});this._player?this._player.updateConfig(a):(r instanceof HTMLVideoElement?this._player=new T2(a):this._player=new C2(a),this._player.updateVideoTrack(this._mediaStreamTrack)),this._player.play(),this._videoVisibleTimer&&window.clearInterval(this._videoVisibleTimer),this._clearPreviousVideoVisibleStatus(),this._videoVisibleTimer=window.setInterval((()=>{try{const c=this.getVideoElementVisibleStatus();this.safeEmit(l0.VIDEO_ELEMENT_VISIBLE_STATUS,c)}catch{}}),oe("CHECK_VIDEO_VISIBLE_INTERVAL"))}stop(){this._player&&(this._videoVisibleTimer&&(window.clearInterval(this._videoVisibleTimer),this._videoVisibleTimer=null),this._clearPreviousVideoVisibleStatus(),this._player.destroy(),this._player=void 0,M.debug("[".concat(this.getTrackId(),"] stop video playback")))}async setEnabled(r,s){if(!s){if(r===this._enabled)return;this.stateCheck("enabled",r)}if(M.info("[".concat(this.getTrackId(),"] start setEnabled"),r),!r){this._originMediaStreamTrack.enabled=!1;try{await wr(this,Tt.NEED_DISABLE_TRACK,this)}catch(a){throw M.error("[".concat(this.getTrackId(),"] setEnabled to false error"),a.toString()),a}return s||(this._enabled=!1),void M.info("[".concat(this.getTrackId(),"] setEnabled to false success"))}this._originMediaStreamTrack.enabled=!0;try{await wr(this,Tt.NEED_ENABLE_TRACK,this)}catch(a){throw M.error("[".concat(this.getTrackId(),"] setEnabled to true error"),a.toString()),a}M.info("[".concat(this.getTrackId(),"] setEnabled to true success")),s||(this._enabled=!0)}async setMuted(r){r!==this._muted&&(this.stateCheck("muted",r),this._muted=r,this._originMediaStreamTrack.enabled=!r,M.debug("[".concat(this.getTrackId(),"] start set muted: ").concat(r)),r?await wr(this,Tt.NEED_MUTE_TRACK,this):await wr(this,Tt.NEED_UNMUTE_TRACK,this))}async setSaveEncodeBitrateRatio(){let r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this._saveEncodeBitrateRatio;if(this._saveEncodeBitrateRatio!==1&&this._encoderConfig&&this._encoderConfig.bitrateMax&&this._encoderConfig.bitrateMin){this._encoderConfig.bitrateMin=Math.floor(this._encoderConfig.bitrateMin*r),this._encoderConfig.bitrateMax=Math.floor(this._encoderConfig.bitrateMax*r),M.debug("[".concat(this.getTrackId(),"] set save encode bitrate ratio, ").concat(r)),this._saveEncodeBitrateRatio=1;try{await wr(this,Tt.NEED_UPDATE_VIDEO_ENCODER,this)}catch(s){return s.throw(M)}}}async setEncoderConfiguration(r,s){if(!this._enabled)throw new Le(te.TRACK_IS_DISABLED,"can not set encoder configuration when track is disabled");if(r=qu(r),oe("USE_STANDARD_BITRATE_DEFAULT")&&(delete r.bitrateMax,delete r.bitrateMin),this._forceBitrateLimit&&(r.bitrateMax=this._forceBitrateLimit.max_bitrate?this._forceBitrateLimit.max_bitrate:r.bitrateMax,r.bitrateMin=this._forceBitrateLimit.min_bitrate?this._forceBitrateLimit.min_bitrate:r.bitrateMin),r.width||r.height||r.frameRate){const a=j1({encoderConfig:r});(Fs()||To()||Hu())&&(a.deviceId=void 0),M.debug("[".concat(this.getTrackId(),"] setEncoderConfiguration applyConstraints"),JSON.stringify(r),JSON.stringify(a));try{await this._originMediaStreamTrack.applyConstraints(a),this.updateMediaStreamTrackResolution()}catch(c){const d=new Le(te.UNEXPECTED_ERROR,c.toString());throw M.error("[".concat(this.getTrackId(),"] applyConstraints error"),d.toString()),d}}this._encoderConfig=r,this._hints.indexOf(Sr.SCREEN_TRACK)===-1&&this.updateBitrateFromProfile();try{await wr(this,Tt.NEED_UPDATE_VIDEO_ENCODER,this)}catch(a){return a.throw(M)}}getStats(){return Jm((()=>{M.warning("[deprecated] LocalVideoTrack.getStats will be removed in the future, use AgoraRTCClient.getLocalVideoStats instead")}),"localVideoTrackGetStatsWarning"),al(this,Tt.GET_STATS)||Pr({},g2)}async setBeautyEffect(r){M.error("LocalVideoTrack.setBeautyEffect was deprecated, please migrate to agora-extension-beauty-effect")}getCurrentFrameData(){return this._player?this._player.getCurrentFrame():new ImageData(2,2)}async getCurrentFrameImage(r){let s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1;return this._player?this._player.getCurrentFrameToUint8Array(r,s):await w2(r)}async findClosestProfile(){const{width:r,height:s,frameRate:a}=this.getMediaStreamTrackSettings(),{width:c,height:d,frameRate:h}=this._encoderConfig||{},m=n0(this._videoWidth||r||c||0),g=n0(this._videoHeight||s||d||0),v=(function(w,I,A){if(!Array.isArray(oe("VIDEO_ENCODER_CONFIG_LIST"))||oe("VIDEO_ENCODER_CONFIG_LIST").length===0)return!1;const N=Math.min(w,I);return!(N>=480)&&Pr(Pr({},oe("VIDEO_ENCODER_CONFIG_LIST").find((H=>H.height>N))),{},{frameRate:A})})(m,g,n0(a||h||15));if(v)return M.debug("[".concat(this.getTrackId(),"] find closest profile, ").concat(m,"x").concat(g," => ").concat(JSON.stringify(v))),this.setEncoderConfiguration(v)}async setBitrateLimit(r){M.debug("[".concat(this.getTrackId(),"] set bitrate limit, ").concat(JSON.stringify(r))),r&&(this._forceBitrateLimit=r,this._encoderConfig&&(this._encoderConfig.bitrateMax?this._encoderConfig.bitrateMax=this._encoderConfig.bitrateMax<r.max_bitrate?this._encoderConfig.bitrateMax:r.max_bitrate:this._encoderConfig.bitrateMax=r.max_bitrate,this._encoderConfig.bitrateMin,this._encoderConfig.bitrateMin=r.min_bitrate))}async setOptimizationMode(r){if(r!=="motion"&&r!=="detail"&&r!=="balanced")return void M.error(te.INVALID_PARAMS,"optimization mode must be motion, detail or balanced");const s=this._optimizationMode;try{this._optimizationMode=r,await wr(this,Tt.NEED_UPDATE_VIDEO_SEND_PARAMETERS,this)}catch(a){throw this._optimizationMode=s,M.error("[".concat(this.getTrackId(),"] set optimization mode failed"),a.toString()),a}M.info("[".concat(this.getTrackId(),"] set optimization mode success (").concat(r,")"))}setScalabiltyMode(r){if(r.numSpatialLayers===1&&r.numTemporalLayers!==1)return M.error(te.INVALID_PARAMS,"scalability mode currently not supported, no SVC."),void(this._scalabilityMode={numSpatialLayers:1,numTemporalLayers:1});this._scalabilityMode=r,M.info("[".concat(this.getTrackId(),"] set scalability mode success (").concat(r,")"))}updateMediaStreamTrackResolution(){mW(this._originMediaStreamTrack).then((r=>{let[s,a]=r;this._videoHeight=a,this._videoWidth=s})).catch(A1)}_updatePlayerSource(){this._player&&this._player.updateVideoTrack(this._mediaStreamTrack)}_getDefaultPlayerConfig(){return{fit:"contain"}}async setSenderConfiguration(r){if(!this._enabled)throw new Le(te.TRACK_IS_DISABLED,"can not set encoder configuration when track is disabled");M.debug("[".concat(this.getTrackId(),"] setSenderConfiguration applyConstraints"),JSON.stringify(r)),r=qu(r),this._forceBitrateLimit&&(r.bitrateMax=this._forceBitrateLimit.max_bitrate?this._forceBitrateLimit.max_bitrate:r.bitrateMax,r.bitrateMin=this._forceBitrateLimit.min_bitrate?this._forceBitrateLimit.min_bitrate:r.bitrateMin),this._encoderConfig=r,this._hints.indexOf(Sr.SCREEN_TRACK)===-1&&this.updateBitrateFromProfile();try{await wr(this,Tt.NEED_UPDATE_VIDEO_ENCODER,this)}catch(s){return s.throw(M)}}updateBitrateFromProfile(){if(!this._encoderConfig)return;const{width:r,height:s,frameRate:a}=this.getMediaStreamTrackSettings();if(!r||!s||!a)return;const{bitrateMax:c,bitrateMin:d}=this._encoderConfig;if(d==null||c==null){const{max:h,min:m}=(function(g,v,w,I,A){const N=oe("BITRATE_ADAPTER_TYPE");if(N==="DEFAULT_BITRATE")return{min:I,max:A};if(A===void 0){const H=Math.floor(200*Math.pow(w/15,.6)*Math.pow(g*v/640/360,.75));A=N==="STANDARD_BITRATE"?4*H:2*H,I=I??H}else I=I??Math.floor(A/10);return{min:I,max:A}})(r,s,a,d,c);if(this._encoderConfig.bitrateMin=m,this._encoderConfig.bitrateMax=h,oe("VIDEO_STANDARD_BITRATE_VERSION")&&d==null&&c==null){const[g,v]=(function(w,I,A){const N=4*Math.floor(2e5*Math.pow(A/15,.6)*Math.pow(w*I/230400,.75)),H=w*I,B=new Map([[19200,.9],[230400,.85],[518400,.75],[921600,.7],[2073600,.6],[3686400,.5]]),z=new Map([[230400,.95],[518400,.9],[921600,.85],[2073600,.8]]);let ee=Pc(B).call(B).next().value,Z=1;if(B.has(H))ee=B.get(H);else{var ae;const Ze=q_(ae=Array.from(B.entries())).call(ae,((bn,Zt)=>{let[ir]=bn,[Jn]=Zt;return ir-Jn})),_n=Ze.find((bn=>{let[Zt]=bn;return Zt>H}));if(_n){const bn=Ze.indexOf(_n);if(bn>0){const Zt=Ze[bn-1],ir=(H-Zt[0])/(_n[0]-Zt[0]);ee=Zt[1]+ir*(_n[1]-Zt[1])}else ee=_n[1]}else ee=Ze[Ze.length-1][1]}if(z.has(H))Z=z.get(H);else{var ye;const Ze=q_(ye=Array.from(z.entries())).call(ye,((bn,Zt)=>{let[ir]=bn,[Jn]=Zt;return ir-Jn})),_n=Ze.find((bn=>{let[Zt]=bn;return Zt>H}));if(_n){const bn=Ze.indexOf(_n);if(bn>0){const Zt=Ze[bn-1],ir=(H-Zt[0])/(_n[0]-Zt[0]);Z=Zt[1]+ir*(_n[1]-Zt[1])}else Z=_n[1]}else Z=Ze[Ze.length-1][1]}const _e=oe("VIDEO_NEW_BITRATE_RATIO");_e&&_e>0&&(ee=_e/100);const ue=Math.floor(N*ee),Ae=Math.floor(65e4*Math.pow(w*I/230400,.5)*Math.pow(A/15,.69));let Ue=ue;const We=oe("VIDEO_STANDARD_BITRATE_VERSION");return We&&We>0&&(We===1?Ue=N:We===2?Ue=ue:We===3&&(Ue=Ae)),[Math.floor(Ue/1e3),Z]})(r,s,a);this._encoderConfig.bitrateMax=g,this._encoderConfig.bitrateMin=m?Math.min(m,g):g,this._saveEncodeBitrateRatio=v,M.debug("[".concat(this.getTrackId(),"] update new bitrate from profile, [w: ").concat(r,", h: ").concat(s,", fps: ").concat(a,"] => [brMax: ").concat(this._encoderConfig.bitrateMax,", brMin: ").concat(this._encoderConfig.bitrateMin,", save_bitrate_ratio: ").concat(this._saveEncodeBitrateRatio,"]"))}else M.debug("[".concat(this.getTrackId(),"] update bitrate from profile, [w: ").concat(r,", h: ").concat(s,", fps: ").concat(a,"] => [brMax: ").concat(h,", brMin: ").concat(m,"]")),this._saveEncodeBitrateRatio=1}}getVideoElementVisibleStatus(){try{var r,s;const a=this==null||(r=this._player)===null||r===void 0?void 0:r.getContainerElement(),c={track:this,element:this==null||(s=this._player)===null||s===void 0?void 0:s.getVideoElement(),slot:a==null?void 0:a.parentElement},{element:d,slot:h}=c;if(this.isPlaying&&d instanceof HTMLVideoElement&&h instanceof HTMLElement){const m=g9.checkOneElementVisible(d),g=Object.assign({},m);if(g.visible!==this._previousVideoVisibleStatus){this._previousVideoVisibleStatus=g.visible;const v=It.reportApiInvoke(null,{tag:$r.TRACER,name:pi.LOCAL_VIDEO_TRACK_GET_VIDEO_VISIBLE,options:[this.getTrackId()]});g.visible?v.onSuccess("Video is visible"):v.onSuccess("Invisible because of ".concat(g.reason))}return g}return}catch(a){throw new Le(te.GET_VIDEO_ELEMENT_VISIBLE_ERROR,a.message)}}async renewMediaStreamTrack(r){}pipe(r){if(this.processor===r)return r;if(r._source)throw new Le(te.INVALID_OPERATION,"Processor ".concat(r.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=r,this.processor._source=this,r.updateInput({track:this._originMediaStreamTrack,context:this.processorContext}),r}unpipe(){if(!this.processor)return;const r=this.processor;this.processor._source=void 0,this.processor=void 0,r.reset()}close(){super.close(),this.unbindProcessorDestinationEvents(),this.unbindProcessorContextEvents(),this.unpipe(),this.processorDestination._source&&this.processorDestination._source.unpipe()}clone(r){let s=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1],a=this._encoderConfig;r&&(a=Pr(Pr({},a),qu(r))),a=ry(a);const c=Tr(8,"track-video-cloned-"),d=new rce(s?this._mediaStreamTrack.clone():this._mediaStreamTrack,a,ry(this._scalabilityMode),this._optimizationMode,c,ry(this._hints));return r&&a&&d.setEncoderConfiguration(a),M.debug("clone video track from ".concat(this.getTrackId()," to ").concat(c,", clone ").concat(s)),d}async replaceTrack(r,s){if(!(r instanceof MediaStreamTrack))throw new Le(te.INVALID_PARAMS,"track should be an instance of MediaStreamTrack");if(r.kind!=="video")throw new Le(te.INVALID_PARAMS,"track should be a video MediaStreamTrack");await this._updateOriginMediaStreamTrack(r,s,!0),this.updateMediaStreamTrackResolution()}sendSeiData(r){if(Jm((()=>{It.reportApiInvoke(null,{name:pi.LOCAL_VIDEO_SEND_SEI_DATA,options:[],tag:$r.TRACER}).onSuccess("")}),this._mediaStreamTrack.id||this.getTrackId()),!oe("ENABLE_VIDEO_SEI")||!oe("ENABLE_ENCODED_TRANSFORM"))return void M.warning('To send/receive SEI, please call AgoraRTC.setParameter("ENABLE_VIDEO_SEI", true) before instantiate IAgoraRtcClient');if(r instanceof Uint8Array==0)return new Le(te.INVALID_PARAMS,"Invalid argument type, ILocalVideoTrack.sendSeiData() only accept Uint8Array argument.").throw();const s=this.getRTCRtpTransceiver();if(!s)return void M.warning("Video track is not published, SEI can not be send");const a=s.sender.getParameters();if(a.codecs.length===0)return;const c=a.codecs[0].mimeType.toLocaleLowerCase();c==="video/h264"||c==="video/h265"?this.safeEmit("sei-to-send",r):M.warning("SEI is not supported by ".concat(c))}bindProcessorDestinationEvents(){this.processorDestination.on(ha.ON_TRACK,(async r=>{r?r!==this._mediaStreamTrack&&(this._mediaStreamTrack=r,this._updatePlayerSource(),await wr(this,Tt.NEED_REPLACE_TRACK,this)):this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource(),await wr(this,Tt.NEED_REPLACE_TRACK,this))}))}unbindProcessorDestinationEvents(){this.processorDestination.removeAllListeners(ha.ON_TRACK)}unbindProcessorContextEvents(){this.processorContext.removeAllListeners(ul.REQUEST_UPDATE_CONSTRAINTS),this.processorContext.removeAllListeners(ul.REQUEST_CONSTRAINTS)}},Ln(Rn.prototype,"play",[oG,aG],Object.getOwnPropertyDescriptor(Rn.prototype,"play"),Rn.prototype),Ln(Rn.prototype,"stop",[cG],Object.getOwnPropertyDescriptor(Rn.prototype,"stop"),Rn.prototype),Ln(Rn.prototype,"setEnabled",[lG,uG,dG],Object.getOwnPropertyDescriptor(Rn.prototype,"setEnabled"),Rn.prototype),Ln(Rn.prototype,"setMuted",[hG,pG,fG],Object.getOwnPropertyDescriptor(Rn.prototype,"setMuted"),Rn.prototype),Ln(Rn.prototype,"setSaveEncodeBitrateRatio",[mG,gG],Object.getOwnPropertyDescriptor(Rn.prototype,"setSaveEncodeBitrateRatio"),Rn.prototype),Ln(Rn.prototype,"setEncoderConfiguration",[_G,yG],Object.getOwnPropertyDescriptor(Rn.prototype,"setEncoderConfiguration"),Rn.prototype),Ln(Rn.prototype,"getStats",[EG],Object.getOwnPropertyDescriptor(Rn.prototype,"getStats"),Rn.prototype),Ln(Rn.prototype,"setBeautyEffect",[vG,SG],Object.getOwnPropertyDescriptor(Rn.prototype,"setBeautyEffect"),Rn.prototype),Ln(Rn.prototype,"getCurrentFrameData",[bG],Object.getOwnPropertyDescriptor(Rn.prototype,"getCurrentFrameData"),Rn.prototype),Ln(Rn.prototype,"getCurrentFrameImage",[wG],Object.getOwnPropertyDescriptor(Rn.prototype,"getCurrentFrameImage"),Rn.prototype),Ln(Rn.prototype,"findClosestProfile",[TG,CG],Object.getOwnPropertyDescriptor(Rn.prototype,"findClosestProfile"),Rn.prototype),Ln(Rn.prototype,"setBitrateLimit",[RG],Object.getOwnPropertyDescriptor(Rn.prototype,"setBitrateLimit"),Rn.prototype),Ln(Rn.prototype,"setOptimizationMode",[IG],Object.getOwnPropertyDescriptor(Rn.prototype,"setOptimizationMode"),Rn.prototype),Ln(Rn.prototype,"setScalabiltyMode",[AG],Object.getOwnPropertyDescriptor(Rn.prototype,"setScalabiltyMode"),Rn.prototype),Ln(Rn.prototype,"updateMediaStreamTrackResolution",[PG],Object.getOwnPropertyDescriptor(Rn.prototype,"updateMediaStreamTrackResolution"),Rn.prototype),Ln(Rn.prototype,"pipe",[OG],Object.getOwnPropertyDescriptor(Rn.prototype,"pipe"),Rn.prototype),Ln(Rn.prototype,"unpipe",[kG],Object.getOwnPropertyDescriptor(Rn.prototype,"unpipe"),Rn.prototype),Ln(Rn.prototype,"close",[NG],Object.getOwnPropertyDescriptor(Rn.prototype,"close"),Rn.prototype),Ln(Rn.prototype,"replaceTrack",[xG],Object.getOwnPropertyDescriptor(Rn.prototype,"replaceTrack"),Rn.prototype),Rn),F1=(DG=Wt({argsMap:(t,r)=>[t.getTrackId(),r]}),LG=li(),MG=r0("CameraVideoTrack","_enabledMutex"),UG=Wt({argsMap:(t,r)=>[t.getTrackId(),r]}),VG=li(),jG=Wt({argsMap:(t,r)=>[t.getTrackId(),r]}),FG=li(),BG=Wt({argsMap:t=>[t.getTrackId()]}),ml=class ice extends Nr{get __className__(){return"CameraVideoTrack"}constructor(r,s,a,c,d,h){super(r,qu(s.encoderConfig),c,d,h),Pe(this,"_config",void 0),Pe(this,"_originalConstraints",void 0),Pe(this,"_constraints",void 0),Pe(this,"_enabled",!0),Pe(this,"_deviceName","default"),Pe(this,"tryResumeVideoForIOS15_16WeChat",(async()=>{(Zv()||WL())&&!(function(){const m=Mn();if(m.os!==os.IOS||!m.osVersion)return!1;const g=m.osVersion.split(".");return Number(g[0])===15&&Number(g[1])>=2})()&&h9()&&this._enabled&&!this._isClosed&&(M.debug("[".concat(this.getTrackId(),"] try capture camera media device for interrupted iOS 15 device on WeChat.")),await this.renewMediaStreamTrack())})),this._config=s,this._originalConstraints=a,this._constraints=a,this._deviceName=r.label,this._encoderConfig=qu(this._config.encoderConfig),_r.on(Ps.IOS_15_16_INTERRUPTION_END,this.tryResumeVideoForIOS15_16WeChat),_r.on(Ps.IOS_INTERRUPTION_END,this.tryResumeVideoForIOS15_16WeChat),this.bindProcessorContextEvents()}async setDevice(r){return typeof r=="string"?this._setDeviceById(r):r.deviceId?this._setDeviceById(r.deviceId):r.facingMode?this._setDeviceByFacingModel(r.facingMode):void 0}async _setDeviceById(r){if(M.info("[".concat(this.getTrackId(),"] set device to ").concat(r)),this._enabled)try{const s=await pl.getDeviceById(r),a={};a.video=Pr({},this._constraints),a.video.deviceId={exact:r},a.video.facingMode=void 0,this._originMediaStreamTrack.stop();let c=null;try{c=await hl(a,this.getTrackId())}catch(d){throw M.error("[".concat(this.getTrackId(),"] setDevice failed"),d.toString()),c=await hl({video:this._constraints},this.getTrackId()),await this._updateOriginMediaStreamTrack(c.getVideoTracks()[0],!1),d}await this._updateOriginMediaStreamTrack(c.getVideoTracks()[0],!1),this.updateMediaStreamTrackResolution(),this._deviceName=s.label,this._config.cameraId=r,this._constraints.deviceId={exact:r}}catch(s){throw M.error("[".concat(this.getTrackId(),"] setDevice error"),s.toString()),s}else try{const s=await pl.getDeviceById(r);this._deviceName=s.label,this._config.cameraId=r,this._constraints.deviceId={exact:r}}catch(s){throw M.error("[".concat(this.getTrackId(),"] setDevice error"),s.toString()),s}M.info("[".concat(this.getTrackId(),"] setDevice success"))}async _setDeviceByFacingModel(r){M.info("[".concat(this.getTrackId(),"] set facingMode ").concat(r));const s={video:Pr(Pr({},this._constraints),{},{deviceId:void 0,facingMode:{exact:r}})};if(this._enabled){this._originMediaStreamTrack.stop();let a=null;try{a=await hl(s,this.getTrackId())}catch(c){throw M.error("[".concat(this.getTrackId(),"] setDeviceByFacingModel failed"),c.toString()),a=await hl({video:this._constraints},this.getTrackId()),await this._updateOriginMediaStreamTrack(a.getVideoTracks()[0],!1),c}await this._updateOriginMediaStreamTrack(a.getVideoTracks()[0],!1),this.updateMediaStreamTrackResolution()}this._deviceName="",this._config.facingMode=r,this._config.cameraId=void 0,this._constraints=Pr({},s.video),M.info("[".concat(this.getTrackId(),"] setDeviceByFacingModel success"))}async setEnabled(r,s){if(!s){if(r===this._enabled)return;this.stateCheck("enabled",r)}if(M.info("[".concat(this.getTrackId(),"] start setEnabled"),r),r){try{if(this.isExternalTrack)this._originMediaStreamTrack.enabled=!0;else{const a=await hl({video:this._constraints},this.getTrackId());await this._updateOriginMediaStreamTrack(a.getVideoTracks()[0],!1)}await wr(this,Tt.NEED_ENABLE_TRACK,this)}catch(a){throw M.error("[".concat(this.getTrackId(),"] setEnabled true error"),a.toString()),a}this.updateMediaStreamTrackResolution(),M.info("[".concat(this.getTrackId(),"] setEnabled to true success")),s||(this._enabled=!0)}else{this.isExternalTrack?this._originMediaStreamTrack.enabled=!1:(this._originMediaStreamTrack.onended=null,this._originMediaStreamTrack.stop()),s||(this._enabled=!1);try{await wr(this,Tt.NEED_DISABLE_TRACK,this)}catch(a){throw M.error("[".concat(this.getTrackId(),"] setEnabled to false error"),a.toString()),a}M.info("[".concat(this.getTrackId(),"] setEnabled to false success"))}}async setEncoderConfiguration(r,s){if(!this._enabled)throw new Le(te.TRACK_IS_DISABLED,"can not set encoder configuration when track is disabled");r=qu(r),oe("USE_STANDARD_BITRATE_DEFAULT")&&(delete r.bitrateMax,delete r.bitrateMin),this._forceBitrateLimit&&(r.bitrateMax=this._forceBitrateLimit.max_bitrate||r.bitrateMax,r.bitrateMin=this._forceBitrateLimit.min_bitrate||r.bitrateMin);const a=Kr(this._config);a.encoderConfig=r;const c=j1(a);(Fs()||To()||Hu())&&(c.deviceId=void 0),M.debug("[".concat(this.getTrackId(),"] setEncoderConfiguration applyConstraints"),JSON.stringify(r),JSON.stringify(c));try{await this._originMediaStreamTrack.applyConstraints(c),this.updateMediaStreamTrackResolution()}catch(d){const h=new Le(te.UNEXPECTED_ERROR,d.toString());throw M.error("[".concat(this.getTrackId(),"] applyConstraints error"),h.toString()),h}this._config=a,this._constraints=c,this._originalConstraints=c,this._encoderConfig=r,this._hints.indexOf(Sr.SCREEN_TRACK)===-1&&this.updateBitrateFromProfile();try{await wr(this,Tt.NEED_UPDATE_VIDEO_ENCODER,this)}catch(d){return d.throw(M)}}_getDefaultPlayerConfig(){return{mirror:!0,fit:"cover"}}onTrackEnded(){if((To()||Hu())&&this._enabled&&!this._isClosed&&_r.duringInterruption){const r=async()=>{_r.off(Ps.IOS_INTERRUPTION_END,r),this._enabled&&!this._isClosed&&(M.debug("[".concat(this.getTrackId(),"] try capture camera media device for interrupted iOS device.")),await this.setEnabled(!1),await this.setEnabled(!0))};_r.on(Ps.IOS_INTERRUPTION_END,r)}else M.debug("[".concat(this.getTrackId(),"] track ended")),this.safeEmit(l0.TRACK_ENDED)}async renewMediaStreamTrack(r){const s=r||this._constraints,a=pl.searchDeviceIdByName(this._deviceName);if(a&&!s.deviceId&&(s.deviceId={exact:a}),this._enabled){const c=await hl({video:s},this.getTrackId());this._constraints=s,await this._updateOriginMediaStreamTrack(c.getVideoTracks()[0],!0),this.updateMediaStreamTrackResolution()}}close(){super.close(),_r.off(Ps.IOS_15_16_INTERRUPTION_END,this.tryResumeVideoForIOS15_16WeChat),_r.off(Ps.IOS_INTERRUPTION_END,this.tryResumeVideoForIOS15_16WeChat)}clone(r){let s=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1],a=this._encoderConfig;r&&(a=Pr(Pr({},a),qu(r))),a=ry(a);const c=Tr(8,"track-cam-cloned-"),d=new ice(s?this._mediaStreamTrack.clone():this._mediaStreamTrack,ry(Pr(Pr({},this._config),{},{encoderConfig:a})),ry(this._constraints),ry(this._scalabilityMode),this._optimizationMode,c);return r&&a&&d.setEncoderConfiguration(a),M.debug("clone track from ".concat(this.getTrackId()," to ").concat(c,", clone ").concat(s)),d}bindProcessorContextEvents(){this.processorContext.on(ul.REQUEST_UPDATE_CONSTRAINTS,(async(r,s,a)=>{try{const c=Object.assign({},this._originalConstraints,...r);await this.renewMediaStreamTrack(c),s()}catch(c){a(c)}})),this.processorContext.on(ul.REQUEST_CONSTRAINTS,(async r=>{r(this._originMediaStreamTrack.getSettings())}))}},Ln(ml.prototype,"setDevice",[DG,LG],Object.getOwnPropertyDescriptor(ml.prototype,"setDevice"),ml.prototype),Ln(ml.prototype,"setEnabled",[MG,UG,VG],Object.getOwnPropertyDescriptor(ml.prototype,"setEnabled"),ml.prototype),Ln(ml.prototype,"setEncoderConfiguration",[jG,FG],Object.getOwnPropertyDescriptor(ml.prototype,"setEncoderConfiguration"),ml.prototype),Ln(ml.prototype,"close",[BG],Object.getOwnPropertyDescriptor(ml.prototype,"close"),ml.prototype),ml);function R2(t,r,s,a){s.optimizationMode&&(a&&a.width&&a.height?(s.encoderConfig=Pr(Pr({},a),{},{bitrateMin:a.bitrateMin,bitrateMax:a.bitrateMax}),s.optimizationMode!=="motion"&&s.optimizationMode!=="detail"||(r.contentHint=s.optimizationMode,r.contentHint===s.optimizationMode?M.debug("[".concat(t,"] set content hint to"),s.optimizationMode):M.debug("[".concat(t,"] set content hint failed")))):M.warning("[".concat(t,"] can not apply optimization mode bitrate config, no encoderConfig")))}var zG,WG,GG,HG,nu,$G,KG,qG,YG,XG,JG,zo;class QG extends eW{getUserId(){return this._userId}constructor(r,s,a,c){super(r,"track-".concat(r.kind,"-").concat(s,"-").concat(c.clientId,"_").concat(Tr(5,""))),Pe(this,"_userId",void 0),Pe(this,"_uintId",void 0),Pe(this,"_isDestroyed",!1),Pe(this,"store",void 0),Pe(this,"processor",void 0),Pe(this,"processorContext",void 0),this._userId=s,this._uintId=a,this.store=c}_updateOriginMediaStreamTrack(r){this._originMediaStreamTrack=r,this._mediaStreamTrack=r,this._updatePlayerSource(),this.processor&&this.processor.updateInput({track:this._originMediaStreamTrack,context:this.processorContext})}_destroy(){this._isDestroyed=!0,M.info("[".concat(this.getTrackId(),"] is destroyed")),this.stop(),super.close()}getProcessorStats(){return this.processorContext.gatherStats()}getProcessorUsage(){return this.processorContext.gatherUsage()}}let f0=(zG=Wt({argsMap:(t,r,s)=>[t.getTrackId(),typeof r=="string"?r:r instanceof HTMLVideoElement?"HTMLVideoElement":"HTMLElement",s]}),WG=Wt({argsMap:t=>[t.getTrackId()]}),GG=Wt({argsMap:(t,r)=>[t.getTrackId(),r.name]}),HG=Wt({argsMap:t=>[t.getTrackId()]}),Ln((nu=class extends QG{get isPlaying(){return!(!this._player||this._player.videoElementStatus!==oo.PLAYING)}get __className__(){return"RemoteVideoTrack"}constructor(t,r,s,a,c){super(t,r,s,a),Pe(this,"_videoVisibleTimer",null),Pe(this,"_previousVideoVisibleStatus",void 0),Pe(this,"_clearPreviousVideoVisibleStatus",(()=>this._previousVideoVisibleStatus=void 0)),Pe(this,"trackMediaType",u0.VIDEO),Pe(this,"_videoWidth",void 0),Pe(this,"_videoHeight",void 0),Pe(this,"_player",void 0),Pe(this,"_prePlayer",void 0),Pe(this,"processorDestination",void 0),Pe(this,"processorContext",void 0),this._prePlayer=c,this.updateMediaStreamTrackResolution(),this.processorContext=new hW(this.getTrackId(),"remote"),this.processorDestination=new dW(this.processorContext),this.bindProcessorDestinationEvents()}getStats(){return Jm((()=>{M.warning("[deprecated] RemoteVideoTrack.getStats will be removed in the future, use AgoraRTCClient.getRemoteVideoStats instead")}),"remoteVideoTrackGetStatsWarning"),al(this,Tt.GET_STATS)||Pr({},Q9)}play(t){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(this.safeEmit(tu.PLAY_START),typeof t=="string"){const a=document.getElementById(t);a?t=a:(M.warning("[".concat(this.getTrackId(),'] can not find "#').concat(t,'" element, use document.body')),t=document.body)}M.debug("[".concat(this.getTrackId(),"] start video playback in ").concat(t instanceof HTMLVideoElement?"HTMLVideoElement":"HTMLElement"),JSON.stringify(r));const s=Pr(Pr({fit:"cover"},r),{},{trackId:this.getTrackId(),element:t});if(this._player)this._player.updateConfig(s);else{let a=!1,c=!1;t instanceof HTMLVideoElement?(this._player=new T2(s),this._prePlayer&&(this._prePlayer.destroy(),this._prePlayer=void 0,c=!0)):this._prePlayer&&!this._prePlayer.isDestroyed?(this._player=this._prePlayer,this._prePlayer=void 0,a=this._player.videoState>0,this._player.updateConfig(s)):this._player=new C2(s),this._player.updateVideoTrack(this._mediaStreamTrack),this._player.onFirstVideoFrameDecoded=()=>{this.store.subscribe(this.getUserId(),"video",void 0,void 0,Date.now()),this.safeEmit(tu.FIRST_FRAME_DECODED),c&&this.safeEmit(tu.FIRST_FRAME_RENDER)},this._player.onVideoStateChanged=d=>{this.safeEmit(tu.VIDEO_STATE_CHANGED,d)},a&&(this._player.onFirstVideoFrameDecoded(),this._player.onVideoStateChanged(this._player.videoState))}this._player.play(this.store.sessionId||void 0),this._videoVisibleTimer&&window.clearInterval(this._videoVisibleTimer),this._clearPreviousVideoVisibleStatus(),this._videoVisibleTimer=window.setInterval((()=>{try{const a=this.getVideoElementVisibleStatus();this.safeEmit(tu.VIDEO_ELEMENT_VISIBLE_STATUS,a)}catch{}}),oe("CHECK_VIDEO_VISIBLE_INTERVAL")),this.safeEmit(tu.PLAY_END)}stop(){this._player&&(this._videoVisibleTimer&&(window.clearInterval(this._videoVisibleTimer),this._videoVisibleTimer=null),this._clearPreviousVideoVisibleStatus(),this._player.destroy(),this._player=void 0,M.debug("[".concat(this.getTrackId(),"] stop video playback")))}getCurrentFrameData(){return this._player?this._player.getCurrentFrame():new ImageData(2,2)}updateMediaStreamTrackResolution(){mW(this._originMediaStreamTrack).then((t=>{let[r,s]=t;this._videoHeight=s,this._videoWidth=r})).catch(A1)}_updatePlayerSource(){M.debug("[".concat(this.getTrackId(),"] update player source track")),this._player&&this._player.updateVideoTrack(this._mediaStreamTrack)}getVideoElementVisibleStatus(){try{var t,r;const s=this==null||(t=this._player)===null||t===void 0?void 0:t.getContainerElement(),a={track:this,element:this==null||(r=this._player)===null||r===void 0?void 0:r.getVideoElement(),slot:s==null?void 0:s.parentElement},{element:c,slot:d}=a;if(this.isPlaying&&c instanceof HTMLVideoElement&&d instanceof HTMLElement){const h=g9.checkOneElementVisible(c),m=Object.assign({},h);if(m.visible!==this._previousVideoVisibleStatus){this._previousVideoVisibleStatus=m.visible;const g=It.reportApiInvoke(null,{tag:$r.TRACER,name:pi.REMOTE_VIDEO_TRACK_GET_VIDEO_VISIBLE,options:[this.getTrackId()]});m.visible?g.onSuccess("Video is visible"):g.onSuccess("Invisible because of ".concat(m.reason))}return m}return}catch(s){throw new Le(te.GET_VIDEO_ELEMENT_VISIBLE_ERROR,s.message)}}pipe(t){if(this.processor===t)return t;if(t._source)throw new Le(te.INVALID_OPERATION,"Processor ".concat(t.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=t,this.processor._source=this,t.updateInput({track:this._originMediaStreamTrack,context:this.processorContext}),t}unpipe(){if(!this.processor)return;const t=this.processor;this.processor._source=void 0,this.processor=void 0,t.reset()}bindProcessorDestinationEvents(){this.processorDestination.on(ha.ON_TRACK,(async t=>{t?t!==this._mediaStreamTrack&&(this._mediaStreamTrack=t,this._updatePlayerSource()):this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource())}))}unbindProcessorDestinationEvents(){this.processorDestination.removeAllListeners(ha.ON_TRACK)}_destroy(){this._prePlayer&&(this._prePlayer.destroy(),this._prePlayer=void 0),super._destroy(),this.unbindProcessorDestinationEvents()}_onSei(t){this.emit(ay.SEI_RECEIVED,t)}}).prototype,"play",[zG],Object.getOwnPropertyDescriptor(nu.prototype,"play"),nu.prototype),Ln(nu.prototype,"stop",[WG],Object.getOwnPropertyDescriptor(nu.prototype,"stop"),nu.prototype),Ln(nu.prototype,"pipe",[GG],Object.getOwnPropertyDescriptor(nu.prototype,"pipe"),nu.prototype),Ln(nu.prototype,"unpipe",[HG],Object.getOwnPropertyDescriptor(nu.prototype,"unpipe"),nu.prototype),nu),m0=($G=Wt({argsMap:(t,r)=>[t.getTrackId(),r],throttleTime:300}),KG=Wt({argsMap:(t,r)=>[t.getTrackId(),r]}),qG=Wt({argsMap:t=>[t.getTrackId()]}),YG=Wt({argsMap:t=>[t.getTrackId()]}),XG=Wt({argsMap:(t,r)=>[t.getTrackId(),r.name]}),JG=Wt({argsMap:t=>[t.getTrackId()]}),Ln((zo=class extends QG{get isPlaying(){return this._useAudioElement?xa.isPlaying(this.getTrackId()):this._source.isPlayed}get __className__(){return"RemoteAudioTrack"}constructor(t,r,s,a){super(t,r,s,a),Pe(this,"trackMediaType",u0.AUDIO),Pe(this,"_source",void 0),Pe(this,"_useAudioElement",!0),Pe(this,"_volume",100),Pe(this,"processorContext",void 0),Pe(this,"processorDestination",void 0),Pe(this,"_played",!1),Pe(this,"_bypassWebAudio",!1),oe("DISABLE_WEBAUDIO")?(this._source=new b2,this._bypassWebAudio=!0,this._useAudioElement=!0):(this._source=new iW(t,!0),oe("REMOTE_AUDIO_TRACK_USES_WEB_AUDIO")&&(this._useAudioElement=!1)),this._source.once(ll.RECEIVE_TRACK_BUFFER,(()=>{this.safeEmit(tu.FIRST_FRAME_DECODED)})),this.processorContext=new fW(this._source.context,this.getTrackId(),"remote"),this.processorDestination=new pW(this.processorContext),this.bindProcessorDestinationEvents(),this._source.on(ll.UPDATE_SOURCE,(()=>{this.processor&&this.processor.updateInput({node:this._source.processSourceNode,context:this.processorContext})}))}setAudioFrameCallback(t){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:4096;if(!t)return this._source.removeAllListeners(ll.ON_AUDIO_BUFFER),void this._source.stopGetAudioBuffer();this._source.startGetAudioBuffer(r),this._source.removeAllListeners(ll.ON_AUDIO_BUFFER),this._source.on(ll.ON_AUDIO_BUFFER,(s=>t(s)))}setVolume(t){this._volume=t,this._useAudioElement?xa.setVolume(this.getTrackId(),t):this._source.setVolume(t/100)}async setPlaybackDevice(t){if(!this._useAudioElement||!q9())throw new Le(te.NOT_SUPPORTED,"your browser does not support setting the audio output device");await xa.setSinkID(this.getTrackId(),t)}getVolumeLevel(){return this._source.getAccurateVolumeLevel()}getStats(){return Jm((()=>{M.warning("[deprecated] RemoteAudioTrack.getStats will be removed in the future, use AgoraRTCClient.getRemoteAudioStats instead")}),"remoteAudioTrackGetStatsWarning"),al(this,Tt.GET_STATS)||Pr({},J9)}play(){M.debug("[".concat(this.getTrackId(),"] start audio playback")),this._played=!0,this._useAudioElement?(M.debug("[".concat(this.getTrackId(),"] use audio element to play")),xa.play(this._mediaStreamTrack,this.getTrackId(),this._volume,this.store.sessionId||void 0)):this._source.play()}stop(){M.debug("[".concat(this.getTrackId(),"] stop audio playback")),this._played=!1,this._useAudioElement?xa.stop(this.getTrackId()):this._source.stop()}_destroy(){super._destroy(),this._played=!1,this.unbindProcessorDestinationEvents(),this._source.destroy()}_isFreeze(){return this._source.isFreeze}_updatePlayerSource(){let t=!(arguments.length>0&&arguments[0]!==void 0)||arguments[0];M.debug("[".concat(this.getTrackId(),"] update player source track")),t&&this._source.updateTrack(this._mediaStreamTrack),this._useAudioElement&&xa.updateTrack(this.getTrackId(),this._mediaStreamTrack)}pipe(t){if(this._bypassWebAudio)throw new Le(te.NOT_SUPPORTED,"can not pipe extension when WebAudio disabled");if(this.processor===t)return t;if(t._source)throw new Le(te.INVALID_OPERATION,"Processor ".concat(t.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=t,this.processor._source=this,t.updateInput({track:this._originMediaStreamTrack,node:this._source.processSourceNode,context:this.processorContext}),t}unpipe(){var t;if(this._bypassWebAudio)throw new Le(te.NOT_SUPPORTED,"can not unpipe extension when WebAudio disabled");if(!this.processor)return;const r=this.processor;(t=this._source.processSourceNode)===null||t===void 0||t.disconnect(),this.processor._source=!1,this.processor=void 0,r.reset()}bindProcessorDestinationEvents(){this.processorDestination.on(ha.ON_TRACK,(async t=>{t?t!==this._mediaStreamTrack&&(this._mediaStreamTrack=t,this._updatePlayerSource(!1),this._source.processedNode=this._source.createMediaStreamSourceNode(t)):this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource())})),this.processorDestination.on(ha.ON_NODE,(t=>{this._source.processedNode=t;const r=!t;this._useAudioElement!==r&&(this._played?(this.stop(),this._useAudioElement=r,this.play()):this._useAudioElement=r)}))}unbindProcessorDestinationEvents(){this.processorDestination.removeAllListeners(ha.ON_TRACK),this.processorDestination.removeAllListeners(ha.ON_NODE)}}).prototype,"setVolume",[$G],Object.getOwnPropertyDescriptor(zo.prototype,"setVolume"),zo.prototype),Ln(zo.prototype,"setPlaybackDevice",[KG],Object.getOwnPropertyDescriptor(zo.prototype,"setPlaybackDevice"),zo.prototype),Ln(zo.prototype,"play",[qG],Object.getOwnPropertyDescriptor(zo.prototype,"play"),zo.prototype),Ln(zo.prototype,"stop",[YG],Object.getOwnPropertyDescriptor(zo.prototype,"stop"),zo.prototype),Ln(zo.prototype,"pipe",[XG],Object.getOwnPropertyDescriptor(zo.prototype,"pipe"),zo.prototype),Ln(zo.prototype,"unpipe",[JG],Object.getOwnPropertyDescriptor(zo.prototype,"unpipe"),zo.prototype),zo);const lp=new class extends Zr{get visibility(){return document.visibilityState}get lastHiddenTime(){return this._lastHiddenTime}get lastVisibleTime(){return this._lastVisibleTime}constructor(){super(),Pe(this,"_lastHiddenTime",0),Pe(this,"_lastVisibleTime",0),document.addEventListener("visibilitychange",(()=>{document.visibilityState==="hidden"?this._lastHiddenTime=performance.now():this._lastVisibleTime=performance.now(),M.debug("current web page is ".concat(document.visibilityState)),this.emit("VISIBILITY_CHANGE",document.visibilityState)}))}};class ZG extends Zr{constructor(r,s){super(),Pe(this,"trackMediaType",u0.DATA),Pe(this,"_version",1),Pe(this,"_type",3),Pe(this,"_config",void 0),Pe(this,"_originDataChannel",void 0),Pe(this,"_dataStreamPacketHeader",new ArrayBuffer(4)),Pe(this,"_dataStreamPacketHandler",{serialize:a=>a,deserialize:a=>a}),Pe(this,"_datachannelEventMap",new Map),this._config=r,s&&(this._originDataChannel=s,this._bandDataChannelEvents(s)),this._initPacketHeader()}useDataStream(r){this._dataStreamPacketHandler=r}get id(){return this._config.id}get ordered(){return this._config.ordered}get maxRetransmits(){return oe("DATASTREAM_MAX_RETRANSMITS")}get metadata(){return this._config.metadata}get readyState(){var r,s;return(r=(s=this._originDataChannel)===null||s===void 0?void 0:s.readyState)!==null&&r!==void 0?r:"connecting"}get _originDataChannelId(){var r,s;return(r=(s=this._originDataChannel)===null||s===void 0?void 0:s.id)!==null&&r!==void 0?r:null}getChannelId(){return this.id}getConfig(){return this._config}_close(){this._originDataChannel&&(this._unbindDataChannelEvents(this._originDataChannel),this._originDataChannel=void 0)}async _waitTillOpen(){return new mt(((r,s)=>{if(this._originDataChannel){this._originDataChannel.readyState==="open"&&r();const a=setTimeout((()=>{var c;s(new Le(te.DATACHANNEL_CONNECTION_TIMEOUT,"Cannot create datachannel, id: ".concat((c=this._originDataChannel)===null||c===void 0?void 0:c.id)))}),1e4);this._originDataChannel.onopen=()=>{clearTimeout(a),this._originDataChannel&&this._bandDataChannelEvents(this._originDataChannel),r()},this._originDataChannel.onerror=()=>{throw clearTimeout(a),new Le(te.DATACHANNEL_CONNECTION_TIMEOUT)}}else s(new Le(te.DATACHANNEL_CONNECTION_TIMEOUT,"cannot find dataChannel"))}))}_updateOriginDataChannel(r){this._originDataChannel=r,this._bandDataChannelEvents(r)}_initPacketHeader(){const r=new DataView(this._dataStreamPacketHeader);r.setUint16(0,this._version),r.setUint8(2,this._type),r.setUint8(3,this._config.id)}_bandDataChannelEvents(r){this._unbindDataChannelEvents(r),[U1.OPEN,U1.CLOSE,U1.ERROR].forEach((s=>{const a=()=>{this.emit(s)};this._datachannelEventMap.set(s,a),r.addEventListener(s,a)}))}_unbindDataChannelEvents(r){Array.from(this._datachannelEventMap.entries()).forEach((s=>{let[a,c]=s;r.removeEventListener(a,c)})),this._datachannelEventMap.clear()}}class Sge extends ZG{constructor(r){super(r),Pe(this,"_messageListener",void 0),this._messageListener=s=>{if(s.data.byteLength<this._dataStreamPacketHeader.byteLength)throw Error("invalid byteLength: the byte length must exceed "+this._dataStreamPacketHeader.byteLength);const a=s.data.slice(0,this._dataStreamPacketHeader.byteLength),c=new DataView(a).getUint8(3);if(c!==this.id)return void(oe("SHOW_DATASTREAM2_LOG")&&M.debug("invalid datachannel id: ".concat(c," !== ").concat(this.id)));let d=s.data.slice(this._dataStreamPacketHeader.byteLength);d=this._dataStreamPacketHandler.deserialize(d),this.emit(U1.MESSAGE,d)}}_updateOriginDataChannel(r){super._updateOriginDataChannel(r),this._bandRemoteDataChannelEvents()}_close(){this._originDataChannel&&(this._originDataChannel.removeEventListener("message",this._messageListener),super._close())}_bandRemoteDataChannelEvents(){this._originDataChannel&&this._originDataChannel.addEventListener("message",this._messageListener)}}class bge extends ZG{send(r){if(this._originDataChannel){let s=r;s=this._dataStreamPacketHandler.serialize(r);const a=new Uint8Array(this._dataStreamPacketHeader.byteLength+s.byteLength);a.set(new Uint8Array(this._dataStreamPacketHeader),0),a.set(new Uint8Array(s),this._dataStreamPacketHeader.byteLength),this._originDataChannel.send(a.buffer)}}}function B1(){const t=new Blob([atob("Y29uc3QgdD0idmlkZW8vaDI2NCIsZT0idmlkZW8vaDI2NSI7ZnVuY3Rpb24gbih0LGUsbil7bGV0IGE9bmV3IFVpbnQ4QXJyYXkodCxlLG4pLHI9W10sbz0wO2Zvcig7ci5sZW5ndGg8bjspbyszPG4mJjA9PT1hW29dJiYwPT09YVtvKzFdJiYzPT09YVtvKzJdJiYoMD09PWFbbyszXXx8MT09PWFbbyszXXx8Mj09PWFbbyszXXx8Mz09PWFbbyszXSk/KHIucHVzaChhW29dLGFbbysxXSxhW28rM10pLG8rPTQpOihyLnB1c2goYVtvXSksbysrKTtyZXR1cm4gbmV3IFVpbnQ4QXJyYXkocil9ZnVuY3Rpb24gYShhLHIpe3N3aXRjaChyKXtjYXNlIHQ6cmV0dXJuIGZ1bmN0aW9uKHQpe2NvbnN0IGU9bmV3IERhdGFWaWV3KHQuZGF0YSk7bGV0IGE9MDtmb3IoO2ErNDx0LmRhdGEuYnl0ZUxlbmd0aDspe2lmKDA9PT1lLmdldFVpbnQ4KGErMCkmJjA9PT1lLmdldFVpbnQ4KGErMSkmJjA9PT1lLmdldFVpbnQ4KGErMikmJjE9PT1lLmdldFVpbnQ4KGErMykmJjY9PT1lLmdldFVpbnQ4KGErNCkpe2xldCByPWErNixvPTAsaT0wO2Zvcig7MjU1PT09KGk9ZS5nZXRVaW50OChyKyspKTspbys9MjU1O28rPWk7Y29uc3Qgcz1uKHQuZGF0YSxyLG8pO3JldHVybiBuZXcgVWludDhBcnJheShzKX1hKyt9cmV0dXJuIG51bGx9KGEpO2Nhc2UgZTpyZXR1cm4gZnVuY3Rpb24odCl7Y29uc3QgZT1uZXcgRGF0YVZpZXcodC5kYXRhKTtsZXQgYT0wO2Zvcig7YSs1PHQuZGF0YS5ieXRlTGVuZ3RoOyl7aWYoMD09PWUuZ2V0VWludDgoYSswKSYmMD09PWUuZ2V0VWludDgoYSsxKSYmMD09PWUuZ2V0VWludDgoYSsyKSYmMT09PWUuZ2V0VWludDgoYSszKSYmNzg9PT1lLmdldFVpbnQ4KGErNCkmJjE9PT1lLmdldFVpbnQ4KGErNSkmJjEwMT09PWUuZ2V0VWludDgoYSs2KSl7bGV0IHI9YSs3LG89MCxpPTA7Zm9yKDsyNTU9PT0oaT1lLmdldFVpbnQ4KHIrKykpOylvKz0yNTU7bys9aTtjb25zdCBzPW4odC5kYXRhLHIsbyk7cmV0dXJuIG5ldyBVaW50OEFycmF5KHMpfWErK31yZXR1cm4gbnVsbH0oYSk7ZGVmYXVsdDpyZXR1cm4gbnVsbH19ZnVuY3Rpb24gcih0KXtjb25zdCBlPXQubGVuZ3RoO2xldCBuPVtdLGE9MDtmb3IoO2E8ZTspYSsyPGUmJjA9PT10W2FdJiYwPT09dFthKzFdJiYoMD09PXRbYSsyXXx8MT09PXRbYSsyXXx8Mj09PXRbYSsyXXx8Mz09PXRbYSsyXSk/KG4ucHVzaCh0W2FdLHRbYSsxXSwzLHRbYSsyXSksYSs9Myk6KG4ucHVzaCh0W2FdKSxhKyspO3JldHVybiBuZXcgVWludDhBcnJheShuKX1mdW5jdGlvbiBvKG4sYSxvKXtzd2l0Y2gobyl7Y2FzZSB0OnJldHVybiBmdW5jdGlvbih0LGUpe2NvbnN0IG49cihlKSxhPW4ubGVuZ3RoLG89TWF0aC5mbG9vcihhLzI1NSksaT1hJTI1NSxzPW5ldyBVaW50OEFycmF5KDYrbysxK2ErdC5ieXRlTGVuZ3RoKTtzWzBdPTAsc1sxXT0wLHNbMl09MCxzWzNdPTEsc1s0XT02LHNbNV09MTAxO2xldCBmPTA7Zm9yKDtmPG87KXNbNitmXT0yNTUsZisrO3JldHVybiBzWzYrZl09aSxmKysscy5zZXQobiw2K2YpLHMuc2V0KG5ldyBVaW50OEFycmF5KHQpLDYrZithKSxzLmJ1ZmZlcn0obixhKTtjYXNlIGU6cmV0dXJuIGZ1bmN0aW9uKHQsZSl7Y29uc3Qgbj1yKGUpLGE9bi5sZW5ndGgsbz1NYXRoLmZsb29yKGEvMjU1KSxpPWElMjU1LHM9bmV3IFVpbnQ4QXJyYXkoNytvKzErYSsxK3QuYnl0ZUxlbmd0aCk7c1swXT0wLHNbMV09MCxzWzJdPTAsc1szXT0xLHNbNF09Nzgsc1s1XT0xLHNbNl09MTAxO2xldCBmPTA7Zm9yKDtmPG87KXNbNytmXT0yNTUsZisrO3JldHVybiBzWzcrZl09aSxmKysscy5zZXQobiw3K2YpLGYrPWEsc1s3K2ZdPTEyOCxmKysscy5zZXQobmV3IFVpbnQ4QXJyYXkodCksNytmKSxzLmJ1ZmZlcn0obixhKTtkZWZhdWx0OnJldHVybiBudWxsfX1mdW5jdGlvbiBpKG4pe2lmKG4ubGVuZ3RoPDUpcmV0dXJuIiI7bGV0IGE9LTE7Zm9yKGxldCB0PTA7dDxuLmxlbmd0aC0zO3QrKyl7aWYoMD09PW5bdF0mJjA9PT1uW3QrMV0mJjE9PT1uW3QrMl0pe2E9dDticmVha31pZih0PG4ubGVuZ3RoLTQmJjA9PT1uW3RdJiYwPT09blt0KzFdJiYwPT09blt0KzJdJiYxPT09blt0KzNdKXthPXQ7YnJlYWt9fWlmKC0xPT09YSlyZXR1cm4iIjtjb25zdCByPWErKDA9PT1uW2ErMl0/NDozKTtpZihyPj1uLmxlbmd0aClyZXR1cm4iIjtjb25zdCBvPW5bcl07aWYoMTI4Jm8pcmV0dXJuIiI7aWYoKG8+PjEmNjMpPj0zMilyZXR1cm4gZTtpZihyKzE8bi5sZW5ndGgpe2lmKDA9PSgyNDgmbltyKzFdKSlyZXR1cm4gZX1yZXR1cm4oMzEmbyk8PTMxP3Q6IiJ9Y29uc3Qgcz03MSxmPTEsbD0yLHU9MSxnPTI7dmFyIGM7ZnVuY3Rpb24gZCh0LGU9ITEpe2NvbnN0IG49dC5nZXRVaW50OCgwKTtpZihuIT09cylyZXR1cm47Y29uc3QgYT10LmdldFVpbnQxNigxKSxyPWYrbCthLG89bmV3IFVpbnQ4QXJyYXkodC5ieXRlTGVuZ3RoLXIpO28uc2V0KG5ldyBVaW50OEFycmF5KHQuYnVmZmVyLHIsdC5ieXRlTGVuZ3RoLXIpKTtjb25zdCBpPXttOm4sdGx2TGVuOmEsdGx2OltdLGZyYW1lOm99O2xldCBkPWYrbDtmb3IoO2Q8cjspe2NvbnN0IG49dC5nZXRVaW50OChkKSxhPXQuZ2V0VWludDE2KGQrdSkscj11K2c7aWYobj09PWMuQVVESU9fTEVWRUwpe2xldCBvPXQuZ2V0VWludDgoZCtyKTtmb3IobGV0IGU9MTtlPGE7ZSsrKW89bzw8OHx0LmdldFVpbnQ4KGQrcitlKTtpLnRsdi5wdXNoKHt0YWc6bixsZW5ndGg6YSx2YWx1ZTplPzEyN15vPj4xOjEyNyZvfSl9ZWxzZSBpZihuPT09Yy5NRVRBREFUQXx8bj09PWMuQVVESU9fNjRfQklUX1BUUyl7Y29uc3QgZT1uZXcgVWludDhBcnJheShhKTtmb3IobGV0IG49MDtuPGE7bisrKWVbbl09dC5nZXRVaW50OChkK3Irbik7aS50bHYucHVzaCh7dGFnOm4sbGVuZ3RoOmEsdmFsdWU6ZX0pfWQrPXIrYX1yZXR1cm4gaX0hZnVuY3Rpb24odCl7dFt0LkFVRElPX0xFVkVMPTFdPSJBVURJT19MRVZFTCIsdFt0Lk1FVEFEQVRBPTJdPSJNRVRBREFUQSIsdFt0LkFVRElPXzY0X0JJVF9QVFM9M109IkFVRElPXzY0X0JJVF9QVFMifShjfHwoYz17fSkpLHNlbGYub25ydGN0cmFuc2Zvcm09dD0+e2NvbnN0IGU9dC50cmFuc2Zvcm1lcjtsZXQgbj1bXSxyPVtdO2Uub3B0aW9ucy5wb3J0Lm9ubWVzc2FnZT10PT57dC5kYXRhLnNlaSYmbi5wdXNoKHQuZGF0YS5zZWkpLHQuZGF0YS5tZXRhZGF0YSYmci5wdXNoKHQuZGF0YS5tZXRhZGF0YSl9LHNlbGYucG9zdE1lc3NhZ2UoInN0YXJ0ZWQiKTtjb25zdCBoPWUucmVhZGFibGUuZ2V0UmVhZGVyKCksVT1lLndyaXRhYmxlLmdldFdyaXRlcigpOyJzZWktcngiPT09ZS5vcHRpb25zLm5hbWU/ZnVuY3Rpb24gdChlKXtoLnJlYWQoKS50aGVuKChuPT57aWYoIW4uZG9uZSl7aWYobi52YWx1ZSBpbnN0YW5jZW9mIFJUQ0VuY29kZWRWaWRlb0ZyYW1lKXtjb25zdCB0PWkobmV3IFVpbnQ4QXJyYXkobi52YWx1ZS5kYXRhKSkscj1hKG4udmFsdWUsdCk7ciYmZS5vcHRpb25zLnBvcnQucG9zdE1lc3NhZ2Uoe3NlaTpyfSl9VS53cml0ZShuLnZhbHVlKSxlLm9wdGlvbnMucG9ydC5wb3N0TWVzc2FnZSh7dHJhbnNmb3JtZWQ6ITB9KSx0KGUpfX0pKX0oZSk6InNlaS10eCI9PT1lLm9wdGlvbnMubmFtZT9mdW5jdGlvbiB0KGUpe2gucmVhZCgpLnRoZW4oKGE9PntpZighYS5kb25lKXtpZihhLnZhbHVlIGluc3RhbmNlb2YgUlRDRW5jb2RlZFZpZGVvRnJhbWUpe2NvbnN0IHQ9aShuZXcgVWludDhBcnJheShhLnZhbHVlLmRhdGEpKSxlPW4uc2hpZnQoKTtpZihlKXtjb25zdCBuPW8oYS52YWx1ZS5kYXRhLGUsdCk7biYmKGEudmFsdWUuZGF0YT1uKX19VS53cml0ZShhLnZhbHVlKSxlLm9wdGlvbnMucG9ydC5wb3N0TWVzc2FnZSh7dHJhbnNmb3JtZWQ6ITB9KSx0KGUpfX0pKX0oZSk6ImF1ZGlvLW1ldGFkYXRhLXJ4Ij09PWUub3B0aW9ucy5uYW1lP2Z1bmN0aW9uIHQoZSl7aC5yZWFkKCkudGhlbigobj0+e2lmKCFuLmRvbmUpe2lmKG4udmFsdWUgaW5zdGFuY2VvZiBSVENFbmNvZGVkQXVkaW9GcmFtZSl7Y29uc3QgdD1uZXcgRGF0YVZpZXcobi52YWx1ZS5kYXRhKSxhPXQuZ2V0VWludDgoMCk7bGV0IHI7aWYoMCE9KDEyOCZhKSYmNzEhPT1hKXtsZXQgZT1mdW5jdGlvbih0KXtpZih0LmJ5dGVMZW5ndGg8PTApcmV0dXJuW107Y29uc3QgZT1bXTtsZXQgbj0wO2Zvcig7bjx0LmJ5dGVMZW5ndGg7KXtjb25zdCBhPSgxMjgmdC5nZXRVaW50OChuKSk+Pjcscj0xMjcmdC5nZXRVaW50OChuKTtpZighKGEmJm4rNDw9dC5ieXRlTGVuZ3RoKSl7bisrO2JyZWFrfXtjb25zdCBhPXQuZ2V0VWludDMyKG4sITEpLG89KDE2Nzc2MTkyJmEpPj4xMCxpPTEwMjMmYTtlLnB1c2goe3B0OnIsdHNfb2Zmc2V0Om8sbGVuZ3RoOmksZGF0YTpuZXcgVWludDhBcnJheX0pLG4rPTR9fWxldCBhPXQuYnl0ZUxlbmd0aC1uO2Zvcihjb25zdCByIG9mIGUpe2lmKHIubGVuZ3RoPmEpcmV0dXJuIGNvbnNvbGUud2FybigiQnJva2VuIHJlZCBwYXlsb2FkIiksW107ci5sZW5ndGg+MCYmKHIuZGF0YT1uZXcgVWludDhBcnJheSh0LmJ1ZmZlcix0LmJ5dGVPZmZzZXQrbixyLmxlbmd0aCksbis9ci5sZW5ndGgsYS09ci5sZW5ndGgpfWlmKGE+MCl7Y29uc3Qgcj17cHQ6ZS5sZW5ndGg+MD9lW2UubGVuZ3RoLTFdLnB0OjAsdHNfb2Zmc2V0OjAsbGVuZ3RoOmEsZGF0YTpuZXcgVWludDhBcnJheSh0LmJ1ZmZlcix0LmJ5dGVPZmZzZXQrbixhKX07ZS5wdXNoKHIpfXJldHVybiBlfSh0KTtpZihlLmxlbmd0aD4wKXtjb25zdCB0PWZ1bmN0aW9uKHQpe2xldCBlPTA7Zm9yKGxldCBuPTA7bjx0Lmxlbmd0aDtuKyspZSs9bjx0Lmxlbmd0aC0xPzQ6MSxlKz10W25dLmxlbmd0aDtjb25zdCBuPW5ldyBVaW50OEFycmF5KGUpO2xldCBhPTA7Zm9yKGxldCBlPTA7ZTx0Lmxlbmd0aDtlKyspaWYoZTx0Lmxlbmd0aC0xKXtjb25zdCByPSgyMTQ3NDgzNjQ4fCgxMjcmdFtlXS5wdCk8PDI0fCgyNjIxNDMmdFtlXS50c19vZmZzZXQpPDwxMHwxMDIzJnRbZV0ubGVuZ3RoKT4+PjA7blthKytdPXI+PjI0JjI1NSxuW2ErK109cj4+MTYmMjU1LG5bYSsrXT1yPj44JjI1NSxuW2ErK109MjU1JnJ9ZWxzZSBuW2ErK109MTI3JnRbZV0ucHQ7Zm9yKGNvbnN0IGUgb2YgdCluLnNldChlLmRhdGEsYSksYSs9ZS5sZW5ndGg7cmV0dXJuIG59KGUubWFwKCh0PT57bGV0IGU9bmV3IFVpbnQ4QXJyYXkodC5sZW5ndGgpO2Uuc2V0KHQuZGF0YSk7Y29uc3Qgbj1kKG5ldyBEYXRhVmlldyhlLmJ1ZmZlcikpO3JldHVybiBuPy5mcmFtZSYmKHQuZGF0YT1uPy5mcmFtZSkscj1uLHR9KSkpO24udmFsdWUuZGF0YT10LmJ1ZmZlcn19ZWxzZSByPWQodCksciYmKG4udmFsdWUuZGF0YT1yLmZyYW1lLmJ1ZmZlcik7aWYocil7bGV0IHQ9ci50bHYuZmluZCgodD0+dC50YWc9PT1jLk1FVEFEQVRBKSk7aWYodCYmdC52YWx1ZSBpbnN0YW5jZW9mIFVpbnQ4QXJyYXkmJmUub3B0aW9ucy5wb3J0LnBvc3RNZXNzYWdlKHttZXRhZGF0YTp0LnZhbHVlfSksdD1yLnRsdi5maW5kKCh0PT50LnRhZz09PWMuQVVESU9fNjRfQklUX1BUUykpLHQmJnQudmFsdWUgaW5zdGFuY2VvZiBVaW50OEFycmF5JiY4PT10LnZhbHVlLmxlbmd0aCl7Y29uc3Qgbj1uZXcgRGF0YVZpZXcodC52YWx1ZS5idWZmZXIpLmdldEJpZ1VpbnQ2NCgwLCEwKTt0JiZ0LnZhbHVlIGluc3RhbmNlb2YgVWludDhBcnJheSYmZS5vcHRpb25zLnBvcnQucG9zdE1lc3NhZ2Uoe3B0czpufSl9fX1VLndyaXRlKG4udmFsdWUpLGUub3B0aW9ucy5wb3J0LnBvc3RNZXNzYWdlKHt0cmFuc2Zvcm1lZDohMH0pLHQoZSl9fSkpfShlKToiYXVkaW8tbWV0YWRhdGEtdHgiPT09ZS5vcHRpb25zLm5hbWUmJmZ1bmN0aW9uIHQoZSl7aC5yZWFkKCkudGhlbigobj0+e2lmKCFuLmRvbmUpe2lmKGUub3B0aW9ucy5wb3J0LnBvc3RNZXNzYWdlKHtnZXRNZXRhZGF0YTohMH0pLG4udmFsdWUgaW5zdGFuY2VvZiBSVENFbmNvZGVkQXVkaW9GcmFtZSl7Y29uc3QgdD1yLnNoaWZ0KCk7dCYmKG4udmFsdWUuZGF0YT1mdW5jdGlvbih0LGUsbil7Y29uc3QgYT1uLmJ5dGVMZW5ndGgscj1hK3UrZyxvPWYrbCtyLGk9bmV3IEFycmF5QnVmZmVyKHQuYnl0ZUxlbmd0aCtvKSxjPW5ldyBEYXRhVmlldyhpKTtjLnNldFVpbnQ4KDAscyksYy5zZXRVaW50MTYoMSxyKSxjLnNldFVpbnQ4KDMsZSksYy5zZXRVaW50MTYoNCxhKTtmb3IobGV0IHQ9MDt0PGE7dCsrKWMuc2V0VWludDgoNit0LG5bdF0pO2NvbnN0IGQ9bmV3IFVpbnQ4QXJyYXkoYy5idWZmZXIpO3JldHVybiBkLnNldChuZXcgVWludDhBcnJheSh0KSxvKSxkLmJ1ZmZlcn0obi52YWx1ZS5kYXRhLGMuQVVESU9fNjRfQklUX1BUUyx0KSl9VS53cml0ZShuLnZhbHVlKSxlLm9wdGlvbnMucG9ydC5wb3N0TWVzc2FnZSh7dHJhbnNmb3JtZWQ6ITB9KSx0KGUpfX0pKX0oZSl9LHNlbGYucG9zdE1lc3NhZ2UoInJlZ2lzdGVyZWQiKTsK")],{type:"text/javascript"});return setTimeout((()=>FA.revokeObjectURL(t)),0),new Worker(FA.createObjectURL(t))}const e7=71,I2=1,A2=2,P2=1,t7=2;var eg=(function(t){return t[t.AUDIO_LEVEL=1]="AUDIO_LEVEL",t[t.METADATA=2]="METADATA",t[t.AUDIO_64_BIT_PTS=3]="AUDIO_64_BIT_PTS",t})(eg||{});function O2(t){let r=arguments.length>1&&arguments[1]!==void 0&&arguments[1];const s=t.getUint8(0);if(s!==e7)return;const a=t.getUint16(1),c=I2+A2+a,d=new Uint8Array(t.byteLength-c);d.set(new Uint8Array(t.buffer,c,t.byteLength-c));const h={m:s,tlvLen:a,tlv:[],frame:d};let m=I2+A2;for(;m<c;){const g=t.getUint8(m),v=t.getUint16(m+P2),w=P2+t7;if(g===eg.AUDIO_LEVEL){let I=t.getUint8(m+w);for(let A=1;A<v;A++)I=I<<8|t.getUint8(m+w+A);h.tlv.push({tag:g,length:v,value:r?127^I>>1:127&I})}else if(g===eg.METADATA||g===eg.AUDIO_64_BIT_PTS){const I=new Uint8Array(v);for(let A=0;A<v;A++)I[A]=t.getUint8(m+w+A);h.tlv.push({tag:g,length:v,value:I})}m+=w+v}return h}const z1=new Map,W1=127,uy=1e-10,k2=139/13,G1=new Map;function N2(t,r,s){const a="".concat(t,"-").concat(r,"-").concat(s);let c=0;return G1.has(a)?c=G1.get(a):(c=Math.log((function(h,m){const g=h-m;m<g&&(m=g);let v=1;for(let w=h,I=1;w>m;w--,I++)v=v*w/I;return v})(r,t))+t*Math.log(.5)+(r-t)*Math.log(1-.5)-Math.log(s)+s*t,G1.set(a,c)),c<uy&&(c=uy),c}function n7(t,r,s){const a=r.length,c=t.length/a;let d=!1;for(let h=0,m=0;h<a;h++){let g=0;for(let v=m+c;m<v;m++)t[m]>s&&g++;r[h]!==g&&(r[h]=g,d=!0)}return d}window.cache=G1;let wge=0;class r7{constructor(r){Pe(this,"id",void 0),Pe(this,"immediates",[]),Pe(this,"lastNonSilence",-1),Pe(this,"immediateSpeechActivityScore",uy),Pe(this,"lastLevelChangedTime",Date.now()),Pe(this,"levels",[]),Pe(this,"longs",[]),Pe(this,"longSpeechActivityScore",uy),Pe(this,"mediums",[]),Pe(this,"mediumSpeechActivityScore",uy),Pe(this,"minLevel",0),Pe(this,"nextMinLevel",0),Pe(this,"nextMinLevelWindowLength",0),Pe(this,"energyScore",0),this.id=r||"".concat(wge++),this.immediates.length=50,this.mediums.length=10,this.longs.length=1,this.levels.length=this.immediates.length}computeImmediates(){const r=this.immediates,s=this.levels,a=this.minLevel+k2;let c=!1;for(let d=0;d<r.length;++d){let h=s[d];h<a&&(h=0);const m=Math.floor(h/k2);r[d]!==m&&(r[d]=m,c=!0)}return c}computeLongs(){return n7(this.mediums,this.longs,4)}computeMediums(){return n7(this.immediates,this.mediums,7)}evaluateImmediateSpeechActivityScore(){this.immediateSpeechActivityScore=N2(this.immediates[0],13,.78)}evaluateLongSpeechActivityScore(r){this.longSpeechActivityScore=N2(this.longs[0],10,47),this.longSpeechActivityScore>uy&&(this.lastNonSilence=r)}evaluateMediumSpeechActivityScore(){this.mediumSpeechActivityScore=N2(this.mediums[0],5,24)}evaluateSpeechActivityScores(r){this.computeImmediates()&&(this.evaluateImmediateSpeechActivityScore(),this.computeMediums()&&(this.evaluateMediumSpeechActivityScore(),this.computeLongs()&&this.evaluateLongSpeechActivityScore(r)))}getLastLevelChangedTime(){return this.lastLevelChangedTime}getLevels(){var r;return"[".concat(g_(r=[...this.levels]).call(r).join(),"]")}getSpeechActivityScore(r){switch(r){case 0:return this.immediateSpeechActivityScore;case 1:return this.mediumSpeechActivityScore;case 2:return this.longSpeechActivityScore;default:throw new Error("interval "+r)}}levelChanged(r,s){if(this.lastLevelChangedTime<=s){this.lastLevelChangedTime=s;let a=r;return r<0&&(a=0),r>W1&&(a=W1),this.levels.unshift(a),this.levels.length>this.immediates.length&&this.levels.pop(),this.updateMinLevel(a),a>=this.minLevel+k2?a:a/2}return-1}levelTimedOut(){this.levelChanged(0,this.lastLevelChangedTime)}updateMinLevel(r){if(r!==0){if(this.minLevel===0||this.minLevel>r)return this.minLevel=r,this.nextMinLevel=0,void(this.nextMinLevelWindowLength=0);if(this.nextMinLevel===0)return this.nextMinLevel=r,void(this.nextMinLevelWindowLength=1);if(this.nextMinLevel>r&&(this.nextMinLevel=r),this.nextMinLevelWindowLength++,this.nextMinLevelWindowLength>=750){let s=Math.sqrt(this.minLevel*this.nextMinLevel);s<0?s=0:s>W1&&(s=W1),this.minLevel=s,this.nextMinLevel=0,this.nextMinLevelWindowLength=0}}}}class Tge{constructor(r){Pe(this,"algorithm",void 0),this.algorithm=r}execute(){let r=!this.algorithm;if(!r)try{const s=this.algorithm.runInDecisionMaker(this);s<=0?r=!0:setTimeout(this.execute.bind(this),s)}catch{r=!0}r&&this.algorithm&&this.algorithm.decisionMakerExited(this)}}class x2{constructor(r,s,a){Pe(this,"isDominant",void 0),Pe(this,"energyRanking",void 0),Pe(this,"energyScore",void 0),this.isDominant=r,this.energyRanking=s,this.energyScore=a}}class Cge extends Zr{constructor(r){super(),Pe(this,"dominantId",null),Pe(this,"lastDecisionTime",0),Pe(this,"lastLevelChangedTime",0),Pe(this,"lastLevelIdleTime",0),Pe(this,"relativeSpeechActivities",[]),Pe(this,"speakers",new Map),Pe(this,"enableSilence",!1),Pe(this,"timeoutToSilenceInterval",0),Pe(this,"decisionMaker",null),Pe(this,"loudest",[]),Pe(this,"numLoudestToTrack",3),Pe(this,"energyExpireTimeMs",250),Pe(this,"energyAlphaPct",50),this.timeoutToSilenceInterval=r,this.enableSilence=r>0,this.relativeSpeechActivities.length=3}setLoudestConfig(){let r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:3,s=arguments.length>1?arguments[1]:void 0,a=arguments.length>2?arguments[2]:void 0;this.numLoudestToTrack=r,s!=null&&(this.energyExpireTimeMs=s),a!=null&&(this.energyAlphaPct=a),this.loudest.length>r&&this.loudest.splice(r)}getDominantSpeaker(){return this.dominantId}isAmongLoudest(r){return this.loudest.some((s=>s.id===r))}levelChanged(r,s){const a=Date.now(),c=this.getOrCreateSpeaker(r);this.lastLevelChangedTime<a&&(this.lastLevelChangedTime=a,this.maybeStartDecisionMaker());const d=c.levelChanged(s,a);return this.updateLoudestList(c,d,a)}runInDecisionMaker(r){return this.decisionMaker!==r||this.lastDecisionTime>0&&this.lastDecisionTime-this.lastLevelChangedTime>=15e3?-1:this._runInDecisionMaker()}decisionMakerExited(r){this.decisionMaker===r&&(this.decisionMaker=null)}destroy(){this.decisionMaker=null,this.loudest.length=0,this.speakers.clear(),this.removeAllListeners()}addSpeakers(r){r.forEach((s=>{this.speakers.has(s.id)||this.speakers.set(s.id,s)}))}removeSpeakers(r){r.forEach((s=>{this.speakers.delete(s.id)}))}getOrCreateSpeaker(r){let s=this.speakers.get(r);return s||(s=new r7(r),this.speakers.set(r,s),this.maybeStartDecisionMaker()),s}updateLoudestList(r,s,a){const c=r.id===this.dominantId;if(s<0){let g=0;for(;g<this.loudest.length&&this.loudest[g]!==r;)++g;return new x2(c,g,r.energyScore)}if(r.energyScore=Math.floor((this.energyAlphaPct*s+(100-this.energyAlphaPct)*r.energyScore+50)/100),this.numLoudestToTrack===0)return new x2(c,0,r.energyScore);const d=a-this.energyExpireTimeMs;let h=0;for(;h<this.loudest.length;){const g=this.loudest[h];if(g.getLastLevelChangedTime()<d&&this.loudest.length>=this.numLoudestToTrack)this.loudest.splice(h,1);else if(g.id!==r.id)++h;else if(this.loudest.splice(h,1),this.loudest.length<this.numLoudestToTrack)break}let m=0;for(;m<this.loudest.length&&!(this.loudest[m].energyScore<r.energyScore);)++m;return m<this.numLoudestToTrack&&(this.loudest.splice(m,0,r),this.loudest.length>this.numLoudestToTrack&&this.loudest.splice(this.numLoudestToTrack,1)),new x2(c,m,r.energyScore)}maybeStartDecisionMaker(){!this.decisionMaker&&this.speakers.size>0&&(this.decisionMaker=new Tge(this),this.decisionMaker.execute())}makeDecision(r){let s=null,a=null;const c=this.speakers.size;let d=null;if(c===0)d=null;else if(c===1){var h;const m=Pc(h=this.speakers).call(h).next().value;this.enableSilence&&m&&(d=m.id,m.evaluateSpeechActivityScores(r),r-m.lastNonSilence>this.timeoutToSilenceInterval&&(d=null))}else{let m=this.dominantId==null?null:this.speakers.get(this.dominantId);if(m==null){const w=this.speakers.entries().next();w.value&&(d=w.value[0],m=w.value[1])}else d=m.id;m!=null&&m.evaluateSpeechActivityScores(r);const g=this.relativeSpeechActivities;let v=2;for(const w of this.speakers.entries()){const[I,A]=w;if(A===m)continue;A.evaluateSpeechActivityScores(r);for(let z=0;z<g.length;++z){const ee=m==null?uy:m.getSpeechActivityScore(z);g[z]=Math.log(A.getSpeechActivityScore(z)/ee)}const N=g[0],H=g[1],B=g[2];N>3&&H>2&&B>0&&H>v&&(v=H,d=I)}this.enableSilence&&m!=null&&d===m.id&&r-m.lastNonSilence>this.timeoutToSilenceInterval&&(d=null)}d==null&&!this.enableSilence||d===this.dominantId||(s=this.dominantId,this.dominantId=d,a=this.dominantId),a==null&&!this.enableSilence||a===s||this.emit("ActiveSpeakerChanged",a)}_runInDecisionMaker(){const r=Date.now(),s=300-(r-this.lastLevelIdleTime);let a=0;s<=0?(this.lastLevelIdleTime!==0&&this.timeoutIdleLevels(r),this.lastLevelIdleTime=r):a=s;let c=300-(r-this.lastDecisionTime);return c<=0&&(this.lastDecisionTime=r,this.makeDecision(r),c=300-(Date.now()-r)),c>0&&a>c&&(a=c),a}timeoutIdleLevels(r){const s=[];for(const c of Pc(a=this.speakers).call(a)){var a;const d=r-c.getLastLevelChangedTime();36e5<d&&(this.dominantId==null||c.id!==this.dominantId)?s.push(c.id):300<d&&c.levelTimedOut()}s.forEach((c=>this.speakers.delete(c)))}}const g0=new Map;let Qd=null,H1=null;const i7=3;let dy=[];const Zd=new Map,$1=new Map;class Rge{get samples(){return this.actives+this.inactives}get activeRate(){return this.actives/this.samples}constructor(r,s){Pe(this,"id",void 0),Pe(this,"track",void 0),Pe(this,"score",0),Pe(this,"active",!0),Pe(this,"muted",!1),Pe(this,"timer",0),Pe(this,"actives",0),Pe(this,"inactives",0),this.id=r,this.track=s,this.setActive(Zd.size<3)}autoCheckActive(){this.autoSetActive(),this.autoAdjustActive(),this.resetTimer(),this.actives=0,this.inactives=0}autoSetActive(){const r=this.active;this.active=this.activeRate>=.8;const{actives:s,inactives:a}=(function(){const c=[],d=[];return Array.from(Pc(Zd).call(Zd)).forEach((h=>{h.active?c.push(h):d.push(h)})),{actives:c,inactives:d}})();if(s.length>3){let c;s.forEach((d=>{(!c||c.score>d.score)&&(c=d)})),c&&c.setActive(!1)}if(s.length<3&&a.length>0){let c;a.forEach((d=>{(!c||c.score<d.score)&&d.id!==this.id&&(c=d)})),c&&r&&!this.active&&(c.samples>40&&c.activeRate-this.activeRate>.4?c.setActive(!0):this.active=!0)}this.setMuted(!this.active)}setActive(r){this.active=r,this.resetTimer(),this.setMuted(!r)}autoAdjustActive(){this.active?this.autoSwitchToInactive():this.autoSwitchToActive()}autoSwitchToActive(){const r=(function(s){let a;return Array.from(Pc(Zd).call(Zd)).forEach((c=>{!c.active||c.id===s||c.samples<40||(!a||c.score<a.score)&&(a=c)})),a})(this.id);r&&this.activeRate-r.activeRate>.4&&(r.setActive(!1),this.setActive(!0))}autoSwitchToInactive(){const r=(function(s){let a;return Array.from(Pc(Zd).call(Zd)).forEach((c=>{c.active||c.id===s||c.samples<40||(!a||c.score>a.score)&&(a=c)})),a})(this.id);r&&r.activeRate-this.activeRate>.4&&(r.setActive(!0),this.setActive(!1))}addSample(r){r?this.actives+=1:this.inactives+=1,this.samples>66.66666666666667&&this.autoCheckActive()}setMuted(r){this.track&&(this.track.enabled=!r,this.muted=r)}resetTimer(){this.clearTimer(),this.timer=window.setTimeout((()=>{if(this.samples!==0)return this.samples<50?this.resetTimer():void this.autoCheckActive()}),1e3)}clearTimer(){this.timer&&(clearTimeout(this.timer),this.timer=0)}}let K1;function s7(t){const r=Zd.get(t);r&&(Zd.delete(t),r.clearTimer())}const q1=new Map,Ige=new Map,D2="video/h264",L2="video/h265";function o7(t,r,s){let a=new Uint8Array(t,r,s),c=[],d=0;for(;c.length<s;)d+3<s&&a[d]===0&&a[d+1]===0&&a[d+2]===3&&(a[d+3]===0||a[d+3]===1||a[d+3]===2||a[d+3]===3)?(c.push(a[d],a[d+1],a[d+3]),d+=4):(c.push(a[d]),d++);return new Uint8Array(c)}function a7(t){const r=t.length;let s=[],a=0;for(;a<r;)a+2<r&&t[a]===0&&t[a+1]===0&&(t[a+2]===0||t[a+2]===1||t[a+2]===2||t[a+2]===3)?(s.push(t[a],t[a+1],3,t[a+2]),a+=3):(s.push(t[a]),a++);return new Uint8Array(s)}function c7(t){if(t.length<5)return"";let r=-1;for(let c=0;c<t.length-3;c++){if(t[c]===0&&t[c+1]===0&&t[c+2]===1){r=c;break}if(c<t.length-4&&t[c]===0&&t[c+1]===0&&t[c+2]===0&&t[c+3]===1){r=c;break}}if(r===-1)return"";const s=r+(t[r+2]===0?4:3);if(s>=t.length)return"";const a=t[s];return 128&a?"":(a>>1&63)>=32||s+1<t.length&&(248&t[s+1])==0?L2:(31&a)<=31?D2:""}const Y1=new Map,yT=new Map;(function(){const t=Mn();As.getDisplayMedia=!(!navigator.mediaDevices||!navigator.mediaDevices.getDisplayMedia),As.getStreamFromExtension=t.name===Yn.CHROME&&Number(t.version)>34,As.supportUnifiedPlan=(function(){if(!window.RTCRtpTransceiver||!("currentDirection"in RTCRtpTransceiver.prototype))return!1;const r=new RTCPeerConnection;let s=!1;try{r.addTransceiver("audio"),s=!0}catch{}return r.close(),s})(),As.supportMinBitrate=t.name===Yn.CHROME||t.name===Yn.EDGE,As.supportSetRtpSenderParameters=(function(){const r=Mn();return!!(window.RTCRtpSender&&window.RTCRtpSender.prototype.setParameters&&window.RTCRtpSender.prototype.getParameters)&&(!!vf()||!(!Fs()&&!T1())||r.name===Yn.FIREFOX&&Number(r.version)>=64)})(),t.name===Yn.SAFARI&&(Number(t.version)>=14?As.supportDualStream=!0:As.supportDualStream=!1),As.webAudioMediaStreamDest=(function(){const r=Mn();return!(r.name===Yn.SAFARI&&Number(r.version)<12)})(),As.supportReplaceTrack=!!window.RTCRtpSender&&typeof RTCRtpSender.prototype.replaceTrack=="function",As.supportWebGL=typeof WebGLRenderingContext<"u",As.supportRequestFrame=!!window.CanvasCaptureMediaStreamTrack,vf()||(As.webAudioWithAEC=!0),As.supportShareAudio=(function(){const r=Mn();return(r.os===os.WIN_10||r.os===os.WIN_81||r.os===os.WIN_7||r.os===os.LINUX||r.os===os.MAC_OS||r.os===os.CHROMIUM_OS)&&r.name===Yn.CHROME&&Number(r.version)>=74})(),As.supportDataChannel=!!(Qv(76)||FL(68)||a9(14)),As.supportPCSetConfiguration=(function(){const r=window.RTCPeerConnection;return!ii()&&!!r&&r.prototype.setConfiguration instanceof Function})(),As.supportWebRTCEncodedTransform=Qv(87)||i9()||FL(117),As.supportWebRTCInsertableStream=(function(){const r=Mn();return(r.name===Yn.CHROME||r.name===Yn.EDGE)&&Number(r.version)>=94&&"MediaStreamTrackGenerator"in window&&"MediaStreamTrackProcessor"in window})(),As.supportRequestVideoFrameCallback="requestVideoFrameCallback"in HTMLVideoElement.prototype,As.supportWebCrypto=typeof window<"u"&&window.crypto!==void 0&&window.crypto.subtle!==void 0,I1((()=>{As.supportDualStreamEncoding=(function(){const r=Mn();return!!oe("DISABLE_WEBAUDIO")||r.name==="Safari"&&Number(r.version)>=14||!!(r.name==="Chrome"&&/Windows/i.test(r.os||"")&&Number(r.version)>=100&&oe("CHROME_DUAL_STREAM_USE_ENCODING"))})(),M.debug("browser ua: ",navigator.userAgent),M.info("browser info: ",t),M.info("browser compatibility: ",As)}))})();const Age=["CHINA","GLOBAL"],l7=[[0,1,2,3,4,5,5],[0,2,2,3,4,5,5],[0,3,3,3,4,5,5],[0,4,4,4,4,5,5],[0,5,5,5,5,5,5]],hy=[],_0=[];function py(t,r){return!!r&&hy.some((s=>s.uid===t&&s.channelName===r))}function M2(){return _0.length>0}var Pge=w8.forEach,u7=u_("forEach")?[].forEach:function(t){return Pge(this,t,arguments.length>1?arguments[1]:void 0)};Kn({target:"Array",proto:!0,forced:[].forEach!==u7},{forEach:u7});var Oge=wc("Array","forEach"),kge=Id,Nge=Vr,xge=O,Dge=Oge,U2=Array.prototype,Lge={DOMTokenList:!0,NodeList:!0},Mge=function(t){var r=t.forEach;return t===U2||xge(U2,t)&&r===U2.forEach||Nge(Lge,kge(t))?Dge:r},Uge=l(Mge),Vge=Qs,d7=Pa;Kn({target:"Object",stat:!0,forced:u((function(){d7(1)}))},{keys:function(t){return d7(Vge(t))}});var jge=l(bt.Object.keys),Fge=l(Mi),Bge=l(m_),zge=Kn,h7=Ad,Wge=js,Gge=on,p7=Ye,Hge=mr,$ge=an,Kge=SD,qge=Rr,Yge=Ts,Xge=p8("slice"),Jge=qge("species"),V2=Array,Qge=Math.max;zge({target:"Array",proto:!0,forced:!Xge},{slice:function(t,r){var s,a,c,d=$ge(this),h=Hge(d),m=p7(t,h),g=p7(r===void 0?h:r,h);if(h7(d)&&(s=d.constructor,(Wge(s)&&(s===V2||h7(s.prototype))||Gge(s)&&(s=s[Jge])===null)&&(s=void 0),s===V2||s===void 0))return Yge(d,m,g);for(a=new(s===void 0?V2:s)(Qge(g-m,0)),c=0;m<g;m++,c++)m in d&&Kge(a,c,d[m]);return a.length=c,a}});var Zge=wc("Array","slice"),e_e=O,t_e=Zge,j2=Array.prototype,n_e=function(t){var r=t.slice;return t===j2||e_e(j2,t)&&r===j2.slice?t_e:r},r_e=l(n_e);function Rt(t,r,s,a,c){var d,h,m,g={};return Uge(d=jge(a)).call(d,(function(v){g[v]=a[v]})),g.enumerable=!!g.enumerable,g.configurable=!!g.configurable,("value"in g||g.initializer)&&(g.writable=!0),g=Fge(h=Bge(m=r_e(s).call(s)).call(m)).call(h,(function(v,w){return w(t,r,v)||v}),g),c&&g.initializer!==void 0&&(g.value=g.initializer?g.initializer.call(c):void 0,g.initializer=void 0),g.initializer===void 0?(l8(t,r,g),null):g}let X1=(function(t){return t[t.ACCESS_POINT=101]="ACCESS_POINT",t[t.UNILBS=201]="UNILBS",t[t.STRING_UID_ALLOCATOR=901]="STRING_UID_ALLOCATOR",t})({}),F2=(function(t){return t[t.IIIEGAL_APPID=1]="IIIEGAL_APPID",t[t.IIIEGAL_UID=2]="IIIEGAL_UID",t[t.INTERNAL_ERROR=3]="INTERNAL_ERROR",t})({}),Yu=(function(t){return t[t.INVALID_VENDOR_KEY=5]="INVALID_VENDOR_KEY",t[t.INVALID_CHANNEL_NAME=7]="INVALID_CHANNEL_NAME",t[t.INTERNAL_ERROR=8]="INTERNAL_ERROR",t[t.NO_AUTHORIZED=9]="NO_AUTHORIZED",t[t.DYNAMIC_KEY_TIMEOUT=10]="DYNAMIC_KEY_TIMEOUT",t[t.NO_ACTIVE_STATUS=11]="NO_ACTIVE_STATUS",t[t.DYNAMIC_KEY_EXPIRED=13]="DYNAMIC_KEY_EXPIRED",t[t.STATIC_USE_DYNAMIC_KEY=14]="STATIC_USE_DYNAMIC_KEY",t[t.DYNAMIC_USE_STATIC_KEY=15]="DYNAMIC_USE_STATIC_KEY",t[t.USER_OVERLOAD=16]="USER_OVERLOAD",t[t.FORBIDDEN_REGION=18]="FORBIDDEN_REGION",t[t.CANNOT_MEET_AREA_DEMAND=19]="CANNOT_MEET_AREA_DEMAND",t})({}),pa=(function(t){return t[t.NO_FLAG_SET=100]="NO_FLAG_SET",t[t.FLAG_SET_BUT_EMPTY=101]="FLAG_SET_BUT_EMPTY",t[t.INVALID_FALG_SET=102]="INVALID_FALG_SET",t[t.FLAG_SET_BUT_NO_RE=103]="FLAG_SET_BUT_NO_RE",t[t.INVALID_SERVICE_ID=104]="INVALID_SERVICE_ID",t[t.NO_SERVICE_AVAILABLE=200]="NO_SERVICE_AVAILABLE",t[t.NO_SERVICE_AVAILABLE_P2P=201]="NO_SERVICE_AVAILABLE_P2P",t[t.NO_SERVICE_AVAILABLE_VOICE=202]="NO_SERVICE_AVAILABLE_VOICE",t[t.NO_SERVICE_AVAILABLE_WEBRTC=203]="NO_SERVICE_AVAILABLE_WEBRTC",t[t.NO_SERVICE_AVAILABLE_CDS=204]="NO_SERVICE_AVAILABLE_CDS",t[t.NO_SERVICE_AVAILABLE_CDN=205]="NO_SERVICE_AVAILABLE_CDN",t[t.NO_SERVICE_AVAILABLE_TDS=206]="NO_SERVICE_AVAILABLE_TDS",t[t.NO_SERVICE_AVAILABLE_REPORT=207]="NO_SERVICE_AVAILABLE_REPORT",t[t.NO_SERVICE_AVAILABLE_APP_CENTER=208]="NO_SERVICE_AVAILABLE_APP_CENTER",t[t.NO_SERVICE_AVAILABLE_ENV0=209]="NO_SERVICE_AVAILABLE_ENV0",t[t.NO_SERVICE_AVAILABLE_VOET=210]="NO_SERVICE_AVAILABLE_VOET",t[t.NO_SERVICE_AVAILABLE_STRING_UID=211]="NO_SERVICE_AVAILABLE_STRING_UID",t[t.NO_SERVICE_AVAILABLE_WEBRTC_UNILBS=212]="NO_SERVICE_AVAILABLE_WEBRTC_UNILBS",t[t.NO_SERVICE_AVAILABLE_UNILBS_FLV=213]="NO_SERVICE_AVAILABLE_UNILBS_FLV",t})({}),Bt=(function(t){return t[t.K_TIMESTAMP_EXPIRED=2]="K_TIMESTAMP_EXPIRED",t[t.K_CHANNEL_PERMISSION_INVALID=3]="K_CHANNEL_PERMISSION_INVALID",t[t.K_CERTIFICATE_INVALID=4]="K_CERTIFICATE_INVALID",t[t.K_CHANNEL_NAME_EMPTY=5]="K_CHANNEL_NAME_EMPTY",t[t.K_CHANNEL_NOT_FOUND=6]="K_CHANNEL_NOT_FOUND",t[t.K_TICKET_INVALID=7]="K_TICKET_INVALID",t[t.K_CHANNEL_CONFLICTED=8]="K_CHANNEL_CONFLICTED",t[t.K_SERVICE_NOT_READY=9]="K_SERVICE_NOT_READY",t[t.K_SERVICE_TOO_HEAVY=10]="K_SERVICE_TOO_HEAVY",t[t.K_UID_BANNED=14]="K_UID_BANNED",t[t.K_IP_BANNED=15]="K_IP_BANNED",t[t.K_CHANNEL_BANNED=16]="K_CHANNEL_BANNED",t[t.DATASTREAM2_NOT_AVAILABLE=27]="DATASTREAM2_NOT_AVAILABLE",t[t.K_AUTO_REBALANCE=28]="K_AUTO_REBALANCE",t[t.WARN_NO_AVAILABLE_CHANNEL=103]="WARN_NO_AVAILABLE_CHANNEL",t[t.WARN_LOOKUP_CHANNEL_TIMEOUT=104]="WARN_LOOKUP_CHANNEL_TIMEOUT",t[t.WARN_LOOKUP_CHANNEL_REJECTED=105]="WARN_LOOKUP_CHANNEL_REJECTED",t[t.WARN_OPEN_CHANNEL_TIMEOUT=106]="WARN_OPEN_CHANNEL_TIMEOUT",t[t.WARN_OPEN_CHANNEL_REJECTED=107]="WARN_OPEN_CHANNEL_REJECTED",t[t.WARN_REQUEST_DEFERRED=108]="WARN_REQUEST_DEFERRED",t[t.ERR_DYNAMIC_KEY_TIMEOUT=109]="ERR_DYNAMIC_KEY_TIMEOUT",t[t.ERR_NO_AUTHORIZED=110]="ERR_NO_AUTHORIZED",t[t.ERR_VOM_SERVICE_UNAVAILABLE=111]="ERR_VOM_SERVICE_UNAVAILABLE",t[t.ERR_NO_CHANNEL_AVAILABLE_CODE=112]="ERR_NO_CHANNEL_AVAILABLE_CODE",t[t.ERR_MASTER_VOCS_UNAVAILABLE=114]="ERR_MASTER_VOCS_UNAVAILABLE",t[t.ERR_INTERNAL_ERROR=115]="ERR_INTERNAL_ERROR",t[t.ERR_NO_ACTIVE_STATUS=116]="ERR_NO_ACTIVE_STATUS",t[t.ERR_INVALID_UID=117]="ERR_INVALID_UID",t[t.ERR_DYNAMIC_KEY_EXPIRED=118]="ERR_DYNAMIC_KEY_EXPIRED",t[t.ERR_STATIC_USE_DYANMIC_KE=119]="ERR_STATIC_USE_DYANMIC_KE",t[t.ERR_DYNAMIC_USE_STATIC_KE=120]="ERR_DYNAMIC_USE_STATIC_KE",t[t.ERR_NO_VOCS_AVAILABLE=2e3]="ERR_NO_VOCS_AVAILABLE",t[t.ERR_NO_VOS_AVAILABLE=2001]="ERR_NO_VOS_AVAILABLE",t[t.ERR_JOIN_CHANNEL_TIMEOUT=2002]="ERR_JOIN_CHANNEL_TIMEOUT",t[t.ERR_REPEAT_JOIN_CHANNEL=2003]="ERR_REPEAT_JOIN_CHANNEL",t[t.ERR_JOIN_BY_MULTI_IP=2004]="ERR_JOIN_BY_MULTI_IP",t[t.ERR_NOT_JOINED=2011]="ERR_NOT_JOINED",t[t.ERR_REPEAT_JOIN_REQUEST=2012]="ERR_REPEAT_JOIN_REQUEST",t[t.ERR_INVALID_VENDOR_KEY=2013]="ERR_INVALID_VENDOR_KEY",t[t.ERR_INVALID_CHANNEL_NAME=2014]="ERR_INVALID_CHANNEL_NAME",t[t.ERR_INVALID_STRINGUID=2015]="ERR_INVALID_STRINGUID",t[t.ERR_TOO_MANY_USERS=2016]="ERR_TOO_MANY_USERS",t[t.ERR_SET_CLIENT_ROLE_TIMEOUT=2017]="ERR_SET_CLIENT_ROLE_TIMEOUT",t[t.ERR_SET_CLIENT_ROLE_NO_PERMISSION=2018]="ERR_SET_CLIENT_ROLE_NO_PERMISSION",t[t.ERR_SET_CLIENT_ROLE_ALREADY_IN_USE=2019]="ERR_SET_CLIENT_ROLE_ALREADY_IN_USE",t[t.ERR_PUBLISH_REQUEST_INVALID=2020]="ERR_PUBLISH_REQUEST_INVALID",t[t.ERR_SUBSCRIBE_REQUEST_INVALID=2021]="ERR_SUBSCRIBE_REQUEST_INVALID",t[t.ERR_NOT_SUPPORTED_MESSAGE=2022]="ERR_NOT_SUPPORTED_MESSAGE",t[t.ERR_ILLEAGAL_PLUGIN=2023]="ERR_ILLEAGAL_PLUGIN",t[t.ERR_REJOIN_TOKEN_INVALID=2024]="ERR_REJOIN_TOKEN_INVALID",t[t.ERR_REJOIN_USER_NOT_JOINED=2025]="ERR_REJOIN_USER_NOT_JOINED",t[t.ERR_INVALID_OPTIONAL_INFO=2027]="ERR_INVALID_OPTIONAL_INFO",t[t.ILLEGAL_AES_PASSWORD=2028]="ILLEGAL_AES_PASSWORD",t[t.ILLEGAL_CLIENT_ROLE_LEVEL=2029]="ILLEGAL_CLIENT_ROLE_LEVEL",t[t.ERR_TOO_MANY_BROADCASTERS=2031]="ERR_TOO_MANY_BROADCASTERS",t[t.ERR_TOO_MANY_SUBSCRIBERS=2032]="ERR_TOO_MANY_SUBSCRIBERS",t[t.ERR_LICENSE_MISSING=32769]="ERR_LICENSE_MISSING",t[t.ERR_LICENSE_EXPIRED=32771]="ERR_LICENSE_EXPIRED",t[t.ERR_LICENSE_MINUTES_EXCEEDED=32773]="ERR_LICENSE_MINUTES_EXCEEDED",t[t.ERR_LICENSE_PERIOD_INVALID=32774]="ERR_LICENSE_PERIOD_INVALID",t[t.ERR_LICENSE_MULTIPLE_SDK_SERVICE=32778]="ERR_LICENSE_MULTIPLE_SDK_SERVICE",t[t.ERR_LICENSE_ILLEGAL=32783]="ERR_LICENSE_ILLEGAL",t[t.ERR_TEST_RECOVER=9e3]="ERR_TEST_RECOVER",t[t.ERR_TEST_TRYNEXT=9001]="ERR_TEST_TRYNEXT",t[t.ERR_TEST_RETRY=9002]="ERR_TEST_RETRY",t})({}),Or=(function(t){return t.CONNECTING="connecting",t.CONNECTED="connected",t.RECONNECTING="reconnecting",t.CLOSED="closed",t})({}),tn=(function(t){return t.WS_CONNECTED="ws_connected",t.WS_RECONNECTING="ws_reconnecting",t.WS_CLOSED="ws_closed",t.WS_RECONNECT_CREATE_CONNECTION="ws_reconnect_create_connection",t.ON_BINARY_DATA="on_binary_data",t.REQUEST_RECOVER="request_recover",t.REQUEST_JOIN_INFO="request_join_info",t.REQUEST_REJOIN_INFO="req_rejoin_info",t.IS_P2P_DISCONNECTED="is_p2p_dis",t.DISCONNECT_P2P="dis_p2p",t.ABORT_P2P_EXECUTION="abort_p2p_execution",t.NEED_RENEW_SESSION="need-sid",t.REPORT_JOIN_GATEWAY="report_join_gateway",t.REQUEST_TIMEOUT="request_timeout",t.REQUEST_SUCCESS="request_success",t.JOIN_RESPONSE="join_response",t.PRE_CONNECT_PC="pre_connect_pc",t.P2P_CONNECTION="p2p_connection",t.P2P_REMOTE_CANDIDATE_UPDATE="p2p_remote_candidate_update",t.P2P_SUBSCRIBE="p2p_subscribe",t.P2P_UNSUBSCRIBE="p2p_unsubscribe",t.P2P_EXCHANGE_SDP="p2p_exchange_sdp",t.P2P_ON_ADD_VIDEO_STREAM="p2p_on_add_video_stream",t.P2P_ON_ADD_AUDIO_STREAM="p2p_on_add_audio_stream",t.RECOVER_NOTIFICATION="recover_notification",t})({}),Qt=(function(t){return t.PING="ping",t.PING_BACK="ping_back",t.JOIN="join_v3",t.REJOIN="rejoin_v3",t.LEAVE="leave",t.SET_CLIENT_ROLE="set_client_role",t.PUBLISH="publish",t.PUBLISH_DATASTREAM="publish_datastream",t.UNPUBLISH="unpublish",t.UNPUBLISH_DATASTREAM="unpublish_datastream",t.SUBSCRIBE="subscribe",t.PRE_SUBSCRIBE="pre_subscribe",t.SUBSCRIBE_DATASTREAM="subscribe_datastream",t.SUBSCRIBE_STREAMS="subscribe_streams",t.UNSUBSCRIBE="unsubscribe",t.UNSUBSCRIBE_DATASTREAM="unsubscribe_datastream",t.UNSUBSCRIBE_STREAMS="unsubscribe_streams",t.SUBSCRIBE_CHANGE="subscribe_change",t.TRAFFIC_STATS="traffic_stats",t.RENEW_TOKEN="renew_token",t.SWITCH_VIDEO_STREAM="switch_video_stream",t.DEFAULT_VIDEO_STREAM="default_video_stream",t.SET_FALLBACK_OPTION="set_fallback_option",t.GATEWAY_INFO="gateway_info",t.CONTROL="control",t.SEND_METADATA="send_metadata",t.DATA_STREAM="data_stream",t.PICK_SVC_LAYER="pick_svc_layer",t.RESTART_ICE="restart_ice",t.CONNECT_PC="connect_pc",t.SET_VIDEO_PROFILE="set_video_profile",t.SET_PARAMETER="set_parameter",t.SET_RTM2_FLAG="set_rtm2_flag",t.DOWNGRADE_CODEC="downgrade_codec",t})({}),ET=(function(t){return t.WRTC_STATS="wrtc_stats",t.WS_INFLATE_DATA_LENGTH="ws_inflate_data_length",t.DENOISER_STATS="denoiser_stats",t.EXTENSION_USAGE_STATS="extension_usage_stats",t})({}),Nn=(function(t){return t.ON_USER_ONLINE="on_user_online",t.ON_USER_OFFLINE="on_user_offline",t.ON_STREAM_FALLBACK_UPDATE="on_stream_fallback_update",t.ON_PUBLISH_STREAM="on_publish_stream",t.ON_UPLINK_STATS="on_uplink_stats",t.ON_P2P_LOST="on_p2p_lost",t.ON_REMOVE_STREAM="on_remove_stream",t.ON_ADD_AUDIO_STREAM="on_add_audio_stream",t.ON_ADD_VIDEO_STREAM="on_add_video_stream",t.ON_TOKEN_PRIVILEGE_WILL_EXPIRE="on_token_privilege_will_expire",t.ON_TOKEN_PRIVILEGE_DID_EXPIRE="on_token_privilege_did_expire",t.ON_USER_BANNED="on_user_banned",t.ON_USER_LICENSE_BANNED="on_user_license_banned",t.ON_NOTIFICATION="on_notification",t.ON_CRYPT_ERROR="on_crypt_error",t.MUTE_AUDIO="mute_audio",t.MUTE_VIDEO="mute_video",t.UNMUTE_AUDIO="unmute_audio",t.UNMUTE_VIDEO="unmute_video",t.ON_P2P_OK="on_p2p_ok",t.RECEIVE_METADATA="receive_metadata",t.ON_DATA_STREAM="on_data_stream",t.ON_RTP_CAPABILITY_CHANGE="on_rtp_capability_change",t.ON_REMOTE_DATASTREAM_UPDATE="on_remote_datastream_update",t.ON_REMOTE_FULL_DATASTREAM_INFO="on_remote_full_datastream_info",t.ENABLE_LOCAL_VIDEO="enable_local_video",t.DISABLE_LOCAL_VIDEO="disable_local_video",t.ENABLE_LOCAL_AUDIO="enable_local_audio",t.DISABLE_LOCAL_AUDIO="disable_local_audio",t.ON_PUBLISHED_USER_LIST="on_published_user_list",t})({}),fa=(function(t){return t.SEND_ONLY="SEND_ONLY",t.RECEIVE_ONLY="RECEIVE_ONLY",t})({}),pn=(function(t){return t.CONNECTED="websocket:connected",t.RECONNECTING="websocket:reconnecting",t.WILL_RECONNECT="websocket:will_reconnect",t.CLOSED="websocket:closed",t.FAILED="websocket:failed",t.ON_MESSAGE="websocket:on_message",t.REQUEST_NEW_URLS="websocket:request_new_urls",t.RECONNECT_CREATE_CONNECTION="websocket:reconnect_create_connection",t.ON_TOKEN_PRIVILEGE_DID_EXPIRE="websocket:on_token_privilege_did_expire",t})({});function J1(t){if(typeof t!="string"||!/^[a-zA-Z0-9 \!\#\$\%\&\(\)\+\-\:\;\<\=\.\>\?\@\[\]\^\_\{\}\|\~\,]{1,64}$/.test(t))throw M.error("Invalid Channel Name ".concat(t)),new ke(te.INVALID_PARAMS,"The length must be within 64 bytes. The supported characters: a-z,A-Z,0-9,space,!, #, $, %, &, (, ), +, -, :, ;, <, =, ., >, ?, @, [, ], ^, _,  {, }, |, ~, ,")}function Q1(t){if(r=t,!(typeof r=="number"&&Math.floor(r)===r&&0<=r&&r<=4294967295||m9(t,1,255)))throw new ke(te.INVALID_PARAMS,"[String uid] Length of the string: [1,255]. ASCII characters only. [Number uid] The value range is [0,10000]");var r;typeof t=="string"&&M.warn("You input a string as the user ID, to ensure better end-user experience, Agora highly suggests not using a string as the user ID.")}let bf=(function(t){return t.TRANSCODE="mix_streaming",t.RAW="raw_streaming",t})({});const i_e={alpha:1,height:640,width:360,x:0,y:0,zOrder:0,audioChannel:0},B2={x:0,y:0,width:160,height:160,zOrder:255,alpha:1};function z2(t,r){Rs(t.url,"".concat(r,".url"),1,1e3,!1),si(t.x)||vr(t.x,"".concat(r,".x"),0,1e4),si(t.y)||vr(t.y,"".concat(r,".y"),0,1e4),si(t.width)||vr(t.width,"".concat(r,".width"),0,1e4),si(t.height)||vr(t.height,"".concat(r,".height"),0,1e4),si(t.zOrder)||vr(t.zOrder,"".concat(r,".zOrder"),0,255),si(t.alpha)||vr(t.alpha,"".concat(r,".alpha"),0,1,!1)}const s_e={audioBitrate:48,audioChannels:1,audioSampleRate:48e3,backgroundColor:0,height:360,lowLatency:!1,videoBitrate:400,videoCodecProfile:100,videoCodecType:1,videoFrameRate:15,videoGop:30,width:640,images:[],userConfigs:[],userConfigExtraInfo:""};let tg=(function(t){return t.WARNING="@live_uap-warning",t.ERROR="@line_uap-error",t.PUBLISH_STREAM_STATUS="@live_uap-publish-status",t.WORKER_STATUS="@live_uap-worker-status",t.REQUEST_NEW_ADDRESS="@live_uap-request-address",t})({}),W2=(function(t){return t.REQUEST_WORKER_MANAGER_LIST="@live_req_worker_manager",t})({}),Hi=(function(t){return t[t.LIVE_STREAM_RESPONSE_SUCCEED=200]="LIVE_STREAM_RESPONSE_SUCCEED",t[t.LIVE_STREAM_RESPONSE_ALREADY_EXISTS_STREAM=454]="LIVE_STREAM_RESPONSE_ALREADY_EXISTS_STREAM",t[t.LIVE_STREAM_RESPONSE_TRANSCODING_PARAMETER_ERROR=450]="LIVE_STREAM_RESPONSE_TRANSCODING_PARAMETER_ERROR",t[t.LIVE_STREAM_RESPONSE_BAD_STREAM=451]="LIVE_STREAM_RESPONSE_BAD_STREAM",t[t.LIVE_STREAM_RESPONSE_WM_PARAMETER_ERROR=400]="LIVE_STREAM_RESPONSE_WM_PARAMETER_ERROR",t[t.LIVE_STREAM_RESPONSE_WM_WORKER_NOT_EXIST=404]="LIVE_STREAM_RESPONSE_WM_WORKER_NOT_EXIST",t[t.LIVE_STREAM_RESPONSE_NOT_AUTHORIZED=456]="LIVE_STREAM_RESPONSE_NOT_AUTHORIZED",t[t.LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE=457]="LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE",t[t.LIVE_STREAM_RESPONSE_REQUEST_TOO_OFTEN=429]="LIVE_STREAM_RESPONSE_REQUEST_TOO_OFTEN",t[t.LIVE_STREAM_RESPONSE_NOT_FOUND_PUBLISH=452]="LIVE_STREAM_RESPONSE_NOT_FOUND_PUBLISH",t[t.LIVE_STREAM_RESPONSE_NOT_SUPPORTED=453]="LIVE_STREAM_RESPONSE_NOT_SUPPORTED",t[t.LIVE_STREAM_RESPONSE_MAX_STREAM_NUM=455]="LIVE_STREAM_RESPONSE_MAX_STREAM_NUM",t[t.LIVE_STREAM_RESPONSE_INTERNAL_SERVER_ERROR=500]="LIVE_STREAM_RESPONSE_INTERNAL_SERVER_ERROR",t[t.LIVE_STREAM_RESPONSE_WORKER_LOST=501]="LIVE_STREAM_RESPONSE_WORKER_LOST",t[t.LIVE_STREAM_RESPONSE_RESOURCE_LIMIT=502]="LIVE_STREAM_RESPONSE_RESOURCE_LIMIT",t[t.LIVE_STREAM_RESPONSE_WORKER_QUIT=503]="LIVE_STREAM_RESPONSE_WORKER_QUIT",t[t.ERROR_FAIL_SEND_MESSAGE=504]="ERROR_FAIL_SEND_MESSAGE",t[t.PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE=30]="PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE",t[t.PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT=31]="PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT",t[t.PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH=32]="PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH",t[t.PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN=33]="PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN",t})({});function f7(t){if(!t.channelName)throw new ke(te.INVALID_PARAMS,"invalid channelName in info");if(typeof t.uid!="number")throw new ke(te.INVALID_PARAMS,"invalid uid in info, uid must be a number");return t.token&&Rs(t.token,"info.token",1,2047),Q1(t.uid),J1(t.channelName),!0}let ma=(function(t){return t[t.SetSdkProfile=0]="SetSdkProfile",t[t.SetSourceChannel=1]="SetSourceChannel",t[t.SetSourceUserId=2]="SetSourceUserId",t[t.SetDestChannel=3]="SetDestChannel",t[t.StartPacketTransfer=4]="StartPacketTransfer",t[t.StopPacketTransfer=5]="StopPacketTransfer",t[t.UpdateDestChannel=6]="UpdateDestChannel",t[t.Reconnect=7]="Reconnect",t[t.SetVideoProfile=8]="SetVideoProfile",t})({}),wf=(function(t){return t.NETWORK_DISCONNECTED="NETWORK_DISCONNECTED",t.NETWORK_CONNECTED="NETWORK_CONNECTED",t.PACKET_JOINED_SRC_CHANNEL="PACKET_JOINED_SRC_CHANNEL",t.PACKET_JOINED_DEST_CHANNEL="PACKET_JOINED_DEST_CHANNEL",t.PACKET_SENT_TO_DEST_CHANNEL="PACKET_SENT_TO_DEST_CHANNEL",t.PACKET_RECEIVED_VIDEO_FROM_SRC="PACKET_RECEIVED_VIDEO_FROM_SRC",t.PACKET_RECEIVED_AUDIO_FROM_SRC="PACKET_RECEIVED_AUDIO_FROM_SRC",t.PACKET_UPDATE_DEST_CHANNEL="PACKET_UPDATE_DEST_CHANNEL",t.PACKET_UPDATE_DEST_CHANNEL_REFUSED="PACKET_UPDATE_DEST_CHANNEL_REFUSED",t.PACKET_UPDATE_DEST_CHANNEL_NOT_CHANGE="PACKET_UPDATE_DEST_CHANNEL_NOT_CHANGE",t})({}),ic=(function(t){return t.RELAY_STATE_IDLE="RELAY_STATE_IDLE",t.RELAY_STATE_CONNECTING="RELAY_STATE_CONNECTING",t.RELAY_STATE_RUNNING="RELAY_STATE_RUNNING",t.RELAY_STATE_FAILURE="RELAY_STATE_FAILURE",t})({}),y0=(function(t){return t.RELAY_OK="RELAY_OK",t.SERVER_CONNECTION_LOST="SERVER_CONNECTION_LOST",t.SRC_TOKEN_EXPIRED="SRC_TOKEN_EXPIRED",t.DEST_TOKEN_EXPIRED="DEST_TOKEN_EXPIRED",t})({}),lr=(function(t){return t.High="high",t.Low="low",t.Audio="audio",t.Screen="screen",t.ScreenLow="screen_low",t})({}),ps=(function(t){return t.DISCONNECT="disconnect",t.CONNECTION_STATE_CHANGE="connection-state-change",t.NETWORK_QUALITY="network-quality",t.STREAM_TYPE_CHANGE="stream-type-change",t.IS_P2P_DISCONNECTED="is-p2p-dis",t.DISCONNECT_P2P="dis-p2p",t.REQUEST_NEW_GATEWAY_LIST="req-gate-url",t.NEED_RENEW_SESSION="need-sid",t.REQUEST_P2P_CONNECTION_PARAMS="request-p2p-connection-params",t.JOIN_RESPONSE="join-response",t.RESET_CONNECTION_EVENTS="reset-connection-events",t.PRE_CONNECT_PC="pre-connect_pc",t.UPDATE_GATEWAY_CONFIG="update-gateway-config",t})({}),Z1=(function(t){return t.P2P_DISCONNECTED="P2P_DISCONNECTED",t.A_ROUND_WS_FAILED="A_ROUND_WS_FAILED",t.TIMEOUT="TIMEOUT",t.UNKNOWN_REASON="UNKNOWN_REASON",t})({}),as=(function(t){return t[t.Nothing=0]="Nothing",t[t.Audio=1]="Audio",t[t.LwoVideo=2]="LwoVideo",t[t.Video=4]="Video",t[t.Data=8]="Data",t[t.DataStream0=256]="DataStream0",t[t.DataStream1=512]="DataStream1",t[t.DataStream2=1024]="DataStream2",t[t.DataStream3=2048]="DataStream3",t[t.DataStream4=4096]="DataStream4",t[t.DataStream5=8192]="DataStream5",t[t.DataStream6=16384]="DataStream6",t[t.DataStream7=32768]="DataStream7",t})({}),tr=(function(t){return t.CHINA="CHINA",t.ASIA="ASIA",t.NORTH_AMERICA="NORTH_AMERICA",t.EUROPE="EUROPE",t.JAPAN="JAPAN",t.INDIA="INDIA",t.KOREA="KOREA",t.HKMC="HKMC",t.US="US",t.OCEANIA="OCEANIA",t.SOUTH_AMERICA="SOUTH_AMERICA",t.AFRICA="AFRICA",t.OVERSEA="OVERSEA",t.GLOBAL="GLOBAL",t.EXTENSIONS="EXTENSIONS",t})({});const m7=[tr.AFRICA,tr.ASIA,tr.CHINA,tr.EUROPE,tr.GLOBAL,tr.INDIA,tr.JAPAN,tr.NORTH_AMERICA,tr.OCEANIA,tr.OVERSEA,tr.SOUTH_AMERICA];let ao=(function(t){return t.CHINA="CN",t.ASIA="AS",t.NORTH_AMERICA="NA",t.EUROPE="EU",t.JAPAN="JP",t.INDIA="IN",t.KOREA="KR",t.HKMC="HK",t.US="US",t.OCEANIA="OC",t.SOUTH_AMERICA="SA",t.AFRICA="AF",t.OVERSEA="OVERSEA",t.GLOBAL="GLOBAL",t.EXTENSIONS="GLOBAL",t})({});const eP={CHINA:{},ASIA:{CODE:ao.ASIA,WEBCS_DOMAIN:["ap-web-1-asia.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-asia.agora.io"],PROXY_CS:["proxy-ap-web-asia.agora.io"],CDS_AP:["cds-ap-web-asia.agora.io","cds-ap-web-asia2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-asia.agora.io","sua-ap-web-asia2.agora.io"],UAP_AP:["uap-ap-web-asia.agora.io","uap-ap-web-asia2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-asia.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-asia.agora.io"],LOG_UPLOAD_SERVER:["logservice-asia.agora.io"],PROXY_SERVER_TYPE3:["southeast-asia.webrtc-cloud-proxy.sd-rtn.com"]},NORTH_AMERICA:{CODE:ao.NORTH_AMERICA,WEBCS_DOMAIN:["ap-web-1-north-america.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-north-america.agora.io"],PROXY_CS:["proxy-ap-web-america.agora.io"],CDS_AP:["cds-ap-web-america.agora.io","cds-ap-web-america2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-america.agora.io","sua-ap-web-america2.agora.io"],UAP_AP:["uap-ap-web-america.agora.io","uap-ap-web-america2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-north-america.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-north-america.agora.io"],LOG_UPLOAD_SERVER:["logservice-north-america.agora.io"],PROXY_SERVER_TYPE3:["east-usa.webrtc-cloud-proxy.sd-rtn.com"]},EUROPE:{CODE:ao.EUROPE,WEBCS_DOMAIN:["ap-web-1-europe.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-europe.agora.io"],PROXY_CS:["proxy-ap-web-europe.agora.io"],CDS_AP:["cds-ap-web-europe.agora.io","cds-ap-web-europe2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-europe.agora.io","sua-ap-web-europe.agora.io"],UAP_AP:["uap-ap-web-europe.agora.io","uap-ap-web-europe2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-europe.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-europe.agora.io"],LOG_UPLOAD_SERVER:["logservice-europe.agora.io"],PROXY_SERVER_TYPE3:["europe.webrtc-cloud-proxy.sd-rtn.com"]},JAPAN:{CODE:ao.JAPAN,WEBCS_DOMAIN:["ap-web-1-japan.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-japan.agora.io"],PROXY_CS:["proxy-ap-web-japan.agora.io"],CDS_AP:["cds-ap-web-japan.agora.io","cds-ap-web-japan2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-japan.agora.io","sua-ap-web-japan2.agora.io"],UAP_AP:["uap-ap-web-japan.agora.io","uap-ap-web-japan2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-japan.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-japan.agora.io"],LOG_UPLOAD_SERVER:["logservice-japan.agora.io"],PROXY_SERVER_TYPE3:["japan.webrtc-cloud-proxy.sd-rtn.com"]},INDIA:{CODE:ao.INDIA,WEBCS_DOMAIN:["ap-web-1-india.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-india.agora.io"],PROXY_CS:["proxy-ap-web-india.agora.io"],CDS_AP:["cds-ap-web-india.agora.io","cds-ap-web-india2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-india.agora.io","sua-ap-web-india2.agora.io"],UAP_AP:["uap-ap-web-india.agora.io","uap-ap-web-india2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-india.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-india.agora.io"],LOG_UPLOAD_SERVER:["logservice-india.agora.io"],PROXY_SERVER_TYPE3:["india.webrtc-cloud-proxy.sd-rtn.com"]},KOREA:{CODE:ao.KOREA,WEBCS_DOMAIN:["ap-web-1-korea.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-korea.agora.io"],PROXY_CS:["proxy-ap-web-korea.agora.io"],CDS_AP:["cds-ap-web-korea.agora.io","cds-ap-web-korea2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-korea.agora.io","sua-ap-web-korea2.agora.io"],UAP_AP:["uap-ap-web-korea.agora.io","uap-ap-web-korea2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-korea.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-korea.agora.io"],LOG_UPLOAD_SERVER:["logservice-korea.agora.io"],PROXY_SERVER_TYPE3:["korea.webrtc-cloud-proxy.sd-rtn.com"]},HKMC:{CODE:ao.HKMC,WEBCS_DOMAIN:["ap-web-1-hkmc.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-hkmc.agora.io"],PROXY_CS:["proxy-ap-web-hkmc.agora.io"],CDS_AP:["cds-ap-web-hkmc.agora.io","cds-ap-web-hkmc2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-hkmc.agora.io","sua-ap-web-hkmc2.agora.io"],UAP_AP:["uap-ap-web-hkmc.agora.io","uap-ap-web-hkmc2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-hkmc.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-hkmc.agora.io"],LOG_UPLOAD_SERVER:["logservice-hkmc.agora.io"],PROXY_SERVER_TYPE3:["hkmc.webrtc-cloud-proxy.sd-rtn.com"]},US:{CODE:ao.US,WEBCS_DOMAIN:["ap-web-1-us.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-us.agora.io"],PROXY_CS:["proxy-ap-web-us.agora.io"],CDS_AP:["cds-ap-web-us.agora.io","cds-ap-web-us2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-us.agora.io","sua-ap-web-us2.agora.io"],UAP_AP:["uap-ap-web-us.agora.io","uap-ap-web-us2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-us.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-us.agora.io"],LOG_UPLOAD_SERVER:["logservice-us.agora.io"],PROXY_SERVER_TYPE3:["us.webrtc-cloud-proxy.sd-rtn.com"]},OVERSEA:{CODE:ao.OVERSEA,WEBCS_DOMAIN:["ap-web-1-oversea.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-oversea.agora.io"],PROXY_CS:["proxy-ap-web-oversea.agora.io"],CDS_AP:["cds-ap-web-oversea.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-oversea.agora.io"],UAP_AP:["uap-ap-web-oversea.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-oversea.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-oversea.agora.io"],LOG_UPLOAD_SERVER:["logservice-oversea.agora.io"],PROXY_SERVER_TYPE3:["webrtc-cloud-proxy.agora.io"]},GLOBAL:{CODE:ao.GLOBAL,WEBCS_DOMAIN:["webrtc2-ap-web-1.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["webrtc2-ap-web-3.agora.io"],PROXY_CS:["ap-proxy-1.agora.io","ap-proxy-2.agora.io"],CDS_AP:["cds-ap-web-1.agora.io","cds-ap-web-3.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-1.agora.io","sua-ap-web-3.agora.io"],UAP_AP:["uap-ap-web-1.agora.io","uap-ap-web-3.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2.agora.io"],LOG_UPLOAD_SERVER:["logservice.agora.io"],PROXY_SERVER_TYPE3:["webrtc-cloud-proxy.sd-rtn.com"]},OCEANIA:{CODE:ao.OCEANIA,WEBCS_DOMAIN:["ap-web-1-oceania.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-oceania.agora.io"],PROXY_CS:["proxy-ap-web-oceania.agora.io"],CDS_AP:["cds-ap-web-oceania.agora.io","cds-ap-web-oceania2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-oceania.agora.io","sua-ap-web-oceania2.agora.io"],UAP_AP:["uap-ap-web-oceania.agora.io","uap-ap-web-oceania2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-oceania.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-oceania.agora.io"],LOG_UPLOAD_SERVER:["logservice-oceania.agora.io"],PROXY_SERVER_TYPE3:["oceania.webrtc-cloud-proxy.sd-rtn.com"]},SOUTH_AMERICA:{CODE:ao.SOUTH_AMERICA,WEBCS_DOMAIN:["ap-web-1-south-america.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-south-america.agora.io"],PROXY_CS:["proxy-ap-web-south-america.agora.io"],CDS_AP:["cds-ap-web-south-america.agora.io","cds-ap-web-south-america2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-south-america.agora.io","sua-ap-web-south-america2.agora.io"],UAP_AP:["uap-ap-web-south-america.agora.io","uap-ap-web-south-america2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-south-america.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-south-america.agora.io"],LOG_UPLOAD_SERVER:["logservice-south-america.agora.io"],PROXY_SERVER_TYPE3:["south-america.webrtc-cloud-proxy.sd-rtn.com"]},AFRICA:{CODE:ao.AFRICA,WEBCS_DOMAIN:["ap-web-1-africa.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-africa.agora.io"],PROXY_CS:["proxy-ap-web-africa.agora.io"],CDS_AP:["cds-ap-web-africa.agora.io","cds-ap-web-africa2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-africa.agora.io","sua-ap-web-africa2.agora.io"],UAP_AP:["uap-ap-web-africa.agora.io","uap-ap-web-africa2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-africa.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-africa.agora.io"],LOG_UPLOAD_SERVER:["logservice-south-africa.agora.io"],PROXY_SERVER_TYPE3:["africa.webrtc-cloud-proxy.sd-rtn.com"]},EXTENSIONS:{}};o2&&(eP.CHINA={CODE:ao.CHINA,WEBCS_DOMAIN:["webrtc2-2.ap.sd-rtn.com"],WEBCS_DOMAIN_BACKUP_LIST:["webrtc2-4.ap.sd-rtn.com"],PROXY_CS:["proxy-web.ap.sd-rtn.com"],CDS_AP:["cds-web-2.ap.sd-rtn.com","cds-web-4.ap.sd-rtn.com"],ACCOUNT_REGISTER:["sua-web-2.ap.sd-rtn.com","sua-web-4.ap.sd-rtn.com"],UAP_AP:["uap-web-2.ap.sd-rtn.com","uap-web-4.ap.sd-rtn.com"],EVENT_REPORT_DOMAIN:["web-3.statscollector.sd-rtn.com"],EVENT_REPORT_BACKUP_DOMAIN:["web-4.statscollector.sd-rtn.com"],LOG_UPLOAD_SERVER:["logservice-china.agora.io"],PROXY_SERVER_TYPE3:["east-cn.webrtc-cloud-proxy.sd-rtn.com"]});let vT=(function(t){return t.UPDATE_BITRATE_LIMIT="update_bitrate_limit",t.UPDATE_CLIENT_ROLE_OPTIONS="update_client_role_options",t})({});function g7(t){return!!t&&!(!t.uplink||!t.id)&&t.uplink.max_bitrate!==void 0&&t.uplink.min_bitrate!==void 0}class _7 extends Zr{constructor(r,s){super(),X(this,"onICEConnectionStateChange",void 0),X(this,"onConnectionStateChange",void 0),X(this,"onDTLSTransportStateChange",void 0),X(this,"onDTLSTransportError",void 0),X(this,"onICETransportStateChange",void 0),X(this,"onFirstAudioReceived",void 0),X(this,"onFirstVideoReceived",void 0),X(this,"onFirstAudioDecoded",void 0),X(this,"onFirstVideoDecoded",void 0),X(this,"onFirstVideoRender",void 0),X(this,"onFirstVideoDecodedTimeout",void 0),X(this,"onSelectedLocalCandidateChanged",void 0),X(this,"onSelectedRemoteCandidateChanged",void 0),X(this,"onICECandidateError",void 0),X(this,"getLocalVideoStats",void 0)}}class y7 extends _7{constructor(r,s){super(r,s),X(this,"establishPromise",void 0)}}let St=(function(t){return t.VIDEO="video",t.AUDIO="audio",t})({}),co=(function(t){return t.UDP_RELAY="udp_relay",t.UDP_TCP_RELAY="udp_tcp_relay",t.TCP_RELAY="tcp_relay",t.RELAY="relay",t})({}),Tf=(function(t){return t[t.FIRST_CONNECTION=0]="FIRST_CONNECTION",t[t.UDP_TCP_RESTART=1]="UDP_TCP_RESTART",t[t.RELAY_RESTART=2]="RELAY_RESTART",t[t.TCP_RESTART=3]="TCP_RESTART",t[t.OLD_FIRST_CONNECTION=10]="OLD_FIRST_CONNECTION",t[t.OLD_RESTART=11]="OLD_RESTART",t[t.DISCONNECTED_OR_FAILED=20]="DISCONNECTED_OR_FAILED",t})({});const E7=["disconnected","failed"];let Xe=(function(t){return t.LocalVideoTrack="videoTrack",t.LocalAudioTrack="audioTrack",t.LocalVideoLowTrack="videoLowTrack",t})({}),ar=(function(t){return t.New="new",t.Connected="connected",t.Reconnecting="reconnecting",t.Disconnected="disconnected",t})({}),Mt=(function(t){return t.AudioMetadata="audioMetadata",t.AudioPts="audioPts",t.StateChange="stateChange",t.IceConnectionStateChange="iceConnectionStateChange",t.RequestMuteLocal="requestMuteLocal",t.RequestUnmuteLocal="requestUnmuteLocal",t.RequestRePublish="requestRePublish",t.RequestRePublishDataChannel="requestRePublishDataChannel",t.RequestReSubscribe="requestReSubscribe",t.RequestUploadStats="requestUploadStats",t.RequestUpload="requestUpload",t.MediaReconnectStart="MediaReconnectStart",t.MediaReconnectEnd="MediaReconnectEnd",t.NeedSignalRTT="NeedSignalRTT",t.RequestRestartICE="RequestRestartIce",t.PeerConnectionStateChange="PeerConnectionStateChange",t.RequestReconnect="RequestReconnect",t.RequestReconnectPC="RequestReconnectPC",t.RequestUnpublishForReconnectPC="RequestUnpublishForReconnectPC",t.P2PLost="P2PLost",t.UpdateVideoEncoder="UpdateVideoEncoder",t.ConnectionTypeChange="ConnectionTypeChange",t.RequestLowStreamParameter="RequestLowStreamParameter",t.QueryClientConnectionState="QueryClientConnectionState",t.LocalCandidate="LocalCandidate",t.RequestP2PMuteLocal="requestP2PMuteLocal",t.RequestP2PUnPublish="RequestP2PUnPublish",t.RequestP2PUnmuteRemote="RequestP2PUnmuteRemote",t.RequestP2PMuteRemote="RequestP2PMuteRemote",t.RequestP2PRestartICE="RequestP2PRestartICE",t})({}),Xu=(function(t){return t.CONNECTING="CONNECTING",t.RECONNECTING="RECONNECTING",t.CONNECTED="CONNECTED",t.CLOSED="CLOSED",t})({}),Ju=(function(t){return t[t.CONNECT_AP=0]="CONNECT_AP",t[t.AP_CONNECTED=1]="AP_CONNECTED",t[t.CONNECT_WORKER_MANAGER=2]="CONNECT_WORKER_MANAGER",t[t.WORKER_MANAGER_CONNECTED=3]="WORKER_MANAGER_CONNECTED",t[t.GET_WORKER_MANAGER_RESPONSE=4]="GET_WORKER_MANAGER_RESPONSE",t[t.CONNECT_WORKER=5]="CONNECT_WORKER",t[t.WORKER_CONNECTED=6]="WORKER_CONNECTED",t[t.CLOSED=7]="CLOSED",t})({}),fs=(function(t){return t.CONNECTION_STATE_CHANGE="connection-state-change",t.STATE_CHANGE="state-change",t.INSPECT_RESULT="inspect-result",t.CLIENT_LOCAL_VIDEO_TRACK="client-local-video-track",t.REQUEST_NEW_WORKER_URL="request-new-worker-url",t})({}),v7=(function(t){return t.CONNECTED="transmitter:connected",t.RECONNECTING="transmitter:reconnecting",t.WILL_RECONNECT="transmitter:will_reconnect",t.CLOSED="transmitter:closed",t.FAILED="transmitter:failed",t.ON_MESSAGE="transmitter:on_message",t.REQUEST_NEW_URLS="transmitter:request_new_urls",t.RECONNECT_CREATE_CONNECTION="transmitter:reconnect_create_connection",t.ON_TOKEN_PRIVILEGE_DID_EXPIRE="transmitter:on_token_privilege_did_expire",t.TO_CONNECT_DATACHANNEL="transmitter:to_connect_datachannel",t.FAILBACK="transmitter:failback",t.PRE_CONNECT_PC="transmitter:pre_connect_pc",t})({}),up=(function(t){return t.CAMERA_CHANGED="camera-changed",t.MICROPHONE_CHANGED="microphone-changed",t.PLAYBACK_DEVICE_CHANGED="playback-device-changed",t.AUDIO_AUTOPLAY_FAILED="audio-autoplay-failed",t.AUTOPLAY_FAILED="autoplay-failed",t.AUDIO_CONTEXT_STATE_CHANGED="audio-context-state-changed",t.SECURITY_POLICY_VIOLATION="security-policy-violation",t})({}),ru=(function(t){return t.CONNECTING="CONNECTING",t.RECONNECTING="RECONNECTING",t.CONNECTED="CONNECTED",t.CLOSED="CLOSED",t})({}),eh=(function(t){return t.CONNECTION_STATE_CHANGE="connection-state-change",t.STATE_CHANGE="state-change",t.INSPECT_RESULT="inspect-result",t.CLIENT_LOCAL_VIDEO_TRACK="client-local-video-track",t.REQUEST_NEW_WORKER_URL="request-new-worker-url",t})({}),E0=(function(t){return t[t.CONNECT_AP=0]="CONNECT_AP",t[t.AP_CONNECTED=1]="AP_CONNECTED",t[t.CONNECT_WORKER_MANAGER=2]="CONNECT_WORKER_MANAGER",t[t.WORKER_MANAGER_CONNECTED=3]="WORKER_MANAGER_CONNECTED",t[t.GET_WORKER_MANAGER_RESPONSE=4]="GET_WORKER_MANAGER_RESPONSE",t[t.CONNECT_WORKER=5]="CONNECT_WORKER",t[t.WORKER_CONNECTED=6]="WORKER_CONNECTED",t[t.CLOSED=7]="CLOSED",t})({}),bi=(function(t){return t.CALL="call",t.CANDIDATE="candidate",t.PUBLISH="publish",t.UNPUBLISH="unpublish",t.CONTROL="control",t.RESTART_ICE="restart_ice",t.ACK="ack",t.RESPONSE="response",t.JOIN="join",t.CHECK="check",t})({}),v0=(function(t){return t.ABORT="abort",t})({}),ng=(function(t){return t.MUTE_LOCAL_AUDIO="mute_local_audio",t.MUTE_LOCAL_VIDEO="mute_local_video",t.UNMUTE_LOCAL_AUDIO="unmute_local_audio",t.UNMUTE_LOCAL_VIDEO="unmute_local_video",t})({}),o_e=(function(t){return t.P2P_TOKEN_TIMEOUT="p2p_token_timeout",t.P2P_TOKEN_CHANGED="p2p_token_changed",t})({});const a_e={[X1.ACCESS_POINT]:{[pa.NO_FLAG_SET]:{desc:"flag is zero",retry:!1},[pa.FLAG_SET_BUT_EMPTY]:{desc:"flag is empty",retry:!1},[pa.INVALID_FALG_SET]:{desc:"invalid flag",retry:!1},[pa.FLAG_SET_BUT_NO_RE]:{desc:"flag set unilbs but no request",retry:!1},[pa.INVALID_SERVICE_ID]:{desc:"invalid service id",retry:!1},[pa.NO_SERVICE_AVAILABLE]:{desc:"no service available",retry:!0},[pa.NO_SERVICE_AVAILABLE_P2P]:{desc:"no unilbs p2p service available",retry:!0},[pa.NO_SERVICE_AVAILABLE_VOICE]:{desc:"no unilbs voice service available",retry:!0},[pa.NO_SERVICE_AVAILABLE_WEBRTC]:{desc:"no unilbs webrtc service available",retry:!0},[pa.NO_SERVICE_AVAILABLE_CDS]:{desc:"no cds service available",retry:!0},[pa.NO_SERVICE_AVAILABLE_CDN]:{desc:"no cdn dispatcher service available",retry:!0},[pa.NO_SERVICE_AVAILABLE_TDS]:{desc:"no tds service available",retry:!0},[pa.NO_SERVICE_AVAILABLE_REPORT]:{desc:"no unilbs report service available",retry:!0},[pa.NO_SERVICE_AVAILABLE_APP_CENTER]:{desc:"no app center service available",retry:!0},[pa.NO_SERVICE_AVAILABLE_ENV0]:{desc:"no unilbs sig env0 service available",retry:!0},[pa.NO_SERVICE_AVAILABLE_VOET]:{desc:"no unilbs voet service available",retry:!0},[pa.NO_SERVICE_AVAILABLE_STRING_UID]:{desc:"no string uid service available",retry:!0},[pa.NO_SERVICE_AVAILABLE_WEBRTC_UNILBS]:{desc:"no webrtc unilbs service available",retry:!0}},[X1.UNILBS]:{[Yu.INVALID_VENDOR_KEY]:{desc:"invalid vendor key, can not find appid",retry:!1},[Yu.INVALID_CHANNEL_NAME]:{desc:"invalid channel name",retry:!1},[Yu.INTERNAL_ERROR]:{desc:"unilbs internal error",retry:!1},[Yu.NO_AUTHORIZED]:{desc:"invalid token, authorized failed",retry:!1},[Yu.DYNAMIC_KEY_TIMEOUT]:{desc:"dynamic key or token timeout",retry:!1},[Yu.NO_ACTIVE_STATUS]:{desc:"no active status",retry:!1},[Yu.DYNAMIC_KEY_EXPIRED]:{desc:"dynamic key expired",retry:!1},[Yu.STATIC_USE_DYNAMIC_KEY]:{desc:"static use dynamic key",retry:!1},[Yu.DYNAMIC_USE_STATIC_KEY]:{desc:"dynamic use static key",retry:!1},[Yu.USER_OVERLOAD]:{desc:"amount of users over load",retry:!1},[Yu.FORBIDDEN_REGION]:{desc:"the request is forbidden in this area",retry:!1},[Yu.CANNOT_MEET_AREA_DEMAND]:{desc:"unable to allocate services in this area",retry:!1}},[X1.STRING_UID_ALLOCATOR]:{[F2.IIIEGAL_APPID]:{desc:"invalid appid",retry:!1},[F2.IIIEGAL_UID]:{desc:"invalid string uid",retry:!1},[F2.INTERNAL_ERROR]:{desc:"string uid allocator internal error",retry:!0}}};function S0(t){const r=a_e[Math.floor(t/1e4)];if(!r)return{desc:"unknown error",retry:!1};const s=r[t%1e4];if(!s){if(Math.floor(t/1e4)===X1.ACCESS_POINT){const a=t%1e4;if(a.toString()[0]==="1")return{desc:t.toString(),retry:!1};if(a.toString()[0]==="2")return{desc:t.toString(),retry:!0}}return{desc:"unknown error",retry:!1}}return s}const c_e={[Bt.K_TIMESTAMP_EXPIRED]:{desc:"K_TIMESTAMP_EXPIRED",action:"failed"},[Bt.K_CHANNEL_PERMISSION_INVALID]:{desc:"K_CHANNEL_PERMISSION_INVALID",action:"failed"},[Bt.K_CERTIFICATE_INVALID]:{desc:"K_CERTIFICATE_INVALID",action:"failed"},[Bt.K_CHANNEL_NAME_EMPTY]:{desc:"K_CHANNEL_NAME_EMPTY",action:"failed"},[Bt.K_CHANNEL_NOT_FOUND]:{desc:"K_CHANNEL_NOT_FOUND",action:"failed"},[Bt.K_TICKET_INVALID]:{desc:"K_TICKET_INVALID",action:"failed"},[Bt.K_CHANNEL_CONFLICTED]:{desc:"K_CHANNEL_CONFLICTED",action:"failed"},[Bt.K_SERVICE_NOT_READY]:{desc:"K_SERVICE_NOT_READY",action:"tryNext"},[Bt.K_SERVICE_TOO_HEAVY]:{desc:"K_SERVICE_TOO_HEAVY",action:"tryNext"},[Bt.K_UID_BANNED]:{desc:"K_UID_BANNED",action:"failed"},[Bt.K_IP_BANNED]:{desc:"K_IP_BANNED",action:"failed"},[Bt.DATASTREAM2_NOT_AVAILABLE]:{desc:"DATASTREAM2_NOT_AVAILABLE",action:"quit"},[Bt.K_AUTO_REBALANCE]:{desc:"k_AUTO_REBALANCE",action:"recover"},[Bt.ERR_INVALID_VENDOR_KEY]:{desc:"ERR_INVALID_VENDOR_KEY",action:"failed"},[Bt.ERR_INVALID_CHANNEL_NAME]:{desc:"ERR_INVALID_CHANNEL_NAME",action:"failed"},[Bt.WARN_NO_AVAILABLE_CHANNEL]:{desc:"WARN_NO_AVAILABLE_CHANNEL",action:"failed"},[Bt.WARN_LOOKUP_CHANNEL_TIMEOUT]:{desc:"WARN_LOOKUP_CHANNEL_TIMEOUT",action:"tryNext"},[Bt.WARN_LOOKUP_CHANNEL_REJECTED]:{desc:"WARN_LOOKUP_CHANNEL_REJECTED",action:"failed"},[Bt.WARN_OPEN_CHANNEL_TIMEOUT]:{desc:"WARN_OPEN_CHANNEL_TIMEOUT",action:"tryNext"},[Bt.WARN_OPEN_CHANNEL_REJECTED]:{desc:"WARN_OPEN_CHANNEL_REJECTED",action:"failed"},[Bt.WARN_REQUEST_DEFERRED]:{desc:"WARN_REQUEST_DEFERRED",action:"failed"},[Bt.ERR_DYNAMIC_KEY_TIMEOUT]:{desc:"ERR_DYNAMIC_KEY_TIMEOUT",action:"failed"},[Bt.ERR_NO_AUTHORIZED]:{desc:"ERR_NO_AUTHORIZED",action:"failed"},[Bt.ERR_VOM_SERVICE_UNAVAILABLE]:{desc:"ERR_VOM_SERVICE_UNAVAILABLE",action:"tryNext"},[Bt.ERR_NO_CHANNEL_AVAILABLE_CODE]:{desc:"ERR_NO_CHANNEL_AVAILABLE_CODE",action:"failed"},[Bt.ERR_MASTER_VOCS_UNAVAILABLE]:{desc:"ERR_MASTER_VOCS_UNAVAILABLE",action:"tryNext"},[Bt.ERR_INTERNAL_ERROR]:{desc:"ERR_INTERNAL_ERROR",action:"tryNext"},[Bt.ERR_NO_ACTIVE_STATUS]:{desc:"ERR_NO_ACTIVE_STATUS",action:"failed"},[Bt.ERR_INVALID_UID]:{desc:"ERR_INVALID_UID",action:"failed"},[Bt.ERR_DYNAMIC_KEY_EXPIRED]:{desc:"ERR_DYNAMIC_KEY_EXPIRED",action:"failed"},[Bt.ERR_STATIC_USE_DYANMIC_KE]:{desc:"ERR_STATIC_USE_DYANMIC_KE",action:"failed"},[Bt.ERR_DYNAMIC_USE_STATIC_KE]:{desc:"ERR_DYNAMIC_USE_STATIC_KE",action:"failed"},[Bt.ERR_NO_VOCS_AVAILABLE]:{desc:"ERR_NO_VOCS_AVAILABLE",action:"tryNext"},[Bt.ERR_NO_VOS_AVAILABLE]:{desc:"ERR_NO_VOS_AVAILABLE",action:"tryNext"},[Bt.ERR_JOIN_CHANNEL_TIMEOUT]:{desc:"ERR_JOIN_CHANNEL_TIMEOUT",action:"tryNext"},[Bt.ERR_JOIN_BY_MULTI_IP]:{desc:"ERR_JOIN_BY_MULTI_IP",action:"recover"},[Bt.ERR_NOT_JOINED]:{desc:"ERR_NOT_JOINED",action:"failed"},[Bt.ERR_REPEAT_JOIN_REQUEST]:{desc:"ERR_REPEAT_JOIN_REQUEST",action:"quit"},[Bt.ERR_REPEAT_JOIN_CHANNEL]:{desc:"ERR_REPEAT_JOIN_CHANNEL",action:"quit"},[Bt.ERR_INVALID_STRINGUID]:{desc:"ERR_INVALID_STRINGUID",action:"failed"},[Bt.ERR_TOO_MANY_USERS]:{desc:"ERR_TOO_MANY_USERS",action:"tryNext"},[Bt.ERR_SET_CLIENT_ROLE_TIMEOUT]:{desc:"ERR_SET_CLIENT_ROLE_TIMEOUT",action:"failed"},[Bt.ERR_SET_CLIENT_ROLE_NO_PERMISSION]:{desc:"ERR_SET_CLIENT_ROLE_TIMEOUT",action:"failed"},[Bt.ERR_SET_CLIENT_ROLE_ALREADY_IN_USE]:{desc:"ERR_SET_CLIENT_ROLE_ALREADY_IN_USE",action:"success"},[Bt.ERR_PUBLISH_REQUEST_INVALID]:{desc:"ERR_PUBLISH_REQUEST_INVALID",action:"failed"},[Bt.ERR_SUBSCRIBE_REQUEST_INVALID]:{desc:"ERR_SUBSCRIBE_REQUEST_INVALID",action:"failed"},[Bt.ERR_NOT_SUPPORTED_MESSAGE]:{desc:"ERR_NOT_SUPPORTED_MESSAGE",action:"failed"},[Bt.ERR_ILLEAGAL_PLUGIN]:{desc:"ERR_ILLEAGAL_PLUGIN",action:"failed"},[Bt.ILLEGAL_CLIENT_ROLE_LEVEL]:{desc:"ILLEGAL_CLIENT_ROLE_LEVEL",action:"failed"},[Bt.ERR_REJOIN_TOKEN_INVALID]:{desc:"ERR_REJOIN_TOKEN_INVALID",action:"failed"},[Bt.ERR_REJOIN_USER_NOT_JOINED]:{desc:"ERR_REJOIN_NOT_JOINED",action:"failed"},[Bt.ERR_INVALID_OPTIONAL_INFO]:{desc:"ERR_INVALID_OPTIONAL_INFO",action:"quit"},[Bt.ERR_TEST_RECOVER]:{desc:"ERR_TEST_RECOVER",action:"recover"},[Bt.ERR_TEST_TRYNEXT]:{desc:"ERR_TEST_TRYNEXT",action:"recover"},[Bt.ERR_TEST_RETRY]:{desc:"ERR_TEST_RETRY",action:"recover"},[Bt.ILLEGAL_AES_PASSWORD]:{desc:"ERR_TEST_RETRY",action:"failed"},[Bt.ERR_TOO_MANY_BROADCASTERS]:{desc:"ERR_TOO_MANY_BROADCASTERS",action:"failed"},[Bt.ERR_TOO_MANY_SUBSCRIBERS]:{desc:"ERR_TOO_MANY_SUBSCRIBERS",action:"failed"},[Bt.ERR_LICENSE_ILLEGAL]:{desc:"ERR_LICENSE_ILLEGAL",action:"quit"},[Bt.ERR_LICENSE_MISSING]:{desc:"ERR_LICENSE_MISSING",action:"quit"},[Bt.ERR_LICENSE_EXPIRED]:{desc:"ERR_LICENSE_EXPIRED",action:"quit"},[Bt.ERR_LICENSE_MINUTES_EXCEEDED]:{desc:"ERR_LICENSE_MINUTES_EXCEEDED",action:"quit"},[Bt.ERR_LICENSE_PERIOD_INVALID]:{desc:"ERR_LICENSE_PERIOD_INVALID",action:"quit"},[Bt.ERR_LICENSE_MULTIPLE_SDK_SERVICE]:{desc:"ERR_LICENSE_MULTIPLE_SDK_SERVICE",action:"quit"}};function ST(t){return c_e[t]||{desc:"UNKNOWN_ERROR_".concat(t),action:"failed"}}function S7(t,r){var s=Object.keys(t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);r&&(a=a.filter((function(c){return Object.getOwnPropertyDescriptor(t,c).enumerable}))),s.push.apply(s,a)}return s}function G2(t){for(var r=1;r<arguments.length;r++){var s=arguments[r]!=null?arguments[r]:{};r%2?S7(Object(s),!0).forEach((function(a){X(t,a,s[a])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(s)):S7(Object(s)).forEach((function(a){Object.defineProperty(t,a,Object.getOwnPropertyDescriptor(s,a))}))}return t}function H2(t,r){if(typeof t=="string")return t;const{proxy:s,host:a,port:c}=t;if(r){const d=oe("JOIN_GATEWAY_FALLBACK_PORT")||443;return d===443?"wss://".concat(a,"/ws/?p=").concat(Number(c)+150):"wss://".concat(a,":").concat(d,"/ws/?p=").concat(Number(c)+150)}return s?"wss://".concat(s,"/ws/?h=").concat(a,"&p=").concat(c):"wss://".concat(a,":").concat(c)}const l_e=/wss:\/\/(.+)\/ws\/\?h=(.+)&p=([0-9]+)\/?/,u_e=/wss:\/\/(.+)\/ws\/\?p=([0-9]+)\/?/,d_e=/wss:\/\/(.+):([0-9]+)\/?/,h_e=/wss:\/\/(.[^\/]+)\/?/;let p_e=0;class f_e{constructor(r,s){X(this,"id",0),X(this,"store",void 0),X(this,"recordIndex",void 0),X(this,"websockets",[]),X(this,"try443PortDuration",2e3),X(this,"forceCloseWSDuration",5e3),X(this,"try443PortTimeout",null),X(this,"forceCloseTimeout",null),X(this,"isTry443PortFailed",!1),X(this,"isNormalPortFailed",!1),X(this,"useDoubleDomain",!1),X(this,"useProxy",!1),X(this,"startTime",Date.now()),this.id=++p_e,this.try443PortDuration=oe("JOIN_GATEWAY_TRY_443PORT_DURATION")||2e3,this.forceCloseWSDuration=r||5e3,this.store=s}closeAllWebsockets(){this.websockets.forEach((r=>{r.onopen=null,r.onclose=null,r.onmessage=null,r.close()})),this.websockets.length=0}clearTimeout(){this.forceCloseTimeout&&clearTimeout(this.forceCloseTimeout),this.try443PortTimeout&&clearTimeout(this.try443PortTimeout),this.forceCloseTimeout=null,this.try443PortTimeout=null}logger(){var r;const s=Date.now()-this.startTime;for(var a=arguments.length,c=new Array(a),d=0;d<a;d++)c[d]=arguments[d];M.debug("[choose-best-ws ".concat((r=this.store)===null||r===void 0?void 0:r.clientId," ").concat(this.id,"] ").concat(s,"ms:"),...c)}createWebSocket(r,s,a){this.logger("createWebSocket:",r,{isTry443Port:s,hasTimeoutDetection:a});const c=oe("GATEWAY_DOMAINS"),d=Date.now(),h=[],m=c.find((A=>{var N;return rt(N=r.host).call(N,A)}));m||(this.useDoubleDomain=!1);const g=[];if(this.useDoubleDomain)c.forEach((A=>{g.push(H2(G2(G2({},r),{},{host:r.host.replace(m,A)}),s))}));else{const A=G2({},r);if(s&&m){const N=c.find((H=>H!==m));N&&(A.host=A.host.replace(m,N))}g.push(H2(A,s))}try{g.forEach((A=>{const N=new WebSocket(A);N.binaryType="arraybuffer",h.push(N),this.logger("ws is connecting:",N.url)}))}catch(A){if(this.logger("ws create failed"),h.forEach((N=>N.close())),h.length=0,this.useDoubleDomain)return this.useDoubleDomain=!1,this.createWebSocket(r,s,a);if(!s&&Number(r.port)!==443)return this.createWebSocket(r,!0,a);throw new ke(te.WS_ERR,"init websocket failed! Error: ".concat(A.toString()))}const v=sT();this.store&&this.store.recordJoinChannelService({urls:h.map((A=>A.url)),service:"gateway"},this.recordIndex),h.forEach((A=>{A.onopen=()=>{this.logger("onopen: ws ".concat(A.url," open cost ").concat(Date.now()-d,"ms")),this.websockets.forEach((N=>{N!==A&&(N.onopen=null,N.onclose=null,N.onmessage=null,N.close(),this.logger("close backup websocket: ".concat(N.url)))})),this.websockets.length=0,v.resolve(A)},A.onclose=N=>{this.logger("onclose: ws ".concat(A.url," closed cost ").concat(Date.now()-d,"ms state: ").concat(A.readyState));const H=h.every((B=>B.readyState===WebSocket.CLOSED||B.readyState===WebSocket.CLOSING));this.logger("".concat(s?"443":"47xx"," websocket closed, all failed: ").concat(H)),H&&(s||this.isTry443PortFailed||this.useProxy)?(this.logger("onclose: all websocket is closed, ".concat(N.reason)),v.reject({code:N.code,reason:Z1.A_ROUND_WS_FAILED})):!s&&H&&!this.isNormalPortFailed&&this.try443PortTimeout&&(this.logger("all 47xx websocket is closed, try 443 port"),this.clearTimeout(),I()),s?this.isTry443PortFailed=H:this.isNormalPortFailed=H},A.onmessage=N=>this.logger("".concat(A.url," onmessage: ").concat(N.data))})),this.websockets.push(...h);const w=()=>{this.websockets.forEach((A=>A.readyState!==WebSocket.OPEN&&A.close()))},I=()=>{if(v.isResolved)return w();Mn().os===os.MAC_OS&&ii()&&w(),this.createWebSocket(r,!0,!0).then((A=>{v.resolve(A)})).catch((A=>{this.isNormalPortFailed&&v.reject(A),this.logger("try 443 port to create ws failed")})),this.forceCloseTimeout=window.setTimeout((()=>{this.logger("5s timeout close un-opens, isWebsocket created: ",v.isResolved),this.forceCloseTimeout=null,w()}),this.forceCloseWSDuration)};return a||(()=>{if(s||this.useProxy)return this.logger("add 5s timeout at ".concat(s?"try-443":"proxy"," condition")),this.forceCloseTimeout=window.setTimeout((()=>{this.forceCloseTimeout=null,w()}),this.forceCloseWSDuration);this.try443PortTimeout=window.setTimeout((()=>{this.logger("2s timeout, isWebsocket created: ",v.isResolved),this.try443PortTimeout=null,I()}),this.try443PortDuration)})(),v.promise}chooseBestWebsocket(r,s,a,c){return this.useDoubleDomain=!!s,typeof r=="string"&&(r=(function(d){let h,m,g;return[,h,m,g]=d.match(l_e)||[],h||([,m,g]=d.match(u_e)||[]),m&&g||([,m,g]=d.match(d_e)||[]),m&&g||([,m]=d.match(h_e)||[]),m||M.warning("un-destructible url: ",d),{proxy:h,host:m,port:g||"443"}})(r)),this.recordIndex=c,this.useProxy=!!r.proxy,a&&this.useProxy&&(M.warn("cannot use 443 only when use proxy"),a=!1),this.createWebSocket(r,!!a,!1).finally((()=>this.clearTimeout()))}}function b7(t,r){var s=Object.keys(t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);r&&(a=a.filter((function(c){return Object.getOwnPropertyDescriptor(t,c).enumerable}))),s.push.apply(s,a)}return s}class w7 extends Zr{get url(){return this.websocket&&this.websocket.url||this._websocketUrl}get reconnectMode(){return this._reconnectMode}set reconnectMode(r){var s;rt(s=["tryNext","recover"]).call(s,r)&&this.resetReconnectCount(r),this._reconnectMode=r}get state(){return this._state}set state(r){r!==this._state&&(this._state=r,this._state==="reconnecting"?this.emit(pn.RECONNECTING,this.reconnectReason):this._state==="connected"?this.emit(pn.CONNECTED):this._state==="closed"?this.emit(pn.CLOSED):this._state==="failed"&&this.emit(pn.FAILED))}resetReconnectCount(r){M.debug("websocket reset reconnect count, reason: "+r),this.reconnectCount=0}constructor(r,s){let a=arguments.length>2&&arguments[2]!==void 0&&arguments[2],c=arguments.length>3&&arguments[3]!==void 0&&arguments[3],d=arguments.length>4&&arguments[4]!==void 0&&arguments[4],h=arguments.length>5?arguments[5]:void 0;super(),X(this,"_websocketUrl",null),X(this,"connectionID",0),X(this,"currentURLIndex",0),X(this,"urls",[]),X(this,"_reconnectMode","tryNext"),X(this,"reconnectReason",void 0),X(this,"_initMutex",void 0),X(this,"name",void 0),X(this,"_state","closed"),X(this,"reconnectInterrupter",void 0),X(this,"websocket",void 0),X(this,"retryConfig",void 0),X(this,"reconnectCount",0),X(this,"forceCloseTimeout",5e3),X(this,"onlineReconnectListener",void 0),X(this,"useCompress",void 0),X(this,"tryDoubleDomain",!1),X(this,"use443PortOnly",!1),X(this,"wsInflateLength",0),X(this,"wsDeflateLength",0),X(this,"closeEstablishingWs",(()=>{})),X(this,"store",void 0),X(this,"joinGatewayRecordIndex",void 0),this.store=h,this.name=r,this.retryConfig=(function(I){for(var A=1;A<arguments.length;A++){var N=arguments[A]!=null?arguments[A]:{};A%2?b7(Object(N),!0).forEach((function(H){X(I,H,N[H])})):Object.getOwnPropertyDescriptors?Object.defineProperties(I,Object.getOwnPropertyDescriptors(N)):b7(Object(N)).forEach((function(H){Object.defineProperty(I,H,Object.getOwnPropertyDescriptor(N,H))}))}return I})({},s),this.useCompress=a,this.tryDoubleDomain=c,this.use443PortOnly=d,this._initMutex=new so("websocket",h?h.clientId:void 0);const{timeout:m,timeoutFactor:g}=s,v=Math.max(300,Math.floor(3*m/5)),w=Math.max(1.2,Math.floor(8*g)/10);Nc.ONLINE&&(this.retryConfig.timeout=v,this.retryConfig.timeoutFactor=w),Ai.on(e0.NETWORK_STATE_CHANGE,((I,A)=>{I!==A&&(this.resetReconnectCount("network state change: ".concat(A," -> ").concat(I)),I===Nc.ONLINE?(this.retryConfig.timeout=v,this.retryConfig.timeoutFactor=w):(this.retryConfig.timeout=m,this.retryConfig.timeoutFactor=g))}))}getConnection(){return this.websocket||void 0}async init(r){let s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:5e3;const a=await this._initMutex.lock();this._reconnectMode="tryNext",this.forceCloseTimeout=s,this.urls=r,this.state="connecting";try{var c;const d=sT(),h=this.urls[this.currentURLIndex];(c=this.store)===null||c===void 0||c.beforeConnect(),(function(m){return!(D1()||oe("USE_NEW_TOKEN")||!oe("ENABLE_PREALLOC_PC")&&(m==null||!m.autoSubscribe||oe("FORCE_DISABLE_AUTO_SUB")))})(this.store)&&this.emit(v7.PRE_CONNECT_PC),this.createWebSocketConnection(h).then(d.resolve).catch(d.reject),this.once(pn.CLOSED,(()=>{d.reject(new Le(te.WS_DISCONNECT))})),this.once(pn.CONNECTED,d.resolve),await d.promise}catch{}finally{a()}}close(r,s){if(this.currentURLIndex=0,this.resetReconnectCount("close"),this.reconnectInterrupter&&this.reconnectInterrupter(),this.websocket){this.websocket.onclose=null,this.websocket.onopen=null,this.websocket.onmessage=null;const a=this.websocket;s?setTimeout((()=>a.close()),500):a.close(),this.websocket=void 0,this._websocketUrl=null}this.state=r?"failed":"closed",this.closeEstablishingWs&&this.closeEstablishingWs()}reconnect(r,s){if(!this.websocket)return void M.warning("[".concat(this.name,"] can not reconnect, no websocket"));r!==void 0&&(this.reconnectMode=r),M.debug("[".concat(this.name,"] reconnect is triggered initiative")),typeof this.joinGatewayRecordIndex=="number"&&this.store&&this.store.recordJoinChannelService({status:"error",errors:[new Error(s)]},this.joinGatewayRecordIndex);const a=this.websocket.onclose;this.websocket.onclose=null,this.websocket.close(),a&&a.bind(this.websocket)({code:9999,reason:s})}sendMessage(r){let s=arguments.length>2&&arguments[2]!==void 0&&arguments[2];if(!this.websocket||this.websocket.readyState!==WebSocket.OPEN)throw new Le(te.WS_ABORT,"websocket is not ready");try{s||(r=JSON.stringify(r)),this.websocket.send(r)}catch(a){throw new Le(te.WS_ERR,"send websocket message error"+a.toString())}}setWsInflateData(r){this.wsDeflateLength=this.wsDeflateLength+r.originLength,this.wsInflateLength=this.wsInflateLength+r.compressedLength}getWsInflateData(){const r=this.wsInflateLength,s=this.wsDeflateLength;return this.clearWsInflateData(),{wsInflateLength:r,wsDeflateLength:s}}clearWsInflateData(){this.wsInflateLength=0,this.wsDeflateLength=0}async createWebSocketConnection(r){var s;const a=sT();this.connectionID+=1,this.joinGatewayRecordIndex=void 0;const c=w=>{var I;(I=this.store)===null||I===void 0||I.signalChannelOpen(),M.debug("[".concat(this.name,"] websocket opened:"),w),this.reconnectMode="retry",this.state="connected",this.resetReconnectCount("opened"),a.resolve()},d=async w=>{var I;if(M.debug("[".concat(this.name,"] websocket close ").concat((I=this.websocket)===null||I===void 0?void 0:I.url,", code: ").concat(w.code,", reason: ").concat(w.reason,", current mode: ").concat(this.reconnectMode)),this.reconnectCount>=this.retryConfig.maxRetryCount)a.reject(new Le(te.WS_DISCONNECT,"websocket close: ".concat(w.code))),this.close();else{this.state==="connected"&&(this.reconnectReason=w.reason,this.state="reconnecting");const A=al(this,pn.WILL_RECONNECT,this.reconnectMode,w.reason)||this.reconnectMode,N=await this.reconnectWithAction(A);if(this.state==="closed")return void M.debug("[".concat(this.connectionID,"] ws is closed, no need to reconnect"));if(!N)return a.reject(new Le(te.WS_DISCONNECT,"websocket reconnect failed: ".concat(w.code))),this.close(!0);a.resolve()}},h=w=>{this.emit(pn.ON_MESSAGE,w)},m=w=>{M.warn("[".concat(this.connectionID,"] ws open error ").concat(w))};this.websocket&&(this.websocket.onclose=null,this.websocket.close()),oe("GATEWAY_WSS_ADDRESS")&&this.name.startsWith("gateway")&&(r=oe("GATEWAY_WSS_ADDRESS")),M.debug("[".concat(this.name,"] start connect, url:"),r);const g=(s=this.store)===null||s===void 0?void 0:s.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"gateway"});try{var v;this._websocketUrl=H2(r);const w=await this.chooseBestWebsocketConnection(r);this.websocket=w,c&&c(this.websocket.url),this.websocket.onclose=d,this.websocket.onmessage=h,this.websocket.onerror=m,(v=this.store)===null||v===void 0||v.recordJoinChannelService({endTs:Date.now(),status:"success"},g),this.joinGatewayRecordIndex=g}catch(w){const I=this.state==="closed",A=w instanceof Le,N=A&&w.code===te.WS_ABORT,H=A&&w.code===te.WS_ERR,B=A?w.message:w&&(w.reason||w.toString());M.warning("[choose-best-ws] chooseBestWebsocket error: ".concat(B)),this.store&&this.store.recordJoinChannelService({endTs:Date.now(),status:N?"aborted":"error",errors:[w]},g),I||H?(a.reject(I?new Le(te.WS_DISCONNECT,"websocket is closed: ".concat(B)):new Le(te.WS_ERR,"init websocket failed: ".concat(B))),H&&M.error("[".concat(this.name,"] init websocket failed: ").concat(B))):d&&d(w)}return a.promise}async reconnectWithAction(r){let s=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1];if(this.reconnectCount>=this.retryConfig.maxRetryCount||this.urls.length===0||this.state==="closed")return!1;M.warning("[choose-best-ws] action: =>",r),this.onlineReconnectListener||Ai.isOnline||!Ai.onlineWaiter||(this.onlineReconnectListener=Ai.onlineWaiter.then((()=>{this.onlineReconnectListener=void 0})));let a=!0;if(this.reconnectInterrupter=()=>a=!1,s){const h=QL(this.reconnectCount,this.retryConfig);M.debug("[".concat(this.name,"] wait ").concat(h,"ms to reconnect websocket, mode: ").concat(r)),await mt.race([Is(h),this.onlineReconnectListener||new mt((()=>{}))])}if(this._state==="closed"||!a)return!1;this.reconnectCount+=1;const c=async(h,m)=>{this.emit(pn.RECONNECT_CREATE_CONNECTION,m),await this.createWebSocketConnection(h)};try{if(r==="retry")await c(this.urls[this.currentURLIndex],r);else if(r==="tryNext"){if(this.currentURLIndex+=1,this.currentURLIndex>=this.urls.length)return this.reconnectWithAction("recover",!1);M.debug("[".concat(this.name,"] websocket url length: ").concat(this.urls.length," current index: ").concat(this.currentURLIndex)),await c(this.urls[this.currentURLIndex],r)}else r==="recover"&&(M.debug("[".concat(this.name,"] request new urls")),this.resetReconnectCount("recover mode"),this.urls=await zs(this,pn.REQUEST_NEW_URLS),this.currentURLIndex=0,await c(this.urls[this.currentURLIndex],r))}catch(h){var d;M.error("[".concat(this.name,"] reconnect failed ").concat(h&&h.toString()));const m=h==null||(d=h.data)===null||d===void 0?void 0:d.desc;return Array.isArray(m)&&rt(m).call(m,"dynamic key expired")?(this.emit(pn.ON_TOKEN_PRIVILEGE_DID_EXPIRE),!1):this.reconnectWithAction(r,s)}return!0}}class $2 extends w7{constructor(r,s){super(r,s,arguments.length>2&&arguments[2]!==void 0&&arguments[2],arguments.length>3&&arguments[3]!==void 0&&arguments[3],arguments.length>4&&arguments[4]!==void 0&&arguments[4],arguments.length>5?arguments[5]:void 0)}async chooseBestWebsocketConnection(r,s){const a=sT(),c=(function(h,m){return new f_e(h,m)})(this.forceCloseTimeout,this.store);this.closeEstablishingWs=()=>{M.debug("[choose-best-ws] close establishing websockets"),c.closeAllWebsockets(),a.reject(new Le(te.WS_ABORT,"choose best websocket aborted"))};const d=oe("GATEWAY_DOMAINS");return M.debug("[choose-best-ws] currentDomain: ",r,", domains: ",d,"total: ".concat(this.urls.length),"current: ".concat(this.currentURLIndex+1)),c.chooseBestWebsocket(r,this.tryDoubleDomain,this.use443PortOnly,s).then(a.resolve).catch(a.reject),a.promise.finally((()=>{this.closeEstablishingWs=void 0}))}}class bT extends w7{constructor(r,s){super(r,s,arguments.length>2&&arguments[2]!==void 0&&arguments[2],arguments.length>3&&arguments[3]!==void 0&&arguments[3],arguments.length>4&&arguments[4]!==void 0&&arguments[4],arguments.length>5?arguments[5]:void 0)}async chooseBestWebsocketConnection(r,s){return new mt(((a,c)=>{let d=!1;const h=[];this.closeEstablishingWs=()=>{M.debug("[choose-best-ws] close establishing websockets"),h.forEach((H=>{H.onclose=null,H.onopen=null,H.onmessage=null,H.close()})),c(new Le(te.WS_ABORT,"choose best websocket aborted"))};const m=oe("GATEWAY_DOMAINS");let g;const v=r.indexOf("?h="),w=m.find((H=>v!==-1?rt(r).call(r,H,v):rt(r).call(r,H)));M.debug("[choose-best-ws] currentDomain: ",w,", domains: ",m);let I=!this.tryDoubleDomain||!w;if(!I&&w){var A;const H=Date.now();try{m.forEach((B=>{const z=v===-1?r.replace(w,B):r.substr(0,v)+r.substr(v).replace(w,B),ee=new WebSocket(z);ee.binaryType="arraybuffer",h.push(ee),M.debug("[choose-best-ws] ws is connecting:",ee.url)}))}catch{for(M.debug("[choose-best-ws] ws create failed, fallback to single url"),h.forEach((z=>z.close()));h.length;)h.pop();I=!0}(A=this.store)===null||A===void 0||A.recordJoinChannelService({urls:h.map((B=>B.url)),service:"gateway"},s),h.forEach((B=>{B.onopen=()=>{if(d)return;const z=Date.now()-H;M.debug("[choose-best-ws] ws open cost ".concat(z,"ms")),h.filter((ee=>ee!==B)).forEach((ee=>{M.debug("[choose-best-ws]close backup websocket: ".concat(ee.url)),ee.close()})),d=!0,a(B)},B.onclose=z=>{g=z,!d&&(h.find((ee=>!(ee.readyState===WebSocket.CLOSED||ee.readyState===WebSocket.CLOSING)))||(M.debug("[choose-best-ws] all websocket is closed"),d=!0,c(g)))},B.onmessage=z=>{M.debug("[choose-best-ws]".concat(B.url," onmessage: ").concat(z.data))}})),Is(this.forceCloseTimeout).then((()=>{h.forEach((B=>{B.readyState!==WebSocket.OPEN&&B.close()}))}))}if(I){var N;let H;M.debug("[choose-best-ws] use single url: ",r),(N=this.store)===null||N===void 0||N.recordJoinChannelService({urls:[r],service:"gateway"},s);try{H=new WebSocket(r),h.push(H),H.binaryType="arraybuffer"}catch(B){const z=new Le(te.WS_ERR,"init websocket failed! Error: ".concat(B.toString()));return M.error("[".concat(this.name,"]").concat(z)),void c(z)}H.onopen=()=>{a(H)},H.onclose=B=>{c(B)},H.onmessage=B=>{M.debug("[choose-best-ws]".concat(H.url," onmessage: ").concat(B.data))},Is(this.forceCloseTimeout).then((()=>{H&&H.readyState!==WebSocket.OPEN&&H.close()}))}})).then((a=>(this.closeEstablishingWs=void 0,a))).catch((a=>{throw this.closeEstablishingWs=void 0,a}))}}class m_e extends Zr{get connectionState(){return this._connectionState}set connectionState(r){r!==this._connectionState&&(this._connectionState=r,r===Or.CONNECTED?this.emit(tn.WS_CONNECTED):r===Or.RECONNECTING?this.emit(tn.WS_RECONNECTING,this._websocketReconnectReason):r===Or.CLOSED&&this.emit(tn.WS_CLOSED,this._disconnectedReason))}get currentURLIndex(){return this.websocket.currentURLIndex}get url(){return this.websocket&&this.websocket.url||null}get rtt(){return this.rttRolling.mean()}constructor(r,s){super(),X(this,"_disconnectedReason",void 0),X(this,"_websocketReconnectReason",void 0),X(this,"_connectionState",Or.CLOSED),X(this,"reconnectToken",void 0),X(this,"websocket",void 0),X(this,"openConnectionTime",void 0),X(this,"clientId",void 0),X(this,"lastMsgTime",Date.now()),X(this,"uploadCache",[]),X(this,"uploadCacheInterval",void 0),X(this,"rttRolling",new k9(5)),X(this,"pingpongTimer",void 0),X(this,"wsInflateDataTimer",void 0),X(this,"pingpongTimeoutCount",0),X(this,"ortc",void 0),X(this,"joinResponse",void 0),X(this,"multiIpOption",void 0),X(this,"initError",void 0),X(this,"spec",void 0),X(this,"store",void 0),X(this,"onWebsocketMessage",(a=>{if(a.data instanceof ArrayBuffer)return void this.emit(tn.ON_BINARY_DATA,a.data);const c=JSON.parse(a.data);if(this.lastMsgTime=Date.now(),Object.prototype.hasOwnProperty.call(c,"_id")){const d="res-@".concat(c._id);this.emit(d,c._result,c._message)}else if(Object.prototype.hasOwnProperty.call(c,"_type")){if(this.emit(c._type,c._message),c._type===Nn.ON_NOTIFICATION&&this.handleNotification(c._message),c._type===Nn.ON_USER_BANNED)switch(c._message.error_code){case 14:this.close(or.UID_BANNED);break;case 15:this.close(or.IP_BANNED);break;case 16:this.close(or.CHANNEL_BANNED)}if(c._type===Nn.ON_USER_LICENSE_BANNED)switch(c._message.error_code){case Bt.ERR_LICENSE_MISSING:this.close(or.LICENSE_MISSING);break;case Bt.ERR_LICENSE_EXPIRED:this.close(or.LICENSE_EXPIRED);break;case Bt.ERR_LICENSE_MINUTES_EXCEEDED:this.close(or.LICENSE_MINUTES_EXCEEDED);break;case Bt.ERR_LICENSE_PERIOD_INVALID:this.close(or.LICENSE_PERIOD_INVALID);break;case Bt.ERR_LICENSE_MULTIPLE_SDK_SERVICE:this.close(or.LICENSE_MULTIPLE_SDK_SERVICE);break;case Bt.ERR_LICENSE_ILLEGAL:this.close(or.LICENSE_ILLEGAL);break;default:this.close()}}})),this.clientId=r.clientId,this.spec=r,this.store=s,this.websocket=new $2("gateway-".concat(this.clientId),this.spec.retryConfig,!0,oe("JOIN_GATEWAY_USE_DUAL_DOMAIN"),oe("JOIN_GATEWAY_USE_443PORT_ONLY"),s),this.handleWebsocketEvents(),window.addEventListener("offline",(()=>{this.connectionState===Or.CONNECTED&&this.reconnect("retry",Bs.OFFLINE)}))}async request(r,s,a,c){const d=Tr(6,""),h={_id:d,_type:r,_message:s},m=this.websocket.connectionID,g=()=>new mt(((H,B)=>{if(this.connectionState===Or.CONNECTED)return H();const z=()=>{this.off(tn.WS_CLOSED,ee),H()},ee=()=>{this.off(tn.WS_CONNECTED,z),B(new ke(te.WS_ABORT))};this.once(tn.WS_CONNECTED,z),this.once(tn.WS_CLOSED,ee),r!==Qt.PUBLISH&&r!==Qt.PUBLISH_DATASTREAM&&r!==Qt.SUBSCRIBE&&r!==Qt.SUBSCRIBE_DATASTREAM&&r!==Qt.UNSUBSCRIBE&&r!==Qt.UNSUBSCRIBE_DATASTREAM&&r!==Qt.UNPUBLISH&&r!==Qt.UNPUBLISH_DATASTREAM&&r!==Qt.CONTROL&&r!==Qt.RESTART_ICE||this.once(tn.DISCONNECT_P2P,(()=>{B(new ke(te.DISCONNECT_P2P))})),r!==Qt.PUBLISH&&r!==Qt.RESTART_ICE||this.once(tn.ABORT_P2P_EXECUTION,(()=>{B(new ke(te.DISCONNECT_P2P))}))}));if(this.connectionState!==Or.CONNECTING&&this.connectionState!==Or.RECONNECTING||r===Qt.JOIN||r===Qt.REJOIN||await g(),this.websocket.sendMessage(h,!0),c)return;const v=new mt(((H,B)=>{let z=!1;const ee=(ae,ye)=>{z=!0,H({isSuccess:ae==="success",message:ye||{}}),this.off(tn.WS_CLOSED,Z),this.off(tn.WS_RECONNECTING,Z),this.emit(tn.REQUEST_SUCCESS,r,s)};this.once("res-@".concat(d),ee);const Z=()=>{B(new ke(te.WS_ABORT,"type: ".concat(r))),this.off(tn.WS_CLOSED,Z),this.off(tn.WS_RECONNECTING,Z),this.off("res-@".concat(d),ee)};this.once(tn.WS_CLOSED,Z),this.once(tn.WS_RECONNECTING,Z),Is(oe("SIGNAL_REQUEST_TIMEOUT")).then((()=>{this.websocket.connectionID!==m||z||(M.warning("[".concat(this.clientId,"] ws request timeout, type: ").concat(r)),this.emit(tn.REQUEST_TIMEOUT,r,s))}))}));let w=null;try{w=await v}catch(H){if(this.connectionState===Or.CLOSED||r===Qt.LEAVE)throw new ke(te.WS_ABORT);return!this.spec.forceWaitGatewayResponse||a?H.throw():r===Qt.JOIN||r===Qt.REJOIN?null:(await g(),await this.request(r,s))}if(w.isSuccess)return w.message;const I=Number(w.message.error_code||w.message.code),A=ST(I),N=new ke(te.UNEXPECTED_RESPONSE,"".concat(A.desc,": ").concat(w.message.error_str),{code:I,data:w.message,desc:A.desc});return A.action==="success"?w.message:(M.warning("[".concat(this.clientId,"] [").concat(this.websocket.connectionID,"] unexpected response from type ").concat(r,", error_code: ").concat(I,", message: ").concat(A.desc,", action: ").concat(A.action)),I===Bt.ERR_TOO_MANY_BROADCASTERS?((r===Qt.JOIN||r===Qt.REJOIN)&&(this.initError=N,this.close()),N.throw()):A.action==="failed"?N.throw():A.action==="quit"?(this.initError=N,this.close(),N.throw()):(I===Bt.ERR_JOIN_BY_MULTI_IP?(this.multiIpOption=w.message.option,M.warning("[".concat(this.clientId,"] detect multi ip, recover")),this.reconnect("recover",Bs.MULTI_IP)):this.reconnect(A.action,Bs.SERVER_ERROR),r===Qt.JOIN||r===Qt.REJOIN?null:await this.request(r,s)))}waitMessage(r,s){return new mt((a=>{const c=d=>{(!s||s(d))&&(this.off(r,c),a(d))};this.on(r,c)}))}uploadWRTCStats(r){if(!this.store.sessionId)return void M.warn("[".concat(this.clientId,"] no session id when upload wrtc stats"));const s={lts:Date.now(),sid:this.store.sessionId,uid:this.store.intUid,stats:r};this.upload(ET.WRTC_STATS,s)}upload(r,s){const a={_type:r,_message:s};try{this.websocket.sendMessage(a)}catch{const d=oe("MAX_UPLOAD_CACHE")||50;this.uploadCache.push(a),this.uploadCache.length>d&&this.uploadCache.splice(0,1),this.uploadCache.length>0&&!this.uploadCacheInterval&&(this.uploadCacheInterval=window.setInterval((()=>{if(this.connectionState!==Or.CONNECTED)return;const h=this.uploadCache.splice(0,1)[0];this.uploadCache.length===0&&(window.clearInterval(this.uploadCacheInterval),this.uploadCacheInterval=void 0),this.upload(h._type,h._message)}),oe("UPLOAD_CACHE_INTERVAL")||2e3))}}send(r,s){const a={_type:r,_message:s};this.websocket.sendMessage(a)}init(r){return this.initError=void 0,this.multiIpOption=void 0,this.joinResponse=void 0,this.reconnectToken=void 0,this.openConnectionTime=void 0,new mt(((s,a)=>{this.once(tn.WS_CONNECTED,(()=>s(this.joinResponse))),this.once(tn.WS_CLOSED,(c=>a(this.initError||new ke(te.WS_ABORT,c)))),this.connectionState=Or.CONNECTING,this.websocket.init(r).catch(a),this.wsInflateDataTimer&&window.clearInterval(this.wsInflateDataTimer),this.wsInflateDataTimer=window.setInterval((()=>{this.handleWsInflateData()}),2e4)}))}close(r){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.wsInflateDataTimer&&(this.handleWsInflateData(),window.clearInterval(this.wsInflateDataTimer),this.wsInflateDataTimer=void 0),this.reconnectToken=void 0,this.joinResponse=void 0,this._disconnectedReason=r||or.LEAVE,this.connectionState=Or.CLOSED,M.debug("[".concat(this.clientId,"] ")+"will close websocket in signal"),this.websocket.close()}async join(){if(!this.joinResponse){this.emit(tn.ABORT_P2P_EXECUTION),this.store.signalConnected();const r=await zs(this,tn.REQUEST_JOIN_INFO);this.store.joinReq();const s=await this.request(Qt.JOIN,r);if(this.ortc=r==null?void 0:r.ortc,this.store.joinRep(),!s)return this.emit(tn.REPORT_JOIN_GATEWAY,Z1.TIMEOUT,this.url||""),!1;this.joinResponse=s,this.emit(tn.JOIN_RESPONSE,this.joinResponse),this.reconnectToken=this.joinResponse.rejoin_token}return this.connectionState=Or.CONNECTED,this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(this.handlePingPong.bind(this),3e3),!0}async rejoin(){if(!this.reconnectToken)throw new ke(te.UNEXPECTED_ERROR,"can not rejoin, no rejoin token");const r=uT(this,tn.REQUEST_REJOIN_INFO);r.token=this.reconnectToken;const s=await this.request(Qt.REJOIN,r);return!!s&&(this.connectionState=Or.CONNECTED,this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(this.handlePingPong.bind(this),3e3),s.peers&&s.peers.forEach((a=>{this.emit(Nn.ON_USER_ONLINE,{uid:a.uid}),a.audio&&this.emit(Nn.ON_ADD_AUDIO_STREAM,{uid:a.uid,uint_id:a.uint_id,audio:!0,ssrcId:a.audio_ssrc}),a.video&&this.emit(Nn.ON_ADD_VIDEO_STREAM,{uid:a.uid,uint_id:a.uint_id,video:!0,ssrcId:a.video_ssrc}),a.audio_mute?this.emit(Nn.MUTE_AUDIO,{uid:a.uid}):this.emit(Nn.UNMUTE_AUDIO,{uid:a.uid}),a.video_mute?this.emit(Nn.MUTE_VIDEO,{uid:a.uid}):this.emit(Nn.UNMUTE_VIDEO,{uid:a.uid}),a.audio_enable_local?this.emit(Nn.ENABLE_LOCAL_AUDIO,{uid:a.uid}):this.emit(Nn.DISABLE_LOCAL_AUDIO,{uid:a.uid}),a.video_enable_local?this.emit(Nn.ENABLE_LOCAL_VIDEO,{uid:a.uid}):this.emit(Nn.DISABLE_LOCAL_VIDEO,{uid:a.uid}),a.audio||a.video||this.emit(Nn.ON_REMOVE_STREAM,{uid:a.uid,uint_id:a.uint_id})})),!0)}reconnect(r,s){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.websocket.reconnect(r,s)}async downgradeCodec(r){if(!this.ortc)return!1;const s={downgrade_codec:r,ortc:this.ortc};return!!await this.request(Qt.DOWNGRADE_CODEC,s)}handleNotification(r){M.debug("[".concat(this.clientId,"] receive notification: "),r);const s=ST(r.code);if(r.code===28&&"detail"in r&&(M.info("[".concat(this.clientId,"] receive recover notification: "),r.detail),this.emit(tn.RECOVER_NOTIFICATION,r.detail)),s.action!=="success"){if(s.action!=="failed")return s.action==="quit"?(s.desc==="ERR_REPEAT_JOIN_CHANNEL"&&this.close(or.UID_BANNED),void this.close()):void this.reconnect(s.action,Bs.SERVER_ERROR);M.error("[".concat(this.clientId,"] ignore error: "),s.desc)}}handlePingPong(){if(!this.websocket||this.websocket.state!=="connected")return;this.pingpongTimeoutCount>0&&this.rttRolling.add(3e3),this.pingpongTimeoutCount+=1;const r=oe("PING_PONG_TIME_OUT"),s=Date.now();this.pingpongTimeoutCount>=r&&(M.warning("[".concat(this.clientId,"] PING-PONG Timeout. Last Socket Message: ").concat(s-this.lastMsgTime,"ms")),s-this.lastMsgTime>oe("WEBSOCKET_TIMEOUT_MIN"))?this.reconnect("retry",Bs.TIMEOUT):this.request(Qt.PING,void 0,!0).then((()=>{this.pingpongTimeoutCount=0;const a=Date.now()-s;this.rttRolling.add(a),oe("REPORT_STATS")&&this.send(Qt.PING_BACK,{pingpongElapse:a})})).catch((a=>{}))}handleWsInflateData(){const{wsInflateLength:r,wsDeflateLength:s}=this.websocket.getWsInflateData();r!==0&&s!==0&&this.upload(ET.WS_INFLATE_DATA_LENGTH,{ws_deflate_length:s,ws_inflate_length:r})}handleWebsocketEvents(){this.websocket.on(pn.RECONNECT_CREATE_CONNECTION,(r=>{this.emit(tn.WS_RECONNECT_CREATE_CONNECTION,r)})),this.websocket.on(pn.ON_MESSAGE,this.onWebsocketMessage),this.websocket.on(pn.CLOSED,(()=>{this.connectionState=Or.CLOSED})),this.websocket.on(pn.FAILED,(()=>{this._disconnectedReason=or.NETWORK_ERROR,this.connectionState=Or.CLOSED})),this.websocket.on(pn.RECONNECTING,(r=>{this._websocketReconnectReason=r,this.joinResponse=void 0,this.connectionState===Or.CONNECTED?this.connectionState=Or.RECONNECTING:this.connectionState=Or.CONNECTING})),this.websocket.on(pn.WILL_RECONNECT,((r,s,a)=>{const c=uT(this,tn.IS_P2P_DISCONNECTED),d=c||r!=="retry";c&&r==="retry"&&(M.debug("".concat(this.clientId," reconnect mode is retry, but p2p lost, change to tryNext")),r="tryNext",s=Z1.P2P_DISCONNECTED),d&&(M.debug("".concat(this.clientId," will renewSession, reconnect mode: ").concat(r)),this.emit(tn.REPORT_JOIN_GATEWAY,s||Z1.UNKNOWN_REASON,this.url||""),this.reconnectToken=void 0,this.emit(tn.DISCONNECT_P2P)),a(r)})),this.websocket.on(pn.CONNECTED,(()=>{this.openConnectionTime=Date.now(),this.reconnectToken?this.rejoin().catch((r=>{M.warning("[".concat(this.clientId,"] rejoin failed ").concat(r)),this.reconnect("tryNext",Bs.SERVER_ERROR)})):this.join().catch((r=>{if(this.emit(tn.REPORT_JOIN_GATEWAY,r,this.url||""),r instanceof ke){if(r.code===te.UNEXPECTED_RESPONSE&&r.data.code===Bt.ERR_NO_AUTHORIZED)return this.initError=new ke(te.TOKEN_EXPIRE,"dynamic key expired"),void this.close(or.TOKEN_EXPIRE);M.error("[".concat(this.clientId,"] join gateway request failed"),r.toString()),this.spec.forceWaitGatewayResponse?this.reconnect("tryNext",Bs.SERVER_ERROR):(this.initError=r,this.close())}}))})),this.websocket.on(pn.REQUEST_NEW_URLS,((r,s)=>{zs(this,tn.REQUEST_RECOVER,this.multiIpOption).then(r).catch(s)})),this.websocket.on(pn.ON_TOKEN_PRIVILEGE_DID_EXPIRE,(()=>{this.emit(Nn.ON_TOKEN_PRIVILEGE_DID_EXPIRE)})),this.websocket.on(v7.PRE_CONNECT_PC,(()=>{this.emit(tn.PRE_CONNECT_PC)}))}}let g_e=(function(t){return t.NATIVE_RTC="native_rtc",t.NATIVE_RTM="native_rtm",t.WEB_RTC="web_rtc",t.WEB_RTM="web_rtm",t})({}),Pi=(function(t){return t[t.CHOOSE_SERVER=11]="CHOOSE_SERVER",t[t.CLOUD_PROXY=18]="CLOUD_PROXY",t[t.CLOUD_PROXY_5=20]="CLOUD_PROXY_5",t[t.CLOUD_PROXY_FALLBACK=26]="CLOUD_PROXY_FALLBACK",t})({});function T7(t,r){var s=Object.keys(t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);r&&(a=a.filter((function(c){return Object.getOwnPropertyDescriptor(t,c).enumerable}))),s.push.apply(s,a)}return s}function tP(t){for(var r=1;r<arguments.length;r++){var s=arguments[r]!=null?arguments[r]:{};r%2?T7(Object(s),!0).forEach((function(a){X(t,a,s[a])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(s)):T7(Object(s)).forEach((function(a){Object.defineProperty(t,a,Object.getOwnPropertyDescriptor(s,a))}))}return t}function rg(t){return t.match(/^[\.\:\d]+$/)?"".concat(t.replace(/[^\d]/g,"-"),".").concat(oe("TURN_DOMAIN")):(M.debug("Cannot recognized as ip address: ".concat(t,", use as host2")),t)}function nP(t){try{const r=oe("GATEWAY_DOMAINS").concat(oe("TURN_DOMAIN")).find((s=>rt(t).call(t,s)));return r?t.split(".".concat(r))[0].replace(/-/g,"."):t}catch{return M.debug("serverUrlToIp error, fallback to url",t),t}}function K2(t,r){t.addresses||(t.addresses=[]);const s=(function(m,g){if(oe("CONNECT_GATEWAY_WITHOUT_DOMAIN"))return m.map((I=>{let{ip:A,port:N}=I;return{address:"".concat(A,":").concat(N)}}));const v=oe("GATEWAY_DOMAINS");let w=v[1]&&rt(g).call(g,v[1])?1:0;return m.map((I=>{let{domain_prefix:A,port:N,ip:H}=I;if(A)return{address:"".concat(A,".").concat(v[w++%v.length],":").concat(N)};const B=/^[\.\:\d]+$/.test(H),z=B?"".concat(H.replace(/[^\d]/g,"-"),".").concat(v[w++%v.length],":").concat(N):"".concat(H,":").concat(N);return B||M.debug("Cannot recognized as ip address: ".concat(H,", use as host3")),{ip:H,port:N,address:z}}))})(t.addresses,r),a=Array.isArray(t.detail)&&t.detail[18];if(a&&typeof a=="string"){const m=a.split(";");for(let g=0;g<m.length;g++){var c;const v=Bo(c=m[g]).call(c);s[g]&&v&&(s[g].ip6=v)}}const d=t.detail&&t.detail.candidate;let h;if(d){const[m,g]=d.split(":");m&&g&&(h={port:Number(g),ip:m,address:"".concat(m,":").concat(g)})}return{gatewayAddrs:s,apGatewayAddress:h,uid:t.uid,cid:t.cid,cert:t.cert,vid:t.detail&&t.detail[8],uni_lbs_ip:t.detail&&t.detail[1],res:t,csIp:t.detail&&t.detail[502]}}function xc(t){return typeof t=="number"?t:t.exact||t.ideal||t.max||t.min||0}function C7(t){const r=t._encoderConfig;if(!r)return{};const s={resolution:r.width&&r.height?"".concat(xc(r.width),"x").concat(xc(r.height)):void 0,maxVideoBW:r.bitrateMax,minVideoBW:r.bitrateMin};return typeof r.frameRate=="number"?(s.maxFrameRate=r.frameRate,s.minFrameRate=r.frameRate):r.frameRate&&(s.maxFrameRate=r.frameRate.max||r.frameRate.ideal||r.frameRate.exact||r.frameRate.min,s.minFrameRate=r.frameRate.min||r.frameRate.ideal||r.frameRate.exact||r.frameRate.max),s}function R7(t){return t>=0&&t<.17?1:t>=.17&&t<.36?2:t>=.36&&t<.59?3:t>=.59&&t<=1?4:t>1?5:0}function wT(t,r){let s,a,c;switch(r){case Pi.CHOOSE_SERVER:a=4096,c="choose server";break;case Pi.CLOUD_PROXY:a=1048576,c="proxy";break;case Pi.CLOUD_PROXY_5:a=4194304,c="proxy5";break;case Pi.CLOUD_PROXY_FALLBACK:a=4194310,c="proxy fallback";break;default:throw new ke(te.UNEXPECTED_ERROR,"multi unlibs response transformer get unknown service id",{csIp:t.detail&&t.detail[502],retry:!1})}if(t.response_body.forEach((d=>{d.buffer&&d.buffer.flag===a&&(s={code:d.buffer.code,addresses:(d.buffer.edges_services||[]).map((h=>tP(tP({},h),{},{ticket:d.buffer.cert}))),server_ts:t.enter_ts,uid:d.buffer.uid,cid:d.buffer.cid,cname:d.buffer.cname,detail:tP(tP({},d.buffer.detail),t.detail),flag:d.buffer.flag,opid:t.opid,cert:d.buffer.cert})})),!s)throw new ke(te.MULTI_UNILBS_RESPONSE_ERROR,"cannot parse response ".concat(c," from multi unilbs response"),{csIp:t.detail&&t.detail[502]});return s}async function I7(t,r){return await mt.all(t.addresses.map((async s=>({address:rg(s.ip),tcpport:s.port,udpport:s.port,username:r&&oe("ENCRYPT_PROXY_USERNAME_AND_PSW")&&window.isSecureContext?r.toString():Ws.username,password:r&&oe("ENCRYPT_PROXY_USERNAME_AND_PSW")&&window.isSecureContext?await qL(r.toString()):Ws.password}))))}function q2(t,r){const s=r.getMediaStreamTrack(!0).getSettings(),a=r.videoHeight||s.height,c=r.videoWidth||s.width;return a&&c?Math.max(Math.min(a,c)/Math.min(xc(t.height),xc(t.width)),1):(M.warning("can't get ori-track's height, default scale down 4 times for low stream"),4)}function ig(t){let{candidateType:r,relayProtocol:s,type:a,address:c,port:d,protocol:h}=t;const m={candidateType:r,relayProtocol:s,protocol:h};if(a!=="local-candidate"){const g=c.split(".");g.length>=4&&(g[1]="*",g[2]="*"),m.address=g.join("."),m.port=d}return m}function fy(t){const r=t.split(":"),s=t.split(/[-.]/),a=rt(t).call(t,"-")?"-":".";let c=t;return r.length>1?s.length>1?(s[1]="**",c=s[0]+a+"**:"+r[r.length-1]):c=r.length>2?r[0]+a+"**:"+r[r.length-1]:"**:"+r[r.length-1]:s.length>1&&(c=s[0]+a+"**"),c}function rP(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:oe("SVC_MODE");if(oe("ENABLE_SVC"))return(function(r){return r in k1})(t)?t:k1.L1T3}const A7={[St.VIDEO]:[{key:"abs-send-time",extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time"},{key:"video-orientation",extensionName:"urn:3gpp:video-orientation"},{key:"draft-holmer-rmcat-transport-wide-cc-extensions-01",extensionName:"http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01"},{key:"playout-delay",extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/playout-delay"},{key:"video-content-type",extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/video-content-type"},{key:"color-space",extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/color-space"},{key:"video-timing",extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/video-timing"}],[St.AUDIO]:[{key:"ssrc-audio-level",extensionName:"urn:ietf:params:rtp-hdrext:ssrc-audio-level"},{key:"draft-holmer-rmcat-transport-wide-cc-extensions-01",extensionName:"http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01"},{key:"abs-send-time",extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time"}]};function iP(t,r,s){r.forEach((a=>{var c;const d=A7[t].find((m=>{var g;let{key:v}=m;return rt(g=a.extensionName).call(g,v)}));if(!d)return;const h=s.find((m=>{let{extensionName:g}=m;return rt(g).call(g,d.key)}));h&&rt(c=h.extensionName).call(c,"gdpr_forbidden")&&(a.extensionName=h.extensionName)}))}function b0(t,r){r.forEach((s=>{var a;const c=A7[t].find((d=>{var h;let{key:m}=d;return rt(h=s.extensionName).call(h,m)}));rt(a=s.extensionName).call(a,"gdpr_forbidden")&&c&&(s.extensionName=c.extensionName)}))}function P7(t){return t==="http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time"||rt(t).call(t,"abs-send-time")}function sP(t){return t==="http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01"||rt(t).call(t,"draft-holmer-rmcat-transport-wide-cc-extensions-01")}function O7(t,r){var s=Object.keys(t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);r&&(a=a.filter((function(c){return Object.getOwnPropertyDescriptor(t,c).enumerable}))),s.push.apply(s,a)}return s}function k7(t){for(var r=1;r<arguments.length;r++){var s=arguments[r]!=null?arguments[r]:{};r%2?O7(Object(s),!0).forEach((function(a){X(t,a,s[a])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(s)):O7(Object(s)).forEach((function(a){Object.defineProperty(t,a,Object.getOwnPropertyDescriptor(s,a))}))}return t}function TT(t){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},s=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},a=arguments.length>3?arguments[3]:void 0;const{filterRTX:c,filterVideoFec:d,filterAudioFec:h,filterAudioCodec:m,filterVideoCodec:g,unsupportedVideoUplinkCodec:v,unsupportedVideoDownlinkCodec:w}=r,{useXR:I}=s;let A=[],N=[],H=[],B=[],z=!1,ee=!1;if(nc(t).mediaDescriptions.forEach((ae=>{a&&a!==ae.attributes.direction||(ae.media.mediaType!=="video"||z||(N=ae.attributes.payloads,B=ae.attributes.extmaps,z=!0),ae.media.mediaType!=="audio"||ee||(A=ae.attributes.payloads,H=ae.attributes.extmaps,ee=!0))})),!B||N.length===0)throw new Error("Cannot get video capabilities from SDP.");if(!H||A.length===0)throw new Error("Cannot get audio capabilities from SDP.");if(N.forEach((ae=>{var ye;(ye=ae.rtpMap)!==null&&ye!==void 0&&ye.clockRate&&(ae.rtpMap.clockRate=parseInt(ae.rtpMap.clockRate)),I&&ae.rtcpFeedbacks.push({type:"rrtr"})})),A.forEach((ae=>{var ye;(ye=ae.rtpMap)!==null&&ye!==void 0&&ye.clockRate&&(ae.rtpMap.clockRate=parseInt(ae.rtpMap.clockRate)),I&&ae.rtcpFeedbacks.push({type:"rrtr"})})),c&&(A=A.filter((ae=>{var ye;return((ye=ae.rtpMap)===null||ye===void 0?void 0:ye.encodingName.toLowerCase())!=="rtx"})),N=N.filter((ae=>{var ye;return((ye=ae.rtpMap)===null||ye===void 0?void 0:ye.encodingName.toLowerCase())!=="rtx"}))),d){const ae=N.filter((ue=>{var Ae;return/(red)|(ulpfec)|(flexfec)/i.test(((Ae=ue.rtpMap)===null||Ae===void 0?void 0:Ae.encodingName)||"")})),ye=og(ae,N).map((ue=>ue.payloadType)),_e=[...ae.map((ue=>ue.payloadType)),...ye];N=N.filter((ue=>!rt(_e).call(_e,ue.payloadType)))}if(h&&(A=A.filter((ae=>{var ye;return!/(red)|(ulpfec)|(flexfec)/i.test(((ye=ae.rtpMap)===null||ye===void 0?void 0:ye.encodingName)||"")}))),m&&(m==null?void 0:m.length)>0&&(A=A.filter((ae=>{var ye;return rt(m).call(m,((ye=ae.rtpMap)===null||ye===void 0?void 0:ye.encodingName.toLowerCase())||"")}))),g&&(g==null?void 0:g.length)>0){const ae=N.filter((ye=>{var _e;return rt(g).call(g,((_e=ye.rtpMap)===null||_e===void 0?void 0:_e.encodingName.toLowerCase())||"")}));N=ae.concat(c?[]:og(ae,N))}const Z=oe("UNSUPPORTED_VIDEO_CODEC");if(Z&&Z.length>0){const ae=N.filter((ue=>ue.rtpMap&&rt(Z).call(Z,ue.rtpMap.encodingName.toLowerCase()))),ye=og(ae,N),_e=ae.concat(ye).map((ue=>ue.payloadType));N=N.filter((ue=>!rt(_e).call(_e,ue.payloadType))),M.debug("unsupportedVideoCodec: ".concat(Z,", toBeRemoved: ").concat(_e))}if(v&&v.length>0&&a==="sendonly"){const ae=N.filter((ue=>ue.rtpMap&&rt(v).call(v,ue.rtpMap.encodingName.toLowerCase()))),ye=og(ae,N),_e=ae.concat(ye).map((ue=>ue.payloadType));N=N.filter((ue=>!rt(_e).call(_e,ue.payloadType))),M.debug("unsupportedVideoUplinkCodec: ".concat(v,", toBeRemoved: ").concat(_e))}if(w&&w.length>0&&a==="recvonly"){const ae=N.filter((ue=>ue.rtpMap&&rt(w).call(w,ue.rtpMap.encodingName.toLowerCase()))),ye=og(ae,N),_e=ae.concat(ye).map((ue=>ue.payloadType));N=N.filter((ue=>!rt(_e).call(_e,ue.payloadType))),M.debug("unsupportedVideoDownlinkCodec: ".concat(w,", toBeRemoved: ").concat(_e))}return{audioCodecs:A,videoCodecs:N,audioExtensions:H,videoExtensions:B}}function sg(t){const r=nc(t);let s,a;for(const c of r.mediaDescriptions){if(!s){const d=c.attributes.iceUfrag,h=c.attributes.icePwd;if(!d||!h)throw new Error("Cannot get iceUfrag or icePwd from SDP.");s={iceUfrag:d,icePwd:h}}if(!a){const d=c.attributes.fingerprints;d.length>0&&(a={fingerprints:d})}}if(!a&&r.attributes.fingerprints.length>0&&(a={fingerprints:r.attributes.fingerprints}),!a||!s)throw new Error("Cannot get iceParameters or dtlsParameters from SDP.");return{iceParameters:s,dtlsParameters:a}}function N7(t,r){const s=[],a=t.attributes.ssrcGroups.filter((h=>h.semantic==="FID")),c=t.attributes.ssrcGroups.find((h=>h.semantic==="SIM")),d=t.attributes.ssrcs;if(c)c.ssrcIds.forEach((h=>{var m;const g=(m=a.find((v=>v.ssrcIds[0]===h)))===null||m===void 0?void 0:m.ssrcIds[1];s.push({ssrcId:h,rtx:r?g:void 0})}));else if(a.length>0){const h=a[0].ssrcIds[0],m=a[0].ssrcIds[1];s.push({ssrcId:h,rtx:r?m:void 0})}else{if(d.length===0)throw new Error("No ssrcs found on local media description.");s.push({ssrcId:d[0].ssrcId})}return s}function x7(t,r,s){const{cname:a}=t;let c=[];r&&(c=D7(r)),c.length===0&&(c=t.iceParameters.candidates.map((w=>({foundation:w.foundation,componentId:"1",transport:w.protocol,priority:w.priority.toString(),connectionAddress:w.ip,port:w.port.toString(),type:w.type,extension:{}}))),M.debug("Using candidates from gateway."));const d={fingerprints:t.dtlsParameters.fingerprints.map((w=>({hashFunction:w.algorithm,fingerprint:w.fingerprint})))},h={iceUfrag:t.iceParameters.iceUfrag,icePwd:t.iceParameters.icePwd};let m;switch(t.dtlsParameters.role){case"server":m="passive";break;case"client":m="active";break;case"auto":m="actpass"}const g=aP(t.rtpCapabilities),v=[];return Array.isArray(s)&&s.length>0&&s.forEach((w=>{v.push({kind:St.VIDEO,ssrcMsg:[{ssrcId:w.v,rtx:w.v_rtx}],mslabel:"".concat(w.v,"_").concat(w.a)},{kind:St.AUDIO,ssrcMsg:[{ssrcId:w.a}],mslabel:"".concat(w.v,"_").concat(w.a)})})),{dtlsParameters:d,iceParameters:h,candidates:c,rtpCapabilities:g,setup:m,cname:a,preSSRCs:v}}function D7(t){let r=[];return t.ip&&typeof t.port=="number"&&(r=[{foundation:"udpcandidate",componentId:"1",transport:"udp",priority:"2103266323",connectionAddress:t.ip,port:t.port.toString(),type:"host",extension:{}}],M.debug("Using remote candidate from AP ".concat(fy(t.ip),":").concat(t.port)),t.ip6&&(r.push({foundation:"udpcandidate",componentId:"1",transport:"udp",priority:"2103266323",connectionAddress:t.ip6,port:t.port.toString(),type:"host",extension:{}}),M.debug("Using IPV6 remote candidate from AP ".concat(fy(t.ip6),":").concat(t.port)))),r}function CT(t,r,s){const a=[],c=[];return t.forEach((d=>{let{ssrcId:h,rtx:m}=d;const g=Tr(8,"track-"),v={ssrcId:h,attributes:k7({label:g,mslabel:s=s||Tr(10,""),msid:"".concat(s," ").concat(g)},r&&{cname:r})};if(a.push(v),m!==void 0){const w={ssrcId:m,attributes:k7({label:g,mslabel:s,msid:"".concat(s," ").concat(g)},r&&{cname:r})};a.push(w),c.push({semantic:"FID",ssrcIds:[h,m]})}})),t.length>1&&c.push({semantic:"SIM",ssrcIds:t.map((d=>{let{ssrcId:h}=d;return h}))}),{ssrcs:a,ssrcGroups:c}}function w0(t,r){r instanceof ui&&t.attributes.payloads.forEach((s=>{var a;const c=(a=s.rtpMap)===null||a===void 0?void 0:a.encodingName.toLowerCase();if(!c||["opus","pcmu","pcma","g722"].indexOf(c)===-1)return;s.fmtp||(s.fmtp={parameters:{}}),c==="opus"&&typeof oe("OPUS_PTIME")=="number"?s.fmtp.parameters.ptime=oe("OPUS_PTIME"):s.fmtp.parameters.minptime="10",s.fmtp.parameters.useinbandfec="1";const d=r._encoderConfig;d&&(c!=="pcmu"&&c!=="pcma"&&c!=="g722"&&(d.bitrate&&!ii()&&(s.fmtp.parameters.maxaveragebitrate="".concat(Math.floor(1e3*d.bitrate))),d.sampleRate&&(s.fmtp.parameters.maxplaybackrate="".concat(d.sampleRate),s.fmtp.parameters["sprop-maxcapturerate"]="".concat(d.sampleRate)),d.stereo&&(s.fmtp.parameters.stereo="1",s.fmtp.parameters["sprop-stereo"]="1")),r instanceof _T&&c==="opus"&&r._config.DTX&&(s.fmtp.parameters.usedtx="1"))}))}function Y2(t){const r=t.attributes.unrecognized.findIndex((s=>s.attField==="x-google-flag"&&s.attValue==="conference"));r!==-1&&t.attributes.unrecognized.splice(r,1)}function X2(t,r){var s;if(!(r instanceof Nr&&r._encoderConfig&&r._hints.indexOf(Sr.SCREEN_TRACK)===-1))return;const a=r._encoderConfig;Wn().supportMinBitrate&&a.bitrateMin&&t.attributes.payloads.forEach((c=>{var d,h;rt(d=["h264","h265","vp8","vp9","av1"]).call(d,((h=c.rtpMap)===null||h===void 0?void 0:h.encodingName.toLowerCase())||"")&&(c.fmtp||(c.fmtp={parameters:{}}),c.fmtp.parameters["x-google-min-bitrate"]="".concat(a.bitrateMin))})),Wn().supportMinBitrate&&!rt(s=r._hints).call(s,Sr.LOW_STREAM)&&a.bitrateMax&&t.attributes.payloads.forEach((c=>{var d,h;rt(d=["h264","h265","vp8","vp9","av1"]).call(d,((h=c.rtpMap)===null||h===void 0?void 0:h.encodingName.toLowerCase())||"")&&(c.fmtp||(c.fmtp={parameters:{}}),c.fmtp.parameters["x-google-start-bitrate"]="".concat(oe("X_GOOGLE_START_BITRATE")||Math.floor(a.bitrateMax)))}))}function L7(t){if(t.media.mediaType!=="video")return;const r=Mn();if(r.name!==Yn.SAFARI&&r.os!==os.IOS)return;const s=t.attributes.extmaps.findIndex((a=>/video-orientation/g.test(a.extensionName)));s!==-1&&t.attributes.extmaps.splice(s,1)}function oP(t,r,s){if(!r)return;let a,c;if(t.media.mediaType==="video"?(a=s.videoExtensions,c=s.videoCodecs):(a=s.audioExtensions,c=s.audioCodecs),r.twcc===!0){const d=a.find((h=>sP(h.extensionName)));if(d){const h=d.extensionName;t.attributes.extmaps.find((g=>sP(g.extensionName)))||t.attributes.extmaps.push({entry:d.entry,extensionName:h}),(function(g,v){return v.filter((w=>!!g.find((I=>I.payloadType===w.payloadType&&!!I.rtcpFeedbacks.find((A=>A.type==="transport-cc"))))))})(c,t.attributes.payloads).forEach((g=>{g.rtcpFeedbacks.find((v=>v.type==="transport-cc"))||g.rtcpFeedbacks.push({type:"transport-cc"})}))}}else if(r.twcc===!1){const d=t.attributes.extmaps.findIndex((h=>sP(h.extensionName)));d!==-1&&t.attributes.extmaps.splice(d,1),t.attributes.payloads.forEach((h=>{const m=h.rtcpFeedbacks.findIndex((g=>g.type==="transport-cc"));m!==-1&&h.rtcpFeedbacks.splice(m,1)}))}if(r.remb===!0){const d=a.find((h=>P7(h.extensionName)));if(d){const h=d.extensionName;t.attributes.extmaps.find((g=>g.extensionName===h))||t.attributes.extmaps.push({entry:d.entry,extensionName:h}),(function(g,v){return v.filter((w=>!!g.find((I=>I.payloadType===w.payloadType&&!!I.rtcpFeedbacks.find((A=>A.type==="goog-remb"))))))})(c,t.attributes.payloads).forEach((g=>{g.rtcpFeedbacks.find((v=>v.type==="goog-remb"))||g.rtcpFeedbacks.push({type:"goog-remb"})}))}}else if(r.remb===!1){const d=t.attributes.extmaps.findIndex((h=>P7(h.extensionName)));d!==-1&&t.attributes.extmaps.splice(d,1),t.attributes.payloads.forEach((h=>{const m=h.rtcpFeedbacks.findIndex((g=>g.type==="goog-remb"));m!==-1&&h.rtcpFeedbacks.splice(m,1)}))}}function M7(t,r,s){if(ii()||t.media.mediaType!=="video"||!(r instanceof Nr)||s!=="vp9"&&s!=="vp8"||s==="vp8"&&!oe("SIMULCAST")||s==="vp9"&&oe("ENABLE_SVC")||r._scalabilityMode===void 0||r._scalabilityMode.numSpatialLayers<=1)return;const a=s==="vp8"?2:r._scalabilityMode.numSpatialLayers,c=t.attributes.ssrcs[0],d=t.attributes.ssrcGroups.find((m=>m.semantic==="FID"&&m.ssrcIds[0]===c.ssrcId)),h={semantic:"SIM",ssrcIds:[c.ssrcId]};for(let m=1;m<a;m++)t.attributes.ssrcs.push({ssrcId:c.ssrcId+m,attributes:Kr(c.attributes)}),h.ssrcIds.push(c.ssrcId+m),d&&(t.attributes.ssrcs.push({ssrcId:d.ssrcIds[1]+m,attributes:Kr(c.attributes)}),t.attributes.ssrcGroups.push({semantic:"FID",ssrcIds:[c.ssrcId+m,d.ssrcIds[1]+m]}));t.attributes.ssrcGroups.unshift(h)}async function U7(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const s=new RTCPeerConnection;s.addTransceiver("video",{direction:"sendonly"}),s.addTransceiver("audio",{direction:"sendonly"}),s.addTransceiver("video",{direction:"recvonly"}),s.addTransceiver("audio",{direction:"recvonly"});const a=(await s.createOffer()).sdp,{send:c,recv:d,sendrecv:h}=(function(){let m=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},g=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},v=arguments.length>2?arguments[2]:void 0;const w=TT(v,m,g,"sendonly"),I=TT(v,m,g,"recvonly"),A={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},N={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},H={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]};if(Qu(w,I,"videoExtensions",A,N,H),Qu(w,I,"videoCodecs",A,N,H),Qu(w,I,"audioExtensions",A,N,H),Qu(w,I,"audioCodecs",A,N,H),oe("RAISE_H264_BASELINE_PRIORITY")){const B=[],z=[];if(H.videoCodecs.forEach(((ee,Z)=>{var ae;if(((ae=ee.rtpMap)===null||ae===void 0?void 0:ae.encodingName.toLocaleLowerCase())==="h264"){var ye,_e;const ue=H.videoCodecs[Z+1],Ae=ue&&z7(ee,ue),Ue=(ye=ee.fmtp)===null||ye===void 0?void 0:ye.parameters["profile-level-id"],We=(_e=ee.fmtp)===null||_e===void 0?void 0:_e.parameters["packetization-mode"];!Ue||Ue!==oe("FIRST_H264_PROFILE_LEVEL_ID")||oe("FIRST_PACKETIZATION_MODE")&&We!==oe("FIRST_PACKETIZATION_MODE")?Ae?z.push([ee,ue]):z.push([ee]):Ae?B.push([ee,ue]):B.push([ee])}})),B.length>0&&z.length>0){M.debug("raising H264 baseline profile priority"),H.videoCodecs.forEach(((Z,ae)=>{var ye;if(((ye=Z.rtpMap)===null||ye===void 0?void 0:ye.encodingName.toLocaleLowerCase())==="h264"){const _e=z7(Z,H.videoCodecs[ae+1]),ue=B.shift()||z.shift()||[];ue.length>0&&(_e?H.videoCodecs.splice(ae,2,...ue):H.videoCodecs.splice(ae,1,...ue))}}));const ee=N.videoCodecs.filter((Z=>{var ae,ye;return((ae=Z.rtpMap)===null||ae===void 0?void 0:ae.encodingName.toLocaleLowerCase())==="h264"&&((ye=Z.fmtp)===null||ye===void 0?void 0:ye.parameters["profile-level-id"])!==oe("FIRST_H264_PROFILE_LEVEL_ID")}));if(ee.length>0){const Z=og(ee,N.videoCodecs).map((ye=>ye.payloadType)),ae=[...ee.map((ye=>ye.payloadType)),...Z];N.videoCodecs=N.videoCodecs.filter((ye=>!rt(ae).call(ae,ye.payloadType)))}oe("FILTER_SEND_H264_BASELINE")&&(A.videoCodecs=A.videoCodecs.filter((Z=>{var ae,ye;return!(((ae=Z.rtpMap)===null||ae===void 0?void 0:ae.encodingName.toLocaleLowerCase())==="h264"&&((ye=Z.fmtp)===null||ye===void 0?void 0:ye.parameters["profile-level-id"])!==oe("FIRST_H264_PROFILE_LEVEL_ID"))})))}return{send:A,recv:N,sendrecv:H}}return{send:A,recv:N,sendrecv:H}})(t,r,a);try{s.close()}catch{}return{send:c,recv:d,sendrecv:h}}function V7(){const t={audioCodecs:[],videoCodecs:[],audioExtensions:[],videoExtensions:[]},r=TT(arguments.length>2?arguments[2]:void 0,arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},"recvonly"),s={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},a={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},c={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]};if(Qu(t,r,"videoExtensions",s,a,c),Qu(t,r,"videoCodecs",s,a,c),Qu(t,r,"audioExtensions",s,a,c),Qu(t,r,"audioCodecs",s,a,c),oe("RAISE_H264_BASELINE_PRIORITY")){const d=c.videoCodecs.findIndex((h=>h.rtpMap&&h.rtpMap.encodingName.toLocaleLowerCase()==="h264"&&h.fmtp&&h.fmtp.parameters["profile-level-id"]==="42001f"));if(d!==-1){const h=c.videoCodecs.findIndex((m=>m.rtpMap&&m.rtpMap.encodingName.toLocaleLowerCase()==="h264"));if(h<d){M.debug("raising H264 baseline profile priority");const m=c.videoCodecs[d];c.videoCodecs.splice(d,1),c.videoCodecs.splice(h,0,m)}h!==-1&&(a.videoCodecs=a.videoCodecs.filter((m=>!(m.rtpMap&&m.rtpMap.encodingName.toLocaleLowerCase()==="h264"&&m.fmtp&&m.fmtp.parameters["profile-level-id"]!=="42001f"))))}}return{send:s,recv:a,sendrecv:c}}function Qu(t,r,s,a,c,d){if(s==="videoExtensions"||s==="audioExtensions"){const h=[];return t[s].forEach((m=>{r[s].some(((g,v)=>{if(m.entry===g.entry&&m.extensionName===g.extensionName)return h.push(v),!0}))?d[s].push(m):a[s].push(m)})),void r[s].forEach(((m,g)=>{h.indexOf(g)===-1&&c[s].push(m)}))}if(s==="videoCodecs"||s==="audioCodecs"){const h=[];return t[s].forEach((m=>{r[s].some(((g,v)=>{if(m.payloadType===g.payloadType&&JSON.stringify(m)===JSON.stringify(g))return h.push(v),!0}))?d[s].push(m):a[s].push(m)})),void r[s].forEach(((m,g)=>{h.indexOf(g)===-1&&c[s].push(m)}))}}function aP(t){const{send:r,recv:s,sendrecv:a}=t;if(!a){if(!r||!s)throw new Error("cannot merge rtp capabilities because one of send or recv is empty!");return{send:r,recv:s}}let c,d;return r?(c={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},c.audioCodecs=[...r.audioCodecs,...a.audioCodecs],c.videoCodecs=[...r.videoCodecs,...a.videoCodecs],c.audioExtensions=[...r.audioExtensions,...a.audioExtensions],c.videoExtensions=[...r.videoExtensions,...a.videoExtensions]):c=a,s?(d={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},d.audioCodecs=[...s.audioCodecs,...a.audioCodecs],d.videoCodecs=[...s.videoCodecs,...a.videoCodecs],d.audioExtensions=[...s.audioExtensions,...a.audioExtensions],d.videoExtensions=[...s.videoExtensions,...a.videoExtensions]):d=a,{send:c,recv:d}}function T0(t){t.media.mediaType==="audio"&&t.attributes.payloads.filter((r=>{var s;return((s=r.rtpMap)===null||s===void 0?void 0:s.encodingName.toLowerCase())==="opus"})).forEach((r=>{r.fmtp||(r.fmtp={parameters:{}}),r.fmtp.parameters.stereo="1",r.fmtp.parameters["sprop-stereo"]="1"}))}function RT(t,r,s,a){let c=[];if(t===St.VIDEO){if(oe("H264_PROFILE_LEVEL_ID")&&a==="h264"&&(c=r.videoCodecs.filter((d=>{var h;return rt(h=d.rtpMap&&d.rtpMap.encodingName.toLowerCase()||"").call(h,a)&&d&&d.fmtp&&d.fmtp.parameters["profile-level-id"]===oe("H264_PROFILE_LEVEL_ID")}))),!Array.isArray(c)||c.length===0){let d=[];const h=[],m=[],g=[];if(s.videoCodecs.forEach((v=>{const w=v.rtpMap&&v.rtpMap.encodingName.toLowerCase()||"";rt(w).call(w,a)?d.push(v):rt(w).call(w,"vp9")?h.push(v):rt(w).call(w,"vp8")?m.push(v):rt(w).call(w,"h264")&&g.push(v)})),d.length===0){let v="";h.length!==0?(d=h,v="vp9"):m.length!==0?(d=m,v="vp8"):g.length!==0&&(d=g,v="h264"),M.warning("codec ".concat(a," not included in rtpCapabilities, fallback to default payloads: ").concat(v))}d.length!==0&&(c=r.videoCodecs.filter((v=>d.some((w=>w.payloadType===v.payloadType)))))}if(c.length===0&&(M.warning("codec ".concat(a," not included in rtpCapabilities, fallback to default payloads: ").concat(r.videoCodecs[0].rtpMap&&r.videoCodecs[0].rtpMap.encodingName)),c=r.videoCodecs),oe("USE_PUB_RTX")||oe("USE_SUB_RTX")){const d=og(c,r.videoCodecs);c=[...c,...d]}}else{c=r.audioCodecs.filter((h=>{var m;return rt(m=h.rtpMap&&h.rtpMap.encodingName.toLowerCase()||"").call(m,a)}));const d=r.audioCodecs.filter((h=>{var m;return rt(m=h.rtpMap&&h.rtpMap.encodingName.toLowerCase()||"").call(m,"red")}));c.length===0&&(M.warning("codec ".concat(a," not included in rtpCapabilities, fallback to opus")),c=r.audioCodecs.filter((h=>{var m;return rt(m=h.rtpMap&&h.rtpMap.encodingName.toLowerCase()||"").call(m,"opus")}))),oe("ENABLE_AUDIO_RED")&&d.length!==0&&(c=[...d,...c])}return c}function og(t,r){const s=t.map((a=>a.payloadType.toString()));return r.filter((a=>a.rtpMap&&a.rtpMap.encodingName==="rtx"&&a.fmtp&&a.fmtp.parameters.apt&&rt(s).call(s,a.fmtp&&a.fmtp.parameters.apt)))}async function ag(t,r,s){const a=r.toString(),c=F7(a,"offer","remote","exchangeSDP");await t.setRemoteDescription({type:"offer",sdp:a});const d=await t.createAnswer();if(!d.sdp)throw new Error("cannot get answer sdp");let h=d.sdp;h=j7(h,s||{}),c==null||c(h||""),await t.setLocalDescription({type:"answer",sdp:h})}function j7(t,r,s){const a=nc(t),{useXR:c}=r;return a.mediaDescriptions.forEach((d=>{var h;d.attributes.mid&&(Array.isArray(s)&&!rt(s).call(s,d.attributes.mid)||(d.media.mediaType==="audio"&&T0(d),c&&rt(h=["audio","video"]).call(h,d.media.mediaType)&&d.attributes.payloads.forEach((m=>{m.rtcpFeedbacks.findIndex((g=>g.type==="rrtr"))===-1&&m.rtcpFeedbacks.push({type:"rrtr"})}))))})),Zm(a)}function F7(t,r,s,a){if(oe("SDP_LOGGING"))return M.upload("exchanging ".concat(s," ").concat(r," SDP during P2PConnection.").concat(a,`
`),t),r==="offer"?c=>{F7(c,"answer",s==="local"?"remote":"local",a)}:void 0}function B7(t){const r=oe("COMPATIBLE_SDP_EXTENSION");return!!(Array.isArray(r)&&r.length>0)&&r.some((s=>rt(t).call(t,s)))}function z7(t,r){try{var s;return((s=t.fmtp)===null||s===void 0?void 0:s.parameters.apt)===r.payloadType.toString()}catch{return!1}}function W7(t,r){var s=Object.keys(t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);r&&(a=a.filter((function(c){return Object.getOwnPropertyDescriptor(t,c).enumerable}))),s.push.apply(s,a)}return s}function gl(t,r){return typeof oe(t)===r?oe(t):void 0}function __e(){try{const t=oe("EXPERIMENTS")||{};return typeof t=="string"||Array.isArray(t)?{}:(function(r){for(var s=1;s<arguments.length;s++){var a=arguments[s]!=null?arguments[s]:{};s%2?W7(Object(a),!0).forEach((function(c){X(r,c,a[c])})):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(a)):W7(Object(a)).forEach((function(c){Object.defineProperty(r,c,Object.getOwnPropertyDescriptor(a,c))}))}return r})({},t)}catch(t){return M.debug("handle gateway attributes failed: ",t),{}}}const G7={};function cg(t){(!(arguments.length>1&&arguments[1]!==void 0)||arguments[1])&&M.debug("install service ".concat(t.name)),G7[t.name]=t}function Cf(t){const r=G7[t];if(!r)throw new Le(te.INVALID_OPERATION,"".concat(t," not found, please use AgoraRTC.use(").concat(t,"Service) to load it first"));return r}function H7(t,r){return Cf("DataStream").create(t,r)}function cP(){return Cf("InterceptFrame").create()}function $7(t,r){var s=Object.keys(t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);r&&(a=a.filter((function(c){return Object.getOwnPropertyDescriptor(t,c).enumerable}))),s.push.apply(s,a)}return s}function Co(t){for(var r=1;r<arguments.length;r++){var s=arguments[r]!=null?arguments[r]:{};r%2?$7(Object(s),!0).forEach((function(a){X(t,a,s[a])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(s)):$7(Object(s)).forEach((function(a){Object.defineProperty(t,a,Object.getOwnPropertyDescriptor(s,a))}))}return t}const J2=new Map;class y_e extends Zr{get state(){return this._state}set state(r){if(r===this._state)return;const s=this._state;this._state=r,r==="DISCONNECTED"&&this._disconnectedReason?this.emit(ps.CONNECTION_STATE_CHANGE,r,s,this._disconnectedReason):this.emit(ps.CONNECTION_STATE_CHANGE,r,s)}get joinGatewayStartTime(){return this._joinGatewayStartTime}set joinGatewayStartTime(r){M.debug("[".concat(this.store.clientId,"] set joinGatewayStartTime at ").concat(r)),this._joinGatewayStartTime=r}constructor(r,s){var a,c,d;super(),X(this,"store",void 0),X(this,"joinInfo",void 0),X(this,"key",void 0),X(this,"ntpOffset",0),X(this,"signal",void 0),X(this,"role",void 0),X(this,"isPreallocation",void 0),X(this,"isPreSub",void 0),X(this,"inChannelInfo",{joinAt:null,duration:0}),X(this,"spec",void 0),X(this,"_state","DISCONNECTED"),X(this,"_statsCollector",void 0),X(this,"_disconnectedReason",void 0),X(this,"isSignalRecover",!1),X(this,"hasChangeBGPAddress",!1),X(this,"trafficStatsInterval",void 0),X(this,"networkQualityInterval",void 0),X(this,"_joinGatewayStartTime",0),X(this,"_signalTimeout",!1),X(this,"_clientRoleOptions",void 0),X(this,"_isProactiveJoin",!1),this.store=r,this.spec=s,this.signal=this.store.useP2P?(a={spec:Co(Co({},s),{},{retryConfig:s.websocketRetryConfig}),store:r},(c=(d=Cf("P2PChannel")).createSubmodule)===null||c===void 0?void 0:c.call(d,a)):new m_e(Co(Co({},s),{},{retryConfig:s.websocketRetryConfig}),r),this._statsCollector=s.statsCollector,this.role=s.role||"audience",this._clientRoleOptions=s.clientRoleOptions,this.handleSignalEvents()}async join(r,s,a){this.store.joinGatewayStart(),r.cloudProxyServer!=="disabled"&&(this.hasChangeBGPAddress=!0);const c=Date.now();let d=J2.get(r.cname);if(d||(d=new Map,J2.set(r.cname,d)),this._isProactiveJoin=!0,d.has(r.uid)){const v=new ke(te.UID_CONFLICT);throw It.joinGateway(r.sid,{lts:c,succ:!1,ec:v.code,addr:null,uid:r.uid,cid:r.cid,firstSuccess:this._isProactiveJoin,isProxy:!!r.proxyServer,signalChannel:"0",preload:r.preload}),v}d.set(r.uid,!0),this.joinInfo=r,this.key=s;let h=0;this.joinGatewayStartTime=c;const m=r.proxyServer;try{M.debug("[".concat(this.store.clientId,"] use websocket join uid ").concat(h));const v=r.gatewayAddrs.map((w=>{let{address:I}=w;const[A,N]=I.split(":"),H={host:A,port:N};return r.proxyServer&&(H.proxy=r.proxyServer),H}));h=(await this.signal.init(v)).uid,M.debug("[".concat(this.store.clientId,"] websocket join uid ").concat(h," cost ").concat(Date.now()-this.joinGatewayStartTime))}catch(v){var g;throw M.error("[".concat(this.store.clientId,"] User join failed"),v.toString()),It.joinGateway(r.sid,{lts:c,succ:!1,ec:((g=v.data)===null||g===void 0?void 0:g.desc)||v.code,errorMsg:v.message,addr:this.signal.url,uid:r.uid,cid:r.cid,firstSuccess:this._isProactiveJoin,isProxy:!!m,signalChannel:"0",preload:r.preload}),d.delete(r.uid),this.signal.close(),v}return this.state="CONNECTED",this.inChannelInfo.joinAt=Date.now(),M.debug("[".concat(this.store.clientId,"] Connected to gateway server")),this.trafficStatsInterval=window.setInterval((()=>{this.updateTrafficStats().catch((v=>{M.warning("[".concat(this.store.clientId,"] get traffic stats error"),v.toString())}))}),3e3),this.networkQualityInterval=window.setInterval((()=>{navigator&&navigator.onLine!==void 0&&!navigator.onLine?this.emit(ps.NETWORK_QUALITY,{downlinkNetworkQuality:6,uplinkNetworkQuality:6}):this._signalTimeout?this.emit(ps.NETWORK_QUALITY,{downlinkNetworkQuality:5,uplinkNetworkQuality:5}):this.state==="CONNECTED"&&this._statsCollector.trafficStats?this.emit(ps.NETWORK_QUALITY,{uplinkNetworkQuality:R7(this._statsCollector.trafficStats.B_unq),downlinkNetworkQuality:R7(this._statsCollector.trafficStats.B_dnq)}):this.emit(ps.NETWORK_QUALITY,{uplinkNetworkQuality:0,downlinkNetworkQuality:0})}),2e3),this.store.joinGatewayEnd(),h}async leave(){let r=arguments.length>0&&arguments[0]!==void 0&&arguments[0],s=arguments.length>1?arguments[1]:void 0;if(this.state!=="DISCONNECTED"){s!==or.FALLBACK&&(this.state="DISCONNECTING");try{r||this.signal.connectionState!==Or.CONNECTED||await(function(a,c){return c===1/0?a:mt.race([a,Wme(c)])})(this.signal.request(Qt.LEAVE,void 0,!0),3e3)}catch(a){M.warning("[".concat(this.store.clientId,"] leave request failed, ignore"),a)}this.signal.close(s),s!==or.FALLBACK&&(this.state="DISCONNECTED"),this.reset()}}async publish(r,s,a){if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new ke(te.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));const c={state:"offer",p2p_id:this.store.p2pId,ortc:s,mode:this.spec.mode,extend:oe("PUB_EXTEND"),twcc:!!oe("PUBLISH_TWCC"),rtx:!!oe("USE_PUB_RTX")};try{return(await this.signal.request(Qt.PUBLISH,c,!0))._message}catch(d){if(a&&d.data&&d.data.code===Bt.ERR_PUBLISH_REQUEST_INVALID)return M.warning("[".concat(this.store.clientId,"] receive publish error code, retry"),d.toString()),await this.tryUnpubBeforeRepub(r,s),this.publish(r,s,!1);throw d}}async publishDataChannel(r,s,a){var c;if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new ke(te.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));const d={stream_id:s.streamId,ordered:s.ordered?1:0,max_retrans_times:(c=s.maxRetransmits)!==null&&c!==void 0?c:10,channel_id:s.channelId,metadata:s.metadata};try{await this.signal.request(Qt.PUBLISH_DATASTREAM,d,!0)}catch(h){if(a&&h.data&&h.data.code===Bt.ERR_PUBLISH_REQUEST_INVALID)return M.warning("[".concat(this.store.clientId,"] receive publish datachannels error code, retry"),h.toString()),await this.tryUnpubDataChannelBeforeRepub(r,s),this.publishDataChannel(r,s,!1);throw h}}async unpublish(r,s){try{if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new ke(te.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));await this.signal.request(Qt.UNPUBLISH,{stream_id:s,ortc:r},!0)}catch(a){M.warning("[".concat(this.store.clientId,"] unpublish warning: "),a)}}async unpublishDataChannel(r){try{if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new ke(te.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));await mt.all(r.map((s=>this.signal.request(Qt.UNPUBLISH_DATASTREAM,{channel_id:s},!0))))}catch(s){M.warning("unpublish datachannels warning: ",s)}}async presubscribe(r,s,a){if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new ke(te.INVALID_OPERATION,"can not presubscribe when connection state is ".concat(this.state));const c={stream_id:r,stream_type:s,mode:this.spec.mode,codec:this.spec.codec,p2p_id:this.store.p2pId,twcc:!!oe("SUBSCRIBE_TWCC"),rtx:!!oe("USE_SUB_RTX")||void 0,extend:oe("SUB_EXTEND"),svc:Array.isArray(oe("SVC"))&&oe("SVC").length!==0?oe("SVC"):void 0};try{return await this.signal.request(Qt.PRE_SUBSCRIBE,c,!0)}catch(d){if(a&&d.data&&d.data.code===Bt.ERR_SUBSCRIBE_REQUEST_INVALID)return M.warning("[".concat(this.store.clientId,"] pre-subscribe error, retry"),d.toString()),this.presubscribe(r,s,!1);throw d}}async subscribe(r,s,a){if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new ke(te.INVALID_OPERATION,"can not subscribe when connection state is ".concat(this.state));const c={stream_id:r,stream_type:s.stream_type,mode:this.spec.mode,codec:this.spec.codec,p2p_id:this.store.p2pId,twcc:!!oe("SUBSCRIBE_TWCC"),rtx:!!oe("USE_SUB_RTX"),extend:oe("SUB_EXTEND"),ssrcId:s.ssrcId,svc:Array.isArray(oe("SVC"))&&oe("SVC").length!==0?oe("SVC"):void 0};try{return(await this.signal.request(Qt.SUBSCRIBE,c,!0))._message}catch(d){if(a&&d.data&&d.data.code===Bt.ERR_SUBSCRIBE_REQUEST_INVALID)return M.warning("[".concat(this.store.clientId,"] receiver subscribe error code, retry"),d.toString()),await this.tryUnsubBeforeResub(r,s),await this.subscribe(r,s,!1);throw d}}async subscribeDataChannel(r,s,a){if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new ke(te.INVALID_OPERATION,"can not subscribe datachannel when connection state is ".concat(this.state));const c={uid:r,stream_id:s.id,channel_id:s.datachannelId};try{return void await this.signal.request(Qt.SUBSCRIBE_DATASTREAM,c,!0)}catch(d){if(a&&d.data&&d.data.code===Bt.ERR_SUBSCRIBE_REQUEST_INVALID)return M.warning("[".concat(this.store.clientId,"] receiver subscribe datachannel error code, retry"),d.toString()),await this.tryUnsubDataChannelBeforeResub(r,s),await this.subscribeDataChannel(r,s,!1);throw d}}async subscribeAll(r,s){if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new ke(te.INVALID_OPERATION,"can not massSubscribe when connection state is ".concat(this.state));const a={p2p_id:this.store.p2pId,users:r,dtx:!1,rtx:!!oe("USE_SUB_RTX"),twcc:!!oe("SUBSCRIBE_TWCC"),svc:Array.isArray(oe("SVC"))&&oe("SVC").length!==0?oe("SVC"):void 0};try{return await this.signal.request(Qt.SUBSCRIBE_STREAMS,a,!0)}catch(c){if(s&&c.data&&c.data.code===Bt.ERR_SUBSCRIBE_REQUEST_INVALID)return M.warning("[".concat(this.store.clientId,"] receiver massSubscribe error code, retry"),c.toString()),await this.tryMassUnsubBeforeResub(r),await this.subscribeAll(r,!1);throw c}}async setVideoProfile(r){const s=(function(a){if(!(a.bitrateMax&&a.bitrateMin&&a.frameRate&&a.height&&a.width))return;let c=a.frameRate,d=a.width,h=a.height,m=!0;return typeof c!="number"&&(c=c.exact||c.ideal||c.max||c.min||0,c||(m=!1)),typeof d!="number"&&(d=d.exact||d.ideal||d.max||d.min||0,d||(m=!1)),typeof h!="number"&&(h=h.exact||h.ideal||h.max||h.min||0,c||(m=!1)),m?{stream_type:0,width:d,height:h,fps:c,start_bps:1e3*a.bitrateMax,min_bps:1e3*a.bitrateMin,target_bps:1e3*a.bitrateMax}:void 0})(r);if(s)return this.signal.request(Qt.SET_VIDEO_PROFILE,s);M.debug("[".concat(this.store.clientId,"] encoder config is not complete, do not report to gateway"))}async unsubscribe(r,s){try{await this.signal.request(Qt.UNSUBSCRIBE,{p2p_id:this.store.p2pId,ortc:r,stream_id:s},!0)}catch(a){M.warning("[".concat(this.store.clientId,"] unsubscribe warning: "),a)}}async unsubscribeDataChannel(r,s){try{if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new ke(te.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));await mt.all(r.map((a=>this.signal.request(Qt.UNSUBSCRIBE_DATASTREAM,{stream_id:a,uid:s},!0))))}catch(a){M.warning("unsubscribeDataChannel warning: ",a)}}async massUnsubscribe(r){try{await this.signal.request(Qt.UNSUBSCRIBE_STREAMS,r,!0)}catch(s){M.warning("[".concat(this.store.clientId,"] massUnsubscribeAll warning: "),s)}}async reconnectPC(r){const{iceParameters:s,dtlsParameters:a,rtpCapabilities:c}=r;return{gatewayEstablishParams:await this.signal.request(Qt.CONNECT_PC,{p2p_id:this.store.p2pId,stream_id:this.store.uid,ortc:{iceParameters:s,dtlsParameters:a,rtpCapabilities:c}},!0),gatewayAddress:this.getCurrentGatewayAddress()}}getGatewayInfo(){return this.signal.request(Qt.GATEWAY_INFO)}async renewToken(r){await this.signal.request(Qt.RENEW_TOKEN,r),this.key=r.token}updateClientRole(r,s){s&&(this._clientRoleOptions=Object.assign({},s)),oe("CLIENT_ROLE_OPTIONS")&&(M.debug("[".concat(this.store.clientId,"] Set roleOptions for ").concat(JSON.stringify(oe("CLIENT_ROLE_OPTIONS"))," instead of ").concat(JSON.stringify(this._clientRoleOptions)," ")),this._clientRoleOptions=Object.assign({},oe("CLIENT_ROLE_OPTIONS"))),this.role=r}async setClientRole(r,s){if(s&&(this._clientRoleOptions=Object.assign({},s)),oe("CLIENT_ROLE_OPTIONS")&&(this._clientRoleOptions=Object.assign({},oe("CLIENT_ROLE_OPTIONS")),M.debug("[".concat(this.store.clientId,"] Set roleOptions for ").concat(JSON.stringify(oe("CLIENT_ROLE_OPTIONS"))," instead of ").concat(JSON.stringify(this._clientRoleOptions)," "))),this.state!=="CONNECTED")return void(this.role=r);let a,c=0;r==="audience"?this._clientRoleOptions&&this._clientRoleOptions.delay?(a=this._clientRoleOptions.delay,c=1):c=this._clientRoleOptions&&this._clientRoleOptions.level?this._clientRoleOptions.level:2:c=0;const d=Object.assign({},s);delete d.delay,delete d.level,await this.signal.request(Qt.SET_CLIENT_ROLE,Co(Co({role:r,level:c,delay:a},d),{},{client_ts:Date.now()})),this.role=r}async setRemoteVideoStreamType(r,s){await this.signal.request(Qt.SWITCH_VIDEO_STREAM,{stream_id:r,stream_type:s})}async setDefaultRemoteVideoStreamType(r){await this.signal.request(Qt.DEFAULT_VIDEO_STREAM,{stream_type:r})}async setStreamFallbackOption(r,s){await this.signal.request(Qt.SET_FALLBACK_OPTION,{stream_id:r,fallback_type:s})}async pickSVCLayer(r,s){await this.signal.request(Qt.PICK_SVC_LAYER,{stream_id:r,spatial_layer:s.spatialLayer,temporal_layer:s.temporalLayer})}async setRTM2Flag(r){await this.signal.request(Qt.SET_RTM2_FLAG,{rtm2_flag:r})}async sendExtensionMessage(r,s,a){if(this.store.useP2P)return this.signal.sendExtensionMessage(r,s,a)}getInChannelInfo(){return this.inChannelInfo.joinAt&&(this.inChannelInfo.duration=Date.now()-this.inChannelInfo.joinAt),Co({},this.inChannelInfo)}async getGatewayVersion(){return(await this.signal.request(Qt.GATEWAY_INFO)).version}reset(){if(this.inChannelInfo.joinAt&&(this.inChannelInfo.duration=Date.now()-this.inChannelInfo.joinAt,this.inChannelInfo.joinAt=null),this.trafficStatsInterval&&(window.clearInterval(this.trafficStatsInterval),this.trafficStatsInterval=void 0),this.joinInfo){const r=J2.get(this.joinInfo.cname);r&&r.delete(this.joinInfo.uid)}this.joinInfo=void 0,this.key=void 0,this.networkQualityInterval&&(window.clearInterval(this.networkQualityInterval),this.networkQualityInterval=void 0)}updateTurnConfigFromSignal(){if(!this.joinInfo)return;const r=(function(s){let a;return a=s.startsWith("dc")?s.match(/(dc\:\/\/)?([^:]+):(\d+)/):s.match(/(wss\:\/\/)?([^:]+):(\d+)/),a?{username:Ws.username,password:Ws.password,turnServerURL:a[2],tcpport:parseInt(a[3])+30,udpport:parseInt(a[3])+30,forceturn:!1}:null})((this.joinInfo.cloudProxyServer==="disabled"?this.signal.url:this.joinInfo.gatewayAddrs[this.signal.currentURLIndex].address)||"");this.joinInfo.turnServer.serversFromGateway=[],r&&this.joinInfo.turnServer.mode!=="off"&&this.joinInfo.cloudProxyServer==="disabled"&&this.joinInfo.turnServer.serversFromGateway.push(Co(Co({},Ws),{},{turnServerURL:r.turnServerURL,tcpport:r.tcpport,udpport:r.udpport,username:this.joinInfo.uid.toString(),password:this.joinInfo.token}))}async updateTrafficStats(){if(this.state!=="CONNECTED")return;const r=await this.signal.request(Qt.TRAFFIC_STATS,void 0,!0);r.timestamp=Date.now(),r.ntp_offset!=null&&(this.ntpOffset=r.ntp_offset),r.peer_delay.forEach((s=>{const a=this._statsCollector.trafficStats&&this._statsCollector.trafficStats.peer_delay.find((c=>c.peer_uid===s.peer_uid));a&&a.B_st!==s.B_st&&I1((()=>{this.emit(ps.STREAM_TYPE_CHANGE,s.peer_uid,s.B_st)}))})),this._statsCollector.updateTrafficStats(r)}getJoinMessage(r){var s,a;if(!this.joinInfo||!this.key)throw new ke(te.UNEXPECTED_ERROR,"can not generate join message, no join info");const c=Object.assign({},this.joinInfo.apResponse);let d=oe("REPORT_APP_SCENARIO");if(typeof d!="string")try{d=JSON.stringify(d)}catch{d=void 0}var h;d&&d.length>128&&(d=void 0),this.store.hasStartJoinChannel=!0,this.store.isABTestSuccess||this.emit(ps.UPDATE_GATEWAY_CONFIG),h=this.store.clientId,rt(_0).call(_0,h)||_0.push(h);const m=h2(this.store),g=!((s=this.isPreallocation)===null||s===void 0||!s.call(this)),v=Y9(this.store),w=__e(),I=Qv(87)||i9()||FL(117),A=((function(){const H=Mn();if(H.name!==Yn.SAFARI||!H.browserVersion)return!1;const B=H.browserVersion.split(".");return Number(B[0])>18||Number(B[0])===18&&Number(B[1])>=4})()||c9(18,4,!1))&&BL(18,6,!0)&&this.spec.codec==="h264"&&oe("ENABLE_ABSSENDTIME_AS_SENTTS"),N=Co({license:this.joinInfo.license,p2p_id:this.store.p2pId,session_id:this.joinInfo.sid,app_id:this.joinInfo.appId,channel_key:this.key,channel_name:this.joinInfo.cname,sdk_version:Zl,browser:navigator.userAgent,process_id:oe("PROCESS_ID"),mode:this.store.useP2P?"p2p":this.spec.mode,codec:this.spec.codec,role:this.role,has_changed_gateway:this.hasChangeBGPAddress,ap_response:c,extend:oe("JOIN_EXTEND"),details:{6:this.joinInfo.stringUid,cservice_map:this.joinInfo.cloudProxyServer==="proxy3"?"1":this.joinInfo.cloudProxyServer==="proxy5"?"2":void 0},features:{rejoin:!0},optionalInfo:this.joinInfo.optionalInfo,appScenario:d,attributes:{userAttributes:Co(Co({enableEncodedTransform:(!!oe("ENABLE_AUDIO_METADATA")||!!oe("ENABLE_AUDIO_PTS"))&&I||!!oe("ENABLE_AUDIO_TOPN")&&VL(Yn.CHROME,87,116)||void 0,enableAudioMetadata:!!oe("ENABLE_AUDIO_METADATA")&&I,enableAudioPts:!!oe("ENABLE_AUDIO_PTS")&&I,topnSmoothLevel:oe("TOPN_SMOOTH_LEVEL"),topnNewSpeakerDelay:oe("TOPN_NEW_SPEAKER_DELAY"),topnSwitchHoldMs:oe("TOPN_SWITCH_HOLD_MS"),topnAudioGain:oe("TOPN_AUDIO_GAIN"),enablePublishedUserList:oe("ENABLE_PUBLISHED_USER_LIST"),maxSubscription:oe("MAX_SUBSCRIPTION"),subscribeAudioFilterTopN:gl("SUBSCRIBE_AUDIO_FILTER_TOPN","number"),enablePublishAudioFilter:gl("ENABLE_PUBLISH_AUDIO_FILTER","boolean"),enableUserLicenseCheck:gl("ENABLE_USER_LICENSE_CHECK","boolean"),enableRTX:oe("USE_PUB_RTX")===!0||oe("USE_SUB_RTX")===!0||void 0,disableFEC:oe("DISABLE_FEC"),enableNTPReport:!!oe("ENABLE_NTP_REPORT")||void 0,enableInstantVideo:v,enableFulllinkAvSync:!!oe("ENABLE_FULL_LINK_AV_SYNC")||void 0,enableDataStream2:gl("ENABLE_DATASTREAM_2","boolean"),enableAutFeedback:!!oe("FORCE_ENABLE_AUT_CC")||!D1()&&(!!oe("ENABLE_AUT_FEEDBACK")||void 0),rtm2Flag:typeof this.joinInfo.rtmFlag=="number"?this.joinInfo.rtmFlag:void 0,enableUserAutoRebalanceCheck:!!oe("ENABLE_USER_AUTO_REBALANCE_CHECK"),enableXR:gl("USE_XR","boolean"),enableLossbasedBwe:gl("ENABLE_LOSSBASED_BWE","boolean"),enableAutCC:!!oe("FORCE_ENABLE_AUT_CC")||!D1()&&(!!oe("ENABLE_AUT_CC")||void 0),enableCCFallback:gl("ENABLE_CC_FALLBACK","boolean"),enablePreallocPC:g,preSubNum:m?gl("PRE_SUB_NUM","number"):void 0,enablePubTWCC:gl("PUBLISH_TWCC","boolean"),enableSubTWCC:gl("SUBSCRIBE_TWCC","boolean"),enablePubRTX:gl("USE_PUB_RTX","boolean"),enableSubRTX:gl("USE_SUB_RTX","boolean"),enableSubSVC:oe("ENABLE_SVC")?oe("ENABLE_SVC_DEFAULT_CODECS"):Array.isArray(oe("SVC"))&&oe("SVC").length!==0?oe("SVC"):void 0,enableSvcExtended:oe("ENABLE_SVC")&&Array.isArray(oe("SVC_EXTENDED"))&&oe("SVC_EXTENDED").length!==0?oe("SVC_EXTENDED"):void 0},w),{},{audioDuplicate:gl("ENABLE_AUDIO_RED","boolean")?(a=gl("AUDIO_DUPLICATE_NUM","number"))!==null&&a!==void 0?a:2:void 0,senttsUsesAbsSendTime:!!A||void 0})},join_ts:this.joinGatewayStartTime},r);return this.joinInfo.stringUid&&(N.string_uid=this.joinInfo.stringUid),this.joinInfo.aesmode&&this.joinInfo.aespassword&&(N.aes_mode=this.joinInfo.aesmode,oe("ENCRYPT_AES")?(N.aes_secret=this.joinInfo.aespassword,N.aes_encrypt=!0):N.aes_secret=this.joinInfo.aespassword,this.joinInfo.aessalt&&(N.aes_salt=this.joinInfo.aessalt)),c.addresses[this.signal.websocket.currentURLIndex]&&(N.ap_response.ticket=c.addresses[this.signal.websocket.currentURLIndex].ticket,delete c.addresses),this.joinInfo.defaultVideoStream!==void 0&&(N.default_video_stream=this.joinInfo.defaultVideoStream),N}getRejoinMessage(){if(!this.joinInfo)throw new ke(te.UNEXPECTED_ERROR,"can not generate rejoin message, no join info");return{session_id:this.joinInfo.sid,channel_name:this.joinInfo.cname,cid:this.joinInfo.cid,uid:this.joinInfo.uid,vid:Number(this.joinInfo.vid)}}handleSignalEvents(){this.signal.on(tn.WS_RECONNECT_CREATE_CONNECTION,(r=>{this.joinGatewayStartTime=Date.now()})),this.signal.on(tn.WS_RECONNECTING,(r=>{this.joinInfo&&It.WebSocketQuit(this.joinInfo.sid,{lts:Date.now(),succ:-1,cname:this.joinInfo.cname,uid:this.joinInfo.uid,cid:this.joinInfo.cid,errorCode:r||Bs.NETWORK_ERROR}),this.joinInfo&&(this.state="RECONNECTING",It.sessionInit(this.joinInfo.sid,{lts:new Date().getTime(),extend:this.isSignalRecover?{recover:!0}:{rejoin:!0},cname:this.joinInfo.cname,appid:this.joinInfo.appId,mode:this.spec.mode,stringUid:this.joinInfo.stringUid,channelProfile:this.spec.mode==="live"?1:0,channelMode:0,lsid:this.joinInfo.sid,clientRole:this.role==="audience"?2:1,buildFormat:1}),this.isSignalRecover=!1,this.joinGatewayStartTime=Date.now())})),this.signal.on(tn.WS_CLOSED,(r=>{let s;switch(r){case or.LEAVE:s=Bs.LEAVE;break;case or.UID_BANNED:case or.IP_BANNED:case or.CHANNEL_BANNED:case or.SERVER_ERROR:s=Bs.SERVER_ERROR;break;case or.FALLBACK:s=Bs.FALLBACK;break;case or.LICENSE_MISSING:case or.LICENSE_EXPIRED:case or.LICENSE_MINUTES_EXCEEDED:case or.LICENSE_PERIOD_INVALID:case or.LICENSE_MULTIPLE_SDK_SERVICE:case or.LICENSE_ILLEGAL:case or.TOKEN_EXPIRE:s=r;break;default:s=Bs.NETWORK_ERROR}M.debug("[".concat(this.store.clientId,"] [signal] websocket closed, reason: ").concat(s||"undefined -> "+Bs.NETWORK_ERROR)),this.joinInfo&&It.WebSocketQuit(this.joinInfo.sid,{lts:Date.now(),succ:r===or.LEAVE?1:-1,cname:this.joinInfo.cname,uid:this.joinInfo.uid,cid:this.joinInfo.cid,errorCode:s}),this._disconnectedReason=r,r!==or.FALLBACK&&(this.state="DISCONNECTED"),this.reset()})),this.signal.on(tn.WS_CONNECTED,(()=>{if(this.updateTurnConfigFromSignal(),this.state="CONNECTED",this.joinInfo){if(this.role==="audience"){const r=oe("CLIENT_ROLE_OPTIONS")||this._clientRoleOptions;r&&(r.level||r.delay)&&(M.debug("[".concat(this.store.clientId,"] patch to send set client role, role: ").concat(this.role,", mode: ").concat(this.spec.mode,", level: ").concat(r.level,", delay: ").concat(r.delay)),this.setClientRole(this.role,r))}if(It.joinGateway(this.joinInfo.sid,{lts:this.joinGatewayStartTime,succ:!0,ec:null,vid:this.joinInfo.vid,addr:this.signal.url,uid:this.joinInfo.uid,cid:this.joinInfo.cid,firstSuccess:this._isProactiveJoin,isProxy:!!this.joinInfo.proxyServer,signalChannel:"0",preload:this.joinInfo.preload,isABTestSuccess:this.store.isABTestSuccess}),this._isProactiveJoin=!1,this.joinInfo.useLocalAccessPoint&&this.joinInfo.setLocalAPVersion===1){const r=this.signal.url&&this.signal.url.match(/wss\:\/\/([^:]+):(\d+)/);if(!r)return void M.error("[".concat(this.store.clientId,"] set local access point after joined failed: ").concat(r));gr("EVENT_REPORT_DOMAIN",r[1]),gr("EVENT_REPORT_BACKUP_DOMAIN",r[1]),gr("LOG_UPLOAD_SERVER","".concat(r[1],":6444"))}}})),this.signal.on(Nn.ON_UPLINK_STATS,(r=>{this._statsCollector.updateUplinkStats(r)})),this.signal.on(tn.REQUEST_RECOVER,((r,s,a)=>{if(!this.joinInfo)return a(new ke(te.UNEXPECTED_ERROR,"gateway: can not recover, no join info"));r&&(this.joinInfo.multiIP=r,this.hasChangeBGPAddress=!0),this.isSignalRecover=!0,zs(this,ps.REQUEST_NEW_GATEWAY_LIST).then(s).catch(a)})),this.signal.on(tn.REQUEST_JOIN_INFO,(async(r,s,a)=>{var c,d,h;if(this.updateTurnConfigFromSignal(),this.store.useP2P)return void r(this.getJoinMessage({ortc:{}}));const m=Kr((c=this.joinInfo)===null||c===void 0?void 0:c.turnServer);if(oe("NEW_TURN_MODE")&&m&&((d=this.joinInfo)===null||d===void 0?void 0:d.cloudProxyServer)==="disabled"){var g;let A=m.servers.map((B=>"turnServerURL"in B&&oe("USE_TURN_IP")?Co(Co({},B),{},{turnServerURL:nP(B.turnServerURL)}):B)),N=(g=m.serversFromGateway)===null||g===void 0?void 0:g.map((B=>oe("USE_TURN_IP")?Co(Co({},B),{},{turnServerURL:nP(B.turnServerURL)}):B));const H=this.signal.currentURLIndex;A.length>0&&(A=[A[H%A.length]],m.servers=A),Array.isArray(N)&&N.length>0&&(N=[N[0]],m.serversFromGateway=N),M.debug("[".concat(this.store.clientId,"] use single turn, use turn server index: ").concat(H))}const{iceParameters:v,dtlsParameters:w,rtpCapabilities:I}=await zs(this,ps.REQUEST_P2P_CONNECTION_PARAMS,{turnServer:m,cloudProxyServer:(h=this.joinInfo)===null||h===void 0?void 0:h.cloudProxyServer});try{r(this.getJoinMessage({ortc:{iceParameters:v,dtlsParameters:w,rtpCapabilities:I,version:"2"}}))}catch(A){s(A)}})),this.signal.on(tn.REQUEST_REJOIN_INFO,(r=>{r(this.getRejoinMessage())})),this.signal.on(tn.REPORT_JOIN_GATEWAY,((r,s)=>{if(!this.joinInfo)return;let a,c="";var d;r instanceof ke?(a=((d=r.data)===null||d===void 0?void 0:d.desc)||r.code,c=r.message):a=r,It.joinGateway(this.joinInfo.sid,{lts:this.joinGatewayStartTime,succ:!1,ec:a,errorMsg:c,addr:s,uid:this.joinInfo.uid,cid:this.joinInfo.cid,firstSuccess:this._isProactiveJoin,isProxy:!!this.joinInfo.proxyServer,signalChannel:"0",preload:this.joinInfo.preload})})),this.signal.on(tn.IS_P2P_DISCONNECTED,(r=>{r(uT(this,ps.IS_P2P_DISCONNECTED))})),this.signal.on(tn.DISCONNECT_P2P,(()=>{this.emit(ps.DISCONNECT_P2P)})),this.signal.on(tn.REQUEST_SUCCESS,(()=>{this._signalTimeout=!1})),this.signal.on(tn.REQUEST_TIMEOUT,(()=>{this._signalTimeout=!0})),this.signal.on(tn.JOIN_RESPONSE,(r=>{const s=this.getCurrentGatewayAddress();this.emit(ps.JOIN_RESPONSE,r,s)})),this.signal.on(tn.PRE_CONNECT_PC,(async()=>{if(this.joinInfo){var r,s;this.updateTurnConfigFromSignal();const c=this.getCurrentGatewayAddress(),d=Kr((r=this.joinInfo)===null||r===void 0?void 0:r.turnServer);if(oe("NEW_TURN_MODE")&&d&&((s=this.joinInfo)===null||s===void 0?void 0:s.cloudProxyServer)==="disabled"){var a;let m=d.servers.map((w=>"turnServerURL"in w&&oe("USE_TURN_IP")?Co(Co({},w),{},{turnServerURL:nP(w.turnServerURL)}):w)),g=(a=d.serversFromGateway)===null||a===void 0?void 0:a.map((w=>oe("USE_TURN_IP")?Co(Co({},w),{},{turnServerURL:nP(w.turnServerURL)}):w));const v=this.signal.currentURLIndex;m.length>0&&(m=[m[v%m.length]],d.servers=m),Array.isArray(g)&&g.length>0&&(g=[g[0]],d.serversFromGateway=g),M.debug("[".concat(this.store.clientId,"] use single turn, use turn server index: ").concat(v,",in pre pc"))}const h=oe("FINGERPRINT")||this.joinInfo.apResponse.addresses[this.signal.currentURLIndex].fingerprint;if(c&&h){const m=D7(c);this.emit(ps.PRE_CONNECT_PC,{candidates:m,fingerprint:h,turnServer:d})}}})),this.signal.on(tn.RECOVER_NOTIFICATION,(r=>{this.joinInfo&&typeof oe("AP_REQUEST_DETAIL")=="string"&&(this.joinInfo.apRequestDetail="".concat(oe("AP_REQUEST_DETAIL"),";").concat(r))}))}async tryUnsubBeforeResub(r,s){try{await this.signal.request(Qt.UNSUBSCRIBE,{p2p_id:this.store.p2pId,stream_id:r,ortc:[s]},!0)}catch(a){throw M.warning("[".concat(this.store.clientId,"] tryUnsubBeforeResub warning"),a),a}}async tryUnsubDataChannelBeforeResub(r,s){try{await this.signal.request(Qt.UNSUBSCRIBE,{stream_id:s.id},!0)}catch(a){throw M.warning("unsubscribe datachannel warning",a),a}}async tryUnpubBeforeRepub(r,s){try{await this.signal.request(Qt.UNPUBLISH,{stream_id:r,ortc:s},!0)}catch(a){throw M.warning("[".concat(this.store.clientId,"] tryUnpubBeforeRepub warning: "),a),a}}async tryUnpubDataChannelBeforeRepub(r,s){try{await this.signal.request(Qt.UNPUBLISH_DATASTREAM,{channnel_id:s.channelId},!0)}catch(a){throw M.warning("unpublish datastream warning: ",a),a}}async tryMassUnsubBeforeResub(r){const s={users:r.map((a=>({stream_id:a.stream_id,stream_type:a.stream_type})))};try{await this.signal.request(Qt.UNSUBSCRIBE_STREAMS,s,!0)}catch(a){throw M.warning("[".concat(this.store.clientId,"] tryMassUnsubBeforeResub warning"),a),a}}async muteLocal(r,s){const a={action:r.find((c=>c.stream_type===lr.Audio))?"mute_local_audio":"mute_local_video",p2p_id:this.store.p2pId,ortc:r,stream_id:s};try{await this.signal.request(Qt.CONTROL,a,!0,!0)}catch(c){throw M.warning("[".concat(this.store.clientId,"] gateway muteLocal warning: "),c),c}}async unmuteLocal(r,s){const a={action:r.find((c=>c.stream_type===lr.Audio))?"unmute_local_audio":"unmute_local_video",p2p_id:this.store.p2pId,ortc:r,stream_id:s};try{await this.signal.request(Qt.CONTROL,a,!0,!0)}catch(c){throw M.warning("[".concat(this.store.clientId,"] gateway unmuteLocal warning: "),c),c}}async muteRemote(r,s){const a={action:r===St.AUDIO?"mute_remote_audio":"mute_remote_video",p2p_id:this.store.p2pId,stream_id:s};try{await this.signal.request(Qt.CONTROL,a,!0,!0)}catch(c){throw M.warning("[".concat(this.store.clientId,"] gateway muteRemote warning: "),c),c}}async unmuteRemote(r,s){const a={action:r===St.AUDIO?"unmute_remote_audio":"unmute_remote_video",p2p_id:this.store.p2pId,stream_id:s};try{await this.signal.request(Qt.CONTROL,a,!0,!0)}catch(c){throw M.warning("[".concat(this.store.clientId,"] gateway unmuteRemote warning: "),c),c}}uploadWRTCStats(r){this.signal.uploadWRTCStats(r)}upload(r,s){this.signal.upload(r,s)}getSignalRTT(){return this.signal.rtt}async restartICE(r){const s={p2p_id:this.store.p2pId,stream_id:this.store.uid,ortc:r};try{return await this.signal.request(Qt.RESTART_ICE,s,!0)}catch(a){throw M.warning("[".concat(this.store.clientId,"] P2PChannel.restartICE warning: "),a),a}}reconnect(r,s){this.state==="CONNECTED"&&this.signal.reconnect(r||void 0,s||Bs.P2P_FAILED)}getCurrentGatewayAddress(){var r,s;if(!oe("GATEWAY_WSS_ADDRESS"))return oe("USE_CANDIDATE_FROM_AP_DETAIL")&&(r=this.joinInfo)!==null&&r!==void 0&&r.apGatewayAddress?(M.debug("[".concat(this.store.clientId,"] use candidate from ap detail, ").concat(JSON.stringify(this.joinInfo.apGatewayAddress))),this.joinInfo.apGatewayAddress):(s=this.joinInfo)!==null&&s!==void 0&&s.gatewayAddrs?this.joinInfo.gatewayAddrs[this.signal.currentURLIndex]:void 0}async setPublishAudioFilterEnabled(r){await this.signal.request(Qt.SET_PARAMETER,{enablePublishAudioFilter:r})}downgradeCodec(r){this.signal.downgradeCodec(r)}}let lP=0,Q2=0;function th(t,r,s,a){return new mt(((c,d)=>{r.timeout=r.timeout||oe("HTTP_CONNECT_TIMEOUT"),r.responseType=r.responseType||"json",r.data&&!s?(r.data=JSON.stringify(r.data),lP+=sp(r.data)):s&&(r.data.size?lP+=r.data.size:r.data instanceof FormData?lP+=T9(r.data):lP+=sp(JSON.stringify(r.data))),r.headers=r.headers||{},r.headers["Content-Type"]=r.headers["Content-Type"]||"application/json",r.method="POST",r.url=t,Na.request(r).then((h=>{typeof h.data=="string"?Q2+=sp(h.data):h.data instanceof ArrayBuffer||h.data instanceof Uint8Array?Q2+=h.data.byteLength:Q2+=sp(JSON.stringify(h.data)),a&&c({data:h.data,headers:h.headers}),c(h.data)})).catch((h=>{Na.isCancel(h)?d(new ke(te.OPERATION_ABORTED,"cancel token canceled")):h.code==="ECONNABORTED"?d(new ke(te.NETWORK_TIMEOUT,h.message)):h.response?d(new ke(te.NETWORK_RESPONSE_ERROR,h.response.status)):d(new ke(te.NETWORK_ERROR,h.message))}))}))}/*! formdata-polyfill. MIT License. Jimmy W?rting <https://jimmy.warting.se/opensource> */(function(){var t;function r(ze){var ot=0;return function(){return ot<ze.length?{done:!1,value:ze[ot++]}:{done:!0}}}var s=typeof Object.defineProperties=="function"?Object.defineProperty:function(ze,ot,wt){return ze==Array.prototype||ze==Object.prototype||(ze[ot]=wt.value),ze},a,c=(function(ze){ze=[typeof globalThis=="object"&&globalThis,ze,typeof window=="object"&&window,typeof self=="object"&&self,typeof o=="object"&&o];for(var ot=0;ot<ze.length;++ot){var wt=ze[ot];if(wt&&wt.Math==Math)return wt}throw Error("Cannot find global object")})(this);function d(ze,ot){if(ot)e:{var wt=c;ze=ze.split(".");for(var Ke=0;Ke<ze.length-1;Ke++){var V=ze[Ke];if(!(V in wt))break e;wt=wt[V]}(ot=ot(Ke=wt[ze=ze[ze.length-1]]))!=Ke&&ot!=null&&s(wt,ze,{configurable:!0,writable:!0,value:ot})}}function h(ze){return(ze={next:ze})[Symbol.iterator]=function(){return this},ze}function m(ze){var ot=typeof Symbol<"u"&&Symbol.iterator&&ze[Symbol.iterator];return ot?ot.call(ze):{next:r(ze)}}if(d("Symbol",(function(ze){function ot(V,ce){this.A=V,s(this,"description",{configurable:!0,writable:!0,value:ce})}if(ze)return ze;ot.prototype.toString=function(){return this.A};var wt="jscomp_symbol_"+(1e9*Math.random()>>>0)+"_",Ke=0;return function V(ce){if(this instanceof V)throw new TypeError("Symbol is not a constructor");return new ot(wt+(ce||"")+"_"+Ke++,ce)}})),d("Symbol.iterator",(function(ze){if(ze)return ze;ze=Symbol("Symbol.iterator");for(var ot="Array Int8Array Uint8Array Uint8ClampedArray Int16Array Uint16Array Int32Array Uint32Array Float32Array Float64Array".split(" "),wt=0;wt<ot.length;wt++){var Ke=c[ot[wt]];typeof Ke=="function"&&typeof Ke.prototype[ze]!="function"&&s(Ke.prototype,ze,{configurable:!0,writable:!0,value:function(){return h(r(this))}})}return ze})),typeof Object.setPrototypeOf=="function")a=Object.setPrototypeOf;else{var g;e:{var v={};try{v.__proto__={a:!0},g=v.a;break e}catch{}g=!1}a=g?function(ze,ot){if(ze.__proto__=ot,ze.__proto__!==ot)throw new TypeError(ze+" is not extensible");return ze}:null}var w=a;function I(){this.m=!1,this.j=null,this.v=void 0,this.h=1,this.u=this.C=0,this.l=null}function A(ze){if(ze.m)throw new TypeError("Generator is already running");ze.m=!0}function N(ze,ot){return ze.h=3,{value:ot}}function H(ze){this.g=new I,this.G=ze}function B(ze,ot,wt,Ke){try{var V=ot.call(ze.g.j,wt);if(!(V instanceof Object))throw new TypeError("Iterator result "+V+" is not an object");if(!V.done)return ze.g.m=!1,V;var ce=V.value}catch(ge){return ze.g.j=null,ze.g.s(ge),z(ze)}return ze.g.j=null,Ke.call(ze.g,ce),z(ze)}function z(ze){for(;ze.g.h;)try{var ot=ze.G(ze.g);if(ot)return ze.g.m=!1,{value:ot.value,done:!1}}catch(wt){ze.g.v=void 0,ze.g.s(wt)}if(ze.g.m=!1,ze.g.l){if(ot=ze.g.l,ze.g.l=null,ot.F)throw ot.D;return{value:ot.return,done:!0}}return{value:void 0,done:!0}}function ee(ze){this.next=function(ot){return ze.o(ot)},this.throw=function(ot){return ze.s(ot)},this.return=function(ot){return(function(wt,Ke){A(wt.g);var V=wt.g.j;return V?B(wt,"return"in V?V.return:function(ce){return{value:ce,done:!0}},Ke,wt.g.return):(wt.g.return(Ke),z(wt))})(ze,ot)},this[Symbol.iterator]=function(){return this}}function Z(ze,ot){return ot=new ee(new H(ot)),w&&ze.prototype&&w(ot,ze.prototype),ot}if(I.prototype.o=function(ze){this.v=ze},I.prototype.s=function(ze){this.l={D:ze,F:!0},this.h=this.C||this.u},I.prototype.return=function(ze){this.l={return:ze},this.h=this.u},H.prototype.o=function(ze){return A(this.g),this.g.j?B(this,this.g.j.next,ze,this.g.o):(this.g.o(ze),z(this))},H.prototype.s=function(ze){return A(this.g),this.g.j?B(this,this.g.j.throw,ze,this.g.o):(this.g.s(ze),z(this))},d("Array.prototype.entries",(function(ze){return ze||function(){return(function(ot,wt){ot instanceof String&&(ot+="");var Ke=0,V=!1,ce={next:function(){if(!V&&Ke<ot.length){var ge=Ke++;return{value:wt(ge,ot[ge]),done:!1}}return V=!0,{done:!0,value:void 0}}};return ce[Symbol.iterator]=function(){return ce},ce})(this,(function(ot,wt){return[ot,wt]}))}})),typeof Blob<"u"&&(typeof FormData>"u"||!FormData.prototype.keys)){var ae=function(ze,ot){for(var wt=0;wt<ze.length;wt++)ot(ze[wt])},ye=function(ze){return ze.replace(/\r?\n|\r/g,`\r
`)},_e=function(ze,ot,wt){return ot instanceof Blob?(wt=wt!==void 0?wt+"":typeof ot.name=="string"?ot.name:"blob",ot.name===wt&&Object.prototype.toString.call(ot)!=="[object Blob]"||(ot=new File([ot],wt)),[String(ze),ot]):[String(ze),String(ot)]},ue=function(ze,ot){if(ze.length<ot)throw new TypeError(ot+" argument required, but only "+ze.length+" present.")},Ae=typeof globalThis=="object"?globalThis:typeof window=="object"?window:typeof self=="object"?self:this,Ue=Ae.FormData,We=Ae.XMLHttpRequest&&Ae.XMLHttpRequest.prototype.send,Ze=Ae.Request&&Ae.fetch,_n=Ae.navigator&&Ae.navigator.sendBeacon,bn=Ae.Element&&Ae.Element.prototype,Zt=Ae.Symbol&&Symbol.toStringTag;Zt&&(Blob.prototype[Zt]||(Blob.prototype[Zt]="Blob"),"File"in Ae&&!File.prototype[Zt]&&(File.prototype[Zt]="File"));try{new File([],"")}catch{Ae.File=function(ot,wt,Ke){return ot=new Blob(ot,Ke||{}),Object.defineProperties(ot,{name:{value:wt},lastModified:{value:+(Ke&&Ke.lastModified!==void 0?new Date(Ke.lastModified):new Date)},toString:{value:function(){return"[object File]"}}}),Zt&&Object.defineProperty(ot,Zt,{value:"File"}),ot}}var ir=function(ze){return ze.replace(/\n/g,"%0A").replace(/\r/g,"%0D").replace(/"/g,"%22")},Jn=function(ze){this.i=[];var ot=this;ze&&ae(ze.elements,(function(wt){if(wt.name&&!wt.disabled&&wt.type!=="submit"&&wt.type!=="button"&&!wt.matches("form fieldset[disabled] *"))if(wt.type==="file"){var Ke=wt.files&&wt.files.length?wt.files:[new File([],"",{type:"application/octet-stream"})];ae(Ke,(function(V){ot.append(wt.name,V)}))}else wt.type==="select-multiple"||wt.type==="select-one"?ae(wt.options,(function(V){!V.disabled&&V.selected&&ot.append(wt.name,V.value)})):wt.type==="checkbox"||wt.type==="radio"?wt.checked&&ot.append(wt.name,wt.value):(Ke=wt.type==="textarea"?ye(wt.value):wt.value,ot.append(wt.name,Ke))}))};if((t=Jn.prototype).append=function(ze,ot,wt){ue(arguments,2),this.i.push(_e(ze,ot,wt))},t.delete=function(ze){ue(arguments,1);var ot=[];ze=String(ze),ae(this.i,(function(wt){wt[0]!==ze&&ot.push(wt)})),this.i=ot},t.entries=function ze(){var ot,wt=this;return Z(ze,(function(Ke){if(Ke.h==1&&(ot=0),Ke.h!=3)return ot<wt.i.length?Ke=N(Ke,wt.i[ot]):(Ke.h=0,Ke=void 0),Ke;ot++,Ke.h=2}))},t.forEach=function(ze,ot){ue(arguments,1);for(var wt=m(this),Ke=wt.next();!Ke.done;Ke=wt.next()){var V=m(Ke.value);Ke=V.next().value,V=V.next().value,ze.call(ot,V,Ke,this)}},t.get=function(ze){ue(arguments,1);var ot=this.i;ze=String(ze);for(var wt=0;wt<ot.length;wt++)if(ot[wt][0]===ze)return ot[wt][1];return null},t.getAll=function(ze){ue(arguments,1);var ot=[];return ze=String(ze),ae(this.i,(function(wt){wt[0]===ze&&ot.push(wt[1])})),ot},t.has=function(ze){ue(arguments,1),ze=String(ze);for(var ot=0;ot<this.i.length;ot++)if(this.i[ot][0]===ze)return!0;return!1},t.keys=function ze(){var ot,wt,Ke,V,ce=this;return Z(ze,(function(ge){if(ge.h==1&&(ot=m(ce),wt=ot.next()),ge.h!=3)return wt.done?void(ge.h=0):(Ke=wt.value,V=m(Ke),N(ge,V.next().value));wt=ot.next(),ge.h=2}))},t.set=function(ze,ot,wt){ue(arguments,2),ze=String(ze);var Ke=[],V=_e(ze,ot,wt),ce=!0;ae(this.i,(function(ge){ge[0]===ze?ce&&(ce=!Ke.push(V)):Ke.push(ge)})),ce&&Ke.push(V),this.i=Ke},t.values=function ze(){var ot,wt,Ke,V,ce=this;return Z(ze,(function(ge){if(ge.h==1&&(ot=m(ce),wt=ot.next()),ge.h!=3)return wt.done?void(ge.h=0):(Ke=wt.value,(V=m(Ke)).next(),N(ge,V.next().value));wt=ot.next(),ge.h=2}))},Jn.prototype._asNative=function(){for(var ze=new Ue,ot=m(this),wt=ot.next();!wt.done;wt=ot.next()){var Ke=m(wt.value);wt=Ke.next().value,Ke=Ke.next().value,ze.append(wt,Ke)}return ze},Jn.prototype._blob=function(){var ze="----formdata-polyfill-"+Math.random(),ot=[],wt="--"+ze+`\r
Content-Disposition: form-data; name="`;return this.forEach((function(Ke,V){return typeof Ke=="string"?ot.push(wt+ir(ye(V))+`"\r
\r
`+ye(Ke)+`\r
`):ot.push(wt+ir(ye(V))+'"; filename="'+ir(Ke.name)+`"\r
Content-Type: `+(Ke.type||"application/octet-stream")+`\r
\r
`,Ke,`\r
`)})),ot.push("--"+ze+"--"),new Blob(ot,{type:"multipart/form-data; boundary="+ze})},Jn.prototype[Symbol.iterator]=function(){return this.entries()},Jn.prototype.toString=function(){return"[object FormData]"},bn&&!bn.matches&&(bn.matches=bn.matchesSelector||bn.mozMatchesSelector||bn.msMatchesSelector||bn.oMatchesSelector||bn.webkitMatchesSelector||function(ze){for(var ot=(ze=(this.document||this.ownerDocument).querySelectorAll(ze)).length;0<=--ot&&ze.item(ot)!==this;);return-1<ot}),Zt&&(Jn.prototype[Zt]="FormData"),We){var uo=Ae.XMLHttpRequest.prototype.setRequestHeader;Ae.XMLHttpRequest.prototype.setRequestHeader=function(ze,ot){uo.call(this,ze,ot),ze.toLowerCase()==="content-type"&&(this.B=!0)},Ae.XMLHttpRequest.prototype.send=function(ze){ze instanceof Jn?(ze=ze._blob(),this.B||this.setRequestHeader("Content-Type",ze.type),We.call(this,ze)):We.call(this,ze)}}Ze&&(Ae.fetch=function(ze,ot){return ot&&ot.body&&ot.body instanceof Jn&&(ot.body=ot.body._blob()),Ze.call(this,ze,ot)}),_n&&(Ae.navigator.sendBeacon=function(ze,ot){return ot instanceof Jn&&(ot=ot._asNative()),_n.call(this,ze,ot)}),Ae.FormData=Jn}})();const IT=()=>{const t=oe("AREAS");return t.length===0&&t.push(tr.GLOBAL),Xa(t).call(t,((r,s,a)=>{const c=K7(s);return c?a===0?c:"".concat(r,",").concat(c):r}),"")},K7=t=>t===tr.OVERSEA?"".concat(ao.ASIA,",").concat(ao.EUROPE,",").concat(ao.AFRICA,",").concat(ao.NORTH_AMERICA,",").concat(ao.SOUTH_AMERICA,",").concat(ao.OCEANIA):ao[t],E_e=t=>{const r={CODE:"",WEBCS_DOMAIN:[],WEBCS_DOMAIN_BACKUP_LIST:[],PROXY_CS:[],CDS_AP:[],ACCOUNT_REGISTER:[],UAP_AP:[],EVENT_REPORT_DOMAIN:[],EVENT_REPORT_BACKUP_DOMAIN:[],LOG_UPLOAD_SERVER:[],PROXY_SERVER_TYPE3:[]};return t.map((s=>{const a=eP[s],c=Object.keys(a);c&&c.map((d=>{d!=="CODE"&&(r[d]=r[d].concat(a[d]))}))})),r},uP={GLOBAL:{ASIA:[tr.CHINA,tr.JAPAN,tr.INDIA,tr.KOREA,tr.HKMC],EUROPE:[],NORTH_AMERICA:[tr.US],SOUTH_AMERICA:[],OCEANIA:[],AFRICA:[]}},dP=Object.keys(uP[tr.GLOBAL]),Z2=[tr.CHINA,tr.NORTH_AMERICA,tr.EUROPE,tr.ASIA,tr.JAPAN,tr.INDIA,tr.OCEANIA,tr.SOUTH_AMERICA,tr.AFRICA,tr.KOREA,tr.HKMC,tr.US],v_e=function(t,r){let s=[];if(rt(t).call(t,tr.GLOBAL)){const d=[tr.GLOBAL,tr.OVERSEA],h=Object.keys(eP);if(r===tr.GLOBAL)throw new ke(te.INVALID_PARAMS,"GLOBAL is an invalid excludedArea value");if(r===tr.CHINA)s=[tr.OVERSEA];else if(c=r,rt(dP).call(dP,c)){const m=(a=r,uP[tr.GLOBAL][a]||[]),g=[...d,r,...m];s=h.filter((v=>!rt(g).call(g,v)))}else if((function(m){let g=!1;return dP.forEach((v=>{var w;rt(w=uP[tr.GLOBAL][v]).call(w,m)&&(g=!0)})),g})(r)){const m=(function(v){let w;return dP.forEach((I=>{var A;rt(A=uP[tr.GLOBAL][I]).call(A,v)&&(w=I)})),w})(r),g=[...d,m,r];s=h.filter((v=>!rt(g).call(g,v)))}else s=t;s=(function(m){const g=[];return Z2.forEach((v=>{rt(m).call(m,v)&&g.push(v)})),g.concat(m.filter((v=>!rt(Z2).call(Z2,v))))})(s)}else s=t;var a,c;return s};function q7(t){var r,s;if(!t&&rt(r=oe("AREAS")).call(r,tr.EXTENSIONS))return M.debug("update area from ap : reset"),void eM(Age,!0);if(!rt(s=oe("AREAS")).call(s,tr.GLOBAL)||!t)return;let a=eP.EXTENSIONS;a&&(a={CODE:K7(tr.EXTENSIONS),WEBCS_DOMAIN:["ap-web-1-".concat(t,".agora.io")],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-".concat(t,".ap.sd-rtn.com")],PROXY_CS:["proxy-ap-web-".concat(t,".agora.io")],CDS_AP:["cds-ap-web-1-".concat(t,".agora.io"),"cds-ap-web-2-".concat(t,".ap.sd-rtn.com")],ACCOUNT_REGISTER:["sua-ap-web-1-".concat(t,".agora.io"),"sua-ap-web-2-".concat(t,".ap.sd-rtn.com")],UAP_AP:["uap-ap-web-1-".concat(t,".agora.io"),"uap-ap-web-2-".concat(t,".ap.sd-rtn.com")],EVENT_REPORT_DOMAIN:["statscollector-1-".concat(t,".agora.io")],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-".concat(t,".agora.io")],LOG_UPLOAD_SERVER:["logservice-".concat(t,".agora.io")],PROXY_SERVER_TYPE3:["webrtc-cloud-proxy-".concat(t,".agora.io")]},M.debug("update area from ap success: ".concat(t,",config is "),a),gr("AREAS",[tr.EXTENSIONS],!0),Object.keys(a).map((c=>{c==="LOG_UPLOAD_SERVER"||c==="EVENT_REPORT_DOMAIN"||c==="EVENT_REPORT_BACKUP_DOMAIN"||c==="PROXY_SERVER_TYPE3"?gr(c,a[c][0]):gr(c,a[c])})))}function eM(t){let r=arguments.length>1&&arguments[1]!==void 0&&arguments[1];const s=It.reportApiInvoke(null,{name:pi.SET_AREA,options:t,tag:$r.TRACER});try{let a=[];if(typeof t=="string"&&(a=[t]),Array.isArray(t)&&(t.forEach((d=>{if(!rt(m7).call(m7,d))throw new ke(te.INVALID_PARAMS,"invalid area code")})),a=t),Object.prototype.toString.call(t)==="[object Object]"){const{areaCode:d,excludedArea:h}=t;if(!d)throw new ke(te.INVALID_PARAMS,"area code is needed");let m=d;typeof d=="string"&&(m=[d]),a=h?v_e(m,h):m}if(!r){if(Jd.AREAS){const d=new ke(te.PROHIBITED_OPERATION,"setArea is prohibited because of config-distribute");return s.onError(d),void M.warning("setArea is prohibited because of config-distribute")}if(rt(a).call(a,tr.GLOBAL)&&oe("AREAS")===tr.EXTENSIONS){const d=new ke(te.PROHIBITED_OPERATION,"setArea is prohibited because of ap extensions");return s.onError(d),void M.warning("setArea is prohibited because of ap extensions")}}gr("AREAS",a,r);const c=E_e(a);Object.keys(c).map((d=>{d==="LOG_UPLOAD_SERVER"||d==="EVENT_REPORT_DOMAIN"||d==="EVENT_REPORT_BACKUP_DOMAIN"||d==="PROXY_SERVER_TYPE3"?gr(d,c[d][0]):gr(d,c[d])})),M.debug("set area success:",a.join(","))}catch(a){throw s.onError(a),a}s.onSuccess()}function Y7(t,r){var s=Object.keys(t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);r&&(a=a.filter((function(c){return Object.getOwnPropertyDescriptor(t,c).enumerable}))),s.push.apply(s,a)}return s}function dp(t){for(var r=1;r<arguments.length;r++){var s=arguments[r]!=null?arguments[r]:{};r%2?Y7(Object(s),!0).forEach((function(a){X(t,a,s[a])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(s)):Y7(Object(s)).forEach((function(a){Object.defineProperty(t,a,Object.getOwnPropertyDescriptor(s,a))}))}return t}let tM=1;function S_e(t,r,s,a,c){tM+=1;const d={sid:s.sid,command:"convergeAllocateEdge",uid:"666",appId:s.appId,ts:Math.floor(Date.now()/1e3),seq:tM,requestId:tM,version:Zl,cname:s.cname},h={service_name:r,json_body:JSON.stringify(d)};let m,g,v=t[0];return Xd((async()=>{m=Date.now();const w=await th(v,{data:h,cancelToken:a,headers:{"X-Packet-Service-Type":"0","X-Packet-URI":"61"}});if(g=Date.now()-m,w.code!==0){const N=new ke(te.UNEXPECTED_RESPONSE,"live streaming ap error, code"+w.code,{retry:!0,responseTime:g});throw M.error(N.toString()),N}const I=JSON.parse(w.json_body);if(I.code!==200){const N=new ke(te.UNEXPECTED_RESPONSE,"live streaming app center error, code: ".concat(I.code,", reason: ").concat(I.reason),{code:I.code,responseTime:g});throw M.error(N.toString()),N}if(!I.servers||I.servers.length===0){const N=new ke(te.UNEXPECTED_RESPONSE,"live streaming app center empty server",{code:I.code,responseTime:g});throw M.error(N.toString()),N}const A=(function(N,H){return{addressList:N.servers.map((B=>"wss://".concat(B.address.replace(/\./g,"-"),".").concat(oe("WORKER_DOMAIN"),":").concat(B.wss,"?serviceName=").concat(encodeURIComponent(H)))),workerToken:N.workerToken,vid:N.vid}})(I,r);return oe("LIVE_STREAMING_ADDRESS")&&(A.addressList=oe("LIVE_STREAMING_ADDRESS")instanceof Array?oe("LIVE_STREAMING_ADDRESS"):[oe("LIVE_STREAMING_ADDRESS")]),dp(dp({},A),{},{responseTime:g})}),((w,I)=>(It.apworkerEvent(s.sid,{success:!0,sc:200,serviceName:r,responseDetail:JSON.stringify(w.addressList),firstSuccess:I===0,responseTime:g,serverIp:t[I%t.length]}),!1)),((w,I)=>(It.apworkerEvent(s.sid,{success:!1,sc:w.data&&w.data.code||200,serviceName:r,responseTime:g,serverIp:t[I%t.length]}),!!(w.code!==te.OPERATION_ABORTED&&w.code!==te.UNEXPECTED_RESPONSE||w.data&&w.data.retry)&&(v=t[(I+1)%t.length],!0))),c)}let nM=1;function X7(t,r,s,a){let{url:c,areaCode:d}=t;const{clientId:h,sid:m}=r,g=Date.now();let v;const w=r.role,[I,A]=iM(r,d,[Pi.CHOOSE_SERVER]);let N=Ai.networkState;return Xd((async()=>{N&&Ai.networkState===Nc.OFFLINE&&Ai.onlineWaiter&&await mt.race([Ai.onlineWaiter,Is(a&&a.maxRetryTimeout||Vi.maxRetryTimeout)]),N=Ai.networkState;const{data:H,headers:B}=await th(c,{data:I,cancelToken:s,headers:{"Content-Type":"multipart/form-data;"}},!0,!0);v=B.http3==="1"?1:-1,It.reportResourceTiming(c,m),Q7(H,c,r,g,[Pi.CHOOSE_SERVER],v);const z=wT(H,Pi.CHOOSE_SERVER);return rM(z),K2(z,c)}),(H=>(H&&It.joinChooseServer(m,{role:w,lts:g,succ:!0,csAddr:c,opid:A,serverList:H.gatewayAddrs.map((B=>B.address)),ec:null,cid:H.cid.toString(),uid:H.uid.toString(),csIp:H.csIp,unilbsServerIds:[Pi.CHOOSE_SERVER].toString(),isHttp3:v,corssRegionTagReq:r.apRequestDetail,corssRegionTagRes:H.res.detail&&H.res.detail[38]}),!1)),(H=>H.code!==te.OPERATION_ABORTED&&(H.code===te.CAN_NOT_GET_GATEWAY_SERVER?H.data.retry:(It.joinChooseServer(m,{role:w,lts:g,succ:!1,csAddr:c,serverList:null,opid:A,ec:H.code,csIp:H.data&&H.data.csIp,unilbsServerIds:[Pi.CHOOSE_SERVER].toString(),extend:JSON.stringify({networkState:N}),isHttp3:v,corssRegionTagReq:r.apRequestDetail}),M.warning("[".concat(h||"sid-".concat(m.slice(0,6)),"] Choose server network error, retry"),H),!0))),a)}function J7(t,r,s,a){let c,{url:d,areaCode:h,serviceIds:m}=t;const g=Date.now(),v=r.role,[w,I]=iM(r,h,m);let A;return Xd((async()=>{A&&Ai.networkState===Nc.OFFLINE&&Ai.onlineWaiter&&await mt.race([Ai.onlineWaiter,Is(a&&a.maxRetryTimeout||Vi.maxRetryTimeout)]),A=Ai.networkState;const{data:N,headers:H}=await th(d,{data:w,cancelToken:s,headers:{"Content-Type":"multipart/form-data;"}},!0,!0);c=H.http3==="1"?1:-1,It.reportResourceTiming(d,r.sid),Q7(N,d,r,g,m,c);const B=wT(N,Pi.CHOOSE_SERVER),z=wT(N,r.cloudProxyServer==="proxy5"?Pi.CLOUD_PROXY_5:r.cloudProxyServer==="proxy3"||r.cloudProxyServer==="proxy4"?Pi.CLOUD_PROXY:Pi.CLOUD_PROXY_FALLBACK),ee=performance.getEntriesByName(d),Z=ee[ee.length-1];let ae;return Z&&(ae={name:Z.name,protocol:"nextHopProtocol"in Z?Z.nextHopProtocol:"",dnscost:"domainLookupEnd"in Z&&"domainLookupStart"in Z&&typeof Z.domainLookupEnd=="number"&&typeof Z.domainLookupStart=="number"?Z.domainLookupEnd-Z.domainLookupStart:-1,tcpTlsCost:"connectEnd"in Z&&"connectStart"in Z&&typeof Z.connectEnd=="number"&&typeof Z.connectStart=="number"?Z.connectEnd-Z.connectStart:-1,reqCost:"requestStart"in Z&&typeof Z.requestStart=="number"&&"responseEnd"in Z&&typeof Z.responseEnd=="number"?Z.responseEnd-Z.requestStart:-1,handleCost:"leave_ts"in N&&"enter_ts"in N&&typeof N.leave_ts=="number"&&typeof N.enter_ts=="number"?N.leave_ts-N.enter_ts:-1}),rM(B),{gatewayInfo:K2(B,d),proxyInfo:z,url:d,resourceTimingInfo:ae}}),(N=>(N.gatewayInfo&&It.joinChooseServer(r.sid,{role:v,lts:g,succ:!0,csAddr:d,serverList:N.gatewayInfo.gatewayAddrs.map((H=>H.address)),ec:null,opid:I,cid:N.gatewayInfo.cid.toString(),uid:N.gatewayInfo.uid.toString(),csIp:N.gatewayInfo.csIp,unilbsServerIds:m.toString(),isHttp3:c,corssRegionTagReq:r.apRequestDetail,corssRegionTagRes:N.gatewayInfo.res.detail&&N.gatewayInfo.res.detail[38],resourceTimingInfo:N.resourceTimingInfo?JSON.stringify(N.resourceTimingInfo):void 0}),N.proxyInfo&&It.joinWebProxyAP(r.sid,{lts:g,sucess:1,apServerAddr:d,turnServerAddrList:N.proxyInfo.addresses.map((H=>H.ip)).join(","),errorCode:null,eventType:r.cloudProxyServer,unilbsServerIds:m.toString()}),!1)),(N=>N.code!==te.OPERATION_ABORTED&&(N.code===te.CAN_NOT_GET_GATEWAY_SERVER?N.data.retry:(It.joinWebProxyAP(r.sid,{lts:g,sucess:0,apServerAddr:d,turnServerAddrList:null,errorCode:N.code,eventType:r.cloudProxyServer,unilbsServerIds:m.toString(),extend:JSON.stringify({networkState:A})}),M.warning("[".concat(r.clientId,"] multi unilbs network error, retry"),N),!0))),a)}const Q7=(t,r,s,a,c,d)=>{const{sid:h,clientId:m,cloudProxyServer:g}=s,v=[],w=I=>{I.flag===4096?It.joinChooseServer(h,{role:s.role,lts:a,succ:!1,csAddr:r,opid:t.opid,serverList:null,ec:I.error.message,csIp:I.error.data&&I.error.data.csIp,unilbsServerIds:c.toString(),isHttp3:d,corssRegionTagReq:s.apRequestDetail}):I.flag!==1048576&&I.flag!==4194304&&I.flag!==4194310||It.joinWebProxyAP(h,{lts:a,sucess:0,apServerAddr:r,turnServerAddrList:null,errorCode:I.error.code,eventType:g,unilbsServerIds:c.toString()})};if(t.response_body.forEach((I=>{const A=I.buffer.code;if(I.uri===23&&A===0&&!I.buffer.edges_services)if(I.buffer.flag===4194310)M.warning("no edge services in ap response of proxy fallback, will not set proxy in iceServers"),I.buffer.edges_services=[];else{const N={error:new ke(te.CAN_NOT_GET_GATEWAY_SERVER,"no edge services in ap response",{retry:!0,csIp:t.detail[502]}),flag:I.buffer.flag};v.push(N),w(N)}if(A!==0){const N=S0(A),H={error:new ke(te.CAN_NOT_GET_GATEWAY_SERVER,N.desc,{desc:N.desc,retry:N.retry,csIp:t.detail[502]}),flag:I.buffer.flag};I.buffer.flag===4194310?M.warning(H.error.toString()):v.push(H),w(H)}})),v.length)throw M.warning("[".concat(m||"sid-".concat(h.slice(0,6)),"] multi unilbs ").concat(r," failed, ").concat(v.map((I=>"flag: ".concat(I.flag,", message: ").concat(I.error.message,", retry: ").concat(I.error.data.retry))).join(" | "))),new ke(te.CAN_NOT_GET_GATEWAY_SERVER,v.map((I=>"flag: ".concat(I.flag,", message: ").concat(I.error.message))).join(" | "),{retry:!!v.find((I=>I.error.data.retry)),csIp:t.detail[502],desc:[...new Set(v.map((I=>{var A;return I==null||(A=I.error)===null||A===void 0||(A=A.data)===null||A===void 0?void 0:A.desc})).filter((I=>!!I)))]})},rM=t=>{var r,s,a,c;if(t.addresses&&t.addresses.length===0&&t.code===0)throw new ke(te.CAN_NOT_GET_GATEWAY_SERVER,"void gateway address",{retry:!0,csIp:t.detail&&t.detail[502]});if(oe("AP_AREA")&&((a=t.detail)!==null&&a!==void 0&&a[23]&&typeof((c=t.detail)===null||c===void 0?void 0:c[23])=="string"?q7(t.detail[23].toLowerCase()):q7()),(r=t.detail)!==null&&r!==void 0&&r[19]&&typeof((s=t.detail)===null||s===void 0?void 0:s[19])=="string"){const h=t.detail[19],m=h==null?void 0:h.split(";");for(let g=0;g<m.length;g++){var d;const v=Bo(d=m[g]).call(d);t.addresses[g]&&m&&(t.addresses[g].fingerprint=v)}}if(oe("GATEWAY_ADDRESS")&&oe("GATEWAY_ADDRESS").length>0){M.debug("assign gateway address to",oe("GATEWAY_ADDRESS"));const h=oe("GATEWAY_ADDRESS").map((m=>{var g,v;const w=(g=(v=t.addresses.find((I=>I.ip===m.ip&&I.port===m.port)))===null||v===void 0?void 0:v.fingerprint)!==null&&g!==void 0?g:"";return{ip:m.ip,port:m.port,ticket:t.addresses[0]&&t.addresses[0].ticket,fingerprint:w}}));t.addresses=h}},b_e=(t,r)=>{if(t.response_body&&t.response_body.length){const s=t.response_body[0];if(s.buffer.code!==0){const a=S0(s.buffer.code);throw new ke(te.UPDATE_TICKET_FAILED,"[".concat(s.buffer.code,"]: ").concat(a.desc),{retry:a.retry})}return s.buffer.ticket}throw M.debug("update ticket request received ap response without response body:",r),new ke(te.UPDATE_TICKET_FAILED,"cannot find response body from ap response",{retry:!1})},iM=(t,r,s)=>{const a=Math.floor(Math.random()*1e12),c=t.role==="host"?"1":t.role==="audience"?"2":void 0,d={appid:t.appId,client_ts:Date.now(),opid:a,sid:t.sid,request_bodies:[{uri:22,buffer:{cname:t.cname,detail:dp(dp(dp({6:t.stringUid,11:r,12:oe("USE_NEW_TOKEN")?"1":void 0},c?{17:c}:{}),{},{22:r},t.apRequestDetail?{33:t.apRequestDetail}:{}),t.apRTM?{26:"RTM2"}:{}),key:t.token,service_ids:s,uid:t.uid||0}}]};d.request_bodies.forEach((m=>{t.multiIP&&t.multiIP.gateway_ip&&(m.buffer.detail[5]=JSON.stringify({vocs_ip:[t.multiIP.uni_lbs_ip],vos_ip:[t.multiIP.gateway_ip]}))}));const h=new FormData;return h.append("request",JSON.stringify(d)),[h,a]},w_e=(t,r)=>{const s=Math.floor(Math.random()*1e12),a={appid:t.appId,client_ts:Date.now(),opid:s,sid:t.sid,request_bodies:[{uri:28,buffer:{cname:t.cname,detail:{1:"",6:t.stringUid,12:"1"},token:t.token,service_ids:r,uid:t.uid||0,edges_services:t.apResponse.addresses.map((d=>({ip:d.ip,port:d.port})))}}]},c=new FormData;return c.append("request",JSON.stringify(a)),[c,s]};let C0=0;function R0(t){return mt.all(t.map((r=>r.then((s=>{throw s}),(s=>s))))).then((r=>{throw r}),(r=>r))}const AT=async t=>{let{fragementLength:r,referenceList:s,asyncMapHandler:a,allFailedhandler:c,promisesCollector:d}=t,h=0;const m=r;let g,v=0;const w=async()=>{const I=(()=>{const A=h*m,N=A+m;return s.slice(A,N).map(a)})();d&&d.push(...I);try{g=await R0(I)}catch(A){if(v+=m,h++,!(v>=s.length))return void await w();c(A)}I.forEach((A=>A.cancel()))};return await w(),g},Z7=async t=>{let{referenceList:r,asyncMapHandler:s,closeFn:a}=t;const c=r.length;let d=0;const h=async()=>{const m=s(r.shift());try{return await m}catch(g){if(d++,d>=c||a!=null&&a(g))throw g;return h()}};return h()};async function T_e(){if(typeof VideoDecoder>"u")return!0;let t;const r=[18,0,10,13,0,0,0,3,180,253,144,6,136,8,8,8,32,50,85,16,66,128,2,8,32,132,0,8,0,180,90,204,169,166,242,109,241,190,143,149,160,133,4,144,43,122,168,159,120,159,205,39,82,131,57,52,87,187,68,23,248,134,204,226,97,17,49,183,55,236,219,249,221,98,208,215,190,59,179,167,213,47,1,246,150,14,194,245,159,83,35,64,103,218,38,21,82,3,135,21,185,84,248,134],s=[18,0,10,13,0,0,0,3,180,253,144,6,136,8,8,8,32,50,87,16,66,128,2,8,32,132,0,8,0,180,90,204,169,166,242,109,241,190,143,148,62,134,140,92,172,141,77,35,94,181,164,65,169,65,156,154,43,221,162,11,252,67,102,113,48,136,137,219,62,43,113,239,23,126,250,186,252,10,138,218,25,193,244,74,68,194,209,107,23,52,206,199,78,72,98,103,151,71,96,62,51,210,158,72,231,158],a=[18,0,10,13,0,0,0,3,180,253,144,6,136,8,8,8,32,50,87,16,66,128,2,8,32,132,0,8,0,180,90,204,169,166,242,109,241,190,143,143,233,163,51,196,98,95,151,224,22,134,33,240,150,248,67,18,34,196,142,81,238,173,140,80,205,232,132,144,67,12,131,157,4,171,243,86,122,35,6,166,184,243,85,126,13,206,103,152,62,168,160,187,2,241,138,52,211,72,121,128,151,63,147,128,19,42],c=[18,0,50,138,1,48,192,64,253,248,65,17,67,192,32,0,16,0,0,0,0,0,0,0,195,12,48,144,64,32,0,209,75,61,9,204,25,115,79,226,115,63,63,208,70,210,220,153,126,241,237,37,107,195,153,1,99,112,230,189,209,169,130,10,11,22,167,215,159,205,197,7,183,162,26,48,254,141,134,103,32,16,235,45,1,15,18,119,169,110,206,251,51,115,202,60,148,1,46,39,109,25,28,86,168,15,77,211,239,2,58,43,146,26,230,184,81,48,140,226,226,250,222,146,171,133,164,13,188,180,64,122,142,146,32,208,238,170,193,35,53,44,225],d=[18,0,50,107,48,0,133,125,248,65,26,195,64,62,32,31,16,0,0,0,0,0,1,4,16,64,144,64,32,0,204,24,122,65,56,165,18,52,206,218,4,187,51,97,9,29,191,90,253,106,185,31,197,155,52,205,245,185,203,131,20,226,25,124,95,113,220,113,141,15,15,104,211,144,152,237,150,157,127,51,143,24,231,218,171,255,176,241,128,229,149,150,148,66,245,228,91,27,182,228,136,61,182,237,133,45,220,24,103,214,152],h=[18,0,50,122,48,1,9,253,248,65,26,67,64,62,32,31,16,0,0,0,0,0,1,4,16,64,144,64,32,0,198,182,231,242,220,235,163,140,12,36,36,166,46,132,210,4,71,23,218,132,27,30,17,45,244,79,31,243,195,136,100,169,76,88,142,85,204,217,121,168,29,163,198,17,251,223,73,12,212,244,139,123,151,179,75,216,96,208,136,40,229,42,59,149,10,116,228,85,99,93,221,108,255,140,248,20,30,167,122,109,206,164,108,197,110,251,23,243,133,160,63,13,207,177,12,128];return await new mt(((g,v)=>{let w;(async function(){t&&t.state!=="closed"||await(async function(){t=new VideoDecoder({output:A=>{A.close(),clearTimeout(w),g(!0)},error:A=>{clearTimeout(w),g(!1)}}),await t.configure({codec:"av01.0.05M.08",width:160,height:90})})();const I=[r,s,a,c,d,h];for(let A=0;A<I.length;A++){const N=new EncodedVideoChunk({type:A==0?"key":"delta",timestamp:33333*A,duration:33333,data:new Uint8Array(I[A])});try{await t.decode(N)}catch{return void g(!1)}}})(),w=setTimeout((()=>{g(!1)}),5e3)}))}async function sM(t,r,s,a){return{gatewayInfo:await(async function(d,h,m,g){let v=null;const w=[],I=async()=>{const N=oe("WEBCS_DOMAIN").slice(0,oe("AJAX_REQUEST_CONCURRENT")).map((z=>({url:d.proxyServer?"https://".concat(d.proxyServer,"/ap/?url=").concat(z+"/api/v2/transpond/webrtc?v=2"):"https://".concat(z,"/api/v2/transpond/webrtc?v=2"),areaCode:IT()}))),H=g.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"chooseServer",urls:N.map((z=>z.url))}),B=await AT({fragementLength:oe("FRAGEMENT_LENGTH"),referenceList:N,asyncMapHandler:z=>(M.debug("[".concat(d.clientId,"] Connect to choose_server:"),z.url),X7(z,d,h,m)),allFailedhandler:z=>{throw g.recordJoinChannelService({endTs:Date.now(),status:"error",errors:z},H),z[0]},promisesCollector:w});return g.recordJoinChannelService({endTs:Date.now(),status:"success"},H),B},A=async()=>{if(await Is(1e3),v!==null)return v;const N=oe("WEBCS_DOMAIN_BACKUP_LIST").map((z=>({url:d.proxyServer?"https://".concat(d.proxyServer,"/ap/?url=").concat(z+"/api/v2/transpond/webrtc?v=2"):"https://".concat(z,"/api/v2/transpond/webrtc?v=2"),areaCode:IT()}))),H=g.recordJoinChannelService({endTs:void 0,startTs:Date.now(),status:"pending",service:"chooseServer",urls:N.map((z=>z.url))}),B=await AT({fragementLength:oe("FRAGEMENT_LENGTH"),referenceList:N,asyncMapHandler:z=>(M.debug("[".concat(d.clientId,"] Connect to backup choose_server:"),z.url),X7(z,d,h,m)),allFailedhandler:z=>{throw g.recordJoinChannelService({endTs:Date.now(),status:"error",errors:z},H),z[0]},promisesCollector:w});return g.recordJoinChannelService({endTs:Date.now(),status:"success"},H),B};try{return v=await R0([I(),A()]),w.length&&w.forEach((N=>N.cancel&&typeof N.cancel=="function"&&N.cancel())),v}catch(N){throw N[0]}})(t,r,s,a)}}async function eH(t,r,s,a,c){const d=t.cloudProxyServer;if(d==="disabled"){if(t.useLocalAccessPoint)return await sM(t,r,s,c);if(oe("JOIN_WITH_FALLBACK_MEDIA_PROXY")){const{gatewayInfo:A,proxyInfo:N}=await rH(t,r,s,c);if(t.turnServer&&t.turnServer.mode!=="auto")return{gatewayInfo:A};const H=N.map((B=>({turnServerURL:B.address,tcpport:B.tcpport||Ws.tcpport,udpport:B.udpport||Ws.udpport,username:B.username||Ws.username,password:B.password||Ws.password,forceturn:!1,security:!0})));if(c.useP2P){var h;const B=(h=t.uid)!==null&&h!==void 0?h:A.uid,z="glb:".concat(B.toString()),ee=await qL(z),Z=N.map((ae=>({turnServerURL:ae.address,tcpport:ae.tcpport||Ws.tcpport,udpport:ae.udpport||Ws.udpport,username:z,password:ee,forceturn:!1,security:!0})));H.push(...Z)}return t.turnServer={mode:"manual",servers:H},{gatewayInfo:A}}return await sM(t,r,s,c)}const{proxyInfo:m,gatewayInfo:g}=await rH(t,r,s,c),v={gatewayInfo:g},w=m.map((A=>({turnServerURL:A.address,tcpport:d==="proxy3"?void 0:A.tcpport?A.tcpport:Ws.tcpport,udpport:d==="proxy4"?void 0:A.udpport?A.udpport:Ws.udpport,username:A.username||Ws.username,password:A.password||Ws.password,forceturn:d!=="proxy4",security:d==="proxy5"})));if(c.useP2P){var I;const A=(I=t.uid)!==null&&I!==void 0?I:g.uid,N="glb:".concat(A.toString()),H=await qL(N),B=m.map((z=>({turnServerURL:z.address,tcpport:d==="proxy3"?void 0:z.tcpport||Ws.tcpport,udpport:d==="proxy4"?void 0:z.udpport||Ws.udpport,username:N,password:H,forceturn:d!=="proxy4",security:d==="proxy5"})));w.push(...B)}return t.turnServer={mode:"manual",servers:w},M.debug("[".concat(t.clientId,"] set proxy server: ").concat(t.proxyServer,", mode: ").concat(d)),v}async function tH(t,r,s,a,c){const d=oe("ACCOUNT_REGISTER").slice(0,oe("AJAX_REQUEST_CONCURRENT"));let h=[];h=r.proxyServer?d.map((g=>"https://".concat(r.proxyServer,"/ap/?url=").concat(g+"/api/v1"))):d.map((g=>"https://".concat(g,"/api/v1")));const m=c==null?void 0:c.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"stringUID",urls:h});try{const g=await(async function(v,w,I,A,N){const H=Date.now(),B={sid:I.sid,opid:10,appid:I.appId,string_uid:w};let z=v[0];const ee=await Xd((()=>th(z+"".concat(z.indexOf("?")===-1?"?":"&","action=stringuid"),{data:B,cancelToken:A,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":72}})),((Z,ae)=>{if(Z.code===0){if(Z.uid<=0||Z.uid>=Math.pow(2,32))throw M.error("Invalid Uint Uid ".concat(w," => ").concat(Z.uid),Z),It.reqUserAccount(B.sid,{lts:H,success:!1,serverAddr:z,stringUid:B.string_uid,uid:Z.uid,errorCode:te.INVALID_UINT_UID_FROM_STRING_UID,extend:B}),new ke(te.INVALID_UINT_UID_FROM_STRING_UID);return It.reqUserAccount(B.sid,{lts:H,success:!0,serverAddr:z,stringUid:B.string_uid,uid:Z.uid,errorCode:null,extend:B}),!1}const ye=S0(Z.code);return ye.retry&&(z=v[(ae+1)%v.length]),It.reqUserAccount(B.sid,{lts:H,success:!1,serverAddr:z,stringUid:B.string_uid,uid:Z.uid,errorCode:ye.desc,extend:B}),ye.retry}),((Z,ae)=>Z.code!==te.OPERATION_ABORTED&&(It.reqUserAccount(B.sid,{lts:H,success:!1,serverAddr:z,stringUid:B.string_uid,uid:null,errorCode:Z.code,extend:B}),z=v[(ae+1)%v.length],!0)),N);if(ee.code!==0){const Z=S0(ee.code);throw new ke(te.UNEXPECTED_RESPONSE,Z.desc)}return ee})(h,t,r,s,a);return c==null||c.recordJoinChannelService({status:"success",endTs:Date.now()},m),g.uid}catch(g){throw c==null||c.recordJoinChannelService({status:"error",endTs:Date.now(),errors:[g]},m),g}}async function C_e(t,r,s){const a=oe("ACCOUNT_REGISTER");let c=[];c=r.proxyServer?a.map((d=>"https://".concat(r.proxyServer,"/ap/?url=").concat(d+"/api/v1"))):a.map((d=>"https://".concat(d,"/api/v1")));try{return await Z7({referenceList:c,asyncMapHandler:h=>(async function(m,g,v,w){const I=Date.now(),A={sid:v.sid,opid:10,appid:v.appId,string_uid:g};try{const N=await th(m+"".concat(m.indexOf("?")===-1?"?":"&","action=stringuid"),{data:A,cancelToken:w,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":72}});if(N.code!==0){const H=S0(N.code);throw new ke(te.UNEXPECTED_RESPONSE,"preload sua error:".concat(H.desc),H)}if(N.uid<=0||N.uid>=Math.pow(2,32))throw new ke(te.INVALID_UINT_UID_FROM_STRING_UID);return{requestTime:I,url:m,req:A,uid:N.uid,elapse:Date.now()-I}}catch(N){throw N}})(h,t,r,s),closeFn:h=>h.code===te.OPERATION_ABORTED||h.code===te.UNEXPECTED_RESPONSE&&!h.data.retry})}catch(d){throw d}}async function R_e(t,r,s){const a=oe("CDS_AP").slice(0,oe("AJAX_REQUEST_CONCURRENT")).map((g=>t.proxyServer?"https://".concat(t.proxyServer,"/ap/?url=").concat(g+"/api/v1"):"https://".concat(g,"/api/v1?action=config"))),c=a.map((g=>(function(v,w,I,A){const N=Mn(),H={flag:64,cipher_method:0,features:dp(dp(dp(dp(dp({install_id:s2(),device:N.name,system:N.os,system_general:navigator.userAgent,vendor:w.appId,version:Zl,cname:w.cname,session_id:w.sid,proxyServer:w.proxyServer,sdk_type:g_e.WEB_RTC,browser_name:N.name,browser_version:N.version,user_agent:navigator.userAgent,channel_name:w.cname},w.stringUid&&{string_uid:w.stringUid}),w.uid&&{uid:w.uid+""}),N.os&&{os_name:N.os}),N.osVersion&&{os_version:N.osVersion}),{},{detail:""})};return Xd((()=>th(v,{data:H,timeout:1e3,cancelToken:I,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":54}})),void 0,(B=>B.code!==te.OPERATION_ABORTED),A)})(g,t,r,s)));let d=null,h=null,m={};try{d=await R0(c)}catch(g){if(g.code===te.OPERATION_ABORTED)throw g;h=g}if(c.forEach((g=>g.cancel())),It.reportApiInvoke(t.sid,{name:pi.REQUEST_CONFIG_DISTRIBUTE,options:{error:h,res:d}}).onSuccess(),d&&d.test_tags)try{m=(function(g){if(!g.test_tags)return{};const v=g.test_tags,w=Object.keys(v),I={};return w.forEach((A=>{var N;const H=Bo(N=A.slice(4)).call(N),B=JSON.parse(v[A]),z=B[1];I[H]={tag:B[0]||"",value:z}})),I})(d)}catch{}return m}async function nH(t,r){const s=oe("WEBCS_DOMAIN").concat(oe("WEBCS_DOMAIN_BACKUP_LIST")).map((a=>({url:"https://".concat(a,"/api/v2/transpond/webrtc?v=2"),areaCode:IT(),serviceIds:[Pi.CHOOSE_SERVER,Pi.CLOUD_PROXY_FALLBACK]})));try{return await Z7({referenceList:s,asyncMapHandler:c=>(async function(d,h,m){let g,{url:v,areaCode:w,serviceIds:I}=d;const A=Date.now(),[N,H]=iM(h,w,I);let B=Ai.networkState;try{B&&Ai.networkState===Nc.OFFLINE&&Ai.onlineWaiter&&await mt.race([Ai.onlineWaiter,Is(Vi.maxRetryTimeout)]),B=Ai.networkState;const{data:z,headers:ee}=await th(v,{data:N,cancelToken:m,headers:{"Content-Type":"multipart/form-data;"}},!0,!0);g=ee.http3==="1"?1:-1,(_e=>{const ue=[];if(_e.response_body.forEach((Ae=>{const Ue=Ae.buffer.code;if(Ae.uri===23&&Ue===0&&!Ae.buffer.edges_services)if(Ae.buffer.flag===4194310)Ae.buffer.edges_services=[];else{const We={error:new ke(te.CAN_NOT_GET_GATEWAY_SERVER,"no edge services in ap response",{retry:!0,csIp:_e.detail[502]}),flag:Ae.buffer.flag};ue.push(We)}if(Ue!==0){const We=S0(Ue),Ze={error:new ke(te.CAN_NOT_GET_GATEWAY_SERVER,We.desc,{desc:We.desc,retry:We.retry,csIp:_e.detail[502]}),flag:Ae.buffer.flag};Ae.buffer.flag===4194310?M.warning(Ze.error.toString()):ue.push(Ze)}})),ue.length)throw new ke(te.CAN_NOT_GET_GATEWAY_SERVER,ue.map((Ae=>"flag: ".concat(Ae.flag,", message: ").concat(Ae.error.message))).join(" | "),{retry:!!ue.find((Ae=>Ae.error.data.retry)),csIp:_e.detail[502],desc:[...new Set(ue.map((Ae=>{var Ue;return Ae==null||(Ue=Ae.error)===null||Ue===void 0||(Ue=Ue.data)===null||Ue===void 0?void 0:Ue.desc})).filter((Ae=>!!Ae)))]})})(z);const ae=wT(z,Pi.CHOOSE_SERVER),ye=wT(z,Pi.CLOUD_PROXY_FALLBACK);return rM(ae),{gatewayInfo:K2(ae,v),proxyInfo:ye,opid:H,requestTime:A,url:v,isHttp3:g,elapse:Date.now()-A}}catch(z){throw z}})(c,t,r),closeFn:c=>c.code===te.OPERATION_ABORTED||c.code===te.CAN_NOT_GET_GATEWAY_SERVER&&!c.data.retry})}catch(a){throw a}}async function rH(t,r,s,a){const c=oe("PROXY_SERVER_TYPE3"),d=(N,H,B)=>{let z=B||c;return Array.isArray(z)&&(z=H%2==0&&c[1]||c[0]),"https://".concat(z,"/ap/?url=").concat(N)};let h=null;const m=[],g=async()=>{const N=oe("WEBCS_DOMAIN").slice(0,oe("AJAX_REQUEST_CONCURRENT")).map(((z,ee)=>{let Z;return Z=t.cloudProxyServer==="disabled"&&t.proxyServer?d("".concat(z,"/api/v2/transpond/webrtc?v=2"),ee,t.proxyServer):t.cloudProxyServer==="disabled"||t.cloudProxyServer==="fallback"?"https://".concat(z,"/api/v2/transpond/webrtc?v=2"):d("".concat(z,"/api/v2/transpond/webrtc?v=2"),ee),{url:Z,areaCode:IT(),serviceIds:[Pi.CHOOSE_SERVER,t.cloudProxyServer==="proxy5"?Pi.CLOUD_PROXY_5:t.cloudProxyServer==="proxy3"||t.cloudProxyServer==="proxy4"?Pi.CLOUD_PROXY:Pi.CLOUD_PROXY_FALLBACK]}})),H=a.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"chooseServer",urls:N.map((z=>z.url))}),B=await AT({fragementLength:oe("FRAGEMENT_LENGTH"),referenceList:N,asyncMapHandler:z=>(M.debug("[".concat(t.clientId,"] Connect to choose_server:"),z.url),J7(z,t,r,s)),allFailedhandler:z=>{throw a.recordJoinChannelService({endTs:Date.now(),status:"error",errors:z},H),z[0]},promisesCollector:m});return a.recordJoinChannelService({endTs:Date.now(),status:"success"},H),B},v=async()=>{if(await Is(1e3),h!==null)return h;const N=oe("WEBCS_DOMAIN_BACKUP_LIST").map(((z,ee)=>{let Z;return Z=t.cloudProxyServer==="disabled"&&t.proxyServer?d("".concat(z,"/api/v2/transpond/webrtc?v=2"),ee,t.proxyServer):t.cloudProxyServer==="disabled"||t.cloudProxyServer==="fallback"?"https://".concat(z,"/api/v2/transpond/webrtc?v=2"):d("".concat(z,"/api/v2/transpond/webrtc?v=2"),ee),{url:Z,areaCode:IT(),serviceIds:[Pi.CHOOSE_SERVER,t.cloudProxyServer==="proxy5"?Pi.CLOUD_PROXY_5:t.cloudProxyServer==="proxy3"||t.cloudProxyServer==="proxy4"?Pi.CLOUD_PROXY:Pi.CLOUD_PROXY_FALLBACK]}})),H=a.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"chooseServer",urls:N.map((z=>z.url))}),B=await AT({fragementLength:oe("FRAGEMENT_LENGTH"),referenceList:N,asyncMapHandler:z=>(M.debug("[".concat(t.clientId,"] Connect to backup choose_server:"),z.url),J7(z,t,r,s)),allFailedhandler:z=>{throw a.recordJoinChannelService({endTs:Date.now(),status:"error",errors:z},H),z[0]},promisesCollector:m});return a.recordJoinChannelService({endTs:Date.now(),status:"success"},H),B};let w,I,A;try{({gatewayInfo:w,proxyInfo:I,url:A}=await R0([g(),v()]))}catch(N){throw N[0]}if(m.length&&m.forEach((N=>N.cancel&&typeof N.cancel=="function"&&N.cancel())),!w||!I)throw new ke(te.UNEXPECTED_ERROR,"missing gateway or proxy response").print();if(t.apUrl=A,t.cloudProxyServer!=="disabled"&&Array.isArray(c)&&A){const N=/^https?:\/\/(.+?)(\/.*)?$/.exec(A)[1];rt(c).call(c,N)&&(t.proxyServer=N,M.setProxyServer(N),It.setProxyServer(N))}return h={gatewayInfo:w,proxyInfo:await I7(I,w.uid)},h}async function I_e(t,r,s){const a=oe("UAP_AP").slice(0,oe("AJAX_REQUEST_CONCURRENT")).map((d=>t.proxyServer?"https://".concat(t.proxyServer,"/ap/?url=").concat(d+"/api/v1?action=uap"):"https://".concat(d,"/api/v1?action=uap"))),c=a.map((d=>(function(h,m,g,v){const w={command:"convergeAllocateEdge",sid:m.sid,appId:m.appId,token:m.token,ts:Date.now(),version:Zl,cname:m.cname,uid:m.uid.toString(),requestId:nM,seq:nM};nM+=1;const I={service_name:"tele_channel",json_body:JSON.stringify(w)};return Xd((async()=>{const A=await th(h,{data:I,cancelToken:g,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":61}});if(A.code!==0){const H=new ke(te.UNEXPECTED_RESPONSE,"cross channel ap error, code"+A.code,{retry:!0});throw M.error(H.toString()),H}const N=JSON.parse(A.json_body);if(N.code!==200){const H=new ke(te.UNEXPECTED_RESPONSE,"cross channel app center error, code: ".concat(N.code,", reason: ").concat(N.reason));throw M.error(H.toString()),H}if(!N.servers||N.servers.length===0){const H=new ke(te.UNEXPECTED_RESPONSE,"cross channel app center empty server");throw M.error(H.toString()),H}return{vid:N.vid,workerToken:N.workerToken,addressList:(oe("CHANNEL_MEDIA_RELAY_SERVERS")||N.servers).map((H=>"wss://".concat(H.address.replace(/\./g,"-"),".").concat(oe("WORKER_DOMAIN"),":").concat(H.wss)))}}),void 0,(A=>!!(A.code!==te.OPERATION_ABORTED&&A.code!==te.UNEXPECTED_RESPONSE||A.data&&A.data.retry)),v)})(d,t,r,s)));try{const d=await R0(c);return c.forEach((h=>h.cancel())),d}catch(d){throw d[0]}}async function A_e(t,r,s){let a=null;const c=[],d=async h=>{const m=oe(h?"WEBCS_DOMAIN_BACKUP_LIST":"WEBCS_DOMAIN").map((g=>t.proxyServer?"https://".concat(t.proxyServer,"/ap/?url=").concat(g+"/api/v2/transpond/webrtc?v=2"):"https://".concat(g,"/api/v2/transpond/webrtc?v=2")));return h&&(await Is(1e3),a!==null)?a:await AT({fragementLength:oe("FRAGEMENT_LENGTH"),referenceList:m,asyncMapHandler:g=>(M.debug("[".concat(t.clientId,"] update ticket, Connect to ").concat(h?"backup":""," choose_server:"),g),(function(v,w,I,A){const[N]=w_e(w,[Pi.CHOOSE_SERVER]);let H=Ai.networkState;return Xd((async()=>{H&&Ai.networkState===Nc.OFFLINE&&Ai.onlineWaiter&&await mt.race([Ai.onlineWaiter,Is(A&&A.maxRetryTimeout||Vi.maxRetryTimeout)]),H=Ai.networkState;const B=await th(v,{data:N,cancelToken:I,headers:{"Content-Type":"multipart/form-data;"}},!0);return b_e(B,v)}),(()=>!1),(B=>B.code!==te.OPERATION_ABORTED&&(B.code===te.UPDATE_TICKET_FAILED?B.data.retry:(M.warning("[".concat(w.clientId,"] update ticket network error, retry"),B),!0))),A)})(g,t,r,s)),allFailedhandler:g=>{throw g[0]},promisesCollector:c})};try{return a=await R0([d(!1),d(!0)]),c.length&&c.forEach((h=>h.cancel&&typeof h.cancel=="function"&&h.cancel())),a}catch(h){throw h[0]}}function iH(t,r){var s=Object.keys(t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);r&&(a=a.filter((function(c){return Object.getOwnPropertyDescriptor(t,c).enumerable}))),s.push.apply(s,a)}return s}function oM(t){for(var r=1;r<arguments.length;r++){var s=arguments[r]!=null?arguments[r]:{};r%2?iH(Object(s),!0).forEach((function(a){X(t,a,s[a])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(s)):iH(Object(s)).forEach((function(a){Object.defineProperty(t,a,Object.getOwnPropertyDescriptor(s,a))}))}return t}class P_e extends Zr{get isSuccess(){return!!this.configs}constructor(r,s){super(),X(this,"configs",void 0),X(this,"store",void 0),X(this,"joinInfo",void 0),X(this,"cancelToken",void 0),X(this,"retryConfig",{timeout:3e3,timeoutFactor:1.5,maxRetryCount:1,maxRetryTimeout:1e4}),X(this,"interval",void 0),X(this,"mutex",void 0),X(this,"mutableParamsRead",!1),X(this,"configCache",{}),X(this,"limit_bitrate",void 0),this.mutex=new so("config-distribute",r),this.store=s}startGetConfigDistribute(r,s){this.joinInfo=r,this.cancelToken=s,this.interval&&this.stopGetConfigDistribute(),oe("ENABLE_CONFIG_DISTRIBUTE")&&(this.updateConfigDistribute(),this.interval=window.setInterval((()=>{this.updateConfigDistribute()}),oe("CONFIG_DISTRIBUTE_INTERVAL")))}stopGetConfigDistribute(){this.interval&&clearInterval(this.interval),this.interval=void 0,this.joinInfo=void 0,this.cancelToken=void 0,this.configs=void 0,this.limit_bitrate=void 0}async awaitConfigDistributeComplete(){this.mutex.isLocked&&(await this.mutex.lock())()}async updateConfigDistribute(){if(this.mutableParamsRead||(this.mutableParamsRead=!0,It.reportApiInvoke(null,{options:void 0,name:pi.LOAD_CONFIG_FROM_LOCALSTORAGE,tag:$r.TRACER}).onSuccess(JSON.stringify(Jd))),!this.joinInfo||!this.cancelToken||!this.retryConfig)return void M.debug("[config-distribute] get config distribute interrupted have no joininfo");let r;const s=await this.mutex.lock();try{r=await R_e(this.joinInfo,this.cancelToken,this.retryConfig),M.debug("[config-distribute] get config distribute",JSON.stringify(r));const a=(function(c){var d;const h=q_(d=Object.keys(c).filter((v=>/^webrtc_ng_global_parameter/.test(v)))).call(d);for(let v=0;v<h.length;v++)for(let w=h.length-1;w>v;w--){const I=h[w],A=c[I].value;if(typeof A.__priority=="number"){const N=A.__priority,H=h[w-1],B=c[H].value;if(typeof B.__priority=="number"){if(!(N>B.__priority))continue;{const z=I;h[w]=h[w-1],h[w-1]=z}}else{const z=I;h[w]=h[w-1],h[w-1]=z}}}const m=Date.now();let g={};return h.forEach((v=>{const w=c[v].value.__expires;w&&w<=m||(g[v]=c[v])})),g})(r);this.cacheGlobalParameterConfig(a),this.store.hasStartJoinChannel||(this.store.isABTestSuccess=!0),this.configs=a}catch(a){const c=new ke(te.NETWORK_RESPONSE_ERROR,a);M.warning("[config-distribute] ".concat(c.toString()))}finally{s()}}getBitrateLimit(){return this.limit_bitrate||void 0}handleBitrateLimit(r){g7(r)&&(this.limit_bitrate?this.limit_bitrate&&this.limit_bitrate.id!==r.id&&this.emit(vT.UPDATE_BITRATE_LIMIT,r):this.emit(vT.UPDATE_BITRATE_LIMIT,r))}getLowStreamConfigDistribute(){return this.limit_bitrate&&oM({},this.limit_bitrate.low_stream_uplink)}handleABTestConfigDistribute(r){try{const s={},a=Object.keys(r),c=[];a.forEach((d=>{const h=r[d].value;s[d]=h;const m=h.__id;if(m&&this.configCache[d]&&this.configCache[d].__id===m)return;const g=h.__type,v=r[d].value,w=r[d].tag;let I=0;g?g===F9.REALTIME&&(I=1):Object.keys(v).some((A=>Object.prototype.hasOwnProperty.call(l2,A)||!M2()&&Object.prototype.hasOwnProperty.call(N1,A)?(I=1,!0):void 0)),c.push({tag:w,isApplied:I,feature:d,params:JSON.stringify(h)})})),c.forEach((d=>{let{tag:h,feature:m,params:g,isApplied:v}=d;this.store.sessionId&&It.abTest(this.store.sessionId,{intSucc:1,isApplied:v,tag:h,feature:m,params:g,cid:this.store.cid,uid:this.store.intUid})})),this.configCache=s}catch(s){M.debug("handleABTestConfigDistribute error",s)}}cacheGlobalParameterConfig(r){const s=(function(c){const d={};return Object.keys(c).forEach((h=>{const m=c[h].value,g=m.__expires,v=m.__type;Object.keys(m).forEach((w=>{w==="__id"||w==="__type"||w==="__priority"||w==="__expires"||Object.prototype.hasOwnProperty.call(d,w)||(d[w]=oM(oM({value:m[w]},g&&{expires:g}),v&&{type:v}))}))})),d})(r);try{var a;const c=(a=s.LIMIT_BITRATE)===null||a===void 0?void 0:a.value;delete s.LIMIT_BITRATE,c&&g7(c)&&this.handleBitrateLimit(c),this.limit_bitrate=c,this.handleGlobalParameterConfig(s),this.handleABTestConfigDistribute(r),(function(m){try{const g=Date.now();Object.keys(m).forEach((v=>{const{value:w,type:I,expires:A}=m[v];A&&A<=g||((I===F9.REALTIME||Object.prototype.hasOwnProperty.call(l2,v))&&(Jd[v]=w,Fr[v]=w,M.debug("Update realtime parameters from config distribute",v,w)),I||M2()||!Object.prototype.hasOwnProperty.call(N1,v)||(Jd[v]=w,Fr[v]=w,M.debug("Update gateway parameters from config distribute",v,w)))}))}catch(g){M.error("Error update config immediately: ".concat(m),g.message)}})(s);const d=JSON.stringify(s),h=window.btoa(d);window.localStorage.setItem("websdk_ng_global_parameter",h),M.debug("Caching global parameters ".concat(d))}catch(c){M.error("Error caching global parameters:",c.message)}}handleGlobalParameterConfig(r){try{const s=Date.now();Object.keys(r).forEach((a=>{if(a==="CLIENT_ROLE_OPTIONS"&&Object.prototype.hasOwnProperty.call(Fr,a)){const{value:c,expires:d}=r[a];if(d&&d<=s)return;(function(h,m){try{return typeof h=="object"&&typeof m=="object"&&JSON.stringify(h)===JSON.stringify(m)}catch{return!1}})(Fr[a],c)||(Jd[a]=c,Fr[a]=c,this.emit(vT.UPDATE_CLIENT_ROLE_OPTIONS,c),M.debug("Updating client role options: ".concat(JSON.stringify(c))))}}))}catch(s){M.error("Error handling global parameter config:",s.message)}}}class O_e extends Zr{constructor(){super(...arguments),X(this,"resultStorage",new Map)}setLocalAudioStats(r,s,a){this.record("AUDIO_INPUT_LEVEL_TOO_LOW",r,this.checkAudioInputLevel(a,s)),this.record("SEND_AUDIO_BITRATE_TOO_LOW",r,this.checkSendAudioBitrate(a,s))}setLocalVideoStats(r,s,a){this.record("SEND_VIDEO_BITRATE_TOO_LOW",r,this.checkSendVideoBitrate(a,s)),this.record("FRAMERATE_INPUT_TOO_LOW",r,this.checkFramerateInput(a,s)),this.record("FRAMERATE_SENT_TOO_LOW",r,this.checkFramerateSent(a)),!s.muted&&this.record("VIDEO_ENCODE_FAILED",r,this.checResolutionSent(a))}setRemoteAudioStats(r,s){const a=r.getUserId();this.record("AUDIO_OUTPUT_LEVEL_TOO_LOW",a,this.checkAudioOutputLevel(s))}setRemoteVideoStats(r,s){const a=r.getUserId();this.record("RECV_VIDEO_DECODE_FAILED",a,this.checkVideoDecode(s))}record(r,s,a){if(oe("STATS_UPDATE_INTERVAL")>500)return;this.resultStorage.has(r)||this.resultStorage.set(r,{result:[],isPrevNormal:!0});const c=this.resultStorage.get(r);if(!c)return;c.result.push(a);const d=r==="VIDEO_ENCODE_FAILED"?oe("ENCODE_EXCEPTION_TIMES"):5;if(c.result.length>=d){var h;const m=rt(h=c.result).call(h,!0);c.isPrevNormal&&!m&&this.emit("exception",aM[r],r,s),!c.isPrevNormal&&m&&this.emit("exception",aM[r]+2e3,r+"_RECOVER",s),c.isPrevNormal=m,c.result=[]}}checkAudioOutputLevel(r){return!(r.receiveBitrate>0&&r.receiveLevel===0)}checkAudioInputLevel(r,s){return s instanceof Gi&&!s.isActive||!!s.muted||r.sendVolumeLevel!==0}checkFramerateInput(r,s){let a=null;s._encoderConfig&&s._encoderConfig.frameRate&&(a=xc(s._encoderConfig.frameRate));const c=r.captureFrameRate;return!a||!c||!(a>10&&c<5||a<10&&a>=5&&c<=1)}checkFramerateSent(r){return!(r.captureFrameRate&&r.sendFrameRate&&r.captureFrameRate>5&&r.sendFrameRate<=1)}checResolutionSent(r){var s;return!(!r.codecType||rt(s=oe("ENCODE_EXCEPTION_VALIDATE_CODEC")).call(s,r.codecType.toLocaleLowerCase()))||!r.captureFrameRate||r.sendFrameRate!==0||r.sendResolutionWidth!==0||r.sendResolutionHeight!==0}checkSendVideoBitrate(r,s){return!!s.muted||r.sendBitrate!==0}checkSendAudioBitrate(r,s){return s instanceof Gi&&!s.isActive||!!s.muted||r.sendBitrate!==0}checkVideoDecode(r){return r.receiveBitrate===0||r.decodeFrameRate!==0}}const aM={FRAMERATE_INPUT_TOO_LOW:1001,FRAMERATE_SENT_TOO_LOW:1002,SEND_VIDEO_BITRATE_TOO_LOW:1003,RECV_VIDEO_DECODE_FAILED:1005,AUDIO_INPUT_LEVEL_TOO_LOW:2001,AUDIO_OUTPUT_LEVEL_TOO_LOW:2002,SEND_AUDIO_BITRATE_TOO_LOW:2003,VIDEO_ENCODE_FAILED:2004},lo=new class{markSubscribeStart(t,r){performance.mark("agora-web-sdk/".concat(t,"/subscribe-").concat(r))}markPublishStart(t,r){performance.mark("agora-web-sdk/".concat(t,"/publish-").concat(r))}measureFromSubscribeStart(t,r){const s=performance.getEntriesByName("agora-web-sdk/".concat(t,"/subscribe-").concat(r));if(s.length>0){const a=s[s.length-1];return Math.round(performance.now()-a.startTime)}return 0}measureFromPublishStart(t,r){const s=performance.getEntriesByName("agora-web-sdk/".concat(t,"/publish-").concat(r));if(s.length>0){const a=s[s.length-1];return Math.round(performance.now()-a.startTime)}return 0}};function sH(t,r){var s=Object.keys(t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);r&&(a=a.filter((function(c){return Object.getOwnPropertyDescriptor(t,c).enumerable}))),s.push.apply(s,a)}return s}function my(t){for(var r=1;r<arguments.length;r++){var s=arguments[r]!=null?arguments[r]:{};r%2?sH(Object(s),!0).forEach((function(a){X(t,a,s[a])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(s)):sH(Object(s)).forEach((function(a){Object.defineProperty(t,a,Object.getOwnPropertyDescriptor(s,a))}))}return t}class PT{constructor(r){X(this,"store",void 0),X(this,"onStatsException",void 0),X(this,"onUploadPublishDuration",void 0),X(this,"onStatsChanged",void 0),X(this,"onVideoCodecChanged",void 0),X(this,"localStats",new Map),X(this,"remoteStats",new Map),X(this,"updateStatsInterval",void 0),X(this,"trafficStats",void 0),X(this,"trafficStatsPeerList",[]),X(this,"uplinkStats",void 0),X(this,"exceptionMonitor",void 0),X(this,"p2pChannel",void 0),X(this,"scalabilityMode",k1.L1T1),X(this,"updateStats",(()=>{this.p2pChannel&&(this.updateRemoteStats(this.p2pChannel),this.updateLocalStats(this.p2pChannel))})),this.store=r,this.exceptionMonitor=new O_e,this.exceptionMonitor.on("exception",((s,a,c)=>{this.onStatsException&&this.onStatsException(s,a,c)}))}startUpdateStats(){this.updateStatsInterval||(this.updateStatsInterval=window.setInterval(this.updateStats,1e3))}stopUpdateStats(){this.updateStatsInterval&&(window.clearInterval(this.updateStatsInterval),this.updateStatsInterval=void 0)}reset(){this.localStats=new Map,this.remoteStats=new Map,this.trafficStats=void 0,this.trafficStatsPeerList=[],this.uplinkStats=void 0}getLocalAudioTrackStats(){return this.localStats.get(Xe.LocalAudioTrack)||my({},m2)}getLocalVideoTrackStats(){return this.localStats.get(Xe.LocalVideoTrack)||my({},g2)}getRemoteAudioTrackStats(r){const s=(d,h)=>{if(!this.trafficStats)return h;const m=this.trafficStats.peer_delay.find((g=>g.peer_uid===d));return m&&(h.publishDuration=m.B_ppad+(Date.now()-this.trafficStats.timestamp)),h},a={};if(r){var c;const d=(c=this.remoteStats.get(r))===null||c===void 0?void 0:c.audioStats;d&&(a[r]=s(r,d))}else Array.from(this.remoteStats.entries()).forEach((d=>{let[h,{audioStats:m}]=d;m&&(a[h]=s(h,m))}));return a}getRemoteNetworkQualityStats(r){const s={};if(r){var a;const c=(a=this.remoteStats.get(r))===null||a===void 0?void 0:a.networkStats;c&&(s[r]=c)}else Array.from(this.remoteStats.entries()).forEach((c=>{let[d,{networkStats:h}]=c;h&&(s[d]=h)}));return s}getRemoteVideoTrackStats(r){const s=(d,h)=>{if(!this.trafficStats)return h;const m=this.trafficStats.peer_delay.find((g=>g.peer_uid===d));return m&&(h.publishDuration=m.B_ppvd+(Date.now()-this.trafficStats.timestamp)),h},a={};if(r){var c;const d=(c=this.remoteStats.get(r))===null||c===void 0?void 0:c.videoStats;d&&(a[r]=s(r,d))}else Array.from(this.remoteStats.entries()).forEach((d=>{let[h,{videoStats:m}]=d;m&&(a[h]=s(h,m))}));return a}getRTCStats(){let r=0,s=0,a=0,c=0;const d=this.localStats.get(Xe.LocalAudioTrack);d&&(r+=d.sendBytes,s+=d.sendBitrate);const h=this.localStats.get(Xe.LocalVideoTrack);h&&(r+=h.sendBytes,s+=h.sendBitrate);const m=this.localStats.get(Xe.LocalVideoLowTrack);m&&(r+=m.sendBytes,s+=m.sendBitrate),this.remoteStats.forEach((v=>{let{audioStats:w,videoStats:I}=v;w&&(a+=w.receiveBytes,c+=w.receiveBitrate),I&&(a+=I.receiveBytes,c+=I.receiveBitrate)}));let g=1;return this.trafficStats&&(g+=this.trafficStats.peer_delay.length),{Duration:0,UserCount:g,SendBitrate:s,SendBytes:r,RecvBytes:a,RecvBitrate:c,OutgoingAvailableBandwidth:this.uplinkStats?this.uplinkStats.B_uab/1e3:0,RTT:this.trafficStats?2*this.trafficStats.B_acd:0}}addLocalStats(r){this.localStats.set(r,void 0)}removeLocalStats(r){r?this.localStats.delete(r):this.localStats.clear()}addRemoteStats(r){this.remoteStats.set(r,{})}removeRemoteStats(r){r?this.remoteStats.delete(r):this.remoteStats.clear()}addP2PChannel(r){this.p2pChannel=r}updateTrafficStats(r){r.peer_delay=r.peer_delay.filter((s=>s.B_ppad!==void 0||s.B_ppvd!==void 0)),r.peer_delay.filter((s=>this.trafficStatsPeerList.indexOf(s.peer_uid)===-1)).forEach((s=>{var a;const c=(a=this.p2pChannel)===null||a===void 0?void 0:a.getRemoteMedia(s.peer_uid),d=c!=null&&c.videoSSRC?lo.measureFromSubscribeStart(this.store.clientId,c.videoSSRC):0,h=c!=null&&c.audioSSRC?lo.measureFromSubscribeStart(this.store.clientId,c.audioSSRC):0;s.B_ppad!==void 0&&s.B_ppvd!==void 0&&(this.onUploadPublishDuration&&this.onUploadPublishDuration(s.peer_uid,s.B_ppad,s.B_ppvd,d>h?d:h),this.trafficStatsPeerList.push(s.peer_uid))})),this.trafficStats=r}updateUplinkStats(r){this.uplinkStats&&this.uplinkStats.B_fir!==r.B_fir&&M.debug("[".concat(this.store.clientId,"]: Period fir changes to ").concat(r.B_fir)),this.uplinkStats=r}static isRemoteVideoFreeze(r,s,a){if(!r)return!1;const c=!!a&&s.framesDecodeFreezeTime>a.framesDecodeFreezeTime,d=!a||s.framesDecodeCount>a.framesDecodeCount;return c||!d}static isRemoteAudioFreeze(r){return!!r&&r._isFreeze()}isLocalVideoFreeze(r){return!(!r.inputFrame||!r.sentFrame)&&r.inputFrame.frameRate>5&&r.sentFrame.frameRate<3}updateLocalStats(r){Array.from(this.localStats.entries()).forEach((s=>{let[a,c]=s;switch(a){case Xe.LocalVideoTrack:case Xe.LocalVideoLowTrack:{const m=c,g=my({},g2),v=r.getStats(),w=r.getLocalMedia(a);if(v){const I=v.videoSend.find((A=>A.ssrc===(w==null?void 0:w.ssrcs[0].ssrcId)));if(I){const A=r.getLocalVideoSize(),N=r.getEncoderConfig(Xe.LocalVideoTrack);var d;(I.codec==="H264"||I.codec==="H265"||I.codec==="VP8"||I.codec==="VP9"||I.codec==="AV1X"||I.codec==="AV1")&&(g.codecType=I.codec,(m==null?void 0:m.codecType)!==I.codec&&((d=this.onVideoCodecChanged)===null||d===void 0||d.call(this,I.codec.toLocaleLowerCase()))),g.sendBytes=I.bytes,g.sendBitrate=m?8*Math.max(0,g.sendBytes-m.sendBytes):0,I.inputFrame?(g.captureFrameRate=I.inputFrame.frameRate,g.captureResolutionHeight=I.inputFrame.height,g.captureResolutionWidth=I.inputFrame.width):A&&(g.captureResolutionWidth=A.width,g.captureResolutionHeight=A.height),I.sentFrame?(g.sendFrameRate=I.sentFrame.frameRate,g.sendResolutionHeight=I.sentFrame.height,g.sendResolutionWidth=I.sentFrame.width):A&&(g.sendResolutionWidth=A.width,g.sendResolutionHeight=A.height),I.avgEncodeMs&&(g.encodeDelay=I.avgEncodeMs),N&&N.bitrateMax?g.targetSendBitrate=1e3*N.bitrateMax:I.targetBitrate&&(g.targetSendBitrate=I.targetBitrate),g.sendPackets=I.packets,g.sendPacketsLost=I.packetsLost,g.sendJitterMs=I.jitterMs,g.sendRttMs=I.rttMs,g.totalDuration=m?m.totalDuration+1:1,g.totalFreezeTime=m?m.totalFreezeTime:0,this.isLocalVideoFreeze(I)&&(g.totalFreezeTime+=1),I.scalabilityMode&&this.scalabilityMode!==I.scalabilityMode&&(M.debug("[".concat(this.store.clientId,"]: The scalabilityMode of the video sending stream is ").concat(I.scalabilityMode)),this.scalabilityMode=I.scalabilityMode)}this.trafficStats&&(g.currentPacketLossRate=(this.trafficStats.B_pvlr4||0)/100)}var h;this.localStats.set(a,g),((m==null?void 0:m.sendResolutionWidth)!==g.sendResolutionWidth||(m==null?void 0:m.sendResolutionHeight)!==g.sendResolutionHeight)&&((h=this.onStatsChanged)===null||h===void 0||h.call(this,"resolution",{width:g.sendResolutionWidth,height:g.sendResolutionHeight})),g&&w&&this.exceptionMonitor.setLocalVideoStats(this.store.uid,w.track,g);break}case Xe.LocalAudioTrack:{const m=c,g=my({},m2),v=r.getStats(),w=r.getLocalMedia(a);if(v){const I=v.audioSend.find((A=>A.ssrc===(w==null?void 0:w.ssrcs[0].ssrcId)));if(I){if(I.codec!=="opus"&&I.codec!=="aac"&&I.codec!=="PCMU"&&I.codec!=="PCMA"&&I.codec!=="G722"||(g.codecType=I.codec),I.inputLevel)g.sendVolumeLevel=Math.round(32767*I.inputLevel);else{const A=r.getLocalAudioVolume();A&&(g.sendVolumeLevel=Math.round(32767*A))}g.sendBytes=I.bytes,g.sendPackets=I.packets,g.sendPacketsLost=I.packetsLost,g.sendJitterMs=I.jitterMs,g.sendRttMs=I.rttMs,g.sendBitrate=m?8*Math.max(0,g.sendBytes-m.sendBytes):0}}this.trafficStats&&(g.currentPacketLossRate=(this.trafficStats.B_palr4||0)/100),this.localStats.set(Xe.LocalAudioTrack,g),g&&w&&this.exceptionMonitor.setLocalAudioStats(this.store.uid,w.track,g);break}}}))}updateRemoteStats(r){Array.from(this.remoteStats.entries()).forEach((s=>{var a,c;let[d,{videoStats:h,audioStats:m,videoPcStats:g}]=s;const v=m,w=h,I=g,A=my({},J9),N=my({},Q9),H=my({},pge),{audioTrack:B,videoTrack:z,audioSSRC:ee,videoSSRC:Z}=r.getRemoteMedia(d);let ae;ae=this.store.useP2P?r.getStats(!0):r.getStats();const ye=(a=ae)===null||a===void 0?void 0:a.audioRecv.find((Ue=>Ue.ssrc===ee)),_e=(c=ae)===null||c===void 0?void 0:c.videoRecv.find((Ue=>Ue.ssrc===Z)),ue=this.trafficStats&&this.trafficStats.peer_delay.find((Ue=>Ue.peer_uid===d));if(ye&&(ye.codec!=="opus"&&ye.codec!=="aac"&&ye.codec!=="PCMU"&&ye.codec!=="PCMA"&&ye.codec!=="G722"||(A.codecType=ye.codec),ye.outputLevel?A.receiveLevel=Math.round(32767*ye.outputLevel):B&&(A.receiveLevel=Math.round(32767*B.getVolumeLevel())),A.receiveBytes=ye.bytes,A.receivePackets=ye.packets,A.receivePacketsLost=ye.packetsLost,A.receivePacketsDiscarded=ye.packetsDiscarded,A.packetLossRate=A.receivePacketsLost/(A.receivePackets+A.receivePacketsLost),A.receiveBitrate=v?8*Math.max(0,A.receiveBytes-v.receiveBytes):0,A.totalDuration=v?v.totalDuration+1:1,A.totalFreezeTime=v?v.totalFreezeTime:0,A.freezeRate=A.totalFreezeTime/A.totalDuration,A.receiveDelay=ye.jitterBufferMs,A.totalDuration>10&&PT.isRemoteAudioFreeze(B)&&(A.totalFreezeTime+=1)),_e){var Ae;_e.codec!=="H264"&&_e.codec!=="H265"&&_e.codec!=="VP8"&&_e.codec!=="VP9"&&_e.codec!=="AV1X"&&_e.codec!=="AV1"||(N.codecType=_e.codec),N.receiveBytes=_e.bytes,N.receiveBitrate=w?8*Math.max(0,N.receiveBytes-w.receiveBytes):0,N.decodeFrameRate=_e.decodeFrameRate<0?0:_e.decodeFrameRate,N.renderFrameRate=_e.decodeFrameRate<0?0:_e.decodeFrameRate,_e.outputFrame&&(N.renderFrameRate=_e.outputFrame.frameRate),_e.receivedFrame?(N.receiveFrameRate=_e.receivedFrame.frameRate,N.receiveResolutionHeight=_e.receivedFrame.height,N.receiveResolutionWidth=_e.receivedFrame.width):z&&(N.receiveResolutionHeight=z._videoHeight||0,N.receiveResolutionWidth=z._videoWidth||0),_e.framesRateFirefox!==void 0&&(N.receiveFrameRate=Math.round(_e.framesRateFirefox)),N.receivePackets=_e.packets,N.receivePacketsLost=_e.packetsLost,N.packetLossRate=N.receivePacketsLost/(N.receivePackets+N.receivePacketsLost);const Ue=w?w.totalFreezeTime:0,We=w?w.totalDuration:0;N.totalDuration=w?w.totalDuration+1:1,N.totalFreezeTime=(Ae=_e.totalFreezesDuration)!==null&&Ae!==void 0?Ae:Ue||0,N.receiveDelay=_e.jitterBufferMs||0;const Ze=!!Z&&r.getRemoteVideoIsReady(Z);_e.totalFreezesDuration===void 0&&z&&Ze&&PT.isRemoteVideoFreeze(z,_e,I)&&(N.totalFreezeTime+=1),N.freezeRate=Math.max(0,Math.min((N.totalFreezeTime-Ue)/(N.totalDuration-We),1))}ue&&(A.end2EndDelay=ue.B_ad,N.end2EndDelay=ue.B_vd,A.transportDelay=ue.B_ed,N.transportDelay=ue.B_ed,A.currentPacketLossRate=ue.B_ealr4/100,N.currentPacketLossRate=ue.B_evlr4/100,H.uplinkNetworkQuality=ue.B_punq?ue.B_punq:0,H.downlinkNetworkQuality=ue.B_pdnq?ue.B_pdnq:0),this.remoteStats.set(d,{audioStats:A,videoStats:N,videoPcStats:_e,networkStats:H}),B&&this.exceptionMonitor.setRemoteAudioStats(B,A),z&&this.exceptionMonitor.setRemoteVideoStats(z,N)}))}}class oH{constructor(){X(this,"destChannelMediaInfos",new Map),X(this,"srcChannelMediaInfo",void 0)}setSrcChannelInfo(r){f7(r),this.srcChannelMediaInfo=r}addDestChannelInfo(r){f7(r),this.destChannelMediaInfos.set(r.channelName,r)}removeDestChannelInfo(r){J1(r),this.destChannelMediaInfos.delete(r)}getSrcChannelMediaInfo(){return this.srcChannelMediaInfo}getDestChannelMediaInfo(){return this.destChannelMediaInfos}}function aH(t){if(!(t instanceof oH))return new ke(te.INVALID_PARAMS,"Config should be instance of [ChannelMediaRelayConfiguration]").throw();const r=t.getSrcChannelMediaInfo(),s=t.getDestChannelMediaInfo();if(!r)return new ke(te.INVALID_PARAMS,"srcChannelMediaInfo should not be empty").throw();if(s.size===0)return new ke(te.INVALID_PARAMS,"destChannelMediaInfo should not be empty").throw()}class lg{get hasVideo(){return this._video_enabled_&&!this._video_muted_&&this._video_added_}get hasAudio(){return this._audio_enabled_&&!this._audio_muted_&&this._audio_added_}get audioTrack(){if(this.hasAudio||this._audio_pre_subscribed)return this._audioTrack}get videoTrack(){if(this.hasVideo||this._video_pre_subscribed)return this._videoTrack}get dataChannels(){return this._dataChannels}constructor(r,s){X(this,"uid",void 0),X(this,"_uintid",void 0),X(this,"_trust_in_room_",!0),X(this,"_trust_audio_enabled_state_",!0),X(this,"_trust_video_enabled_state_",!0),X(this,"_trust_audio_mute_state_",!0),X(this,"_trust_video_mute_state_",!0),X(this,"_audio_muted_",!1),X(this,"_video_muted_",!1),X(this,"_audio_enabled_",!0),X(this,"_video_enabled_",!0),X(this,"_audio_added_",!1),X(this,"_video_added_",!1),X(this,"_is_pre_created",!1),X(this,"_video_pre_subscribed",!1),X(this,"_audio_pre_subscribed",!1),X(this,"_trust_video_stream_added_state_",!0),X(this,"_trust_audio_stream_added_state_",!0),X(this,"_audioTrack",void 0),X(this,"_videoTrack",void 0),X(this,"_dataChannels",[]),X(this,"_audioSSRC",void 0),X(this,"_videoSSRC",void 0),X(this,"_audioOrtc",void 0),X(this,"_videoOrtc",void 0),X(this,"_cname",void 0),X(this,"_rtxSsrcId",void 0),X(this,"_videoMid",void 0),X(this,"_audioMid",void 0),this.uid=r,this._uintid=s}}function cH(t,r){var s=Object.keys(t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);r&&(a=a.filter((function(c){return Object.getOwnPropertyDescriptor(t,c).enumerable}))),s.push.apply(s,a)}return s}function cM(t){for(var r=1;r<arguments.length;r++){var s=arguments[r]!=null?arguments[r]:{};r%2?cH(Object(s),!0).forEach((function(a){X(t,a,s[a])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(s)):cH(Object(s)).forEach((function(a){Object.defineProperty(t,a,Object.getOwnPropertyDescriptor(s,a))}))}return t}const hP="9",lM=2e4,pP=4e4;function lH(t,r){var s=Object.keys(t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);r&&(a=a.filter((function(c){return Object.getOwnPropertyDescriptor(t,c).enumerable}))),s.push.apply(s,a)}return s}function Rf(t){for(var r=1;r<arguments.length;r++){var s=arguments[r]!=null?arguments[r]:{};r%2?lH(Object(s),!0).forEach((function(a){X(t,a,s[a])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(s)):lH(Object(s)).forEach((function(a){Object.defineProperty(t,a,Object.getOwnPropertyDescriptor(s,a))}))}return t}var I0=(function(t){return t[t.DOWN=0]="DOWN",t[t.UP=1]="UP",t})(I0||{});const fP=new Map;function uH(t,r,s,a){let{scale:c}=t;if(c===0&&a===I0.UP||c>=r.length-1&&a===I0.DOWN)return t;let d=Rf(Rf({},t),{},{scale:a===I0.DOWN?++c:--c});switch(s){case"maintain-framerate":d=Rf(Rf({},d),r[c].motion);break;case"maintain-resolution":d=Rf(Rf({},d),r[c].detail);break;case"balanced":d=Rf(Rf({},d),r[c].balanced)}return d}function dH(t,r){if(r){const s={overUse:0,underUse:0,adaptationList:hH(r)};fP.set(t,s)}else fP.delete(t)}function hH(t){const r=Rf({},t),{bitrateMax:s,frameRate:a,scaleResolutionDownBy:c,bitrateMin:d}=r,{MIN_FRAME_RATE:h,MAX_THRESHOLD_FRAMERATE:m,MAX_SCALE:g,BITRATE_MIN_THRESHOLD:v,BITRATE_MAX_THRESHOLD:w,BWE_SCALE_UP_THRESHOLD:I,BWE_SCALE_DOWN_THRESHOLD:A,PERF_SCALE_DOWN_THRESHOLD:N,PERF_SCALE_UP_THRESHOLD:H,BALANCE_BITRATE_FACTOR:B,BALANCE_FRAMERATE_FACTOR:z,BALANCE_RESOLUTION_FACTOR:ee,MOTION_RESOLUTION_FACTOR:Z,MOTION_BITRATE_FACTOR:ae,DETAIL_FRAMERATE_FACTOR:ye,DETAIL_BITRATE_FACTOR:_e}=a2,ue=Math.min(r.frameRate,m),Ae=[{scale:0,threshold:{bwe_down:Math.round(Math.pow(A,1)*s),bwe_up:s,fps_down:Math.round(Math.pow(N,1)*ue),fps_up:a},balanced:{scaleResolutionDownBy:1,frameRate:a,bitrateMax:s,bitrateMin:d},motion:{scaleResolutionDownBy:1,frameRate:a,bitrateMax:s,bitrateMin:d},detail:{scaleResolutionDownBy:1,frameRate:a,bitrateMax:s,bitrateMin:d}}];for(let Ue=1;Ue<=g;Ue++){const We={bwe_up:Math.round(Math.pow(I,Ue)*s),bwe_down:Math.round(Math.pow(A,Ue+1)*s),fps_up:Math.round(Math.pow(H,Ue)*ue),fps_down:Math.round(Math.pow(N,Ue+1)*ue)},Ze={scaleResolutionDownBy:c/Math.pow(ee,Ue),frameRate:Math.max(Math.round(Math.pow(z,Ue)*a),h),bitrateMax:Math.max(Math.round(Math.pow(B,Ue)*s),w),bitrateMin:Math.max(Math.round(Math.pow(B,Ue)*d),v)},_n={scaleResolutionDownBy:c/Math.pow(Z,Ue),frameRate:a,bitrateMax:Math.max(Math.round(Math.pow(ae,Ue)*s),w),bitrateMin:Math.max(Math.round(Math.pow(ae,Ue)*d),v)},bn={scaleResolutionDownBy:1,frameRate:Math.max(Math.round(Math.pow(ye,Ue)*a),h),bitrateMax:Math.max(Math.round(Math.pow(_e,Ue)*s),w),bitrateMin:Math.max(Math.round(Math.pow(_e,Ue)*d),v)};Ae.push({scale:Ue,threshold:We,balanced:Ze,motion:_n,detail:bn})}return Ae}function k_e(t,r,s,a,c,d){const h=fP.get(t)||{overUse:0,underUse:0,adaptationList:hH(c)},{adaptationList:m}=h;fP.set(t,h);const{OVERUSE_TIMES_THRESHOLD:g,UNDERUSE_TIMES_THRESHOLD:v}=a2,{scale:w}=a;let I,A;return typeof r=="number"&&r>0&&(function(N,H,B,z){if(H>=B.length)return!1;let{threshold:{fps_down:ee}}=B[H];return oe("FORCE_AG_HIGH_FRAMERATE")&&z==="maintain-framerate"&&(ee=B[0].threshold.fps_down),N<ee})(r,w,m,d)&&(h.overUse++,A=hT.CPU,h.overUse>g)||typeof s=="number"&&s>0&&(function(N,H,B){if(H>=B.length)return!1;const{threshold:{bwe_down:z}}=B[H];return N<z})(s,w,m)&&(h.overUse++,A=hT.BANDWIDTH,h.overUse>g)?(h.overUse=0,h.underUse=0,I=uH(a,m,d,I0.DOWN),[I,A]):(typeof r=="number"&&r>0&&typeof s=="number"&&s>0&&(function(N,H,B,z){if(H===0)return;let{threshold:{fps_up:ee}}=B[H];return oe("FORCE_AG_HIGH_FRAMERATE")&&z==="maintain-framerate"&&(ee=B[1].threshold.fps_up),N>ee})(r,w,m,d)&&(function(N,H,B){if(H===0)return;const{threshold:{bwe_up:z}}=B[H];return N>z})(s,w,m)&&(h.underUse++,h.underUse>v&&(h.overUse=0,h.underUse=0,I=uH(a,m,d,I0.UP),I.scale===0&&(A=hT.NONE))),[I,A])}function pH(t,r){var s=Object.keys(t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);r&&(a=a.filter((function(c){return Object.getOwnPropertyDescriptor(t,c).enumerable}))),s.push.apply(s,a)}return s}function uM(t){for(var r=1;r<arguments.length;r++){var s=arguments[r]!=null?arguments[r]:{};r%2?pH(Object(s),!0).forEach((function(a){X(t,a,s[a])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(s)):pH(Object(s)).forEach((function(a){Object.defineProperty(t,a,Object.getOwnPropertyDescriptor(s,a))}))}return t}const mP=new Map;function gP(t,r){const s=mP.get(t);if(s){const{timer:a}=s;window.clearTimeout(a),mP.delete(t)}r.qualityLimitationReason=hT.NONE,dH(t)}function N_e(t,r){var s;let a;switch(r){case Xe.LocalAudioTrack:a=lr.Audio;break;case Xe.LocalVideoTrack:a=rt(s=t._hints).call(s,Sr.SCREEN_TRACK)?lr.Screen:lr.High;break;case Xe.LocalVideoLowTrack:a=lr.Low}return a}function dM(t){const r=Wn();if(t.some((s=>s._bypassWebAudio)))throw new Le(te.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio");if(!r.webAudioMediaStreamDest)throw new Le(te.NOT_SUPPORTED,"cannot publish multiple tracks because your browser does not support audio mixing")}function hM(t,r){dM(t);const s=new Gi;return t.forEach((a=>s.addAudioTrack(a))),s}const x_e=!Wn().supportUnifiedPlan||oe("CHROME_FORCE_PLAN_B")&&vf();function _P(t){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};var s;return x_e?(s={spec:r,store:t},Cf("PlanBConnection").create(s)):new iu(r,t)}function pM(t){return t&&(t.iceConnectionState==="disconnected"||t.iceConnectionState==="checking"||t.iceConnectionState==="failed")}function fH(t){try{if(t.iceServers)return!1;if(t.turnServer&&t.turnServer.mode!=="off"){if(lT(t.turnServer.servers))return!1;if(oe("FORCE_TURN_TCP")||t.turnServer.servers.concat(t.turnServer.serversFromGateway||[]).some((r=>r.forceturn)))return!0}return!1}catch{return!1}}var Un;function mH(t,r){var s=Object.keys(t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);r&&(a=a.filter((function(c){return Object.getOwnPropertyDescriptor(t,c).enumerable}))),s.push.apply(s,a)}return s}function nh(t){for(var r=1;r<arguments.length;r++){var s=arguments[r]!=null?arguments[r]:{};r%2?mH(Object(s),!0).forEach((function(a){X(t,a,s[a])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(s)):mH(Object(s)).forEach((function(a){Object.defineProperty(t,a,Object.getOwnPropertyDescriptor(s,a))}))}return t}let iu=(Un=class xy extends y7{get currentLocalDescription(){return this.peerConnection.currentLocalDescription}get currentRemoteDescription(){return this.peerConnection.currentRemoteDescription}get peerConnectionState(){return this.peerConnection.connectionState}get iceConnectionState(){return this.peerConnection.iceConnectionState}get dtlsTransportState(){var r,s;return(r=(s=this.peerConnection.getReceivers()[0])===null||s===void 0||(s=s.transport)===null||s===void 0?void 0:s.state)!==null&&r!==void 0?r:null}get localCodecs(){return[...new Set(this.localCapabilities&&this.localCapabilities.send.videoCodecs.map((r=>r.rtpMap&&r.rtpMap.encodingName.toLowerCase()||"")).filter((r=>{var s;return rt(s=Object.keys(fT)).call(s,r)})))]}constructor(r,s){super(r,s),X(this,"id",Tr(5,"connection-")),X(this,"store",void 0),X(this,"peerConnection",void 0),X(this,"forceTurn",!1),X(this,"remoteSDP",void 0),X(this,"initialOffer",void 0),X(this,"transportEventReceiver",void 0),X(this,"statsFilter",void 0),X(this,"extension",{useXR:oe("USE_XR")}),X(this,"localCapabilities",void 0),X(this,"remoteCodecs",void 0),X(this,"localCandidateCount",0),X(this,"allCandidatesReceived",!1),X(this,"isPreallocation",!1),X(this,"preMediaMap",new Map),X(this,"dataStreamChannelMap",new Map),X(this,"establishPromise",void 0),X(this,"recoveredDataChannelIds",[]),X(this,"currentDataChannelId",1),X(this,"supportAV1RtpSpec",!1),X(this,"mutex",void 0),X(this,"qualityLimitationReason",hT.NONE),X(this,"isFirstConnected",!1),this.store=s,this.forceTurn=fH(r),this.mutex=new so("P2PConnection-mutex",s.clientId),this.peerConnection=new RTCPeerConnection(xy.resolvePCConfiguration(r),{optional:[{googDscp:!0}]}),this.isFirstConnected=!1,this.statsFilter=i2(this.peerConnection,oe("STATS_UPDATE_INTERVAL"),void 0,ii()?1200:void 0),this.bindPCEvents(),this.bindStatsEvents(),this.store.p2pId=this.store.p2pId+1,r.isPreallocation&&(this.isPreallocation=!0),this.establishPromise=this.establish()}getPreMedia(r){return this.preMediaMap.get(r)}isPreSub(){return this.preMediaMap.size>0}async updateRemoteRTPCapabilities(r,s){if(this.remoteCodecs=s,!this.remoteSDP)return void M.debug("[P2PConnection] cannot updateRemoteRTPCapabilities before remote SDP created, local codecs: ".concat(this.localCodecs,", codecs: ").concat(s));if(this.remoteSDP.updateRemoteCodec(r,s,this.store.codec)){const a=await this.peerConnection.createOffer(),c=this.logSDPExchange(a.sdp||"","offer","local","muteLocal");await this.peerConnection.setLocalDescription(a);const d=this.remoteSDP.toString();c==null||c(d),await this.peerConnection.setRemoteDescription({type:"answer",sdp:d})}else M.debug("[P2PConnection] updateRemoteRTPCapabilities no need to exchange SDP.")}async establish(){try{this.peerConnection.addTransceiver("video",{direction:"recvonly"}),this.peerConnection.addTransceiver("audio",{direction:"recvonly"});const a=await this.peerConnection.createOffer();if(!a.sdp)throw new Error("Cannot get initialOffer.sdp when trying to establish PeerConnection.");const c=sg(a.sdp),d=await U7({filterRTX:!oe("USE_PUB_RTX")&&!oe("USE_SUB_RTX"),filterVideoFec:oe("FILTER_VIDEO_FEC"),filterAudioFec:oe("FILTER_AUDIO_FEC"),filterVideoCodec:oe("FILTER_VIDEO_CODEC"),unsupportedVideoUplinkCodec:oe("UNSUPPORTED_VIDEO_UPLINK_CODEC"),unsupportedVideoDownlinkCodec:oe("UNSUPPORTED_VIDEO_DOWNLINK_CODEC")},this.extension);if(this.localCapabilities=aP(d),this.initialOffer=a,oe("ENABLE_SVC")&&this.store.codec=="av1"){const m=await(async function(){try{const g=new RTCPeerConnection;g.addTransceiver("video",{direction:"sendonly",sendEncodings:[{scalabilityMode:k1.L1T3}]});const v=await g.createOffer();if(!v.sdp)return void g.close();const w=nc(v.sdp).mediaDescriptions[0];if(!w)return;const I=w.attributes.extmaps.find((A=>A.extensionName==="https://aomediacodec.github.io/av1-rtp-spec/#dependency-descriptor-rtp-header-extension"));return g.close(),I}catch{return}})();var r;m&&(this.supportAV1RtpSpec=!0,(r=d.send)===null||r===void 0||r.videoExtensions.push(m))}let h;return a.sdp&&B7(a.sdp)&&(h=Kr(d),(s=h).send&&(b0(St.VIDEO,s.send.videoExtensions),b0(St.AUDIO,s.send.audioExtensions)),s.recv&&(b0(St.VIDEO,s.recv.videoExtensions),b0(St.AUDIO,s.recv.audioExtensions)),s.sendrecv&&(b0(St.VIDEO,s.sendrecv.videoExtensions),b0(St.AUDIO,s.sendrecv.audioExtensions))),nh(nh({},c),{},{rtpCapabilities:h||d,offerSDP:a.sdp})}catch(a){throw new Le(te.GET_LOCAL_CONNECTION_PARAMS_FAILED,a.toString())}var s}async connect(r){try{if(!this.initialOffer)throw new Error("Cannot establish P2PConnection without initial offer.");this.initialOffer.sdp&&B7(this.initialOffer.sdp)&&(s=r.rtpCapabilities,a=this.localCapabilities,s.send&&(iP(St.VIDEO,s.send.videoExtensions,a.send.videoExtensions),iP(St.AUDIO,s.send.audioExtensions,a.send.audioExtensions)),s.recv&&(iP(St.VIDEO,s.recv.videoExtensions,a.recv.videoExtensions),iP(St.AUDIO,s.recv.audioExtensions,a.recv.audioExtensions))),this.remoteSDP=new class{get localCapabilities(){return Kr(this._localCapabilities)}get rtpCapabilities(){return Kr(this._rtpCapabilities)}get candidates(){return Kr(this._candidates)}get iceParameters(){return Kr(this._iceParameters)}get dtlsParameters(){return Kr(this._dtlsParameters)}constructor(g){let v=arguments.length>1&&arguments[1]!==void 0&&arguments[1],w=arguments.length>2&&arguments[2]!==void 0&&arguments[2];X(this,"sessionDesc",void 0),X(this,"_localCapabilities",void 0),X(this,"_rtpCapabilities",void 0),X(this,"_candidates",void 0),X(this,"_originCandidates",void 0),X(this,"_iceParameters",void 0),X(this,"_isUseExtmapAllowMixed",void 0),X(this,"_isUseLocalCodecs",void 0),X(this,"_dtlsParameters",void 0),X(this,"setup",void 0),X(this,"currentMidIndex",void 0),X(this,"cname",void 0),X(this,"useLocalCodecsMids",[]),X(this,"preloadSsrcs",[]),X(this,"firefoxSsrcMidMap",new Map),this._isUseExtmapAllowMixed=v,this._isUseLocalCodecs=w,g=Kr(g);const{iceParameters:I,dtlsParameters:A,candidates:N,rtpCapabilities:H,setup:B,localCapabilities:z,cname:ee}=g;this._rtpCapabilities=H,this._candidates=N,this._originCandidates=Kr(N),this._iceParameters=I,this._dtlsParameters=A,this._localCapabilities=z,this.setup=B,this.cname=ee,[this.sessionDesc]=this.updateRemoteRTPCapabilities(H),this.currentMidIndex=this.sessionDesc.mediaDescriptions.length-1}checkPreloadSsrcs(g){return g.length===this.preloadSsrcs.length&&g.every((v=>{var w;return rt(w=this.preloadSsrcs).call(w,v)}))}preloadRemoteMedia(g){let v=0;const w=[],I=[];for(;g>0;){const A=[cM({ssrcId:pP+v},oe("USE_SUB_RTX")?{rtx:pP+v+1}:{})],N="".concat(pP+v,"_").concat(lM+v),{ssrcs:H,ssrcGroups:B}=CT(A,this.cname,oe("SYNC_GROUP")?N:void 0),z=this.preCreateOrRecycleSendMedia("video",H,B,void 0),ee=[{ssrcId:lM+v}],Z="".concat(pP+v,"_").concat(lM+v),{ssrcs:ae,ssrcGroups:ye}=CT(ee,this.cname,oe("SYNC_GROUP")?Z:void 0),_e=this.preCreateOrRecycleSendMedia("audio",ae,ye,void 0);g--,v+=2,w.push(z,_e),I.push(H[0].ssrcId,ae[0].ssrcId)}return this.useLocalCodecsMids.push(...w),this.preloadSsrcs=I,{mids:w,preSSRCs:I,isAvailable:!0}}preCreateOrRecycleSendMedia(g,v,w,I){const A=this.rtpCapabilities.send.videoCodecs,N=this._isUseLocalCodecs||A.length===0?this.localCapabilities.recv:this.rtpCapabilities.send;M.debug("create or recycle send media without remote rtp capabilities, ssrcs ",v[0].ssrcId);const H=g===St.VIDEO?N.videoCodecs:N.audioCodecs,B=g===St.VIDEO?N.videoExtensions:N.audioExtensions;this.currentMidIndex+=1;const z="".concat(this.currentMidIndex);let ee={media:{mediaType:g,port:hP,protos:["UDP","TLS","RTP","SAVPF"],fmts:H.map((Z=>Z.payloadType.toString(10)))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:this.candidates,extmaps:B,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:v,ssrcGroups:w,rtcpFeedbackWildcards:[],payloads:H,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:"sendonly",rtcpMux:!0,rtcpRsize:!0,mid:"".concat(z)}};return ee=this.mungSendMediaDesc(ee,I),this.sessionDesc.mediaDescriptions.push(ee),this.updateBundleMids(),z}toString(){return Zm(this.sessionDesc)}send(g,v,w,I){const{ssrcs:A,ssrcGroups:N}=CT(v,this.cname,oe("SYNC_GROUP")?w:void 0),H=this.findPreloadMediaDesc(A);if(H){if(ii()&&this.firefoxSsrcMidMap.set(A[0].ssrcId,H.attributes.mid),I&&(I.twcc||I.remb)){const B=this.sessionDesc.mediaDescriptions.indexOf(H);return this.sessionDesc.mediaDescriptions[B]=this.mungSendMediaDesc(H,I),{mid:H.attributes.mid,needExchangeSDP:!0}}return{mid:H.attributes.mid,needExchangeSDP:!1}}{const B=this.findAvailableMediaIndex(g,A);let z;return B===-1||B===1&&(Fs()||(function(){const ee=Mn();return!(ee.name!==Yn.CHROME||!ee.osVersion)&&Number(ee.version)<=90})()||oe("ENABLE_ENCODED_TRANSFORM")&&Ef())||B===0&&!(function(ee){const Z=Mn();return!(Z.name!==Yn.FIREFOX||!Z.osVersion)&&Number(Z.version)===ee})(138)&&oe("USE_SUB_RTX")||u9()?(z=this.createOrRecycleSendMedia(g,A,N,"sendonly",I),this.updateBundleMids()):(z=Kr(this.sessionDesc.mediaDescriptions[B]),z.attributes.direction="sendonly",z.attributes.ssrcs=A,z.attributes.ssrcGroups=N,this.sessionDesc.mediaDescriptions[B]=this.mungSendMediaDesc(z,I)),ii()&&this.firefoxSsrcMidMap.set(A[0].ssrcId,z.attributes.mid),{mid:z.attributes.mid,needExchangeSDP:!0}}}sendDataChannel(){const{mediaDesc:g,needExchangeSDP:v}=this.createOrRecycleDataChannel();return this.updateBundleMids(),{mid:g.attributes.mid,needExchangeSDP:v}}batchSend(g){const v=g.map((A=>{let{kind:N,ssrcMsg:H,mslabel:B}=A;return this.send(N,H,B)})),w=[];let I=!1;return v.forEach((A=>{let{mid:N,needExchangeSDP:H}=A;H&&(I=!0),w.push(N)})),{mids:w,needExchangeSDP:I}}stopSending(g){const v=this.sessionDesc.mediaDescriptions.filter((w=>w.attributes.mid&&g.indexOf(w.attributes.mid)!==-1));if(v.length!==g.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.stopSending.");v.forEach((w=>{w.attributes.mid==="0"||ii()||u9()?w.attributes.ssrcs=[]:(w.attributes.ssrcs=[],w.attributes.direction="inactive",w.media.port="0")})),this.updateBundleMids()}mute(g){const v=this.sessionDesc.mediaDescriptions.find((w=>w.attributes.mid===g));if(!v)throw new Error("mediaDescription not found with ".concat(g," in remote SDP when calling RemoteSDP.mute."));v.attributes.direction="inactive"}unmute(g){const v=this.sessionDesc.mediaDescriptions.find((w=>w.attributes.mid===g));if(!v)throw new Error("mediaDescription not found with ".concat(g," in remote SDP when calling RemoteSDP.unmute."));v.attributes.direction="sendonly"}muteRemote(g){const v=this.sessionDesc.mediaDescriptions.filter((w=>rt(g).call(g,w.attributes.mid||"")));if(v.length!==g.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");v.forEach((w=>{w.attributes.direction="inactive"}))}unmuteRemote(g){const v=this.sessionDesc.mediaDescriptions.filter((w=>rt(g).call(g,w.attributes.mid||"")));if(v.length!==g.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");v.forEach((w=>{w.attributes.direction="recvonly"}))}receive(g,v,w,I){g.forEach(((A,N)=>{this.createOrRecycleRecvMedia(A,[],"recvonly",v,w,I[N])})),this.updateBundleMids()}stopReceiving(g){const v=this.sessionDesc.mediaDescriptions.filter((w=>g.indexOf(w.attributes.mid)!==-1));if(v.length!==g.length)throw new Error("MediaDescriptions' length doesn't match mids's length when calling RemoteSDP.receive.");v.forEach((w=>{w.media.port="0",w.attributes.direction="inactive"})),this.updateBundleMids()}updateRemoteRTPCapabilities(g){const v=this.sessionDesc||nc((w=this._isUseExtmapAllowMixed,`v=0
o=- 0 0 IN IP4 127.0.0.1
s=AgoraGateway
t=0 0
a=group:BUNDLE 0 1
a=msid-semantic: WMS
a=ice-lite`.concat(w?`
a=extmap-allow-mixed`:"",`
m=video 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendonly
a=rtcp-mux
a=rtcp-rsize
a=mid:0
m=audio 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendonly
a=rtcp-mux
a=rtcp-rsize
a=mid:1
`)));var w;this._rtpCapabilities=g;let I=!1;const A=this.rtpCapabilities.send,N=this.localCapabilities.send,H=this.localCapabilities.recv,B=H.videoCodecs,z=H.audioCodecs,ee=H.videoExtensions,Z=H.audioExtensions;for(const ue of v.mediaDescriptions){var ae;if(ue.attributes.direction!=="sendonly"||typeof ue.attributes.mid!="string"||!rt(ae=this.useLocalCodecsMids).call(ae,ue.attributes.mid)){if(I=!0,ue.attributes.iceUfrag=this._iceParameters.iceUfrag,ue.attributes.icePwd=this._iceParameters.icePwd,ue.attributes.fingerprints=this._dtlsParameters.fingerprints,ue.attributes.candidates=this._candidates,ue.attributes.setup=this.setup,ue.media.mediaType==="application"&&(ue.attributes.sctpPort="5000"),ue.media.mediaType==="video")if(this._isUseLocalCodecs&&ue.attributes.direction==="sendonly"){var ye;ue.media.fmts=B.map((Ue=>Ue.payloadType.toString(10))),ue.attributes.payloads=B,ue.attributes.extmaps=ee;const Ae=ue.attributes.mid;typeof Ae!="string"||rt(ye=this.useLocalCodecsMids).call(ye,Ae)||this.useLocalCodecsMids.push(Ae)}else if(A.videoCodecs.length===0){const Ae=N.videoCodecs.filter((Ue=>{var We,Ze;return(We=Ue.rtpMap)===null||We===void 0?void 0:rt(Ze=We.encodingName.toLowerCase()).call(Ze,"vp8")}))||[N.videoCodecs[0]];ue.media.fmts=Ae.map((Ue=>Ue.payloadType.toString(10))),ue.attributes.payloads=Ae,ue.attributes.extmaps=[]}else ue.media.fmts=A.videoCodecs.map((Ae=>Ae.payloadType.toString(10))),ue.attributes.payloads=A.videoCodecs,ue.attributes.extmaps=A.videoExtensions;if(ue.media.mediaType==="audio")if(this._isUseLocalCodecs&&ue.attributes.direction==="sendonly"){var _e;ue.media.fmts=z.map((Ue=>Ue.payloadType.toString(10))),ue.attributes.payloads=z,ue.attributes.extmaps=Z;const Ae=ue.attributes.mid;typeof Ae!="string"||rt(_e=this.useLocalCodecsMids).call(_e,Ae)||this.useLocalCodecsMids.push(Ae)}else if(A.audioCodecs.length===0){const Ae=N.audioCodecs.filter((Ue=>{var We,Ze;return(We=Ue.rtpMap)===null||We===void 0?void 0:rt(Ze=We.encodingName.toLowerCase()).call(Ze,"opus")}))||[N.audioCodecs[0]];ue.media.fmts=Ae.map((Ue=>Ue.payloadType.toString(10))),ue.attributes.payloads=Ae,ue.attributes.extmaps=[]}else ue.media.fmts=A.audioCodecs.map((Ae=>Ae.payloadType.toString(10))),ue.attributes.payloads=A.audioCodecs,ue.attributes.extmaps=A.audioExtensions,T0(ue)}}return this.sessionDesc=v,this.currentMidIndex=v.mediaDescriptions.length-1,[this.sessionDesc,I]}updateCandidates(g){const v=this._originCandidates.filter((I=>I.transport==="udp")),w=[];if(v.forEach((I=>{w.push(cM(cM({},I),{},{foundation:"tcpcandidate",priority:Number(I.priority)-1+"",transport:"tcp",port:Number(I.port)+90+""}))})),v.length!==0){switch(g){case co.TCP_RELAY:this._candidates=w;break;case co.UDP_TCP_RELAY:case co.RELAY:this._candidates=[...v,...w];break;default:this._candidates=v}for(const I of this.sessionDesc.mediaDescriptions)I.attributes.candidates=this.candidates}}restartICE(g){g=Kr(g),this._iceParameters=g,this.sessionDesc.mediaDescriptions.forEach((v=>{v.attributes.iceUfrag=g.iceUfrag,v.attributes.icePwd=g.icePwd}))}predictReceivingMids(g){const v=[];for(let w=0;w<g;w++)v.push((this.currentMidIndex+w+1).toString(10));return v}findAvailableMediaIndex(g,v){return this.sessionDesc.mediaDescriptions.findIndex((w=>{const I=w.media.mediaType===g&&w.media.port!=="0"&&(w.attributes.direction==="sendonly"||w.attributes.direction==="sendrecv")&&w.attributes.ssrcs.length===0;if(ii()){if(I){const A=this.firefoxSsrcMidMap.get(v[0].ssrcId);return!(A||w.attributes.mid!=="0"&&w.attributes.mid!=="1")||!(!A||A!==w.attributes.mid)}return!1}return I}))}createOrRecycleDataChannel(){for(const w of this.sessionDesc.mediaDescriptions)if(w.media.mediaType==="application")return{mediaDesc:w,needExchangeSDP:!1};this.currentMidIndex+=1;const g="".concat(this.currentMidIndex),v={media:{mediaType:"application",port:hP,protos:["UDP","DTLS","SCTP"],fmts:["webrtc-datachannel"]},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:this.candidates,extmaps:[],fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:[],ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:[],rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,mid:"".concat(g),sctpPort:"5000"}};return this.sessionDesc.mediaDescriptions.push(v),{mediaDesc:v,needExchangeSDP:!0}}createOrRecycleRecvMedia(g,v,w,I,A,N){const H=g._mediaStreamTrack.kind,B=this.rtpCapabilities.recv,z=RT(H,B,this.localCapabilities.send,H===St.VIDEO?I:A),ee=H===St.VIDEO?B.videoExtensions:B.audioExtensions;this.currentMidIndex+=1;const Z="".concat(this.currentMidIndex);let ae={media:{mediaType:H,port:hP,protos:["UDP","TLS","RTP","SAVPF"],fmts:z.map((_e=>_e.payloadType.toString(10)))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:this.candidates,extmaps:ee,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:v,ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:z,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:w,rtcpMux:!0,rtcpRsize:!0,mid:"".concat(Z)}};ae=this.mungRecvMediaDsec(ae,g,N);const ye=this.findFirstClosedMedia(H);if(ye){const _e=this.sessionDesc.mediaDescriptions.indexOf(ye);this.sessionDesc.mediaDescriptions[_e]=ae}else this.sessionDesc.mediaDescriptions.push(ae);return ae}updateRemoteDtlsParameters(g){const v=new Set(this._dtlsParameters.fingerprints.map((A=>A.fingerprint))),w=new Set(g.map((A=>A.fingerprint)));let I=!1;v.size!==w.size&&(I=!0);for(const A of v)w.has(A)||(I=!0);return I}updateRemoteCodec(g,v,w){const I=[...new Set(this._rtpCapabilities.recv.videoCodecs.map((ae=>ae.rtpMap&&ae.rtpMap.encodingName.toLowerCase()||"")).filter((ae=>{var ye;return rt(ye=Object.keys(fT)).call(ye,ae)})))],A=new Set(v);if(I.every((ae=>A.has(ae))))return M.debug("codecs has not changed, no need to updateRemoteCodec, codecs: ".concat(v)),!1;const N=this._rtpCapabilities.recv.videoCodecs.filter((ae=>v.some((ye=>{var _e;return rt(_e=ae.rtpMap&&ae.rtpMap.encodingName.toLowerCase()||"").call(_e,ye)}))));if(N.length===0)return M.debug("updateRemoteCodec failed, because cannot find matched codec, remoteCapabilities codecs: ".concat(I," codecs: ").concat(v)),!1;const H=[...new Set(N.map((ae=>ae.rtpMap&&ae.rtpMap.encodingName.toLowerCase()||"")))];let B;if(M.debug("updateRemoteCodec, from ".concat(I," to ").concat(H)),g.length===0)B=this.sessionDesc.mediaDescriptions.filter((ae=>ae.media.mediaType==="video"&&ae.attributes.direction==="recvonly"));else if(B=this.sessionDesc.mediaDescriptions.filter((ae=>ae.attributes.mid&&ae.media.mediaType==="video"&&rt(g).call(g,ae.attributes.mid)&&ae.attributes.direction==="recvonly")),B.length!==g.length)return M.debug("updateRemoteCodec failed, because cannot find mids, mids: ".concat(g,", codecs: ").concat(v)),!1;if(oe("USE_PUB_RTX")||oe("USE_SUB_RTX")){const ae=og(N,this.rtpCapabilities.recv.videoCodecs);N.push(...ae)}this._rtpCapabilities.recv.videoCodecs=N;const z=this.localCapabilities.send,ee=this.rtpCapabilities.recv,Z=RT(St.VIDEO,ee,z,w);return B.forEach((ae=>{const ye=Z.map((_e=>_e.payloadType.toString(10)));M.debug("updateRemoteCodec mid: ".concat(ae.attributes.mid,", from"),ae.attributes.payloads,"to",Z),ae.attributes.payloads=Z,ae.media.fmts=ye})),!0}createOrRecycleSendMedia(g,v,w,I,A){const N=this.rtpCapabilities.send.videoCodecs,H=this._isUseLocalCodecs||N.length===0?this.localCapabilities.recv:this.rtpCapabilities.send,B=g===St.VIDEO?H.videoCodecs:H.audioCodecs,z=g===St.VIDEO?H.videoExtensions:H.audioExtensions;this.currentMidIndex+=1;const ee="".concat(this.currentMidIndex);let Z={media:{mediaType:g,port:hP,protos:["UDP","TLS","RTP","SAVPF"],fmts:B.map((ye=>ye.payloadType.toString(10)))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:this.candidates,extmaps:z,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:v,ssrcGroups:w,rtcpFeedbackWildcards:[],payloads:B,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:I,rtcpMux:!0,rtcpRsize:!0,mid:"".concat(ee)}};Z=this.mungSendMediaDesc(Z,A);const ae=this.findFirstClosedMedia(g);if(ae){const ye=this.sessionDesc.mediaDescriptions.indexOf(ae);this.sessionDesc.mediaDescriptions[ye]=Z}else this.sessionDesc.mediaDescriptions.push(Z);return Z}updateBundleMids(){this.sessionDesc.attributes.groups[0].identificationTag=this.sessionDesc.mediaDescriptions.filter((g=>g.media.port!=="0")).map((g=>g.attributes.mid))}mungRecvMediaDsec(g,v,w){const I=Kr(g);return Y2(I),w0(I,v),X2(I,v),L7(I),oP(I,w,this.localCapabilities.send),I}mungSendMediaDesc(g,v){const w=Kr(g);return oP(w,v,this.localCapabilities.recv),T0(w),w}updateRecvMedia(g,v){const w=this.sessionDesc.mediaDescriptions.findIndex((I=>I.attributes.mid===g));if(w!==-1){const I=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[w],v);this.sessionDesc.mediaDescriptions[w]=I}}bumpMid(g){this.currentMidIndex+=g}findFirstClosedMedia(g){return this.sessionDesc.mediaDescriptions.find((v=>ii()?v.media.port==="0"&&v.media.mediaType===g:v.media.port==="0"))}findPreloadMediaDesc(g){return this.sessionDesc.mediaDescriptions.find((v=>{var w;return((w=v.attributes)===null||w===void 0||(w=w.ssrcs[0])===null||w===void 0?void 0:w.ssrcId)===g[0].ssrcId}))}getSSRC(g){var v;return(v=this.sessionDesc.mediaDescriptions.find((w=>w.attributes.mid===g)))===null||v===void 0?void 0:v.attributes.ssrcs}}(nh(nh({},r),{},{localCapabilities:this.localCapabilities}),this.supportAV1RtpSpec,!(!oe("ENABLE_PRE_SUB_WITH_PRE_PC")||!oe("PRE_USE_LOCAL_CODECS"))&&h2(this.store)),r.preallocation&&(this.isPreallocation=!0),Array.isArray(this.remoteCodecs)&&this.remoteCodecs.length>0&&this.remoteSDP.updateRemoteCodec([],this.remoteCodecs,this.store.codec);const c=this.remoteSDP.toString(),d=j7(this.initialOffer.sdp,this.extension),h=this.logSDPExchange(d||"","offer","local","connect");this.store.descriptionStart(),await this.peerConnection.setLocalDescription({type:"offer",sdp:d}),h==null||h(c),await this.peerConnection.setRemoteDescription({type:"answer",sdp:c});const m=this.peerConnection.getTransceivers()[0];if(m!=null&&m.receiver&&this.tryBindTransportEvents(m.receiver),h2(this.store))if(r.preallocation&&oe("ENABLE_PRE_SUB_WITH_PRE_PC")){const g=oe("PRE_SUB_NUM"),{mids:v,preSSRCs:w}=this.remoteSDP.preloadRemoteMedia(g);await ag(this.peerConnection,this.remoteSDP,this.extension),M.debug("[".concat(this.store.clientId,"] [P2PConnection] preload media, in pre pc,add preload ssrcs ").concat(w)),this.presetMedia(v,w)}else{const{preSSRCs:g=[]}=r,v=g.map((I=>I.ssrcMsg[0].ssrcId));if(g.length===0)return;const{mids:w}=this.remoteSDP.batchSend(g.map((I=>Object.assign({},I))));await ag(this.peerConnection,this.remoteSDP,this.extension),M.debug("[P2PConnection.connect] preload media, after join, add preload ssrcs ".concat(v)),this.presetMedia(w,v)}}catch(c){throw new Le(te.EXCHANGE_SDP_FAILED,"P2PConnection.connect failed; ".concat(c.toString()))}var s,a}presetMedia(r,s){r.forEach(((a,c)=>{this.peerConnection.getTransceivers().forEach((d=>{if(d.mid!=null&&a===d.mid&&d.receiver.track){const h=d.receiver.track;let m;h.kind==="video"&&oe("ENABLE_PRE_RENDER")&&(m=new C2({trackId:"track-".concat(h.kind,"-unknown-").concat(this.store.clientId,"_").concat(Tr(5,""))},!0),m.updateVideoTrack(h),m.onFirstVideoFrameRender=()=>{var g;const v=this.preMediaMap.get(s[c]);v&&(v.firstVideoRender=Date.now()),(g=this.onFirstVideoRender)===null||g===void 0||g.call(this,s[c])},m.play(this.store.sessionId||void 0)),this.preMediaMap.set(s[c],{mid:a,track:h,player:m,transceiver:d})}})),this.store.peerReceiver()}))}checkDtlsParameters(r){return!!this.remoteSDP&&r.length>0&&this.remoteSDP.updateRemoteDtlsParameters(r)}async updateRemoteConnect(r){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.updateRemoteConnect before remote SDP created");let s=!1;const{rtpCapabilities:a}=r;if([,s]=this.remoteSDP.updateRemoteRTPCapabilities(a),Array.isArray(this.remoteCodecs)&&this.remoteCodecs.length>0){const h=this.remoteSDP.updateRemoteCodec([],this.remoteCodecs,this.store.codec);s=s||h}const{preSSRCs:c=[]}=r,d=c.map((h=>h.ssrcMsg[0].ssrcId));if(!this.remoteSDP.checkPreloadSsrcs(d)){const h=[],m=[];if(Array.from(this.preMediaMap.entries()).every((g=>{let[v,{mid:w,player:I,track:A}]=g;return h.push(w),m.push(v),this.preMediaMap.delete(v),I&&I.destroy(),!0})),h.length>0&&(this.remoteSDP.stopSending(h),await ag(this.peerConnection,this.remoteSDP,this.extension),M.warn("[P2PConnection.updateRemoteConnect] preload media, failed, del preload ssrcs ".concat(m)),It.reportApiInvoke(this.store.sessionId,{name:pi.PRELOAD_MEDIA_FAILED,options:[c,m],tag:$r.TRACER}).onSuccess()),c.length>0){const{mids:g}=this.remoteSDP.batchSend(c.map((v=>Object.assign({},v))));await ag(this.peerConnection,this.remoteSDP,this.extension),M.debug("[P2PConnection.updateRemoteConnect] preload media, after join, add preload ssrcs ".concat(d)),this.presetMedia(g,d)}}s?(await ag(this.peerConnection,this.remoteSDP,this.extension),M.debug("[P2PConnection] updateRemoteConnect by exchanging SDP.")):M.debug("[P2PConnection] updateRemoteConnect no need to exchange SDP, because no need to update remote codecs (use local codecs)")}catch(s){throw new Le(te.EXCHANGE_SDP_FAILED,"P2PConnection.updateRemoteConnect failed; ".concat(s.toString()))}}send(r,s,a){var c=this;return Ql((function*(){const d=yield zn(c.mutex.lock("From P2PConnection.send"));try{if(!c.remoteSDP)throw new Error("Cannot call P2PConnection.send before remote SDP created");const h=[],m=rP();r.forEach((z=>{const ee=c.peerConnection.addTransceiver(z._mediaStreamTrack,nh({direction:"sendonly"},z.trackMediaType==="video"&&c.supportAV1RtpSpec&&m?{sendEncodings:[{scalabilityMode:m}]}:{}));h.push(ee),z._updateRtpTransceiver(ee)})),ii()&&oe("SIMULCAST")===!0&&(yield zn(c.applySimulcastForFirefox(h,r)));const g=yield zn(c.peerConnection.createOffer()),v=c.remoteSDP.predictReceivingMids(r.length),w=c.mungSendOfferSDP(g.sdp,r,v),I=nc(w),A=v.map((z=>{const ee=I.mediaDescriptions.find((Z=>Z.attributes.mid===z));if(!ee)throw new Error("Cannot extract ssrc from mediaDescription.");return N7(ee,oe("USE_PUB_RTX"))}));let N;try{N=yield A}catch(z){N=[],c.remoteSDP.receive(r,s,a,N);const ee=c.remoteSDP.toString();throw yield zn(c.peerConnection.setLocalDescription({type:"offer",sdp:w})),yield zn(c.peerConnection.setRemoteDescription({type:"answer",sdp:ee})),yield zn(c.stopSending(v,!0)),z}c.remoteSDP.receive(r,s,a,N);const H=c.remoteSDP.toString(),B=c.logSDPExchange(w,"offer","local","send");return yield zn(c.peerConnection.setLocalDescription({type:"offer",sdp:w})),yield zn(c.applySimulcastEncodings(h,r)),yield zn(c.applySendEncodings(h,r)),B==null||B(H),yield zn(c.peerConnection.setRemoteDescription({type:"answer",sdp:H})),h.map(((z,ee)=>{const Z=v[ee];return{localSSRC:A[ee],id:Z,transceiver:z}}))}catch(h){throw h instanceof Le?h:new Le(te.EXCHANGE_SDP_FAILED,"P2PConnection.send failed; ".concat(h.toString()))}finally{d()}}))()}async createDataChannels(r,s){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.createDataChannels before remote SDP created");let a=this.dataStreamChannelMap.get(r);if(a&&a.readyState==="open")M.debug("[P2PConnection] Channels are already available and can be reused directly.");else{const d=this.currentDataChannelId<1023?this.currentDataChannelId++:this.recoveredDataChannelIds.shift();if(typeof d!="number")throw new Error("create DataChannel error, because cannot get dc id");a=this.peerConnection.createDataChannel("datastream-channel",{id:d,negotiated:!0,ordered:!1,maxRetransmits:oe("DATASTREAM_MAX_RETRANSMITS")}),a.binaryType="arraybuffer",this.dataStreamChannelMap.set(r,a)}s.forEach((d=>{d._updateOriginDataChannel(a)}));const{needExchangeSDP:c}=this.remoteSDP.sendDataChannel();if(c){const d=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:d});const h=await this.peerConnection.createAnswer();await this.peerConnection.setLocalDescription(h),M.debug("[P2PConnection] createDataChannels by exchanging SDP.")}else M.debug("[P2PConnection] createDataChannels no need to exchange SDP.");return}catch(a){throw a instanceof Le?a:new Le(te.EXCHANGE_SDP_FAILED,"P2PConnection.createDataChannels failed; ".concat(a.toString()))}}async stopDataChannels(r){try{const s=this.dataStreamChannelMap.get(r);return s&&(s.id&&this.recoveredDataChannelIds.push(s.id),s.close()),void this.dataStreamChannelMap.delete(r)}catch(s){throw s instanceof Le?s:new Le(te.DATACHANNEL_FAILED,"P2PConnection.stopDataChannels failed; ".concat(s.toString()))}}async stopSending(r,s){const a=s?void 0:await this.mutex.lock("From P2PConnection.stopSending");try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopSending before remote SDP created");const c=this.peerConnection.getTransceivers().filter((g=>r.indexOf(g.mid)!==-1));if(c.length!==r.length)throw new Error("Transceivers' length doesn't match mids' length when trying to call P2PConnection.stopSending.");c.map((g=>{var v;gP(this.id+g.mid,this),g.direction="inactive",(v=g.stop)===null||v===void 0||v.call(g)}));const d=await this.peerConnection.createOffer(),h=this.logSDPExchange(d.sdp||"","offer","local","stopSending");await this.peerConnection.setLocalDescription(d),this.remoteSDP.stopReceiving(r);const m=this.remoteSDP.toString();h==null||h(m),await this.peerConnection.setRemoteDescription({type:"answer",sdp:m})}catch(c){throw new Le(te.EXCHANGE_SDP_FAILED,"P2PConnection.stopSending failed; ".concat(c.toString()))}finally{a&&a()}}async receive(r,s,a,c){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.receive ".concat(r," before remoteSDP created."));const{mid:d,needExchangeSDP:h}=this.remoteSDP.send(r,s,a,c);h&&(await ag(this.peerConnection,this.remoteSDP,this.extension),M.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(r," by exchanging SDP.")));const m=this.peerConnection.getTransceivers().find((g=>g.mid===d));if(!m)throw new Error("Cannot get transceiver after setLocalDescription.");return{track:m.receiver.track,id:d,transceiver:m}}catch(d){throw new Le(te.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(d.toString()))}}async batchReceive(r){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.batchReceive before remoteSDP created.");const{mids:s,needExchangeSDP:a}=this.remoteSDP.batchSend(r);return a&&(await ag(this.peerConnection,this.remoteSDP,this.extension),M.debug("[".concat(this.store.clientId,"] [P2PConnection] batchReceive by exchanging SDP."))),s.map((c=>{const d=this.peerConnection.getTransceivers().find((h=>h.mid===c));if(!d)throw new Error("Cannot get transceiver after setLocalDescription.");return{track:d.receiver.track,id:c,transceiver:d}}))}catch(s){throw new Le(te.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(s.toString()))}}async stopReceiving(r){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopReceiving before remote SDP created.");r.forEach((d=>{Array.from(this.preMediaMap.entries()).some((h=>{let[m,{mid:g,player:v}]=h;if(g===d)return this.preMediaMap.delete(m),v&&v.destroy(),!0}))})),this.remoteSDP.stopSending(r);const s=this.remoteSDP.toString(),a=this.logSDPExchange(s,"offer","remote","stopReceiving");await this.peerConnection.setRemoteDescription({type:"offer",sdp:s});const c=await this.peerConnection.createAnswer();a==null||a(c.sdp||""),await this.peerConnection.setLocalDescription(c)}catch(s){throw new Le(te.EXCHANGE_SDP_FAILED,"P2PConnection stopReceiving failed; ".concat(s.toString()))}}async muteRemote(r){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.muteRemote mid=".concat(r," before remote SDP created."));this.remoteSDP.mute(r);const s=this.remoteSDP.toString(),a=this.logSDPExchange(s,"offer","remote","muteRemote");await this.peerConnection.setRemoteDescription({type:"offer",sdp:s});const c=await this.peerConnection.createAnswer();a==null||a(c.sdp||""),await this.peerConnection.setLocalDescription(c)}catch(s){throw new Le(te.EXCHANGE_SDP_FAILED,"P2PConnection.muteRemote failed; ".concat(s.toString()))}}async unmuteRemote(r){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.unmuteRemote mid=".concat(r," before remote SDP created."));this.remoteSDP.unmute(r);const s=this.remoteSDP.toString(),a=this.logSDPExchange(s,"offer","remote","unmuteRemote");await this.peerConnection.setRemoteDescription({type:"offer",sdp:s});const c=await this.peerConnection.createAnswer();a==null||a(c.sdp||""),await this.peerConnection.setLocalDescription(c)}catch(s){throw new Le(te.EXCHANGE_SDP_FAILED,"P2PConnection.unmuteRemote failed; ".concat(s.toString()))}}async muteLocal(r){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.muteLocal before remote SDP created.");const s=this.peerConnection.getTransceivers().filter((h=>h.mid&&r.indexOf(h.mid)!==-1));if(s.length!==r.length)throw new Error("Transceivers' length doesn't match mids' length.");s.map((h=>{h.direction="inactive"}));const a=await this.peerConnection.createOffer(),c=this.logSDPExchange(a.sdp||"","offer","local","muteLocal");await this.peerConnection.setLocalDescription(a),this.remoteSDP.muteRemote(r);const d=this.remoteSDP.toString();c==null||c(d),await this.peerConnection.setRemoteDescription({type:"answer",sdp:d})}catch(s){throw new Le(te.EXCHANGE_SDP_FAILED,"P2PConnection.muteLocal failed; ".concat(s.toString()))}}async unmuteLocal(r){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.unmuteLocal before remote SDP created.");const s=this.peerConnection.getTransceivers().filter((h=>h.mid&&r.indexOf(h.mid)!==-1));if(s.length!==r.length)throw new Error("Transceivers' length doesn't match mids' length.");s.map((async(h,m)=>{h.direction="sendonly"}));const a=await this.peerConnection.createOffer(),c=this.logSDPExchange(a.sdp||"","offer","local","unmuteLocal");await this.peerConnection.setLocalDescription(a),this.remoteSDP.unmuteRemote(r),Array.isArray(this.remoteCodecs)&&this.remoteCodecs.length>0&&this.remoteSDP.updateRemoteCodec(r,this.remoteCodecs,this.store.codec);const d=this.remoteSDP.toString();c==null||c(d),await this.peerConnection.setRemoteDescription({type:"answer",sdp:d})}catch(s){throw new Le(te.EXCHANGE_SDP_FAILED,"P2PConnection.unmuteLocal failed; ".concat(s.toString()))}}restartICE(r){var s=this;return Ql((function*(){const a=yield zn(s.mutex.lock("From P2PConnection.restartICE"));try{if(!s.remoteSDP)throw new Error("Cannot restartICE before remoteSDP created.");const c=Wn().supportPCSetConfiguration,d=oe("FORCE_TURN_TCP")||s.forceTurn;if(r===co.RELAY&&!c)return;if(c&&!d){const I=r===co.RELAY?"relay":"all",A=s.peerConnection.getConfiguration();A.iceTransportPolicy!==I&&(M.debug("[".concat(s.store.clientId,"] restartICE change iceTransportPolicy from [").concat(A.iceTransportPolicy,"] to [").concat(I,"]")),A.iceTransportPolicy=I,s.peerConnection.setConfiguration(A))}s.remoteSDP.updateCandidates(r);const h=yield zn(s.peerConnection.createOffer({iceRestart:!0}));if(!h.sdp)throw new Error("Cannot restartICE because restart offer SDP does not exist.");const m=sg(h.sdp),{remoteIceParameters:g}=yield m.iceParameters;s.remoteSDP.restartICE(g);const v=s.remoteSDP.toString(),w=s.logSDPExchange(h.sdp||"","offer","local","restartICE");s.store.descriptionStart(),yield zn(s.peerConnection.setLocalDescription(h)),w==null||w(v),yield zn(s.peerConnection.setRemoteDescription({type:"answer",sdp:v}))}catch(c){M.warning("[".concat(s.store.clientId,"] restart ICE failed, abort operation"),c)}finally{a()}}))()}async extendCandidate(){if(!this.remoteSDP||this.isFirstConnected)return;const r=await this.mutex.lock("From P2PConnection.extendCandidate");try{this.remoteSDP.updateCandidates(co.TCP_RELAY),await ag(this.peerConnection,this.remoteSDP,this.extension)}catch(s){M.warning("[".concat(this.store.clientId,"] extend candidate failed, abort operation"),s)}finally{r()}}close(){var r;this.peerConnection.getTransceivers().forEach((s=>{gP(this.id+s.mid,this)})),this.preMediaMap.forEach((s=>{let{player:a}=s;a&&a.destroy()})),this.preMediaMap.clear(),this.peerConnection.close(),(r=this.onConnectionStateChange)===null||r===void 0||r.call(this,"closed"),this.tryUnbindTransportEvents(),this.unbindPCEvents(),this.unbindStatsEvents(),this.removeAllListeners(),this.transportEventReceiver=void 0,this.statsFilter.destroy(),this.dataStreamChannelMap.clear(),this.recoveredDataChannelIds=[],this.currentDataChannelId=1}getStats(){return nh(nh({},this.statsFilter.getStats()),{},{qualityLimitationReason:this.qualityLimitationReason})}getRemoteVideoIsReady(r){return this.statsFilter.getVideoIsReady(r)}async updateEncoderConfig(r,s){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.updateEncoderConfig before remote SDP created.");const a=await this.peerConnection.createOffer(),c=this.mungSendOfferSDP(a.sdp,[s],[r]);this.remoteSDP.updateRecvMedia(r,s);const d=this.remoteSDP.toString(),h=this.logSDPExchange(c,"offer","local","updateEncoderConfig");await this.peerConnection.setLocalDescription({type:"offer",sdp:c}),h==null||h(d),await this.peerConnection.setRemoteDescription({type:"answer",sdp:d})}catch(a){throw new Le(te.EXCHANGE_SDP_FAILED,a.toString())}}async updateSendParameters(r,s){const a=this.peerConnection.getTransceivers().filter((c=>c.mid===r));a.length===1&&(this.isVP8Simulcast(s)?ii()||await this.applySimulcastEncodings(a,[s]):await this.applySendEncodings(a,[s]))}setStatsRemoteVideoIsReady(r,s){this.statsFilter.setVideoIsReady2(r,s)}async replaceTrack(r,s){const a=this.peerConnection.getTransceivers().find((c=>c.mid===s));a&&await a.sender.replaceTrack(r._mediaStreamTrack)}async getSelectedCandidatePair(){const r=this.peerConnection.getReceivers();if(r.length>0&&r[0].transport&&r[0].transport.iceTransport&&r[0].transport.iceTransport.getSelectedCandidatePair&&r[0].transport.iceTransport.getSelectedCandidatePair()){const s=r[0].transport.iceTransport,{local:a,remote:c}=s.getSelectedCandidatePair();return{local:nh(nh({},op),{},{candidateType:a.type,protocol:a.protocol,address:a.address,port:a.port}),remote:nh(nh({},op),{},{candidateType:c.type,protocol:c.protocol,address:c.address,port:c.port})}}return this.statsFilter.getSelectedCandidatePair()}bindPCEvents(){this.peerConnection.oniceconnectionstatechange=()=>{var r;(r=this.onICEConnectionStateChange)===null||r===void 0||r.call(this,this.peerConnection.iceConnectionState)},this.peerConnection.onconnectionstatechange=()=>{var r;this.peerConnection.connectionState==="connected"&&(this.isFirstConnected=!0),(r=this.onConnectionStateChange)===null||r===void 0||r.call(this,this.peerConnection.connectionState)},this.peerConnection.onicecandidateerror=r=>{if(r&&(r.errorCode||r.errorText)){var s;const a="code: ".concat(r.errorCode,", message: ").concat(r.errorText),c=r.port?"local: ".concat(r.port):"",d=fy(r.url||"");M.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICECandidateError(").concat(a,"), url: ").concat(d||"",", host_candidate:").concat(c)),(s=this.onICECandidateError)===null||s===void 0||s.call(this,a)}},this.peerConnection.onicegatheringstatechange=r=>{r&&r.target&&"iceGatheringState"in r.target&&M.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] RTCPeerConnection.onicegatheringstatechange(").concat(r.target.iceGatheringState,")"))},this.peerConnection.onicecandidate=r=>{r.candidate?this.localCandidateCount+=1:(this.peerConnection.onicecandidate=null,this.allCandidatesReceived=!0,M.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] local candidate count"),this.localCandidateCount))},setTimeout((()=>{this.allCandidatesReceived||(this.allCandidatesReceived=!0,M.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] onicecandidate timeout, local candidate count"),this.localCandidateCount))}),oe("CANDIDATE_TIMEOUT"))}unbindPCEvents(){this.peerConnection.oniceconnectionstatechange=null,this.peerConnection.onconnectionstatechange=null,this.peerConnection.onsignalingstatechange=null,this.peerConnection.onicecandidateerror=null,this.peerConnection.onicecandidate=null,this.peerConnection.ontrack=null}static resolvePCConfiguration(r){const s={iceServers:[]},a=r.cloudProxyServer||"disabled";return r.iceServers?s.iceServers=r.iceServers:r.turnServer&&(lT(r.turnServer.servers)?s.iceServers=r.turnServer.servers:oe("NEW_TURN_MODE")&&s.iceServers&&a==="disabled"?(oe("USE_TURN_SERVER_OF_GATEWAY")?r.turnServer.serversFromGateway&&s.iceServers.push(...xy.newTurnServerConfigToIceServers(r.turnServer.serversFromGateway)):s.iceServers.push(...xy.newTurnServerConfigToIceServers(r.turnServer.servers)),oe("NEW_FORCE_TURN")&&(s.iceTransportPolicy="relay")):r.turnServer.mode!=="off"&&(s.iceServers&&s.iceServers.push(...xy.turnServerConfigToIceServers(r.turnServer.servers)),oe("USE_TURN_SERVER_OF_GATEWAY")&&s.iceServers&&r.turnServer.serversFromGateway&&s.iceServers.push(...xy.turnServerConfigToIceServers(r.turnServer.serversFromGateway)),oe("FORCE_TURN_TCP")?s.iceTransportPolicy="relay":r.turnServer.servers.concat(r.turnServer.serversFromGateway||[]).forEach((c=>{c.forceturn&&(s.iceTransportPolicy="relay")})))),oe("ENABLE_ENCODED_TRANSFORM")&&Wn().supportWebRTCEncodedTransform&&(s.encodedInsertableStreams=!0),s}static turnServerConfigToIceServers(r){const s=[];return r.forEach((a=>{a.security?a.tcpport&&s.push({username:a.username,credential:a.password,credentialType:"password",urls:"turns:".concat(rg(a.turnServerURL),":").concat(a.tcpport,"?transport=tcp")}):(a.udpport&&!oe("FORCE_TURN_TCP")&&s.push({username:a.username,credential:a.password,credentialType:"password",urls:"turn:".concat(a.turnServerURL,":").concat(a.udpport,"?transport=udp")}),a.tcpport&&s.push({username:a.username,credential:a.password,credentialType:"password",urls:"turn:".concat(a.turnServerURL,":").concat(a.tcpport,"?transport=tcp")}))})),s}static newTurnServerConfigToIceServers(r){const s=[];return r.forEach((a=>{const c=oe("NEW_TURN_MODE");c===1?s.push({username:a.username,credential:a.password,credentialType:"password",urls:"turn:".concat(a.turnServerURL,":3478?transport=udp")}):c===2?s.push({username:a.username,credential:a.password,credentialType:"password",urls:"turn:".concat(a.turnServerURL,":3478?transport=tcp")}):c===3?s.push({username:a.username,credential:a.password,credentialType:"password",urls:"turns:".concat(rg(a.turnServerURL),":443?transport=tcp")}):c===4&&(s.push({username:a.username,credential:a.password,credentialType:"password",urls:"turn:".concat(a.turnServerURL,":3478?transport=udp")}),s.push({username:a.username,credential:a.password,credentialType:"password",urls:"turn:".concat(a.turnServerURL,":3478?transport=tcp")}),s.push({username:a.username,credential:a.password,credentialType:"password",urls:"turns:".concat(rg(a.turnServerURL),":443?transport=tcp")}))})),s}tryBindTransportEvents(r){const s=r.transport;if(s){this.transportEventReceiver=r,s.onstatechange=()=>{var c;s!=null&&s.state&&((c=this.onDTLSTransportStateChange)===null||c===void 0||c.call(this,s.state))},s.onerror=c=>{var d;(d=this.onDTLSTransportError)===null||d===void 0||d.call(this,"error"in c?c.error:c)};const a=s.iceTransport;a&&(a.onstatechange=()=>{const c=s==null?void 0:s.iceTransport.state;var d;c&&((d=this.onICETransportStateChange)===null||d===void 0||d.call(this,c))},a.getSelectedCandidatePair&&(a.onselectedcandidatepairchange=()=>{if(a.getSelectedCandidatePair()){const{local:c,remote:d}=a.getSelectedCandidatePair()||{};if(c&&d){const h=c.address+":"+c.port,m=d.address+":"+d.port;M.info("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] selectedcandidatepairchange: local ").concat(JSON.stringify(fy(h)),", remote ").concat(JSON.stringify(fy(m))))}}}))}}tryUnbindTransportEvents(){this.transportEventReceiver&&this.transportEventReceiver.transport&&(this.transportEventReceiver.transport.onstatechange=null,this.transportEventReceiver.transport.onerror=null,this.transportEventReceiver.transport.iceTransport&&(this.transportEventReceiver.transport.iceTransport.onstatechange=null))}async updateRtpSenderEncodings(r,s){var a,c;if(s||(s=this.peerConnection.getSenders().find((z=>z.track===r._mediaStreamTrack))),!s)return M.warn("[".concat(r.getTrackId(),"] no rtpSender found}"));if(this.isVP8Simulcast(r))return M.warn("[updateRtpSenderEncodings] Track is VP8 simulcast, please apply simulcast encodings");if(!Wn().supportSetRtpSenderParameters)return M.warn("[updateRtpSenderEncodings] Browser not support set rtp-sender parameters");const d={},h={};switch(r._optimizationMode){case"motion":d.degradationPreference="maintain-framerate";break;case"detail":d.degradationPreference="maintain-resolution";break;case"balanced":d.degradationPreference="balanced"}const m=(function(B,z){return B.getTransceivers().find((ee=>ee.sender.track===z||ee.receiver.track===z))})(this.peerConnection,r._mediaStreamTrack),g=yge(r);if((function(B){var z;return!(!oe("ENABLE_AG_ADAPTATION")||!(B instanceof F1||rt(z=B._hints).call(z,Sr.CUSTOM_TRACK))||!oe("FORCE_SUPPORT_AG_ADAPTATION")&&!(c9(14,0,!1)&&l9(17,4)||a9(14)&&BL(17,4,!0)))})(r)&&m&&s&&g&&this.getLocalVideoStats&&rt(a=["vp8","vp9"]).call(a,this.store.codec)){var v;const B=d.degradationPreference||(rt(v=r._hints).call(v,Sr.CUSTOM_TRACK)?oe("CUSTOM_ADAPTATION_DEFAULT_MODE"):"maintain-framerate");(function(z,ee,Z,ae,ye,_e){if(gP(z,Z),ye(ee),ae!=="balanced"&&ae!=="maintain-framerate"&&ae!=="maintain-resolution")return;let ue=-1;dH(z,ee);const Ae=window.setInterval((()=>{const We=mP.get(z);if(!oe("ENABLE_AG_ADAPTATION")||!We)return gP(z,Z),void ye(ee);const Ze=_e();if(Ze.sendPackets>0&&Ze.OutgoingAvailableBandwidth>0){if(ue===-1)return void(ue=Date.now());if(Date.now()-ue<1e3)return;const _n=Ze.sendFrameRate,bn=Ze.OutgoingAvailableBandwidth,[Zt,ir]=k_e(z,_n,bn,We.adaptationConfig,ee,ae);ir&&(Z.qualityLimitationReason=ir),Zt&&We.adaptationConfig.scale!==Zt.scale&&(M.debug("[".concat(z,"] applyAdaptation: ").concat(Z.qualityLimitationReason,`
           sendFps `).concat(_n,", bwe ").concat(bn,", switch from ").concat(We.adaptationConfig.scale," to ").concat(Zt.scale," ")),We.adaptationConfig=uM(uM({},We.adaptationConfig),Zt),ye(Zt))}}),oe("CHECK_LOCAL_STATS_INTERVAL")),Ue=uM({},ee);mP.set(z,{timer:Ae,adaptationConfig:Ue,originConfig:ee,adaptationFunc:ye}),M.debug("[".concat(z,"] start adaptation, originConfig: ").concat(JSON.stringify(ee),", degradationPreference: ").concat(ae))})(this.id+m.mid,g,this,B,(z=>{s&&this.updateAdaptation(s,z)}),this.getLocalVideoStats.bind(this))}if(r._encoderConfig){var w;const{bitrateMax:B,frameRate:z,scaleResolutionDownBy:ee}=r._encoderConfig;B&&(h.maxBitrate=1e3*B),(rt(w=r._hints).call(w,Sr.LOW_STREAM)||r.isUseScaleResolutionDownBy)&&(z&&(h.maxFramerate=xc(z)),ee&&ee>=1&&(h.scaleResolutionDownBy=ee))}const{maxFramerate:I}=oe("ENCODER_CONFIG_LIMIT");if(I&&typeof I=="number"&&(h.maxFramerate=h.maxFramerate?Math.min(h.maxFramerate,I):I),oe("DSCP_TYPE")&&vf()){var A;const B=oe("DSCP_TYPE");rt(A=["very-low","low","medium","high"]).call(A,B)&&(h.networkPriority=B)}const N=s.getParameters(),H=(c=N.encodings)===null||c===void 0?void 0:c[0];ii()&&!H&&(d.encodings=[h]),H&&Object.assign(H,h),Object.assign(N,d),M.debug("[".concat(r.getTrackId(),"] updateRtpSenderEncodings: ").concat(JSON.stringify(N.encodings))),await s.setParameters(N),await(async function(B,z,ee){try{var Z;if(!Wn().supportSetRtpSenderParameters||!(function(Ae){return Ae==="vp9"||Ae==="av1"})(B)||!oe("ENABLE_SVC"))return;const ae={},ye={},_e=z.getParameters(),ue=(Z=_e.encodings)===null||Z===void 0?void 0:Z[0];ye.scalabilityMode=rP(ee),ue&&Object.assign(ue,ye),Object.assign(_e,ae),await z.setParameters(_e),M.debug("[updateAdaptation] updateRtpSenderEncodings scalabilityMode success: ".concat(JSON.stringify(_e.encodings)))}catch(ae){M.debug("[updateAdaptation] updateRtpSenderEncodings scalabilityMode failed",ae)}})(this.store.codec,s,oe("SVC_MODE"))}async updateAdaptation(r,s){var a,c;if(!r)return M.debug("[updateAdaptation] no rtpSender found");if(!Wn().supportSetRtpSenderParameters)return M.debug("[updateAdaptation] Browser not support set rtp-sender parameters");const d={},{bitrateMax:h,frameRate:m,scaleResolutionDownBy:g}=s;h&&(d.maxBitrate=1e3*h),m&&(d.maxFramerate=xc(m)),g&&g>=1&&rt(a=["vp8","vp9"]).call(a,this.store.codec)&&(d.scaleResolutionDownBy=g);const v=r.getParameters(),w=(c=v.encodings)===null||c===void 0?void 0:c[0];w&&Object.assign(w,d),Object.assign(v,{});try{await r.setParameters(v),M.debug("[updateAdaptation] updateRtpSenderEncodings: ".concat(JSON.stringify(v.encodings)))}catch(I){!("transport"in r)||r.transport&&r.transport.state==="connected"?this.peerConnectionState!=="connected"?M.debug("[updateAdaptation] peerConnection not connected}"):M.debug("[updateAdaptation] updateRtpSenderEncodings failed",I):M.debug("[updateAdaptation] rtpSender transport not connected}")}}async applySendEncodings(r,s){try{if(!Wn().supportSetRtpSenderParameters||r.length!==s.length)return;for(let a=0;a<r.length;a++){const c=r[a],d=s[a];d instanceof Nr&&!this.isVP8Simulcast(d)&&await this.updateRtpSenderEncodings(d,c.sender)}}catch{M.debug("[".concat(this.store.clientId,"] Apply RTPSendEncodings failed."))}}mungSendOfferSDP(r,s,a){const c=nc(r);return s.forEach(((d,h)=>{const m=a[h],g=c.mediaDescriptions.find((v=>v.attributes.mid===m));g&&(w0(g,d),M7(g,d,this.store.codec))})),Zm(c)}bindStatsEvents(){this.statsFilter.onFirstAudioReceived=r=>{var s;(s=this.onFirstAudioReceived)===null||s===void 0||s.call(this,r)},this.statsFilter.onFirstVideoReceived=r=>{var s;(s=this.onFirstVideoReceived)===null||s===void 0||s.call(this,r)},this.statsFilter.onFirstAudioDecoded=r=>{var s;(s=this.onFirstAudioDecoded)===null||s===void 0||s.call(this,r)},this.statsFilter.onFirstVideoDecoded=(r,s,a)=>{var c;(c=this.onFirstVideoDecoded)===null||c===void 0||c.call(this,r,s,a)},this.statsFilter.onSelectedLocalCandidateChanged=(r,s)=>{var a;(a=this.onSelectedLocalCandidateChanged)===null||a===void 0||a.call(this,r,s)},this.statsFilter.onSelectedRemoteCandidateChanged=(r,s)=>{var a;(a=this.onSelectedRemoteCandidateChanged)===null||a===void 0||a.call(this,r,s)},this.statsFilter.onFirstVideoDecodedTimeout=r=>{var s;(s=this.onFirstVideoDecodedTimeout)===null||s===void 0||s.call(this,r)}}unbindStatsEvents(){this.statsFilter.onFirstAudioReceived=void 0,this.statsFilter.onFirstVideoReceived=void 0,this.statsFilter.onFirstAudioDecoded=void 0,this.statsFilter.onFirstVideoDecoded=void 0,this.statsFilter.onSelectedLocalCandidateChanged=void 0,this.statsFilter.onSelectedRemoteCandidateChanged=void 0,this.statsFilter.onFirstVideoDecodedTimeout=void 0}async applySimulcastForFirefox(r,s){if(r.length===s.length)for(let g=0;g<r.length;g++){var a,c,d,h,m;const v=r[g],w=s[g];if(w instanceof Nr&&!rt(a=w._hints).call(a,Sr.LOW_STREAM)&&(c=w._encoderConfig)!==null&&c!==void 0&&c.bitrateMax&&((d=w._encoderConfig)===null||d===void 0?void 0:d.bitrateMax)>200&&(h=w._scalabilityMode)!==null&&h!==void 0&&h.numSpatialLayers&&((m=w._scalabilityMode)===null||m===void 0?void 0:m.numSpatialLayers)>1&&this.store.codec==="vp8"){const I={},A={high:1e3*(w._encoderConfig.bitrateMax-50),medium:5e4};I.encodings=[{rid:"m",active:!0,maxBitrate:A.medium,scaleResolutionDownBy:4},{rid:"h",active:!0,maxBitrate:A.high}];const N=v.sender.getParameters();await v.sender.setParameters(Object.assign(N,I))}}}async applySimulcastEncodings(r,s){if(!ii()&&r.length===s.length)for(let a=0;a<r.length;a++){const c=s[a];if(c instanceof Nr&&this.isVP8Simulcast(c)){const d=r[a],h={},m={high:1e3*(c._encoderConfig.bitrateMax-50),medium:5e4};h.encodings=[{active:!0,adaptivePtime:!1,networkPriority:"high",priority:"high",maxBitrate:m.high},{active:!0,adaptivePtime:!1,networkPriority:"low",priority:"low",maxBitrate:m.medium,scaleResolutionDownBy:4}];const g=d.sender.getParameters();await d.sender.setParameters(Object.assign(g,h))}}}isVP8Simulcast(r){var s,a,c,d,h;return!!(r instanceof Nr&&oe("SIMULCAST")&&this.store.codec==="vp8"&&!rt(s=r._hints).call(s,Sr.LOW_STREAM)&&(a=r._encoderConfig)!==null&&a!==void 0&&a.bitrateMax&&((c=r._encoderConfig)===null||c===void 0?void 0:c.bitrateMax)>200&&(d=r._scalabilityMode)!==null&&d!==void 0&&d.numSpatialLayers&&((h=r._scalabilityMode)===null||h===void 0?void 0:h.numSpatialLayers)>1)}logSDPExchange(r,s,a,c){if(oe("SDP_LOGGING"))return M.upload("[".concat(this.store.clientId,"] exchanging ").concat(a," ").concat(s," SDP during P2PConnection.").concat(c,`
`),r),s==="offer"?d=>{this.logSDPExchange(d,"answer",a==="local"?"remote":"local",c)}:void 0}async getRemoteSSRC(r){if(!this.remoteSDP)return;const s=this.remoteSDP.getSSRC(r);return s&&s.length!==0?s[0].ssrcId:void 0}setConfiguration(r){if(Wn().supportPCSetConfiguration){const s=xy.resolvePCConfiguration(r);this.peerConnection.setConfiguration(s)}r.isPreallocation&&(this.isPreallocation=!0)}},Rt(Un.prototype,"updateRemoteRTPCapabilities",[Da],Object.getOwnPropertyDescriptor(Un.prototype,"updateRemoteRTPCapabilities"),Un.prototype),Rt(Un.prototype,"connect",[Da],Object.getOwnPropertyDescriptor(Un.prototype,"connect"),Un.prototype),Rt(Un.prototype,"updateRemoteConnect",[Da],Object.getOwnPropertyDescriptor(Un.prototype,"updateRemoteConnect"),Un.prototype),Rt(Un.prototype,"createDataChannels",[Da],Object.getOwnPropertyDescriptor(Un.prototype,"createDataChannels"),Un.prototype),Rt(Un.prototype,"receive",[Da],Object.getOwnPropertyDescriptor(Un.prototype,"receive"),Un.prototype),Rt(Un.prototype,"batchReceive",[Da],Object.getOwnPropertyDescriptor(Un.prototype,"batchReceive"),Un.prototype),Rt(Un.prototype,"stopReceiving",[Da],Object.getOwnPropertyDescriptor(Un.prototype,"stopReceiving"),Un.prototype),Rt(Un.prototype,"muteRemote",[Da],Object.getOwnPropertyDescriptor(Un.prototype,"muteRemote"),Un.prototype),Rt(Un.prototype,"unmuteRemote",[Da],Object.getOwnPropertyDescriptor(Un.prototype,"unmuteRemote"),Un.prototype),Rt(Un.prototype,"muteLocal",[Da],Object.getOwnPropertyDescriptor(Un.prototype,"muteLocal"),Un.prototype),Rt(Un.prototype,"unmuteLocal",[Da],Object.getOwnPropertyDescriptor(Un.prototype,"unmuteLocal"),Un.prototype),Rt(Un.prototype,"close",[Da],Object.getOwnPropertyDescriptor(Un.prototype,"close"),Un.prototype),Rt(Un.prototype,"updateEncoderConfig",[Da],Object.getOwnPropertyDescriptor(Un.prototype,"updateEncoderConfig"),Un.prototype),Rt(Un.prototype,"updateSendParameters",[Da],Object.getOwnPropertyDescriptor(Un.prototype,"updateSendParameters"),Un.prototype),Rt(Un.prototype,"replaceTrack",[Da],Object.getOwnPropertyDescriptor(Un.prototype,"replaceTrack"),Un.prototype),Rt(Un.prototype,"updateAdaptation",[Da],Object.getOwnPropertyDescriptor(Un.prototype,"updateAdaptation"),Un.prototype),Rt(Un.prototype,"getRemoteSSRC",[Da],Object.getOwnPropertyDescriptor(Un.prototype,"getRemoteSSRC"),Un.prototype),Un);function Da(t,r,s){const a=t[r];if(typeof a!="function")throw new Error("Cannot use mutex on object property.");return s.value=async function(){const c=this.mutex,d=await c.lock("From P2PConnection.".concat(r));try{for(var h=arguments.length,m=new Array(h),g=0;g<h;g++)m[g]=arguments[g];return await a.apply(this,m)}finally{d()}},s}function fM(t,r){let s=document.createElement("video"),a=document.createElement("canvas");s.setAttribute("style","display:none"),a.setAttribute("style","display:none"),s.setAttribute("muted",""),s.muted=!0,s.setAttribute("autoplay",""),s.autoplay=!0,s.setAttribute("playsinline",""),a.width=xc(r.width),a.height=xc(r.height);const c=xc(r.framerate||15);document.body.append(s),document.body.append(a);let d=t._mediaStreamTrack;s.srcObject=new MediaStream([d]),s.play();const h=a.getContext("2d");if(!h)throw new ke(te.UNEXPECTED_ERROR,"can not get canvas context");const m=Wn(),g=a.captureStream(m.supportRequestFrame?0:c).getVideoTracks()[0];g.canvas||(g.canvas=a),a.startCapture=()=>{if(!s)return a.stopCapture&&a.stopCapture();if(s.paused&&s.play(),s.videoHeight>2&&s.videoWidth>2){const w=s.videoWidth,I=s.videoHeight/w,A=a.width*I;Math.abs(A-a.height)>=2&&(M.debug("adjust low stream resolution","".concat(a.width,"x").concat(a.height," -> ").concat(a.width,"x").concat(A)),a.height=A)}h.drawImage(s,0,0,a.width,a.height),g.requestFrame&&g.requestFrame(),d!==t._mediaStreamTrack&&(d=t._mediaStreamTrack,s.srcObject=new MediaStream([d]))},a.stopCapture=E2((()=>a.startCapture&&a.startCapture()),c);const v=g.stop;return g.stop=()=>{v.call(g),s&&(s.remove(),s.srcObject=null,s=null),a&&(a.width=0,a.remove(),a.stopCapture&&a.stopCapture(),a.startCapture=void 0,a.stopCapture=void 0,a=null),M.debug("clean low stream renderer")},g}var gH=(function(t){return t[t.Video_Send_Type=190]="Video_Send_Type",t})(gH||{}),rh=(function(t){return t[t.Video_Send_Qp_Sum=2143]="Video_Send_Qp_Sum",t[t.Video_Send_Freeze=2082]="Video_Send_Freeze",t[t.Video_Recv_Qp_Sum=2144]="Video_Recv_Qp_Sum",t[t.Video_Recv_Freeze=2084]="Video_Recv_Freeze",t[t.Video_Render_Freeze_Time=2109]="Video_Render_Freeze_Time",t[t.Video_Render_Freeze_Time_Render=2147]="Video_Render_Freeze_Time_Render",t[t.Video_Render_Freeze_Time_Render2=2223]="Video_Render_Freeze_Time_Render2",t[t.Audio_Recv_Freeze=2083]="Audio_Recv_Freeze",t})(rh||{}),sn=(function(t){return t[t.Video_Send_Retransmit=2062]="Video_Send_Retransmit",t[t.Video_Send_Target_Encoded=2064]="Video_Send_Target_Encoded",t[t.Video_Send_Actual_Encoded=2060]="Video_Send_Actual_Encoded",t[t.Video_Send_Transmit=2066]="Video_Send_Transmit",t[t.Video_Send_Bandwidth=2061]="Video_Send_Bandwidth",t[t.Video_Capture_Height=2033]="Video_Capture_Height",t[t.Video_Capture_Width=2035]="Video_Capture_Width",t[t.Video_Capture_Frame_Rate=2034]="Video_Capture_Frame_Rate",t[t.Video_Send_Low_Height=2073]="Video_Send_Low_Height",t[t.Video_Send_Low_Frame_Rate=2075]="Video_Send_Low_Frame_Rate",t[t.Video_Send_Low_Width=2077]="Video_Send_Low_Width",t[t.Video_Send_Low_Bitrate=2069]="Video_Send_Low_Bitrate",t[t.Video_Send_Low_Package_Lost=2070]="Video_Send_Low_Package_Lost",t[t.Video_Send_Low_Package_Rate=2071]="Video_Send_Low_Package_Rate",t[t.Video_Send_Frame_Rate=2002]="Video_Send_Frame_Rate",t[t.Video_Send_Width=2003]="Video_Send_Width",t[t.Video_Send_Height=2004]="Video_Send_Height",t[t.Video_Send_Disabled=2095]="Video_Send_Disabled",t[t.Video_Send_Adaptation=2032]="Video_Send_Adaptation",t[t.Video_Send_Player_Status=2128]="Video_Send_Player_Status",t[t.Video_Send_Nacks=2009]="Video_Send_Nacks",t[t.Video_Send_Plis=2010]="Video_Send_Plis",t[t.Video_Send_Firs=2011]="Video_Send_Firs",t[t.Video_Send_Avg_Encode=2007]="Video_Send_Avg_Encode",t[t.Video_Send_Huge_Frame_Sent=2174]="Video_Send_Huge_Frame_Sent",t[t.Video_Send_Bytes_Retransmit=2173]="Video_Send_Bytes_Retransmit",t[t.Video_Send_Packages_Retransmit=2172]="Video_Send_Packages_Retransmit",t[t.Video_Send_Key_Frames_Encoded=2207]="Video_Send_Key_Frames_Encoded",t[t.Video_Send_Bitrate=2012]="Video_Send_Bitrate",t[t.Video_Send_Package_Rate=2031]="Video_Send_Package_Rate",t[t.Video_Send_Package_Lost=2005]="Video_Send_Package_Lost",t[t.Audio_Capture_PCM_Level=2104]="Audio_Capture_PCM_Level",t[t.Audio_Send_Level=2038]="Audio_Send_Level",t[t.Audio_Send_Bitrate=2039]="Audio_Send_Bitrate",t[t.Audio_Send_Package_Rate=2040]="Audio_Send_Package_Rate",t[t.Audio_Send_AEC_Return_Loss=2041]="Audio_Send_AEC_Return_Loss",t[t.Audio_Send_AEC_Return_Loss_Enhancement=2042]="Audio_Send_AEC_Return_Loss_Enhancement",t[t.Audio_Send_Freeze=2081]="Audio_Send_Freeze",t[t.Audio_Send_Disabled=2096]="Audio_Send_Disabled",t[t.Audio_Send_Bytes_Retransmit=2179]="Audio_Send_Bytes_Retransmit",t[t.Audio_Send_Packages_Retransmit=2180]="Audio_Send_Packages_Retransmit",t[t.Video_Recv_Height=2019]="Video_Recv_Height",t[t.Video_Recv_Width=2018]="Video_Recv_Width",t[t.Video_Recv_Frame_Rate_Output=2155]="Video_Recv_Frame_Rate_Output",t[t.Video_Recv_Jitter_Buffer=2023]="Video_Recv_Jitter_Buffer",t[t.Video_Recv_Current_Delay=2024]="Video_Recv_Current_Delay",t[t.Video_Recv_Nacks=2026]="Video_Recv_Nacks",t[t.Video_Recv_Plis=2027]="Video_Recv_Plis",t[t.Video_Recv_Firs=2028]="Video_Recv_Firs",t[t.Video_Recv_Disabled=2101]="Video_Recv_Disabled",t[t.Video_Recv_Player_Status=2129]="Video_Recv_Player_Status",t[t.Video_Recv_I_Frame_Delay=2149]="Video_Recv_I_Frame_Delay",t[t.Video_Render_Frame_Rate_Render=2022]="Video_Render_Frame_Rate_Render",t[t.Video_Render_Freeze_Duration=2156]="Video_Render_Freeze_Duration",t[t.Audio_Render_Level=2043]="Audio_Render_Level",t[t.Audio_Render_Freeze_Time_80ms=2226]="Audio_Render_Freeze_Time_80ms",t[t.Audio_Render_Freeze_Time_200ms=2227]="Audio_Render_Freeze_Time_200ms",t[t.Audio_Render_Freeze_Samples_80ms=2228]="Audio_Render_Freeze_Samples_80ms",t[t.Audio_Render_Freeze_Samples_200ms=2229]="Audio_Render_Freeze_Samples_200ms",t[t.Audio_Recv_PCM_Level=2105]="Audio_Recv_PCM_Level",t[t.Audio_Recv_Disabled=2102]="Audio_Recv_Disabled",t[t.Audio_Recv_Jitter_Buffer=2054]="Audio_Recv_Jitter_Buffer",t[t.Audio_Recv_Current_Delay=2047]="Audio_Recv_Current_Delay",t[t.Audio_Recv_Player_Status=2130]="Audio_Recv_Player_Status",t[t.Audio_Recv_Bitrate=2044]="Audio_Recv_Bitrate",t[t.Audio_Recv_Concealed_Samples=2148]="Audio_Recv_Concealed_Samples",t[t.Audio_Recv_Total_Samples_Received=2224]="Audio_Recv_Total_Samples_Received",t})(sn||{}),Os=(function(t){return t[t.Video_Render_Frame_Rate_Decode=2021]="Video_Render_Frame_Rate_Decode",t[t.Video_Recv_Frame_Rate=2020]="Video_Recv_Frame_Rate",t[t.Video_Recv_Frame_Dropped=2181]="Video_Recv_Frame_Dropped",t[t.Video_Recv_Bytes_Retransmit=2175]="Video_Recv_Bytes_Retransmit",t[t.Video_Recv_Packages_Retransmit=2176]="Video_Recv_Packages_Retransmit",t[t.Video_Recv_Packages_Discarded=2198]="Video_Recv_Packages_Discarded",t[t.Video_Recv_Avg_Decode=2200]="Video_Recv_Avg_Decode",t[t.Video_Recv_Avg_Processing_Delay=2202]="Video_Recv_Avg_Processing_Delay",t[t.Video_Recv_Avg_Assembly_Time=2203]="Video_Recv_Avg_Assembly_Time",t[t.Video_Recv_Avg_Inter_Frame_Delay=2204]="Video_Recv_Avg_Inter_Frame_Delay",t[t.Video_Recv_Key_Frames_Decoded=2206]="Video_Recv_Key_Frames_Decoded",t[t.Video_Recv_Package_Lost=2014]="Video_Recv_Package_Lost",t[t.Video_Recv_Bitrate=2029]="Video_Recv_Bitrate",t[t.Video_Recv_Package_Rate=2078]="Video_Recv_Package_Rate",t[t.Audio_Recv_Jitter=2055]="Audio_Recv_Jitter",t[t.Audio_Recv_Bytes_Retransmit=2178]="Audio_Recv_Bytes_Retransmit",t[t.Audio_Recv_Packages_Retransmit=2177]="Audio_Recv_Packages_Retransmit",t[t.Audio_Recv_Packages_Discarded=2199]="Audio_Recv_Packages_Discarded",t[t.Audio_Recv_Avg_Processing_Delay=2201]="Audio_Recv_Avg_Processing_Delay",t[t.Audio_Recv_Package_Rate=2046]="Audio_Recv_Package_Rate",t[t.Audio_Recv_Package_Lost=2045]="Audio_Recv_Package_Lost",t})(Os||{}),La=(function(t){return t[t.RTT=2006]="RTT",t[t.CONN_TYPE=801]="CONN_TYPE",t[t.STATS_UPDATE_INTERVAL=2205]="STATS_UPDATE_INTERVAL",t})(La||{}),yP=(function(t){return t[t.RTC_PEER_CONNECTION_STATE=2219]="RTC_PEER_CONNECTION_STATE",t})(yP||{});const gy=1e3,EP=6,OT=3,D_e=Math.max(EP,OT,60);function zt(t,r,s){s!=null&&Number.isFinite(s)&&(t[r]=Math.round(Math.max(0,s)))}function _H(t){const r={[La.CONN_TYPE]:0,[La.RTT]:t.rtt,[La.STATS_UPDATE_INTERVAL]:t.updateInterval?Math.round(Math.max(0,t.updateInterval)):void 0};switch(t.selectedCandidatePair.localCandidate.candidateType){case"relay":{const s=t.selectedCandidatePair.localCandidate.relayProtocol;s==="udp"&&(r[La.CONN_TYPE]=1),s==="tcp"&&(r[La.CONN_TYPE]=3),s==="tls"&&(r[La.CONN_TYPE]=4);break}case"srflx":r[La.CONN_TYPE]=2;break;case"unknown":r[La.CONN_TYPE]=5;break;default:r[La.CONN_TYPE]=0}return r}function yH(t){let r=0;switch(t){case"none":r=0;break;case"cpu":r=1;break;case"bandwidth":r=2;break;case"other":r=3}return r}class EH extends Zr{constructor(r){super(),X(this,"store",void 0),X(this,"uploadWRTCStatsTimer",void 0),X(this,"uploadOutboundDenoiserStatsTimer",void 0),X(this,"uploadExtStatsTimer",void 0),X(this,"uploadExtUsageStatsTimer",void 0),X(this,"uploadInboundExtStatsTimer",void 0),X(this,"requestStats",void 0),X(this,"requestTransportStats",void 0),X(this,"requestLocalMedia",void 0),X(this,"requestRemoteMedia",void 0),X(this,"requestAllTracks",void 0),X(this,"requestVideoIsReady",void 0),X(this,"requestUploadStats",void 0),X(this,"requestUpload",void 0),X(this,"uploadOutboundStarted",!1),X(this,"uploadInboundStarted",!1),X(this,"uploadTransportStarted",!1),X(this,"uploadBaseStatsStarted",!1),X(this,"uploadExtensionUsageStarted",!1),X(this,"lastRecvStats",void 0),X(this,"lastSendStats",void 0),X(this,"lastRefRecvStats",void 0),X(this,"lastRefSendStats",void 0),X(this,"lastNormalRecvStats",void 0),X(this,"lastNormalSendStats",void 0),X(this,"lastExtendStats",{}),X(this,"needUploadStats",{}),X(this,"needUploadRenderFreezeTime",!0),X(this,"lastUploadCompensateTime",-1),X(this,"uploadCompensateDeltaTime",0),this.store=r}uploadWRTCStats(r){if(!this.requestStats||!this.requestUploadStats)return;const s=r%OT==0,a=r%EP==0,c=r%60==0;let d,h;if(this.uploadTransportStarted&&(d=this.requestStats(),this.store.useP2P&&(h=this.requestStats(!0))),!d&&this.uploadOutboundStarted&&(d=this.requestStats()),!h&&this.uploadInboundStarted&&(h=this.requestStats(!0)),d||h){var m;const g={};if(this.uploadTransportStarted&&d){const w=this.getTransportStats(d,h,s);w&&(g.misc=[w])}if(this.uploadOutboundStarted&&d){const w=this.getOutboundStats(d,a?this.lastNormalSendStats:void 0,s?this.lastRefSendStats:void 0,this.lastSendStats,c);w&&(g.outbound=[w])}if(this.uploadInboundStarted&&h){this.uploadCompensateStats(r);const w=this.getInboundStats(h,a?this.lastNormalRecvStats:void 0,s?this.lastRefRecvStats:void 0,this.lastRecvStats);w&&(g.inbound=w)}const v=(m=this.requestTransportStats)===null||m===void 0?void 0:m.call(this).connectState;v&&(Array.isArray(g.misc)?g.misc[0]&&g.misc[0].addition&&(g.misc[0].addition[yP.RTC_PEER_CONNECTION_STATE]=r2[v]):g.misc=[{addition:{[yP.RTC_PEER_CONNECTION_STATE]:r2[v]}}]),this.needUploadStats.sendType&&(Array.isArray(g.outbound)&&g.outbound[0]&&g.outbound[0].high&&(g.outbound[0].high[gH.Video_Send_Type]=this.needUploadStats.sendType),this.needUploadStats.sendType=void 0),this.requestUploadStats(g)}this.lastRecvStats=h,this.lastSendStats=d,a&&(this.lastNormalRecvStats=h,this.lastNormalSendStats=d),s&&(this.lastRefRecvStats=h,this.lastRefSendStats=d)}startUploadWRTCStats(){if(this.uploadWRTCStatsTimer)return;this.uploadBaseStatsStarted=!0;let r=1;this.uploadWRTCStatsTimer=window.setInterval((()=>{if(!this.uploadTransportStarted&&!this.uploadInboundStarted&&!this.uploadOutboundStarted){if(this.uploadBaseStatsStarted){var s,a;const c=(s=this.requestTransportStats)===null||s===void 0?void 0:s.call(this);return void(c&&((a=this.requestUploadStats)===null||a===void 0||a.call(this,{misc:[{addition:{[yP.RTC_PEER_CONNECTION_STATE]:r2[c.connectState]}}]})))}return this.stopUploadWRTCStats()}this.uploadWRTCStats(r),++r===D_e+1&&(r=1)}),gy)}uploadCompensateStats(r){if(!this.requestStats||!this.requestUploadStats||!this.requestRemoteMedia)return;const s=r%OT==0&&this.needUploadRenderFreezeTime;if(!this.uploadInboundStarted||!s)return;if(this.lastUploadCompensateTime===-1)return void(this.lastUploadCompensateTime=Date.now());const a=Math.max(-6e3,Date.now()-this.lastUploadCompensateTime-6e3);if(this.uploadCompensateDeltaTime+=a,this.lastUploadCompensateTime=Date.now(),this.uploadCompensateDeltaTime<6e3)return;const c=Math.min(Math.floor(this.uploadCompensateDeltaTime/6e3),10);this.uploadCompensateDeltaTime-=6e3*c;const d=this.requestStats(!0);new Array(c).fill(0).forEach((()=>{if(!this.requestStats||!this.requestUploadStats||!this.requestRemoteMedia)return;const h={};if(this.uploadInboundStarted&&d){const m=this.requestRemoteMedia()||[],g=[];m.forEach((v=>{let[w,I]=v;const A={peer:w.uid};if(w._videoSSRC&&this.requestVideoIsReady&&this.requestVideoIsReady(w._videoSSRC)&&I.has(St.VIDEO)&&w.videoTrack){const N=(function(H,B,z){if(!B.videoRecv.find((Z=>Z.ssrc===H)))return;const ee={};if(z&&z._player){const Z=z._player,{renderFreezeAccTime2:ae,videoElementStatus:ye}=Z;if(lp.visibility==="visible"&&ye===oo.PLAYING&&Wn().supportRequestVideoFrameCallback){const _e=Math.min(6e3,ae);Z.renderFreezeAccTime2=Math.max(0,ae-_e),zt(ee,rh.Video_Render_Freeze_Time_Render2,_e),oe("USE_NEW_RENDER_FREEZE_TIME")&&zt(ee,rh.Video_Render_Freeze_Time_Render,_e)}}return ee})(w._videoSSRC,d,w.videoTrack);N&&(A.video=N)}A.video&&g.push(A)})),g.length>0&&(h.inbound=g,this.requestUploadStats(h))}}))}stopUploadWRTCStats(){window.clearInterval(this.uploadWRTCStatsTimer),this.uploadWRTCStatsTimer=void 0,this.lastSendStats&&(this.lastSendStats.videoSend=[],this.lastSendStats.audioSend=[],this.lastSendStats=void 0),this.lastRecvStats&&(this.lastRecvStats.videoRecv=[],this.lastRecvStats.audioRecv=[],this.lastRecvStats=void 0),this.lastRefSendStats&&(this.lastRefSendStats.videoSend=[],this.lastRefSendStats.audioSend=[],this.lastRefSendStats=void 0),this.lastRefRecvStats&&(this.lastRefRecvStats.videoRecv=[],this.lastRefRecvStats.audioRecv=[],this.lastRefRecvStats=void 0),this.lastNormalSendStats&&(this.lastNormalSendStats.videoSend=[],this.lastNormalSendStats.audioSend=[],this.lastNormalSendStats=void 0),this.lastNormalRecvStats&&(this.lastNormalRecvStats.videoRecv=[],this.lastNormalRecvStats.audioRecv=[],this.lastNormalRecvStats=void 0),this.lastExtendStats={},this.needUploadStats={},this.lastUploadCompensateTime=-1,this.uploadCompensateDeltaTime=0,this.needUploadRenderFreezeTime=!0}getTransportStats(r,s,a){if(!this.requestStats)return;if(!a)return r.rtt==null?void 0:{addition:{[La.RTT]:r.rtt,[La.CONN_TYPE]:void 0,[La.STATS_UPDATE_INTERVAL]:r.updateInterval||void 0}};const c=_H(r);if(this.store.useP2P){if(s){const d=_H(s);c[La.CONN_TYPE]+=d[La.CONN_TYPE]<<3}c[La.CONN_TYPE]+=110}else c[La.CONN_TYPE]+=100;return{addition:c}}getOutboundStats(r,s,a,c,d){if(!this.requestUploadStats||!this.requestLocalMedia)return;const h=this.requestLocalMedia();if(!h||h.length===0)return;let m,g,v;return h.forEach((w=>{let[I,{track:A,ssrcs:N}]=w;switch(I){case Xe.LocalVideoLowTrack:case Xe.LocalVideoTrack:if(I===Xe.LocalVideoTrack){var H;const B=(function(ae,ye,_e,ue,Ae,Ue){const We=ye.videoSend.find((Zt=>Zt.ssrc===ae));if(!We)return;const Ze={},{sentFrame:_n,inputFrame:bn}=We;if(ue&&(zt(Ze,rh.Video_Send_Qp_Sum,We.qpSumPerFrame),bn&&_n)){const Zt=bn.frameRate,ir=_n.frameRate;Ze[rh.Video_Send_Freeze]=(function(Jn,uo){let ze=!0;return ze=!(Jn<=5)&&(Jn<=10?uo<3:Jn<=20?uo<4:uo<5),ze})(Zt,ir)?1:0}if(Ae){switch(_n&&(zt(Ze,sn.Video_Send_Height,_n.height),zt(Ze,sn.Video_Send_Width,_n.width),zt(Ze,sn.Video_Send_Frame_Rate,_n.frameRate)),Ze[sn.Video_Send_Disabled]=_e._originMediaStreamTrack&&!_e._originMediaStreamTrack.enabled||_e._mediaStreamTrack&&!_e._mediaStreamTrack.enabled?1:0,We.adaptionChangeReason){case"none":Ze[sn.Video_Send_Adaptation]=0;break;case"cpu":Ze[sn.Video_Send_Adaptation]=1;break;case"bandwidth":Ze[sn.Video_Send_Adaptation]=2;break;case"other":Ze[sn.Video_Send_Adaptation]=3}let Zt=0;We.adaptionChangeReason&&(Zt+=yH(We.adaptionChangeReason)),ye.qualityLimitationReason&&(Zt+=yH(ye.qualityLimitationReason)<<3),Ze[sn.Video_Send_Adaptation]=Zt,Ze[sn.Video_Send_Player_Status]=_2[_e._player?_e._player.videoElementStatus:"uninit"],zt(Ze,sn.Video_Send_Nacks,We.nacksCount),zt(Ze,sn.Video_Send_Plis,We.plisCount),zt(Ze,sn.Video_Send_Firs,We.firsCount),zt(Ze,sn.Video_Send_Avg_Encode,We.avgEncodeMs),zt(Ze,sn.Video_Send_Huge_Frame_Sent,We.hugeFramesSent),zt(Ze,sn.Video_Send_Bytes_Retransmit,We.retransmittedBytesSent),zt(Ze,sn.Video_Send_Packages_Retransmit,We.retransmittedPacketsSent),zt(Ze,sn.Video_Send_Key_Frames_Encoded,We.keyFramesEncoded);const ir=Ae.videoSend.find((Jn=>Jn.ssrc===ae));if(ir){let Jn=gy*OT;ir.timestamp&&We.timestamp&&(Jn=We.timestamp-ir.timestamp),ir.packets!=null&&We.packets!=null&&zt(Ze,sn.Video_Send_Package_Rate,1e3*(We.packets-ir.packets)/Jn),We.packetsLost!=null&&ir.packetsLost!=null&&zt(Ze,sn.Video_Send_Package_Lost,We.packetsLost-ir.packetsLost),ir.bytes!=null&&We.bytes!=null&&zt(Ze,sn.Video_Send_Bitrate,8*(We.bytes-ir.bytes)/Jn)}}return Ze})(N[0].ssrcId,r,A,s,a),z=A.__className__==="CameraVideoTrack"?3:rt(H=A._hints).call(H,Sr.SCREEN_TRACK)?7:10;(this.lastExtendStats.sendType!==z||d)&&(this.needUploadStats={sendType:z},this.lastExtendStats.sendType=z);const ee=A&&(function(ae,ye,_e,ue){const Ae=ye.videoSend.find((We=>We.ssrc===ae));if(!Ae)return null;const Ue={};if(ue){const We=Ae.inputFrame,Ze=We&&We.height||_e.videoHeight||0,_n=We&&We.width||_e.videoWidth||0,bn=We&&We.frameRate||0;zt(Ue,sn.Video_Capture_Height,Ze),zt(Ue,sn.Video_Capture_Width,_n),zt(Ue,sn.Video_Capture_Frame_Rate,bn)}return Ue})(N[0].ssrcId,r,A,!!a),Z=(function(ae,ye){const _e={};return ye&&(zt(_e,sn.Video_Send_Retransmit,ae.bitrate.retransmit),zt(_e,sn.Video_Send_Target_Encoded,ae.bitrate.targetEncoded),zt(_e,sn.Video_Send_Actual_Encoded,ae.bitrate.actualEncoded),zt(_e,sn.Video_Send_Transmit,ae.bitrate.transmit),zt(_e,sn.Video_Send_Bandwidth,ae.sendBandwidth)),_e})(r,!!a);g=Object.assign({},B,ee,Z)}else v=(function(B,z,ee,Z,ae){const ye=z.videoSend.find((ue=>ue.ssrc===B));if(!ye)return;const _e={};if(Z){const ue=ye.sentFrame;ue&&(zt(_e,sn.Video_Send_Low_Height,ue.height),zt(_e,sn.Video_Send_Low_Width,ue.width),zt(_e,sn.Video_Send_Low_Frame_Rate,ue.frameRate));const Ae=Z.videoSend.find((Ue=>Ue.ssrc===B));if(Ae){let Ue=gy*EP;Ae.timestamp&&ye.timestamp&&(Ue=ye.timestamp-Ae.timestamp),Ae.packets!=null&&ye.packets!=null&&zt(_e,sn.Video_Send_Low_Package_Rate,1e3*(ye.packets-Ae.packets)/Ue),ye.packetsLost!=null&&Ae.packetsLost!=null&&zt(_e,sn.Video_Send_Low_Package_Lost,ye.packetsLost-Ae.packetsLost),Ae.bytes!=null&&ye.bytes!=null&&zt(_e,sn.Video_Send_Low_Bitrate,8*(ye.bytes-Ae.bytes)/Ue)}}return _e})(N[0].ssrcId,r,0,a);break;case Xe.LocalAudioTrack:m=A&&(function(B,z,ee,Z,ae,ye){const _e=z.audioSend.find((Ae=>Ae.ssrc===B));if(!_e)return;const ue={};if(ae){ue[sn.Audio_Send_Disabled]=ee._originMediaStreamTrack&&!ee._originMediaStreamTrack.enabled||ee._mediaStreamTrack&&!ee._mediaStreamTrack.enabled?1:0;const Ae=100*ee._source.getAccurateVolumeLevel(),Ue=_e.inputLevel;if(Ue!=null){const Ze=Math.ceil(50*Math.log10(100*Ue+1));zt(ue,sn.Audio_Send_Level,Ze)}zt(ue,sn.Audio_Capture_PCM_Level,Ae),zt(ue,sn.Audio_Send_AEC_Return_Loss,_e.aecReturnLoss),zt(ue,sn.Audio_Send_AEC_Return_Loss_Enhancement,_e.aecReturnLossEnhancement),zt(ue,sn.Audio_Send_Bytes_Retransmit,_e.retransmittedBytesSent),zt(ue,sn.Audio_Send_Packages_Retransmit,_e.retransmittedPacketsSent),ue[sn.Audio_Send_Freeze]=0;const We=ae.audioSend.find((Ze=>Ze.ssrc===B));if(We){let Ze=gy*EP;We.timestamp&&_e.timestamp&&(Ze=_e.timestamp-We.timestamp),We.bytes!=null&&_e.bytes!=null&&zt(ue,sn.Audio_Send_Bitrate,8*(_e.bytes-We.bytes)/Ze),We.packets!=null&&_e.packets!=null&&zt(ue,sn.Audio_Send_Package_Rate,1e3*(_e.packets-We.packets)/Ze)}}return ue})(N[0].ssrcId,r,A,0,a)}})),{high:g,low:v,audio:m}}getInboundStats(r,s,a,c){if(!this.requestRemoteMedia)return;const d=this.requestRemoteMedia()||[],h=[];return d.forEach((m=>{let[g,v]=m;const w={peer:g.uid};if(v.has(St.VIDEO)&&g.videoTrack){const I=g._videoSSRC&&this.requestVideoIsReady&&this.requestVideoIsReady(g._videoSSRC)||!1,A=g.videoTrack?(function(N,H,B,z,ee,Z,ae,ye){const _e=H.videoRecv.find((Zt=>Zt.ssrc===N));if(!_e)return;const ue={},{receivedFrame:Ae,outputFrame:Ue,decodeFrameRate:We}=_e;zt(ue,Os.Video_Render_Frame_Rate_Decode,We),_e.framesRateFirefox&&zt(ue,Os.Video_Recv_Frame_Rate,_e.framesRateFirefox),Ae&&zt(ue,Os.Video_Recv_Frame_Rate,Ae.frameRate),zt(ue,Os.Video_Recv_Frame_Dropped,_e.framesDroppedCount),zt(ue,Os.Video_Recv_Bytes_Retransmit,_e.retransmittedBytesReceived),zt(ue,Os.Video_Recv_Packages_Retransmit,_e.retransmittedPacketsReceived),zt(ue,Os.Video_Recv_Packages_Discarded,_e.packetsDiscarded),zt(ue,Os.Video_Recv_Avg_Decode,_e.avgDecodeMs),zt(ue,Os.Video_Recv_Avg_Processing_Delay,_e.avgProcessingDelayMs),zt(ue,Os.Video_Recv_Avg_Assembly_Time,_e.avgFramesAssembledFromMultiplePacketsMs),zt(ue,Os.Video_Recv_Avg_Inter_Frame_Delay,_e.avgInterFrameDelayMs),zt(ue,Os.Video_Recv_Key_Frames_Decoded,_e.keyFramesDecoded);const Ze=ye&&ye.videoRecv.find((Zt=>Zt.ssrc===N));if(Ze){const Zt=H.timestamp-ye.timestamp||gy;_e.packetsLost!=null&&Ze.packetsLost!=null&&zt(ue,Os.Video_Recv_Package_Lost,_e.packetsLost-Ze.packetsLost),Ze.bytes!=null&&_e.bytes!=null&&zt(ue,Os.Video_Recv_Bitrate,8*(_e.bytes-Ze.bytes)/Zt),Ze.packets!=null&&_e.packets!=null&&zt(ue,Os.Video_Recv_Package_Rate,1e3*(_e.packets-Ze.packets)/Zt)}const _n=Z&&Z.videoRecv.find((Zt=>Zt.ssrc===N));if(_n&&(zt(ue,rh.Video_Recv_Qp_Sum,_e.qpSumPerFrame),ue[rh.Video_Recv_Freeze]=z&&PT.isRemoteVideoFreeze(B,_e,_n)?1:0),ae){var bn;const Zt=ae.videoRecv.find((Jn=>Jn.ssrc===N));Ae?(zt(ue,sn.Video_Recv_Height,Ae.height),zt(ue,sn.Video_Recv_Width,Ae.width)):B&&(zt(ue,sn.Video_Recv_Height,B._videoHeight||0),zt(ue,sn.Video_Recv_Width,B._videoWidth||0)),Ue&&zt(ue,sn.Video_Recv_Frame_Rate_Output,Ue.frameRate);const ir=(bn=B._player)===null||bn===void 0?void 0:bn.rendFrameRate.toFixed(0);if(ir&&zt(ue,sn.Video_Render_Frame_Rate_Render,+ir),zt(ue,sn.Video_Recv_Jitter_Buffer,_e.jitterBufferMs),zt(ue,sn.Video_Recv_Current_Delay,_e.currentDelayMs),zt(ue,sn.Video_Recv_Firs,_e.firsCount),zt(ue,sn.Video_Recv_Nacks,_e.nacksCount),zt(ue,sn.Video_Recv_Plis,_e.plisCount),B){ue[sn.Video_Recv_Disabled]=B._originMediaStreamTrack.enabled&&B._mediaStreamTrack.enabled?0:1;const Jn=B._player;if(Jn){const{freezeTimeCounterList:uo,renderFreezeAccTime:ze,renderFreezeAccTime2:ot,videoElementStatus:wt}=Jn;if(uo&&uo.length>0&&zt(ue,rh.Video_Render_Freeze_Time,uo.splice(0,1)[0]),ee&&lp.visibility==="visible"&&wt===oo.PLAYING&&Wn().supportRequestVideoFrameCallback){const Ke=Math.min(6e3,ot);Jn.renderFreezeAccTime2=Math.max(0,ot-Ke),zt(ue,rh.Video_Render_Freeze_Time_Render2,Ke);const V=Math.min(6e3,ze);Jn.renderFreezeAccTime=Math.max(0,ze-V),zt(ue,rh.Video_Render_Freeze_Time_Render,oe("USE_NEW_RENDER_FREEZE_TIME")?Ke:V)}if(typeof _e.totalFreezesDuration=="number"){const Ke=Zt&&Zt.totalFreezesDuration?_e.totalFreezesDuration-Zt.totalFreezesDuration:_e.totalFreezesDuration;zt(ue,sn.Video_Render_Freeze_Duration,1e3*Ke)}}}if(ue[sn.Video_Recv_Player_Status]=_2[B._player?B._player.videoElementStatus:"uninit"],Zt&&_e.totalInterFrameDelay!==void 0&&_e.totalSquaredInterFrameDelay!==void 0&&Zt.totalInterFrameDelay!==void 0&&Zt.totalSquaredInterFrameDelay!==void 0){const Jn=_e.totalInterFrameDelay-Zt.totalInterFrameDelay,uo=_e.totalSquaredInterFrameDelay-Zt.totalSquaredInterFrameDelay,ze=_e.framesDecodeCount-Zt.framesDecodeCount,ot=Jn/ze*1e3,wt=Math.round(1e3*Math.sqrt((uo-Math.pow(Jn,2)/ze)/ze));!isNaN(wt)&&ot+wt>Math.max(3*ot,ot+150)&&(ue[sn.Video_Recv_I_Frame_Delay]=wt)}}return ue})(g._videoSSRC,r,g.videoTrack,I===!0,this.needUploadRenderFreezeTime,s,a,c):void 0;A&&(w.video=A)}if(v.has(St.AUDIO)&&g.audioTrack){const I=g.audioTrack?(function(A,N,H,B,z,ee){const Z=N.audioRecv.find((ue=>ue.ssrc===A));if(!Z)return;const ae={};zt(ae,Os.Audio_Recv_Jitter,Z.jitterMs),zt(ae,Os.Audio_Recv_Bytes_Retransmit,Z.retransmittedBytesReceived),zt(ae,Os.Audio_Recv_Packages_Retransmit,Z.retransmittedPacketsReceived),zt(ae,Os.Audio_Recv_Packages_Discarded,Z.packetsDiscarded),zt(ae,Os.Audio_Recv_Avg_Processing_Delay,Z.avgProcessingDelayMs);const ye=ee&&ee.audioRecv.find((ue=>ue.ssrc===A));if(ye){const ue=gy;Z.packets!=null&&ye.packets!=null&&zt(ae,Os.Audio_Recv_Package_Rate,1e3*(Z.packets-ye.packets)/ue),Z.packetsLost!=null&&ye.packetsLost!=null&&zt(ae,Os.Audio_Recv_Package_Lost,Z.packetsLost-ye.packetsLost)}if(B){const{receivedFrames:ue,droppedFrames:Ae}=Z;ue!=null&&Ae!=null&&(ae[rh.Audio_Recv_Freeze]=(_e=ue)===0||100*Ae/_e>20?1:0)}var _e;if(z){const ue=100*H._source.getAccurateVolumeLevel(),Ae=Z.outputLevel;if(Ae!=null){const We=Math.ceil(50*Math.log10(100*Ae+1));zt(ae,sn.Audio_Render_Level,We)}zt(ae,sn.Audio_Recv_PCM_Level,ue),H&&(ae[sn.Audio_Recv_Disabled]=H._originMediaStreamTrack.enabled&&H._mediaStreamTrack.enabled?0:1),zt(ae,sn.Audio_Recv_Jitter_Buffer,Z.jitterBufferMs),zt(ae,sn.Audio_Recv_Current_Delay,Z.jitterBufferMs),ae[sn.Audio_Recv_Player_Status]=_2[xa.getPlayerState(H.getTrackId())];const Ue=z.audioRecv.find((We=>We.ssrc===A));if(Ue){Ue.bytes!=null&&Z.bytes!=null&&zt(ae,sn.Audio_Recv_Bitrate,8*(Z.bytes-Ue.bytes)/(gy*OT));const We=Z.concealedSamples-Ue.concealedSamples;We>0&&zt(ae,sn.Audio_Recv_Concealed_Samples,We);const Ze=Z.totalSamplesReceived-Ue.totalSamplesReceived;Ze>0&&zt(ae,sn.Audio_Recv_Total_Samples_Received,Ze);const _n=Z.freezeSamples80-Ue.freezeSamples80;_n>0&&zt(ae,sn.Audio_Render_Freeze_Samples_80ms,_n);const bn=Z.freezeSamples200-Ue.freezeSamples200;bn>0&&zt(ae,sn.Audio_Render_Freeze_Samples_200ms,bn);const Zt=Z.freezeMs80-Ue.freezeMs80;zt(ae,sn.Audio_Render_Freeze_Time_80ms,Zt<0?0:Zt);const ir=Z.freezeMs200-Ue.freezeMs200;zt(ae,sn.Audio_Render_Freeze_Time_200ms,ir<0?0:ir)}}return ae})(g._audioSSRC,r,g.audioTrack,s,a,c):void 0;I&&(w.audio=I)}(w.video||w.audio)&&h.push(w)})),this.needUploadRenderFreezeTime=!this.needUploadRenderFreezeTime,h}startUploadTransportStats(){this.uploadTransportStarted=!0,this.uploadWRTCStatsTimer||this.startUploadWRTCStats()}stopUploadTransportStats(){this.uploadTransportStarted=!1}startUploadOutboundStats(){this.uploadOutboundStarted||(this.uploadOutboundStarted=!0,this.uploadWRTCStatsTimer||this.startUploadWRTCStats(),this.uploadOutboundDenoiserStatsTimer&&window.clearInterval(this.uploadOutboundDenoiserStatsTimer),this.uploadOutboundDenoiserStatsTimer=window.setInterval((()=>{if(!this.requestAllTracks||!this.requestUpload)return;const r=(this.requestAllTracks()||[]).find((s=>s instanceof _T));if(r&&r._external.getDenoiserStats){const s=r._external.getDenoiserStats();s&&this.requestUpload(ET.DENOISER_STATS,s)}}),2e3),this.uploadExtStatsTimer&&window.clearInterval(this.uploadExtStatsTimer),this.uploadExtStatsTimer=window.setInterval((()=>{!this.requestAllTracks||!this.requestUpload||this.requestAllTracks().forEach((r=>{r.getProcessorStats().forEach((s=>{this.requestUpload&&this.requestUpload(s.type,s.stats)}))}))}),2e3))}stopUploadOutboundStats(){this.uploadOutboundStarted&&(this.uploadOutboundStarted=!1,this.lastSendStats&&(this.lastSendStats.videoSend=[],this.lastSendStats.audioSend=[],this.lastSendStats=void 0),this.lastRefSendStats&&(this.lastRefSendStats.videoSend=[],this.lastRefSendStats.audioSend=[],this.lastRefSendStats=void 0),this.lastNormalSendStats&&(this.lastNormalSendStats.videoSend=[],this.lastNormalSendStats.audioSend=[],this.lastNormalSendStats=void 0),this.lastExtendStats={},this.needUploadStats={},this.uploadOutboundDenoiserStatsTimer&&window.clearInterval(this.uploadOutboundDenoiserStatsTimer),this.uploadOutboundDenoiserStatsTimer=void 0,this.uploadExtStatsTimer&&window.clearInterval(this.uploadExtStatsTimer),this.uploadExtStatsTimer=void 0)}startUploadInboundStats(){this.uploadInboundStarted||(this.uploadInboundStarted=!0,this.uploadWRTCStatsTimer||this.startUploadWRTCStats(),this.uploadInboundExtStatsTimer&&window.clearInterval(this.uploadInboundExtStatsTimer),this.uploadInboundExtStatsTimer=window.setInterval((()=>{!this.requestUpload||!this.requestRemoteMedia||(this.requestRemoteMedia()||[]).forEach((r=>{let[s,a]=r;a.has(St.VIDEO)&&s.videoTrack&&s.videoTrack.getProcessorStats().forEach((c=>{this.requestUpload&&this.requestUpload(c.type,c.stats)})),a.has(St.AUDIO)&&s.audioTrack&&s.audioTrack.getProcessorStats().forEach((c=>{this.requestUpload&&this.requestUpload(c.type,c.stats)}))}))}),2e3))}stopUploadInboundStats(){this.uploadInboundStarted&&(this.uploadInboundStarted=!1,this.lastRecvStats&&(this.lastRecvStats.videoRecv=[],this.lastRecvStats.audioRecv=[],this.lastRecvStats=void 0),this.lastRefRecvStats&&(this.lastRefRecvStats.videoRecv=[],this.lastRefRecvStats.audioRecv=[],this.lastRefRecvStats=void 0),this.lastNormalRecvStats&&(this.lastNormalRecvStats.videoRecv=[],this.lastNormalRecvStats.audioRecv=[],this.lastNormalRecvStats=void 0),this.lastUploadCompensateTime=-1,this.uploadCompensateDeltaTime=0,this.needUploadRenderFreezeTime=!0,this.uploadInboundExtStatsTimer&&window.clearInterval(this.uploadInboundExtStatsTimer),this.uploadInboundExtStatsTimer=void 0)}startUploadExtensionUsageStats(){if(this.uploadExtensionUsageStarted)return;this.uploadExtensionUsageStarted=!0,this.uploadExtUsageStatsTimer&&window.clearInterval(this.uploadExtUsageStatsTimer);const r=new Map;this.uploadExtUsageStatsTimer=window.setInterval((async()=>{const s=Date.now(),a={connectionInterval:oe("EXTENSION_USAGE_UPLOAD_INTERVAL")/1e3,details:[],lts:s};let c=[];const d=this.requestAllTracks&&this.requestAllTracks()||[];for(const v of d)!v.muted&&v.enabled&&(c=c.concat(await v.getProcessorUsage()));const h=this.requestRemoteMedia&&this.requestRemoteMedia()||[];for(const[v,w]of h)w.has(St.VIDEO)&&v.videoTrack&&(c=c.concat(await v.videoTrack.getProcessorUsage())),w.has(St.AUDIO)&&v.audioTrack&&(c=c.concat(await v.audioTrack.getProcessorUsage()));if(c.length===0)return;a.details=(function(v,w){const I={};for(const{id:B,value:z,level:ee,direction:Z}of v){var A;const ae=(A=w.get(B))!==null&&A!==void 0?A:0,ye=z===2?ae+oe("EXTENSION_USAGE_UPLOAD_INTERVAL")/1e3:ae;var N,H;w.set(B,ye),I[B]?(z===2&&(I[B].value=z),ee>I[B].level&&(I[B].level=ee),Z==="remote"&&(I[B].remoteUidCount+=1),I[B].totalTs=(N=w.get(B))!==null&&N!==void 0?N:0):I[B]={value:z,level:ee,remoteUidCount:Z==="local"?0:1,totalTs:(H=w.get(B))!==null&&H!==void 0?H:0}}return Object.keys(I).map((B=>{const{level:z,value:ee,totalTs:Z}=I[B];return{id:B,level:z,value:ee,totalTs:Z}}))})(c,r);const m=Date.now(),g=m>s?m:s+1;this.requestUpload&&this.requestUpload(ET.EXTENSION_USAGE_STATS,{usageStats:a,sendTs:g})}),oe("EXTENSION_USAGE_UPLOAD_INTERVAL"))}stopUploadExtensionUsageStats(){this.uploadExtensionUsageStarted&&(this.uploadExtensionUsageStarted=!1,this.uploadExtUsageStatsTimer&&window.clearInterval(this.uploadExtUsageStatsTimer),this.uploadExtUsageStatsTimer=void 0)}stopUploadBaseStats(){this.uploadBaseStatsStarted=!1}}const L_e=oe("ICE_RESTART_INTERVAL");let vP=new Map,A0=new Map,ug=[co.UDP_TCP_RELAY,co.TCP_RELAY,co.RELAY],mM=oe("JOIN_WITH_FALLBACK_MEDIA_PROXY_FORCE")&&Wn().supportPCSetConfiguration;function vH(t){let r=arguments.length>1&&arguments[1]!==void 0&&arguments[1];const s=vP.get(t.id);s&&(window.clearTimeout(s),vP.delete(t.id));const a=A0.get(t.id);r&&a&&a.index===ug.length-1&&(M.debug("[".concat(t.id,"] reset ICE restart policy")),A0.delete(t.id))}function SH(t,r,s){if(vP.size===0&&A0.size===0&&(Array.isArray(oe("RESTART_SEQUENCE"))&&oe("RESTART_SEQUENCE").length>0&&!(function(m,g){if(m.length!==g.length)return!1;for(let v=0;v<m.length;v+=1){const w=m[v];if(m.filter((I=>I===w)).length!==g.filter((I=>I===w)).length)return!1}return!0})(ug,oe("RESTART_SEQUENCE"))&&(ug=oe("RESTART_SEQUENCE").filter((m=>{var g;if(rt(g=Object.values(co)).call(g,m))return!0})),M.debug("use reconnection policy from config distribution, queues: ".concat(ug.join(" => ")))),mM=oe("JOIN_WITH_FALLBACK_MEDIA_PROXY_FORCE")&&Wn().supportPCSetConfiguration),ug.length===0)return void s();let a,{index:c=0,type:d}=A0.get(t.id)||{};if(mM&&d===co.RELAY)return void s();let h=d&&c>=ug.length-1;if(mM)d=co.RELAY;else{if(h)return void s();d?(c++,d=ug[c]):(d=ug[0],c=0)}M.debug("[".concat(t.id,"] choose ICE restart policy: ").concat(d,", index: ").concat(c)),r(d),A0.set(t.id,{index:c,type:d}),a=window.setTimeout((()=>SH(t,r,s)),L_e),vP.set(t.id,a)}var In;function bH(t,r){var s=Object.keys(t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);r&&(a=a.filter((function(c){return Object.getOwnPropertyDescriptor(t,c).enumerable}))),s.push.apply(s,a)}return s}function hp(t){for(var r=1;r<arguments.length;r++){var s=arguments[r]!=null?arguments[r]:{};r%2?bH(Object(s),!0).forEach((function(a){X(t,a,s[a])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(s)):bH(Object(s)).forEach((function(a){Object.defineProperty(t,a,Object.getOwnPropertyDescriptor(s,a))}))}return t}function wH(t){var r,s,a,c=2;for(typeof Symbol<"u"&&(s=OL,a=Symbol.iterator);c--;){if(s&&(r=t[s])!=null)return r.call(t);if(a&&(r=t[a])!=null)return new SP(r.call(t));s="@@asyncIterator",a="@@iterator"}throw new TypeError("Object is not async iterable")}function SP(t){function r(s){if(Object(s)!==s)return mt.reject(new TypeError(s+" is not an object."));var a=s.done;return mt.resolve(s.value).then((function(c){return{value:c,done:a}}))}return SP=function(s){this.s=s,this.n=s.next},SP.prototype={s:null,n:null,next:function(){return r(this.n.apply(this.s,arguments))},return:function(s){var a=this.s.return;return a===void 0?mt.resolve({value:s,done:!0}):r(a.apply(this.s,arguments))},throw:function(s){var a=this.s.return;return a===void 0?mt.reject(s):r(a.apply(this.s,arguments))}},new SP(t)}let kT=(In=class extends Zr{get state(){return this._state}set state(t){const r=this._state;this._state=t,this.emit(Mt.StateChange,r,this._state)}constructor(t,r){super(),X(this,"isPlanB",void 0),X(this,"store",void 0),X(this,"statsUploader",void 0),X(this,"connection",void 0),X(this,"localTrackMap",new Map),X(this,"remoteUserMap",new Map),X(this,"localDataChannels",[]),X(this,"remoteDataChannelMap",new Map),X(this,"pendingLocalTracks",[]),X(this,"pendingRemoteTracks",[]),X(this,"pendingLocalDataChannels",[]),X(this,"pendingRemoteDataChannels",[]),X(this,"statsCollector",void 0),X(this,"shouldForwardP2PCreation",void 0),X(this,"iceFailedCount",0),X(this,"dtlsFailedCount",0),X(this,"mutex",void 0),X(this,"_state",ar.Disconnected),X(this,"_pcStatsUploadType",oe("NEW_ICE_RESTART")?Tf.FIRST_CONNECTION:Tf.OLD_FIRST_CONNECTION),X(this,"_isStartRestartIce",!1),X(this,"_restartTimer",void 0),X(this,"_isTryConnecting",!1),X(this,"_iceError",null),X(this,"_forceTurn",!1),X(this,"_isWaitPcToRePub",!1),X(this,"handleMuteLocalTrack",(async(s,a,c)=>{const d=await this.mutex.lock("Locking from P2PChannel.handleMuteLocalTrack");try{if(!this.connection||this.state!==ar.Connected)return void c(new Le(te.INVALID_OPERATION,"Cannot call P2PChannel.handleMuteLocalTrack before connection established."));const h=this.filterTobeMutedTracks(s);if(h.length===0)return void a();const m=h.find((v=>v[0]==="videoLowTrack"));if(m){const v=m[1];this.store.enableInstantMuteRestore?(v.track._originMediaStreamTrack.enabled=!1,M.info("[".concat(this.store.clientId,"] P2PChannel muteLocalLowTrack without close sender because enableInstantMuteRestore is true"))):v.track._originMediaStreamTrack.stop()}this.store.enableInstantMuteRestore?M.info("[".concat(this.store.clientId,"] P2PChannel muteLocalTrack without close sender because enableInstantMuteRestore is true")):await this.connection.muteLocal(h.map((v=>{let[,{id:w}]=v;return w})));const g=this.createMuteMessage(h);await wr(this,Mt.RequestMuteLocal,g),a()}catch(h){c(h)}finally{d()}})),X(this,"handleUnmuteLocalTrack",(async(s,a,c)=>{const d=await this.mutex.lock("Locking from P2PChannel.handleUnmuteLocalTrack");try{if(!this.connection||this.state!==ar.Connected)return void c(new Le(te.INVALID_OPERATION,"Cannot call P2PChannel.handleUnmuteLocalTrack before connection established."));const h=this.filterTobeUnmutedTracks(s);if(h.length===0)return void a();const m=h.find((v=>v[0]==="videoLowTrack"));if(m){const v=m[1];if(this.store.enableInstantMuteRestore)v.track._originMediaStreamTrack.enabled=!0,M.info("[".concat(this.store.clientId,"] P2PChannel unmuteLocalLowTrack without close sender because enableInstantMuteRestore is true"));else{if(v.track._originMediaStreamTrack.stop(),!oe("DISABLE_DUAL_STREAM_USE_ENCODING")&&Wn().supportDualStreamEncoding){const w=s._mediaStreamTrack.clone();v.track._mediaStreamTrack=w,v.track._originMediaStreamTrack=w}else{const w=fM(s,uT(this,Mt.RequestLowStreamParameter));v.track._mediaStreamTrack=w,v.track._originMediaStreamTrack=w}await new mt(((w,I)=>{this.handleReplaceTrack(v.track,w,I,!0)}))}}this.store.enableInstantMuteRestore?M.info("[".concat(this.store.clientId,"] P2PChannel unmuteLocalTrack without close sender because enableInstantMuteRestore is true")):await this.connection.unmuteLocal(h.map((v=>{let[,{id:w}]=v;return w})));const g=this.createUnmuteMessage(h);await wr(this,Mt.RequestUnmuteLocal,g),a()}catch(h){c(h)}finally{d()}})),X(this,"handleUpdateVideoEncoder",(async(s,a,c,d)=>{let h;d||(h=await this.mutex.lock("Locking from P2PChannel.handleUpdateVideoEncoder"));try{const g=this.localTrackMap.get(Xe.LocalVideoTrack);if(!this.connection||!g||g.track!==s||this.state!==ar.Connected)return void a();const{id:v,track:w}=g;await this.connection.updateSendParameters(v,w),await this.connection.updateEncoderConfig(v,w),this.emit(Mt.UpdateVideoEncoder,w),a()}catch(g){c(g)}finally{var m;(m=h)===null||m===void 0||m()}})),X(this,"handleUpdateVideoSendParameters",(async(s,a,c)=>{const d=await this.mutex.lock("Locking from P2PChannel.handleUpdateVideoSendParameters");try{const h=this.localTrackMap.get(Xe.LocalVideoTrack);if(!this.connection||!h||h.track!==s||this.state!==ar.Connected)return void a();const{id:m,track:g}=h;await this.connection.updateSendParameters(m,g),a()}catch(h){c(h)}finally{d()}})),X(this,"handleReplaceMixingTrack",(async(s,a,c,d)=>{if(!this.connection||this.state!==ar.Connected)return void a();const h=hM([s]);let m;M.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection will replace audioTrack [").concat(h.getTrackId(),"]")),typeof d=="boolean"&&d||(m=await this.mutex.lock("From P2PChannel.handleReplaceMixingTrack"));try{await this.replaceTrack(s,h),a()}catch(v){c(v)}finally{var g;(g=m)===null||g===void 0||g()}})),X(this,"handleReplaceTrack",(async(s,a,c,d)=>{let h;M.debug("[".concat(this.store.clientId,"] P2PChannel handleReplaceTrack for [track-id-").concat(s.getTrackId(),"]")),typeof d=="boolean"&&d||(h=await this.mutex.lock("From P2PChannel.handleReplaceTrack"));try{var m;const v=Array.from(this.localTrackMap.entries()).find((w=>{let[,{track:I}]=w;return s===I}));if(!this.connection||!v||this.state!==ar.Connected)return void a();if(await((m=this.connection)===null||m===void 0?void 0:m.replaceTrack(s,v[1].id)),this.isPlanB){const w=v[1];w.id=s._mediaStreamTrack.id,this.localTrackMap.set(v[0],w)}if(v[0]===Xe.LocalVideoTrack&&!oe("DISABLE_DUAL_STREAM_USE_ENCODING")&&Wn().supportDualStreamEncoding){const w=this.localTrackMap.get(Xe.LocalVideoLowTrack);if(w){const I=s._mediaStreamTrack.clone();w.track._originMediaStreamTrack.stop(),w.track._mediaStreamTrack=I,w.track._originMediaStreamTrack=I,await new mt(((A,N)=>{this.handleReplaceTrack(w.track,A,N,!0)}))}}a()}catch(v){c(v)}finally{var g;(g=h)===null||g===void 0||g()}})),X(this,"handleGetRTCStats",(s=>{s(this.statsCollector.getRTCStats())})),X(this,"handleGetLocalVideoStats",(s=>{s(this.statsCollector.getLocalVideoTrackStats())})),X(this,"handleGetLocalAudioStats",(s=>{s(this.statsCollector.getLocalAudioTrackStats())})),X(this,"handleGetRemoteVideoStats",(s=>this.statsCollector.getRemoteVideoTrackStats(s.uid)[s.uid])),X(this,"handleGetRemoteAudioStats",(s=>this.statsCollector.getRemoteAudioTrackStats(s.uid)[s.uid])),this.store=t,this.statsCollector=r,this.statsCollector.addP2PChannel(this),this.statsUploader=new EH(this.store),this.bindStatsUploaderEvents(),this.mutex=new so("P2PChannel-mutex",this.store.clientId),this.isPlanB=!Wn().supportUnifiedPlan||oe("CHROME_FORCE_PLAN_B")&&vf(),this.shouldForwardP2PCreation=oe("FORWARD_P2P_CREATION")&&Wn().supportPCSetConfiguration&&GL(),this.shouldForwardP2PCreation&&(this.connection=_P(this.store),this.emit(Mt.PeerConnectionStateChange,this.connection.peerConnectionState),this.bindConnectionEvents(this.connection))}async startP2PConnection(t,r){var s;this.state=ar.New,this._forceTurn=fH(t),M.debug("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] forceTurn: ").concat(this._forceTurn));const a=this.shouldForwardP2PCreation&&((s=this.connection)===null||s===void 0?void 0:s.peerConnectionState)==="closed";if((!this.shouldForwardP2PCreation||a||r)&&((a||r)&&this.connection&&(M.warning("[".concat(this.store.clientId,"] P2PChannel.startP2PConnection ForwardP2P closed.")),this.resetConnection(this.connection)),this.connection=_P(this.store,t),this.emit(Mt.PeerConnectionStateChange,this.connection.peerConnectionState),this.bindConnectionEvents(this.connection)),!this.connection)throw new Le(te.UNEXPECTED_ERROR,"Cannot P2PChannel.startConnection before P2PConnection initialization .");return this._pcStatsUploadType=oe("NEW_ICE_RESTART")?Tf.FIRST_CONNECTION:Tf.OLD_FIRST_CONNECTION,this._isTryConnecting=!0,this._isStartRestartIce=!1,this._iceError=null,this.connection.setConfiguration(t),this.connection.establishPromise}async connect(t){if(!this.connection)throw new Le(te.UNEXPECTED_ERROR,"Cannot P2PChannel.connect before P2PChannel.startP2PConnection .");if(this.isPreallocation()&&this.state===ar.Connected){if(this.connection instanceof iu&&this.connection.checkDtlsParameters(t.dtlsParameters.fingerprints))return M.debug("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] dtls parameters mismatch, try next.")),It.reportApiInvoke(this.store.sessionId,{name:pi.MISMATCH_DTLS_PARAMETERS,options:[t.dtlsParameters.fingerprints],tag:$r.TRACER}).onSuccess(),void setTimeout((()=>{this.emit(Mt.RequestReconnect)}));await this.connection.updateRemoteConnect(t)}else this.store.peerConnectionStart(),await this.connection.connect(t),this.statsUploader.startUploadTransportStats(),this.statsUploader.startUploadExtensionUsageStats(),this.state=ar.Connected}updateRemoteRTPCapabilities(t){const r=Array.from(this.localTrackMap.entries()).filter((c=>{var d;let[h]=c;return rt(d=[Xe.LocalVideoLowTrack,Xe.LocalVideoTrack]).call(d,h)})),s=r.map((c=>{let[,{id:d}]=c;return d})),a=r.map((c=>{let[d]=c;return d}));if(this.connection instanceof iu){if(It.updateRemoteRTPCapabilities(this.store.sessionId,{trackTypes:JSON.stringify(a),localCodecs:JSON.stringify(this.connection.localCodecs),remoteCodecs:JSON.stringify(t)}),!rt(t).call(t,this.store.codec)){const c=["vp9","vp8","h264"].find((d=>rt(t).call(t,d)));c&&(this.store.codec=c,M.debug("[".concat(this.store.clientId,"] [").concat(this.store.p2pId," updateRemoteRTPCapabilities] default codec is not available, hence the fallback to ").concat(c,".")))}this.connection.updateRemoteRTPCapabilities(s,t)}}async getEstablishParams(){var t;if(this.connection instanceof iu&&this.connection.peerConnectionState!=="closed"&&rt(t=[ar.New,ar.Connected]).call(t,this.state))return this.connection.establishPromise}async publishDataChannel(t){if(!this.connection||this.state!==ar.Connected){if(this.state===ar.Disconnected)throw new Le(te.UNEXPECTED_ERROR,"PeerConnection already disconnected.");return t.forEach((s=>{var a;rt(a=this.pendingLocalDataChannels).call(a,s)||this.pendingLocalDataChannels.push(s)})),[]}const r=this.filterTobePublishedDataChannels(t);return r.length===0?[]:(r.forEach((s=>{const a=Date.now();this.store.publish(s.id.toString(),"datachannel",a)})),await this.connection.createDataChannels(this.store.uid,r),r.forEach((s=>{this.localDataChannels.push(s);const a=Date.now();this.store.publish(s.id+"","datachannel",void 0,a)})),t.map((s=>({streamId:s.id,ordered:s.ordered,maxRetransmits:s.maxRetransmits,metadata:s.metadata,channelId:s._originDataChannelId}))))}publish(t,r,s){var a=this;return Ql((function*(){const c=yield zn(a.mutex.lock("From P2PChannel.publish"));try{var d;const h=a.connection&&rt(d=["disconnected","failed"]).call(d,a.connection.peerConnectionState);if(!a.connection||a.state!==ar.Connected||h){if(a.state===ar.Disconnected)throw new Le(te.UNEXPECTED_ERROR,"PeerConnection already disconnected.");a.throwIfTrackTypeNotMatch(t);const g=t.filter((v=>a.pendingLocalTracks.indexOf(v)===-1));return a.pendingLocalTracks=a.pendingLocalTracks.concat(g),void(h&&(a._isWaitPcToRePub=!0))}a.store.pubId=a.store.pubId+1,lo.markPublishStart(a.store.clientId,a.store.pubId);const m=a.filterTobePublishedTracks(t,r,s);if(m.length===0)return void(yield zn(a.tryToUnmuteAudio(t)));yield*p1(wH(a.doPublish(a.connection,m)))}finally{c()}}))()}doPublish(t,r){var s=this;return Ql((function*(){r.forEach((A=>{let{track:N,type:H}=A;const B=Date.now();s.store.publish(N.getTrackId(),H===Xe.LocalAudioTrack?"audio":"video",B)})),s.bindLocalTrackEvents(r);const a=r.map((A=>{let{track:N}=A;return N})),c=yield zn(t.send(a,s.store.codec,s.store.audioCodec)),d=(yield zn(c.next())).value,h=s.createGatewayPublishMessage(r,d);let m;try{m=yield h}catch(A){throw c.throw(A),(A==null?void 0:A.code)===te.WS_ABORT&&r.forEach((N=>{let{track:H}=N;s.pendingLocalTracks.indexOf(H)===-1&&s.pendingLocalTracks.push(H)})),s.unbindLocalTrackEvents(r),A}const g=s.mapPubResToRemoteConfig(h,m,a),v=(yield zn(c.next(g))).value;if(s.state===ar.Disconnected)throw new Le(te.UNEXPECTED_ERROR,"PeerConnection already disconnected.");oe("ENABLE_VIDEO_SEI");const w=oe("ENABLE_ENCODED_TRANSFORM"),I=oe("ENABLE_AUDIO_METADATA");a.forEach((async A=>{const N=A.getRTCRtpTransceiver();if(!N||!w)return;const{interceptLocalVideoFrame:H,interceptLocalAudioFrame:B}=cP();A.trackMediaType===St.VIDEO?await H(N.sender,A):A.trackMediaType===St.AUDIO&&await B(N.sender,{metadata:I?()=>{const z=A.metadata.shift();return z&&z.value}:void 0})})),r.forEach((A=>{let{type:N}=A;s.statsCollector.addLocalStats(N)})),s.assignLocalTracks(r,v),s.statsUploader.startUploadOutboundStats(),r.forEach((A=>{let{track:N,type:H}=A;const B=Date.now();s.store.publish(N.getTrackId(),H===Xe.LocalAudioTrack?"audio":"video",void 0,B)}))}))()}async updateVideoStreamParameter(t,r){const s=this.localTrackMap.get(r);if(!s||!this.connection)return;if(!(s.track instanceof Nr))return M.warn("[updateVideoStreamParameter]: track is not an instance of LocalVideoTrack");const{track:a}=s,c=(function(d,h){const m={};return d.height&&d.width&&(m.scaleResolutionDownBy=q2(d,h)),m.maxFramerate=d.framerate?xc(d.framerate):void 0,m.maxBitrate=d.bitrate?1e3*d.bitrate:void 0,m})(t,a);if(a._encoderConfig||(a._encoderConfig={}),r!==Xe.LocalVideoLowTrack||!oe("DISABLE_DUAL_STREAM_USE_ENCODING")&&Wn().supportDualStreamEncoding)c.scaleResolutionDownBy!=null&&(a._encoderConfig.scaleResolutionDownBy=c.scaleResolutionDownBy);else{const d=a._originMediaStreamTrack;if(!d.canvas)return M.warn("[".concat(a.getTrackId(),"] no canvas on track"));(function(h,m){const g=h.canvas;m.width&&(g.width=xc(m.width)),m.height&&(g.height=xc(m.height)),m.framerate&&(g.stopCapture&&g.stopCapture(),g.stopCapture=E2((()=>{!g.startCapture&&g.stopCapture&&g.stopCapture(),g.startCapture&&g.startCapture()}),xc(m.framerate)))})(d,t)}c.maxBitrate!=null&&(a._encoderConfig.bitrateMax=c.maxBitrate/1e3),c.maxFramerate!=null&&(a._encoderConfig.frameRate&&typeof a._encoderConfig.frameRate=="object"?a._encoderConfig.frameRate.max=c.maxFramerate:a._encoderConfig.frameRate={max:c.maxFramerate}),M.debug("[".concat(a.getTrackId(),"] LowStreamEncoderConfig: , ").concat(JSON.stringify(a._encoderConfig))),await this.connection.updateRtpSenderEncodings(a)}publishLowStream(t){var r=this;return Ql((function*(){if(!r.connection||r.state!==ar.Connected)return;const s=yield zn(r.mutex.lock("Locking from P2PChannel.publishLowStream"));try{const c=r.localTrackMap.get(Xe.LocalVideoTrack);if(!c)throw new Le(te.UNEXPECTED_ERROR,"Could not find high stream");if(r.localTrackMap.has(Xe.LocalVideoLowTrack))throw new Le(te.UNEXPECTED_ERROR,"[".concat(r.store.clientId,"] Can't publish low stream when stream already publish"));const d=[{track:r.getLowVideoTrack(c.track,t),type:Xe.LocalVideoLowTrack}];if(yield*p1(wH(r.doPublish(r.connection,d))),c.track.muted||!c.track.enabled){var a;const h=(a=r.localTrackMap.get(Xe.LocalVideoLowTrack))===null||a===void 0?void 0:a.id;h!==void 0&&(yield zn(r.connection.muteLocal([h])))}}finally{s()}}))()}async republish(){this.pendingLocalTracks.length>0&&(M.debug("[".concat(this.store.clientId,"] Emit P2PChannelEvents.RequestRePublish to republish tracks.")),await zs(this,Mt.RequestRePublish,this.pendingLocalTracks),this.emit(Mt.MediaReconnectEnd,this.store.uid),this.pendingLocalTracks=[]),this.pendingLocalDataChannels.length>0&&(M.debug("Emit P2PChannelEvents.RequestRePublishDataChannel to republish datachannels."),await zs(this,Mt.RequestRePublishDataChannel,this.pendingLocalDataChannels),this.pendingLocalDataChannels=[]),this._isWaitPcToRePub=!1}async reSubscribe(t){for(let r=this.pendingRemoteTracks.length-1;r>=0;r--){const{user:s,kind:a}=this.pendingRemoteTracks[r];(a!==St.AUDIO||s._audio_added_&&s._audioSSRC)&&(a!==St.VIDEO||s._video_added_&&s._videoSSRC)||this.pendingRemoteTracks.splice(r,1)}if(t)await zs(this,Mt.RequestReSubscribe,this.pendingRemoteTracks);else for(const{user:r,kind:s}of this.pendingRemoteTracks)await this.subscribe(r,s,s===St.VIDEO?r._videoSSRC:r._audioSSRC);this.pendingRemoteTracks.forEach((r=>{let{user:s}=r;this.emit(Mt.MediaReconnectEnd,s.uid)})),this.pendingRemoteTracks=[]}async unpublish(t){if(!this.connection||this.state!==ar.Connected)return void t.forEach((a=>{const c=this.pendingLocalTracks.indexOf(a);c!==-1&&this.pendingLocalTracks.splice(c,1)}));const r=this.filterTobeUnpublishedTracks(t);if(r.length===0)return;const s=r.find((a=>a[0]==="videoLowTrack"));return s&&s[1].track.close(),this.doUnpublish(this.connection,r)}async unpublishDataChannel(t){if(!this.connection||this.state!==ar.Connected)return void t.forEach((s=>{const a=this.pendingLocalDataChannels.indexOf(s);a!==-1&&this.pendingLocalDataChannels.splice(a,1)}));const r=this.filterTobeUnpublishedDataChannels(t);return r.length!==0?(r.forEach((s=>{const a=this.localDataChannels.indexOf(s);a!==-1&&this.localDataChannels.splice(a,1)})),this.localDataChannels.length===0&&await this.connection.stopDataChannels(this.store.uid),r.map((s=>s.id))):void 0}async unpublishLowStream(){if(!this.connection||this.state!==ar.Connected)return;const t=this.localTrackMap.get(Xe.LocalVideoLowTrack);if(!t)return;t.track.close();const r=[[Xe.LocalVideoLowTrack,t]];return this.doUnpublish(this.connection,r)}async doUnpublish(t,r){const s=this.createGatewayUnpublishMessage(r);return await t.stopSending(r.map((a=>{let[,{id:c}]=a;return c}))),this.withdrawLocalTracks(r),this.unbindLocalTrackEvents(r.map((a=>{let[c,{track:d}]=a;return{type:c,track:d}}))),r.forEach((a=>{let[c]=a;this.statsCollector.removeLocalStats(c)})),this.localTrackMap.size===0&&this.statsUploader.stopUploadOutboundStats(),s}async subscribeDataChannel(t,r){if(!this.connection||this.state!==ar.Connected)throw new Le(te.INVALID_OPERATION,"Cannot subscribe remote user when peerConnection disconnected.");const s=r.filter((a=>{var c;return!((c=this.remoteDataChannelMap.get(t))!==null&&c!==void 0&&c.get(a.id))}));if(s.length!==0)return await this.connection.createDataChannels(t.uid,s),s.forEach((a=>{var c;this.remoteDataChannelMap.has(t)?(c=this.remoteDataChannelMap.get(t))===null||c===void 0||c.set(a.id,a):this.remoteDataChannelMap.set(t,new Map([[a.id,a]]));const d=this.pendingRemoteDataChannels.findIndex((h=>{let{user:m,id:g}=h;return m.uid===t.uid&&g===a.id}));d!==-1&&this.pendingRemoteDataChannels.splice(d,1)})),s.map((a=>a.id))}async subscribe(t,r,s,a,c){var d;if(!this.connection||this.state!==ar.Connected)throw new Le(te.INVALID_OPERATION,"Cannot subscribe remote user when peerConnection disconnected.");if((d=this.remoteUserMap.get(t))!==null&&d!==void 0&&d.has(r))return;let h,m,g,v;const w=this.connection.getPreMedia(s);if(w)M.debug("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] preSSRCMap has ssrcId: ").concat(s,", no need to send sub to gateway.")),g=w.transceiver,h=w.track,m=w.mid,v=w.player,w.firstVideoRender&&this.store.firstVideoFrameDecoded(t.uid,{firstPreRender:w.firstVideoRender});else if(c){const N=c.find((B=>{let{stream_type:z}=B;return z===r}));if(!N)throw new Le(te.UNEXPECTED_ERROR,"Cannot subscribe to remote ".concat(r," for user: ").concat(t.uid," because subscribe answer from gateway does not contain stream_type: ").concat(r,"."));const H=await this.connection.receive(r,N.ssrcs,String(t._uintid),N.attributes);this.connection instanceof iu&&(g=H.transceiver),h=H.track,m=H.id}else{const N=await this.connection.receive(r,[{ssrcId:s,rtx:a}],String(t._uintid),void 0);this.connection instanceof iu&&(g=N.transceiver),h=N.track,m=N.id}if(r===St.AUDIO?(t._audioTrack?t._audioTrack._updateOriginMediaStreamTrack(h):(t._audioTrack=new m0(h,t.uid,t._uintid,this.store),M.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote audio track: ").concat(t._audioTrack.getTrackId()))),g&&t._audioTrack._updateRtpTransceiver(g),this.bindRemoteTrackEvents(t,t._audioTrack)):(t._videoTrack?t._videoTrack._updateOriginMediaStreamTrack(h):(t._videoTrack=new f0(h,t.uid,t._uintid,this.store,v),M.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote video track: ").concat(t._videoTrack.getTrackId())),t._videoTrack.once(tu.PLAY_START,(()=>{this.store.firstVideoFrameDecoded(t.uid,{playStart:Date.now()})})),t._videoTrack.once(tu.PLAY_END,(()=>{this.store.firstVideoFrameDecoded(t.uid,{playEnd:Date.now()}),this.reportVideoFirstFrameRender(t)})),v?t._videoTrack.once(tu.FIRST_FRAME_RENDER,(()=>{this.store.firstVideoFrameDecoded(t.uid,{firstRender:Date.now()}),this.reportVideoFirstFrameRender(t)})):t._videoTrack.once(tu.FIRST_FRAME_DECODED,(()=>{this.store.firstVideoFrameDecoded(t.uid,{firstRender:Date.now()}),this.reportVideoFirstFrameRender(t)}))),g&&t._videoTrack._updateRtpTransceiver(g),this.bindRemoteTrackEvents(t,t._videoTrack)),g&&oe("ENABLE_ENCODED_TRANSFORM")){const{interceptRemoteVideoFrame:N,interceptRemoteAudioFrame:H}=cP();r==St.VIDEO?await N(g.receiver,{onSei:oe("ENABLE_VIDEO_SEI")&&(B=>{var z;return(z=t._videoTrack)===null||z===void 0?void 0:z._onSei(B)})}):r==St.AUDIO&&await H(g.receiver,{enableTopn:!!oe("ENABLE_AUDIO_TOPN"),enableMetadata:!!oe("ENABLE_AUDIO_METADATA"),enablePts:!!oe("ENABLE_AUDIO_PTS"),onMetadata:B=>{this.safeEmit(Mt.AudioMetadata,B)},onPts:B=>{this.safeEmit(Mt.AudioPts,B)}})}const I=this.remoteUserMap.get(t);I?I.set(r,m):this.remoteUserMap.set(t,new Map([[r,m]])),this.statsCollector.addRemoteStats(t.uid),this.statsUploader.startUploadInboundStats();const A=this.pendingRemoteTracks.findIndex((N=>{let{user:H,kind:B}=N;return H.uid===t.uid&&r===B}));A!==-1&&(this.pendingRemoteTracks.splice(A,1),this.emit(Mt.MediaReconnectEnd,t.uid))}async massSubscribe(t){return this.massSubscribeNoLock(t)}async massSubscribeNoLock(t){if(!this.connection||this.state!==ar.Connected)throw new Le(te.INVALID_OPERATION,"Cannot subscribeAll remote users when peerConnection disconnected.");t=t.filter((c=>{var d;let{user:h,mediaType:m}=c;return!((d=this.remoteUserMap.get(h))!==null&&d!==void 0&&d.has(m))}));const r=[],s=new Map;t.forEach((c=>{if(!this.connection)return;const d=this.connection.getPreMedia(c.ssrcId);if(d){const{track:h,mid:m,transceiver:g,player:v}=d;s.set(c.ssrcId,{track:h,id:m,transceiver:g,player:v})}else r.push(c)}));const a=await this.connection.batchReceive(r.map((c=>{let{user:d,mediaType:h,ssrcId:m,rtxSsrcId:g}=c;return{kind:h,ssrcMsg:[{ssrcId:m,rtx:g}],mslabel:String(d._uintid)}})));r.forEach(((c,d)=>{s.set(c.ssrcId,a[d])}));for(const{user:c,mediaType:d,ssrcId:h}of t){const m=s.get(h);if(!m)return void M.debug("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] cannot find ").concat(c.uid," subscribe data,").concat(d,", ").concat(h));const{track:g,id:v,transceiver:w,player:I}=m;if(w&&oe("ENABLE_ENCODED_TRANSFORM")){const{interceptRemoteVideoFrame:H,interceptRemoteAudioFrame:B}=cP();d==St.VIDEO?await H(w.receiver,{onSei:oe("ENABLE_VIDEO_SEI")&&(z=>{var ee;return(ee=c._videoTrack)===null||ee===void 0?void 0:ee._onSei(z)})}):d==St.AUDIO&&await B(w.receiver,{enableTopn:!!oe("ENABLE_AUDIO_TOPN"),enableMetadata:!!oe("ENABLE_AUDIO_METADATA"),enablePts:!!oe("ENABLE_AUDIO_PTS"),onMetadata:z=>{this.safeEmit(Mt.AudioMetadata,z)},onPts:z=>{this.safeEmit(Mt.AudioPts,z)}})}if(d===St.AUDIO?(c._audioTrack?c._audioTrack._updateOriginMediaStreamTrack(g):(c._audioTrack=new m0(g,c.uid,c._uintid,this.store),M.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote audio track: ").concat(c._audioTrack.getTrackId()))),w&&c._audioTrack._updateRtpTransceiver(w),this.bindRemoteTrackEvents(c,c._audioTrack)):(c._videoTrack?c._videoTrack._updateOriginMediaStreamTrack(g):(c._videoTrack=new f0(g,c.uid,c._uintid,this.store,I),M.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote video track: ").concat(c._videoTrack.getTrackId()))),w&&c._videoTrack._updateRtpTransceiver(w),this.bindRemoteTrackEvents(c,c._videoTrack)),oe("ENABLE_VIDEO_SEI")&&w){const{interceptRemoteVideoFrame:H,interceptRemoteAudioFrame:B}=cP();d==St.VIDEO?await H(w.receiver,{onSei:z=>{var ee;(ee=c._videoTrack)===null||ee===void 0||ee._onSei(z)}}):d==St.AUDIO&&await B(w.receiver)}const A=this.remoteUserMap.get(c);A?A.set(d,v):this.remoteUserMap.set(c,new Map([[d,v]])),this.statsCollector.addRemoteStats(c.uid),this.statsUploader.startUploadInboundStats();const N=this.pendingRemoteTracks.findIndex((H=>{let{user:B,kind:z}=H;return B.uid===c.uid&&d===z}));N!==-1&&(this.pendingRemoteTracks.splice(N,1),this.emit(Mt.MediaReconnectEnd,c.uid))}}async unsubscribe(t,r,s){const a=this.pendingRemoteTracks.filter((h=>{let{user:m,kind:g}=h;return r!==void 0?m.uid===t.uid&&r===g:m.uid===t.uid}));if(a.forEach((h=>{const m=this.pendingRemoteTracks.indexOf(h);this.pendingRemoteTracks.splice(m,1)})),this.connection&&this.state===ar.Connected||s||a.forEach((h=>{let{kind:m}=h;var g;if(m===St.AUDIO)(g=t._audioTrack)===null||g===void 0||g._destroy(),t._audioTrack=void 0;else if(m===St.VIDEO){var v;(v=t._videoTrack)===null||v===void 0||v._destroy(),t._videoTrack=void 0}})),!this.connection||this.state!==ar.Connected)return;const c=this.filterTobeUnSubscribedTracks(t,r);if(c.length===0)return;await this.connection.stopReceiving(c.map((h=>{let[,{id:m}]=h;return m})));const d=this.createUnsubscribeMessage(c);return this.withdrawRemoteTracks(c),this.remoteUserMap.size===0&&this.statsUploader.stopUploadInboundStats(),c.forEach((h=>{let[m,{kind:g}]=h;var v,w;if(g===St.VIDEO&&m._videoSSRC&&((v=this.connection)===null||v===void 0||v.setStatsRemoteVideoIsReady(m._videoSSRC,!1)),g===St.VIDEO)this.unbindRemoteTrackEvents(m._videoTrack),s||((w=m._videoTrack)===null||w===void 0||w._destroy(),m._videoTrack=void 0);else if(g===St.AUDIO){var I;this.unbindRemoteTrackEvents(m._audioTrack),!s&&((I=m._audioTrack)===null||I===void 0||I._destroy(),m._audioTrack=void 0)}})),d}async unsubscribeDataChannel(t,r){if(r.forEach((c=>{const d=this.pendingRemoteDataChannels.findIndex((h=>h.id===c.id));d!==-1&&this.pendingRemoteDataChannels.splice(d,1)})),!this.connection)return;const s=this.filterTobeUnSubscribedDataChannels(t,r);if(s.length===0)return;r.forEach((c=>{c._close()}));const a=this.remoteDataChannelMap.get(t);return s.forEach((c=>{a&&a.delete(c.id)})),a&&a.size===0&&(this.remoteDataChannelMap.delete(t),await this.connection.stopDataChannels(t.uid)),s.map((c=>c.id))}async massUnsubscribe(t){return this.massUnsubscribeNoLock(t)}async massUnsubscribeNoLock(t){let r=[];for(const{user:c,mediaType:d}of t){const h=this.pendingRemoteTracks.filter((m=>{let{user:g,kind:v}=m;return d!==void 0?g.uid===c.uid&&d===v:g.uid===c.uid}));h.forEach((m=>{const g=this.pendingRemoteTracks.indexOf(m);this.pendingRemoteTracks.splice(g,1)})),r=r.concat(h)}if(!this.connection||this.state!==ar.Connected)return void r.forEach((c=>{let{user:d,kind:h}=c;var m;if(h===St.AUDIO)(m=d._audioTrack)===null||m===void 0||m._destroy(),d._audioTrack=void 0;else if(h===St.VIDEO){var g;(g=d._videoTrack)===null||g===void 0||g._destroy(),d._videoTrack=void 0}}));const s=Xa(t).call(t,((c,d)=>{let{user:h,mediaType:m}=d;const g=this.filterTobeUnSubscribedTracks(h,m);return c.concat(g)}),[]);if(s.length===0)return;await this.connection.stopReceiving(s.map((c=>{let[,{id:d}]=c;return d})));const a=this.createUnsubscribeAllMessage(s);return this.withdrawRemoteTracks(s),this.remoteUserMap.size===0&&this.statsUploader.stopUploadInboundStats(),s.forEach((c=>{let[d,{kind:h}]=c;var m,g;if(h===St.VIDEO&&d._videoSSRC&&((m=this.connection)===null||m===void 0||m.setStatsRemoteVideoIsReady(d._videoSSRC,!1)),h===St.VIDEO)this.unbindRemoteTrackEvents(d._videoTrack),(g=d._videoTrack)===null||g===void 0||g._destroy(),d._videoTrack=void 0;else if(h===St.AUDIO){var v;this.unbindRemoteTrackEvents(d._audioTrack),(v=d._audioTrack)===null||v===void 0||v._destroy(),d._audioTrack=void 0}})),a}isPreSubScribe(t){return!this.connection||this.state!==ar.Connected?!1:!!this.connection.getPreMedia(t)}async muteRemote(t,r){if(!this.connection)return;const s=this.remoteUserMap.get(t);if(!s)return void M.warning("[".concat(this.store.clientId,"] P2PChannel.muteRemote has no remote user ").concat(t.uid,"."));if(!s.get(r))return void M.warning("[".concat(this.store.clientId,"] P2PChannel.muteRemote has no remote user ").concat(t.uid," media type ").concat(r,"."));const a=r===St.VIDEO?t._videoSSRC:t._audioSSRC;a!==void 0&&this.connection.setStatsRemoteVideoIsReady(a,!1)}async unmuteRemote(t,r){return this.unmuteRemoteNoLock(t,r)}async unmuteRemoteNoLock(t,r){if(!this.connection)return;const s=this.remoteUserMap.get(t);if(!s)return void M.warning("[".concat(this.store.clientId,"] P2PChannel.unmuteRemote has no remote user ").concat(t.uid,"."));s.get(r)||M.warning("[".concat(this.store.clientId,"] P2PChannel.unmuteRemote has no remote user ").concat(t.uid," media type ").concat(r,"."))}addAudioMetadata(t){const r=this.localTrackMap.get(Xe.LocalAudioTrack),s=r&&r.track;s&&s.metadata.push(t)}getAllTracks(t){const r=this.localTrackMap.get(Xe.LocalAudioTrack);if((r==null?void 0:r.track)instanceof Gi){const s=r.track;return Array.from(this.localTrackMap.entries()).filter((a=>{let[c]=a;return c!==Xe.LocalAudioTrack})).filter((a=>{let[c]=a;return!(t&&c===Xe.LocalVideoLowTrack)})).map((a=>{let[,{track:c}]=a;return c})).concat(s.trackList)}return Array.from(this.localTrackMap.entries()).filter((s=>{let[a]=s;return!(t&&a===Xe.LocalVideoLowTrack)})).map((s=>{let[,{track:a}]=s;return a}))}getAllDataChannels(){return this.localDataChannels}reportPublishEvent(t,r,s,a,c){if(t){const h=this.localTrackMap.get(Xe.LocalAudioTrack),m=a?this.localTrackMap.get(Xe.LocalVideoLowTrack):this.localTrackMap.get(Xe.LocalVideoTrack);It.publish(this.store.sessionId,{eventElapse:lo.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:t,ec:r,audioName:h==null?void 0:h.track.getTrackLabel(),videoName:m==null?void 0:m.track.getTrackLabel(),screenshare:(m==null?void 0:m.track._hints.indexOf(Sr.SCREEN_TRACK))!==-1,audio:!!h,video:!!m,p2pid:this.store.p2pId,publishRequestid:this.store.pubId,extend:c})}else{var d;s||(s=[]);const h=s.find((g=>g instanceof ui)),m=a?(d=this.localTrackMap.get(Xe.LocalVideoTrack))===null||d===void 0?void 0:d.track:s.find((g=>g instanceof Nr));It.publish(this.store.sessionId,{eventElapse:lo.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:t,ec:r,audioName:h==null?void 0:h.getTrackLabel(),videoName:m==null?void 0:m.getTrackLabel(),screenshare:(m==null?void 0:m._hints.indexOf(Sr.SCREEN_TRACK))!==-1,audio:!!h,video:!!m,p2pid:this.store.p2pId,publishRequestid:this.store.pubId,extend:c})}}reportSubscribeEvent(t,r,s,a){const c=a===St.VIDEO?s._videoSSRC:s._audioSSRC;c&&It.subscribe(this.store.sessionId,{succ:t,ec:r,video:a===St.VIDEO,audio:a===St.AUDIO,peerid:s.uid,subscribeRequestid:c,p2pid:this.store.p2pId,eventElapse:lo.measureFromSubscribeStart(this.store.clientId,c),preSsrc:this.isPreSubScribe(c)})}reset(){M.debug("[".concat(this.store.clientId,"] P2PChannel.reset")),this.mutex=new so("P2PChannel-mutex",this.store.clientId),this.connection&&(this.resetConnection(this.connection),this.connection=void 0),this.shouldForwardP2PCreation&&(this.connection=_P(this.store),this.emit(Mt.PeerConnectionStateChange,this.connection.peerConnectionState),this.bindConnectionEvents(this.connection)),this.statsUploader.stopUploadOutboundStats(),this.statsUploader.stopUploadInboundStats(),this.statsUploader.stopUploadTransportStats(),this.statsUploader.stopUploadExtensionUsageStats(),this.statsUploader.stopUploadBaseStats(),this.unbindLocalTrackEvents(),this.unbindAllRemoteTrackEvents(),this.unbindRtpTransceiver();const t=this.localTrackMap.get(Xe.LocalAudioTrack);if((t==null?void 0:t.track)instanceof Gi){if(t.track.trackList.length>0){const r=t.track;t.track.trackList.forEach((s=>{r.removeAudioTrack(s)}))}t.track.close()}this.localTrackMap.clear(),this.remoteUserMap.clear(),this.statsCollector.removeRemoteStats(),this.statsCollector.removeLocalStats(),this.iceFailedCount=0,this.dtlsFailedCount=0,this.pendingLocalTracks=[],this.pendingRemoteTracks=[],this.localDataChannels=[],this.remoteDataChannelMap.clear(),this.pendingLocalDataChannels=[],this.pendingRemoteDataChannels=[],this.state=ar.Disconnected}getStats(){var t;return(t=this.connection)===null||t===void 0?void 0:t.getStats()}getRemoteVideoIsReady(t){var r;return((r=this.connection)===null||r===void 0?void 0:r.getRemoteVideoIsReady(t))||!1}getLocalAudioVolume(){const t=this.localTrackMap.get(Xe.LocalAudioTrack);if(t)return t.track.getVolumeLevel()}getLocalVideoSize(){const t=this.localTrackMap.get(Xe.LocalVideoTrack);if(t)return{width:t.track.videoWidth||0,height:t.track.videoHeight||0}}getEncoderConfig(t){const r=this.localTrackMap.get(t);return r&&r.track instanceof Nr||r&&r.track instanceof ui?r.track._encoderConfig:void 0}getLocalMedia(t){return this.localTrackMap.get(t)}hasLocalMedia(){return this.localTrackMap.size>0}hasRemoteMedia(t,r){if(!t)return this.remoteUserMap.size>0;const s=this.remoteUserMap.get(t);return!!s&&(!r||s.has(r))}async hasRemoteMediaWithLock(t,r){if(!t)return this.remoteUserMap.size>0;const s=this.remoteUserMap.get(t);return!!s&&(!r||s.has(r))}getRemoteMedia(t){var r;const s=Array.from(rc(r=this.remoteUserMap).call(r)).find((a=>a.uid===t));return s?{audioTrack:s.audioTrack,audioSSRC:s._audioSSRC,videoTrack:s.videoTrack,videoSSRC:s._videoSSRC}:{}}getAudioLevels(){let t=Array.from(this.remoteUserMap.entries()).map((s=>{let[a]=s;return{uid:a.uid,level:a.audioTrack?100*a.audioTrack._source.getAccurateVolumeLevel():0}}));const r=this.localTrackMap.get(Xe.LocalAudioTrack);return r&&t.push({level:100*r.track._source.getAccurateVolumeLevel(),uid:this.store.uid}),t=q_(t).call(t,((s,a)=>s.level-a.level)),t}async disconnectForReconnect(){this.connection&&(M.debug("[".concat(this.store.clientId,"] P2PChannel.disconnectForReconnect closing P2PConnection")),this.state=ar.Reconnecting,oe("KEEP_LAST_FRAME")&&this.remoteUserMap.size!==0&&Array.from(this.remoteUserMap.entries()).forEach((t=>{let[r]=t;var s;r._videoTrack&&r._videoTrack._player&&((s=r._videoTrack._player.getVideoElement())===null||s===void 0||s.pause(),r._videoTrack._player.isKeepLastFrame=!0,r._videoTrack._originMediaStreamTrack.stop())})),this.resetConnection(this.connection),this.connection=void 0,this.shouldForwardP2PCreation&&(this.connection=_P(this.store),this.emit(Mt.PeerConnectionStateChange,this.connection.peerConnectionState),this.bindConnectionEvents(this.connection)),this.localTrackMap.size!==0&&(Array.from(this.localTrackMap.entries()).forEach((t=>{var r;let[s,{track:a}]=t;switch(s){case Xe.LocalVideoTrack:rt(r=a._hints).call(r,Sr.LOW_STREAM)?a.close():this.pendingLocalTracks.push(a);break;case Xe.LocalAudioTrack:a instanceof Gi?this.pendingLocalTracks=this.pendingLocalTracks.concat(a.trackList):this.pendingLocalTracks.push(a);case Xe.LocalVideoLowTrack:}})),this.emit(Mt.MediaReconnectStart,this.store.uid)),this.unbindLocalTrackEvents(),this.localTrackMap.clear(),this.remoteUserMap.size!==0&&Array.from(this.remoteUserMap.entries()).forEach((t=>{let[r,s]=t;Array.from(rc(s).call(s)).forEach((a=>{this.setPendingRemoteMedia(r,a)})),this.emit(Mt.MediaReconnectStart,r.uid)})),this.unbindAllRemoteTrackEvents(),this.remoteUserMap.clear(),this.localDataChannels.length!==0&&(this.localDataChannels.forEach((t=>{this.pendingLocalDataChannels.push(t)})),this.localDataChannels.length=0),this.remoteDataChannelMap.size!==0&&(Array.from(this.remoteDataChannelMap.entries()).forEach((t=>{let[r,s]=t;Array.from(rc(s).call(s)).forEach((a=>{this.setPendingRemoteDataChannel(r,a)}))})),this.remoteDataChannelMap.clear()),this.statsUploader.stopUploadOutboundStats(),this.statsUploader.stopUploadInboundStats(),this.statsUploader.stopUploadTransportStats(),M.debug("[".concat(this.store.clientId,"] P2PChannel disconnected, waiting to reconnect.")))}hasPendingRemoteDataChannel(t,r){for(const s of this.pendingRemoteDataChannels){const{user:a,id:c}=s;if((t instanceof lg?t.uid:t)===a.uid&&c===r)return!0}return!1}setPendingRemoteDataChannel(t,r){this.hasPendingRemoteDataChannel(t,r)||this.pendingRemoteDataChannels.push({user:t,id:r})}hasPendingRemoteMedia(t,r){for(const s of this.pendingRemoteTracks){const{user:a,kind:c}=s;if((t instanceof lg?t.uid:t)===a.uid&&r===c)return!0}return!1}setPendingRemoteMedia(t,r){this.hasPendingRemoteMedia(t,r)||this.pendingRemoteTracks.push({user:t,kind:r})}restartICE(t){var r=this;return Ql((function*(){if(!r.connection||r.state!==ar.Connected)return;const s=yield zn(r.mutex.lock("From P2PChannel.restartICE"));let a;try{a=yield zn(r.connection.restartICE(t));const d=yield zn(a.next());if(d.done)return;const h=d.value,m=yield h;switch(pM(r.connection)&&r.reportPCStats(Date.now(),!1,r._pcStatsUploadType),t){case co.UDP_TCP_RELAY:r._pcStatsUploadType=Tf.UDP_TCP_RESTART;break;case co.TCP_RELAY:r._pcStatsUploadType=Tf.TCP_RESTART;break;case co.RELAY:r._pcStatsUploadType=Tf.RELAY_RESTART;break;default:r._pcStatsUploadType=Tf.OLD_RESTART}r._isTryConnecting=!0,a.next(m)}catch(d){var c;(c=a)===null||c===void 0||c.throw(d)}finally{s()}}))()}getUplinkNetworkQuality(){if(!this.connection)return 0;const t=this.connection.getStats(),r=this.localTrackMap.get(Xe.LocalVideoTrack),s=this.localTrackMap.get(Xe.LocalAudioTrack),a=t.videoSend.find((N=>N.ssrc===(r==null?void 0:r.ssrcs[0].ssrcId))),c=t.audioSend.find((N=>N.ssrc===(s==null?void 0:s.ssrcs[0].ssrcId)));if(!a||!c)return 1;const d=al(this,Mt.NeedSignalRTT),h=a?a.rttMs:void 0,m=c?c.rttMs:void 0,g=h&&m?(h+m)/2:h||m,v=(g&&d?(g+d)/2:g||d)||0,w=100*t.sendPacketLossRate*.7/50+.3*v/1500,I=w<.17?1:w<.36?2:w<.59?3:w<.1?4:5,A=r==null?void 0:r.track;if(A&&A._encoderConfig&&A._hints.indexOf(Sr.SCREEN_TRACK)===-1){const N=A._encoderConfig.bitrateMax,H=t.bitrate.actualEncoded;if(N&&H){const B=(1e3*N-H)/(1e3*N);return l7[B<.15?0:B<.3?1:B<.45?2:B<.6?3:4][I]}}return I}getDownlinkNetworkQuality(){if(!this.connection)return 0;const t=this.connection.getStats();let r=0;return Array.from(this.remoteUserMap.entries()).forEach((s=>{let[a]=s;const c=a._audioSSRC,d=a._videoSSRC,h=t.audioRecv.find((H=>H.ssrc===c)),m=t.videoRecv.find((H=>H.ssrc===d));if(!h&&!m)return void(r+=1);const g=al(this,Mt.NeedSignalRTT),v=t.rtt,w=(v&&g?(v+g)/2:v||g)||0,I=h?h.jitterMs:void 0,A=t.recvPacketLossRate;let N=.7*A*100/50+.3*w/1500;I&&(N=.6*A*100/50+.2*w/1500+.2*I/400),r+=N<.1?1:N<.17?2:N<.36?3:N<.59?4:5})),this.remoteUserMap.size>0?Math.round(r/this.remoteUserMap.size):r}async muteLocalTrack(t){return new mt(((r,s)=>{this.handleMuteLocalTrack(t,r,s)}))}async replaceTrack(t,r){var s;if(M.debug("[".concat(this.store.clientId,"] P2PChannel replaceTrack from [").concat(t.getTrackId(),"] to [").concat(r.getTrackId(),"]")),!this.connection||this.state!==ar.Connected)return;const a=Array.from(this.localTrackMap.entries()).find((d=>{let[,{track:h}]=d;return t===h}));if(!a)return;const c=a[0];if(t!==r&&(this.unbindLocalTrackEvents([{track:t,type:c}]),this.bindLocalTrackEvents([{track:r,type:c}]),a[1].track=r),await((s=this.connection)===null||s===void 0?void 0:s.replaceTrack(r,a[1].id)),this.isPlanB){const d=a[1];d.id=r._mediaStreamTrack.id,this.localTrackMap.set(c,d)}if(c===Xe.LocalVideoTrack&&!oe("DISABLE_DUAL_STREAM_USE_ENCODING")&&Wn().supportDualStreamEncoding){const d=this.localTrackMap.get(Xe.LocalVideoLowTrack);if(d){const h=t._mediaStreamTrack.clone();d.track._originMediaStreamTrack.stop(),d.track._mediaStreamTrack=h,d.track._originMediaStreamTrack=h,await new mt(((m,g)=>{this.handleReplaceTrack(d.track,m,g,!0)}))}}}filterTobePublishedTracks(t,r,s){const a=[],c=this.getAllTracks();t=t0(t=t.filter((g=>c.indexOf(g)===-1)));let d,h=!1;const m=this.localTrackMap.get(Xe.LocalAudioTrack);for(const g of t){if(g instanceof Nr&&(this.localTrackMap.has(Xe.LocalVideoTrack)||h?new Le(te.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS).throw():(a.push({track:g,type:Xe.LocalVideoTrack}),h=!0),r)){const v=this.getLowVideoTrack(g,s);a.push({track:v,type:Xe.LocalVideoLowTrack})}if(g instanceof ui)if(m){const v=m.track;if(v instanceof Gi)dM([g]),v.addAudioTrack(g),this.bindLocalAudioTrackEvents(g,!0);else{const w=hM([v,g]);M.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection will replace audioTrack [").concat(w.getTrackId(),"]")),this.replaceTrack(v,w)}}else d instanceof Gi?(dM([g]),d.addAudioTrack(g)):d||!g._useAudioElement&&Wn().webAudioMediaStreamDest&&!g._bypassWebAudio?d=hM(d?[g,d]:[g]):d=g}return d&&(M.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection will send audioTrack [").concat(d.getTrackId(),"]")),a.push({track:d,type:Xe.LocalAudioTrack})),a}filterTobeUnpublishedTracks(t){const r=[],s=this.getAllTracks();t=t0(t=t.filter((a=>s.indexOf(a)!==-1)));for(const a of t){if(a instanceof ui){const c=this.localTrackMap.get(Xe.LocalAudioTrack);if(!c)continue;c.track instanceof Gi?(c.track.removeAudioTrack(a),this.unbindLocalAudioTrackEvents(a),c.track.trackList.length===0&&(r.push([Xe.LocalAudioTrack,c]),c.track.close())):r.push([Xe.LocalAudioTrack,c])}if(a instanceof Nr){const c=this.localTrackMap.get(Xe.LocalVideoTrack);if(!c)continue;r.push([Xe.LocalVideoTrack,c]);const d=this.localTrackMap.get(Xe.LocalVideoLowTrack);d&&r.push([Xe.LocalVideoLowTrack,d])}}return r}filterTobePublishedDataChannels(t){return t=(t=t0(t)).filter((r=>this.localDataChannels.findIndex((s=>s.id===r.id))===-1))}filterTobeUnpublishedDataChannels(t){return t=(t=(t=t0(t)).filter((r=>this.localDataChannels.indexOf(r)!==-1))).filter((r=>r._originDataChannel))}bindLocalTrackEvents(t){t.forEach((r=>{let{track:s,type:a}=r;switch(a){case Xe.LocalVideoTrack:s.addListener(Tt.GET_STATS,this.handleGetLocalVideoStats),s.addListener(Tt.GET_RTC_STATS,this.handleGetRTCStats),s.addListener(Tt.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),s.addListener(Tt.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),s.addListener(Tt.NEED_UPDATE_VIDEO_ENCODER,this.handleUpdateVideoEncoder),s.addListener(Tt.NEED_UPDATE_VIDEO_SEND_PARAMETERS,this.handleUpdateVideoSendParameters),s.addListener(Tt.NEED_REPLACE_TRACK,this.handleReplaceTrack),s.addListener(Tt.NEED_MUTE_TRACK,this.handleMuteLocalTrack),s.addListener(Tt.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack);break;case Xe.LocalAudioTrack:this.bindLocalAudioTrackEvents(s);case Xe.LocalVideoLowTrack:}}))}bindLocalAudioTrackEvents(t,r){t instanceof Gi?t.trackList.forEach((s=>{s.addListener(Tt.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),s.addListener(Tt.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),s.addListener(Tt.GET_STATS,this.handleGetLocalAudioStats),s.addListener(Tt.NEED_MUTE_TRACK,this.handleMuteLocalTrack),s.addListener(Tt.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack)})):(t.addListener(Tt.GET_STATS,this.handleGetLocalAudioStats),t.addListener(Tt.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),t.addListener(Tt.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),t.addListener(Tt.NEED_MUTE_TRACK,this.handleMuteLocalTrack),t.addListener(Tt.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack),r||(t.addListener(Tt.NEED_REPLACE_TRACK,this.handleReplaceTrack),t.addListener(Tt.NEED_REPLACE_MIXING_TRACK,this.handleReplaceMixingTrack)))}unbindLocalTrackEvents(t){t||(t=Array.from(this.localTrackMap.entries()).map((r=>{let[s,{track:a}]=r;return{track:a,type:s}}))),t.forEach((r=>{let{track:s,type:a}=r;switch(a){case Xe.LocalVideoTrack:s.off(Tt.GET_STATS,this.handleGetLocalVideoStats),s.off(Tt.GET_RTC_STATS,this.handleGetRTCStats),s.off(Tt.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),s.off(Tt.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),s.off(Tt.NEED_UPDATE_VIDEO_ENCODER,this.handleUpdateVideoEncoder),s.off(Tt.NEED_UPDATE_VIDEO_SEND_PARAMETERS,this.handleUpdateVideoSendParameters),s.off(Tt.NEED_REPLACE_TRACK,this.handleReplaceTrack),s.off(Tt.NEED_MUTE_TRACK,this.handleMuteLocalTrack),s.off(Tt.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack);break;case Xe.LocalAudioTrack:this.unbindLocalAudioTrackEvents(s);case Xe.LocalVideoLowTrack:}}))}unbindLocalAudioTrackEvents(t){t instanceof Gi?t.trackList.forEach((r=>{r.off(Tt.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),r.off(Tt.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),r.off(Tt.GET_STATS,this.handleGetLocalAudioStats),r.off(Tt.NEED_MUTE_TRACK,this.handleMuteLocalTrack),r.off(Tt.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack)})):(t.off(Tt.GET_STATS,this.handleGetLocalAudioStats),t.off(Tt.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),t.off(Tt.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),t.off(Tt.NEED_REPLACE_TRACK,this.handleReplaceTrack),t.off(Tt.NEED_REPLACE_MIXING_TRACK,this.handleReplaceMixingTrack),t.off(Tt.NEED_MUTE_TRACK,this.handleMuteLocalTrack),t.off(Tt.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack))}bindRemoteTrackEvents(t,r){r instanceof f0&&r.addListener(Tt.GET_STATS,(s=>{s(this.handleGetRemoteVideoStats(t))})),r instanceof m0&&r.addListener(Tt.GET_STATS,(s=>{s(this.handleGetRemoteAudioStats(t))}))}unbindRemoteTrackEvents(t){t&&t.removeAllListeners(Tt.GET_STATS)}unbindAllRemoteTrackEvents(){Array.from(this.remoteUserMap.entries()).forEach((t=>{let[r,s]=t;s.has(St.AUDIO)&&this.unbindRemoteTrackEvents(r._audioTrack),s.has(St.VIDEO)&&this.unbindRemoteTrackEvents(r._videoTrack)}))}createGatewayPublishMessage(t,r){return t.map(((s,a)=>{var c;let d,h,{track:m,type:g}=s;switch(g){case Xe.LocalAudioTrack:d=lr.Audio,h={dtx:m instanceof _T&&m._config.DTX,hq:!1,lq:!1,stereo:!1,speech:!1};break;case Xe.LocalVideoTrack:d=rt(c=m._hints).call(c,Sr.SCREEN_TRACK)?lr.Screen:lr.High,h=hp(hp({},C7(m)),{},{codec:this.store.codec,svc_mode:rP()});break;case Xe.LocalVideoLowTrack:d=lr.Low,h=hp(hp({},C7(m)),{},{codec:this.store.codec,svc_mode:rP()})}return{stream_type:d,attributes:h,ssrcs:r[a]}}))}createGatewayUnpublishMessage(t){return t.map((r=>{var s;let a,[c,{track:d,ssrcs:h,id:m}]=r;switch(c){case Xe.LocalVideoTrack:a=rt(s=d._hints).call(s,Sr.SCREEN_TRACK)?lr.Screen:lr.High;break;case Xe.LocalAudioTrack:a=lr.Audio;break;case Xe.LocalVideoLowTrack:a=lr.Low}return{stream_type:a,ssrcs:h,mid:m}}))}assignLocalTracks(t,r){t.forEach(((s,a)=>{let{track:c,type:d}=s;this.localTrackMap.set(d,{track:c,id:r[a].id,ssrcs:r[a].localSSRC})}))}withdrawLocalTracks(t){t.forEach((r=>{let[s]=r;this.localTrackMap.delete(s)}))}bindConnectionEvents(t){t.onConnectionStateChange=async r=>{if(M.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onConnectionStateChange(").concat(r,")")),this.emit(Mt.PeerConnectionStateChange,r),r==="connecting"&&t instanceof iu&&!ii()&&oe("FIRST_TCP_CANDIDATE")&&window.setTimeout((()=>{r==="connecting"&&t.extendCandidate()}),oe("FIRST_TCP_CANDIDATE_INTERVAL")),r!=="connected"||this.store.keyMetrics.peerConnectionEnd||this.store.peerConnectionEnd(),r==="connected"&&(this._restartTimer&&(window.clearTimeout(this._restartTimer),this._restartTimer=void 0),t instanceof iu&&vH(t,!0),this._isTryConnecting&&this.reportPCStats(Date.now(),!0,this._pcStatsUploadType),this._isTryConnecting=!1,this._isStartRestartIce=!1,this._pcStatsUploadType=Tf.DISCONNECTED_OR_FAILED,al(this,Mt.QueryClientConnectionState)==="CONNECTED"&&this._isWaitPcToRePub)){const s=this.pendingLocalTracks.map((c=>c.getTrackId())),a=this.pendingLocalDataChannels.map((c=>"dc_".concat(c.id)));It.reportApiInvoke(this.store.sessionId,{name:pi.REPUB_AFTER_PC_CONNECTED,options:s.concat(a),tag:$r.TRACER}).onSuccess(),this.republish()}if(oe("NEW_ICE_RESTART")&&t instanceof iu&&!ii()&&!this._forceTurn){if(rt(E7).call(E7,r)){if(this._isStartRestartIce)return;this._isStartRestartIce=!0;const s=c=>{pM(t)&&(M.debug("[".concat(this.store.clientId,"] [P2PChannel] try to restartICE, type is ").concat(c)),al(this,Mt.QueryClientConnectionState)==="CONNECTED"&&this.emit(Mt.RequestRestartICE,c))},a=()=>{pM(t)&&(this.reportPCStats(Date.now(),!1,this._pcStatsUploadType),M.debug("[".concat(this.store.clientId,"] P2PConnection disconnected timeout, force reconnect")),setTimeout((()=>this.emit(Mt.P2PLost)),0),this.iceFailedCount+=1,this.requestReconnect())};return void(this._restartTimer=window.setTimeout((()=>{SH(t,s,a)}),800))}}else{if(r==="disconnected"&&t.iceConnectionState==="disconnected")return setTimeout((()=>{t.iceConnectionState==="disconnected"&&oe("ICE_RESTART")&&al(this,Mt.QueryClientConnectionState)==="CONNECTED"&&this.emit(Mt.RequestRestartICE)}),800),void setTimeout((()=>{t.peerConnectionState==="disconnected"&&(M.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection disconnected timeout 4000ms, force reconnect")),this.reportPCStats(Date.now(),!1,this._pcStatsUploadType),this._isTryConnecting=!1,setTimeout((()=>this.emit(Mt.P2PLost)),0),this.iceFailedCount+=1,this.requestReconnect())}),4e3);r==="failed"&&(M.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection state failed, force reconnect")),this.reportPCStats(Date.now(),!1,this._pcStatsUploadType),setTimeout((()=>this.emit(Mt.P2PLost)),0),this.iceFailedCount+=1,await this.requestReconnect())}},t.onICEConnectionStateChange=r=>{r!=="connected"||this.store.keyMetrics.iceConnectionEnd||this.store.iceConnectionEnd(),M.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICEConnectionStateChange(").concat(r,")")),It.reportApiInvoke(this.store.sessionId,{name:"ICEConnectionStateChange",options:r,tag:$r.TRACER}).onSuccess(),this.emit(Mt.IceConnectionStateChange,r)},t.onICETransportStateChange=r=>{M.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICETransportStateChange(").concat(r,")"))},t.onDTLSTransportStateChange=r=>{M.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onDTLSTransportStateChange(").concat(r,")"))},t.onDTLSTransportError=r=>{M.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onDTLSTransportError(").concat(r,")"))},t.onFirstAudioDecoded=r=>{var s;const a=Array.from(rc(s=this.remoteUserMap).call(s)).find((d=>d._audioSSRC===r));var c;a&&(this.store.subscribe(a.uid,"audio",void 0,void 0,void 0,Date.now()),(c=a.audioTrack)===null||c===void 0||c.emit(tu.FIRST_FRAME_DECODED),It.firstRemoteFrame(this.store.sessionId,es.FIRST_AUDIO_DECODE,Br.FIRST_AUDIO_DECODE,{peer:a._uintid,subscribeElapse:lo.measureFromSubscribeStart(this.store.clientId,r),subscribeRequestid:r,p2pid:this.store.p2pId}))},t.onFirstAudioReceived=r=>{var s;const a=Array.from(rc(s=this.remoteUserMap).call(s)).find((c=>c._audioSSRC===r));a&&It.firstRemoteFrame(this.store.sessionId,es.FIRST_AUDIO_RECEIVED,Br.FIRST_AUDIO_RECEIVED,{peer:a._uintid,subscribeElapse:lo.measureFromSubscribeStart(this.store.clientId,r),subscribeRequestid:r,p2pid:this.store.p2pId})},t.onFirstVideoDecoded=(r,s,a)=>{var c;const d=Array.from(rc(c=this.remoteUserMap).call(c)).find((h=>h._videoSSRC===r));d&&this.store.firstVideoFrameDecoded(d.uid,{firstDecoded:Date.now()}),this.reportVideoFirstFrameDecoded(r,s,a)},t.onFirstVideoRender=r=>{var s;const a=Array.from(rc(s=this.remoteUserMap).call(s)).find((c=>c._videoSSRC===r));a&&(this.store.firstVideoFrameDecoded(a.uid,{firstPreRender:Date.now()}),this.reportVideoFirstFrameRender(a))},t.onFirstVideoReceived=r=>{var s;const a=Array.from(rc(s=this.remoteUserMap).call(s)).find((c=>c._videoSSRC===r));a&&(this.store.firstVideoFrameDecoded(a.uid,{firstReceived:Date.now()}),It.firstRemoteFrame(this.store.sessionId,es.FIRST_VIDEO_RECEIVED,Br.FIRST_VIDEO_RECEIVED,{peer:a._uintid,subscribeElapse:lo.measureFromSubscribeStart(this.store.clientId,r),subscribeRequestid:r,p2pid:this.store.p2pId}))},t.onSelectedLocalCandidateChanged=(r,s)=>{const a=r.candidateType==="relay",c=s.candidateType==="relay";s.candidateType!=="unknown"&&a===c||this.emit(Mt.ConnectionTypeChange,a),M.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.SelectedLocalCandidateChanged(").concat(JSON.stringify(ig(s))," -> ").concat(JSON.stringify(ig(r)),")"))},t.onSelectedRemoteCandidateChanged=(r,s)=>{M.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.SelectedRemoteCandidateChanged(").concat(JSON.stringify(ig(s))," -> ").concat(JSON.stringify(ig(r)),")"))},t.onFirstVideoDecodedTimeout=r=>{this.reportVideoFirstFrameDecoded(r,void 0,void 0,!0)},t.getLocalVideoStats=()=>{const r=this.statsCollector.getLocalVideoTrackStats(),s=this.statsCollector.getRTCStats();return hp(hp({},r),s)},t.onICECandidateError=r=>{this._iceError=r}}resetConnection(t){t instanceof iu&&(function(r){A0.delete(r.id),vH(r)})(t),t.close(),this.emit(Mt.PeerConnectionStateChange,"closed"),(function(r){r.onConnectionStateChange=void 0,r.onICEConnectionStateChange=void 0,r.onICETransportStateChange=void 0,r.onDTLSTransportStateChange=void 0,r.onDTLSTransportError=void 0,r.onFirstAudioDecoded=void 0,r.onFirstAudioReceived=void 0,r.onFirstVideoDecoded=void 0,r.onFirstVideoReceived=void 0,r.onSelectedLocalCandidateChanged=void 0,r.onSelectedRemoteCandidateChanged=void 0,r.onFirstVideoDecodedTimeout=void 0,r.getLocalVideoStats=void 0})(t),this._isWaitPcToRePub=!1}filterTobeMutedTracks(t){const r=[];if(this.getAllTracks().indexOf(t)===-1)return r;const s=this.localTrackMap.get(Xe.LocalAudioTrack);if(t instanceof ui&&(s==null?void 0:s.track)instanceof Gi)return s.track.isActive||r.push([Xe.LocalAudioTrack,s]),r;const a=Array.from(this.localTrackMap.entries()).find((c=>{let[,{track:d}]=c;return t===d}));if(a&&(r.push(a),a[0]===Xe.LocalVideoTrack)){const c=this.localTrackMap.get(Xe.LocalVideoLowTrack);c&&r.push([Xe.LocalVideoLowTrack,c])}return r}filterTobeUnmutedTracks(t){const r=[],s=this.localTrackMap.get(Xe.LocalAudioTrack);if(t instanceof ui&&(s==null?void 0:s.track)instanceof Gi)return s.track.isActive&&r.push([Xe.LocalAudioTrack,s]),r;const a=Array.from(this.localTrackMap.entries()).find((c=>{let[,{track:d}]=c;return t===d}));if(a)if(a[0]===Xe.LocalVideoTrack){r.push(a);const c=this.localTrackMap.get(Xe.LocalVideoLowTrack);c&&r.push([Xe.LocalVideoLowTrack,c])}else r.push(a);return r}createMuteMessage(t){return t.map((r=>{var s;let a,[c,{track:d,ssrcs:h,id:m}]=r;switch(c){case Xe.LocalAudioTrack:a=lr.Audio;break;case Xe.LocalVideoTrack:a=rt(s=d._hints).call(s,Sr.SCREEN_TRACK)?lr.Screen:lr.High;break;case Xe.LocalVideoLowTrack:a=lr.Low}return{stream_type:a,ssrcs:h,mid:m}}))}createUnmuteMessage(t){return t.map((r=>{var s;let a,[c,{track:d,ssrcs:h,id:m}]=r;switch(c){case Xe.LocalAudioTrack:a=lr.Audio;break;case Xe.LocalVideoTrack:a=rt(s=d._hints).call(s,Sr.SCREEN_TRACK)?lr.Screen:lr.High;break;case Xe.LocalVideoLowTrack:a=lr.Low}return{stream_type:a,ssrcs:h,mid:m}}))}filterTobeUnSubscribedTracks(t,r){const s=[],a=this.remoteUserMap.get(t);if(!a)return s;if(r){const c=a.get(r);if(!c)return s;s.push([t,{kind:r,id:c}])}else Array.from(a.entries()).forEach((c=>{let[d,h]=c;s.push([t,{kind:d,id:h}])}));return s}filterTobeUnSubscribedDataChannels(t,r){const s=[];return r.forEach((a=>{var c;(c=this.remoteDataChannelMap.get(t))!==null&&c!==void 0&&c.has(a.id)&&s.push(a)})),s}createUnsubscribeMessage(t){const r=[];return t.forEach((s=>{let[a,{kind:c,id:d}]=s;switch(c){case St.VIDEO:return void(a._videoSSRC&&r.push({stream_type:St.VIDEO,ssrcId:a._videoSSRC}));case St.AUDIO:return void(a._audioSSRC&&r.push({stream_type:St.AUDIO,ssrcId:a._audioSSRC}))}})),r}createUnsubscribeAllMessage(t){const r=new Map;return t.forEach((s=>{let[a,{kind:c}]=s;if(r.has(a)){let d=r.get(a);c===St.VIDEO?d|=as.Video:d|=as.Audio,r.set(a,d)}else c===St.VIDEO?r.set(a,as.Video):r.set(a,as.Audio)})),{users:Array.from(r.entries()).map((s=>{let[a,c]=s;return{stream_id:a.uid,stream_type:c}}))}}withdrawRemoteTracks(t){t.forEach((r=>{let[s,{kind:a}]=r;const c=this.remoteUserMap.get(s);c&&(c.delete(a),Array.from(c.entries()).length===0&&this.remoteUserMap.delete(s))}))}async updateBitrateLimit(t){const r=this.localTrackMap.get(Xe.LocalVideoTrack),s=this.localTrackMap.get(Xe.LocalVideoLowTrack);r&&(await r.track.setBitrateLimit(t.uplink),await new mt(((a,c)=>{this.handleUpdateVideoEncoder(r.track,a,c,!0)}))),s&&t.low_stream_uplink&&(await s.track.setBitrateLimit({max_bitrate:t.low_stream_uplink.bitrate,min_bitrate:t.low_stream_uplink.bitrate||0}),await new mt(((a,c)=>{this.handleUpdateVideoEncoder(s.track,a,c,!0)})))}isP2PDisconnected(){return this.connection?this.connection.peerConnectionState!=="connected":!0}isPreallocation(){return this.connection instanceof iu&&this.connection.isPreallocation}isPreSub(){return this.connection instanceof iu&&this.connection.isPreSub()}mapPubResToRemoteConfig(t,r,s){return t.map(((a,c)=>{var d;let{stream_type:h}=a;const m=(d=r.find((g=>{let{stream_type:v}=g;return h===v})))===null||d===void 0?void 0:d.attributes;if(m&&oe("DISABLE_SCREEN_SHARE_REMB")){const g=s[c]._hints;(rt(g).call(g,Sr.SCREEN_TRACK)||rt(g).call(g,Sr.SCREEN_LOW_TRACK))&&(m.remb=!1,M.debug("disable remb for screen share, hints:",g))}return m}))}async tryToUnmuteAudio(t){for(let s=0;s<t.length;s++)if(t[s]instanceof ui){var r;const a=this.filterTobeUnmutedTracks(t[s]);if(a.length===0)continue;await((r=this.connection)===null||r===void 0?void 0:r.unmuteLocal(a.map((d=>{let[,{id:h}]=d;return h}))));const c=this.createUnmuteMessage(a);return void await wr(this,Mt.RequestUnmuteLocal,c)}}bindStatsUploaderEvents(){this.statsUploader.requestStats=()=>this.getStats(),this.statsUploader.requestLocalMedia=()=>Array.from(this.localTrackMap.entries()),this.statsUploader.requestRemoteMedia=()=>Array.from(this.remoteUserMap.entries()),this.statsUploader.requestVideoIsReady=t=>{var r;return!((r=this.connection)===null||r===void 0||!r.getRemoteVideoIsReady(t))},this.statsUploader.requestUpload=(t,r)=>this.emit(Mt.RequestUpload,t,r),this.statsUploader.requestUploadStats=t=>this.emit(Mt.RequestUploadStats,t),this.statsUploader.requestAllTracks=()=>this.getAllTracks(),this.statsUploader.requestTransportStats=()=>{var t;return{connectState:((t=this.connection)===null||t===void 0?void 0:t.peerConnectionState)||"closed"}}}unbindStatsUploaderEvents(){this.statsUploader.requestStats=void 0,this.statsUploader.requestLocalMedia=void 0,this.statsUploader.requestRemoteMedia=void 0,this.statsUploader.requestVideoIsReady=void 0}async requestReconnect(){this.dtlsFailedCount+=1,await Is(QL(this.dtlsFailedCount,Vi)),this.emit(Mt.RequestReconnect)}async reconnectP2P(){const t=Array.from(this.localTrackMap.entries()),r=this.createGatewayUnpublishMessage(t);Array.from(this.remoteUserMap.entries()),r.length>0&&await zs(this,Mt.RequestUnpublishForReconnectPC,r),this.disconnectForReconnect(),this.emit(Mt.RequestReconnectPC)}canPublishLowStream(){return this.localTrackMap.has(Xe.LocalVideoTrack)||this.pendingLocalTracks.some((t=>t instanceof Nr))}throwIfTrackTypeNotMatch(t){if(t.filter((r=>r instanceof Nr)).length>1)throw new Le(te.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS);if(t.filter((r=>r instanceof ui)).length>1&&(t.some((r=>r instanceof ui&&r._bypassWebAudio))||!Wn().webAudioMediaStreamDest))throw new Le(te.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser doesn't support MediaStreamDestNode");for(const r of t){if(r instanceof Nr&&this.pendingLocalTracks.some((s=>s instanceof Nr)))throw new Le(te.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS);if(r instanceof ui&&this.pendingLocalTracks.some((s=>s instanceof ui))&&(!Wn().webAudioMediaStreamDest||r._bypassWebAudio||this.pendingLocalTracks.some((s=>s instanceof ui&&s._bypassWebAudio))))throw new Le(te.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser doesn't support MediaStreamDestNode")}}getLowVideoTrack(t,r){var s;const a=!oe("DISABLE_DUAL_STREAM_USE_ENCODING")&&Wn().supportDualStreamEncoding,c=hp(hp({},{width:160,height:120,framerate:15,bitrate:50}),r);let d;d=a?t._mediaStreamTrack.clone():fM(t,c);const h=Tr(8,"track-low-"),m=new Nr(d,hp(hp({},a&&{scaleResolutionDownBy:q2(c,t)}),{},{frameRate:c.framerate,bitrateMax:c.bitrate,bitrateMin:c.bitrate}),void 0,void 0,h);return m.on(ay.TRANSCEIVER_UPDATED,(g=>{t._updateRtpTransceiver(g,c0.LOW_STREAM)})),m._hints.push(Sr.LOW_STREAM),rt(s=t._hints).call(s,Sr.SCREEN_TRACK)&&m._hints.push(Sr.SCREEN_LOW_TRACK),t.on("sei-to-send",(g=>{m.emit("sei-to-send",g)})),t.addListener(Tt.NEED_CLOSE,(()=>{m.close()})),m}async globalLock(){return this.mutex.lock("From P2PChannel.globalLock")}async reportPCStats(t,r,s){let a=arguments.length>3&&arguments[3]!==void 0?arguments[3]:null;if(this.connection&&this.connection instanceof iu){var c,d,h,m;const g=this.store.keyMetrics.descriptionStart||0,{iceConnectionState:v,dtlsTransportState:w,peerConnectionState:I}=this.connection,{local:A,remote:N}=await this.connection.getSelectedCandidatePair();It.pcStats(this.store.sessionId,{startTime:g,eventElapse:t-g||0,iceconnectionsate:v,dtlsstate:w,connectionstate:I,intSucc:r?1:2,error:this._iceError||a||"",selectedLocalCandidateProtocol:(c=A==null?void 0:A.protocol)!==null&&c!==void 0?c:"",selectedLocalCandidateType:(d=A.candidateType)!==null&&d!==void 0?d:"",selectedLocalCandidateAddress:"".concat(A.address,":").concat(A.port),selectedRemoteCandidateProtocol:(h=N.protocol)!==null&&h!==void 0?h:"",selectedRemoteCandidateType:(m=N.candidateType)!==null&&m!==void 0?m:"",selectedRemoteCandidateAddress:"".concat(N.address,":").concat(N.port),restartCnt:s,preallocation:this.connection.isPreallocation}),this._iceError=null}}reportVideoFirstFrameRender(t){const r=this.store.keyMetrics,s=r.firstVideoFrameDecoded.find((w=>w.userId===t.uid));if(!s)return;const{isInternalUpload:a,isExternalUpload:c}=s;if(a&&c)return;const{subscribeEnd:d,firstPreRender:h,peerPublishDuration:m,peerPubStatusMs:g}=s;let{firstRender:v=0}=s;if(d&&(v||h)&&m&&g){s.isInternalUpload=!0;const{playEnd:w}=s;w&&(s.isExternalUpload=!0);const{firstPreRender:I=0}=s;v=I||v;const A=t.videoTrack,N={peer:t._uintid,width:(A==null?void 0:A._videoWidth)||0,height:(A==null?void 0:A._videoHeight)||0,ssrc:t._videoSSRC||0,p2pid:this.store.p2pId,peerPublishDuration:m,peerPubStatusMs:g,joinChannelStart:r.joinStart||0,preloadStart:r.preloadStart||0,preloadEnd:r.preloadEnd||0,apStart:r.requestAPStart||0,apEnd:r.requestAPEnd||0,suaEnd:r.requestSUAEnd||0,beforeConnect:r.beforeConnect||0,peerReceiver:r.peerReceiver||0,ice:r.iceConnectionEnd||0,pc:r.peerConnectionEnd||0,signalConnected:r.signalConnected||0,joinReq:r.joinReq||0,joinRes:r.joinRep||0,userJoinNotify:s.userJoinNotify||0,videoAddNotify:s.videoAddNotify||0,subscribeStart:s.subscribeStart||0,subscribeEnd:s.subscribeEnd||0,firstReceived:s.firstReceived||0,firstDecoded:s.firstDecoded||0,firstPreRender:I||0,firstRender:w?Math.max(v,w):Math.max(v,d),playStart:s.playStart||0,playEnd:s.playEnd||0,isPreSub:!(!t._videoSSRC||!this.isPreSubScribe(t._videoSSRC)),isPrePc:this.isPreallocation(),isPreInstantVideo:Y9(this.store)};It.firstXLAPeerFirstVideoFrame(this.store.sessionId,N)}}reportVideoFirstFrameDecoded(t,r,s,a){var c;const d=Array.from(rc(c=this.remoteUserMap).call(c)).find((h=>h._videoSSRC===t));if(d){a||this.store.subscribe(d.uid,"video",void 0,void 0,void 0,void 0,Date.now());const h=this.store.keyMetrics,m=h.subscribe.find((g=>g.userId===d.uid&&g.type==="video"));It.firstRemoteVideoDecode(this.store.sessionId,es.FIRST_VIDEO_DECODE,Br.FIRST_VIDEO_DECODE,{peer:d._uintid,videowidth:r,videoheight:s,subscribeElapse:lo.measureFromSubscribeStart(this.store.clientId,t),subscribeRequestid:t,p2pid:this.store.p2pId,apEnd:h.requestAPEnd||0,apStart:h.requestAPStart||0,joinGwEnd:h.joinGatewayEnd||0,joinGwStart:h.joinGatewayStart||0,pcEnd:h.peerConnectionEnd||0,pcStart:h.peerConnectionStart||0,subscriberEnd:(m==null?void 0:m.subscribeEnd)||0,subscriberStart:(m==null?void 0:m.subscribeStart)||0,videoAddNotify:(m==null?void 0:m.streamAdded)||0,state:a?1:0,firstFrame:(m==null?void 0:m.firstFrame)||0})}}async remoteMediaSsrcChanged(t,r,s){if(!this.connection)return!1;const a=this.remoteUserMap.get(t);if(!a)return!1;const c=a.get(r);if(!c)return!1;const d=await this.connection.getRemoteSSRC(c);return d!==void 0&&d!==s}unbindRtpTransceiver(){this.localTrackMap.size!==0&&Array.from(this.localTrackMap.entries()).forEach((t=>{let[r,{track:s}]=t;r===Xe.LocalVideoLowTrack?s._updateRtpTransceiver(void 0,c0.LOW_STREAM):s._updateRtpTransceiver(void 0)}))}},Rt(In.prototype,"startP2PConnection",[Wo],Object.getOwnPropertyDescriptor(In.prototype,"startP2PConnection"),In.prototype),Rt(In.prototype,"connect",[Wo],Object.getOwnPropertyDescriptor(In.prototype,"connect"),In.prototype),Rt(In.prototype,"updateRemoteRTPCapabilities",[Wo],Object.getOwnPropertyDescriptor(In.prototype,"updateRemoteRTPCapabilities"),In.prototype),Rt(In.prototype,"publishDataChannel",[Wo],Object.getOwnPropertyDescriptor(In.prototype,"publishDataChannel"),In.prototype),Rt(In.prototype,"unpublish",[Wo],Object.getOwnPropertyDescriptor(In.prototype,"unpublish"),In.prototype),Rt(In.prototype,"unpublishDataChannel",[Wo],Object.getOwnPropertyDescriptor(In.prototype,"unpublishDataChannel"),In.prototype),Rt(In.prototype,"unpublishLowStream",[Wo],Object.getOwnPropertyDescriptor(In.prototype,"unpublishLowStream"),In.prototype),Rt(In.prototype,"subscribeDataChannel",[Wo],Object.getOwnPropertyDescriptor(In.prototype,"subscribeDataChannel"),In.prototype),Rt(In.prototype,"subscribe",[Wo],Object.getOwnPropertyDescriptor(In.prototype,"subscribe"),In.prototype),Rt(In.prototype,"massSubscribe",[Wo],Object.getOwnPropertyDescriptor(In.prototype,"massSubscribe"),In.prototype),Rt(In.prototype,"unsubscribe",[Wo],Object.getOwnPropertyDescriptor(In.prototype,"unsubscribe"),In.prototype),Rt(In.prototype,"unsubscribeDataChannel",[Wo],Object.getOwnPropertyDescriptor(In.prototype,"unsubscribeDataChannel"),In.prototype),Rt(In.prototype,"massUnsubscribe",[Wo],Object.getOwnPropertyDescriptor(In.prototype,"massUnsubscribe"),In.prototype),Rt(In.prototype,"muteRemote",[Wo],Object.getOwnPropertyDescriptor(In.prototype,"muteRemote"),In.prototype),Rt(In.prototype,"unmuteRemote",[Wo],Object.getOwnPropertyDescriptor(In.prototype,"unmuteRemote"),In.prototype),Rt(In.prototype,"hasRemoteMediaWithLock",[Wo],Object.getOwnPropertyDescriptor(In.prototype,"hasRemoteMediaWithLock"),In.prototype),Rt(In.prototype,"disconnectForReconnect",[Wo],Object.getOwnPropertyDescriptor(In.prototype,"disconnectForReconnect"),In.prototype),Rt(In.prototype,"updateBitrateLimit",[Wo],Object.getOwnPropertyDescriptor(In.prototype,"updateBitrateLimit"),In.prototype),Rt(In.prototype,"remoteMediaSsrcChanged",[Wo],Object.getOwnPropertyDescriptor(In.prototype,"remoteMediaSsrcChanged"),In.prototype),In);function Wo(t,r,s){const a=t[r];if(typeof a!="function")throw new Error("Cannot use mutex on object property.");return s.value=async function(){const c=this.mutex,d=await c.lock("From P2PChannel.".concat(r));try{for(var h=arguments.length,m=new Array(h),g=0;g<h;g++)m[g]=arguments[g];return await a.apply(this,m)}finally{d()}},s}function TH(t,r){var s=Object.keys(t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);r&&(a=a.filter((function(c){return Object.getOwnPropertyDescriptor(t,c).enumerable}))),s.push.apply(s,a)}return s}function CH(t){for(var r=1;r<arguments.length;r++){var s=arguments[r]!=null?arguments[r]:{};r%2?TH(Object(s),!0).forEach((function(a){X(t,a,s[a])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(s)):TH(Object(s)).forEach((function(a){Object.defineProperty(t,a,Object.getOwnPropertyDescriptor(s,a))}))}return t}const M_e=Date.now(),U_e=20,gM=new Map,bP=new Map;async function RH(t){const r=gM.get(t),s=Array.isArray(r)&&r[r.length-1],a=bP.get(t);if(!s)return void(a.isSyncing=!1);const c={uid:s.uid,payload:s.payload};a.firstRecvTs===0&&(a.firstRecvTs=s.recvTs,a.firstSendTs=s.sendTs);const d=s.sendTs-a.firstSendTs,h=d-(Date.now()-a.firstRecvTs);h>0&&(a.firstRecvTs=Date.now()-d);let m=s.mediaDelay+h;m<=0?(r.pop(),IH(s.context,c),m=0):m=Math.min(m,U_e),setTimeout((()=>r.length&&RH(t)),m)}function IH(t,r){t.safeEmit(Pn.STREAM_MESSAGE,r.uid,r.payload),t.onStreamMessage&&t.onStreamMessage(r)}function V_e(t){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,s=arguments.length>2?arguments[2]:void 0;if(!t.syncWithAudio)return IH(s,{uid:t.uid,payload:t.payload});const a="".concat(s.id,"-").concat(t.uid),c=gM.get(a)||[],d=c.findIndex((v=>t.sendTs>=v.sendTs)),h=CH(CH({},t),{},{context:s,mediaDelay:r,recvTs:Date.now()});d===-1?c.push(h):c.splice(d,0,h),gM.set(a,c);let m=!1;var g;bP.has(a)?m=!((g=bP.get(a))===null||g===void 0||!g.isSyncing):bP.set(a,{isSyncing:m,firstRecvTs:0,firstSendTs:0}),m||RH(a)}const j_e=Mn().name;function AH(t,r){var s=Object.keys(t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);r&&(a=a.filter((function(c){return Object.getOwnPropertyDescriptor(t,c).enumerable}))),s.push.apply(s,a)}return s}function PH(t){for(var r=1;r<arguments.length;r++){var s=arguments[r]!=null?arguments[r]:{};r%2?AH(Object(s),!0).forEach((function(a){X(t,a,s[a])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(s)):AH(Object(s)).forEach((function(a){Object.defineProperty(t,a,Object.getOwnPropertyDescriptor(s,a))}))}return t}const P0="websdk_ng_cache_parameter",F_e=oe("MAX_PRELOAD_ASYNC_LENGTH"),B_e=1e4,_y=new Map,yy=[];let _M=null,yM=0,EM=0;const wP=new Map,z_e=(function(t,r){const s=[];let a=0;const c=async()=>{const d=s.shift();d&&await d(),s.length>0&&a<r?c():a--};return async function(){for(var d=arguments.length,h=new Array(d),m=0;m<d;m++)h[m]=arguments[m];return new mt((async(g,v)=>{s.push((async()=>{try{const w=await t(...h);g(w)}catch(w){v(w)}})),a<r&&(a++,c())}))}})(OH,F_e),vM=Na.CancelToken.source();async function OH(t,r,s,a,c,d){try{if(!oe("ENABLE_PRELOAD"))return;if(!Wn().supportWebCrypto)return void Jm((()=>{M.warn("Your browser does not support preloading, this feature  be run in a secure environment")}),"preload_webcrypto_not_supported");if(!s&&s!==null)throw new Le(te.INVALID_PARAMS,"Invalid token: ".concat(s,". If you don not use token, set it to null"));s&&Rs(s,"token",1,2047),Rs(t,"appid",1,2047),J1(r),a&&Q1(a);const h=sy();M.debug("preload channel ".concat(r,", uid is ").concat(a));const m={appId:t,cname:r,token:s||t,uid:typeof a!="string"?a:null,sid:h,proxyServer:c};let g,v;typeof a=="string"?(m.stringUid=a,[v,g]=await mt.all([C_e(a,{sid:h,appId:t},vM.token),nH(PH(PH({},m),{},{token:s||t,uid:0}),vM.token)]),m.uid=v.uid,g.gatewayInfo.uid=m.uid,g.gatewayInfo.res.uid=m.uid):(d&&(m.stringUid=d),g=await nH(m,vM.token));const w={sid:h,appId:t,cname:r,token:s||t,uid:m.stringUid||a,intUid:m.uid||g.gatewayInfo.uid,stringUid:m.stringUid,ts:Date.now(),sua:v,ap:g};await(async function(I){let A;try{I.uid&&NH({appId:I.appId,cname:I.cname,token:I.token,uid:I.uid,stringUid:I.stringUid});const N=MH(I),H=await(async function(z,ee){try{const Z=await window.crypto.subtle.importKey("raw",b9(ee),"AES-GCM",!1,["encrypt"]),ae=await window.crypto.subtle.encrypt({name:"AES-GCM",iv:new Uint8Array(1)},Z,iy(window.btoa(JSON.stringify(z))));return Qm(new Uint8Array(ae))}catch{return}})(I,I.token||I.appId);if(!H)return;A=LH(P0);const B=A?JSON.parse(A):[];B.push({[N]:H}),B.length>oe("AP_CACHE_NUM")&&B.shift(),TP(P0,JSON.stringify(B))}catch(N){M.warn("Error caching server parameters:",N.message),TP(P0,"")}})(w),yM++}catch(h){throw EM++,(function(m){_M||(_M=window.setTimeout((()=>{let v="";wP.forEach(((w,I)=>{v+="".concat(I,": ").concat(w," ;")})),It.reportApiInvoke(null,{name:pi.PRELOAD,options:{success:yM,failed:EM,err:v}}).onError(m),yM=0,EM=0,wP.clear(),_M=null}),B_e));const g=wP.get(m.code)||0;wP.set(m.code,g+1)})(h),h}}async function kH(t){try{if(oe("AP_REQUEST_DETAIL")||oe("ENABLE_ROLE_SELECT_EDGE"))return;const r=NH(t);if(!r||t.cloudProxyServer!=="disabled")return;const s=await(async function(a,c){try{const d=await window.crypto.subtle.importKey("raw",b9(c),"AES-GCM",!1,["decrypt"]),h=await window.crypto.subtle.decrypt({name:"AES-GCM",iv:new Uint8Array(1)},d,iy(a));return JSON.parse(window.atob(Qm(new Uint8Array(h))))}catch{return}})(r,t.token||t.appId);if(!s||!(function(a,c){return a.cname===c.cname&&a.appId===c.appId&&a.token===c.token?c.stringUid?a.stringUid===c.stringUid:typeof c.uid=="number"?a.uid===c.uid:a.uid==c.uid:!1})(s,t))return;if(s&&Date.now()-s.ts<oe("AP_CACHE_LIFETIME"))return s}catch(r){M.warn("Error get preloadInfo",r.message)}}function NH(t){let r;try{if(r=LH(P0),!r)return;const s=JSON.parse(r),a=MH(t),c=(function(h,m){for(let g=h.length-1;g>=0;g--)if(m(h[g]))return g;return-1})(s,(h=>a in h));if(c===-1)return;const d=s.splice(c,1)[0];return TP(P0,JSON.stringify(s)),d[a]}catch(s){M.warn("Error delete preload info: ".concat(r),s.message),TP(P0,"")}}function SM(t){if(t){let r=_y.get(t);r&&(window.clearTimeout(r),r=null,_y.delete(t)),rt(yy).call(yy,t)||t.cloudProxyServer!=="disabled"||yy.push(t)}if(_y.size<oe("AP_CACHE_NUM")&&yy.length>0){const r=yy.shift();_y.set(r,window.setTimeout((async()=>{const{appId:s,cname:a,token:c,stringUid:d,uid:h,proxyServer:m}=r;try{await z_e(s,a,c,h,m,d),_y.has(r)&&SM(r)}catch(g){M.warn("update preload failed",g.message),xH(r)}}),oe("AP_UPDATE_INTERVAL")))}}function xH(t){const r=yy.indexOf(t);r!==-1&&yy.splice(r,1);let s=_y.get(t);s&&(window.clearTimeout(s),s=null,_y.delete(t),SM())}function DH(t,r){const s=t.sua,a=t.ap;r&&s&&It.reqUserAccount(t.sid,{lts:s.requestTime,elapse:s.elapse,success:!0,serverAddr:s.url,stringUid:r,uid:t.intUid,errorCode:null,extend:s.req}),It.reportResourceTiming(t.ap.url,t.sid),It.joinWebProxyAP(t.sid,{lts:a.requestTime,elapse:a.elapse,sucess:1,apServerAddr:a.url,turnServerAddrList:a.proxyInfo.addresses.map((c=>c.ip)).join(","),eventType:"disabled",unilbsServerIds:[Pi.CHOOSE_SERVER,Pi.CLOUD_PROXY_FALLBACK].toString()}),It.joinChooseServer(t.sid,{lts:a.requestTime,elapse:a.elapse,succ:!0,csAddr:a.url,opid:a.opid,serverList:a.gatewayInfo.gatewayAddrs.map((c=>c.address)),ec:null,cid:a.gatewayInfo.cid.toString(),uid:a.gatewayInfo.uid.toString(),csIp:a.gatewayInfo.csIp,unilbsServerIds:[Pi.CHOOSE_SERVER].toString(),isHttp3:a.isHttp3})}function LH(t){return window.atob(window.localStorage.getItem(t)||"")}function TP(t,r){window.localStorage.setItem(t,window.btoa(r))}function MH(t){let r="".concat(t.appId,"_").concat(t.cname);return typeof t.uid=="string"&&(r+="_s_".concat(t.uid)),typeof t.uid=="number"&&(r+="_".concat(t.uid)),t.token&&(r+="_".concat(t.token)),P9(r)}function W_e(t){let r=(function(){const s=$_e.pop();return s?(s.offset=s.limit=0,s):{bytes:new Uint8Array(64),offset:0,limit:0}})();return(function(s,a){let c=s.appId;c!==void 0&&(Oi(a,10),dg(a,c));let d=s.cid;d!==void 0&&(Oi(a,16),Oi(a,d));let h=s.cname;h!==void 0&&(Oi(a,26),dg(a,h));let m=s.deviceId;m!==void 0&&(Oi(a,34),dg(a,m));let g=s.elapse;g!==void 0&&(Oi(a,40),hg(a,g));let v=s.fileSize;v!==void 0&&(Oi(a,48),hg(a,O0(v)));let w=s.height;w!==void 0&&(Oi(a,56),hg(a,O0(w)));let I=s.jpg;I!==void 0&&(Oi(a,66),Oi(a,I.length),VH(a,I));let A=s.networkType;A!==void 0&&(Oi(a,72),hg(a,O0(A)));let N=s.osType;N!==void 0&&(Oi(a,80),hg(a,O0(N)));let H=s.requestId;H!==void 0&&(Oi(a,90),dg(a,H));let B=s.sdkVersion;B!==void 0&&(Oi(a,98),dg(a,B));let z=s.sequence;z!==void 0&&(Oi(a,104),hg(a,O0(z)));let ee=s.sid;ee!==void 0&&(Oi(a,114),dg(a,ee));let Z=s.timestamp;Z!==void 0&&(Oi(a,120),hg(a,Z));let ae=s.uid;ae!==void 0&&(Oi(a,128),Oi(a,ae));let ye=s.vid;ye!==void 0&&(Oi(a,136),Oi(a,ye));let _e=s.width;_e!==void 0&&(Oi(a,144),hg(a,O0(_e)));let ue=s.service;ue!==void 0&&(Oi(a,152),Oi(a,ue));let Ae=s.callbackData;Ae!==void 0&&(Oi(a,162),Oi(a,Ae.length),VH(a,Ae));let Ue=s.ticket;Ue!==void 0&&(Oi(a,170),dg(a,Ue));let We=s.vendorConfigs;We!==void 0&&(Oi(a,178),dg(a,We))})(t,r),(function(s){let a=s.bytes,c=s.limit;return a.length===c?a:a.subarray(0,c)})(r)}function G_e(t){return(function(s){let a={};e:for(;!K_e(s);){let c=NT(s);switch(c>>>3){case 0:break e;case 1:a.code=NT(s);break;case 2:a.msg=jH(s,NT(s));break;case 3:a.requestId=jH(s,NT(s));break;case 4:a.timestamp=q_e(s,!1);break;default:H_e(s,7&c)}}return a})({bytes:r=t,offset:0,limit:r.length});var r}function H_e(t,r){switch(r){case 0:for(;128&Zu(t););break;case 2:bM(t,NT(t));break;case 5:bM(t,4);break;case 1:bM(t,8);break;default:throw new Error("Unimplemented type: "+r)}}function O0(t){return{low:t|=0,high:t>>31,unsigned:t>=0}}let $_e=[];function bM(t,r){if(t.offset+r>t.limit)throw new Error("Skip past limit");t.offset+=r}function K_e(t){return t.offset>=t.limit}function CP(t,r){let s=t.bytes,a=t.offset,c=t.limit,d=a+r;if(d>s.length){let h=new Uint8Array(2*d);h.set(s),t.bytes=h}return t.offset=d,d>c&&(t.limit=d),a}function UH(t,r){let s=t.offset;if(s+r>t.limit)throw new Error("Read past limit");return t.offset+=r,s}function VH(t,r){let s=CP(t,r.length);t.bytes.set(r,s)}function jH(t,r){let s=UH(t,r),a=String.fromCharCode,c=t.bytes,d="",h="";for(let m=0;m<r;m++){let g,v,w,I,A=c[m+s];(128&A)==0?h+=a(A):(224&A)==192?m+1>=r?h+=d:(g=c[m+s+1],(192&g)!=128?h+=d:(I=(31&A)<<6|63&g,I<128?h+=d:(h+=a(I),m++))):(240&A)==224?m+2>=r?h+=d:(g=c[m+s+1],v=c[m+s+2],(49344&(g|v<<8))!=32896?h+=d:(I=(15&A)<<12|(63&g)<<6|63&v,I<2048||I>=55296&&I<=57343?h+=d:(h+=a(I),m+=2))):(248&A)==240?m+3>=r?h+=d:(g=c[m+s+1],v=c[m+s+2],w=c[m+s+3],(12632256&(g|v<<8|w<<16))!=8421504?h+=d:(I=(7&A)<<18|(63&g)<<12|(63&v)<<6|63&w,I<65536||I>1114111?h+=d:(I-=65536,h+=a(55296+(I>>10),56320+(1023&I)),m+=3))):h+=d}return h}function dg(t,r){let s=r.length,a=0;for(let h=0;h<s;h++){let m=r.charCodeAt(h);m>=55296&&m<=56319&&h+1<s&&(m=(m<<10)+r.charCodeAt(++h)-56613888),a+=m<128?1:m<2048?2:m<65536?3:4}Oi(t,a);let c=CP(t,a),d=t.bytes;for(let h=0;h<s;h++){let m=r.charCodeAt(h);m>=55296&&m<=56319&&h+1<s&&(m=(m<<10)+r.charCodeAt(++h)-56613888),m<128?d[c++]=m:(m<2048?d[c++]=m>>6&31|192:(m<65536?d[c++]=m>>12&15|224:(d[c++]=m>>18&7|240,d[c++]=m>>12&63|128),d[c++]=m>>6&63|128),d[c++]=63&m|128)}}function Zu(t){return t.bytes[UH(t,1)]}function FH(t,r){let s=CP(t,1);t.bytes[s]=r}function NT(t){let r,s=0,a=0;do r=Zu(t),s<32&&(a|=(127&r)<<s),s+=7;while(128&r);return a}function Oi(t,r){for(r>>>=0;r>=128;)FH(t,127&r|128),r>>>=7;FH(t,r)}function q_e(t,r){let s,a=0,c=0,d=0;return s=Zu(t),a=127&s,128&s&&(s=Zu(t),a|=(127&s)<<7,128&s&&(s=Zu(t),a|=(127&s)<<14,128&s&&(s=Zu(t),a|=(127&s)<<21,128&s&&(s=Zu(t),c=127&s,128&s&&(s=Zu(t),c|=(127&s)<<7,128&s&&(s=Zu(t),c|=(127&s)<<14,128&s&&(s=Zu(t),c|=(127&s)<<21,128&s&&(s=Zu(t),d=127&s,128&s&&(s=Zu(t),d|=(127&s)<<7))))))))),{low:a|c<<28,high:c>>>4|d<<24,unsigned:r}}function hg(t,r){let s=r.low>>>0,a=(r.low>>>28|r.high<<4)>>>0,c=r.high>>>24,d=c===0?a===0?s<16384?s<128?1:2:s<1<<21?3:4:a<16384?a<128?5:6:a<1<<21?7:8:c<128?9:10,h=CP(t,d),m=t.bytes;switch(d){case 10:m[h+9]=c>>>7&1;case 9:m[h+8]=d!==9?128|c:127&c;case 8:m[h+7]=d!==8?a>>>21|128:a>>>21&127;case 7:m[h+6]=d!==7?a>>>14|128:a>>>14&127;case 6:m[h+5]=d!==6?a>>>7|128:a>>>7&127;case 5:m[h+4]=d!==5?128|a:127&a;case 4:m[h+3]=d!==4?s>>>21|128:s>>>21&127;case 3:m[h+2]=d!==3?s>>>14|128:s>>>14&127;case 2:m[h+1]=d!==2?s>>>7|128:s>>>7&127;case 1:m[h]=d!==1?128|s:127&s}}const BH={},zH={},RP=4294967296,Y_e=RP*RP,WH=Y_e/2;HH(0,!0);const GH=HH(0),X_e=xT(0,-2147483648,!1),J_e=xT(-1,2147483647,!1);function HH(t,r){let s,a,c;return r?(c=0<=(t>>>=0)&&t<256)&&(a=zH[t],a)?a:(s=xT(t,0,!0),c&&(zH[t]=s),s):(c=-128<=(t|=0)&&t<128)&&(a=BH[t],a)?a:(s=xT(t,t<0?-1:0,!1),c&&(BH[t]=s),s)}function xT(t,r,s){return{low:0|t,high:0|r,unsigned:!!s}}function $H(t,r){if(isNaN(t))return GH;{if(t<=-WH)return X_e;if(t+1>=WH)return J_e}return t<0?GH:xT(t%RP|0,t/RP|0,r)}function KH(t,r){var s=Object.keys(t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);r&&(a=a.filter((function(c){return Object.getOwnPropertyDescriptor(t,c).enumerable}))),s.push.apply(s,a)}return s}class wM extends Zr{get connectionState(){return this._connectionState}set connectionState(r){if(this._connectionState===r)return;const s=this._connectionState;this._connectionState=r,this.emit(eh.CONNECTION_STATE_CHANGE,r,s)}get quality(){return this._quality}set quality(r){this._quality=r>1?1:r<.1?.1:r,this._qualityTimer&&(window.clearTimeout(this._qualityTimer),this._qualityTimer=null),this._quality>=1||(this._qualityTimer=window.setTimeout((()=>{this.quality=this._quality/this._qualityRatio}),6e4))}constructor(r){var s;super(),X(this,"name","AgoraRTCImageModeration"),X(this,"_connectionState",ru.CONNECTING),X(this,"_sequence",0),X(this,"_moderationStartTime",void 0),X(this,"_workerConnection",void 0),X(this,"_workerMessageLengthLimit",void 0),X(this,"_qualityRatio",void 0),X(this,"_connectInfo",void 0),X(this,"_cancelTokenSource",Na.CancelToken.source()),X(this,"_retryConfig",void 0),X(this,"_moderationInterval",void 0),X(this,"_moderationTimer",null),X(this,"_moderationMode",1),X(this,"_quality",1),X(this,"_qualityTimer",null),X(this,"_ticket",void 0),X(this,"_moderationIntervalMinimum",void 0),X(this,"_uploadFailedNum",0),X(this,"_uploadNum",0),X(this,"_uploadTimer",null),X(this,"_extraInfo",void 0),X(this,"_vendor",""),X(this,"_encoder",new TextEncoder),X(this,"_moderationId",void 0),X(this,"inspectImage",(()=>{if(this.connectionState!==ru.CONNECTED)throw new ke(te.OPERATION_ABORTED,"image moderation service connection status is ".concat(this.connectionState));this._moderationTimer&&(window.clearInterval(this._moderationTimer),this._moderationTimer=null),this._moderationTimer=window.setInterval((()=>{this.connectionState===ru.CONNECTED?this.requestToInspectImage():M.debug("[".concat(this._moderationId,"] Moderation State is not connected , "),this.connectionState)}),this._moderationInterval<this._moderationIntervalMinimum?this._moderationIntervalMinimum:this._moderationInterval),this.requestToInspectImage()})),this._moderationId=Tr(5,"image-moderation-"),this._workerMessageLengthLimit=oe("IMAGE_MODERATION_WORKER_MESSAGE_LENGTH_LIMIT"),this._moderationIntervalMinimum=oe("IMAGE_MODERATION_INTERVAL_MINIMUM"),this._moderationInterval=(s=r.interval)!==null&&s!==void 0?s:1e3,r.extraInfo&&(this._extraInfo=this._encoder.encode(r.extraInfo)),r.vendor&&(this._vendor=r.vendor),this._qualityRatio=oe("IMAGE_MODERATION_QUALITY_RATIO"),this._moderationStartTime=Number(Date.now()),this._workerConnection=new bT("worker-"+this._moderationId,Vi),this.on(eh.STATE_CHANGE,((a,c)=>{M.debug("[".concat(this._moderationId,"] Moderation operation :").concat(E0[a]," ").concat(c||""))})),this.handleWorkerEvents()}async init(r,s){this.emit(eh.STATE_CHANGE,E0.CONNECT_AP),this._connectInfo=r;const a=this._cancelTokenSource.token;return this._retryConfig=s,new mt(((c,d)=>{this.on(eh.CONNECTION_STATE_CHANGE,((h,m)=>{h===ru.CONNECTED&&c()})),this.requestAP(r,a,s).then((h=>{this.connectWorker(h)})).catch((h=>{d(h)}))}))}updateConfig(r){var s;this._moderationInterval=(s=r.interval)!==null&&s!==void 0?s:1e3,r.extraInfo&&(this._extraInfo=this._encoder.encode(r.extraInfo)),r.vendor&&(this._vendor=r.vendor),M.debug("[".concat(this._moderationId,"] updateConfig: ").concat(JSON.stringify(r))),this.connectionState===ru.CONNECTED&&this.inspectImage()}async requestAP(r,s,a){const c=oe("WEBCS_DOMAIN").map((g=>"https://".concat(g,"/api/v1"))),d=await(function(g,v,w,I){let{appId:A,areaCode:N,cname:H,sid:B,token:z,uid:ee}=v;C0++;const Z="moderation_plugin",ae={service_name:Z,json_body:JSON.stringify({appId:A,areaCode:N,cname:H,command:"allocateEdge",requestId:C0,seq:C0,sid:B,appToken:z,ts:Date.now(),uid:ee+""})};let ye,_e,ue=g[0];return Xd((async()=>{ye=Date.now();const Ae=await th(ue,{data:ae,cancelToken:w,headers:{"X-Packet-Service-Type":"0","X-Packet-URI":"61"},params:{action:"wrtc_gateway"}});if(_e=Date.now()-ye,Ae.code!==0){const Ze=new ke(te.UNEXPECTED_RESPONSE,"moderation plugin ap error, code"+Ae.code,{retry:!0,responseTime:_e});throw M.error(Ze.toString()),Ze}const Ue=JSON.parse(Ae.json_body);if(Ue.code!==200){const Ze=new ke(te.UNEXPECTED_RESPONSE,"moderation plugin ap error, code: ".concat(Ue.code,", reason: ").concat(Ue.reason),{code:Ue.code,responseTime:_e});throw M.error(Ze.toString()),Ze}if(!Ue.servers||!Array.isArray(Ue.servers)||Ue.servers.length===0){const Ze=new ke(te.UNEXPECTED_RESPONSE,"moderation plugin ap empty server",{code:Ue.code,responseTime:_e});throw M.error(Ze.toString()),Ze}if(!Ue.servers.some((Ze=>!!Ze.wss))){const Ze=new ke(te.UNEXPECTED_RESPONSE,"moderation plugin ap empty port",{code:Ue.code,responseTime:_e});throw M.error(Ze.toString()),Ze}const We=oe("IMAGE_MODERATION_WORKER_HOST");return{addressList:Ue.servers.map((Ze=>{let{address:_n,wss:bn}=Ze;if(_n&&bn)return"wss://".concat(_n.replace(/\./g,"-"),".").concat(We,":").concat(bn,"/moderation")})).filter((Ze=>!!Ze)),workerToken:Ue.workerToken,vid:Ue.vid,ticket:Ue.appTicket,responseTime:_e}}),((Ae,Ue)=>(It.apworkerEvent(B,{success:!0,sc:200,serviceName:Z,responseDetail:JSON.stringify(Ae.addressList),firstSuccess:Ue===0,responseTime:_e,serverIp:g[Ue%g.length]}),!1)),((Ae,Ue)=>(It.apworkerEvent(B,{success:!1,sc:Ae.data&&Ae.data.code||200,serviceName:Z,responseTime:_e,serverIp:g[Ue%g.length]}),!!(Ae.code!==te.OPERATION_ABORTED&&Ae.code!==te.UNEXPECTED_RESPONSE||Ae.data&&Ae.data.retry)&&(ue=g[(Ue+1)%g.length],!0))),I)})(c,r,s,a);this.emit(eh.STATE_CHANGE,E0.AP_CONNECTED);const{addressList:h,ticket:m}=d;return this._ticket=m,h}async connectWorker(r){this.emit(eh.STATE_CHANGE,E0.CONNECT_WORKER),await this._workerConnection.init(r,1e4)}handleWorkerEvents(){this._workerConnection.on(pn.CONNECTED,(async()=>{this.emit(eh.STATE_CHANGE,E0.WORKER_CONNECTED,this._workerConnection.url),this.connectionState=ru.CONNECTED})),this._workerConnection.on(pn.CLOSED,(()=>{this.connectionState=ru.CLOSED})),this._workerConnection.on(pn.FAILED,(()=>{this.connectionState=ru.CLOSED})),this._workerConnection.on(pn.RECONNECTING,(()=>{this.connectionState=this.connectionState===ru.CONNECTED?ru.RECONNECTING:ru.CONNECTING})),this._workerConnection.on(pn.ON_MESSAGE,(async r=>{if(r.data instanceof ArrayBuffer){const s=G_e(new Uint8Array(r.data));oe("SHOW_IMAGE_MODERATION_WORKER_MESSAGE")&&M.debug("[".concat(this._moderationId,"] Response message for worker of image moderation "),JSON.stringify(s)),this._uploadNum++,s.code===void 0||s.code===0||(this._uploadFailedNum++,M.error("[".concat(this._moderationId,"] Error response from worke, code is ").concat(s.code,", msg is ").concat(s.msg)),this._uploadTimer||(this._uploadTimer=window.setTimeout((()=>{It.reportApiInvoke(this._connectInfo.sid||null,{name:pi.IMAGE_MODERATION_UPLOAD,options:[this._uploadFailedNum,this._uploadNum,s.code],tag:$r.TRACER}).onError(new ke(te.IMAGE_MODERATION_UPLOAD_FAILED,s.msg)),this._uploadTimer=null}),oe("IMAGE_MODERATION_UPLOAD_REPORT_INTERVAL"))))}else M.error("[".concat(this._moderationId,"] Unexpected message type from worker"))})),this._workerConnection.on(pn.WILL_RECONNECT,((r,s,a)=>{r==="recover"&&a(r),a("tryNext")})),this._workerConnection.on(pn.REQUEST_NEW_URLS,((r,s)=>{this.requestAP(this._connectInfo,this._cancelTokenSource.token,this._retryConfig).then(r).catch(s)}))}static intToLong(r){return{low:r|=0,high:r>>31,unsigned:r>=0}}async requestToInspectImage(){const r=al(this,eh.CLIENT_LOCAL_VIDEO_TRACK),s={appId:this._connectInfo.appId,cname:this._connectInfo.cname,cid:this._connectInfo.cid,sid:this._connectInfo.sid,uid:this._connectInfo.uid,vid:this._connectInfo.vid};if(r){if(!r.isPlaying)return void(oe("SHOW_IMAGE_MODERATION_WORKER_MESSAGE")&&M.debug("Only the track being played can be inspected"));this._sequence++;const a=await this.generateRequestData(r,s);this._workerConnection.sendMessage(a,!0,!0)}else oe("SHOW_IMAGE_MODERATION_WORKER_MESSAGE")&&M.debug("Only the track being published can be inspected")}async generateRequestData(r,s){let{appId:a,cname:c,cid:d,vid:h,sid:m,uid:g}=s;const v=Date.now(),w=await r.getCurrentFrameImage("image/jpeg",this.quality),I=await yW(w,a,c),A=this._sequence+"-"+d+"-"+g+"-"+v+"-"+Tr(12,""),N={appId:a,cid:d,cname:c,deviceId:"",elapse:wM.intToLong(Number(v-this._moderationStartTime)),fileSize:w.buffer.byteLength,height:w.height,width:w.width,jpg:I,networkType:6,osType:7,requestId:A,sdkVersion:"4.24.0",sequence:this._sequence,sid:m,timestamp:$H(v),uid:g,vid:h,service:this._moderationMode,ticket:this._ticket,callbackData:this._extraInfo,vendorConfigs:this._vendor};this._extraInfo===void 0&&delete N.callbackData;const H=W_e(N);if(H.byteLength<this._workerMessageLengthLimit){if(oe("SHOW_IMAGE_MODERATION_WORKER_MESSAGE")){const B=(function(z){for(var ee=1;ee<arguments.length;ee++){var Z=arguments[ee]!=null?arguments[ee]:{};ee%2?KH(Object(Z),!0).forEach((function(ae){X(z,ae,Z[ae])})):Object.getOwnPropertyDescriptors?Object.defineProperties(z,Object.getOwnPropertyDescriptors(Z)):KH(Object(Z)).forEach((function(ae){Object.defineProperty(z,ae,Object.getOwnPropertyDescriptor(Z,ae))}))}return z})({},N);delete B.jpg,M.debug("[".concat(this._moderationId,"] Request message for worker of image moderation service: "),JSON.stringify(B))}return H}{const B=this.quality*this._qualityRatio;return this.quality=B,await this.generateRequestData(r,{appId:a,cname:c,cid:d,vid:h,sid:m,uid:g})}}close(){this._cancelTokenSource.cancel(),this._cancelTokenSource=Na.CancelToken.source(),this._workerConnection&&this._workerConnection.close(),this._moderationTimer&&window.clearInterval(this._moderationTimer),this._moderationTimer=null,this._uploadTimer&&window.clearTimeout(this._uploadTimer),this._uploadTimer=null,this.connectionState=ru.CLOSED,this.emit(eh.STATE_CHANGE,E0.CLOSED)}}function qH(t){if(vr(t.interval,"interval",1e3,1/0),t&&t.extraInfo&&t.extraInfo.length>1024)throw new ke(te.INVALID_PARAMS,"config.extraInfo length cannot exceed 1024 bytes");if(t&&t.vendor&&t.vendor.length>1024)throw new ke(te.INVALID_PARAMS,"config.vendor length cannot exceed 1024 bytes")}const Q_e={name:"ImageModeration",create:function(t){let{config:r}=t;return qH(r),new wM(r)}};var YH,XH,JH,QH,ZH,e$,t$,n$,r$,i$,s$,o$,a$,c$,l$,u$,d$,h$,p$,f$,m$,g$,_$,y$,E$,v$,S$,b$,w$,T$,C$,R$,I$,A$,P$,O$,k$,N$,x$,D$,L$,yt;function M$(t,r){var s=Object.keys(t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);r&&(a=a.filter((function(c){return Object.getOwnPropertyDescriptor(t,c).enumerable}))),s.push.apply(s,a)}return s}function ed(t){for(var r=1;r<arguments.length;r++){var s=arguments[r]!=null?arguments[r]:{};r%2?M$(Object(s),!0).forEach((function(a){X(t,a,s[a])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(s)):M$(Object(s)).forEach((function(a){Object.defineProperty(t,a,Object.getOwnPropertyDescriptor(s,a))}))}return t}so.setLogger(M);let Z_e=(YH=Wt(),XH=Wt({argsMap:(t,r)=>{if(!Array.isArray(r)){if(!(r instanceof d0))return[r];r=[r]}return r.map((s=>s?Object(s).toString():"null"))}}),JH=Wt({argsMap:(t,r)=>(r||(r=[]),Array.isArray(r)||r.trackMediaType!==u0.DATA?(Array.isArray(r)||(r=[r]),r.map((s=>s.getTrackId()))):[r.getChannelId()])}),QH=Wt({argsMap:(t,r,s,a)=>[typeof r=="object"?r.uid:r,s,a]}),ZH=Wt({argsMap:(t,r,s)=>[r,s]}),e$=Wt({argsMap:(t,r)=>r.map((s=>{let{user:a,mediaType:c}=s;return[a==null?void 0:a.uid,c]}))}),t$=Wt({argsMap:(t,r,s,a)=>[typeof r=="object"?r.uid:r,s,a]}),n$=Wt({argsMap:(t,r)=>r.map((s=>{let{user:a,mediaType:c}=s;return{uid:a==null?void 0:a.uid,mediaType:c}}))}),r$=Wt(),i$=Wt(),s$=Wt(),o$=Wt(),a$=Wt(),c$=Wt(),l$=Wt(),u$=Wt(),d$=Wt(),h$=Wt(),p$=Wt(),f$=Wt(),m$=Wt(),g$=Wt(),_$=Wt(),y$=Wt({argsMap:(t,r)=>[r]}),E$=Wt(),v$=Wt(),S$=Wt(),b$=Wt(),w$=Wt(),T$=Wt(),C$=Wt(),R$=Wt(),I$=Wt({argsMap:(t,r)=>(Array.isArray(r)||(r=[r]),[JSON.stringify(r)])}),A$=Wt(),P$=Wt(),O$=Wt(),k$=Wt(),N$=Wt(),x$=Wt(),D$=Wt({reportResult:!0}),L$=Wt(),yt=class extends Zr{get connectionState(){return this._gateway.state}get remoteUsers(){return this._users}get localTracks(){return this._p2pChannel.getAllTracks(!0)}get uid(){return this._uid}get channelName(){return this._channelName}get localDataChannels(){return this._p2pChannel.getAllDataChannels()}get mode(){return this._config.mode}get role(){var t;return((t=this._config)===null||t===void 0?void 0:t.role)||"audience"}get codec(){return this._config.codec}get audioCodec(){return this._config.audioCodec||"opus"}get isStringUID(){return!!this._joinInfo&&!!this._joinInfo.stringUid}get __className__(){return"Client"}constructor(t,r){let s;if(super(),X(this,"store",void 0),X(this,"_uid",void 0),X(this,"_channelName",void 0),X(this,"_uintUid",void 0),X(this,"_users",[]),X(this,"_config",void 0),X(this,"_clientId",void 0),X(this,"_appId",void 0),X(this,"_sessionId",null),X(this,"_key",void 0),X(this,"_rtmConfig",{}),X(this,"_joinInfo",void 0),X(this,"_gateway",void 0),X(this,"_statsCollector",void 0),X(this,"_configDistribute",void 0),X(this,"_leaveMutex",void 0),X(this,"_publishMutex",void 0),X(this,"_renewTokenMutex",void 0),X(this,"_subscribeMutex",void 0),X(this,"_encryptionMode","none"),X(this,"_encryptionSecret",null),X(this,"_encryptionSalt",null),X(this,"_encryptDataStream",!1),X(this,"_encryptDataStreamKey",null),X(this,"_encryptDataStreamIv",null),X(this,"_proxyServer",void 0),X(this,"_turnServer",{servers:[],mode:"auto"}),X(this,"_cloudProxyServerMode","disabled"),X(this,"_isDualStreamEnabled",!1),X(this,"_defaultStreamFallbackType",void 0),X(this,"_lowStreamParameter",void 0),X(this,"_streamFallbackTypeCacheMap",new Map),X(this,"_remoteStreamTypeCacheMap",new Map),X(this,"_axiosCancelSource",Na.CancelToken.source()),X(this,"_audioVolumeIndicationInterval",void 0),X(this,"_networkQualityInterval",void 0),X(this,"_userOfflineTimeout",void 0),X(this,"_streamRemovedTimeout",void 0),X(this,"_liveTranscodeStreamingClient",void 0),X(this,"_liveRawStreamingClient",void 0),X(this,"_channelMediaRelayClient",void 0),X(this,"_networkQualitySensitivity","normal"),X(this,"_p2pChannel",void 0),X(this,"_useLocalAccessPoint",!1),X(this,"_setLocalAPVersion",void 0),X(this,"_joinAndNotLeaveYet",!1),X(this,"_numberOfJoinCount",0),X(this,"_joinResponse",null),X(this,"_remoteDefaultVideoStreamType",void 0),X(this,"_inspect",void 0),X(this,"_moderation",void 0),X(this,"_license",void 0),X(this,"_pendingPublishedUsers",[]),X(this,"ntpAlignErrorCount",0),X(this,"remoteInboundOffset",0),X(this,"_peerConnectionState",void 0),X(this,"_handleLocalTrackEnable",((c,d,h)=>{this.publish(c,!1).then(d).catch(h)})),X(this,"_handleLocalTrackDisable",((c,d,h)=>{this.unpublish(c).then(d).catch(h)})),X(this,"_handleUserOnline",(c=>{if(oe("BLOCK_LOCAL_CLIENT")&&py(c.uid,this.channelName))return void M.debug("[".concat(c.uid,"] will be ignored in local"));this.isStringUID&&typeof c.uid!="string"&&M.error("[".concat(this._clientId,"] StringUID is Mixed with UintUID"));const d=this._users.find((h=>h.uid===c.uid));if(d)d._trust_in_room_=!0,d._is_pre_created&&(d._is_pre_created=!1,this.safeEmit(Pn.USER_JOINED,d));else{const h=new lg(c.uid,c.uint_id||c.uid);this._users.push(h),M.debug("[".concat(this._clientId,"] user online"),c.uid),this.store.firstVideoFrameDecoded(h.uid,{userJoinNotify:Date.now()}),this.safeEmit(Pn.USER_JOINED,h)}})),X(this,"_handleUserOffline",(c=>{if(oe("BLOCK_LOCAL_CLIENT")&&py(c.uid,this.channelName))return;const d=this._users.find((h=>h.uid===c.uid));d&&(this._handleRemoveStream(c),this._handleRemoveDataChannels(c),d._audio_pre_subscribed||d._video_pre_subscribed?d._is_pre_created=!0:R1(this._users,d),this._remoteStreamTypeCacheMap.delete(d.uid),this._streamFallbackTypeCacheMap.delete(d.uid),M.debug("[".concat(this._clientId,"] user offline"),c.uid,"reason:",c.reason),this.safeEmit(Pn.USER_LEAVED,d,c.reason))})),X(this,"_handleAddAudioOrVideoStream",((c,d,h,m,g,v,w,I)=>{if(oe("BLOCK_LOCAL_CLIENT")&&py(d,this.channelName))return;const A=this._users.find((H=>H.uid===d));if(!A)return void M.error("[".concat(this._clientId,"] can not find target user!(on_add_stream)"));M.debug("[".concat(this._clientId,"] stream added with uid ").concat(d,", type ").concat(c)),this.store.subscribe(A.uid,c,void 0,void 0,void 0,Date.now()),c==="video"&&this.store.firstVideoFrameDecoded(A.uid,{videoAddNotify:Date.now()});const N=c==="audio"?A.hasAudio:A.hasVideo;if(A._uintid||(A._uintid=v||d),c==="audio"?A._trust_audio_stream_added_state_=!0:A._trust_video_stream_added_state_=!0,c==="audio"?(A._audio_added_=!0,h!==void 0&&(A._audioSSRC=h),m!==void 0&&(A._cname=m),w&&(A._audioOrtc=w)):(A._video_added_=!0,h!==void 0&&(A._videoSSRC=h),m!==void 0&&(A._cname=m),I!==void 0&&(A._rtxSsrcId=I),w&&(A._videoOrtc=w)),(c==="audio"?A.hasAudio:A.hasVideo)&&!N&&(M.info("[".concat(this._clientId,"] remote user ").concat(A.uid," published ").concat(c)),this.safeEmit(Pn.USER_PUBLISHED,A,c)),c==="video"?It.onGatewayStream(this._sessionId,es.ON_ADD_VIDEO_STREAM,Br.ON_ADD_VIDEO_STREAM,{peer:v||d,ssrc:A._videoSSRC}):It.onGatewayStream(this._sessionId,es.ON_ADD_AUDIO_STREAM,Br.ON_ADD_AUDIO_STREAM,{peer:v||d,ssrc:A._audioSSRC}),this._p2pChannel.remoteMediaSsrcChanged(A,c,h).then((H=>{if(H&&(M.debug("[".concat(this._clientId,"] resubscribe ").concat(c," for user ").concat(A.uid," after rejoin because SSRC id changed.")),this._p2pChannel instanceof kT))return this._p2pChannel.unsubscribe(A,c,!0).then((()=>this._subscribe(A,c,!0).catch((B=>{M.error("[".concat(this._clientId,"] resubscribe error"),B.toString())}))))})),this._p2pChannel.hasPendingRemoteMedia(A,c)&&(M.debug("[".concat(this._clientId,"] resubscribe ").concat(c," for user ").concat(A.uid," after reconnect.")),this._subscribe(A,c,!0).catch((H=>{M.error("[".concat(this._clientId,"] resubscribe error"),H.toString())}))),c==="video"&&!Fs()&&!To()){const H=this._getEncodingName(g);(H==null?void 0:H.toLocaleLowerCase())==fT.av1&&T_e().then((B=>{B||this._gateway.downgradeCodec(H)}))}})),X(this,"_handleRemoveStream",(c=>{if(oe("BLOCK_LOCAL_CLIENT")&&py(c.uid,this.channelName))return;const d=this._users.find((m=>m.uid===c.uid));if(!d)return void M.warning("[".concat(this._clientId,"] can not find target user!(on_remove_stream)"));M.debug("[".concat(this._clientId,"] stream removed with uid ").concat(c.uid));let h=()=>{};d.hasAudio&&d.hasVideo?h=()=>{M.info("[".concat(this._clientId,"] remote user ").concat(d.uid," unpublished audio track")),this.safeEmit(Pn.USER_UNPUBLISHED,d,"audio"),M.info("[".concat(this._clientId,"] remote user ").concat(d.uid," unpublished video track")),this.safeEmit(Pn.USER_UNPUBLISHED,d,"video")}:d.hasVideo?h=()=>{M.info("[".concat(this._clientId,"] remote user ").concat(d.uid," unpublished video track")),this.safeEmit(Pn.USER_UNPUBLISHED,d,"video")}:d.hasAudio&&(h=()=>{M.info("[".concat(this._clientId,"] remote user ").concat(d.uid," unpublished audio track")),this.safeEmit(Pn.USER_UNPUBLISHED,d,"audio")}),d._video_pre_subscribed||d._audio_pre_subscribed||(d._trust_audio_stream_added_state_=!0,d._trust_video_stream_added_state_=!0,d._audio_added_=!1,d._video_added_=!1,this._p2pChannel instanceof kT&&this._p2pChannel.unsubscribe(d).then((m=>{if(m)return this._gateway.unsubscribe(m,d.uid)})),d._audioSSRC=void 0,d._videoSSRC=void 0,d._audioOrtc=void 0,d._videoOrtc=void 0,d._rtxSsrcId=void 0),It.onGatewayStream(this._sessionId,es.ON_REMOVE_STREAM,Br.ON_REMOVE_STREAM,{peer:c.uint_id||c.uid}),h()})),X(this,"_handleSetStreamLocalEnable",((c,d,h)=>{if(oe("BLOCK_LOCAL_CLIENT")&&py(d,this.channelName))return;const m=this._users.find((w=>w.uid===d));if(!m)return void M.error("[".concat(this._clientId,"] can not find target user!(disable_local)"));M.debug("[".concat(this._clientId,"] local ").concat(c," ").concat(h?"enabled":"disabled"," with uid ").concat(d));const g=c==="audio"?m.hasAudio:m.hasVideo;if(c==="audio"){m._trust_audio_enabled_state_=!0;const w=m._audio_enabled_;if(m._audio_enabled_=h,m._audio_enabled_===w)return;{const I=m._audio_enabled_?"enable-local-audio":"disable-local-audio";M.debug("[".concat(this._clientId,"] user-info-updated, uid: ").concat(d,", msg: ").concat(I)),this.safeEmit(Pn.USER_INFO_UPDATED,d,I)}}else{m._trust_video_enabled_state_=!0;const w=m._video_enabled_;if(m._video_enabled_=h,m._video_enabled_===w)return;{const I=m._video_enabled_?"enable-local-video":"disable-local-video";M.debug("[".concat(this._clientId,"] user-info-update, uid: ").concat(d,", msg: ").concat(I)),this.safeEmit(Pn.USER_INFO_UPDATED,d,I)}}const v=c==="audio"?m.hasAudio:m.hasVideo;return g!==v?!g&&v?(M.info("[".concat(this._clientId,"] remote user ").concat(d," published ").concat(c)),void this.safeEmit(Pn.USER_PUBLISHED,m,c)):(c==="video"&&m._videoTrack&&m._videoTrack._destroy(),c==="audio"&&m._audioTrack,this._p2pChannel.muteRemote(m,c),M.info("[".concat(this._clientId,"] remote user ").concat(d," unpublished ").concat(c)),void this.safeEmit(Pn.USER_UNPUBLISHED,m,c)):void 0})),X(this,"_handleMuteStream",((c,d,h)=>{if(oe("BLOCK_LOCAL_CLIENT")&&py(c,this.channelName))return;M.debug("[".concat(this._clientId,"] receive mute message"),c,d,h);const m=this._users.find((w=>w.uid===c));if(!m)return void M.warning("[".concat(this._clientId,"] can not find remote user, ignore mute event, uid: ").concat(c));const g=d==="audio"?m.hasAudio:m.hasVideo;if(d==="audio"){m._trust_audio_mute_state_=!0;const w=m._audio_muted_;if(m._audio_muted_=h,m._audio_muted_===w)return;{const I=m._audio_muted_?"mute-audio":"unmute-audio";M.debug("[".concat(this._clientId,"] user-info-update, uid: ").concat(c,", msg: ").concat(I)),this.safeEmit(Pn.USER_INFO_UPDATED,c,I)}}else{m._trust_video_mute_state_=!0;const w=m._video_muted_;if(m._video_muted_=h,m._video_muted_===w)return;{const I=m._video_muted_?"mute-video":"unmute-video";M.debug("[".concat(this._clientId,"] user-info-update, uid: ").concat(c,", msg: ").concat(I)),this.safeEmit(Pn.USER_INFO_UPDATED,c,I)}}const v=d==="audio"?m.hasAudio:m.hasVideo;if(g!==v){if(!g&&v)return(d==="audio"?m._audioSSRC:m._videoSSRC)?(M.info("[".concat(this._clientId,"] remote user ").concat(c," published ").concat(d)),void this.safeEmit(Pn.USER_PUBLISHED,m,d)):void M.warning("[".concat(this._clientId,"] remote user ").concat(c," receive ").concat(d," unmute message  before add stream message, ").concat(d," SSRC doesn't exist yet."));d==="video"&&m._videoTrack&&!m._video_pre_subscribed&&m._videoTrack._destroy(),d==="audio"&&m._audioTrack,this._p2pChannel.muteRemote(m,d),M.info("[".concat(this._clientId,"] remote user ").concat(c," unpublished ").concat(d)),this.safeEmit(Pn.USER_UNPUBLISHED,m,d)}})),X(this,"_handleP2PLost",(async c=>{M.debug("[".concat(this._clientId,"] receive p2p lost"),c),parseInt(c.p2pid,10)===this.store.p2pId?await this._p2pChannel.requestReconnect():M.warning("[".concat(this._clientId,"] P2PLost stream not found"),c)})),X(this,"_handleTokenWillExpire",(()=>{M.debug("[".concat(this._clientId,"] received message onTokenPrivilegeWillExpire")),this.safeEmit(Pn.ON_TOKEN_PRIVILEGE_WILL_EXPIRE)})),X(this,"_handleBeforeUnload",(c=>{c.type==="beforeunload"&&c.returnValue!==void 0&&c.returnValue!==""||(this.leave(),M.info("[".concat(this._clientId,"] auto leave onbeforeunload or pagehide")))})),X(this,"_handleUpdateNetworkQuality",(()=>{if(this._networkQualitySensitivity==="normal")return;if(navigator&&navigator.onLine!==void 0&&!navigator.onLine)return void this.safeEmit(Pn.NETWORK_QUALITY,{downlinkNetworkQuality:6,uplinkNetworkQuality:6});const c={downlinkNetworkQuality:0,uplinkNetworkQuality:0};c.uplinkNetworkQuality=this._p2pChannel.getUplinkNetworkQuality(),c.downlinkNetworkQuality=this._p2pChannel.getDownlinkNetworkQuality(),this.safeEmit(Pn.NETWORK_QUALITY,c)})),X(this,"_handleP2PAddAudioOrVideoStream",((c,d,h,m)=>{const g=this._users.find((w=>w.uid===d));if(!g)return void M.error("[".concat(this._clientId,"] can not find target user!(on_add_stream)"));M.debug("[".concat(this._clientId,"] stream added with uid ").concat(d,", type ").concat(c)),this.store.subscribe(g.uid,c,void 0,void 0,void 0,Date.now());const v=c==="audio"?g.hasAudio:g.hasVideo;c==="audio"?g._trust_audio_stream_added_state_=!0:g._trust_video_stream_added_state_=!0,c==="audio"?(g._audio_added_=!0,h!==void 0&&(g._audioSSRC=h),m!==void 0&&(g._audioMid=m)):(g._video_added_=!0,h!==void 0&&(g._videoSSRC=h),m!==void 0&&(g._videoMid=m)),(c==="audio"?g.hasAudio:g.hasVideo)&&!v&&(M.info("[".concat(this._clientId,"] remote user ").concat(g.uid," published ").concat(c)),this.safeEmit(Pn.USER_PUBLISHED,g,c)),this._p2pChannel.hasPendingRemoteMedia(g,c)&&(M.debug("[".concat(this._clientId,"] resubscribe ").concat(c," for user ").concat(g.uid," after reconnect.")),this._subscribe(g,c,!0).catch((w=>{M.error("[".concat(this._clientId,"] resubscribe error"),w.toString())})))})),this._config=t,this._clientId=r||Tr(5,"client-"),this.store=new class{constructor(c,d,h,m){nn(this,"state",void 0),this.state={codec:c,audioCodec:d,mode:h,clientId:m,sessionId:null,p2pId:0,dcId:0,pubId:0,subId:0,keyMetrics:{publish:[],subscribe:[],firstVideoFrameDecoded:[]},joinChannelServiceRecords:[],cloudProxyServerMode:"disabled",useP2P:!1,p2pTransport:oy.Default,hasStartJoinChannel:!1,isABTestSuccess:!1,autoSubscribe:!1,enableInstantMuteRestore:!1}}dispatch(c){this.state=(function(d,h){switch(h.type){case rn.SET_SESSION_ID:return et(et({},d),{},{sessionId:h.sessionId});case rn.SET_P2P_ID:return et(et({},d),{},{p2pId:h.p2pId});case rn.SET_UID:return et(et({},d),{},{uid:h.uid});case rn.SET_INT_UID:return et(et({},d),{},{intUid:h.intUid});case rn.SET_PUB_ID:return et(et({},d),{},{pubId:h.pubId});case rn.KEY_METRIC_CLIENT_CREATED:return et(et({},d),{},{keyMetrics:et(et({},d.keyMetrics),{},{clientCreated:h.metric})});case rn.KEY_METRIC_JOIN_START:return et(et({},d),{},{keyMetrics:et(et({},d.keyMetrics),{},{joinStart:h.metric})});case rn.KEY_METRIC_PRELOAD_START:return et(et({},d),{},{keyMetrics:et(et({},d.keyMetrics),{},{preloadStart:h.metric})});case rn.KEY_METRIC_PRELOAD_END:return et(et({},d),{},{keyMetrics:et(et({},d.keyMetrics),{},{preloadEnd:h.metric})});case rn.KEY_METRIC_JOIN_END:return et(et({},d),{},{keyMetrics:et(et({},d.keyMetrics),{},{joinEnd:h.metric})});case rn.KEY_METRIC_REQUEST_AP_START:return et(et({},d),{},{keyMetrics:et(et({},d.keyMetrics),{},{requestAPStart:h.metric})});case rn.KEY_METRIC_REQUEST_AP_END:return et(et({},d),{},{keyMetrics:et(et({},d.keyMetrics),{},{requestAPEnd:h.metric})});case rn.KEY_METRIC_REQUEST_SUA_END:return et(et({},d),{},{keyMetrics:et(et({},d.keyMetrics),{},{requestSUAEnd:h.metric})});case rn.KEY_METRIC_BEFORE_CONNECT:return et(et({},d),{},{keyMetrics:et(et({},d.keyMetrics),{},{beforeConnect:h.metric})});case rn.KEY_METRIC_PEER_RECEIVER:return et(et({},d),{},{keyMetrics:et(et({},d.keyMetrics),{},{peerReceiver:h.metric})});case rn.KEY_METRIC_SIGNAL_CONNECTED:return et(et({},d),{},{keyMetrics:et(et({},d.keyMetrics),{},{signalConnected:h.metric})});case rn.KEY_METRIC_JOIN_REQ:return et(et({},d),{},{keyMetrics:et(et({},d.keyMetrics),{},{joinReq:h.metric})});case rn.KEY_METRIC_JOIN_REP:return et(et({},d),{},{keyMetrics:et(et({},d.keyMetrics),{},{joinRep:h.metric})});case rn.KEY_METRIC_JOIN_GATEWAY_START:return et(et({},d),{},{keyMetrics:et(et({},d.keyMetrics),{},{joinGatewayStart:h.metric})});case rn.KEY_METRIC_JOIN_GATEWAY_END:return et(et({},d),{},{keyMetrics:et(et({},d.keyMetrics),{},{joinGatewayEnd:h.metric})});case rn.KEY_METRIC_PEER_CONNECTION_START:return et(et({},d),{},{keyMetrics:et(et({},d.keyMetrics),{},{peerConnectionStart:h.metric})});case rn.KEY_METRIC_PEER_CONNECTION_END:return et(et({},d),{},{keyMetrics:et(et({},d.keyMetrics),{},{peerConnectionEnd:h.metric})});case rn.KEY_METRIC_DESCRIPTION_START:return et(et({},d),{},{keyMetrics:et(et({},d.keyMetrics),{},{descriptionStart:h.metric})});case rn.KEY_METRIC_SIGNAL_CHANNEL_OPEN:return et(et({},d),{},{keyMetrics:et(et({},d.keyMetrics),{},{signalChannelOpen:h.metric})});case rn.KEY_METRIC_ICE_CONNECTION_END:return et(et({},d),{},{keyMetrics:et(et({},d.keyMetrics),{},{iceConnectionEnd:h.metric})});case rn.KEY_METRIC_PUBLISH:{const m=d.keyMetrics.publish,g=m.findIndex((v=>v.trackId===h.metric.trackId));return g!==-1?(m[g]=et(et({},m[g]),h.metric),et(et({},d),{},{keyMetrics:et(et({},d.keyMetrics),{},{publish:[...m]})})):et(et({},d),{},{keyMetrics:et(et({},d.keyMetrics),{},{publish:[...d.keyMetrics.publish,h.metric]})})}case rn.KEY_METRIC_SUBSCRIBE:{const m=d.keyMetrics.subscribe,g=m.findIndex((v=>v.userId===h.metric.userId&&v.type===h.metric.type));return g!==-1?(m[g]=et(et({},m[g]),h.metric),et(et({},d),{},{keyMetrics:et(et({},d.keyMetrics),{},{subscribe:[...m]})})):et(et({},d),{},{keyMetrics:et(et({},d.keyMetrics),{},{subscribe:[...d.keyMetrics.subscribe,h.metric]})})}case rn.KEY_METRIC_FIRST_VIDEO_FRAME_DECODED:{const m=d.keyMetrics.firstVideoFrameDecoded,g=m.findIndex((v=>v.userId===h.metric.userId));return g!==-1?(m[g]=et(et({},m[g]),h.metric),et(et({},d),{},{keyMetrics:et(et({},d.keyMetrics),{},{firstVideoFrameDecoded:[...m]})})):et(et({},d),{},{keyMetrics:et(et({},d.keyMetrics),{},{firstVideoFrameDecoded:[...d.keyMetrics.firstVideoFrameDecoded,h.metric]})})}case rn.RESET_FIRST_VIDEO_FRAME_DECODED:return d.keyMetrics.firstVideoFrameDecoded=[],d;case rn.SET_CLOUD_PROXY_SERVER_MODE:return d.cloudProxyServerMode=h.mode,d;case rn.RECORD_JOIN_CHANNEL_SERVICE:return typeof h.index!="number"?d.joinChannelServiceRecords=[...d.joinChannelServiceRecords,h.record]:(d.joinChannelServiceRecords[h.index]=et(et({},d.joinChannelServiceRecords[h.index]),h.record),d.joinChannelServiceRecords=[...d.joinChannelServiceRecords]),d;case rn.RESET_JOIN_CHANNEL_SERVICE_RECORDS:return d.joinChannelServiceRecords=[],d;case rn.RESET_KEY_METRICS:return d.keyMetrics={publish:[],subscribe:[],firstVideoFrameDecoded:[]},d;case rn.SET_USE_P2P:return et(et({},d),{},{useP2P:h.val});case rn.SET_TRANSPORT_TYPE:return et(et({},d),{},{p2pTransport:h.val});default:return d}})(this.state,c)}set autoSubscribe(c){this.state.autoSubscribe=c}get autoSubscribe(){return this.state.autoSubscribe}set enableInstantMuteRestore(c){this.state.enableInstantMuteRestore=c}get enableInstantMuteRestore(){return this.state.enableInstantMuteRestore}set sessionId(c){this.dispatch({type:rn.SET_SESSION_ID,sessionId:c})}get sessionId(){return this.state.sessionId}set cid(c){this.state.cid=c}get cid(){return this.state.cid}set codec(c){this.state.codec=c}get codec(){return this.state.codec}get mode(){return this.state.mode}get audioCodec(){return this.state.audioCodec}get clientId(){return this.state.clientId}set p2pId(c){this.dispatch({type:rn.SET_P2P_ID,p2pId:c})}get p2pId(){return this.state.p2pId}set dcId(c){this.dispatch({type:rn.SET_DC_ID,dcId:c})}get dcId(){return this.state.dcId}set uid(c){this.dispatch({type:rn.SET_UID,uid:c})}get uid(){return this.state.uid}set intUid(c){this.dispatch({type:rn.SET_INT_UID,intUid:c})}get intUid(){return this.state.intUid}set pubId(c){this.dispatch({type:rn.SET_PUB_ID,pubId:c})}get pubId(){return this.state.pubId}set cloudProxyServerMode(c){this.dispatch({type:rn.SET_CLOUD_PROXY_SERVER_MODE,mode:c})}get cloudProxyServerMode(){return this.state.cloudProxyServerMode}set useP2P(c){this.dispatch({type:rn.SET_USE_P2P,val:c})}get useP2P(){return this.state.useP2P}set p2pTransport(c){this.dispatch({type:rn.SET_TRANSPORT_TYPE,val:c})}get p2pTransport(){return this.state.p2pTransport}set hasStartJoinChannel(c){this.state.hasStartJoinChannel=c}get hasStartJoinChannel(){return this.state.hasStartJoinChannel}set isABTestSuccess(c){this.state.isABTestSuccess=c}get isABTestSuccess(){return this.state.isABTestSuccess}clientCreated(){this.dispatch({type:rn.KEY_METRIC_CLIENT_CREATED,metric:Date.now()})}joinStart(){this.dispatch({type:rn.KEY_METRIC_JOIN_START,metric:Date.now()})}preloadStart(){this.dispatch({type:rn.KEY_METRIC_PRELOAD_START,metric:Date.now()})}preloadEnd(){this.dispatch({type:rn.KEY_METRIC_PRELOAD_END,metric:Date.now()})}joinEnd(){this.dispatch({type:rn.KEY_METRIC_JOIN_END,metric:Date.now()})}requestAPStart(){this.dispatch({type:rn.KEY_METRIC_REQUEST_AP_START,metric:Date.now()})}requestAPEnd(){this.dispatch({type:rn.KEY_METRIC_REQUEST_AP_END,metric:Date.now()})}requestSUAEnd(){this.dispatch({type:rn.KEY_METRIC_REQUEST_SUA_END,metric:Date.now()})}beforeConnect(){this.dispatch({type:rn.KEY_METRIC_BEFORE_CONNECT,metric:Date.now()})}peerReceiver(){this.dispatch({type:rn.KEY_METRIC_PEER_RECEIVER,metric:Date.now()})}signalConnected(){this.dispatch({type:rn.KEY_METRIC_SIGNAL_CONNECTED,metric:Date.now()})}joinReq(){this.dispatch({type:rn.KEY_METRIC_JOIN_REQ,metric:Date.now()})}joinRep(){this.dispatch({type:rn.KEY_METRIC_JOIN_REP,metric:Date.now()})}joinGatewayStart(){this.dispatch({type:rn.KEY_METRIC_JOIN_GATEWAY_START,metric:Date.now()})}joinGatewayEnd(){this.dispatch({type:rn.KEY_METRIC_JOIN_GATEWAY_END,metric:Date.now()})}peerConnectionStart(){this.dispatch({type:rn.KEY_METRIC_PEER_CONNECTION_START,metric:Date.now()})}peerConnectionEnd(){this.dispatch({type:rn.KEY_METRIC_PEER_CONNECTION_END,metric:Date.now()})}firstVideoFrameDecoded(c,d){this.dispatch({type:rn.KEY_METRIC_FIRST_VIDEO_FRAME_DECODED,metric:et({userId:c},d)})}descriptionStart(){this.dispatch({type:rn.KEY_METRIC_DESCRIPTION_START,metric:Date.now()})}signalChannelOpen(){this.dispatch({type:rn.KEY_METRIC_SIGNAL_CHANNEL_OPEN,metric:Date.now()})}iceConnectionEnd(){this.dispatch({type:rn.KEY_METRIC_ICE_CONNECTION_END,metric:Date.now()})}publish(c,d,h,m){this.dispatch({type:rn.KEY_METRIC_PUBLISH,metric:et(et({trackId:c,type:d},h&&{publishStart:h}),m&&{publishEnd:m})})}subscribe(c,d,h,m,g,v,w){this.dispatch({type:rn.KEY_METRIC_SUBSCRIBE,metric:et(et(et(et(et({userId:c,type:d},h&&{subscribeStart:h}),m&&{subscribeEnd:m}),g&&{firstFrame:g}),v&&{streamAdded:v}),w&&{firstDecoded:w})})}massSubscribe(c,d,h,m){c.forEach((g=>{this.dispatch({type:rn.KEY_METRIC_SUBSCRIBE,metric:et(et(et({userId:g.userId,type:g.type},d&&{subscribeStart:d}),h&&{subscribeEnd:h}),m&&{firstFrame:m})})}))}get keyMetrics(){return this.state.keyMetrics}recordJoinChannelService(c,d){c.service==="gateway"&&Array.isArray(c.urls)&&(c.urls=c.urls.map((h=>h.replace(/(\d+)-\d+-\d+-(\d+)/,"$1-*-*-$2"))));try{return typeof d!="number"?(this.dispatch({type:rn.RECORD_JOIN_CHANNEL_SERVICE,record:et(et({},c),{},{sessionId:this.sessionId,cloudProxyMode:this.cloudProxyServerMode,uid:this.uid})}),this.state.joinChannelServiceRecords.length-1):(d<0||d>=this.state.joinChannelServiceRecords.length||this.dispatch({type:rn.RECORD_JOIN_CHANNEL_SERVICE,record:c,index:d}),d)}catch{return 0}}resetJoinChannelServiceRecords(){this.dispatch({type:rn.RESET_JOIN_CHANNEL_SERVICE_RECORDS})}resetKeyMetrics(){this.dispatch({type:rn.RESET_KEY_METRICS})}resetFirstVideoFrameDecoded(){this.dispatch({type:rn.RESET_FIRST_VIDEO_FRAME_DECODED})}get joinChannelServiceRecords(){try{return this.state.joinChannelServiceRecords}catch{return[]}}}(t.codec,t.audioCodec,t.mode,this._clientId),this._leaveMutex=new so("client-leave",this._clientId),this._publishMutex=new so("client-publish",this._clientId),this._renewTokenMutex=new so("client-renewtoken",this._clientId),this._subscribeMutex=new so("client-subscribe",this._clientId),this.store.clientCreated(),t.proxyServer&&this.setProxyServer(t.proxyServer,!0),t.turnServer&&this.setTurnServer(t.turnServer,!0),M.info("[".concat(this._clientId,"] Initializing AgoraRTC client v").concat(Zl," build: ").concat(c2,", mode: ").concat(this.mode,", codec: ").concat(this.codec)),t.clientRoleOptions)try{YL(t.clientRoleOptions),s=Object.assign({},t.clientRoleOptions)}catch(c){M.warning("[".concat(this._clientId,"] ").concat(c.toString()))}var a;this._statsCollector=new PT(this.store),this._statsCollector.onStatsException=(c,d,h)=>{M.warn("[".concat(this._clientId,"] receive exception msg, code: ").concat(c,", msg: ").concat(d,", uid: ").concat(h)),c===aM.VIDEO_ENCODE_FAILED&&this.localTracks.forEach((m=>{m instanceof F1&&oe("ENABLE_ENCODE_EXCEPTION")&&m.findClosestProfile()})),this.safeEmit(Pn.EXCEPTION,{code:c,msg:d,uid:h})},this._statsCollector.onUploadPublishDuration=(c,d,h,m)=>{const g=this._users.find((v=>v.uid===c));g&&(this.store.keyMetrics&&(this.store.firstVideoFrameDecoded(g._uintid,{peerPublishDuration:h,peerPubStatusMs:Date.now()}),this._p2pChannel.reportVideoFirstFrameRender(g)),It.peerPublishStatus(this._sessionId,{subscribeElapse:m,audioPublishDuration:d,videoPublishDuration:h,peer:g._uintid}))},this._statsCollector.onVideoCodecChanged=c=>{if(oe("VIDEO_STANDARD_BITRATE_VERSION")&&(c==="av1"||c==="h265"||c==="h264")){const d=this.localTracks.find((h=>h instanceof Nr));d&&d._saveEncodeBitrateRatio!==1&&d.setSaveEncodeBitrateRatio(c==="h264"?oe("BASELINE_MORE_H264_BITRATE_RATIO"):void 0)}},this.store.useP2P=t.mode==="p2p",this._gateway=new y_e(this.store,{clientId:this._clientId,mode:this.mode,codec:this.codec,websocketRetryConfig:t.websocketRetryConfig||Vi,httpRetryConfig:t.httpRetryConfig||Vi,forceWaitGatewayResponse:t.forceWaitGatewayResponse===void 0||t.forceWaitGatewayResponse,statsCollector:this._statsCollector,role:t.role,clientRoleOptions:s}),this._configDistribute=new P_e(this._clientId,this.store),this.store.useP2P?(this._p2pChannel=(a={store:this.store,statsCollector:this._statsCollector},Cf("P2PChannel").create(a)),this._handleP2PEvents()):this._p2pChannel=new kT(this.store,this._statsCollector),this._handleP2PChannelEvents(),this._handleGatewayEvents(),this._handleGatewaySignalEvents()}async joinMeta(t,r,s,a,c){let d=!(arguments.length>5&&arguments[5]!==void 0)||arguments[5],h=arguments.length>6&&arguments[6]!==void 0&&arguments[6];gr("JOIN_GATEWAY_USE_443PORT_ONLY",d),gr("JOIN_GATEWAY_USE_DUAL_DOMAIN",h);const m=this._gateway.signal.websocket;return m instanceof $2&&(m.use443PortOnly=d,m.tryDoubleDomain=h),(async function(g,v,w){S1.get(g)||S1.set(g,[]),b1.get(g)||b1.set(g,v),ip.get(g)||ip.set(g,0);const I=S1.get(g),A=b1.get(g);if(!I||!A)throw new Error("concurrent: deferQueue or maxConcurrency is null");if(ip.get(g)===A){const ee=sT();I.push(ee),await ee.promise}ip.set(g,ip.get(g)+1);for(var N=arguments.length,H=new Array(N>3?N-3:0),B=3;B<N;B++)H[B-3]=arguments[B];const z=await w(...H);return ip.set(g,ip.get(g)-1),ip.get(g)===A-1&&I.length>0&&(I[0].resolve(),I.shift()),ip.get(g)===0&&(S1.set(g,[]),b1.set(g,0),ip.set(g,0)),z})("client.join",oe("JOIN_MAX_CONCURRENCY"),this.join.bind(this),t,r,s,a,c)}async join(t,r,s,a,c){const d=++this._numberOfJoinCount;this.store.joinStart(),a&&(this.store.uid=a);const h=(P1||P1||(P1=(window.location.protocol.split(":")[0]||"").toUpperCase(),P1))==="HTTPS",m=N9()?window.isSecureContext:"Browser Not Support";(!N9()&&!h||!window.isSecureContext)&&M.warning("The website must be running in a secure context (About secure context: https://developer.mozilla.org/en-US/docs/Web/Security/Secure_Contexts ), otherwise the media collection will be restricted by the browser");let g;It.setAppId(t);try{if(!s&&s!==null)throw new ke(te.INVALID_PARAMS,"Invalid token: ".concat(s,". If you don not use token, set it to null"));if(s&&Rs(s,"token",1,2047),Rs(t,"appid",1,2047),J1(r),a&&Q1(a),c)if(typeof c=="string")Rs(c,"optionalInfo",1,256),g=c;else{if(typeof c!="object")throw new ke(te.INVALID_PARAMS,"Invalid options: options is not a string or object");{const{autoSubscribe:z,enableInstantMuteRestore:ee}=c;z&&(Yd(z,"autoSubscribe"),M.info("[".concat(this._clientId,"] join: autoSubscribe: ").concat(z)),this.store.autoSubscribe=z),ee&&(Yd(ee,"enableInstantMuteRestore"),M.info("[".concat(this._clientId,"] join: enableInstantMuteRestore: ").concat(ee)),this.store.enableInstantMuteRestore=ee)}}}catch(z){throw It.reportApiInvoke(sy(),{name:pi.JOIN,options:[t,r,s,a],states:{isHttps:h,isSecureContext:m},tag:$r.TRACER}).onError(z),z}if(this._leaveMutex.isLocked&&(M.debug("[".concat(this._clientId,"] join: waiting leave operation")),(await this._leaveMutex.lock())(),M.debug("[".concat(this._clientId,"] join: continue"))),this._joinAndNotLeaveYet=!0,this.connectionState!=="DISCONNECTED"){const z=new ke(te.INVALID_OPERATION,"[".concat(this._clientId,"] Client already in connecting/connected state"));throw It.reportApiInvoke(sy(),{name:pi.JOIN,options:[t,r,s,a],states:{isHttps:h,isSecureContext:m},tag:$r.TRACER}).onError(z),z}this._gateway.state="CONNECTING",this.store.preloadStart();const v=await kH({appId:t,cname:r,uid:a,stringUid:typeof a=="string"?a:void 0,token:s||t,cloudProxyServer:this._cloudProxyServerMode});if(this.store.preloadEnd(),!this._joinAndNotLeaveYet)throw new ke(te.INVALID_OPERATION,"[".concat(this._clientId,"] Client already left"));const w=(v==null?void 0:v.sid)||sy();M.info("[".concat(this._clientId,"] start join channel ").concat(r,", join number: ").concat(d)),this._sessionId||(this._sessionId=w,this.store.sessionId=this._sessionId);const I=It.reportApiInvoke(w,{id:this._clientId,name:pi.JOIN,options:[t,r,s,a],states:{isHttps:h,isSecureContext:m},tag:$r.TRACER}),A=ed(ed(ed({},this._rtmConfig),{},{role:this.role,clientId:this._clientId,appId:t,sid:this._sessionId,cname:r,uid:typeof a!="string"?a:null,turnServer:this._turnServer,proxyServer:this._proxyServer,token:s||t,cloudProxyServer:this._cloudProxyServerMode,optionalInfo:g,license:this._license,useLocalAccessPoint:this._useLocalAccessPoint,preload:!!v},this._remoteDefaultVideoStreamType!==void 0&&{defaultVideoStream:this._remoteDefaultVideoStreamType}),{},{apRequestDetail:oe("AP_REQUEST_DETAIL")||void 0});if(this._useLocalAccessPoint&&(A.setLocalAPVersion=this._setLocalAPVersion),typeof a=="string"&&(A.stringUid=a,this._uintUid?(A.uid=this._uintUid,this._uintUid=void 0):A.uid=0),this._encryptionMode!=="none"&&this._encryptionSecret){if(A.aesmode=this._encryptionMode,A.aespassword=await(async z=>{const ee=(function(_e){const ue=window.atob(`MIGfMA0GCSqGSIb3DQEBAQUAA4GNADCBiQKBgQDCMnXAHkKIGAM+x4N22gCI+Wyu
STM9ztkT3uYslTT2PuKmZfPzhH6kVdO7PTjGCOZnAsyb3oTtWat0KcxQ4jxvqQV+
HvYl3iI1Yd4vl2c3qRMJPLtRDfNxa2Mcxgq7e9aEUibzdd0st+OJAy3tOj/Y0aVy
xQiYDz3vqa6bP29adwIDAQAB`),Ae=new Uint8Array(new ArrayBuffer(ue.length));for(let Ue=0;Ue<ue.length;Ue+=1)Ae[Ue]=ue.charCodeAt(Ue);return Ae})(),Z=await window.crypto.subtle.importKey("spki",ee,{name:"RSA-OAEP",hash:"SHA-256"},!0,["encrypt"]),ae=KL(z),ye=await window.crypto.subtle.encrypt({name:"RSA-OAEP"},Z,ae);return(function(_e){let ue="";for(let Ae=0;Ae<_e.length;Ae+=1)ue+=String.fromCharCode(_e[Ae]);return window.btoa(ue)})(new Uint8Array(ye))})(this._encryptionSecret),!this._joinAndNotLeaveYet)throw new ke(te.INVALID_OPERATION,"[".concat(this._clientId,"] Client already left"));this._encryptionSalt&&(A.aessalt=this._encryptionSalt)}if(this._encryptDataStream&&(this._encryptionMode==="aes-128-gcm2"||this._encryptionMode==="aes-256-gcm2"))if(this._encryptionSalt&&this._encryptionSecret)if(window.crypto.subtle){const z=new TextEncoder,ee=oe("USE_PURE_ENCRYPTION_MASTER_KEY")?z.encode(A.appId+this._encryptionSecret+this._encryptionSecret):z.encode(A.appId+A.cname+this._encryptionSecret);this._encryptDataStreamIv=await(async function(Z,ae,ye){const _e=await window.crypto.subtle.importKey("raw",ae,"PBKDF2",!1,["deriveBits","deriveKey"]),ue=Z==="aes-128-gcm2"?128:256,Ae=await window.crypto.subtle.deriveBits({name:"PBKDF2",iterations:z9,hash:"SHA-256",salt:ye},_e,ue+qme);return new Uint8Array(Ae).subarray(ue/8)})(this._encryptionMode,ee,iy(this._encryptionSalt)),this._encryptDataStreamKey=await(async function(Z,ae,ye){const _e=await window.crypto.subtle.importKey("raw",ae,"PBKDF2",!1,["deriveBits","deriveKey"]),ue=Z==="aes-128-gcm2"?128:256;return await window.crypto.subtle.deriveKey({name:"PBKDF2",iterations:z9,hash:"SHA-256",salt:ye},_e,{name:"AES-GCM",length:ue},!0,["encrypt","decrypt"])})(this._encryptionMode,ee,iy(this._encryptionSalt))}else m?M.warning("[".concat(this._clientId,"] encrypt datastream must be running in a secure context, fallback to plain data stream")):M.warning("[".concat(this._clientId,"] current browser do not support WebCrypto ,fallback to plain data stream")),this._encryptDataStream=!1;else this._encryptDataStream=!1,M.debug("[".concat(this._clientId,"] no salt / secret, cannot support encrypt data stream, fallback to plain data stream"));this._startSession(this._sessionId,{channel:r,appId:t,stringUid:A.stringUid});const N=this._sessionId;setTimeout((()=>{this.connectionState==="CONNECTING"&&N===this._sessionId&&It.joinChannelTimeout(this._sessionId,5)}),5e3);try{var H;let z;const ee=A.cloudProxyServer;if(rt(H=["proxy3","proxy4","proxy5"]).call(H,ee)){const ue=oe("PROXY_SERVER_TYPE3");Array.isArray(ue)?A.proxyServer=ue[0]:A.proxyServer=ue}if(It.setProxyServer(A.proxyServer),M.setProxyServer(A.proxyServer),this.store.requestAPStart(),v){if(M.debug("[".concat(this._clientId,"] get serverInfo Success from Preload Cache ").concat(A.stringUid?", ".concat(A.stringUid," => ").concat(v.intUid):""," ")),A.stringUid&&!A.uid&&(A.uid=v.intUid),z={gatewayInfo:v.ap.gatewayInfo},oe("JOIN_WITH_FALLBACK_MEDIA_PROXY")&&A.turnServer.mode==="auto")if(v.ap.proxyInfo.addresses.length===0)M.warning("no edge services in ap response of proxy fallback, will not set proxy in iceServers");else{const ue=(await I7(v.ap.proxyInfo,v.ap.gatewayInfo.uid)).map((Ae=>({turnServerURL:Ae.address,tcpport:Ae.tcpport||Ws.tcpport,udpport:Ae.udpport||Ws.udpport,username:Ae.username||Ws.username,password:Ae.password||Ws.password,forceturn:!1,security:!0})));A.turnServer={mode:"manual",servers:ue}}DH(v,A.stringUid)}else{if(A.stringUid&&!A.uid){let ue;[ue,z]=await mt.all([tH(A.stringUid,A,this._axiosCancelSource.token,this._config.httpRetryConfig||Vi,this.store).finally((()=>{this.store.requestSUAEnd()})),eH(A,this._axiosCancelSource.token,this._config.httpRetryConfig||Vi,!0,this.store).finally((()=>{this.store.requestAPEnd()}))]),M.debug("[".concat(this._clientId,"] getUserAccount Success ").concat(A.stringUid," => ").concat(ue)),A.uid=ue,z.gatewayInfo.uid=ue,z.gatewayInfo.res.uid=ue}else z=await eH(A,this._axiosCancelSource.token,this._config.httpRetryConfig||Vi,!0,this.store);if(!this._joinAndNotLeaveYet)throw new ke(te.INVALID_OPERATION,"[".concat(this._clientId,"] Client already left"))}this.store.requestAPEnd(),setTimeout((()=>{this._configDistribute.startGetConfigDistribute(A,this._axiosCancelSource.token),this._configDistribute.on(vT.UPDATE_BITRATE_LIMIT,(ue=>{this._p2pChannel.updateBitrateLimit(ue)})),this._configDistribute.on(vT.UPDATE_CLIENT_ROLE_OPTIONS,(ue=>{this._setClientRoleOptions(ue)}))}),0),this._key=s||t;const Z=z.gatewayInfo,ae=A.uid?A.uid:Z.uid;this._joinInfo=ed(ed({},A),{},{cid:Z.cid,uid:ae,vid:Z.vid,apResponse:Z.res,apGatewayAddress:Z.apGatewayAddress,uni_lbs_ip:Z.uni_lbs_ip,gatewayAddrs:Z.gatewayAddrs}),this.store.intUid=ae,this.store.cid=Z.cid;const ye=await this._joinGateway();if(!this._joinAndNotLeaveYet)throw new ke(te.INVALID_OPERATION,"[".concat(this._clientId,"] Client already left"));I.onSuccess(ye),this._appId=t,this._channelName=A.cname,this._uid=ye,this.store.uid=ye,setTimeout((()=>{this._networkQualityInterval&&window.clearInterval(this._networkQualityInterval),this._networkQualityInterval=window.setInterval(this._handleUpdateNetworkQuality,2e3),window.addEventListener(Fs()?"beforeunload":"pagehide",this._handleBeforeUnload),this._statsCollector.startUpdateStats()}),0);const _e=A.stringUid?"string uid: ".concat(A.stringUid,",uid: ").concat(A.uid):"uid: ".concat(this._uid);return M.info("[".concat(this._clientId,"] Joining channel success: channel: ").concat(r,",").concat(_e)),setTimeout((()=>{M.startUpload()}),5e3),this.store.joinEnd(),B=this,rt(hy).call(hy,B)||hy.push(B),this._cloudProxyServerMode==="disabled"&&Wn().supportWebCrypto&&oe("ENABLE_PRELOAD")&&SM(this._joinInfo),ye}catch(z){const ee=Array.isArray(z)?z[0]:z;throw ee&&ee.code===te.OPERATION_ABORTED?M.warning("[".concat(this._clientId,"] join number: ").concat(d,", Joining channel failed, rollback"),ee):M.error("[".concat(this._clientId,"] join number: ").concat(d,", Joining channel failed, rollback"),ee),ee.code!==te.OPERATION_ABORTED&&this._numberOfJoinCount===d&&(this._gateway.state="DISCONNECTED",this._reset()),I.onError(ee),ee}var B}_joinGateway(){if(!this._joinInfo||!this._key)throw new ke(te.INVALID_OPERATION);return this._gateway.join(this._joinInfo,this._key,!(this._joinInfo.cloudProxyServer!=="disabled"||this._joinInfo.proxyServer||!oe("JOIN_WITH_FALLBACK_SIGNAL_PROXY")))}async leave(){M.info("[".concat(this._clientId,"] Leaving channel")),window.removeEventListener(Fs()?"beforeunload":"pagehide",this._handleBeforeUnload),this._reset(),(function(r){const s=hy.indexOf(r);s!==-1&&hy.splice(s,1)})(this),this._statsCollector.stopUpdateStats();const t=await this._leaveMutex.lock();if(this.connectionState==="DISCONNECTED")return M.info("[".concat(this._clientId,"] Leaving channel repeated, success")),void t();await this._gateway.leave(this.connectionState!=="CONNECTED",or.LEAVE),M.info("[".concat(this._clientId,"] Leaving channel success")),this._joinAndNotLeaveYet=!1,this.store.resetJoinChannelServiceRecords(),t()}async publish(t){let r=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1];if(!Array.isArray(t)){if(!(t instanceof d0))return this._publishDataChannel(t);t=[t]}if(t.length===0)throw new ke(te.INVALID_PARAMS,"param list is empty");const s=t;if(this._gateway.role==="audience")throw new ke(te.INVALID_OPERATION,"audience can not publish stream");for(const c of s){if(!(c instanceof d0))throw new ke(te.INVALID_PARAMS,"parameter is not local track");if(!c._enabled&&r)throw new ke(te.TRACK_IS_DISABLED,"can not publish a disabled track: ".concat(c.getTrackId()))}M.info("[".concat(this._clientId,"] Publishing tracks, id ").concat(s.map((c=>"".concat(c.getTrackId()," ")))));const a=await this._publishMutex.lock();await this._configDistribute.awaitConfigDistributeComplete(),r&&s.forEach((c=>{const d=this._configDistribute.getBitrateLimit();c instanceof Nr&&d&&c.setBitrateLimit(d.uplink)}));try{await this._publishHighStream(s),M.info("[".concat(this._clientId,"] Publish success, id ").concat(s.map((c=>"".concat(c.getTrackId()," ")))))}catch(c){throw M.error("[".concat(this._clientId,"] publish error"),c.toString()),c}finally{a()}}async _publishDataChannel(t){if(t==null)throw new ke(te.INVALID_PARAMS,"parameter is not local track or datachannel config, config is ".concat(JSON.stringify(t)));vr(t.id,"id",0,65535,!0),Yd(t.ordered,"ordered"),Rs(t.metadata,"metadata",0,512),M.info("[".concat(this._clientId,"] Publishing datachannels, id ").concat(t.id));const r=await this._publishMutex.lock();try{if(this._p2pChannel.getAllDataChannels().findIndex((c=>c.id===t.id))!==-1)throw new ke(te.INVALID_PARAMS,"Invalid id: ".concat(t.id,". If you want to republish the datachannel, unpublish first"));if(!this._joinInfo||this._uid===void 0)throw new ke(te.INVALID_OPERATION,"Can't publish datachannel, haven't joined yet!");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new ke(te.INVALID_OPERATION,"can not publish datachannel in ".concat(this.connectionState," state"));if(this._turnServer.mode==="auto"&&oe("FORCE_TURN")&&!oe("TURN_ENABLE_TCP")&&!oe("TURN_ENABLE_UDP"))throw new ke(te.UNEXPECTED_ERROR,"force TURN With No TURN Configuration");const s=(function(c){return H7(c,!1)})(t),a=await this._p2pChannel.publishDataChannel([s]);if(a.length>0){if(typeof s._originDataChannelId!="number")throw M.error("[".concat(this._clientId,"] can not publish with mediaType datachannel, cannot get RTCDatachannel id")),new ke(te.CREATE_DATACHANNEL_ERROR);try{await mt.all(a.map((c=>this._uid&&this._gateway.publishDataChannel(this._uid,c,!0)))),await s._waitTillOpen()}catch(c){if(c.code!==te.DISCONNECT_P2P)throw c}}return M.info("[".concat(this._clientId,"] Publish dataChannels success, id ").concat(s.id)),s}catch(s){throw M.error("[".concat(this._clientId,"] publish datachannels error"),s.toString()),s}finally{r()}}async unpublish(t){if(!this._joinInfo||this._uid===void 0)throw new ke(te.INVALID_OPERATION,"Can't unpublish stream, haven't joined yet!");let r=[];if(t)if(Array.isArray(t))r=t;else{if(!(t instanceof d0))return this._unpublishDataChannel([t]);r=[t]}else this.store.useP2P||await this._unpublishDataChannel(),r=this._p2pChannel.getAllTracks(!0);M.info("[".concat(this._clientId,"] Unpublish tracks, tracks ").concat(r.map((a=>"".concat(a.getTrackId()," ")))," "));const s=await this._publishMutex.lock();try{if(this.store.useP2P){const a=await this._p2pChannel.unpublish(r);a&&await this._gateway.sendExtensionMessage(bi.UNPUBLISH,{unpubMsg:a},!0)}else{const a=await this._p2pChannel.unpublish(r);a&&await this._gateway.unpublish(a,this._uid),M.info("[".concat(this._clientId,"] Unpublish success,tracks ").concat(r.map((c=>"".concat(c.getTrackId())))))}}catch(a){throw M.error("[".concat(this._clientId,"] unpublish error"),a.toString()),a}finally{s&&s()}}async _unpublishDataChannel(t){t!==void 0&&t.length!==0||(t=this._p2pChannel.getAllDataChannels()),M.info("[".concat(this._clientId,"] Unpublish datachannels, datachannels ").concat(t.map((s=>"".concat(s.id," ")))," "));const r=await this._publishMutex.lock();try{const s=await this._p2pChannel.unpublishDataChannel(t);s&&await this._gateway.unpublishDataChannel(s),M.info("[".concat(this._clientId,"] Unpublish dataChannel success,dataChannel ").concat(t.map((a=>"".concat(a.id)))))}catch(s){throw M.error("[".concat(this._clientId,"] unpublish dataChannel error"),s.toString()),s}finally{r&&r()}}async subscribe(t,r,s){if(!(t instanceof lg)){const a=this.remoteUsers.find((c=>c.uid===t));if(!a)throw new ke(te.INVALID_REMOTE_USER,"user is not in the channel");t=a}return r==="datachannel"?this._subscribeDataChannel(t,s):this._subscribe(t,r)}async presubscribe(t,r){if(Zi(r,"mediaType",["audio","video"]),this.store.useP2P)throw new ke(te.INVALID_OPERATION,"can't presub at p2p mode");if(!this._joinInfo)throw new ke(te.INVALID_OPERATION,"can't presub when not join");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new ke(te.INVALID_OPERATION,"can't presub in ".concat(this.connectionState," state"));const s=r===St.AUDIO,a=r===St.VIDEO,c=await this._subscribeMutex.lock();try{const{ssrcId:d,ortc:h,rtxSsrcId:m,cname:g,uint_id:v}=await this._gateway.presubscribe(t,r,!0);if(d==null)throw new ke(te.UNEXPECTED_RESPONSE,"no ssrc id");let w=this._users.find((A=>A.uid===t));w||(w=new lg(t,v||t),w._is_pre_created=!0,this._users.push(w)),g&&(w._cname=g),w._uintid||(w._uintid=v||t),s&&(w._audioSSRC=d,w._audio_pre_subscribed=!0,h&&(w._audioOrtc=h)),a&&(w._videoSSRC=d,w._video_pre_subscribed=!0,h&&(w._videoOrtc=h),m!=null&&(w._rtxSsrcId=m)),M.info("[".concat(this._clientId,"] presub succeed ssrc: ").concat(d)),await this._p2pChannel.subscribe(w,r,d,m,h);const I=s?w._audioTrack:w._videoTrack;if(!I)throw new ke(te.UNEXPECTED_ERROR,"can not find remote track in user");return s&&(w._trust_audio_stream_added_state_=!0,w._audio_added_=!0),a&&(w._trust_video_stream_added_state_=!0,w._video_added_=!0),I}catch(d){throw M.error("[".concat(this._clientId,"] presub user ").concat(t," error"),d),d}finally{c()}}async _subscribeDataChannel(t,r){var s;if(vr(r,"channelId",0,65535,!0),!this._joinInfo)throw new ke(te.INVALID_OPERATION,"Can't subscribe datachannel, not joined");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new ke(te.INVALID_OPERATION,"Can't subscribe datachannel in ".concat(this.connectionState," state"));if(!this._users.find((m=>m===t)))throw M.error("[".concat(this._clientId,"] can not subscribe ").concat(t.uid,", this user is not in the channel")),new ke(te.INVALID_REMOTE_USER,"user is not in the channel");if(!t.hasAudio&&!t.hasVideo&&t._dataChannels.length===0)throw M.error("[".concat(this._clientId,"] can not subscribe ").concat(t.uid,", user is not published")),new ke(te.INVALID_REMOTE_USER,"user is not published");const c=(s=t._dataChannels)===null||s===void 0?void 0:s.find((m=>m.id===r));if(!c)throw M.error("[".concat(this._clientId,"] can not subscribe ").concat(t.uid," with mediaType datachannel, remote datachannel is not published")),new ke(te.REMOTE_USER_IS_NOT_PUBLISHED);const d=await this._subscribeMutex.lock();M.info("[".concat(this._clientId,"] subscribe user ").concat(t.uid,", mediaType: datachannel"));try{const m=await this._p2pChannel.subscribeDataChannel(t,[c]);if(m&&rt(m).call(m,c.id))try{var h;if(typeof c._originDataChannelId!="number")throw M.error("[".concat(this._clientId,"] can not subscribe ").concat(t.uid," with mediaType datachannel, cannot get RTCDatachannel")),new ke(te.CREATE_DATACHANNEL_ERROR);const g={id:c.id,datachannelId:c._originDataChannelId,ordered:c.ordered,maxRetransmits:c.maxRetransmits,metadata:(h=c.metadata)!==null&&h!==void 0?h:""};await this._gateway.subscribeDataChannel(t.uid,g,!0),await c._waitTillOpen()}catch(g){if((g==null?void 0:g.code)!==te.WS_ABORT)throw await this._p2pChannel.unsubscribeDataChannel(t,[c]),g;await this._p2pChannel.unsubscribeDataChannel(t,[c]),this._p2pChannel.setPendingRemoteDataChannel(t,c.id)}return M.info("[".concat(this._clientId,"] subscribe success user ").concat(t.uid,", mediaType: datachannel")),c}finally{d()}}async _p2pSubscribe(t,r,s){if(Zi(r,"mediaType",["audio","video"]),!this._joinInfo)throw new ke(te.INVALID_OPERATION,"Can't subscribe stream, not joined");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new ke(te.INVALID_OPERATION,"Can't subscribe stream in ".concat(this.connectionState," state"));if(!this._users.find((d=>d===t))){const d=new ke(te.INVALID_REMOTE_USER,"user is not in the channel");throw M.error("[".concat(this._clientId,"] can not subscribe ").concat(t.uid,", this user is not in the channel")),d}if(!t.hasAudio&&!t.hasVideo){const d=new ke(te.INVALID_REMOTE_USER,"user is not published");throw M.error("[".concat(this._clientId,"] can not subscribe ").concat(t.uid,", user is not published")),d}if(!s&&(r==="audio"&&!t.hasAudio||r==="video"&&!t.hasVideo)){const d=new ke(te.REMOTE_USER_IS_NOT_PUBLISHED);throw M.error("[".concat(this._clientId,"] can not subscribe ").concat(t.uid," with mediaType ").concat(r,", remote track is not published")),d}const c=await this._subscribeMutex.lock();M.info("[".concat(this._clientId,"] subscribe user ").concat(t.uid,", mediaType: ").concat(r));try{if(await this._p2pChannel.hasRemoteMediaWithLock(t,r))await this._p2pChannel.unmuteRemote(t,r);else try{const h=r==="audio"?t._audioSSRC:t._videoSSRC,m=r==="audio"?t._audioMid:t._videoMid;this.store.subscribe(t.uid,r,Date.now()),this.store.useP2P&&await this._p2pChannel.subscribe(t,r,h,m)}catch(h){throw h}M.info("[".concat(this._clientId,"] subscribe success user ").concat(t.uid,", mediaType: ").concat(r)),this._defaultStreamFallbackType&&this.setStreamFallbackOption(t.uid,this._defaultStreamFallbackType).catch((h=>{M.warning("[".concat(this._clientId,"] auto set fallback failed"),h)}));const d=r==="audio"?t._audioTrack:t._videoTrack;if(!d)throw new ke(te.UNEXPECTED_ERROR,"can not find remote track in user object");return d}catch(d){throw M.error("[".concat(this._clientId,"] subscribe user ").concat(t.uid," error"),d),d}finally{c()}}async _subscribe(t,r,s){if(this.store.useP2P)return this._p2pSubscribe(t,r);if(Zi(r,"mediaType",["audio","video"]),!this._joinInfo)throw new ke(te.INVALID_OPERATION,"Can't subscribe stream, not joined");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new ke(te.INVALID_OPERATION,"Can't subscribe stream in ".concat(this.connectionState," state"));if(!this._users.find((v=>v===t))){const v=new ke(te.INVALID_REMOTE_USER,"user is not in the channel");throw M.error("[".concat(this._clientId,"] can not subscribe ").concat(t.uid,", this user is not in the channel")),v}if(!t.hasAudio&&!t.hasVideo){const v=new ke(te.INVALID_REMOTE_USER,"user is not published");throw M.error("[".concat(this._clientId,"] can not subscribe ").concat(t.uid,", user is not published")),v}if(!(s||(r!=="audio"||t.hasAudio&&t._audioSSRC!==void 0)&&(r!=="video"||t.hasVideo&&t._videoSSRC!==void 0))){const v=new ke(te.REMOTE_USER_IS_NOT_PUBLISHED);throw M.error("[".concat(this._clientId,"] can not subscribe ").concat(t.uid," with mediaType ").concat(r,", remote track is not published")),v}let c=r==="audio"?t._audioSSRC:t._videoSSRC,d=r==="audio"?t._audioOrtc:t._videoOrtc,h=r==="video"?t._rtxSsrcId:void 0,m={stream_type:r==="audio"?St.AUDIO:St.VIDEO,ssrcId:c};r==="video"&&this.store.firstVideoFrameDecoded(t.uid,{subscribeStart:Date.now()});const g=await this._subscribeMutex.lock();M.info("[".concat(this._clientId,"] subscribe user ").concat(t.uid,", mediaType: ").concat(r));try{if(await this._p2pChannel.hasRemoteMediaWithLock(t,r))await this._p2pChannel.unmuteRemote(t,r);else try{const w=r==="audio"?t._audioSSRC:t._videoSSRC;w!==void 0&&w!==c&&(c=w,d=r==="audio"?t._audioOrtc:t._videoOrtc,h=r==="video"?t._rtxSsrcId:void 0,m={stream_type:r==="audio"?St.AUDIO:St.VIDEO,ssrcId:c}),lo.markSubscribeStart(this.store.clientId,c),this.store.subscribe(t.uid,r,Date.now()),await this._p2pChannel.subscribe(t,r,c,h,d);try{this._p2pChannel.isPreSubScribe(c)||await this._gateway.subscribe(t.uid,m,!0)}catch(I){if((I==null?void 0:I.code)!==te.WS_ABORT)throw await this._p2pChannel.unsubscribe(t,r),I;await this._p2pChannel.unsubscribe(t,r,!0),this._p2pChannel.setPendingRemoteMedia(t,r)}this.store.subscribe(t.uid,r,void 0,Date.now()),this._p2pChannel.reportSubscribeEvent(!0,null,t,r)}catch(w){throw this._p2pChannel.reportSubscribeEvent(!1,w==null?void 0:w.code,t,r),w}M.info("[".concat(this._clientId,"] subscribe success user ").concat(t.uid,", mediaType: ").concat(r)),this._defaultStreamFallbackType&&this.setStreamFallbackOption(t.uid,this._defaultStreamFallbackType).catch((w=>{M.warning("[".concat(this._clientId,"] auto set fallback failed"),w)}));const v=r==="audio"?t._audioTrack:t._videoTrack;if(!v)throw new ke(te.UNEXPECTED_ERROR,"can not find remote track in user object");return r==="video"&&(this.store.firstVideoFrameDecoded(t.uid,{subscribeEnd:Date.now()}),this._p2pChannel.reportVideoFirstFrameRender(t)),v}catch(v){throw M.error("[".concat(this._clientId,"] subscribe user ").concat(t.uid," error"),v),v}finally{g()}}async massSubscribe(t){if(Sf(t,"subscribeList"),!this._joinInfo)throw new ke(te.INVALID_OPERATION,"Can't subscribe stream, not joined");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new ke(te.INVALID_OPERATION,"Can't subscribe stream in ".concat(this.connectionState," state"));const r=Date.now(),s=new Map,a=await this._subscribeMutex.lock();M.info("[".concat(this._clientId,"]start massSubscribe user ").concat(t.map((m=>{let{user:g,mediaType:v}=m;return"user: ".concat(g==null?void 0:g.uid,", mediaType: ").concat(v)})).join("; ")));const c=(t=[...t]).map((m=>{let{user:g,mediaType:v}=m;return{user:g,mediaType:v}})),d=await this._p2pChannel.globalLock();try{var h;for(let g=t.length-1;g>=0;g--){const v=t[g],{user:w,mediaType:I}=v;if(Zi(I,"mediaType",["audio","video"]),!w){const B=new ke(te.INVALID_PARAMS,"user property does not exist in subscribeList item");throw M.error("[".concat(this._clientId,"] user property does not exist in subscribeList item")),B}if(!this._users.find((B=>B===w))){const B=new ke(te.INVALID_REMOTE_USER,"user is not in the channel");M.error("[".concat(this._clientId,"] can not massSubscribe ").concat(w.uid,", this user is not in the channel")),c[g].error=B,t.splice(g,1);continue}if(I==="audio"&&(!w.hasAudio||w._audioSSRC===void 0)||I==="video"&&(!w.hasVideo||w._videoSSRC===void 0)){const B=new ke(te.REMOTE_USER_IS_NOT_PUBLISHED);M.error("[".concat(this._clientId,"] can not subscribe ").concat(w.uid," with mediaType ").concat(I,", remote user is not published")),c[g].error=B,t.splice(g,1);continue}const N=as.Video|as.LwoVideo,H=s.get(w);if(H){if(I==="video"?H&N:H&as.Audio){t.splice(g,1),M.warning("[".concat(this._clientId,"] repeat massSubscribe user:").concat(w.uid,", mediaType:").concat(I," twice"));continue}s.set(w,H|(I==="video"?N:as.Audio))}else s.set(w,I==="video"?N:as.Audio)}for(let g=t.length-1;g>=0;g--){const v=t[g],{user:w,mediaType:I}=v,A=as.Video|as.LwoVideo;if(this._p2pChannel.hasRemoteMedia(w,I)){await this._p2pChannel.unmuteRemoteNoLock(w,I);const N=s.get(w);s.set(w,I==="video"?N^A:N^as.Audio),t.splice(g,1)}}this.store.massSubscribe(t.map((g=>({userId:g.user.uid,type:g.mediaType}))),r);let m=Xa(h=Array.from(s.entries())).call(h,((g,v)=>{let[w,I]=v;if(I===0)return g;const A={stream_id:w.uid,stream_type:I};return I&as.Audio&&(A.audio_ssrc=w._audioSSRC),I&as.Video&&(A.video_ssrc=w._videoSSRC),g.push(A),g}),[]);try{t.length>0&&await this._p2pChannel.massSubscribeNoLock(t.map((v=>{let{user:w,mediaType:I}=v;return{user:w,mediaType:I,ssrcId:I===St.VIDEO?w._videoSSRC:w._audioSSRC,rtxSsrcId:I===St.VIDEO?w._rtxSsrcId:void 0}})));const g=new Map;if(m=m.filter((v=>v.video_ssrc&&!this._p2pChannel.isPreSubScribe(v.video_ssrc)||v.audio_ssrc&&!this._p2pChannel.isPreSubScribe(v.audio_ssrc)||!v.video_ssrc&&!v.audio_ssrc)),m.length>0){const v=await this._gateway.subscribeAll(m,!0);((v==null?void 0:v.users)||[]).forEach((w=>{let{stream_id:I,video_error_code:A,audio_error_code:N,error_code:H}=w;(A||N||H)&&g.set(I,{video_error_code:A,audio_error_code:N,error_code:H})}))}if(Array.from(g.entries()).length>0){const v=[];Array.from(g.entries()).forEach((w=>{let[I,A]=w;const N=this.remoteUsers.find((H=>H.uid===I));if(N){let H;A.error_code||A.video_error_code&&A.audio_error_code?H=void 0:A.video_error_code?H=St.VIDEO:A.audio_error_code&&(H=St.AUDIO),v.push({user:N,mediaType:H})}})),v.length>0&&await this._p2pChannel.massUnsubscribeNoLock(v)}for(const v of c){const w=g.get(v.user.uid);if(w){const I=w.error_code||v.mediaType==="audio"&&w.audio_error_code||v.mediaType==="video"&&w.video_error_code;if(I){const A=ST(I);M.error("user:".concat(v.user.uid," mediaType:").concat(v.mediaType," has massSubscribe error ").concat(A.desc)),v.error=new ke(te.SUBSCRIBE_FAILED,"code ".concat(I,": ").concat(A.desc))}}v.error||(v.mediaType==="video"?v.track=v.user.videoTrack:v.track=v.user.audioTrack)}return this.store.massSubscribe(c.filter((v=>!v.error)).map((v=>({userId:v.user.uid,type:v.mediaType}))),void 0,Date.now()),c.forEach((v=>{var w;It.subscribe(this.store.sessionId,{succ:!!v.error,ec:((w=v.error)===null||w===void 0?void 0:w.code)||null,video:v.mediaType===St.VIDEO,audio:v.mediaType===St.AUDIO,peerid:v.user.uid,subscribeRequestid:v.mediaType===St.VIDEO?v.user._videoSSRC:v.user._audioSSRC,p2pid:this.store.p2pId,eventElapse:Math.floor(performance.now()-r),preSsrc:this._p2pChannel.isPreSubScribe(v.user._videoSSRC)},!0)})),M.info("[".concat(this._clientId,"] massSubscribe success ").concat(t.map((v=>{let{user:w,mediaType:I}=v;return"user: ".concat(w==null?void 0:w.uid,", mediaType: ").concat(I)})).join("; "))),c}catch(g){throw await this._p2pChannel.massUnsubscribeNoLock(t),g}}finally{d(),a()}}async unsubscribe(t,r,s){if(!(t instanceof lg)){const d=this.remoteUsers.find((h=>h.uid===t));if(!d)throw new ke(te.INVALID_REMOTE_USER,"user is not in the channel");t=d}if(r||this.store.useP2P){if(r==="datachannel")return this._unsubscribeDataChannel(t,s)}else await this._unsubscribeDataChannel(t,s);if(r&&Zi(r,"mediaType",["audio","video"]),!this._joinInfo)throw new ke(te.INVALID_OPERATION,"Can't unsubscribe stream, haven't joined yet!");if(!this._users.find((d=>d===t))){const d=new ke(te.INVALID_REMOTE_USER,"user is not in the channel");throw M.error("[".concat(this._clientId,"] can not unsubscribe ").concat(t.uid,", user is not in the channel")),d}M.info("[".concat(this._clientId,"] unsubscribe uid: ").concat(t.uid,", mediaType: ").concat(r));const c=await this._subscribeMutex.lock();try{if(this.store.useP2P)await this._p2pChannel.unsubscribe(t,r);else{const d=await this._p2pChannel.unsubscribe(t,r);d&&await this._gateway.unsubscribe(d,t.uid),r&&r!=="audio"||(t._audio_pre_subscribed=!1),r&&r!=="video"||(t._video_pre_subscribed=!1),t._is_pre_created&&R1(this._users,t),M.info("[".concat(this._clientId,"] unsubscribe success uid: ").concat(t.uid,", mediaType: ").concat(r))}}catch(d){if(d.code===te.DISCONNECT_P2P)return void M.warning("disconnecting p2p, abort unsubscribe request.");throw M.error("[".concat(this._clientId,"] unsubscribe user ").concat(t.uid," error"),d.toString()),d}finally{c()}}async _unsubscribeDataChannel(t,r){if(r&&vr(r,"id",0,65535,!0),!this._joinInfo)throw new ke(te.INVALID_OPERATION,"Can't unsubscribe datachannel, haven't joined yet!");if(!this._users.find((c=>c===t))){const c=new ke(te.INVALID_REMOTE_USER,"user is not in the channel");throw M.error("[".concat(this._clientId,"] can not unsubscribe ").concat(t.uid,", user is not in the channel")),c}let a;if(typeof r=="number"){const c=t._dataChannels.find((d=>d.id===r));c&&(a=[c])}else a=t._dataChannels;if(a===void 0){const c=new ke(te.REMOTE_USER_IS_NOT_PUBLISHED);throw M.error("[".concat(this._clientId,"] can not unsubscribe ").concat(t.uid," with channelId ").concat(r,", remote datachannel is not published")),c}M.info("[".concat(this._clientId,"] unsubscribe uid: ").concat(t.uid,", mediaType: datachannel, ids: ").concat(a.map((c=>c.id))));try{const c=await this._p2pChannel.unsubscribeDataChannel(t,a);c&&await this._gateway.unsubscribeDataChannel(c,t.uid),M.info("[".concat(this._clientId,"] unsubscribe datachannel success uid: ").concat(t.uid,", mediaType: datachannel, ids: ").concat(c))}catch(c){if(c.code===te.DISCONNECT_P2P)return void M.warning("disconnecting p2p, abort unsubscribe request.");throw M.error("[".concat(this._clientId,"] unsubscribe user ").concat(t.uid," error"),c.toString()),c}}async massUnsubscribe(t){if(Sf(t,"unsubscribeList"),!this._joinInfo)throw new ke(te.INVALID_OPERATION,"Can't unsubscribeAll stream, haven't joined yet!");M.info("[".concat(this._clientId,"] start massUnsubscribe ").concat(t.map((s=>{let{user:a,mediaType:c}=s;return"user: ".concat(a==null?void 0:a.uid,", mediaType: ").concat(c,";")})).join())),t=[...t];const r=new Map;for(let s=t.length-1;s>=0;s--){const{user:a,mediaType:c}=t[s];if(!a){const m=new ke(te.INVALID_PARAMS,"user property does not exist in unsubscribeList item");throw M.error("[".concat(this._clientId,"] user property does not exist in unsubscribeList item")),m}if(Zi(c,"mediaType",["video","audio",void 0]),!this._users.find((m=>m===a))){M.warning("[".concat(this._clientId,"] can not unsubscribe ").concat(a.uid,", user is not in the channel")),t.splice(s,1);continue}const h=as.Video|as.LwoVideo;if(r.has(a)){const m=r.get(a);let g;switch(c){case"video":g=m&h;break;case"audio":g=m&as.Audio;break;default:g=m&(as.Audio|h)}if(g){M.warning("[".concat(this._clientId,"] repeat massUnsubscribe user:").concat(a.uid,",mediaType:").concat(c," twice.")),t.splice(s,1);continue}c?c==="audio"?r.set(a,m|as.Audio):c==="video"&&r.set(a,m|h):r.set(a,m|as.Audio|h)}else c?c==="audio"?r.set(a,as.Audio):c==="video"&&r.set(a,h):r.set(a,as.Audio|h)}try{const s=await this._p2pChannel.massUnsubscribe(t);s&&await this._gateway.massUnsubscribe(s),M.info("[".concat(this._clientId,"] massUnsubscribe success ").concat(t.map((a=>{let{user:c,mediaType:d}=a;return"user: ".concat(c==null?void 0:c.uid,", mediaType: ").concat(d,";")})).join()))}catch(s){if(s.code===te.DISCONNECT_P2P)return void M.warning("[".concat(this._clientId,"] disconnecting p2p, abort unsubscribe request."));throw M.error("[".concat(this._clientId,"] massUnsubscribe error"),s.toString()),s}}async setLowStreamParameter(t){(function(s){if(!s)throw new Le(te.INVALID_PARAMS);si(s.width)||HL(s.width,"streamParameter.width"),si(s.height)||HL(s.height,"streamParameter.height"),si(s.framerate)||HL(s.framerate,"streamParameter.framerate"),si(s.bitrate)||vr(s.bitrate,"streamParameter.bitrate")})(t),(!t.width&&t.height||t.width&&!t.height)&&M.warning("[".concat(this._clientId,"] The width and height parameters take effect only when both are set")),M.info("[".concat(this._clientId,"] set low stream parameter to"),JSON.stringify(t));const r=this._configDistribute.getLowStreamConfigDistribute();if(r&&r.bitrate&&t.bitrate&&r.bitrate<t.bitrate&&(t.bitrate=r.bitrate),this._lowStreamParameter=t,this._isDualStreamEnabled)return this._p2pChannel.updateVideoStreamParameter(t,Xe.LocalVideoLowTrack)}async enableDualStream(){if(!Wn().supportDualStream)throw It.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!0,succ:!1}),new ke(te.NOT_SUPPORTED,"Your browser is not support dual stream");if(this._isDualStreamEnabled)throw new ke(te.INVALID_OPERATION,"Dual stream is already enabled");if(this._p2pChannel.canPublishLowStream())try{await this._publishLowStream()}catch(t){throw It.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!0,succ:!1}),t}this._isDualStreamEnabled=!0,It.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!0,succ:!0}),M.info("[".concat(this._clientId,"] enable dual stream"))}async disableDualStream(){if(this._isDualStreamEnabled){if(!this._joinInfo)throw new ke(te.INVALID_OPERATION,"Can't publish stream, haven't joined yet!");if(this._p2pChannel.getLocalMedia(Xe.LocalVideoLowTrack))try{const t=await this._p2pChannel.unpublishLowStream();t&&await this._gateway.unpublish(t,this._joinInfo.stringUid||this._joinInfo.uid)}catch(t){throw It.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!1,succ:!1}),t}this._isDualStreamEnabled=!1,It.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!1,succ:!0}),M.info("[".concat(this._clientId,"] disable dual stream"))}}async setClientRole(t,r){if((function(a){Zi(a,"role",["audience","host"])})(t),r&&YL(r),this.mode==="rtc"||this.mode==="p2p")throw M.warning("[".concat(this._clientId,"]").concat(this.mode," mode can not use setClientRole")),new ke(te.INVALID_OPERATION,"".concat(this.mode," mode can not use setClientRole"));if(r&&r.level&&t==="host")throw new ke(te.INVALID_OPERATION,"host mode can not set audience latency level");if(t==="audience"&&this._p2pChannel.hasLocalMedia())throw new ke(te.INVALID_OPERATION,"can not set client role to audience when publishing stream");const s=this._config.role;this._joinInfo&&(this._joinInfo.role=t),t!==s&&oe("ENABLE_ROLE_SELECT_EDGE")?(this._gateway.updateClientRole(t,r),this._config.role=t,this._gateway.reconnect("recover",Bs.REGIONAL_DISTRIBUTION)):(await this._gateway.setClientRole(t,r),this._config.role=t),M.info("[".concat(this._clientId,"] set client role to ").concat(t,", level: ").concat(r&&r.level))}async _setClientRoleOptions(t){if(this.mode==="rtc"||this.mode==="p2p"||this._config.role!=="audience"||this._p2pChannel.hasLocalMedia())return;let r=!1;try{t&&YL(t),await this._gateway.setClientRole(this._config.role,t),r=!0}catch{}finally{M.info("[".concat(this._clientId,"] set client role options ").concat(r?"succeed":"failed",", options is ").concat(t))}}getRemoteInboundOffset(){var t;const r=(t=this._p2pChannel.getStats())===null||t===void 0?void 0:t.audioSend[0];if(!r||!r.timestamp)return 0;const s=r.timestamp-Date.now();return Math.abs(s)>1e3+r.rttMs+100?this.ntpAlignErrorCount+=1:this.ntpAlignErrorCount=0,this.ntpAlignErrorCount>=3?s:0}getNtpWallTimeInMs(){return document.visibilityState==="visible"&&(this.remoteInboundOffset=this.getRemoteInboundOffset()),this.remoteInboundOffset+Date.now()+this._gateway.ntpOffset}setProxyServer(t,r){if(Rs(t,"proxyServer"),!r){if(this.connectionState!=="DISCONNECTED")throw new ke(te.INVALID_OPERATION,"Set proxy server before join channel");if(this._cloudProxyServerMode!=="disabled"||this._useLocalAccessPoint)throw new ke(te.INVALID_OPERATION,"You have already set the proxy")}this._proxyServer=t,It.setProxyServer(this._proxyServer),M.setProxyServer(this._proxyServer),M.info("[".concat(this._clientId,"] Set proxy server ").concat(r?"by initialize call":""," success."))}setTurnServer(t,r){if(Array.isArray(t)||(t=[t]),!r){if(this.connectionState!=="DISCONNECTED")throw new ke(te.INVALID_OPERATION,"Set turn server before join channel");if(this._cloudProxyServerMode!=="disabled"||this._useLocalAccessPoint)throw new ke(te.INVALID_OPERATION,"You have already set the proxy")}if(lT(t))return this._turnServer={servers:t,mode:"original-manual"},void M.info("[".concat(this._clientId,"] Set original turnserver ").concat(r?"by initialize call":""," success: ").concat(t.map((s=>s.urls)).join(","),"."));t.forEach((s=>v9(s))),this._turnServer={servers:t,mode:"manual"},M.info("[".concat(this._clientId,"] Set turnserver ").concat(r?"by initialize call":""," success."))}setLicense(t){if(this.connectionState!=="DISCONNECTED")throw new ke(te.INVALID_OPERATION,"you should set license before join channel");if(Rs(t,"license",32,32),!/^[A-Za-z\d]+$/.test(t))throw new ke(te.INVALID_PARAMS,"license should only contains characters from A-Z a-z 0-9");this._license=t,M.info("[".concat(this._clientId,"] set license success"),t)}startProxyServer(t){if(this.connectionState!=="DISCONNECTED")throw new ke(te.INVALID_OPERATION,"Start proxy server before join channel");if(this._proxyServer||this._turnServer.mode==="manual"||this._useLocalAccessPoint)throw new ke(te.INVALID_OPERATION,"You have already set the proxy");const r=[3,4,5];let s;switch(t===void 0&&(t=3),t){case 1:case 2:throw new ke(te.NOT_SUPPORTED,"proxy mode 1/2 has been deprecated and not supported.");case 3:s="proxy3";break;case 4:s="proxy4";break;case 5:s="proxy5";break;default:throw new ke(te.INVALID_PARAMS,"proxy server mode must be ".concat(r.join("|")))}this._cloudProxyServerMode=s,this.store.cloudProxyServerMode=s,M.info("[".concat(this._clientId,"] set cloud proxy server mode to"),this._cloudProxyServerMode)}stopProxyServer(){if(this.connectionState!=="DISCONNECTED")throw new ke(te.INVALID_OPERATION,"Stop proxy server after leave channel");It.setProxyServer(),M.setProxyServer(),this._cloudProxyServerMode="disabled",this.store.cloudProxyServerMode="disabled",M.info("[".concat(this._clientId,"] set cloud proxy server mode to"),this._cloudProxyServerMode),this._proxyServer=void 0,this._turnServer={mode:"auto",servers:[]}}setLocalAccessPointsV2(t){if(!t.accessPoints)throw new ke(te.INVALID_PARAMS,"accessPoints is required.");Sf(t.accessPoints.serverList,"accessPoints.serverList"),Rs(t.accessPoints.domain,"accessPoints.domain");const r=(A,N)=>{vr(A,N,0,65535,!0)};let s=443;if(t.accessPoints.port&&(r(t.accessPoints.port,"accessPoints.port"),s=t.accessPoints.port),this._proxyServer||this._cloudProxyServerMode!=="disabled")throw new ke(te.INVALID_OPERATION,"set local access point failed, You have already set the cloud proxy");oe("CLOSE_AFB_FOR_LOCAL_AP")&&(gr("JOIN_WITH_FALLBACK_SIGNAL_PROXY",!1),gr("JOIN_WITH_FALLBACK_MEDIA_PROXY",!1));const a=/^((\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.){3}(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])$/,c=t.accessPoints.domain,d=t.accessPoints.serverList.map((A=>a.test(A)?"".concat(A.replace(/\./g,"-"),".").concat(c):A)),h=d.map((A=>"".concat(A,":").concat(s)));this._useLocalAccessPoint=!0,this._setLocalAPVersion=2,gr("WEBCS_DOMAIN",h),gr("WEBCS_DOMAIN_BACKUP_LIST",h),gr("GATEWAY_DOMAINS",[c]),t.report&&t.report.hostname&&Array.isArray(t.report.hostname)&&t.report.hostname.length?(Sf(t.report.hostname,"report.hostname"),gr("EVENT_REPORT_DOMAIN",t.report.hostname[0]),gr("EVENT_REPORT_BACKUP_DOMAIN",t.report.hostname[1]||t.report.hostname[0])):(gr("EVENT_REPORT_DOMAIN",d[0]),gr("EVENT_REPORT_BACKUP_DOMAIN",d[1]||d[0]));let m=6443;t.report&&t.report.port&&(r(t.report.port,"report.port"),m=t.report.port),gr("STATS_COLLECTOR_PORT",m),t.report?gr("ENABLE_EVENT_REPORT",!0):gr("ENABLE_EVENT_REPORT",!1);let g="";t.log&&t.log.hostname&&Array.isArray(t.log.hostname)&&t.log.hostname.length?(Sf(t.log.hostname,"log.hostname"),g=t.log.hostname[0]):g=d[0];let v=6444;t.log&&t.log.port&&(r(t.log.port,"log.port"),v=t.log.port),gr("LOG_UPLOAD_SERVER","".concat(g,":").concat(v));let w=[];t.cds&&t.cds.hostname&&Array.isArray(t.cds.hostname)&&t.cds.hostname.length?(Sf(t.cds.hostname,"cds.hostname"),w=t.cds.hostname):w=d;let I=443;t.cds&&t.cds.port&&(r(t.cds.port,"cds.port"),I=t.cds.port),gr("CDS_AP",w.map((A=>"".concat(A,":").concat(I)))),t.cds?gr("ENABLE_CONFIG_DISTRIBUTE",!0):gr("ENABLE_CONFIG_DISTRIBUTE",!1),M.info("set local access point v2 success")}setLocalAccessPoints(t,r){if(Sf(t,"serverList"),Rs(r,"domain"),this._proxyServer||this._cloudProxyServerMode!=="disabled")throw new ke(te.INVALID_OPERATION,"set local access point failed, You have already set the cloud proxy");const s=/^(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])$/;t=t.map((a=>s.test(a)?"".concat(a.replace(/\./g,"-"),".").concat(r):a)),this._useLocalAccessPoint=!0,this._setLocalAPVersion=1,gr("WEBCS_DOMAIN",t),gr("WEBCS_DOMAIN_BACKUP_LIST",t),gr("GATEWAY_DOMAINS",[r]),gr("EVENT_REPORT_DOMAIN",t[0]),gr("EVENT_REPORT_BACKUP_DOMAIN",t[1]||t[0]),gr("LOG_UPLOAD_SERVER","".concat(t[0],":6444")),M.info("[".concat(this._clientId,"] set local access point success"))}async setRemoteDefaultVideoStreamType(t){if(Zi(t,"streamType",[0,1,4,5,6,7,8,9]),this._remoteDefaultVideoStreamType=t,this._joinInfo)try{await this._gateway.setDefaultRemoteVideoStreamType(t),this._joinInfo.defaultVideoStream=this._remoteDefaultVideoStreamType}catch(r){throw M.error("[".concat(this._clientId,"] set default remote video stream type error"),r.toString()),r}else M.debug("[".concat(this._clientId,"] haven't joined yet, cache remoteDefaultVideoStreamType ").concat(t))}async setRemoteVideoStreamType(t,r){Zi(r,"streamType",[0,1,4,5,6,7,8,9]);try{await this._gateway.setRemoteVideoStreamType(t,r),setTimeout((()=>{const s=this._users.find((a=>a.uid===t));s&&s.videoTrack&&s.videoTrack.updateMediaStreamTrackResolution()}),2e3)}catch(s){throw M.error("[".concat(this._clientId,"] set remote video stream type error"),s.toString()),s}M.info("[".concat(this._clientId,"] set remote ").concat(t," video stream type to ").concat(r)),this._remoteStreamTypeCacheMap.set(t,r)}async setStreamFallbackOption(t,r){Zi(r,"fallbackType",[0,1,2,3,4,5,6,7,8]);try{await this._gateway.setStreamFallbackOption(t,r)}catch(s){throw M.error("[".concat(this._clientId,"] set stream fallback option"),s.toString()),s}M.info("[".concat(this._clientId,"] set remote ").concat(t," stream fallback type to ").concat(r)),this._streamFallbackTypeCacheMap.set(t,r)}setEncryptionConfig(t,r,s,a){(function(d){Zi(d,"encryptionMode",["aes-128-xts","aes-256-xts","aes-128-ecb","sm4-128-ecb","aes-128-gcm","aes-256-gcm","aes-128-gcm2","aes-256-gcm2","none"])})(t),Rs(r,"secret");const c=["aes-128-gcm2","aes-256-gcm2"];if(rt(c).call(c,t)){if(!s||!(s instanceof Uint8Array&&s.length===32))throw new ke(te.INVALID_PARAMS,"salt must be an Uint8Array and exactly equal to 32 bytes")}else if(s)throw new ke(te.INVALID_PARAMS,"current encrypt mode does not need salt");if(a){if(Yd(a,"encryptDataStream"),!rt(c).call(c,t))throw new ke(te.INVALID_PARAMS,"current encrypt mode does not support data stream");this._encryptDataStream=!0}new RegExp(`^(?=.*[a-z])(?=.*[A-Z])(?=.*[0-9])(?=.*[!@#$%^&*,.<>?/:;'"|{}\\[\\]])(?=.{8,})`).test(r)||M.warning(`The secret is not strong:
      The secret must contain at least 1 lowercase alphabetical character,
      The secret must contain at least 1 uppercase alphabetical character,
      The secret must contain at least 1 numeric character,
      The secret must contain at least one special character,
      The secret must be eight characters or longer.
      `),this._encryptionMode=t,this._encryptionSecret=r,s&&(this._encryptionSalt=Qm(s))}async renewToken(t){if(Rs(t,"token",1,2047),!this._key||!this._joinInfo)throw new ke(te.INVALID_OPERATION,"renewToken should not be called before user join");const r=this._key;this._key=t,this._joinInfo&&(this._joinInfo.token=t);const s=await this._renewTokenMutex.lock();try{if(oe("USE_NEW_TOKEN")){M.debug("[".concat(this._clientId,"] start renew token with ticket from unilbs"));const a=await A_e(this._joinInfo,this._axiosCancelSource.token,this._config.httpRetryConfig||Vi);M.debug("[".concat(this._clientId,"] get ticket from unilbs success")),await this._gateway.renewToken({token:t,ticket:a})}else M.debug("[".concat(this._clientId,"] start renew token without ticket")),await this._gateway.renewToken({token:t});M.debug("[".concat(this._clientId,"] renewToken success"))}catch(a){throw this._key=r,this._joinInfo.token=r,M.error("[".concat(this._clientId,"] renewToken failed"),a.toString()),a}finally{s()}}enableAudioVolumeIndicator(){this._audioVolumeIndicationInterval?M.warning("you have already enabled audio volume indicator!"):this._audioVolumeIndicationInterval=window.setInterval((()=>{const t=this._p2pChannel.getAudioLevels();this.safeEmit(Pn.VOLUME_INDICATOR,t)}),oe("AUDIO_VOLUME_INDICATION_INTERVAL")||2e3)}getRTCStats(){const t=this._statsCollector.getRTCStats(),r=this._gateway.getInChannelInfo();return t.Duration=Math.round(r.duration/1e3),t}async startLiveStreaming(t,r){if(!r){if(this.codec!=="h264")throw new ke(te.LIVE_STREAMING_INVALID_RAW_STREAM,"raw streaming is only support h264");if(!this._p2pChannel.hasLocalMedia())throw new ke(te.LIVE_STREAMING_INVALID_RAW_STREAM,"can not find stream to raw streaming")}if(this._liveRawStreamingClient&&this._liveRawStreamingClient.hasUrl(t)||this._liveTranscodeStreamingClient&&this._liveTranscodeStreamingClient.hasUrl(t))throw new ke(te.LIVE_STREAMING_TASK_CONFLICT);const s=r?bf.TRANSCODE:bf.RAW;return this._createLiveStreamingClient(s).startLiveStreamingTask(t,s)}setLiveTranscoding(t){return this._createLiveStreamingClient(bf.TRANSCODE).setTranscodingConfig(t)}async stopLiveStreaming(t){const r=[this._liveRawStreamingClient,this._liveTranscodeStreamingClient].filter((s=>s&&s.hasUrl(t)));if(!r.length)throw new ke(te.INVALID_PARAMS,"can not find live streaming url to stop");await mt.all(r.map((s=>s&&s.stopLiveStreamingTask(t))))}async startChannelMediaRelay(t){aH(t),await this._createChannelMediaRelayClient().startChannelMediaRelay(t)}async updateChannelMediaRelay(t){aH(t),await this._createChannelMediaRelayClient().updateChannelMediaRelay(t)}async stopChannelMediaRelay(){await this._createChannelMediaRelayClient().stopChannelMediaRelay(),this._statsCollector.onStatsChanged&&(this._statsCollector.onStatsChanged=void 0)}sendAudioMetadata(t){this._p2pChannel instanceof kT&&this._p2pChannel.addAudioMetadata(t)}async sendStreamMessage(t){var r;let s=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1];if(!this._joinInfo)throw new ke(te.INVALID_OPERATION,"can not send data stream, not joined");if((typeof t=="string"||t instanceof Uint8Array)&&(t={payload:t}),typeof t.payload=="string"){const c=new TextEncoder;t.payload=c.encode(t.payload)}let a=!1;if(this._encryptDataStream&&this._encryptDataStreamIv&&this._encryptDataStreamKey&&window.crypto.subtle&&rt(r=["aes-128-gcm2","aes-256-gcm2"]).call(r,this._encryptionMode)&&(a=!0,t.payload=await(async function(c,d,h){var m;const g=Xa(m=Array.from(h)).call(m,((B,z)=>B+z),0),v={serverTs:0,seq:Yme++,length:h.length,checkSum:g},w=new Uint8Array(A9(g,2)),I=new ArrayBuffer(s0),A=new DataView(I);A.setUint32(0,v.serverTs),A.setUint16(4,v.seq),A.setUint16(6,v.length),A.setUint16(8,v.checkSum);const N=16-h.length%16;h=w9(h,new Uint8Array(N));const H=await window.crypto.subtle.encrypt({name:"AES-GCM",iv:c,tagLength:B9,additionalData:w},d,h);return w9(new Uint8Array(I),new Uint8Array(H))})(this._encryptDataStreamIv,this._encryptDataStreamKey,t.payload)),new Blob([t.payload]).size>1024)throw new ke(te.INVALID_PARAMS,a?"encrypted stream message out of range.":"stream message out of range.");return this._gateway.signal.request(Qt.DATA_STREAM,{payload:Qm(t.payload),syncWithAudio:t.syncWithAudio,sendTs:Date.now()-M_e},!s)}sendMetadata(t){if(!this._joinInfo)throw new ke(te.INVALID_OPERATION,"can not send metadata, not joined");if(new Blob([t]).size>1024)throw new ke(te.METADATA_OUT_OF_RANGE);return this._gateway.signal.request(Qt.SEND_METADATA,{session_id:this._joinInfo.sid,metadata:Qm(t)})}async sendCustomReportMessage(t){if(Array.isArray(t)||(t=[t]),t.forEach(ige),!this._joinInfo)throw new ke(te.INVALID_OPERATION,"can not send custom report, not joined");await It.sendCustomReportMessage(this._joinInfo.sid,t)}getLocalAudioStats(){return this._statsCollector.getLocalAudioTrackStats()}getRemoteAudioStats(){return this._statsCollector.getRemoteAudioTrackStats()}getLocalVideoStats(){return this._statsCollector.getLocalVideoTrackStats()}getRemoteVideoStats(){return this._statsCollector.getRemoteVideoTrackStats()}getRemoteNetworkQuality(){const t=this._statsCollector.getRemoteNetworkQualityStats();if(oe("DELETE_NEQ_AFTER_USER_LEAVE")){const r=this._users.map((s=>s.uid+""));Object.keys(t).forEach((s=>{rt(r).call(r,s)||delete t[s]}))}return t}async pickSVCLayer(t,r){Zi(r.spatialLayer,"spatialLayer",[0,1,2,3]),Zi(r.temporalLayer,"temporalLayer",[0,1,2,3]);try{await this._gateway.pickSVCLayer(t,r)}catch(s){throw M.error("[".concat(this._clientId,"] pick SVC layer failed"),s.toString()),s}}async setRTMConfig(t){const{apRTM:r=!1,rtmFlag:s}=t;if(Yd(r,"apRTM"),vr(s,"rtmFlag",0),this._rtmConfig.apRTM=r,this._rtmConfig.rtmFlag=s,M.debug("[".concat(this._clientId,"] setRTMconfig ").concat(JSON.stringify(t)," in ").concat(this.connectionState," state")),(this.connectionState==="CONNECTED"||this.connectionState==="RECONNECTING")&&this._joinInfo)return this._joinInfo.apRTM=r,this._joinInfo.rtmFlag=s,this._gateway.setRTM2Flag(s)}_reset(){if(M.debug("[".concat(this._clientId,"] reset client")),(function(t){const r=_0.indexOf(t);r!==-1&&_0.splice(r,1)})(this._clientId),this.store.hasStartJoinChannel=!1,this.store.isABTestSuccess=!1,this.store.autoSubscribe=!1,this._axiosCancelSource.cancel(),this._axiosCancelSource=Na.CancelToken.source(),this._streamFallbackTypeCacheMap=new Map,this._remoteStreamTypeCacheMap=new Map,this._configDistribute.stopGetConfigDistribute(),this._joinInfo&&xH(this._joinInfo),this._joinInfo=void 0,this._proxyServer=void 0,this._defaultStreamFallbackType=void 0,this._sessionId&&It.removeSid(this._sessionId),this._sessionId=null,this.store.sessionId=null,this.store.resetFirstVideoFrameDecoded(),this._statsCollector.reset(),this._key=void 0,this._appId=void 0,this._uid=void 0,this.store.uid=void 0,this._channelName=void 0,this._encryptionMode="none",this._encryptionSecret=null,this._encryptionSalt=null,this._encryptDataStreamKey=null,this._encryptDataStreamIv=null,this._pendingPublishedUsers=[],this._users.forEach((t=>{t._audioTrack&&t._audioTrack._destroy(),t._videoTrack&&t._videoTrack._destroy(),t._dataChannels&&(t._dataChannels.forEach((r=>r._close())),t._dataChannels.length=0)})),this._users=[],this._audioVolumeIndicationInterval&&(window.clearInterval(this._audioVolumeIndicationInterval),this._audioVolumeIndicationInterval=void 0),this._cloudProxyServerMode==="fallback"&&(this._cloudProxyServerMode="disabled",this.store.cloudProxyServerMode="disabled"),this._p2pChannel.reset(),this._publishMutex=new so("client-publish",this._clientId),this._subscribeMutex=new so("client-subscribe",this._clientId),this._networkQualityInterval&&(window.clearInterval(this._networkQualityInterval),this._networkQualityInterval=void 0),this._liveRawStreamingClient&&(this._liveRawStreamingClient.terminate(),this._liveRawStreamingClient.removeAllListeners(),this._liveRawStreamingClient=void 0),this._liveTranscodeStreamingClient&&(this._liveTranscodeStreamingClient.terminate(),this._liveTranscodeStreamingClient.removeAllListeners(),this._liveTranscodeStreamingClient=void 0),this._channelMediaRelayClient&&(this._channelMediaRelayClient.dispose(),this._channelMediaRelayClient=void 0),this._inspect)try{this._inspect.close(),this._inspect=void 0}catch{}if(this._moderation)try{this.setImageModeration(!1)}catch{}}_startSession(t,r){var s;const a=t||sy();t?M.debug("[".concat(this._clientId,"] new Session ").concat(a)):M.debug("[".concat(this._clientId,"] renewSession ").concat(this._sessionId," => ").concat(a));const c=t?"":this._sessionId||"";this._sessionId=a,this.store.sessionId=a,It.addSid(a);const d={lts:new Date().getTime(),mode:this.mode,buildFormat:1,stringUid:(r==null?void 0:r.stringUid)||((s=this._joinInfo)===null||s===void 0?void 0:s.stringUid),channelProfile:this.mode==="live"?1:0,channelMode:0,isABTestSuccess:Number(this._configDistribute.isSuccess),lsid:c,clientRole:this.role==="audience"?2:1};It.sessionInit(this._sessionId,ed({cname:r.channel,appid:r.appId},d)),this._joinInfo&&(this._joinInfo.sid=a),this._gateway.joinInfo&&(this._gateway.joinInfo.sid=a)}async _publishHighStream(t){if(!this._joinInfo||this._uid===void 0)throw new ke(te.INVALID_OPERATION,"Can't publish stream, haven't joined yet!");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new ke(te.INVALID_OPERATION,"can not publish stream in ".concat(this.connectionState," state"));if(this._turnServer.mode==="auto"&&oe("FORCE_TURN")&&!oe("TURN_ENABLE_TCP")&&!oe("TURN_ENABLE_UDP"))throw new ke(te.UNEXPECTED_ERROR,"force TURN With No TURN Configuration");M.debug("[".concat(this._clientId,"] publish high stream"));try{const s=await this._p2pChannel.publish(t,this._isDualStreamEnabled,this._lowStreamParameter);if(this.store.useP2P){const a=(await s.next()).value;if(a){try{await this._gateway.sendExtensionMessage(bi.PUBLISH,a,!0)}catch(c){throw s.throw(c),c}await s.next()}this._p2pChannel.reportPublishEvent(!0,null)}else{const a=(await s.next()).value;if(a){var r;let c;try{c=await this._gateway.publish(this._uid,a,!0)}catch(d){if(d.code!==te.DISCONNECT_P2P)throw s.throw(d),d}await s.next(((r=c)===null||r===void 0?void 0:r.ortc)||[])}this._p2pChannel.reportPublishEvent(!0,null);for(const c of t)c instanceof Nr&&c._encoderConfig&&this._gateway.setVideoProfile(c._encoderConfig).catch((d=>{M.debug("[".concat(this._clientId,"] stop setVideoProfile, because websocket is closed"))})),!c.muted&&c.enabled||await this._p2pChannel.muteLocalTrack(c)}}catch(s){if(this._p2pChannel.reportPublishEvent(!1,s==null?void 0:s.code,t),(s==null?void 0:s.code)===te.WS_ABORT)return;throw s}}async _publishLowStream(){if(!this._joinInfo||this._uid===void 0)throw new ke(te.INVALID_OPERATION,"Can't publish stream, haven't joined yet!");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new ke(te.INVALID_OPERATION,"can not publish stream in ".concat(this.connectionState," state"));M.debug("[".concat(this._clientId,"] publish low stream"));const t=this._configDistribute.getLowStreamConfigDistribute();t&&t.bitrate&&(this._lowStreamParameter||(this._lowStreamParameter={width:160,height:120,framerate:15,bitrate:50}),this._lowStreamParameter&&this._lowStreamParameter.bitrate&&t.bitrate<this._lowStreamParameter.bitrate&&(this._lowStreamParameter.bitrate=t.bitrate));try{const s=await this._p2pChannel.publishLowStream(this._lowStreamParameter),a=(await s.next()).value;if(a){var r;let c;try{c=await this._gateway.publish(this._uid,a,!0)}catch(d){if(d.code!==te.DISCONNECT_P2P)throw s.throw(d),d}s.next(((r=c)===null||r===void 0?void 0:r.ortc)||[]),this._p2pChannel.reportPublishEvent(!0,null,void 0,!0)}}catch(s){if(this._p2pChannel.reportPublishEvent(!1,s==null?void 0:s.code,void 0,!0),(s==null?void 0:s.code)===te.WS_ABORT)return;throw s}}_createLiveStreamingClient(t){const r=()=>{if(!this._joinInfo||!this._appId)return new ke(te.INVALID_OPERATION,"can not create live streaming client, please join channel first").throw();const s=(a={joinInfo:this._joinInfo,appId:this._appId,websocketRetryConfig:this._config.websocketRetryConfig,httpRetryConfig:this._config.httpRetryConfig},Cf("LiveStreaming").create(a));var a;return s.onLiveStreamError=(c,d)=>{It.reportApiInvoke(this._sessionId,{name:pi.ON_LIVE_STREAM_ERROR,options:[c,d],tag:$r.TRACER}).onSuccess(),this.safeEmit(Pn.LIVE_STREAMING_ERROR,c,d)},s.onLiveStreamWarning=(c,d)=>{It.reportApiInvoke(this._sessionId,{name:pi.ON_LIVE_STREAM_WARNING,options:[c,d],tag:$r.TRACER}).onSuccess(),this.safeEmit(Pn.LIVE_STREAMING_WARNING,c,d)},s.on(W2.REQUEST_WORKER_MANAGER_LIST,((c,d,h)=>{if(!this._joinInfo)return h(new ke(te.INVALID_OPERATION,"can not find join info to get worker manager"));(async function(m,g,v,w){const I=oe("UAP_AP").slice(0,oe("AJAX_REQUEST_CONCURRENT")).map((A=>g.proxyServer?"https://".concat(g.proxyServer,"/ap/?url=").concat(A+"/api/v1?action=uap"):"https://".concat(A,"/api/v1?action=uap")));return await S_e(I,m,g,v,w)})(c,this._joinInfo,this._axiosCancelSource.token,Vi).then(d).catch(h)})),s};return t===bf.RAW?(this._liveRawStreamingClient=this._liveRawStreamingClient||r(),this._liveRawStreamingClient):(this._liveTranscodeStreamingClient=this._liveTranscodeStreamingClient||r(),this._liveTranscodeStreamingClient)}_createChannelMediaRelayClient(){if(!this._joinInfo)return new ke(te.INVALID_OPERATION,"can not create channel media relay client, please join channel first").throw();if(!this._channelMediaRelayClient){const{sendResolutionWidth:r,sendResolutionHeight:s}=this.getLocalVideoStats(),a=(t={joinInfo:this._joinInfo,clientId:this._clientId,websocketRetryConfig:this._config.websocketRetryConfig,httpRetryConfig:this._config.httpRetryConfig,resolution:{width:r,height:s}},Cf("ChannelMediaRelay").create(t));a.on("state",(c=>{c===ic.RELAY_STATE_FAILURE&&a&&a.dispose(),this.safeEmit(Pn.CHANNEL_MEDIA_RELAY_STATE,c)})),a.on("event",(c=>{this.safeEmit(Pn.CHANNEL_MEDIA_RELAY_EVENT,c)})),this._channelMediaRelayClient=a,this._statsCollector.onStatsChanged=(c,d)=>{var h;c==="resolution"&&((h=this._channelMediaRelayClient)===null||h===void 0||h.setVideoProfile(d))}}var t;return this._channelMediaRelayClient}_handleUpdateDataChannel(t,r){const{added:s,deleted:a}=t,c=[];if(r){const d=[];this._users.forEach((h=>{h._dataChannels.forEach((m=>{s.every((g=>g.uid!==h._uintid||g.stream_id!==m.id))&&d.push({uid:h._uintid,stream_id:m.id,ordered:m.ordered,max_retrans_times:m.maxRetransmits,metadata:m.metadata})}))})),d.length>0&&this._handleUpdateDataChannel({added:[],deleted:d})}Array.isArray(s)&&s.length>0&&s.forEach((d=>{const{uid:h,stream_id:m,ordered:g,max_retrans_times:v,metadata:w}=d,I=this._users.find((A=>A._uintid===h));if(!I)return void M.error("[".concat(this._clientId,"] can not find target user!(on_add_data_channel)"));if(M.debug("[".concat(this._clientId,"] data_channel added with uid ").concat(h)),rt(c).call(c,I)||c.push(I),I._uintid||(I._uintid=h),I._dataChannels.findIndex((A=>A.id===d.stream_id))===-1){const A={id:m,ordered:!!g,maxRetransmits:v,metadata:w},N=(function(H){return H7(H,!0)})(A);I._dataChannels.push(N),M.info("[".concat(this._clientId,"] remote user ").concat(I.uid," published datachannel")),r||this.safeEmit(Pn.USER_PUBLISHED,I,"datachannel",A)}this._p2pChannel.hasPendingRemoteDataChannel(I,d.stream_id)&&(M.debug("[".concat(this._clientId,"] resubscribe datachannel for user ").concat(I.uid," after reconnect.")),this._subscribeDataChannel(I,d.stream_id).catch((A=>{M.error("[".concat(this._clientId,"] resubscribe datachannel error"),A.toString())})))})),r&&(this.safeEmit(Pn.PUBLISHED_USER_LIST,this._pendingPublishedUsers),this._pendingPublishedUsers=[]),Array.isArray(a)&&a.length>0&&a.forEach((d=>{const{uid:h,stream_id:m}=d,g=this._users.find((w=>w._uintid===h));if(!g)return void M.error("[".concat(this._clientId,"] can not find target user!(on_delete_data_channel)"));const v=g._dataChannels.find((w=>w.id===d.stream_id));v&&(M.debug("[".concat(this._clientId,"] data_stream delete with uid ").concat(h)),this._p2pChannel.unsubscribeDataChannel(g,[v]).then((w=>{if(g._dataChannels=g._dataChannels.filter((I=>I!==v)),w)return this._gateway.unsubscribeDataChannel(w,g.uid)})),M.info("[".concat(this._clientId,"] remote user ").concat(h," unpublished datachannel ,id:").concat(v.id)),this.safeEmit(Pn.USER_UNPUBLISHED,g,"datachannel",v._config))}))}_getEncodingName(t){var r;if(!this._joinResponse)return;const s=(r=this._joinResponse.ortc.rtpCapabilities.sendrecv)===null||r===void 0?void 0:r.videoCodecs;if(s)for(const c of s){var a;if(c.payloadType===t)return c==null||(a=c.rtpMap)===null||a===void 0?void 0:a.encodingName}}_handleRemoveDataChannels(t){const r=this._users.find((s=>s.uid===t.uid));if(r){if(r._dataChannels!==void 0&&r._dataChannels.length>0){M.debug("[".concat(this._clientId,"] datachannel removed with uid ").concat(t.uid));const s=()=>{M.info("[".concat(this._clientId,"] remote user ").concat(r.uid," unpublished datachannel")),r._dataChannels.forEach((a=>{this.safeEmit(Pn.USER_UNPUBLISHED,r,"datachannel",a._config)}))};this._p2pChannel.unsubscribeDataChannel(r,r._dataChannels).then((a=>{if(a)return this._gateway.unsubscribeDataChannel(a,r.uid)})),s()}}else M.warning("[".concat(this._clientId,"] can not find target user!(on_remove_datachannel)"))}_handleGatewayEvents(){this._gateway.on(ps.UPDATE_GATEWAY_CONFIG,(()=>{(function(){let t;try{t=window.localStorage.getItem("websdk_ng_global_parameter")}catch(r){return void M.error("Error loading sdk config",r.message)}if(t)try{const r=JSON.parse(window.atob(t)),s=Date.now();Object.keys(r).forEach((a=>{const{value:c,type:d,expires:h}=r[a];h&&h<=s||d||M2()||!Object.prototype.hasOwnProperty.call(N1,a)||(Jd[a]=c,Fr[a]=c,M.debug("Update gateway parameters from config distribute",a,c))}))}catch(r){M.error("Error update config from local cache",r.message)}})()})),this._gateway.on(ps.DISCONNECT_P2P,(async()=>{await this._p2pChannel.disconnectForReconnect()})),this._gateway.on(ps.CONNECTION_STATE_CHANGE,((t,r,s)=>{var a;if(s===or.FALLBACK)return;const c=()=>{this.safeEmit(Pn.CONNECTION_STATE_CHANGE,t,r,s)};if(It.reportApiInvoke(this._sessionId||((a=this._gateway.joinInfo)===null||a===void 0?void 0:a.sid)||null,{name:pi.CONNECTION_STATE_CHANGE,options:[t,r,s],tag:$r.TRACER}).onSuccess(JSON.stringify({cur:t,prev:r,reason:s})),M.info("[".concat(this._clientId,"] signal connection state change: ").concat(r," -> ").concat(t)),t==="DISCONNECTED")return this._reset(),void c();if(t==="RECONNECTING")this._users.forEach((h=>{h._trust_in_room_=!1,h._trust_audio_enabled_state_=!1,h._trust_video_enabled_state_=!1,h._trust_audio_mute_state_=!1,h._trust_video_mute_state_=!1,h._trust_audio_stream_added_state_=!1,h._trust_video_stream_added_state_=!1,h._is_pre_created||(h._audio_pre_subscribed||(h._audioSSRC=void 0,h._audioOrtc=void 0),h._video_pre_subscribed||(h._videoSSRC=void 0,h._videoOrtc=void 0,h._rtxSsrcId=void 0),h._cname=void 0)})),this._userOfflineTimeout&&window.clearTimeout(this._userOfflineTimeout),this._streamRemovedTimeout&&window.clearTimeout(this._streamRemovedTimeout),this._userOfflineTimeout=void 0,this._streamRemovedTimeout=void 0;else if(t==="CONNECTED"){var d;this._streamFallbackTypeCacheMap.forEach(((h,m)=>{this._gateway.setStreamFallbackOption(m,h).catch((g=>{M.warning("[".concat(this._clientId,"] auto set stream fallback option failed"),g)}))})),this._remoteStreamTypeCacheMap.forEach(((h,m)=>{this._gateway.setRemoteVideoStreamType(m,h).catch((g=>{M.warning("[".concat(this._clientId,"] auto set remote stream type failed"),g)}))})),this._remoteDefaultVideoStreamType!==void 0&&((d=this._joinInfo)===null||d===void 0?void 0:d.defaultVideoStream)===void 0&&this.setRemoteDefaultVideoStreamType(this._remoteDefaultVideoStreamType).then((()=>{M.debug("[".concat(this._clientId,"] setRemoteDefaultVideoStreamType after gateway connected"))})).catch((h=>{M.error("[".concat(this._clientId,"] setRemoteDefaultVideoStreamType after gateway failed, ").concat(h))})),this.store.useP2P||(this._p2pChannel.republish(),this._userOfflineTimeout=window.setTimeout((()=>{this.connectionState==="CONNECTED"&&(this._userOfflineTimeout=void 0,this._users.filter((h=>!h._trust_in_room_)).forEach((h=>{M.debug("[".concat(this._clientId,"] user offline timeout, emit user offline ").concat(h.uid)),this._handleUserOffline({uid:h.uid})})))}),3e3),this._streamRemovedTimeout=window.setTimeout((()=>{this.connectionState==="CONNECTED"&&(this._streamRemovedTimeout=void 0,this._users.forEach((h=>{h._trust_audio_mute_state_||(M.debug("[".concat(this._clientId,"] auto dispatch audio unmute event ").concat(h.uid)),this._handleMuteStream(h.uid,St.AUDIO,!1)),h._trust_video_mute_state_||(M.debug("[".concat(this._clientId,"] auto dispatch video unmute event ").concat(h.uid)),this._handleMuteStream(h.uid,St.VIDEO,!1)),h._trust_audio_enabled_state_||(M.debug("[".concat(this._clientId,"] auto dispatch enable local audio ").concat(h.uid)),this._handleSetStreamLocalEnable("audio",h.uid,!0)),h._trust_video_enabled_state_||(M.debug("[".concat(this._clientId,"] auto dispatch enable local video ").concat(h.uid)),this._handleSetStreamLocalEnable("video",h.uid,!0)),h._trust_video_stream_added_state_||(M.debug("[".concat(this._clientId,"] auto dispatch reset video stream added ").concat(h.uid)),this._handleResetAddStream(h,"video")),h._trust_audio_stream_added_state_||(M.debug("[".concat(this._clientId,"] auto dispatch reset audio stream added ").concat(h.uid)),this._handleResetAddStream(h,"audio")),h._video_added_||h._audio_added_||(M.debug("[".concat(this._clientId,"] auto dispatch stream remove ").concat(h.uid)),this._handleRemoveStream({uid:h.uid,uint_id:h._uintid}))})))}),1e3))}c()})),this._gateway.on(ps.REQUEST_NEW_GATEWAY_LIST,(async(t,r)=>{if(!this._joinInfo)return r(new ke(te.UNEXPECTED_ERROR,"can not recover, no join info"));try{let s;const a=await kH(ed(ed({},this._joinInfo),{},{uid:this._joinInfo.uid,stringUid:void 0}));a?(s=a.ap,DH(a),this._joinInfo.preload=!0):(s=await sM(this._joinInfo,this._axiosCancelSource.token,this._config.httpRetryConfig||Vi,this.store),this._joinInfo.preload=!1),this._joinInfo&&(this._joinInfo.apResponse=s.gatewayInfo.res,this._joinInfo.gatewayAddrs=s.gatewayInfo.gatewayAddrs,this._joinInfo.uni_lbs_ip=s.gatewayInfo.uni_lbs_ip);const c=[];s.gatewayInfo.gatewayAddrs.forEach((d=>{let{address:h}=d;const[m,g]=h.split(":");this._joinInfo&&this._joinInfo.proxyServer?c.push({proxy:this._joinInfo.proxyServer,host:m,port:g}):c.push({host:m,port:g})})),t(c)}catch(s){r(s)}})),this._gateway.on(ps.NETWORK_QUALITY,(t=>{this._networkQualitySensitivity==="normal"&&this.safeEmit(Pn.NETWORK_QUALITY,t)})),this._gateway.on(ps.STREAM_TYPE_CHANGE,((t,r)=>{this.safeEmit(Pn.STREAM_TYPE_CHANGED,t,r),It.reportApiInvoke(this._sessionId,{name:pi.STREAM_TYPE_CHANGE,options:[t,r],tag:$r.TRACER}).onSuccess(JSON.stringify({uid:t,streamType:r}))})),this._gateway.isPreSub=()=>"isPreSub"in this._p2pChannel&&this._p2pChannel.isPreSub(),this._gateway.isPreallocation=()=>"isPreallocation"in this._p2pChannel&&this._p2pChannel.isPreallocation(),this._gateway.on(ps.IS_P2P_DISCONNECTED,(t=>{this._p2pChannel.isP2PDisconnected()?t(!0):this._p2pChannel.hasLocalMedia()||this._p2pChannel.hasRemoteMedia()?t(!1):t(!0)})),this._gateway.on(ps.REQUEST_P2P_CONNECTION_PARAMS,(async(t,r,s)=>{try{let a=await this._p2pChannel.getEstablishParams();a&&"isPreallocation"in this._p2pChannel&&this._p2pChannel.isPreallocation()||(a=await this._p2pChannel.startP2PConnection(t)),r(a)}catch(a){s(a)}})),this._gateway.on(ps.JOIN_RESPONSE,((t,r)=>{if(this.store.useP2P)return;let s;this._joinResponse=t,t.attributes?s=t.attributes.userAttributes.preSubSsrcs:M.debug("no attributes in joinResponse");const a=x7(t.ortc,r,s);this._p2pChannel.connect(a)})),this._gateway.on(ps.PRE_CONNECT_PC,(async t=>{const{candidates:r,fingerprint:s,turnServer:a}=t;if(this._joinInfo&&r.length>0&&!this._p2pChannel.isPlanB){const{cert:d,cid:h}=this._joinInfo.apResponse,m="".concat(h,"_").concat(d);if(m.length<4||m.length>256)return;await this._p2pChannel.startP2PConnection({turnServer:a,cloudProxyServer:this._joinInfo.cloudProxyServer,isPreallocation:!0});try{var c;await this._p2pChannel.connect({iceParameters:{iceUfrag:"".concat(h,"_").concat(d),icePwd:"".concat(h,"_").concat(d)},dtlsParameters:{fingerprints:[{hashFunction:"sha-256",fingerprint:(c=oe("FINGERPRINT"))!==null&&c!==void 0?c:s}]},candidates:r,rtpCapabilities:{send:{audioCodecs:[],videoCodecs:[],audioExtensions:[],videoExtensions:[]},recv:{audioCodecs:[],videoCodecs:[],audioExtensions:[],videoExtensions:[]}},setup:"active",cname:"o/i14u9pJrxRKAsu",preallocation:!0})}catch(g){g.code&&g.code===te.EXCHANGE_SDP_FAILED&&await this._p2pChannel.startP2PConnection({turnServer:a,cloudProxyServer:this._joinInfo.cloudProxyServer},!0)}}}))}_handleGatewaySignalEvents(){this._gateway.signal.on(Nn.ON_USER_ONLINE,this._handleUserOnline),this._gateway.signal.on(Nn.ON_USER_OFFLINE,this._handleUserOffline),this._gateway.signal.on(Nn.ON_ADD_AUDIO_STREAM,(t=>this._handleAddAudioOrVideoStream("audio",t.uid,t.ssrcId,t.cname,t.pt,t.uint_id,t.ortc))),this._gateway.signal.on(Nn.ON_ADD_VIDEO_STREAM,(t=>this._handleAddAudioOrVideoStream("video",t.uid,t.ssrcId,t.cname,t.pt,t.uint_id,t.ortc,t.rtxSsrcId))),this._gateway.signal.on(Nn.ON_REMOTE_DATASTREAM_UPDATE,(t=>{this._handleUpdateDataChannel(t)})),this._gateway.signal.on(Nn.ON_REMOTE_FULL_DATASTREAM_INFO,(t=>{this._handleUpdateDataChannel({added:t.datastreams||[],deleted:[]},!0)})),this._gateway.signal.on(Nn.ON_REMOVE_STREAM,this._handleRemoveStream),this._gateway.signal.on(Nn.ON_P2P_LOST,this._handleP2PLost),this._gateway.signal.on(Nn.MUTE_AUDIO,(t=>this._handleMuteStream(t.uid,St.AUDIO,!0))),this._gateway.signal.on(Nn.UNMUTE_AUDIO,(t=>this._handleMuteStream(t.uid,St.AUDIO,!1))),this._gateway.signal.on(Nn.MUTE_VIDEO,(t=>this._handleMuteStream(t.uid,St.VIDEO,!0))),this._gateway.signal.on(Nn.UNMUTE_VIDEO,(t=>this._handleMuteStream(t.uid,St.VIDEO,!1))),this._gateway.signal.on(Nn.RECEIVE_METADATA,(t=>{const r=iy(t.metadata);this.safeEmit(Pn.RECEIVE_METADATA,t.uid,r)})),this._gateway.signal.on(Nn.ON_DATA_STREAM,(async t=>{var r;if(!t)return;let s=iy(t.payload);if(this._encryptDataStream&&this._encryptDataStreamIv&&this._encryptDataStreamKey&&window.crypto.subtle&&rt(r=["aes-128-gcm2","aes-256-gcm2"]).call(r,this._encryptionMode)){if(t.payload.length<s0)throw new ke(te.UNEXPECTED_RESPONSE,"payload length ".concat(t.payload.length," is less than header length ").concat(s0));s=await(async function(d,h,m){const g=m.subarray(0,s0),v=g.slice(8,s0),w=(v[0]<<8)+v[1],I=(g[6]<<8)+g[7],A=await window.crypto.subtle.decrypt({name:"AES-GCM",iv:d,tagLength:B9,additionalData:new Uint8Array(A9(w,2))},h,m.subarray(s0));return new Uint8Array(A).subarray(0,I)})(this._encryptDataStreamIv,this._encryptDataStreamKey,s)}let a=0;if(t.ordered||t.syncWithAudio){const c=this._p2pChannel.getStats(),d=this.remoteUsers.find((m=>m.uid===t.uid)),h=c==null?void 0:c.audioRecv.find((m=>m.ssrc===(d==null?void 0:d._audioSSRC)));a=h==null?void 0:h.jitterBufferMs}(a==null||Number.isNaN(a))&&(a=0),V_e(ed(ed({},t),{},{payload:s}),a,{id:this._clientId,onStreamMessage:typeof this.onStreamMessage=="function"?this.onStreamMessage.bind(this):void 0,safeEmit:this.safeEmit.bind(this)})})),this._gateway.signal.on(Nn.ON_CRYPT_ERROR,(()=>{Jm((()=>{M.warning("[".concat(this._clientId,"] on crypt error")),this.safeEmit(Pn.CRYPT_ERROR)}),this._sessionId)})),this._gateway.signal.on(Nn.ON_TOKEN_PRIVILEGE_WILL_EXPIRE,this._handleTokenWillExpire),this._gateway.signal.on(Nn.ON_TOKEN_PRIVILEGE_DID_EXPIRE,(()=>{M.warning("[".concat(this._clientId,"] received message onTokenPrivilegeDidExpire, please get new token and join again")),this._gateway.leave(!0,or.TOKEN_EXPIRE),this.safeEmit(Pn.ON_TOKEN_PRIVILEGE_DID_EXPIRE),this._reset()})),this._gateway.signal.on(Nn.ON_STREAM_FALLBACK_UPDATE,(t=>{M.debug("[".concat(this._clientId,"] stream fallback peerId: ").concat(t.stream_id,", attr: ").concat(t.stream_type)),this.safeEmit(Pn.STREAM_FALLBACK,t.stream_id,t.stream_type===1?"fallback":"recover")})),this._gateway.signal.on(Nn.ON_PUBLISH_STREAM,(t=>{this.uid===this._uid&&(this._p2pChannel.reportPublishEvent(!0,null,void 0,!1,JSON.stringify({proxy:t.proxy})),M.info("[".concat(this._clientId,"] on publish stream, ").concat(JSON.stringify(t))))})),this._gateway.signal.on(Nn.ENABLE_LOCAL_VIDEO,(t=>{this._handleSetStreamLocalEnable("video",t.uid,!0)})),this._gateway.signal.on(Nn.DISABLE_LOCAL_VIDEO,(t=>{this._handleSetStreamLocalEnable("video",t.uid,!1)})),this._gateway.signal.on(tn.REQUEST_TIMEOUT,((t,r)=>{if(this._joinInfo)switch(t){case Qt.PUBLISH:{if(!r)return;const c=r.ortc;if(c){var s,a;const d=c.some((g=>{let{stream_type:v}=g;return v===lr.Audio})),h=c.some((g=>{let{stream_type:v}=g;return v!==lr.Audio})),m=c.some((g=>{let{stream_type:v}=g;return v===lr.Screen||v===lr.ScreenLow}));r.state==="offer"&&It.publish(this._joinInfo.sid,{eventElapse:lo.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:!1,ec:te.TIMEOUT,audio:d,video:h,p2pid:r.p2p_id,publishRequestid:this.store.pubId,screenshare:m,audioName:d?(s=c.find((g=>{let{stream_type:v}=g;return v===lr.Audio})))===null||s===void 0||(s=s.ssrcs[0])===null||s===void 0?void 0:s.ssrcId.toString():void 0,videoName:h?(a=c.find((g=>{let{stream_type:v}=g;return v!==lr.Audio})))===null||a===void 0||(a=a.ssrcs[0])===null||a===void 0?void 0:a.ssrcId.toString():void 0})}break}case Qt.SUBSCRIBE:r&&It.subscribe(this._joinInfo.sid,{succ:!1,ec:te.TIMEOUT,audio:r.stream_type===St.AUDIO,video:r.stream_type===St.VIDEO,peerid:r.stream_id,subscribeRequestid:r.ssrcId,p2pid:this.store.p2pId,eventElapse:lo.measureFromSubscribeStart(this.store.clientId,r.ssrcId),preSsrc:this._p2pChannel.isPreSubScribe(r.ssrcId)})}})),this._gateway.signal.on(Nn.ON_P2P_OK,(t=>{this.uid,this._uid})),this._gateway.signal.on(Nn.ON_PUBLISHED_USER_LIST,(t=>{if(t==null||!t.users)return;oe("BLOCK_LOCAL_CLIENT")&&(t.users=t.users.filter((a=>!py(a.string_id||a.stream_id,this.channelName))));const r=[],s=[];for(const a of t.users){let c=this._users.find((w=>w._uintid===a.stream_id));c?c._trust_in_room_=!0:(c=new lg(a.string_id||a.stream_id,a.stream_id),this._users.push(c),this.store.firstVideoFrameDecoded(c.uid,{userJoinNotify:Date.now()}),this.getListeners(Pn.PUBLISHED_USER_LIST).length===0&&(M.debug("[".concat(this._clientId,"] user online"),a.stream_id),this.safeEmit(Pn.USER_JOINED,c)));const d=as.Audio&a.stream_type,h=(as.Video|as.LwoVideo)&a.stream_type,m=(65280&a.stream_type)!=0,g=d&&c.hasAudio,v=h&&c.hasVideo;h&&(c._trust_video_stream_added_state_=!0,c._video_added_=!0,c._videoSSRC=a.video_ssrc,c._rtxSsrcId=a.video_rtx),d&&(c._trust_audio_stream_added_state_=!0,c._audio_added_=!0,c._audioSSRC=a.audio_ssrc),d&&!g&&this.getListeners(Pn.PUBLISHED_USER_LIST).length===0&&(M.info("[".concat(this._clientId,"] remote user ").concat(c.uid," published audio")),this.safeEmit(Pn.USER_PUBLISHED,c,"audio")),h&&!v&&this.getListeners(Pn.PUBLISHED_USER_LIST).length===0&&(M.info("[".concat(this._clientId,"] remote user ").concat(c.uid," published video")),this.safeEmit(Pn.USER_PUBLISHED,c,"video")),(d&&!g||h&&!v||m)&&r.push(c),h&&this._p2pChannel.hasPendingRemoteMedia(c,"video")&&s.push({user:c,mediaType:"video"}),d&&this._p2pChannel.hasPendingRemoteMedia(c,"audio")&&s.push({user:c,mediaType:"audio"})}s.length>0&&(M.debug("[".concat(this._clientId,"] RE massSubscribe after reconnect ").concat(s.map((a=>"user: ".concat(a.user.uid,", mediaType: ").concat(a.mediaType))).join("; ")," ")),this.massSubscribe(s).catch((a=>{M.error("[".concat(this._clientId,"] mass resubscribe error"),a.toString())}))),this.getListeners(Pn.PUBLISHED_USER_LIST).length>0?oe("ENABLE_DATASTREAM_2")?this._pendingPublishedUsers=r:(M.info("[".concat(this._clientId,"] client emit user-list event, users: ").concat(r.map((a=>a.uid)).join(", "))),this.safeEmit(Pn.PUBLISHED_USER_LIST,r)):M.info("[".concat(this._clientId,"] client not emit user-list event case there is no user-list listener, users: ").concat(r.map((a=>a.uid)).join(", ")))})),this._gateway.signal.on(Nn.ON_RTP_CAPABILITY_CHANGE,(t=>{const{video_codec:r}=t;this._p2pChannel instanceof kT&&this._p2pChannel.updateRemoteRTPCapabilities(r.map((s=>s.toLowerCase())).filter((s=>{var a;return rt(a=Object.keys(fT)).call(a,s)})))}))}_handleP2PEvents(){this._gateway.signal.on(Nn.ON_USER_OFFLINE,(()=>{this._p2pChannel.disconnectForReconnect()})),this._gateway.signal.on(bi.PUBLISH,((t,r,s)=>{const{uid:a}=t;t.forEach((c=>{const{kind:d,ssrcs:h,mid:m,isMuted:g}=c;this._handleP2PAddAudioOrVideoStream(d,a,h[0].ssrcId,m);const v=this._users.find((w=>w.uid===a));return v&&this.store.useP2P?this._p2pChannel.mockSubscribe(v,d,h[0].ssrcId,m).then((()=>{r()})).catch(s):r(),this._handleMuteStream(a,d,!!g)}))})),this._gateway.signal.on(bi.CALL,(async(t,r,s)=>{if(this.store.useP2P)try{var a;r(await this._p2pChannel.startP2P({turnServer:(a=this._joinInfo)===null||a===void 0?void 0:a.turnServer},t))}catch(c){s(c)}})),this._gateway.signal.on(tn.P2P_CONNECTION,(async t=>{this.store.useP2P&&(await this._p2pChannel).p2pConnect(t)})),this._gateway.signal.on(bi.UNPUBLISH,(async(t,r,s)=>{if(this.store.useP2P){const{unpubMsg:a,uid:c}=t,d=this._users.find((h=>h.uid===c));if(!d)return M.warning("[".concat(this._clientId,"] can not find remote user, ignore mute event, uid: ").concat(c)),void r();try{a.forEach((async h=>{let{stream_type:m}=h;const g=m===lr.Audio?St.AUDIO:St.VIDEO;await this._p2pChannel.unsubscribe(d,g),this._handleMuteStream(c,g,!0)})),r()}catch(h){s(h)}}})),this._gateway.signal.on(bi.CONTROL,(async(t,r)=>{const{action:s}=t;switch(s){case ng.MUTE_LOCAL_VIDEO:this._handleMuteStream(r,St.VIDEO,!0);break;case ng.MUTE_LOCAL_AUDIO:this._handleMuteStream(r,St.AUDIO,!0);break;case ng.UNMUTE_LOCAL_VIDEO:this._handleP2PAddAudioOrVideoStream("video",r),this._handleMuteStream(r,St.VIDEO,!1);break;case ng.UNMUTE_LOCAL_AUDIO:this._handleP2PAddAudioOrVideoStream("audio",r),this._handleMuteStream(r,St.AUDIO,!1)}})),this._gateway.signal.on(bi.RESTART_ICE,(async(t,r,s)=>{if(this.store.useP2P)try{const{direction:a,iceParameter:c}=t;a!==fa.SEND_ONLY||c?r(await this._p2pChannel.restartICE(a,c)):(this._p2pChannel.handleDisconnect(a),r())}catch(a){s(a)}})),this._gateway.signal.on(bi.CANDIDATE,(t=>{if(this.store.useP2P){const{candidate:r,direction:s}=t;this._p2pChannel.addRemoteCandidate(r,s)}})),this._p2pChannel.on(Mt.RequestP2PRestartICE,(async(t,r,s)=>{try{const{direction:a}=t;r(await this._gateway.sendExtensionMessage(bi.RESTART_ICE,t,a===fa.SEND_ONLY))}catch(a){s(a)}})),this._p2pChannel.on(Mt.LocalCandidate,(t=>{this._gateway.sendExtensionMessage(bi.CANDIDATE,JSON.stringify(t),!0)})),this._p2pChannel.on(Mt.RequestP2PMuteLocal,(async(t,r,s)=>{try{await this._gateway.sendExtensionMessage(bi.CONTROL,t,!0),r()}catch(a){s(a)}})),this._p2pChannel.on(Mt.RequestP2PUnmuteRemote,(async(t,r,s)=>{if(this._joinInfo)try{await this._gateway.unmuteRemote(t,this._joinInfo.stringUid||this._joinInfo.uid),r()}catch(a){a.code===te.DISCONNECT_P2P?r():s(a)}else r()})),this._p2pChannel.on(Mt.RequestP2PMuteRemote,(async(t,r,s)=>{if(this._joinInfo)try{await this._gateway.muteRemote(t,this._joinInfo.stringUid||this._joinInfo.uid),r()}catch(a){a.code===te.DISCONNECT_P2P?r():s(a)}else r()})),this._p2pChannel.on(Mt.StateChange,((t,r)=>{r===ar.Connected&&this._p2pChannel.republish()}))}_handleP2PChannelEvents(){this._p2pChannel.on(Mt.PeerConnectionStateChange,(t=>{const r=this._peerConnectionState;t!==r&&(this.safeEmit(Pn.PEERCONNECTION_STATE_CHANGE,t,r),this._peerConnectionState=t)})),this._p2pChannel.on(Mt.RequestMuteLocal,(async(t,r,s)=>{if(this._joinInfo)try{await this._gateway.muteLocal(t,this._joinInfo.stringUid||this._joinInfo.uid),r()}catch(a){a.code===te.DISCONNECT_P2P?r():s(a)}else r()})),this._p2pChannel.on(Mt.RequestUnmuteLocal,(async(t,r,s)=>{if(this._joinInfo)try{await this._gateway.unmuteLocal(t,this._joinInfo.stringUid||this._joinInfo.uid),r()}catch(a){a.code===te.DISCONNECT_P2P?r():s(a)}else r()})),this._p2pChannel.on(Mt.RequestRePublish,((t,r,s)=>{this.publish(t,!1).then(r).catch(s)})),this._p2pChannel.on(Mt.RequestRePublishDataChannel,((t,r,s)=>{mt.all(t.map((async a=>{const c=await this._p2pChannel.publishDataChannel([a]);try{c.forEach((d=>{this._uid&&this._gateway.publishDataChannel(this._uid,d,!0)}))}catch(d){if(d.code!==te.DISCONNECT_P2P)throw d}}))).then(r).catch(s)})),this._p2pChannel.on(Mt.RequestReSubscribe,(async(t,r,s)=>{try{for(const{user:a,kind:c}of t)c===St.VIDEO?await this.subscribe(a,"video"):await this.subscribe(a,"audio");r()}catch(a){s(a)}})),this._p2pChannel.on(Mt.RequestUpload,((t,r)=>{this._gateway.upload(t,r)})),this._p2pChannel.on(Mt.RequestUploadStats,(t=>{this._gateway.uploadWRTCStats(t)})),this._p2pChannel.on(Mt.MediaReconnectStart,(t=>{this.safeEmit(Pn.MEDIA_RECONNECT_START,t)})),this._p2pChannel.on(Mt.MediaReconnectEnd,(t=>{this.safeEmit(Pn.MEDIA_RECONNECT_END,t)})),this._p2pChannel.on(Mt.NeedSignalRTT,(t=>{t(this._gateway.getSignalRTT())})),this._p2pChannel.on(Mt.RequestRestartICE,(async t=>{if(this.store.useP2P)return;const r=await this._p2pChannel.restartICE(t),s=await r.next();if(s.done)return;const a=s.value;let c;try{c=await this._gateway.restartICE({iceParameters:a})}catch(h){return void r.throw(h)}const{iceParameters:d}=(function(h){const m=h.iceParameters;return{iceParameters:{iceUfrag:m.iceUfrag,icePwd:m.icePwd}}})(c);await r.next({remoteIceParameters:d})})),this._p2pChannel.on(Mt.RequestReconnect,(async()=>{this._gateway.reconnect()})),this._p2pChannel.on(Mt.RequestReconnectPC,(async()=>{var t;const{iceParameters:r,dtlsParameters:s,rtpCapabilities:a}=await this._p2pChannel.startP2PConnection({turnServer:(t=this._joinInfo)===null||t===void 0?void 0:t.turnServer}),{gatewayEstablishParams:c,gatewayAddress:d}=await this._gateway.reconnectPC({iceParameters:r,dtlsParameters:s,rtpCapabilities:a}),h=x7(c,d);await this._p2pChannel.connect(h),await this._p2pChannel.republish(),await this._p2pChannel.reSubscribe()})),this._p2pChannel.on(Mt.RequestUnpublishForReconnectPC,(async(t,r,s)=>{this._joinInfo&&this._uid!==void 0?(await this._gateway.unpublish(t,this._uid),r()):s()})),this._p2pChannel.on(Mt.P2PLost,(()=>{this.safeEmit(Pn.P2P_LOST,this.store.uid)})),this._p2pChannel.on(Mt.UpdateVideoEncoder,(t=>{t._encoderConfig&&this._gateway.setVideoProfile(t._encoderConfig)})),this._p2pChannel.on(Mt.ConnectionTypeChange,(t=>{this.safeEmit(Pn.IS_USING_CLOUD_PROXY,t)})),this._p2pChannel.on(Mt.RequestLowStreamParameter,(t=>{t(this._lowStreamParameter||{width:160,height:120,framerate:15,bitrate:50})})),this._p2pChannel.on(Mt.QueryClientConnectionState,(t=>{t(this.connectionState)})),this._p2pChannel.on(Mt.AudioMetadata,(t=>{this.safeEmit(Pn.AUDIO_METADATA,t)})),this._p2pChannel.on(Mt.AudioPts,(t=>{this.safeEmit(Pn.AUDIO_PTS,Number(t))}))}getKeyMetrics(){return this.store.keyMetrics}async enableContentInspect(t){if(!this._joinInfo||this.connectionState!=="CONNECTED")throw new ke(te.INVALID_OPERATION,"[".concat(this._clientId,"] can not create content inspect, please join channel first"));if(this._inspect)throw new ke(te.INVALID_OPERATION,"[".concat(this._clientId,"] Inspect content service already in connecting/connected state"));try{const s=(r={config:t},Cf("ContentInspect").create(r));this._inspect=s,this.handleVideoInspectEvents(s);const{appId:a,cname:c,sid:d,token:h,uid:m,cid:g,vid:v}=this._joinInfo;await s.init({appId:a,areaCode:"",cname:c,sid:d,token:h,uid:m,cid:g,vid:v?Number(v):0},Vi)}catch(s){throw Array.isArray(s)?s[0]:s}var r}handleVideoInspectEvents(t){t.on(fs.CONNECTION_STATE_CHANGE,((r,s)=>{if(this.safeEmit(Pn.CONTENT_INSPECT_CONNECTION_STATE_CHANGE,r,s),s===Xu.CONNECTED){if(this.connectionState!=="CONNECTED")return void this.safeEmit(Pn.CONTENT_INSPECT_ERROR,new ke(te.OPERATION_ABORTED,"Content inspect was cancelled because it left the channel"));t.inspectImage()}})),t.on(fs.INSPECT_RESULT,((r,s)=>{var a;if((s==null?void 0:s.code)===te.INVALID_OPERATION&&this.connectionState==="DISCONNECTED")return M.debug("Stop inspect content because that has left channel"),this==null||(a=this._inspect)===null||a===void 0||a.close(),void(this._inspect=void 0);this.safeEmit(Pn.CONTENT_INSPECT_RESULT,r,s)})),t.on(fs.CLIENT_LOCAL_VIDEO_TRACK,(r=>{r(this.localTracks.filter((s=>s.trackMediaType==="video"))[0])}))}async disableContentInspect(){if(!this._inspect)throw new ke(te.INVALID_OPERATION,"[".concat(this._clientId,"] inspectVideoContent not started"));try{this._inspect.close(),this._inspect=void 0}catch(t){throw Array.isArray(t)?t[0]:t}}async setImageModeration(t,r){if(Yd(t,"enabled"),t){if(!r)throw new ke(te.INVALID_PARAMS,"config is required");if(qH(r),!this._joinInfo)throw new ke(te.INVALID_OPERATION,"can not create image moderation, please join channel first");try{if(this._moderation)this._moderation.updateConfig(r);else{const a=(s={config:r},Cf("ImageModeration").create(s));this._moderation=a,this.handleImageModerationEvents(a);const{appId:c,cname:d,sid:h,token:m,uid:g,cid:v,vid:w}=this._joinInfo;await a.init({appId:c,areaCode:"",cname:d,sid:h,token:m,uid:g,cid:v,vid:w?Number(w):0},Vi)}}catch(a){throw Array.isArray(a)?a[0]:a}}else{var s;if(!this._moderation)throw new ke(te.INVALID_OPERATION,"[".concat(this._clientId,"] image moderation not started"));try{this._moderation.close(),this._moderation.removeAllListeners(),this._moderation=void 0}catch(a){throw Array.isArray(a)?a[0]:a}}}handleImageModerationEvents(t){t.on(eh.CONNECTION_STATE_CHANGE,((r,s)=>{if(this.safeEmit(Pn.IMAGE_MODERATION_CONNECTION_STATE_CHANGE,r,s),r===ru.CONNECTED){if(this.connectionState!=="CONNECTED")throw this.setImageModeration(!1),new ke(te.OPERATION_ABORTED,"Image moderation was cancelled because it left the channel");t.inspectImage()}})),t.on(eh.CLIENT_LOCAL_VIDEO_TRACK,(r=>{r(this.localTracks.filter((s=>s.trackMediaType==="video"))[0])}))}setP2PTransport(t){if((function(r){Zi(r,"transport",["default","auto","relay","sd-rtn"])})(t),this.mode!=="p2p")throw new ke(te.INVALID_OPERATION,"only p2p mode can set p2pTransport");this.store.p2pTransport=t,M.info("[".concat(this._clientId,"] set client p2pTransport to ").concat(t))}getJoinChannelServiceRecords(){return M.debug("getJoinChannelServiceRecords"),this.store.joinChannelServiceRecords}async setPublishAudioFilterEnabled(t){Yd(t,"enabled"),gr("ENABLE_PUBLISH_AUDIO_FILTER",t),this._joinInfo&&await this._gateway.setPublishAudioFilterEnabled(t)}_handleResetAddStream(t,r){switch(r){case"audio":t._audio_added_=!1,t._trust_audio_stream_added_state_=!0;break;case"video":t._video_added_=!1,t._trust_video_stream_added_state_=!0}}},Rt(yt.prototype,"leave",[YH],Object.getOwnPropertyDescriptor(yt.prototype,"leave"),yt.prototype),Rt(yt.prototype,"publish",[XH],Object.getOwnPropertyDescriptor(yt.prototype,"publish"),yt.prototype),Rt(yt.prototype,"unpublish",[JH],Object.getOwnPropertyDescriptor(yt.prototype,"unpublish"),yt.prototype),Rt(yt.prototype,"subscribe",[QH],Object.getOwnPropertyDescriptor(yt.prototype,"subscribe"),yt.prototype),Rt(yt.prototype,"presubscribe",[ZH],Object.getOwnPropertyDescriptor(yt.prototype,"presubscribe"),yt.prototype),Rt(yt.prototype,"massSubscribe",[e$],Object.getOwnPropertyDescriptor(yt.prototype,"massSubscribe"),yt.prototype),Rt(yt.prototype,"unsubscribe",[t$],Object.getOwnPropertyDescriptor(yt.prototype,"unsubscribe"),yt.prototype),Rt(yt.prototype,"massUnsubscribe",[n$],Object.getOwnPropertyDescriptor(yt.prototype,"massUnsubscribe"),yt.prototype),Rt(yt.prototype,"setLowStreamParameter",[r$],Object.getOwnPropertyDescriptor(yt.prototype,"setLowStreamParameter"),yt.prototype),Rt(yt.prototype,"enableDualStream",[i$],Object.getOwnPropertyDescriptor(yt.prototype,"enableDualStream"),yt.prototype),Rt(yt.prototype,"disableDualStream",[s$],Object.getOwnPropertyDescriptor(yt.prototype,"disableDualStream"),yt.prototype),Rt(yt.prototype,"setClientRole",[o$],Object.getOwnPropertyDescriptor(yt.prototype,"setClientRole"),yt.prototype),Rt(yt.prototype,"_setClientRoleOptions",[a$],Object.getOwnPropertyDescriptor(yt.prototype,"_setClientRoleOptions"),yt.prototype),Rt(yt.prototype,"setProxyServer",[c$],Object.getOwnPropertyDescriptor(yt.prototype,"setProxyServer"),yt.prototype),Rt(yt.prototype,"setTurnServer",[l$],Object.getOwnPropertyDescriptor(yt.prototype,"setTurnServer"),yt.prototype),Rt(yt.prototype,"setLicense",[u$],Object.getOwnPropertyDescriptor(yt.prototype,"setLicense"),yt.prototype),Rt(yt.prototype,"startProxyServer",[d$],Object.getOwnPropertyDescriptor(yt.prototype,"startProxyServer"),yt.prototype),Rt(yt.prototype,"stopProxyServer",[h$],Object.getOwnPropertyDescriptor(yt.prototype,"stopProxyServer"),yt.prototype),Rt(yt.prototype,"setLocalAccessPointsV2",[p$],Object.getOwnPropertyDescriptor(yt.prototype,"setLocalAccessPointsV2"),yt.prototype),Rt(yt.prototype,"setLocalAccessPoints",[f$],Object.getOwnPropertyDescriptor(yt.prototype,"setLocalAccessPoints"),yt.prototype),Rt(yt.prototype,"setRemoteDefaultVideoStreamType",[m$],Object.getOwnPropertyDescriptor(yt.prototype,"setRemoteDefaultVideoStreamType"),yt.prototype),Rt(yt.prototype,"setRemoteVideoStreamType",[g$],Object.getOwnPropertyDescriptor(yt.prototype,"setRemoteVideoStreamType"),yt.prototype),Rt(yt.prototype,"setStreamFallbackOption",[_$],Object.getOwnPropertyDescriptor(yt.prototype,"setStreamFallbackOption"),yt.prototype),Rt(yt.prototype,"setEncryptionConfig",[y$],Object.getOwnPropertyDescriptor(yt.prototype,"setEncryptionConfig"),yt.prototype),Rt(yt.prototype,"renewToken",[E$],Object.getOwnPropertyDescriptor(yt.prototype,"renewToken"),yt.prototype),Rt(yt.prototype,"enableAudioVolumeIndicator",[v$],Object.getOwnPropertyDescriptor(yt.prototype,"enableAudioVolumeIndicator"),yt.prototype),Rt(yt.prototype,"startLiveStreaming",[S$],Object.getOwnPropertyDescriptor(yt.prototype,"startLiveStreaming"),yt.prototype),Rt(yt.prototype,"setLiveTranscoding",[b$],Object.getOwnPropertyDescriptor(yt.prototype,"setLiveTranscoding"),yt.prototype),Rt(yt.prototype,"stopLiveStreaming",[w$],Object.getOwnPropertyDescriptor(yt.prototype,"stopLiveStreaming"),yt.prototype),Rt(yt.prototype,"startChannelMediaRelay",[T$],Object.getOwnPropertyDescriptor(yt.prototype,"startChannelMediaRelay"),yt.prototype),Rt(yt.prototype,"updateChannelMediaRelay",[C$],Object.getOwnPropertyDescriptor(yt.prototype,"updateChannelMediaRelay"),yt.prototype),Rt(yt.prototype,"stopChannelMediaRelay",[R$],Object.getOwnPropertyDescriptor(yt.prototype,"stopChannelMediaRelay"),yt.prototype),Rt(yt.prototype,"sendCustomReportMessage",[I$],Object.getOwnPropertyDescriptor(yt.prototype,"sendCustomReportMessage"),yt.prototype),Rt(yt.prototype,"pickSVCLayer",[A$],Object.getOwnPropertyDescriptor(yt.prototype,"pickSVCLayer"),yt.prototype),Rt(yt.prototype,"setRTMConfig",[P$],Object.getOwnPropertyDescriptor(yt.prototype,"setRTMConfig"),yt.prototype),Rt(yt.prototype,"enableContentInspect",[O$],Object.getOwnPropertyDescriptor(yt.prototype,"enableContentInspect"),yt.prototype),Rt(yt.prototype,"disableContentInspect",[k$],Object.getOwnPropertyDescriptor(yt.prototype,"disableContentInspect"),yt.prototype),Rt(yt.prototype,"setImageModeration",[N$],Object.getOwnPropertyDescriptor(yt.prototype,"setImageModeration"),yt.prototype),Rt(yt.prototype,"setP2PTransport",[x$],Object.getOwnPropertyDescriptor(yt.prototype,"setP2PTransport"),yt.prototype),Rt(yt.prototype,"getJoinChannelServiceRecords",[D$],Object.getOwnPropertyDescriptor(yt.prototype,"getJoinChannelServiceRecords"),yt.prototype),Rt(yt.prototype,"setPublishAudioFilterEnabled",[L$],Object.getOwnPropertyDescriptor(yt.prototype,"setPublishAudioFilterEnabled"),yt.prototype),yt);class DT{constructor(r,s){X(this,"id",0),X(this,"element",void 0),X(this,"peerPair",void 0),X(this,"context",void 0),X(this,"audioPlayerElement",void 0),X(this,"audioTrack",void 0),DT.count+=1,this.id=DT.count,this.element=r,this.context=s}initPeers(){this.peerPair=[new RTCPeerConnection,new RTCPeerConnection],this.peerPair[1].ontrack=r=>{const s=document.createElement("audio");s.srcObject=new MediaStream([r.track]),s.play(),this.audioPlayerElement=s}}async switchSdp(){if(!this.peerPair)return;const r=async(a,c)=>{const d=c==="offer"?await a.createOffer():await a.createAnswer();return await a.setLocalDescription(d),a.iceGatheringState==="complete"?a.localDescription:new mt((h=>{a.onicegatheringstatechange=()=>{a.iceGatheringState==="complete"&&h(a.localDescription)}}))},s=async(a,c)=>await a.setRemoteDescription(c);try{const a=await r(this.peerPair[0],"offer");await s(this.peerPair[1],a);const c=await r(this.peerPair[1],"answer");await s(this.peerPair[0],c)}catch(a){throw new ke(te.LOCAL_AEC_ERROR,a.toString()).print()}}async getTracksFromMediaElement(r){if(this.audioTrack)return this.audioTrack;let s;try{r instanceof HTMLVideoElement&&(r.captureStream?r.captureStream():r.mozCaptureStream()),s=this.context.createMediaStreamDestination(),this.context.createMediaElementSource(r).connect(s)}catch(c){throw new ke(te.LOCAL_AEC_ERROR,c.toString()).print()}if(!s)throw new ke(te.LOCAL_AEC_ERROR,"no dest node when local aec").print();const a=s.stream.getAudioTracks()[0];return this.audioTrack=a,a}getElement(){return this.element}async startEchoCancellation(){this.context.resume(),this.peerPair&&this.close(),this.initPeers();const r=this.element,s=await this.getTracksFromMediaElement(r);this.peerPair&&this.peerPair[0].addTrack(s),await this.switchSdp()}close(){M.debug("close echo cancellation unit, id is",this.id),this.audioPlayerElement&&this.audioPlayerElement.pause(),this.peerPair&&this.peerPair.forEach((r=>{r.close()})),this.peerPair=void 0,this.audioPlayerElement=void 0}}var U$,IP;X(DT,"count",0);const eye=window.AudioContext||window.webkitAudioContext,tye=new(U$=Wt({report:It}),Rt((IP=class{constructor(){X(this,"units",[]),X(this,"context",void 0)}processExternalMediaAEC(t){if(!this._doesEnvironmentNeedAEC())return M.debug("the system does not need to process local aec"),-1;this.context||(this.context=new eye);let r=this.units.find((s=>s&&s.getElement()===t));return r||(r=new DT(t,this.context),this.units.push(r)),r.startEchoCancellation(),M.debug("start processing local audio echo cancellation, id is",r.id),r.id}_doesEnvironmentNeedAEC(){return Mn().name!==Yn.SAFARI}}).prototype,"processExternalMediaAEC",[U$],Object.getOwnPropertyDescriptor(IP.prototype,"processExternalMediaAEC"),IP.prototype),IP);function V$(t,r){var s=Object.keys(t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);r&&(a=a.filter((function(c){return Object.getOwnPropertyDescriptor(t,c).enumerable}))),s.push.apply(s,a)}return s}function j$(t){for(var r=1;r<arguments.length;r++){var s=arguments[r]!=null?arguments[r]:{};r%2?V$(Object(s),!0).forEach((function(a){X(t,a,s[a])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(s)):V$(Object(s)).forEach((function(a){Object.defineProperty(t,a,Object.getOwnPropertyDescriptor(s,a))}))}return t}const TM=window||document;function F$(t){let r=arguments.length>1&&arguments[1]!==void 0&&arguments[1];if(!TM)return;const s=ji._cspEventHandlerPointer;if(s&&r)return void console.error(s,r);const a=c=>{if(!(c&&c.blockedURI&&(ji.onSecurityPolicyViolation||ji.getListeners(up.SECURITY_POLICY_VIOLATION).length>0)))return;const d=c.blockedURI;oe("CSP_DETECTED_HOSTNAME_LIST").some((h=>rt(d).call(d,h)))&&(ji.onSecurityPolicyViolation&&typeof ji.onSecurityPolicyViolation=="function"&&ji.onSecurityPolicyViolation(c),ji.getListeners(up.SECURITY_POLICY_VIOLATION).length>0&&ji.safeEmit(up.SECURITY_POLICY_VIOLATION,c))};s&&TM.removeEventListener("securitypolicyviolation",s),(r||t&&typeof t=="function"||ji.getListeners(up.SECURITY_POLICY_VIOLATION).length>0)&&TM.addEventListener("securitypolicyviolation",a),ji._cspEventHandlerPointer=a}var nye=O,rye=Sz,B$=RegExp.prototype,iye=function(t){return t===B$||nye(B$,t)?rye(t):t.flags},Go=l(iye);function k0(t){let r=t.length;for(;--r>=0;)t[r]=0}const CM=256,z$=286,LT=30,MT=15,RM=new Uint8Array([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0]),AP=new Uint8Array([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13]),sye=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7]),W$=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),If=new Array(576);k0(If);const UT=new Array(60);k0(UT);const VT=new Array(512);k0(VT);const jT=new Array(256);k0(jT);const IM=new Array(29);k0(IM);const PP=new Array(LT);function AM(t,r,s,a,c){this.static_tree=t,this.extra_bits=r,this.extra_base=s,this.elems=a,this.max_length=c,this.has_stree=t&&t.length}let G$,H$,$$;function PM(t,r){this.dyn_tree=t,this.max_code=0,this.stat_desc=r}k0(PP);const K$=t=>t<256?VT[t]:VT[256+(t>>>7)],FT=(t,r)=>{t.pending_buf[t.pending++]=255&r,t.pending_buf[t.pending++]=r>>>8&255},_l=(t,r,s)=>{t.bi_valid>16-s?(t.bi_buf|=r<<t.bi_valid&65535,FT(t,t.bi_buf),t.bi_buf=r>>16-t.bi_valid,t.bi_valid+=s-16):(t.bi_buf|=r<<t.bi_valid&65535,t.bi_valid+=s)},pp=(t,r,s)=>{_l(t,s[2*r],s[2*r+1])},q$=(t,r)=>{let s=0;do s|=1&t,t>>>=1,s<<=1;while(--r>0);return s>>>1},Y$=(t,r,s)=>{const a=new Array(16);let c,d,h=0;for(c=1;c<=MT;c++)h=h+s[c-1]<<1,a[c]=h;for(d=0;d<=r;d++){let m=t[2*d+1];m!==0&&(t[2*d]=q$(a[m]++,m))}},X$=t=>{let r;for(r=0;r<z$;r++)t.dyn_ltree[2*r]=0;for(r=0;r<LT;r++)t.dyn_dtree[2*r]=0;for(r=0;r<19;r++)t.bl_tree[2*r]=0;t.dyn_ltree[512]=1,t.opt_len=t.static_len=0,t.sym_next=t.matches=0},J$=t=>{t.bi_valid>8?FT(t,t.bi_buf):t.bi_valid>0&&(t.pending_buf[t.pending++]=t.bi_buf),t.bi_buf=0,t.bi_valid=0},Q$=(t,r,s,a)=>{const c=2*r,d=2*s;return t[c]<t[d]||t[c]===t[d]&&a[r]<=a[s]},OM=(t,r,s)=>{const a=t.heap[s];let c=s<<1;for(;c<=t.heap_len&&(c<t.heap_len&&Q$(r,t.heap[c+1],t.heap[c],t.depth)&&c++,!Q$(r,a,t.heap[c],t.depth));)t.heap[s]=t.heap[c],s=c,c<<=1;t.heap[s]=a},Z$=(t,r,s)=>{let a,c,d,h,m=0;if(t.sym_next!==0)do a=255&t.pending_buf[t.sym_buf+m++],a+=(255&t.pending_buf[t.sym_buf+m++])<<8,c=t.pending_buf[t.sym_buf+m++],a===0?pp(t,c,r):(d=jT[c],pp(t,d+CM+1,r),h=RM[d],h!==0&&(c-=IM[d],_l(t,c,h)),a--,d=K$(a),pp(t,d,s),h=AP[d],h!==0&&(a-=PP[d],_l(t,a,h)));while(m<t.sym_next);pp(t,256,r)},kM=(t,r)=>{const s=r.dyn_tree,a=r.stat_desc.static_tree,c=r.stat_desc.has_stree,d=r.stat_desc.elems;let h,m,g,v=-1;for(t.heap_len=0,t.heap_max=573,h=0;h<d;h++)s[2*h]!==0?(t.heap[++t.heap_len]=v=h,t.depth[h]=0):s[2*h+1]=0;for(;t.heap_len<2;)g=t.heap[++t.heap_len]=v<2?++v:0,s[2*g]=1,t.depth[g]=0,t.opt_len--,c&&(t.static_len-=a[2*g+1]);for(r.max_code=v,h=t.heap_len>>1;h>=1;h--)OM(t,s,h);g=d;do h=t.heap[1],t.heap[1]=t.heap[t.heap_len--],OM(t,s,1),m=t.heap[1],t.heap[--t.heap_max]=h,t.heap[--t.heap_max]=m,s[2*g]=s[2*h]+s[2*m],t.depth[g]=(t.depth[h]>=t.depth[m]?t.depth[h]:t.depth[m])+1,s[2*h+1]=s[2*m+1]=g,t.heap[1]=g++,OM(t,s,1);while(t.heap_len>=2);t.heap[--t.heap_max]=t.heap[1],((w,I)=>{const A=I.dyn_tree,N=I.max_code,H=I.stat_desc.static_tree,B=I.stat_desc.has_stree,z=I.stat_desc.extra_bits,ee=I.stat_desc.extra_base,Z=I.stat_desc.max_length;let ae,ye,_e,ue,Ae,Ue,We=0;for(ue=0;ue<=MT;ue++)w.bl_count[ue]=0;for(A[2*w.heap[w.heap_max]+1]=0,ae=w.heap_max+1;ae<573;ae++)ye=w.heap[ae],ue=A[2*A[2*ye+1]+1]+1,ue>Z&&(ue=Z,We++),A[2*ye+1]=ue,ye>N||(w.bl_count[ue]++,Ae=0,ye>=ee&&(Ae=z[ye-ee]),Ue=A[2*ye],w.opt_len+=Ue*(ue+Ae),B&&(w.static_len+=Ue*(H[2*ye+1]+Ae)));if(We!==0){do{for(ue=Z-1;w.bl_count[ue]===0;)ue--;w.bl_count[ue]--,w.bl_count[ue+1]+=2,w.bl_count[Z]--,We-=2}while(We>0);for(ue=Z;ue!==0;ue--)for(ye=w.bl_count[ue];ye!==0;)_e=w.heap[--ae],_e>N||(A[2*_e+1]!==ue&&(w.opt_len+=(ue-A[2*_e+1])*A[2*_e],A[2*_e+1]=ue),ye--)}})(t,r),Y$(s,v,t.bl_count)},eK=(t,r,s)=>{let a,c,d=-1,h=r[1],m=0,g=7,v=4;for(h===0&&(g=138,v=3),r[2*(s+1)+1]=65535,a=0;a<=s;a++)c=h,h=r[2*(a+1)+1],++m<g&&c===h||(m<v?t.bl_tree[2*c]+=m:c!==0?(c!==d&&t.bl_tree[2*c]++,t.bl_tree[32]++):m<=10?t.bl_tree[34]++:t.bl_tree[36]++,m=0,d=c,h===0?(g=138,v=3):c===h?(g=6,v=3):(g=7,v=4))},tK=(t,r,s)=>{let a,c,d=-1,h=r[1],m=0,g=7,v=4;for(h===0&&(g=138,v=3),a=0;a<=s;a++)if(c=h,h=r[2*(a+1)+1],!(++m<g&&c===h)){if(m<v)do pp(t,c,t.bl_tree);while(--m!=0);else c!==0?(c!==d&&(pp(t,c,t.bl_tree),m--),pp(t,16,t.bl_tree),_l(t,m-3,2)):m<=10?(pp(t,17,t.bl_tree),_l(t,m-3,3)):(pp(t,18,t.bl_tree),_l(t,m-11,7));m=0,d=c,h===0?(g=138,v=3):c===h?(g=6,v=3):(g=7,v=4)}};let nK=!1;const rK=(t,r,s,a)=>{_l(t,0+(a?1:0),3),J$(t),FT(t,s),FT(t,~s),s&&t.pending_buf.set(t.window.subarray(r,r+s),t.pending),t.pending+=s};var oye=t=>{nK||((()=>{let r,s,a,c,d;const h=new Array(16);for(a=0,c=0;c<28;c++)for(IM[c]=a,r=0;r<1<<RM[c];r++)jT[a++]=c;for(jT[a-1]=c,d=0,c=0;c<16;c++)for(PP[c]=d,r=0;r<1<<AP[c];r++)VT[d++]=c;for(d>>=7;c<LT;c++)for(PP[c]=d<<7,r=0;r<1<<AP[c]-7;r++)VT[256+d++]=c;for(s=0;s<=MT;s++)h[s]=0;for(r=0;r<=143;)If[2*r+1]=8,r++,h[8]++;for(;r<=255;)If[2*r+1]=9,r++,h[9]++;for(;r<=279;)If[2*r+1]=7,r++,h[7]++;for(;r<=287;)If[2*r+1]=8,r++,h[8]++;for(Y$(If,287,h),r=0;r<LT;r++)UT[2*r+1]=5,UT[2*r]=q$(r,5);G$=new AM(If,RM,257,z$,MT),H$=new AM(UT,AP,0,LT,MT),$$=new AM(new Array(0),sye,0,19,7)})(),nK=!0),t.l_desc=new PM(t.dyn_ltree,G$),t.d_desc=new PM(t.dyn_dtree,H$),t.bl_desc=new PM(t.bl_tree,$$),t.bi_buf=0,t.bi_valid=0,X$(t)},aye=(t,r,s,a)=>{let c,d,h=0;t.level>0?(t.strm.data_type===2&&(t.strm.data_type=(m=>{let g,v=4093624447;for(g=0;g<=31;g++,v>>>=1)if(1&v&&m.dyn_ltree[2*g]!==0)return 0;if(m.dyn_ltree[18]!==0||m.dyn_ltree[20]!==0||m.dyn_ltree[26]!==0)return 1;for(g=32;g<CM;g++)if(m.dyn_ltree[2*g]!==0)return 1;return 0})(t)),kM(t,t.l_desc),kM(t,t.d_desc),h=(m=>{let g;for(eK(m,m.dyn_ltree,m.l_desc.max_code),eK(m,m.dyn_dtree,m.d_desc.max_code),kM(m,m.bl_desc),g=18;g>=3&&m.bl_tree[2*W$[g]+1]===0;g--);return m.opt_len+=3*(g+1)+5+5+4,g})(t),c=t.opt_len+3+7>>>3,d=t.static_len+3+7>>>3,d<=c&&(c=d)):c=d=s+5,s+4<=c&&r!==-1?rK(t,r,s,a):t.strategy===4||d===c?(_l(t,2+(a?1:0),3),Z$(t,If,UT)):(_l(t,4+(a?1:0),3),((m,g,v,w)=>{let I;for(_l(m,g-257,5),_l(m,v-1,5),_l(m,w-4,4),I=0;I<w;I++)_l(m,m.bl_tree[2*W$[I]+1],3);tK(m,m.dyn_ltree,g-1),tK(m,m.dyn_dtree,v-1)})(t,t.l_desc.max_code+1,t.d_desc.max_code+1,h+1),Z$(t,t.dyn_ltree,t.dyn_dtree)),X$(t),a&&J$(t)},cye=(t,r,s)=>(t.pending_buf[t.sym_buf+t.sym_next++]=r,t.pending_buf[t.sym_buf+t.sym_next++]=r>>8,t.pending_buf[t.sym_buf+t.sym_next++]=s,r===0?t.dyn_ltree[2*s]++:(t.matches++,r--,t.dyn_ltree[2*(jT[s]+CM+1)]++,t.dyn_dtree[2*K$(r)]++),t.sym_next===t.sym_end),lye=t=>{_l(t,2,3),pp(t,256,If),(r=>{r.bi_valid===16?(FT(r,r.bi_buf),r.bi_buf=0,r.bi_valid=0):r.bi_valid>=8&&(r.pending_buf[r.pending++]=255&r.bi_buf,r.bi_buf>>=8,r.bi_valid-=8)})(t)},uye={_tr_init:oye,_tr_stored_block:rK,_tr_flush_block:aye,_tr_tally:cye,_tr_align:lye},BT=(t,r,s,a)=>{let c=65535&t|0,d=t>>>16&65535|0,h=0;for(;s!==0;){h=s>2e3?2e3:s,s-=h;do c=c+r[a++]|0,d=d+c|0;while(--h);c%=65521,d%=65521}return c|d<<16|0};const dye=new Uint32Array((()=>{let t,r=[];for(var s=0;s<256;s++){t=s;for(var a=0;a<8;a++)t=1&t?3988292384^t>>>1:t>>>1;r[s]=t}return r})());var ga=(t,r,s,a)=>{const c=dye,d=a+s;t^=-1;for(let h=a;h<d;h++)t=t>>>8^c[255&(t^r[h])];return-1^t},Ey={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"},OP={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_MEM_ERROR:-4,Z_BUF_ERROR:-5,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_UNKNOWN:2,Z_DEFLATED:8};const{_tr_init:hye,_tr_stored_block:NM,_tr_flush_block:pye,_tr_tally:pg,_tr_align:fye}=uye,{Z_NO_FLUSH:fg,Z_PARTIAL_FLUSH:mye,Z_FULL_FLUSH:gye,Z_FINISH:td,Z_BLOCK:iK,Z_OK:Ma,Z_STREAM_END:sK,Z_STREAM_ERROR:fp,Z_DATA_ERROR:_ye,Z_BUF_ERROR:xM,Z_DEFAULT_COMPRESSION:yye,Z_FILTERED:Eye,Z_HUFFMAN_ONLY:kP,Z_RLE:vye,Z_FIXED:Sye,Z_DEFAULT_STRATEGY:bye,Z_UNKNOWN:wye,Z_DEFLATED:NP}=OP,DM=286,Tye=30,Cye=19,Rye=2*DM+1,Iye=15,vy=258,mp=262,N0=42,Sy=113,zT=666,by=(t,r)=>(t.msg=Ey[r],r),oK=t=>2*t-(t>4?9:0),mg=t=>{let r=t.length;for(;--r>=0;)t[r]=0},Aye=t=>{let r,s,a,c=t.w_size;r=t.hash_size,a=r;do s=t.head[--a],t.head[a]=s>=c?s-c:0;while(--r);r=c,a=r;do s=t.prev[--a],t.prev[a]=s>=c?s-c:0;while(--r)};let gg=(t,r,s)=>(r<<t.hash_shift^s)&t.hash_mask;const su=t=>{const r=t.state;let s=r.pending;s>t.avail_out&&(s=t.avail_out),s!==0&&(t.output.set(r.pending_buf.subarray(r.pending_out,r.pending_out+s),t.next_out),t.next_out+=s,r.pending_out+=s,t.total_out+=s,t.avail_out-=s,r.pending-=s,r.pending===0&&(r.pending_out=0))},ou=(t,r)=>{pye(t,t.block_start>=0?t.block_start:-1,t.strstart-t.block_start,r),t.block_start=t.strstart,su(t.strm)},fi=(t,r)=>{t.pending_buf[t.pending++]=r},WT=(t,r)=>{t.pending_buf[t.pending++]=r>>>8&255,t.pending_buf[t.pending++]=255&r},LM=(t,r,s,a)=>{let c=t.avail_in;return c>a&&(c=a),c===0?0:(t.avail_in-=c,r.set(t.input.subarray(t.next_in,t.next_in+c),s),t.state.wrap===1?t.adler=BT(t.adler,r,c,s):t.state.wrap===2&&(t.adler=ga(t.adler,r,c,s)),t.next_in+=c,t.total_in+=c,c)},aK=(t,r)=>{let s,a,c=t.max_chain_length,d=t.strstart,h=t.prev_length,m=t.nice_match;const g=t.strstart>t.w_size-mp?t.strstart-(t.w_size-mp):0,v=t.window,w=t.w_mask,I=t.prev,A=t.strstart+vy;let N=v[d+h-1],H=v[d+h];t.prev_length>=t.good_match&&(c>>=2),m>t.lookahead&&(m=t.lookahead);do if(s=r,v[s+h]===H&&v[s+h-1]===N&&v[s]===v[d]&&v[++s]===v[d+1]){d+=2,s++;do;while(v[++d]===v[++s]&&v[++d]===v[++s]&&v[++d]===v[++s]&&v[++d]===v[++s]&&v[++d]===v[++s]&&v[++d]===v[++s]&&v[++d]===v[++s]&&v[++d]===v[++s]&&d<A);if(a=vy-(A-d),d=A-vy,a>h){if(t.match_start=r,h=a,a>=m)break;N=v[d+h-1],H=v[d+h]}}while((r=I[r&w])>g&&--c!=0);return h<=t.lookahead?h:t.lookahead},x0=t=>{const r=t.w_size;let s,a,c;do{if(a=t.window_size-t.lookahead-t.strstart,t.strstart>=r+(r-mp)&&(t.window.set(t.window.subarray(r,r+r-a),0),t.match_start-=r,t.strstart-=r,t.block_start-=r,t.insert>t.strstart&&(t.insert=t.strstart),Aye(t),a+=r),t.strm.avail_in===0)break;if(s=LM(t.strm,t.window,t.strstart+t.lookahead,a),t.lookahead+=s,t.lookahead+t.insert>=3)for(c=t.strstart-t.insert,t.ins_h=t.window[c],t.ins_h=gg(t,t.ins_h,t.window[c+1]);t.insert&&(t.ins_h=gg(t,t.ins_h,t.window[c+3-1]),t.prev[c&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=c,c++,t.insert--,!(t.lookahead+t.insert<3)););}while(t.lookahead<mp&&t.strm.avail_in!==0)},cK=(t,r)=>{let s,a,c,d=t.pending_buf_size-5>t.w_size?t.w_size:t.pending_buf_size-5,h=0,m=t.strm.avail_in;do{if(s=65535,c=t.bi_valid+42>>3,t.strm.avail_out<c||(c=t.strm.avail_out-c,a=t.strstart-t.block_start,s>a+t.strm.avail_in&&(s=a+t.strm.avail_in),s>c&&(s=c),s<d&&(s===0&&r!==td||r===fg||s!==a+t.strm.avail_in)))break;h=r===td&&s===a+t.strm.avail_in?1:0,NM(t,0,0,h),t.pending_buf[t.pending-4]=s,t.pending_buf[t.pending-3]=s>>8,t.pending_buf[t.pending-2]=~s,t.pending_buf[t.pending-1]=~s>>8,su(t.strm),a&&(a>s&&(a=s),t.strm.output.set(t.window.subarray(t.block_start,t.block_start+a),t.strm.next_out),t.strm.next_out+=a,t.strm.avail_out-=a,t.strm.total_out+=a,t.block_start+=a,s-=a),s&&(LM(t.strm,t.strm.output,t.strm.next_out,s),t.strm.next_out+=s,t.strm.avail_out-=s,t.strm.total_out+=s)}while(h===0);return m-=t.strm.avail_in,m&&(m>=t.w_size?(t.matches=2,t.window.set(t.strm.input.subarray(t.strm.next_in-t.w_size,t.strm.next_in),0),t.strstart=t.w_size,t.insert=t.strstart):(t.window_size-t.strstart<=m&&(t.strstart-=t.w_size,t.window.set(t.window.subarray(t.w_size,t.w_size+t.strstart),0),t.matches<2&&t.matches++,t.insert>t.strstart&&(t.insert=t.strstart)),t.window.set(t.strm.input.subarray(t.strm.next_in-m,t.strm.next_in),t.strstart),t.strstart+=m,t.insert+=m>t.w_size-t.insert?t.w_size-t.insert:m),t.block_start=t.strstart),t.high_water<t.strstart&&(t.high_water=t.strstart),h?4:r!==fg&&r!==td&&t.strm.avail_in===0&&t.strstart===t.block_start?2:(c=t.window_size-t.strstart,t.strm.avail_in>c&&t.block_start>=t.w_size&&(t.block_start-=t.w_size,t.strstart-=t.w_size,t.window.set(t.window.subarray(t.w_size,t.w_size+t.strstart),0),t.matches<2&&t.matches++,c+=t.w_size,t.insert>t.strstart&&(t.insert=t.strstart)),c>t.strm.avail_in&&(c=t.strm.avail_in),c&&(LM(t.strm,t.window,t.strstart,c),t.strstart+=c,t.insert+=c>t.w_size-t.insert?t.w_size-t.insert:c),t.high_water<t.strstart&&(t.high_water=t.strstart),c=t.bi_valid+42>>3,c=t.pending_buf_size-c>65535?65535:t.pending_buf_size-c,d=c>t.w_size?t.w_size:c,a=t.strstart-t.block_start,(a>=d||(a||r===td)&&r!==fg&&t.strm.avail_in===0&&a<=c)&&(s=a>c?c:a,h=r===td&&t.strm.avail_in===0&&s===a?1:0,NM(t,t.block_start,s,h),t.block_start+=s,su(t.strm)),h?3:1)},MM=(t,r)=>{let s,a;for(;;){if(t.lookahead<mp){if(x0(t),t.lookahead<mp&&r===fg)return 1;if(t.lookahead===0)break}if(s=0,t.lookahead>=3&&(t.ins_h=gg(t,t.ins_h,t.window[t.strstart+3-1]),s=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart),s!==0&&t.strstart-s<=t.w_size-mp&&(t.match_length=aK(t,s)),t.match_length>=3)if(a=pg(t,t.strstart-t.match_start,t.match_length-3),t.lookahead-=t.match_length,t.match_length<=t.max_lazy_match&&t.lookahead>=3){t.match_length--;do t.strstart++,t.ins_h=gg(t,t.ins_h,t.window[t.strstart+3-1]),s=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart;while(--t.match_length!=0);t.strstart++}else t.strstart+=t.match_length,t.match_length=0,t.ins_h=t.window[t.strstart],t.ins_h=gg(t,t.ins_h,t.window[t.strstart+1]);else a=pg(t,0,t.window[t.strstart]),t.lookahead--,t.strstart++;if(a&&(ou(t,!1),t.strm.avail_out===0))return 1}return t.insert=t.strstart<2?t.strstart:2,r===td?(ou(t,!0),t.strm.avail_out===0?3:4):t.sym_next&&(ou(t,!1),t.strm.avail_out===0)?1:2},D0=(t,r)=>{let s,a,c;for(;;){if(t.lookahead<mp){if(x0(t),t.lookahead<mp&&r===fg)return 1;if(t.lookahead===0)break}if(s=0,t.lookahead>=3&&(t.ins_h=gg(t,t.ins_h,t.window[t.strstart+3-1]),s=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart),t.prev_length=t.match_length,t.prev_match=t.match_start,t.match_length=2,s!==0&&t.prev_length<t.max_lazy_match&&t.strstart-s<=t.w_size-mp&&(t.match_length=aK(t,s),t.match_length<=5&&(t.strategy===Eye||t.match_length===3&&t.strstart-t.match_start>4096)&&(t.match_length=2)),t.prev_length>=3&&t.match_length<=t.prev_length){c=t.strstart+t.lookahead-3,a=pg(t,t.strstart-1-t.prev_match,t.prev_length-3),t.lookahead-=t.prev_length-1,t.prev_length-=2;do++t.strstart<=c&&(t.ins_h=gg(t,t.ins_h,t.window[t.strstart+3-1]),s=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart);while(--t.prev_length!=0);if(t.match_available=0,t.match_length=2,t.strstart++,a&&(ou(t,!1),t.strm.avail_out===0))return 1}else if(t.match_available){if(a=pg(t,0,t.window[t.strstart-1]),a&&ou(t,!1),t.strstart++,t.lookahead--,t.strm.avail_out===0)return 1}else t.match_available=1,t.strstart++,t.lookahead--}return t.match_available&&(a=pg(t,0,t.window[t.strstart-1]),t.match_available=0),t.insert=t.strstart<2?t.strstart:2,r===td?(ou(t,!0),t.strm.avail_out===0?3:4):t.sym_next&&(ou(t,!1),t.strm.avail_out===0)?1:2};function gp(t,r,s,a,c){this.good_length=t,this.max_lazy=r,this.nice_length=s,this.max_chain=a,this.func=c}const GT=[new gp(0,0,0,0,cK),new gp(4,4,8,4,MM),new gp(4,5,16,8,MM),new gp(4,6,32,32,MM),new gp(4,4,16,16,D0),new gp(8,16,32,32,D0),new gp(8,16,128,128,D0),new gp(8,32,128,256,D0),new gp(32,128,258,1024,D0),new gp(32,258,258,4096,D0)];function Pye(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=NP,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new Uint16Array(2*Rye),this.dyn_dtree=new Uint16Array(2*(2*Tye+1)),this.bl_tree=new Uint16Array(2*(2*Cye+1)),mg(this.dyn_ltree),mg(this.dyn_dtree),mg(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new Uint16Array(Iye+1),this.heap=new Uint16Array(2*DM+1),mg(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new Uint16Array(2*DM+1),mg(this.depth),this.sym_buf=0,this.lit_bufsize=0,this.sym_next=0,this.sym_end=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}const HT=t=>{if(!t)return 1;const r=t.state;return!r||r.strm!==t||r.status!==N0&&r.status!==57&&r.status!==69&&r.status!==73&&r.status!==91&&r.status!==103&&r.status!==Sy&&r.status!==zT?1:0},lK=t=>{if(HT(t))return by(t,fp);t.total_in=t.total_out=0,t.data_type=wye;const r=t.state;return r.pending=0,r.pending_out=0,r.wrap<0&&(r.wrap=-r.wrap),r.status=r.wrap===2?57:r.wrap?N0:Sy,t.adler=r.wrap===2?0:1,r.last_flush=-2,hye(r),Ma},uK=t=>{const r=lK(t);return r===Ma&&(s=>{s.window_size=2*s.w_size,mg(s.head),s.max_lazy_match=GT[s.level].max_lazy,s.good_match=GT[s.level].good_length,s.nice_match=GT[s.level].nice_length,s.max_chain_length=GT[s.level].max_chain,s.strstart=0,s.block_start=0,s.lookahead=0,s.insert=0,s.match_length=s.prev_length=2,s.match_available=0,s.ins_h=0})(t.state),r},dK=(t,r,s,a,c,d)=>{if(!t)return fp;let h=1;if(r===yye&&(r=6),a<0?(h=0,a=-a):a>15&&(h=2,a-=16),c<1||c>9||s!==NP||a<8||a>15||r<0||r>9||d<0||d>Sye||a===8&&h!==1)return by(t,fp);a===8&&(a=9);const m=new Pye;return t.state=m,m.strm=t,m.status=N0,m.wrap=h,m.gzhead=null,m.w_bits=a,m.w_size=1<<m.w_bits,m.w_mask=m.w_size-1,m.hash_bits=c+7,m.hash_size=1<<m.hash_bits,m.hash_mask=m.hash_size-1,m.hash_shift=~~((m.hash_bits+3-1)/3),m.window=new Uint8Array(2*m.w_size),m.head=new Uint16Array(m.hash_size),m.prev=new Uint16Array(m.w_size),m.lit_bufsize=1<<c+6,m.pending_buf_size=4*m.lit_bufsize,m.pending_buf=new Uint8Array(m.pending_buf_size),m.sym_buf=m.lit_bufsize,m.sym_end=3*(m.lit_bufsize-1),m.level=r,m.strategy=d,m.method=s,uK(t)};var Oye=(t,r)=>{if(HT(t)||r>iK||r<0)return t?by(t,fp):fp;const s=t.state;if(!t.output||t.avail_in!==0&&!t.input||s.status===zT&&r!==td)return by(t,t.avail_out===0?xM:fp);const a=s.last_flush;if(s.last_flush=r,s.pending!==0){if(su(t),t.avail_out===0)return s.last_flush=-1,Ma}else if(t.avail_in===0&&oK(r)<=oK(a)&&r!==td)return by(t,xM);if(s.status===zT&&t.avail_in!==0)return by(t,xM);if(s.status===N0&&s.wrap===0&&(s.status=Sy),s.status===N0){let c=NP+(s.w_bits-8<<4)<<8,d=-1;if(d=s.strategy>=kP||s.level<2?0:s.level<6?1:s.level===6?2:3,c|=d<<6,s.strstart!==0&&(c|=32),c+=31-c%31,WT(s,c),s.strstart!==0&&(WT(s,t.adler>>>16),WT(s,65535&t.adler)),t.adler=1,s.status=Sy,su(t),s.pending!==0)return s.last_flush=-1,Ma}if(s.status===57){if(t.adler=0,fi(s,31),fi(s,139),fi(s,8),s.gzhead)fi(s,(s.gzhead.text?1:0)+(s.gzhead.hcrc?2:0)+(s.gzhead.extra?4:0)+(s.gzhead.name?8:0)+(s.gzhead.comment?16:0)),fi(s,255&s.gzhead.time),fi(s,s.gzhead.time>>8&255),fi(s,s.gzhead.time>>16&255),fi(s,s.gzhead.time>>24&255),fi(s,s.level===9?2:s.strategy>=kP||s.level<2?4:0),fi(s,255&s.gzhead.os),s.gzhead.extra&&s.gzhead.extra.length&&(fi(s,255&s.gzhead.extra.length),fi(s,s.gzhead.extra.length>>8&255)),s.gzhead.hcrc&&(t.adler=ga(t.adler,s.pending_buf,s.pending,0)),s.gzindex=0,s.status=69;else if(fi(s,0),fi(s,0),fi(s,0),fi(s,0),fi(s,0),fi(s,s.level===9?2:s.strategy>=kP||s.level<2?4:0),fi(s,3),s.status=Sy,su(t),s.pending!==0)return s.last_flush=-1,Ma}if(s.status===69){if(s.gzhead.extra){let c=s.pending,d=(65535&s.gzhead.extra.length)-s.gzindex;for(;s.pending+d>s.pending_buf_size;){let m=s.pending_buf_size-s.pending;if(s.pending_buf.set(s.gzhead.extra.subarray(s.gzindex,s.gzindex+m),s.pending),s.pending=s.pending_buf_size,s.gzhead.hcrc&&s.pending>c&&(t.adler=ga(t.adler,s.pending_buf,s.pending-c,c)),s.gzindex+=m,su(t),s.pending!==0)return s.last_flush=-1,Ma;c=0,d-=m}let h=new Uint8Array(s.gzhead.extra);s.pending_buf.set(h.subarray(s.gzindex,s.gzindex+d),s.pending),s.pending+=d,s.gzhead.hcrc&&s.pending>c&&(t.adler=ga(t.adler,s.pending_buf,s.pending-c,c)),s.gzindex=0}s.status=73}if(s.status===73){if(s.gzhead.name){let c,d=s.pending;do{if(s.pending===s.pending_buf_size){if(s.gzhead.hcrc&&s.pending>d&&(t.adler=ga(t.adler,s.pending_buf,s.pending-d,d)),su(t),s.pending!==0)return s.last_flush=-1,Ma;d=0}c=s.gzindex<s.gzhead.name.length?255&s.gzhead.name.charCodeAt(s.gzindex++):0,fi(s,c)}while(c!==0);s.gzhead.hcrc&&s.pending>d&&(t.adler=ga(t.adler,s.pending_buf,s.pending-d,d)),s.gzindex=0}s.status=91}if(s.status===91){if(s.gzhead.comment){let c,d=s.pending;do{if(s.pending===s.pending_buf_size){if(s.gzhead.hcrc&&s.pending>d&&(t.adler=ga(t.adler,s.pending_buf,s.pending-d,d)),su(t),s.pending!==0)return s.last_flush=-1,Ma;d=0}c=s.gzindex<s.gzhead.comment.length?255&s.gzhead.comment.charCodeAt(s.gzindex++):0,fi(s,c)}while(c!==0);s.gzhead.hcrc&&s.pending>d&&(t.adler=ga(t.adler,s.pending_buf,s.pending-d,d))}s.status=103}if(s.status===103){if(s.gzhead.hcrc){if(s.pending+2>s.pending_buf_size&&(su(t),s.pending!==0))return s.last_flush=-1,Ma;fi(s,255&t.adler),fi(s,t.adler>>8&255),t.adler=0}if(s.status=Sy,su(t),s.pending!==0)return s.last_flush=-1,Ma}if(t.avail_in!==0||s.lookahead!==0||r!==fg&&s.status!==zT){let c=s.level===0?cK(s,r):s.strategy===kP?((d,h)=>{let m;for(;;){if(d.lookahead===0&&(x0(d),d.lookahead===0)){if(h===fg)return 1;break}if(d.match_length=0,m=pg(d,0,d.window[d.strstart]),d.lookahead--,d.strstart++,m&&(ou(d,!1),d.strm.avail_out===0))return 1}return d.insert=0,h===td?(ou(d,!0),d.strm.avail_out===0?3:4):d.sym_next&&(ou(d,!1),d.strm.avail_out===0)?1:2})(s,r):s.strategy===vye?((d,h)=>{let m,g,v,w;const I=d.window;for(;;){if(d.lookahead<=vy){if(x0(d),d.lookahead<=vy&&h===fg)return 1;if(d.lookahead===0)break}if(d.match_length=0,d.lookahead>=3&&d.strstart>0&&(v=d.strstart-1,g=I[v],g===I[++v]&&g===I[++v]&&g===I[++v])){w=d.strstart+vy;do;while(g===I[++v]&&g===I[++v]&&g===I[++v]&&g===I[++v]&&g===I[++v]&&g===I[++v]&&g===I[++v]&&g===I[++v]&&v<w);d.match_length=vy-(w-v),d.match_length>d.lookahead&&(d.match_length=d.lookahead)}if(d.match_length>=3?(m=pg(d,1,d.match_length-3),d.lookahead-=d.match_length,d.strstart+=d.match_length,d.match_length=0):(m=pg(d,0,d.window[d.strstart]),d.lookahead--,d.strstart++),m&&(ou(d,!1),d.strm.avail_out===0))return 1}return d.insert=0,h===td?(ou(d,!0),d.strm.avail_out===0?3:4):d.sym_next&&(ou(d,!1),d.strm.avail_out===0)?1:2})(s,r):GT[s.level].func(s,r);if(c!==3&&c!==4||(s.status=zT),c===1||c===3)return t.avail_out===0&&(s.last_flush=-1),Ma;if(c===2&&(r===mye?fye(s):r!==iK&&(NM(s,0,0,!1),r===gye&&(mg(s.head),s.lookahead===0&&(s.strstart=0,s.block_start=0,s.insert=0))),su(t),t.avail_out===0))return s.last_flush=-1,Ma}return r!==td?Ma:s.wrap<=0?sK:(s.wrap===2?(fi(s,255&t.adler),fi(s,t.adler>>8&255),fi(s,t.adler>>16&255),fi(s,t.adler>>24&255),fi(s,255&t.total_in),fi(s,t.total_in>>8&255),fi(s,t.total_in>>16&255),fi(s,t.total_in>>24&255)):(WT(s,t.adler>>>16),WT(s,65535&t.adler)),su(t),s.wrap>0&&(s.wrap=-s.wrap),s.pending!==0?Ma:sK)},kye=(t,r)=>{let s=r.length;if(HT(t))return fp;const a=t.state,c=a.wrap;if(c===2||c===1&&a.status!==N0||a.lookahead)return fp;if(c===1&&(t.adler=BT(t.adler,r,s,0)),a.wrap=0,s>=a.w_size){c===0&&(mg(a.head),a.strstart=0,a.block_start=0,a.insert=0);let g=new Uint8Array(a.w_size);g.set(r.subarray(s-a.w_size,s),0),r=g,s=a.w_size}const d=t.avail_in,h=t.next_in,m=t.input;for(t.avail_in=s,t.next_in=0,t.input=r,x0(a);a.lookahead>=3;){let g=a.strstart,v=a.lookahead-2;do a.ins_h=gg(a,a.ins_h,a.window[g+3-1]),a.prev[g&a.w_mask]=a.head[a.ins_h],a.head[a.ins_h]=g,g++;while(--v);a.strstart=g,a.lookahead=2,x0(a)}return a.strstart+=a.lookahead,a.block_start=a.strstart,a.insert=a.lookahead,a.lookahead=0,a.match_length=a.prev_length=2,a.match_available=0,t.next_in=h,t.input=m,t.avail_in=d,a.wrap=c,Ma},$T={deflateInit:(t,r)=>dK(t,r,NP,15,8,bye),deflateInit2:dK,deflateReset:uK,deflateResetKeep:lK,deflateSetHeader:(t,r)=>HT(t)||t.state.wrap!==2?fp:(t.state.gzhead=r,Ma),deflate:Oye,deflateEnd:t=>{if(HT(t))return fp;const r=t.state.status;return t.state=null,r===Sy?by(t,_ye):Ma},deflateSetDictionary:kye,deflateInfo:"pako deflate (from Nodeca project)"};const Nye=(t,r)=>Object.prototype.hasOwnProperty.call(t,r);var xP={assign:function(t){const r=Array.prototype.slice.call(arguments,1);for(;r.length;){const s=r.shift();if(s){if(typeof s!="object")throw new TypeError(s+"must be non-object");for(const a in s)Nye(s,a)&&(t[a]=s[a])}}return t},flattenChunks:t=>{let r=0;for(let a=0,c=t.length;a<c;a++)r+=t[a].length;const s=new Uint8Array(r);for(let a=0,c=0,d=t.length;a<d;a++){let h=t[a];s.set(h,c),c+=h.length}return s}};let hK=!0;try{String.fromCharCode.apply(null,new Uint8Array(1))}catch{hK=!1}const KT=new Uint8Array(256);for(let t=0;t<256;t++)KT[t]=t>=252?6:t>=248?5:t>=240?4:t>=224?3:t>=192?2:1;KT[254]=KT[254]=1;var qT={string2buf:t=>{if(typeof TextEncoder=="function"&&TextEncoder.prototype.encode)return new TextEncoder().encode(t);let r,s,a,c,d,h=t.length,m=0;for(c=0;c<h;c++)s=t.charCodeAt(c),(64512&s)==55296&&c+1<h&&(a=t.charCodeAt(c+1),(64512&a)==56320&&(s=65536+(s-55296<<10)+(a-56320),c++)),m+=s<128?1:s<2048?2:s<65536?3:4;for(r=new Uint8Array(m),d=0,c=0;d<m;c++)s=t.charCodeAt(c),(64512&s)==55296&&c+1<h&&(a=t.charCodeAt(c+1),(64512&a)==56320&&(s=65536+(s-55296<<10)+(a-56320),c++)),s<128?r[d++]=s:s<2048?(r[d++]=192|s>>>6,r[d++]=128|63&s):s<65536?(r[d++]=224|s>>>12,r[d++]=128|s>>>6&63,r[d++]=128|63&s):(r[d++]=240|s>>>18,r[d++]=128|s>>>12&63,r[d++]=128|s>>>6&63,r[d++]=128|63&s);return r},buf2string:(t,r)=>{const s=r||t.length;if(typeof TextDecoder=="function"&&TextDecoder.prototype.decode)return new TextDecoder().decode(t.subarray(0,r));let a,c;const d=new Array(2*s);for(c=0,a=0;a<s;){let h=t[a++];if(h<128){d[c++]=h;continue}let m=KT[h];if(m>4)d[c++]=65533,a+=m-1;else{for(h&=m===2?31:m===3?15:7;m>1&&a<s;)h=h<<6|63&t[a++],m--;m>1?d[c++]=65533:h<65536?d[c++]=h:(h-=65536,d[c++]=55296|h>>10&1023,d[c++]=56320|1023&h)}}return((h,m)=>{if(m<65534&&h.subarray&&hK)return String.fromCharCode.apply(null,h.length===m?h:h.subarray(0,m));let g="";for(let v=0;v<m;v++)g+=String.fromCharCode(h[v]);return g})(d,c)},utf8border:(t,r)=>{(r=r||t.length)>t.length&&(r=t.length);let s=r-1;for(;s>=0&&(192&t[s])==128;)s--;return s<0||s===0?r:s+KT[t[s]]>r?s:r}},pK=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0};const fK=Object.prototype.toString,{Z_NO_FLUSH:xye,Z_SYNC_FLUSH:Dye,Z_FULL_FLUSH:Lye,Z_FINISH:Mye,Z_OK:DP,Z_STREAM_END:Uye,Z_DEFAULT_COMPRESSION:Vye,Z_DEFAULT_STRATEGY:jye,Z_DEFLATED:Fye}=OP;function LP(t){this.options=xP.assign({level:Vye,method:Fye,chunkSize:16384,windowBits:15,memLevel:8,strategy:jye},t||{});let r=this.options;r.raw&&r.windowBits>0?r.windowBits=-r.windowBits:r.gzip&&r.windowBits>0&&r.windowBits<16&&(r.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new pK,this.strm.avail_out=0;let s=$T.deflateInit2(this.strm,r.level,r.method,r.windowBits,r.memLevel,r.strategy);if(s!==DP)throw new Error(Ey[s]);if(r.header&&$T.deflateSetHeader(this.strm,r.header),r.dictionary){let a;if(a=typeof r.dictionary=="string"?qT.string2buf(r.dictionary):fK.call(r.dictionary)==="[object ArrayBuffer]"?new Uint8Array(r.dictionary):r.dictionary,s=$T.deflateSetDictionary(this.strm,a),s!==DP)throw new Error(Ey[s]);this._dict_set=!0}}function Bye(t,r){const s=new LP(r);if(s.push(t,!0),s.err)throw s.msg||Ey[s.err];return s.result}LP.prototype.push=function(t,r){const s=this.strm,a=this.options.chunkSize;let c,d;if(this.ended)return!1;for(d=r===~~r?r:r===!0?Mye:xye,typeof t=="string"?s.input=qT.string2buf(t):fK.call(t)==="[object ArrayBuffer]"?s.input=new Uint8Array(t):s.input=t,s.next_in=0,s.avail_in=s.input.length;;)if(s.avail_out===0&&(s.output=new Uint8Array(a),s.next_out=0,s.avail_out=a),(d===Dye||d===Lye)&&s.avail_out<=6)this.onData(s.output.subarray(0,s.next_out)),s.avail_out=0;else{if(c=$T.deflate(s,d),c===Uye)return s.next_out>0&&this.onData(s.output.subarray(0,s.next_out)),c=$T.deflateEnd(this.strm),this.onEnd(c),this.ended=!0,c===DP;if(s.avail_out!==0){if(d>0&&s.next_out>0)this.onData(s.output.subarray(0,s.next_out)),s.avail_out=0;else if(s.avail_in===0)break}else this.onData(s.output)}return!0},LP.prototype.onData=function(t){this.chunks.push(t)},LP.prototype.onEnd=function(t){t===DP&&(this.result=xP.flattenChunks(this.chunks)),this.chunks=[],this.err=t,this.msg=this.strm.msg};var zye={deflate:Bye};const MP=16209;var Wye=function(t,r){let s,a,c,d,h,m,g,v,w,I,A,N,H,B,z,ee,Z,ae,ye,_e,ue,Ae,Ue,We;const Ze=t.state;s=t.next_in,Ue=t.input,a=s+(t.avail_in-5),c=t.next_out,We=t.output,d=c-(r-t.avail_out),h=c+(t.avail_out-257),m=Ze.dmax,g=Ze.wsize,v=Ze.whave,w=Ze.wnext,I=Ze.window,A=Ze.hold,N=Ze.bits,H=Ze.lencode,B=Ze.distcode,z=(1<<Ze.lenbits)-1,ee=(1<<Ze.distbits)-1;e:do{N<15&&(A+=Ue[s++]<<N,N+=8,A+=Ue[s++]<<N,N+=8),Z=H[A&z];t:for(;;){if(ae=Z>>>24,A>>>=ae,N-=ae,ae=Z>>>16&255,ae===0)We[c++]=65535&Z;else{if(!(16&ae)){if((64&ae)==0){Z=H[(65535&Z)+(A&(1<<ae)-1)];continue t}if(32&ae){Ze.mode=16191;break e}t.msg="invalid literal/length code",Ze.mode=MP;break e}ye=65535&Z,ae&=15,ae&&(N<ae&&(A+=Ue[s++]<<N,N+=8),ye+=A&(1<<ae)-1,A>>>=ae,N-=ae),N<15&&(A+=Ue[s++]<<N,N+=8,A+=Ue[s++]<<N,N+=8),Z=B[A&ee];n:for(;;){if(ae=Z>>>24,A>>>=ae,N-=ae,ae=Z>>>16&255,!(16&ae)){if((64&ae)==0){Z=B[(65535&Z)+(A&(1<<ae)-1)];continue n}t.msg="invalid distance code",Ze.mode=MP;break e}if(_e=65535&Z,ae&=15,N<ae&&(A+=Ue[s++]<<N,N+=8,N<ae&&(A+=Ue[s++]<<N,N+=8)),_e+=A&(1<<ae)-1,_e>m){t.msg="invalid distance too far back",Ze.mode=MP;break e}if(A>>>=ae,N-=ae,ae=c-d,_e>ae){if(ae=_e-ae,ae>v&&Ze.sane){t.msg="invalid distance too far back",Ze.mode=MP;break e}if(ue=0,Ae=I,w===0){if(ue+=g-ae,ae<ye){ye-=ae;do We[c++]=I[ue++];while(--ae);ue=c-_e,Ae=We}}else if(w<ae){if(ue+=g+w-ae,ae-=w,ae<ye){ye-=ae;do We[c++]=I[ue++];while(--ae);if(ue=0,w<ye){ae=w,ye-=ae;do We[c++]=I[ue++];while(--ae);ue=c-_e,Ae=We}}}else if(ue+=w-ae,ae<ye){ye-=ae;do We[c++]=I[ue++];while(--ae);ue=c-_e,Ae=We}for(;ye>2;)We[c++]=Ae[ue++],We[c++]=Ae[ue++],We[c++]=Ae[ue++],ye-=3;ye&&(We[c++]=Ae[ue++],ye>1&&(We[c++]=Ae[ue++]))}else{ue=c-_e;do We[c++]=We[ue++],We[c++]=We[ue++],We[c++]=We[ue++],ye-=3;while(ye>2);ye&&(We[c++]=We[ue++],ye>1&&(We[c++]=We[ue++]))}break}}break}}while(s<a&&c<h);ye=N>>3,s-=ye,N-=ye<<3,A&=(1<<N)-1,t.next_in=s,t.next_out=c,t.avail_in=s<a?a-s+5:5-(s-a),t.avail_out=c<h?h-c+257:257-(c-h),Ze.hold=A,Ze.bits=N};const UP=15,Gye=new Uint16Array([3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0]),Hye=new Uint8Array([16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78]),$ye=new Uint16Array([1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0]),Kye=new Uint8Array([16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64]);var YT=(t,r,s,a,c,d,h,m)=>{const g=m.bits;let v,w,I,A,N,H,B=0,z=0,ee=0,Z=0,ae=0,ye=0,_e=0,ue=0,Ae=0,Ue=0,We=null;const Ze=new Uint16Array(16),_n=new Uint16Array(16);let bn,Zt,ir,Jn=null;for(B=0;B<=UP;B++)Ze[B]=0;for(z=0;z<a;z++)Ze[r[s+z]]++;for(ae=g,Z=UP;Z>=1&&Ze[Z]===0;Z--);if(ae>Z&&(ae=Z),Z===0)return c[d++]=20971520,c[d++]=20971520,m.bits=1,0;for(ee=1;ee<Z&&Ze[ee]===0;ee++);for(ae<ee&&(ae=ee),ue=1,B=1;B<=UP;B++)if(ue<<=1,ue-=Ze[B],ue<0)return-1;if(ue>0&&(t===0||Z!==1))return-1;for(_n[1]=0,B=1;B<UP;B++)_n[B+1]=_n[B]+Ze[B];for(z=0;z<a;z++)r[s+z]!==0&&(h[_n[r[s+z]]++]=z);if(t===0?(We=Jn=h,H=20):t===1?(We=Gye,Jn=Hye,H=257):(We=$ye,Jn=Kye,H=0),Ue=0,z=0,B=ee,N=d,ye=ae,_e=0,I=-1,Ae=1<<ae,A=Ae-1,t===1&&Ae>852||t===2&&Ae>592)return 1;for(;;){bn=B-_e,h[z]+1<H?(Zt=0,ir=h[z]):h[z]>=H?(Zt=Jn[h[z]-H],ir=We[h[z]-H]):(Zt=96,ir=0),v=1<<B-_e,w=1<<ye,ee=w;do w-=v,c[N+(Ue>>_e)+w]=bn<<24|Zt<<16|ir|0;while(w!==0);for(v=1<<B-1;Ue&v;)v>>=1;if(v!==0?(Ue&=v-1,Ue+=v):Ue=0,z++,--Ze[B]==0){if(B===Z)break;B=r[s+h[z]]}if(B>ae&&(Ue&A)!==I){for(_e===0&&(_e=ae),N+=ee,ye=B-_e,ue=1<<ye;ye+_e<Z&&(ue-=Ze[ye+_e],!(ue<=0));)ye++,ue<<=1;if(Ae+=1<<ye,t===1&&Ae>852||t===2&&Ae>592)return 1;I=Ue&A,c[I]=ae<<24|ye<<16|N-d|0}}return Ue!==0&&(c[N+Ue]=B-_e<<24|64<<16|0),m.bits=ae,0};const{Z_FINISH:mK,Z_BLOCK:qye,Z_TREES:VP,Z_OK:wy,Z_STREAM_END:Yye,Z_NEED_DICT:Xye,Z_STREAM_ERROR:nd,Z_DATA_ERROR:gK,Z_MEM_ERROR:_K,Z_BUF_ERROR:Jye,Z_DEFLATED:yK}=OP,jP=16180,FP=16190,Af=16191,UM=16192,VM=16194,BP=16199,zP=16200,jM=16206,ms=16209,EK=t=>(t>>>24&255)+(t>>>8&65280)+((65280&t)<<8)+((255&t)<<24);function Qye(){this.strm=null,this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new Uint16Array(320),this.work=new Uint16Array(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}const Ty=t=>{if(!t)return 1;const r=t.state;return!r||r.strm!==t||r.mode<jP||r.mode>16211?1:0},vK=t=>{if(Ty(t))return nd;const r=t.state;return t.total_in=t.total_out=r.total=0,t.msg="",r.wrap&&(t.adler=1&r.wrap),r.mode=jP,r.last=0,r.havedict=0,r.flags=-1,r.dmax=32768,r.head=null,r.hold=0,r.bits=0,r.lencode=r.lendyn=new Int32Array(852),r.distcode=r.distdyn=new Int32Array(592),r.sane=1,r.back=-1,wy},SK=t=>{if(Ty(t))return nd;const r=t.state;return r.wsize=0,r.whave=0,r.wnext=0,vK(t)},bK=(t,r)=>{let s;if(Ty(t))return nd;const a=t.state;return r<0?(s=0,r=-r):(s=5+(r>>4),r<48&&(r&=15)),r&&(r<8||r>15)?nd:(a.window!==null&&a.wbits!==r&&(a.window=null),a.wrap=s,a.wbits=r,SK(t))},wK=(t,r)=>{if(!t)return nd;const s=new Qye;t.state=s,s.strm=t,s.window=null,s.mode=jP;const a=bK(t,r);return a!==wy&&(t.state=null),a};let FM,BM,TK=!0;const Zye=t=>{if(TK){FM=new Int32Array(512),BM=new Int32Array(32);let r=0;for(;r<144;)t.lens[r++]=8;for(;r<256;)t.lens[r++]=9;for(;r<280;)t.lens[r++]=7;for(;r<288;)t.lens[r++]=8;for(YT(1,t.lens,0,288,FM,0,t.work,{bits:9}),r=0;r<32;)t.lens[r++]=5;YT(2,t.lens,0,32,BM,0,t.work,{bits:5}),TK=!1}t.lencode=FM,t.lenbits=9,t.distcode=BM,t.distbits=5},CK=(t,r,s,a)=>{let c;const d=t.state;return d.window===null&&(d.wsize=1<<d.wbits,d.wnext=0,d.whave=0,d.window=new Uint8Array(d.wsize)),a>=d.wsize?(d.window.set(r.subarray(s-d.wsize,s),0),d.wnext=0,d.whave=d.wsize):(c=d.wsize-d.wnext,c>a&&(c=a),d.window.set(r.subarray(s-a,s-a+c),d.wnext),(a-=c)?(d.window.set(r.subarray(s-a,s),0),d.wnext=a,d.whave=d.wsize):(d.wnext+=c,d.wnext===d.wsize&&(d.wnext=0),d.whave<d.wsize&&(d.whave+=c))),0};var eEe=(t,r)=>{let s,a,c,d,h,m,g,v,w,I,A,N,H,B,z,ee,Z,ae,ye,_e,ue,Ae,Ue=0;const We=new Uint8Array(4);let Ze,_n;const bn=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]);if(Ty(t)||!t.output||!t.input&&t.avail_in!==0)return nd;s=t.state,s.mode===Af&&(s.mode=UM),h=t.next_out,c=t.output,g=t.avail_out,d=t.next_in,a=t.input,m=t.avail_in,v=s.hold,w=s.bits,I=m,A=g,Ae=wy;e:for(;;)switch(s.mode){case jP:if(s.wrap===0){s.mode=UM;break}for(;w<16;){if(m===0)break e;m--,v+=a[d++]<<w,w+=8}if(2&s.wrap&&v===35615){s.wbits===0&&(s.wbits=15),s.check=0,We[0]=255&v,We[1]=v>>>8&255,s.check=ga(s.check,We,2,0),v=0,w=0,s.mode=16181;break}if(s.head&&(s.head.done=!1),!(1&s.wrap)||(((255&v)<<8)+(v>>8))%31){t.msg="incorrect header check",s.mode=ms;break}if((15&v)!==yK){t.msg="unknown compression method",s.mode=ms;break}if(v>>>=4,w-=4,ue=8+(15&v),s.wbits===0&&(s.wbits=ue),ue>15||ue>s.wbits){t.msg="invalid window size",s.mode=ms;break}s.dmax=1<<s.wbits,s.flags=0,t.adler=s.check=1,s.mode=512&v?16189:Af,v=0,w=0;break;case 16181:for(;w<16;){if(m===0)break e;m--,v+=a[d++]<<w,w+=8}if(s.flags=v,(255&Go(s))!==yK){t.msg="unknown compression method",s.mode=ms;break}if(57344&Go(s)){t.msg="unknown header flags set",s.mode=ms;break}s.head&&(s.head.text=v>>8&1),512&Go(s)&&4&s.wrap&&(We[0]=255&v,We[1]=v>>>8&255,s.check=ga(s.check,We,2,0)),v=0,w=0,s.mode=16182;case 16182:for(;w<32;){if(m===0)break e;m--,v+=a[d++]<<w,w+=8}s.head&&(s.head.time=v),512&Go(s)&&4&s.wrap&&(We[0]=255&v,We[1]=v>>>8&255,We[2]=v>>>16&255,We[3]=v>>>24&255,s.check=ga(s.check,We,4,0)),v=0,w=0,s.mode=16183;case 16183:for(;w<16;){if(m===0)break e;m--,v+=a[d++]<<w,w+=8}s.head&&(s.head.xflags=255&v,s.head.os=v>>8),512&Go(s)&&4&s.wrap&&(We[0]=255&v,We[1]=v>>>8&255,s.check=ga(s.check,We,2,0)),v=0,w=0,s.mode=16184;case 16184:if(1024&Go(s)){for(;w<16;){if(m===0)break e;m--,v+=a[d++]<<w,w+=8}s.length=v,s.head&&(s.head.extra_len=v),512&Go(s)&&4&s.wrap&&(We[0]=255&v,We[1]=v>>>8&255,s.check=ga(s.check,We,2,0)),v=0,w=0}else s.head&&(s.head.extra=null);s.mode=16185;case 16185:if(1024&Go(s)&&(N=s.length,N>m&&(N=m),N&&(s.head&&(ue=s.head.extra_len-s.length,s.head.extra||(s.head.extra=new Uint8Array(s.head.extra_len)),s.head.extra.set(a.subarray(d,d+N),ue)),512&Go(s)&&4&s.wrap&&(s.check=ga(s.check,a,N,d)),m-=N,d+=N,s.length-=N),s.length))break e;s.length=0,s.mode=16186;case 16186:if(2048&Go(s)){if(m===0)break e;N=0;do ue=a[d+N++],s.head&&ue&&s.length<65536&&(s.head.name+=String.fromCharCode(ue));while(ue&&N<m);if(512&Go(s)&&4&s.wrap&&(s.check=ga(s.check,a,N,d)),m-=N,d+=N,ue)break e}else s.head&&(s.head.name=null);s.length=0,s.mode=16187;case 16187:if(4096&Go(s)){if(m===0)break e;N=0;do ue=a[d+N++],s.head&&ue&&s.length<65536&&(s.head.comment+=String.fromCharCode(ue));while(ue&&N<m);if(512&Go(s)&&4&s.wrap&&(s.check=ga(s.check,a,N,d)),m-=N,d+=N,ue)break e}else s.head&&(s.head.comment=null);s.mode=16188;case 16188:if(512&Go(s)){for(;w<16;){if(m===0)break e;m--,v+=a[d++]<<w,w+=8}if(4&s.wrap&&v!==(65535&s.check)){t.msg="header crc mismatch",s.mode=ms;break}v=0,w=0}s.head&&(s.head.hcrc=Go(s)>>9&1,s.head.done=!0),t.adler=s.check=0,s.mode=Af;break;case 16189:for(;w<32;){if(m===0)break e;m--,v+=a[d++]<<w,w+=8}t.adler=s.check=EK(v),v=0,w=0,s.mode=FP;case FP:if(s.havedict===0)return t.next_out=h,t.avail_out=g,t.next_in=d,t.avail_in=m,s.hold=v,s.bits=w,Xye;t.adler=s.check=1,s.mode=Af;case Af:if(r===qye||r===VP)break e;case UM:if(s.last){v>>>=7&w,w-=7&w,s.mode=jM;break}for(;w<3;){if(m===0)break e;m--,v+=a[d++]<<w,w+=8}switch(s.last=1&v,v>>>=1,w-=1,3&v){case 0:s.mode=16193;break;case 1:if(Zye(s),s.mode=BP,r===VP){v>>>=2,w-=2;break e}break;case 2:s.mode=16196;break;case 3:t.msg="invalid block type",s.mode=ms}v>>>=2,w-=2;break;case 16193:for(v>>>=7&w,w-=7&w;w<32;){if(m===0)break e;m--,v+=a[d++]<<w,w+=8}if((65535&v)!=(v>>>16^65535)){t.msg="invalid stored block lengths",s.mode=ms;break}if(s.length=65535&v,v=0,w=0,s.mode=VM,r===VP)break e;case VM:s.mode=16195;case 16195:if(N=s.length,N){if(N>m&&(N=m),N>g&&(N=g),N===0)break e;c.set(a.subarray(d,d+N),h),m-=N,d+=N,g-=N,h+=N,s.length-=N;break}s.mode=Af;break;case 16196:for(;w<14;){if(m===0)break e;m--,v+=a[d++]<<w,w+=8}if(s.nlen=257+(31&v),v>>>=5,w-=5,s.ndist=1+(31&v),v>>>=5,w-=5,s.ncode=4+(15&v),v>>>=4,w-=4,s.nlen>286||s.ndist>30){t.msg="too many length or distance symbols",s.mode=ms;break}s.have=0,s.mode=16197;case 16197:for(;s.have<s.ncode;){for(;w<3;){if(m===0)break e;m--,v+=a[d++]<<w,w+=8}s.lens[bn[s.have++]]=7&v,v>>>=3,w-=3}for(;s.have<19;)s.lens[bn[s.have++]]=0;if(s.lencode=s.lendyn,s.lenbits=7,Ze={bits:s.lenbits},Ae=YT(0,s.lens,0,19,s.lencode,0,s.work,Ze),s.lenbits=Ze.bits,Ae){t.msg="invalid code lengths set",s.mode=ms;break}s.have=0,s.mode=16198;case 16198:for(;s.have<s.nlen+s.ndist;){for(;Ue=s.lencode[v&(1<<s.lenbits)-1],z=Ue>>>24,ee=Ue>>>16&255,Z=65535&Ue,!(z<=w);){if(m===0)break e;m--,v+=a[d++]<<w,w+=8}if(Z<16)v>>>=z,w-=z,s.lens[s.have++]=Z;else{if(Z===16){for(_n=z+2;w<_n;){if(m===0)break e;m--,v+=a[d++]<<w,w+=8}if(v>>>=z,w-=z,s.have===0){t.msg="invalid bit length repeat",s.mode=ms;break}ue=s.lens[s.have-1],N=3+(3&v),v>>>=2,w-=2}else if(Z===17){for(_n=z+3;w<_n;){if(m===0)break e;m--,v+=a[d++]<<w,w+=8}v>>>=z,w-=z,ue=0,N=3+(7&v),v>>>=3,w-=3}else{for(_n=z+7;w<_n;){if(m===0)break e;m--,v+=a[d++]<<w,w+=8}v>>>=z,w-=z,ue=0,N=11+(127&v),v>>>=7,w-=7}if(s.have+N>s.nlen+s.ndist){t.msg="invalid bit length repeat",s.mode=ms;break}for(;N--;)s.lens[s.have++]=ue}}if(s.mode===ms)break;if(s.lens[256]===0){t.msg="invalid code -- missing end-of-block",s.mode=ms;break}if(s.lenbits=9,Ze={bits:s.lenbits},Ae=YT(1,s.lens,0,s.nlen,s.lencode,0,s.work,Ze),s.lenbits=Ze.bits,Ae){t.msg="invalid literal/lengths set",s.mode=ms;break}if(s.distbits=6,s.distcode=s.distdyn,Ze={bits:s.distbits},Ae=YT(2,s.lens,s.nlen,s.ndist,s.distcode,0,s.work,Ze),s.distbits=Ze.bits,Ae){t.msg="invalid distances set",s.mode=ms;break}if(s.mode=BP,r===VP)break e;case BP:s.mode=zP;case zP:if(m>=6&&g>=258){t.next_out=h,t.avail_out=g,t.next_in=d,t.avail_in=m,s.hold=v,s.bits=w,Wye(t,A),h=t.next_out,c=t.output,g=t.avail_out,d=t.next_in,a=t.input,m=t.avail_in,v=s.hold,w=s.bits,s.mode===Af&&(s.back=-1);break}for(s.back=0;Ue=s.lencode[v&(1<<s.lenbits)-1],z=Ue>>>24,ee=Ue>>>16&255,Z=65535&Ue,!(z<=w);){if(m===0)break e;m--,v+=a[d++]<<w,w+=8}if(ee&&(240&ee)==0){for(ae=z,ye=ee,_e=Z;Ue=s.lencode[_e+((v&(1<<ae+ye)-1)>>ae)],z=Ue>>>24,ee=Ue>>>16&255,Z=65535&Ue,!(ae+z<=w);){if(m===0)break e;m--,v+=a[d++]<<w,w+=8}v>>>=ae,w-=ae,s.back+=ae}if(v>>>=z,w-=z,s.back+=z,s.length=Z,ee===0){s.mode=16205;break}if(32&ee){s.back=-1,s.mode=Af;break}if(64&ee){t.msg="invalid literal/length code",s.mode=ms;break}s.extra=15&ee,s.mode=16201;case 16201:if(s.extra){for(_n=s.extra;w<_n;){if(m===0)break e;m--,v+=a[d++]<<w,w+=8}s.length+=v&(1<<s.extra)-1,v>>>=s.extra,w-=s.extra,s.back+=s.extra}s.was=s.length,s.mode=16202;case 16202:for(;Ue=s.distcode[v&(1<<s.distbits)-1],z=Ue>>>24,ee=Ue>>>16&255,Z=65535&Ue,!(z<=w);){if(m===0)break e;m--,v+=a[d++]<<w,w+=8}if((240&ee)==0){for(ae=z,ye=ee,_e=Z;Ue=s.distcode[_e+((v&(1<<ae+ye)-1)>>ae)],z=Ue>>>24,ee=Ue>>>16&255,Z=65535&Ue,!(ae+z<=w);){if(m===0)break e;m--,v+=a[d++]<<w,w+=8}v>>>=ae,w-=ae,s.back+=ae}if(v>>>=z,w-=z,s.back+=z,64&ee){t.msg="invalid distance code",s.mode=ms;break}s.offset=Z,s.extra=15&ee,s.mode=16203;case 16203:if(s.extra){for(_n=s.extra;w<_n;){if(m===0)break e;m--,v+=a[d++]<<w,w+=8}s.offset+=v&(1<<s.extra)-1,v>>>=s.extra,w-=s.extra,s.back+=s.extra}if(s.offset>s.dmax){t.msg="invalid distance too far back",s.mode=ms;break}s.mode=16204;case 16204:if(g===0)break e;if(N=A-g,s.offset>N){if(N=s.offset-N,N>s.whave&&s.sane){t.msg="invalid distance too far back",s.mode=ms;break}N>s.wnext?(N-=s.wnext,H=s.wsize-N):H=s.wnext-N,N>s.length&&(N=s.length),B=s.window}else B=c,H=h-s.offset,N=s.length;N>g&&(N=g),g-=N,s.length-=N;do c[h++]=B[H++];while(--N);s.length===0&&(s.mode=zP);break;case 16205:if(g===0)break e;c[h++]=s.length,g--,s.mode=zP;break;case jM:if(s.wrap){for(;w<32;){if(m===0)break e;m--,v|=a[d++]<<w,w+=8}if(A-=g,t.total_out+=A,s.total+=A,4&s.wrap&&A&&(t.adler=s.check=Go(s)?ga(s.check,c,A,h-A):BT(s.check,c,A,h-A)),A=g,4&s.wrap&&(Go(s)?v:EK(v))!==s.check){t.msg="incorrect data check",s.mode=ms;break}v=0,w=0}s.mode=16207;case 16207:if(s.wrap&&Go(s)){for(;w<32;){if(m===0)break e;m--,v+=a[d++]<<w,w+=8}if(4&s.wrap&&v!==(4294967295&s.total)){t.msg="incorrect length check",s.mode=ms;break}v=0,w=0}s.mode=16208;case 16208:Ae=Yye;break e;case ms:Ae=gK;break e;case 16210:return _K;default:return nd}return t.next_out=h,t.avail_out=g,t.next_in=d,t.avail_in=m,s.hold=v,s.bits=w,(s.wsize||A!==t.avail_out&&s.mode<ms&&(s.mode<jM||r!==mK))&&CK(t,t.output,t.next_out,A-t.avail_out),I-=t.avail_in,A-=t.avail_out,t.total_in+=I,t.total_out+=A,s.total+=A,4&s.wrap&&A&&(t.adler=s.check=Go(s)?ga(s.check,c,A,t.next_out-A):BT(s.check,c,A,t.next_out-A)),t.data_type=s.bits+(s.last?64:0)+(s.mode===Af?128:0)+(s.mode===BP||s.mode===VM?256:0),(I===0&&A===0||r===mK)&&Ae===wy&&(Ae=Jye),Ae},Pf={inflateReset:SK,inflateReset2:bK,inflateResetKeep:vK,inflateInit:t=>wK(t,15),inflateInit2:wK,inflate:eEe,inflateEnd:t=>{if(Ty(t))return nd;let r=t.state;return r.window&&(r.window=null),t.state=null,wy},inflateGetHeader:(t,r)=>{if(Ty(t))return nd;const s=t.state;return(2&s.wrap)==0?nd:(s.head=r,r.done=!1,wy)},inflateSetDictionary:(t,r)=>{const s=r.length;let a,c,d;return Ty(t)?nd:(a=t.state,a.wrap!==0&&a.mode!==FP?nd:a.mode===FP&&(c=1,c=BT(c,r,s,0),c!==a.check)?gK:(d=CK(t,r,s,s),d?(a.mode=16210,_K):(a.havedict=1,wy)))},inflateInfo:"pako inflate (from Nodeca project)"},tEe=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1};const RK=Object.prototype.toString,{Z_NO_FLUSH:nEe,Z_FINISH:rEe,Z_OK:XT,Z_STREAM_END:zM,Z_NEED_DICT:WM,Z_STREAM_ERROR:iEe,Z_DATA_ERROR:IK,Z_MEM_ERROR:sEe}=OP;function WP(t){this.options=xP.assign({chunkSize:65536,windowBits:15,to:""},t||{});const r=this.options;r.raw&&r.windowBits>=0&&r.windowBits<16&&(r.windowBits=-r.windowBits,r.windowBits===0&&(r.windowBits=-15)),!(r.windowBits>=0&&r.windowBits<16)||t&&t.windowBits||(r.windowBits+=32),r.windowBits>15&&r.windowBits<48&&(15&r.windowBits)==0&&(r.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new pK,this.strm.avail_out=0;let s=Pf.inflateInit2(this.strm,r.windowBits);if(s!==XT)throw new Error(Ey[s]);if(this.header=new tEe,Pf.inflateGetHeader(this.strm,this.header),r.dictionary&&(typeof r.dictionary=="string"?r.dictionary=qT.string2buf(r.dictionary):RK.call(r.dictionary)==="[object ArrayBuffer]"&&(r.dictionary=new Uint8Array(r.dictionary)),r.raw&&(s=Pf.inflateSetDictionary(this.strm,r.dictionary),s!==XT)))throw new Error(Ey[s])}function oEe(t,r){const s=new WP(r);if(s.push(t),s.err)throw s.msg||Ey[s.err];return s.result}WP.prototype.push=function(t,r){const s=this.strm,a=this.options.chunkSize,c=this.options.dictionary;let d,h,m;if(this.ended)return!1;for(h=r===~~r?r:r===!0?rEe:nEe,RK.call(t)==="[object ArrayBuffer]"?s.input=new Uint8Array(t):s.input=t,s.next_in=0,s.avail_in=s.input.length;;){for(s.avail_out===0&&(s.output=new Uint8Array(a),s.next_out=0,s.avail_out=a),d=Pf.inflate(s,h),d===WM&&c&&(d=Pf.inflateSetDictionary(s,c),d===XT?d=Pf.inflate(s,h):d===IK&&(d=WM));s.avail_in>0&&d===zM&&s.state.wrap>0&&t[s.next_in]!==0;)Pf.inflateReset(s),d=Pf.inflate(s,h);switch(d){case iEe:case IK:case WM:case sEe:return this.onEnd(d),this.ended=!0,!1}if(m=s.avail_out,s.next_out&&(s.avail_out===0||d===zM))if(this.options.to==="string"){let g=qT.utf8border(s.output,s.next_out),v=s.next_out-g,w=qT.buf2string(s.output,g);s.next_out=v,s.avail_out=a-v,v&&s.output.set(s.output.subarray(g,g+v),0),this.onData(w)}else this.onData(s.output.length===s.next_out?s.output:s.output.subarray(0,s.next_out));if(d!==XT||m!==0){if(d===zM)return d=Pf.inflateEnd(this.strm),this.onEnd(d),this.ended=!0,!0;if(s.avail_in===0)break}}return!0},WP.prototype.onData=function(t){this.chunks.push(t)},WP.prototype.onEnd=function(t){t===XT&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=xP.flattenChunks(this.chunks)),this.chunks=[],this.err=t,this.msg=this.strm.msg};var aEe={inflate:oEe};const{deflate:cEe}=zye,{inflate:lEe}=aEe;var uEe=cEe,dEe=lEe,AK=(function(t){return t[t.ONE_BYTE=0]="ONE_BYTE",t[t.TWO_BYTE=1]="TWO_BYTE",t})(AK||{});class hEe{constructor(){X(this,"_sequence",0),X(this,"_startTime",Date.now()),X(this,"isUseOneByte",!0)}get startTime(){const r=Date.now()-this._startTime;return r<Math.pow(2,16)?r:(this._startTime+=Math.pow(2,16),this.startTime)}get sequence(){return this._sequence<Math.pow(2,32)?this._sequence++:(this._sequence-=Math.pow(2,32),this.sequence)}serialize(r){const s={commonPacketHeader:{length:0,reserved:0,extension:0,sequence:this.sequence},commonStreamHeader:this.startTime,extension:void 0,payload:r};if(r.byteLength>128){const m=new Uint8Array(4);m.set([1,0,0,0]);const g={id:0,length:4,data:m.buffer},v={profile:this.isUseOneByte?0:1,length:this.isUseOneByte?5:6,datas:[g]};s.commonPacketHeader.extension=1,s.extension=v,s.payload=this.compress(r),s.commonPacketHeader.length=8+(s.extension.length+2)+s.payload.byteLength}else s.commonPacketHeader.length=8+s.payload.byteLength;oe("SHOW_DATASTREAM2_LOG")&&M.debug("send data header: ".concat(JSON.stringify(s.commonPacketHeader)));const a=new ArrayBuffer(s.commonPacketHeader.length),c=new Uint8Array(a),d=new DataView(a);let h=0;if(d.setUint16(h,s.commonPacketHeader.extension<<15|s.commonPacketHeader.reserved<<14|s.commonPacketHeader.length,!0),h+=2,d.setUint32(h,s.commonPacketHeader.sequence,!0),h+=4,d.setUint16(h,s.commonStreamHeader,!0),h+=2,s.extension){const m=this.serializeExtension(s.extension);c.set(new Uint8Array(m),h),h+=m.byteLength}if(c.set(new Uint8Array(s.payload),h),h+=s.payload.byteLength,h!==s.commonPacketHeader.length)throw Error("serialize error!");return a}deserialize(r){if(r.byteLength<4)return new ArrayBuffer(0);const s=new DataView(r);let a=0;const c=s.getUint16(a,!0);a+=2;const d={length:16383&c,reserved:(16384&c)>>14,extension:(32768&c)>>15,sequence:s.getUint16(a+2,!0)<<16|s.getUint16(a,!0)};let h,m;if(a+=4,oe("SHOW_DATASTREAM2_LOG")&&M.debug("receive data header: ".concat(JSON.stringify(d))),s.getUint16(a,!0),a+=2,d.extension){m=this.deserializeExtension(r.slice(a)),a+=2+m.length,h=r.slice(a);let g=!1;if(m.datas.length>0){const v=m.datas.find((w=>w.id===0));v&&(g=(1&new DataView(v.data).getUint32(0,!0))==1)}h=g?this.decompress(h):h}else h=r.slice(8);return h}serializeExtension(r){const{profile:s,length:a,datas:c}=r,d=new ArrayBuffer(a+2),h=new Uint8Array(d),m=new DataView(d);let g=0;if(m.setUint8(g++,s),m.setUint8(g++,a),c.forEach((v=>{s?(m.setUint8(g++,v.id),m.setUint8(g++,v.length),h.set(new Uint8Array(v.data),g),g+=v.data.byteLength):(m.setUint8(g++,v.id|v.length<<4),h.set(new Uint8Array(v.data),g),g+=v.data.byteLength)})),g!==a+2)throw Error("serialize extension error, is ".concat(g,"!==").concat(a+2));return d}deserializeExtension(r){const s=new DataView(r);let a=0;const c=s.getUint8(a);a++;const d=s.getUint8(a);a++;const h=c===AK.TWO_BYTE,m=[],g=new DataView(r,2);let v=0;for(;v<d;){let w=0,I=0,A=new ArrayBuffer(0);h?(w=g.getUint8(v),v++,I=g.getUint8(v),v++):(w=15&g.getUint8(v),I=g.getUint8(v)>>4,v++),I>0&&(A=g.buffer.slice(v+2,v+2+I),v+=A.byteLength),m.push({id:w,length:I,data:A})}if(v!==d)throw Error("parse error");return{profile:c,length:d,datas:m}}decompress(r){return dEe(new Uint8Array(r))}compress(r){return uEe(new Uint8Array(r))}}const pEe={name:"DataStream",create:(t,r)=>{const s=r?new Sge(t):new bge(t);return s.useDataStream(new hEe),s}};class fEe extends Zr{constructor(r,s,a){super(),X(this,"ws",void 0),X(this,"requestId",1),X(this,"heartBeatTimer",void 0),X(this,"joinInfo",void 0),X(this,"clientId",void 0),X(this,"onOpen",(()=>{this.emit("open"),this.startHeartBeatCheck()})),X(this,"onClose",(c=>{this.emit("close"),this.dispose()})),X(this,"onMessage",(c=>{const d=JSON.parse(c.data);if(!d||d.command!=="serverResponse"||!d.requestId)return d&&d.command==="serverStatus"&&d.serverStatus&&d.serverStatus.command?(this.emit("status",d.serverStatus),void this.emit(d.serverStatus.command,d.serverStatus)):void 0;this.emit("req_".concat(d.requestId),d)})),this.joinInfo=r,this.clientId=s,this.ws=new bT("cross-channel-".concat(this.clientId),a),this.ws.on(pn.RECONNECTING,(()=>{this.ws.reconnectMode="retry",this.emit("reconnecting")})),this.ws.on(pn.CONNECTED,this.onOpen),this.ws.on(pn.ON_MESSAGE,this.onMessage),this.ws.on(pn.CLOSED,this.onClose)}isConnect(){return this.ws.state==="connected"}sendMessage(r){const s=this.requestId++;return r.requestId=s,r.seq=s,this.ws.sendMessage(r),s}waitStatus(r){return new mt(((s,a)=>{const c=window.setTimeout((()=>{a(new ke(te.TIMEOUT,"wait status timeout, status: ".concat(r)))}),5e3);this.once(r,(d=>{window.clearTimeout(c),d.state&&d.state!==0?a(new ke(te.CROSS_CHANNEL_WAIT_STATUS_ERROR,"wait status error, status: ".concat(r))):s(void 0)})),this.once("dispose",(()=>{window.clearTimeout(c),a(new ke(te.WS_ABORT))}))}))}async request(r){if(this.ws.state==="closed")throw new ke(te.WS_DISCONNECT);const s=()=>new mt(((h,m)=>{this.ws.once(pn.CLOSED,(()=>m(new ke(te.WS_ABORT)))),this.ws.once(pn.CONNECTED,h)}));this.ws.state!=="connected"&&await s();const a=this.sendMessage(r),c=new mt(((h,m)=>{const g=()=>{m(new ke(te.WS_ABORT))};this.ws.once(pn.RECONNECTING,g),this.ws.once(pn.CLOSED,g),this.once("req_".concat(a),h),Is(3e3).then((()=>{this.removeAllListeners("req_".concat(a)),this.ws.off(pn.RECONNECTING,g),this.ws.off(pn.CLOSED,g),m(new ke(te.TIMEOUT,"cross channel ws request timeout"))}))})),d=await c;if(!d||d.code!==200)throw new ke(te.CROSS_CHANNEL_SERVER_ERROR_RESPONSE,"response: ".concat(JSON.stringify(d)));return d}async connect(r){this.ws.removeAllListeners(pn.REQUEST_NEW_URLS),this.ws.on(pn.REQUEST_NEW_URLS,(s=>{s(r)})),await this.ws.init(r)}dispose(){this.clearHeartBeatCheck(),this.emit("dispose"),this.removeAllListeners(),this.ws.close()}sendPing(r){const s=this.requestId++;return r.requestId=s,this.ws.sendMessage(r),s}startHeartBeatCheck(){this.heartBeatTimer&&window.clearInterval(this.heartBeatTimer),this.heartBeatTimer=window.setInterval((()=>{this.sendPing({command:"ping",appId:this.joinInfo.appId,cname:this.joinInfo.cname,uid:this.joinInfo.uid.toString(),sid:this.joinInfo.sid,ts:+new Date,requestId:0})}),3e3)}clearHeartBeatCheck(){window.clearInterval(this.heartBeatTimer),this.heartBeatTimer=void 0}}class mEe extends Zr{set state(r){r!==this._state&&(r!==ic.RELAY_STATE_FAILURE&&(this.errorCode=y0.RELAY_OK),this.emit("state",r,this.errorCode),this._state=r)}get state(){return this._state}constructor(r,s,a,c,d){super(),X(this,"joinInfo",void 0),X(this,"sid",void 0),X(this,"clientId",void 0),X(this,"cancelToken",Na.CancelToken.source()),X(this,"workerToken",void 0),X(this,"requestId",0),X(this,"signal",void 0),X(this,"prevChannelMediaConfig",void 0),X(this,"httpRetryConfig",void 0),X(this,"_resolution",void 0),X(this,"_state",ic.RELAY_STATE_IDLE),X(this,"errorCode",y0.RELAY_OK),X(this,"onStatus",(h=>{M.debug("[".concat(this.clientId,"] ChannelMediaStatus: ").concat(JSON.stringify(h))),h&&h.command&&(h.command==="onAudioPacketReceived"&&this.emit("event",wf.PACKET_RECEIVED_AUDIO_FROM_SRC),h.command==="onVideoPacketReceived"&&this.emit("event",wf.PACKET_RECEIVED_VIDEO_FROM_SRC),h.command==="onSrcTokenPrivilegeDidExpire"&&(this.errorCode=y0.SRC_TOKEN_EXPIRED,this.state=ic.RELAY_STATE_FAILURE),h.command==="onDestTokenPrivilegeDidExpire"&&(this.errorCode=y0.DEST_TOKEN_EXPIRED,this.state=ic.RELAY_STATE_FAILURE))})),X(this,"onReconnect",(async()=>{M.debug("[".concat(this.clientId,"] ChannelMediaSocket disconnect, reconnecting")),this.emit("event",wf.NETWORK_DISCONNECTED),this.state=ic.RELAY_STATE_IDLE,this.prevChannelMediaConfig&&this.sendStartRelayMessage(this.prevChannelMediaConfig).catch((h=>{this.state!==ic.RELAY_STATE_IDLE&&(M.error("auto restart channel media relay failed",h.toString()),this.errorCode=y0.SERVER_CONNECTION_LOST,this.state=ic.RELAY_STATE_FAILURE)}))})),this.joinInfo=r,this.clientId=s,this.sid=sy(),this.signal=new fEe(this.joinInfo,this.clientId,a),this.httpRetryConfig=c,this._resolution=d}async startChannelMediaRelay(r){if(this.state!==ic.RELAY_STATE_IDLE)throw new ke(te.INVALID_OPERATION);this.state=ic.RELAY_STATE_CONNECTING,await this.connect(),M.debug("[".concat(this.clientId,"] startChannelMediaRelay: connect success"));try{await this.sendStartRelayMessage(r)}catch(s){throw s.data&&s.data.serverResponse&&s.data.serverResponse.command==="SetSourceChannel"?new ke(te.CROSS_CHANNEL_FAILED_JOIN_SRC):s.data&&s.data.serverResponse&&s.serverResponse.command==="SetDestChannelStatus"?new ke(te.CROSS_CHANNEL_FAILED_JOIN_DEST):s.data&&s.data.serverResponse&&s.serverResponse.command==="StartPacketTransfer"?new ke(te.CROSS_CHANNEL_FAILED_PACKET_SENT_TO_DEST):s}this.prevChannelMediaConfig=r}async updateChannelMediaRelay(r){if(this.state!==ic.RELAY_STATE_RUNNING)throw new ke(te.INVALID_OPERATION);await this.sendUpdateMessage(r),this.prevChannelMediaConfig=r}async setVideoProfile(r){if(this._resolution=r,this.state!==ic.RELAY_STATE_RUNNING)throw new ke(te.INVALID_OPERATION);const s=this.genMessage(ma.SetVideoProfile);await this.signal.request(s),M.debug("[".concat(this.clientId,"] startChannelMediaRelay: setVideoProfile success"))}async stopChannelMediaRelay(){await this.sendStopRelayMessage(),M.debug("[".concat(this.clientId,"] stopChannelMediaRelay: send stop message success")),this.state=ic.RELAY_STATE_IDLE,this.dispose()}dispose(){M.debug("[".concat(this.clientId,"] disposeChannelMediaRelay")),this.cancelToken.cancel(),this.cancelToken=Na.CancelToken.source(),this.state=ic.RELAY_STATE_IDLE,this.emit("dispose"),this.signal.dispose(),this.prevChannelMediaConfig=void 0}async connect(){const r=await I_e(this.joinInfo,this.cancelToken.token,this.httpRetryConfig);this.workerToken=r.workerToken,await this.signal.connect(r.addressList),this.emit("event",wf.NETWORK_CONNECTED),this.signal.on("status",this.onStatus),this.signal.on("reconnecting",this.onReconnect)}async sendStartRelayMessage(r){const s=this.genMessage(ma.StopPacketTransfer);await this.signal.request(s),await this.signal.waitStatus("Normal Quit"),M.debug("[".concat(this.clientId,"] startChannelMediaRelay: StopPacketTransfer success"));const a=this.genMessage(ma.SetSdkProfile,r);await this.signal.request(a),M.debug("[".concat(this.clientId,"] startChannelMediaRelay: SetSdkProfile success"));const c=this.genMessage(ma.SetSourceChannel,r);await this.signal.request(c),await this.signal.waitStatus("SetSourceChannelStatus"),this.emit("event",wf.PACKET_JOINED_SRC_CHANNEL),M.debug("[".concat(this.clientId,"] startChannelMediaRelay: SetSourceChannel success"));const d=this.genMessage(ma.SetSourceUserId,r);await this.signal.request(d),M.debug("[".concat(this.clientId,"] startChannelMediaRelay: SetSourceUserId success"));const h=this.genMessage(ma.SetDestChannel,r);await this.signal.request(h),await this.signal.waitStatus("SetDestChannelStatus"),this.emit("event",wf.PACKET_JOINED_DEST_CHANNEL),M.debug("[".concat(this.clientId,"] startChannelMediaRelay: SetDestChannel success"));const m=this.genMessage(ma.StartPacketTransfer,r);await this.signal.request(m),this.emit("event",wf.PACKET_SENT_TO_DEST_CHANNEL),this.state=ic.RELAY_STATE_RUNNING,M.debug("[".concat(this.clientId,"] startChannelMediaRelay: StartPacketTransfer success")),this.setVideoProfile(this._resolution)}async sendUpdateMessage(r){const s=this.genMessage(ma.UpdateDestChannel,r);await this.signal.request(s),this.emit("event",wf.PACKET_UPDATE_DEST_CHANNEL),M.debug("[".concat(this.clientId,"] sendUpdateMessage: UpdateDestChannel success"))}async sendStopRelayMessage(){const r=this.genMessage(ma.StopPacketTransfer);await this.signal.request(r),M.debug("[".concat(this.clientId,"] sendStopRelayMessage: StopPacketTransfer success"))}genMessage(r,s){const a=[],c=[],d=[];this.requestId+=1;const h={appId:this.joinInfo.appId,cname:this.joinInfo.cname,uid:this.joinInfo.uid.toString(),sdkVersion:Zl,sid:this.sid,ts:Date.now(),requestId:this.requestId,seq:this.requestId,allocate:!0,clientRequest:{}};h.sdkVersion==="4.24.0"&&(h.sdkVersion="0.0.1");let m=null,g=null;switch(r){case ma.SetSdkProfile:return h.clientRequest={command:"SetSdkProfile",type:"multi_channel"},h;case ma.SetSourceChannel:if(g=s&&s.getSrcChannelMediaInfo(),!g)throw new ke(te.UNEXPECTED_ERROR,"can not find source config");return h.clientRequest={command:"SetSourceChannel",uid:"0",channelName:g.channelName,token:g.token||this.joinInfo.appId},h;case ma.SetSourceUserId:if(g=s&&s.getSrcChannelMediaInfo(),!g)throw new ke(te.UNEXPECTED_ERROR,"can not find source config");return h.clientRequest={command:"SetSourceUserId",uid:g.uid+""},h;case ma.SetDestChannel:if(m=s&&s.getDestChannelMediaInfo(),!m)throw new ke(te.UNEXPECTED_ERROR,"can not find dest config");return m.forEach((v=>{a.push(v.channelName),c.push(v.uid+""),d.push(v.token||this.joinInfo.appId)})),h.clientRequest={command:"SetDestChannel",channelName:a,uid:c,token:d},h;case ma.StartPacketTransfer:return h.clientRequest={command:"StartPacketTransfer"},h;case ma.Reconnect:return h.clientRequest={command:"Reconnect"},h;case ma.StopPacketTransfer:return h.clientRequest={command:"StopPacketTransfer"},h;case ma.UpdateDestChannel:if(m=s&&s.getDestChannelMediaInfo(),!m)throw new ke(te.UNEXPECTED_ERROR,"can not find dest config");return m.forEach((v=>{a.push(v.channelName),c.push(v.uid+""),d.push(v.token||this.joinInfo.appId)})),h.clientRequest={command:"UpdateDestChannel",channelName:a,uid:c,token:d},h;case ma.SetVideoProfile:h.clientRequest={command:"SetVideoProfile",width:this._resolution.width,height:this._resolution.height}}return h}}const gEe={name:"ChannelMediaRelay",create:function(t){return new mEe(t.joinInfo,t.clientId,t.websocketRetryConfig||Vi,t.httpRetryConfig||Vi,t.resolution)}};function PK(t,r){var s=Object.keys(t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);r&&(a=a.filter((function(c){return Object.getOwnPropertyDescriptor(t,c).enumerable}))),s.push.apply(s,a)}return s}function JT(t){for(var r=1;r<arguments.length;r++){var s=arguments[r]!=null?arguments[r]:{};r%2?PK(Object(s),!0).forEach((function(a){X(t,a,s[a])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(s)):PK(Object(s)).forEach((function(a){Object.defineProperty(t,a,Object.getOwnPropertyDescriptor(s,a))}))}return t}class _Ee extends Zr{constructor(r,s,a,c){super(),X(this,"spec",void 0),X(this,"token",void 0),X(this,"websocket",void 0),X(this,"pingpongTimer",void 0),X(this,"reconnectMode","retry"),X(this,"serviceMode",void 0),X(this,"reqId",0),X(this,"commandReqId",0),X(this,"handleWebSocketOpen",(()=>{this.reconnectMode="retry",this.startPingPong()})),X(this,"handleWebSocketMessage",(d=>{if(!d.data)return;const h=JSON.parse(d.data);h.requestId?this.emit("@".concat(h.requestId,"-").concat(h.sid),h):(It.workerEvent(this.spec.sid,{actionType:"status",serverCode:h.code,workerType:this.serviceMode===bf.TRANSCODE?1:2}),this.emit(tg.PUBLISH_STREAM_STATUS,h))})),this.spec=s,this.token=r,this.serviceMode=c,this.websocket=new bT("live-streaming",a),this.websocket.on(pn.CONNECTED,this.handleWebSocketOpen),this.websocket.on(pn.ON_MESSAGE,this.handleWebSocketMessage),this.websocket.on(pn.REQUEST_NEW_URLS,((d,h)=>{zs(this,tg.REQUEST_NEW_ADDRESS).then(d).catch(h)})),this.websocket.on(pn.RECONNECTING,(()=>{this.websocket.reconnectMode=this.reconnectMode}))}init(r){return this.websocket.init(r)}async request(r,s,a,c){this.reqId+=1,r==="request"&&(this.commandReqId+=1);const d=this.commandReqId,h=this.reqId;if(!h||!this.websocket)throw new ke(te.UNEXPECTED_ERROR);const m=JT({command:r,sdkVersion:Zl==="4.24.0"?"0.0.1":Zl,seq:h,requestId:h,allocate:a,cname:this.spec.cname,appId:this.spec.appId,sid:this.spec.sid,uid:this.spec.uid.toString(),ts:Math.floor(Date.now()/1e3)},s);if(this.websocket.state==="closed")throw new ke(te.WS_DISCONNECT);const g=()=>new mt(((A,N)=>{this.websocket.once(pn.CLOSED,(()=>N(new ke(te.WS_ABORT)))),this.websocket.once(pn.CONNECTED,A)}));this.websocket.state!=="connected"&&await g(),m.clientRequest&&(m.clientRequest.workerToken=this.token);const v=new mt(((A,N)=>{const H=()=>{N(new ke(te.WS_ABORT))};this.websocket.once(pn.RECONNECTING,H),this.websocket.once(pn.CLOSED,H),this.once("@".concat(h,"-").concat(this.spec.sid),(B=>{A(B)}))}));c&&It.workerEvent(this.spec.sid,JT(JT({},c),{},{requestId:d,actionType:"request",payload:JSON.stringify(s.clientRequest),serverCode:0,code:0}));const w=Date.now();this.websocket.sendMessage(m);let I=null;try{I=await v}catch(A){if(this.websocket.state==="closed")throw A;return await g(),await this.request(r,s,a)}return c&&It.workerEvent(this.spec.sid,JT(JT({},c),{},{requestId:d,actionType:"response",payload:JSON.stringify(I.serverResponse),serverCode:I.code,success:I.code===200,responseTime:Date.now()-w})),I.code!==200&&this.handleResponseError(I),I}tryNextAddress(){this.reconnectMode="tryNext",this.websocket.reconnect("tryNext")}close(){const r=Zl==="4.24.0"?"0.0.1":Zl;this.reqId+=1,this.websocket.state==="connected"?(this.websocket.sendMessage({command:"request",appId:this.spec.appId,cname:this.spec.cname,uid:this.spec.uid.toString(),sdkVersion:r,sid:this.spec.sid,seq:this.reqId,ts:Math.floor(Date.now()/1e3),requestId:this.reqId,clientRequest:{command:"DestroyWorker"}}),this.websocket.close(!1,!0)):this.websocket.close(!1),this.pingpongTimer&&(window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0)}handleResponseError(r){switch(r.code){case Hi.LIVE_STREAM_RESPONSE_ALREADY_EXISTS_STREAM:return void M.warning("live stream response already exists stream");case Hi.LIVE_STREAM_RESPONSE_TRANSCODING_PARAMETER_ERROR:case Hi.LIVE_STREAM_RESPONSE_BAD_STREAM:case Hi.LIVE_STREAM_RESPONSE_WM_PARAMETER_ERROR:return new ke(te.LIVE_STREAMING_INVALID_ARGUMENT,"",{code:r.code}).throw();case Hi.LIVE_STREAM_RESPONSE_WM_WORKER_NOT_EXIST:if(r.serverResponse.command==="UnpublishStream")return;throw new ke(te.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"live stream response wm worker not exist",{retry:!0});case Hi.LIVE_STREAM_RESPONSE_NOT_AUTHORIZED:return new ke(te.LIVE_STREAMING_PUBLISH_STREAM_NOT_AUTHORIZED,"",{code:r.code}).throw();case Hi.LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE:{const s=new ke(te.LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE);return this.emit(tg.WARNING,s,r.serverResponse.url)}case Hi.LIVE_STREAM_RESPONSE_REQUEST_TOO_OFTEN:{const s=new ke(te.LIVE_STREAMING_WARN_FREQUENT_REQUEST);return this.emit(tg.WARNING,s,r.serverResponse.url)}case Hi.LIVE_STREAM_RESPONSE_NOT_FOUND_PUBLISH:throw new ke(te.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"live stream response wm worker not exist",{retry:!0});case Hi.LIVE_STREAM_RESPONSE_NOT_SUPPORTED:return new ke(te.LIVE_STREAMING_TRANSCODING_NOT_SUPPORTED,"",{code:r.code}).throw();case Hi.LIVE_STREAM_RESPONSE_MAX_STREAM_NUM:{const s=new ke(te.LIVE_STREAMING_WARN_STREAM_NUM_REACH_LIMIT);return this.emit(tg.WARNING,s,r.serverResponse.url)}case Hi.LIVE_STREAM_RESPONSE_INTERNAL_SERVER_ERROR:return new ke(te.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"",{code:r.code}).throw();case Hi.LIVE_STREAM_RESPONSE_RESOURCE_LIMIT:throw new ke(te.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"live stream resource limit",{retry:!0,changeAddress:!0});case Hi.LIVE_STREAM_RESPONSE_WORKER_LOST:case Hi.LIVE_STREAM_RESPONSE_WORKER_QUIT:if(r.serverResponse.command==="UnpublishStream")return;throw new ke(te.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"error fail send message",{retry:!0,changeAddress:!0});case Hi.ERROR_FAIL_SEND_MESSAGE:if(r.serverResponse.command==="UnpublishStream")return;if(r.serverResponse.command==="UpdateTranscoding"||r.serverResponse.command==="ControlStream")return new ke(te.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"error fail send message",{code:r.code}).throw();throw new ke(te.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"error fail send message",{retry:!0,changeAddress:!0});case Hi.PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN:case Hi.PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT:case Hi.PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE:case Hi.PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH:return new ke(te.LIVE_STREAMING_CDN_ERROR,"",{code:r.code}).throw()}}startPingPong(){this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval((()=>{this.websocket.state==="connected"&&this.request("ping",{}).catch(A1)}),6e3)}}function OK(t,r){var s=Object.keys(t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);r&&(a=a.filter((function(c){return Object.getOwnPropertyDescriptor(t,c).enumerable}))),s.push.apply(s,a)}return s}function sc(t){for(var r=1;r<arguments.length;r++){var s=arguments[r]!=null?arguments[r]:{};r%2?OK(Object(s),!0).forEach((function(a){X(t,a,s[a])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(s)):OK(Object(s)).forEach((function(a){Object.defineProperty(t,a,Object.getOwnPropertyDescriptor(s,a))}))}return t}class yEe extends Zr{constructor(r){let s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:Vi,a=arguments.length>2&&arguments[2]!==void 0?arguments[2]:Vi;super(),X(this,"onLiveStreamWarning",void 0),X(this,"onLiveStreamError",void 0),X(this,"spec",void 0),X(this,"retryTimeout",1e4),X(this,"connection",void 0),X(this,"httpRetryConfig",void 0),X(this,"wsRetryConfig",void 0),X(this,"streamingTasks",new Map),X(this,"isStartingStreamingTask",!1),X(this,"taskMutex",new so("live-streaming")),X(this,"cancelToken",Na.CancelToken.source()),X(this,"transcodingConfig",void 0),X(this,"uapResponse",void 0),X(this,"lastTaskId",1),X(this,"statusError",new Map),this.spec=r,this.httpRetryConfig=a,this.wsRetryConfig=s}async setTranscodingConfig(r){const s=sc(sc({},s_e),r);s.videoCodecProfile!==66&&s.videoCodecProfile!==77&&s.videoCodecProfile!==100&&(M.debug("[".concat(this.spec.clientId,"] set transcoding config, fix video codec profile: ").concat(s.videoCodecProfile," -> 100")),s.videoCodecProfile=100),s.transcodingUsers||(s.transcodingUsers=s.userConfigs),s.transcodingUsers&&(s.transcodingUsers=s.transcodingUsers.map((h=>sc(sc(sc({},i_e),h),{},{zOrder:h.zOrder?h.zOrder+1:1})))),(function(h){si(h.width)||vr(h.width,"config.width",0,1e4),si(h.height)||vr(h.height,"config.height",0,1e4),si(h.videoBitrate)||vr(h.videoBitrate,"config.videoBitrate",1,1e6),si(h.videoFrameRate)||vr(h.videoFrameRate,"config.videoFrameRate"),si(h.lowLatency)||Yd(h.lowLatency,"config.lowLatency"),si(h.audioSampleRate)||Zi(h.audioSampleRate,"config.audioSampleRate",[32e3,44100,48e3]),si(h.audioBitrate)||vr(h.audioBitrate,"config.audioBitrate",1,128),si(h.audioChannels)||Zi(h.audioChannels,"config.audioChannels",[1,2,3,4,5]),si(h.videoGop)||vr(h.videoGop,"config.videoGop"),si(h.videoCodecProfile)||Zi(h.videoCodecProfile,"config.videoCodecProfile",[66,77,100]),si(h.userCount)||vr(h.userCount,"config.userCount",0,17),si(h.backgroundColor)||vr(h.backgroundColor,"config.backgroundColor",0,16777215),si(h.userConfigExtraInfo)||Rs(h.userConfigExtraInfo,"config.userConfigExtraInfo",0,4096,!1),h.transcodingUsers&&!si(h.transcodingUsers)&&(Sf(h.transcodingUsers,"config.transcodingUsers"),h.transcodingUsers.forEach(((m,g)=>{Q1(m.uid),si(m.x)||vr(m.x,"transcodingUser[".concat(g,"].x"),0,1e4),si(m.y)||vr(m.y,"transcodingUser[".concat(g,"].y"),0,1e4),si(m.width)||vr(m.width,"transcodingUser[".concat(g,"].width"),0,1e4),si(m.height)||vr(m.height,"transcodingUser[".concat(g,"].height"),0,1e4),si(m.zOrder)||vr(m.zOrder-1,"transcodingUser[".concat(g,"].zOrder"),0,100),si(m.alpha)||vr(m.alpha,"transcodingUser[".concat(g,"].alpha"),0,1,!1)}))),si(h.watermark)||z2(h.watermark,"watermark"),si(h.backgroundImage)||z2(h.backgroundImage,"backgroundImage"),h.images&&!si(h.images)&&(Sf(h.images,"config.images"),h.images.forEach(((m,g)=>{z2(m,"images[".concat(g,"]"))})))})(s);const a=[];s.images&&a.push(...s.images.map((h=>sc(sc(sc({},B2),h),{},{zOrder:255})))),s.backgroundImage&&(a.push(sc(sc(sc({},B2),s.backgroundImage),{},{zOrder:0})),delete s.backgroundImage),s.watermark&&(a.push(sc(sc(sc({},B2),s.watermark),{},{zOrder:255})),delete s.watermark),s.images=a,s.transcodingUsers&&(s.userConfigs=s.transcodingUsers.map((h=>sc({},h))),s.userCount=s.transcodingUsers.length,delete s.transcodingUsers);const c=(s.userConfigs||[]).map((h=>typeof h.uid=="number"?mt.resolve(h.uid):tH(h.uid,this.spec,this.cancelToken.token,this.httpRetryConfig)));if((await mt.all(c)).forEach(((h,m)=>{s.userConfigs&&s.userConfigs[m]&&(s.userConfigs[m].uid=h)})),this.transcodingConfig=s,this.connection)try{var d;const h=await this.connection.request("request",{clientRequest:{command:"UpdateTranscoding",transcodingConfig:this.transcodingConfig}},!1,{command:"UpdateTranscoding",workerType:1,requestByUser:!0,tid:Array.from(Pc(d=this.streamingTasks).call(d)).map((m=>m.taskId)).join("#")});M.debug("[".concat(this.spec.clientId,"] update live transcoding config success, code: ").concat(h.code,", config:"),JSON.stringify(this.transcodingConfig))}catch(h){if(!h.data||!h.data.retry)throw h;h.data.changeAddress&&this.connection.tryNextAddress(),this.streamingTasks.forEach((m=>{M.warning("[".concat(this.spec.clientId,"] live streaming receive error"),h.toString(),"try to republish",m.url),this.startLiveStreamingTask(m.url,m.mode,h).then((()=>{M.debug("[".concat(this.spec.clientId,"] live streaming republish ").concat(m.url," success"))})).catch((g=>{M.error("[".concat(this.spec.clientId,"] live streaming republish failed"),m.url,g.toString()),this.onLiveStreamError&&this.onLiveStreamError(m.url,g)}))}))}}async startLiveStreamingTask(r,s,a){if(!this.transcodingConfig&&s===bf.TRANSCODE)throw new ke(te.INVALID_OPERATION,"[LiveStreaming] no transcoding config found, can not start transcoding streaming task");const c={command:"PublishStream",ts:Date.now(),url:r,uid:this.spec.uid.toString(),autoDestroyTime:100,acceptImageTimeout:!0};M.debug("[".concat(this.spec.clientId,"] start live streaming ").concat(r,", mode: ").concat(s));const d=await this.taskMutex.lock();if(!this.connection&&a)return void d();if(this.streamingTasks.get(r)&&!a)return d(),new ke(te.LIVE_STREAMING_TASK_CONFLICT).throw();try{this.connection||(this.connection=await this.connect(s))}catch(m){throw d(),m}switch(s){case bf.TRANSCODE:c.transcodingConfig=sc({},this.transcodingConfig)}this.uapResponse&&this.uapResponse.vid&&(c.vid=this.uapResponse.vid),this.isStartingStreamingTask=!0;const h=this.lastTaskId++;try{const m=new mt(((v,w)=>{Is(this.retryTimeout).then((()=>{if(a)return w(a);const I=this.statusError.get(r);return I?(this.statusError.delete(r),w(I)):void 0}))})),g=await mt.race([this.connection.request("request",{clientRequest:c},!0,{url:r,command:"PublishStream",workerType:s===bf.TRANSCODE?1:2,requestByUser:!a,tid:h.toString()}),m]);this.isStartingStreamingTask=!1,M.debug("[".concat(this.spec.clientId,"] live streaming started, code: ").concat(g.code)),this.streamingTasks.set(r,{clientRequest:c,mode:s,url:r,taskId:h}),d()}catch(m){if(d(),this.isStartingStreamingTask=!1,!m.data||!m.data.retry||a)throw m;return m.data.changeAddress?(this.connection.tryNextAddress(),await this.startLiveStreamingTask(r,s,m)):await this.startLiveStreamingTask(r,s,m)}}stopLiveStreamingTask(r){return new mt(((s,a)=>{const c=this.streamingTasks.get(r);if(!c||!this.connection)return new ke(te.UNEXPECTED_ERROR,"can not find streaming task to stop").throw();const d=c.mode;c.abortTask=()=>{M.debug("[".concat(this.spec.clientId,"] stop live streaming success(worker exception)")),this.streamingTasks.delete(r),s()},this.connection.request("request",{clientRequest:{command:"UnpublishStream",url:c.url}},!1,{url:r,command:"UnPublishStream",workerType:d===bf.TRANSCODE?1:2,requestByUser:!0,tid:(this.lastTaskId++).toString()}).then((h=>{M.debug("[".concat(this.spec.clientId,"] stop live streaming success, code: ").concat(h.code)),this.streamingTasks.delete(r),this.streamingTasks.size===0&&(this.connection&&this.connection.close(),this.connection=void 0),s()})).catch(a)}))}resetAllTask(){var r;const s=Array.from(Pc(r=this.streamingTasks).call(r));this.terminate();for(const a of s)this.startLiveStreamingTask(a.url,a.mode).catch((c=>{this.onLiveStreamError&&this.onLiveStreamError(a.url,c)}))}terminate(){this.cancelToken&&this.cancelToken.cancel(),this.streamingTasks=new Map,this.isStartingStreamingTask=!1,this.statusError=new Map,this.cancelToken=Na.CancelToken.source(),this.uapResponse=void 0,this.connection&&this.connection.close(),this.connection=void 0}async connect(r){if(this.connection)throw new ke(te.UNEXPECTED_ERROR,"live streaming connection has already connected");const s=await zs(this,W2.REQUEST_WORKER_MANAGER_LIST,r);return this.uapResponse=s,this.connection=new _Ee(s.workerToken,this.spec,this.wsRetryConfig,r),this.connection.on(tg.WARNING,((a,c)=>this.onLiveStreamWarning&&this.onLiveStreamWarning(c,a))),this.connection.on(tg.PUBLISH_STREAM_STATUS,(a=>this.handlePublishStreamServer(a))),this.connection.on(tg.REQUEST_NEW_ADDRESS,((a,c)=>{if(!this.connection)return c(new ke(te.UNEXPECTED_ERROR,"can not get new live streaming address list"));zs(this,W2.REQUEST_WORKER_MANAGER_LIST,r).then((d=>{this.uapResponse=d,a(d.addressList)})).catch(c)})),await this.connection.init(s.addressList),this.connection}handlePublishStreamServer(r){const s=r.serverStatus&&r.serverStatus.url||"empty_url",a=this.streamingTasks.get(s),c=r.reason;switch(r.code){case Hi.PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN:case Hi.PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT:case Hi.PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE:case Hi.PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH:{const h=new ke(te.LIVE_STREAMING_CDN_ERROR,"",{code:r.code});if(a)return M.error(h.toString()),this.onLiveStreamError&&this.onLiveStreamError(s,h);if(!this.isStartingStreamingTask)return;this.statusError.set(s,h)}case Hi.LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE:{const h=new ke(te.LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE,c);return this.onLiveStreamWarning&&this.onLiveStreamWarning(s,h)}case Hi.LIVE_STREAM_RESPONSE_WORKER_LOST:case Hi.LIVE_STREAM_RESPONSE_WORKER_QUIT:{var d;if(!this.connection)return;this.connection.tryNextAddress();const h=Array.from(Pc(d=this.streamingTasks).call(d));for(const m of h)m.abortTask?m.abortTask():(M.warning("[".concat(this.spec.clientId,"] publish stream status code"),r.code,"try to republish",m.url),this.startLiveStreamingTask(m.url,m.mode,new ke(te.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"",{code:r.code})).then((()=>{M.debug("[".concat(this.spec.clientId,"] republish live stream success"),m.url)})).catch((g=>{M.error(g.toString()),this.onLiveStreamError&&this.onLiveStreamError(m.url,g)})));return}}}hasUrl(r){return this.streamingTasks.has(r)}}const EEe={name:"LiveStreaming",create:function(t){return new yEe(t.joinInfo,t.websocketRetryConfig||Vi,t.httpRetryConfig||Vi)}};function vEe(t){let r=xK();return(function(s,a){let c=s.appId;c!==void 0&&(hr(a,10),_p(a,c));let d=s.cid;d!==void 0&&(hr(a,16),hr(a,d));let h=s.cname;h!==void 0&&(hr(a,26),_p(a,h));let m=s.deviceId;m!==void 0&&(hr(a,34),_p(a,m));let g=s.elapse;g!==void 0&&(hr(a,40),_g(a,g));let v=s.fileSize;v!==void 0&&(hr(a,48),_g(a,L0(v)));let w=s.height;w!==void 0&&(hr(a,56),_g(a,L0(w)));let I=s.jpg;I!==void 0&&(hr(a,66),hr(a,I.length),(function(uo,ze){let ot=M0(uo,ze.length);uo.bytes.set(ze,ot)})(a,I));let A=s.networkType;A!==void 0&&(hr(a,72),_g(a,L0(A)));let N=s.osType;N!==void 0&&(hr(a,80),_g(a,L0(N)));let H=s.requestId;H!==void 0&&(hr(a,90),_p(a,H));let B=s.sdkVersion;B!==void 0&&(hr(a,98),_p(a,B));let z=s.sequence;z!==void 0&&(hr(a,104),_g(a,L0(z)));let ee=s.sid;ee!==void 0&&(hr(a,114),_p(a,ee));let Z=s.timestamp;Z!==void 0&&(hr(a,120),_g(a,Z));let ae=s.uid;ae!==void 0&&(hr(a,128),hr(a,ae));let ye=s.vid;ye!==void 0&&(hr(a,136),hr(a,ye));let _e=s.width;_e!==void 0&&(hr(a,144),_g(a,L0(_e)));let ue=s.service;ue!==void 0&&(hr(a,152),hr(a,ue));let Ae=s.callbackData;Ae!==void 0&&(hr(a,162),_p(a,Ae));let Ue=s.jpgEncryption;Ue!==void 0&&(hr(a,168),hr(a,Ue));let We=s.requestType;We!==void 0&&(hr(a,176),hr(a,We));let Ze=s.scorePorn;Ze!==void 0&&(hr(a,185),qM(a,Ze));let _n=s.scoreSexy;_n!==void 0&&(hr(a,193),qM(a,_n));let bn=s.scoreNeutral;bn!==void 0&&(hr(a,201),qM(a,bn));let Zt=s.scene;Zt!==void 0&&(hr(a,208),hr(a,Zt));let ir=s.ossFilePrefix;ir!==void 0&&(hr(a,218),_p(a,ir));let Jn=s.serviceVendor;if(Jn!==void 0)for(let uo of Jn){hr(a,226);let ze=xK();wEe(uo,ze),hr(a,ze.limit),IEe(a,ze),REe(ze)}})(t,r),(function(s){let a=s.bytes,c=s.limit;return a.length===c?a:a.subarray(0,c)})(r)}function SEe(t){return(function(s){let a={};e:for(;!DK(s);){let c=yp(s);switch(c>>>3){case 0:break e;case 1:a.code=yp(s);break;case 2:a.msg=LK(s,yp(s));break;case 3:{let d=TEe(s);a.data=bEe(s),s.limit=d;break}default:kK(s,7&c)}}return a})({bytes:r=t,offset:0,limit:r.length});var r}function bEe(t){let r={};e:for(;!DK(t);){let s=yp(t);switch(s>>>3){case 0:break e;case 1:r.requestId=LK(t,yp(t));break;case 2:r.requestType=yp(t)>>>0;break;case 3:r.scorePorn=KM(t);break;case 4:r.scoreSexy=KM(t);break;case 5:r.scoreNeutral=KM(t);break;case 6:r.requestScene=yp(t)>>>0;break;case 7:r.scene=yp(t)>>>0;break;default:kK(t,7&s)}}return r}function wEe(t,r){let s=t.service;s!==void 0&&(hr(r,8),hr(r,s));let a=t.vendor;a!==void 0&&(hr(r,16),hr(r,a));let c=t.token;c!==void 0&&(hr(r,26),_p(r,c));let d=t.callbackUrl;d!==void 0&&(hr(r,34),_p(r,d))}function TEe(t){let r=yp(t),s=t.limit;return t.limit=t.offset+r,s}function kK(t,r){switch(r){case 0:for(;128&MK(t););break;case 2:HM(t,yp(t));break;case 5:HM(t,4);break;case 1:HM(t,8);break;default:throw new Error("Unimplemented type: "+r)}}let CEe=new Float32Array(1);new Uint8Array(CEe.buffer);let GM=new Float64Array(1),oc=new Uint8Array(GM.buffer);function L0(t){return{low:t|=0,high:t>>31,unsigned:t>=0}}let NK=[];function xK(){const t=NK.pop();return t?(t.offset=t.limit=0,t):{bytes:new Uint8Array(64),offset:0,limit:0}}function REe(t){NK.push(t)}function HM(t,r){if(t.offset+r>t.limit)throw new Error("Skip past limit");t.offset+=r}function DK(t){return t.offset>=t.limit}function M0(t,r){let s=t.bytes,a=t.offset,c=t.limit,d=a+r;if(d>s.length){let h=new Uint8Array(2*d);h.set(s),t.bytes=h}return t.offset=d,d>c&&(t.limit=d),a}function $M(t,r){let s=t.offset;if(s+r>t.limit)throw new Error("Read past limit");return t.offset+=r,s}function LK(t,r){let s=$M(t,r),a=String.fromCharCode,c=t.bytes,d="",h="";for(let m=0;m<r;m++){let g,v,w,I,A=c[m+s];(128&A)==0?h+=a(A):(224&A)==192?m+1>=r?h+=d:(g=c[m+s+1],(192&g)!=128?h+=d:(I=(31&A)<<6|63&g,I<128?h+=d:(h+=a(I),m++))):(240&A)==224?m+2>=r?h+=d:(g=c[m+s+1],v=c[m+s+2],(49344&(g|v<<8))!=32896?h+=d:(I=(15&A)<<12|(63&g)<<6|63&v,I<2048||I>=55296&&I<=57343?h+=d:(h+=a(I),m+=2))):(248&A)==240?m+3>=r?h+=d:(g=c[m+s+1],v=c[m+s+2],w=c[m+s+3],(12632256&(g|v<<8|w<<16))!=8421504?h+=d:(I=(7&A)<<18|(63&g)<<12|(63&v)<<6|63&w,I<65536||I>1114111?h+=d:(I-=65536,h+=a(55296+(I>>10),56320+(1023&I)),m+=3))):h+=d}return h}function _p(t,r){let s=r.length,a=0;for(let h=0;h<s;h++){let m=r.charCodeAt(h);m>=55296&&m<=56319&&h+1<s&&(m=(m<<10)+r.charCodeAt(++h)-56613888),a+=m<128?1:m<2048?2:m<65536?3:4}hr(t,a);let c=M0(t,a),d=t.bytes;for(let h=0;h<s;h++){let m=r.charCodeAt(h);m>=55296&&m<=56319&&h+1<s&&(m=(m<<10)+r.charCodeAt(++h)-56613888),m<128?d[c++]=m:(m<2048?d[c++]=m>>6&31|192:(m<65536?d[c++]=m>>12&15|224:(d[c++]=m>>18&7|240,d[c++]=m>>12&63|128),d[c++]=m>>6&63|128),d[c++]=63&m|128)}}function IEe(t,r){let s=M0(t,r.limit),a=t.bytes,c=r.bytes;for(let d=0,h=r.limit;d<h;d++)a[d+s]=c[d]}function MK(t){return t.bytes[$M(t,1)]}function UK(t,r){let s=M0(t,1);t.bytes[s]=r}function KM(t){let r=$M(t,8),s=t.bytes;return oc[0]=s[r++],oc[1]=s[r++],oc[2]=s[r++],oc[3]=s[r++],oc[4]=s[r++],oc[5]=s[r++],oc[6]=s[r++],oc[7]=s[r++],GM[0]}function qM(t,r){let s=M0(t,8),a=t.bytes;GM[0]=r,a[s++]=oc[0],a[s++]=oc[1],a[s++]=oc[2],a[s++]=oc[3],a[s++]=oc[4],a[s++]=oc[5],a[s++]=oc[6],a[s++]=oc[7]}function yp(t){let r,s=0,a=0;do r=MK(t),s<32&&(a|=(127&r)<<s),s+=7;while(128&r);return a}function hr(t,r){for(r>>>=0;r>=128;)UK(t,127&r|128),r>>>=7;UK(t,r)}function _g(t,r){let s=r.low>>>0,a=(r.low>>>28|r.high<<4)>>>0,c=r.high>>>24,d=c===0?a===0?s<16384?s<128?1:2:s<1<<21?3:4:a<16384?a<128?5:6:a<1<<21?7:8:c<128?9:10,h=M0(t,d),m=t.bytes;switch(d){case 10:m[h+9]=c>>>7&1;case 9:m[h+8]=d!==9?128|c:127&c;case 8:m[h+7]=d!==8?a>>>21|128:a>>>21&127;case 7:m[h+6]=d!==7?a>>>14|128:a>>>14&127;case 6:m[h+5]=d!==6?a>>>7|128:a>>>7&127;case 5:m[h+4]=d!==5?128|a:127&a;case 4:m[h+3]=d!==4?s>>>21|128:s>>>21&127;case 3:m[h+2]=d!==3?s>>>14|128:s>>>14&127;case 2:m[h+1]=d!==2?s>>>7|128:s>>>7&127;case 1:m[h]=d!==1?128|s:127&s}}function VK(t,r){var s=Object.keys(t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);r&&(a=a.filter((function(c){return Object.getOwnPropertyDescriptor(t,c).enumerable}))),s.push.apply(s,a)}return s}const AEe=new Map([["moderation",1],["supervise",2]]);class PEe extends Zr{get connectionState(){return this._connectionState}set connectionState(r){if(this._connectionState===r)return;const s=this._connectionState;this._connectionState=r,this.emit(fs.CONNECTION_STATE_CHANGE,s,r)}get inspectType(){return this._inspectType}set inspectType(r){var s;this._inspectMode=Xa(s=r.map((a=>AEe.get(a)||0))).call(s,((a,c)=>a+c)),this._inspectType=r}get quality(){return this._quality}set quality(r){this._quality=r>1?1:r<.1?.1:r,this.qualityTimer&&(window.clearTimeout(this.qualityTimer),this.qualityTimer=null),this._quality>=1||(this.qualityTimer=window.setTimeout((()=>{this.quality=this._quality/this.qualityRatio}),6e4))}constructor(r){super(),X(this,"name","AgoraRTCVideoContentInspect"),X(this,"_connectionState",Xu.CONNECTING),X(this,"_innerConnectionState",void 0),X(this,"sequence",0),X(this,"inspectStartTime",void 0),X(this,"workerManagerConnection",void 0),X(this,"workerConnection",void 0),X(this,"workerMessageLengthLimit",void 0),X(this,"inspectIntervalMinimum",void 0),X(this,"qualityRatio",void 0),X(this,"_connectInfo",void 0),X(this,"_cancelTokenSource",Na.CancelToken.source()),X(this,"_retryConfig",void 0),X(this,"wmSequence",0),X(this,"inspectInterval",void 0),X(this,"inspectTimer",null),X(this,"ossFilePrefix",void 0),X(this,"extraInfo",void 0),X(this,"_inspectType",void 0),X(this,"_inspectMode",void 0),X(this,"_quality",1),X(this,"qualityTimer",null),X(this,"_inspectId",void 0),X(this,"_needWorkUrlOnly",!1),X(this,"inspectImage",(()=>{if(this.connectionState!==Xu.CONNECTED)throw new ke(te.OPERATION_ABORTED,"content inspect service connection status is ".concat(this.connectionState));this.inspectTimer&&(window.clearInterval(this.inspectTimer),this.inspectTimer=null),this.inspectTimer=window.setInterval((()=>{this.connectionState===Xu.CONNECTED?this.requestToInspectImage():M.debug("[".concat(this._inspectId,"] Inspect State is not connected , "),this.connectionState)}),this.inspectInterval<this.inspectIntervalMinimum?this.inspectIntervalMinimum:this.inspectInterval),this.requestToInspectImage()})),this._inspectId=Tr(5,"inspect-"),this.workerMessageLengthLimit=oe("VIDEO_INSPECT_WORKER_MESSAGE_LENGTH_LIMIT"),this.inspectIntervalMinimum=oe("VIDEO_INSPECT_INTERVAL_MINIMUM"),this.qualityRatio=oe("VIDEO_INSPECT_QUALITY_RATIO"),this.inspectInterval=r.interval,this.ossFilePrefix=r.ossFilePrefix,this.extraInfo=r.extraInfo,this.inspectType=r.inspectType,this.inspectStartTime=Number(Date.now()),this.workerManagerConnection=new bT("worker-manager-"+this._inspectId,Vi),this.on(fs.STATE_CHANGE,((s,a)=>{this._innerConnectionState=s,M.debug("[".concat(this._inspectId,"] Inspect operation :").concat(Ju[s]," ").concat(a||""))})),this.handleWorkerManagerEvents(),this.workerConnection=new bT("worker-"+this._inspectId,Vi),this.handleWorkerEvents()}async init(r,s){this.emit(fs.STATE_CHANGE,Ju.CONNECT_AP),this._connectInfo=r;const a=this._cancelTokenSource.token;return this._retryConfig=s,new mt(((c,d)=>{this.on(fs.CONNECTION_STATE_CHANGE,((h,m)=>{m===Xu.CONNECTED&&c()})),this.requestAP(r,a,s).then((h=>{this.connectWorkerManager(h)})).catch((h=>{d(h)}))}))}async requestAP(r,s,a){const c=oe("WEBCS_DOMAIN").map((m=>"https://".concat(m,"/api/v1"))),d=await(function(m,g,v,w){let{appId:I,areaCode:A,cname:N,sid:H,token:B,uid:z}=g;C0++;const ee="image_moderation_api",Z={service_name:ee,json_body:JSON.stringify({appId:I,areaCode:A,cname:N,command:"allocateEdge",requestId:C0,seq:C0,sid:H,token:B,ts:Date.now(),uid:z+""})};let ae,ye,_e=m[0];return Xd((async()=>{ae=Date.now();const ue=await th(_e,{data:Z,cancelToken:v,headers:{"X-Packet-Service-Type":"0","X-Packet-URI":"61"},params:{action:"wrtc_gateway"}});if(ye=Date.now()-ae,ue.code!==0){const Ze=new ke(te.UNEXPECTED_RESPONSE,"image inspect ap error, code"+ue.code,{retry:!0,responseTime:ye});throw M.error(Ze.toString()),Ze}const Ae=JSON.parse(ue.json_body);if(Ae.code!==200){const Ze=new ke(te.UNEXPECTED_RESPONSE,"image inspect ap error, code: ".concat(Ae.code,", reason: ").concat(Ae.reason),{code:Ae.code,responseTime:ye});throw M.error(Ze.toString()),Ze}if(!Ae.servers||!Array.isArray(Ae.servers)||Ae.servers.length===0){const Ze=new ke(te.UNEXPECTED_RESPONSE,"image inspect ap empty server",{code:Ae.code,responseTime:ye});throw M.error(Ze.toString()),Ze}const Ue=oe("VIDEO_INSPECT_WORKER_MANAGER_HOST"),We=oe("VIDEO_INSPECT_WORKER_MANAGER_PORT");return{addressList:Ae.servers.map((Ze=>{let{address:_n,wss:bn}=Ze;if(_n&&bn)return"wss://".concat(_n.replace(/\./g,"-"),".").concat(Ue,":").concat(We||bn)})).filter((Ze=>!!Ze)),workerToken:Ae.workerToken,vid:Ae.vid,responseTime:ye}}),((ue,Ae)=>(It.apworkerEvent(H,{success:!0,sc:200,serviceName:ee,responseDetail:JSON.stringify(ue.addressList),firstSuccess:Ae===0,responseTime:ye,serverIp:m[Ae%m.length]}),!1)),((ue,Ae)=>(It.apworkerEvent(H,{success:!1,sc:ue.data&&ue.data.code||200,serviceName:ee,responseTime:ye,serverIp:m[Ae%m.length]}),!!(ue.code!==te.OPERATION_ABORTED&&ue.code!==te.UNEXPECTED_RESPONSE||ue.data&&ue.data.retry)&&(_e=m[(Ae+1)%m.length],!0))),w)})(c,r,s,a);this.emit(fs.STATE_CHANGE,Ju.AP_CONNECTED);const{addressList:h}=d;return this.wmSequence++,h}async connectWorkerManager(r){let s=arguments.length>1&&arguments[1]!==void 0&&arguments[1];this._needWorkUrlOnly=s,this.emit(fs.STATE_CHANGE,Ju.CONNECT_WORKER_MANAGER),await this.workerManagerConnection.init(r,1e4)}async connectWorker(r){await this.workerConnection.init([r])}handleWorkerManagerEvents(){this.workerManagerConnection.on(pn.CONNECTED,(async()=>{this.emit(fs.STATE_CHANGE,Ju.WORKER_MANAGER_CONNECTED,this.workerManagerConnection.url),this.workerManagerConnection.sendMessage({appId:this._connectInfo.appId,cname:this._connectInfo.cname,uid:this._connectInfo.uid+"",sdkVersion:"4.24.0",sid:this._connectInfo.sid,seq:this.wmSequence,ts:Number(Date.now()),requestId:Math.floor(1e12*Math.random()),allocate:!0,clientRequest:{command:"join"}},!0)})),this.workerManagerConnection.on(pn.CLOSED,(()=>{this._innerConnectionState<Ju.GET_WORKER_MANAGER_RESPONSE&&M.debug("[".concat(this._inspectId,"] Inspect worker manager is closed before connecting worker"))})),this.workerManagerConnection.on(pn.FAILED,(()=>{this._innerConnectionState<Ju.GET_WORKER_MANAGER_RESPONSE&&M.debug("[".concat(this._inspectId,"] Connecting inspect worker manager is failed before connecting worker"))})),this.workerManagerConnection.on(pn.RECONNECTING,(()=>{this._innerConnectionState<Ju.GET_WORKER_MANAGER_RESPONSE&&M.debug("[".concat(this._inspectId,"] Inspect worker manager is reconnecting before connecting worker"))})),this.workerManagerConnection.on(pn.ON_MESSAGE,(async r=>{this.emit(fs.STATE_CHANGE,Ju.GET_WORKER_MANAGER_RESPONSE);const s=this.workerManagerConnection.url;this.workerManagerConnection.close();const a=JSON.parse(r.data);if(a.code!==200)throw M.error("[".concat(this._inspectId,"] Unexpected code ").concat(a.code," from worker manager")),new ke(te.UNEXPECTED_RESPONSE,"response code of worker is unexpected",a);if(!(a.serverResponse&&a.serverResponse.portWss&&s))throw M.error("[".concat(this._inspectId,"] Unexpected content from worker manager : ").concat(JSON.stringify(a))),new ke(te.UNEXPECTED_RESPONSE,"response content of worker is unexpected",a);{const c=oe("VIDEO_INSPECT_WORKER_PORT")||a.serverResponse.portWss,d=s.replace(/:\d+\/?$/,":".concat(c));this.emit(fs.STATE_CHANGE,Ju.CONNECT_WORKER,d),this._needWorkUrlOnly?this.emit(fs.REQUEST_NEW_WORKER_URL,d):await this.connectWorker(d)}})),this.workerManagerConnection.on(pn.WILL_RECONNECT,((r,s,a)=>{a(r)})),this.workerManagerConnection.on(pn.REQUEST_NEW_URLS,((r,s)=>{this.requestAP(this._connectInfo,this._cancelTokenSource.token,this._retryConfig).then(r).catch(s)}))}handleWorkerEvents(){this.workerConnection.on(pn.CONNECTED,(async()=>{this.emit(fs.STATE_CHANGE,Ju.WORKER_CONNECTED,this.workerConnection.url),this.connectionState=Xu.CONNECTED})),this.workerConnection.on(pn.ON_MESSAGE,(async r=>{if(r.data instanceof ArrayBuffer){const a=SEe(new Uint8Array(r.data));if(oe("SHOW_VIDEO_INSPECT_WORKER_MESSAGE")&&M.debug("[".concat(this._inspectId,"] Response message for worker of inspect content "),JSON.stringify(a)),a.code===200){if(Array.isArray(this.inspectType)&&this.inspectType.length===1&&this.inspectType[0]==="supervise")return void this.emit(fs.INSPECT_RESULT,void 0,void 0);if(a.data&&a.data.scorePorn&&a.data.scoreSexy&&a.data.scoreNeutral){var s;const c={porn:a.data.scorePorn,sexy:a.data.scoreSexy,neutral:a.data.scoreNeutral},d=Xa(s=Object.keys(c)).call(s,((m,g)=>c[m]>c[g]?m:g),"porn"),h=Object.keys(c).find((m=>m===d));this.emit(fs.INSPECT_RESULT,h)}else this.emit(fs.INSPECT_RESULT,void 0,new ke(te.UNEXPECTED_RESPONSE,a.code+"","There is an unexpected data on message"))}else this.emit(fs.INSPECT_RESULT,void 0,new ke(te.UNEXPECTED_RESPONSE,a.code+"",a.msg))}else M.error("[".concat(this._inspectId,"] Unexpected message type from worker")),this.emit(fs.INSPECT_RESULT,void 0,new ke(te.UNEXPECTED_RESPONSE,"invalid worker message type"))})),this.workerConnection.on(pn.CLOSED,(()=>{this.connectionState=Xu.CLOSED})),this.workerConnection.on(pn.FAILED,(()=>{this.connectionState=Xu.CLOSED})),this.workerConnection.on(pn.RECONNECTING,(()=>{this.connectionState=this.connectionState===Xu.CONNECTED?Xu.RECONNECTING:Xu.CONNECTING})),this.workerConnection.on(pn.WILL_RECONNECT,((r,s,a)=>{r==="recover"&&a(r),a("tryNext")})),this.workerConnection.on(pn.REQUEST_NEW_URLS,((r,s)=>{this.workerManagerConnection.close(),this.once(fs.REQUEST_NEW_WORKER_URL,(a=>{r([a])})),this.requestAP(this._connectInfo,this._cancelTokenSource.token,this._retryConfig).then((a=>{this.connectWorkerManager(a,!0)})).catch((a=>{s(a)}))}))}async requestToInspectImage(){this.sequence++;const r=al(this,fs.CLIENT_LOCAL_VIDEO_TRACK),s={appId:this._connectInfo.appId,cname:this._connectInfo.cname,cid:this._connectInfo.cid,sid:this._connectInfo.sid,uid:this._connectInfo.uid,vid:this._connectInfo.vid};if(r){if(!r.isPlaying)return void this.emit(fs.INSPECT_RESULT,void 0,new ke(te.INVALID_OPERATION,"Only the track being played can be inspected"));const a=await this.generateRequestData(r,s);this.workerConnection.sendMessage(a,!0,!0)}else this.emit(fs.INSPECT_RESULT,void 0,new ke(te.INVALID_OPERATION,"Only the track being published can be inspected"))}async generateRequestData(r,s){let{appId:a,cname:c,cid:d,vid:h,sid:m,uid:g}=s;const v=Date.now(),w=await r.getCurrentFrameImage("image/jpeg",this.quality),I=await yW(w,a,c),A=this.sequence+"-"+d+"-"+g+"-"+v+"-"+Tr(12,""),N={appId:a,cid:d,cname:c,deviceId:"",elapse:(H=Number(v-this.inspectStartTime),{low:H|=0,high:H>>31,unsigned:H>=0}),fileSize:I.byteLength,jpgEncryption:2,height:w.height,width:w.width,jpg:I,networkType:6,osType:7,requestId:A,sdkVersion:"4.24.0",sequence:this.sequence,sid:m,timestamp:$H(v),uid:g,vid:h,service:this._inspectMode,callbackData:this.extraInfo,ossFilePrefix:this.ossFilePrefix};var H;this.extraInfo===void 0&&delete N.callbackData,this.ossFilePrefix===void 0&&delete N.ossFilePrefix;const B=vEe(N);if(B.byteLength<this.workerMessageLengthLimit){if(oe("SHOW_VIDEO_INSPECT_WORKER_MESSAGE")){const z=(function(ee){for(var Z=1;Z<arguments.length;Z++){var ae=arguments[Z]!=null?arguments[Z]:{};Z%2?VK(Object(ae),!0).forEach((function(ye){X(ee,ye,ae[ye])})):Object.getOwnPropertyDescriptors?Object.defineProperties(ee,Object.getOwnPropertyDescriptors(ae)):VK(Object(ae)).forEach((function(ye){Object.defineProperty(ee,ye,Object.getOwnPropertyDescriptor(ae,ye))}))}return ee})({},N);delete z.jpg,M.debug("[".concat(this._inspectId,"] Request message for worker of inspect content "),JSON.stringify(z))}return B}{const z=this.quality*this.qualityRatio;return this.quality=z,await this.generateRequestData(r,{appId:a,cname:c,cid:d,vid:h,sid:m,uid:g})}}close(){this._cancelTokenSource.cancel(),this._cancelTokenSource=Na.CancelToken.source(),this.workerManagerConnection&&this.workerManagerConnection.close(),this.workerConnection&&this.workerConnection.close(),this.inspectTimer&&window.clearInterval(this.inspectTimer),this.inspectTimer=null,this.connectionState=Xu.CLOSED,this.emit(fs.STATE_CHANGE,Ju.CLOSED)}}const OEe={name:"ContentInspect",create:function(t){let{config:r}=t;return(function(s){if(!s)throw new ke(te.INVALID_PARAMS,"inspectConfig is necessary.");if(!s.inspectType||!Array.isArray(s.inspectType))throw new ke(te.INVALID_PARAMS,"inspectConfig.inspectType is necessary and is an instance of Array.");{const a=[...new Set(s.inspectType)];a.forEach((c=>{var d;if(!rt(d=["supervise","moderation"]).call(d,c))throw new ke(te.INVALID_PARAMS,"".concat(c," is not a valid inspect type."))})),s.inspectType=a}if(s&&s.extraInfo&&s.extraInfo.length>1024)throw new ke(te.INVALID_PARAMS,"inspectConfig.extraInfo length cannot exceed 1024 bytes")})(r),new PEe(r)}};var jK=l(bt.Object.getOwnPropertySymbols),kEe=Kn,NEe=Rd.indexOf,xEe=u_,YM=ne([].indexOf),FK=!!YM&&1/YM([1],1,-0)<0;kEe({target:"Array",proto:!0,forced:FK||!xEe("indexOf")},{indexOf:function(t){var r=arguments.length>1?arguments[1]:void 0;return FK?YM(this,t,r)||0:NEe(this,t,r)}});var DEe=wc("Array","indexOf"),LEe=O,MEe=DEe,XM=Array.prototype,UEe=function(t){var r=t.indexOf;return t===XM||LEe(XM,t)&&r===XM.indexOf?MEe:r},BK=l(UEe);function VEe(t,r){if(t==null)return{};var s,a,c=(function(h,m){if(h==null)return{};var g={};for(var v in h)if({}.hasOwnProperty.call(h,v)){if(BK(m).call(m,v)!==-1)continue;g[v]=h[v]}return g})(t,r);if(jK){var d=jK(t);for(a=0;a<d.length;a++)s=d[a],BK(r).call(r,s)===-1&&{}.propertyIsEnumerable.call(t,s)&&(c[s]=t[s])}return c}let zK=class{get localCapabilities(){return Kr(this._localCapabilities)}get rtpCapabilities(){return Kr(this._rtpCapabilities)}get candidates(){return Kr(this._candidates)}get iceParameters(){return Kr(this._iceParameters)}get dtlsParameters(){return Kr(this._dtlsParameters)}constructor(t){X(this,"sessionDesc",void 0),X(this,"_localCapabilities",void 0),X(this,"_rtpCapabilities",void 0),X(this,"_candidates",void 0),X(this,"_iceParameters",void 0),X(this,"_dtlsParameters",void 0),X(this,"setup",void 0),X(this,"currentMidIndex",void 0),X(this,"cname","o/i14u9pJrxRKAsu"),X(this,"firefoxSsrcMidMap",new Map),t=Kr(t);const{remoteIceParameters:r,remoteDtlsParameters:s,candidates:a,remoteRTPCapabilities:c,localCapabilities:d,direction:h,setup:m,videoCodec:g,audioCodec:v}=t;let w;this.setup=m,w=h===fa.RECEIVE_ONLY?nc(`v=0
o=- 0 0 IN IP4 127.0.0.1
s=AgoraGateway
t=0 0
a=group:BUNDLE 0 1
a=msid-semantic: WMS
a=extmap-allow-mixed
m=video 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendonly
a=rtcp-mux
a=rtcp-rsize
a=mid:0
m=audio 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendonly
a=rtcp-mux
a=rtcp-rsize
a=mid:1
`):nc(`v=0
o=- 0 0 IN IP4 127.0.0.1
s=AgoraGateway
t=0 0
a=group:BUNDLE 0 1
a=msid-semantic: WMS
a=extmap-allow-mixed
m=video 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=recvonly
a=rtcp-mux
a=rtcp-rsize
a=mid:0
m=audio 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=recvonly
a=rtcp-mux
a=rtcp-rsize
a=mid:1
`),this._rtpCapabilities=c,this._candidates=a,this._iceParameters=r,this._dtlsParameters=s,this._localCapabilities=d;const I=h===fa.RECEIVE_ONLY?this.rtpCapabilities.send:this.rtpCapabilities.recv,A=h===fa.RECEIVE_ONLY?this._localCapabilities.recv:this._localCapabilities.send,N=h===fa.RECEIVE_ONLY?c.send.videoCodecs:RT(St.VIDEO,I,A,g),H=h===fa.RECEIVE_ONLY?c.send.audioCodecs:RT(St.AUDIO,I,A,v);for(const B of w.mediaDescriptions)B.attributes.iceUfrag=r.iceUfrag,B.attributes.icePwd=r.icePwd,B.attributes.fingerprints=s.fingerprints,B.attributes.candidates=a,B.attributes.setup=this.setup,B.media.mediaType==="application"&&(B.attributes.sctpPort="5000"),B.media.mediaType==="video"&&(B.media.fmts=N.map((z=>z.payloadType.toString(10))),B.attributes.payloads=N,B.attributes.extmaps=I.videoExtensions),B.media.mediaType==="audio"&&(B.media.fmts=H.map((z=>z.payloadType.toString(10))),B.attributes.payloads=H,B.attributes.extmaps=I.audioExtensions,T0(B));this.sessionDesc=w,this.currentMidIndex=w.mediaDescriptions.length-1}toString(){return Zm(this.sessionDesc)}hasMid(t){return Array.isArray(t)?t.every((r=>this.hasMid(r))):this.sessionDesc.mediaDescriptions.some((r=>r.attributes.mid===t))}send(t,r,s,a,c){s=s.replace(/ /g,"-");const{ssrcs:d,ssrcGroups:h}=CT(r,this.cname,oe("SYNC_GROUP")?s:void 0),m=this.findPreloadMediaDesc(d);if(m){if(ii()&&this.firefoxSsrcMidMap.set(d[0].ssrcId,m.attributes.mid),c&&(c.twcc||c.remb)){const g=this.sessionDesc.mediaDescriptions.indexOf(m);return this.sessionDesc.mediaDescriptions[g]=this.mungSendMediaDesc(m,c),{mid:m.attributes.mid,needExchangeSDP:!0}}return{mid:m.attributes.mid,needExchangeSDP:!1}}{const g=this.findAvailableMediaIndex(t,d,a);let v;return g===-1?(v=this.createOrRecycleSendMedia(t,d,h,"sendonly",a,c),this.updateBundleMids()):(v=Kr(this.sessionDesc.mediaDescriptions[g]),v.attributes.direction="sendonly",v.attributes.ssrcs=d,v.attributes.ssrcGroups=h,this.sessionDesc.mediaDescriptions[g]=this.mungSendMediaDesc(v,c)),ii()&&this.firefoxSsrcMidMap.set(d[0].ssrcId,v.attributes.mid),{needExchangeSDP:!0,mid:v.attributes.mid}}}stopSending(t){const r=this.sessionDesc.mediaDescriptions.filter((s=>s.attributes.mid&&t.indexOf(s.attributes.mid)!==-1));if(r.length!==t.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.stopSending.");r.forEach((s=>{s.attributes.ssrcs=[]})),this.updateBundleMids()}receive(t,r,s){const a=[];return t.forEach((c=>{const d=c._mediaStreamTrack.kind,h=this.findAvailableRecvMediaIndex(d);let m,g=!1;h===-1?(g=!0,m=this.createOrRecycleRecvMedia(c,[],"recvonly",r,s),this.updateBundleMids()):(m=Kr(this.sessionDesc.mediaDescriptions[h]),m.attributes.direction="recvonly"),a.push({mid:m.attributes.mid,needCreateTransceiver:g})})),a}stopReceiving(t){const r=this.sessionDesc.mediaDescriptions.filter((s=>t.indexOf(s.attributes.mid)!==-1));if(r.length!==t.length)throw new Error("MediaDescriptions' length doesn't match mids's length when calling RemoteSDP.receive.");r.forEach((s=>{s.media.port="0",s.attributes.direction="inactive"})),this.updateBundleMids()}addRemoteCandidate(t){const{foundation:r,protocol:s,address:a,port:c,type:d,relatedAddress:h,relatedPort:m,priority:g}=new RTCIceCandidate(t),v={foundation:r??"",componentId:"1",transport:s??"",priority:g?g+"":"",connectionAddress:a??"",port:c?c+"":"",type:d?d+"":"",relAddr:h??"",relPort:m?m+"":"",extension:{}};this.candidates.some((w=>w.priority===v.priority&&w.connectionAddress===v.connectionAddress&&w.port===v.port))||(this._candidates.push(v),this.sessionDesc.mediaDescriptions.forEach((w=>{w.attributes.candidates=this.candidates})))}clearRemoteCandidate(){this._candidates=[],this.sessionDesc.mediaDescriptions[0].attributes.candidates=this._candidates}createOrRecycleRecvMedia(t,r,s,a,c){const d=t._mediaStreamTrack.kind,h=this.rtpCapabilities.recv,m=RT(d,h,this.localCapabilities.send,d===St.AUDIO?c:a),g=d===St.VIDEO?h.videoExtensions:h.audioExtensions,v="".concat(++this.currentMidIndex);let w={media:{mediaType:d,port:"9",protos:["UDP","TLS","RTP","SAVPF"],fmts:m.map((A=>A.payloadType.toString(10)))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:[],extmaps:g,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:r,ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:m,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:s,rtcpMux:!0,rtcpRsize:!0,mid:"".concat(v)}};w=this.mungRecvMediaDsec(w,t);const I=this.findFirstClosedMedia(d);if(I){const A=this.sessionDesc.mediaDescriptions.indexOf(I);this.sessionDesc.mediaDescriptions[A]=w}else this.sessionDesc.mediaDescriptions.push(w);return w}muteRemote(t){const r=this.sessionDesc.mediaDescriptions.filter((s=>rt(t).call(t,s.attributes.mid||"")));if(r.length!==t.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");r.forEach((s=>{s.attributes.direction="inactive"}))}unmuteRemote(t){const r=this.sessionDesc.mediaDescriptions.filter((s=>rt(t).call(t,s.attributes.mid||"")));if(r.length!==t.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");r.forEach((s=>{s.attributes.direction="recvonly"}))}findAvailableMediaIndex(t,r,s){return this.sessionDesc.mediaDescriptions.findIndex((a=>{const c=a.media.mediaType===t&&a.media.port!=="0"&&(a.attributes.direction==="sendonly"||a.attributes.direction==="sendrecv")&&a.attributes.ssrcs.length===0;if(ii()){if(c){const d=this.firefoxSsrcMidMap.get(r[0].ssrcId);return!(d||a.attributes.mid!=="0"&&a.attributes.mid!=="1")||!(!d||d!==a.attributes.mid)}return!1}return c&&a.attributes.mid===s}))}findAvailableRecvMediaIndex(t){return this.sessionDesc.mediaDescriptions.findIndex((r=>{const s=r.media.mediaType===t&&r.media.port!=="0"&&(r.attributes.direction==="recvonly"||r.attributes.direction==="sendrecv");return r.attributes.mid!=="0"&&r.attributes.mid!=="1"&&s}))}predictReceivingMids(t){const r=[];for(let s=0;s<t;s++)r.push((this.currentMidIndex+s+1).toString(10));return r}restartICE(t){t=Kr(t),this._iceParameters=t,this.sessionDesc.mediaDescriptions.forEach((r=>{r.attributes.iceUfrag=t.iceUfrag,r.attributes.icePwd=t.icePwd}))}createOrRecycleSendMedia(t,r,s,a,c,d){const h=this.rtpCapabilities.send,m=t===St.VIDEO?h.videoCodecs:h.audioCodecs,g=t===St.VIDEO?h.videoExtensions:h.audioExtensions;ii()&&(c="".concat(++this.currentMidIndex));let v={media:{mediaType:t,port:"9",protos:["UDP","TLS","RTP","SAVPF"],fmts:m.map((I=>I.payloadType.toString(10)))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:[],extmaps:g,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:r,ssrcGroups:s,rtcpFeedbackWildcards:[],payloads:m,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:a,rtcpMux:!0,rtcpRsize:!0,mid:c}};v=this.mungSendMediaDesc(v,d);const w=this.findFirstClosedMedia(t);if(w){const I=this.sessionDesc.mediaDescriptions.indexOf(w);this.sessionDesc.mediaDescriptions[I]=v}else this.sessionDesc.mediaDescriptions.push(v);return v}mungRecvMediaDsec(t,r,s){const a=Kr(t);return Y2(a),w0(a,r),X2(a,r),L7(a),oP(a,s,this.localCapabilities.send),a}mungSendMediaDesc(t,r){const s=Kr(t);return oP(s,r,this.localCapabilities.recv),T0(s),s}updateRecvMedia(t,r){const s=this.sessionDesc.mediaDescriptions.findIndex((a=>a.attributes.mid===t));if(s!==-1){const a=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[s],r);this.sessionDesc.mediaDescriptions[s]=a}}updateBundleMids(){this.sessionDesc.attributes.groups[0].identificationTag=this.sessionDesc.mediaDescriptions.filter((t=>t.media.port!=="0")).map((t=>t.attributes.mid))}findPreloadMediaDesc(t){return this.sessionDesc.mediaDescriptions.find((r=>{var s;return((s=r.attributes)===null||s===void 0||(s=s.ssrcs[0])===null||s===void 0?void 0:s.ssrcId)===t[0].ssrcId}))}findFirstClosedMedia(t){return this.sessionDesc.mediaDescriptions.find((r=>ii()?r.media.port==="0"&&r.media.mediaType===t:r.media.port==="0"))}};const jEe=["sdp"];var xr;function WK(t,r){var s=Object.keys(t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);r&&(a=a.filter((function(c){return Object.getOwnPropertyDescriptor(t,c).enumerable}))),s.push.apply(s,a)}return s}function yg(t){for(var r=1;r<arguments.length;r++){var s=arguments[r]!=null?arguments[r]:{};r%2?WK(Object(s),!0).forEach((function(a){X(t,a,s[a])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(s)):WK(Object(s)).forEach((function(a){Object.defineProperty(t,a,Object.getOwnPropertyDescriptor(s,a))}))}return t}let GK=(xr=class Z0 extends _7{get currentLocalDescription(){return this.peerConnection.currentLocalDescription}get currentRemoteDescription(){return this.peerConnection.currentRemoteDescription}get peerConnectionState(){return this.peerConnection.connectionState}get iceConnectionState(){return this.peerConnection.iceConnectionState}get dtlsTransportState(){var r,s;return(r=(s=this.peerConnection.getReceivers()[0])===null||s===void 0||(s=s.transport)===null||s===void 0?void 0:s.state)!==null&&r!==void 0?r:null}get localCodecs(){return[]}set isInRestartIce(r){this._isInRestartIce=r}get isInRestartIce(){return this._isInRestartIce}constructor(r,s,a){super(r,s),X(this,"direction",void 0),X(this,"name",void 0),X(this,"store",void 0),X(this,"spec",void 0),X(this,"peerConnection",void 0),X(this,"initialOffer",void 0),X(this,"transport",void 0),X(this,"statsFilter",void 0),X(this,"localCandidateCount",0),X(this,"_isInRestartIce",!1),X(this,"mutex",void 0),X(this,"onLocalCandidate",void 0),X(this,"remoteSDP",void 0),X(this,"pendingCandidates",[]),X(this,"localCapabilities",void 0),X(this,"isReady",!1),X(this,"restartCnt",0),X(this,"curTurnServerIndex",0),this.store=s,this.spec=r,this.mutex=new so("P2PConnection-mutex",s.clientId),this.peerConnection=new RTCPeerConnection(Z0.resolvePCConfiguration(r,s.p2pTransport),{optional:[{googDscp:!0}]}),this.direction=a??fa.SEND_ONLY,this.name=this.direction===fa.SEND_ONLY?"sendP2PConnection":"recvP2PConnection",this.statsFilter=i2(this.peerConnection,oe("STATS_UPDATE_INTERVAL"),void 0,ii()?1200:void 0),this.bindPCEvents(),this.bindStatsEvents(),this.store.p2pId=this.store.p2pId+1}async establish(r){try{const s=await U7();if(this.localCapabilities=aP(s),r){const{sdp:a}=r,c=VEe(r,jEe),d=(function(){const w={audioCodecs:[],videoCodecs:[],audioExtensions:[],videoExtensions:[]},I=TT(arguments.length>2?arguments[2]:void 0,arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},"sendonly"),A={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},N={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},H={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]};if(Qu(I,w,"videoExtensions",A,N,H),Qu(I,w,"videoCodecs",A,N,H),Qu(I,w,"audioExtensions",A,N,H),Qu(I,w,"audioCodecs",A,N,H),oe("RAISE_H264_BASELINE_PRIORITY")){const B=H.videoCodecs.findIndex((z=>z.rtpMap&&z.rtpMap.encodingName.toLocaleLowerCase()==="h264"&&z.fmtp&&z.fmtp.parameters["profile-level-id"]==="42001f"));if(B!==-1){const z=H.videoCodecs.findIndex((ee=>ee.rtpMap&&ee.rtpMap.encodingName.toLocaleLowerCase()==="h264"));if(z<B){M.debug("raising H264 baseline profile priority");const ee=H.videoCodecs[B];H.videoCodecs.splice(B,1),H.videoCodecs.splice(z,0,ee)}z!==-1&&oe("FILTER_SEND_H264_BASELINE")&&(A.videoCodecs=A.videoCodecs.filter((ee=>!(ee.rtpMap&&ee.rtpMap.encodingName.toLocaleLowerCase()==="h264"&&ee.fmtp&&ee.fmtp.parameters["profile-level-id"]!=="42001f"))))}}return{send:A,recv:N,sendrecv:H}})({},{},a);this.remoteSDP=new zK({remoteIceParameters:c.iceParameters,remoteDtlsParameters:c.dtlsParameters,candidates:[],remoteRTPCapabilities:d,localCapabilities:this.localCapabilities,direction:this.direction,setup:"actpass",videoCodec:this.store.codec,audioCodec:this.store.audioCodec}),await this.setRemoteDescription({type:"offer",sdp:this.remoteSDP.toString()}),this.isReady=!0;const h=await this.peerConnection.createAnswer();if(!h.sdp)throw new Error("Cannot get answer sdp when trying to establish PeerConnection.");const m=sg(h.sdp);await this.peerConnection.setLocalDescription(h);const g=await V7({},{},h.sdp);this.localCapabilities=aP(g);const v=this.peerConnection.getTransceivers()[0];return v!=null&&v.receiver&&v.receiver.transport&&this.tryBindTransportEvents(v.receiver.transport),yg(yg({},m),{},{sdp:h.sdp})}{this.peerConnection.addTransceiver("video",{direction:"sendonly"}),this.peerConnection.addTransceiver("audio",{direction:"sendonly"});const a=await this.peerConnection.createOffer();if(!a.sdp)throw new Error("Cannot get initialOffer.sdp when trying to establish PeerConnection.");const c=sg(a.sdp);return this.initialOffer=a,yg(yg({},c),{},{sdp:a.sdp})}}catch(s){throw new Le(te.GET_LOCAL_CONNECTION_PARAMS_FAILED,s.toString())}}async connect(r){try{if(!this.initialOffer)throw new Error("Cannot establish P2PConnection without initial offer.");await this.peerConnection.setLocalDescription(this.initialOffer);const{sdp:s,iceParameters:a,dtlsParameters:c}=r,d=await V7({},{},s);this.remoteSDP=new zK({remoteIceParameters:a,remoteDtlsParameters:c,candidates:[],remoteRTPCapabilities:d,localCapabilities:this.localCapabilities,direction:this.direction,setup:"active",videoCodec:this.store.codec,audioCodec:this.store.audioCodec}),await this.setRemoteDescription({type:"answer",sdp:this.remoteSDP.toString()});const h=this.peerConnection.getTransceivers()[0];h!=null&&h.sender&&h.sender.transport&&this.tryBindTransportEvents(h.sender.transport)}catch(s){throw new Le(te.EXCHANGE_SDP_FAILED,"P2PConnection.connect failed; ".concat(s.toString()))}}async addRemoteCandidate(r){try{r&&this.pendingCandidates.push(r),this.peerConnection.remoteDescription&&this.isReady&&(this.pendingCandidates.forEach((s=>{this.peerConnection.addIceCandidate(s)})),this.pendingCandidates=[])}catch(s){throw new Le(te.ADD_CANDIDATE_FAILED,"P2PConnection.addRemoteCandidate failed; ".concat(s.toString()))}}send(r,s,a){var c=this;return Ql((function*(){const d=yield zn(c.mutex.lock("From P2PConnection.send"));try{if(!c.remoteSDP)throw new Error("Cannot call P2PConnection.send before remote SDP created");const h=[],m=c.remoteSDP.receive(r,s,a);r.forEach(((z,ee)=>{if(m[ee].needCreateTransceiver){const Z=c.peerConnection.addTransceiver(z._mediaStreamTrack,{direction:"sendonly"});h.push(Z),z._updateRtpTransceiver(Z)}else{const Z=c.peerConnection.getTransceivers().find((ae=>ae.mid===m[ee].mid));if(!Z)throw new Error("cannot find transceiver when sendPeerconnection send, mid is ".concat(m[ee].mid));h.push(Z),z._updateRtpTransceiver(Z)}})),ii()&&oe("SIMULCAST")===!0&&(yield zn(c.applySimulcastForFirefox(h,r)));const g=m.map((z=>z.mid)),v=yield zn(c.peerConnection.createOffer()),w=c.mungSendOfferSDP(v.sdp,r,g),I=nc(w),A=g.map((z=>{const ee=I.mediaDescriptions.find((Z=>Z.attributes.mid===z));if(!ee)throw new Error("Cannot extract ssrc from mediaDescription.");return N7(ee,oe("USE_PUB_RTX"))})),N=h.map(((z,ee)=>{const Z=g[ee];return{localSSRC:A[ee],id:Z}}));yield zn(c.peerConnection.setLocalDescription({type:"offer",sdp:w}));try{yield N}catch(z){const ee=c.remoteSDP.toString();throw yield zn(c.peerConnection.setLocalDescription({type:"offer",sdp:w})),yield zn(c.peerConnection.setRemoteDescription({type:"answer",sdp:ee})),yield zn(c.stopSending(g,!0)),z}yield zn(c.applySimulcastEncodings(h,r)),yield zn(c.applySendEncodings(h,r));const H=c.remoteSDP.toString(),B=c.logSDPExchange(w,"offer","local","send");return B==null||B(H),yield zn(c.setRemoteDescription({type:"answer",sdp:H})),h.map(((z,ee)=>{const Z=g[ee];return{localSSRC:A[ee],id:Z}}))}catch(h){throw h instanceof Le?h:new Le(te.EXCHANGE_SDP_FAILED,"P2PConnection.send failed; ".concat(h.toString()))}finally{d()}}))()}async stopSending(r,s){const a=s?void 0:await this.mutex.lock("From P2PConnection.stopSending");try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopSending before remote SDP created");const c=this.peerConnection.getTransceivers().filter((g=>r.indexOf(g.mid)!==-1));if(c.length!==r.length)throw new Error("Transceivers' length (".concat(c.length,") doesn't match mids' length (").concat(r.length,") when trying to call P2PConnection.stopSending."));c.map((g=>{var v;g.direction="inactive",(v=g.stop)===null||v===void 0||v.call(g)}));const d=await this.peerConnection.createOffer(),h=this.logSDPExchange(d.sdp||"","offer","local","stopSending");await this.peerConnection.setLocalDescription(d),this.remoteSDP.stopReceiving(r);const m=this.remoteSDP.toString();h==null||h(m),await this.setRemoteDescription({type:"answer",sdp:m})}catch(c){throw new Le(te.EXCHANGE_SDP_FAILED,"P2PConnection.stopSending failed; ".concat(c.toString()))}finally{a&&a()}}async receive(r,s,a,c){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.receive ".concat(r," before remoteSDP created."));const{mid:d,needExchangeSDP:h}=this.remoteSDP.send(r,s,a,c);if(h){const g=this.remoteSDP.toString(),v=this.logSDPExchange(g,"offer","remote","receive");await this.setRemoteDescription({type:"offer",sdp:g});const w=await this.peerConnection.createAnswer(),I=this.mungReceiveAnswerSDP(w.sdp,d,r);v==null||v(I||""),await this.peerConnection.setLocalDescription({type:"answer",sdp:I}),M.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(r," by exchanging SDP."))}else M.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(r," no need to exchange SDP."));const m=this.peerConnection.getTransceivers().find((g=>g.mid===d));if(!m||m.mid===null)throw new Error("Cannot get transceiver after setLocalDescription.");return{track:m.receiver.track,mid:m.mid,transceiver:m}}catch(d){throw new Le(te.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(d.toString()))}}async mockReceive(r,s,a,c){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.receive ".concat(r," before remoteSDP created."));const{mid:d,needExchangeSDP:h}=this.remoteSDP.send(r,s,a,c);if(h){const m=this.remoteSDP.toString(),g=this.logSDPExchange(m,"offer","remote","receive");await this.setRemoteDescription({type:"offer",sdp:m});const v=await this.peerConnection.createAnswer(),w=this.mungReceiveAnswerSDP(v.sdp,d,r);g==null||g(w||""),await this.peerConnection.setLocalDescription({type:"answer",sdp:w}),M.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(r," by exchanging SDP."))}else M.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(r," no need to exchange SDP."))}catch(d){throw new Le(te.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(d.toString()))}}async stopReceiving(r){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopReceiving before remote SDP created.");this.remoteSDP.stopSending(r);const s=this.remoteSDP.toString(),a=this.logSDPExchange(s,"offer","remote","stopReceiving");await this.setRemoteDescription({type:"offer",sdp:s});const c=await this.peerConnection.createAnswer();a==null||a(c.sdp||""),await this.peerConnection.setLocalDescription(c)}catch(s){throw new Le(te.EXCHANGE_SDP_FAILED,"P2PConnection stopReceiving failed; ".concat(s.toString()))}}async restartICE(r){try{if(this.store.p2pTransport===oy.Auto&&(this.store.p2pTransport=oy.SdRtn,Wn().supportPCSetConfiguration&&this.peerConnection.setConfiguration(Z0.resolvePCConfiguration(this.spec,this.store.p2pTransport))),this.restartCnt>3&&(this.restartCnt=0,Wn().supportPCSetConfiguration&&this.peerConnection.setConfiguration(Z0.resolvePCConfiguration(this.spec,this.store.p2pTransport,++this.curTurnServerIndex))),!r){this.restartCnt++,this.isReady=!1;const s=await this.peerConnection.createOffer({iceRestart:!0});if(!s.sdp)throw new Error("Cannot restartICE because restart offer SDP does not exist.");const{iceParameters:a}=sg(s.sdp);return this.store.descriptionStart(),this.direction===fa.SEND_ONLY&&await this.peerConnection.setLocalDescription(s),a}if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopReceiving before remote SDP created.");if(this.remoteSDP.restartICE(r),this.store.descriptionStart(),this.direction===fa.RECEIVE_ONLY){this.restartCnt++,await this.setRemoteDescription({type:"offer",sdp:this.remoteSDP.toString()});const s=await this.peerConnection.createAnswer();if(!s.sdp)throw new Error("Cannot get answer sdp when trying to iceRestart.");const{iceParameters:a}=sg(s.sdp);return await this.peerConnection.setLocalDescription(s),a}await this.setRemoteDescription({type:"answer",sdp:this.remoteSDP.toString()}),this.isReady=!0}catch(s){throw new Le(te.EXCHANGE_SDP_FAILED,"P2PConnection stopReceiving failed; ".concat(s.toString()))}}close(){var r;this.peerConnection.close(),this.peerConnection.onicecandidate=null,(r=this.onConnectionStateChange)===null||r===void 0||r.call(this,"closed"),this.tryUnbindTransportEvents(),this.unbindPCEvents(),this.unbindStatsEvents(),this.transport=void 0,this.statsFilter.destroy()}getStats(){return this.statsFilter.getStats()}getRemoteVideoIsReady(r){return this.statsFilter.getVideoIsReady(r)}async updateEncoderConfig(r,s){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.updateEncoderConfig before remote SDP created.");const a=await this.peerConnection.createOffer(),c=this.mungSendOfferSDP(a.sdp,[s],[r]);this.remoteSDP.updateRecvMedia(r,s);const d=this.remoteSDP.toString(),h=this.logSDPExchange(c,"offer","local","updateEncoderConfig");await this.peerConnection.setLocalDescription({type:"offer",sdp:c}),h==null||h(d),await this.peerConnection.setRemoteDescription({type:"answer",sdp:d})}catch(a){throw new Le(te.EXCHANGE_SDP_FAILED,a.toString())}}async updateSendParameters(r,s){const a=this.peerConnection.getTransceivers().filter((c=>c.mid===r));a.length===1&&(this.isVP8Simulcast(s)?ii()||await this.applySimulcastEncodings(a,[s]):await this.applySendEncodings(a,[s]))}setStatsRemoteVideoIsReady(r,s){this.statsFilter.setVideoIsReady2(r,s)}async replaceTrack(r,s){const a=this.peerConnection.getTransceivers().find((c=>c.mid===s));a&&await a.sender.replaceTrack(r._mediaStreamTrack)}async getSelectedCandidatePair(){const r=this.peerConnection.getReceivers();if(r.length>0&&r[0].transport&&r[0].transport.iceTransport&&r[0].transport.iceTransport.getSelectedCandidatePair&&r[0].transport.iceTransport.getSelectedCandidatePair()){const s=r[0].transport.iceTransport,{local:a,remote:c}=s.getSelectedCandidatePair();return{local:yg(yg({},op),{},{candidateType:a.type,protocol:a.protocol,address:a.address,port:a.port}),remote:yg(yg({},op),{},{candidateType:c.type,protocol:c.protocol,address:c.address,port:c.port})}}return this.statsFilter.getSelectedCandidatePair()}bindPCEvents(){this.peerConnection.oniceconnectionstatechange=()=>{var r,s;rt(r=["connected","completed"]).call(r,this.peerConnection.iceConnectionState)&&(this.isReady=!1),(s=this.onICEConnectionStateChange)===null||s===void 0||s.call(this,this.peerConnection.iceConnectionState)},this.peerConnection.onconnectionstatechange=()=>{var r;this.peerConnection.connectionState==="connected"&&(this.restartCnt=0),(r=this.onConnectionStateChange)===null||r===void 0||r.call(this,this.peerConnection.connectionState)},this.startICECandidate()}startICECandidate(){this.peerConnection.onicecandidate||(this.localCandidateCount=0,this.peerConnection.onicecandidate=r=>{if(r.candidate){var s;r.candidate.candidate&&((s=this.onLocalCandidate)===null||s===void 0||s.call(this,r.candidate.toJSON())),this.localCandidateCount+=1}else M.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] local candidate count"),this.localCandidateCount)})}unbindPCEvents(){this.peerConnection.oniceconnectionstatechange=null,this.peerConnection.onconnectionstatechange=null,this.peerConnection.onsignalingstatechange=null,this.peerConnection.onicecandidateerror=null,this.peerConnection.onicecandidate=null,this.peerConnection.ontrack=null}static resolvePCConfiguration(r,s){let a=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0;const c={iceServers:[]};var d;return r.iceServers?c.iceServers=r.iceServers:r.turnServer&&r.turnServer.mode!=="off"&&(lT(r.turnServer.servers)?c.iceServers=r.turnServer.servers:(c.iceServers&&c.iceServers.push(...Z0.turnServerConfigToIceServers(r.turnServer.servers,s,a)),oe("USE_TURN_SERVER_OF_GATEWAY")&&c.iceServers&&r.turnServer.serversFromGateway&&c.iceServers.push(...Z0.turnServerConfigToIceServers(r.turnServer.serversFromGateway,s,a)),rt(d=[oy.Relay,oy.SdRtn]).call(d,s)&&(c.iceTransportPolicy="relay"),oe("FORCE_TURN_TCP")?c.iceTransportPolicy="relay":r.turnServer.servers.concat(r.turnServer.serversFromGateway||[]).forEach((h=>{h.forceturn&&(c.iceTransportPolicy="relay")})))),oe("ENABLE_ENCODED_TRANSFORM")&&Wn().supportWebRTCEncodedTransform&&(c.encodedInsertableStreams=!0),M.debug("P2PConnection p2pTransport is ".concat(s)),c}static turnServerConfigToIceServers(r,s){let a=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0;const c=[],d=r.filter((m=>m.tcpport));M.debug("P2PConnection turnServers is ".concat(d,", current index is ").concat(a));const h=d.length>a?d[a]:d[0];switch(s){case oy.SdRtn:const m=r.filter((v=>{var w;return rt(w=v.username).call(w,"glb:")&&v.turnServerURL==v.turnServerURL})),g=m.length>a?m[a]:m[0];g&&(c.push({username:g.username,credential:g.password,credentialType:"password",urls:"turn:".concat(rg(g.turnServerURL),":").concat(g.tcpport,"?transport=udp")}),c.push({username:g.username,credential:g.password,credentialType:"password",urls:"turns:".concat(rg(g.turnServerURL),":").concat(g.tcpport,"?transport=tcp")}));break;case oy.Relay:h&&(c.push({username:h.username,credential:h.password,credentialType:"password",urls:"turn:".concat(h.turnServerURL,":").concat(h.tcpport,"?transport=udp")}),c.push({username:h.username,credential:h.password,credentialType:"password",urls:"turns:".concat(rg(h.turnServerURL),":").concat(h.tcpport,"?transport=tcp")}));break;default:h&&(c.push({username:h.username,credential:h.password,credentialType:"password",urls:"turn:".concat(h.turnServerURL,":").concat(h.tcpport,"?transport=udp")}),c.push({username:h.username,credential:h.password,credentialType:"password",urls:"turns:".concat(rg(h.turnServerURL),":").concat(h.tcpport,"?transport=tcp")}),c.push({username:h.username,credential:h.password,credentialType:"password",urls:"stun:".concat(h.turnServerURL,":").concat(h.tcpport)}))}return c}tryBindTransportEvents(r){if(r){this.transport=r,r.onstatechange=()=>{var a;r!=null&&r.state&&((a=this.onDTLSTransportStateChange)===null||a===void 0||a.call(this,r.state))},r.onerror=a=>{var c;(c=this.onDTLSTransportError)===null||c===void 0||c.call(this,"error"in a?a.error:a)};const s=r.iceTransport;s&&(s.onstatechange=()=>{const a=r==null?void 0:r.iceTransport.state;var c;a&&((c=this.onICETransportStateChange)===null||c===void 0||c.call(this,a))},s.getSelectedCandidatePair&&(s.onselectedcandidatepairchange=()=>{if(s.getSelectedCandidatePair()){const{local:a,remote:c}=s.getSelectedCandidatePair()||{};if(a&&c){const d=a.address+":"+a.port,h=c.address+":"+c.port;M.info("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] selectedcandidatepairchange: local ").concat(JSON.stringify(fy(d)),", remote ").concat(JSON.stringify(fy(h))))}}}))}}tryUnbindTransportEvents(){this.transport&&(this.transport.onstatechange=null,this.transport.onerror=null,this.transport.iceTransport&&(this.transport.iceTransport.onstatechange=null))}async updateRtpSenderEncodings(r,s){var a;if(s||(s=this.peerConnection.getSenders().find((w=>w.track===r._mediaStreamTrack))),!s)return M.warn("[".concat(r.getTrackId(),"] no rtpSender found}"));if(this.isVP8Simulcast(r))return M.warn("[updateRtpSenderEncodings] Track is VP8 simulcast, please apply simulcast encodings");if(!Wn().supportSetRtpSenderParameters)return M.warn("[updateRtpSenderEncodings] Browser not support set rtp-sender parameters");const c={},d={};switch(r._optimizationMode){case"motion":c.degradationPreference="maintain-framerate";break;case"detail":c.degradationPreference="maintain-resolution";break;default:c.degradationPreference="balanced"}if(r._encoderConfig){var h;const{bitrateMax:w,frameRate:I,scaleResolutionDownBy:A}=r._encoderConfig;w&&(d.maxBitrate=1e3*w),rt(h=r._hints).call(h,Sr.LOW_STREAM)&&(I&&(d.maxFramerate=xc(I)),A&&A>=1&&(d.scaleResolutionDownBy=A))}if(oe("DSCP_TYPE")&&vf()){var m;const w=oe("DSCP_TYPE");rt(m=["very-low","low","medium","high"]).call(m,w)&&(d.networkPriority=w)}const g=s.getParameters(),v=(a=g.encodings)===null||a===void 0?void 0:a[0];ii()&&!v&&(c.encodings=[d]),v&&Object.assign(v,d),Object.assign(g,c),M.debug("[".concat(r.getTrackId(),"] updateRtpSenderEncodings: ").concat(JSON.stringify(g.encodings))),await s.setParameters(g)}async applySendEncodings(r,s){try{if(!Wn().supportSetRtpSenderParameters||r.length!==s.length)return;for(let a=0;a<r.length;a++){const c=r[a],d=s[a];d instanceof Nr&&!this.isVP8Simulcast(d)&&await this.updateRtpSenderEncodings(d,c.sender)}}catch{M.debug("[".concat(this.store.clientId,"] Apply RTPSendEncodings failed."))}}mungSendOfferSDP(r,s,a){const c=nc(r);return s.forEach(((d,h)=>{const m=a[h],g=c.mediaDescriptions.find((v=>v.attributes.mid===m));g&&(w0(g,d),M7(g,d,this.store.codec))})),Zm(c)}bindStatsEvents(){this.statsFilter.onFirstAudioReceived=r=>{var s;(s=this.onFirstAudioReceived)===null||s===void 0||s.call(this,r)},this.statsFilter.onFirstVideoReceived=r=>{var s;(s=this.onFirstVideoReceived)===null||s===void 0||s.call(this,r)},this.statsFilter.onFirstAudioDecoded=r=>{var s;(s=this.onFirstAudioDecoded)===null||s===void 0||s.call(this,r)},this.statsFilter.onFirstVideoDecoded=(r,s,a)=>{var c;(c=this.onFirstVideoDecoded)===null||c===void 0||c.call(this,r,s,a)},this.statsFilter.onSelectedLocalCandidateChanged=(r,s)=>{var a;(a=this.onSelectedLocalCandidateChanged)===null||a===void 0||a.call(this,r,s)},this.statsFilter.onSelectedRemoteCandidateChanged=(r,s)=>{var a;(a=this.onSelectedRemoteCandidateChanged)===null||a===void 0||a.call(this,r,s)},this.statsFilter.onFirstVideoDecodedTimeout=r=>{var s;(s=this.onFirstVideoDecodedTimeout)===null||s===void 0||s.call(this,r)}}unbindStatsEvents(){this.statsFilter.onFirstAudioReceived=void 0,this.statsFilter.onFirstVideoReceived=void 0,this.statsFilter.onFirstAudioDecoded=void 0,this.statsFilter.onFirstVideoDecoded=void 0,this.statsFilter.onSelectedLocalCandidateChanged=void 0,this.statsFilter.onSelectedRemoteCandidateChanged=void 0,this.statsFilter.onFirstVideoDecodedTimeout=void 0}async applySimulcastForFirefox(r,s){if(r.length===s.length)for(let g=0;g<r.length;g++){var a,c,d,h,m;const v=r[g],w=s[g];if(w instanceof Nr&&!rt(a=w._hints).call(a,Sr.LOW_STREAM)&&(c=w._encoderConfig)!==null&&c!==void 0&&c.bitrateMax&&((d=w._encoderConfig)===null||d===void 0?void 0:d.bitrateMax)>200&&(h=w._scalabilityMode)!==null&&h!==void 0&&h.numSpatialLayers&&((m=w._scalabilityMode)===null||m===void 0?void 0:m.numSpatialLayers)>1&&this.store.codec==="vp8"){const I={},A={high:1e3*(w._encoderConfig.bitrateMax-50),medium:5e4};I.encodings=[{rid:"m",active:!0,maxBitrate:A.medium,scaleResolutionDownBy:4},{rid:"h",active:!0,maxBitrate:A.high}];const N=v.sender.getParameters();await v.sender.setParameters(Object.assign(N,I))}}}async applySimulcastEncodings(r,s){if(!ii()&&r.length===s.length)for(let a=0;a<r.length;a++){const c=s[a];if(c instanceof Nr&&this.isVP8Simulcast(c)){const d=r[a],h={},m={high:1e3*(c._encoderConfig.bitrateMax-50),medium:5e4};h.encodings=[{active:!0,adaptivePtime:!1,networkPriority:"high",priority:"high",maxBitrate:m.high},{active:!0,adaptivePtime:!1,networkPriority:"low",priority:"low",maxBitrate:m.medium,scaleResolutionDownBy:4}];const g=d.sender.getParameters();await d.sender.setParameters(Object.assign(g,h))}}}isVP8Simulcast(r){var s,a,c,d,h;return!!(r instanceof Nr&&oe("SIMULCAST")&&this.store.codec==="vp8"&&!rt(s=r._hints).call(s,Sr.LOW_STREAM)&&(a=r._encoderConfig)!==null&&a!==void 0&&a.bitrateMax&&((c=r._encoderConfig)===null||c===void 0?void 0:c.bitrateMax)>200&&(d=r._scalabilityMode)!==null&&d!==void 0&&d.numSpatialLayers&&((h=r._scalabilityMode)===null||h===void 0?void 0:h.numSpatialLayers)>1)}logSDPExchange(r,s,a,c){if(oe("SDP_LOGGING"))return M.upload("[".concat(this.store.clientId,"] exchanging ").concat(a," ").concat(s," SDP during P2PConnection.").concat(c,`
`),r),s==="offer"?d=>{this.logSDPExchange(d,"answer",a==="local"?"remote":"local",c)}:void 0}async muteLocal(r){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.muteLocal before remote SDP created.");const s=this.peerConnection.getTransceivers().filter((h=>h.mid&&r.indexOf(h.mid)!==-1));if(s.length!==r.length)throw new Error("Transceivers' length doesn't match mids' length.");s.map((h=>{h.direction="inactive"}));const a=await this.peerConnection.createOffer(),c=this.logSDPExchange(a.sdp||"","offer","local","muteLocal");await this.peerConnection.setLocalDescription(a),this.remoteSDP.muteRemote(r);const d=this.remoteSDP.toString();c==null||c(d),await this.setRemoteDescription({type:"answer",sdp:d})}catch(s){throw new Le(te.EXCHANGE_SDP_FAILED,"P2PConnection.muteLocal failed; ".concat(s.toString()))}}async unmuteLocal(r){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.unmuteLocal before remote SDP created.");const s=this.peerConnection.getTransceivers().filter((h=>h.mid&&r.indexOf(h.mid)!==-1));if(s.length!==r.length)throw new Error("Transceivers' length doesn't match mids' length.");s.map((async h=>{h.direction="sendonly"}));const a=await this.peerConnection.createOffer(),c=this.logSDPExchange(a.sdp||"","offer","local","unmuteLocal");await this.peerConnection.setLocalDescription(a),this.remoteSDP.unmuteRemote(r);const d=this.remoteSDP.toString();c==null||c(d),await this.setRemoteDescription({type:"answer",sdp:d})}catch(s){throw new Le(te.EXCHANGE_SDP_FAILED,"P2PConnection.unmuteLocal failed; ".concat(s.toString()))}}async getRemoteSSRC(r,s){var a;if(s=s??((a=this.currentRemoteDescription)===null||a===void 0?void 0:a.sdp)){var c;const d=(c=nc(s).mediaDescriptions.find((h=>h.attributes.mid===r)))===null||c===void 0?void 0:c.attributes.ssrcs;return d==null?void 0:d[0].ssrcId}}async setRemoteDescription(r){var s;await this.peerConnection.setRemoteDescription(r),rt(s=["connected","completed"]).call(s,this.peerConnection.iceConnectionState)||(this.isReady=!0,this.addRemoteCandidate())}mungReceiveAnswerSDP(r,s,a){const c=nc(r),d=c.mediaDescriptions.find((h=>h.attributes.mid===s));return d&&a===St.AUDIO&&d.media.mediaType==="audio"&&T0(d),Zm(c)}},Rt(xr.prototype,"establish",[rd],Object.getOwnPropertyDescriptor(xr.prototype,"establish"),xr.prototype),Rt(xr.prototype,"connect",[rd],Object.getOwnPropertyDescriptor(xr.prototype,"connect"),xr.prototype),Rt(xr.prototype,"receive",[rd],Object.getOwnPropertyDescriptor(xr.prototype,"receive"),xr.prototype),Rt(xr.prototype,"mockReceive",[rd],Object.getOwnPropertyDescriptor(xr.prototype,"mockReceive"),xr.prototype),Rt(xr.prototype,"stopReceiving",[rd],Object.getOwnPropertyDescriptor(xr.prototype,"stopReceiving"),xr.prototype),Rt(xr.prototype,"restartICE",[rd],Object.getOwnPropertyDescriptor(xr.prototype,"restartICE"),xr.prototype),Rt(xr.prototype,"close",[rd],Object.getOwnPropertyDescriptor(xr.prototype,"close"),xr.prototype),Rt(xr.prototype,"updateEncoderConfig",[rd],Object.getOwnPropertyDescriptor(xr.prototype,"updateEncoderConfig"),xr.prototype),Rt(xr.prototype,"updateSendParameters",[rd],Object.getOwnPropertyDescriptor(xr.prototype,"updateSendParameters"),xr.prototype),Rt(xr.prototype,"replaceTrack",[rd],Object.getOwnPropertyDescriptor(xr.prototype,"replaceTrack"),xr.prototype),Rt(xr.prototype,"muteLocal",[rd],Object.getOwnPropertyDescriptor(xr.prototype,"muteLocal"),xr.prototype),Rt(xr.prototype,"unmuteLocal",[rd],Object.getOwnPropertyDescriptor(xr.prototype,"unmuteLocal"),xr.prototype),xr);function rd(t,r,s){const a=t[r];if(typeof a!="function")throw new Error("Cannot use mutex on object property.");return s.value=async function(){const c=this.mutex,d=await c.lock("From P2PConnection.".concat(r));try{for(var h=arguments.length,m=new Array(h),g=0;g<h;g++)m[g]=arguments[g];return await a.apply(this,m)}finally{d()}},s}let ih=(function(t){return t.SEND_ONLY="SEND_ONLY",t.RECEIVE_ONLY="RECEIVE_ONLY",t})({});var HK,$K,KK,qK,YK,XK,JK,QK,ZK,eq,tq,qr;function nq(t,r){var s=Object.keys(t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);r&&(a=a.filter((function(c){return Object.getOwnPropertyDescriptor(t,c).enumerable}))),s.push.apply(s,a)}return s}function GP(t){for(var r=1;r<arguments.length;r++){var s=arguments[r]!=null?arguments[r]:{};r%2?nq(Object(s),!0).forEach((function(a){X(t,a,s[a])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(s)):nq(Object(s)).forEach((function(a){Object.defineProperty(t,a,Object.getOwnPropertyDescriptor(s,a))}))}return t}let FEe=(HK=sh(ih.SEND_ONLY),$K=sh(ih.SEND_ONLY),KK=sh(),qK=sh(ih.RECEIVE_ONLY),YK=sh(ih.RECEIVE_ONLY),XK=sh(ih.RECEIVE_ONLY),JK=sh(ih.RECEIVE_ONLY),QK=sh(ih.RECEIVE_ONLY),ZK=sh(ih.RECEIVE_ONLY),eq=sh(),tq=sh(ih.RECEIVE_ONLY),qr=class extends Zr{get state(){return this._state}set state(t){const r=this._state;this._state=t,this.emit(Mt.StateChange,r,this._state)}constructor(t,r){super(),X(this,"isPlanB",!1),X(this,"store",void 0),X(this,"statsUploader",void 0),X(this,"sendConnection",void 0),X(this,"recvConnection",void 0),X(this,"localTrackMap",new Map),X(this,"remoteUserMap",new Map),X(this,"localDataChannels",[]),X(this,"pendingLocalTracks",[]),X(this,"pendingRemoteTracks",[]),X(this,"statsCollector",void 0),X(this,"dtlsFailedCount",0),X(this,"sendMutex",void 0),X(this,"recvMutex",void 0),X(this,"_state",ar.Disconnected),X(this,"_restartStates",["disconnected","failed"]),X(this,"reconnectInterval",void 0),X(this,"uploadUnplinkStarted",!1),X(this,"uploadDownlinkStarted",!1),X(this,"uplinkStateUploadInterval",void 0),X(this,"downlinkStatsUploadInterval",void 0),X(this,"handleMuteLocalTrack",(async(s,a,c)=>{const d=await this.sendMutex.lock("Locking from P2PChannel2.handleMuteLocalTrack");try{if(!this.sendConnection||this.state!==ar.Connected)return void c(new Le(te.INVALID_OPERATION,"Cannot call P2PChannel2.handleMuteLocalTrack before sendConnection established."));const g=this.filterTobeMutedTracks(s);if(g.length===0)return void a();const v=g.find((N=>N[0]==="videoLowTrack"));v&&v[1].track._originMediaStreamTrack.stop(),await this.sendConnection.muteLocal(g.map((N=>{let[,{id:H}]=N;return H})));let w=!1;var h,m;s.trackMediaType==="video"?w=!((h=this.localTrackMap.get(Xe.LocalAudioTrack))===null||h===void 0||!h.track._muted):w=((m=this.localTrackMap.get(Xe.LocalVideoTrack))===null||m===void 0?void 0:m.id)===void 0;const I=this.createMuteMessage(g);await wr(this,Mt.RequestMuteLocal,I);const A=s.trackMediaType==="video"?ng.MUTE_LOCAL_VIDEO:ng.MUTE_LOCAL_AUDIO;await wr(this,Mt.RequestP2PMuteLocal,{action:A,message:I,isMuteAll:w}),a()}catch(g){c(g)}finally{d()}})),X(this,"handleUnmuteLocalTrack",(async(s,a,c)=>{const d=await this.sendMutex.lock("Locking from P2PChannel2.handleUnmuteLocalTrack");try{if(!this.sendConnection||this.state!==ar.Connected)return void c(new Le(te.INVALID_OPERATION,"Cannot call P2PChannel2.handleUnmuteLocalTrack before sendConnection established."));const h=this.filterTobeUnmutedTracks(s);if(h.length===0)return void a();await this.sendConnection.unmuteLocal(h.map((v=>{let[,{id:w}]=v;return w})));const m=this.createUnmuteMessage(h),g=s.trackMediaType==="video"?ng.UNMUTE_LOCAL_VIDEO:ng.UNMUTE_LOCAL_AUDIO;await wr(this,Mt.RequestP2PMuteLocal,{action:g,message:m}),a()}catch(h){c(h)}finally{d()}})),X(this,"handleUpdateVideoEncoder",(async(s,a,c,d)=>{let h;typeof d=="boolean"&&d||(h=await this.sendMutex.lock("Locking from P2PChannel2.handleUpdateVideoEncoder"));try{const g=this.localTrackMap.get(Xe.LocalVideoTrack);if(!this.sendConnection||!g||g.track!==s||this.state!==ar.Connected)return void a();const{id:v,track:w}=g;v&&(await this.sendConnection.updateSendParameters(v,w),await this.sendConnection.updateEncoderConfig(v,w),this.emit(Mt.UpdateVideoEncoder,w)),a()}catch(g){c(g)}finally{var m;(m=h)===null||m===void 0||m()}})),X(this,"handleUpdateVideoSendParameters",(async(s,a,c)=>{const d=await this.sendMutex.lock("Locking from P2PChannel2.handleUpdateVideoSendParameters");try{const h=this.localTrackMap.get(Xe.LocalVideoTrack);if(!this.sendConnection||!h||h.track!==s||this.state!==ar.Connected)return void a();const{id:m,track:g}=h;m&&await this.sendConnection.updateSendParameters(m,g),a()}catch(h){c(h)}finally{d()}})),X(this,"handleReplaceTrack",(async(s,a,c,d)=>{let h;M.debug("[".concat(this.store.clientId,"] P2PChannel2 handleReplaceTrack for [track-id-").concat(s.getTrackId(),"]")),typeof d=="boolean"&&d||(h=await this.sendMutex.lock("From P2PChannel2.handleReplaceTrack"));try{var m;const v=Array.from(this.localTrackMap.entries()).find((w=>{let[,{track:I}]=w;return s===I}));if(!this.sendConnection||!v||v[1].id===void 0||this.state!==ar.Connected)return void a();if(await((m=this.sendConnection)===null||m===void 0?void 0:m.replaceTrack(s,v[1].id)),v[0]===Xe.LocalVideoTrack&&Wn().supportDualStreamEncoding){const w=this.localTrackMap.get(Xe.LocalVideoLowTrack);if(w){const I=s._mediaStreamTrack.clone();w.track._originMediaStreamTrack.stop(),w.track._mediaStreamTrack=I,w.track._originMediaStreamTrack=I,await new mt(((A,N)=>{this.handleReplaceTrack(w.track,A,N,!0)}))}}a()}catch(v){c(v)}finally{var g;(g=h)===null||g===void 0||g()}})),X(this,"handleGetLocalVideoStats",(s=>{s(this.statsCollector.getLocalVideoTrackStats())})),X(this,"handleGetLocalAudioStats",(s=>{s(this.statsCollector.getLocalAudioTrackStats())})),X(this,"handleGetRemoteVideoStats",(s=>this.statsCollector.getRemoteVideoTrackStats(s.uid)[s.uid])),X(this,"handleGetRemoteAudioStats",(s=>this.statsCollector.getRemoteAudioTrackStats(s.uid)[s.uid])),this.store=t,this.statsCollector=r,this.statsCollector.addP2PChannel(this),this.statsUploader=new EH(t),this.bindStatsUploaderEvents(),this.sendMutex=new so("P2PChannel2-send-mutex",t.clientId),this.recvMutex=new so("P2PChannel2-recv-mutex",t.clientId),this.reconnectInterval=window.setInterval((()=>{[this.sendConnection,this.recvConnection].forEach((s=>{s&&(s.iceConnectionState!=="disconnected"&&s.iceConnectionState!=="failed"||this.handleDisconnect(s.direction))}))}),oe("ICE_RESTART_INTERVAL"))}async startP2PConnection(t,r){throw new Le(te.NOT_SUPPORTED,"p2p mode does not support startP2PConnection.")}async connect(t){throw new Le(te.NOT_SUPPORTED,"p2p mode does not support connect.")}async startP2P(t,r){let s;try{if(r){this.recvConnection&&(M.warning("[".concat(this.store.clientId,"] P2PChannel.startP2P reset recvConnection.")),this.recvConnection.close(),this.unbindConnectionEvents(this.recvConnection)),s=await this.recvMutex.lock("From P2PChannel.startP2P"),this.recvConnection=new GK(t,this.store,fa.RECEIVE_ONLY),this.bindConnectionEvents(this.recvConnection);const a=await this.recvConnection.establish(r);return{iceParameters:a.iceParameters,dtlsParameters:a.dtlsParameters,sdp:a.sdp}}{this.state=ar.New,this.sendConnection&&(M.warning("[".concat(this.store.clientId,"] P2PChannel.startP2P reset sendConnection.")),this.sendConnection.close(),this.unbindConnectionEvents(this.sendConnection)),s=await this.sendMutex.lock("From P2PChannel.startP2P"),this.sendConnection=new GK(t,this.store),this.store.peerConnectionStart(),this.bindConnectionEvents(this.sendConnection);const a=await this.sendConnection.establish();return{iceParameters:a.iceParameters,dtlsParameters:a.dtlsParameters,sdp:a.sdp}}}finally{s&&s()}}async p2pConnect(t){if(!this.sendConnection)throw new Le(te.UNEXPECTED_ERROR,"Cannot P2PChannel2.p2pConnect before P2PChannel2.startP2PConnection .");this.store.peerConnectionStart(),await this.sendConnection.connect(t),this.statsUploader.startUploadTransportStats(),this.statsUploader.startUploadExtensionUsageStats(),this.state=ar.Connected}async addRemoteCandidate(t,r){if(r===fa.RECEIVE_ONLY){if(!this.sendConnection)throw new Le(te.UNEXPECTED_ERROR,"Cannot P2PChannel2.connect before P2PChannel2.addRemoteCandidate .");await this.sendConnection.addRemoteCandidate(t)}else{if(!this.recvConnection)throw new Le(te.UNEXPECTED_ERROR,"Cannot P2PChannel2.connect before P2PChannel2.addRemoteCandidate .");await this.recvConnection.addRemoteCandidate(t)}}publish(t,r,s){var a=this;return Ql((function*(){const c=yield zn(a.sendMutex.lock("From P2PChannel.publish"));try{if(!a.sendConnection||a.state!==ar.Connected){a.throwIfTrackTypeNotMatch(t);const v=t.filter((w=>a.pendingLocalTracks.indexOf(w)===-1));return void(a.pendingLocalTracks=a.pendingLocalTracks.concat(v))}a.store.pubId=a.store.pubId+1,lo.markPublishStart(a.store.clientId,a.store.pubId);const d=a.filterTobePublishedTracks(t,r,s);if(d.length===0)return void(yield zn(a.tryToUnmuteAudio(t)));d.forEach((v=>{let{track:w,type:I}=v;const A=Date.now();a.store.publish(w.getTrackId(),I===Xe.LocalAudioTrack?"audio":"video",A)})),a.bindLocalTrackEvents(d);const h=yield zn(a.sendConnection.send(d.map((v=>{let{track:w}=v;return w})),a.store.codec,a.store.audioCodec)),m=(yield zn(h.next())).value,g=a.createGatewayPublishMessage(d,m);try{yield g}catch(v){throw h.throw(v),(v==null?void 0:v.code)===te.WS_ABORT&&d.forEach((w=>{let{track:I}=w;a.pendingLocalTracks.indexOf(I)===-1&&a.pendingLocalTracks.push(I)})),a.unbindLocalTrackEvents(d),v}yield zn(h.next()),d.forEach((v=>{let{type:w}=v;a.statsCollector.addLocalStats(w)})),a.statsUploader.startUploadOutboundStats(),a.assignLocalTracks(d,m),d.forEach((v=>{let{track:w,type:I}=v;const A=Date.now();a.store.publish(w.getTrackId(),I===Xe.LocalAudioTrack?"audio":"video",void 0,A)})),a.startUploadUplinkState()}finally{c()}}))()}async unpublish(t){if(!this.sendConnection||this.state!==ar.Connected)return void(t.length===0?this.pendingLocalTracks.length=0:this.pendingLocalTracks=this.pendingLocalTracks.filter((c=>!rt(t).call(t,c))));const r=this.filterTobeUnpublishedTracks(t);if(r.length===0)return;const s=r.find((c=>c[0]==="videoLowTrack"));s&&s[1].track.close();const a=this.createGatewayUnpublishMessage(r);if(await this.sendConnection.stopSending(r.map((c=>{let[,{id:d}]=c;return d}))),this.withdrawLocalTracks(r),this.unbindLocalTrackEvents(r.map((c=>{let[d,{track:h}]=c;return{type:d,track:h}}))),r.forEach((c=>{let[d]=c;this.statsCollector.removeLocalStats(d)})),this.localTrackMap.size===0&&(this.statsUploader.stopUploadOutboundStats(),this.stopUploadUplinkState()),this.sendConnection&&this.state===ar.Connected)return s&&s[1].track.close(),a;t.forEach((c=>{const d=this.pendingLocalTracks.indexOf(c);d!==-1&&this.pendingLocalTracks.splice(d,1)}))}startUploadUplinkState(){if(this.uploadUnplinkStarted)return;this.uploadUnplinkStarted=!0,this.uplinkStateUploadInterval&&window.clearInterval(this.uplinkStateUploadInterval);const t=()=>{const r=[],s=[];Array.from(this.localTrackMap.entries()).forEach((a=>{let[c,{track:d,ssrcs:h}]=a;const m={stream_type:N_e(d,c),ssrcs:h};d._muted||!d._enabled?r.push(m):s.push(m)})),r.length>0&&r.forEach((a=>{wr(this,Mt.RequestMuteLocal,[a])})),s.length>0&&s.forEach((a=>{wr(this,Mt.RequestUnmuteLocal,[a])}))};t(),this.uplinkStateUploadInterval=window.setInterval((()=>{t()}),3e3)}stopUploadUplinkState(){this.uploadUnplinkStarted&&(this.uploadUnplinkStarted=!1,this.uplinkStateUploadInterval&&window.clearInterval(this.uplinkStateUploadInterval))}publishLowStream(t){return Ql((function*(){throw new Le(te.NOT_SUPPORTED,"p2p mode does not support publishLowStream.")}))()}async republish(){this.pendingLocalTracks.length>0&&(M.debug("[".concat(this.store.clientId,"] Emit P2PChannelEvents.RequestRePublish to republish tracks.")),await zs(this,Mt.RequestRePublish,this.pendingLocalTracks),this.emit(Mt.MediaReconnectEnd,this.store.uid),this.pendingLocalTracks=[])}async unpublishLowStream(){throw new Le(te.NOT_SUPPORTED,"p2p mode does not support unpublishLowStream.")}async subscribe(t,r,s,a){var c;if(!this.recvConnection)throw new Le(te.INVALID_OPERATION,"Cannot subscribe remote user when recvConnection disconnected.");if((c=this.remoteUserMap.get(t))!==null&&c!==void 0&&c.has(r))return;const{track:d,mid:h,transceiver:m}=await this.recvConnection.receive(r,[{ssrcId:s}],String(t.uid),a);r===St.AUDIO?(t._audioTrack?t._audioTrack._updateOriginMediaStreamTrack(d):(t._audioTrack=new m0(d,t.uid,t._uintid,this.store),M.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote audio track: ").concat(t._audioTrack.getTrackId()))),m&&t._audioTrack._updateRtpTransceiver(m),this.bindRemoteTrackEvents(t,t._audioTrack)):(t._videoSSRC=s,t._videoTrack?t._videoTrack._updateOriginMediaStreamTrack(d):(t._videoTrack=new f0(d,t.uid,t._uintid,this.store),M.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote video track: ").concat(t._videoTrack.getTrackId()))),m&&t._videoTrack._updateRtpTransceiver(m),this.bindRemoteTrackEvents(t,t._videoTrack));const g=this.remoteUserMap.get(t);g?g.set(r,h):this.remoteUserMap.set(t,new Map([[r,h]])),this.statsCollector.addRemoteStats(t.uid),this.statsUploader.startUploadInboundStats(),this.startUploadDownlinkState();const v=this.pendingRemoteTracks.findIndex((w=>{let{user:I,kind:A}=w;return I.uid===t.uid&&r===A}));v!==-1&&(this.pendingRemoteTracks.splice(v,1),this.emit(Mt.MediaReconnectEnd,t.uid))}async mockSubscribe(t,r,s,a){if(!this.recvConnection)throw new Le(te.INVALID_OPERATION,"Cannot subscribe remote user when recvConnection disconnected.");await this.recvConnection.mockReceive(r,[{ssrcId:s}],String(t.uid),a)}async unsubscribe(t,r,s){const a=this.pendingRemoteTracks.filter((d=>{let{user:h,kind:m}=d;return r!==void 0?h.uid===t.uid&&r===m:h.uid===t.uid}));if(a.forEach((d=>{const h=this.pendingRemoteTracks.indexOf(d);this.pendingRemoteTracks.splice(h,1)})),this.recvConnection||s||a.forEach((d=>{let{kind:h}=d;var m;if(h===St.AUDIO)(m=t._audioTrack)===null||m===void 0||m._destroy(),t._audioTrack=void 0;else if(h===St.VIDEO){var g;(g=t._videoTrack)===null||g===void 0||g._destroy(),t._videoTrack=void 0}})),!this.recvConnection)return;const c=this.filterTobeUnSubscribedTracks(t,r);c.length!==0&&(await this.recvConnection.stopReceiving(c.map((d=>{let[,{id:h}]=d;return h}))),this.withdrawRemoteTracks(c),this.remoteUserMap.size===0&&(this.statsUploader.stopUploadInboundStats(),this.stopUploadDownlinkState()),c.forEach((d=>{let[h,{kind:m}]=d;var g,v;if(m===St.VIDEO&&h._videoSSRC&&((g=this.recvConnection)===null||g===void 0||g.setStatsRemoteVideoIsReady(h._videoSSRC,!1)),m===St.VIDEO)this.unbindRemoteTrackEvents(h._videoTrack),s||((v=h._videoTrack)===null||v===void 0||v._destroy(),h._videoTrack=void 0);else if(m===St.AUDIO){var w;this.unbindRemoteTrackEvents(h._audioTrack),!s&&((w=h._audioTrack)===null||w===void 0||w._destroy(),h._audioTrack=void 0)}})),c.forEach((d=>{let[,{kind:h}]=d;wr(this,Mt.RequestP2PMuteRemote,h)})))}startUploadDownlinkState(){if(this.uploadDownlinkStarted)return;this.uploadDownlinkStarted=!0,this.downlinkStatsUploadInterval&&window.clearInterval(this.downlinkStatsUploadInterval);const t=()=>Array.from(this.remoteUserMap.entries()).forEach((r=>{let[,s]=r;[St.VIDEO,St.AUDIO].forEach((a=>{s.has(a)?wr(this,Mt.RequestP2PUnmuteRemote,a):wr(this,Mt.RequestP2PMuteRemote,a)}))}));t(),this.downlinkStatsUploadInterval=window.setInterval((()=>{t()}),3e3)}stopUploadDownlinkState(){this.uploadDownlinkStarted&&(this.uploadDownlinkStarted=!1,this.downlinkStatsUploadInterval&&window.clearInterval(this.downlinkStatsUploadInterval))}getAllDataChannels(){return this.localDataChannels}async massSubscribe(t){throw new Le(te.NOT_SUPPORTED,"p2p mode does not support massSubscribe.")}async massSubscribeNoLock(t){throw new Le(te.NOT_SUPPORTED,"p2p mode does not support massSubscribeNoLock.")}async massUnsubscribe(t){throw new Le(te.NOT_SUPPORTED,"p2p mode does not support massUnsubscribe.")}async massUnsubscribeNoLock(t){throw new Le(te.NOT_SUPPORTED,"p2p mode does not support massUnsubscribeNoLock.")}async muteRemote(t,r){if(!this.recvConnection)return;const s=this.remoteUserMap.get(t);if(!s)return void M.warning("[".concat(this.store.clientId,"] P2PChannel2.muteRemote has no remote user ").concat(t.uid,"."));if(!s.get(r))return void M.warning("[".concat(this.store.clientId,"] P2PChannel2.muteRemote has no remote user ").concat(t.uid," media type ").concat(r,"."));const a=r===St.VIDEO?t._videoSSRC:t._audioSSRC;a!==void 0&&this.recvConnection.setStatsRemoteVideoIsReady(a,!1)}async unmuteRemote(t,r){return this.unmuteRemoteNoLock(t,r)}async unmuteRemoteNoLock(t,r){if(!this.recvConnection)return;const s=this.remoteUserMap.get(t);if(!s)return void M.warning("[".concat(this.store.clientId,"] P2PChannel2.unmuteRemote has no remote user ").concat(t.uid,"."));s.get(r)||M.warning("[".concat(this.store.clientId,"] P2PChannel2.unmuteRemote has no remote user ").concat(t.uid," media type ").concat(r,"."))}getAllTracks(t){const r=this.localTrackMap.get(Xe.LocalAudioTrack);if((r==null?void 0:r.track)instanceof Gi){const s=r.track;return Array.from(this.localTrackMap.entries()).filter((a=>{let[c]=a;return c!==Xe.LocalAudioTrack})).filter((a=>{let[c]=a;return!(t&&c===Xe.LocalVideoLowTrack)})).map((a=>{let[,{track:c}]=a;return c})).concat(s.trackList)}return Array.from(this.localTrackMap.entries()).filter((s=>{let[a]=s;return!(t&&a===Xe.LocalVideoLowTrack)})).map((s=>{let[,{track:a}]=s;return a}))}reportPublishEvent(t,r,s,a,c){if(t){const h=this.localTrackMap.get(Xe.LocalAudioTrack),m=a?this.localTrackMap.get(Xe.LocalVideoLowTrack):this.localTrackMap.get(Xe.LocalVideoTrack);It.publish(this.store.sessionId,{eventElapse:lo.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:t,ec:r,audioName:h==null?void 0:h.track.getTrackLabel(),videoName:m==null?void 0:m.track.getTrackLabel(),screenshare:(m==null?void 0:m.track._hints.indexOf(Sr.SCREEN_TRACK))!==-1,audio:!!h,video:!!m,p2pid:this.store.p2pId,publishRequestid:this.store.pubId,extend:c})}else{var d;s||(s=[]);const h=s.find((g=>g instanceof ui)),m=a?(d=this.localTrackMap.get(Xe.LocalVideoTrack))===null||d===void 0?void 0:d.track:s.find((g=>g instanceof Nr));It.publish(this.store.sessionId,{eventElapse:lo.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:t,ec:r,audioName:h==null?void 0:h.getTrackLabel(),videoName:m==null?void 0:m.getTrackLabel(),screenshare:(m==null?void 0:m._hints.indexOf(Sr.SCREEN_TRACK))!==-1,audio:!!h,video:!!m,p2pid:this.store.p2pId,publishRequestid:this.store.pubId,extend:c})}}reportSubscribeEvent(t,r,s,a){const c=a===St.VIDEO?s._videoSSRC:s._audioSSRC;c&&It.subscribe(this.store.sessionId,{succ:t,ec:r,video:a===St.VIDEO,audio:a===St.AUDIO,peerid:s.uid,subscribeRequestid:a===St.VIDEO?s._videoSSRC:s._audioSSRC,p2pid:this.store.p2pId,eventElapse:lo.measureFromSubscribeStart(this.store.clientId,c)})}reset(){M.debug("[".concat(this.store.clientId,"] P2PChannel2.reset")),this.sendMutex=new so("P2PChannel2-send-mutex",this.store.clientId),this.sendMutex=new so("P2PChannel2-recv-mutex",this.store.clientId),this.sendConnection&&(this.sendConnection.close(),this.unbindConnectionEvents(this.sendConnection),this.sendConnection=void 0),this.recvConnection&&(this.recvConnection.close(),this.unbindConnectionEvents(this.recvConnection),this.recvConnection=void 0),this.statsUploader.stopUploadOutboundStats(),this.statsUploader.stopUploadInboundStats(),this.statsUploader.stopUploadTransportStats(),this.statsUploader.stopUploadExtensionUsageStats(),this.stopUploadUplinkState(),this.stopUploadDownlinkState(),this.unbindLocalTrackEvents(),this.unbindAllRemoteTrackEvents(),this.unbindRtpTransceiver();const t=this.localTrackMap.get(Xe.LocalAudioTrack);if((t==null?void 0:t.track)instanceof Gi){if(t.track.trackList.length>0){const r=t.track;t.track.trackList.forEach((s=>{r.removeAudioTrack(s)}))}t.track.close()}this.localTrackMap.clear(),this.remoteUserMap.clear(),this.statsCollector.removeRemoteStats(),this.statsCollector.removeLocalStats(),this.dtlsFailedCount=0,this.pendingLocalTracks=[],this.pendingRemoteTracks=[],this.reconnectInterval&&(window.clearInterval(this.reconnectInterval),this.reconnectInterval=void 0),this.state=ar.Disconnected}getStats(t){var r,s;return t?(s=this.recvConnection)===null||s===void 0?void 0:s.getStats():(r=this.sendConnection)===null||r===void 0?void 0:r.getStats()}getRemoteVideoIsReady(t){var r;return((r=this.recvConnection)===null||r===void 0?void 0:r.getRemoteVideoIsReady(t))||!1}getLocalAudioVolume(){const t=this.localTrackMap.get(Xe.LocalAudioTrack);if(t)return t.track.getVolumeLevel()}getLocalVideoSize(){const t=this.localTrackMap.get(Xe.LocalVideoTrack);if(t)return{width:t.track.videoWidth||0,height:t.track.videoHeight||0}}getEncoderConfig(t){const r=this.localTrackMap.get(t);return r&&r.track instanceof Nr||r&&r.track instanceof ui?r.track._encoderConfig:void 0}getLocalMedia(t){return this.localTrackMap.get(t)}hasLocalMedia(){return this.localTrackMap.size>0}hasRemoteMedia(t,r){if(!t)return this.remoteUserMap.size>0;const s=this.remoteUserMap.get(t);return!!s&&(!r||s.has(r))}async hasRemoteMediaWithLock(t,r){if(!t)return this.remoteUserMap.size>0;const s=this.remoteUserMap.get(t);return!!s&&(!r||s.has(r))}getRemoteMedia(t){var r;const s=Array.from(rc(r=this.remoteUserMap).call(r)).find((a=>a.uid===t));return s?{audioTrack:s.audioTrack,audioSSRC:s._audioSSRC,videoTrack:s.videoTrack,videoSSRC:s._videoSSRC}:{}}getAudioLevels(){let t=Array.from(this.remoteUserMap.entries()).map((s=>{let[a]=s;return{uid:a.uid,level:a.audioTrack?100*a.audioTrack._source.getAccurateVolumeLevel():0}}));const r=this.localTrackMap.get(Xe.LocalAudioTrack);return r&&t.push({level:100*r.track._source.getAccurateVolumeLevel(),uid:this.store.uid}),t=q_(t).call(t,((s,a)=>s.level-a.level)),t}async disconnectForReconnect(){this.sendConnection&&this.recvConnection&&(M.debug("[".concat(this.store.clientId,"] P2PChannel2.disconnectForReconnect closing P2PConnection")),this.state=ar.Reconnecting,oe("KEEP_LAST_FRAME")&&this.remoteUserMap.size!==0&&Array.from(this.remoteUserMap.entries()).forEach((t=>{let[r]=t;var s;r._videoTrack&&r._videoTrack._player&&((s=r._videoTrack._player.getVideoElement())===null||s===void 0||s.pause(),r._videoTrack._player.isKeepLastFrame=!0,r._videoTrack._originMediaStreamTrack.stop())})),this.sendConnection.close(),this.unbindConnectionEvents(this.sendConnection),this.sendConnection=void 0,this.recvConnection.close(),this.unbindConnectionEvents(this.recvConnection),this.recvConnection=void 0,this.localTrackMap.size!==0&&(Array.from(this.localTrackMap.entries()).forEach((t=>{var r;let[s,{track:a}]=t;switch(s){case Xe.LocalVideoTrack:rt(r=a._hints).call(r,Sr.LOW_STREAM)?a.close():this.pendingLocalTracks.push(a);break;case Xe.LocalAudioTrack:a instanceof Gi?this.pendingLocalTracks=this.pendingLocalTracks.concat(a.trackList):this.pendingLocalTracks.push(a);case Xe.LocalVideoLowTrack:}})),this.emit(Mt.MediaReconnectStart,this.store.uid)),this.unbindLocalTrackEvents(),this.localTrackMap.clear(),this.remoteUserMap.size!==0&&Array.from(this.remoteUserMap.entries()).forEach((t=>{let[r,s]=t;Array.from(rc(s).call(s)).forEach((a=>{this.setPendingRemoteMedia(r,a)})),this.emit(Mt.MediaReconnectStart,r.uid)})),this.unbindAllRemoteTrackEvents(),this.remoteUserMap.clear(),this.stopUploadUplinkState(),this.stopUploadDownlinkState(),this.statsUploader.stopUploadOutboundStats(),this.statsUploader.stopUploadInboundStats(),this.statsUploader.stopUploadTransportStats(),M.debug("[".concat(this.store.clientId,"] P2PChannel2 disconnected, waiting to reconnect.")))}hasPendingRemoteMedia(t,r){for(const s of this.pendingRemoteTracks){const{user:a,kind:c}=s;if((t instanceof lg?t.uid:t)===a.uid&&r===c)return!0}return!1}setPendingRemoteMedia(t,r){this.hasPendingRemoteMedia(t,r)||this.pendingRemoteTracks.push({user:t,kind:r})}async restartICE(t,r){let s,a;if(t===fa.SEND_ONLY){if(!this.sendConnection)throw new Le(te.INVALID_OPERATION,"Cannot call P2PChannel2.handleMuteLocalTrack before sendConnection established.");s=await this.sendMutex.lock("From P2PChannel.restartICE"),a=this.sendConnection}else{if(!this.recvConnection)throw new Le(te.INVALID_OPERATION,"Cannot call P2PChannel2.handleMuteLocalTrack before recvConnection established.");s=await this.recvMutex.lock("From P2PChannel.restartICE"),a=this.recvConnection}try{if(r){const c=await a.restartICE(r);return a.isInRestartIce=!1,c}{const c=await a.restartICE();if(c){const d=await zs(this,Mt.RequestP2PRestartICE,{direction:fa.RECEIVE_ONLY,iceParameter:c});await a.restartICE(d),a.isInRestartIce=!1}}}finally{s()}}getUplinkNetworkQuality(){if(!this.sendConnection)return 0;const t=this.sendConnection.getStats(),r=this.localTrackMap.get(Xe.LocalVideoTrack),s=this.localTrackMap.get(Xe.LocalAudioTrack),a=t.videoSend.find((N=>{var H;return N.ssrc===(r==null||(H=r.ssrcs)===null||H===void 0?void 0:H[0].ssrcId)})),c=t.audioSend.find((N=>{var H;return N.ssrc===(s==null||(H=s.ssrcs)===null||H===void 0?void 0:H[0].ssrcId)}));if(!a||!c)return 1;const d=al(this,Mt.NeedSignalRTT),h=a?a.rttMs:void 0,m=c?c.rttMs:void 0,g=h&&m?(h+m)/2:h||m,v=(g&&d?(g+d)/2:g||d)||0,w=100*t.sendPacketLossRate*.7/50+.3*v/1500,I=w<.17?1:w<.36?2:w<.59?3:w<.1?4:5,A=r==null?void 0:r.track;if(A&&A._encoderConfig&&A._hints.indexOf(Sr.SCREEN_TRACK)===-1){const N=A._encoderConfig.bitrateMax,H=t.bitrate.actualEncoded;if(N&&H){const B=(1e3*N-H)/(1e3*N);return l7[B<.15?0:B<.3?1:B<.45?2:B<.6?3:4][I]}}return I}getDownlinkNetworkQuality(){if(!this.recvConnection)return 0;const t=this.recvConnection.getStats();let r=0;return Array.from(this.remoteUserMap.entries()).forEach((s=>{let[a]=s;const c=a._audioSSRC,d=a._videoSSRC,h=t.audioRecv.find((H=>H.ssrc===c)),m=t.videoRecv.find((H=>H.ssrc===d));if(!h&&!m)return void(r+=1);const g=al(this,Mt.NeedSignalRTT),v=t.rtt,w=(v&&g?(v+g)/2:v||g)||0,I=h?h.jitterMs:void 0,A=t.recvPacketLossRate;let N=.7*A*100/50+.3*w/1500;I&&(N=.6*A*100/50+.2*w/1500+.2*I/400),r+=N<.1?1:N<.17?2:N<.36?3:N<.59?4:5})),this.remoteUserMap.size>0?Math.round(r/this.remoteUserMap.size):r}async muteLocalTrack(t){return new mt(((r,s)=>{this.handleMuteLocalTrack(t,r,s)}))}filterTobePublishedTracks(t,r,s){const a=[],c=Wn(),d=this.getAllTracks();t=t0(t=t.filter((g=>d.indexOf(g)===-1)));let h=!1,m=!1;for(const g of t){if(g instanceof Nr&&(this.localTrackMap.has(Xe.LocalVideoTrack)||h?new Le(te.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS).throw():(a.push({track:g,type:Xe.LocalVideoTrack}),h=!0),r)){const v=this.getLowVideoTrack(g,s);a.push({track:v,type:Xe.LocalVideoLowTrack})}if(g instanceof ui){const v=this.localTrackMap.get(Xe.LocalAudioTrack);if(v){if(!(v.track instanceof Gi))throw new Le(te.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser does not support audio mixing");if(g._bypassWebAudio)throw new Le(te.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio");v.track.addAudioTrack(g),this.bindLocalAudioTrackEvents(g,!0)}else if(m){const w=a.find((I=>{let{type:A}=I;return A===Xe.LocalAudioTrack}));if(!(w.track instanceof Gi))throw new Le(te.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser does not support audio mixing");if(g._bypassWebAudio)throw new Le(te.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio");w.track.addAudioTrack(g)}else{if(!c.webAudioMediaStreamDest||g instanceof Gi||g._bypassWebAudio)a.push({track:g,type:Xe.LocalAudioTrack});else{const w=new Gi;w.addAudioTrack(g),a.push({track:w,type:Xe.LocalAudioTrack})}m=!0}}}return a}filterTobeUnpublishedTracks(t){const r=[],s=this.getAllTracks();t=t0(t=t.filter((a=>s.indexOf(a)!==-1)));for(const a of t){if(a instanceof ui){const c=this.localTrackMap.get(Xe.LocalAudioTrack);if(!c)continue;c.track instanceof Gi?(c.track.removeAudioTrack(a),this.unbindLocalAudioTrackEvents(a),c.track.trackList.length===0&&(r.push([Xe.LocalAudioTrack,c]),c.track.close())):r.push([Xe.LocalAudioTrack,c])}if(a instanceof Nr){const c=this.localTrackMap.get(Xe.LocalVideoTrack);if(!c)continue;r.push([Xe.LocalVideoTrack,c]);const d=this.localTrackMap.get(Xe.LocalVideoLowTrack);d&&r.push([Xe.LocalVideoLowTrack,d])}}return r}bindLocalTrackEvents(t){t.forEach((r=>{let{track:s,type:a}=r;switch(a){case Xe.LocalVideoTrack:s.addListener(Tt.GET_STATS,this.handleGetLocalVideoStats),s.addListener(Tt.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),s.addListener(Tt.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),s.addListener(Tt.NEED_UPDATE_VIDEO_ENCODER,this.handleUpdateVideoEncoder),s.addListener(Tt.NEED_UPDATE_VIDEO_SEND_PARAMETERS,this.handleUpdateVideoSendParameters),s.addListener(Tt.NEED_REPLACE_TRACK,this.handleReplaceTrack),s.addListener(Tt.NEED_MUTE_TRACK,this.handleMuteLocalTrack),s.addListener(Tt.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack);break;case Xe.LocalAudioTrack:this.bindLocalAudioTrackEvents(s);case Xe.LocalVideoLowTrack:}}))}bindLocalAudioTrackEvents(t,r){t instanceof Gi?t.trackList.forEach((s=>{s.addListener(Tt.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),s.addListener(Tt.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),s.addListener(Tt.GET_STATS,this.handleGetLocalAudioStats),s.addListener(Tt.NEED_MUTE_TRACK,this.handleMuteLocalTrack),s.addListener(Tt.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack)})):(t.addListener(Tt.GET_STATS,this.handleGetLocalAudioStats),t.addListener(Tt.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),t.addListener(Tt.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),t.addListener(Tt.NEED_MUTE_TRACK,this.handleMuteLocalTrack),t.addListener(Tt.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack),r||t.addListener(Tt.NEED_REPLACE_TRACK,this.handleReplaceTrack))}unbindLocalTrackEvents(t){t||(t=Array.from(this.localTrackMap.entries()).map((r=>{let[s,{track:a}]=r;return{track:a,type:s}}))),t.forEach((r=>{let{track:s,type:a}=r;switch(a){case Xe.LocalVideoTrack:s.off(Tt.GET_STATS,this.handleGetLocalVideoStats),s.off(Tt.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),s.off(Tt.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),s.off(Tt.NEED_UPDATE_VIDEO_ENCODER,this.handleUpdateVideoEncoder),s.off(Tt.NEED_UPDATE_VIDEO_SEND_PARAMETERS,this.handleUpdateVideoSendParameters),s.off(Tt.NEED_REPLACE_TRACK,this.handleReplaceTrack),s.off(Tt.NEED_MUTE_TRACK,this.handleMuteLocalTrack),s.off(Tt.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack);break;case Xe.LocalAudioTrack:this.unbindLocalAudioTrackEvents(s);case Xe.LocalVideoLowTrack:}}))}unbindLocalAudioTrackEvents(t){t instanceof Gi?t.trackList.forEach((r=>{r.off(Tt.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),r.off(Tt.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),r.off(Tt.GET_STATS,this.handleGetLocalAudioStats),r.off(Tt.NEED_MUTE_TRACK,this.handleMuteLocalTrack),r.off(Tt.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack)})):(t.off(Tt.GET_STATS,this.handleGetLocalAudioStats),t.off(Tt.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),t.off(Tt.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),t.off(Tt.NEED_REPLACE_TRACK,this.handleReplaceTrack),t.off(Tt.NEED_MUTE_TRACK,this.handleMuteLocalTrack),t.off(Tt.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack))}bindRemoteTrackEvents(t,r){r instanceof f0&&r.addListener(Tt.GET_STATS,(s=>{s(this.handleGetRemoteVideoStats(t))})),r instanceof m0&&r.addListener(Tt.GET_STATS,(s=>{s(this.handleGetRemoteAudioStats(t))}))}unbindRemoteTrackEvents(t){t&&t.removeAllListeners(Tt.GET_STATS)}unbindAllRemoteTrackEvents(){Array.from(this.remoteUserMap.entries()).forEach((t=>{let[r,s]=t;s.has(St.AUDIO)&&this.unbindRemoteTrackEvents(r._audioTrack),s.has(St.VIDEO)&&this.unbindRemoteTrackEvents(r._videoTrack)}))}createGatewayPublishMessage(t,r){return t.map(((s,a)=>{var c;let d,{track:h,type:m}=s;switch(m){case Xe.LocalAudioTrack:d=lr.Audio;break;case Xe.LocalVideoTrack:d=rt(c=h._hints).call(c,Sr.SCREEN_TRACK)?lr.Screen:lr.High;break;case Xe.LocalVideoLowTrack:d=lr.Low}return{kind:m===Xe.LocalAudioTrack?St.AUDIO:St.VIDEO,stream_type:d,mid:r[a].id,ssrcs:r[a].localSSRC,isMuted:h.muted||!h.enabled}}))}createGatewayUnpublishMessage(t){return t.map((r=>{var s;let a,[c,{track:d,ssrcs:h,id:m}]=r;switch(c){case Xe.LocalVideoTrack:a=rt(s=d._hints).call(s,Sr.SCREEN_TRACK)?lr.Screen:lr.High;break;case Xe.LocalAudioTrack:a=lr.Audio;break;case Xe.LocalVideoLowTrack:a=lr.Low}return{stream_type:a,ssrcs:h,mid:m}}))}assignLocalTracks(t,r){t.forEach(((s,a)=>{let{track:c,type:d}=s;this.localTrackMap.set(d,{track:c,id:r[a].id,ssrcs:r[a].localSSRC})}))}withdrawLocalTracks(t){t.forEach((r=>{let[s]=r;this.localTrackMap.delete(s)}))}bindConnectionEvents(t){t.onConnectionStateChange=async r=>{var s;M.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: ").concat(t.name,".onConnectionStateChange(").concat(r,")")),this.emit(Mt.PeerConnectionStateChange,r),r!=="connected"||this.store.keyMetrics.peerConnectionEnd||this.store.peerConnectionEnd(),r==="connected"&&(t.isInRestartIce=!1),rt(s=this._restartStates).call(s,r)&&!t.isInRestartIce&&(r==="disconnected"&&await Is(800),t.iceConnectionState!=="disconnected"&&t.iceConnectionState!=="failed"||this.handleDisconnect(t.direction))},t.onICEConnectionStateChange=r=>{r!=="connected"||this.store.keyMetrics.iceConnectionEnd||this.store.iceConnectionEnd(),M.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICEConnectionStateChange(").concat(r,")")),It.reportApiInvoke(this.store.sessionId,{name:"ICEConnectionStateChange",options:r,tag:$r.TRACER}).onSuccess(),this.emit(Mt.IceConnectionStateChange,r)},t.onICETransportStateChange=r=>{M.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICETransportStateChange(").concat(r,")"))},t.onDTLSTransportStateChange=r=>{M.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onDTLSTransportStateChange(").concat(r,")"))},t.onDTLSTransportError=r=>{M.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onDTLSTransportError(").concat(r,")"))},t.onFirstAudioDecoded=r=>{var s;const a=Array.from(rc(s=this.remoteUserMap).call(s)).find((d=>d._audioSSRC===r));var c;a&&(this.store.subscribe(a.uid,"audio",void 0,void 0,void 0,Date.now()),(c=a.audioTrack)===null||c===void 0||c.emit(tu.FIRST_FRAME_DECODED),It.firstRemoteFrame(this.store.sessionId,es.FIRST_AUDIO_DECODE,Br.FIRST_AUDIO_DECODE,{peer:a._uintid,subscribeElapse:lo.measureFromSubscribeStart(this.store.clientId,r),subscribeRequestid:r,p2pid:this.store.p2pId}))},t.onFirstAudioReceived=r=>{var s;const a=Array.from(rc(s=this.remoteUserMap).call(s)).find((c=>c._audioSSRC===r));a&&It.firstRemoteFrame(this.store.sessionId,es.FIRST_AUDIO_RECEIVED,Br.FIRST_AUDIO_RECEIVED,{peer:a._uintid,subscribeElapse:lo.measureFromSubscribeStart(this.store.clientId,r),subscribeRequestid:r,p2pid:this.store.p2pId})},t.onFirstVideoDecoded=(r,s,a)=>{this.reportVideoFirstFrameDecoded(r,s,a)},t.onFirstVideoReceived=r=>{var s;const a=Array.from(rc(s=this.remoteUserMap).call(s)).find((c=>c._videoSSRC===r));a&&It.firstRemoteFrame(this.store.sessionId,es.FIRST_VIDEO_RECEIVED,Br.FIRST_VIDEO_RECEIVED,{peer:a._uintid,subscribeElapse:lo.measureFromSubscribeStart(this.store.clientId,r),subscribeRequestid:r,p2pid:this.store.p2pId})},t.onSelectedLocalCandidateChanged=(r,s)=>{const a=r.candidateType==="relay",c=s.candidateType==="relay";s.candidateType!=="unknown"&&a===c||this.emit(Mt.ConnectionTypeChange,a),M.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.SelectedLocalCandidateChanged(").concat(JSON.stringify(ig(s))," -> ").concat(JSON.stringify(ig(r)),")"))},t.onSelectedRemoteCandidateChanged=(r,s)=>{M.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.SelectedRemoteCandidateChanged(").concat(JSON.stringify(ig(s))," -> ").concat(JSON.stringify(ig(r)),")"))},t.onFirstVideoDecodedTimeout=r=>{this.reportVideoFirstFrameDecoded(r,void 0,void 0,!0)},t.onLocalCandidate=r=>{this.emit(Mt.LocalCandidate,{candidate:r,direction:t.direction})}}unbindConnectionEvents(t){t.onConnectionStateChange=void 0,t.onICEConnectionStateChange=void 0,t.onICETransportStateChange=void 0,t.onDTLSTransportStateChange=void 0,t.onDTLSTransportError=void 0,t.onFirstAudioDecoded=void 0,t.onFirstAudioReceived=void 0,t.onFirstVideoDecoded=void 0,t.onFirstVideoReceived=void 0,t.onSelectedLocalCandidateChanged=void 0,t.onSelectedRemoteCandidateChanged=void 0,t.onFirstVideoDecodedTimeout=void 0,t.onLocalCandidate=void 0}async handleDisconnect(t){const r=t===fa.SEND_ONLY?this.sendConnection:this.recvConnection;r&&!r.isInRestartIce&&(r.isInRestartIce=!0,M.debug("[".concat(this.store.clientId,"] [P2PChannel-").concat(r.name,"] start use restartICE")),t===fa.SEND_ONLY?this.restartICE(t):zs(this,Mt.RequestP2PRestartICE,{direction:fa.SEND_ONLY}))}filterTobeMutedTracks(t){const r=[];if(this.getAllTracks().indexOf(t)===-1)return r;const s=this.localTrackMap.get(Xe.LocalAudioTrack);if(t instanceof ui&&(s==null?void 0:s.track)instanceof Gi)return s.track.isActive||r.push([Xe.LocalAudioTrack,s]),r;const a=Array.from(this.localTrackMap.entries()).find((c=>{let[,{track:d}]=c;return t===d}));if(a&&(r.push(a),a[0]===Xe.LocalVideoTrack)){const c=this.localTrackMap.get(Xe.LocalVideoLowTrack);c&&r.push([Xe.LocalVideoLowTrack,c])}return r}filterTobeUnmutedTracks(t){const r=[],s=this.localTrackMap.get(Xe.LocalAudioTrack);if(t instanceof ui&&(s==null?void 0:s.track)instanceof Gi)return s.track.isActive&&r.push([Xe.LocalAudioTrack,s]),r;const a=Array.from(this.localTrackMap.entries()).find((c=>{let[,{track:d}]=c;return t===d}));if(a)if(a[0]===Xe.LocalVideoTrack){r.push(a);const c=this.localTrackMap.get(Xe.LocalVideoLowTrack);c&&r.push([Xe.LocalVideoLowTrack,c])}else r.push(a);return r}createMuteMessage(t){return t.map((r=>{var s;let a,[c,{track:d,ssrcs:h,id:m}]=r;switch(c){case Xe.LocalAudioTrack:a=lr.Audio;break;case Xe.LocalVideoTrack:a=rt(s=d._hints).call(s,Sr.SCREEN_TRACK)?lr.Screen:lr.High;break;case Xe.LocalVideoLowTrack:a=lr.Low}return{stream_type:a,ssrcs:h,mid:m}}))}createUnmuteMessage(t){return t.map((r=>{var s;let a,[c,{track:d,ssrcs:h,id:m}]=r;switch(c){case Xe.LocalAudioTrack:a=lr.Audio;break;case Xe.LocalVideoTrack:a=rt(s=d._hints).call(s,Sr.SCREEN_TRACK)?lr.Screen:lr.High;break;case Xe.LocalVideoLowTrack:a=lr.Low}return{stream_type:a,ssrcs:h,mid:m}}))}filterTobeUnSubscribedTracks(t,r){const s=[],a=this.remoteUserMap.get(t);if(!a)return s;if(r){const c=a.get(r);if(!c)return s;s.push([t,{kind:r,id:c}])}else Array.from(a.entries()).forEach((c=>{let[d,h]=c;s.push([t,{kind:d,id:h}])}));return s}createUnsubscribeMessage(t){const r=[];return t.forEach((s=>{let[a,{kind:c,id:d}]=s;switch(c){case St.VIDEO:return void(a._videoSSRC&&r.push({stream_type:St.VIDEO,ssrcId:a._videoSSRC}));case St.AUDIO:return void(a._audioSSRC&&r.push({stream_type:St.AUDIO,ssrcId:a._audioSSRC}))}})),r}withdrawRemoteTracks(t){t.forEach((r=>{let[s,{kind:a}]=r;const c=this.remoteUserMap.get(s);c&&(c.delete(a),Array.from(c.entries()).length===0&&this.remoteUserMap.delete(s))}))}async updateBitrateLimit(t){const r=this.localTrackMap.get(Xe.LocalVideoTrack),s=this.localTrackMap.get(Xe.LocalVideoLowTrack);r&&(await r.track.setBitrateLimit(t.uplink),await new mt(((a,c)=>{this.handleUpdateVideoEncoder(r.track,a,c,!0)}))),s&&t.low_stream_uplink&&(await s.track.setBitrateLimit({max_bitrate:t.low_stream_uplink.bitrate,min_bitrate:t.low_stream_uplink.bitrate||0}),await new mt(((a,c)=>{this.handleUpdateVideoEncoder(s.track,a,c,!0)})))}isP2PDisconnected(){if(this.sendConnection&&this.recvConnection){const t=this.sendConnection.peerConnectionState,r=this.recvConnection.peerConnectionState;return t!=="connected"&&r!=="connected"}return!0}async tryToUnmuteAudio(t){for(let r=0;r<t.length;r++)if(t[r]instanceof ui){const s=this.filterTobeUnmutedTracks(t[r]);if(s.length===0)continue;const a=this.createUnmuteMessage(s);return void await wr(this,Mt.RequestUnmuteLocal,a)}}bindStatsUploaderEvents(){this.statsUploader.requestStats=t=>this.getStats(t),this.statsUploader.requestLocalMedia=()=>Array.from(this.localTrackMap.entries()).filter((t=>{let[,{ssrcs:r}]=t;return!!r})),this.statsUploader.requestRemoteMedia=()=>Array.from(this.remoteUserMap.entries()),this.statsUploader.requestVideoIsReady=t=>{var r;return!((r=this.recvConnection)===null||r===void 0||!r.getRemoteVideoIsReady(t))},this.statsUploader.requestUpload=(t,r)=>this.emit(Mt.RequestUpload,t,r),this.statsUploader.requestUploadStats=t=>this.emit(Mt.RequestUploadStats,t),this.statsUploader.requestAllTracks=()=>this.getAllTracks()}unbindStatsUploaderEvents(){this.statsUploader.requestStats=void 0,this.statsUploader.requestLocalMedia=void 0,this.statsUploader.requestRemoteMedia=void 0,this.statsUploader.requestVideoIsReady=void 0}async requestReconnect(){this.dtlsFailedCount+=1,await Is(QL(this.dtlsFailedCount,Vi)),this.emit(Mt.RequestReconnect)}async reconnectP2P(){}canPublishLowStream(){return this.localTrackMap.has(Xe.LocalVideoTrack)||this.pendingLocalTracks.some((t=>t instanceof Nr))}throwIfTrackTypeNotMatch(t){if(t.filter((r=>r instanceof Nr)).length>1)throw new Le(te.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS);if(t.filter((r=>r instanceof ui)).length>1&&(t.some((r=>r instanceof ui&&r._bypassWebAudio))||!Wn().webAudioMediaStreamDest))throw new Le(te.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser doesn't support MediaStreamDestNode");for(const r of t){if(r instanceof Nr&&this.pendingLocalTracks.some((s=>s instanceof Nr)))throw new Le(te.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS);if(r instanceof ui&&this.pendingLocalTracks.some((s=>s instanceof ui))&&(!Wn().webAudioMediaStreamDest||r._bypassWebAudio||this.pendingLocalTracks.some((s=>s instanceof ui&&s._bypassWebAudio))))throw new Le(te.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser doesn't support MediaStreamDestNode")}}getLowVideoTrack(t,r){const s=!oe("DISABLE_DUAL_STREAM_USE_ENCODING")&&Wn().supportDualStreamEncoding,a=GP(GP({},{width:160,height:120,framerate:15,bitrate:50}),r);let c;c=s?t._mediaStreamTrack.clone():fM(t,a);const d=Tr(8,"track-low-"),h=new Nr(c,GP(GP({},s&&{scaleResolutionDownBy:q2(a,t)}),{},{frameRate:a.framerate,bitrateMax:a.bitrate,bitrateMin:a.bitrate}),void 0,void 0,d);return h.on(ay.TRANSCEIVER_UPDATED,(m=>{t._updateRtpTransceiver(m,c0.LOW_STREAM)})),h._hints.push(Sr.LOW_STREAM),t.addListener(Tt.NEED_CLOSE,(()=>{h.close()})),h}async globalLock(){return this.recvMutex.lock("From P2PChannel2.globalLock")}reportVideoFirstFrameDecoded(t,r,s,a){var c;const d=Array.from(rc(c=this.remoteUserMap).call(c)).find((h=>h._videoSSRC===t));if(d){a||this.store.subscribe(d.uid,"video",void 0,void 0,void 0,void 0,Date.now());const h=this.store.keyMetrics,m=h.subscribe.find((g=>g.userId===d.uid&&g.type==="video"));It.firstRemoteVideoDecode(this.store.sessionId,es.FIRST_VIDEO_DECODE,Br.FIRST_VIDEO_DECODE,{peer:d._uintid,videowidth:r,videoheight:s,subscribeElapse:lo.measureFromSubscribeStart(this.store.clientId,t),subscribeRequestid:t,p2pid:this.store.p2pId,apEnd:h.requestAPEnd||0,apStart:h.requestAPStart||0,joinGwEnd:h.joinGatewayEnd||0,joinGwStart:h.joinGatewayStart||0,pcEnd:h.peerConnectionEnd||0,pcStart:h.peerConnectionStart||0,subscriberEnd:(m==null?void 0:m.subscribeEnd)||0,subscriberStart:(m==null?void 0:m.subscribeStart)||0,videoAddNotify:(m==null?void 0:m.streamAdded)||0,state:a?1:0})}}async remoteMediaSsrcChanged(t,r,s){if(!this.recvConnection)return!1;const a=this.remoteUserMap.get(t);if(!a)return!1;const c=a.get(r);if(!c)return!1;const d=await this.recvConnection.getRemoteSSRC(c);return d!==void 0&&d!==s}isPreSubScribe(t){return!1}async publishDataChannel(t){throw new Le(te.NOT_SUPPORTED)}async unpublishDataChannel(t){throw new Le(te.NOT_SUPPORTED)}async subscribeDataChannel(t,r){throw new Le(te.NOT_SUPPORTED)}async unsubscribeDataChannel(t,r){throw new Le(te.NOT_SUPPORTED)}hasPendingRemoteDataChannel(t,r){throw new Le(te.NOT_SUPPORTED)}setPendingRemoteDataChannel(t,r){throw new Le(te.NOT_SUPPORTED)}async preConnect(t){throw new Le(te.NOT_SUPPORTED)}getEstablishParams(){throw new Le(te.NOT_SUPPORTED)}async reSubscribe(t){throw new Le(te.NOT_SUPPORTED)}reportVideoFirstFrameRender(t){}async updateVideoStreamParameter(t,r){throw new Le(te.NOT_SUPPORTED)}unbindRtpTransceiver(){this.localTrackMap.size!==0&&Array.from(this.localTrackMap.entries()).forEach((t=>{let[r,{track:s}]=t;r===Xe.LocalVideoLowTrack?s._updateRtpTransceiver(void 0,c0.LOW_STREAM):s._updateRtpTransceiver(void 0)}))}},Rt(qr.prototype,"p2pConnect",[HK],Object.getOwnPropertyDescriptor(qr.prototype,"p2pConnect"),qr.prototype),Rt(qr.prototype,"unpublish",[$K],Object.getOwnPropertyDescriptor(qr.prototype,"unpublish"),qr.prototype),Rt(qr.prototype,"unpublishLowStream",[KK],Object.getOwnPropertyDescriptor(qr.prototype,"unpublishLowStream"),qr.prototype),Rt(qr.prototype,"subscribe",[qK],Object.getOwnPropertyDescriptor(qr.prototype,"subscribe"),qr.prototype),Rt(qr.prototype,"mockSubscribe",[YK],Object.getOwnPropertyDescriptor(qr.prototype,"mockSubscribe"),qr.prototype),Rt(qr.prototype,"unsubscribe",[XK],Object.getOwnPropertyDescriptor(qr.prototype,"unsubscribe"),qr.prototype),Rt(qr.prototype,"muteRemote",[JK],Object.getOwnPropertyDescriptor(qr.prototype,"muteRemote"),qr.prototype),Rt(qr.prototype,"unmuteRemote",[QK],Object.getOwnPropertyDescriptor(qr.prototype,"unmuteRemote"),qr.prototype),Rt(qr.prototype,"hasRemoteMediaWithLock",[ZK],Object.getOwnPropertyDescriptor(qr.prototype,"hasRemoteMediaWithLock"),qr.prototype),Rt(qr.prototype,"disconnectForReconnect",[eq],Object.getOwnPropertyDescriptor(qr.prototype,"disconnectForReconnect"),qr.prototype),Rt(qr.prototype,"remoteMediaSsrcChanged",[tq],Object.getOwnPropertyDescriptor(qr.prototype,"remoteMediaSsrcChanged"),qr.prototype),qr);function sh(t){return function(r,s,a){const c=r[s];if(typeof c!="function")throw new Error("Cannot use mutex on object property.");return a.value=async function(){for(var d=arguments.length,h=new Array(d),m=0;m<d;m++)h[m]=arguments[m];switch(t){case ih.SEND_ONLY:{const g=await this.sendMutex.lock("From P2PChannel2.".concat(s));try{return await c.apply(this,h)}finally{g()}}case ih.RECEIVE_ONLY:{const g=await this.recvMutex.lock("From P2PChannel2.".concat(s));try{return await c.apply(this,h)}finally{g()}}default:{const g=await this.sendMutex.lock("From P2PChannel2.".concat(s)),v=await this.recvMutex.lock("From P2PChannel2.".concat(s));try{return await c.apply(this,h)}finally{g(),v()}}}},a}}class Cy extends Zr{constructor(r,s){super(),X(this,"signal",void 0),X(this,"token",void 0),X(this,"tokenTimeout",void 0),X(this,"tokenInterval",void 0),X(this,"_sequence",0),X(this,"userMap",new Map),X(this,"encoder",new TextEncoder),this.signal=r,this.token=s;const a=()=>{this.signal.connectionState===Or.CONNECTED&&this.check(),this.userMap.size===0?this.tokenInterval=window.setTimeout(a,1e3):this.tokenInterval=window.setTimeout(a,3*oe("P2P_TOKEN_INTERVAL"))};a()}async send(r,s,a,c,d){var h;if(this.userMap.size===0)return;const m=Array.from(Pc(h=this.userMap).call(h))[0].token;typeof s!="string"&&(s=JSON.stringify(s)),c=c??Tr(6,""),d=d??this._sequence++;const g={_id:c,_type:r,_seq:d,_message:s,token:"".concat(this.token,"_").concat(m)};oe("SHOW_P2P_LOG")&&M.debug("send message",g,"noNeedResponse : ".concat(a)),this.splitMessage(JSON.stringify(g)).forEach((w=>{this.signal.request(Qt.DATA_STREAM,{payload:Qm(this.encoder.encode(w))})}));const v=new mt(((w,I)=>{const A=window.setTimeout((()=>{this.off("res-@".concat(c,"_ack"),N),this.off("res-@".concat(c),B),this.off(v0.ABORT,H),M.debug("[external-signal] request timeout, type: ".concat(r,", requestId: ").concat(c)),this.userMap.size===0?I(new Le(te.INVALID_REMOTE_USER)):I(new Le(te.TIMEOUT))}),oe("EXTERNAL_SIGNAL_REQUEST_TIMEOUT")),N=()=>{A&&window.clearTimeout(A),this.off(v0.ABORT,H),a&&w()},H=()=>{A&&window.clearTimeout(A),this.off("res-@".concat(c,"_ack"),N),this.off("res-@".concat(c),B),I(new Le(te.EXTERNAL_SIGNAL_ABORT,"type: ".concat(r,", requestId: ").concat(c)))};this.once(v0.ABORT,H),this.once("res-@".concat(c,"_ack"),N);const B=(ee,Z)=>{z=!0,A&&window.clearTimeout(A),this.off("res-@".concat(c,"_ack"),N),this.off(v0.ABORT,H),ee==="success"?w(Z):I(new Le(te.P2P_MESSAGE_FAILED,"request ".concat(r," failed, requestId: ").concat(c)))};let z=!1;a||(this.once("res-@".concat(c),B),Is(oe("SIGNAL_REQUEST_TIMEOUT")).then((()=>{z||M.warning("external_signal request timeout, type: ".concat(r,", requestId: ").concat(c,", ").concat(g))})))}));try{return await v}catch(w){if(w.code===te.TIMEOUT)return await this.send(r,s,a,c,d);throw w}}onMessage(r){var s;const{_uid:a}=r;let c,d=this.userMap.get(a);if(d)c=d.splitMessageMap;else{if(this.userMap.size>0||!("_type"in r)||r._type!==bi.CHECK)return;const{token:v}=r;c=new Map,d={uid:a,isStart:!0,token:v,splitMessageMap:c,nextExpectedSequenceNumber:0,receivedMessagesMap:new Map},this.userMap.set(a,d),this.signal.emit(Nn.ON_USER_ONLINE,{uid:a}),this.handleUserOnline()}if("id"in r&&"total"in r){var h;const{id:v,total:w}=r,I=(h=c.get(v))!==null&&h!==void 0?h:[];if(I.push(r),c.has(v)||c.set(v,I),I.length!==w)return;{const A=q_(I).call(I,((N,H)=>N.index-H.index)).map((N=>N.payload)).join("");c.delete(v),(r=JSON.parse(A))._uid=a}}const{_type:m,token:g}=r;if(rt(s=[bi.ACK,bi.CHECK]).call(s,m))return m===bi.CHECK&&this.handleCheckToken(d,g),void this.receiveMessage(r);g==="".concat(d.token,"_").concat(this.token)?this.handleReceivedMessage(r):M.debug('Receive unexpected message", '.concat(g,", cur_token: ").concat(d.token,"_").concat(this.token),r)}check(){const r={_id:Tr(6,""),token:this.token,_type:bi.CHECK};oe("SHOW_P2P_LOG")&&M.debug("send message",r),this.signal.request(Qt.DATA_STREAM,{payload:Qm(this.encoder.encode(JSON.stringify(r)))})}ack(r){const s={_id:r,_type:bi.ACK,token:this.token};oe("SHOW_P2P_LOG")&&M.debug("send message",s),this.signal.request(Qt.DATA_STREAM,{payload:Qm(this.encoder.encode(JSON.stringify(s)))})}response(r,s,a){this.send(bi.RESPONSE,JSON.stringify({success:!a,message:s}),!0,r)}handleReceivedMessage(r){const s=()=>{this.userMap.forEach((v=>{const{receivedMessagesMap:w,nextExpectedSequenceNumber:I}=v;for(;w.has(I);){const A=w.get(I);w.delete(I),this.receiveMessage(A),v.nextExpectedSequenceNumber++}}))};if(!r)return void s();const{_uid:a,_seq:c}=r,d=this.userMap.get(a),{receivedMessagesMap:h,isStart:m,nextExpectedSequenceNumber:g}=d;if(c<g)return this.ack(r._id),void M.debug("[external-signal] receive old message, seq: ".concat(c,", ").concat(r._message));h.set(c,r),m&&c===g&&(this.receiveMessage(r),h.delete(g),d.nextExpectedSequenceNumber++,s())}receiveMessage(r){const{_id:s,_type:a,_message:c,_uid:d}=r;if(oe("SHOW_P2P_LOG")&&M.debug("receive message",r),s){let h;switch(r._type!==bi.ACK&&(c&&(h=JSON.parse(c)),this.ack(r._id)),r._type){case bi.CANDIDATE:case bi.CONTROL:this.signal.emit(a,h,d);break;case bi.PUBLISH:case bi.UNPUBLISH:case bi.RESTART_ICE:case bi.CALL:h.uid=d,zs(this.signal,a,h).then((m=>{this.response(r._id,m)})).catch((()=>{this.response(r._id,void 0,!0)}));break;case bi.ACK:this.getListeners("res-@".concat(s,"_ack")).length>0&&this.emit("res-@".concat(s,"_ack"));break;case bi.RESPONSE:{const{success:m,message:g}=h;this.emit("res-@".concat(s),m?"success":"failed",g);break}}}}splitMessage(r){if(r.length<Cy.MAX_MESSAGE_SIZE)return[r];const s=[],{remoteToken:a}=JSON.parse(r),c=Tr(6,"");let d=0,h=800;const m=Math.ceil(r.length/h);for(;r.length>0;){d++;const g={id:c,index:d,total:m,payload:r.slice(0,h),token:"".concat(this.token,"_").concat(a)};JSON.stringify(g).length>Cy.MAX_MESSAGE_SIZE?h-=50:(s.push(g),r=r.slice(h))}return s.map((g=>JSON.stringify(g)))}handleCheckToken(r,s){return r.token!==s?(M.debug("token changed, from ".concat(r.token," to ").concat(s)),this.reset(r.uid,s),!1):(this.tokenTimeout&&(window.clearTimeout(this.tokenTimeout),this.tokenTimeout=void 0),this.tokenTimeout=window.setTimeout((()=>{M.debug("token timeout, ".concat(s)),this.reset(r.uid)}),oe("MAX_P2P_TIMEOUT")),!0)}async handleUserOnline(){const r=await zs(this.signal,bi.CALL,void 0),s=await this.send(bi.CALL,r);this.signal.emit(tn.P2P_CONNECTION,s,!0)}async reset(r,s){const a=this.userMap.get(r);a&&(this.emit(v0.ABORT),this.signal.emit(Nn.ON_USER_OFFLINE,{uid:a.uid,reason:o_e.P2P_TOKEN_CHANGED}),this._sequence=0,this.userMap.clear(),s||(M.debug("change local token from ".concat(s," to ").concat(s)),this.token=Tr(6,"")))}clear(){this._sequence=0,this.userMap.clear(),this.tokenInterval&&window.clearTimeout(this.tokenInterval),this.tokenInterval=void 0,this.tokenTimeout&&window.clearTimeout(this.tokenTimeout),this.tokenTimeout=void 0,this.emit(v0.ABORT)}}X(Cy,"MAX_SIZE",1),X(Cy,"MAX_MESSAGE_SIZE",1024);class BEe extends Zr{get connectionState(){return this._connectionState}set connectionState(r){r!==this._connectionState&&(this._connectionState=r,r===Or.CONNECTED?this.emit(tn.WS_CONNECTED):r===Or.RECONNECTING?this.emit(tn.WS_RECONNECTING,this._websocketReconnectReason):r===Or.CLOSED&&this.emit(tn.WS_CLOSED,this._disconnectedReason))}get currentURLIndex(){return this.websocket.currentURLIndex}get url(){return this.websocket&&this.websocket.url||null}get rtt(){return this.rttRolling.mean()}constructor(r,s){super(),X(this,"_disconnectedReason",void 0),X(this,"_websocketReconnectReason",void 0),X(this,"_connectionState",Or.CLOSED),X(this,"reconnectToken",void 0),X(this,"p2pToken",void 0),X(this,"websocket",void 0),X(this,"openConnectionTime",void 0),X(this,"clientId",void 0),X(this,"lastMsgTime",Date.now()),X(this,"uploadCache",[]),X(this,"uploadCacheInterval",void 0),X(this,"rttRolling",new k9(5)),X(this,"pingpongTimer",void 0),X(this,"pingpongTimeoutCount",0),X(this,"joinResponse",void 0),X(this,"multiIpOption",void 0),X(this,"initError",void 0),X(this,"spec",void 0),X(this,"store",void 0),X(this,"_external_signal",void 0),X(this,"onWebsocketMessage",(a=>{if(a.data instanceof ArrayBuffer)return void this.emit(tn.ON_BINARY_DATA,a.data);const c=JSON.parse(a.data);if(this.lastMsgTime=Date.now(),Object.prototype.hasOwnProperty.call(c,"_id")){const d="res-@".concat(c._id);this.emit(d,c._result,c._message)}else if(Object.prototype.hasOwnProperty.call(c,"_type")){switch(c._type){case Nn.ON_DATA_STREAM:return void this.handleDataStream(c._message);case Nn.MUTE_AUDIO:case Nn.MUTE_VIDEO:case Nn.ON_P2P_LOST:case Nn.ON_USER_ONLINE:return;case Nn.ON_USER_OFFLINE:const{uid:d}=c._message;return M.debug("[".concat(this.clientId,"] user-offline uid: ").concat(d)),void this._external_signal.reset(d)}if(this.emit(c._type,c._message),c._type===Nn.ON_NOTIFICATION&&this.handleNotification(c._message),c._type===Nn.ON_USER_BANNED)switch(c._message.error_code){case 14:this.close(or.UID_BANNED);break;case 15:this.close(or.IP_BANNED);break;case 16:this.close(or.CHANNEL_BANNED)}if(c._type===Nn.ON_USER_LICENSE_BANNED)switch(c._message.error_code){case Bt.ERR_LICENSE_MISSING:this.close(or.LICENSE_MISSING);break;case Bt.ERR_LICENSE_EXPIRED:this.close(or.LICENSE_EXPIRED);break;case Bt.ERR_LICENSE_MINUTES_EXCEEDED:this.close(or.LICENSE_MINUTES_EXCEEDED);break;case Bt.ERR_LICENSE_PERIOD_INVALID:this.close(or.LICENSE_PERIOD_INVALID);break;case Bt.ERR_LICENSE_MULTIPLE_SDK_SERVICE:this.close(or.LICENSE_MULTIPLE_SDK_SERVICE);break;case Bt.ERR_LICENSE_ILLEGAL:this.close(or.LICENSE_ILLEGAL);break;default:this.close()}}})),this.clientId=r.clientId,this.spec=r,this.store=s,this.websocket=new $2("gateway-".concat(this.clientId),this.spec.retryConfig,!0,oe("JOIN_GATEWAY_USE_DUAL_DOMAIN"),oe("JOIN_GATEWAY_USE_443PORT_ONLY"),s),this.handleWebsocketEvents(),window.addEventListener("offline",(()=>{this.connectionState===Or.CONNECTED&&this.reconnect("retry",Bs.OFFLINE)})),this.p2pToken=Tr(6,""),this._external_signal=new Cy(this,this.p2pToken)}async request(r,s,a,c){const d=Tr(6,""),h={_id:d,_type:r,_message:s},m=this.websocket.connectionID,g=()=>new mt(((H,B)=>{if(this.connectionState===Or.CONNECTED)return H();const z=()=>{this.off(tn.WS_CLOSED,ee),H()},ee=()=>{this.off(tn.WS_CONNECTED,z),B(new Le(te.WS_ABORT))};this.once(tn.WS_CONNECTED,z),this.once(tn.WS_CLOSED,ee)}));if(this.connectionState!==Or.CONNECTING&&this.connectionState!==Or.RECONNECTING||r===Qt.JOIN||r===Qt.REJOIN||await g(),this.websocket.sendMessage(h,!0),c)return;const v=new mt(((H,B)=>{let z=!1;const ee=(ae,ye)=>{z=!0,H({isSuccess:ae==="success",message:ye||{}}),this.off(tn.WS_CLOSED,Z),this.off(tn.WS_RECONNECTING,Z),this.emit(tn.REQUEST_SUCCESS,r,s)};this.once("res-@".concat(d),ee);const Z=()=>{B(new Le(te.WS_ABORT,"type: ".concat(r))),this.off(tn.WS_CLOSED,Z),this.off(tn.WS_RECONNECTING,Z),this.off("res-@".concat(d),ee)};this.once(tn.WS_CLOSED,Z),this.once(tn.WS_RECONNECTING,Z),Is(oe("SIGNAL_REQUEST_TIMEOUT")).then((()=>{this.websocket.connectionID!==m||z||(M.warning("[".concat(this.clientId,"] ws request timeout, type: ").concat(r)),this.emit(tn.REQUEST_TIMEOUT,r,s))}))}));let w=null;try{w=await v}catch(H){if(this.connectionState===Or.CLOSED||r===Qt.LEAVE)throw new Le(te.WS_ABORT);return!this.spec.forceWaitGatewayResponse||a?H.throw():r===Qt.JOIN||r===Qt.REJOIN?null:(await g(),await this.request(r,s))}if(w.isSuccess)return w.message;const I=Number(w.message.error_code||w.message.code),A=ST(I),N=new Le(te.UNEXPECTED_RESPONSE,"".concat(A.desc,": ").concat(w.message.error_str),{code:I,data:w.message,desc:A.desc});return A.action==="success"?w.message:(M.warning("[".concat(this.clientId,"] [").concat(this.websocket.connectionID,"] unexpected response from type ").concat(r,", error_code: ").concat(I,", message: ").concat(A.desc,", action: ").concat(A.action)),I===Bt.ERR_TOO_MANY_BROADCASTERS?((r===Qt.JOIN||r===Qt.REJOIN)&&(this.initError=N,this.close()),N.throw()):A.action==="failed"?N.throw():A.action==="quit"?(this.initError=N,this.close(),N.throw()):(I===Bt.ERR_JOIN_BY_MULTI_IP?(this.multiIpOption=w.message.option,M.warning("[".concat(this.clientId,"] detect multi ip, recover")),this.reconnect("recover",Bs.MULTI_IP)):this.reconnect(A.action,Bs.SERVER_ERROR),r===Qt.JOIN||r===Qt.REJOIN?null:await this.request(r,s)))}waitMessage(r,s){return new mt((a=>{const c=d=>{(!s||s(d))&&(this.off(r,c),a(d))};this.on(r,c)}))}uploadWRTCStats(r){if(!this.store.sessionId)return void M.warn("[".concat(this.clientId,"] no session id when upload wrtc stats"));const s={lts:Date.now(),sid:this.store.sessionId,uid:this.store.intUid,stats:r};this.upload(ET.WRTC_STATS,s)}upload(r,s){const a={_type:r,_message:s};try{this.websocket.sendMessage(a)}catch{const d=oe("MAX_UPLOAD_CACHE")||50;this.uploadCache.push(a),this.uploadCache.length>d&&this.uploadCache.splice(0,1),this.uploadCache.length>0&&!this.uploadCacheInterval&&(this.uploadCacheInterval=window.setInterval((()=>{if(this.connectionState!==Or.CONNECTED)return;const h=this.uploadCache.splice(0,1)[0];this.uploadCache.length===0&&(window.clearInterval(this.uploadCacheInterval),this.uploadCacheInterval=void 0),this.upload(h._type,h._message)}),oe("UPLOAD_CACHE_INTERVAL")||2e3))}}send(r,s){const a={_type:r,_message:s};this.websocket.sendMessage(a)}async sendExtensionMessage(r,s,a){return await this._external_signal.send(r,s,a)}init(r){return this.initError=void 0,this.multiIpOption=void 0,this.joinResponse=void 0,this.reconnectToken=void 0,this.openConnectionTime=void 0,new mt(((s,a)=>{this.once(tn.WS_CONNECTED,(()=>s(this.joinResponse))),this.once(tn.WS_CLOSED,(()=>a(this.initError||new Le(te.WS_ABORT)))),this.connectionState=Or.CONNECTING,this.websocket.init(r).catch(a)}))}close(r){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.reconnectToken=void 0,this.joinResponse=void 0,this._external_signal.clear(),this._disconnectedReason=r||or.LEAVE,this.connectionState=Or.CLOSED,M.debug("[".concat(this.clientId,"] ")+"will close websocket in signal"),this.websocket.close(),this.p2pToken=Tr(6,""),this._external_signal.clear(),this._external_signal=new Cy(this,this.p2pToken)}async join(){if(!this.joinResponse){this.emit(tn.ABORT_P2P_EXECUTION);const r=await zs(this,tn.REQUEST_JOIN_INFO),s=await this.request(Qt.JOIN,r);if(!s)return this.emit(tn.REPORT_JOIN_GATEWAY,te.TIMEOUT,this.url||""),!1;this.joinResponse=s,this.emit(tn.JOIN_RESPONSE,this.joinResponse),this.reconnectToken=this.joinResponse.rejoin_token}return this.connectionState=Or.CONNECTED,this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(this.handlePingPong.bind(this),3e3),!0}reconnect(r,s){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.websocket.reconnect(r,s)}async downgradeCodec(r){return!1}handleDataStream(r){try{var s;const a=iy(r.payload),c=new TextDecoder().decode(a),d=JSON.parse(c);"total"in d&&"id"in d||rt(s=Object.values(bi)).call(s,d._type)?(d._uid=r.uid,this._external_signal.onMessage(d)):this.emit(Nn.ON_DATA_STREAM,r)}catch{this.emit(Nn.ON_DATA_STREAM,r)}}handleNotification(r){M.debug("[".concat(this.clientId,"] receive notification: "),r);const s=ST(r.code);if(s.action!=="success"){if(s.action!=="failed")return s.action==="quit"?(s.desc==="ERR_REPEAT_JOIN_CHANNEL"&&this.close(or.UID_BANNED),void this.close()):void this.reconnect(s.action,Bs.SERVER_ERROR);M.error("[".concat(this.clientId,"] ignore error: "),s.desc)}}handlePingPong(){if(!this.websocket||this.websocket.state!=="connected")return;this.pingpongTimeoutCount>0&&this.rttRolling.add(3e3),this.pingpongTimeoutCount+=1;const r=oe("PING_PONG_TIME_OUT"),s=Date.now();this.pingpongTimeoutCount>=r&&(M.warning("[".concat(this.clientId,"] PINGPONG Timeout. Last Socket Message: ").concat(s-this.lastMsgTime,"ms")),s-this.lastMsgTime>oe("WEBSOCKET_TIMEOUT_MIN"))?this.reconnect("retry",Bs.TIMEOUT):this.request(Qt.PING,void 0,!0).then((()=>{this.pingpongTimeoutCount=0;const a=Date.now()-s;this.rttRolling.add(a),oe("REPORT_STATS")&&this.send(Qt.PING_BACK,{pingpongElapse:a})})).catch((a=>{}))}handleWebsocketEvents(){this.websocket.on(pn.RECONNECT_CREATE_CONNECTION,(r=>{this.emit(tn.WS_RECONNECT_CREATE_CONNECTION,r)})),this.websocket.on(pn.ON_MESSAGE,this.onWebsocketMessage),this.websocket.on(pn.CLOSED,(()=>{this.connectionState=Or.CLOSED})),this.websocket.on(pn.FAILED,(()=>{this._disconnectedReason=or.NETWORK_ERROR,this.connectionState=Or.CLOSED})),this.websocket.on(pn.RECONNECTING,(r=>{this._websocketReconnectReason=r,this.joinResponse=void 0,this.connectionState===Or.CONNECTED?this.connectionState=Or.RECONNECTING:this.connectionState=Or.CONNECTING})),this.websocket.on(pn.WILL_RECONNECT,((r,s,a)=>{r!=="retry"?(M.debug("".concat(this.clientId," websocket will_connect event, renewSession reconnectMode is ").concat(r)),this.reconnectToken=void 0):M.debug("".concat(this.clientId," reconnect mode is retry, no need to renew session")),a(r)})),this.websocket.on(pn.CONNECTED,(()=>{this.openConnectionTime=Date.now(),this.join().catch((r=>{if(this.emit(tn.REPORT_JOIN_GATEWAY,r,this.url||""),r instanceof Le&&r.code===te.UNEXPECTED_RESPONSE&&r.data.code===Bt.ERR_NO_AUTHORIZED)return M.warning("[".concat(this.clientId,"] reconnect no authorized, recover")),void this.reconnect("recover",Bs.SERVER_ERROR);M.error("[".concat(this.clientId,"] join gateway request failed"),r.toString()),this.spec.forceWaitGatewayResponse?this.reconnect("tryNext",Bs.SERVER_ERROR):(this.initError=r,this.close())}))})),this.websocket.on(pn.REQUEST_NEW_URLS,((r,s)=>{zs(this,tn.REQUEST_RECOVER,this.multiIpOption).then(r).catch(s)})),this.websocket.on(pn.ON_TOKEN_PRIVILEGE_DID_EXPIRE,(()=>{this.emit(Nn.ON_TOKEN_PRIVILEGE_DID_EXPIRE)}))}}const zEe={name:"P2PChannel",create:function(t){let{store:r,statsCollector:s}=t;return new FEe(r,s)},createSubmodule:function(t){let{store:r,spec:s}=t;return new BEe(s,r)}};function rq(t,r){var s=Object.keys(t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);r&&(a=a.filter((function(c){return Object.getOwnPropertyDescriptor(t,c).enumerable}))),s.push.apply(s,a)}return s}function iq(t){for(var r=1;r<arguments.length;r++){var s=arguments[r]!=null?arguments[r]:{};r%2?rq(Object(s),!0).forEach((function(a){X(t,a,s[a])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(s)):rq(Object(s)).forEach((function(a){Object.defineProperty(t,a,Object.getOwnPropertyDescriptor(s,a))}))}return t}class WEe{constructor(r){X(this,"sessionDesc",void 0),X(this,"localCapabilities",void 0),X(this,"rtpCapabilities",void 0),X(this,"candidates",void 0),X(this,"_originCandidates",void 0),X(this,"iceParameters",void 0),X(this,"dtlsParameters",void 0),X(this,"setup",void 0),X(this,"currentMidIndex",void 0),X(this,"cname",void 0),r=Kr(r);const{iceParameters:s,dtlsParameters:a,candidates:c,rtpCapabilities:d,setup:h,localCapabilities:m,sdkCodec:g,cname:v}=r,w=nc(`v=0
o=- 0 0 IN IP4 127.0.0.1
s=AgoraGateway
t=0 0
a=group:BUNDLE audio video
a=msid-semantic: WMS
a=ice-lite
m=audio 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendrecv
a=rtcp-mux
a=rtcp-rsize
a=mid:audio
m=video 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendrecv
a=rtcp-mux
a=rtcp-rsize
a=mid:video
`);this.rtpCapabilities=d,this.candidates=c,this._originCandidates=Kr(c),this.iceParameters=s,this.dtlsParameters=a,this.setup=h,this.localCapabilities=m,this.cname=v;for(let I=0;I<w.mediaDescriptions.length;I++){const A=w.mediaDescriptions[I];if(A.attributes.iceUfrag=s.iceUfrag,A.attributes.icePwd=s.icePwd,A.attributes.fingerprints=a.fingerprints,A.attributes.candidates=c,A.attributes.setup=h,A.media.mediaType==="video"){A.media.fmts=d.videoCodecs.map((B=>B.payloadType.toString(10)));const N=d.videoCodecs.filter((B=>{var z,ee;return(z=B.rtpMap)===null||z===void 0?void 0:rt(ee=z.encodingName.toLowerCase()).call(ee,g)})),H=d.videoCodecs.filter((B=>!rt(N).call(N,B)));A.attributes.payloads=[...N,...H],A.attributes.extmaps=d.videoExtensions}A.media.mediaType==="audio"&&(A.media.fmts=d.audioCodecs.map((N=>N.payloadType.toString(10))),A.attributes.payloads=d.audioCodecs,A.attributes.extmaps=d.audioExtensions),w.mediaDescriptions[I]=this.mungMediaDesc(A)}this.sessionDesc=w,this.currentMidIndex=w.mediaDescriptions.length-1}toString(){return Zm(this.sessionDesc)}send(r,s,a){const{ssrcs:c,ssrcGroups:d}=CT(s,this.cname),h=this.sessionDesc.mediaDescriptions.find((v=>r===St.VIDEO?v.media.mediaType==="video":v.media.mediaType==="audio")),m=c[0].attributes.label,g=c[0].attributes.mslabel;return h.attributes.ssrcs=h.attributes.ssrcs.concat(c),h.attributes.ssrcGroups=h.attributes.ssrcGroups.concat(d),{id:m,mslabel:g}}batchSend(r){return r.map((s=>{let{kind:a,ssrcMsg:c}=s;return this.send(a,c,void 0)}))}stopSending(r){this.sessionDesc.mediaDescriptions.forEach((s=>{const a=[],c=[],d=[];s.attributes.ssrcs.forEach((h=>{rt(r).call(r,h.attributes.label||"")?d.push(h):a.push(h)})),s.attributes.ssrcGroups.forEach((h=>{var m;rt(m=d.map((g=>g.ssrcId))).call(m,h.ssrcIds[0])||c.push(h)})),s.attributes.ssrcs=a,s.attributes.ssrcGroups=c}))}mute(r){const s=this.sessionDesc.mediaDescriptions.find((a=>a.attributes.mid===r));if(!s)throw new Error("mediaDescription not found with ".concat(r," in remote SDP when calling RemoteSDP.mute."));s.attributes.direction="inactive"}unmute(r){const s=this.sessionDesc.mediaDescriptions.find((a=>a.attributes.mid===r));if(!s)throw new Error("mediaDescription not found with ".concat(r," in remote SDP when calling RemoteSDP.unmute."));s.attributes.direction="sendonly"}receive(r,s,a){r.forEach(((c,d)=>{const h=c._mediaStreamTrack,m=this.sessionDesc.mediaDescriptions.findIndex((v=>v.attributes.mid===h.kind)),g=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[m],c);this.sessionDesc.mediaDescriptions[m]=g}))}stopReceiving(r){}updateCandidates(r){const s=this._originCandidates.filter((c=>c.transport==="udp")),a=[];if(s.forEach((c=>{a.push(iq(iq({},c),{},{foundation:"tcpcandidate",priority:Number(c.priority)-1+"",transport:"tcp",port:Number(c.port)+90+""}))})),s.length!==0){switch(r){case co.TCP_RELAY:this.candidates=a;break;case co.UDP_TCP_RELAY:case co.RELAY:this.candidates=[...s,...a];break;default:this.candidates=s}for(const c of this.sessionDesc.mediaDescriptions)c.attributes.candidates=this.candidates}}restartICE(r){r=Kr(r),this.iceParameters=r,this.sessionDesc.mediaDescriptions.forEach((s=>{s.attributes.iceUfrag=r.iceUfrag,s.attributes.icePwd=r.icePwd}))}predictReceivingMids(r){const s=[];for(let a=0;a<r;a++)s.push((this.currentMidIndex+a+1).toString(10));return s}mungRecvMediaDsec(r,s){const a=Kr(r);return w0(a,s),X2(a,s),a}updateRecvMedia(r,s){const a=this.sessionDesc.mediaDescriptions.findIndex((c=>c.attributes.mid===r));if(a!==-1){const c=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[a],s);this.sessionDesc.mediaDescriptions[a]=c}}bumpMid(r){this.currentMidIndex+=r}updateTrackLabel(r,s,a){const c=this.sessionDesc.mediaDescriptions.find((h=>r===St.VIDEO?h.attributes.mid==="video":h.attributes.mid==="audio"));if(c){const h=c.attributes.ssrcs.find((m=>m.attributes.label===s));var d;h&&(h.attributes.label=a,(d=h.attributes.msid)===null||d===void 0||d.replace(s,a))}}mungMediaDesc(r){const s=Kr(r);return Y2(s),(function(a){const c=a.attributes.extmaps.find((d=>sP(d.extensionName)));c&&a.attributes.extmaps.splice(a.attributes.extmaps.indexOf(c),1),a.attributes.payloads.forEach((d=>{const h=d.rtcpFeedbacks.findIndex((m=>m.type==="transport-cc"));h!==-1&&d.rtcpFeedbacks.splice(h,1)}))})(s),s}getSSRC(r){for(const s of this.sessionDesc.mediaDescriptions)for(const a of s.attributes.ssrcs)if(a.attributes.label===r)return[a]}}var Cr;function sq(t,r){var s=Object.keys(t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);r&&(a=a.filter((function(c){return Object.getOwnPropertyDescriptor(t,c).enumerable}))),s.push.apply(s,a)}return s}function HP(t){for(var r=1;r<arguments.length;r++){var s=arguments[r]!=null?arguments[r]:{};r%2?sq(Object(s),!0).forEach((function(a){X(t,a,s[a])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(s)):sq(Object(s)).forEach((function(a){Object.defineProperty(t,a,Object.getOwnPropertyDescriptor(s,a))}))}return t}let GEe=(Cr=class LC extends y7{get peerConnectionState(){return this.peerConnection.connectionState}get iceConnectionState(){return this.peerConnection.iceConnectionState}get currentLocalDescription(){return this.peerConnection.currentLocalDescription}get currentRemoteDescription(){return this.peerConnection.currentRemoteDescription}get localCodecs(){return[...new Set(this.localCapabilities&&this.localCapabilities.videoCodecs.map((r=>r.rtpMap&&r.rtpMap.encodingName.toLowerCase()||"")).filter((r=>{var s;return rt(s=Object.keys(fT)).call(s,r)})))]}constructor(r,s){super(r,s),X(this,"store",void 0),X(this,"peerConnection",void 0),X(this,"remoteSDP",void 0),X(this,"initialOffer",void 0),X(this,"statsFilter",void 0),X(this,"useRTX",!1),X(this,"localCapabilities",void 0),X(this,"localCandidateCount",0),X(this,"allCandidatesReceived",!1),X(this,"establishPromise",void 0),X(this,"mutex",void 0),this.store=s,this.mutex=new so("P2PConnection-mutex",s.clientId),this.peerConnection=new RTCPeerConnection(LC.resolvePCConfiguration(r),{optional:[{googDscp:!0}]}),this.statsFilter=i2(this.peerConnection,oe("STATS_UPDATE_INTERVAL"),void 0,ii()?1200:void 0),this.bindPCEvents(),this.bindStatsEvents(),this.store.p2pId=this.store.p2pId+1,this.establishPromise=this.establish()}async establish(){try{const r=await this.peerConnection.createOffer({offerToReceiveAudio:!0,offerToReceiveVideo:!0});if(!r.sdp)throw new Error("Cannot get initialOffer.sdp when trying to establish PeerConnection.");const s=sg(r.sdp),a=TT(r.sdp,{filterRTX:!this.useRTX,filterVideoFec:oe("FILTER_VIDEO_FEC"),filterAudioFec:oe("FILTER_AUDIO_FEC"),filterAudioCodec:["opus"]});return this.localCapabilities=a,this.initialOffer=r,HP(HP({},s),{},{rtpCapabilities:{send:{audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},recv:{audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},sendrecv:a},offerSDP:r.sdp})}catch(r){throw new Le(te.GET_LOCAL_CONNECTION_PARAMS_FAILED,r.toString())}}async updateRemoteConnect(){}async connect(r){try{if(!this.initialOffer)throw new Error("Cannot establish P2PConnection without initial offer.");this.remoteSDP=new WEe(HP(HP({},r),{},{rtpCapabilities:r.rtpCapabilities.send,localCapabilities:this.localCapabilities,sdkCodec:this.store.codec}));const s=this.remoteSDP.toString();await this.peerConnection.setLocalDescription(this.initialOffer),await this.peerConnection.setRemoteDescription({type:"answer",sdp:s})}catch(s){throw new Le(te.EXCHANGE_SDP_FAILED,"P2PConnection.connect failed; ".concat(s.toString()))}}async updateRemoteRTPCapabilities(r,s){throw new Le(te.NOT_SUPPORTED,"Planb mode does not support createDataChannels.")}getPreMedia(r){}send(r,s){var a=this;return Ql((function*(){const c=yield zn(a.mutex.lock());try{if(!a.remoteSDP)throw new Error("Cannot call P2PConnection.send before remote SDP created");const d=r.map((A=>a.peerConnection.addTrack(A._mediaStreamTrack))),h=yield zn(a.peerConnection.createOffer()),m=nc(h.sdp),g=r.map((A=>{const N=A._mediaStreamTrack,H=m.mediaDescriptions.find((B=>B.attributes.mid===N.kind));if(!H)throw new Error("Cannot extract ssrc from mediaDescription.");return(function(B,z,ee){const Z=B.attributes.ssrcs.filter((ye=>ye.attributes.label===z)),ae=B.attributes.ssrcGroups;if(Z.length===0)throw new Error("Cannot extract ssrc from plan-b SDP.");if(ae&&Z.length>1){const ye=ae.find((_e=>_e.ssrcIds.indexOf(Z[0].ssrcId)!==-1));return ye?[{ssrcId:ye.ssrcIds[0],rtx:ee?ye.ssrcIds[1]:void 0}]:[{ssrcId:Z[0].ssrcId}]}return[{ssrcId:Z[0].ssrcId}]})(H,N.id,a.useRTX)}));let v;try{v=yield g}catch(A){throw d.forEach((N=>{Fs()&&N.replaceTrack(null),a.peerConnection.removeTrack(N)})),A}const w=a.mungSendOfferSDP(h.sdp,r);a.remoteSDP.receive(r,s,v);const I=a.remoteSDP.toString();return yield zn(a.peerConnection.setLocalDescription({type:"offer",sdp:w})),yield zn(a.applySendEncodings(d,r)),yield zn(a.peerConnection.setRemoteDescription({type:"answer",sdp:I})),r.map(((A,N)=>{const H=A._mediaStreamTrack.id;return{localSSRC:g[N],id:H}}))}catch(d){throw new Le(te.EXCHANGE_SDP_FAILED,"P2PConnection.send failed; ".concat(d.toString()))}finally{c()}}))()}async stopSending(r){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopSending before remote SDP created");const s=this.peerConnection.getSenders().filter((d=>{var h;return r.indexOf(((h=d.track)===null||h===void 0?void 0:h.id)||"")!==-1}));if(s.length!==r.length)throw new Error("Transceivers' length doesn't match mids' length when trying to call P2PConnection.stopSending.");s.map((d=>{Fs()&&d.replaceTrack(null),this.peerConnection.removeTrack(d)}));const a=await this.peerConnection.createOffer();await this.peerConnection.setLocalDescription(a),this.remoteSDP.stopReceiving(r);const c=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"answer",sdp:c})}catch(s){throw new Le(te.EXCHANGE_SDP_FAILED,"P2PConnection.stopSending failed; ".concat(s.toString()))}}async receive(r,s,a,c){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.receive ".concat(r," before remoteSDP created."));const{id:d,mslabel:h}=this.remoteSDP.send(r,s,c),m=new mt(((w,I)=>{const A=setTimeout((()=>{I(new Error("Cannot receive track, id: ".concat(d)))}),1e4),N=H=>{const B=Mn();if((B.name==="Safari"&&Number(B.version)===11||To())&&H.track.id!==d&&H.streams[0].id===h){var z;const ee=H.streams[0].getTracks()[0];return(z=this.remoteSDP)===null||z===void 0||z.updateTrackLabel(r,d,H.track.id),this.peerConnection.removeEventListener("track",N),clearTimeout(A),void w(ee)}if(H.track.id===d)return this.peerConnection.removeEventListener("track",N),clearTimeout(A),void w(H.track)};this.peerConnection.addEventListener("track",N)})),g=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:g});const v=await this.peerConnection.createAnswer();return await this.peerConnection.setLocalDescription(v),{track:await m,id:d}}catch(d){throw new Le(te.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(d.toString()))}}async stopReceiving(r){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopReceiving before remote SDP created.");this.remoteSDP.stopSending(r);const s=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:s});const a=await this.peerConnection.createAnswer();await this.peerConnection.setLocalDescription(a)}catch(s){throw new Le(te.EXCHANGE_SDP_FAILED,"P2PConnection stopReceiving failed; ".concat(s.toString()))}}async muteRemote(r){}async unmuteRemote(r){}async muteLocal(r){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.muteLocal before remote SDP created.");const s=this.peerConnection.getSenders().filter((a=>{var c;return r.indexOf(((c=a.track)===null||c===void 0?void 0:c.id)||"")!==-1}));if(s.length!==r.length)throw new Error("sender' length doesn't match mids' length.");s.map((a=>{if(Fs()&&a.track)a.track.enabled=!1;else{const c=a.getParameters();c.encodings.forEach((d=>d.active=!1)),a.setParameters(c)}}))}catch(s){throw new Le(te.EXCHANGE_SDP_FAILED,"P2PConnection.muteLocal failed; ".concat(s.toString()))}}async unmuteLocal(r){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.unmuteLocal before remote SDP created.");const s=this.peerConnection.getSenders().filter((d=>{var h;return r.indexOf(((h=d.track)===null||h===void 0?void 0:h.id)||"")!==-1}));if(s.length!==r.length)throw new Error("Senders' length doesn't match mids' length.");s.map((async d=>{if(Fs()&&d.track)d.track.enabled=!0;else{const h=d.getParameters();h.encodings.forEach((m=>m.active=!0)),await d.setParameters(h)}}));const a=await this.peerConnection.createOffer();await this.peerConnection.setLocalDescription(a);const c=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"answer",sdp:c})}catch(s){throw new Le(te.EXCHANGE_SDP_FAILED,"P2PConnection.unmuteLocal failed; ".concat(s.toString()))}}restartICE(r){var s=this;return Ql((function*(){const a=yield zn(s.mutex.lock("From P2PConnection.restartICE"));try{if(!s.remoteSDP)throw new Error("Cannot restartICE before remoteSDP created.");const c=Wn().supportPCSetConfiguration;if(r===co.RELAY&&!c)return;if(c){const v=s.peerConnection.getConfiguration(),w=r===co.RELAY?"relay":"all";v.iceTransportPolicy!==w&&(M.debug("[".concat(s.store.clientId,"] restartICE change iceTransportPolicy from [").concat(v.iceTransportPolicy,"] to [").concat(w,"]")),v.iceTransportPolicy=w,s.peerConnection.setConfiguration(v))}r!==co.RELAY&&s.remoteSDP.updateCandidates(r);const d=yield zn(s.peerConnection.createOffer({iceRestart:!0}));if(!d.sdp)throw new Error("Cannot restartICE because restart offer SDP does not exist.");const h=sg(d.sdp),{remoteIceParameters:m}=yield h.iceParameters;s.remoteSDP.restartICE(m);const g=s.remoteSDP.toString();yield zn(s.peerConnection.setLocalDescription(d)),yield zn(s.peerConnection.setRemoteDescription({type:"answer",sdp:g}))}catch(c){M.warning("[".concat(s.store.clientId,"] restart ICE failed, abort operation"),c)}finally{a()}}))()}close(){var r;this.peerConnection.close(),(r=this.onConnectionStateChange)===null||r===void 0||r.call(this,"closed"),this.unbindPCEvents(),this.unbindStatsEvents(),this.removeAllListeners(),this.statsFilter.destroy()}getStats(){return this.statsFilter.getStats()}getRemoteVideoIsReady(r){return this.statsFilter.getVideoIsReady(r)}async updateEncoderConfig(r,s){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.updateEncoderConfig before remote SDP created.");const a=await this.peerConnection.createOffer(),c=this.mungSendOfferSDP(a.sdp,[s]);this.remoteSDP.updateRecvMedia(s._mediaStreamTrack.kind,s);const d=this.remoteSDP.toString();await this.peerConnection.setLocalDescription({type:"offer",sdp:c}),await this.peerConnection.setRemoteDescription({type:"answer",sdp:d})}catch(a){throw new Le(te.EXCHANGE_SDP_FAILED,a.toString())}}async updateSendParameters(r,s){const a=this.peerConnection.getSenders().filter((c=>{var d;return((d=c.track)===null||d===void 0?void 0:d.id)===r}));a.length===1&&await this.applySendEncodings(a,[s])}setStatsRemoteVideoIsReady(r,s){this.statsFilter.setVideoIsReady2(r,s)}async replaceTrack(r,s){const a=this.peerConnection.getSenders().find((c=>{var d;return((d=c.track)===null||d===void 0?void 0:d.id)===s}));a&&await a.replaceTrack(r._mediaStreamTrack)}createDataChannels(r,s){throw new Le(te.NOT_SUPPORTED,"Planb mode does not support createDataChannels.")}stopDataChannels(r){throw new Le(te.NOT_SUPPORTED,"Planb mode does not support stopDataChannels.")}bindPCEvents(){this.peerConnection.oniceconnectionstatechange=()=>{var r;(r=this.onICEConnectionStateChange)===null||r===void 0||r.call(this,this.peerConnection.iceConnectionState)},this.peerConnection.onconnectionstatechange=()=>{var r;(r=this.onConnectionStateChange)===null||r===void 0||r.call(this,this.peerConnection.connectionState)},this.peerConnection.onicecandidate=r=>{r.candidate?this.localCandidateCount+=1:(this.peerConnection.onicecandidate=null,this.allCandidatesReceived=!0,M.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] local candidate count"),this.localCandidateCount))},setTimeout((()=>{this.allCandidatesReceived||(this.allCandidatesReceived=!0,M.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] onicecandidate timeout, local candidate count"),this.localCandidateCount))}),oe("CANDIDATE_TIMEOUT"))}unbindPCEvents(){this.peerConnection.oniceconnectionstatechange=null,this.peerConnection.onconnectionstatechange=null,this.peerConnection.onsignalingstatechange=null,this.peerConnection.onicecandidateerror=null,this.peerConnection.onicecandidate=null,this.peerConnection.ontrack=null}static resolvePCConfiguration(r){const s={iceServers:[],sdpSemantics:"plan-b"};return r.iceServers?s.iceServers=r.iceServers:r.turnServer&&r.turnServer.mode!=="off"&&(lT(r.turnServer.servers)?s.iceServers=r.turnServer.servers:(s.iceServers&&s.iceServers.push(...LC.turnServerConfigToIceServers(r.turnServer.servers)),oe("USE_TURN_SERVER_OF_GATEWAY")&&s.iceServers&&r.turnServer.serversFromGateway&&s.iceServers.push(...LC.turnServerConfigToIceServers(r.turnServer.serversFromGateway)),r.turnServer.servers.concat(r.turnServer.serversFromGateway||[]).forEach((a=>{a.forceturn&&(s.iceTransportPolicy="relay")})))),s}static turnServerConfigToIceServers(r){const s=[];return r.forEach((a=>{a.security?a.tcpport&&s.push({username:a.username,credential:a.password,credentialType:"password",urls:"turns:".concat(a.turnServerURL,":").concat(a.tcpport,"?transport=tcp")}):(a.udpport&&s.push({username:a.username,credential:a.password,credentialType:"password",urls:"turn:".concat(a.turnServerURL,":").concat(a.udpport,"?transport=udp")}),a.tcpport&&s.push({username:a.username,credential:a.password,credentialType:"password",urls:"turn:".concat(a.turnServerURL,":").concat(a.tcpport,"?transport=tcp")}))})),s}async updateRtpSenderEncodings(r,s){var a;if(s||(s=this.peerConnection.getSenders().find((v=>{var w;return((w=v.track)===null||w===void 0?void 0:w.id)===r._mediaStreamTrack.id}))),!s)return M.warn("[".concat(r.getTrackId(),"] no rtpSender found}"));if(!Wn().supportSetRtpSenderParameters)return M.warn("Browser not support set rtp-sender parameters");const c={},d={};if(r instanceof Nr)switch(r._optimizationMode){case"motion":c.degradationPreference="maintain-framerate";break;case"detail":c.degradationPreference="maintain-resolution";break;default:c.degradationPreference="balanced"}if(oe("DSCP_TYPE")&&vf()){var h;const v=oe("DSCP_TYPE");rt(h=["very-low","low","medium","high"]).call(h,v)&&(d.networkPriority=v)}const m=s.getParameters(),g=(a=m.encodings)===null||a===void 0?void 0:a[0];g&&Object.assign(g,d),Object.assign(m,c),M.debug("[".concat(r.getTrackId(),"] updateRtpSenderEncodings: ").concat(JSON.stringify(m.encodings))),await s.setParameters(m)}async applySendEncodings(r,s){try{if(!Wn().supportSetRtpSenderParameters||r.length!==s.length)return;for(let a=0;a<r.length;a++){const c=r[a],d=s[a];c&&d&&await this.updateRtpSenderEncodings(d,c)}}catch{M.debug("[".concat(this.store.clientId,"] Apply RTPSendEncodings failed."))}}mungSendOfferSDP(r,s){const a=nc(r);return s.forEach(((c,d)=>{const h=c._mediaStreamTrack,m=a.mediaDescriptions.find((g=>g.attributes.mid===h.kind));m&&w0(m,c)})),Zm(a)}bindStatsEvents(){this.statsFilter.onFirstAudioReceived=r=>{var s;(s=this.onFirstAudioReceived)===null||s===void 0||s.call(this,r)},this.statsFilter.onFirstVideoReceived=r=>{var s;(s=this.onFirstVideoReceived)===null||s===void 0||s.call(this,r)},this.statsFilter.onFirstAudioDecoded=r=>{var s;(s=this.onFirstAudioDecoded)===null||s===void 0||s.call(this,r)},this.statsFilter.onFirstVideoDecoded=(r,s,a)=>{var c;(c=this.onFirstVideoDecoded)===null||c===void 0||c.call(this,r,s,a)},this.statsFilter.onSelectedLocalCandidateChanged=(r,s)=>{var a;(a=this.onSelectedLocalCandidateChanged)===null||a===void 0||a.call(this,r,s)},this.statsFilter.onSelectedRemoteCandidateChanged=(r,s)=>{var a;(a=this.onSelectedRemoteCandidateChanged)===null||a===void 0||a.call(this,r,s)}}unbindStatsEvents(){this.statsFilter.onFirstAudioReceived=void 0,this.statsFilter.onFirstVideoReceived=void 0,this.statsFilter.onFirstAudioDecoded=void 0,this.statsFilter.onFirstVideoDecoded=void 0,this.statsFilter.onSelectedLocalCandidateChanged=void 0,this.statsFilter.onSelectedRemoteCandidateChanged=void 0}async batchReceive(r){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.batchReceive before remoteSDP created.");const s=this.remoteSDP.batchSend(r).map(((d,h)=>{let{id:m,mslabel:g}=d;const{kind:v}=r[h];return new mt(((w,I)=>{const A=setTimeout((()=>{I(new Error("Cannot receive track, id: ".concat(m)))}),1e4),N=H=>{const B=Mn();if(B.name==="Safari"&&Number(B.version)===11&&H.track.id!==m&&H.streams[0].id===g){var z;const ee=H.streams[0].getTracks()[0];return(z=this.remoteSDP)===null||z===void 0||z.updateTrackLabel(v,m,H.track.id),this.peerConnection.removeEventListener("track",N),clearTimeout(A),void w({track:ee,id:m})}if(H.track.id===m)return this.peerConnection.removeEventListener("track",N),clearTimeout(A),void w({track:H.track,id:m})};this.peerConnection.addEventListener("track",N)}))})),a=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:a});const c=await this.peerConnection.createAnswer();return await this.peerConnection.setLocalDescription(c),await mt.all(s)}catch(s){throw new Le(te.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(s.toString()))}}async getRemoteSSRC(r){if(!this.remoteSDP)return;const s=this.remoteSDP.getSSRC(r);return s==null?void 0:s[0].ssrcId}setConfiguration(r){if(Wn().supportPCSetConfiguration){const s=LC.resolvePCConfiguration(r);this.peerConnection.setConfiguration(s)}}},Rt(Cr.prototype,"connect",[au],Object.getOwnPropertyDescriptor(Cr.prototype,"connect"),Cr.prototype),Rt(Cr.prototype,"stopSending",[au],Object.getOwnPropertyDescriptor(Cr.prototype,"stopSending"),Cr.prototype),Rt(Cr.prototype,"receive",[au],Object.getOwnPropertyDescriptor(Cr.prototype,"receive"),Cr.prototype),Rt(Cr.prototype,"stopReceiving",[au],Object.getOwnPropertyDescriptor(Cr.prototype,"stopReceiving"),Cr.prototype),Rt(Cr.prototype,"muteRemote",[au],Object.getOwnPropertyDescriptor(Cr.prototype,"muteRemote"),Cr.prototype),Rt(Cr.prototype,"unmuteRemote",[au],Object.getOwnPropertyDescriptor(Cr.prototype,"unmuteRemote"),Cr.prototype),Rt(Cr.prototype,"muteLocal",[au],Object.getOwnPropertyDescriptor(Cr.prototype,"muteLocal"),Cr.prototype),Rt(Cr.prototype,"unmuteLocal",[au],Object.getOwnPropertyDescriptor(Cr.prototype,"unmuteLocal"),Cr.prototype),Rt(Cr.prototype,"close",[au],Object.getOwnPropertyDescriptor(Cr.prototype,"close"),Cr.prototype),Rt(Cr.prototype,"updateEncoderConfig",[au],Object.getOwnPropertyDescriptor(Cr.prototype,"updateEncoderConfig"),Cr.prototype),Rt(Cr.prototype,"updateSendParameters",[au],Object.getOwnPropertyDescriptor(Cr.prototype,"updateSendParameters"),Cr.prototype),Rt(Cr.prototype,"replaceTrack",[au],Object.getOwnPropertyDescriptor(Cr.prototype,"replaceTrack"),Cr.prototype),Rt(Cr.prototype,"getRemoteSSRC",[au],Object.getOwnPropertyDescriptor(Cr.prototype,"getRemoteSSRC"),Cr.prototype),Cr);function au(t,r,s){const a=t[r];if(typeof a!="function")throw new Error("Cannot use mutex on object property.");return s.value=async function(){const c=this.mutex,d=await c.lock("Locking from P2PConnection.".concat(r));try{for(var h=arguments.length,m=new Array(h),g=0;g<h;g++)m[g]=arguments[g];return await a.apply(this,m)}finally{d()}},s}const HEe={name:"PlanBConnection",create:function(t){let{store:r,spec:s}=t;return new GEe(s,r)}},$Ee={interceptLocalAudioFrame:async function(t){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(!Wn().supportWebRTCEncodedTransform)return void M.warning("browser not support audio encoded transform");if(z1.has(t)||!t.track)return;const s={track:t.track};if(Ef()){if(!t.createEncodedStreams)return void M.warning("browser not support createEncodedStreams() API");let c=null;try{c=t.createEncodedStreams()}catch(h){return void M.error("create audio-encoded-streams error",h&&h.message)}const d=new TransformStream({transform(h,m){s.controller||(s.controller=m),t.track&&t.track.id!==s.track.id&&(M.debug("audio track changed: ".concat(s.track.id," => ").concat(t.track.id)),s.track.removeEventListener("ended",a),s.track=t.track,s.track.addEventListener("ended",a));const g=r.metadata&&r.metadata();g?(function(v,w){const{chunk:I,controller:A}=w,N=eg.METADATA;I.data=(function(H,B,z){const ee=z.byteLength,Z=ee+P2+t7,ae=I2+A2+Z,ye=new ArrayBuffer(H.byteLength+ae),_e=new DataView(ye);_e.setUint8(0,e7),_e.setUint16(1,Z),_e.setUint8(3,B),_e.setUint16(4,ee);for(let Ae=0;Ae<ee;Ae++)_e.setUint8(6+Ae,z[Ae]);const ue=new Uint8Array(_e.buffer);return ue.set(new Uint8Array(H),ae),ue.buffer})(I.data,N,v),A.enqueue(I)})(g,{chunk:h,controller:m}):m.enqueue(h)}});c.readable.pipeThrough(d).pipeTo(c.writable)}else if(Fs()){if(typeof RTCRtpScriptTransform>"u")return void M.warning("browser not support RTCRtpScriptTransform");const c=B1(),d=new MessageChannel;await new mt((m=>c.onmessage=g=>{g.data==="registered"&&m(void 0)}));const h=new RTCRtpScriptTransform(c,{name:"audio-metadata-tx",port:d.port2},[d.port2]);t.transform=h,await new mt((m=>c.onmessage=g=>{g.data==="started"&&m(void 0)})),d.port1.onmessage=m=>{var g;if(m.data.transformed&&t.track&&((g=t.track)===null||g===void 0?void 0:g.id)!==s.track.id)M.debug("audio track changed: ".concat(s.track.id," => ").concat(t.track.id)),s.track.removeEventListener("ended",a),s.track=t.track,s.track.addEventListener("ended",a);else if(m.data.getMetadata){const v=r.metadata&&r.metadata();v&&d.port1.postMessage({metadata:v})}},s.worker=c}function a(){if(t.track){if(this.id!==t.track.id)return;t.track.removeEventListener("ended",a)}const c=z1.get(t);if(c){z1.delete(t);try{var d,h;(d=c.controller)===null||d===void 0||d.terminate(),(h=c.worker)===null||h===void 0||h.terminate()}catch(m){M.warning(m&&m.message)}}}z1.set(t,s),t.track.addEventListener("ended",a)},interceptRemoteAudioFrame:async function(t){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(!Wn().supportWebRTCEncodedTransform)return void M.warning("browser not support audio encoded transform");if(q1.has(t))return;const s={track:t.track,onMetadata:r.onMetadata,onPts:r.onPts};if(Ef()&&!To()){if(!t.createEncodedStreams)return void M.warning("browser not support createEncodedStreams() API");VL(Yn.CHROME,87,116)||(r.enableTopn=!1);let c=null;try{c=t.createEncodedStreams()}catch(h){return void M.error("create audio-encoded-streams error",h&&h.message)}const d=new TransformStream({transform(h,m){s.controller||(s.controller=m),t.track&&t.track.id!==s.track.id&&(M.debug("audio track changed: ".concat(s.track.id," => ").concat(t.track.id)),s.track.removeEventListener("ended",a),s.track=t.track,s.track.addEventListener("ended",a)),r.enableTopn?(function(g,v,w){var I;const A=O2(new DataView(v.data));if(!A)return w.enqueue(v);const N=g.track.id;Ige.set(N,g.track);const H=(I=A.tlv.find((ye=>ye.tag===eg.AUDIO_LEVEL)))===null||I===void 0?void 0:I.value;let B=0;typeof H=="number"&&(B=127-H);const z=Math.round(Math.pow(10,B/60)-1),{selected:ee,speaker:Z}=(function(ye,_e){let ue=g0.get(ye);if(ue||(ue=(function(Ae){const Ue=new r7;return g0.set(Ae,Ue),Qd||(Qd=new Cge(oe("TOPN_SILENCE_THRESHOLD")||500),Qd.on("ActiveSpeakerChanged",(We=>{We!=null&&(H1=We)}))),Qd.addSpeakers([Ue]),Ue})(ye)),g0.size<=i7)return{selected:!0,speaker:ue};if(!Qd)throw new Error("no active speaker detector");return Qd.levelChanged(ue.id,_e),dy=Qd.loudest.map((Ae=>Ae.id)),H1&&!rt(dy).call(dy,H1)&&dy.length>=i7&&dy.pop(),{selected:rt(dy).call(dy,ue.id)||ue.id===H1,speaker:ue}})(g,z),ae=(function(ye,_e,ue){const Ae=Zd.get(ye)||new Rge(ye,_e);return Ae.score=ue,Zd.set(ye,Ae),(function(Ue){if($1.set(Ue,!0),!K1)return void(K1=Date.now());const We=Date.now();We-K1>1e3&&($1.get(Ue)?$1.set(Ue,!1):(s7(Ue),$1.delete(Ue)),K1=We)})(ye),Ae})(N,g.track,Z.energyScore);ae.addSample(ee),ae.active&&(v.data=A.frame.buffer,w.enqueue(v))})(t,h,m):r.enableMetadata||r.enablePts?(function(g,v,w,I){const A=new DataView(g.data),N=A.getUint8(0);let H;if((128&N)!=0&&N!==71){const ee=(function(Z){if(Z.byteLength<=0)return[];const ae=[];let ye=0;for(;ye<Z.byteLength;){const ue=(128&Z.getUint8(ye))>>7,Ae=127&Z.getUint8(ye);if(!(ue&&ye+4<=Z.byteLength)){ye++;break}{const Ue=Z.getUint32(ye,!1),We=(16776192&Ue)>>10,Ze=1023&Ue;ae.push({pt:Ae,ts_offset:We,length:Ze,data:new Uint8Array}),ye+=4}}let _e=Z.byteLength-ye;for(const ue of ae){if(ue.length>_e)return console.warn("Broken red payload"),[];ue.length>0&&(ue.data=new Uint8Array(Z.buffer,Z.byteOffset+ye,ue.length),ye+=ue.length,_e-=ue.length)}if(_e>0){const ue={pt:ae.length>0?ae[ae.length-1].pt:0,ts_offset:0,length:_e,data:new Uint8Array(Z.buffer,Z.byteOffset+ye,_e)};ae.push(ue)}return ae})(A);if(ee.length>0){const Z=(function(ae){let ye=0;for(let Ae=0;Ae<ae.length;Ae++)ye+=Ae<ae.length-1?4:1,ye+=ae[Ae].length;const _e=new Uint8Array(ye);let ue=0;for(let Ae=0;Ae<ae.length;Ae++)if(Ae<ae.length-1){const Ue=(2147483648|(127&ae[Ae].pt)<<24|(262143&ae[Ae].ts_offset)<<10|1023&ae[Ae].length)>>>0;_e[ue++]=Ue>>24&255,_e[ue++]=Ue>>16&255,_e[ue++]=Ue>>8&255,_e[ue++]=255&Ue}else _e[ue++]=127&ae[Ae].pt;for(const Ae of ae)_e.set(Ae.data,ue),ue+=Ae.length;return _e})(ee.map((ae=>{const ye=new Uint8Array(ae.length);ye.set(ae.data);const _e=O2(new DataView(ye.buffer));return _e!=null&&_e.frame&&(ae.data=_e==null?void 0:_e.frame),H=_e,ae})));g.data=Z.buffer}}else H=O2(A),H&&(g.data=H.frame.buffer);if(v.enqueue(g),!H)return;const B=H.tlv.find((ee=>ee.tag===eg.METADATA));B&&w&&B.value instanceof Uint8Array&&w(B.value);const z=H.tlv.find((ee=>ee.tag===eg.AUDIO_64_BIT_PTS));z&&I&&z.value instanceof Uint8Array&&z.value.length==8&&I(new DataView(z.value.buffer).getBigUint64(0,!0))})(h,m,r.onMetadata,r.onPts):m.enqueue(h)}});c.readable.pipeThrough(d).pipeTo(c.writable)}else{if(typeof RTCRtpScriptTransform>"u")return void M.warning("browser not support RTCRtpScriptTransform");const c=B1(),d=new MessageChannel;await new mt((m=>c.onmessage=g=>{g.data==="registered"&&m(void 0)}));const h=new RTCRtpScriptTransform(c,{name:"audio-metadata-rx",port:d.port2},[d.port2]);t.transform=h,await new mt((m=>c.onmessage=g=>{g.data==="started"&&m(void 0)})),d.port1.onmessage=m=>{var g;m.data.transformed&&t.track&&((g=t.track)===null||g===void 0?void 0:g.id)!==s.track.id?(M.debug("audio track changed: ".concat(s.track.id," => ").concat(t.track.id)),s.track.removeEventListener("ended",a),s.track=t.track,s.track.addEventListener("ended",a)):m.data.metadata&&s.onMetadata?s.onMetadata(m.data.metadata):m.data.pts&&s.onPts&&s.onPts(m.data.pts)},s.worker=c}function a(){t.track.removeEventListener("ended",a),(function(c){const d=q1.get(c);if(d){(function(g){const v=g0.get(g);v&&(g0.delete(g),Qd&&(Qd.removeSpeakers([v]),g0.size===0&&(Qd.destroy(),Qd=null)))})(c),s7(c.track.id),q1.delete(c);try{var h,m;(h=d.controller)===null||h===void 0||h.terminate(),(m=d.worker)===null||m===void 0||m.terminate()}catch(g){M.warning(g&&g.message)}}})(t)}q1.set(t,s),t.track.addEventListener("ended",a)},interceptLocalVideoFrame:async function(t,r){if(!Wn().supportWebRTCEncodedTransform)return void M.warning("browser not support video encoded transform");if(Y1.has(t)||!t.track)return;const s={track:t.track};if(Ef()){if(!t.createEncodedStreams)return void M.warning("browser not support createEncodedStreams() API");let c=null;try{c=t.createEncodedStreams()}catch(m){return void M.error("create video-encoded-streams error",m&&m.message)}const d=[];r.on("sei-to-send",(m=>{d.push(m)}));const h=new TransformStream({transform(m,g){s.controller||(s.controller=g),t.track&&t.track.id!==s.track.id&&(M.debug("video track changed: ".concat(s.track.id," => ").concat(t.track.id)),s.track.removeEventListener("ended",a),s.track=t.track,s.track.addEventListener("ended",a));const v=c7(new Uint8Array(m.data)),w=d.shift();if(w){const I=(function(A,N,H){switch(H){case D2:return(function(B,z){const ee=a7(z),Z=ee.length,ae=Math.floor(Z/255),ye=Z%255,_e=new Uint8Array(6+ae+1+Z+B.byteLength);_e[0]=0,_e[1]=0,_e[2]=0,_e[3]=1,_e[4]=6,_e[5]=101;let ue=0;for(;ue<ae;)_e[6+ue]=255,ue++;return _e[6+ue]=ye,ue++,_e.set(ee,6+ue),_e.set(new Uint8Array(B),6+ue+Z),_e.buffer})(A,N);case L2:return(function(B,z){const ee=a7(z),Z=ee.length,ae=Math.floor(Z/255),ye=Z%255,_e=new Uint8Array(7+ae+1+Z+1+B.byteLength);_e[0]=0,_e[1]=0,_e[2]=0,_e[3]=1,_e[4]=78,_e[5]=1,_e[6]=101;let ue=0;for(;ue<ae;)_e[7+ue]=255,ue++;return _e[7+ue]=ye,ue++,_e.set(ee,7+ue),ue+=Z,_e[7+ue]=128,ue++,_e.set(new Uint8Array(B),7+ue),_e.buffer})(A,N);default:return null}})(m.data,w,v);I&&(m.data=I)}g.enqueue(m)}});c.readable.pipeThrough(h).pipeTo(c.writable)}else{if(!Fs())return;{if(typeof RTCRtpScriptTransform>"u")return void M.warning("browser not support RTCRtpScriptTransform");const c=B1(),d=new MessageChannel;await new mt((m=>c.onmessage=g=>{g.data==="registered"&&m(void 0)}));const h=new RTCRtpScriptTransform(c,{name:"sei-tx",port:d.port2},[d.port2]);t.transform=h,await new mt((m=>c.onmessage=g=>{g.data==="started"&&m(void 0)})),r.on("sei-to-send",(m=>{d.port1.postMessage({sei:m})})),d.port1.onmessage=m=>{var g;m.data.transformed&&t.track&&((g=t.track)===null||g===void 0?void 0:g.id)!==s.track.id&&(M.debug("video track changed: ".concat(s.track.id," => ").concat(t.track.id)),s.track.removeEventListener("ended",a),s.track=t.track,s.track.addEventListener("ended",a))},s.worker=c}}function a(){if(t.track){if(this.id!==t.track.id)return;t.track.removeEventListener("ended",a)}const c=Y1.get(t);if(c){Y1.delete(t);try{var d,h;(d=c.controller)===null||d===void 0||d.terminate(),(h=c.worker)===null||h===void 0||h.terminate()}catch(m){M.warning(m&&m.message)}}}Y1.set(t,s),t.track.addEventListener("ended",a)},interceptRemoteVideoFrame:async function(t){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(!Wn().supportWebRTCEncodedTransform)return void M.warning("browser not support video encoded transform");if(!t.track)return;if(yT.has(t)){const c=yT.get(t);return void(c&&(c.onSei=r.onSei))}const s={track:t.track,onSei:r.onSei};if(Ef()){if(!t.createEncodedStreams)return void M.warning("browser not support createEncodedStreams() API");let c=null;try{c=t.createEncodedStreams()}catch(h){return void M.error("create video-encoded-streams error",h&&h.message)}const d=new TransformStream({transform(h,m){s.controller||(s.controller=m),t.track&&t.track.id!==s.track.id&&(M.debug("video track changed: ".concat(s.track.id," => ").concat(t.track.id)),s.track.removeEventListener("ended",a),s.track=t.track,s.track.addEventListener("ended",a));const g=(function(v,w){switch(w){case D2:return(function(I){const A=new DataView(I.data);let N=0;for(;N+4<I.data.byteLength;){if(A.getUint8(N+0)===0&&A.getUint8(N+1)===0&&A.getUint8(N+2)===0&&A.getUint8(N+3)===1&&A.getUint8(N+4)===6){let H=N+6,B=0,z=0;for(;(z=A.getUint8(H++))===255;)B+=255;B+=z;const ee=o7(I.data,H,B);return new Uint8Array(ee)}N++}return null})(v);case L2:return(function(I){const A=new DataView(I.data);let N=0;for(;N+5<I.data.byteLength;){if(A.getUint8(N+0)===0&&A.getUint8(N+1)===0&&A.getUint8(N+2)===0&&A.getUint8(N+3)===1&&A.getUint8(N+4)===78&&A.getUint8(N+5)===1&&A.getUint8(N+6)===101){let H=N+7,B=0,z=0;for(;(z=A.getUint8(H++))===255;)B+=255;B+=z;const ee=o7(I.data,H,B);return new Uint8Array(ee)}N++}return null})(v);default:return null}})(h,c7(new Uint8Array(h.data)));g&&s.onSei&&s.onSei(g),m.enqueue(h)}});c.readable.pipeThrough(d).pipeTo(c.writable)}else if(Fs()){if(typeof RTCRtpScriptTransform>"u")return void M.warning("browser not support RTCRtpScriptTransform");const c=B1(),d=new MessageChannel;await new mt((m=>c.onmessage=g=>{g.data==="registered"&&m(void 0)}));const h=new RTCRtpScriptTransform(c,{name:"sei-rx",port:d.port2},[d.port2]);t.transform=h,await new mt((m=>c.onmessage=g=>{g.data==="started"&&m(void 0)})),d.port1.onmessage=m=>{var g;m.data.transformed&&t.track&&((g=t.track)===null||g===void 0?void 0:g.id)!==s.track.id?(M.debug("video track changed: ".concat(s.track.id," => ").concat(t.track.id)),s.track.removeEventListener("ended",a),s.track=t.track,s.track.addEventListener("ended",a)):m.data.sei&&s.onSei&&s.onSei(m.data.sei)},s.worker=c}function a(){if(t.track){if(this.id!==t.track.id)return;t.track.removeEventListener("ended",a)}(function(c){const d=yT.get(c);if(d){yT.delete(c);try{var h,m;(h=d.controller)===null||h===void 0||h.terminate(),(m=d.worker)===null||m===void 0||m.terminate()}catch(g){M.warning(g&&g.message)}}})(t)}yT.set(t,s),t.track.addEventListener("ended",a)}},KEe={name:"InterceptFrame",create:()=>$Ee};s2(),gr("PROCESS_ID","process-".concat(Tr(8,""),"-").concat(Tr(4,""),"-").concat(Tr(4,""),"-").concat(Tr(4,""),"-").concat(Tr(12,""))),(function(){let t;try{t=window.localStorage.getItem("websdk_ng_global_parameter")}catch(r){return void M.error("Error loading sdk config",r.message)}if(t)try{const r=JSON.parse(window.atob(t)),s=Date.now();M.debug("Loading global parameters from cache",r),Object.keys(r).forEach((a=>{if(Object.prototype.hasOwnProperty.call(Fr,a)){const{value:c,expires:d}=r[a];if(d&&d<=s)return;Jd[a]=c,Fr[a]=c}}))}catch(r){M.error("Error loading mutableParamsCache: ".concat(t),r.message)}})(),Array.isArray(Jd.AREAS)&&Jd.AREAS.length>0&&eM(Jd.AREAS,!0);const oq=(t,r,s)=>{M.debug("setParameter key:".concat(t,", value:").concat(JSON.stringify(r))),gr(t,r,s)};cg(gEe,!1),cg(EEe,!1),cg(Q_e,!1),cg(OEe,!1),cg(pEe,!1),cg(zEe,!1),cg(HEe,!1),cg(KEe,!1);const ji=(function(t){const r=new Zr,s=t,a={getListeners:r.getListeners.bind(r),on:(c,d)=>((function(h,m){h===up.SECURITY_POLICY_VIOLATION&&F$(m,!0)})(c,d),r.on.bind(r)(c,d)),addListener:r.addListener.bind(r),once:r.once.bind(r),off:r.off.bind(r),removeAllListeners:r.removeAllListeners.bind(r),emit:r.emit.bind(r),safeEmit:r.safeEmit.bind(r)};return j$(j$({},s),a)})({__TRACK_LIST__:a0,VERSION:Zl,BUILD:c2,ESM_BUNDLER:!1,ESM:!1,UMD:!0,DEV:!1,setParameter:oq,getParameter:oe,getSupportedCodec:async function(){let t={audio:[],video:[]};try{let r=new RTCPeerConnection;const s=await(async function(a){let c;return Wn().supportUnifiedPlan?(a.addTransceiver("video",{direction:"recvonly"}),a.addTransceiver("audio",{direction:"recvonly"}),c=(await a.createOffer()).sdp):c=(await a.createOffer({offerToReceiveAudio:!0,offerToReceiveVideo:!0})).sdp,c})(r);if(!s)return t;r.close(),r=null,t=(function(a){const c={video:[],audio:[]};return a.match(/ VP8/i)&&c.video.push("VP8"),a.match(/ VP9/i)&&c.video.push("VP9"),a.match(/ AV1/i)&&c.video.push("AV1"),a.match(/ H264/i)&&c.video.push("H264"),a.match(/ H265/i)&&c.video.push("H265"),a.match(/ opus/i)&&c.audio.push("OPUS"),a.match(/ PCMU/i)&&c.audio.push("PCMU"),a.match(/ PCMA/i)&&c.audio.push("PCMA"),a.match(/ G722/i)&&c.audio.push("G722"),c})(s)}catch(r){throw new ke(te.CREATE_OFFER_FAILED,r.toString&&r.toString()).print()}return t},checkSystemRequirements:function(){const t=It.reportApiInvoke(null,{name:pi.CHECK_SYSTEM_REQUIREMENTS,options:[],tag:$r.TRACER});let r=!1;try{const d=window.RTCPeerConnection,h=navigator.mediaDevices&&navigator.mediaDevices.getUserMedia,m=window.WebSocket;r=!!(d&&h&&m),r&&GL()&&o9(75)&&new d().close()}catch(d){return M.error("check system requirement failed: ",d),!1}let s=!1;const a=Mn();a.name===Yn.CHROME&&Number(a.version)>=58&&(qd.engine.name!=="WebKit"||(function(){const d=Mn();if(T1()){if(d.os===os.MAC_OS)return!0;if(d.os===os.IOS){const h=qd.os.version&&qd.os.version.split(".");if(h&&Number(h[0])===14&&h[1]&&Number(h[1])>=3||h&&Number(h[0])>14)return!0}}return!1})())&&(s=!0),(a.name===Yn.FIREFOX&&Number(a.version)>=56||a.name===Yn.OPERA&&Number(a.version)>=45||a.name===Yn.SAFARI&&Number(a.version)>=11||a.name==="WebKit"&&(To()||Hu())&&a.osVersion&&Number(a.osVersion.split(".")[0])>=11||h9()||Mn().name===Yn.QQ)&&(s=!0),M.debug("checkSystemRequirements, api:",r,"browser",s);const c=r&&s;return t.onSuccess(c),c},getDevices:function(t){return pl.enumerateDevices(!0,!0,t)},getMicrophones:function(t){return pl.getRecordingDevices(t)},getCameras:function(t){return pl.getCamerasDevices(t)},getElectronScreenSources:oW,getPlaybackDevices:function(t){return pl.getSpeakers(t)},createClient:function(){var t;let r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{codec:"vp8",audioCodec:"opus",mode:"rtc"};const s=Tr(5,"client-"),a=It.reportApiInvoke(null,{id:s,name:pi.CREATE_CLIENT,options:[r],tag:$r.TRACER});try{(function(c){Zi(c.codec,"config.codec",["vp8","vp9","av1","h264","h265"]),Zi(c.mode,"config.mode",["rtc","live","p2p"]),c.audioCodec!==void 0&&Zi(c.audioCodec,"config.audioCodec",["opus","pcmu","pcma","g722"]),c.proxyServer!==void 0&&Rs(c.proxyServer,"config.proxyServer",1,1e4),c.turnServer!==void 0&&v9(c.turnServer),c.httpRetryConfig!==void 0&&E9(c.httpRetryConfig),c.websocketRetryConfig!==void 0&&E9(c.websocketRetryConfig)})(r)}catch(c){throw a.onError(c),c}return(l9(16,0)||BL(16,0,!0))&&(r.codec==="vp9"&&(r.codec="vp8",M.debug("browser not support vp9, force use vp8")),gr("UNSUPPORTED_VIDEO_CODEC",["vp9"])),r.audioCodec===void 0&&(r.audioCodec="opus"),a.onSuccess(),new Z_e(ed(ed({forceWaitGatewayResponse:!0},r),{},{role:rt(t=["rtc","p2p"]).call(t,r.mode)?"host":r.role||"audience"}),s)},createCameraVideoTrack:async function(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const r=oe("CAMERA_CAPTURE_CONFIG"),s=Tr(8,"track-cam-"),a=It.reportApiInvoke(null,{id:s,tag:$r.TRACER,name:pi.CREATE_CAM_VIDEO_TRACK,options:[Pr({},t),r]});r&&(t.encoderConfig=r);const c=j1(t);let d=null;M.info("start create camera video track with config",JSON.stringify(t),"trackId",s);try{d=(await hl({video:c},s)).getVideoTracks()[0]||null}catch(m){throw a.onError(m),m}if(!d){const m=new Le(te.UNEXPECTED_ERROR,"can not find track in media stream");return a.onError(m),m.throw(M)}if(t.optimizationMode&&R2(s,d,t,qu(t.encoderConfig)),oe("USE_STANDARD_BITRATE_DEFAULT")){const m=qu(t.encoderConfig);t.encoderConfig=m,delete m.bitrateMax,delete m.bitrateMin}const h=new F1(d,t,c,t.scalabiltyMode?L1(t.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},t.optimizationMode,s);return a.onSuccess(h.getTrackId()),M.info("create camera video success, trackId:",s),h},createCustomVideoTrack:function(t){const r=Tr(8,"track-cus-"),s=It.reportApiInvoke(null,{id:r,tag:$r.TRACER,name:pi.CREATE_CUSTOM_VIDEO_TRACK,options:[t]});oe("USE_STANDARD_BITRATE_DEFAULT")&&(delete t.bitrateMax,delete t.bitrateMin);const a=new Nr(t.mediaStreamTrack,{width:t.width,height:t.height,frameRate:t.frameRate,bitrateMax:t.bitrateMax,bitrateMin:t.bitrateMin},t.scalabiltyMode?L1(t.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},t.optimizationMode,r,[Sr.CUSTOM_TRACK]);return s.onSuccess(a.getTrackId()),M.info("create custom video track success with config",t,"trackId",a.getTrackId()),a},createScreenVideoTrack:async function(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"disable";const s=typeof r=="object"?(function(A){return gW(A)})(r):void 0;s&&(r="auto");const a=Tr(8,"track-scr-v-"),c=It.reportApiInvoke(null,{id:a,tag:$r.TRACER,name:pi.CREATE_SCREEN_VIDEO_TRACK,options:[Pr({},t),r]});t.encoderConfig?typeof t.encoderConfig=="string"||t.encoderConfig.width&&t.encoderConfig.height||(t.encoderConfig.width={max:1920},t.encoderConfig.height={max:1080}):t.encoderConfig="1080p_2";const d=(function(A){const N={};A.screenSourceType&&(N.mediaSource=A.screenSourceType),A.extensionId&&Ef()&&(N.extensionId=A.extensionId);const{displaySurface:H,selfBrowserSurface:B,surfaceSwitching:z,systemAudio:ee,preferCurrentTab:Z}=A;(Qv(107)||jL(107)||zL(93))&&(H&&(Zi(H,"displaySurface",["browser","window","monitor"]),N.displaySurface=H),B?(Zi(B,"selfBrowserSurface",["exclude","include"]),N.selfBrowserSurface=B):N.selfBrowserSurface="include",z&&(Zi(z,"surfaceSwitching",["exclude","include"]),N.surfaceSwitching=z)),(Qv(105)||jL(105)||zL(91))&&ee&&(Zi(ee,"systemAudio",["exclude","include"]),N.systemAudio=ee),(Qv(94)||jL(94)||zL(80))&&Z&&(N.preferCurrentTab=!0),A.electronScreenSourceId&&(N.sourceId=A.electronScreenSourceId);const ae=A.encoderConfig?f2(A.encoderConfig):null;return N.mandatory={chromeMediaSource:"desktop",maxWidth:ae?ae.width:void 0,maxHeight:ae?ae.height:void 0},ae&&(ae.frameRate&&(typeof ae.frameRate=="number"?(N.mandatory.maxFrameRate=ae.frameRate,N.mandatory.minFrameRate=ae.frameRate):(N.mandatory.maxFrameRate=ae.frameRate.max||ae.frameRate.ideal||ae.frameRate.exact||void 0,N.mandatory.minFrameRate=ae.frameRate.min||ae.frameRate.ideal||ae.frameRate.exact||void 0),N.frameRate=ae.frameRate),ae.width&&(N.width=ae.width),ae.height&&(N.height=ae.height)),N})(t);let h=null,m=null;const g=Wn();if(!g.supportShareAudio&&r==="enable"){const A=new Le(te.NOT_SUPPORTED,"your browser or platform is not support share-screen with audio");return c.onError(A),A.throw(M)}M.info("start create screen video track with config",t,"withAudio",r,"trackId",a);const v=g.supportShareAudio&&r!=="disable";try{const A=await hl({screen:d,screenAudio:v?s||!0:void 0},a);h=A.getVideoTracks()[0]||null,m=A.getAudioTracks()[0]||null}catch(A){throw c.onError(A),A}if(!h){const A=new Le(te.UNEXPECTED_ERROR,"can not find track in media stream");return c.onError(A),A.throw(M)}if(!m&&r==="enable"){h&&h.stop();const A=new Le(te.SHARE_AUDIO_NOT_ALLOWED);return c.onError(A),A.throw(M)}t.optimizationMode||(t.optimizationMode="detail"),t.optimizationMode&&(R2(a,h,t,t.encoderConfig&&f2(t.encoderConfig)||void 0),t.encoderConfig&&typeof t.encoderConfig!="string"&&(t.encoderConfig.bitrateMin=t.encoderConfig.bitrateMax));const w=new Nr(h,t.encoderConfig?f2(t.encoderConfig):{},t.scalabiltyMode?L1(t.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},t.optimizationMode,a,[Sr.SCREEN_TRACK]);if(!m)return c.onSuccess(w.getTrackId()),M.info("create screen video track success","video:",w.getTrackId()),w;const I=new ui(m,void 0,Tr(8,"track-scr-a-"),!1);return c.onSuccess([w.getTrackId(),I.getTrackId()]),M.info("create screen video track success","video:",w.getTrackId(),"audio:",I.getTrackId()),[w,I]},createMicrophoneAndCameraTracks:async function(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const s=oe("CAMERA_CAPTURE_CONFIG"),a=Tr(8,"track-mic-"),c=Tr(8,"track-cam-"),d=It.reportApiInvoke(null,{id:"".concat(a,"-").concat(c),tag:$r.TRACER,name:pi.CREATE_MIC_AND_CAM_TRACKS,options:[t,r,s]});s&&(r.encoderConfig=s);const h=j1(r),m=_W(t);let g=null,v=null;M.info("start create camera video track(".concat(c,") and microphone audio track(").concat(a,") with config, audio: ").concat(JSON.stringify(t),", video: ").concat(JSON.stringify(r)));try{const A=await hl({audio:m,video:h},"".concat(a,"-").concat(c));g=A.getAudioTracks()[0],v=A.getVideoTracks()[0]}catch(A){throw d.onError(A),A}if(!g||!v){const A=new Le(te.UNEXPECTED_ERROR,"can not find tracks in media stream");return d.onError(A),A.throw(M)}if(r.optimizationMode&&R2(c,v,r,qu(r.encoderConfig)),oe("USE_STANDARD_BITRATE_DEFAULT")){const A=qu(r.encoderConfig);r.encoderConfig=A,delete A.bitrateMax,delete A.bitrateMin}const w=new _T(g,t,m,a),I=new F1(v,r,h,r.scalabiltyMode?L1(r.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},r.optimizationMode,c);return d.onSuccess([w.getTrackId(),I.getTrackId()]),M.info("create camera video track(".concat(c,") and microphone audio track(").concat(a,") success")),[w,I]},createMicrophoneAudioTrack:async function(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const r=Tr(8,"track-mic-"),s=It.reportApiInvoke(null,{id:r,tag:$r.TRACER,name:pi.CREATE_MIC_AUDIO_TRACK,options:[t]}),a=_W(t);let c=null;M.info("start create microphone audio track with config",JSON.stringify(t),"trackId",r);try{c=(await hl({audio:a},r)).getAudioTracks()[0]||null}catch(h){throw s.onError(h),h}if(!c){const h=new Le(te.UNEXPECTED_ERROR,"can not find track in media stream");return s.onError(h),h.throw(M)}const d=new _T(c,t,a,r);return s.onSuccess(d.getTrackId()),M.info("create microphone audio track success, trackId:",r),d},createCustomAudioTrack:function(t){const r=Tr(8,"track-cus-"),s=It.reportApiInvoke(null,{id:r,tag:$r.TRACER,name:pi.CREATE_CUSTOM_AUDIO_TRACK,options:[t]}),a=new ui(t.mediaStreamTrack,t.encoderConfig?M1(t.encoderConfig):{},r,!1);return M.info("create custom audio track success with config",t,"trackId",a.getTrackId()),s.onSuccess(a.getTrackId()),a},createBufferSourceAudioTrack:async function(t){var r;const{cacheOnlineFile:s,encoderConfig:a}=t;let{source:c}=t;const d={source:c instanceof AudioBuffer?"AudioBuffer":c instanceof File?(r=File.name)!==null&&r!==void 0?r:"File":c,cacheOnlineFile:s,encoderConfig:a},h=Tr(8,"track-buf-"),m=It.reportApiInvoke(null,{id:h,tag:$r.TRACER,name:pi.CREATE_BUFFER_AUDIO_TRACK,options:[d]});if(oe("DISABLE_WEBAUDIO"))throw new Le(te.NOT_SUPPORTED,"can not create BufferSourceAudioTrack when WebAudio disabled");M.info("start create buffer source audio track with config",JSON.stringify(d),"trackId",h);const g=c;if(!(c instanceof AudioBuffer))try{c=await(async function(I,A){let N=null;if(typeof I=="string"){const B=rG.get(I);if(B)return M.debug("use cached audio resource: ",I),B;try{N=(await Xd((()=>Na.get(I,{responseType:"arraybuffer"})),void 0,void 0,{maxRetryCount:3})).data}catch(z){throw new Le(te.FETCH_AUDIO_FILE_FAILED,z.toString())}}else N=await new mt(((z,ee)=>{const Z=new FileReader;Z.onload=ae=>{ae.target?z(ae.target.result):ee(new Le(te.READ_LOCAL_AUDIO_FILE_ERROR))},Z.onerror=()=>{ee(new Le(te.READ_LOCAL_AUDIO_FILE_ERROR))},Z.readAsArrayBuffer(I)}));const H=await(function(B){const z=h0();return new mt(((ee,Z)=>{z.decodeAudioData(B,(ae=>{ee(ae)}),(ae=>{Z(new Le(te.DECODE_AUDIO_FILE_FAILED,ae.toString()))}))}))})(N);return typeof I=="string"&&A&&rG.set(I,H),H})(c,s)}catch(I){return m.onError(I),I.throw(M)}const v=new vge(c),w=new Ege(g,v,a?M1(a):{},h);return M.info("create buffer source audio track success, trackId:",h),m.onSuccess(w.getTrackId()),w},setAppType:function(t){if(M.debug("setAppType: ".concat(t)),!(Number.isInteger(t)&&t>=0))throw M.debug("Invalid appType"),new ke(te.INVALID_PARAMS,"invalid app type",t);gr("APP_TYPE",Math.floor(t))},setLogLevel:function(t){M.setLogLevel(t)},enableLogUpload:function(){oe("USE_NEW_LOG")?gr("UPLOAD_LOG",!0):M.enableLogUpload()},disableLogUpload:function(){oe("USE_NEW_LOG")?gr("UPLOAD_LOG",!1):M.disableLogUpload()},createChannelMediaRelayConfiguration:function(){return new oH},checkAudioTrackIsActive:async function(t){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:5e3;const s=It.reportApiInvoke(null,{tag:$r.TRACER,name:pi.CHECK_AUDIO_TRACK_IS_ACTIVE,options:[r]});if(!(t instanceof ui||t instanceof m0)){const g=new ke(te.INVALID_TRACK,"the parameter is not a audio track");return s.onError(g),g.throw()}r&&r<1e3&&(r=1e3);const a=t instanceof ui?t.getTrackLabel():"remote_track",c=t.getVolumeLevel();let d=c,h=c;const m=Date.now();return new mt((g=>{const v=setInterval((()=>{const w=t.getVolumeLevel();d=w>d?w:d,h=w<h?w:h;const I=d-h>1e-4,A=Date.now()-m;if(I||A>r){clearInterval(v);const N=I,H={duration:A,deviceLabel:a,maxVolumeLevel:d,result:N};M.info("[track-".concat(t.getTrackId(),"] check audio track active completed. ").concat(JSON.stringify(H))),s.onSuccess(H),g(N)}}),200)}))},checkVideoTrackIsActive:async function(t){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:5e3;const s=It.reportApiInvoke(null,{tag:$r.TRACER,name:pi.CHECK_VIDEO_TRACK_IS_ACTIVE,options:[r]});if(!(t instanceof Nr||t instanceof f0)){const I=new ke(te.INVALID_TRACK,"the parameter is not a video track");return s.onError(I),I.throw()}r&&r<1e3&&(r=1e3);const a=t instanceof Nr?t.getTrackLabel():"remote_track",c=t.getMediaStreamTrack(!0),d=document.createElement("video");d.style.width="1px",d.style.height="1px",d.setAttribute("muted",""),d.muted=!0,d.setAttribute("playsinline",""),d.controls=!1,(Fs()||T1())&&(d.style.opacity="0.01",d.style.position="fixed",d.style.left="0",d.style.top="0",document.body.appendChild(d)),d.srcObject=new MediaStream([c]),d.play();const h=document.createElement("canvas");h.width=160,h.height=120;let m=0,g=0;try{const I=Date.now();m=await(function(A,N,H,B){let z,ee=0,Z=null;return new mt(((ae,ye)=>{function _e(){ee>B&&z&&(z(),ae(ee));const ue=H.getContext("2d");if(!ue){const We=new ke(te.UNEXPECTED_ERROR,"can not get canvas 2d context.");return M.error(We.toString()),void ye(We)}ue.drawImage(A,0,0,160,120);const Ae=ue.getImageData(0,0,H.width,H.height),Ue=Math.floor(Ae.data.length/3);if(Z){for(let We=0;We<Ue;We+=3)if(Ae.data[We]!==Z[We])return ee+=1,void(Z=Ae.data);Z=Ae.data}else Z=Ae.data}setTimeout((()=>{z&&(z(),ae(ee))}),N),z=E2((()=>{_e()}),30)}))})(d,r,h,4),g=Date.now()-I}catch(I){throw s.onError(I),I}j_e===Yn.SAFARI&&(d.pause(),d.remove()),d.srcObject=null;const v=m>4,w={duration:g,changedPicNum:m,deviceLabel:a,result:v};return M.info("[track-".concat(t.getTrackId(),"] check video track active completed. ").concat(JSON.stringify(w))),s.onSuccess(w),v},setArea:eM,audioElementPlayCenter:xa,resumeAudioContext:function(){xa.autoResumeAfterInterruption(!0)},processExternalMediaAEC:function(t){tye.processExternalMediaAEC(t)},registerExtensions:function(t){const r=oe("PLUGIN_INFO")||[];t.forEach((s=>{"name"in s&&!rt(r).call(r,s.name)&&r.push(s.name);const a=s;a.__registered__=!0,a.logger.hookLog=M.extLog,a.reporter.hookApiInvoke=It.extApiInvoke,a.parameters&&Object.keys(a.parameters).forEach((c=>{a.parameters[c]=oe(c)}))})),oq("PLUGIN_INFO",r)},ChannelMediaRelayError:y0,ChannelMediaRelayEvent:wf,ChannelMediaRelayState:ic,RemoteStreamFallbackType:hge,RemoteStreamType:dge,ConnectionDisconnectedReason:or,AudienceLatencyLevelType:zme,AREAS:tr,preload:async function(t,r,s,a){return OH(t,r,s,a)}});return Object.defineProperties(ji,{onAudioAutoplayFailed:{get:()=>fl.onAudioAutoplayFailed,set:t=>{fl.onAudioAutoplayFailed=t}},onAutoplayFailed:{get:()=>fl.onAutoplayFailed,set:t=>{fl.onAutoplayFailed=t}},_onSecurityPolicyViolation:{value:void 0,writable:!0},_cspEventHandlerPointer:{value:void 0,writable:!0},onSecurityPolicyViolation:{get:()=>ji._onSecurityPolicyViolation,set(t){ji._onSecurityPolicyViolation=t,F$(t)}},__CLIENT_LIST__:{get:()=>oe("SHOW_GLOBAL_CLIENT_LIST")?hy:[]}}),pl.on(cy.CAMERA_DEVICE_CHANGED,(t=>{M.info("camera device changed",JSON.stringify(t)),ji.onCameraChanged&&ji.onCameraChanged(t),ji.safeEmit(up.CAMERA_CHANGED,t)})),pl.on(cy.RECORDING_DEVICE_CHANGED,(t=>{M.info("microphone device changed",JSON.stringify(t)),ji.onMicrophoneChanged&&ji.onMicrophoneChanged(t),ji.safeEmit(up.MICROPHONE_CHANGED,t)})),pl.on(cy.PLAYOUT_DEVICE_CHANGED,(t=>{M.debug("playout device changed",JSON.stringify(t)),ji.onPlaybackDeviceChanged&&ji.onPlaybackDeviceChanged(t),ji.safeEmit(up.PLAYBACK_DEVICE_CHANGED,t)})),xa.onAutoplayFailed=()=>{M.info("detect audio element autoplay failed"),fl.onAudioAutoplayFailed&&fl.onAudioAutoplayFailed()},_r.on("autoplay-failed",(()=>{M.info("detect webaudio autoplay failed"),fl.onAudioAutoplayFailed&&fl.onAudioAutoplayFailed(),ji.safeEmit(up.AUTOPLAY_FAILED)})),_r.on(Ps.STATE_CHANGE,((t,r)=>{M.info("audio context state changed: ".concat(r," => ").concat(t)),ji.onAudioContextStateChanged&&ji.onAudioContextStateChanged(t,r),ji.safeEmit(up.AUDIO_CONTEXT_STATE_CHANGED,t,r)})),Ai.on(e0.NETWORK_STATE_CHANGE,((t,r)=>{M.info("[network-indicator] network state changed, ".concat(r," => ").concat(t))})),window&&(window.__ARTC__=ji),ji}))})(ok)),ok.exports}var BWe=FWe();const LR=Jg(BWe),zWe="9442a472625f44e7b2c5065b9f9b3988",WWe=LR.createClient({mode:"rtc",codec:"vp8"});let fC=null;const sce=k.createContext(null),oce=({children:n,appId:e=zWe,channel:i=null,token:o=null,uid:l=null,enabled:u=!0,startMuted:p=!0,onClientReady:y=()=>{}})=>{const[E,b]=k.useState(!1),[T,R]=k.useState(!1),[O,L]=k.useState([]),[D,U]=k.useState(null),[F,Y]=k.useState(null),[W,re]=k.useState(null),[le,ie]=k.useState(!1),[me,q]=k.useState(!1),[J,Q]=k.useState(!1),[ne,he]=k.useState(null),[de,pe]=k.useState(!1),Se=ea(),Ie=k.useRef(WWe),Fe=k.useRef({appId:e,channel:i,uid:l,enabled:u}),we=k.useRef(!1),Re=k.useRef(null);k.useRef(null),k.useEffect(()=>{Fe.current={appId:e,channel:i,uid:l,enabled:u}},[e,i,l,u]),k.useEffect(()=>{Y(i)},[i]),k.useEffect(()=>{if(!Ie.current)return;const lt=gt=>{G.log(`Connection state changed to: ${gt}`),gt==="DISCONNECTED"?(b(!1),G.log("Disconnected from Agora")):gt==="CONNECTED"&&(b(!0),U(null))};return Ie.current.on("connection-state-change",lt),()=>{Ie.current.off("connection-state-change",lt)}},[]),k.useEffect(()=>{if(!i||!u)return;const lt=async(Gt,Jt)=>{G.log(`User published: ${Gt.uid}, mediaType: ${Jt}`);try{await Ie.current.subscribe(Gt,Jt),Jt==="audio"&&Gt.audioTrack.play(),L(st=>st.some(hn=>hn.uid===Gt.uid)?st:[...st,Gt])}catch(st){G.error("Error subscribing to user:",st)}},gt=(Gt,Jt)=>{G.log(`User unpublished: ${Gt.uid}, mediaType: ${Jt}`),Jt==="audio"&&Gt.audioTrack&&Gt.audioTrack.stop()},at=Gt=>{G.log(`User joined: ${Gt.uid}`),L(Jt=>Jt.some(st=>st.uid===Gt.uid)?Jt:[...Jt,Gt])},Ct=Gt=>{G.log(`User left: ${Gt.uid}`),L(Jt=>Jt.filter(st=>st.uid!==Gt.uid))};return Ie.current.on("user-published",lt),Ie.current.on("user-unpublished",gt),Ie.current.on("user-joined",at),Ie.current.on("user-left",Ct),(async()=>{if(we.current){G.log("Already initializing, skipping duplicate initialization");return}we.current=!0;try{if(E&&Re.current===i){G.log(`Already joined to channel ${i}`),ie(!0),y(Ie.current);return}if(Ie.current.connectionState==="CONNECTING"||Ie.current.connectionState==="CONNECTED")if(Re.current&&Re.current!==i){G.log("Connected to different channel, leaving first");try{await be()}catch(Gt){G.error("Error leaving channel:",Gt)}}else{b(!0),ie(!0),Re.current=i,fC=i,y(Ie.current);return}G.log(`Joining channel ${i}`),await Ne(),G.log("Join channel completed")}catch(Gt){G.error("Error during initialization:",Gt)}finally{we.current=!1}})(),()=>{G.log("Cleaning up event listeners"),Ie.current.off("user-published",lt),Ie.current.off("user-unpublished",gt),Ie.current.off("user-joined",at),Ie.current.off("user-left",Ct)}},[i,u,l,y,E]);const Te=async()=>{if(!u||W)return W;G.log("Initializing microphone");try{const lt=await LR.createMicrophoneAudioTrack();return await lt.setMuted(p),re(lt),G.log("Microphone initialized successfully"),lt}catch(lt){return G.error("Error initializing microphone:",lt),U("Failed to initialize microphone. Please check your permissions."),null}};k.useEffect(()=>{(async()=>{if(i)try{const Ct=await _o(i);Ct&&Ct.voiceDisabled?(G.log("Voice is disabled for this space"),pe(!0),E&&await be()):pe(!1)}catch(at){G.error("Error checking if voice is disabled:",at)}})();const gt=at=>{at.detail&&typeof at.detail.voiceDisabled=="boolean"&&(G.log("Voice setting changed:",at.detail.voiceDisabled),pe(at.detail.voiceDisabled),at.detail.voiceDisabled&&E?be():!at.detail.voiceDisabled&&!E&&u&&i&&Ne())};return window.addEventListener("SpaceVoiceSettingChanged",gt),()=>{window.removeEventListener("SpaceVoiceSettingChanged",gt)}},[i,E,u]);const Ne=async()=>{if(!u)return G.log("Agora is disabled, not joining channel"),!1;if(de)return G.log("Voice is disabled for this space, not joining channel"),U("Voice chat is disabled for this space"),!1;if(!i)return G.error("AgoraProvider: No channel specified"),U("No channel specified"),!1;if(G.log(`joinChannel called for channel ${i} with UID ${l}`),G.log("Current state:",{isJoined:E,isJoining:me,connectionState:Ie.current.connectionState,joinedChannel:Re.current}),E&&Re.current===i)return G.log(`Already joined to channel: ${i}`),!0;if(me)return G.log("AgoraProvider: Already in the process of joining"),!1;if(Ie.current.connectionState==="CONNECTED")if(Re.current&&Re.current!==i){G.log("Connected to different channel, leaving first");try{await be()}catch(lt){G.error("Error leaving channel:",lt)}}else return G.log("Client already connected, setting joined state to true"),b(!0),ie(!0),Re.current=i,fC=i,y(Ie.current),!0;if(Ie.current.connectionState==="CONNECTING")return G.log("Client already connecting, waiting for connection"),q(!0),new Promise(lt=>{const gt=setInterval(()=>{Ie.current.connectionState==="CONNECTED"&&(clearInterval(gt),b(!0),q(!1),ie(!0),Re.current=i,fC=i,y(Ie.current),lt(!0))},500);setTimeout(()=>{clearInterval(gt),G.log("AgoraProvider: Connection timeout, considering join failed"),q(!1),lt(!1)},1e4)});try{if(G.log(`Joining channel: ${i} with UID: ${l||"random"}`),G.log(`Using appId: ${e}, Type: ${typeof e}, Length: ${e.length}`),!e||e.trim()===""){const gt="AgoraProvider: App ID is empty or invalid";return G.error(gt),U(gt),q(!1),!1}q(!0);const lt=l||Math.floor(Math.random()*1e6);return await Ie.current.join(e,i,o,lt),G.log(`Joined channel successfully with UID: ${Ie.current.uid}`),b(!0),q(!1),ie(!0),Re.current=i,fC=i,y(Ie.current),!0}catch(lt){return G.error("Error joining channel:",lt),U(`Error joining channel: ${lt.toString()}`),q(!1),!1}},be=async()=>{if(E)try{W&&await Ie.current.unpublish(W),await Ie.current.leave(),fC=null,Re.current=null,G.log("Left channel successfully"),b(!1),L([])}catch(lt){G.error("Error leaving channel:",lt),U(lt.message||"Failed to leave channel")}};k.useEffect(()=>()=>{W&&W.close()},[]),k.useEffect(()=>{u&&i&&(!E||Re.current!==i)&&Ne()},[u,i,E]);const xe=()=>{if(!W)return!1;try{return W.isActive&&!W.muted}catch(lt){return G.error("Error checking microphone status:",lt),!1}};k.useEffect(()=>{const lt=()=>{const at=xe();at!==T&&(G.log("Syncing microphone state:",{actualStatus:at,currentState:T}),R(at),window.dispatchEvent(new CustomEvent("VoiceToggled",{detail:{enabled:at}})),window.agoraClient&&(window.agoraClient.isVoiceEnabled=at,window.agoraClient.microphoneTrack=W))};W&&lt();const gt=setInterval(lt,1e3);return()=>{clearInterval(gt)}},[W,T]);const je=async()=>{var lt;if(de)return G.log("Voice is disabled for this space, cannot toggle"),Se({title:"Voice Chat Disabled",description:"Voice chat has been disabled for this space by the owner.",status:"info",duration:3e3,isClosable:!0}),!1;try{const gt=T!==void 0?T:W?!W.muted:!1;if(G.log("AgoraProvider: Toggling voice, current state:",{isVoiceEnabled:T,currentState:gt,hasMicTrack:!!W,trackMuted:W==null?void 0:W.muted}),!W&&(G.log("AgoraProvider: No microphone track, initializing..."),!await Te()))return G.error("AgoraProvider: Failed to initialize microphone"),gt;const at=!gt;if(G.log("AgoraProvider: New voice state will be:",at),gt){if(W)try{G.log("AgoraProvider: Muting microphone track"),await W.setMuted(!0),W.muted||(G.warn("AgoraProvider: Track not muted after setMuted(true), trying again"),await W.setEnabled(!1)),G.log("AgoraProvider: Microphone track muted successfully, muted state:",W.muted)}catch(Ct){return G.error("Error muting track:",Ct),gt}}else if(W)try{Ie.current&&E&&!((lt=Ie.current.localTracks)!=null&&lt.includes(W))&&(G.log("AgoraProvider: Publishing microphone track"),await Ie.current.publish(W),G.log("AgoraProvider: Microphone track published successfully")),G.log("AgoraProvider: Unmuting microphone track"),await W.setMuted(!1),W.muted&&(G.warn("AgoraProvider: Track still muted after setMuted(false), trying again"),await W.setEnabled(!0)),G.log("AgoraProvider: Microphone track unmuted successfully, muted state:",W.muted)}catch(Ct){return G.error("Error unmuting track:",Ct),gt}return R(at),at}catch(gt){return G.error("Error toggling voice:",gt),T}},nt=async lt=>{try{re(lt),G.log("Microphone track updated successfully")}catch(gt){throw G.error("Error updating microphone track:",gt),gt}},dt=async()=>{if(!Ie.current||!i)return G.error("AgoraProvider: Voice chat not connected"),!1;try{if(J)return G.log("AgoraProvider: Stopping screen share"),ne&&(Array.isArray(ne)?(await Ie.current.unpublish(ne),ne.forEach(lt=>lt.close())):(await Ie.current.unpublish(ne),ne.close()),he(null)),Q(!1),G.log("AgoraProvider: Screen sharing stopped"),typeof window<"u"&&(window.agoraClient||(window.agoraClient={}),window.agoraClient.isScreenSharing=!1,window.agoraClient.screenTrack=null,window.dispatchEvent(new CustomEvent("ScreenShareToggled",{detail:{enabled:!1}}))),!1;G.log("AgoraProvider: Starting screen share");try{const lt=await LR.createScreenVideoTrack({encoderConfig:"1080p_1",optimizationMode:"detail"});return G.log("AgoraProvider: Screen track created:",lt),lt.on("track-ended",()=>{G.log("AgoraProvider: Screen sharing ended by browser UI"),Ie.current.unpublish(lt),lt.close(),he(null),Q(!1),typeof window<"u"&&(window.agoraClient||(window.agoraClient={}),window.agoraClient.isScreenSharing=!1,window.agoraClient.screenTrack=null,window.dispatchEvent(new CustomEvent("ScreenShareToggled",{detail:{enabled:!1}})))}),await Ie.current.publish(lt),he(lt),Q(!0),G.log("AgoraProvider: Screen sharing started"),typeof window<"u"&&(window.agoraClient||(window.agoraClient={}),window.agoraClient.isScreenSharing=!0,window.agoraClient.screenTrack=lt,window.dispatchEvent(new CustomEvent("ScreenShareToggled",{detail:{enabled:!0}}))),!0}catch(lt){return G.error("AgoraProvider: Error creating screen track:",lt),Q(!1),he(null),!1}}catch(lt){return G.error("AgoraProvider: Error toggling screen share:",lt),Q(!1),he(null),!1}};k.useEffect(()=>{if(G.log("AgoraProvider: Initializing window.agoraClient"),typeof window<"u"){window.agoraClient={isVoiceEnabled:!1,isJoined:!1,client:Ie.current,isScreenSharing:!1,screenTrack:null};const lt=at=>{G.log("AgoraProvider: Received ToggleScreenShare event"),dt().then(Ct=>{at.detail&&at.detail.callback&&at.detail.callback(!0,Ct)}).catch(Ct=>{G.error("AgoraProvider: Error handling ToggleScreenShare event:",Ct),at.detail&&at.detail.callback&&at.detail.callback(!1,J)})},gt=at=>{G.log("AgoraProvider: Received JoinVoiceChat event"),Ne().then(Ct=>{at.detail&&at.detail.callback&&at.detail.callback(Ct)}).catch(Ct=>{G.error("AgoraProvider: Error handling JoinVoiceChat event:",Ct),at.detail&&at.detail.callback&&at.detail.callback(!1)})};return window.addEventListener("ToggleScreenShare",lt),window.addEventListener("JoinVoiceChat",gt),()=>{window.removeEventListener("ToggleScreenShare",lt),window.removeEventListener("JoinVoiceChat",gt),typeof window<"u"&&window.agoraClient&&(G.log("AgoraProvider: Cleaning up window.agoraClient"),window.agoraClient=null)}}return()=>{typeof window<"u"&&window.agoraClient&&(G.log("AgoraProvider: Cleaning up window.agoraClient"),window.agoraClient=null)}},[]),k.useEffect(()=>{G.log("AgoraProvider: Voice enabled state changed:",T),typeof window<"u"&&(window.agoraClient||(window.agoraClient={}),window.agoraClient.isVoiceEnabled=T,window.agoraClient.microphoneTrack=W,window.agoraClient.client=Ie.current,window.dispatchEvent(new CustomEvent("VoiceToggled",{detail:{enabled:T}})),G.log("AgoraProvider: Updated window.agoraClient and dispatched event:",{isVoiceEnabled:T}))},[T,W]);const ft={client:Ie.current,isJoined:E,isVoiceEnabled:T,users:O,error:D,channel:F,appId:e,toggleVoice:je,leaveChannel:be,joinChannel:Ne,microphoneTrack:W,isReady:le,createMicrophoneTrack:nt,isScreenSharing:J,screenTrack:ne,toggleScreenShare:dt,voiceDisabled:de};return S.jsx(sce.Provider,{value:ft,children:n})},ace=()=>{const n=k.useContext(sce);if(!n)throw new Error("useAgoraContext must be used within an AgoraProvider");return n};oce.propTypes={children:An.node.isRequired,appId:An.string.isRequired,channel:An.string.isRequired,token:An.string,uid:An.oneOfType([An.string,An.number])};const GWe=()=>{var we,Re;const{client:n,isVoiceEnabled:e,isJoined:i,users:o,error:l,microphoneTrack:u,isReady:p,channel:y,appId:E,toggleVoice:b,joinChannel:T,leaveChannel:R,createMicrophoneTrack:O,isScreenSharing:L,screenTrack:D,toggleScreenShare:U,voiceDisabled:F}=ace(),[Y,W]=k.useState(e!==void 0?e:((we=window.agoraClient)==null?void 0:we.isVoiceEnabled)||!1),[re,le]=k.useState(L!==void 0?L:((Re=window.agoraClient)==null?void 0:Re.isScreenSharing)||!1),[ie,me]=k.useState(F!==void 0?F:!1),[q,J]=k.useState(!0);k.useEffect(()=>{var Te;e!==void 0?W(e):((Te=window.agoraClient)==null?void 0:Te.isVoiceEnabled)!==void 0?W(window.agoraClient.isVoiceEnabled):u&&W(!u.muted)},[e,u]),k.useEffect(()=>{var Te;L!==void 0?le(L):((Te=window.agoraClient)==null?void 0:Te.isScreenSharing)!==void 0&&le(window.agoraClient.isScreenSharing)},[L]),k.useEffect(()=>{F!==void 0&&me(F)},[F]);const Q=k.useRef({isVoiceEnabled:Y,isScreenSharing:re,isJoined:i,users:o,error:l,isReady:p,channel:y,appId:E,voiceDisabled:ie});k.useEffect(()=>{Q.current={isVoiceEnabled:Y,isScreenSharing:re,isJoined:i,users:o,error:l,isReady:p,channel:y,appId:E,voiceDisabled:ie}},[Y,re,i,o,l,p,y,E,ie]),k.useEffect(()=>{const Te=setTimeout(()=>{J(!1)},5e3);return()=>clearTimeout(Te)},[]),k.useEffect(()=>{p&&J(!1)},[p]),k.useEffect(()=>{},[e,Y,L,re,i,o,l,p,y,E,u,D]);const ne=async()=>{try{const Te=await b();if(Te!==void 0)W(Te);else{const Ne=!Y;W(Ne),window.agoraClient&&(window.agoraClient.isVoiceEnabled=Ne)}return Te!==void 0?Te:!Y}catch(Te){return console.error("useVoiceChat: Error toggling voice:",Te),Y}},he=async()=>{try{const Te=await U();if(Te!==void 0)le(Te);else{const Ne=!re;le(Ne),window.agoraClient&&(window.agoraClient.isScreenSharing=Ne)}return Te!==void 0?Te:!re}catch(Te){return console.error("useVoiceChat: Error toggling screen share:",Te),re}},de=async()=>{Y&&u&&await ne()},pe=async()=>{!Y&&u&&await ne()},Se=Te=>o.some(Ne=>{var be;return Ne.uid===Te&&((be=Ne.audioTrack)==null?void 0:be.isPlaying)}),Ie=k.useCallback(()=>{if(!u||!Y)return 0;try{return u.getVolumeLevel()}catch(Te){return console.error("Error getting volume level:",Te),0}},[u,Y]);return{isVoiceEnabled:Y,isScreenSharing:re,isJoined:i,users:o,error:l,toggleVoice:ne,toggleScreenShare:he,mute:de,unmute:pe,isUserSpeaking:Se,getVolumeLevel:Ie,microphoneTrack:u,screenTrack:D,isLoading:q,channel:y,appId:E,joinChannel:T,leaveChannel:R,client:n,setMicrophoneDevice:async Te=>{try{if(!Te){console.error("No device ID provided");return}if(!n||!i){console.error("Client not initialized or not joined to a channel");return}u&&(Y&&await n.unpublish(u),await u.close());const Ne=await LR.createMicrophoneAudioTrack({microphoneId:Te,encoderConfig:"music_standard"});O&&await O(Ne),Y&&await n.publish(Ne)}catch(Ne){throw console.error("Error changing microphone device:",Ne),Ne}},voiceDisabled:ie}},HWe=({size:n="md",tooltipPlacement:e="top",defaultMuted:i=!0,joinOnClick:o=!0,className:l="voice-button"})=>{const{isVoiceEnabled:u,toggleVoice:p,isJoined:y,joinChannel:E,channel:b,client:T,voiceDisabled:R}=GWe(),[O,L]=k.useState(!1),[D,U]=k.useState(!1);k.useEffect(()=>{const W=()=>{G.log("VoiceButton: Player instantiated, showing button"),U(!0)};return window.addEventListener("PlayerInstantiated",W),window.isPlayerInstantiated&&(G.log("VoiceButton: Player was already instantiated"),U(!0)),()=>{window.removeEventListener("PlayerInstantiated",W)}},[]),k.useEffect(()=>{},[u,y,b,T,D,R]);const F=async()=>{if(!(O||R)){L(!0);try{if(!y&&o)try{await E()}catch(re){re.message&&re.message.includes("already in connecting/connected state")||console.error("VoiceButton: Error joining channel:",re)}const W=await p()}catch(W){console.error("VoiceButton: Error toggling voice:",W)}finally{L(!1)}}},Y=()=>R?"Voice chat is disabled for this space":D?O?"Processing...":y?u?"Turn microphone off":"Turn microphone on":"Connecting to voice chat...":"Waiting for player to be ready...";return!D||R?null:S.jsx(Kf,{label:Y(),placement:e,hasArrow:!0,children:S.jsxs(He,{position:"relative",cursor:"pointer",onClick:F,children:[S.jsx(jc,{size:n,borderRadius:"full",bg:u?"green.500":"red.500",icon:u?S.jsx(qae,{color:"white"}):S.jsx(Kae,{color:"white"}),borderWidth:"1px",borderColor:"whiteAlpha.300",className:l,"data-testid":"voice-button"}),O&&S.jsx(He,{position:"absolute",top:"0",left:"0",right:"0",bottom:"0",display:"flex",alignItems:"center",justifyContent:"center",bg:"rgba(0, 0, 0, 0.6)",borderRadius:"full",children:S.jsx(vd,{size:"sm",color:"white"})})]})})},$We=yi.createContext({user:null}),KWe=({userNickname:n})=>{const{client:e,channel:i,screenTrack:o,isScreenSharing:l,toggleScreenShare:u}=ace(),[p,y]=k.useState([]),[E,b]=k.useState(!1),[T,R]=k.useState(!0);k.useRef({});const O=k.useRef(null);k.useRef(null);const{user:L}=k.useContext($We)||{user:null},[D,U]=k.useState({}),F=k.useRef(o),[Y,W]=k.useState(null),{isOpen:re,onOpen:le,onClose:ie}=yu(),[me,q]=k.useState(!1),J=k.useRef(null),Q=k.useRef(null);k.useEffect(()=>{F.current=o},[o]),k.useEffect(()=>{if(!e||!i){b(!1);return}const Se=setTimeout(()=>{R(!1)},5e3);if(e.connectionState==="CONNECTED")b(!0),R(!1);else{b(!1);const Fe=we=>{we==="CONNECTED"?(b(!0),R(!1)):b(!1)};return e.on("connection-state-change",Fe),()=>{e.off("connection-state-change",Fe),clearTimeout(Se)}}return()=>{clearTimeout(Se)}},[e,i]),k.useEffect(()=>{const Se=async()=>{const Ie={...D};let Fe=!1;for(const we of p){if(D[we.uid])continue;let Re=null,Te=we.uid;if(typeof Te=="string"&&(Te.includes("-")?(Re=Te.split("-")[0],Te=Te.split("-")[1]):Te.includes("_")&&(Re=Te.split("_")[0],Te=Te.split("_")[1])),Te)try{const Ne=await Fc(Te);Ne&&Ne.Nickname?(Ie[we.uid]=Ne.Nickname,Fe=!0):Re?(Ie[we.uid]=Re,Fe=!0):(Ie[we.uid]="User",Fe=!0)}catch(Ne){console.error("Error fetching user profile:",Ne),Re?(Ie[we.uid]=Re,Fe=!0):(Ie[we.uid]="User",Fe=!0)}else Re?(Ie[we.uid]=Re,Fe=!0):(Ie[we.uid]="User",Fe=!0)}Fe&&U(Ie)};p.length>0&&Se()},[p,D]),k.useEffect(()=>{if(!e||!i||!E)return;const Se=async(we,Re)=>{if(Re==="video")try{await e.subscribe(we,Re),y(Te=>Te.some(Ne=>Ne.uid===we.uid)?Te:[...Te,we])}catch(Te){console.error("Error subscribing to remote video track:",Te)}},Ie=(we,Re)=>{if(Re==="video"){if(we.videoTrack)try{we.videoTrack.stop()}catch(Te){console.error("Error stopping video track:",Te)}if(y(Te=>Te.filter(Ne=>Ne.uid!==we.uid)),l&&F.current&&O.current)try{F.current.play(O.current)}catch(Te){console.error("Error replaying local screen track:",Te)}}},Fe=we=>{const Re=p.find(Te=>Te.uid===we.uid);if(Re&&Re.videoTrack)try{Re.videoTrack.stop()}catch(Te){console.error("Error stopping video track:",Te)}if(y(Te=>Te.filter(Ne=>Ne.uid!==we.uid)),l&&F.current&&O.current)try{F.current.play(O.current)}catch(Te){console.error("Error replaying local screen track:",Te)}};return e.on("user-published",Se),e.on("user-unpublished",Ie),e.on("user-left",Fe),()=>{e.off("user-published",Se),e.off("user-unpublished",Ie),e.off("user-left",Fe)}},[e,i,E,p,l]),k.useEffect(()=>{if(p.forEach(Se=>{if(Se.videoTrack)try{Se.videoTrack.play(`video-container-${Se.uid}`)}catch(Ie){console.error("Error playing video track:",Ie)}}),l&&F.current&&O.current)try{F.current.play(O.current)}catch(Se){console.error("Error replaying local screen track:",Se)}},[p,l]),k.useEffect(()=>{if(l&&o&&O.current)try{o.play(O.current)}catch(Se){console.error("Error playing local screen track:",Se)}},[l,o]),k.useEffect(()=>()=>{if(p.forEach(Se=>{if(Se.videoTrack)try{Se.videoTrack.stop()}catch(Ie){console.error("Error stopping video track on unmount:",Ie)}}),o)try{o.stop()}catch(Se){console.error("Error stopping local screen track on unmount:",Se)}},[p,o]);const ne=()=>{u()},he=Se=>l&&L&&(Se===L.uid||Se===(e==null?void 0:e.uid))?n||"You":D[Se]?D[Se]:typeof Se=="string"?Se.includes("-")?Se.split("-")[0]:Se.includes("_")?Se.split("_")[0]:Se:"User",de=Se=>{W(Se),le()},pe=()=>{W({isLocal:!0}),le()};return k.useEffect(()=>{re&&Y?setTimeout(()=>{if(Y.isLocal&&F.current)try{F.current.play("modal-screen-container"),q(!0)}catch(Se){console.error("Error playing local screen in modal:",Se)}else if(Y.videoTrack)try{Y.videoTrack.play("modal-screen-container"),q(!0)}catch(Se){console.error("Error playing remote screen in modal:",Se)}},500):re||(q(!1),W(null),setTimeout(()=>{if(l&&F.current)try{F.current.play("local-screen-container")}catch(Se){console.error("Error playing local screen in small container:",Se)}p.forEach(Se=>{if(Se.videoTrack)try{Se.videoTrack.play(`video-container-${Se.uid}`)}catch(Ie){console.error(`Error playing remote screen ${Se.uid} in small container:`,Ie)}})},500))},[re,Y,l,p]),!E||T&&p.length===0&&!l||p.length===0&&!l?null:S.jsxs(S.Fragment,{children:[!re&&S.jsxs(He,{position:"fixed",top:"20px",left:"20px",zIndex:1e4,overflow:"visible",ref:J,children:[l&&o&&S.jsxs(He,{position:"relative",mb:4,borderRadius:"md",overflow:"hidden",boxShadow:"xl",bg:"black",width:"200px",height:"120px",cursor:"pointer",transition:"all 0.2s",_hover:{filter:"brightness(0.8)",transform:"scale(1.05)"},onClick:pe,children:[S.jsx(He,{id:"local-screen-container",width:"100%",height:"100%",position:"relative"}),S.jsx(He,{position:"absolute",bottom:2,left:2,color:"white",fontSize:"xs",bg:"rgba(0,0,0,0.5)",px:2,py:1,borderRadius:"md",zIndex:5,children:n?`${n}'s Screen`:"Your Screen"})]}),p.map(Se=>{const Ie=D[Se.uid]||he(Se.uid);return S.jsxs(He,{position:"relative",mb:4,borderRadius:"md",overflow:"hidden",boxShadow:"xl",bg:"black",width:"200px",height:"120px",cursor:"pointer",transition:"all 0.2s",_hover:{filter:"brightness(0.8)",transform:"scale(1.05)"},onClick:()=>de(Se),children:[S.jsx(He,{id:`video-container-${Se.uid}`,width:"100%",height:"100%",position:"relative"}),S.jsx(He,{position:"absolute",bottom:2,left:2,color:"white",fontSize:"xs",bg:"rgba(0,0,0,0.5)",px:2,py:1,borderRadius:"md",zIndex:5,children:`${Ie}'s Screen`})]},Se.uid)})]}),re&&S.jsx(He,{position:"fixed",top:"0",left:"0",width:"100vw",height:"100vh",bg:"rgba(0,0,0,0.8)",zIndex:1e4,display:"flex",justifyContent:"center",alignItems:"center",onClick:ie,children:S.jsxs(He,{width:"80vw",height:"80vh",bg:"black",borderRadius:"md",overflow:"hidden",position:"relative",onClick:Se=>Se.stopPropagation(),children:[!me&&S.jsxs(He,{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",color:"white",textAlign:"center",children:[S.jsx(vd,{size:"xl"}),S.jsx($e,{mt:4,children:"Loading screen share..."})]}),S.jsx(He,{id:"modal-screen-container",width:"100%",height:"100%",position:"relative",ref:Q}),S.jsx(He,{position:"absolute",top:2,right:2,color:"white",bg:"rgba(0,0,0,0.5)",borderRadius:"full",width:"30px",height:"30px",display:"flex",justifyContent:"center",alignItems:"center",cursor:"pointer",onClick:ie,children:""}),S.jsx(He,{position:"absolute",bottom:4,left:4,color:"white",fontSize:"sm",bg:"rgba(0,0,0,0.5)",px:3,py:2,borderRadius:"md",children:Y!=null&&Y.isLocal?n?`${n}'s Screen`:"Your Screen":`${D[Y==null?void 0:Y.uid]||he(Y==null?void 0:Y.uid)}'s Screen`}),(Y==null?void 0:Y.isLocal)&&S.jsx(He,{position:"absolute",bottom:4,right:4,children:S.jsx(On,{colorScheme:"red",size:"sm",onClick:ne,children:"Stop Sharing"})})]})})]})},qWe=({onClose:n})=>{const e=ea(),[i,o]=k.useState(!1),[l,u]=k.useState(!1);k.useEffect(()=>{const E=()=>{window.agoraClient&&u(!!window.agoraClient.isScreenSharing)};E();const b=setInterval(E,1e3),T=()=>{E()};return window.addEventListener("ScreenShareToggled",T),()=>{clearInterval(b),window.removeEventListener("ScreenShareToggled",T)}},[]);const p=async E=>{if(E.preventDefault(),E.stopPropagation(),n&&n(),!window.agoraClient||!window.agoraClient.client){e({title:"Screen sharing not available",description:"Voice chat must be connected to use screen sharing",status:"warning",duration:3e3,isClosable:!0});return}try{if(o(!0),window.agoraClient.isJoined)y();else{const b=new CustomEvent("JoinVoiceChat",{detail:{callback:T=>{if(!T){console.error("ScreenShareMenuOption: Failed to join voice chat"),e({title:"Connection failed",description:"Could not connect to voice chat",status:"error",duration:3e3,isClosable:!0}),o(!1);return}y()}}});window.dispatchEvent(b)}}catch(b){console.error("Error in screen share handler:",b),o(!1),e({title:"Screen sharing error",description:b.message||"Failed to toggle screen sharing",status:"error",duration:5e3,isClosable:!0})}},y=async()=>{try{const E=new CustomEvent("ToggleScreenShare",{detail:{callback:(b,T)=>{o(!1),b?(u(T),e(T?{title:"Screen sharing started",status:"success",duration:3e3,isClosable:!0}:{title:"Screen sharing stopped",status:"info",duration:3e3,isClosable:!0})):e({title:"Screen sharing error",description:"Failed to toggle screen sharing",status:"error",duration:5e3,isClosable:!0})}}});window.dispatchEvent(E)}catch(E){console.error("Error toggling screen share:",E),o(!1),e({title:"Screen sharing error",description:E.message||"Failed to toggle screen sharing",status:"error",duration:5e3,isClosable:!0})}};return S.jsx($e,{fontSize:"sm",cursor:"pointer",_hover:{bg:"whiteAlpha.200"},p:1.5,borderRadius:"md",onClick:p,color:l?"red.300":"white",children:i?"Connecting...":l?"Stop Screen Sharing":"Share Screen"})};function YWe({open:n,onClose:e}){const[i,o]=k.useState(0);return S.jsxs(_s,{isOpen:n,onClose:e,size:"md",isCentered:!0,children:[S.jsx(vs,{backdropFilter:"blur(4px)"}),S.jsxs(ys,{bg:"rgba(23, 25, 35, 0.95)",color:"white",borderRadius:"md",boxShadow:"0 4px 20px rgba(0, 0, 0, 0.5)",maxW:"600px",h:"350px",overflow:"hidden",children:[S.jsx(Do,{borderBottom:"1px solid",borderColor:"whiteAlpha.200",py:2,fontSize:"md",fontWeight:"600",children:"Controls"}),S.jsx(Ns,{size:"sm",color:"whiteAlpha.700",_hover:{color:"white",bg:"whiteAlpha.100"}}),S.jsx(Es,{p:0,display:"flex",children:S.jsxs($S,{orientation:"vertical",variant:"unstyled",index:i,onChange:o,display:"flex",flexGrow:1,children:[S.jsxs(KS,{bg:"rgba(0, 0, 0, 0.2)",w:"80px",py:4,borderRight:"1px solid",borderColor:"whiteAlpha.200",children:[S.jsxs(ya,{display:"flex",flexDirection:"column",alignItems:"center",py:3,_selected:{bg:"whiteAlpha.100",color:"blue.300"},_hover:{bg:"whiteAlpha.50"},children:[S.jsx(en,{as:X9e,mb:1}),S.jsx($e,{fontSize:"xs",children:"Movement"})]}),S.jsxs(ya,{display:"flex",flexDirection:"column",alignItems:"center",py:3,_selected:{bg:"whiteAlpha.100",color:"blue.300"},_hover:{bg:"whiteAlpha.50"},children:[S.jsx(en,{as:J9e,mb:1}),S.jsx($e,{fontSize:"xs",children:"Camera"})]}),S.jsxs(ya,{display:"flex",flexDirection:"column",alignItems:"center",py:3,_selected:{bg:"whiteAlpha.100",color:"blue.300"},_hover:{bg:"whiteAlpha.50"},children:[S.jsx(en,{as:q9e,mb:1}),S.jsx($e,{fontSize:"xs",children:"Actions"})]}),S.jsxs(ya,{display:"flex",flexDirection:"column",alignItems:"center",py:3,_selected:{bg:"whiteAlpha.100",color:"blue.300"},_hover:{bg:"whiteAlpha.50"},children:[S.jsx(en,{as:Y9e,mb:1}),S.jsx($e,{fontSize:"xs",children:"Tips"})]})]}),S.jsxs(wR,{flexGrow:1,display:"flex",flexDirection:"column",children:[S.jsxs(dc,{p:4,display:"flex",flexDirection:"column",h:"100%",children:[S.jsx($e,{fontSize:"sm",fontWeight:"600",mb:3,color:"blue.300",children:"Movement Controls"}),S.jsxs(Mr,{wrap:"wrap",gap:3,children:[S.jsx(uu,{keyLabel:"W",description:"Move Forward"}),S.jsx(uu,{keyLabel:"A",description:"Move Left"}),S.jsx(uu,{keyLabel:"S",description:"Move Backward"}),S.jsx(uu,{keyLabel:"D",description:"Move Right"}),S.jsx(uu,{keyLabel:"Shift",description:"Run"}),S.jsx(uu,{keyLabel:"Space",description:"Jump / Double Jump"})]})]}),S.jsxs(dc,{p:4,display:"flex",flexDirection:"column",h:"100%",children:[S.jsx($e,{fontSize:"sm",fontWeight:"600",mb:3,color:"blue.300",children:"Camera Controls"}),S.jsxs(Mr,{wrap:"wrap",gap:3,children:[S.jsx(uu,{keyLabel:"Mouse",description:"Look Around"}),S.jsx(uu,{keyLabel:"Click + Drag",description:"Rotate Camera"}),S.jsx(uu,{keyLabel:"Scroll",description:"Zoom In/Out"})]})]}),S.jsxs(dc,{p:4,display:"flex",flexDirection:"column",h:"100%",children:[S.jsx($e,{fontSize:"sm",fontWeight:"600",mb:3,color:"blue.300",children:"Action Controls"}),S.jsxs(Mr,{wrap:"wrap",gap:3,children:[S.jsx(uu,{keyLabel:"E",description:"Interact"}),S.jsx(uu,{keyLabel:"F",description:"Emote Menu"}),S.jsx(uu,{keyLabel:"T",description:"Chat"}),S.jsx(uu,{keyLabel:"M",description:"Mute Mic"})]})]}),S.jsxs(dc,{p:4,display:"flex",flexDirection:"column",h:"100%",children:[S.jsx($e,{fontSize:"sm",fontWeight:"600",mb:3,color:"blue.300",children:"Tips & Tricks"}),S.jsxs(Qn,{align:"stretch",spacing:2,children:[S.jsx($e,{fontSize:"xs",children:" Double-tap Shift to auto-run"}),S.jsx($e,{fontSize:"xs",children:" Press ESC to access settings"}),S.jsx($e,{fontSize:"xs",children:" Click on players to view their profile"}),S.jsx($e,{fontSize:"xs",children:" Use the minimap to navigate"})]})]})]})]})})]})]})}const uu=({keyLabel:n,description:e})=>S.jsx(He,{bg:"whiteAlpha.100",borderRadius:"md",p:2,minW:"120px",maxW:"180px",children:S.jsxs(Cn,{spacing:2,children:[S.jsx(He,{bg:"whiteAlpha.200",borderRadius:"md",px:2,py:1,fontSize:"xs",fontWeight:"bold",minW:"30px",textAlign:"center",children:n}),S.jsx($e,{fontSize:"xs",children:e})]})}),XWe=({isOpen:n,onClose:e,containerRef:i})=>{const[o,l]=k.useState([]),[u,p]=k.useState(""),[y,E]=k.useState(0),[b,T]=k.useState(100),[R,O]=k.useState(100),[L,D]=k.useState(!0),[U,F]=k.useState(!0),[Y,W]=k.useState(!1),[re,le]=k.useState(null),[ie,me]=k.useState(null),[q,J]=k.useState(null);k.useEffect(()=>{if(!n)return;(async()=>{try{await navigator.mediaDevices.getUserMedia({audio:!0});const Se=await LR.getMicrophones();l(Se),Se.length>0&&p(Se[0].deviceId)}catch(Se){console.error("Error getting audio devices:",Se)}})()},[n]),k.useEffect(()=>{if(!n||!Y){E(0);return}let pe;return(async()=>{try{const Ie=await navigator.mediaDevices.getUserMedia({audio:{deviceId:u?{exact:u}:void 0}});J(Ie);const Fe=new(window.AudioContext||window.webkitAudioContext),we=Fe.createAnalyser(),Re=Fe.createMediaStreamSource(Ie);we.fftSize=256,we.smoothingTimeConstant=.8,Re.connect(we),le(Fe),me(we);const Te=new Uint8Array(we.frequencyBinCount),Ne=()=>{we.getByteFrequencyData(Te);const be=Math.sqrt(Te.reduce((nt,dt)=>nt+dt*dt,0)/Te.length),je=Math.min(be*3,255)/255*100*(b/100);E(Math.min(je,100)),Y&&n&&(pe=requestAnimationFrame(Ne))};Ne()}catch(Ie){console.error("Error setting up audio analysis:",Ie),E(0)}})(),()=>{pe&&cancelAnimationFrame(pe),q&&(q.getTracks().forEach(Ie=>Ie.stop()),J(null)),re&&(re.close(),le(null)),me(null),E(0)}},[Y,n,u,b]);const Q=pe=>{const Se=pe.target.value;p(Se)},ne=pe=>{T(pe)},he=pe=>{O(pe)},de=()=>{W(!Y)};return S.jsx(Bc,{containerRef:i,children:S.jsxs(_s,{isOpen:n,onClose:e,size:"md",isCentered:!0,children:[S.jsx(vs,{bg:"rgba(0, 0, 0, 0.8)",backdropFilter:"blur(8px)"}),S.jsxs(ys,{bg:"#1a1a1a",color:"white",borderRadius:"xl",border:"1px solid #333",maxW:"500px",children:[S.jsx(Do,{fontSize:"md",fontWeight:"600",pb:1,pt:3,px:4,color:"white",children:"Voice Chat Settings"}),S.jsx(Ns,{color:"white",bg:"rgba(255,255,255,0.1)",_hover:{color:"gray.400",bg:"transparent"},borderRadius:"full",size:"sm",top:2,right:3}),S.jsx(Es,{px:4,py:3,children:S.jsxs(Qn,{spacing:4,align:"stretch",children:[S.jsxs(br,{children:[S.jsxs(Ei,{fontSize:"sm",fontWeight:"500",color:"white",mb:2,children:["Microphone",S.jsx(Mc,{ml:2,bg:Y?"rgba(34, 197, 94, 0.2)":"rgba(239, 68, 68, 0.2)",color:Y?"#22c55e":"#ef4444",fontSize:"xs",px:2,py:1,borderRadius:"full",children:Y?"Enabled":"Muted"})]}),S.jsxs(yie,{value:u,onChange:Q,bg:"rgba(255,255,255,0.05)",borderColor:"rgba(255,255,255,0.15)",_hover:{borderColor:"rgba(255,255,255,0.3)"},_focus:{borderColor:"rgba(255,255,255,0.5)",boxShadow:"0 0 0 1px rgba(255,255,255,0.3)"},borderRadius:"lg",size:"sm",fontSize:"xs",children:[o.map(pe=>S.jsx("option",{value:pe.deviceId,style:{backgroundColor:"#1a1a1a",color:"white"},children:pe.label||`Microphone ${pe.deviceId.slice(0,5)}...`},pe.deviceId)),o.length===0&&S.jsx("option",{value:"",style:{backgroundColor:"#1a1a1a",color:"white"},children:"No microphones found"})]})]}),S.jsxs(He,{children:[S.jsx($e,{fontSize:"sm",fontWeight:"500",color:"white",mb:2,children:"Microphone Level"}),S.jsx(Zy,{value:y,colorScheme:"green",size:"sm",borderRadius:"full",bg:"rgba(255,255,255,0.1)",hasStripe:y>20,isAnimated:y>20,sx:{"& > div":{backgroundColor:"#22c55e !important"}}})]}),S.jsxs(br,{children:[S.jsxs(Ei,{fontSize:"sm",fontWeight:"500",color:"white",mb:2,children:["Microphone Volume: ",b,"%"]}),S.jsxs(CS,{value:b,onChange:ne,min:0,max:100,step:1,colorScheme:"gray",children:[S.jsx(IS,{bg:"rgba(255,255,255,0.1)",h:"6px",borderRadius:"full",children:S.jsx(AS,{})}),S.jsx(RS,{boxSize:4})]})]}),S.jsxs(br,{children:[S.jsxs(Ei,{fontSize:"sm",fontWeight:"500",color:"white",mb:2,children:["Speaker Volume: ",R,"%"]}),S.jsxs(CS,{value:R,onChange:he,min:0,max:100,step:1,colorScheme:"gray",children:[S.jsx(IS,{bg:"rgba(255,255,255,0.1)",h:"6px",borderRadius:"full",children:S.jsx(AS,{})}),S.jsx(RS,{boxSize:4})]})]}),S.jsxs(br,{display:"flex",alignItems:"center",justifyContent:"space-between",children:[S.jsx(Ei,{mb:"0",fontSize:"sm",fontWeight:"500",color:"white",children:"Microphone Enabled"}),S.jsx(ld,{isChecked:Y,onChange:de,colorScheme:"gray",size:"md"})]}),S.jsxs(br,{display:"flex",alignItems:"center",justifyContent:"space-between",children:[S.jsx(Ei,{mb:"0",fontSize:"sm",fontWeight:"500",color:"white",children:"Echo Cancellation"}),S.jsx(ld,{isChecked:L,onChange:()=>D(!L),colorScheme:"gray",size:"md"})]}),S.jsxs(br,{display:"flex",alignItems:"center",justifyContent:"space-between",children:[S.jsx(Ei,{mb:"0",fontSize:"sm",fontWeight:"500",color:"white",children:"Noise Suppression"}),S.jsx(ld,{isChecked:U,onChange:()=>F(!U),colorScheme:"gray",size:"md"})]}),S.jsx(He,{mt:2,p:3,bg:"rgba(255,255,255,0.05)",borderRadius:"lg",border:"1px solid rgba(255,255,255,0.1)",children:S.jsx($e,{fontSize:"xs",color:"gray.400",children:"Note: These settings will be applied when you join a voice chat."})})]})})]})]})})};function JWe({open:n,onClose:e,containerRef:i}){const[o,l]=k.useState(!1),[u,p]=k.useState(100),[y,E]=k.useState(100),[b,T]=k.useState(100),R=Wa(),O=()=>{l(!0)},L=()=>{l(!1)},D=Y=>{p(Y),R("SetMasterVolume",{volume:Y/100})},U=Y=>{E(Y),R("SetMusicVolume",{volume:Y/100})},F=Y=>{T(Y),R("SetSFXVolume",{volume:Y/100})};return n?S.jsxs(S.Fragment,{children:[S.jsx(Bc,{containerRef:i,children:S.jsx(He,{position:"absolute",top:"0",left:"0",right:"0",bottom:"0",backdropFilter:"blur(2px)",bg:"rgba(0, 0, 0, 0.3)",zIndex:"999",opacity:n?1:0,visibility:n?"visible":"hidden",transition:"opacity 0.3s ease-in-out, visibility 0.3s ease-in-out",pointerEvents:n?"auto":"none",onClick:e})}),S.jsx(Bc,{containerRef:i,children:S.jsxs(He,{position:"absolute",top:"0",right:"0",bottom:"0",width:"35%",minWidth:"600px",bg:"rgba(26, 32, 44, 0.95)",backdropFilter:"blur(10px)",borderLeft:"1px solid rgba(255, 255, 255, 0.1)",zIndex:"1000",color:"white",overflowY:"auto",transform:n?"translateX(0)":"translateX(100%)",transition:"transform 0.4s cubic-bezier(0.4, 0, 0.2, 1)",maxHeight:"100vh",children:[S.jsx(He,{p:4,borderBottom:"1px solid rgba(255, 255, 255, 0.1)",position:"sticky",top:"0",bg:"rgba(26, 32, 44, 0.95)",backdropFilter:"blur(10px)",zIndex:"1001",children:S.jsxs(Cn,{justify:"space-between",align:"center",children:[S.jsx($e,{fontSize:"xl",fontWeight:"bold",children:"Settings"}),S.jsx(On,{variant:"ghost",size:"xs",onClick:e,color:"white",_hover:{bg:"whiteAlpha.200"},"aria-label":"Close settings",minW:"auto",h:"auto",p:1,children:""})]})}),S.jsx(He,{p:4,children:S.jsxs($S,{variant:"unstyled",colorScheme:"blue",children:[S.jsxs(KS,{mb:4,bg:"rgba(255, 255, 255, 0.1)",borderRadius:"md",p:.5,children:[S.jsx(ya,{_selected:{bg:"blue.500",color:"white",borderRadius:"sm"},color:"whiteAlpha.700",_hover:{color:"white"},flex:"1",fontWeight:"medium",fontSize:"sm",py:2,px:3,children:"Audio & Video"}),S.jsx(ya,{_selected:{bg:"blue.500",color:"white",borderRadius:"sm"},color:"whiteAlpha.700",_hover:{color:"white"},flex:"1",fontWeight:"medium",fontSize:"sm",py:2,px:3,children:"Graphics"})]}),S.jsxs(wR,{children:[S.jsx(dc,{p:0,children:S.jsxs(Qn,{spacing:6,align:"stretch",children:[S.jsxs(He,{children:[S.jsx($e,{fontSize:"lg",fontWeight:"bold",mb:4,color:"white",children:"Audio"}),S.jsxs(Qn,{spacing:3,align:"stretch",children:[S.jsxs(Cn,{justify:"space-between",align:"center",children:[S.jsx($e,{fontSize:"sm",color:"white",minW:"120px",children:"Master Volume"}),S.jsxs(Cn,{spacing:3,flex:"1",justify:"flex-end",children:[S.jsxs($e,{fontSize:"sm",color:"whiteAlpha.800",minW:"50px",textAlign:"right",children:[u,"%"]}),S.jsx(He,{width:"180px",children:S.jsxs(CS,{value:u,onChange:D,min:0,max:100,step:1,colorScheme:"blue",size:"sm",children:[S.jsx(IS,{bg:"whiteAlpha.300",h:"4px",children:S.jsx(AS,{})}),S.jsx(RS,{boxSize:4})]})})]})]}),S.jsxs(Cn,{justify:"space-between",align:"center",children:[S.jsx($e,{fontSize:"sm",color:"white",minW:"120px",children:"Music Volume"}),S.jsxs(Cn,{spacing:3,flex:"1",justify:"flex-end",children:[S.jsxs($e,{fontSize:"sm",color:"whiteAlpha.800",minW:"50px",textAlign:"right",children:[y,"%"]}),S.jsx(He,{width:"180px",children:S.jsxs(CS,{value:y,onChange:U,min:0,max:100,step:1,colorScheme:"green",size:"sm",children:[S.jsx(IS,{bg:"whiteAlpha.300",h:"4px",children:S.jsx(AS,{})}),S.jsx(RS,{boxSize:4})]})})]})]}),S.jsxs(Cn,{justify:"space-between",align:"center",children:[S.jsx($e,{fontSize:"sm",color:"white",minW:"120px",children:"Sound Effects Volume"}),S.jsxs(Cn,{spacing:3,flex:"1",justify:"flex-end",children:[S.jsxs($e,{fontSize:"sm",color:"whiteAlpha.800",minW:"50px",textAlign:"right",children:[b,"%"]}),S.jsx(He,{width:"180px",children:S.jsxs(CS,{value:b,onChange:F,min:0,max:100,step:1,colorScheme:"orange",size:"sm",children:[S.jsx(IS,{bg:"whiteAlpha.300",h:"4px",children:S.jsx(AS,{})}),S.jsx(RS,{boxSize:4})]})})]})]})]})]}),S.jsxs(He,{children:[S.jsx($e,{fontSize:"lg",fontWeight:"bold",mb:4,color:"white",children:"Voice Chat"}),S.jsxs(Cn,{justify:"space-between",align:"center",children:[S.jsx($e,{fontSize:"sm",color:"white",children:"Microphone"}),S.jsx(On,{onClick:O,variant:"outline",size:"sm",colorScheme:"gray",borderColor:"whiteAlpha.400",color:"white",_hover:{bg:"whiteAlpha.200"},rightIcon:S.jsx(He,{as:"span",children:""}),px:4})]})]})]})}),S.jsx(dc,{p:0,children:S.jsxs(Qn,{spacing:4,align:"stretch",children:[S.jsx($e,{fontSize:"md",fontWeight:"semibold",children:"Graphics Settings"}),S.jsx(He,{p:4,bg:"whiteAlpha.100",borderRadius:"md",border:"1px solid",borderColor:"whiteAlpha.200",children:S.jsx($e,{color:"whiteAlpha.700",fontSize:"sm",children:"Graphics settings will be available here."})})]})})]})]})})]})}),o&&S.jsx(XWe,{isOpen:o,onClose:L,containerRef:i})]}):null}function QWe(n){return sr({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"circle",attr:{cx:"12",cy:"8",r:"7"}},{tag:"polyline",attr:{points:"8.21 13.89 7 23 12 20 17 23 15.79 13.88"}}]})(n)}function ZWe(n){return sr({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"path",attr:{d:"M23 19a2 2 0 0 1-2 2H3a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h4l2-3h6l2 3h4a2 2 0 0 1 2 2z"}},{tag:"circle",attr:{cx:"12",cy:"13",r:"4"}}]})(n)}function NZ(n){return sr({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"rect",attr:{x:"2",y:"2",width:"20",height:"20",rx:"2.18",ry:"2.18"}},{tag:"line",attr:{x1:"7",y1:"2",x2:"7",y2:"22"}},{tag:"line",attr:{x1:"17",y1:"2",x2:"17",y2:"22"}},{tag:"line",attr:{x1:"2",y1:"12",x2:"22",y2:"12"}},{tag:"line",attr:{x1:"2",y1:"7",x2:"7",y2:"7"}},{tag:"line",attr:{x1:"2",y1:"17",x2:"7",y2:"17"}},{tag:"line",attr:{x1:"17",y1:"17",x2:"22",y2:"17"}},{tag:"line",attr:{x1:"17",y1:"7",x2:"22",y2:"7"}}]})(n)}function zy(n){return sr({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"rect",attr:{x:"3",y:"3",width:"18",height:"18",rx:"2",ry:"2"}},{tag:"circle",attr:{cx:"8.5",cy:"8.5",r:"1.5"}},{tag:"polyline",attr:{points:"21 15 16 10 5 21"}}]})(n)}function eGe(n){return sr({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"circle",attr:{cx:"12",cy:"12",r:"10"}},{tag:"line",attr:{x1:"12",y1:"16",x2:"12",y2:"12"}},{tag:"line",attr:{x1:"12",y1:"8",x2:"12.01",y2:"8"}}]})(n)}function tGe(n){return sr({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"path",attr:{d:"M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"}},{tag:"path",attr:{d:"M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"}}]})(n)}function nGe(n){return sr({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"path",attr:{d:"M21 11.5a8.38 8.38 0 0 1-.9 3.8 8.5 8.5 0 0 1-7.6 4.7 8.38 8.38 0 0 1-3.8-.9L3 21l1.9-5.7a8.38 8.38 0 0 1-.9-3.8 8.5 8.5 0 0 1 4.7-7.6 8.38 8.38 0 0 1 3.8-.9h.5a8.48 8.48 0 0 1 8 8v.5z"}}]})(n)}function rGe(n){return sr({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"circle",attr:{cx:"12",cy:"12",r:"3"}},{tag:"path",attr:{d:"M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"}}]})(n)}function iGe(n){return sr({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"polygon",attr:{points:"12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"}}]})(n)}function xZ(n){return sr({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"path",attr:{d:"M14.7 6.3a1 1 0 0 0 0 1.4l1.6 1.6a1 1 0 0 0 1.4 0l3.77-3.77a6 6 0 0 1-7.94 7.94l-6.91 6.91a2.12 2.12 0 0 1-3-3l6.91-6.91a6 6 0 0 1 7.94-7.94l-3.76 3.76z"}}]})(n)}function Wy(n){return sr({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"polyline",attr:{points:"3 6 5 6 21 6"}},{tag:"path",attr:{d:"M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"}},{tag:"line",attr:{x1:"10",y1:"11",x2:"10",y2:"17"}},{tag:"line",attr:{x1:"14",y1:"11",x2:"14",y2:"17"}}]})(n)}function ak(n){return sr({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"path",attr:{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"}},{tag:"polyline",attr:{points:"17 8 12 3 7 8"}},{tag:"line",attr:{x1:"12",y1:"3",x2:"12",y2:"15"}}]})(n)}function DZ(n){return sr({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"path",attr:{d:"M16 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"}},{tag:"circle",attr:{cx:"8.5",cy:"7",r:"4"}},{tag:"line",attr:{x1:"23",y1:"11",x2:"17",y2:"11"}}]})(n)}function bV(n){return sr({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"path",attr:{d:"M16 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"}},{tag:"circle",attr:{cx:"8.5",cy:"7",r:"4"}},{tag:"line",attr:{x1:"20",y1:"8",x2:"20",y2:"14"}},{tag:"line",attr:{x1:"23",y1:"11",x2:"17",y2:"11"}}]})(n)}function LZ(n){return sr({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"path",attr:{d:"M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"}},{tag:"circle",attr:{cx:"9",cy:"7",r:"4"}},{tag:"path",attr:{d:"M23 21v-2a4 4 0 0 0-3-3.87"}},{tag:"path",attr:{d:"M16 3.13a4 4 0 0 1 0 7.75"}}]})(n)}function rR(n){return sr({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"polygon",attr:{points:"23 7 16 12 23 17 23 7"}},{tag:"rect",attr:{x:"1",y:"5",width:"15",height:"14",rx:"2",ry:"2"}}]})(n)}function sGe(n){return sr({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"polygon",attr:{points:"11 5 6 9 2 9 2 15 6 15 11 19 11 5"}},{tag:"path",attr:{d:"M19.07 4.93a10 10 0 0 1 0 14.14M15.54 8.46a5 5 0 0 1 0 7.07"}}]})(n)}const oGe=async()=>{try{G.log("tagsFirestore: Fetching all tags");const n=mc(Fn,"tags"),e=await _d(n),i=[];return e.forEach(o=>{i.push({id:o.id,...o.data()})}),i}catch(n){throw G.error("tagsFirestore: Error fetching tags:",n),n}},aGe=async n=>{try{G.log(`tagsFirestore: Fetching tag with ID: ${n}`);const e=dr(Fn,"tags",n),i=await Qo(e);return i.exists()?{id:i.id,...i.data()}:(G.warn(`tagsFirestore: Tag with ID ${n} not found`),null)}catch(e){throw G.error(`tagsFirestore: Error fetching tag with ID ${n}:`,e),e}},cGe=async({id:n,name:e,color:i,description:o})=>{try{G.log(`tagsFirestore: Creating new tag: ${e}`);const l={name:e,color:i||"#808080",description:o||"",createdAt:new Date,updatedAt:new Date};let u;if(n){const p=dr(Fn,"tags",n);await Xg(p,l),u=n}else{const p=mc(Fn,"tags");u=(await nae(p,l)).id}return{id:u,...l}}catch(l){throw G.error("tagsFirestore: Error creating tag:",l),l}},lGe=async(n,e)=>{try{G.log(`tagsFirestore: Adding tag ${e} to space ${n}`);const i=dr(Fn,"tags",e);if(!(await Qo(i)).exists())throw new Error(`Tag with ID ${e} does not exist`);const l=dr(Fn,"spaces",n);return await qs(l,{tags:IBe(e)}),!0}catch(i){throw G.error(`tagsFirestore: Error adding tag ${e} to space ${n}:`,i),i}},uGe=async(n,e)=>{try{G.log(`tagsFirestore: Removing tag ${e} from space ${n}`);const i=dr(Fn,"spaces",n);return await qs(i,{tags:iae(e)}),!0}catch(i){throw G.error(`tagsFirestore: Error removing tag ${e} from space ${n}:`,i),i}},dGe=async n=>{try{G.log(`tagsFirestore: Getting tags for space ${n}`);const e=dr(Fn,"spaces",n),i=await Qo(e);if(!i.exists())throw new Error(`Space with ID ${n} not found`);const l=i.data().tags||[];if(l.length===0)return[];const u=[];for(const p of l){const y=await aGe(p);y&&u.push(y)}return u}catch(e){throw G.error(`tagsFirestore: Error getting tags for space ${n}:`,e),e}},hGe=async()=>{G.log("tagsFirestore: Initializing default tags");const n=[{id:"collaboration",name:"Collaboration",color:"#4287f5",description:"Spaces designed for team collaboration and meetings"},{id:"social",name:"Social",color:"#f54242",description:"Social gathering and networking spaces"},{id:"education",name:"Education",color:"#42f581",description:"Learning and educational environments"},{id:"events",name:"Events",color:"#f5a742",description:"Spaces optimized for hosting events"},{id:"showcase",name:"Showcase",color:"#9f42f5",description:"Spaces for exhibiting content and creations"},{id:"entertainment",name:"Entertainment",color:"#f542b3",description:"Entertainment and leisure spaces"},{id:"productivity",name:"Productivity",color:"#42dbf5",description:"Spaces focused on work and productivity"},{id:"featured",name:"Featured",color:"#f5f242",description:"Featured and highlighted spaces"}];try{let e=0,i=0;for(const o of n){G.log(`tagsFirestore: Processing tag: ${o.name}`);const l=dr(Fn,"tags",o.id);(await Qo(l)).exists()?(G.log(`tagsFirestore: Tag ${o.id} already exists, skipping`),i++):(await cGe(o),e++,G.log(`tagsFirestore: Created tag: ${o.name}`))}return G.log(`tagsFirestore: Tags initialization complete. Created: ${e}, Skipped: ${i}`),{created:e,skipped:i}}catch(e){throw G.error("tagsFirestore: Error initializing default tags:",e),e}},cce=({spaceID:n})=>{const[e,i]=k.useState([]),[o,l]=k.useState([]),[u,p]=k.useState(!0),[y,E]=k.useState(!1),[b,T]=k.useState(!1),[R,O]=k.useState(null),{isOpen:L,onOpen:D,onClose:U}=yu(),F=ea(),{user:Y}=k.useContext(Di),W=(Y==null?void 0:Y.groups)&&(Y.groups.includes("disruptiveAdmin")||Y.groups.includes("admin"));k.useEffect(()=>{re()},[n]);const re=async()=>{p(!0);try{let Q=[];try{Q=await oGe(),i(Q)}catch(ne){G.error("SpaceTagsManager: Error loading available tags:",ne),i([]),F({title:"Error loading tags",description:"Failed to load available tags. Please try again later.",status:"error",duration:3e3,isClosable:!0})}if(n)try{const ne=await dGe(n);l(ne)}catch(ne){G.error("SpaceTagsManager: Error loading space tags:",ne),l([]),F({title:"Error loading space tags",description:"Failed to load this space's tags. Please try again later.",status:"error",duration:3e3,isClosable:!0})}}catch(Q){G.error("SpaceTagsManager: Error in loadTags:",Q),F({title:"Error loading tags",description:"Failed to load tags. Please try again later.",status:"error",duration:3e3,isClosable:!0})}finally{p(!1)}},le=async()=>{T(!0),O(null);try{const Q=await hGe();O(Q),F({title:"Tags initialized",description:`Successfully created ${Q.created} tags. Skipped ${Q.skipped} existing tags.`,status:"success",duration:4e3,isClosable:!0}),await re()}catch(Q){G.error("SpaceTagsManager: Error initializing tags:",Q),O(!1),F({title:"Error initializing tags",description:"Failed to initialize tags. Please try again later.",status:"error",duration:4e3,isClosable:!0})}finally{T(!1)}},ie=async Q=>{if(!(!n||!Q)){E(!0);try{await lGe(n,Q);const ne=e.find(he=>he.id===Q);ne&&l(he=>[...he,ne]),F({title:"Tag added",description:"Tag has been added to the space.",status:"success",duration:2e3,isClosable:!0})}catch(ne){G.error(`SpaceTagsManager: Error adding tag ${Q} to space:`,ne),F({title:"Error adding tag",description:"Failed to add tag to the space.",status:"error",duration:3e3,isClosable:!0})}finally{E(!1)}}},me=async Q=>{if(!(!n||!Q)){E(!0);try{await uGe(n,Q),l(ne=>ne.filter(he=>he.id!==Q)),F({title:"Tag removed",description:"Tag has been removed from the space.",status:"info",duration:2e3,isClosable:!0})}catch(ne){G.error(`SpaceTagsManager: Error removing tag ${Q} from space:`,ne),F({title:"Error removing tag",description:"Failed to remove tag from the space.",status:"error",duration:3e3,isClosable:!0})}finally{E(!1)}}},q=()=>{const Q=o.map(ne=>ne.id);return e.filter(ne=>!Q.includes(ne.id))},J=q().length===0;return S.jsxs(He,{children:[S.jsx(Mr,{mb:3,justifyContent:"space-between",alignItems:"center",children:S.jsxs(Cn,{spacing:2,ml:"auto",children:[W&&S.jsx(On,{size:"xs",leftIcon:S.jsx(Bze,{}),onClick:D,variant:"outline",colorScheme:"purple",children:"Admin"}),S.jsxs(SE,{children:[S.jsx(bE,{as:On,size:"xs",leftIcon:S.jsx(Fze,{}),rightIcon:S.jsx(Aae,{}),isDisabled:u||y||J,children:J?"No Available Tags":"Add Tag"}),S.jsx(wE,{zIndex:1e3,bg:"gray.800",borderColor:"gray.700",color:"white",children:q().length>0?q().map(Q=>S.jsx(fh,{onClick:()=>ie(Q.id),icon:S.jsx(He,{width:"12px",height:"12px",borderRadius:"full",bg:Q.color||"#888"}),_hover:{bg:"gray.700"},_focus:{bg:"gray.700"},_active:{bg:"gray.700"},_focusVisible:{bg:"gray.700"},bg:"gray.800",color:"white",children:Q.name},Q.id)):S.jsx(fh,{isDisabled:!0,bg:"gray.800",color:"gray.400",children:"No available tags to add"})})]})]})}),u?S.jsx(Mr,{justify:"center",py:4,children:S.jsx(vd,{size:"sm",color:"blue.300"})}):e.length===0?S.jsx(He,{children:S.jsxs($e,{fontSize:"sm",color:"red.400",mb:2,children:["No tags have been created in the system yet.",W?" Use the Admin button to initialize tags.":" Ask an admin to initialize tags."]})}):o.length===0?S.jsx($e,{fontSize:"sm",color:"gray.400",fontStyle:"italic",children:"No tags assigned to this space."}):S.jsx(Pie,{spacing:2,children:o.map(Q=>S.jsx(FF,{children:S.jsxs(Tie,{size:"md",borderRadius:"full",variant:"subtle",colorScheme:"gray",boxShadow:`0 0 0 1px ${Q.color||"#888"}`,children:[S.jsx(He,{width:"8px",height:"8px",borderRadius:"full",bg:Q.color||"#888",mr:1}),S.jsx(Cie,{children:Q.name}),S.jsx(Iie,{onClick:()=>me(Q.id),isDisabled:y})]})},Q.id))}),S.jsxs(_s,{isOpen:L,onClose:U,size:"md",children:[S.jsx(vs,{backdropFilter:"blur(4px)"}),S.jsxs(ys,{bg:"gray.800",color:"white",children:[S.jsx(Do,{fontSize:"md",children:"Tag System Administration"}),S.jsx(Ns,{}),S.jsxs(Es,{children:[S.jsx($e,{fontSize:"sm",mb:4,children:"Initialize the default tags in your Firestore database. This will create a set of predefined tags if they don't already exist."}),R&&S.jsxs(sE,{status:"success",mb:4,borderRadius:"md",size:"sm",children:[S.jsx(oE,{}),S.jsxs($e,{fontSize:"sm",children:["Tags initialized. Created: ",S.jsx("b",{children:R.created}),", Skipped: ",S.jsx("b",{children:R.skipped})]})]}),S.jsx(On,{colorScheme:"blue",onClick:le,isLoading:b,loadingText:"Initializing...",size:"sm",width:"full",children:"Initialize Default Tags"})]}),S.jsx(vh,{children:S.jsx(On,{variant:"ghost",size:"sm",onClick:U,children:"Close"})})]})]})]})};cce.propTypes={spaceID:An.string.isRequired};const pGe=({isOpen:n,onClose:e})=>{const{spaceID:i}=Lo(),[o,l]=k.useState(0),[u,p]=k.useState(""),[y,E]=k.useState(""),[b,T]=k.useState(!1),[R,O]=k.useState(null),[L,D]=k.useState(null),[U,F]=k.useState(!1),[Y,W]=k.useState(0),[re,le]=k.useState(null),ie=k.useRef(null),[me,q]=k.useState(null),[J,Q]=k.useState(null),[ne,he]=k.useState(!1),[de,pe]=k.useState(0),[Se,Ie]=k.useState(null),Fe=k.useRef(null),[we,Re]=k.useState(null),[Te,Ne]=k.useState(null),[be,xe]=k.useState(!1),[je,nt]=k.useState(0),[dt,ft]=k.useState(null),lt=k.useRef(null),[gt,at]=k.useState([]),[Ct,En]=k.useState([]),[Gt,Jt]=k.useState(!1),[st,hn]=k.useState([]),[an,Ft]=k.useState(null),[on,bt]=k.useState(!1),[ve,De]=k.useState(!1),[qe,Ot]=k.useState(!0),[vt,Pt]=k.useState(!1),[Ut,cn]=k.useState(!1),[_t,wn]=k.useState(!1),[Nt,Ht]=k.useState(!1),[Ur,Ri]=k.useState(""),[ri,zi]=k.useState(""),[ds,Eo]=k.useState(""),[Gr,Mo]=k.useState(!1),{setHLSStreamUrl:Wc,savedStreamData:Xr}=Yae(),[vo,Js]=k.useState(!1),[ns,Gc]=k.useState([]),[So,bu]=k.useState(""),[Ga,Ds]=k.useState(!1),Kt=ea();k.useEffect(()=>{n&&i&&Hc()},[n,i]);const Hc=async()=>{try{const Je=await _o(i);Je.logoUrl&&le(Je.logoUrl),Je.backgroundUrl&&Ie(Je.backgroundUrl),Je.videoBackgroundUrl&&ft(Je.videoBackgroundUrl),Je.voiceDisabled!==void 0&&bt(Je.voiceDisabled),Je.textChatDisabled!==void 0&&De(Je.textChatDisabled),Je.accessibleToAllUsers!==void 0&&Ot(Je.accessibleToAllUsers),Je.allowGuestUsers!==void 0&&Pt(Je.allowGuestUsers),Je.hideGuestSignInButton!==void 0&&cn(Je.hideGuestSignInButton),p(Je.name||""),E(Je.description||""),Je.Override?(Js(Je.Override.enabled===!0),Gc(Je.Override.customPlayers||[])):(Js(!1),Gc([]));try{const qt=await Rae(i);if(qt){Ri(qt.streamUrl||""),zi(qt.rtmpUrl||""),Eo(qt.streamKey||"");const qn=qt.enabled===!0;Ht(qn),G.log("SpaceManageModal: Directly loaded streaming enabled state from Firebase:",{enabled:qn,rawValue:qt.enabled})}else Ht(!1),G.log("SpaceManageModal: No stream data found in Firebase, defaulting enabled to false")}catch(qt){if(G.error("Error fetching stream data directly:",qt),Xr){Ri(Xr.streamUrl||""),zi(Xr.rtmpUrl||""),Eo(Xr.streamKey||"");const qn=Xr.enabled===!0;Ht(qn),G.log("SpaceManageModal: Loaded streaming enabled state from savedStreamData:",{enabled:qn,rawValue:Xr.enabled})}else Ht(!1),G.log("SpaceManageModal: No savedStreamData available, defaulting enabled to false")}ta(Je)}catch(Je){G.error("Error fetching space data:",Je),Kt({title:"Error",description:"Failed to load space data",status:"error",duration:3e3,isClosable:!0})}};k.useEffect(()=>{if(Xr){if(!Gr){Ri(Xr.streamUrl||""),zi(Xr.rtmpUrl||""),Eo(Xr.streamKey||"");const Je=Xr.enabled===!0;Ht(Je),G.log("SpaceManageModal: Updated streaming enabled state from savedStreamData:",{enabled:Je,rawValue:Xr.enabled})}}else n&&!Gr&&G.log("SpaceManageModal: No savedStreamData available but NOT defaulting enabled to false (preserving current state)")},[Xr,Gr,n]);const ta=async Je=>{if(i&&n){Jt(!0);try{const qt=J0(),qn=`space_${i}_owners`,Xi=xR(mc(qt,"users"),WQ("groups","array-contains",qn)),Ss=await _d(Xi),Kc=[];for(const Ji of Ss.docs){const di=Ji.data(),Hr=await Fc(Ji.id);Kc.push({uid:Ji.id,email:di.email,displayName:di.displayName||Hr.Nickname||"Unknown User",photoURL:di.photoURL||Hr.photoURL,firstName:Hr.firstName,lastName:Hr.lastName})}at(Kc);const kh=`space_${i}_hosts`,yc=xR(mc(qt,"users"),WQ("groups","array-contains",kh)),qc=await _d(yc),Ml=[];for(const Ji of qc.docs){const di=Ji.data(),Hr=await Fc(Ji.id);Ml.push({uid:Ji.id,email:di.email,displayName:di.displayName||Hr.Nickname||"Unknown User",photoURL:di.photoURL||Hr.photoURL,firstName:Hr.firstName,lastName:Hr.lastName})}En(Ml);const Rr=mc(qt,`spaces/${i}/BannedUsers`),Ul=await _d(Rr),Ec=[];for(const Ji of Ul.docs){const di=Ji.id;try{const Hr=await Fc(di);Ec.push({uid:di,displayName:(Hr==null?void 0:Hr.Nickname)||di,firstName:Hr==null?void 0:Hr.firstName,lastName:Hr==null?void 0:Hr.lastName,photoURL:Hr==null?void 0:Hr.photoURL})}catch{Ec.push({uid:di,displayName:di})}}hn(Ec)}catch(qt){G.error("Error fetching space users:",qt),Kt({title:"Error",description:"Failed to load space users",status:"error",duration:3e3,isClosable:!0})}finally{Jt(!1)}}};k.useEffect(()=>{i&&n&&o===4&&ta()},[i,n,o]);const Ha=Je=>{const qt=Je.target.files[0];if(qt){if(!qt.type.startsWith("image/")){Kt({title:"Invalid file type",description:"Please select an image file",status:"error",duration:5e3,isClosable:!0});return}O(qt);const qn=new FileReader;qn.onloadend=()=>{D(qn.result)},qn.readAsDataURL(qt)}},$c=Je=>{const qt=Je.target.files[0];if(qt){if(!qt.type.startsWith("image/")){Kt({title:"Invalid file type",description:"Please select an image file",status:"error",duration:5e3,isClosable:!0});return}q(qt);const qn=new FileReader;qn.onloadend=()=>{Q(qn.result)},qn.readAsDataURL(qt)}},na=Je=>{const qt=Je.target.files[0];if(qt){if(!qt.type.startsWith("video/")){Kt({title:"Invalid file type",description:"Please select a video file",status:"error",duration:5e3,isClosable:!0});return}const qn=5*1024*1024;if(qt.size>qn){Kt({title:"File too large",description:"Video file must be smaller than 5MB",status:"error",duration:5e3,isClosable:!0});return}Re(qt);const Xi=new FileReader;Xi.onloadend=()=>{Ne(Xi.result)},Xi.readAsDataURL(qt)}},ra=async()=>{if(!R){Kt({title:"No file selected",description:"Please select a file to upload",status:"warning",duration:5e3,isClosable:!0});return}try{F(!0);const Je=setInterval(()=>{W(qn=>{const Xi=qn+10;return Xi>=90?90:Xi})},300),qt=await wze(i,R);clearInterval(Je),W(100),le(qt),Kt({title:"Upload successful",description:"Space logo has been updated",status:"success",duration:5e3,isClosable:!0}),setTimeout(()=>{O(null),D(null),W(0),F(!1)},1e3),window.dispatchEvent(new CustomEvent("SpaceLogoUpdated",{detail:{logoUrl:qt}}))}catch(Je){console.error("Error uploading logo:",Je),Kt({title:"Upload failed",description:Je.message||"An error occurred during upload",status:"error",duration:5e3,isClosable:!0}),F(!1),W(0)}},Sd=async()=>{if(!me){Kt({title:"No file selected",description:"Please select a file to upload",status:"warning",duration:5e3,isClosable:!0});return}try{he(!0);const Je=setInterval(()=>{pe(qn=>{const Xi=qn+10;return Xi>=90?90:Xi})},300),qt=await Cze(i,me);clearInterval(Je),pe(100),Ie(qt),Kt({title:"Upload successful",description:"Space background has been updated",status:"success",duration:5e3,isClosable:!0}),setTimeout(()=>{q(null),Q(null),pe(0),he(!1)},1e3),window.dispatchEvent(new CustomEvent("SpaceBackgroundUpdated",{detail:{backgroundUrl:qt}}))}catch(Je){console.error("Error uploading background:",Je),Kt({title:"Upload failed",description:Je.message||"An error occurred during upload",status:"error",duration:5e3,isClosable:!0}),he(!1),pe(0)}},Ih=async()=>{if(re)try{F(!0),await Tze(i),le(null),Kt({title:"Logo removed",description:"Space logo has been removed",status:"info",duration:5e3,isClosable:!0}),F(!1),window.dispatchEvent(new CustomEvent("SpaceLogoUpdated",{detail:{logoUrl:null}}))}catch(Je){console.error("Error deleting logo:",Je),Kt({title:"Deletion failed",description:Je.message||"An error occurred during deletion",status:"error",duration:5e3,isClosable:!0}),F(!1)}},kl=async()=>{if(Se)try{he(!0),await Rze(i),Ie(null),Kt({title:"Background removed",description:"Space background has been removed",status:"info",duration:5e3,isClosable:!0}),he(!1),window.dispatchEvent(new CustomEvent("SpaceBackgroundUpdated",{detail:{backgroundUrl:null}}))}catch(Je){console.error("Error deleting background:",Je),Kt({title:"Deletion failed",description:Je.message||"An error occurred during deletion",status:"error",duration:5e3,isClosable:!0}),he(!1)}},Ah=async()=>{if(!we){Kt({title:"No file selected",description:"Please select a file to upload",status:"warning",duration:5e3,isClosable:!0});return}try{xe(!0);const Je=setInterval(()=>{nt(qn=>{const Xi=qn+10;return Xi>=90?90:Xi})},300),qt=await Pze(i,we);clearInterval(Je),nt(100),ft(qt),Kt({title:"Upload successful",description:"Space video background has been updated",status:"success",duration:5e3,isClosable:!0}),setTimeout(()=>{Re(null),Ne(null),nt(0),xe(!1)},1e3),window.dispatchEvent(new CustomEvent("SpaceVideoBackgroundUpdated",{detail:{videoBackgroundUrl:qt}}))}catch(Je){console.error("Error uploading video background:",Je),Kt({title:"Upload failed",description:Je.message||"An error occurred during upload",status:"error",duration:5e3,isClosable:!0}),xe(!1),nt(0)}},Ls=async()=>{if(dt)try{xe(!0),await Oze(i),ft(null),Kt({title:"Video background removed",description:"Space video background has been removed",status:"info",duration:5e3,isClosable:!0}),xe(!1),window.dispatchEvent(new CustomEvent("SpaceVideoBackgroundUpdated",{detail:{videoBackgroundUrl:null}}))}catch(Je){console.error("Error deleting video background:",Je),Kt({title:"Deletion failed",description:Je.message||"An error occurred during deletion",status:"error",duration:5e3,isClosable:!0}),xe(!1)}},Nl=()=>{ie.current&&ie.current.click()},ia=()=>{Fe.current&&Fe.current.click()},bd=()=>{lt.current&&lt.current.click()},xl=async()=>{wn(!0);try{await pS(i,{voiceDisabled:!on}),bt(!on),Kt({title:"Settings Updated",description:`Voice chat has been ${on?"enabled":"disabled"} for this space.`,status:"success",duration:3e3,isClosable:!0})}catch(Je){G.error("Error updating voice settings:",Je),Kt({title:"Error",description:"Failed to update voice settings",status:"error",duration:3e3,isClosable:!0})}finally{wn(!1)}},Dl=async()=>{wn(!0);try{await pS(i,{textChatDisabled:!ve}),De(!ve),window.dispatchEvent(new CustomEvent("SpaceTextChatSettingChanged",{detail:{spaceId:i,textChatDisabled:!ve}})),Kt({title:"Settings Updated",description:`Text chat has been ${ve?"enabled":"disabled"} for this space.`,status:"success",duration:3e3,isClosable:!0})}catch(Je){G.error("Error updating text chat settings:",Je),Kt({title:"Error",description:"Failed to update text chat settings",status:"error",duration:3e3,isClosable:!0})}finally{wn(!1)}},Sa=async()=>{wn(!0);try{await Aze(i,!qe),Ot(!qe),Kt({title:"Settings Updated",description:`Space is now ${qe?"not accessible":"accessible"} to all users.`,status:"success",duration:3e3,isClosable:!0})}catch(Je){G.error("Error updating accessibility settings:",Je),Kt({title:"Error",description:"Failed to update accessibility settings",status:"error",duration:3e3,isClosable:!0})}finally{wn(!1)}},Ll=async()=>{wn(!0);try{const Je=!vt,qt={allowGuestUsers:Je};Je||(qt.hideGuestSignInButton=!1,cn(!1)),await pS(i,qt),Pt(Je),Kt({title:"Settings Updated",description:`Guest users are now ${Je?"allowed":"not allowed"} in this space.`,status:"success",duration:3e3,isClosable:!0})}catch(Je){G.error("Error updating guest user settings:",Je),Kt({title:"Error",description:"Failed to update guest user settings",status:"error",duration:3e3,isClosable:!0})}finally{wn(!1)}},Ph=async()=>{wn(!0);try{await pS(i,{hideGuestSignInButton:!Ut}),cn(!Ut),window.dispatchEvent(new CustomEvent("SpaceSettingsChanged",{detail:{spaceId:i,hideGuestSignInButton:!Ut}})),Kt({title:"Settings Updated",description:`Guest sign-in button is now ${Ut?"visible":"hidden"}.`,status:"success",duration:3e3,isClosable:!0})}catch(Je){G.error("Error updating sign-in button settings:",Je),Kt({title:"Error",description:"Failed to update sign-in button settings",status:"error",duration:3e3,isClosable:!0})}finally{wn(!1)}},Qs=async()=>{if(i){T(!0);try{const Je=J0(),qt=dr(Je,"spaces",i);await qs(qt,{name:u,description:y}),Kt({title:"Success",description:"Space details updated successfully",status:"success",duration:3e3,isClosable:!0}),window.dispatchEvent(new CustomEvent("SpaceDetailsUpdated",{detail:{name:u,description:y}}))}catch(Je){G.error("Error updating space details:",Je),Kt({title:"Error",description:"Failed to update space details",status:"error",duration:3e3,isClosable:!0})}finally{T(!1)}}},Jr=async()=>{if(i){Mo(!0);try{const Je={enabled:Nt,streamUrl:Ur,rtmpUrl:ri,streamKey:ds,playerIndex:"0",updatedAt:new Date().toISOString()};G.log("SpaceManageModal: Saving stream settings to Firebase:",{enabled:Nt,url:Ur,hasRtmp:!!ri,hasKey:!!ds});try{await Y5(i,Je),G.log("SpaceManageModal: Successfully updated stream settings in Firebase directly")}catch(qt){throw G.error("SpaceManageModal: Error updating stream settings directly in Firebase:",qt),qt}await Wc(Ur,0,{enabled:Nt,rtmpUrl:ri,streamKey:ds}),window.dispatchEvent(new CustomEvent("StreamSettingsChanged",{detail:{enabled:Nt,spaceId:i}})),Kt({title:"Success",description:`Stream settings updated successfully. Streaming is now ${Nt?"enabled":"disabled"}.`,status:"success",duration:3e3,isClosable:!0}),setTimeout(()=>{Hc()},500)}catch(Je){G.error("Error updating stream settings:",Je),Kt({title:"Error",description:"Failed to update stream settings",status:"error",duration:3e3,isClosable:!0})}finally{Mo(!1)}}},Oh=async Je=>{try{Ft(Je);const qt=J0();await sx(dr(qt,`spaces/${i}/BannedUsers`,Je));const qn=dr(qt,"users",Je),Xi=`space_${i}_banned`;await qs(qn,{groups:iae(Xi)}),hn(Ss=>Ss.filter(Kc=>Kc.uid!==Je)),Kt({title:"User Unbanned",description:"User can now re-enter this space.",status:"success",duration:3e3,isClosable:!0})}catch(qt){G.error("Error unbanning user:",qt),Kt({title:"Error",description:"Failed to unban user",status:"error",duration:3e3,isClosable:!0})}finally{Ft(null)}},Vr=()=>{if(!So.trim()){Kt({title:"URL Required",description:"Please enter a URL",status:"warning",duration:3e3,isClosable:!0});return}const Je={id:Date.now().toString(),url:So.trim(),createdAt:new Date().toISOString()};Gc(qt=>[...qt,Je]),bu("")},_c=Je=>{Gc(qt=>qt.filter(qn=>qn.id!==Je))},sa=async()=>{const Je=!vo;Js(Je),Ds(!0);try{const qt=J0(),qn=dr(qt,"spaces",i);await qs(qn,{"Override.enabled":Je}),Kt({title:"Override "+(Je?"Enabled":"Disabled"),description:`Override is now ${Je?"enabled":"disabled"}.`,status:"success",duration:2e3,isClosable:!0}),window.dispatchEvent(new CustomEvent("SpaceOverrideUpdated",{detail:{enabled:Je,customPlayers:ns}}))}catch(qt){G.error("Error updating override enabled state:",qt),Js(!Je),Kt({title:"Error",description:"Failed to update override state",status:"error",duration:3e3,isClosable:!0})}finally{Ds(!1)}},wd=async()=>{if(i){Ds(!0);try{const Je=J0(),qt=dr(Je,"spaces",i);await qs(qt,{"Override.enabled":vo,"Override.customPlayers":ns}),Kt({title:"Success",description:"Override settings saved successfully",status:"success",duration:3e3,isClosable:!0}),window.dispatchEvent(new CustomEvent("SpaceOverrideUpdated",{detail:{enabled:vo,customPlayers:ns}}))}catch(Je){G.error("Error updating override settings:",Je),Kt({title:"Error",description:"Failed to update override settings",status:"error",duration:3e3,isClosable:!0})}finally{Ds(!1)}}};return S.jsxs(_s,{isOpen:n,onClose:e,size:"lg",isCentered:!0,children:[S.jsx(vs,{bg:"rgba(0, 0, 0, 0.8)",backdropFilter:"blur(8px)"}),S.jsxs(ys,{bg:"#1a1a1a",color:"white",borderRadius:"xl",border:"1px solid #333",maxW:"800px",maxH:"90vh",overflow:"hidden",children:[S.jsx(Do,{fontSize:"md",fontWeight:"600",pb:1,pt:3,px:4,color:"white",borderBottom:"1px solid",borderColor:"whiteAlpha.200",children:"Manage Space"}),S.jsx(Ns,{color:"white",bg:"rgba(255,255,255,0.1)",_hover:{color:"gray.400",bg:"transparent"},borderRadius:"full",size:"sm",top:2,right:3}),S.jsx(Es,{p:0,display:"flex",overflow:"hidden",children:S.jsxs($S,{orientation:"vertical",variant:"unstyled",index:o,onChange:l,display:"flex",width:"100%",height:"100%",children:[S.jsxs(KS,{bg:"rgba(0, 0, 0, 0.2)",w:"80px",py:4,borderRight:"1px solid",borderColor:"whiteAlpha.200",flexShrink:0,children:[S.jsxs(ya,{display:"flex",flexDirection:"column",alignItems:"center",py:3,_selected:{bg:"whiteAlpha.100",color:"blue.300"},_hover:{bg:"whiteAlpha.50"},children:[S.jsx(en,{as:eGe,mb:1}),S.jsx($e,{fontSize:"xs",children:"Details"})]}),S.jsxs(ya,{display:"flex",flexDirection:"column",alignItems:"center",py:3,_selected:{bg:"whiteAlpha.100",color:"blue.300"},_hover:{bg:"whiteAlpha.50"},children:[S.jsx(en,{as:zy,mb:1}),S.jsx($e,{fontSize:"xs",children:"Logo"})]}),S.jsxs(ya,{display:"flex",flexDirection:"column",alignItems:"center",py:3,_selected:{bg:"whiteAlpha.100",color:"blue.300"},_hover:{bg:"whiteAlpha.50"},children:[S.jsx(en,{as:ZWe,mb:1}),S.jsx($e,{fontSize:"xs",children:"Background"})]}),S.jsxs(ya,{display:"flex",flexDirection:"column",alignItems:"center",py:3,_selected:{bg:"whiteAlpha.100",color:"blue.300"},_hover:{bg:"whiteAlpha.50"},children:[S.jsx(en,{as:rGe,mb:1}),S.jsx($e,{fontSize:"xs",children:"Settings"})]}),S.jsxs(ya,{display:"flex",flexDirection:"column",alignItems:"center",py:3,_selected:{bg:"whiteAlpha.100",color:"blue.300"},_hover:{bg:"whiteAlpha.50"},children:[S.jsx(en,{as:LZ,mb:1}),S.jsx($e,{fontSize:"xs",children:"Users"})]}),S.jsxs(ya,{display:"flex",flexDirection:"column",alignItems:"center",py:3,_selected:{bg:"whiteAlpha.100",color:"blue.300"},_hover:{bg:"whiteAlpha.50"},children:[S.jsx(en,{as:rR,mb:1}),S.jsx($e,{fontSize:"xs",children:"Stream"})]}),S.jsxs(ya,{display:"flex",flexDirection:"column",alignItems:"center",py:3,_selected:{bg:"whiteAlpha.100",color:"blue.300"},_hover:{bg:"whiteAlpha.50"},children:[S.jsx(en,{as:xZ,mb:1}),S.jsx($e,{fontSize:"xs",children:"Custom"})]})]}),S.jsxs(wR,{flexGrow:1,display:"flex",flexDirection:"column",overflowY:"auto",css:{"&::-webkit-scrollbar":{width:"8px"},"&::-webkit-scrollbar-track":{background:"rgba(0,0,0,0.1)"},"&::-webkit-scrollbar-thumb":{background:"rgba(255,255,255,0.3)",borderRadius:"4px"}},children:[S.jsxs(dc,{p:4,display:"flex",flexDirection:"column",children:[S.jsx($e,{fontSize:"sm",fontWeight:"600",mb:3,color:"white",children:"Space Details"}),S.jsxs(Qn,{spacing:4,align:"stretch",children:[S.jsxs(br,{children:[S.jsx(Ei,{fontSize:"xs",color:"white",children:"Space Name"}),S.jsx(ni,{value:u,onChange:Je=>p(Je.target.value),placeholder:"Enter space name",size:"sm",bg:"whiteAlpha.100",borderColor:"whiteAlpha.200",_hover:{borderColor:"whiteAlpha.300"},_focus:{borderColor:"blue.300",boxShadow:"0 0 0 1px #63B3ED"},color:"white",maxLength:100})]}),S.jsxs(br,{children:[S.jsx(Ei,{fontSize:"xs",color:"white",children:"Description"}),S.jsx(Aie,{value:y,onChange:Je=>E(Je.target.value),placeholder:"Enter space description",size:"sm",bg:"whiteAlpha.100",borderColor:"whiteAlpha.200",_hover:{borderColor:"whiteAlpha.300"},_focus:{borderColor:"blue.300",boxShadow:"0 0 0 1px #63B3ED"},rows:4,resize:"vertical",maxLength:500})]}),S.jsxs(br,{children:[S.jsx(Ei,{fontSize:"xs",color:"white",children:"Space Tags"}),S.jsx(He,{p:3,bg:"whiteAlpha.50",borderWidth:"1px",borderColor:"whiteAlpha.200",borderRadius:"md",children:i?S.jsx(cce,{spaceID:i}):S.jsxs(sE,{status:"warning",variant:"subtle",borderRadius:"md",children:[S.jsx(oE,{}),S.jsx(vk,{fontSize:"sm",children:"Space ID missing"}),S.jsx(Sk,{fontSize:"xs",children:"Unable to load tags without a valid space ID."})]})})]}),S.jsx(On,{colorScheme:"blue",size:"sm",onClick:Qs,isLoading:b,loadingText:"Saving...",alignSelf:"flex-start",mt:2,children:"Save Details"})]})]}),S.jsxs(dc,{p:4,display:"flex",flexDirection:"column",children:[S.jsx($e,{fontSize:"sm",fontWeight:"600",mb:3,color:"white",children:"Space Logo"}),S.jsx($e,{fontSize:"xs",mb:4,children:"Upload a logo for your space. This will be displayed during loading."}),(re||L)&&S.jsxs(Mr,{direction:{base:"column",md:"row"},gap:4,mb:4,children:[re&&S.jsxs(He,{borderWidth:"1px",borderRadius:"md",p:3,bg:"whiteAlpha.50",borderColor:"whiteAlpha.200",flex:"1",children:[S.jsx($e,{fontSize:"xs",fontWeight:"medium",mb:2,children:"Current Logo"}),S.jsx(kp,{src:re,alt:"Space Logo",maxH:"120px",mx:"auto",objectFit:"contain"}),S.jsx(On,{mt:3,colorScheme:"red",leftIcon:S.jsx(en,{as:Wy}),onClick:Ih,isLoading:U,loadingText:"Removing...",size:"xs",variant:"ghost",children:"Remove Logo"})]}),L&&S.jsxs(He,{borderWidth:"1px",borderRadius:"md",p:3,bg:"whiteAlpha.50",borderColor:"whiteAlpha.200",flex:"1",children:[S.jsx($e,{fontSize:"xs",fontWeight:"medium",mb:2,children:"Preview"}),S.jsx(kp,{src:L,alt:"Preview",maxH:"120px",mx:"auto",objectFit:"contain"})]})]}),S.jsxs(br,{children:[S.jsx(Ei,{fontSize:"xs",color:"white",children:"Upload New Logo"}),S.jsx(ni,{type:"file",accept:"image/*",onChange:Ha,ref:ie,display:"none"}),U&&S.jsxs(He,{mt:3,mb:3,children:[S.jsxs($e,{fontSize:"xs",mb:1,children:["Uploading... ",Y,"%"]}),S.jsx(Zy,{value:Y,size:"xs",colorScheme:"blue",borderRadius:"full"})]}),S.jsxs(Cn,{mt:3,spacing:3,children:[S.jsx(On,{colorScheme:"blue",leftIcon:S.jsx(en,{as:zy}),onClick:Nl,isDisabled:U,size:"sm",variant:"outline",children:"Browse"}),S.jsx(On,{colorScheme:"green",leftIcon:S.jsx(en,{as:ak}),onClick:ra,isLoading:U,loadingText:"Uploading...",isDisabled:!R||U,size:"sm",children:"Upload"})]}),S.jsx(Xy,{fontSize:"xs",color:"whiteAlpha.700",mt:2,children:"Recommended: PNG format with transparent background. Max height: 400px."})]})]}),S.jsxs(dc,{p:4,display:"flex",flexDirection:"column",children:[S.jsx($e,{fontSize:"sm",fontWeight:"600",mb:3,color:"white",children:"Background"}),S.jsx($e,{fontSize:"xs",mb:4,children:"Upload a background for your space. This will be displayed during loading."}),S.jsxs($S,{variant:"enclosed",colorScheme:"blue",size:"md",mb:4,borderColor:"blue.300",children:[S.jsxs(KS,{children:[S.jsxs(ya,{fontSize:"sm",fontWeight:"medium",_selected:{color:"blue.300",bg:"whiteAlpha.200"},p:3,children:[S.jsx(en,{as:zy,mr:2}),"Image"]}),S.jsxs(ya,{fontSize:"sm",fontWeight:"medium",_selected:{color:"blue.300",bg:"whiteAlpha.200"},p:3,children:[S.jsx(en,{as:NZ,mr:2}),"Video (max 5MB)"]})]}),S.jsxs(wR,{mt:4,children:[S.jsxs(dc,{p:0,children:[(Se||J)&&S.jsxs(Mr,{direction:{base:"column",md:"row"},gap:4,mb:4,children:[Se&&S.jsxs(He,{borderWidth:"1px",borderRadius:"md",p:3,bg:"whiteAlpha.50",borderColor:"whiteAlpha.200",flex:"1",children:[S.jsx($e,{fontSize:"xs",fontWeight:"medium",mb:2,children:"Current Background"}),S.jsx(kp,{src:Se,alt:"Space Background",maxH:"120px",mx:"auto",objectFit:"contain"}),S.jsx(On,{mt:3,colorScheme:"red",leftIcon:S.jsx(en,{as:Wy}),onClick:kl,isLoading:ne,loadingText:"Removing...",size:"xs",variant:"ghost",children:"Remove Background"})]}),J&&S.jsxs(He,{borderWidth:"1px",borderRadius:"md",p:3,bg:"whiteAlpha.50",borderColor:"whiteAlpha.200",flex:"1",children:[S.jsx($e,{fontSize:"xs",fontWeight:"medium",mb:2,children:"Preview"}),S.jsx(kp,{src:J,alt:"Preview",maxH:"120px",mx:"auto",objectFit:"contain"})]})]}),S.jsxs(br,{children:[S.jsx(Ei,{fontSize:"xs",color:"white",children:"Upload New Background Image"}),S.jsx(ni,{type:"file",accept:"image/*",onChange:$c,ref:Fe,display:"none"}),ne&&S.jsxs(He,{mt:3,mb:3,children:[S.jsxs($e,{fontSize:"xs",mb:1,children:["Uploading... ",de,"%"]}),S.jsx(Zy,{value:de,size:"xs",colorScheme:"blue",borderRadius:"full"})]}),S.jsxs(Cn,{mt:3,spacing:3,children:[S.jsx(On,{colorScheme:"blue",leftIcon:S.jsx(en,{as:zy}),onClick:ia,isDisabled:ne,size:"sm",variant:"outline",children:"Browse"}),S.jsx(On,{colorScheme:"green",leftIcon:S.jsx(en,{as:ak}),onClick:Sd,isLoading:ne,loadingText:"Uploading...",isDisabled:!me||ne,size:"sm",children:"Upload"})]}),S.jsx(Xy,{fontSize:"xs",color:"whiteAlpha.700",mt:2,children:"Recommended: High-quality image (1920x1080 or higher) that works well with the frosted glass overlay."})]})]}),S.jsxs(dc,{p:0,children:[(dt||Te)&&S.jsxs(Mr,{direction:{base:"column",md:"row"},gap:4,mb:4,children:[dt&&S.jsxs(He,{borderWidth:"1px",borderRadius:"md",p:3,bg:"whiteAlpha.50",borderColor:"whiteAlpha.200",flex:"1",children:[S.jsx($e,{fontSize:"xs",fontWeight:"medium",mb:2,children:"Current Video Background"}),S.jsx(He,{maxH:"160px",overflow:"hidden",position:"relative",children:S.jsx("video",{src:dt,controls:!0,muted:!0,style:{width:"100%",maxHeight:"120px",objectFit:"contain"}})}),S.jsx(On,{mt:3,colorScheme:"red",leftIcon:S.jsx(en,{as:Wy}),onClick:Ls,isLoading:be,loadingText:"Removing...",size:"xs",variant:"ghost",children:"Remove Video"})]}),Te&&S.jsxs(He,{borderWidth:"1px",borderRadius:"md",p:3,bg:"whiteAlpha.50",borderColor:"whiteAlpha.200",flex:"1",children:[S.jsx($e,{fontSize:"xs",fontWeight:"medium",mb:2,children:"Preview"}),S.jsx(He,{maxH:"160px",overflow:"hidden",children:S.jsx("video",{src:Te,controls:!0,muted:!0,style:{width:"100%",maxHeight:"120px",objectFit:"contain"}})})]})]}),S.jsxs(br,{children:[S.jsx(Ei,{fontSize:"xs",color:"white",children:"Upload New Video Background"}),S.jsx(ni,{type:"file",accept:"video/*",onChange:na,ref:lt,display:"none"}),be&&S.jsxs(He,{mt:3,mb:3,children:[S.jsxs($e,{fontSize:"xs",mb:1,children:["Uploading... ",je,"%"]}),S.jsx(Zy,{value:je,size:"xs",colorScheme:"blue",borderRadius:"full"})]}),S.jsxs(Cn,{mt:3,spacing:3,children:[S.jsx(On,{colorScheme:"blue",leftIcon:S.jsx(en,{as:NZ}),onClick:bd,isDisabled:be,size:"sm",variant:"outline",children:"Browse"}),S.jsx(On,{colorScheme:"green",leftIcon:S.jsx(en,{as:ak}),onClick:Ah,isLoading:be,loadingText:"Uploading...",isDisabled:!we||be,size:"sm",children:"Upload"})]}),S.jsx(Xy,{fontSize:"xs",color:"whiteAlpha.700",mt:2,children:"Recommended: MP4 format. Maximum file size: 5MB. Short looping videos work best."})]})]})]})]})]}),S.jsx(dc,{p:4,display:"flex",flexDirection:"column",children:S.jsxs(Qn,{spacing:4,align:"stretch",children:[S.jsx(He,{borderWidth:"1px",borderRadius:"md",p:3,bg:"whiteAlpha.50",borderColor:"whiteAlpha.200",children:S.jsxs(Cn,{justify:"space-between",align:"center",children:[S.jsxs(He,{children:[S.jsxs(Cn,{mb:1,spacing:2,children:[S.jsxs(He,{position:"relative",w:"16px",h:"16px",children:[S.jsx(en,{as:sGe,color:on?"red.400":"green.400"}),on&&S.jsx(He,{position:"absolute",top:"50%",left:"0",right:"0",height:"2px",bg:"red.400",transform:"rotate(45deg)",transformOrigin:"center"})]}),S.jsx($e,{fontSize:"sm",fontWeight:"600",children:"Voice Chat"})]}),S.jsx($e,{fontSize:"xs",color:"whiteAlpha.800",children:on?"Voice chat is currently disabled for all users in this space.":"Voice chat is currently enabled for all users in this space."})]}),S.jsx(ld,{isChecked:!on,onChange:xl,colorScheme:"green",size:"md",isDisabled:_t})]})}),S.jsx(He,{borderWidth:"1px",borderRadius:"md",p:3,bg:"whiteAlpha.50",borderColor:"whiteAlpha.200",children:S.jsxs(Cn,{justify:"space-between",align:"center",children:[S.jsxs(He,{children:[S.jsxs(Cn,{mb:1,spacing:2,children:[S.jsxs(He,{position:"relative",w:"16px",h:"16px",children:[S.jsx(en,{as:nGe,color:ve?"red.400":"green.400"}),ve&&S.jsx(He,{position:"absolute",top:"50%",left:"0",right:"0",height:"2px",bg:"red.400",transform:"rotate(45deg)",transformOrigin:"center"})]}),S.jsx($e,{fontSize:"sm",fontWeight:"600",children:"Text Chat"})]}),S.jsx($e,{fontSize:"xs",color:"whiteAlpha.800",children:ve?"Text chat is currently disabled for all users in this space.":"Text chat is currently enabled for all users in this space."})]}),S.jsx(ld,{isChecked:!ve,onChange:Dl,colorScheme:"green",size:"md",isDisabled:_t})]})}),S.jsx(He,{borderWidth:"1px",borderRadius:"md",p:3,bg:"whiteAlpha.50",borderColor:"whiteAlpha.200",children:S.jsxs(Cn,{justify:"space-between",align:"center",children:[S.jsxs(He,{children:[S.jsxs(Cn,{mb:1,spacing:2,children:[S.jsx(He,{position:"relative",w:"16px",h:"16px",children:S.jsx(en,{as:LZ,color:qe?"green.400":"red.400"})}),S.jsx($e,{fontSize:"sm",fontWeight:"600",children:"Public Access"})]}),S.jsx($e,{fontSize:"xs",color:"whiteAlpha.800",children:qe?"This space is accessible to all users in the 'users' group.":"This space is only accessible to specific users."})]}),S.jsx(ld,{isChecked:qe,onChange:Sa,colorScheme:"green",size:"md",isDisabled:_t})]})}),S.jsxs(He,{borderWidth:"1px",borderRadius:"md",p:3,bg:"whiteAlpha.50",borderColor:"whiteAlpha.200",children:[S.jsxs(Cn,{justify:"space-between",align:"center",children:[S.jsxs(He,{children:[S.jsxs(Cn,{mb:1,spacing:2,children:[S.jsx(He,{position:"relative",w:"16px",h:"16px",children:S.jsx(en,{as:bV,color:vt?"green.400":"red.400"})}),S.jsx($e,{fontSize:"sm",fontWeight:"600",children:"Allow Guest Users"})]}),S.jsx($e,{fontSize:"xs",color:"whiteAlpha.800",children:vt?"Unauthenticated users can enter as guests with usernames like 'Visitor_1234'.":"Only authenticated users can access this space."})]}),S.jsx(ld,{isChecked:vt,onChange:Ll,colorScheme:"green",size:"md",isDisabled:_t})]}),vt&&S.jsx(He,{mt:3,pt:3,borderTop:"1px solid",borderColor:"whiteAlpha.200",children:S.jsxs(Cn,{justify:"space-between",align:"center",children:[S.jsxs(He,{children:[S.jsxs(Cn,{mb:1,spacing:2,children:[S.jsx(He,{position:"relative",w:"14px",h:"14px",ml:1,children:S.jsx(en,{as:DZ,color:Ut?"orange.400":"gray.400",fontSize:"sm"})}),S.jsx($e,{fontSize:"sm",fontWeight:"500",children:"Remove Sign In Button"})]}),S.jsx($e,{fontSize:"xs",color:"whiteAlpha.700",ml:5,children:Ut?"Guest users won't see the sign-in button to upgrade their account.":"Guest users can see a sign-in button to upgrade to a full account."})]}),S.jsx(ld,{isChecked:Ut,onChange:Ph,colorScheme:"orange",size:"sm",isDisabled:_t||!vt})]})})]})]})}),S.jsxs(dc,{p:4,display:"flex",flexDirection:"column",children:[S.jsx($e,{fontSize:"sm",fontWeight:"600",mb:3,color:"white",children:"Manage Users"}),S.jsx($e,{fontSize:"xs",mb:4,children:"View and manage the owners and hosts of this space."}),Gt?S.jsx(Mr,{justify:"center",align:"center",h:"200px",children:S.jsx(vd,{color:"blue.300"})}):S.jsxs(Qn,{spacing:4,align:"stretch",children:[S.jsxs(He,{children:[S.jsxs(Cn,{mb:2,children:[S.jsx(en,{as:QWe,color:"green.400"}),S.jsx($e,{fontSize:"sm",fontWeight:"600",children:"Owners"}),S.jsx(Mc,{colorScheme:"green",ml:2,children:gt.length})]}),S.jsx(He,{borderWidth:"1px",borderRadius:"md",p:2,bg:"whiteAlpha.50",borderColor:"whiteAlpha.200",maxH:"120px",overflowY:"auto",css:{"&::-webkit-scrollbar":{width:"4px"},"&::-webkit-scrollbar-track":{background:"rgba(0,0,0,0.1)"},"&::-webkit-scrollbar-thumb":{background:"rgba(255,255,255,0.3)",borderRadius:"2px"}},children:gt.length===0?S.jsx($e,{fontSize:"xs",color:"whiteAlpha.600",children:"No owners found"}):S.jsx(Qn,{spacing:1,align:"stretch",children:gt.map(Je=>S.jsxs(Cn,{spacing:2,p:1,borderRadius:"md",_hover:{bg:"whiteAlpha.100"},children:[S.jsx(jc,{size:"xs",src:Je.photoURL,name:Je.displayName}),S.jsxs(He,{children:[S.jsx($e,{fontSize:"xs",children:Je.displayName}),S.jsx($e,{fontSize:"xs",color:"whiteAlpha.600",children:Je.firstName&&Je.lastName?`${Je.firstName} ${Je.lastName}`:"Full name not available"})]}),S.jsx(qC,{}),S.jsx(Mc,{colorScheme:"green",variant:"solid",fontSize:"2xs",children:"Owner"})]},Je.uid))})})]}),S.jsxs(He,{children:[S.jsxs(Cn,{mb:2,children:[S.jsx(en,{as:iGe,color:"purple.400"}),S.jsx($e,{fontSize:"sm",fontWeight:"600",children:"Hosts"}),S.jsx(Mc,{colorScheme:"purple",ml:2,children:Ct.length})]}),S.jsx(He,{borderWidth:"1px",borderRadius:"md",p:2,bg:"whiteAlpha.50",borderColor:"whiteAlpha.200",maxH:"120px",overflowY:"auto",css:{"&::-webkit-scrollbar":{width:"4px"},"&::-webkit-scrollbar-track":{background:"rgba(0,0,0,0.1)"},"&::-webkit-scrollbar-thumb":{background:"rgba(255,255,255,0.3)",borderRadius:"2px"}},children:Ct.length===0?S.jsx($e,{fontSize:"xs",color:"whiteAlpha.600",children:"No hosts found"}):S.jsx(Qn,{spacing:1,align:"stretch",children:Ct.map(Je=>S.jsxs(Cn,{spacing:2,p:1,borderRadius:"md",_hover:{bg:"whiteAlpha.100"},children:[S.jsx(jc,{size:"xs",src:Je.photoURL,name:Je.displayName}),S.jsxs(He,{children:[S.jsx($e,{fontSize:"xs",children:Je.displayName}),S.jsx($e,{fontSize:"xs",color:"whiteAlpha.600",children:Je.firstName&&Je.lastName?`${Je.firstName} ${Je.lastName}`:"Full name not available"})]}),S.jsx(qC,{}),S.jsx(Mc,{colorScheme:"purple",variant:"solid",fontSize:"2xs",children:"Host"})]},Je.uid))})})]}),S.jsxs(He,{children:[S.jsxs(Cn,{mb:2,children:[S.jsx(en,{as:DZ,color:"red.400"}),S.jsx($e,{fontSize:"sm",fontWeight:"600",children:"Banned Users"}),S.jsx(Mc,{colorScheme:"red",ml:2,children:st.length})]}),S.jsx(He,{borderWidth:"1px",borderRadius:"md",p:2,bg:"whiteAlpha.50",borderColor:"whiteAlpha.200",maxH:"120px",overflowY:"auto",css:{"&::-webkit-scrollbar":{width:"4px"},"&::-webkit-scrollbar-thumb":{background:"rgba(255,255,255,0.3)",borderRadius:"2px"}},children:st.length===0?S.jsx($e,{fontSize:"xs",color:"whiteAlpha.600",children:"No banned users"}):S.jsx(Qn,{spacing:1,align:"stretch",children:st.map(Je=>S.jsxs(Cn,{spacing:2,p:1,borderRadius:"md",_hover:{bg:"whiteAlpha.100"},children:[S.jsx(jc,{size:"xs",src:Je.photoURL,name:Je.displayName}),S.jsxs(He,{children:[S.jsx($e,{fontSize:"xs",children:Je.displayName}),Je.firstName&&S.jsxs($e,{fontSize:"xs",color:"whiteAlpha.600",children:[Je.firstName," ",Je.lastName]})]}),S.jsx(qC,{}),S.jsxs(Cn,{spacing:2,children:[S.jsx(On,{size:"xs",colorScheme:"green",isLoading:an===Je.uid,onClick:()=>Oh(Je.uid),leftIcon:S.jsx(en,{as:bV}),children:"Unban"}),S.jsx(Mc,{colorScheme:"red",variant:"solid",fontSize:"2xs",children:"Banned"})]})]},Je.uid))})})]})]})]}),S.jsxs(dc,{p:4,display:"flex",flexDirection:"column",children:[S.jsx($e,{fontSize:"sm",fontWeight:"600",mb:3,color:"white",children:"Stream Settings"}),S.jsxs(Qn,{spacing:4,align:"stretch",children:[S.jsx(He,{borderWidth:"1px",borderRadius:"md",p:3,bg:"whiteAlpha.50",borderColor:"whiteAlpha.200",children:S.jsxs(Cn,{justify:"space-between",align:"center",children:[S.jsx(He,{children:S.jsxs(Cn,{mb:1,spacing:2,children:[S.jsx(He,{position:"relative",w:"16px",h:"16px",children:S.jsx(en,{as:rR,color:Nt?"green.400":"red.400"})}),S.jsx($e,{fontSize:"sm",fontWeight:"600",children:"Streaming Enabled"})]})}),S.jsx(ld,{isChecked:Nt,onChange:async()=>{const Je=!Nt;Ht(Je),Mo(!0);try{G.log("SpaceManageModal: Auto-saving streaming enabled state:",Je);const qt={enabled:Je,streamUrl:Ur||"",rtmpUrl:ri||"",streamKey:ds||"",playerIndex:"0",updatedAt:new Date().toISOString()};try{await Y5(i,qt),G.log("SpaceManageModal: Successfully updated streaming enabled state in Firebase directly")}catch(qn){throw G.error("SpaceManageModal: Error updating streaming state directly in Firebase:",qn),qn}await Wc(Ur,0,{enabled:Je,rtmpUrl:ri,streamKey:ds}),window.dispatchEvent(new CustomEvent("StreamSettingsChanged",{detail:{enabled:Je,spaceId:i}})),Kt({title:"Streaming "+(Je?"Enabled":"Disabled"),description:`Streaming is now ${Je?"enabled":"disabled"}.`,status:"success",duration:2e3,isClosable:!0})}catch(qt){G.error("Error auto-saving streaming state:",qt),Ht(!Je),Kt({title:"Error",description:"Failed to update streaming status",status:"error",duration:3e3,isClosable:!0})}finally{Mo(!1),setTimeout(()=>{Hc()},500)}},colorScheme:"green",size:"md",isDisabled:Gr})]})}),S.jsxs(He,{borderWidth:"1px",borderRadius:"md",p:4,bg:"whiteAlpha.50",borderColor:"whiteAlpha.200",children:[S.jsx($e,{fontSize:"sm",fontWeight:"600",mb:3,children:"Stream Configuration"}),S.jsxs(br,{mb:4,children:[S.jsx(Ei,{fontSize:"xs",color:"white",children:"Stream URL"}),S.jsx(ni,{value:Ur,onChange:Je=>Ri(Je.target.value),placeholder:"https://example.com/stream.m3u8",size:"sm",bg:"whiteAlpha.100",borderColor:"whiteAlpha.200",_hover:{borderColor:"whiteAlpha.300"},_focus:{borderColor:"blue.300",boxShadow:"0 0 0 1px #63B3ED"},color:"white",isDisabled:Gr})]}),S.jsx(cE,{my:3,borderColor:"whiteAlpha.200"}),S.jsx($e,{fontSize:"sm",fontWeight:"600",mb:3,children:"RTMP Configuration"}),S.jsxs(br,{mb:3,children:[S.jsx(Ei,{fontSize:"xs",color:"white",children:"RTMP URL"}),S.jsx(ni,{value:ri,onChange:Je=>zi(Je.target.value),placeholder:"rtmp://example.com/live",size:"sm",bg:"whiteAlpha.100",borderColor:"whiteAlpha.200",_hover:{borderColor:"whiteAlpha.300"},_focus:{borderColor:"blue.300",boxShadow:"0 0 0 1px #63B3ED"},color:"white",isDisabled:Gr})]}),S.jsxs(br,{mb:3,children:[S.jsx(Ei,{fontSize:"xs",color:"white",children:"Stream Key"}),S.jsx(ni,{value:ds,onChange:Je=>Eo(Je.target.value),placeholder:"xxxxxxxxxxxxxxxxxxxxxxxx",size:"sm",bg:"whiteAlpha.100",borderColor:"whiteAlpha.200",_hover:{borderColor:"whiteAlpha.300"},_focus:{borderColor:"blue.300",boxShadow:"0 0 0 1px #63B3ED"},color:"white",isDisabled:Gr,type:"password"})]})]}),S.jsx(On,{colorScheme:"blue",size:"sm",onClick:Jr,isLoading:Gr,loadingText:"Saving...",alignSelf:"flex-start",mt:2,display:Nt?"inline-flex":"none",children:"Save Stream Settings"}),S.jsxs(sE,{status:"info",variant:"subtle",bg:"whiteAlpha.100",borderRadius:"md",borderWidth:"1px",borderColor:"blue.800",mt:2,mb:8,children:[S.jsx(oE,{color:"blue.300"}),S.jsxs(He,{children:[S.jsx(vk,{fontSize:"xs",fontWeight:"medium",children:"HLS Streaming"}),S.jsx(Sk,{fontSize:"xs",children:"After saving, the stream will be available on all screens. Player index: 0"})]})]})]})]}),S.jsxs(dc,{p:4,display:"flex",flexDirection:"column",children:[S.jsx($e,{fontSize:"sm",fontWeight:"600",mb:3,color:"white",children:"Override Settings"}),S.jsxs(Qn,{spacing:4,align:"stretch",children:[S.jsx(He,{borderWidth:"1px",borderRadius:"md",p:3,bg:"whiteAlpha.50",borderColor:"whiteAlpha.200",children:S.jsxs(Cn,{justify:"space-between",align:"center",children:[S.jsx(He,{children:S.jsxs(Cn,{mb:1,spacing:2,children:[S.jsx(He,{position:"relative",w:"16px",h:"16px",children:S.jsx(en,{as:xZ,color:vo?"green.400":"red.400"})}),S.jsx($e,{fontSize:"sm",fontWeight:"600",children:"Enable Override"})]})}),S.jsx(ld,{isChecked:vo,onChange:sa,colorScheme:"green",size:"md",isDisabled:Ga})]})}),S.jsxs(He,{borderWidth:"1px",borderRadius:"md",p:4,bg:"whiteAlpha.50",borderColor:"whiteAlpha.200",children:[S.jsx($e,{fontSize:"sm",fontWeight:"600",mb:3,children:"Add URL"}),S.jsxs(Cn,{spacing:3,children:[S.jsx(br,{flex:"1",children:S.jsx(ni,{value:So,onChange:Je=>bu(Je.target.value),placeholder:"Enter URL",size:"sm",bg:"whiteAlpha.100",borderColor:"whiteAlpha.200",_hover:{borderColor:"whiteAlpha.300"},_focus:{borderColor:"blue.300",boxShadow:"0 0 0 1px #63B3ED"},color:"white",onKeyPress:Je=>{Je.key==="Enter"&&Vr()}})}),S.jsx(On,{colorScheme:"green",size:"sm",onClick:Vr,leftIcon:S.jsx(en,{as:bV}),flexShrink:0,children:"Add"})]})]}),S.jsxs(He,{borderWidth:"1px",borderRadius:"md",p:4,bg:"whiteAlpha.50",borderColor:"whiteAlpha.200",children:[S.jsxs(Cn,{justify:"space-between",mb:3,children:[S.jsx($e,{fontSize:"sm",fontWeight:"600",children:"URLs"}),S.jsx(Mc,{colorScheme:"blue",children:ns.length})]}),ns.length===0?S.jsx($e,{fontSize:"xs",color:"whiteAlpha.600",children:"No URLs added yet."}):S.jsx(Qn,{spacing:2,align:"stretch",maxH:"250px",overflowY:"auto",css:{"&::-webkit-scrollbar":{width:"6px"},"&::-webkit-scrollbar-track":{background:"rgba(0,0,0,0.1)"},"&::-webkit-scrollbar-thumb":{background:"rgba(255,255,255,0.3)",borderRadius:"3px"}},children:ns.map(Je=>S.jsx(He,{p:2,borderWidth:"1px",borderRadius:"md",borderColor:"whiteAlpha.200",bg:"whiteAlpha.50",_hover:{bg:"whiteAlpha.100"},children:S.jsxs(Cn,{justify:"space-between",align:"center",spacing:3,children:[S.jsx($e,{fontSize:"sm",color:"white",flex:"1",isTruncated:!0,title:Je.url,children:Je.url}),S.jsx(On,{size:"xs",colorScheme:"red",variant:"ghost",onClick:()=>_c(Je.id),flexShrink:0,children:S.jsx(en,{as:Wy})})]})},Je.id))})]}),S.jsx(On,{colorScheme:"blue",size:"sm",onClick:wd,isLoading:Ga,loadingText:"Saving...",alignSelf:"flex-start",children:"Save Override Settings"})]})]})]})]})})]})]})},fGe=({onTogglePlayerList:n,spaceID:e,containerRef:i})=>{const{fullscreenRef:o}=Ch(),[l,u]=k.useState(!0),[p,y]=k.useState(!1),[E,b]=k.useState(!1),[T,R]=k.useState(!1),[O,L]=k.useState(!1),[D,U]=k.useState(!1),[F,Y]=k.useState(null),[W,re]=k.useState(!1),[le,ie]=k.useState(!1),[me,q]=k.useState(!1),[J,Q]=k.useState(!1),ne=ea(),{user:he,currentUser:de,isGuestUser:pe}=k.useContext(Di),Ie=he!=null&&he.Nickname?he.Nickname:de&&pe(de)?de.username||de.Nickname||"Guest User":"Unknown",[Fe,we]=k.useState(!1),Re=ft=>{if(!ft)return"G";if(ft.startsWith("Visitor_")){const lt=ft.split("_")[1];return`V${lt?lt.charAt(0):""}`}return ft.charAt(0).toUpperCase()},Te=async()=>{if(he!=null&&he.uid&&e)try{const ft=await Fc(he.uid);let lt=!1,gt=!1;if(ft.groups){const Ct=`space_${e}_owners`,En=`space_${e}_hosts`;lt=ft.groups.includes(Ct),gt=ft.groups.includes(En)}const at=await lx(he.uid,"disruptiveAdmin");if(Q(at),Y({rpmURL:ft.rpmURL?ft.rpmURL.replace(".glb",".png?scene=fullbody-portrait-closeupfront&w=640&q=75"):null,isGuest:!1}),ie(lt||at),q(gt),!lt&&!at&&W){re(!1);const Ct=new CustomEvent("editModeChanged",{detail:{enabled:!1}});window.dispatchEvent(Ct),ne({title:"Edit Mode Disabled",description:"You don't have permission to edit this space.",status:"warning",duration:5e3,isClosable:!0,position:"top"})}}catch(ft){console.error("Error fetching profile data:",ft),ie(!1),q(!1),Q(!1)}else if(de&&pe(de)){if(Y({rpmURL:de.rpmURL?de.rpmURL.replace(".glb",".png?scene=fullbody-portrait-closeupfront&w=640&q=75"):null,isGuest:!0}),ie(!1),q(!1),Q(!1),W){re(!1);const ft=new CustomEvent("editModeChanged",{detail:{enabled:!1}});window.dispatchEvent(ft)}}else Y(null),ie(!1),q(!1),Q(!1)};k.useEffect(()=>{Te()},[he==null?void 0:he.uid,de==null?void 0:de.uid,de==null?void 0:de.rpmURL,e,W]),k.useEffect(()=>{const ft=()=>{u(!0)};return window.addEventListener("PlayerInstantiated",ft),()=>{window.removeEventListener("PlayerInstantiated",ft)}},[]),k.useEffect(()=>{(async()=>{try{window.agoraClient&&typeof window.agoraClient.voiceDisabled=="boolean"&&we(window.agoraClient.voiceDisabled)}catch(gt){console.error("Error checking if voice is disabled:",gt)}})();const lt=gt=>{gt.detail&&typeof gt.detail.voiceDisabled=="boolean"&&we(gt.detail.voiceDisabled)};return window.addEventListener("SpaceVoiceSettingChanged",lt),()=>{window.removeEventListener("SpaceVoiceSettingChanged",lt)}},[]);const Ne=()=>{b(!E),E||dt()},be=()=>R(!T),xe=()=>{U(!D),dt()},je=()=>{L(!1),Te()},nt=ft=>{ft.stopPropagation(),typeof n=="function"&&(G.log("CanvasMainMenu: Toggling player list"),n())},dt=()=>{y(!1)};return S.jsxs(S.Fragment,{children:[S.jsxs(SE,{isOpen:p,onClose:()=>y(!1),children:[S.jsx(bE,{as:va,icon:S.jsx($ze,{}),"aria-label":"Main menu",variant:"ghost",color:"white",bg:"rgba(0,0,0,0.4)",backdropFilter:"blur(10px)",_hover:{bg:p?"rgba(0,0,0,0.5)":"rgba(0,0,0,0.3)"},size:"md",onClick:()=>y(!p)}),S.jsx(Bc,{containerRef:o,children:S.jsx(wE,{bg:"rgba(0,0,0,0.4)",backdropFilter:"blur(10px)",border:"none",boxShadow:"lg",color:"white",width:"300px",p:3,borderRadius:"lg",zIndex:9999,transform:"none !important",children:S.jsxs(Qn,{align:"stretch",spacing:3,children:[S.jsxs(Cn,{spacing:3,children:[S.jsx(jc,{size:"sm",src:F==null?void 0:F.rpmURL,bg:"white",name:F!=null&&F.isGuest?Re((de==null?void 0:de.username)||(de==null?void 0:de.Nickname)):" ",borderWidth:"1px",borderColor:"whiteAlpha.300"}),S.jsxs(Qn,{align:"start",spacing:0,children:[S.jsxs(Cn,{children:[S.jsx($e,{fontWeight:"bold",fontSize:"sm",children:Ie}),le&&!J&&S.jsx(Kf,{label:"Owner",placement:"top",hasArrow:!0,zIndex:1e4,openDelay:300,gutter:8,portalProps:{containerRef:o},children:S.jsx(He,{display:"inline-block",children:S.jsx(en,{as:Qk,color:"green.400",boxSize:2.5})})}),!le&&me&&!J&&S.jsx(Kf,{label:"Host",placement:"top",hasArrow:!0,zIndex:1e4,openDelay:300,gutter:8,portalProps:{containerRef:o},children:S.jsx(He,{display:"inline-block",children:S.jsx(en,{as:Zk,color:"purple.400",boxSize:2.5})})}),J&&S.jsx(Kf,{label:"Admin",placement:"top",hasArrow:!0,zIndex:1e4,openDelay:300,gutter:8,portalProps:{containerRef:o},children:S.jsx(He,{display:"inline-block",children:S.jsx(en,{as:Z9e,color:"blue.400",boxSize:2.5})})})]}),S.jsx($e,{fontSize:"xs",color:"whiteAlpha.800",children:"Spaces Metaverse"})]})]}),S.jsxs(Cn,{spacing:3,justify:"center",children:[S.jsx(va,{icon:S.jsx(rWe,{}),variant:"ghost",colorScheme:"whiteAlpha",size:"sm","aria-label":"People",_hover:{bg:"whiteAlpha.200"},onClick:nt}),S.jsx(va,{icon:S.jsx(He,{w:"4",h:"4"}),variant:"ghost",colorScheme:"whiteAlpha",size:"sm","aria-label":"Action 2",_hover:{bg:"whiteAlpha.200"}}),S.jsx(va,{icon:S.jsx(He,{w:"4",h:"4"}),variant:"ghost",colorScheme:"whiteAlpha",size:"sm","aria-label":"Action 3",_hover:{bg:"whiteAlpha.200"}}),S.jsx(va,{icon:S.jsx(He,{w:"4",h:"4"}),variant:"ghost",colorScheme:"whiteAlpha",size:"sm","aria-label":"Action 4",_hover:{bg:"whiteAlpha.200"}})]}),S.jsx(cE,{borderColor:"whiteAlpha.300"}),S.jsxs(Qn,{align:"stretch",spacing:1,children:[le&&S.jsx($e,{fontSize:"sm",cursor:"pointer",_hover:{bg:"whiteAlpha.200"},p:1.5,borderRadius:"md",onClick:xe,children:"Manage Space"}),he&&e&&!Fe&&S.jsx(qWe,{onClose:dt}),S.jsx($e,{fontSize:"sm",cursor:"pointer",_hover:{bg:"whiteAlpha.200"},p:1.5,borderRadius:"md",onClick:Ne,children:"Settings"}),S.jsx($e,{fontSize:"sm",cursor:"pointer",_hover:{bg:"whiteAlpha.200"},p:1.5,borderRadius:"md",onClick:()=>window.open("https://support.spacesmetaverse.com/","_blank"),children:"Support"}),S.jsx($e,{fontSize:"sm",cursor:"pointer",_hover:{bg:"whiteAlpha.200"},p:1.5,borderRadius:"md",color:"red.300",children:"Leave"})]})]})})})]}),T&&S.jsx(YWe,{open:T,onClose:be}),E&&S.jsx(JWe,{open:E,onClose:Ne,containerRef:i}),O&&S.jsx(nce,{open:O,onClose:je}),S.jsx(pGe,{isOpen:D,onClose:xe})]})},mGe=({isOpen:n,onClose:e,mediaScreenId:i,onImageChange:o})=>{const{spaceID:l}=Lo(),u=Wa(),p=ea(),y=k.useRef(null),E=k.useRef(null),b=k.useRef(),[T,R]=k.useState(null),[O,L]=k.useState(""),[D,U]=k.useState(!1),[F,Y]=k.useState(0),[W,re]=k.useState(null),[le,ie]=k.useState(!0),[me,q]=k.useState(!1),[J,Q]=k.useState(!1),[ne,he]=k.useState(0),[de,pe]=k.useState("image"),[Se,Ie]=k.useState(""),[Fe,we]=k.useState(!1);k.useEffect(()=>{(async()=>{if(n&&i&&l){ie(!0);try{const Ct=await _E(l,i);if(Ct&&(Ct.imageUrl||Ct.videoUrl)){re(Ct);const En=Ct.mediaType==="video";pe(En?"video":"image"),we(Ct.displayAsVideo||!1),En&&Ct.videoUrl&&(Ie(Ct.videoUrl),he(1))}else re(null)}catch(Ct){G.error("Error fetching existing image:",Ct),re(null)}finally{ie(!1)}}})()},[n,i,l]),k.useEffect(()=>{n||(R(null),L(""),Y(0),Ie(""))},[n]);const Re=k.useCallback(at=>{at.preventDefault(),at.stopPropagation(),Q(!0)},[]),Te=k.useCallback(at=>{at.preventDefault(),at.stopPropagation(),Q(!1)},[]),Ne=k.useCallback(at=>{at.preventDefault(),at.stopPropagation()},[]),be=k.useCallback(at=>{if(at.preventDefault(),at.stopPropagation(),Q(!1),at.dataTransfer.files&&at.dataTransfer.files.length>0){const Ct=at.dataTransfer.files[0];xe(Ct)}},[]);k.useEffect(()=>{const at=E.current;if(at)return at.addEventListener("dragenter",Re),at.addEventListener("dragleave",Te),at.addEventListener("dragover",Ne),at.addEventListener("drop",be),()=>{at.removeEventListener("dragenter",Re),at.removeEventListener("dragleave",Te),at.removeEventListener("dragover",Ne),at.removeEventListener("drop",be)}},[Re,Te,Ne,be]);const xe=at=>{if(!at)return;if(!at.type.startsWith("image/")){p({title:"Invalid file type",description:"Please select an image file (PNG, JPEG, etc.)",status:"error",duration:5e3,isClosable:!0});return}R(at);const Ct=new FileReader;Ct.onloadend=()=>{L(Ct.result)},Ct.readAsDataURL(at)},je=at=>{const Ct=at.target.files[0];xe(Ct)},nt=async at=>{const Ct=at.target.checked;if(we(Ct),W)try{await uWe(l,i,Ct),Ct?u("SetMediaScreenImage",{mediaScreenId:i,imageUrl:null,videoUrl:W.videoUrl||null,mediaType:W.mediaType||"image",displayAsVideo:!0}):u("SetMediaScreenImage",{mediaScreenId:i,imageUrl:W.imageUrl||null,videoUrl:W.videoUrl||null,mediaType:W.mediaType||"image",displayAsVideo:!1}),re({...W,displayAsVideo:Ct}),p({title:"Display mode updated",description:`The media screen will now be displayed as ${Ct?"video":"image"}`,status:"success",duration:3e3,isClosable:!0}),G.log(`Updated display mode for media screen ${i} to ${Ct?"video":"image"}`),o&&o({type:"update",mediaScreenId:i,displayAsVideo:Ct})}catch(En){G.error("Error updating display mode:",En),p({title:"Update failed",description:En.message||"An error occurred while updating the display mode",status:"error",duration:5e3,isClosable:!0}),we(!Ct)}},dt=async()=>{if(de==="image"&&!T){p({title:"No file selected",description:"Please select an image to upload",status:"warning",duration:5e3,isClosable:!0});return}if(de==="video"&&!Se){p({title:"No video URL",description:"Please enter a video URL",status:"warning",duration:5e3,isClosable:!0});return}try{U(!0);const at=setInterval(()=>{Y(Jt=>{const st=Jt+10;return st>=90?90:st})},300);let Ct;de==="image"?Ct=await AZ(l,i,T,{mediaType:de,displayAsVideo:Fe}):(Ct=Se,await AZ(l,i,null,{mediaType:"video",directUrl:Se,displayAsVideo:Fe})),clearInterval(at),Y(100);let En=null,Gt=null;de==="image"?(En=Fe?null:Ct,Gt=(W==null?void 0:W.videoUrl)||null):(En=!Fe&&(W!=null&&W.imageUrl)?W.imageUrl:null,Gt=Ct),u("SetMediaScreenImage",{mediaScreenId:i,imageUrl:En,videoUrl:Gt,mediaType:de,displayAsVideo:Fe}),G.log(`Uploaded and sent ${de} for media screen ${i} (display as video: ${Fe})`),o&&o({type:"upload",mediaScreenId:i,imageUrl:de==="image"?Ct:W==null?void 0:W.imageUrl,videoUrl:de==="video"?Ct:W==null?void 0:W.videoUrl,mediaType:de,displayAsVideo:Fe}),p({title:"Upload successful",description:`The ${de} has been uploaded and applied to the media screen`,status:"success",duration:5e3,isClosable:!0}),setTimeout(()=>{R(null),L(""),U(!1),Y(0),e()},1e3)}catch(at){G.error(`Error uploading ${de}:`,at),p({title:"Upload failed",description:at.message||`An error occurred while uploading the ${de}`,status:"error",duration:5e3,isClosable:!0}),U(!1),Y(0)}},ft=async()=>{q(!1);try{U(!0),await lWe(l,i),u("SetMediaScreenImage",{mediaScreenId:i,imageUrl:de==="image"?null:(W==null?void 0:W.imageUrl)||null,videoUrl:de==="video"?null:(W==null?void 0:W.videoUrl)||null,mediaType:null,displayAsVideo:!1}),G.log(`Deleted ${de} for media screen ${i}`),o&&o({type:"delete",mediaScreenId:i}),p({title:`${de==="image"?"Image":"Video"} deleted`,description:`The ${de} has been removed from the media screen`,status:"success",duration:5e3,isClosable:!0}),re(null),U(!1),Ie(""),we(!1),setTimeout(()=>{e()},500)}catch(at){G.error(`Error deleting ${de}:`,at),p({title:"Deletion failed",description:at.message||`An error occurred while deleting the ${de}`,status:"error",duration:5e3,isClosable:!0}),U(!1)}},lt=()=>{D||(R(null),L(""),Y(0),e())},gt=at=>{he(at),pe(at===0?"image":"video")};return S.jsxs(S.Fragment,{children:[S.jsxs(_s,{isOpen:n,onClose:lt,size:"lg",children:[S.jsx(vs,{bg:"rgba(0, 0, 0, 0.8)",backdropFilter:"blur(8px)"}),S.jsxs(ys,{bg:"#1a1a1a",color:"white",maxW:"650px",borderRadius:"xl",border:"1px solid #333",children:[S.jsx(Do,{fontSize:"md",fontWeight:"600",pb:1,pt:3,px:4,color:"white",children:"Media Screen"}),S.jsx(Ns,{isDisabled:D,color:"gray.400",_hover:{color:"white",bg:"rgba(255,255,255,0.1)"},borderRadius:"full",size:"sm",top:3,right:3}),S.jsxs(He,{px:4,pb:1,children:[S.jsxs(Mr,{justify:"space-between",align:"center",bg:"rgba(255,255,255,0.03)",p:2,borderRadius:"lg",mb:1,border:"1px solid rgba(255,255,255,0.08)",children:[S.jsxs(Cn,{spacing:2,children:[S.jsx($e,{fontWeight:"500",fontSize:"xs",color:"gray.300",children:"Display:"}),S.jsxs(Cn,{spacing:2,children:[S.jsx(en,{as:zy,color:Fe?"gray.500":"white",size:"sm"}),S.jsx(ld,{colorScheme:"gray",size:"sm",isChecked:Fe,onChange:nt}),S.jsx(en,{as:rR,color:Fe?"white":"gray.500",size:"sm"})]})]}),S.jsx(Mc,{bg:"rgba(255,255,255,0.1)",color:"gray.300",fontSize:"xs",px:2,py:1,borderRadius:"md",fontWeight:"500",children:Fe?"Video":"Image"})]}),S.jsxs($e,{fontSize:"xs",color:"gray.500",children:["ID: ",i]})]}),S.jsx(Es,{px:4,py:1,children:S.jsxs(Mr,{children:[S.jsx($S,{orientation:"vertical",variant:"unstyled",index:ne,onChange:gt,h:"100%",minW:"75px",mr:3,children:S.jsxs(KS,{spacing:1,children:[S.jsxs(ya,{_selected:{color:"white",bg:"rgba(255,255,255,0.1)",borderRadius:"lg"},_hover:{bg:"rgba(255,255,255,0.05)"},mb:1,py:1.5,px:2.5,justifyContent:"flex-start",borderRadius:"lg",fontSize:"xs",fontWeight:"500",color:"gray.400",w:"full",children:[S.jsx(en,{as:zy,mr:1.5,size:"sm"})," Image"]}),S.jsxs(ya,{_selected:{color:"white",bg:"rgba(255,255,255,0.1)",borderRadius:"lg"},_hover:{bg:"rgba(255,255,255,0.05)"},py:1.5,px:2.5,justifyContent:"flex-start",borderRadius:"lg",fontSize:"xs",fontWeight:"500",color:"gray.400",w:"full",children:[S.jsx(en,{as:rR,mr:1.5,size:"sm"})," Video"]})]})}),S.jsx(He,{flex:"1",children:le?S.jsx(Mr,{justify:"center",align:"center",h:"120px",children:S.jsx(vd,{size:"lg",color:"white"})}):S.jsxs(S.Fragment,{children:[S.jsx(He,{children:ne===0?S.jsxs(Qn,{spacing:4,align:"stretch",children:[W&&W.imageUrl&&de==="image"&&S.jsxs(He,{children:[S.jsx($e,{fontWeight:"semibold",mb:2,children:"Current Image:"}),S.jsxs(Mr,{children:[S.jsx(He,{borderWidth:"1px",borderRadius:"md",overflow:"hidden",mb:2,maxW:"200px",mr:4,children:S.jsx(kp,{src:W.imageUrl,alt:"Current image",maxHeight:"150px",width:"100%",objectFit:"contain"})}),S.jsxs(Qn,{align:"flex-start",spacing:2,children:[S.jsxs($e,{fontSize:"xs",color:"gray.400",children:["Uploaded: ",new Date(W.uploadedAt).toLocaleString()]}),S.jsxs($e,{fontSize:"xs",color:"gray.400",children:["Display Mode: ",W.displayAsVideo?"Video":"Image"]}),S.jsx(On,{size:"sm",colorScheme:"red",variant:"outline",leftIcon:S.jsx(en,{as:Wy}),onClick:()=>q(!0),isDisabled:D,children:"Delete"})]})]}),S.jsx(cE,{my:4})]}),S.jsx($e,{fontWeight:"semibold",mb:2,children:W&&W.imageUrl&&de==="image"?"Replace with new image:":"Upload new image:"}),S.jsxs(He,{ref:E,borderWidth:"2px",borderRadius:"md",borderStyle:"dashed",borderColor:J?"rgba(255,255,255,0.3)":"rgba(255,255,255,0.15)",bg:J?"rgba(255,255,255,0.08)":"rgba(255,255,255,0.03)",p:4,textAlign:"center",transition:"all 0.2s ease",_hover:{borderColor:"rgba(255,255,255,0.3)",bg:"rgba(255,255,255,0.06)"},cursor:"pointer",onClick:()=>y.current.click(),children:[O?S.jsx(He,{borderRadius:"md",overflow:"hidden",maxH:"200px",children:S.jsx(kp,{src:O,alt:"Preview",maxHeight:"200px",width:"100%",objectFit:"contain"})}):S.jsxs(Qn,{spacing:2,children:[S.jsx(en,{as:ak,boxSize:"20px",color:"gray.400"}),S.jsxs(Qn,{spacing:0,children:[S.jsx($e,{fontSize:"xs",fontWeight:"500",color:"white",children:"Drop image or click to browse"}),S.jsx($e,{fontSize:"xs",color:"gray.500",children:"PNG, JPG, JPEG, GIF"})]})]}),S.jsx(ni,{type:"file",accept:"image/*",onChange:je,ref:y,display:"none"})]}),T&&S.jsxs($e,{fontSize:"xs",color:"gray.400",bg:"rgba(255,255,255,0.05)",p:2,borderRadius:"md",border:"1px solid rgba(255,255,255,0.1)",children:[T.name," (",Math.round(T.size/1024)," KB)"]})]}):S.jsxs(Qn,{spacing:4,align:"stretch",children:[W&&W.videoUrl&&de==="video"&&S.jsxs(He,{children:[S.jsx($e,{fontWeight:"500",mb:1,fontSize:"xs",color:"gray.400",children:"Current Video URL:"}),S.jsxs(Mr,{children:[S.jsx(He,{borderWidth:"1px",borderRadius:"md",p:3,mb:2,flex:"1",mr:4,bg:"gray.700",children:S.jsx($e,{fontSize:"sm",wordBreak:"break-all",children:W.videoUrl})}),S.jsxs(Qn,{align:"flex-start",spacing:2,children:[S.jsxs($e,{fontSize:"xs",color:"gray.400",children:["Added: ",new Date(W.uploadedAt).toLocaleString()]}),S.jsxs($e,{fontSize:"xs",color:"gray.400",children:["Display Mode: ",W.displayAsVideo?"Video":"Image"]}),S.jsx(On,{size:"sm",colorScheme:"red",variant:"outline",leftIcon:S.jsx(en,{as:Wy}),onClick:()=>q(!0),isDisabled:D,children:"Delete"})]})]}),S.jsx(cE,{my:4})]}),S.jsxs(br,{children:[S.jsx(Ei,{fontSize:"xs",fontWeight:"500",color:"white",mb:1.5,children:"Video URL"}),S.jsx(ni,{placeholder:"https://youtube.com/watch?v=...",value:Se,onChange:at=>Ie(at.target.value),bg:"rgba(255,255,255,0.05)",borderColor:"rgba(255,255,255,0.15)",_hover:{borderColor:"rgba(255,255,255,0.3)"},_focus:{borderColor:"rgba(255,255,255,0.5)",boxShadow:"0 0 0 1px rgba(255,255,255,0.3)"},size:"sm",borderRadius:"lg",color:"white",fontSize:"xs",_placeholder:{color:"gray.500",fontSize:"xs"}})]}),Se&&S.jsxs(He,{mt:2,p:2,bg:"rgba(255,255,255,0.05)",borderRadius:"lg",border:"1px solid rgba(255,255,255,0.1)",children:[S.jsxs(Cn,{mb:1,children:[S.jsx(en,{as:tGe,color:"gray.400",size:"sm"}),S.jsx($e,{fontWeight:"500",fontSize:"xs",color:"white",children:"Preview"})]}),S.jsx($e,{fontSize:"xs",wordBreak:"break-all",color:"gray.400",children:Se})]})]})}),D&&S.jsxs(He,{mt:3,children:[S.jsxs($e,{mb:2,fontSize:"sm",fontWeight:"500",color:"white",children:["Uploading: ",F,"%"]}),S.jsx(Zy,{value:F,colorScheme:"gray",size:"sm",borderRadius:"full",bg:"rgba(255,255,255,0.1)"})]})]})})]})}),S.jsx(vh,{pt:2,pb:3,px:4,children:S.jsxs(Mr,{w:"full",gap:3,children:[S.jsx(On,{variant:"outline",flex:1,onClick:lt,isDisabled:D,color:"gray.400",borderColor:"rgba(255,255,255,0.2)",_hover:{bg:"rgba(255,255,255,0.05)",borderColor:"rgba(255,255,255,0.3)"},borderRadius:"lg",size:"sm",fontSize:"xs",fontWeight:"500",children:"Cancel"}),S.jsx(On,{bg:"#6b7280",color:"white",flex:2,onClick:dt,isLoading:D,loadingText:"Saving",isDisabled:de==="image"&&!T||de==="video"&&!Se||D||le,leftIcon:S.jsx(en,{as:de==="image"?zy:rR,size:"sm"}),_hover:{bg:"#4b5563"},_active:{bg:"#374151"},_disabled:{bg:"#374151",opacity:.5},borderRadius:"lg",size:"sm",fontSize:"xs",fontWeight:"600",children:de==="image"?"Upload":"Save URL"})]})})]})]}),S.jsx(mUe,{isOpen:me,leastDestructiveRef:b,onClose:()=>q(!1),children:S.jsx(vs,{bg:"rgba(0, 0, 0, 0.8)",children:S.jsxs(gUe,{bg:"#1a1a1a",color:"white",borderRadius:"xl",border:"1px solid #333",maxW:"350px",children:[S.jsxs(Do,{fontSize:"md",fontWeight:"600",pt:4,pb:2,color:"white",children:["Delete ",de==="video"?"Video":"Image"]}),S.jsx(Es,{py:2,color:"gray.400",fontSize:"sm",children:"Are you sure? This will revert the media screen to its blank state."}),S.jsx(vh,{pt:3,pb:4,children:S.jsxs(Mr,{w:"full",gap:2,children:[S.jsx(On,{ref:b,onClick:()=>q(!1),variant:"outline",flex:1,color:"gray.400",borderColor:"rgba(255,255,255,0.2)",_hover:{bg:"rgba(255,255,255,0.05)"},borderRadius:"lg",size:"sm",fontSize:"sm",children:"Cancel"}),S.jsx(On,{bg:"#dc2626",color:"white",onClick:ft,flex:1,leftIcon:S.jsx(en,{as:Wy,size:"sm"}),_hover:{bg:"#b91c1c"},borderRadius:"lg",fontWeight:"600",size:"sm",fontSize:"sm",children:"Delete"})]})})]})})})]})},gGe=n=>{const[e,i]=k.useState(null),[o,l]=k.useState(""),[u,p]=k.useState(null),[y,E]=k.useState(!1),b=zc(),{spaceID:T}=Lo(),R=k.useCallback(D=>{var U,F;try{if(!D)return null;if(D.includes("youtube.com")||D.includes("youtu.be")){let Y="";return D.includes("youtube.com/watch")?Y=new URLSearchParams(new URL(D).search).get("v"):D.includes("youtu.be/")&&(Y=D.split("youtu.be/")[1].split("?")[0]),Y?`https://www.youtube.com/embed/${Y}?autoplay=1`:D}if(D.includes("vimeo.com")){if(D.includes("player.vimeo.com/video"))return D;const Y=(F=(U=D.split("vimeo.com/")[1])==null?void 0:U.split("?")[0])==null?void 0:F.split("/")[0];return Y?`https://player.vimeo.com/video/${Y}?autoplay=1`:D}return D}catch(Y){return G.error("Error converting to embed URL:",Y),D}},[]),O=k.useCallback(()=>{setTimeout(()=>{E(!1),G.log("Video processing state reset")},100)},[]);k.useEffect(()=>{let D=!0,U=null;const Y=b("PlayMediaScreenVideo",async W=>{try{const{mediaScreenId:re,videoUrl:le}=W||{};if(!re){G.error("Media screen ID is missing in Unity event data."),O();return}if(n){G.log("Edit mode is active, setting media screen ID but not playing video"),p(re);return}if(E(!0),U=setTimeout(()=>{D&&(G.warn("Video processing timeout reached, resetting state"),E(!1))},5e3),le){if(D)try{const ie=R(le);i(ie),l(`Media Screen ${re}`),p(re),G.log("Media screen video URL set directly from event:",ie)}catch(ie){G.error("Error setting video URL from direct URL:",ie)}finally{O(),clearTimeout(U)}return}try{const ie=await _E(T,re);if(!ie||!ie.videoUrl){G.error("No video URL found for media screen:",re),O(),clearTimeout(U);return}if(!ie.displayAsVideo){G.log("Media screen is not set to display as video:",re),O(),clearTimeout(U);return}if(D)try{const me=R(ie.videoUrl),q=ie.title||`Media Screen ${re}`;i(me),l(q),p(re),G.log("Media screen video URL set to:",me)}catch(me){G.error("Error setting video URL from Firestore:",me)}finally{O(),clearTimeout(U)}}catch(ie){G.error(`Error fetching media screen data for ${re}:`,ie),O(),clearTimeout(U)}}catch(re){G.error("Error handling media screen video play:",re),console.error("Error handling media screen video play:",re),O(),clearTimeout(U)}});return()=>{D=!1,U&&clearTimeout(U),Y()}},[b,T,n,R,O]);const L=k.useCallback(()=>{i(null),l(""),p(null),E(!1),G.log("Video player state reset")},[]);return[e,o,u,L,y]},_Ge=()=>{const{spaceID:n}=Lo(),e=Wa(),i=zc(),[o,l]=k.useState(!1);k.useEffect(()=>{if(window.isPlayerInstantiated){G.log("useMediaScreenThumbnails: Unity already ready (via window flag)"),l(!0);return}const b=()=>{G.log("useMediaScreenThumbnails: Unity is now ready (PlayerInstantiated event)"),l(!0)};return window.addEventListener("PlayerInstantiated",b),()=>{window.removeEventListener("PlayerInstantiated",b)}},[]);const u=k.useCallback(async b=>{try{return b.includes("vimeo.com")?await p(b):b.includes("youtube.com")||b.includes("youtu.be")?await y(b):"https://via.placeholder.com/640x360?text=Video"}catch(T){return G.error(`Error fetching thumbnail for ${b}:`,T),"https://via.placeholder.com/640x360?text=Error"}},[]),p=async b=>{try{const T=`https://vimeo.com/api/oembed.json?url=${encodeURIComponent(b)}`,R=await fetch(T);if(!R.ok)throw new Error(`Failed to fetch Vimeo thumbnail: ${R.statusText}`);const O=await R.json(),L=O.thumbnail_url.replace(/_\d+x\d+/,""),D=["640x360","295x166"];let U=null;for(let F of D){const Y=`https://i.vimeocdn.com/filter/overlay?src0=${encodeURIComponent(`${L}_${F}`)}&src1=http://f.vimeocdn.com/p/images/crawler_play.png`;try{if((await fetch(Y,{method:"HEAD"})).ok){U=Y;break}}catch(W){G.warn(`Failed to validate thumbnail URL: ${Y}`,W)}}return U||O.thumbnail_url}catch(T){return G.error(`Error fetching Vimeo thumbnail: ${T.message}`),"https://via.placeholder.com/640x360?text=Vimeo+Video"}},y=async b=>{let T="";if(b.includes("youtube.com/watch")?T=new URLSearchParams(new URL(b).search).get("v"):b.includes("youtu.be/")&&(T=b.split("youtu.be/")[1].split("?")[0]),!T)throw new Error("Could not extract YouTube video ID");const R=`https://img.youtube.com/vi/${T}/maxresdefault.jpg`;try{if((await fetch(R,{method:"HEAD"})).ok)return R}catch(O){G.warn(`Failed to validate maxresdefault thumbnail for YouTube video ${T}`,O)}return`https://img.youtube.com/vi/${T}/hqdefault.jpg`},E=k.useCallback(async b=>{try{if(!n||!b)return;G.log(`Refreshing thumbnail for media screen ${b}`);const T=await _E(n,b);if(!T){G.log(`No media screen found with ID ${b}`);return}if(G.log("Media screen data:",T),!T.displayAsVideo||!T.videoUrl){G.log(`Media screen ${b} is not set to display as video or has no video URL`);return}const R=await u(T.videoUrl);e("SetMediaScreenThumbnail",{mediaScreenId:b,thumbnailUrl:R}),G.log(`Sent refreshed thumbnail for media screen ${b}: ${R}`)}catch(T){G.error(`Error refreshing thumbnail for media screen ${b}:`,T)}},[n,u,e]);k.useEffect(()=>{if(!o){G.log("useMediaScreenThumbnails: Waiting for Unity to be ready before setting up thumbnail listeners");return}G.log("useMediaScreenThumbnails: Unity is ready, now setting up thumbnail listeners");const T=i("SetMediaScreenThumbnail",async R=>{try{const{mediaScreenId:O,thumbnailUrl:L}=R;L==="refresh"&&O&&await E(O)}catch(O){console.error("Error handling SetMediaScreenThumbnail event:",O)}});return()=>{T()}},[i,E,o]),k.useEffect(()=>{if(!o){G.log("useMediaScreenThumbnails: Waiting for Unity to be ready before fetching thumbnails");return}G.log("useMediaScreenThumbnails: Unity is ready, now fetching thumbnails");const b=async()=>{try{if(!n)throw new Error("spaceID is not defined.");G.log("Fetching media screens for thumbnails...");const R=await r4(n);G.log("All media screens:",R);const O=R.filter(U=>U.displayAsVideo&&U.videoUrl);if(G.log("Media screens set to display as videos:",O),O.length===0){G.log("No media screens set to display as videos found.");return}G.log(`Found ${O.length} media screens set to display as videos.`);const L=O.map(async U=>{try{const F=await u(U.videoUrl);return G.log(`Fetched thumbnail for ${U.id}: ${F}`),{mediaScreenId:U.id,thumbnailUrl:F}}catch(F){return G.error(`Error processing thumbnail for media screen ${U.id}:`,F),{mediaScreenId:U.id,thumbnailUrl:"https://via.placeholder.com/640x360?text=Error"}}}),D=await Promise.all(L);G.log("Fetched Media Screen Thumbnails",D),D.forEach(({mediaScreenId:U,thumbnailUrl:F})=>{e("SetMediaScreenThumbnail",{mediaScreenId:U,thumbnailUrl:F}),G.log(`Sent thumbnail to Unity for media screen ${U}: ${F}`)})}catch(R){G.error("Error fetching media screen thumbnails:",R)}};b();const T=setInterval(b,300*1e3);return()=>{clearInterval(T)}},[e,n,u,o])},MZ={iframeContainer:{position:"relative",paddingBottom:"56.25%",height:0,overflow:"hidden",width:"100%",pointerEvents:"auto !important"},iframe:{position:"absolute",top:0,left:0,width:"100%",height:"100%",border:"none",pointerEvents:"auto !important",zIndex:1e4}},yGe=()=>S.jsx("style",{dangerouslySetInnerHTML:{__html:`
        /* Disable pointer events on Unity elements when modal is open */
        body.unity-input-disabled #unity-container,
        body.unity-input-disabled #unity-canvas {
          pointer-events: none !important;
        }
        
        /* Make sure the modal is above Unity */
        .chakra-modal__overlay {
          z-index: 1001 !important;
          pointer-events: auto !important;
        }
        
        .chakra-modal__content {
          z-index: 1002 !important;
          pointer-events: auto !important;
        }
        
        /* Make sure the iframe is visible and interactive */
        .video-iframe {
          z-index: 1003 !important;
          pointer-events: auto !important;
        }
        
        /* Make sure the close button is accessible */
        .chakra-modal__close-btn {
          z-index: 1004 !important;
        }
        
        /* Ensure the iframe container allows clicks */
        .iframe-container {
          pointer-events: auto !important;
        }
        
        /* Remove the full-screen blocker */
      `}}),EGe=({videoUrl:n,videoTitle:e,mediaScreenId:i,isOpen:o,onClose:l})=>{const{fullscreenRef:u}=Ch();return fx(o,`video-modal-${i}`),k.useEffect(()=>{if(o){const p=b=>{b.target.classList&&b.target.classList.contains("chakra-modal__overlay")&&(b.stopPropagation(),b.preventDefault())};document.addEventListener("mousemove",p,!0),document.addEventListener("mousedown",p,!0),document.addEventListener("mouseup",p,!0),document.addEventListener("click",p,!0),document.addEventListener("wheel",p,!0);const y=document.getElementById("unity-canvas"),E=document.getElementById("unity-container");if(y&&(y.style.pointerEvents="none"),E&&(E.style.pointerEvents="none"),document.body.classList.add("unity-input-disabled"),window.unityInstance)try{window.unityInstance.SendMessage("WebGLInputManager","Disable"),window.unityInstance.SendMessage("CameraController","DisableInput","VideoModal")}catch(b){console.error("Error disabling Unity input:",b)}return()=>{if(document.removeEventListener("mousemove",p,!0),document.removeEventListener("mousedown",p,!0),document.removeEventListener("mouseup",p,!0),document.removeEventListener("click",p,!0),document.removeEventListener("wheel",p,!0),y&&(y.style.pointerEvents="auto"),E&&(E.style.pointerEvents="auto"),document.body.classList.remove("unity-input-disabled"),window.unityInstance)try{window.unityInstance.SendMessage("WebGLInputManager","Enable"),window.unityInstance.SendMessage("CameraController","EnableInput","VideoModal")}catch(b){console.error("Error re-enabling Unity input:",b)}}}},[o]),S.jsxs(S.Fragment,{children:[S.jsx(yGe,{}),S.jsxs(_s,{isOpen:o,onClose:l,size:"xl",isCentered:!0,portalProps:{containerRef:u},closeOnOverlayClick:!0,closeOnEsc:!0,id:`video-modal-${i}`,children:[S.jsx(vs,{bg:"rgba(0, 0, 0, 0.8)",onClick:p=>{p.target===p.currentTarget&&(l(),p.stopPropagation(),p.preventDefault())},onMouseMove:p=>{p.target===p.currentTarget&&(p.stopPropagation(),p.preventDefault())},onMouseDown:p=>{p.target===p.currentTarget&&(p.stopPropagation(),p.preventDefault())},onMouseUp:p=>{p.target===p.currentTarget&&(p.stopPropagation(),p.preventDefault())},onWheel:p=>{p.target===p.currentTarget&&(p.stopPropagation(),p.preventDefault())},style:{pointerEvents:"auto"}}),S.jsxs(ys,{bg:"gray.900",color:"white",borderRadius:"lg",overflow:"hidden",maxWidth:"80vw",maxHeight:"80vh",className:"video-modal-content",children:[S.jsx(Ns,{size:"lg",bg:"gray.700",color:"white",borderRadius:"full",zIndex:"10004",_hover:{bg:"gray.600"},position:"absolute",top:"10px",right:"10px"}),S.jsx(Es,{p:0,width:"100%",children:n?S.jsx(He,{className:"iframe-container",style:MZ.iframeContainer,children:S.jsx("iframe",{className:"video-iframe",src:n,style:MZ.iframe,allow:"autoplay; fullscreen",allowFullScreen:!0,title:e||"Video Player"})}):S.jsxs(Mr,{direction:"column",align:"center",justify:"center",h:"400px",children:[S.jsx(vd,{size:"xl",mb:4}),S.jsx($e,{children:"Unable to load video"}),S.jsx($e,{fontSize:"sm",color:"gray.400",mt:2,children:"No video URL provided"})]})})]})]})]})},vGe=5e3,SGe=n=>{if(!(n!=null&&n.includes("firebasestorage.googleapis.com")))return n;try{const e=new URL(n),i=e.searchParams.get("alt"),o=e.searchParams.get("token");return e.search="",i&&e.searchParams.set("alt",i),o&&e.searchParams.set("token",o),e.toString()}catch(e){return console.error("Error cleaning Firebase URL:",e),n}},bGe=()=>{const{isOpen:n,onOpen:e,onClose:i}=yu(),[o,l]=k.useState(null),[u,p]=k.useState("image"),y=k.useRef(null);fx(n,"image-viewer-modal");const E=k.useCallback(R=>R.stopPropagation(),[]);return k.useEffect(()=>{if(!n||!y.current)return;const R=y.current,O=document.getElementById("unity-canvas"),L=["mousemove","mousedown","mouseup","wheel"];return L.forEach(D=>R.addEventListener(D,E)),O&&(O.style.pointerEvents="none"),()=>{L.forEach(D=>R.removeEventListener(D,E)),O&&(O.style.pointerEvents="auto")}},[n,E]),{isOpen:n,currentImageUrl:o,currentMediaType:u,openImageViewer:(R,O="image")=>{const L=typeof R=="string"&&(R.match(/\.(jpeg|jpg|gif|png|webp)($|\?)/i)||R.includes("firebasestorage")&&!R.includes("video"));l(R),p(L?"image":O),e()},closeImageViewer:()=>{i(),setTimeout(()=>{l(null),p("image")},300)},modalContentRef:y,preventPropagation:E}},wGe=()=>S.jsx("style",{dangerouslySetInnerHTML:{__html:`
      body.unity-input-disabled #unity-container,
      body.unity-input-disabled #unity-canvas { pointer-events: none !important; }
      .image-viewer-modal-content,
      .chakra-modal__overlay { pointer-events: auto !important; }
    `}}),TGe=()=>{const[n,e]=k.useState([]),[i,o]=k.useState(!1),[l,u]=k.useState(null),[p,y]=k.useState(!1),E=k.useCallback((T,R)=>{e(O=>Array.isArray(O)&&O.some(D=>D.mediaScreenId===T)?O.map(D=>D.mediaScreenId===T?{...D,...R,lastUpdated:new Date().toISOString()}:D):[...Array.isArray(O)?O:[],{mediaScreenId:T,...R,firstDetected:new Date().toISOString(),lastUpdated:new Date().toISOString()}])},[]),b=k.useCallback(T=>Array.isArray(n)?n.find(R=>R.mediaScreenId===T):null,[n]);return{mediaScreens:n,setMediaScreens:e,isEditMode:i,setIsEditMode:o,selectedScreen:l,setSelectedScreen:u,unityReady:p,setUnityReady:y,updateMediaScreen:E,getScreenData:b}},CGe=()=>{const{spaceID:n}=Lo(),{isOpen:e,onOpen:i,onClose:o}=yu(),l=Wa(),{fullscreenRef:u}=Ch(),p=zc(),{trackReactEvent:y}=kE(n),{setMediaScreens:E,isEditMode:b,setIsEditMode:T,selectedScreen:R,setSelectedScreen:O,unityReady:L,setUnityReady:D,updateMediaScreen:U,getScreenData:F}=TGe(),{isOpen:Y,currentImageUrl:W,currentMediaType:re,openImageViewer:le,closeImageViewer:ie,modalContentRef:me,preventPropagation:q}=bGe(),[J,Q,ne,he]=gGe(b),{isOpen:de,onOpen:pe,onClose:Se}=yu();_Ge(),Xae(),k.useEffect(()=>{if(window.isPlayerInstantiated){D(!0);return}const Te=()=>D(!0);return window.addEventListener("PlayerInstantiated",Te),()=>window.removeEventListener("PlayerInstantiated",Te)},[D]);const Ie=k.useCallback(async Te=>{const Ne=F(Te);if(Ne)return{screen:Ne,imageUrl:Ne.imageUrl,videoUrl:Ne.videoUrl,mediaType:Ne.mediaType||"image",displayAsVideo:Ne.displayAsVideo||!1};if(W)return{screen:{mediaScreenId:Te},imageUrl:W,videoUrl:null,mediaType:"image",displayAsVideo:!1};if(n&&Te)try{const be=await _E(n,Te);if(be)return U(Te,{...be,hasImage:!!be.imageUrl,source:"firestore-fetch"}),{screen:be,imageUrl:be.imageUrl,videoUrl:be.videoUrl,mediaType:be.mediaType||"image",displayAsVideo:be.displayAsVideo||!1}}catch(be){console.error(`Error fetching media screen data for ${Te}:`,be)}return null},[F,W,n,U]),Fe=k.useCallback(async Te=>{if(O(Te),b){i();return}if(de&&ne===Te)return;const Ne=await Ie(Te);if(Ne){if(Ne.displayAsVideo&&Ne.videoUrl)l("PlayMediaScreenVideo",{mediaScreenId:Te,videoUrl:Ne.videoUrl});else if(Ne.imageUrl){const be=SGe(Ne.imageUrl);le(be,Ne.mediaType||"image")}}},[b,i,de,ne,Ie,l,le]);k.useEffect(()=>{if(!L||!n)return;const Te=async()=>{try{const Ne=await r4(n),be={};Ne.forEach(xe=>{xe.id&&xe.imageUrl&&(be[xe.id]=xe.imageUrl)}),E(xe=>xe.map(je=>({...je,hasImage:!!be[je.mediaScreenId],imageUrl:be[je.mediaScreenId],mediaType:je.mediaType||"image"})))}catch(Ne){console.error("Error fetching media screen images:",Ne)}};if(Te(),b){const Ne=setInterval(Te,vGe);return()=>clearInterval(Ne)}},[n,b,L,E]);const we=k.useCallback(Te=>{const{mediaScreenId:Ne,type:be,imageUrl:xe,mediaType:je}=Te;be==="upload"?U(Ne,{hasImage:!0,imageUrl:xe,mediaType:je||"image"}):be==="delete"&&setTimeout(()=>{E(nt=>nt.filter(dt=>dt.mediaScreenId!==Ne))},100)},[U,E]);k.useEffect(()=>{const Te=Ne=>{const be=Ne.detail.enabled;T(be),l("SetMediaScreenEditMode",{enabled:be,showUploadIcon:be})};return window.addEventListener("editModeChanged",Te),()=>window.removeEventListener("editModeChanged",Te)},[l,T]),k.useEffect(()=>(window.JsSendMediaScreenClick=Te=>{try{const Ne=JSON.parse(Te);window.dispatchEvent(new CustomEvent("MediaScreenClick",{detail:JSON.stringify(Ne)}))}catch(Ne){console.error("Error processing MediaScreenClick data:",Ne)}},window.handleMediaScreenClick=Te=>{Fe(Te)},window.TestJavaScriptFromUnity=Te=>{},()=>{delete window.JsSendMediaScreenClick,delete window.handleMediaScreenClick,delete window.TestJavaScriptFromUnity}),[Fe]),k.useEffect(()=>{const Te=je=>{try{const nt=JSON.parse(je.detail);U(nt.mediaScreenId,{...nt,source:"event"}),b&&l("SetMediaScreenEditMode",{mediaScreenId:nt.mediaScreenId,enabled:!0,showUploadIcon:!0}),n&&nt.mediaScreenId&&_E(n,nt.mediaScreenId).then(dt=>{dt!=null&&dt.displayAsVideo&&(dt!=null&&dt.videoUrl)&&l("SetMediaScreenImage",{mediaScreenId:nt.mediaScreenId,imageUrl:null,displayAsVideo:!0})}).catch(dt=>console.error("Error fetching media screen data:",dt))}catch(nt){console.error("Error handling MediaScreen registration:",nt)}},Ne=je=>{try{let nt;typeof je=="string"?nt=je:nt=JSON.parse(je.detail).mediaScreenId,Fe(nt)}catch(nt){console.error("Error handling MediaScreen click:",nt)}},xe=[["RegisterMediaScreen",Te],["MediaScreenClick",Ne],["reactUnityEvent",je=>{const{eventName:nt,eventData:dt}=je.detail||{};switch(nt){case"RegisterMediaScreen":Te({detail:dt});break;case"MediaScreenClick":Ne({detail:dt});break;case"SetMediaScreenImage":try{const ft=JSON.parse(dt);ft.mediaScreenId&&U(ft.mediaScreenId,{imageUrl:ft.imageUrl,hasImage:!!ft.imageUrl,displayAsVideo:ft.displayAsVideo||!1,source:"set-media-screen-image"})}catch(ft){console.error("Error handling SetMediaScreenImage event:",ft)}break}}]];return xe.forEach(([je,nt])=>window.addEventListener(je,nt)),()=>{xe.forEach(([je,nt])=>window.removeEventListener(je,nt))}},[b,l,n,U,Fe]),k.useEffect(()=>{J&&(pe(),y(fo.REACT.VIDEO_CLICK,{mediaScreenId:ne,videoUrl:J,videoTitle:Q,source:"media_screen_controller",trigger:"video_modal_open"}))},[J,pe,y,ne,Q]);const Re=k.useCallback(()=>{he(),Se()},[he,Se]);return k.useEffect(()=>{const Ne=p("RegisterMediaScreen",xe=>{xe!=null&&xe.mediaScreenId&&(U(xe.mediaScreenId,{...xe,source:"direct-event"}),b&&l("SetMediaScreenEditMode",{mediaScreenId:xe.mediaScreenId,enabled:!0,showUploadIcon:!0}))}),be=p("MediaScreenClick",xe=>{xe!=null&&xe.mediaScreenId&&Fe(xe.mediaScreenId)});return()=>{Ne(),be()}},[p,b,l,U,Fe]),k.useEffect(()=>{b&&ne&&(O(ne),i(),he())},[b,ne,i,he,O]),S.jsxs(S.Fragment,{children:[S.jsx(mGe,{isOpen:e,onClose:o,mediaScreenId:R,onImageChange:we}),S.jsx(wGe,{}),S.jsx(Bc,{containerRef:u,children:S.jsxs(_s,{isOpen:Y,onClose:ie,size:"lg",isCentered:!0,portalProps:{containerRef:u},id:"image-viewer-modal",blockScrollOnMount:!0,children:[S.jsx(vs,{bg:"rgba(0, 0, 0, 0.8)",onClick:q,onMouseMove:q,onMouseDown:q,onMouseUp:q,onWheel:q}),S.jsxs(ys,{ref:me,bg:"gray.900",color:"white",borderRadius:"lg",overflow:"hidden",maxWidth:"80vw",maxHeight:"80vh",display:"flex",justifyContent:"center",alignItems:"center",position:"relative",zIndex:"10000",className:"image-viewer-modal-content",onClick:q,onMouseMove:q,onMouseDown:q,onMouseUp:q,onWheel:q,children:[S.jsx(Ns,{size:"lg",bg:"gray.700",color:"white",borderRadius:"full",zIndex:"modal",_hover:{bg:"gray.600"},_focus:{boxShadow:"none"},position:"absolute",top:"10px",right:"10px"}),S.jsx(Es,{p:0,width:"100%",onClick:q,onMouseMove:q,onMouseDown:q,onMouseUp:q,onWheel:q,children:W?S.jsx(He,{position:"relative",width:"100%",height:"100%",display:"flex",justifyContent:"center",alignItems:"center",onClick:q,onMouseMove:q,onMouseDown:q,onMouseUp:q,onWheel:q,children:re==="image"?S.jsx(kp,{src:W,maxWidth:"100%",maxHeight:"80vh",objectFit:"contain",alt:"Media Screen Image",onError:Te=>console.error("Error loading image:",Te,W),onClick:q}):S.jsxs(He,{width:"100%",textAlign:"center",onClick:q,onMouseMove:q,onMouseDown:q,onMouseUp:q,onWheel:q,children:[S.jsx($e,{mb:4,fontSize:"lg",children:"Video URL:"}),S.jsx($e,{p:3,bg:"gray.800",borderRadius:"md",fontSize:"sm",wordBreak:"break-all",maxWidth:"100%",children:W}),S.jsx($e,{mt:4,fontSize:"sm",color:"gray.400",children:"Video playback will be implemented in a future update"})]})}):S.jsx(Mr,{direction:"column",align:"center",justify:"center",h:"400px",onClick:q,onMouseMove:q,onMouseDown:q,onMouseUp:q,onWheel:q,children:S.jsx($e,{children:"No image available"})})})]})]})}),S.jsx(EGe,{videoUrl:J,videoTitle:Q,mediaScreenId:ne,isOpen:de,onClose:Re})]})},lce=({backgroundUrl:n=null,videoBackgroundUrl:e=null,containerRef:i})=>{const[o,l]=k.useState(!1),[u,p]=k.useState(n),[y,E]=k.useState(e),b=k.useRef(null),T=k.useRef(null),R=k.useRef(null),O=k.useRef(!1),L=k.useRef(!1);k.useEffect(()=>{if(!(O.current||L.current)){if(L.current=!0,e){U(e),O.current=!0;return}if(n){F(n),O.current=!0;return}D()}},[n,e]),k.useEffect(()=>{const re=le=>{const{videoBackgroundUrl:ie}=le.detail;ie&&!O.current&&(U(ie),O.current=!0)};return window.addEventListener("SpaceVideoBackgroundUpdated",re),()=>{window.removeEventListener("SpaceVideoBackgroundUpdated",re)}},[]);const D=()=>{const le=window.location.pathname.match(/\/space\/([^\/]+)/);if(!le||!le[1])return;const ie=le[1];_o(ie).then(me=>{if(me&&me.videoBackgroundUrl)U(me.videoBackgroundUrl),O.current=!0;else if(me&&(me.backgroundUrl||me.backgroundGsUrl)){const q=me.backgroundUrl||me.backgroundGsUrl;F(q),O.current=!0}}).catch(me=>{G.error("PersistentBackground: Error fetching space data:",me)})},U=re=>{if(!i||!i.current)return;W();const le=document.createElement("video");R.current=le,le.autoplay=!0,le.loop=!0,le.muted=!0,le.playsInline=!0,le.setAttribute("playsinline",""),le.setAttribute("webkit-playsinline",""),le.setAttribute("preload","auto"),le.src=re,Object.assign(le.style,{position:"absolute",top:"0",left:"0",width:"100%",height:"100%",objectFit:"cover",zIndex:"20",transition:"opacity 1.5s ease-in-out",pointerEvents:"none",opacity:"1"}),i.current.appendChild(le),Y(),le.load();try{le.play().catch(ie=>{const me=()=>{le.play().catch(()=>{})};window.addEventListener("click",me,{once:!0}),window.addEventListener("touchstart",me,{once:!0}),setTimeout(()=>{le.play().catch(()=>{})},1e3)})}catch{}},F=re=>{if(!i||!i.current||!re)return;const le=document.createElement("div");b.current=le,Object.assign(le.style,{position:"absolute",top:"0",left:"0",width:"100%",height:"100%",backgroundImage:`url('${re}')`,backgroundSize:"cover",backgroundPosition:"center",backgroundRepeat:"no-repeat",zIndex:"19",transition:"opacity 1.5s ease-in-out",pointerEvents:"none",opacity:"1"}),i.current.appendChild(le),Y()},Y=()=>{if(!i||!i.current)return;const re=document.createElement("div");T.current=re,Object.assign(re.style,{position:"absolute",top:"0",left:"0",width:"100%",height:"100%",backdropFilter:"blur(5px)",WebkitBackdropFilter:"blur(5px)",backgroundColor:"rgba(255, 255, 255, 0.08)",zIndex:"21",transition:"opacity 1.5s ease-in-out",pointerEvents:"none"}),i.current.appendChild(re)},W=()=>{!i||!i.current||(b.current&&i.current.contains(b.current)&&(i.current.removeChild(b.current),b.current=null),R.current&&i.current.contains(R.current)&&(R.current.pause(),R.current.src="",R.current.load(),i.current.removeChild(R.current),R.current=null),T.current&&i.current.contains(T.current)&&(i.current.removeChild(T.current),T.current=null))};return k.useEffect(()=>{if(!i||!i.current)return;const re=()=>{l(!0),b.current&&(b.current.style.opacity="0"),R.current&&(R.current.style.opacity="0"),T.current&&(T.current.style.opacity="0"),setTimeout(()=>{W()},1500)};if(window.isPlayerInstantiated){re();return}Eh.subscribe(yh.playerInstantiated,re),window.addEventListener("PlayerInstantiated",re);const le=setTimeout(()=>{re()},3e4);return()=>{Eh.unsubscribe(yh.playerInstantiated,re),window.removeEventListener("PlayerInstantiated",re),clearTimeout(le),W()}},[i]),null};lce.propTypes={backgroundUrl:An.string,videoBackgroundUrl:An.string,containerRef:An.shape({current:An.instanceOf(Element)})};const UZ="https://www.spacesmetaverse.com/assets/images/SpacesLogo_Loader.png",uce=({containerRef:n})=>{const{spaceID:e}=Lo(),{isUserBannedFromSpace:i}=k.useContext(Di),[o,l]=k.useState(!1),[u,p]=k.useState(!1),[y,E]=k.useState(!1),[b,T]=k.useState(0),[R,O]=k.useState("Initialising World"),[L,D]=k.useState(null),U=k.useRef(null),F=k.useRef(null),Y=k.useRef(null),W=k.useRef(null),re=k.useRef(null),le=k.useRef(null);k.useEffect(()=>()=>{},[]);const{error:ie}=Lo(),[me,q]=k.useState(!1);return k.useEffect(()=>{ie&&(G.error("PersistentLoader: Unity error detected:",ie),q(!0),setTimeout(()=>{if(U.current){const J=U.current.querySelector("div:first-child");J&&(J.textContent="Reconnecting...")}},3e3))},[ie]),k.useEffect(()=>{(async()=>{if(e)try{const Q=await _o(e);Q&&Q.logoUrl&&D(Q.logoUrl)}catch(Q){G.error("PersistentLoader: Error fetching space logo:",Q)}})()},[e]),k.useEffect(()=>{const J=Q=>{const{logoUrl:ne}=Q.detail;D(ne),F.current&&(ne?(F.current.src=ne,Y.current.style.display="flex"):Y.current.style.display="none")};return window.addEventListener("SpaceLogoUpdated",J),()=>{window.removeEventListener("SpaceLogoUpdated",J)}},[]),k.useEffect(()=>{(async()=>{if(e&&i)try{await i(e)&&(G.warn(`PersistentLoader: user banned from space ${e}`),l(!0))}catch(Q){G.error("PersistentLoader: error checking ban status",Q)}})()},[e,i]),k.useEffect(()=>{if(!n||!n.current){G.error("PersistentLoader: Container ref missing");return}if(o){const Ne=document.createElement("div");return Object.assign(Ne.style,{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",color:"red",background:"rgba(0,0,0,0.7)",padding:"20px",borderRadius:"8px",zIndex:"100",fontSize:"18px",fontWeight:"bold",textAlign:"center"}),Ne.textContent="Access Denied: You have been banned from this space.",n.current.appendChild(Ne),()=>{n.current.removeChild(Ne)}}const J=document.createElement("div");if(U.current=J,Object.assign(J.style,{position:"absolute",top:"60%",left:"50%",transform:"translate(-50%, -50%)",width:"300px",padding:"16px",display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"center",zIndex:"50",transition:"opacity 0.3s ease-in-out",pointerEvents:"none",color:"white",fontFamily:"Arial, sans-serif",backgroundColor:"rgba(0, 0, 0, 0.4)",backdropFilter:"blur(10px)",WebkitBackdropFilter:"blur(10px)",borderRadius:"12px",boxShadow:"0 0 20px rgba(0, 0, 0, 0.3), inset 0 0 1px rgba(255, 255, 255, 0.3)",border:"1px solid rgba(255, 255, 255, 0.1)",opacity:"1"}),L){const Ne=document.createElement("div");Y.current=Ne,Object.assign(Ne.style,{position:"absolute",top:"37.5%",left:"50%",transform:"translate(-50%, -50%)",display:"flex",justifyContent:"center",alignItems:"center",zIndex:"50",transition:"opacity 0.3s ease-in-out",pointerEvents:"none",padding:"8px",width:"280px",opacity:"1"});const be=document.createElement("img");F.current=be,be.src=L,be.alt="Space Logo",be.style.maxHeight="100px",be.style.maxWidth="100%",be.style.objectFit="contain",be.style.filter="drop-shadow(0 0 8px rgba(0, 0, 0, 0.7))",Ne.appendChild(be),n.current.appendChild(Ne)}const Q=document.createElement("style");Q.textContent=`
      @keyframes progress-glow {
        0% { background-position: 0% 50%; }
        50% { background-position: 100% 50%; }
        100% { background-position: 0% 50%; }
      }
    `,document.head.appendChild(Q);const ne=document.createElement("div");ne.style.fontSize="16px",ne.style.fontWeight="bold",ne.style.textAlign="center",ne.style.marginBottom="16px",ne.style.color="#ffffff",ne.textContent="Initialising World";const he=document.createElement("div");he.style.width="240px",he.style.height="100px",he.style.position="relative",he.style.marginBottom="15px",he.style.padding="0px",he.style.overflow="hidden",he.style.boxSizing="border-box",he.style.transition="opacity 0.3s ease-in-out",he.style.opacity="1";const de=document.createElement("div");de.style.width="100%",de.style.height="100%",de.style.position="absolute",de.style.top="0",de.style.left="0",de.style.maskImage=`url(${UZ})`,de.style.maskSize="contain",de.style.maskPosition="center",de.style.maskRepeat="no-repeat",de.style.webkitMaskImage=`url(${UZ})`,de.style.webkitMaskSize="contain",de.style.webkitMaskPosition="center",de.style.webkitMaskRepeat="no-repeat",de.style.background="linear-gradient(to right, #4facfe 0%, #00f2fe 15%, white 15%, white 100%)",de.style.backgroundSize="100% 100%",de.style.transition="background 0.5s ease-out",W.current=de,re.current=null,he.appendChild(de);const pe=document.createElement("div");pe.style.marginTop="8px",pe.style.fontSize="14px",pe.style.fontWeight="bold",pe.style.color="#ffffff",pe.textContent="0%",J.appendChild(ne),J.appendChild(he),J.appendChild(pe),n.current.appendChild(J);const Se=Ne=>{T(Ne);const be=Math.round(Ne*100),xe=`linear-gradient(to right, #4facfe 0%, #00f2fe ${be}%, white ${be}%, white 100%)`;de.style.background=xe,pe.textContent=`${be}%`},Ie=Ne=>{O(Ne),ne.textContent=Ne},Fe=[{stage:"Initialising World",progress:.33},{stage:"Loading Assets",progress:.66},{stage:"Loading User",progress:1}];me&&(Fe[0].stage="Connecting to Space",Fe[1].stage="Reconnecting...",Fe[2].stage="Please Wait"),Ie(Fe[0].stage),Se(.25);const we=Ne=>{const be=Ne.detail.progress;Se(be),be<.33?Ie(Fe[0].stage):be<.66?Ie(Fe[1].stage):Ie(Fe[2].stage)},Re=()=>{p(!0),Ie(Fe[1].stage),Se(.66)},Te=()=>{le.current&&clearInterval(le.current),E(!0),Ie(Fe[2].stage),Se(1),!me&&(J.style.transition="all 0.5s ease-in-out",he.style.transition="opacity 1.2s ease-in-out",ne.style.transition="opacity 0.4s ease-in-out",pe.style.transition="opacity 0.4s ease-in-out",Y.current&&(Y.current.style.transition="opacity 0.5s ease-in-out"),J.style.backgroundColor="rgba(0, 0, 0, 0)",J.style.backdropFilter="blur(0px)",J.style.WebkitBackdropFilter="blur(0px)",J.style.boxShadow="0 0 0 rgba(0, 0, 0, 0)",J.style.border="1px solid rgba(255, 255, 255, 0)",ne.style.opacity="0",pe.style.opacity="0",Y.current&&(Y.current.style.opacity="0"),setTimeout(()=>{he.style.opacity="0",setTimeout(()=>{n.current&&n.current.contains(J)&&n.current.removeChild(J),Y.current&&n.current&&n.current.contains(Y.current)&&n.current.removeChild(Y.current)},1300)},400))};if(window.isPlayerInstantiated)Te();else{Eh.subscribe(yh.playerInstantiated,Te);const Ne=()=>Te();window.addEventListener("PlayerInstantiated",Ne),Eh.subscribe(yh.firstSceneLoaded,Re),window.addEventListener("UnityProgress",we),le.current=setInterval(()=>{y||T(xe=>{const je=Math.min(xe+.02,.95);return Se(je),je<.33&&R!==Fe[0].stage?Ie(Fe[0].stage):je>=.33&&je<.66&&R!==Fe[1].stage?Ie(Fe[1].stage):je>=.66&&R!==Fe[2].stage&&Ie(Fe[2].stage),je})},300);const be=setTimeout(()=>{Te()},6e4);return()=>{Eh.unsubscribe(yh.playerInstantiated,Te),window.removeEventListener("PlayerInstantiated",Ne),Eh.unsubscribe(yh.firstSceneLoaded,Re),window.removeEventListener("UnityProgress",we),clearInterval(le.current),clearTimeout(be),n.current&&n.current.contains(J)&&n.current.removeChild(J),Y.current&&n.current&&n.current.contains(Y.current)&&n.current.removeChild(Y.current)}}},[L,n]),null};uce.propTypes={containerRef:An.shape({current:An.instanceOf(Element)})};const RGe=({size:n="md",tooltipPlacement:e="top",className:i="livestream-button"})=>{const[o,l]=k.useState(!1),[u,p]=k.useState(!1),{savedStreamData:y,reloadStreamData:E}=Yae(),{spaceID:b}=Lo(),{user:T}=k.useContext(Di),R=ea(),[O,L]=k.useState(!1),D=Rq((y==null?void 0:y.rtmpUrl)||""),U=Rq((y==null?void 0:y.streamKey)||"");k.useEffect(()=>{if(b){G.log("LiveStreamButton: Forcing reload of stream data"),E();const W=()=>{G.log("LiveStreamButton: Stream settings changed, reloading data"),E()};return window.addEventListener("StreamSettingsChanged",W),()=>{window.removeEventListener("StreamSettingsChanged",W)}}},[b,E]),k.useEffect(()=>{(async()=>{if(!(T!=null&&T.uid)||!b){L(!1);return}try{const re=await t8e(T.uid,"disruptiveAdmin"),le=await i8e(T,b);L(re||le)}catch(re){G.error("Error checking user permissions:",re),L(!1)}})()},[T==null?void 0:T.uid,b]),k.useEffect(()=>{G.log("LiveStreamButton: Current streaming data:",{enabled:y==null?void 0:y.enabled,hasRtmpUrl:!!(y!=null&&y.rtmpUrl),hasStreamKey:!!(y!=null&&y.streamKey),hasPermission:O,isPlayerReady:u})},[y,O,u]),k.useEffect(()=>{const W=()=>{G.log("LiveStreamButton: Player instantiated, showing button"),p(!0)};return window.addEventListener("PlayerInstantiated",W),window.isPlayerInstantiated&&(G.log("LiveStreamButton: Player was already instantiated"),p(!0)),()=>{window.removeEventListener("PlayerInstantiated",W)}},[]);const F=()=>{window.dispatchEvent(new Event("modal-opened")),l(!0)},Y=()=>{window.dispatchEvent(new Event("modal-closed")),l(!1)};return!u||!O||(y==null?void 0:y.enabled)!==!0?(G.log("LiveStreamButton: Not rendering button because:",{playerNotReady:!u,noPermission:!O,streamingDisabled:(y==null?void 0:y.enabled)!==!0,enabledValue:y==null?void 0:y.enabled}),null):S.jsxs(S.Fragment,{children:[S.jsx(Kf,{label:"Live Stream Info",placement:e,hasArrow:!0,children:S.jsx(jc,{size:n,borderRadius:"full",bg:"black",icon:S.jsx(iWe,{color:"white"}),borderWidth:"1px",borderColor:"whiteAlpha.300",className:i,"data-testid":"livestream-button",cursor:"pointer",onClick:F})}),S.jsxs(_s,{isOpen:o,onClose:Y,isCentered:!0,size:"md",children:[S.jsx(vs,{backdropFilter:"blur(4px)"}),S.jsxs(ys,{bg:"rgba(23, 25, 35, 0.95)",color:"white",borderRadius:"md",boxShadow:"0 4px 20px rgba(0, 0, 0, 0.5)",children:[S.jsx(Do,{borderBottom:"1px solid",borderColor:"whiteAlpha.200",py:2,fontSize:"md",fontWeight:"600",children:"Live Stream Info"}),S.jsx(Ns,{size:"sm",color:"whiteAlpha.700",_hover:{color:"white",bg:"whiteAlpha.100"}}),S.jsx(Es,{p:4,children:y!=null&&y.rtmpUrl&&(y!=null&&y.streamKey)?S.jsxs(He,{children:[S.jsx($e,{fontSize:"sm",mb:4,color:"white",children:"Copy these details to your streaming software (OBS, Streamlabs, etc.)"}),S.jsxs(He,{mb:4,children:[S.jsx($e,{fontSize:"xs",fontWeight:"600",mb:1,color:"white",children:"RTMP URL"}),S.jsx(Mr,{children:S.jsxs($f,{size:"sm",children:[S.jsx(ni,{value:y.rtmpUrl,isReadOnly:!0,bg:"whiteAlpha.100",borderColor:"whiteAlpha.200",_hover:{borderColor:"whiteAlpha.300"},pr:"2.5rem",color:"white"}),S.jsx(vR,{children:S.jsx(va,{"aria-label":"Copy RTMP URL",icon:D.hasCopied?S.jsx(RZ,{}):S.jsx(IZ,{}),size:"xs",colorScheme:D.hasCopied?"green":"blue",onClick:()=>{D.onCopy(),R({title:"RTMP URL copied",status:"success",duration:2e3,isClosable:!0,position:"top"})}})})]})})]}),S.jsxs(He,{mb:4,children:[S.jsx($e,{fontSize:"xs",fontWeight:"600",mb:1,color:"white",children:"Stream Key"}),S.jsx(Mr,{children:S.jsxs($f,{size:"sm",children:[S.jsx(ni,{value:y.streamKey,isReadOnly:!0,bg:"whiteAlpha.100",borderColor:"whiteAlpha.200",_hover:{borderColor:"whiteAlpha.300"},pr:"2.5rem",type:"password",color:"white"}),S.jsx(vR,{children:S.jsx(va,{"aria-label":"Copy Stream Key",icon:U.hasCopied?S.jsx(RZ,{}):S.jsx(IZ,{}),size:"xs",colorScheme:U.hasCopied?"green":"blue",onClick:()=>{U.onCopy(),R({title:"Stream Key copied",status:"success",duration:2e3,isClosable:!0,position:"top"})}})})]})})]}),S.jsx($e,{fontSize:"xs",color:"whiteAlpha.800",mt:4,children:"Stream to this RTMP server using the Stream Key above. View and manage stream settings in the Space Manager."})]}):S.jsxs(He,{textAlign:"center",p:4,children:[S.jsx($e,{color:"white",children:"No stream configuration found for this space."}),S.jsx($e,{fontSize:"xs",mt:2,color:"whiteAlpha.800",children:"Configure streaming in the Space Manager under Stream tab."})]})})]})]})]})},i4="spaces",s4="portals",IGe=async(n,e,i)=>{try{const o=dr(Fn,i4,n,s4,e),l={...i,sourceSpaceId:n,portalId:e,createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()};return await Xg(o,l),G.log(`Saved portal ${e} to space ${n}`),!0}catch(o){return G.error("Error saving portal:",o),!1}},AGe=async(n,e)=>{try{const i=dr(Fn,i4,n,s4,e);return await sx(i),G.log(`Deleted portal ${e} from space ${n}`),!0}catch(i){return G.error("Error deleting portal:",i),!1}},PGe=async(n,e,i)=>{try{const o=dr(Fn,i4,n,s4,e),l={...i,updatedAt:new Date().toISOString()};return await qs(o,l),G.log(`Updated portal ${e} in space ${n}`),!0}catch(o){return G.error("Error updating portal:",o),!1}};function OGe(n,e,i){const o=k.useRef();k.useEffect(()=>(o.current&&clearTimeout(o.current),o.current=setTimeout(n,e),()=>clearTimeout(o.current)),i)}const kGe=({isOpen:n,onClose:e,portal:i,spaceId:o,style:l})=>{if(!n||!i)return null;const[u,p]=k.useState({x:0,y:1.5,z:0}),[y,E]=k.useState({x:0,y:0,z:0}),[b,T]=k.useState({x:1,y:1,z:1}),R=Wa(),O=ea();k.useEffect(()=>{i&&(p(i.position||{x:0,y:1.5,z:0}),E(i.rotation||{x:0,y:0,z:0}),T(i.scale||{x:1,y:1,z:1}))},[i]),k.useEffect(()=>{R("UpdatePortalTransform",{portalId:i.portalId,position:u,rotation:y,scale:b})},[u,y,b,i.portalId,R]),OGe(()=>{const D={...i,position:u,rotation:y,scale:b};PGe(o,i.portalId,D)},300,[u,y,b,o,i.portalId]);const L=async()=>{try{if(R("DeletePortal",{portalId:i.portalId}),await AGe(o,i.portalId))O({title:"Portal Deleted",description:"The portal has been removed.",status:"success",duration:3e3,isClosable:!0}),e();else throw new Error("Failed to delete portal from Firebase")}catch{O({title:"Delete Error",description:"Failed to delete portal. Please try again.",status:"error",duration:5e3,isClosable:!0})}};return S.jsxs(He,{position:"absolute",top:"72px",right:"24px",zIndex:2e3,minW:"340px",maxW:"360px",bg:"rgba(255,255,255,0.15)",boxShadow:"0 8px 32px 0 rgba(31, 38, 135, 0.18)",borderRadius:"2xl",p:6,border:"1px solid rgba(255,255,255,0.2)",style:{backdropFilter:"blur(18px)",WebkitBackdropFilter:"blur(18px)",...l},color:"gray.900",children:[S.jsx(He,{fontWeight:"bold",fontSize:"lg",mb:2,children:"Edit Portal"}),S.jsxs(Qn,{spacing:4,align:"stretch",children:[S.jsxs(br,{children:[S.jsx(Ei,{children:"Position"}),S.jsxs(Cn,{children:[S.jsxs($o,{value:u.x,onChange:(D,U)=>p(F=>({...F,x:U})),step:.1,precision:2,children:[S.jsx(qo,{placeholder:"X"}),S.jsxs(Ko,{children:[S.jsx(Xo,{}),S.jsx(Yo,{})]})]}),S.jsxs($o,{value:u.y,onChange:(D,U)=>p(F=>({...F,y:U})),step:.1,precision:2,children:[S.jsx(qo,{placeholder:"Y"}),S.jsxs(Ko,{children:[S.jsx(Xo,{}),S.jsx(Yo,{})]})]}),S.jsxs($o,{value:u.z,onChange:(D,U)=>p(F=>({...F,z:U})),step:.1,precision:2,children:[S.jsx(qo,{placeholder:"Z"}),S.jsxs(Ko,{children:[S.jsx(Xo,{}),S.jsx(Yo,{})]})]})]})]}),S.jsxs(br,{children:[S.jsx(Ei,{children:"Rotation"}),S.jsxs(Cn,{children:[S.jsxs($o,{value:y.x,onChange:(D,U)=>E(F=>({...F,x:U})),step:1,children:[S.jsx(qo,{placeholder:"X"}),S.jsxs(Ko,{children:[S.jsx(Xo,{}),S.jsx(Yo,{})]})]}),S.jsxs($o,{value:y.y,onChange:(D,U)=>E(F=>({...F,y:U})),step:1,children:[S.jsx(qo,{placeholder:"Y"}),S.jsxs(Ko,{children:[S.jsx(Xo,{}),S.jsx(Yo,{})]})]}),S.jsxs($o,{value:y.z,onChange:(D,U)=>E(F=>({...F,z:U})),step:1,children:[S.jsx(qo,{placeholder:"Z"}),S.jsxs(Ko,{children:[S.jsx(Xo,{}),S.jsx(Yo,{})]})]})]})]}),S.jsxs(br,{children:[S.jsx(Ei,{children:"Scale"}),S.jsxs(Cn,{children:[S.jsxs($o,{value:b.x,onChange:(D,U)=>T(F=>({...F,x:U})),step:.1,precision:2,min:.1,children:[S.jsx(qo,{placeholder:"X"}),S.jsxs(Ko,{children:[S.jsx(Xo,{}),S.jsx(Yo,{})]})]}),S.jsxs($o,{value:b.y,onChange:(D,U)=>T(F=>({...F,y:U})),step:.1,precision:2,min:.1,children:[S.jsx(qo,{placeholder:"Y"}),S.jsxs(Ko,{children:[S.jsx(Xo,{}),S.jsx(Yo,{})]})]}),S.jsxs($o,{value:b.z,onChange:(D,U)=>T(F=>({...F,z:U})),step:.1,precision:2,min:.1,children:[S.jsx(qo,{placeholder:"Z"}),S.jsxs(Ko,{children:[S.jsx(Xo,{}),S.jsx(Yo,{})]})]})]})]}),S.jsx(Cn,{spacing:4,width:"100%",justify:"flex-end",children:S.jsx(On,{colorScheme:"red",onClick:L,variant:"outline",children:"Delete Portal"})}),S.jsx(On,{mt:2,variant:"ghost",colorScheme:"whiteAlpha",onClick:e,children:"Close"})]})]})},NGe=n=>{if(!n)return null;try{if(n.includes("firebasestorage.googleapis.com")){const e=new URL(n),i=e.searchParams.get("alt"),o=e.searchParams.get("token");return e.search="",i&&e.searchParams.set("alt",i),o&&e.searchParams.set("token",o),e.toString()}return n}catch(e){return console.error("Error cleaning Firebase URL:",e),n}},xGe=()=>{const{spaceID:n}=Lo(),e=Wa(),[i,o]=k.useState(!1);k.useEffect(()=>{if(window.isPlayerInstantiated){G.log("useUnityPortalImages: Unity already ready (via window flag)"),o(!0);return}const l=()=>{G.log("useUnityPortalImages: Unity is now ready (PlayerInstantiated event)"),o(!0)};return window.addEventListener("PlayerInstantiated",l),()=>{window.removeEventListener("PlayerInstantiated",l)}},[]),k.useEffect(()=>{if(!i){G.log("useUnityPortalImages: Waiting for Unity to be ready before loading portal images");return}G.log("useUnityPortalImages: Unity is ready, now loading portal images"),(async()=>{try{if(!n)throw new Error("spaceID is not defined.");const u=mc(Fn,"spaces",n,"portals"),p=await _d(u);if(p.empty){G.log("useUnityPortalImages: No portals found for space:",n);return}G.log(`useUnityPortalImages: Found ${p.size} portals for space ${n}`);for(const y of p.docs){const E=y.data(),b=E.portalId,T=E.targetSpaceId;if(!T){G.warn(`useUnityPortalImages: No target space ID found for portal: ${b}`);continue}const R=await _o(T);if(!R){G.warn(`useUnityPortalImages: No space data found for target space: ${T}`);continue}const O=R.backgroundUrl||R.backgroundGsUrl;if(!O){G.warn(`useUnityPortalImages: No background image URL found for target space: ${T}`);continue}const L=NGe(O);e("SetPortalImage",JSON.stringify({portalId:b,imageUrl:L})),G.log(`Sent portal image data to Unity for portal ${b}: ${L}`)}}catch(u){G.error("Error fetching portal images:",u)}})()},[e,n,i])},DGe=()=>(xGe(),null);function LGe(n,e,i){const o=k.useRef();k.useEffect(()=>(o.current&&clearTimeout(o.current),o.current=setTimeout(n,e),()=>clearTimeout(o.current)),i)}const MGe=({isOpen:n,onClose:e,item:i,spaceId:o,style:l})=>{if(!n||!i)return null;const[u,p]=k.useState({x:0,y:0,z:0}),[y,E]=k.useState({x:0,y:0,z:0}),[b,T]=k.useState({x:1,y:1,z:1}),R=Wa(),O=ea();k.useEffect(()=>{i&&(p(i.position||{x:0,y:0,z:0}),E(i.rotation||{x:0,y:0,z:0}),T(i.scale||{x:1,y:1,z:1}))},[i]),k.useEffect(()=>{R("UpdateCatalogueItem",{hotspotId:i.hotspotId,position:u,rotation:y,scale:b})},[u,y,b,i.hotspotId,R]),LGe(()=>{const D=dr(Fn,"spaces",o,"catalogue",i.hotspotId);qs(D,{position:u,rotation:y,scale:b,updatedAt:Date.now()})},300,[u,y,b,o,i.hotspotId]);const L=async()=>{try{R("DeleteCatalogueItem",{hotspotId:i.hotspotId});const D=dr(Fn,"spaces",o,"catalogue",i.hotspotId);await sx(D),O({title:"Item Deleted",description:"The item has been removed.",status:"success",duration:3e3,isClosable:!0}),e()}catch{O({title:"Delete Error",description:"Failed to delete item. Please try again.",status:"error",duration:5e3,isClosable:!0})}};return S.jsxs(He,{position:"absolute",top:"72px",right:"24px",zIndex:2e3,minW:"340px",maxW:"360px",bg:"rgba(255,255,255,0.15)",boxShadow:"0 8px 32px 0 rgba(31, 38, 135, 0.18)",borderRadius:"2xl",p:6,border:"1px solid rgba(255,255,255,0.2)",style:{backdropFilter:"blur(18px)",WebkitBackdropFilter:"blur(18px)",...l},color:"gray.900",children:[S.jsx(He,{fontWeight:"bold",fontSize:"lg",mb:2,children:"Edit Catalogue Item"}),S.jsxs(Qn,{spacing:4,align:"stretch",children:[S.jsxs(br,{children:[S.jsx(Ei,{children:"Position"}),S.jsxs(Cn,{children:[S.jsxs($o,{value:u.x,onChange:(D,U)=>p(F=>({...F,x:U})),step:.1,precision:2,children:[S.jsx(qo,{placeholder:"X"}),S.jsxs(Ko,{children:[S.jsx(Xo,{}),S.jsx(Yo,{})]})]}),S.jsxs($o,{value:u.y,onChange:(D,U)=>p(F=>({...F,y:U})),step:.1,precision:2,children:[S.jsx(qo,{placeholder:"Y"}),S.jsxs(Ko,{children:[S.jsx(Xo,{}),S.jsx(Yo,{})]})]}),S.jsxs($o,{value:u.z,onChange:(D,U)=>p(F=>({...F,z:U})),step:.1,precision:2,children:[S.jsx(qo,{placeholder:"Z"}),S.jsxs(Ko,{children:[S.jsx(Xo,{}),S.jsx(Yo,{})]})]})]})]}),S.jsxs(br,{children:[S.jsx(Ei,{children:"Rotation"}),S.jsxs(Cn,{children:[S.jsxs($o,{value:y.x,onChange:(D,U)=>E(F=>({...F,x:U})),step:1,children:[S.jsx(qo,{placeholder:"X"}),S.jsxs(Ko,{children:[S.jsx(Xo,{}),S.jsx(Yo,{})]})]}),S.jsxs($o,{value:y.y,onChange:(D,U)=>E(F=>({...F,y:U})),step:1,children:[S.jsx(qo,{placeholder:"Y"}),S.jsxs(Ko,{children:[S.jsx(Xo,{}),S.jsx(Yo,{})]})]}),S.jsxs($o,{value:y.z,onChange:(D,U)=>E(F=>({...F,z:U})),step:1,children:[S.jsx(qo,{placeholder:"Z"}),S.jsxs(Ko,{children:[S.jsx(Xo,{}),S.jsx(Yo,{})]})]})]})]}),S.jsxs(br,{children:[S.jsx(Ei,{children:"Scale"}),S.jsxs(Cn,{children:[S.jsxs($o,{value:b.x,onChange:(D,U)=>T(F=>({...F,x:U})),step:.1,precision:2,min:.1,children:[S.jsx(qo,{placeholder:"X"}),S.jsxs(Ko,{children:[S.jsx(Xo,{}),S.jsx(Yo,{})]})]}),S.jsxs($o,{value:b.y,onChange:(D,U)=>T(F=>({...F,y:U})),step:.1,precision:2,min:.1,children:[S.jsx(qo,{placeholder:"Y"}),S.jsxs(Ko,{children:[S.jsx(Xo,{}),S.jsx(Yo,{})]})]}),S.jsxs($o,{value:b.z,onChange:(D,U)=>T(F=>({...F,z:U})),step:.1,precision:2,min:.1,children:[S.jsx(qo,{placeholder:"Z"}),S.jsxs(Ko,{children:[S.jsx(Xo,{}),S.jsx(Yo,{})]})]})]})]}),S.jsx(Cn,{spacing:4,width:"100%",justify:"flex-end",children:S.jsx(On,{colorScheme:"red",onClick:L,variant:"outline",children:"Delete Item"})}),S.jsx(On,{mt:2,variant:"ghost",colorScheme:"whiteAlpha",onClick:e,children:"Close"})]})]})};function UGe(){const{clickedItem:n,clearClickedItem:e}=tce(),[i,o]=k.useState(!1);k.useEffect(()=>{const p=y=>{y!=null&&y.detail&&typeof y.detail.enabled=="boolean"&&(o(y.detail.enabled),y.detail.enabled||e())};return window.addEventListener("editModeChanged",p),()=>window.removeEventListener("editModeChanged",p)},[e]);const l=()=>{e()};let u="";if(n!=null&&n.hotspotId){const p=n.hotspotId.split("_");p.length>=3&&(u=p.slice(1,-1).join("_"))}return S.jsx(S.Fragment,{children:n&&i&&S.jsx(MGe,{isOpen:!!n&&i,onClose:l,item:n,spaceId:u})})}const VGe=(n,e={})=>{const{user:i}=k.useContext(Di),{trackUnityEvent:o,isReady:l}=kE(n,{enableDebugLogs:e.enableDebugLogs||!1}),u=zc();return k.useEffect(()=>{if(!l||!i)return;G.log(" Unity Analytics: Setting up event listeners");const p=u("PlayVideo",D=>{G.log(" Unity Analytics: Video play event detected",D),o(fo.UNITY.VIDEO_PLAY,{category:mo.MEDIA_INTERACTION,videoId:D==null?void 0:D.gameObjectName,videoUrl:D==null?void 0:D.videoUrl,isEditMode:(D==null?void 0:D.isEditMode)||!1,timestamp:new Date().toISOString(),...D})}),y=u("PlayMediaScreenVideo",D=>{G.log(" Unity Analytics: Media screen click event detected",D),o(fo.UNITY.MEDIA_SCREEN_CLICK,{category:mo.MEDIA_INTERACTION,mediaScreenId:D==null?void 0:D.mediaScreenId,videoUrl:D==null?void 0:D.videoUrl,isEditMode:(D==null?void 0:D.isEditMode)||!1,timestamp:new Date().toISOString(),...D})}),E=u("OpenNameplateModal",D=>{G.log(" Unity Analytics: Nameplate click event detected",D),o(fo.UNITY.NAMEPLATE_CLICK,{category:mo.SOCIAL_INTERACTION,targetUserId:D==null?void 0:D.uid,targetPlayerName:D==null?void 0:D.playerName,targetPlayerId:D==null?void 0:D.playerId,isLocalPlayer:(D==null?void 0:D.isLocalPlayer)||!1,timestamp:new Date().toISOString(),...D})}),b=u("PlayerInstantiated",D=>{G.log(" Unity Analytics: Player spawn event detected",D),o(fo.UNITY.PLAYER_SPAWN,{category:mo.SYSTEM_EVENT,timestamp:new Date().toISOString(),...D})}),T=u("FirstSceneLoaded",D=>{G.log(" Unity Analytics: First scene loaded event detected",D),o(fo.UNITY.SPACE_READY,{category:mo.SYSTEM_EVENT,timestamp:new Date().toISOString(),...D})}),R=u("SeatingHotspotClicked",D=>{G.log(" Unity Analytics: Catalogue item click event detected",D),o(fo.UNITY.OBJECT_INTERACT,{category:mo.CONTENT_INTERACTION,objectType:"catalogue_item",hotspotId:D==null?void 0:D.hotspotId,itemId:D==null?void 0:D.itemId,position:D==null?void 0:D.position,timestamp:new Date().toISOString(),...D})}),O=u("UpdatePlayerList",D=>{D!=null&&D.players&&Array.isArray(D.players)&&(G.log(" Unity Analytics: Player list update event detected",D),o(fo.UNITY.PLAYER_MOVE,{category:mo.SOCIAL_INTERACTION,activePlayerCount:D.players.length,playerList:D.players.map(U=>({playerId:U.playerId,playerName:U.playerName,isLocalPlayer:U.isLocalPlayer})),timestamp:new Date().toISOString()}))}),L=u("RequestUserForUnity",D=>{G.log(" Unity Analytics: Unity user request event detected",D),o(fo.UNITY.SPACE_LOAD,{category:mo.SYSTEM_EVENT,requestType:"user_data",timestamp:new Date().toISOString(),...D})});return()=>{G.log(" Unity Analytics: Cleaning up event listeners"),p(),y(),E(),b(),T(),R(),O(),L()}},[l,i,o,u]),{isReady:l,trackUnityEvent:o}},jGe=async(n,e)=>{try{const i=mc(Fn,`spaces/${n}/chatMessages`);await nae(i,e),G.log("Message sent to space chat:",e)}catch(i){throw G.error("Error sending message to space chat:",i),i}},FGe=(n,e)=>{try{const i=mc(Fn,`spaces/${n}/chatMessages`),o=new Date,l=xR(i,Qoe("timestamp","asc"),wBe(o));return ox(l,u=>{const p=[];u.docChanges().forEach(y=>{if(y.type==="added"){const E=y.doc.data();p.push({id:y.doc.id,...E})}}),p.length>0&&e(p)})}catch(i){throw G.error("Error subscribing to space chat messages:",i),i}},BGe=n=>{const{user:e}=k.useContext(Di),[i,o]=k.useState([]),[l,u]=k.useState(!1),[p,y]=k.useState(null),[E,b]=k.useState([]);k.useEffect(()=>{o([]),b([]),y(null)},[n]),k.useEffect(()=>{if(!n){G.warn("useWebGLChat: No spaceID provided");return}u(!0),y(null),G.log("useWebGLChat: Subscribing to chat messages for space:",n);const L=setTimeout(()=>{G.warn("useWebGLChat: Loading timeout reached, stopping loading state"),u(!1)},1e4);try{const D=mc(Fn,`spaces/${n}/chatMessages`),U=xR(D,Qoe("timestamp","desc"),Zoe(50)),F=ox(U,Y=>{G.log("useWebGLChat: Firestore snapshot received, docs:",Y.docs.length);const W=[];Y.forEach(me=>{const q=me.data();W.push({id:me.id,...q})});const re=W.sort((me,q)=>{var ne,he;const J=(ne=me.timestamp)!=null&&ne.toDate?me.timestamp.toDate():new Date(me.timestamp),Q=(he=q.timestamp)!=null&&he.toDate?q.timestamp.toDate():new Date(q.timestamp);return J-Q}),le=new Date(Date.now()-1440*60*1e3),ie=re.filter(me=>{var J;return((J=me.timestamp)!=null&&J.toDate?me.timestamp.toDate():new Date(me.timestamp))>=le});G.log("useWebGLChat: Setting messages:",ie.length,"of",re.length,"total (filtered last 24h)"),o(ie),u(!1),clearTimeout(L)},Y=>{G.error("useWebGLChat: Firestore subscription error:",Y),y("Failed to load chat messages"),u(!1)});return()=>{G.log("useWebGLChat: Unsubscribing from chat messages"),clearTimeout(L),F()}}catch(D){G.error("useWebGLChat: Error setting up subscription:",D),y("Failed to load chat messages"),u(!1),clearTimeout(L)}},[n]),k.useEffect(()=>{(async()=>{if(i.length===0){b([]);return}try{const D=await Promise.all(i.map(async U=>{if(U.rpmURL!==void 0||!U.uid)return U;try{const F=await Fc(U.uid);let Y=null;if(F.groups){const W=`space_${n}_owners`,re=`space_${n}_hosts`;F.groups.includes(W)?Y="owner":F.groups.includes(re)&&(Y="host")}return{...U,rpmURL:F.rpmURL,role:Y,firstName:F.firstName,lastName:F.lastName}}catch(F){return G.warn("useWebGLChat: Failed to enrich message with profile data:",F),U}}));b(D)}catch(D){G.error("useWebGLChat: Error enriching messages:",D),b(i)}})()},[i,n]);const T=k.useCallback(async L=>{var D;if(!n||!e)throw new Error("Cannot send message: missing spaceID or user");if(!((D=L.text)!=null&&D.trim()))throw new Error("Cannot send empty message");y(null);try{G.log("useWebGLChat: Sending message:",L);const U={text:L.text.trim(),uid:e.uid,user:L.user||e.Nickname||e.displayName||"Anonymous",timestamp:new Date,rpmURL:L.rpmURL||e.rpmURL,isGuest:L.isGuest||e.isGuest||!1};await jGe(n,U),G.log("useWebGLChat: Message sent successfully")}catch(U){throw G.error("useWebGLChat: Error sending message:",U),y("Failed to send message"),U}},[n,e]),R=E.length,O=k.useCallback(L=>{const D=new Date(L);return E.filter(U=>{var Y;return((Y=U.timestamp)!=null&&Y.toDate?U.timestamp.toDate():new Date(U.timestamp))>D})},[E]);return{messages:E,messageCount:R,sendMessage:T,isLoading:l,error:p,getRecentMessages:O}},zGe=n=>{k.useEffect(()=>(n?(G.log("useChatKeyboardFocus: Chat input focused, blocking Unity keyboard input"),hd(!0),window.dispatchEvent(new CustomEvent("modal-opened"))):(G.log("useChatKeyboardFocus: Chat input blurred, restoring Unity keyboard input"),hd(!1),window.dispatchEvent(new CustomEvent("modal-closed")),setTimeout(()=>{By(!0)},100)),()=>{n&&(G.log("useChatKeyboardFocus: Cleanup - restoring Unity keyboard input"),hd(!1),window.dispatchEvent(new CustomEvent("modal-closed")))}),[n]),k.useEffect(()=>{const e=i=>{if(i.key==="Escape"&&n){G.log("useChatKeyboardFocus: Escape key pressed, blurring chat input");const o=document.querySelector('input[placeholder*="chat"]');o&&o.blur()}};return document.addEventListener("keydown",e),()=>{document.removeEventListener("keydown",e)}},[n])},WGe=({message:n,isCurrentUser:e,spaceID:i,onMessageDelete:o})=>{const{user:l}=k.useContext(Di),[u,p]=k.useState(!1),[y,E]=k.useState(!1),[b,T]=k.useState(!1),R=ea();k.useEffect(()=>{(async()=>{if(l!=null&&l.uid)try{const Y=await lx(l.uid,"disruptiveAdmin");p(Y)}catch(Y){console.error("Error checking admin status:",Y),p(!1)}})()},[l==null?void 0:l.uid]);const O=async()=>{if(!(!i||!n.id)){T(!0);try{await sx(dr(Fn,`spaces/${i}/chatMessages`,n.id)),R({title:"Message Deleted",description:"The message has been removed from the chat.",status:"success",duration:2e3,isClosable:!0}),o&&o(n.id)}catch(F){console.error("Error deleting message:",F),R({title:"Delete Failed",description:"Failed to delete the message. Please try again.",status:"error",duration:3e3,isClosable:!0})}finally{T(!1)}}},L=F=>{if(!F)return"";const Y=F.toDate?F.toDate():new Date(F),re=new Date-Y,le=Math.floor(re/(1e3*60)),ie=Math.floor(re/(1e3*60*60));return le<1?"now":le<60?`${le}m`:ie<24?`${ie}h`:Y.toLocaleDateString()},D=F=>F?F.includes(".glb")?F.replace(".glb",".png?scene=fullbody-portrait-closeupfront&w=640&q=75"):F:null,U=F=>{if(!F)return"?";if(F.startsWith("Visitor_")){const Y=F.split("_")[1];return`V${Y?Y.charAt(0):""}`}return F.charAt(0).toUpperCase()};return S.jsxs(Cn,{align:"flex-start",spacing:2,px:2,py:1,borderRadius:"md",_hover:{bg:"rgba(255, 255, 255, 0.05)"},width:"100%",maxWidth:"100%",position:"relative",onMouseEnter:()=>E(!0),onMouseLeave:()=>E(!1),role:"group",css:{boxSizing:"border-box"},children:[S.jsx(jc,{size:"xs",src:D(n.rpmURL),name:U(n.user),bg:"whiteAlpha.300",color:"white",borderWidth:"1px",borderColor:"whiteAlpha.300",flexShrink:0,mt:.5}),S.jsx(He,{flex:1,minW:0,children:S.jsxs($e,{fontSize:"xs",color:"white",wordBreak:"break-word",whiteSpace:"pre-wrap",lineHeight:"1.3",display:"inline",userSelect:"text",_focus:{outline:"none",boxShadow:"none"},css:{"&::selection":{background:"rgba(66, 153, 225, 0.3)"}},children:[S.jsx($e,{as:"span",fontWeight:"bold",color:e?"blue.300":"green.300",mr:1,textShadow:"0 1px 2px rgba(0,0,0,0.4)",children:n.user}),n.role&&S.jsx($e,{as:"span",mr:1,children:n.role==="owner"?"":n.role==="host"?"":""}),n.isGuest&&S.jsx($e,{as:"span",color:"gray.400",fontSize:"xs",mr:1,children:"(Guest)"}),S.jsx($e,{as:"span",color:"white",textShadow:"0 1px 2px rgba(0,0,0,0.4)",children:n.text}),S.jsx($e,{as:"span",fontSize:"xs",color:"whiteAlpha.500",ml:2,fontWeight:"normal",children:L(n.timestamp)})]})}),u&&y&&S.jsx(He,{position:"absolute",top:"4px",right:"4px",zIndex:"1000",children:S.jsxs(SE,{children:[S.jsx(bE,{as:va,icon:S.jsx(Hae,{}),size:"xs",variant:"ghost",color:"white",bg:"rgba(0, 0, 0, 0.6)",_hover:{bg:"rgba(0, 0, 0, 0.8)"},_active:{bg:"rgba(0, 0, 0, 0.8)"},borderRadius:"full",minW:"20px",h:"20px",isLoading:b}),S.jsx(wE,{bg:"rgba(0, 0, 0, 0.9)",borderColor:"whiteAlpha.300",minW:"120px",zIndex:"9999",boxShadow:"lg",border:"1px solid rgba(255, 255, 255, 0.2)",children:S.jsx(fh,{icon:S.jsx(eWe,{}),onClick:O,bg:"transparent",color:"red.300",_hover:{bg:"red.900"},fontSize:"sm",isDisabled:b,children:"Delete Message"})})]})})]})},GGe=({messages:n=[],currentUserId:e,isLoading:i=!1,spaceID:o})=>{const l=k.useRef(null),u=k.useRef(null),p=b=>{};k.useEffect(()=>{l.current&&setTimeout(()=>{l.current.scrollIntoView({behavior:n.length<=1?"auto":"smooth",block:"end"})},100)},[n]),k.useEffect(()=>{n.length>0&&l.current&&l.current.scrollIntoView({behavior:"auto",block:"end"})},[]);const E=(b=>{const T=[];let R=null;return b.forEach(O=>{var U;const D=((U=O.timestamp)!=null&&U.toDate?O.timestamp.toDate():new Date(O.timestamp)).toDateString();(!R||R.date!==D)&&(R={date:D,messages:[]},T.push(R)),R.messages.push(O)}),T})(n);return i&&n.length===0?S.jsx(He,{display:"flex",justifyContent:"center",alignItems:"center",height:"100%",color:"whiteAlpha.600",children:S.jsxs(Qn,{spacing:2,children:[S.jsx(vd,{size:"sm"}),S.jsx($e,{fontSize:"sm",children:"Loading messages..."})]})}):n.length===0?S.jsx(He,{display:"flex",justifyContent:"center",alignItems:"center",height:"100%",color:"whiteAlpha.600",textAlign:"center",p:4,children:S.jsxs(Qn,{spacing:2,children:[S.jsx($e,{fontSize:"sm",children:"No messages yet"}),S.jsx($e,{fontSize:"xs",children:"Be the first to start the conversation!"})]})}):S.jsx(He,{ref:u,width:"100%",maxWidth:"100%",height:"100%",css:{boxSizing:"border-box","& *:focus":{outline:"none !important",boxShadow:"none !important"},"& *::selection":{background:"transparent"}},children:S.jsxs(Qn,{spacing:0,align:"stretch",width:"100%",children:[E.map((b,T)=>S.jsxs(He,{children:[T>0&&S.jsxs(He,{display:"flex",alignItems:"center",my:2,children:[S.jsx(He,{flex:1,height:"1px",bg:"whiteAlpha.200"}),S.jsx($e,{fontSize:"xs",color:"whiteAlpha.600",px:2,bg:"rgba(0, 0, 0, 0.5)",borderRadius:"md",children:b.date===new Date().toDateString()?"Today":b.date}),S.jsx(He,{flex:1,height:"1px",bg:"whiteAlpha.200"})]}),b.messages.map(R=>S.jsx(WGe,{message:R,isCurrentUser:R.uid===e,spaceID:o,onMessageDelete:p},R.id))]},b.date)),S.jsx("div",{ref:l,style:{height:"1px",width:"100%"}})]})})};function HGe(n){return sr({attr:{fill:"currentColor",viewBox:"0 0 16 16"},child:[{tag:"path",attr:{d:"M8 15A7 7 0 1 1 8 1a7 7 0 0 1 0 14zm0 1A8 8 0 1 0 8 0a8 8 0 0 0 0 16z"}},{tag:"path",attr:{d:"M4.285 9.567a.5.5 0 0 1 .683.183A3.498 3.498 0 0 0 8 11.5a3.498 3.498 0 0 0 3.032-1.75.5.5 0 1 1 .866.5A4.498 4.498 0 0 1 8 12.5a4.498 4.498 0 0 1-3.898-2.25.5.5 0 0 1 .183-.683zM7 6.5C7 7.328 6.552 8 6 8s-1-.672-1-1.5S5.448 5 6 5s1 .672 1 1.5zm4 0c0 .828-.448 1.5-1 1.5s-1-.672-1-1.5S9.448 5 10 5s1 .672 1 1.5z"}}]})(n)}const $Ge=({onSendMessage:n,onFocusChange:e,placeholder:i="Press Enter to chat...",disabled:o=!1,maxLength:l=500})=>{const[u,p]=k.useState(""),[y,E]=k.useState(!1),b=k.useRef(null),T=["","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","",""],R=Y=>{Y.key==="Enter"&&!Y.shiftKey?(Y.preventDefault(),O()):Y.key==="Escape"&&(Y.preventDefault(),D())},O=()=>{u.trim()&&!o&&(n(u),p(""),setTimeout(()=>{b.current&&b.current.focus()},0))},L=()=>{E(!0),e==null||e(!0)},D=()=>{E(!1),e==null||e(!1),b.current&&b.current.blur()},U=Y=>{const W=Y.target.value;W.length<=l&&p(W)},F=Y=>{const W=u+Y;W.length<=l&&(p(W),setTimeout(()=>{b.current&&b.current.focus()},0))};return k.useEffect(()=>{const Y=W=>{W.key==="Enter"&&!y&&!o&&W.target.tagName!=="INPUT"&&W.target.tagName!=="TEXTAREA"&&!W.target.isContentEditable&&(W.preventDefault(),b.current&&b.current.focus())};return document.addEventListener("keydown",Y),()=>{document.removeEventListener("keydown",Y)}},[y,o]),S.jsxs($f,{size:"sm",children:[S.jsx(wS,{children:S.jsxs(SE,{children:[S.jsx(bE,{as:va,icon:S.jsx(HGe,{}),size:"xs",variant:"ghost",color:"white",_hover:{bg:"whiteAlpha.200"},"aria-label":"Add emoji",disabled:o}),S.jsx(wE,{bg:"rgba(0, 0, 0, 0.9)",borderColor:"whiteAlpha.300",border:"1px solid rgba(255, 255, 255, 0.2)",maxW:"280px",zIndex:"9999",p:2,children:S.jsx(AF,{columns:8,spacing:1,children:T.map((Y,W)=>S.jsx(He,{as:"button",p:1,borderRadius:"md",_hover:{bg:"whiteAlpha.200"},onClick:()=>F(Y),fontSize:"lg",textAlign:"center",minH:"32px",display:"flex",alignItems:"center",justifyContent:"center",children:Y},W))})})]})}),S.jsx(ni,{ref:b,value:u,onChange:U,onKeyPress:R,onFocus:L,onBlur:D,placeholder:i,disabled:o,bg:"rgba(255, 255, 255, 0.05)",border:"1px solid rgba(255, 255, 255, 0.1)",color:"white",_placeholder:{color:"whiteAlpha.500"},_focus:{bg:"rgba(255, 255, 255, 0.1)",border:"1px solid rgba(255, 255, 255, 0.3)",boxShadow:"0 0 0 1px rgba(66, 153, 225, 0.4)"},_hover:{border:"1px solid rgba(255, 255, 255, 0.2)"},borderRadius:"md",pl:"40px",pr:"40px"}),S.jsx(vR,{children:S.jsx(va,{icon:S.jsx(Wze,{}),size:"xs",variant:"ghost",color:"white",_hover:{bg:"whiteAlpha.200"},onClick:O,disabled:o||!u.trim(),"aria-label":"Send message"})})]})},KGe=({spaceID:n,isVisible:e=!0})=>{const{user:i}=k.useContext(Di),{isOpen:o,onToggle:l,onClose:u}=yu(),[p,y]=k.useState(!1),[E,b]=k.useState(0),[T,R]=k.useState(!1),[O,L]=k.useState(!1),D=k.useRef(null),{messages:U,sendMessage:F,isLoading:Y,error:W}=BGe(n);zGe(p),k.useEffect(()=>{const ie=()=>{R(!0)};return window.addEventListener("PlayerInstantiated",ie),()=>{window.removeEventListener("PlayerInstantiated",ie)}},[]),k.useEffect(()=>{if(!o&&U.length>0){const ie=U.filter(me=>me.timestamp>(localStorage.getItem(`lastReadChat_${n}`)||0));b(ie.length)}else o&&(b(0),localStorage.setItem(`lastReadChat_${n}`,Date.now().toString()))},[o,U,n]);const re=async ie=>{if(!(!i||!ie.trim()))try{await F({text:ie.trim(),uid:i.uid,user:i.Nickname||i.displayName||i.username||"Anonymous",timestamp:new Date,rpmURL:i.rpmURL,isGuest:i.isGuest||!1})}catch(me){console.error("Failed to send message:",me)}},le=ie=>{y(ie)};return k.useEffect(()=>{o&&D.current&&setTimeout(()=>{const ie=D.current;ie.scrollTop=ie.scrollHeight},150)},[o,U.length]),k.useEffect(()=>{(async()=>{if(n)try{const me=await _o(n);L((me==null?void 0:me.textChatDisabled)||!1)}catch(me){console.error("Error checking text chat setting:",me),L(!1)}})()},[n]),k.useEffect(()=>{const ie=me=>{me.detail&&me.detail.spaceId===n&&(L(me.detail.textChatDisabled),me.detail.textChatDisabled&&o&&u())};return window.addEventListener("SpaceTextChatSettingChanged",ie),()=>{window.removeEventListener("SpaceTextChatSettingChanged",ie)}},[n,o,u]),!e||!i||!T||O?null:S.jsxs(He,{position:"absolute",bottom:"20px",left:"20px",zIndex:"1000",maxWidth:"350px",minWidth:"280px",children:[!o&&S.jsxs(He,{position:"relative",children:[S.jsx(va,{icon:S.jsx(rZ,{}),"aria-label":"Open chat",size:"lg",colorScheme:"blue",bg:"rgba(0, 0, 0, 0.7)",color:"white",_hover:{bg:"rgba(0, 0, 0, 0.8)"},borderRadius:"full",onClick:l}),E>0&&S.jsx(Mc,{position:"absolute",top:"-5px",right:"-5px",colorScheme:"red",borderRadius:"full",minW:"20px",h:"20px",display:"flex",alignItems:"center",justifyContent:"center",fontSize:"xs",children:E>99?"99+":E})]}),S.jsx(qne,{in:o,animateOpacity:!0,children:S.jsxs(He,{bg:"rgba(0, 0, 0, 0.3)",backdropFilter:"blur(8px)",borderRadius:"md",overflow:"visible",maxWidth:"350px",minWidth:"280px",children:[S.jsx(He,{height:"210px",overflowY:"scroll",overflowX:"hidden",p:2,width:"100%",maxWidth:"100%",css:{boxSizing:"border-box","&::-webkit-scrollbar":{width:"4px"},"&::-webkit-scrollbar-track":{background:"transparent"},"&::-webkit-scrollbar-thumb":{background:"rgba(255, 255, 255, 0.2)",borderRadius:"2px"},"&::-webkit-scrollbar:horizontal":{display:"none"}},ref:D,children:S.jsx(GGe,{messages:U,currentUserId:i==null?void 0:i.uid,isLoading:Y,spaceID:n})}),S.jsx(He,{p:2,children:S.jsxs(Cn,{spacing:2,align:"center",children:[S.jsx(He,{flex:1,children:S.jsx($Ge,{onSendMessage:re,onFocusChange:le,placeholder:"Press Enter to chat...",disabled:Y})}),S.jsx(va,{icon:S.jsx(rZ,{}),size:"sm",variant:"ghost",color:"white",_hover:{bg:"whiteAlpha.200"},onClick:u,"aria-label":"Minimize chat",h:"32px",w:"32px",flexShrink:0})]})}),W&&S.jsx(He,{p:2,bg:"red.500",color:"white",fontSize:"xs",textAlign:"center",children:W})]})})]})},qGe=({isOpen:n,onClose:e,currentSpaceId:i})=>{const[o,l]=k.useState([]),[u,p]=k.useState(!1),[y,E]=k.useState(null),[b,T]=k.useState(!1),R=ea(),{placePortal:O,directPlacePortal:L}=Qae(),D=xg("rgba(240, 240, 240, 0.95)","rgba(35, 35, 35, 0.95)"),U=xg("gray.800","white"),F=xg("gray.200","whiteAlpha.200"),Y=xg("gray.200","whiteAlpha.300");k.useEffect(()=>{n&&(async()=>{p(!0),E(null),l([]);try{const ie=mc(Fn,"spaces"),q=(await _d(ie)).docs.map(J=>({id:J.id,name:J.data().name||`Space ID: ${J.id}`}));l(q)}catch(ie){G.error("PortalAdminModal: Error fetching spaces:",ie),E("Failed to load spaces. Please check your connection and try again.")}p(!1)})()},[n]);const W=async(le,ie)=>{if(!i){G.error("PortalAdminModal: currentSpaceId is not defined. Cannot save portal."),R({title:"Error",description:"Cannot place portal: Current space ID is missing.",status:"error",duration:5e3,isClosable:!0});return}T(!0),G.log(`PortalAdminModal: Attempting to place portal to ${ie} (${le}) in space ${i}`);try{const me=await _o(le);if(!me)throw new Error(`Failed to fetch target space data for ${le}`);const q=me.backgroundUrl||me.backgroundGsUrl;q||G.warn(`PortalAdminModal: No background image URL found for target space: ${le}`);const J="PortalObjectPrefab",Q={x:0,y:1.5,z:0},ne={x:0,y:0,z:0},he={x:1,y:1,z:1},de=`portal_${i}_${le}_${Date.now()}`;if(!await IGe(i,de,{type:"portal",targetSpaceId:le,targetSpaceName:ie,portalId:de,position:Q,rotation:ne,scale:he,prefabName:J,initialImageUrl:q})){G.error(`PortalAdminModal: Failed to save portal data to Firebase for space ${i}.`),R({title:"Save Error",description:"Failed to save portal data to database.",status:"error",duration:5e3,isClosable:!0}),T(!1);return}G.log(`PortalAdminModal: Portal data saved to Firebase for space ${i}.`);let Ie=!1;try{const Fe={portalId:de,prefabName:J,position:Q,rotation:ne,scale:he,initialImageUrl:q};Ie=O(de,J,Q,ne,he,q),Ie||(Ie=L(de,J,Q,ne,he,q)),G.log("PortalAdminModal: Portal placement in Unity:",Ie)}catch(Fe){G.error("PortalAdminModal: Error placing portal in Unity:",Fe)}Ie?(R({title:"Portal Placed",description:`Portal to ${ie} created successfully.`,status:"success",duration:3e3,isClosable:!0}),e()):(R({title:"Portal Saved",description:"Portal data saved. It will appear when Unity is ready.",status:"info",duration:5e3,isClosable:!0}),e())}catch(me){G.error("PortalAdminModal: Error creating portal:",me),R({title:"Error",description:"Failed to create portal. Please try again.",status:"error",duration:5e3,isClosable:!0})}finally{T(!1)}},re=u||b;return S.jsxs(_s,{isOpen:n,onClose:e,size:"lg",isCentered:!0,scrollBehavior:"inside",children:[S.jsx(vs,{bg:"blackAlpha.700",backdropFilter:"blur(8px)"}),S.jsxs(ys,{bg:D,backdropFilter:"blur(18px)",color:U,borderRadius:"lg",maxHeight:"80vh",boxShadow:"2xl",children:[S.jsx(Do,{borderBottom:"1px solid",borderColor:Y,fontSize:"lg",fontWeight:"semibold",children:"Select a Space to Create Portal To"}),S.jsx(Ns,{}),S.jsxs(Es,{p:6,children:[re&&S.jsxs(Qn,{justifyContent:"center",alignItems:"center",height:"200px",children:[S.jsx(vd,{size:"xl",thickness:"4px",speed:"0.65s",emptyColor:"gray.200",color:"blue.500"}),S.jsx($e,{mt:3,children:"Loading Spaces..."})]}),y&&S.jsxs(sE,{status:"error",borderRadius:"md",variant:"subtle",children:[S.jsx(oE,{}),y]}),!u&&!y&&o.length===0&&S.jsx($e,{textAlign:"center",py:10,children:"No spaces found or you may not have permission to view them."}),!u&&!y&&o.length>0&&S.jsx(SN,{spacing:3,children:o.map(le=>S.jsx(Vre,{p:3,borderRadius:"md",_hover:{bg:F,cursor:re?"not-allowed":"pointer",transform:re?"none":"scale(1.02)"},transition:"background-color 0.2s ease-in-out, transform 0.2s ease-in-out",onClick:()=>!re&&W(le.id,le.name),borderWidth:"1px",borderColor:"transparent",_focus:{boxShadow:"outline"},opacity:re?.7:1,pointerEvents:re?"none":"auto",children:le.name},le.id))})]})]})]})},YGe={Furniture:"chair",Objects:"misc"},XGe=({isOpen:n,onClose:e,settings:i})=>{const[o,l]=k.useState(null),[u,p]=k.useState(""),[y,E]=k.useState(!1),[b,T]=k.useState(!1),[R,O]=k.useState([]),[L,D]=k.useState(!0),[U,F]=k.useState(null),{placeCatalogueItem:Y}=Zae();xg("blue.500","blue.300"),xg("gray.500","gray.400"),xg("whiteAlpha.200","whiteAlpha.200"),k.useEffect(()=>{n&&(async()=>{D(!0),F(null),O([]);try{const ne=mc(Fn,"catalogue"),he=await _d(ne),de=[];he.forEach(pe=>{var Fe,we;const Se=pe.data(),Ie=["chair","misc"];Se.glbUrl&&((Fe=Se.categories)!=null&&Fe.some(Re=>Ie.includes(Re)))&&de.push({id:pe.id,name:Se.name||"Unnamed Item",thumbnail:((we=Se.thumbnail)==null?void 0:we.src)||"https://via.placeholder.com/150",glbUrl:Se.glbUrl,categories:Se.categories})}),O(de)}catch(ne){console.error("Error fetching catalogue items:",ne),F("Failed to load catalogue items. Please check your connection and try again.")}D(!1)})()},[n]);const W=Q=>{l(Q),p(""),E(Q==="Portals")},re=()=>{l(null),E(!1),p("")},le=(Q,ne)=>{const he=YGe[ne];let de=Q;return he&&(de=de.filter(pe=>{var Se;return(Se=pe.categories)==null?void 0:Se.includes(he)})),u&&(de=de.filter(pe=>pe.name.toLowerCase().includes(u.toLowerCase()))),de},ie=["Furniture","Objects"].includes(o||"")?le(R,o):[],me=async Q=>{try{if(!Q.glbUrl){console.error("Item is missing GLB URL");return}const ne=`item_${i.spaceID}_${Date.now()}`,he={x:0,y:0,z:0},de={x:0,y:0,z:0},pe={x:1,y:1,z:1},Se={itemId:ne,name:Q.name||"Unnamed Item",glbUrl:Q.glbUrl,thumbnail:Q.thumbnail||"https://via.placeholder.com/150",position:he,rotation:de,scale:pe,createdAt:Date.now(),updatedAt:Date.now(),categories:Q.categories||[]};if(!Se.glbUrl)throw new Error("GLB URL is required");await Xg(dr(Fn,"spaces",i.spaceID,"catalogue",ne),Se),Y(ne,Se.glbUrl,he,de,pe)?e():console.error("Failed to place item in Unity")}catch(ne){console.error("Error placing item:",ne)}},q=()=>{T(!0)},J=()=>{T(!1)};return S.jsxs(_s,{isOpen:n,onClose:e,isCentered:!1,motionPreset:"slideInLeft",children:[S.jsx(vs,{bg:"transparent",backdropFilter:"none"}),S.jsxs(ys,{bg:"#1a1a1a",color:"white",borderRadius:"2xl",border:"1px solid #333",position:"fixed",left:"20px",top:"20px",transform:"none",width:"360px",maxWidth:"360px",height:"80vh",maxHeight:"80vh",overflow:"hidden",boxShadow:"xl",children:[S.jsx(Do,{fontSize:"md",fontWeight:"600",pb:1,pt:3,px:4,color:"white",borderBottom:"1px solid",borderColor:"whiteAlpha.300",children:S.jsxs(Mr,{align:"center",gap:2,children:[o&&S.jsx(va,{"aria-label":"Back",icon:S.jsx(z9e,{}),size:"sm",variant:"ghost",color:"whiteAlpha.800",onClick:re}),S.jsx($e,{children:o?y?"Create New Portal":o:"Content Catalogue"})]})}),S.jsx(Ns,{color:"white",bg:"rgba(255,255,255,0.1)",_hover:{color:"gray.400",bg:"transparent"},borderRadius:"full",size:"sm",top:2,right:3}),S.jsxs(Es,{p:0,display:"flex",flexDirection:"column",height:"calc(100% - 60px)",children:[!o&&S.jsx(He,{p:4,children:S.jsxs(wk,{templateColumns:"repeat(2, 1fr)",gap:3,children:[S.jsx(He,{onClick:()=>W("Recent"),cursor:"pointer",bg:"rgba(255,255,255,0.06)",border:"1px solid rgba(255,255,255,0.12)",borderRadius:"xl",height:"120px",display:"flex",alignItems:"center",justifyContent:"center",_hover:{bg:"rgba(255,255,255,0.12)"},children:S.jsxs(Qn,{spacing:2,children:[S.jsx(en,{as:G9e,boxSize:8,color:"white"}),S.jsx($e,{fontSize:"sm",color:"white",children:"Recent"})]})}),S.jsx(He,{onClick:()=>W("Furniture"),cursor:"pointer",bg:"rgba(255,255,255,0.06)",border:"1px solid rgba(255,255,255,0.12)",borderRadius:"xl",height:"120px",display:"flex",alignItems:"center",justifyContent:"center",_hover:{bg:"rgba(255,255,255,0.12)"},children:S.jsxs(Qn,{spacing:2,children:[S.jsx(en,{as:H9e,boxSize:8,color:"white"}),S.jsx($e,{fontSize:"sm",color:"white",children:"Furniture"})]})}),S.jsx(He,{onClick:()=>W("Objects"),cursor:"pointer",bg:"rgba(255,255,255,0.06)",border:"1px solid rgba(255,255,255,0.12)",borderRadius:"xl",height:"120px",display:"flex",alignItems:"center",justifyContent:"center",_hover:{bg:"rgba(255,255,255,0.12)"},children:S.jsxs(Qn,{spacing:2,children:[S.jsx(en,{as:$9e,boxSize:8,color:"white"}),S.jsx($e,{fontSize:"sm",color:"white",children:"Objects"})]})}),S.jsx(He,{onClick:()=>W("Upload"),cursor:"pointer",bg:"rgba(255,255,255,0.06)",border:"1px solid rgba(255,255,255,0.12)",borderRadius:"xl",height:"120px",display:"flex",alignItems:"center",justifyContent:"center",_hover:{bg:"rgba(255,255,255,0.12)"},children:S.jsxs(Qn,{spacing:2,children:[S.jsx(en,{as:tWe,boxSize:8,color:"white"}),S.jsx($e,{fontSize:"sm",color:"white",children:"Upload"})]})}),S.jsx(He,{onClick:()=>W("Portals"),cursor:"pointer",bg:"rgba(255,255,255,0.06)",border:"1px solid rgba(255,255,255,0.12)",borderRadius:"xl",height:"120px",display:"flex",alignItems:"center",justifyContent:"center",gridColumn:"1 / span 2",_hover:{bg:"rgba(255,255,255,0.12)"},children:S.jsxs(Qn,{spacing:2,children:[S.jsx(en,{as:K9e,boxSize:8,color:"white"}),S.jsx($e,{fontSize:"sm",color:"white",children:"Portals"})]})})]})}),o==="Portals"&&y?S.jsx(He,{p:4,flexGrow:1,display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",children:S.jsx(On,{size:"lg",colorScheme:"blue",onClick:q,children:"Browse"})}):o&&S.jsxs(S.Fragment,{children:[S.jsx(He,{p:4,children:S.jsx(ni,{placeholder:`Search in ${o}...`,value:u,onChange:Q=>p(Q.target.value),bg:"rgba(255, 255, 255, 0.05)",borderColor:"rgba(255, 255, 255, 0.2)",borderRadius:"md",size:"md",_placeholder:{color:"whiteAlpha.500"}})}),S.jsx(He,{p:4,pt:0,overflowY:"auto",flexGrow:1,children:S.jsx(wk,{templateColumns:"repeat(2, minmax(0, 1fr))",gap:3,children:L?S.jsx($e,{color:"whiteAlpha.700",children:"Loading items..."}):ie.length>0?ie.map(Q=>S.jsxs(He,{p:2,bg:"whiteAlpha.100",borderRadius:"lg",textAlign:"center",cursor:"pointer",_hover:{bg:"whiteAlpha.300",transform:"scale(1.03)"},onClick:()=>me(Q),transition:"all 0.2s ease-in-out",display:"flex",flexDirection:"column",children:[S.jsx(He,{bgImage:`url(${Q.thumbnail})`,bgSize:"contain",bgRepeat:"no-repeat",bgPos:"center",borderRadius:"md",h:"84px",mb:2,flexShrink:0}),S.jsx($e,{fontSize:"xs",noOfLines:2,flexGrow:1,display:"flex",alignItems:"center",justifyContent:"center",children:Q.name})]},Q.id)):S.jsxs($e,{color:"whiteAlpha.700",children:[o==="Furniture"&&"No chairs found in the catalogue.",o==="Objects"&&"No miscellaneous objects found in the catalogue.",!["Furniture","Objects"].includes(o)&&`No items found in "${o}"${u&&` matching "${u}"`}.`]})})})]})]})]}),S.jsx(qGe,{isOpen:b,onClose:J,currentSpaceId:i==null?void 0:i.spaceID})]})},JGe="9442a472625f44e7b2c5065b9f9b3988",wV=()=>document.querySelector("canvas")||document.getElementById("unity-canvas"),o4=k.forwardRef(({settings:n},e)=>{const{unityProvider:i,isLoaded:o,error:l}=Lo(),u=oWe();cWe();const p=Wa(),y=IWe(u),{user:E}=k.useContext(Di),[b,T]=k.useState(!1),[R,O]=k.useState(window.devicePixelRatio),[L,D]=aWe();Jae().find(bt=>bt.isLocalPlayer);const[F,Y]=k.useState(!0),[W,re]=k.useState(!0),[le,ie]=k.useState(!1),me=ea(),q=n.spaceID||"default";CWe(),wWe(q),VGe(q,{enableDebugLogs:!0});const{trackUnityEvent:J}=kE(q,{enableDebugLogs:!0}),[Q,ne]=k.useState(!1),[he,de]=k.useState(!1),[pe,Se]=k.useState(!1),[Ie,Fe]=k.useState(!1),we=k.useMemo(()=>new URLSearchParams(window.location.search).get("sessionId")||q,[q]),[Re,Te]=k.useState(null);k.useEffect(()=>{E!=null&&E.uid&&Fc(E.uid).then(bt=>{Te(bt)}).catch(bt=>{console.error("Error fetching user profile:",bt)})},[E==null?void 0:E.uid]),k.useEffect(()=>{(async()=>{if(E!=null&&E.uid&&q)try{const ve=await Fc(E.uid);let De=!1;if(ve.groups){const Ot=`space_${q}_owners`;De=ve.groups.includes(Ot)}const qe=await lx(E.uid,"disruptiveAdmin");ie(De||qe)}catch(ve){console.error("Error checking edit permissions:",ve),ie(!1)}else ie(!1)})()},[E==null?void 0:E.uid,q]),k.useEffect(()=>{const bt=async()=>{if(l){de(!0),Se(!0);return}if(E){de(!1);return}try{const De=await _o(q);De&&De.allowGuestUsers===!0?de(!1):(de(!0),Se(!0))}catch{de(!0),Se(!0)}},ve=setTimeout(()=>{bt()},1e3);return()=>clearTimeout(ve)},[l,E,q]),k.useEffect(()=>{const bt=()=>{re(!0),window.dispatchEvent(new CustomEvent("PlayerInstantiated")),window.isPlayerInstantiated=!0};window.isPlayerInstantiated&&re(!0),Eh.subscribe(yh.playerInstantiated,bt);const ve=setTimeout(()=>{W||(re(!0),window.isPlayerInstantiated=!0,window.dispatchEvent(new CustomEvent("PlayerInstantiated")))},5e3);return()=>{Eh.unsubscribe(yh.playerInstantiated,bt),clearTimeout(ve)}},[W]),k.useEffect(()=>{const bt=()=>{Se(!0)},ve=()=>{Se(!1)};return window.addEventListener("modal-opened",bt),window.addEventListener("modal-closed",ve),()=>{window.removeEventListener("modal-opened",bt),window.removeEventListener("modal-closed",ve)}},[]),k.useEffect(()=>{Se(L!==null)},[L]),k.useEffect(()=>{o||u?setTimeout(()=>{T(!0)},5e3):console.warn("WebGLRenderer: Unity is NOT ready yet.")},[o,u]),k.useEffect(()=>{o&&i&&setTimeout(()=>{if(window.unityInstance)try{window.unityInstance.SendMessage("WebGLInput","SetCaptureAllKeyboardInput",!1)}catch(bt){console.error("WebGLRenderer: Error disabling Unity keyboard capture:",bt)}},1e3)},[o,i]),k.useEffect(()=>{const bt=document.getElementById("webgl-root");return bt?(bt.style.display="block",bt.getAttribute("data-space-id")!==q&&bt.setAttribute("data-space-id",q)):console.error("WebGLRenderer: Could not find webgl-root element"),()=>{}},[q]),k.useEffect(()=>{const bt=()=>{const qe=wV();qe?(qe.tabIndex=1,qe.style.outline="none",qe.addEventListener("click",()=>{pe||By(!0)})):console.warn("WebGLRenderer: Could not find Unity canvas to configure")};bt();const ve=setTimeout(bt,1e3),De=()=>{bt()};return window.addEventListener("unityReady",De),()=>{clearTimeout(ve),window.removeEventListener("unityReady",De)}},[o,pe]);const Ne=k.useCallback(()=>{pe||By(!0)},[pe]);k.useEffect(()=>{if(o&&i){const bt=wV();if(bt)return bt.addEventListener("click",Ne),()=>{bt.removeEventListener("click",Ne)}}},[o,i,Ne]),k.useEffect(()=>{if(o&&i){const bt=ve=>{if(pe||ve.target.tagName==="INPUT"||ve.target.tagName==="TEXTAREA"||ve.target.tagName==="SELECT"||ve.target.tagName==="BUTTON"||ve.target.closest(".chakra-modal__content")||ve.target.closest('[role="dialog"]')||ve.target.closest('[role="menu"]')||ve.target.closest(".chakra-popover__content")||ve.target.closest('[role="tooltip"]'))return;const De=wV();if(De&&(ve.target===De||De.contains(ve.target)))return;if(ve.target.closest(".webgl-overlay")||ve.target.closest(".game-ui")||ve.target.closest(".player-list")||ve.target.closest(".unity-ui-overlay")){setTimeout(()=>{pe||By(!0)},50);return}setTimeout(()=>{De&&!pe&&((De.tabIndex===void 0||De.tabIndex<0)&&(De.tabIndex=1),De.focus(),By(!0))},50)};return document.addEventListener("click",bt,!0),()=>{document.removeEventListener("click",bt,!0)}}},[o,i,pe]),k.useEffect(()=>{const bt=ve=>{p("FirebaseUserFromReact",ve)};return Eh.subscribe(yh.sendUserToUnity,bt),()=>Eh.unsubscribe(yh.sendUserToUnity,bt)},[p]);const{setFullscreenRef:be,fullscreenRef:xe}=Ch();k.useEffect(()=>{be(e.current)},[e,be]);const je=()=>{if(!le){me({title:"Permission Denied",description:"You don't have permission to edit this space. Only space owners can use Edit Mode.",status:"error",duration:5e3,isClosable:!0,position:"top"});return}if(Ie){Fe(!1),Se(!1);return}if(Q){ne(!1);const bt=new CustomEvent("editModeChanged",{detail:{enabled:!1}});window.dispatchEvent(bt)}else{ne(!0),Fe(!0),Se(!0);const bt=new CustomEvent("editModeChanged",{detail:{enabled:!0}});window.dispatchEvent(bt)}},nt=()=>{Fe(!1),Se(!1)},dt=()=>{Y(!F)},ft=E&&n.enableVoiceChat;k.useEffect(()=>{const bt=ve=>{ne(ve.detail.enabled)};return window.addEventListener("editModeChanged",bt),()=>{window.removeEventListener("editModeChanged",bt)}},[]),Xae(),hWe();const lt=k.useRef(null),{clickedPortal:gt,clearClickedPortal:at}=TWe(),[Ct,En]=k.useState(!1),[Gt,Jt]=k.useState(!1),[st,hn]=k.useState(""),[an,Ft]=k.useState("");k.useEffect(()=>{async function bt(){if(hn(""),Ft(""),gt&&!Q){let ve=gt.targetSpaceId;if(!ve&&gt.portalId)try{const De=dr(Fn,"spaces",q,"portals",gt.portalId),qe=await Qo(De);qe.exists()&&(ve=qe.data().targetSpaceId)}catch{}if(ve)try{const De=await _o(ve);hn((De==null?void 0:De.name)||ve),Ft((De==null?void 0:De.slug)||""),Jt(!0)}catch{hn(ve),Ft(""),Jt(!0)}else hn(""),Ft(""),Jt(!0)}}gt&&Q&&En(!0),gt&&!Q&&bt()},[gt,Q,q]);const on=()=>{En(!1),at()};return RWe(q),tce(),S.jsxs(He,{className:"webgl-renderer",children:[n.urlLoadingBackground&&S.jsx(lce,{backgroundUrl:n.urlLoadingBackground,videoBackgroundUrl:n.videoBackgroundUrl,containerRef:lt}),!he&&S.jsx(uce,{containerRef:lt}),he&&S.jsx(He,{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",zIndex:"100",width:"100%",height:"100%",display:"flex",justifyContent:"center",alignItems:"center",children:S.jsx(ib,{mode:"button",label:"Sign In",initialIsOpen:!0,buttonProps:{size:"lg",colorScheme:"blue"}})}),S.jsx(UGe,{spaceId:q,isEditMode:Q}),S.jsx(XGe,{isOpen:Ie,onClose:nt,settings:{spaceID:q}}),S.jsx(Cj,{containerRef:xe.current?xe:document.body,children:S.jsxs("div",{ref:e,style:{width:"100%",height:"100%",aspectRatio:"auto",position:"absolute"},children:[S.jsxs(He,{position:"absolute",zIndex:"10",top:4,right:4,display:"flex",alignItems:"center",gap:2,children:[S.jsx(PWe,{}),E&&S.jsx(RGe,{size:"md"}),ft&&S.jsxs(oce,{appId:JGe,channel:we,uid:E==null?void 0:E.uid,enabled:!0,children:[S.jsx(HWe,{size:"md",defaultMuted:!0,joinOnClick:!0}),S.jsx(KWe,{userNickname:Re==null?void 0:Re.Nickname})]}),le&&S.jsx(He,{as:"button",onClick:je,"aria-label":"Edit Mode",display:"flex",alignItems:"center",justifyContent:"center",width:"48px",height:"48px",color:"white",bg:Q?"linear-gradient(135deg, rgba(0, 0, 0, 0.45), rgba(0, 150, 255, 0.2), rgba(0, 0, 0, 0.35))":"linear-gradient(135deg, rgba(0, 0, 0, 0.5), rgba(20, 20, 20, 0.4))",backdropFilter:"blur(30px) saturate(200%) brightness(1.1)",_hover:{bg:Q?"linear-gradient(135deg, rgba(0, 0, 0, 0.55), rgba(0, 150, 255, 0.3), rgba(0, 0, 0, 0.45))":"linear-gradient(135deg, rgba(0, 0, 0, 0.6), rgba(20, 20, 20, 0.5))",transform:"scale(1.05)",backdropFilter:"blur(35px) saturate(220%) brightness(1.15)"},cursor:"pointer",boxShadow:Q?"0 0 20px 2px rgba(0, 150, 255, 0.8), 0 0 40px 4px rgba(0, 150, 255, 0.4), inset 0 1px 2px rgba(255, 255, 255, 0.4), inset 0 -1px 2px rgba(0, 0, 0, 0.3)":"0 4px 15px rgba(0, 0, 0, 0.3), inset 0 1px 2px rgba(255, 255, 255, 0.25), inset 0 -1px 2px rgba(0, 0, 0, 0.2)",transition:"all 0.3s ease",border:"1px solid",borderColor:Q?"rgba(0, 150, 255, 0.4)":"rgba(255, 255, 255, 0.2)",borderRadius:"full",position:"relative",_before:{content:'""',position:"absolute",top:0,left:0,right:0,bottom:0,borderRadius:"full",padding:"1px",background:Q?"linear-gradient(135deg, rgba(0, 150, 255, 0.5), rgba(0, 200, 255, 0.2))":"linear-gradient(135deg, rgba(255, 255, 255, 0.3), rgba(255, 255, 255, 0.1))",WebkitMask:"linear-gradient(#fff 0 0) content-box, linear-gradient(#fff 0 0)",WebkitMaskComposite:"xor",maskComposite:"exclude",pointerEvents:"none"},children:S.jsx(sWe,{size:"20px"})}),S.jsx(NWe,{}),S.jsx(He,{position:"relative",zIndex:"9999",children:S.jsx(fGe,{onTogglePlayerList:dt,spaceID:q,containerRef:lt})})]}),S.jsxs(He,{ref:lt,position:"relative",overflow:"hidden",width:"100%",height:"100%",bgRepeat:"no-repeat",bgSize:"cover",bgPosition:"center",bgColor:"#666666",children:[S.jsx(He,{position:"absolute",top:"0",left:"0",width:"100%",height:"100%",backdropFilter:"blur(8px)",backgroundColor:"rgba(255, 255, 255, 0.1)",zIndex:"0"}),S.jsx(He,{...y,width:"100%",height:"100%",position:"absolute",zIndex:"1",children:i&&!he?S.jsx(Bae.Unity,{unityProvider:i,style:{width:"100%",height:"100%"},devicePixelRatio:R,tabIndex:1}):S.jsx(He,{width:"100%",height:"100%",backgroundColor:"#333",display:"flex",alignItems:"center",justifyContent:"center",children:he&&S.jsx($e,{color:"white",fontSize:"lg",children:"Authentication Required"})})}),S.jsx(He,{position:"absolute",zIndex:"6",width:"100%",height:"100%",style:{display:"none"},children:S.jsx(AWe,{})})]}),S.jsx(He,{...y,position:"absolute",zIndex:"2",top:4,left:4,display:"flex",alignItems:"flex-start",gap:3,height:"50px",children:n.showDisruptiveLogo&&S.jsx(kp,{src:n.urlDisruptiveLogo,width:"100px",alt:"Disruptive Logo"})}),S.jsxs(He,{...y,position:"absolute",zIndex:"2",bottom:4,right:4,display:"flex",alignItems:"flex-start",gap:3,children:[n.showHelpButton&&S.jsx(OWe,{}),S.jsx(LWe,{})]}),S.jsx(MWe,{}),S.jsx(UWe,{isOpen:L!==null,onClose:()=>{D()},playerName:(L==null?void 0:L.playerName)||"Unknown Player",playerId:(L==null?void 0:L.playerId)||"Unknown ID",uid:L==null?void 0:L.uid}),S.jsx(VWe,{isVisible:F,onToggleVisibility:Y,spaceID:q}),S.jsx(CGe,{}),S.jsx(He,{position:"absolute",top:4,right:4,zIndex:1e3,children:Ct&&gt&&S.jsx(kGe,{isOpen:Ct,onClose:on,portal:gt,spaceId:q})}),!Q&&Gt&&S.jsxs(_s,{isOpen:Gt,onClose:()=>{Jt(!1),at(),hn(""),Ft("")},isCentered:!0,children:[S.jsx(vs,{bg:"rgba(0, 0, 0, 0.8)",backdropFilter:"blur(8px)"}),S.jsxs(ys,{bg:"#1a1a1a",borderRadius:"xl",border:"1px solid #333",maxW:"420px",p:0,children:[S.jsx(Do,{fontSize:"md",fontWeight:"600",pb:1,pt:3,px:4,color:"white",textAlign:"center",children:st?`Visit ${st}?`:"Visit Space?"}),S.jsx(Ns,{color:"white",bg:"rgba(255,255,255,0.1)",_hover:{color:"gray.400",bg:"transparent"},borderRadius:"full",size:"sm",top:2,right:3}),S.jsx(Es,{pb:8,pt:2,px:8,children:S.jsxs(Mr,{mt:4,gap:6,justify:"center",children:[S.jsx(On,{variant:"outline",borderColor:"whiteAlpha.400",color:"white",fontWeight:"bold",borderRadius:"2xl",px:10,py:6,fontSize:"lg",onClick:()=>{Jt(!1),at(),hn(""),Ft("")},_hover:{bg:"whiteAlpha.100"},children:"Cancel"}),S.jsx(On,{colorScheme:"whiteAlpha",bg:"white",color:"#181818",fontWeight:"bold",borderRadius:"2xl",px:10,py:6,fontSize:"lg",onClick:async()=>{if(gt&&E){let bt=null;if(gt.portalId){const ve=gt.portalId.split("_");ve.length>=3&&(bt=ve[2])}await J(fo.UNITY.PORTAL_NAVIGATE,{category:mo.NAVIGATION,portalId:gt.portalId,targetSpaceId:bt,sourceSpaceId:q,targetSpaceName:st,targetSpaceSlug:an,isEditMode:!1,navigationType:"confirmed",timestamp:new Date().toISOString()})}an&&window.open(`https://www.spacesmetaverse.com/w/${an}`,"_blank","noopener"),Jt(!1),at(),hn(""),Ft("")},_hover:{bg:"gray.100"},children:"Visit"})]})})]})]}),S.jsx(DGe,{}),S.jsx(KGe,{spaceID:q,isVisible:!he&&E})]})})]})});o4.displayName="WebGLRenderer";o4.propTypes={settings:An.shape({urlLoadingBackground:An.string,videoBackgroundUrl:An.string,showAuthButton:An.bool,showDisruptiveLogo:An.bool,urlDisruptiveLogo:An.string,showHelpButton:An.bool,enableVoiceChat:An.bool,spaceID:An.string})};typeof window<"u"&&!window.MultipleView&&(window.MultipleView=class{constructor(){this.multiView={getPlayer:()=>({isPlaying:!1,play:()=>!0,pause:()=>!0,mute:e=>!0,isMuted:!1,seek:e=>!0,setVolume:e=>!0,getVolume:()=>1,getCurrentTime:()=>0,getDuration:()=>100}),initialize:()=>!0,setUnityContext:e=>(window.hisPlayerContextId=e,!0),release:()=>!0,setProperties:e=>!0,setMultiPaths:e=>(window._hisplayer_paths=e,!0)}}});if(typeof window<"u"&&!window._hisPlayerInitialized){if(G.log("WebGLLoader: Initializing HISPlayer functions"),window._hisPlayerInitialized=!0,window._hisplayer_event_queue=window._hisplayer_event_queue||[],window._hisplayer_error_queue=window._hisplayer_error_queue||[],!document.getElementById("hisplayer-error")){const n=document.createElement("div");n.id="hisplayer-error",n.style.position="absolute",n.style.top="10px",n.style.left="50%",n.style.transform="translateX(-50%)",n.style.color="red",n.style.zIndex="9999",document.body.appendChild(n),G.log("WebGLLoader: Created hisplayer-error div")}window.isErrorQueueEmpty=window.isErrorQueueEmpty||function(){return window._hisplayer_error_queue.length===0},window.getNextError=window.getNextError||function(){return window._hisplayer_error_queue.length>0?window._hisplayer_error_queue.shift():""},window.isEventQueueEmpty=window.isEventQueueEmpty||function(){return window._hisplayer_event_queue.length===0},window.getNextEvent=window.getNextEvent||function(){return window._hisplayer_event_queue.length>0?window._hisplayer_event_queue.shift():""},window.setUpContext=window.setUpContext||function(n){window.hisPlayerContextId=n;try{if(window.MultipleView){const e=new window.MultipleView;if(e&&e.multiView&&typeof e.multiView.setUnityContext=="function")return e.multiView.setUnityContext(n),window._hisplayer_instance=e,!0;console.error("HISPlayer: Player initialization failed - missing expected methods")}else{console.error("HISPlayer: MultipleView class not found"),window.MultipleView=class{constructor(){this.multiView={getPlayer:()=>({isPlaying:!1,play:()=>!0,pause:()=>!0,mute:()=>!0,isMuted:!1,seek:()=>!0,setVolume:()=>!0,getVolume:()=>1,getCurrentTime:()=>0,getDuration:()=>100}),initialize:()=>!0,setUnityContext:o=>(window.hisPlayerContextId=o,!0),release:()=>!0,setProperties:()=>!0,setMultiPaths:()=>!0}}};const e=new window.MultipleView;return e.multiView.setUnityContext(n),window._hisplayer_instance=e,!0}}catch(e){console.error("HISPlayer: Error in setUpContext:",e);const i=document.getElementById("hisplayer-error");i&&(i.textContent="Error: "+e.message)}return!1}}const dce=({spaceID:n,overrideSettings:e})=>{const i=k.useRef(null),[o,l]=k.useState(!0),{loading:u,isUserBannedFromSpace:p,user:y}=k.useContext(Di),[E,b]=k.useState(!1),[T,R]=k.useState(!1),[O,L]=k.useState({spaceID:n,loaderUrl:"",dataUrl:"",frameworkUrl:"",codeUrl:""}),[D,U]=k.useState({urlDisruptiveLogo:"gs://disruptive-metaverse.appspot.com/common/images/Disruptive-logo-white-p-500.png",urlLoadingBackground:"",videoBackgroundUrl:"",showDisruptiveLogo:null,showAuthButton:null,showHelpButton:null,enableVoiceChat:!0,spaceID:n});return k.useEffect(()=>{if(u)return;(async()=>{const Y=y?300:800;await new Promise(W=>setTimeout(W,Y));try{const W=await _o(n);if(W){if(!y&&(!W.allowGuestUsers||W.allowGuestUsers!==!0)){R(!0),l(!1);return}else(!y&&W.allowGuestUsers===!0||y)&&R(!1);L(me=>({...me,spaceID:n,loaderUrl:W.loaderUrl,dataUrl:W.dataUrl,frameworkUrl:W.frameworkUrl,codeUrl:W.codeUrl}));const re=await sk(D.urlDisruptiveLogo);let le="";if(W.backgroundUrl)le=W.backgroundUrl;else if(W.backgroundGsUrl)try{le=await sk(W.backgroundGsUrl)}catch(me){G.warn("WebGLLoader: Error fetching background from GS URL:",me)}else if(W.gsUrlLoadingBackground)try{le=await sk(W.gsUrlLoadingBackground)}catch(me){G.warn("WebGLLoader: Error fetching background from legacy GS URL:",me)}let ie="";W.videoBackgroundUrl&&(ie=W.videoBackgroundUrl),U(me=>({...me,urlLoadingBackground:le,videoBackgroundUrl:ie,showAuthButton:W.showAuthButton!==void 0?W.showAuthButton:!0,showDisruptiveLogo:W.showDisruptiveLogo!==void 0?W.showDisruptiveLogo:!0,showHelpButton:W.showHelpButton!==void 0?W.showHelpButton:!0,enableVoiceChat:W.enableVoiceChat!==void 0?W.enableVoiceChat:!0,urlDisruptiveLogo:re,spaceID:n,...e||{}})),ie&&window.dispatchEvent(new CustomEvent("SpaceVideoBackgroundUpdated",{detail:{videoBackgroundUrl:ie}})),l(!1)}else G.error(`WebGLLoader: No configuration found for spaceID: ${n}`)}catch(W){G.error("WebGLLoader: Error fetching space data:",W)}finally{l(!1)}})()},[n,D.urlDisruptiveLogo,e,y,u]),k.useEffect(()=>{(async()=>{if(!u&&y&&p)try{const Y=await p(n);b(Y)}catch(Y){G.error("WebGLLoader: ban check error",Y)}})()},[u,y,n,p]),k.useEffect(()=>{o||(G.log("WebGLLoader: Unity config from Firebase",O),G.log("WebGLLoader: Space settings from Firebase",D))},[o]),u?S.jsx("div",{className:"flex justify-center items-center h-full mt-12",children:"Loading user"}):E?S.jsx("div",{className:"flex justify-center items-center h-full mt-12 text-red-500",children:"Access Denied: You have been banned from this space."}):T?S.jsx(He,{position:"absolute",top:"0",left:"0",width:"100%",height:"100%",display:"flex",justifyContent:"center",alignItems:"center",backgroundColor:"rgba(0, 0, 0, 0.8)",zIndex:"1000",children:S.jsx(ib,{mode:"button",label:"Sign In Required",initialIsOpen:!0,buttonProps:{size:"lg",colorScheme:"blue"}})}):n?S.jsx(S.Fragment,{children:o?S.jsx("div",{className:"flex justify-center items-center h-full mt-12",children:"Getting space data..."}):S.jsx(j9e,{...O,children:S.jsx(o4,{ref:i,settings:D})})}):null};dce.propTypes={spaceID:An.string.isRequired,overrideSettings:An.object};function Rh(n){const e=Object.prototype.toString.call(n);return n instanceof Date||typeof n=="object"&&e==="[object Date]"?new n.constructor(+n):typeof n=="number"||e==="[object Number]"||typeof n=="string"||e==="[object String]"?new Date(n):new Date(NaN)}function yE(n,e){return n instanceof Date?new n.constructor(e):new Date(e)}const hce=6048e5,QGe=864e5;let ZGe={};function gx(){return ZGe}function MR(n,e){var y,E,b,T;const i=gx(),o=(e==null?void 0:e.weekStartsOn)??((E=(y=e==null?void 0:e.locale)==null?void 0:y.options)==null?void 0:E.weekStartsOn)??i.weekStartsOn??((T=(b=i.locale)==null?void 0:b.options)==null?void 0:T.weekStartsOn)??0,l=Rh(n),u=l.getDay(),p=(u<o?7:0)+u-o;return l.setDate(l.getDate()-p),l.setHours(0,0,0,0),l}function eN(n){return MR(n,{weekStartsOn:1})}function pce(n){const e=Rh(n),i=e.getFullYear(),o=yE(n,0);o.setFullYear(i+1,0,4),o.setHours(0,0,0,0);const l=eN(o),u=yE(n,0);u.setFullYear(i,0,4),u.setHours(0,0,0,0);const p=eN(u);return e.getTime()>=l.getTime()?i+1:e.getTime()>=p.getTime()?i:i-1}function VZ(n){const e=Rh(n);return e.setHours(0,0,0,0),e}function jZ(n){const e=Rh(n),i=new Date(Date.UTC(e.getFullYear(),e.getMonth(),e.getDate(),e.getHours(),e.getMinutes(),e.getSeconds(),e.getMilliseconds()));return i.setUTCFullYear(e.getFullYear()),+n-+i}function e7e(n,e){const i=VZ(n),o=VZ(e),l=+i-jZ(i),u=+o-jZ(o);return Math.round((l-u)/QGe)}function t7e(n){const e=pce(n),i=yE(n,0);return i.setFullYear(e,0,4),i.setHours(0,0,0,0),eN(i)}function n7e(n){return n instanceof Date||typeof n=="object"&&Object.prototype.toString.call(n)==="[object Date]"}function r7e(n){if(!n7e(n)&&typeof n!="number")return!1;const e=Rh(n);return!isNaN(Number(e))}function i7e(n){const e=Rh(n),i=yE(n,0);return i.setFullYear(e.getFullYear(),0,1),i.setHours(0,0,0,0),i}const s7e={lessThanXSeconds:{one:"less than a second",other:"less than {{count}} seconds"},xSeconds:{one:"1 second",other:"{{count}} seconds"},halfAMinute:"half a minute",lessThanXMinutes:{one:"less than a minute",other:"less than {{count}} minutes"},xMinutes:{one:"1 minute",other:"{{count}} minutes"},aboutXHours:{one:"about 1 hour",other:"about {{count}} hours"},xHours:{one:"1 hour",other:"{{count}} hours"},xDays:{one:"1 day",other:"{{count}} days"},aboutXWeeks:{one:"about 1 week",other:"about {{count}} weeks"},xWeeks:{one:"1 week",other:"{{count}} weeks"},aboutXMonths:{one:"about 1 month",other:"about {{count}} months"},xMonths:{one:"1 month",other:"{{count}} months"},aboutXYears:{one:"about 1 year",other:"about {{count}} years"},xYears:{one:"1 year",other:"{{count}} years"},overXYears:{one:"over 1 year",other:"over {{count}} years"},almostXYears:{one:"almost 1 year",other:"almost {{count}} years"}},o7e=(n,e,i)=>{let o;const l=s7e[n];return typeof l=="string"?o=l:e===1?o=l.one:o=l.other.replace("{{count}}",e.toString()),i!=null&&i.addSuffix?i.comparison&&i.comparison>0?"in "+o:o+" ago":o};function TV(n){return(e={})=>{const i=e.width?String(e.width):n.defaultWidth;return n.formats[i]||n.formats[n.defaultWidth]}}const a7e={full:"EEEE, MMMM do, y",long:"MMMM do, y",medium:"MMM d, y",short:"MM/dd/yyyy"},c7e={full:"h:mm:ss a zzzz",long:"h:mm:ss a z",medium:"h:mm:ss a",short:"h:mm a"},l7e={full:"{{date}} 'at' {{time}}",long:"{{date}} 'at' {{time}}",medium:"{{date}}, {{time}}",short:"{{date}}, {{time}}"},u7e={date:TV({formats:a7e,defaultWidth:"full"}),time:TV({formats:c7e,defaultWidth:"full"}),dateTime:TV({formats:l7e,defaultWidth:"full"})},d7e={lastWeek:"'last' eeee 'at' p",yesterday:"'yesterday at' p",today:"'today at' p",tomorrow:"'tomorrow at' p",nextWeek:"eeee 'at' p",other:"P"},h7e=(n,e,i,o)=>d7e[n];function mC(n){return(e,i)=>{const o=i!=null&&i.context?String(i.context):"standalone";let l;if(o==="formatting"&&n.formattingValues){const p=n.defaultFormattingWidth||n.defaultWidth,y=i!=null&&i.width?String(i.width):p;l=n.formattingValues[y]||n.formattingValues[p]}else{const p=n.defaultWidth,y=i!=null&&i.width?String(i.width):n.defaultWidth;l=n.values[y]||n.values[p]}const u=n.argumentCallback?n.argumentCallback(e):e;return l[u]}}const p7e={narrow:["B","A"],abbreviated:["BC","AD"],wide:["Before Christ","Anno Domini"]},f7e={narrow:["1","2","3","4"],abbreviated:["Q1","Q2","Q3","Q4"],wide:["1st quarter","2nd quarter","3rd quarter","4th quarter"]},m7e={narrow:["J","F","M","A","M","J","J","A","S","O","N","D"],abbreviated:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],wide:["January","February","March","April","May","June","July","August","September","October","November","December"]},g7e={narrow:["S","M","T","W","T","F","S"],short:["Su","Mo","Tu","We","Th","Fr","Sa"],abbreviated:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],wide:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"]},_7e={narrow:{am:"a",pm:"p",midnight:"mi",noon:"n",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},abbreviated:{am:"AM",pm:"PM",midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},wide:{am:"a.m.",pm:"p.m.",midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"}},y7e={narrow:{am:"a",pm:"p",midnight:"mi",noon:"n",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"},abbreviated:{am:"AM",pm:"PM",midnight:"midnight",noon:"noon",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"},wide:{am:"a.m.",pm:"p.m.",midnight:"midnight",noon:"noon",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"}},E7e=(n,e)=>{const i=Number(n),o=i%100;if(o>20||o<10)switch(o%10){case 1:return i+"st";case 2:return i+"nd";case 3:return i+"rd"}return i+"th"},v7e={ordinalNumber:E7e,era:mC({values:p7e,defaultWidth:"wide"}),quarter:mC({values:f7e,defaultWidth:"wide",argumentCallback:n=>n-1}),month:mC({values:m7e,defaultWidth:"wide"}),day:mC({values:g7e,defaultWidth:"wide"}),dayPeriod:mC({values:_7e,defaultWidth:"wide",formattingValues:y7e,defaultFormattingWidth:"wide"})};function gC(n){return(e,i={})=>{const o=i.width,l=o&&n.matchPatterns[o]||n.matchPatterns[n.defaultMatchWidth],u=e.match(l);if(!u)return null;const p=u[0],y=o&&n.parsePatterns[o]||n.parsePatterns[n.defaultParseWidth],E=Array.isArray(y)?b7e(y,R=>R.test(p)):S7e(y,R=>R.test(p));let b;b=n.valueCallback?n.valueCallback(E):E,b=i.valueCallback?i.valueCallback(b):b;const T=e.slice(p.length);return{value:b,rest:T}}}function S7e(n,e){for(const i in n)if(Object.prototype.hasOwnProperty.call(n,i)&&e(n[i]))return i}function b7e(n,e){for(let i=0;i<n.length;i++)if(e(n[i]))return i}function w7e(n){return(e,i={})=>{const o=e.match(n.matchPattern);if(!o)return null;const l=o[0],u=e.match(n.parsePattern);if(!u)return null;let p=n.valueCallback?n.valueCallback(u[0]):u[0];p=i.valueCallback?i.valueCallback(p):p;const y=e.slice(l.length);return{value:p,rest:y}}}const T7e=/^(\d+)(th|st|nd|rd)?/i,C7e=/\d+/i,R7e={narrow:/^(b|a)/i,abbreviated:/^(b\.?\s?c\.?|b\.?\s?c\.?\s?e\.?|a\.?\s?d\.?|c\.?\s?e\.?)/i,wide:/^(before christ|before common era|anno domini|common era)/i},I7e={any:[/^b/i,/^(a|c)/i]},A7e={narrow:/^[1234]/i,abbreviated:/^q[1234]/i,wide:/^[1234](th|st|nd|rd)? quarter/i},P7e={any:[/1/i,/2/i,/3/i,/4/i]},O7e={narrow:/^[jfmasond]/i,abbreviated:/^(jan|feb|mar|apr|may|jun|jul|aug|sep|oct|nov|dec)/i,wide:/^(january|february|march|april|may|june|july|august|september|october|november|december)/i},k7e={narrow:[/^j/i,/^f/i,/^m/i,/^a/i,/^m/i,/^j/i,/^j/i,/^a/i,/^s/i,/^o/i,/^n/i,/^d/i],any:[/^ja/i,/^f/i,/^mar/i,/^ap/i,/^may/i,/^jun/i,/^jul/i,/^au/i,/^s/i,/^o/i,/^n/i,/^d/i]},N7e={narrow:/^[smtwf]/i,short:/^(su|mo|tu|we|th|fr|sa)/i,abbreviated:/^(sun|mon|tue|wed|thu|fri|sat)/i,wide:/^(sunday|monday|tuesday|wednesday|thursday|friday|saturday)/i},x7e={narrow:[/^s/i,/^m/i,/^t/i,/^w/i,/^t/i,/^f/i,/^s/i],any:[/^su/i,/^m/i,/^tu/i,/^w/i,/^th/i,/^f/i,/^sa/i]},D7e={narrow:/^(a|p|mi|n|(in the|at) (morning|afternoon|evening|night))/i,any:/^([ap]\.?\s?m\.?|midnight|noon|(in the|at) (morning|afternoon|evening|night))/i},L7e={any:{am:/^a/i,pm:/^p/i,midnight:/^mi/i,noon:/^no/i,morning:/morning/i,afternoon:/afternoon/i,evening:/evening/i,night:/night/i}},M7e={ordinalNumber:w7e({matchPattern:T7e,parsePattern:C7e,valueCallback:n=>parseInt(n,10)}),era:gC({matchPatterns:R7e,defaultMatchWidth:"wide",parsePatterns:I7e,defaultParseWidth:"any"}),quarter:gC({matchPatterns:A7e,defaultMatchWidth:"wide",parsePatterns:P7e,defaultParseWidth:"any",valueCallback:n=>n+1}),month:gC({matchPatterns:O7e,defaultMatchWidth:"wide",parsePatterns:k7e,defaultParseWidth:"any"}),day:gC({matchPatterns:N7e,defaultMatchWidth:"wide",parsePatterns:x7e,defaultParseWidth:"any"}),dayPeriod:gC({matchPatterns:D7e,defaultMatchWidth:"any",parsePatterns:L7e,defaultParseWidth:"any"})},U7e={code:"en-US",formatDistance:o7e,formatLong:u7e,formatRelative:h7e,localize:v7e,match:M7e,options:{weekStartsOn:0,firstWeekContainsDate:1}};function V7e(n){const e=Rh(n);return e7e(e,i7e(e))+1}function j7e(n){const e=Rh(n),i=+eN(e)-+t7e(e);return Math.round(i/hce)+1}function fce(n,e){var T,R,O,L;const i=Rh(n),o=i.getFullYear(),l=gx(),u=(e==null?void 0:e.firstWeekContainsDate)??((R=(T=e==null?void 0:e.locale)==null?void 0:T.options)==null?void 0:R.firstWeekContainsDate)??l.firstWeekContainsDate??((L=(O=l.locale)==null?void 0:O.options)==null?void 0:L.firstWeekContainsDate)??1,p=yE(n,0);p.setFullYear(o+1,0,u),p.setHours(0,0,0,0);const y=MR(p,e),E=yE(n,0);E.setFullYear(o,0,u),E.setHours(0,0,0,0);const b=MR(E,e);return i.getTime()>=y.getTime()?o+1:i.getTime()>=b.getTime()?o:o-1}function F7e(n,e){var y,E,b,T;const i=gx(),o=(e==null?void 0:e.firstWeekContainsDate)??((E=(y=e==null?void 0:e.locale)==null?void 0:y.options)==null?void 0:E.firstWeekContainsDate)??i.firstWeekContainsDate??((T=(b=i.locale)==null?void 0:b.options)==null?void 0:T.firstWeekContainsDate)??1,l=fce(n,e),u=yE(n,0);return u.setFullYear(l,0,o),u.setHours(0,0,0,0),MR(u,e)}function B7e(n,e){const i=Rh(n),o=+MR(i,e)-+F7e(i,e);return Math.round(o/hce)+1}function ki(n,e){const i=n<0?"-":"",o=Math.abs(n).toString().padStart(e,"0");return i+o}const bg={y(n,e){const i=n.getFullYear(),o=i>0?i:1-i;return ki(e==="yy"?o%100:o,e.length)},M(n,e){const i=n.getMonth();return e==="M"?String(i+1):ki(i+1,2)},d(n,e){return ki(n.getDate(),e.length)},a(n,e){const i=n.getHours()/12>=1?"pm":"am";switch(e){case"a":case"aa":return i.toUpperCase();case"aaa":return i;case"aaaaa":return i[0];case"aaaa":default:return i==="am"?"a.m.":"p.m."}},h(n,e){return ki(n.getHours()%12||12,e.length)},H(n,e){return ki(n.getHours(),e.length)},m(n,e){return ki(n.getMinutes(),e.length)},s(n,e){return ki(n.getSeconds(),e.length)},S(n,e){const i=e.length,o=n.getMilliseconds(),l=Math.trunc(o*Math.pow(10,i-3));return ki(l,e.length)}},$0={midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},FZ={G:function(n,e,i){const o=n.getFullYear()>0?1:0;switch(e){case"G":case"GG":case"GGG":return i.era(o,{width:"abbreviated"});case"GGGGG":return i.era(o,{width:"narrow"});case"GGGG":default:return i.era(o,{width:"wide"})}},y:function(n,e,i){if(e==="yo"){const o=n.getFullYear(),l=o>0?o:1-o;return i.ordinalNumber(l,{unit:"year"})}return bg.y(n,e)},Y:function(n,e,i,o){const l=fce(n,o),u=l>0?l:1-l;if(e==="YY"){const p=u%100;return ki(p,2)}return e==="Yo"?i.ordinalNumber(u,{unit:"year"}):ki(u,e.length)},R:function(n,e){const i=pce(n);return ki(i,e.length)},u:function(n,e){const i=n.getFullYear();return ki(i,e.length)},Q:function(n,e,i){const o=Math.ceil((n.getMonth()+1)/3);switch(e){case"Q":return String(o);case"QQ":return ki(o,2);case"Qo":return i.ordinalNumber(o,{unit:"quarter"});case"QQQ":return i.quarter(o,{width:"abbreviated",context:"formatting"});case"QQQQQ":return i.quarter(o,{width:"narrow",context:"formatting"});case"QQQQ":default:return i.quarter(o,{width:"wide",context:"formatting"})}},q:function(n,e,i){const o=Math.ceil((n.getMonth()+1)/3);switch(e){case"q":return String(o);case"qq":return ki(o,2);case"qo":return i.ordinalNumber(o,{unit:"quarter"});case"qqq":return i.quarter(o,{width:"abbreviated",context:"standalone"});case"qqqqq":return i.quarter(o,{width:"narrow",context:"standalone"});case"qqqq":default:return i.quarter(o,{width:"wide",context:"standalone"})}},M:function(n,e,i){const o=n.getMonth();switch(e){case"M":case"MM":return bg.M(n,e);case"Mo":return i.ordinalNumber(o+1,{unit:"month"});case"MMM":return i.month(o,{width:"abbreviated",context:"formatting"});case"MMMMM":return i.month(o,{width:"narrow",context:"formatting"});case"MMMM":default:return i.month(o,{width:"wide",context:"formatting"})}},L:function(n,e,i){const o=n.getMonth();switch(e){case"L":return String(o+1);case"LL":return ki(o+1,2);case"Lo":return i.ordinalNumber(o+1,{unit:"month"});case"LLL":return i.month(o,{width:"abbreviated",context:"standalone"});case"LLLLL":return i.month(o,{width:"narrow",context:"standalone"});case"LLLL":default:return i.month(o,{width:"wide",context:"standalone"})}},w:function(n,e,i,o){const l=B7e(n,o);return e==="wo"?i.ordinalNumber(l,{unit:"week"}):ki(l,e.length)},I:function(n,e,i){const o=j7e(n);return e==="Io"?i.ordinalNumber(o,{unit:"week"}):ki(o,e.length)},d:function(n,e,i){return e==="do"?i.ordinalNumber(n.getDate(),{unit:"date"}):bg.d(n,e)},D:function(n,e,i){const o=V7e(n);return e==="Do"?i.ordinalNumber(o,{unit:"dayOfYear"}):ki(o,e.length)},E:function(n,e,i){const o=n.getDay();switch(e){case"E":case"EE":case"EEE":return i.day(o,{width:"abbreviated",context:"formatting"});case"EEEEE":return i.day(o,{width:"narrow",context:"formatting"});case"EEEEEE":return i.day(o,{width:"short",context:"formatting"});case"EEEE":default:return i.day(o,{width:"wide",context:"formatting"})}},e:function(n,e,i,o){const l=n.getDay(),u=(l-o.weekStartsOn+8)%7||7;switch(e){case"e":return String(u);case"ee":return ki(u,2);case"eo":return i.ordinalNumber(u,{unit:"day"});case"eee":return i.day(l,{width:"abbreviated",context:"formatting"});case"eeeee":return i.day(l,{width:"narrow",context:"formatting"});case"eeeeee":return i.day(l,{width:"short",context:"formatting"});case"eeee":default:return i.day(l,{width:"wide",context:"formatting"})}},c:function(n,e,i,o){const l=n.getDay(),u=(l-o.weekStartsOn+8)%7||7;switch(e){case"c":return String(u);case"cc":return ki(u,e.length);case"co":return i.ordinalNumber(u,{unit:"day"});case"ccc":return i.day(l,{width:"abbreviated",context:"standalone"});case"ccccc":return i.day(l,{width:"narrow",context:"standalone"});case"cccccc":return i.day(l,{width:"short",context:"standalone"});case"cccc":default:return i.day(l,{width:"wide",context:"standalone"})}},i:function(n,e,i){const o=n.getDay(),l=o===0?7:o;switch(e){case"i":return String(l);case"ii":return ki(l,e.length);case"io":return i.ordinalNumber(l,{unit:"day"});case"iii":return i.day(o,{width:"abbreviated",context:"formatting"});case"iiiii":return i.day(o,{width:"narrow",context:"formatting"});case"iiiiii":return i.day(o,{width:"short",context:"formatting"});case"iiii":default:return i.day(o,{width:"wide",context:"formatting"})}},a:function(n,e,i){const l=n.getHours()/12>=1?"pm":"am";switch(e){case"a":case"aa":return i.dayPeriod(l,{width:"abbreviated",context:"formatting"});case"aaa":return i.dayPeriod(l,{width:"abbreviated",context:"formatting"}).toLowerCase();case"aaaaa":return i.dayPeriod(l,{width:"narrow",context:"formatting"});case"aaaa":default:return i.dayPeriod(l,{width:"wide",context:"formatting"})}},b:function(n,e,i){const o=n.getHours();let l;switch(o===12?l=$0.noon:o===0?l=$0.midnight:l=o/12>=1?"pm":"am",e){case"b":case"bb":return i.dayPeriod(l,{width:"abbreviated",context:"formatting"});case"bbb":return i.dayPeriod(l,{width:"abbreviated",context:"formatting"}).toLowerCase();case"bbbbb":return i.dayPeriod(l,{width:"narrow",context:"formatting"});case"bbbb":default:return i.dayPeriod(l,{width:"wide",context:"formatting"})}},B:function(n,e,i){const o=n.getHours();let l;switch(o>=17?l=$0.evening:o>=12?l=$0.afternoon:o>=4?l=$0.morning:l=$0.night,e){case"B":case"BB":case"BBB":return i.dayPeriod(l,{width:"abbreviated",context:"formatting"});case"BBBBB":return i.dayPeriod(l,{width:"narrow",context:"formatting"});case"BBBB":default:return i.dayPeriod(l,{width:"wide",context:"formatting"})}},h:function(n,e,i){if(e==="ho"){let o=n.getHours()%12;return o===0&&(o=12),i.ordinalNumber(o,{unit:"hour"})}return bg.h(n,e)},H:function(n,e,i){return e==="Ho"?i.ordinalNumber(n.getHours(),{unit:"hour"}):bg.H(n,e)},K:function(n,e,i){const o=n.getHours()%12;return e==="Ko"?i.ordinalNumber(o,{unit:"hour"}):ki(o,e.length)},k:function(n,e,i){let o=n.getHours();return o===0&&(o=24),e==="ko"?i.ordinalNumber(o,{unit:"hour"}):ki(o,e.length)},m:function(n,e,i){return e==="mo"?i.ordinalNumber(n.getMinutes(),{unit:"minute"}):bg.m(n,e)},s:function(n,e,i){return e==="so"?i.ordinalNumber(n.getSeconds(),{unit:"second"}):bg.s(n,e)},S:function(n,e){return bg.S(n,e)},X:function(n,e,i){const o=n.getTimezoneOffset();if(o===0)return"Z";switch(e){case"X":return zZ(o);case"XXXX":case"XX":return Dy(o);case"XXXXX":case"XXX":default:return Dy(o,":")}},x:function(n,e,i){const o=n.getTimezoneOffset();switch(e){case"x":return zZ(o);case"xxxx":case"xx":return Dy(o);case"xxxxx":case"xxx":default:return Dy(o,":")}},O:function(n,e,i){const o=n.getTimezoneOffset();switch(e){case"O":case"OO":case"OOO":return"GMT"+BZ(o,":");case"OOOO":default:return"GMT"+Dy(o,":")}},z:function(n,e,i){const o=n.getTimezoneOffset();switch(e){case"z":case"zz":case"zzz":return"GMT"+BZ(o,":");case"zzzz":default:return"GMT"+Dy(o,":")}},t:function(n,e,i){const o=Math.trunc(n.getTime()/1e3);return ki(o,e.length)},T:function(n,e,i){const o=n.getTime();return ki(o,e.length)}};function BZ(n,e=""){const i=n>0?"-":"+",o=Math.abs(n),l=Math.trunc(o/60),u=o%60;return u===0?i+String(l):i+String(l)+e+ki(u,2)}function zZ(n,e){return n%60===0?(n>0?"-":"+")+ki(Math.abs(n)/60,2):Dy(n,e)}function Dy(n,e=""){const i=n>0?"-":"+",o=Math.abs(n),l=ki(Math.trunc(o/60),2),u=ki(o%60,2);return i+l+e+u}const WZ=(n,e)=>{switch(n){case"P":return e.date({width:"short"});case"PP":return e.date({width:"medium"});case"PPP":return e.date({width:"long"});case"PPPP":default:return e.date({width:"full"})}},mce=(n,e)=>{switch(n){case"p":return e.time({width:"short"});case"pp":return e.time({width:"medium"});case"ppp":return e.time({width:"long"});case"pppp":default:return e.time({width:"full"})}},z7e=(n,e)=>{const i=n.match(/(P+)(p+)?/)||[],o=i[1],l=i[2];if(!l)return WZ(n,e);let u;switch(o){case"P":u=e.dateTime({width:"short"});break;case"PP":u=e.dateTime({width:"medium"});break;case"PPP":u=e.dateTime({width:"long"});break;case"PPPP":default:u=e.dateTime({width:"full"});break}return u.replace("{{date}}",WZ(o,e)).replace("{{time}}",mce(l,e))},W7e={p:mce,P:z7e},G7e=/^D+$/,H7e=/^Y+$/,$7e=["D","DD","YY","YYYY"];function K7e(n){return G7e.test(n)}function q7e(n){return H7e.test(n)}function Y7e(n,e,i){const o=X7e(n,e,i);if(console.warn(o),$7e.includes(n))throw new RangeError(o)}function X7e(n,e,i){const o=n[0]==="Y"?"years":"days of the month";return`Use \`${n.toLowerCase()}\` instead of \`${n}\` (in \`${e}\`) for formatting ${o} to the input \`${i}\`; see: https://github.com/date-fns/date-fns/blob/master/docs/unicodeTokens.md`}const J7e=/[yYQqMLwIdDecihHKkms]o|(\w)\1*|''|'(''|[^'])+('|$)|./g,Q7e=/P+p+|P+|p+|''|'(''|[^'])+('|$)|./g,Z7e=/^'([^]*?)'?$/,eHe=/''/g,tHe=/[a-zA-Z]/;function nHe(n,e,i){var T,R,O,L;const o=gx(),l=o.locale??U7e,u=o.firstWeekContainsDate??((R=(T=o.locale)==null?void 0:T.options)==null?void 0:R.firstWeekContainsDate)??1,p=o.weekStartsOn??((L=(O=o.locale)==null?void 0:O.options)==null?void 0:L.weekStartsOn)??0,y=Rh(n);if(!r7e(y))throw new RangeError("Invalid time value");let E=e.match(Q7e).map(D=>{const U=D[0];if(U==="p"||U==="P"){const F=W7e[U];return F(D,l.formatLong)}return D}).join("").match(J7e).map(D=>{if(D==="''")return{isToken:!1,value:"'"};const U=D[0];if(U==="'")return{isToken:!1,value:rHe(D)};if(FZ[U])return{isToken:!0,value:D};if(U.match(tHe))throw new RangeError("Format string contains an unescaped latin alphabet character `"+U+"`");return{isToken:!1,value:D}});l.localize.preprocessor&&(E=l.localize.preprocessor(y,E));const b={firstWeekContainsDate:u,weekStartsOn:p,locale:l};return E.map(D=>{if(!D.isToken)return D.value;const U=D.value;(q7e(U)||K7e(U))&&Y7e(U,e,String(n));const F=FZ[U[0]];return F(y,U,l.localize,b)}).join("")}function rHe(n){const e=n.match(Z7e);return e?e[1].replace(eHe,"'"):n}const iHe=wh(He),gce=({name:n,timestamp:e,text:i,isCurrentUser:o})=>{const l=e&&e.toDate?nHe(e.toDate(),"HH:mm"):"Invalid date";return S.jsxs(iHe,{display:"flex",flexDirection:"column",alignItems:o?"flex-end":"flex-start",initial:{opacity:0},animate:{opacity:1},transition:{duration:.5},children:[S.jsxs(He,{w:"auto",maxW:"80%",bg:o?"secondary.500":"primary.200",color:o?"white":"black",p:"10px",borderRadius:"10px",alignSelf:o?"flex-end":"flex-start",wordBreak:"break-word",children:[S.jsx($e,{fontWeight:"bold",children:n}),S.jsx($e,{children:i})]}),S.jsx($e,{color:"copy.light",fontSize:"xs",mt:"4px",mx:"6px",mb:"10px",textAlign:o?"right":"left",children:l})]})};gce.propTypes={name:An.string.isRequired,timestamp:An.object,text:An.string.isRequired,isCurrentUser:An.bool.isRequired};const sHe=({spaceID:n})=>{const[e,i]=k.useState([]),{user:o}=k.useContext(Di),l=k.useRef(null);return k.useEffect(()=>{const u=FGe(n,p=>{i(y=>[...y,...p]),G.log("Messages updated:",p)});return()=>u()},[n]),k.useEffect(()=>{l.current&&l.current.scrollIntoView({behavior:"smooth"})},[e]),S.jsxs(He,{className:"messages-container",display:"flex",flexDirection:"column",my:"10px",overflowY:"auto",maxHeight:"80vh",children:[e.map(u=>{const p=u.uid===(o==null?void 0:o.uid);return S.jsx(gce,{name:u.user,timestamp:u.timestamp,text:u.text,isCurrentUser:p},u.id)}),S.jsx("div",{ref:l})]})},oHe=({spaceID:n})=>{},aHe=({spaceID:n})=>{const{user:e}=k.useContext(Di);return e?S.jsxs(He,{children:[S.jsx(He,{height:"400px",overflowY:"auto",border:"1px solid #ccc",backgroundColor:"tertiaryAlpha.600",padding:"10px",children:S.jsx(sHe,{spaceID:n})}),S.jsx(He,{mt:"8px",children:S.jsx(oHe,{spaceID:n})})]}):S.jsx(He,{children:S.jsx($e,{children:"Please log in to view the chat."})})};class cHe extends k.Component{constructor(e){super(e),this.state={hasError:!1}}static getDerivedStateFromError(e){return{hasError:!0}}componentDidCatch(e,i){console.error("WebGL Error:",e,i)}render(){return this.state.hasError?S.jsx(He,{p:4,bg:"red.100",color:"red.900",borderRadius:"md",children:S.jsx($e,{children:"WebGL component error. Please refresh the page."})}):this.props.children}}const RO=document.getElementById("root");if(RO){const n=RO.getAttribute("data-space-id"),e=RO.getAttribute("data-theme")||"default",i=()=>{const[o,l]=k.useState(null);return k.useEffect(()=>{fJ(e).then(l);const u=()=>{document.hidden||fJ(e).then(l)};return document.addEventListener("visibilitychange",u),()=>{document.removeEventListener("visibilitychange",u)}},[]),o?S.jsx(_xe,{theme:o,children:S.jsx(Vze,{children:S.jsx(jze,{children:S.jsxs(Qn,{spacing:4,align:"stretch",children:[S.jsxs(Mr,{justify:"space-between",align:"center",p:4,bg:"gray.700",m:0,position:"relative",zIndex:"100",children:[S.jsx($e,{fontSize:"xl",fontWeight:"bold",color:"white",children:"LOGO"}),S.jsx(He,{zIndex:"100",position:"relative",children:S.jsx(k9e,{})})]}),S.jsx(a5,{maxW:"container.xl",p:0,zIndex:"1",children:S.jsx(Yne,{ratio:16/9,bg:"blue.100",m:0,children:S.jsx(He,{id:"webgl-root","data-space-id":n,w:"100%",m:0,children:S.jsx(cHe,{children:S.jsx(dce,{spaceID:n})})})})}),S.jsx(a5,{maxW:"container.xl",p:0,children:S.jsx(aHe,{spaceID:n})})]})})})}):S.jsx("div",{children:"Loading theme..."})};rve.createRoot(RO).render(S.jsx(i,{}))}else console.error("Root element 'root' not found.");export{yve as a,GSe as b,ts as c,BSe as d,uHe as e,lHe as f,xSe as g,pd as i,Op as m,zIe as t};
