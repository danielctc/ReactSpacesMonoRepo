function VEe(n,e){for(var i=0;i<e.length;i++){const o=e[i];if(typeof o!="string"&&!Array.isArray(o)){for(const l in o)if(l!=="default"&&!(l in n)){const u=Object.getOwnPropertyDescriptor(o,l);u&&Object.defineProperty(n,l,u.get?u:{enumerable:!0,get:()=>o[l]})}}}return Object.freeze(Object.defineProperty(n,Symbol.toStringTag,{value:"Module"}))}var Ny=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function $g(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}var BM={exports:{}},FT={},zM={exports:{}},Mr={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var QK;function FEe(){if(QK)return Mr;QK=1;var n=Symbol.for("react.element"),e=Symbol.for("react.portal"),i=Symbol.for("react.fragment"),o=Symbol.for("react.strict_mode"),l=Symbol.for("react.profiler"),u=Symbol.for("react.provider"),p=Symbol.for("react.context"),y=Symbol.for("react.forward_ref"),v=Symbol.for("react.suspense"),w=Symbol.for("react.memo"),C=Symbol.for("react.lazy"),R=Symbol.iterator;function N(ve){return ve===null||typeof ve!="object"?null:(ve=R&&ve[R]||ve["@@iterator"],typeof ve=="function"?ve:null)}var M={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},L=Object.assign,U={};function z(ve,xe,Ge){this.props=ve,this.context=xe,this.refs=U,this.updater=Ge||M}z.prototype.isReactComponent={},z.prototype.setState=function(ve,xe){if(typeof ve!="object"&&typeof ve!="function"&&ve!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,ve,xe,"setState")},z.prototype.forceUpdate=function(ve){this.updater.enqueueForceUpdate(this,ve,"forceUpdate")};function J(){}J.prototype=z.prototype;function q(ve,xe,Ge){this.props=ve,this.context=xe,this.refs=U,this.updater=Ge||M}var re=q.prototype=new J;re.constructor=q,L(re,z.prototype),re.isPureReactComponent=!0;var ce=Array.isArray,ae=Object.prototype.hasOwnProperty,pe={current:null},H={key:!0,ref:!0,__self:!0,__source:!0};function X(ve,xe,Ge){var Ze,lt={},vt=null,nt=null;if(xe!=null)for(Ze in xe.ref!==void 0&&(nt=xe.ref),xe.key!==void 0&&(vt=""+xe.key),xe)ae.call(xe,Ze)&&!H.hasOwnProperty(Ze)&&(lt[Ze]=xe[Ze]);var mt=arguments.length-2;if(mt===1)lt.children=Ge;else if(1<mt){for(var et=Array(mt),St=0;St<mt;St++)et[St]=arguments[St+2];lt.children=et}if(ve&&ve.defaultProps)for(Ze in mt=ve.defaultProps,mt)lt[Ze]===void 0&&(lt[Ze]=mt[Ze]);return{$$typeof:n,type:ve,key:vt,ref:nt,props:lt,_owner:pe.current}}function Q(ve,xe){return{$$typeof:n,type:ve.type,key:xe,ref:ve.ref,props:ve.props,_owner:ve._owner}}function ne(ve){return typeof ve=="object"&&ve!==null&&ve.$$typeof===n}function he(ve){var xe={"=":"=0",":":"=2"};return"$"+ve.replace(/[=:]/g,function(Ge){return xe[Ge]})}var fe=/\/+/g;function de(ve,xe){return typeof ve=="object"&&ve!==null&&ve.key!=null?he(""+ve.key):xe.toString(36)}function ke(ve,xe,Ge,Ze,lt){var vt=typeof ve;(vt==="undefined"||vt==="boolean")&&(ve=null);var nt=!1;if(ve===null)nt=!0;else switch(vt){case"string":case"number":nt=!0;break;case"object":switch(ve.$$typeof){case n:case e:nt=!0}}if(nt)return nt=ve,lt=lt(nt),ve=Ze===""?"."+de(nt,0):Ze,ce(lt)?(Ge="",ve!=null&&(Ge=ve.replace(fe,"$&/")+"/"),ke(lt,xe,Ge,"",function(St){return St})):lt!=null&&(ne(lt)&&(lt=Q(lt,Ge+(!lt.key||nt&&nt.key===lt.key?"":(""+lt.key).replace(fe,"$&/")+"/")+ve)),xe.push(lt)),1;if(nt=0,Ze=Ze===""?".":Ze+":",ce(ve))for(var mt=0;mt<ve.length;mt++){vt=ve[mt];var et=Ze+de(vt,mt);nt+=ke(vt,xe,Ge,et,lt)}else if(et=N(ve),typeof et=="function")for(ve=et.call(ve),mt=0;!(vt=ve.next()).done;)vt=vt.value,et=Ze+de(vt,mt++),nt+=ke(vt,xe,Ge,et,lt);else if(vt==="object")throw xe=String(ve),Error("Objects are not valid as a React child (found: "+(xe==="[object Object]"?"object with keys {"+Object.keys(ve).join(", ")+"}":xe)+"). If you meant to render a collection of children, use an array instead.");return nt}function De(ve,xe,Ge){if(ve==null)return ve;var Ze=[],lt=0;return ke(ve,Ze,"","",function(vt){return xe.call(Ge,vt,lt++)}),Ze}function je(ve){if(ve._status===-1){var xe=ve._result;xe=xe(),xe.then(function(Ge){(ve._status===0||ve._status===-1)&&(ve._status=1,ve._result=Ge)},function(Ge){(ve._status===0||ve._status===-1)&&(ve._status=2,ve._result=Ge)}),ve._status===-1&&(ve._status=0,ve._result=xe)}if(ve._status===1)return ve._result.default;throw ve._result}var Te={current:null},we={transition:null},Ie={ReactCurrentDispatcher:Te,ReactCurrentBatchConfig:we,ReactCurrentOwner:pe};function Oe(){throw Error("act(...) is not supported in production builds of React.")}return Mr.Children={map:De,forEach:function(ve,xe,Ge){De(ve,function(){xe.apply(this,arguments)},Ge)},count:function(ve){var xe=0;return De(ve,function(){xe++}),xe},toArray:function(ve){return De(ve,function(xe){return xe})||[]},only:function(ve){if(!ne(ve))throw Error("React.Children.only expected to receive a single React element child.");return ve}},Mr.Component=z,Mr.Fragment=i,Mr.Profiler=l,Mr.PureComponent=q,Mr.StrictMode=o,Mr.Suspense=v,Mr.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=Ie,Mr.act=Oe,Mr.cloneElement=function(ve,xe,Ge){if(ve==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+ve+".");var Ze=L({},ve.props),lt=ve.key,vt=ve.ref,nt=ve._owner;if(xe!=null){if(xe.ref!==void 0&&(vt=xe.ref,nt=pe.current),xe.key!==void 0&&(lt=""+xe.key),ve.type&&ve.type.defaultProps)var mt=ve.type.defaultProps;for(et in xe)ae.call(xe,et)&&!H.hasOwnProperty(et)&&(Ze[et]=xe[et]===void 0&&mt!==void 0?mt[et]:xe[et])}var et=arguments.length-2;if(et===1)Ze.children=Ge;else if(1<et){mt=Array(et);for(var St=0;St<et;St++)mt[St]=arguments[St+2];Ze.children=mt}return{$$typeof:n,type:ve.type,key:lt,ref:vt,props:Ze,_owner:nt}},Mr.createContext=function(ve){return ve={$$typeof:p,_currentValue:ve,_currentValue2:ve,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},ve.Provider={$$typeof:u,_context:ve},ve.Consumer=ve},Mr.createElement=X,Mr.createFactory=function(ve){var xe=X.bind(null,ve);return xe.type=ve,xe},Mr.createRef=function(){return{current:null}},Mr.forwardRef=function(ve){return{$$typeof:y,render:ve}},Mr.isValidElement=ne,Mr.lazy=function(ve){return{$$typeof:C,_payload:{_status:-1,_result:ve},_init:je}},Mr.memo=function(ve,xe){return{$$typeof:w,type:ve,compare:xe===void 0?null:xe}},Mr.startTransition=function(ve){var xe=we.transition;we.transition={};try{ve()}finally{we.transition=xe}},Mr.unstable_act=Oe,Mr.useCallback=function(ve,xe){return Te.current.useCallback(ve,xe)},Mr.useContext=function(ve){return Te.current.useContext(ve)},Mr.useDebugValue=function(){},Mr.useDeferredValue=function(ve){return Te.current.useDeferredValue(ve)},Mr.useEffect=function(ve,xe){return Te.current.useEffect(ve,xe)},Mr.useId=function(){return Te.current.useId()},Mr.useImperativeHandle=function(ve,xe,Ge){return Te.current.useImperativeHandle(ve,xe,Ge)},Mr.useInsertionEffect=function(ve,xe){return Te.current.useInsertionEffect(ve,xe)},Mr.useLayoutEffect=function(ve,xe){return Te.current.useLayoutEffect(ve,xe)},Mr.useMemo=function(ve,xe){return Te.current.useMemo(ve,xe)},Mr.useReducer=function(ve,xe,Ge){return Te.current.useReducer(ve,xe,Ge)},Mr.useRef=function(ve){return Te.current.useRef(ve)},Mr.useState=function(ve){return Te.current.useState(ve)},Mr.useSyncExternalStore=function(ve,xe,Ge){return Te.current.useSyncExternalStore(ve,xe,Ge)},Mr.useTransition=function(){return Te.current.useTransition()},Mr.version="18.3.1",Mr}var ZK;function Jf(){return ZK||(ZK=1,zM.exports=FEe()),zM.exports}/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var eq;function jEe(){if(eq)return FT;eq=1;var n=Jf(),e=Symbol.for("react.element"),i=Symbol.for("react.fragment"),o=Object.prototype.hasOwnProperty,l=n.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,u={key:!0,ref:!0,__self:!0,__source:!0};function p(y,v,w){var C,R={},N=null,M=null;w!==void 0&&(N=""+w),v.key!==void 0&&(N=""+v.key),v.ref!==void 0&&(M=v.ref);for(C in v)o.call(v,C)&&!u.hasOwnProperty(C)&&(R[C]=v[C]);if(y&&y.defaultProps)for(C in v=y.defaultProps,v)R[C]===void 0&&(R[C]=v[C]);return{$$typeof:e,type:y,key:N,ref:M,props:R,_owner:l.current}}return FT.Fragment=i,FT.jsx=p,FT.jsxs=p,FT}var tq;function BEe(){return tq||(tq=1,BM.exports=jEe()),BM.exports}var S=BEe(),O=Jf();const bi=$g(O),nq=VEe({__proto__:null,default:bi},[O]);var M1={},WM={exports:{}},ol={},GM={exports:{}},HM={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var rq;function zEe(){return rq||(rq=1,function(n){function e(we,Ie){var Oe=we.length;we.push(Ie);e:for(;0<Oe;){var ve=Oe-1>>>1,xe=we[ve];if(0<l(xe,Ie))we[ve]=Ie,we[Oe]=xe,Oe=ve;else break e}}function i(we){return we.length===0?null:we[0]}function o(we){if(we.length===0)return null;var Ie=we[0],Oe=we.pop();if(Oe!==Ie){we[0]=Oe;e:for(var ve=0,xe=we.length,Ge=xe>>>1;ve<Ge;){var Ze=2*(ve+1)-1,lt=we[Ze],vt=Ze+1,nt=we[vt];if(0>l(lt,Oe))vt<xe&&0>l(nt,lt)?(we[ve]=nt,we[vt]=Oe,ve=vt):(we[ve]=lt,we[Ze]=Oe,ve=Ze);else if(vt<xe&&0>l(nt,Oe))we[ve]=nt,we[vt]=Oe,ve=vt;else break e}}return Ie}function l(we,Ie){var Oe=we.sortIndex-Ie.sortIndex;return Oe!==0?Oe:we.id-Ie.id}if(typeof performance=="object"&&typeof performance.now=="function"){var u=performance;n.unstable_now=function(){return u.now()}}else{var p=Date,y=p.now();n.unstable_now=function(){return p.now()-y}}var v=[],w=[],C=1,R=null,N=3,M=!1,L=!1,U=!1,z=typeof setTimeout=="function"?setTimeout:null,J=typeof clearTimeout=="function"?clearTimeout:null,q=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function re(we){for(var Ie=i(w);Ie!==null;){if(Ie.callback===null)o(w);else if(Ie.startTime<=we)o(w),Ie.sortIndex=Ie.expirationTime,e(v,Ie);else break;Ie=i(w)}}function ce(we){if(U=!1,re(we),!L)if(i(v)!==null)L=!0,je(ae);else{var Ie=i(w);Ie!==null&&Te(ce,Ie.startTime-we)}}function ae(we,Ie){L=!1,U&&(U=!1,J(X),X=-1),M=!0;var Oe=N;try{for(re(Ie),R=i(v);R!==null&&(!(R.expirationTime>Ie)||we&&!he());){var ve=R.callback;if(typeof ve=="function"){R.callback=null,N=R.priorityLevel;var xe=ve(R.expirationTime<=Ie);Ie=n.unstable_now(),typeof xe=="function"?R.callback=xe:R===i(v)&&o(v),re(Ie)}else o(v);R=i(v)}if(R!==null)var Ge=!0;else{var Ze=i(w);Ze!==null&&Te(ce,Ze.startTime-Ie),Ge=!1}return Ge}finally{R=null,N=Oe,M=!1}}var pe=!1,H=null,X=-1,Q=5,ne=-1;function he(){return!(n.unstable_now()-ne<Q)}function fe(){if(H!==null){var we=n.unstable_now();ne=we;var Ie=!0;try{Ie=H(!0,we)}finally{Ie?de():(pe=!1,H=null)}}else pe=!1}var de;if(typeof q=="function")de=function(){q(fe)};else if(typeof MessageChannel<"u"){var ke=new MessageChannel,De=ke.port2;ke.port1.onmessage=fe,de=function(){De.postMessage(null)}}else de=function(){z(fe,0)};function je(we){H=we,pe||(pe=!0,de())}function Te(we,Ie){X=z(function(){we(n.unstable_now())},Ie)}n.unstable_IdlePriority=5,n.unstable_ImmediatePriority=1,n.unstable_LowPriority=4,n.unstable_NormalPriority=3,n.unstable_Profiling=null,n.unstable_UserBlockingPriority=2,n.unstable_cancelCallback=function(we){we.callback=null},n.unstable_continueExecution=function(){L||M||(L=!0,je(ae))},n.unstable_forceFrameRate=function(we){0>we||125<we?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):Q=0<we?Math.floor(1e3/we):5},n.unstable_getCurrentPriorityLevel=function(){return N},n.unstable_getFirstCallbackNode=function(){return i(v)},n.unstable_next=function(we){switch(N){case 1:case 2:case 3:var Ie=3;break;default:Ie=N}var Oe=N;N=Ie;try{return we()}finally{N=Oe}},n.unstable_pauseExecution=function(){},n.unstable_requestPaint=function(){},n.unstable_runWithPriority=function(we,Ie){switch(we){case 1:case 2:case 3:case 4:case 5:break;default:we=3}var Oe=N;N=we;try{return Ie()}finally{N=Oe}},n.unstable_scheduleCallback=function(we,Ie,Oe){var ve=n.unstable_now();switch(typeof Oe=="object"&&Oe!==null?(Oe=Oe.delay,Oe=typeof Oe=="number"&&0<Oe?ve+Oe:ve):Oe=ve,we){case 1:var xe=-1;break;case 2:xe=250;break;case 5:xe=1073741823;break;case 4:xe=1e4;break;default:xe=5e3}return xe=Oe+xe,we={id:C++,callback:Ie,priorityLevel:we,startTime:Oe,expirationTime:xe,sortIndex:-1},Oe>ve?(we.sortIndex=Oe,e(w,we),i(v)===null&&we===i(w)&&(U?(J(X),X=-1):U=!0,Te(ce,Oe-ve))):(we.sortIndex=xe,e(v,we),L||M||(L=!0,je(ae))),we},n.unstable_shouldYield=he,n.unstable_wrapCallback=function(we){var Ie=N;return function(){var Oe=N;N=Ie;try{return we.apply(this,arguments)}finally{N=Oe}}}}(HM)),HM}var iq;function WEe(){return iq||(iq=1,GM.exports=zEe()),GM.exports}/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var sq;function GEe(){if(sq)return ol;sq=1;var n=Jf(),e=WEe();function i(f){for(var _="https://reactjs.org/docs/error-decoder.html?invariant="+f,T=1;T<arguments.length;T++)_+="&args[]="+encodeURIComponent(arguments[T]);return"Minified React error #"+f+"; visit "+_+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var o=new Set,l={};function u(f,_){p(f,_),p(f+"Capture",_)}function p(f,_){for(l[f]=_,f=0;f<_.length;f++)o.add(_[f])}var y=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),v=Object.prototype.hasOwnProperty,w=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,C={},R={};function N(f){return v.call(R,f)?!0:v.call(C,f)?!1:w.test(f)?R[f]=!0:(C[f]=!0,!1)}function M(f,_,T,D){if(T!==null&&T.type===0)return!1;switch(typeof _){case"function":case"symbol":return!0;case"boolean":return D?!1:T!==null?!T.acceptsBooleans:(f=f.toLowerCase().slice(0,5),f!=="data-"&&f!=="aria-");default:return!1}}function L(f,_,T,D){if(_===null||typeof _>"u"||M(f,_,T,D))return!0;if(D)return!1;if(T!==null)switch(T.type){case 3:return!_;case 4:return _===!1;case 5:return isNaN(_);case 6:return isNaN(_)||1>_}return!1}function U(f,_,T,D,F,$,me){this.acceptsBooleans=_===2||_===3||_===4,this.attributeName=D,this.attributeNamespace=F,this.mustUseProperty=T,this.propertyName=f,this.type=_,this.sanitizeURL=$,this.removeEmptyString=me}var z={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(f){z[f]=new U(f,0,!1,f,null,!1,!1)}),[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(f){var _=f[0];z[_]=new U(_,1,!1,f[1],null,!1,!1)}),["contentEditable","draggable","spellCheck","value"].forEach(function(f){z[f]=new U(f,2,!1,f.toLowerCase(),null,!1,!1)}),["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(f){z[f]=new U(f,2,!1,f,null,!1,!1)}),"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(f){z[f]=new U(f,3,!1,f.toLowerCase(),null,!1,!1)}),["checked","multiple","muted","selected"].forEach(function(f){z[f]=new U(f,3,!0,f,null,!1,!1)}),["capture","download"].forEach(function(f){z[f]=new U(f,4,!1,f,null,!1,!1)}),["cols","rows","size","span"].forEach(function(f){z[f]=new U(f,6,!1,f,null,!1,!1)}),["rowSpan","start"].forEach(function(f){z[f]=new U(f,5,!1,f.toLowerCase(),null,!1,!1)});var J=/[\-:]([a-z])/g;function q(f){return f[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(f){var _=f.replace(J,q);z[_]=new U(_,1,!1,f,null,!1,!1)}),"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(f){var _=f.replace(J,q);z[_]=new U(_,1,!1,f,"http://www.w3.org/1999/xlink",!1,!1)}),["xml:base","xml:lang","xml:space"].forEach(function(f){var _=f.replace(J,q);z[_]=new U(_,1,!1,f,"http://www.w3.org/XML/1998/namespace",!1,!1)}),["tabIndex","crossOrigin"].forEach(function(f){z[f]=new U(f,1,!1,f.toLowerCase(),null,!1,!1)}),z.xlinkHref=new U("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1),["src","href","action","formAction"].forEach(function(f){z[f]=new U(f,1,!1,f.toLowerCase(),null,!0,!0)});function re(f,_,T,D){var F=z.hasOwnProperty(_)?z[_]:null;(F!==null?F.type!==0:D||!(2<_.length)||_[0]!=="o"&&_[0]!=="O"||_[1]!=="n"&&_[1]!=="N")&&(L(_,T,F,D)&&(T=null),D||F===null?N(_)&&(T===null?f.removeAttribute(_):f.setAttribute(_,""+T)):F.mustUseProperty?f[F.propertyName]=T===null?F.type===3?!1:"":T:(_=F.attributeName,D=F.attributeNamespace,T===null?f.removeAttribute(_):(F=F.type,T=F===3||F===4&&T===!0?"":""+T,D?f.setAttributeNS(D,_,T):f.setAttribute(_,T))))}var ce=n.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,ae=Symbol.for("react.element"),pe=Symbol.for("react.portal"),H=Symbol.for("react.fragment"),X=Symbol.for("react.strict_mode"),Q=Symbol.for("react.profiler"),ne=Symbol.for("react.provider"),he=Symbol.for("react.context"),fe=Symbol.for("react.forward_ref"),de=Symbol.for("react.suspense"),ke=Symbol.for("react.suspense_list"),De=Symbol.for("react.memo"),je=Symbol.for("react.lazy"),Te=Symbol.for("react.offscreen"),we=Symbol.iterator;function Ie(f){return f===null||typeof f!="object"?null:(f=we&&f[we]||f["@@iterator"],typeof f=="function"?f:null)}var Oe=Object.assign,ve;function xe(f){if(ve===void 0)try{throw Error()}catch(T){var _=T.stack.trim().match(/\n( *(at )?)/);ve=_&&_[1]||""}return`
`+ve+f}var Ge=!1;function Ze(f,_){if(!f||Ge)return"";Ge=!0;var T=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(_)if(_=function(){throw Error()},Object.defineProperty(_.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(_,[])}catch(at){var D=at}Reflect.construct(f,[],_)}else{try{_.call()}catch(at){D=at}f.call(_.prototype)}else{try{throw Error()}catch(at){D=at}f()}}catch(at){if(at&&D&&typeof at.stack=="string"){for(var F=at.stack.split(`
`),$=D.stack.split(`
`),me=F.length-1,Ae=$.length-1;1<=me&&0<=Ae&&F[me]!==$[Ae];)Ae--;for(;1<=me&&0<=Ae;me--,Ae--)if(F[me]!==$[Ae]){if(me!==1||Ae!==1)do if(me--,Ae--,0>Ae||F[me]!==$[Ae]){var Ve=`
`+F[me].replace(" at new "," at ");return f.displayName&&Ve.includes("<anonymous>")&&(Ve=Ve.replace("<anonymous>",f.displayName)),Ve}while(1<=me&&0<=Ae);break}}}finally{Ge=!1,Error.prepareStackTrace=T}return(f=f?f.displayName||f.name:"")?xe(f):""}function lt(f){switch(f.tag){case 5:return xe(f.type);case 16:return xe("Lazy");case 13:return xe("Suspense");case 19:return xe("SuspenseList");case 0:case 2:case 15:return f=Ze(f.type,!1),f;case 11:return f=Ze(f.type.render,!1),f;case 1:return f=Ze(f.type,!0),f;default:return""}}function vt(f){if(f==null)return null;if(typeof f=="function")return f.displayName||f.name||null;if(typeof f=="string")return f;switch(f){case H:return"Fragment";case pe:return"Portal";case Q:return"Profiler";case X:return"StrictMode";case de:return"Suspense";case ke:return"SuspenseList"}if(typeof f=="object")switch(f.$$typeof){case he:return(f.displayName||"Context")+".Consumer";case ne:return(f._context.displayName||"Context")+".Provider";case fe:var _=f.render;return f=f.displayName,f||(f=_.displayName||_.name||"",f=f!==""?"ForwardRef("+f+")":"ForwardRef"),f;case De:return _=f.displayName||null,_!==null?_:vt(f.type)||"Memo";case je:_=f._payload,f=f._init;try{return vt(f(_))}catch{}}return null}function nt(f){var _=f.type;switch(f.tag){case 24:return"Cache";case 9:return(_.displayName||"Context")+".Consumer";case 10:return(_._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return f=_.render,f=f.displayName||f.name||"",_.displayName||(f!==""?"ForwardRef("+f+")":"ForwardRef");case 7:return"Fragment";case 5:return _;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return vt(_);case 8:return _===X?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof _=="function")return _.displayName||_.name||null;if(typeof _=="string")return _}return null}function mt(f){switch(typeof f){case"boolean":case"number":case"string":case"undefined":return f;case"object":return f;default:return""}}function et(f){var _=f.type;return(f=f.nodeName)&&f.toLowerCase()==="input"&&(_==="checkbox"||_==="radio")}function St(f){var _=et(f)?"checked":"value",T=Object.getOwnPropertyDescriptor(f.constructor.prototype,_),D=""+f[_];if(!f.hasOwnProperty(_)&&typeof T<"u"&&typeof T.get=="function"&&typeof T.set=="function"){var F=T.get,$=T.set;return Object.defineProperty(f,_,{configurable:!0,get:function(){return F.call(this)},set:function(me){D=""+me,$.call(this,me)}}),Object.defineProperty(f,_,{enumerable:T.enumerable}),{getValue:function(){return D},setValue:function(me){D=""+me},stopTracking:function(){f._valueTracker=null,delete f[_]}}}}function un(f){f._valueTracker||(f._valueTracker=St(f))}function ft(f){if(!f)return!1;var _=f._valueTracker;if(!_)return!0;var T=_.getValue(),D="";return f&&(D=et(f)?f.checked?"true":"false":f.value),f=D,f!==T?(_.setValue(f),!0):!1}function Ct(f){if(f=f||(typeof document<"u"?document:void 0),typeof f>"u")return null;try{return f.activeElement||f.body}catch{return f.body}}function ut(f,_){var T=_.checked;return Oe({},_,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:T??f._wrapperState.initialChecked})}function Ft(f,_){var T=_.defaultValue==null?"":_.defaultValue,D=_.checked!=null?_.checked:_.defaultChecked;T=mt(_.value!=null?_.value:T),f._wrapperState={initialChecked:D,initialValue:T,controlled:_.type==="checkbox"||_.type==="radio"?_.checked!=null:_.value!=null}}function on(f,_){_=_.checked,_!=null&&re(f,"checked",_,!1)}function Ht(f,_){on(f,_);var T=mt(_.value),D=_.type;if(T!=null)D==="number"?(T===0&&f.value===""||f.value!=T)&&(f.value=""+T):f.value!==""+T&&(f.value=""+T);else if(D==="submit"||D==="reset"){f.removeAttribute("value");return}_.hasOwnProperty("value")?Ne(f,_.type,T):_.hasOwnProperty("defaultValue")&&Ne(f,_.type,mt(_.defaultValue)),_.checked==null&&_.defaultChecked!=null&&(f.defaultChecked=!!_.defaultChecked)}function Se(f,_,T){if(_.hasOwnProperty("value")||_.hasOwnProperty("defaultValue")){var D=_.type;if(!(D!=="submit"&&D!=="reset"||_.value!==void 0&&_.value!==null))return;_=""+f._wrapperState.initialValue,T||_===f.value||(f.value=_),f.defaultValue=_}T=f.name,T!==""&&(f.name=""),f.defaultChecked=!!f._wrapperState.initialChecked,T!==""&&(f.name=T)}function Ne(f,_,T){(_!=="number"||Ct(f.ownerDocument)!==f)&&(T==null?f.defaultValue=""+f._wrapperState.initialValue:f.defaultValue!==""+T&&(f.defaultValue=""+T))}var $e=Array.isArray;function Pt(f,_,T,D){if(f=f.options,_){_={};for(var F=0;F<T.length;F++)_["$"+T[F]]=!0;for(T=0;T<f.length;T++)F=_.hasOwnProperty("$"+f[T].value),f[T].selected!==F&&(f[T].selected=F),F&&D&&(f[T].defaultSelected=!0)}else{for(T=""+mt(T),_=null,F=0;F<f.length;F++){if(f[F].value===T){f[F].selected=!0,D&&(f[F].defaultSelected=!0);return}_!==null||f[F].disabled||(_=f[F])}_!==null&&(_.selected=!0)}}function Ot(f,_){if(_.dangerouslySetInnerHTML!=null)throw Error(i(91));return Oe({},_,{value:void 0,defaultValue:void 0,children:""+f._wrapperState.initialValue})}function Et(f,_){var T=_.value;if(T==null){if(T=_.children,_=_.defaultValue,T!=null){if(_!=null)throw Error(i(92));if($e(T)){if(1<T.length)throw Error(i(93));T=T[0]}_=T}_==null&&(_=""),T=_}f._wrapperState={initialValue:mt(T)}}function xt(f,_){var T=mt(_.value),D=mt(_.defaultValue);T!=null&&(T=""+T,T!==f.value&&(f.value=T),_.defaultValue==null&&f.defaultValue!==T&&(f.defaultValue=T)),D!=null&&(f.defaultValue=""+D)}function pn(f){var _=f.textContent;_===f._wrapperState.initialValue&&_!==""&&_!==null&&(f.value=_)}function Cn(f){switch(f){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function En(f,_){return f==null||f==="http://www.w3.org/1999/xhtml"?Cn(_):f==="http://www.w3.org/2000/svg"&&_==="foreignObject"?"http://www.w3.org/1999/xhtml":f}var It,cr=function(f){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(_,T,D,F){MSApp.execUnsafeLocalFunction(function(){return f(_,T,D,F)})}:f}(function(f,_){if(f.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in f)f.innerHTML=_;else{for(It=It||document.createElement("div"),It.innerHTML="<svg>"+_.valueOf().toString()+"</svg>",_=It.firstChild;f.firstChild;)f.removeChild(f.firstChild);for(;_.firstChild;)f.appendChild(_.firstChild)}});function Lt(f,_){if(_){var T=f.firstChild;if(T&&T===f.lastChild&&T.nodeType===3){T.nodeValue=_;return}}f.textContent=_}var Yt={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},Or=["Webkit","ms","Moz","O"];Object.keys(Yt).forEach(function(f){Or.forEach(function(_){_=_+f.charAt(0).toUpperCase()+f.substring(1),Yt[_]=Yt[f]})});function Oi(f,_,T){return _==null||typeof _=="boolean"||_===""?"":T||typeof _!="number"||_===0||Yt.hasOwnProperty(f)&&Yt[f]?(""+_).trim():_+"px"}function ji(f,_){f=f.style;for(var T in _)if(_.hasOwnProperty(T)){var D=T.indexOf("--")===0,F=Oi(T,_[T],D);T==="float"&&(T="cssFloat"),D?f.setProperty(T,F):f[T]=F}}var Fr=Oe({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function Xn(f,_){if(_){if(Fr[f]&&(_.children!=null||_.dangerouslySetInnerHTML!=null))throw Error(i(137,f));if(_.dangerouslySetInnerHTML!=null){if(_.children!=null)throw Error(i(60));if(typeof _.dangerouslySetInnerHTML!="object"||!("__html"in _.dangerouslySetInnerHTML))throw Error(i(61))}if(_.style!=null&&typeof _.style!="object")throw Error(i(62))}}function oa(f,_){if(f.indexOf("-")===-1)return typeof _.is=="string";switch(f){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var Ki=null;function xa(f){return f=f.target||f.srcElement||window,f.correspondingUseElement&&(f=f.correspondingUseElement),f.nodeType===3?f.parentNode:f}var Sl=null,Ps=null,La=null;function Wo(f){if(f=f_(f)){if(typeof Sl!="function")throw Error(i(280));var _=f.stateNode;_&&(_=OE(_),Sl(f.stateNode,f.type,_))}}function uo(f){Ps?La?La.push(f):La=[f]:Ps=f}function ud(){if(Ps){var f=Ps,_=La;if(La=Ps=null,Wo(f),_)for(f=0;f<_.length;f++)Wo(_[f])}}function Go(f,_){return f(_)}function dd(){}var uc=!1;function bo(f,_,T){if(uc)return f(_,T);uc=!0;try{return Go(f,_,T)}finally{uc=!1,(Ps!==null||La!==null)&&(dd(),ud())}}function Tr(f,_){var T=f.stateNode;if(T===null)return null;var D=OE(T);if(D===null)return null;T=D[_];e:switch(_){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(D=!D.disabled)||(f=f.type,D=!(f==="button"||f==="input"||f==="select"||f==="textarea")),f=!D;break e;default:f=!1}if(f)return null;if(T&&typeof T!="function")throw Error(i(231,_,typeof T));return T}var lu=!1;if(y)try{var aa={};Object.defineProperty(aa,"passive",{get:function(){lu=!0}}),window.addEventListener("test",aa,aa),window.removeEventListener("test",aa,aa)}catch{lu=!1}function Ma(f,_,T,D,F,$,me,Ae,Ve){var at=Array.prototype.slice.call(arguments,3);try{_.apply(T,at)}catch(Dt){this.onError(Dt)}}var xc=!1,Ho=null,gt=!1,_n=null,jr={onError:function(f){xc=!0,Ho=f}};function Ni(f,_,T,D,F,$,me,Ae,Ve){xc=!1,Ho=null,Ma.apply(jr,arguments)}function uu(f,_,T,D,F,$,me,Ae,Ve){if(Ni.apply(this,arguments),xc){if(xc){var at=Ho;xc=!1,Ho=null}else throw Error(i(198));gt||(gt=!0,_n=at)}}function es(f){var _=f,T=f;if(f.alternate)for(;_.return;)_=_.return;else{f=_;do _=f,(_.flags&4098)!==0&&(T=_.return),f=_.return;while(f)}return _.tag===3?T:null}function bl(f){if(f.tag===13){var _=f.memoizedState;if(_===null&&(f=f.alternate,f!==null&&(_=f.memoizedState)),_!==null)return _.dehydrated}return null}function $o(f){if(es(f)!==f)throw Error(i(188))}function hd(f){var _=f.alternate;if(!_){if(_=es(f),_===null)throw Error(i(188));return _!==f?null:f}for(var T=f,D=_;;){var F=T.return;if(F===null)break;var $=F.alternate;if($===null){if(D=F.return,D!==null){T=D;continue}break}if(F.child===$.child){for($=F.child;$;){if($===T)return $o(F),f;if($===D)return $o(F),_;$=$.sibling}throw Error(i(188))}if(T.return!==D.return)T=F,D=$;else{for(var me=!1,Ae=F.child;Ae;){if(Ae===T){me=!0,T=F,D=$;break}if(Ae===D){me=!0,D=F,T=$;break}Ae=Ae.sibling}if(!me){for(Ae=$.child;Ae;){if(Ae===T){me=!0,T=$,D=F;break}if(Ae===D){me=!0,D=$,T=F;break}Ae=Ae.sibling}if(!me)throw Error(i(189))}}if(T.alternate!==D)throw Error(i(190))}if(T.tag!==3)throw Error(i(188));return T.stateNode.current===T?f:_}function Lc(f){return f=hd(f),f!==null?wl(f):null}function wl(f){if(f.tag===5||f.tag===6)return f;for(f=f.child;f!==null;){var _=wl(f);if(_!==null)return _;f=f.sibling}return null}var ca=e.unstable_scheduleCallback,dc=e.unstable_cancelCallback,Ko=e.unstable_shouldYield,ei=e.unstable_requestPaint,In=e.unstable_now,em=e.unstable_getCurrentPriorityLevel,ti=e.unstable_ImmediatePriority,Tl=e.unstable_UserBlockingPriority,Ua=e.unstable_NormalPriority,Mp=e.unstable_LowPriority,tm=e.unstable_IdlePriority,Mc=null,la=null;function Up(f){if(la&&typeof la.onCommitFiberRoot=="function")try{la.onCommitFiberRoot(Mc,f,void 0,(f.current.flags&128)===128)}catch{}}var wo=Math.clz32?Math.clz32:Cl,Vp=Math.log,nm=Math.LN2;function Cl(f){return f>>>=0,f===0?32:31-(Vp(f)/nm|0)|0}var du=64,gh=4194304;function Nr(f){switch(f&-f){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return f&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return f&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return f}}function pd(f,_){var T=f.pendingLanes;if(T===0)return 0;var D=0,F=f.suspendedLanes,$=f.pingedLanes,me=T&268435455;if(me!==0){var Ae=me&~F;Ae!==0?D=Nr(Ae):($&=me,$!==0&&(D=Nr($)))}else me=T&~F,me!==0?D=Nr(me):$!==0&&(D=Nr($));if(D===0)return 0;if(_!==0&&_!==D&&(_&F)===0&&(F=D&-D,$=_&-_,F>=$||F===16&&($&4194240)!==0))return _;if((D&4)!==0&&(D|=T&16),_=f.entangledLanes,_!==0)for(f=f.entanglements,_&=D;0<_;)T=31-wo(_),F=1<<T,D|=f[T],_&=~F;return D}function fd(f,_){switch(f){case 1:case 2:case 4:return _+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return _+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function Va(f,_){for(var T=f.suspendedLanes,D=f.pingedLanes,F=f.expirationTimes,$=f.pendingLanes;0<$;){var me=31-wo($),Ae=1<<me,Ve=F[me];Ve===-1?((Ae&T)===0||(Ae&D)!==0)&&(F[me]=fd(Ae,_)):Ve<=_&&(f.expiredLanes|=Ae),$&=~Ae}}function ua(f){return f=f.pendingLanes&-1073741825,f!==0?f:f&1073741824?1073741824:0}function md(){var f=du;return du<<=1,(du&4194240)===0&&(du=64),f}function Rl(f){for(var _=[],T=0;31>T;T++)_.push(f);return _}function hu(f,_,T){f.pendingLanes|=_,_!==536870912&&(f.suspendedLanes=0,f.pingedLanes=0),f=f.eventTimes,_=31-wo(_),f[_]=T}function ui(f,_){var T=f.pendingLanes&~_;f.pendingLanes=_,f.suspendedLanes=0,f.pingedLanes=0,f.expiredLanes&=_,f.mutableReadLanes&=_,f.entangledLanes&=_,_=f.entanglements;var D=f.eventTimes;for(f=f.expirationTimes;0<T;){var F=31-wo(T),$=1<<F;_[F]=0,D[F]=-1,f[F]=-1,T&=~$}}function pu(f,_){var T=f.entangledLanes|=_;for(f=f.entanglements;T;){var D=31-wo(T),F=1<<D;F&_|f[D]&_&&(f[D]|=_),T&=~F}}var mr=0;function Il(f){return f&=-f,1<f?4<f?(f&268435455)!==0?16:536870912:4:1}var _h,yh,fu,rm,Fp,jp=!1,da=[],_s=null,ha=null,pa=null,mu=new Map,fa=new Map,Fa=[],Bp="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function Uc(f,_){switch(f){case"focusin":case"focusout":_s=null;break;case"dragenter":case"dragleave":ha=null;break;case"mouseover":case"mouseout":pa=null;break;case"pointerover":case"pointerout":mu.delete(_.pointerId);break;case"gotpointercapture":case"lostpointercapture":fa.delete(_.pointerId)}}function ks(f,_,T,D,F,$){return f===null||f.nativeEvent!==$?(f={blockedOn:_,domEventName:T,eventSystemFlags:D,nativeEvent:$,targetContainers:[F]},_!==null&&(_=f_(_),_!==null&&yh(_)),f):(f.eventSystemFlags|=D,_=f.targetContainers,F!==null&&_.indexOf(F)===-1&&_.push(F),f)}function Zg(f,_,T,D,F){switch(_){case"focusin":return _s=ks(_s,f,_,T,D,F),!0;case"dragenter":return ha=ks(ha,f,_,T,D,F),!0;case"mouseover":return pa=ks(pa,f,_,T,D,F),!0;case"pointerover":var $=F.pointerId;return mu.set($,ks(mu.get($)||null,f,_,T,D,F)),!0;case"gotpointercapture":return $=F.pointerId,fa.set($,ks(fa.get($)||null,f,_,T,D,F)),!0}return!1}function Al(f){var _=zp(f.target);if(_!==null){var T=es(_);if(T!==null){if(_=T.tag,_===13){if(_=bl(T),_!==null){f.blockedOn=_,Fp(f.priority,function(){fu(T)});return}}else if(_===3&&T.stateNode.current.memoizedState.isDehydrated){f.blockedOn=T.tag===3?T.stateNode.containerInfo:null;return}}}f.blockedOn=null}function Pl(f){if(f.blockedOn!==null)return!1;for(var _=f.targetContainers;0<_.length;){var T=Br(f.domEventName,f.eventSystemFlags,_[0],f.nativeEvent);if(T===null){T=f.nativeEvent;var D=new T.constructor(T.type,T);Ki=D,T.target.dispatchEvent(D),Ki=null}else return _=f_(T),_!==null&&yh(_),f.blockedOn=T,!1;_.shift()}return!0}function gu(f,_,T){Pl(f)&&T.delete(_)}function im(){jp=!1,_s!==null&&Pl(_s)&&(_s=null),ha!==null&&Pl(ha)&&(ha=null),pa!==null&&Pl(pa)&&(pa=null),mu.forEach(gu),fa.forEach(gu)}function hc(f,_){f.blockedOn===_&&(f.blockedOn=null,jp||(jp=!0,e.unstable_scheduleCallback(e.unstable_NormalPriority,im)))}function ma(f){function _(F){return hc(F,f)}if(0<da.length){hc(da[0],f);for(var T=1;T<da.length;T++){var D=da[T];D.blockedOn===f&&(D.blockedOn=null)}}for(_s!==null&&hc(_s,f),ha!==null&&hc(ha,f),pa!==null&&hc(pa,f),mu.forEach(_),fa.forEach(_),T=0;T<Fa.length;T++)D=Fa[T],D.blockedOn===f&&(D.blockedOn=null);for(;0<Fa.length&&(T=Fa[0],T.blockedOn===null);)Al(T),T.blockedOn===null&&Fa.shift()}var kl=ce.ReactCurrentBatchConfig,be=!0;function Me(f,_,T,D){var F=mr,$=kl.transition;kl.transition=null;try{mr=1,Kt(f,_,T,D)}finally{mr=F,kl.transition=$}}function ot(f,_,T,D){var F=mr,$=kl.transition;kl.transition=null;try{mr=4,Kt(f,_,T,D)}finally{mr=F,kl.transition=$}}function Kt(f,_,T,D){if(be){var F=Br(f,_,T,D);if(F===null)pb(f,_,D,sr,T),Uc(f,D);else if(Zg(F,f,_,T,D))D.stopPropagation();else if(Uc(f,D),_&4&&-1<Bp.indexOf(f)){for(;F!==null;){var $=f_(F);if($!==null&&_h($),$=Br(f,_,T,D),$===null&&pb(f,_,D,sr,T),$===F)break;F=$}F!==null&&D.stopPropagation()}else pb(f,_,D,null,T)}}var sr=null;function Br(f,_,T,D){if(sr=null,f=xa(D),f=zp(f),f!==null)if(_=es(f),_===null)f=null;else if(T=_.tag,T===13){if(f=bl(_),f!==null)return f;f=null}else if(T===3){if(_.stateNode.current.memoizedState.isDehydrated)return _.tag===3?_.stateNode.containerInfo:null;f=null}else _!==f&&(f=null);return sr=f,null}function si(f){switch(f){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(em()){case ti:return 1;case Tl:return 4;case Ua:case Mp:return 16;case tm:return 536870912;default:return 16}default:return 16}}var er=null,tr=null,Di=null;function Ws(){if(Di)return Di;var f,_=tr,T=_.length,D,F="value"in er?er.value:er.textContent,$=F.length;for(f=0;f<T&&_[f]===F[f];f++);var me=T-f;for(D=1;D<=me&&_[T-D]===F[$-D];D++);return Di=F.slice(f,1<D?1-D:void 0)}function Vc(f){var _=f.keyCode;return"charCode"in f?(f=f.charCode,f===0&&_===13&&(f=13)):f=_,f===10&&(f=13),32<=f||f===13?f:0}function To(){return!0}function _u(){return!1}function Os(f){function _(T,D,F,$,me){this._reactName=T,this._targetInst=F,this.type=D,this.nativeEvent=$,this.target=me,this.currentTarget=null;for(var Ae in f)f.hasOwnProperty(Ae)&&(T=f[Ae],this[Ae]=T?T($):$[Ae]);return this.isDefaultPrevented=($.defaultPrevented!=null?$.defaultPrevented:$.returnValue===!1)?To:_u,this.isPropagationStopped=_u,this}return Oe(_.prototype,{preventDefault:function(){this.defaultPrevented=!0;var T=this.nativeEvent;T&&(T.preventDefault?T.preventDefault():typeof T.returnValue!="unknown"&&(T.returnValue=!1),this.isDefaultPrevented=To)},stopPropagation:function(){var T=this.nativeEvent;T&&(T.stopPropagation?T.stopPropagation():typeof T.cancelBubble!="unknown"&&(T.cancelBubble=!0),this.isPropagationStopped=To)},persist:function(){},isPersistent:To}),_}var pc={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(f){return f.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},sm=Os(pc),Fc=Oe({},pc,{view:0,detail:0}),e_=Os(Fc),Eh,gd,vh,fc=Oe({},Fc,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:Eu,button:0,buttons:0,relatedTarget:function(f){return f.relatedTarget===void 0?f.fromElement===f.srcElement?f.toElement:f.fromElement:f.relatedTarget},movementX:function(f){return"movementX"in f?f.movementX:(f!==vh&&(vh&&f.type==="mousemove"?(Eh=f.screenX-vh.screenX,gd=f.screenY-vh.screenY):gd=Eh=0,vh=f),Eh)},movementY:function(f){return"movementY"in f?f.movementY:gd}}),yu=Os(fc),t_=Oe({},fc,{dataTransfer:0}),yE=Os(t_),om=Oe({},Fc,{relatedTarget:0}),am=Os(om),EE=Oe({},pc,{animationName:0,elapsedTime:0,pseudoElement:0}),ja=Os(EE),vE=Oe({},pc,{clipboardData:function(f){return"clipboardData"in f?f.clipboardData:window.clipboardData}}),_d=Os(vE),n_=Oe({},pc,{data:0}),r_=Os(n_),Gn={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},ga={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},SE={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function bE(f){var _=this.nativeEvent;return _.getModifierState?_.getModifierState(f):(f=SE[f])?!!_[f]:!1}function Eu(){return bE}var P=Oe({},Fc,{key:function(f){if(f.key){var _=Gn[f.key]||f.key;if(_!=="Unidentified")return _}return f.type==="keypress"?(f=Vc(f),f===13?"Enter":String.fromCharCode(f)):f.type==="keydown"||f.type==="keyup"?ga[f.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:Eu,charCode:function(f){return f.type==="keypress"?Vc(f):0},keyCode:function(f){return f.type==="keydown"||f.type==="keyup"?f.keyCode:0},which:function(f){return f.type==="keypress"?Vc(f):f.type==="keydown"||f.type==="keyup"?f.keyCode:0}}),G=Os(P),ie=Oe({},fc,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),Ee=Os(ie),Ke=Oe({},Fc,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:Eu}),dt=Os(Ke),$t=Oe({},pc,{propertyName:0,elapsedTime:0,pseudoElement:0}),oi=Os($t),Gs=Oe({},fc,{deltaX:function(f){return"deltaX"in f?f.deltaX:"wheelDeltaX"in f?-f.wheelDeltaX:0},deltaY:function(f){return"deltaY"in f?f.deltaY:"wheelDeltaY"in f?-f.wheelDeltaY:"wheelDelta"in f?-f.wheelDelta:0},deltaZ:0,deltaMode:0}),hr=Os(Gs),ho=[9,13,27,32],Ns=y&&"CompositionEvent"in window,jc=null;y&&"documentMode"in document&&(jc=document.documentMode);var Ba=y&&"TextEvent"in window&&!jc,yd=y&&(!Ns||jc&&8<jc&&11>=jc),cm=" ",tI=!1;function nI(f,_){switch(f){case"keyup":return ho.indexOf(_.keyCode)!==-1;case"keydown":return _.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function mc(f){return f=f.detail,typeof f=="object"&&"data"in f?f.data:null}var lm=!1;function aD(f,_){switch(f){case"compositionend":return mc(_);case"keypress":return _.which!==32?null:(tI=!0,cm);case"textInput":return f=_.data,f===cm&&tI?null:f;default:return null}}function cD(f,_){if(lm)return f==="compositionend"||!Ns&&nI(f,_)?(f=Ws(),Di=tr=er=null,lm=!1,f):null;switch(f){case"paste":return null;case"keypress":if(!(_.ctrlKey||_.altKey||_.metaKey)||_.ctrlKey&&_.altKey){if(_.char&&1<_.char.length)return _.char;if(_.which)return String.fromCharCode(_.which)}return null;case"compositionend":return yd&&_.locale!=="ko"?null:_.data;default:return null}}var lD={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function rb(f){var _=f&&f.nodeName&&f.nodeName.toLowerCase();return _==="input"?!!lD[f.type]:_==="textarea"}function rI(f,_,T,D){uo(D),_=u_(_,"onChange"),0<_.length&&(T=new sm("onChange","change",null,T,D),f.push({event:T,listeners:_}))}var i_=null,um=null;function ib(f){fI(f,0)}function wE(f){var _=_m(f);if(ft(_))return f}function uD(f,_){if(f==="change")return _}var s_=!1;if(y){var sb;if(y){var ob="oninput"in document;if(!ob){var iI=document.createElement("div");iI.setAttribute("oninput","return;"),ob=typeof iI.oninput=="function"}sb=ob}else sb=!1;s_=sb&&(!document.documentMode||9<document.documentMode)}function Ed(){i_&&(i_.detachEvent("onpropertychange",sI),um=i_=null)}function sI(f){if(f.propertyName==="value"&&wE(um)){var _=[];rI(_,um,f,xa(f)),bo(ib,_)}}function dD(f,_,T){f==="focusin"?(Ed(),i_=_,um=T,i_.attachEvent("onpropertychange",sI)):f==="focusout"&&Ed()}function za(f){if(f==="selectionchange"||f==="keyup"||f==="keydown")return wE(um)}function hD(f,_){if(f==="click")return wE(_)}function pD(f,_){if(f==="input"||f==="change")return wE(_)}function fD(f,_){return f===_&&(f!==0||1/f===1/_)||f!==f&&_!==_}var Ol=typeof Object.is=="function"?Object.is:fD;function dm(f,_){if(Ol(f,_))return!0;if(typeof f!="object"||f===null||typeof _!="object"||_===null)return!1;var T=Object.keys(f),D=Object.keys(_);if(T.length!==D.length)return!1;for(D=0;D<T.length;D++){var F=T[D];if(!v.call(_,F)||!Ol(f[F],_[F]))return!1}return!0}function oI(f){for(;f&&f.firstChild;)f=f.firstChild;return f}function aI(f,_){var T=oI(f);f=0;for(var D;T;){if(T.nodeType===3){if(D=f+T.textContent.length,f<=_&&D>=_)return{node:T,offset:_-f};f=D}e:{for(;T;){if(T.nextSibling){T=T.nextSibling;break e}T=T.parentNode}T=void 0}T=oI(T)}}function cI(f,_){return f&&_?f===_?!0:f&&f.nodeType===3?!1:_&&_.nodeType===3?cI(f,_.parentNode):"contains"in f?f.contains(_):f.compareDocumentPosition?!!(f.compareDocumentPosition(_)&16):!1:!1}function ab(){for(var f=window,_=Ct();_ instanceof f.HTMLIFrameElement;){try{var T=typeof _.contentWindow.location.href=="string"}catch{T=!1}if(T)f=_.contentWindow;else break;_=Ct(f.document)}return _}function cb(f){var _=f&&f.nodeName&&f.nodeName.toLowerCase();return _&&(_==="input"&&(f.type==="text"||f.type==="search"||f.type==="tel"||f.type==="url"||f.type==="password")||_==="textarea"||f.contentEditable==="true")}function mD(f){var _=ab(),T=f.focusedElem,D=f.selectionRange;if(_!==T&&T&&T.ownerDocument&&cI(T.ownerDocument.documentElement,T)){if(D!==null&&cb(T)){if(_=D.start,f=D.end,f===void 0&&(f=_),"selectionStart"in T)T.selectionStart=_,T.selectionEnd=Math.min(f,T.value.length);else if(f=(_=T.ownerDocument||document)&&_.defaultView||window,f.getSelection){f=f.getSelection();var F=T.textContent.length,$=Math.min(D.start,F);D=D.end===void 0?$:Math.min(D.end,F),!f.extend&&$>D&&(F=D,D=$,$=F),F=aI(T,$);var me=aI(T,D);F&&me&&(f.rangeCount!==1||f.anchorNode!==F.node||f.anchorOffset!==F.offset||f.focusNode!==me.node||f.focusOffset!==me.offset)&&(_=_.createRange(),_.setStart(F.node,F.offset),f.removeAllRanges(),$>D?(f.addRange(_),f.extend(me.node,me.offset)):(_.setEnd(me.node,me.offset),f.addRange(_)))}}for(_=[],f=T;f=f.parentNode;)f.nodeType===1&&_.push({element:f,left:f.scrollLeft,top:f.scrollTop});for(typeof T.focus=="function"&&T.focus(),T=0;T<_.length;T++)f=_[T],f.element.scrollLeft=f.left,f.element.scrollTop=f.top}}var lb=y&&"documentMode"in document&&11>=document.documentMode,Sh=null,ub=null,rt=null,db=!1;function lI(f,_,T){var D=T.window===T?T.document:T.nodeType===9?T:T.ownerDocument;db||Sh==null||Sh!==Ct(D)||(D=Sh,"selectionStart"in D&&cb(D)?D={start:D.selectionStart,end:D.selectionEnd}:(D=(D.ownerDocument&&D.ownerDocument.defaultView||window).getSelection(),D={anchorNode:D.anchorNode,anchorOffset:D.anchorOffset,focusNode:D.focusNode,focusOffset:D.focusOffset}),rt&&dm(rt,D)||(rt=D,D=u_(ub,"onSelect"),0<D.length&&(_=new sm("onSelect","select",null,_,T),f.push({event:_,listeners:D}),_.target=Sh)))}function TE(f,_){var T={};return T[f.toLowerCase()]=_.toLowerCase(),T["Webkit"+f]="webkit"+_,T["Moz"+f]="moz"+_,T}var hm={animationend:TE("Animation","AnimationEnd"),animationiteration:TE("Animation","AnimationIteration"),animationstart:TE("Animation","AnimationStart"),transitionend:TE("Transition","TransitionEnd")},CE={},hb={};y&&(hb=document.createElement("div").style,"AnimationEvent"in window||(delete hm.animationend.animation,delete hm.animationiteration.animation,delete hm.animationstart.animation),"TransitionEvent"in window||delete hm.transitionend.transition);function RE(f){if(CE[f])return CE[f];if(!hm[f])return f;var _=hm[f],T;for(T in _)if(_.hasOwnProperty(T)&&T in hb)return CE[f]=_[T];return f}var uI=RE("animationend"),dI=RE("animationiteration"),o_=RE("animationstart"),pm=RE("transitionend"),hI=new Map,pI="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function Nl(f,_){hI.set(f,_),u(_,[f])}for(var a_=0;a_<pI.length;a_++){var fm=pI[a_],gD=fm.toLowerCase(),_D=fm[0].toUpperCase()+fm.slice(1);Nl(gD,"on"+_D)}Nl(uI,"onAnimationEnd"),Nl(dI,"onAnimationIteration"),Nl(o_,"onAnimationStart"),Nl("dblclick","onDoubleClick"),Nl("focusin","onFocus"),Nl("focusout","onBlur"),Nl(pm,"onTransitionEnd"),p("onMouseEnter",["mouseout","mouseover"]),p("onMouseLeave",["mouseout","mouseover"]),p("onPointerEnter",["pointerout","pointerover"]),p("onPointerLeave",["pointerout","pointerover"]),u("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),u("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),u("onBeforeInput",["compositionend","keypress","textInput","paste"]),u("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),u("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),u("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var c_="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),yD=new Set("cancel close invalid load scroll toggle".split(" ").concat(c_));function IE(f,_,T){var D=f.type||"unknown-event";f.currentTarget=T,uu(D,_,void 0,f),f.currentTarget=null}function fI(f,_){_=(_&4)!==0;for(var T=0;T<f.length;T++){var D=f[T],F=D.event;D=D.listeners;e:{var $=void 0;if(_)for(var me=D.length-1;0<=me;me--){var Ae=D[me],Ve=Ae.instance,at=Ae.currentTarget;if(Ae=Ae.listener,Ve!==$&&F.isPropagationStopped())break e;IE(F,Ae,at),$=Ve}else for(me=0;me<D.length;me++){if(Ae=D[me],Ve=Ae.instance,at=Ae.currentTarget,Ae=Ae.listener,Ve!==$&&F.isPropagationStopped())break e;IE(F,Ae,at),$=Ve}}}if(gt)throw f=_n,gt=!1,_n=null,f}function xi(f,_){var T=_[_b];T===void 0&&(T=_[_b]=new Set);var D=f+"__bubble";T.has(D)||(mI(_,f,2,!1),T.add(D))}function Wa(f,_,T){var D=0;_&&(D|=4),mI(T,f,D,_)}var AE="_reactListening"+Math.random().toString(36).slice(2);function vd(f){if(!f[AE]){f[AE]=!0,o.forEach(function(T){T!=="selectionchange"&&(yD.has(T)||Wa(T,!1,f),Wa(T,!0,f))});var _=f.nodeType===9?f:f.ownerDocument;_===null||_[AE]||(_[AE]=!0,Wa("selectionchange",!1,_))}}function mI(f,_,T,D){switch(si(_)){case 1:var F=Me;break;case 4:F=ot;break;default:F=Kt}T=F.bind(null,_,T,f),F=void 0,!lu||_!=="touchstart"&&_!=="touchmove"&&_!=="wheel"||(F=!0),D?F!==void 0?f.addEventListener(_,T,{capture:!0,passive:F}):f.addEventListener(_,T,!0):F!==void 0?f.addEventListener(_,T,{passive:F}):f.addEventListener(_,T,!1)}function pb(f,_,T,D,F){var $=D;if((_&1)===0&&(_&2)===0&&D!==null)e:for(;;){if(D===null)return;var me=D.tag;if(me===3||me===4){var Ae=D.stateNode.containerInfo;if(Ae===F||Ae.nodeType===8&&Ae.parentNode===F)break;if(me===4)for(me=D.return;me!==null;){var Ve=me.tag;if((Ve===3||Ve===4)&&(Ve=me.stateNode.containerInfo,Ve===F||Ve.nodeType===8&&Ve.parentNode===F))return;me=me.return}for(;Ae!==null;){if(me=zp(Ae),me===null)return;if(Ve=me.tag,Ve===5||Ve===6){D=$=me;continue e}Ae=Ae.parentNode}}D=D.return}bo(function(){var at=$,Dt=xa(T),Mt=[];e:{var Nt=hI.get(f);if(Nt!==void 0){var nn=sm,dn=f;switch(f){case"keypress":if(Vc(T)===0)break e;case"keydown":case"keyup":nn=G;break;case"focusin":dn="focus",nn=am;break;case"focusout":dn="blur",nn=am;break;case"beforeblur":case"afterblur":nn=am;break;case"click":if(T.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":nn=yu;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":nn=yE;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":nn=dt;break;case uI:case dI:case o_:nn=ja;break;case pm:nn=oi;break;case"scroll":nn=e_;break;case"wheel":nn=hr;break;case"copy":case"cut":case"paste":nn=_d;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":nn=Ee}var fn=(_&4)!==0,rs=!fn&&f==="scroll",Xe=fn?Nt!==null?Nt+"Capture":null:Nt;fn=[];for(var Fe=at,it;Fe!==null;){it=Fe;var jt=it.stateNode;if(it.tag===5&&jt!==null&&(it=jt,Xe!==null&&(jt=Tr(Fe,Xe),jt!=null&&fn.push(l_(Fe,jt,it)))),rs)break;Fe=Fe.return}0<fn.length&&(Nt=new nn(Nt,dn,null,T,Dt),Mt.push({event:Nt,listeners:fn}))}}if((_&7)===0){e:{if(Nt=f==="mouseover"||f==="pointerover",nn=f==="mouseout"||f==="pointerout",Nt&&T!==Ki&&(dn=T.relatedTarget||T.fromElement)&&(zp(dn)||dn[Sd]))break e;if((nn||Nt)&&(Nt=Dt.window===Dt?Dt:(Nt=Dt.ownerDocument)?Nt.defaultView||Nt.parentWindow:window,nn?(dn=T.relatedTarget||T.toElement,nn=at,dn=dn?zp(dn):null,dn!==null&&(rs=es(dn),dn!==rs||dn.tag!==5&&dn.tag!==6)&&(dn=null)):(nn=null,dn=at),nn!==dn)){if(fn=yu,jt="onMouseLeave",Xe="onMouseEnter",Fe="mouse",(f==="pointerout"||f==="pointerover")&&(fn=Ee,jt="onPointerLeave",Xe="onPointerEnter",Fe="pointer"),rs=nn==null?Nt:_m(nn),it=dn==null?Nt:_m(dn),Nt=new fn(jt,Fe+"leave",nn,T,Dt),Nt.target=rs,Nt.relatedTarget=it,jt=null,zp(Dt)===at&&(fn=new fn(Xe,Fe+"enter",dn,T,Dt),fn.target=it,fn.relatedTarget=rs,jt=fn),rs=jt,nn&&dn)t:{for(fn=nn,Xe=dn,Fe=0,it=fn;it;it=mm(it))Fe++;for(it=0,jt=Xe;jt;jt=mm(jt))it++;for(;0<Fe-it;)fn=mm(fn),Fe--;for(;0<it-Fe;)Xe=mm(Xe),it--;for(;Fe--;){if(fn===Xe||Xe!==null&&fn===Xe.alternate)break t;fn=mm(fn),Xe=mm(Xe)}fn=null}else fn=null;nn!==null&&gI(Mt,Nt,nn,fn,!1),dn!==null&&rs!==null&&gI(Mt,rs,dn,fn,!0)}}e:{if(Nt=at?_m(at):window,nn=Nt.nodeName&&Nt.nodeName.toLowerCase(),nn==="select"||nn==="input"&&Nt.type==="file")var mn=uD;else if(rb(Nt))if(s_)mn=pD;else{mn=za;var kn=dD}else(nn=Nt.nodeName)&&nn.toLowerCase()==="input"&&(Nt.type==="checkbox"||Nt.type==="radio")&&(mn=hD);if(mn&&(mn=mn(f,at))){rI(Mt,mn,T,Dt);break e}kn&&kn(f,Nt,at),f==="focusout"&&(kn=Nt._wrapperState)&&kn.controlled&&Nt.type==="number"&&Ne(Nt,"number",Nt.value)}switch(kn=at?_m(at):window,f){case"focusin":(rb(kn)||kn.contentEditable==="true")&&(Sh=kn,ub=at,rt=null);break;case"focusout":rt=ub=Sh=null;break;case"mousedown":db=!0;break;case"contextmenu":case"mouseup":case"dragend":db=!1,lI(Mt,T,Dt);break;case"selectionchange":if(lb)break;case"keydown":case"keyup":lI(Mt,T,Dt)}var On;if(Ns)e:{switch(f){case"compositionstart":var Vn="onCompositionStart";break e;case"compositionend":Vn="onCompositionEnd";break e;case"compositionupdate":Vn="onCompositionUpdate";break e}Vn=void 0}else lm?nI(f,T)&&(Vn="onCompositionEnd"):f==="keydown"&&T.keyCode===229&&(Vn="onCompositionStart");Vn&&(yd&&T.locale!=="ko"&&(lm||Vn!=="onCompositionStart"?Vn==="onCompositionEnd"&&lm&&(On=Ws()):(er=Dt,tr="value"in er?er.value:er.textContent,lm=!0)),kn=u_(at,Vn),0<kn.length&&(Vn=new r_(Vn,f,null,T,Dt),Mt.push({event:Vn,listeners:kn}),On?Vn.data=On:(On=mc(T),On!==null&&(Vn.data=On)))),(On=Ba?aD(f,T):cD(f,T))&&(at=u_(at,"onBeforeInput"),0<at.length&&(Dt=new r_("onBeforeInput","beforeinput",null,T,Dt),Mt.push({event:Dt,listeners:at}),Dt.data=On))}fI(Mt,_)})}function l_(f,_,T){return{instance:f,listener:_,currentTarget:T}}function u_(f,_){for(var T=_+"Capture",D=[];f!==null;){var F=f,$=F.stateNode;F.tag===5&&$!==null&&(F=$,$=Tr(f,T),$!=null&&D.unshift(l_(f,$,F)),$=Tr(f,_),$!=null&&D.push(l_(f,$,F))),f=f.return}return D}function mm(f){if(f===null)return null;do f=f.return;while(f&&f.tag!==5);return f||null}function gI(f,_,T,D,F){for(var $=_._reactName,me=[];T!==null&&T!==D;){var Ae=T,Ve=Ae.alternate,at=Ae.stateNode;if(Ve!==null&&Ve===D)break;Ae.tag===5&&at!==null&&(Ae=at,F?(Ve=Tr(T,$),Ve!=null&&me.unshift(l_(T,Ve,Ae))):F||(Ve=Tr(T,$),Ve!=null&&me.push(l_(T,Ve,Ae)))),T=T.return}me.length!==0&&f.push({event:_,listeners:me})}var ED=/\r\n?/g,fb=/\u0000|\uFFFD/g;function _I(f){return(typeof f=="string"?f:""+f).replace(ED,`
`).replace(fb,"")}function d_(f,_,T){if(_=_I(_),_I(f)!==_&&T)throw Error(i(425))}function h_(){}var mb=null,PE=null;function gm(f,_){return f==="textarea"||f==="noscript"||typeof _.children=="string"||typeof _.children=="number"||typeof _.dangerouslySetInnerHTML=="object"&&_.dangerouslySetInnerHTML!==null&&_.dangerouslySetInnerHTML.__html!=null}var gb=typeof setTimeout=="function"?setTimeout:void 0,vD=typeof clearTimeout=="function"?clearTimeout:void 0,yI=typeof Promise=="function"?Promise:void 0,SD=typeof queueMicrotask=="function"?queueMicrotask:typeof yI<"u"?function(f){return yI.resolve(null).then(f).catch(bD)}:gb;function bD(f){setTimeout(function(){throw f})}function kE(f,_){var T=_,D=0;do{var F=T.nextSibling;if(f.removeChild(T),F&&F.nodeType===8)if(T=F.data,T==="/$"){if(D===0){f.removeChild(F),ma(_);return}D--}else T!=="$"&&T!=="$?"&&T!=="$!"||D++;T=F}while(T);ma(_)}function vu(f){for(;f!=null;f=f.nextSibling){var _=f.nodeType;if(_===1||_===3)break;if(_===8){if(_=f.data,_==="$"||_==="$!"||_==="$?")break;if(_==="/$")return null}}return f}function EI(f){f=f.previousSibling;for(var _=0;f;){if(f.nodeType===8){var T=f.data;if(T==="$"||T==="$!"||T==="$?"){if(_===0)return f;_--}else T==="/$"&&_++}f=f.previousSibling}return null}var bh=Math.random().toString(36).slice(2),Su="__reactFiber$"+bh,p_="__reactProps$"+bh,Sd="__reactContainer$"+bh,_b="__reactEvents$"+bh,wD="__reactListeners$"+bh,TD="__reactHandles$"+bh;function zp(f){var _=f[Su];if(_)return _;for(var T=f.parentNode;T;){if(_=T[Sd]||T[Su]){if(T=_.alternate,_.child!==null||T!==null&&T.child!==null)for(f=EI(f);f!==null;){if(T=f[Su])return T;f=EI(f)}return _}f=T,T=f.parentNode}return null}function f_(f){return f=f[Su]||f[Sd],!f||f.tag!==5&&f.tag!==6&&f.tag!==13&&f.tag!==3?null:f}function _m(f){if(f.tag===5||f.tag===6)return f.stateNode;throw Error(i(33))}function OE(f){return f[p_]||null}var yb=[],bd=-1;function Dl(f){return{current:f}}function Ti(f){0>bd||(f.current=yb[bd],yb[bd]=null,bd--)}function Li(f,_){bd++,yb[bd]=f.current,f.current=_}var wh={},qo=Dl(wh),_a=Dl(!1),Th=wh;function Ch(f,_){var T=f.type.contextTypes;if(!T)return wh;var D=f.stateNode;if(D&&D.__reactInternalMemoizedUnmaskedChildContext===_)return D.__reactInternalMemoizedMaskedChildContext;var F={},$;for($ in T)F[$]=_[$];return D&&(f=f.stateNode,f.__reactInternalMemoizedUnmaskedChildContext=_,f.__reactInternalMemoizedMaskedChildContext=F),F}function Ga(f){return f=f.childContextTypes,f!=null}function NE(){Ti(_a),Ti(qo)}function ym(f,_,T){if(qo.current!==wh)throw Error(i(168));Li(qo,_),Li(_a,T)}function vI(f,_,T){var D=f.stateNode;if(_=_.childContextTypes,typeof D.getChildContext!="function")return T;D=D.getChildContext();for(var F in D)if(!(F in _))throw Error(i(108,nt(f)||"Unknown",F));return Oe({},T,D)}function DE(f){return f=(f=f.stateNode)&&f.__reactInternalMemoizedMergedChildContext||wh,Th=qo.current,Li(qo,f),Li(_a,_a.current),!0}function SI(f,_,T){var D=f.stateNode;if(!D)throw Error(i(169));T?(f=vI(f,_,Th),D.__reactInternalMemoizedMergedChildContext=f,Ti(_a),Ti(qo),Li(qo,f)):Ti(_a),Li(_a,T)}var wd=null,xE=!1,Eb=!1;function vb(f){wd===null?wd=[f]:wd.push(f)}function CD(f){xE=!0,vb(f)}function Rh(){if(!Eb&&wd!==null){Eb=!0;var f=0,_=mr;try{var T=wd;for(mr=1;f<T.length;f++){var D=T[f];do D=D(!0);while(D!==null)}wd=null,xE=!1}catch(F){throw wd!==null&&(wd=wd.slice(f+1)),ca(ti,Rh),F}finally{mr=_,Eb=!1}}return null}var Em=[],Ih=0,LE=null,ME=0,ya=[],Bc=0,Wp=null,Td=1,Cd="";function Gp(f,_){Em[Ih++]=ME,Em[Ih++]=LE,LE=f,ME=_}function bI(f,_,T){ya[Bc++]=Td,ya[Bc++]=Cd,ya[Bc++]=Wp,Wp=f;var D=Td;f=Cd;var F=32-wo(D)-1;D&=~(1<<F),T+=1;var $=32-wo(_)+F;if(30<$){var me=F-F%5;$=(D&(1<<me)-1).toString(32),D>>=me,F-=me,Td=1<<32-wo(_)+F|T<<F|D,Cd=$+f}else Td=1<<$|T<<F|D,Cd=f}function vm(f){f.return!==null&&(Gp(f,1),bI(f,1,0))}function UE(f){for(;f===LE;)LE=Em[--Ih],Em[Ih]=null,ME=Em[--Ih],Em[Ih]=null;for(;f===Wp;)Wp=ya[--Bc],ya[Bc]=null,Cd=ya[--Bc],ya[Bc]=null,Td=ya[--Bc],ya[Bc]=null}var gc=null,_c=null,Bi=!1,xl=null;function wI(f,_){var T=$c(5,null,null,0);T.elementType="DELETED",T.stateNode=_,T.return=f,_=f.deletions,_===null?(f.deletions=[T],f.flags|=16):_.push(T)}function TI(f,_){switch(f.tag){case 5:var T=f.type;return _=_.nodeType!==1||T.toLowerCase()!==_.nodeName.toLowerCase()?null:_,_!==null?(f.stateNode=_,gc=f,_c=vu(_.firstChild),!0):!1;case 6:return _=f.pendingProps===""||_.nodeType!==3?null:_,_!==null?(f.stateNode=_,gc=f,_c=null,!0):!1;case 13:return _=_.nodeType!==8?null:_,_!==null?(T=Wp!==null?{id:Td,overflow:Cd}:null,f.memoizedState={dehydrated:_,treeContext:T,retryLane:1073741824},T=$c(18,null,null,0),T.stateNode=_,T.return=f,f.child=T,gc=f,_c=null,!0):!1;default:return!1}}function m_(f){return(f.mode&1)!==0&&(f.flags&128)===0}function g_(f){if(Bi){var _=_c;if(_){var T=_;if(!TI(f,_)){if(m_(f))throw Error(i(418));_=vu(T.nextSibling);var D=gc;_&&TI(f,_)?wI(D,T):(f.flags=f.flags&-4097|2,Bi=!1,gc=f)}}else{if(m_(f))throw Error(i(418));f.flags=f.flags&-4097|2,Bi=!1,gc=f}}}function Sb(f){for(f=f.return;f!==null&&f.tag!==5&&f.tag!==3&&f.tag!==13;)f=f.return;gc=f}function Sm(f){if(f!==gc)return!1;if(!Bi)return Sb(f),Bi=!0,!1;var _;if((_=f.tag!==3)&&!(_=f.tag!==5)&&(_=f.type,_=_!=="head"&&_!=="body"&&!gm(f.type,f.memoizedProps)),_&&(_=_c)){if(m_(f))throw bb(),Error(i(418));for(;_;)wI(f,_),_=vu(_.nextSibling)}if(Sb(f),f.tag===13){if(f=f.memoizedState,f=f!==null?f.dehydrated:null,!f)throw Error(i(317));e:{for(f=f.nextSibling,_=0;f;){if(f.nodeType===8){var T=f.data;if(T==="/$"){if(_===0){_c=vu(f.nextSibling);break e}_--}else T!=="$"&&T!=="$!"&&T!=="$?"||_++}f=f.nextSibling}_c=null}}else _c=gc?vu(f.stateNode.nextSibling):null;return!0}function bb(){for(var f=_c;f;)f=vu(f.nextSibling)}function Hp(){_c=gc=null,Bi=!1}function bm(f){xl===null?xl=[f]:xl.push(f)}var __=ce.ReactCurrentBatchConfig;function y_(f,_,T){if(f=T.ref,f!==null&&typeof f!="function"&&typeof f!="object"){if(T._owner){if(T=T._owner,T){if(T.tag!==1)throw Error(i(309));var D=T.stateNode}if(!D)throw Error(i(147,f));var F=D,$=""+f;return _!==null&&_.ref!==null&&typeof _.ref=="function"&&_.ref._stringRef===$?_.ref:(_=function(me){var Ae=F.refs;me===null?delete Ae[$]:Ae[$]=me},_._stringRef=$,_)}if(typeof f!="string")throw Error(i(284));if(!T._owner)throw Error(i(290,f))}return f}function VE(f,_){throw f=Object.prototype.toString.call(_),Error(i(31,f==="[object Object]"?"object with keys {"+Object.keys(_).join(", ")+"}":f))}function wb(f){var _=f._init;return _(f._payload)}function CI(f){function _(Xe,Fe){if(f){var it=Xe.deletions;it===null?(Xe.deletions=[Fe],Xe.flags|=16):it.push(Fe)}}function T(Xe,Fe){if(!f)return null;for(;Fe!==null;)_(Xe,Fe),Fe=Fe.sibling;return null}function D(Xe,Fe){for(Xe=new Map;Fe!==null;)Fe.key!==null?Xe.set(Fe.key,Fe):Xe.set(Fe.index,Fe),Fe=Fe.sibling;return Xe}function F(Xe,Fe){return Xe=Fh(Xe,Fe),Xe.index=0,Xe.sibling=null,Xe}function $(Xe,Fe,it){return Xe.index=it,f?(it=Xe.alternate,it!==null?(it=it.index,it<Fe?(Xe.flags|=2,Fe):it):(Xe.flags|=2,Fe)):(Xe.flags|=1048576,Fe)}function me(Xe){return f&&Xe.alternate===null&&(Xe.flags|=2),Xe}function Ae(Xe,Fe,it,jt){return Fe===null||Fe.tag!==6?(Fe=fv(it,Xe.mode,jt),Fe.return=Xe,Fe):(Fe=F(Fe,it),Fe.return=Xe,Fe)}function Ve(Xe,Fe,it,jt){var mn=it.type;return mn===H?Dt(Xe,Fe,it.props.children,jt,it.key):Fe!==null&&(Fe.elementType===mn||typeof mn=="object"&&mn!==null&&mn.$$typeof===je&&wb(mn)===Fe.type)?(jt=F(Fe,it.props),jt.ref=y_(Xe,Fe,it),jt.return=Xe,jt):(jt=xm(it.type,it.key,it.props,null,Xe.mode,jt),jt.ref=y_(Xe,Fe,it),jt.return=Xe,jt)}function at(Xe,Fe,it,jt){return Fe===null||Fe.tag!==4||Fe.stateNode.containerInfo!==it.containerInfo||Fe.stateNode.implementation!==it.implementation?(Fe=Lm(it,Xe.mode,jt),Fe.return=Xe,Fe):(Fe=F(Fe,it.children||[]),Fe.return=Xe,Fe)}function Dt(Xe,Fe,it,jt,mn){return Fe===null||Fe.tag!==7?(Fe=jh(it,Xe.mode,jt,mn),Fe.return=Xe,Fe):(Fe=F(Fe,it),Fe.return=Xe,Fe)}function Mt(Xe,Fe,it){if(typeof Fe=="string"&&Fe!==""||typeof Fe=="number")return Fe=fv(""+Fe,Xe.mode,it),Fe.return=Xe,Fe;if(typeof Fe=="object"&&Fe!==null){switch(Fe.$$typeof){case ae:return it=xm(Fe.type,Fe.key,Fe.props,null,Xe.mode,it),it.ref=y_(Xe,null,Fe),it.return=Xe,it;case pe:return Fe=Lm(Fe,Xe.mode,it),Fe.return=Xe,Fe;case je:var jt=Fe._init;return Mt(Xe,jt(Fe._payload),it)}if($e(Fe)||Ie(Fe))return Fe=jh(Fe,Xe.mode,it,null),Fe.return=Xe,Fe;VE(Xe,Fe)}return null}function Nt(Xe,Fe,it,jt){var mn=Fe!==null?Fe.key:null;if(typeof it=="string"&&it!==""||typeof it=="number")return mn!==null?null:Ae(Xe,Fe,""+it,jt);if(typeof it=="object"&&it!==null){switch(it.$$typeof){case ae:return it.key===mn?Ve(Xe,Fe,it,jt):null;case pe:return it.key===mn?at(Xe,Fe,it,jt):null;case je:return mn=it._init,Nt(Xe,Fe,mn(it._payload),jt)}if($e(it)||Ie(it))return mn!==null?null:Dt(Xe,Fe,it,jt,null);VE(Xe,it)}return null}function nn(Xe,Fe,it,jt,mn){if(typeof jt=="string"&&jt!==""||typeof jt=="number")return Xe=Xe.get(it)||null,Ae(Fe,Xe,""+jt,mn);if(typeof jt=="object"&&jt!==null){switch(jt.$$typeof){case ae:return Xe=Xe.get(jt.key===null?it:jt.key)||null,Ve(Fe,Xe,jt,mn);case pe:return Xe=Xe.get(jt.key===null?it:jt.key)||null,at(Fe,Xe,jt,mn);case je:var kn=jt._init;return nn(Xe,Fe,it,kn(jt._payload),mn)}if($e(jt)||Ie(jt))return Xe=Xe.get(it)||null,Dt(Fe,Xe,jt,mn,null);VE(Fe,jt)}return null}function dn(Xe,Fe,it,jt){for(var mn=null,kn=null,On=Fe,Vn=Fe=0,qs=null;On!==null&&Vn<it.length;Vn++){On.index>Vn?(qs=On,On=null):qs=On.sibling;var Xr=Nt(Xe,On,it[Vn],jt);if(Xr===null){On===null&&(On=qs);break}f&&On&&Xr.alternate===null&&_(Xe,On),Fe=$(Xr,Fe,Vn),kn===null?mn=Xr:kn.sibling=Xr,kn=Xr,On=qs}if(Vn===it.length)return T(Xe,On),Bi&&Gp(Xe,Vn),mn;if(On===null){for(;Vn<it.length;Vn++)On=Mt(Xe,it[Vn],jt),On!==null&&(Fe=$(On,Fe,Vn),kn===null?mn=On:kn.sibling=On,kn=On);return Bi&&Gp(Xe,Vn),mn}for(On=D(Xe,On);Vn<it.length;Vn++)qs=nn(On,Xe,Vn,it[Vn],jt),qs!==null&&(f&&qs.alternate!==null&&On.delete(qs.key===null?Vn:qs.key),Fe=$(qs,Fe,Vn),kn===null?mn=qs:kn.sibling=qs,kn=qs);return f&&On.forEach(function(Iu){return _(Xe,Iu)}),Bi&&Gp(Xe,Vn),mn}function fn(Xe,Fe,it,jt){var mn=Ie(it);if(typeof mn!="function")throw Error(i(150));if(it=mn.call(it),it==null)throw Error(i(151));for(var kn=mn=null,On=Fe,Vn=Fe=0,qs=null,Xr=it.next();On!==null&&!Xr.done;Vn++,Xr=it.next()){On.index>Vn?(qs=On,On=null):qs=On.sibling;var Iu=Nt(Xe,On,Xr.value,jt);if(Iu===null){On===null&&(On=qs);break}f&&On&&Iu.alternate===null&&_(Xe,On),Fe=$(Iu,Fe,Vn),kn===null?mn=Iu:kn.sibling=Iu,kn=Iu,On=qs}if(Xr.done)return T(Xe,On),Bi&&Gp(Xe,Vn),mn;if(On===null){for(;!Xr.done;Vn++,Xr=it.next())Xr=Mt(Xe,Xr.value,jt),Xr!==null&&(Fe=$(Xr,Fe,Vn),kn===null?mn=Xr:kn.sibling=Xr,kn=Xr);return Bi&&Gp(Xe,Vn),mn}for(On=D(Xe,On);!Xr.done;Vn++,Xr=it.next())Xr=nn(On,Xe,Vn,Xr.value,jt),Xr!==null&&(f&&Xr.alternate!==null&&On.delete(Xr.key===null?Vn:Xr.key),Fe=$(Xr,Fe,Vn),kn===null?mn=Xr:kn.sibling=Xr,kn=Xr);return f&&On.forEach(function(zD){return _(Xe,zD)}),Bi&&Gp(Xe,Vn),mn}function rs(Xe,Fe,it,jt){if(typeof it=="object"&&it!==null&&it.type===H&&it.key===null&&(it=it.props.children),typeof it=="object"&&it!==null){switch(it.$$typeof){case ae:e:{for(var mn=it.key,kn=Fe;kn!==null;){if(kn.key===mn){if(mn=it.type,mn===H){if(kn.tag===7){T(Xe,kn.sibling),Fe=F(kn,it.props.children),Fe.return=Xe,Xe=Fe;break e}}else if(kn.elementType===mn||typeof mn=="object"&&mn!==null&&mn.$$typeof===je&&wb(mn)===kn.type){T(Xe,kn.sibling),Fe=F(kn,it.props),Fe.ref=y_(Xe,kn,it),Fe.return=Xe,Xe=Fe;break e}T(Xe,kn);break}else _(Xe,kn);kn=kn.sibling}it.type===H?(Fe=jh(it.props.children,Xe.mode,jt,it.key),Fe.return=Xe,Xe=Fe):(jt=xm(it.type,it.key,it.props,null,Xe.mode,jt),jt.ref=y_(Xe,Fe,it),jt.return=Xe,Xe=jt)}return me(Xe);case pe:e:{for(kn=it.key;Fe!==null;){if(Fe.key===kn)if(Fe.tag===4&&Fe.stateNode.containerInfo===it.containerInfo&&Fe.stateNode.implementation===it.implementation){T(Xe,Fe.sibling),Fe=F(Fe,it.children||[]),Fe.return=Xe,Xe=Fe;break e}else{T(Xe,Fe);break}else _(Xe,Fe);Fe=Fe.sibling}Fe=Lm(it,Xe.mode,jt),Fe.return=Xe,Xe=Fe}return me(Xe);case je:return kn=it._init,rs(Xe,Fe,kn(it._payload),jt)}if($e(it))return dn(Xe,Fe,it,jt);if(Ie(it))return fn(Xe,Fe,it,jt);VE(Xe,it)}return typeof it=="string"&&it!==""||typeof it=="number"?(it=""+it,Fe!==null&&Fe.tag===6?(T(Xe,Fe.sibling),Fe=F(Fe,it),Fe.return=Xe,Xe=Fe):(T(Xe,Fe),Fe=fv(it,Xe.mode,jt),Fe.return=Xe,Xe=Fe),me(Xe)):T(Xe,Fe)}return rs}var wm=CI(!0),Tb=CI(!1),FE=Dl(null),jE=null,Tm=null,Cb=null;function Rb(){Cb=Tm=jE=null}function Ib(f){var _=FE.current;Ti(FE),f._currentValue=_}function BE(f,_,T){for(;f!==null;){var D=f.alternate;if((f.childLanes&_)!==_?(f.childLanes|=_,D!==null&&(D.childLanes|=_)):D!==null&&(D.childLanes&_)!==_&&(D.childLanes|=_),f===T)break;f=f.return}}function Ll(f,_){jE=f,Cb=Tm=null,f=f.dependencies,f!==null&&f.firstContext!==null&&((f.lanes&_)!==0&&($a=!0),f.firstContext=null)}function zc(f){var _=f._currentValue;if(Cb!==f)if(f={context:f,memoizedValue:_,next:null},Tm===null){if(jE===null)throw Error(i(308));Tm=f,jE.dependencies={lanes:0,firstContext:f}}else Tm=Tm.next=f;return _}var $p=null;function Ab(f){$p===null?$p=[f]:$p.push(f)}function Pb(f,_,T,D){var F=_.interleaved;return F===null?(T.next=T,Ab(_)):(T.next=F.next,F.next=T),_.interleaved=T,Rd(f,D)}function Rd(f,_){f.lanes|=_;var T=f.alternate;for(T!==null&&(T.lanes|=_),T=f,f=f.return;f!==null;)f.childLanes|=_,T=f.alternate,T!==null&&(T.childLanes|=_),T=f,f=f.return;return T.tag===3?T.stateNode:null}var Id=!1;function kb(f){f.updateQueue={baseState:f.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function RI(f,_){f=f.updateQueue,_.updateQueue===f&&(_.updateQueue={baseState:f.baseState,firstBaseUpdate:f.firstBaseUpdate,lastBaseUpdate:f.lastBaseUpdate,shared:f.shared,effects:f.effects})}function Ad(f,_){return{eventTime:f,lane:_,tag:0,payload:null,callback:null,next:null}}function Ml(f,_,T){var D=f.updateQueue;if(D===null)return null;if(D=D.shared,(Cr&2)!==0){var F=D.pending;return F===null?_.next=_:(_.next=F.next,F.next=_),D.pending=_,Rd(f,T)}return F=D.interleaved,F===null?(_.next=_,Ab(D)):(_.next=F.next,F.next=_),D.interleaved=_,Rd(f,T)}function zE(f,_,T){if(_=_.updateQueue,_!==null&&(_=_.shared,(T&4194240)!==0)){var D=_.lanes;D&=f.pendingLanes,T|=D,_.lanes=T,pu(f,T)}}function II(f,_){var T=f.updateQueue,D=f.alternate;if(D!==null&&(D=D.updateQueue,T===D)){var F=null,$=null;if(T=T.firstBaseUpdate,T!==null){do{var me={eventTime:T.eventTime,lane:T.lane,tag:T.tag,payload:T.payload,callback:T.callback,next:null};$===null?F=$=me:$=$.next=me,T=T.next}while(T!==null);$===null?F=$=_:$=$.next=_}else F=$=_;T={baseState:D.baseState,firstBaseUpdate:F,lastBaseUpdate:$,shared:D.shared,effects:D.effects},f.updateQueue=T;return}f=T.lastBaseUpdate,f===null?T.firstBaseUpdate=_:f.next=_,T.lastBaseUpdate=_}function WE(f,_,T,D){var F=f.updateQueue;Id=!1;var $=F.firstBaseUpdate,me=F.lastBaseUpdate,Ae=F.shared.pending;if(Ae!==null){F.shared.pending=null;var Ve=Ae,at=Ve.next;Ve.next=null,me===null?$=at:me.next=at,me=Ve;var Dt=f.alternate;Dt!==null&&(Dt=Dt.updateQueue,Ae=Dt.lastBaseUpdate,Ae!==me&&(Ae===null?Dt.firstBaseUpdate=at:Ae.next=at,Dt.lastBaseUpdate=Ve))}if($!==null){var Mt=F.baseState;me=0,Dt=at=Ve=null,Ae=$;do{var Nt=Ae.lane,nn=Ae.eventTime;if((D&Nt)===Nt){Dt!==null&&(Dt=Dt.next={eventTime:nn,lane:0,tag:Ae.tag,payload:Ae.payload,callback:Ae.callback,next:null});e:{var dn=f,fn=Ae;switch(Nt=_,nn=T,fn.tag){case 1:if(dn=fn.payload,typeof dn=="function"){Mt=dn.call(nn,Mt,Nt);break e}Mt=dn;break e;case 3:dn.flags=dn.flags&-65537|128;case 0:if(dn=fn.payload,Nt=typeof dn=="function"?dn.call(nn,Mt,Nt):dn,Nt==null)break e;Mt=Oe({},Mt,Nt);break e;case 2:Id=!0}}Ae.callback!==null&&Ae.lane!==0&&(f.flags|=64,Nt=F.effects,Nt===null?F.effects=[Ae]:Nt.push(Ae))}else nn={eventTime:nn,lane:Nt,tag:Ae.tag,payload:Ae.payload,callback:Ae.callback,next:null},Dt===null?(at=Dt=nn,Ve=Mt):Dt=Dt.next=nn,me|=Nt;if(Ae=Ae.next,Ae===null){if(Ae=F.shared.pending,Ae===null)break;Nt=Ae,Ae=Nt.next,Nt.next=null,F.lastBaseUpdate=Nt,F.shared.pending=null}}while(!0);if(Dt===null&&(Ve=Mt),F.baseState=Ve,F.firstBaseUpdate=at,F.lastBaseUpdate=Dt,_=F.shared.interleaved,_!==null){F=_;do me|=F.lane,F=F.next;while(F!==_)}else $===null&&(F.shared.lanes=0);ef|=me,f.lanes=me,f.memoizedState=Mt}}function AI(f,_,T){if(f=_.effects,_.effects=null,f!==null)for(_=0;_<f.length;_++){var D=f[_],F=D.callback;if(F!==null){if(D.callback=null,D=T,typeof F!="function")throw Error(i(191,F));F.call(D)}}}var E_={},bu=Dl(E_),Kp=Dl(E_),v_=Dl(E_);function Ah(f){if(f===E_)throw Error(i(174));return f}function Ob(f,_){switch(Li(v_,_),Li(Kp,f),Li(bu,E_),f=_.nodeType,f){case 9:case 11:_=(_=_.documentElement)?_.namespaceURI:En(null,"");break;default:f=f===8?_.parentNode:_,_=f.namespaceURI||null,f=f.tagName,_=En(_,f)}Ti(bu),Li(bu,_)}function qp(){Ti(bu),Ti(Kp),Ti(v_)}function PI(f){Ah(v_.current);var _=Ah(bu.current),T=En(_,f.type);_!==T&&(Li(Kp,f),Li(bu,T))}function Nb(f){Kp.current===f&&(Ti(bu),Ti(Kp))}var ts=Dl(0);function GE(f){for(var _=f;_!==null;){if(_.tag===13){var T=_.memoizedState;if(T!==null&&(T=T.dehydrated,T===null||T.data==="$?"||T.data==="$!"))return _}else if(_.tag===19&&_.memoizedProps.revealOrder!==void 0){if((_.flags&128)!==0)return _}else if(_.child!==null){_.child.return=_,_=_.child;continue}if(_===f)break;for(;_.sibling===null;){if(_.return===null||_.return===f)return null;_=_.return}_.sibling.return=_.return,_=_.sibling}return null}var Db=[];function xb(){for(var f=0;f<Db.length;f++)Db[f]._workInProgressVersionPrimary=null;Db.length=0}var S_=ce.ReactCurrentDispatcher,Lb=ce.ReactCurrentBatchConfig,Yp=0,qi=null,Hs=null,ys=null,b_=!1,Pd=!1,w_=0,RD=0;function Yo(){throw Error(i(321))}function Mb(f,_){if(_===null)return!1;for(var T=0;T<_.length&&T<f.length;T++)if(!Ol(f[T],_[T]))return!1;return!0}function Cm(f,_,T,D,F,$){if(Yp=$,qi=_,_.memoizedState=null,_.updateQueue=null,_.lanes=0,S_.current=f===null||f.memoizedState===null?AD:VI,f=T(D,F),Pd){$=0;do{if(Pd=!1,w_=0,25<=$)throw Error(i(301));$+=1,ys=Hs=null,_.updateQueue=null,S_.current=PD,f=T(D,F)}while(Pd)}if(S_.current=Im,_=Hs!==null&&Hs.next!==null,Yp=0,ys=Hs=qi=null,b_=!1,_)throw Error(i(300));return f}function Ub(){var f=w_!==0;return w_=0,f}function Ul(){var f={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return ys===null?qi.memoizedState=ys=f:ys=ys.next=f,ys}function Ha(){if(Hs===null){var f=qi.alternate;f=f!==null?f.memoizedState:null}else f=Hs.next;var _=ys===null?qi.memoizedState:ys.next;if(_!==null)ys=_,Hs=f;else{if(f===null)throw Error(i(310));Hs=f,f={memoizedState:Hs.memoizedState,baseState:Hs.baseState,baseQueue:Hs.baseQueue,queue:Hs.queue,next:null},ys===null?qi.memoizedState=ys=f:ys=ys.next=f}return ys}function Xp(f,_){return typeof _=="function"?_(f):_}function Vb(f){var _=Ha(),T=_.queue;if(T===null)throw Error(i(311));T.lastRenderedReducer=f;var D=Hs,F=D.baseQueue,$=T.pending;if($!==null){if(F!==null){var me=F.next;F.next=$.next,$.next=me}D.baseQueue=F=$,T.pending=null}if(F!==null){$=F.next,D=D.baseState;var Ae=me=null,Ve=null,at=$;do{var Dt=at.lane;if((Yp&Dt)===Dt)Ve!==null&&(Ve=Ve.next={lane:0,action:at.action,hasEagerState:at.hasEagerState,eagerState:at.eagerState,next:null}),D=at.hasEagerState?at.eagerState:f(D,at.action);else{var Mt={lane:Dt,action:at.action,hasEagerState:at.hasEagerState,eagerState:at.eagerState,next:null};Ve===null?(Ae=Ve=Mt,me=D):Ve=Ve.next=Mt,qi.lanes|=Dt,ef|=Dt}at=at.next}while(at!==null&&at!==$);Ve===null?me=D:Ve.next=Ae,Ol(D,_.memoizedState)||($a=!0),_.memoizedState=D,_.baseState=me,_.baseQueue=Ve,T.lastRenderedState=D}if(f=T.interleaved,f!==null){F=f;do $=F.lane,qi.lanes|=$,ef|=$,F=F.next;while(F!==f)}else F===null&&(T.lanes=0);return[_.memoizedState,T.dispatch]}function Fb(f){var _=Ha(),T=_.queue;if(T===null)throw Error(i(311));T.lastRenderedReducer=f;var D=T.dispatch,F=T.pending,$=_.memoizedState;if(F!==null){T.pending=null;var me=F=F.next;do $=f($,me.action),me=me.next;while(me!==F);Ol($,_.memoizedState)||($a=!0),_.memoizedState=$,_.baseQueue===null&&(_.baseState=$),T.lastRenderedState=$}return[$,D]}function kI(){}function OI(f,_){var T=qi,D=Ha(),F=_(),$=!Ol(D.memoizedState,F);if($&&(D.memoizedState=F,$a=!0),D=D.queue,KE(DI.bind(null,T,D,f),[f]),D.getSnapshot!==_||$||ys!==null&&ys.memoizedState.tag&1){if(T.flags|=2048,kd(9,T_.bind(null,T,D,F,_),void 0,null),$s===null)throw Error(i(349));(Yp&30)!==0||NI(T,_,F)}return F}function NI(f,_,T){f.flags|=16384,f={getSnapshot:_,value:T},_=qi.updateQueue,_===null?(_={lastEffect:null,stores:null},qi.updateQueue=_,_.stores=[f]):(T=_.stores,T===null?_.stores=[f]:T.push(f))}function T_(f,_,T,D){_.value=T,_.getSnapshot=D,Jp(_)&&HE(f)}function DI(f,_,T){return T(function(){Jp(_)&&HE(f)})}function Jp(f){var _=f.getSnapshot;f=f.value;try{var T=_();return!Ol(f,T)}catch{return!0}}function HE(f){var _=Rd(f,1);_!==null&&vc(_,f,1,-1)}function C_(f){var _=Ul();return typeof f=="function"&&(f=f()),_.memoizedState=_.baseState=f,f={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:Xp,lastRenderedState:f},_.queue=f,f=f.dispatch=Qp.bind(null,qi,f),[_.memoizedState,f]}function kd(f,_,T,D){return f={tag:f,create:_,destroy:T,deps:D,next:null},_=qi.updateQueue,_===null?(_={lastEffect:null,stores:null},qi.updateQueue=_,_.lastEffect=f.next=f):(T=_.lastEffect,T===null?_.lastEffect=f.next=f:(D=T.next,T.next=f,f.next=D,_.lastEffect=f)),f}function R_(){return Ha().memoizedState}function $E(f,_,T,D){var F=Ul();qi.flags|=f,F.memoizedState=kd(1|_,T,void 0,D===void 0?null:D)}function I_(f,_,T,D){var F=Ha();D=D===void 0?null:D;var $=void 0;if(Hs!==null){var me=Hs.memoizedState;if($=me.destroy,D!==null&&Mb(D,me.deps)){F.memoizedState=kd(_,T,$,D);return}}qi.flags|=f,F.memoizedState=kd(1|_,T,$,D)}function xI(f,_){return $E(8390656,8,f,_)}function KE(f,_){return I_(2048,8,f,_)}function LI(f,_){return I_(4,2,f,_)}function MI(f,_){return I_(4,4,f,_)}function qE(f,_){if(typeof _=="function")return f=f(),_(f),function(){_(null)};if(_!=null)return f=f(),_.current=f,function(){_.current=null}}function YE(f,_,T){return T=T!=null?T.concat([f]):null,I_(4,4,qE.bind(null,_,f),T)}function jb(){}function UI(f,_){var T=Ha();_=_===void 0?null:_;var D=T.memoizedState;return D!==null&&_!==null&&Mb(_,D[1])?D[0]:(T.memoizedState=[f,_],f)}function Bb(f,_){var T=Ha();_=_===void 0?null:_;var D=T.memoizedState;return D!==null&&_!==null&&Mb(_,D[1])?D[0]:(f=f(),T.memoizedState=[f,_],f)}function XE(f,_,T){return(Yp&21)===0?(f.baseState&&(f.baseState=!1,$a=!0),f.memoizedState=T):(Ol(T,_)||(T=md(),qi.lanes|=T,ef|=T,f.baseState=!0),_)}function ID(f,_){var T=mr;mr=T!==0&&4>T?T:4,f(!0);var D=Lb.transition;Lb.transition={};try{f(!1),_()}finally{mr=T,Lb.transition=D}}function Vl(){return Ha().memoizedState}function Rm(f,_,T){var D=Lh(f);if(T={lane:D,action:T,hasEagerState:!1,eagerState:null,next:null},zb(f))Wb(_,T);else if(T=Pb(f,_,T,D),T!==null){var F=va();vc(T,f,D,F),Ph(T,_,D)}}function Qp(f,_,T){var D=Lh(f),F={lane:D,action:T,hasEagerState:!1,eagerState:null,next:null};if(zb(f))Wb(_,F);else{var $=f.alternate;if(f.lanes===0&&($===null||$.lanes===0)&&($=_.lastRenderedReducer,$!==null))try{var me=_.lastRenderedState,Ae=$(me,T);if(F.hasEagerState=!0,F.eagerState=Ae,Ol(Ae,me)){var Ve=_.interleaved;Ve===null?(F.next=F,Ab(_)):(F.next=Ve.next,Ve.next=F),_.interleaved=F;return}}catch{}finally{}T=Pb(f,_,F,D),T!==null&&(F=va(),vc(T,f,D,F),Ph(T,_,D))}}function zb(f){var _=f.alternate;return f===qi||_!==null&&_===qi}function Wb(f,_){Pd=b_=!0;var T=f.pending;T===null?_.next=_:(_.next=T.next,T.next=_),f.pending=_}function Ph(f,_,T){if((T&4194240)!==0){var D=_.lanes;D&=f.pendingLanes,T|=D,_.lanes=T,pu(f,T)}}var Im={readContext:zc,useCallback:Yo,useContext:Yo,useEffect:Yo,useImperativeHandle:Yo,useInsertionEffect:Yo,useLayoutEffect:Yo,useMemo:Yo,useReducer:Yo,useRef:Yo,useState:Yo,useDebugValue:Yo,useDeferredValue:Yo,useTransition:Yo,useMutableSource:Yo,useSyncExternalStore:Yo,useId:Yo,unstable_isNewReconciler:!1},AD={readContext:zc,useCallback:function(f,_){return Ul().memoizedState=[f,_===void 0?null:_],f},useContext:zc,useEffect:xI,useImperativeHandle:function(f,_,T){return T=T!=null?T.concat([f]):null,$E(4194308,4,qE.bind(null,_,f),T)},useLayoutEffect:function(f,_){return $E(4194308,4,f,_)},useInsertionEffect:function(f,_){return $E(4,2,f,_)},useMemo:function(f,_){var T=Ul();return _=_===void 0?null:_,f=f(),T.memoizedState=[f,_],f},useReducer:function(f,_,T){var D=Ul();return _=T!==void 0?T(_):_,D.memoizedState=D.baseState=_,f={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:f,lastRenderedState:_},D.queue=f,f=f.dispatch=Rm.bind(null,qi,f),[D.memoizedState,f]},useRef:function(f){var _=Ul();return f={current:f},_.memoizedState=f},useState:C_,useDebugValue:jb,useDeferredValue:function(f){return Ul().memoizedState=f},useTransition:function(){var f=C_(!1),_=f[0];return f=ID.bind(null,f[1]),Ul().memoizedState=f,[_,f]},useMutableSource:function(){},useSyncExternalStore:function(f,_,T){var D=qi,F=Ul();if(Bi){if(T===void 0)throw Error(i(407));T=T()}else{if(T=_(),$s===null)throw Error(i(349));(Yp&30)!==0||NI(D,_,T)}F.memoizedState=T;var $={value:T,getSnapshot:_};return F.queue=$,xI(DI.bind(null,D,$,f),[f]),D.flags|=2048,kd(9,T_.bind(null,D,$,T,_),void 0,null),T},useId:function(){var f=Ul(),_=$s.identifierPrefix;if(Bi){var T=Cd,D=Td;T=(D&~(1<<32-wo(D)-1)).toString(32)+T,_=":"+_+"R"+T,T=w_++,0<T&&(_+="H"+T.toString(32)),_+=":"}else T=RD++,_=":"+_+"r"+T.toString(32)+":";return f.memoizedState=_},unstable_isNewReconciler:!1},VI={readContext:zc,useCallback:UI,useContext:zc,useEffect:KE,useImperativeHandle:YE,useInsertionEffect:LI,useLayoutEffect:MI,useMemo:Bb,useReducer:Vb,useRef:R_,useState:function(){return Vb(Xp)},useDebugValue:jb,useDeferredValue:function(f){var _=Ha();return XE(_,Hs.memoizedState,f)},useTransition:function(){var f=Vb(Xp)[0],_=Ha().memoizedState;return[f,_]},useMutableSource:kI,useSyncExternalStore:OI,useId:Vl,unstable_isNewReconciler:!1},PD={readContext:zc,useCallback:UI,useContext:zc,useEffect:KE,useImperativeHandle:YE,useInsertionEffect:LI,useLayoutEffect:MI,useMemo:Bb,useReducer:Fb,useRef:R_,useState:function(){return Fb(Xp)},useDebugValue:jb,useDeferredValue:function(f){var _=Ha();return Hs===null?_.memoizedState=f:XE(_,Hs.memoizedState,f)},useTransition:function(){var f=Fb(Xp)[0],_=Ha().memoizedState;return[f,_]},useMutableSource:kI,useSyncExternalStore:OI,useId:Vl,unstable_isNewReconciler:!1};function Wc(f,_){if(f&&f.defaultProps){_=Oe({},_),f=f.defaultProps;for(var T in f)_[T]===void 0&&(_[T]=f[T]);return _}return _}function JE(f,_,T,D){_=f.memoizedState,T=T(D,_),T=T==null?_:Oe({},_,T),f.memoizedState=T,f.lanes===0&&(f.updateQueue.baseState=T)}var QE={isMounted:function(f){return(f=f._reactInternals)?es(f)===f:!1},enqueueSetState:function(f,_,T){f=f._reactInternals;var D=va(),F=Lh(f),$=Ad(D,F);$.payload=_,T!=null&&($.callback=T),_=Ml(f,$,F),_!==null&&(vc(_,f,F,D),zE(_,f,F))},enqueueReplaceState:function(f,_,T){f=f._reactInternals;var D=va(),F=Lh(f),$=Ad(D,F);$.tag=1,$.payload=_,T!=null&&($.callback=T),_=Ml(f,$,F),_!==null&&(vc(_,f,F,D),zE(_,f,F))},enqueueForceUpdate:function(f,_){f=f._reactInternals;var T=va(),D=Lh(f),F=Ad(T,D);F.tag=2,_!=null&&(F.callback=_),_=Ml(f,F,D),_!==null&&(vc(_,f,D,T),zE(_,f,D))}};function Od(f,_,T,D,F,$,me){return f=f.stateNode,typeof f.shouldComponentUpdate=="function"?f.shouldComponentUpdate(D,$,me):_.prototype&&_.prototype.isPureReactComponent?!dm(T,D)||!dm(F,$):!0}function FI(f,_,T){var D=!1,F=wh,$=_.contextType;return typeof $=="object"&&$!==null?$=zc($):(F=Ga(_)?Th:qo.current,D=_.contextTypes,$=(D=D!=null)?Ch(f,F):wh),_=new _(T,$),f.memoizedState=_.state!==null&&_.state!==void 0?_.state:null,_.updater=QE,f.stateNode=_,_._reactInternals=f,D&&(f=f.stateNode,f.__reactInternalMemoizedUnmaskedChildContext=F,f.__reactInternalMemoizedMaskedChildContext=$),_}function jI(f,_,T,D){f=_.state,typeof _.componentWillReceiveProps=="function"&&_.componentWillReceiveProps(T,D),typeof _.UNSAFE_componentWillReceiveProps=="function"&&_.UNSAFE_componentWillReceiveProps(T,D),_.state!==f&&QE.enqueueReplaceState(_,_.state,null)}function Gb(f,_,T,D){var F=f.stateNode;F.props=T,F.state=f.memoizedState,F.refs={},kb(f);var $=_.contextType;typeof $=="object"&&$!==null?F.context=zc($):($=Ga(_)?Th:qo.current,F.context=Ch(f,$)),F.state=f.memoizedState,$=_.getDerivedStateFromProps,typeof $=="function"&&(JE(f,_,$,T),F.state=f.memoizedState),typeof _.getDerivedStateFromProps=="function"||typeof F.getSnapshotBeforeUpdate=="function"||typeof F.UNSAFE_componentWillMount!="function"&&typeof F.componentWillMount!="function"||(_=F.state,typeof F.componentWillMount=="function"&&F.componentWillMount(),typeof F.UNSAFE_componentWillMount=="function"&&F.UNSAFE_componentWillMount(),_!==F.state&&QE.enqueueReplaceState(F,F.state,null),WE(f,T,F,D),F.state=f.memoizedState),typeof F.componentDidMount=="function"&&(f.flags|=4194308)}function Am(f,_){try{var T="",D=_;do T+=lt(D),D=D.return;while(D);var F=T}catch($){F=`
Error generating stack: `+$.message+`
`+$.stack}return{value:f,source:_,stack:F,digest:null}}function ZE(f,_,T){return{value:f,source:null,stack:T??null,digest:_??null}}function Hb(f,_){try{console.error(_.value)}catch(T){setTimeout(function(){throw T})}}var $b=typeof WeakMap=="function"?WeakMap:Map;function Kb(f,_,T){T=Ad(-1,T),T.tag=3,T.payload={element:null};var D=_.value;return T.callback=function(){Jo||(Jo=!0,hw=D),Hb(f,_)},T}function BI(f,_,T){T=Ad(-1,T),T.tag=3;var D=f.type.getDerivedStateFromError;if(typeof D=="function"){var F=_.value;T.payload=function(){return D(F)},T.callback=function(){Hb(f,_)}}var $=f.stateNode;return $!==null&&typeof $.componentDidCatch=="function"&&(T.callback=function(){Hb(f,_),typeof D!="function"&&(Dh===null?Dh=new Set([this]):Dh.add(this));var me=_.stack;this.componentDidCatch(_.value,{componentStack:me!==null?me:""})}),T}function qb(f,_,T){var D=f.pingCache;if(D===null){D=f.pingCache=new $b;var F=new Set;D.set(_,F)}else F=D.get(_),F===void 0&&(F=new Set,D.set(_,F));F.has(T)||(F.add(T),f=sA.bind(null,f,_,T),_.then(f,f))}function zI(f){do{var _;if((_=f.tag===13)&&(_=f.memoizedState,_=_!==null?_.dehydrated!==null:!0),_)return f;f=f.return}while(f!==null);return null}function WI(f,_,T,D,F){return(f.mode&1)===0?(f===_?f.flags|=65536:(f.flags|=128,T.flags|=131072,T.flags&=-52805,T.tag===1&&(T.alternate===null?T.tag=17:(_=Ad(-1,1),_.tag=2,Ml(T,_,1))),T.lanes|=1),f):(f.flags|=65536,f.lanes=F,f)}var kD=ce.ReactCurrentOwner,$a=!1;function Ea(f,_,T,D){_.child=f===null?Tb(_,null,T,D):wm(_,f.child,T,D)}function GI(f,_,T,D,F){T=T.render;var $=_.ref;return Ll(_,F),D=Cm(f,_,T,D,$,F),T=Ub(),f!==null&&!$a?(_.updateQueue=f.updateQueue,_.flags&=-2053,f.lanes&=~F,Nd(f,_,F)):(Bi&&T&&vm(_),_.flags|=1,Ea(f,_,D,F),_.child)}function HI(f,_,T,D,F){if(f===null){var $=T.type;return typeof $=="function"&&!bw($)&&$.defaultProps===void 0&&T.compare===null&&T.defaultProps===void 0?(_.tag=15,_.type=$,Yb(f,_,$,D,F)):(f=xm(T.type,null,D,_,_.mode,F),f.ref=_.ref,f.return=_,_.child=f)}if($=f.child,(f.lanes&F)===0){var me=$.memoizedProps;if(T=T.compare,T=T!==null?T:dm,T(me,D)&&f.ref===_.ref)return Nd(f,_,F)}return _.flags|=1,f=Fh($,D),f.ref=_.ref,f.return=_,_.child=f}function Yb(f,_,T,D,F){if(f!==null){var $=f.memoizedProps;if(dm($,D)&&f.ref===_.ref)if($a=!1,_.pendingProps=D=$,(f.lanes&F)!==0)(f.flags&131072)!==0&&($a=!0);else return _.lanes=f.lanes,Nd(f,_,F)}return Xb(f,_,T,D,F)}function wu(f,_,T){var D=_.pendingProps,F=D.children,$=f!==null?f.memoizedState:null;if(D.mode==="hidden")if((_.mode&1)===0)_.memoizedState={baseLanes:0,cachePool:null,transitions:null},Li(Pm,Ec),Ec|=T;else{if((T&1073741824)===0)return f=$!==null?$.baseLanes|T:T,_.lanes=_.childLanes=1073741824,_.memoizedState={baseLanes:f,cachePool:null,transitions:null},_.updateQueue=null,Li(Pm,Ec),Ec|=f,null;_.memoizedState={baseLanes:0,cachePool:null,transitions:null},D=$!==null?$.baseLanes:T,Li(Pm,Ec),Ec|=D}else $!==null?(D=$.baseLanes|T,_.memoizedState=null):D=T,Li(Pm,Ec),Ec|=D;return Ea(f,_,F,T),_.child}function $I(f,_){var T=_.ref;(f===null&&T!==null||f!==null&&f.ref!==T)&&(_.flags|=512,_.flags|=2097152)}function Xb(f,_,T,D,F){var $=Ga(T)?Th:qo.current;return $=Ch(_,$),Ll(_,F),T=Cm(f,_,T,D,$,F),D=Ub(),f!==null&&!$a?(_.updateQueue=f.updateQueue,_.flags&=-2053,f.lanes&=~F,Nd(f,_,F)):(Bi&&D&&vm(_),_.flags|=1,Ea(f,_,T,F),_.child)}function KI(f,_,T,D,F){if(Ga(T)){var $=!0;DE(_)}else $=!1;if(Ll(_,F),_.stateNode===null)nv(f,_),FI(_,T,D),Gb(_,T,D,F),D=!0;else if(f===null){var me=_.stateNode,Ae=_.memoizedProps;me.props=Ae;var Ve=me.context,at=T.contextType;typeof at=="object"&&at!==null?at=zc(at):(at=Ga(T)?Th:qo.current,at=Ch(_,at));var Dt=T.getDerivedStateFromProps,Mt=typeof Dt=="function"||typeof me.getSnapshotBeforeUpdate=="function";Mt||typeof me.UNSAFE_componentWillReceiveProps!="function"&&typeof me.componentWillReceiveProps!="function"||(Ae!==D||Ve!==at)&&jI(_,me,D,at),Id=!1;var Nt=_.memoizedState;me.state=Nt,WE(_,D,me,F),Ve=_.memoizedState,Ae!==D||Nt!==Ve||_a.current||Id?(typeof Dt=="function"&&(JE(_,T,Dt,D),Ve=_.memoizedState),(Ae=Id||Od(_,T,Ae,D,Nt,Ve,at))?(Mt||typeof me.UNSAFE_componentWillMount!="function"&&typeof me.componentWillMount!="function"||(typeof me.componentWillMount=="function"&&me.componentWillMount(),typeof me.UNSAFE_componentWillMount=="function"&&me.UNSAFE_componentWillMount()),typeof me.componentDidMount=="function"&&(_.flags|=4194308)):(typeof me.componentDidMount=="function"&&(_.flags|=4194308),_.memoizedProps=D,_.memoizedState=Ve),me.props=D,me.state=Ve,me.context=at,D=Ae):(typeof me.componentDidMount=="function"&&(_.flags|=4194308),D=!1)}else{me=_.stateNode,RI(f,_),Ae=_.memoizedProps,at=_.type===_.elementType?Ae:Wc(_.type,Ae),me.props=at,Mt=_.pendingProps,Nt=me.context,Ve=T.contextType,typeof Ve=="object"&&Ve!==null?Ve=zc(Ve):(Ve=Ga(T)?Th:qo.current,Ve=Ch(_,Ve));var nn=T.getDerivedStateFromProps;(Dt=typeof nn=="function"||typeof me.getSnapshotBeforeUpdate=="function")||typeof me.UNSAFE_componentWillReceiveProps!="function"&&typeof me.componentWillReceiveProps!="function"||(Ae!==Mt||Nt!==Ve)&&jI(_,me,D,Ve),Id=!1,Nt=_.memoizedState,me.state=Nt,WE(_,D,me,F);var dn=_.memoizedState;Ae!==Mt||Nt!==dn||_a.current||Id?(typeof nn=="function"&&(JE(_,T,nn,D),dn=_.memoizedState),(at=Id||Od(_,T,at,D,Nt,dn,Ve)||!1)?(Dt||typeof me.UNSAFE_componentWillUpdate!="function"&&typeof me.componentWillUpdate!="function"||(typeof me.componentWillUpdate=="function"&&me.componentWillUpdate(D,dn,Ve),typeof me.UNSAFE_componentWillUpdate=="function"&&me.UNSAFE_componentWillUpdate(D,dn,Ve)),typeof me.componentDidUpdate=="function"&&(_.flags|=4),typeof me.getSnapshotBeforeUpdate=="function"&&(_.flags|=1024)):(typeof me.componentDidUpdate!="function"||Ae===f.memoizedProps&&Nt===f.memoizedState||(_.flags|=4),typeof me.getSnapshotBeforeUpdate!="function"||Ae===f.memoizedProps&&Nt===f.memoizedState||(_.flags|=1024),_.memoizedProps=D,_.memoizedState=dn),me.props=D,me.state=dn,me.context=Ve,D=at):(typeof me.componentDidUpdate!="function"||Ae===f.memoizedProps&&Nt===f.memoizedState||(_.flags|=4),typeof me.getSnapshotBeforeUpdate!="function"||Ae===f.memoizedProps&&Nt===f.memoizedState||(_.flags|=1024),D=!1)}return Jb(f,_,T,D,$,F)}function Jb(f,_,T,D,F,$){$I(f,_);var me=(_.flags&128)!==0;if(!D&&!me)return F&&SI(_,T,!1),Nd(f,_,$);D=_.stateNode,kD.current=_;var Ae=me&&typeof T.getDerivedStateFromError!="function"?null:D.render();return _.flags|=1,f!==null&&me?(_.child=wm(_,f.child,null,$),_.child=wm(_,null,Ae,$)):Ea(f,_,Ae,$),_.memoizedState=D.state,F&&SI(_,T,!0),_.child}function qI(f){var _=f.stateNode;_.pendingContext?ym(f,_.pendingContext,_.pendingContext!==_.context):_.context&&ym(f,_.context,!1),Ob(f,_.containerInfo)}function YI(f,_,T,D,F){return Hp(),bm(F),_.flags|=256,Ea(f,_,T,D),_.child}var A_={dehydrated:null,treeContext:null,retryLane:0};function Qb(f){return{baseLanes:f,cachePool:null,transitions:null}}function XI(f,_,T){var D=_.pendingProps,F=ts.current,$=!1,me=(_.flags&128)!==0,Ae;if((Ae=me)||(Ae=f!==null&&f.memoizedState===null?!1:(F&2)!==0),Ae?($=!0,_.flags&=-129):(f===null||f.memoizedState!==null)&&(F|=1),Li(ts,F&1),f===null)return g_(_),f=_.memoizedState,f!==null&&(f=f.dehydrated,f!==null)?((_.mode&1)===0?_.lanes=1:f.data==="$!"?_.lanes=8:_.lanes=1073741824,null):(me=D.children,f=D.fallback,$?(D=_.mode,$=_.child,me={mode:"hidden",children:me},(D&1)===0&&$!==null?($.childLanes=0,$.pendingProps=me):$=F_(me,D,0,null),f=jh(f,D,T,null),$.return=_,f.return=_,$.sibling=f,_.child=$,_.child.memoizedState=Qb(T),_.memoizedState=A_,f):Zb(_,me));if(F=f.memoizedState,F!==null&&(Ae=F.dehydrated,Ae!==null))return OD(f,_,me,D,Ae,F,T);if($){$=D.fallback,me=_.mode,F=f.child,Ae=F.sibling;var Ve={mode:"hidden",children:D.children};return(me&1)===0&&_.child!==F?(D=_.child,D.childLanes=0,D.pendingProps=Ve,_.deletions=null):(D=Fh(F,Ve),D.subtreeFlags=F.subtreeFlags&14680064),Ae!==null?$=Fh(Ae,$):($=jh($,me,T,null),$.flags|=2),$.return=_,D.return=_,D.sibling=$,_.child=D,D=$,$=_.child,me=f.child.memoizedState,me=me===null?Qb(T):{baseLanes:me.baseLanes|T,cachePool:null,transitions:me.transitions},$.memoizedState=me,$.childLanes=f.childLanes&~T,_.memoizedState=A_,D}return $=f.child,f=$.sibling,D=Fh($,{mode:"visible",children:D.children}),(_.mode&1)===0&&(D.lanes=T),D.return=_,D.sibling=null,f!==null&&(T=_.deletions,T===null?(_.deletions=[f],_.flags|=16):T.push(f)),_.child=D,_.memoizedState=null,D}function Zb(f,_){return _=F_({mode:"visible",children:_},f.mode,0,null),_.return=f,f.child=_}function ev(f,_,T,D){return D!==null&&bm(D),wm(_,f.child,null,T),f=Zb(_,_.pendingProps.children),f.flags|=2,_.memoizedState=null,f}function OD(f,_,T,D,F,$,me){if(T)return _.flags&256?(_.flags&=-257,D=ZE(Error(i(422))),ev(f,_,me,D)):_.memoizedState!==null?(_.child=f.child,_.flags|=128,null):($=D.fallback,F=_.mode,D=F_({mode:"visible",children:D.children},F,0,null),$=jh($,F,me,null),$.flags|=2,D.return=_,$.return=_,D.sibling=$,_.child=D,(_.mode&1)!==0&&wm(_,f.child,null,me),_.child.memoizedState=Qb(me),_.memoizedState=A_,$);if((_.mode&1)===0)return ev(f,_,me,null);if(F.data==="$!"){if(D=F.nextSibling&&F.nextSibling.dataset,D)var Ae=D.dgst;return D=Ae,$=Error(i(419)),D=ZE($,D,void 0),ev(f,_,me,D)}if(Ae=(me&f.childLanes)!==0,$a||Ae){if(D=$s,D!==null){switch(me&-me){case 4:F=2;break;case 16:F=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:F=32;break;case 536870912:F=268435456;break;default:F=0}F=(F&(D.suspendedLanes|me))!==0?0:F,F!==0&&F!==$.retryLane&&($.retryLane=F,Rd(f,F),vc(D,f,F,-1))}return Nm(),D=ZE(Error(i(421))),ev(f,_,me,D)}return F.data==="$?"?(_.flags|=128,_.child=f.child,_=FD.bind(null,f),F._reactRetry=_,null):(f=$.treeContext,_c=vu(F.nextSibling),gc=_,Bi=!0,xl=null,f!==null&&(ya[Bc++]=Td,ya[Bc++]=Cd,ya[Bc++]=Wp,Td=f.id,Cd=f.overflow,Wp=_),_=Zb(_,D.children),_.flags|=4096,_)}function JI(f,_,T){f.lanes|=_;var D=f.alternate;D!==null&&(D.lanes|=_),BE(f.return,_,T)}function tv(f,_,T,D,F){var $=f.memoizedState;$===null?f.memoizedState={isBackwards:_,rendering:null,renderingStartTime:0,last:D,tail:T,tailMode:F}:($.isBackwards=_,$.rendering=null,$.renderingStartTime=0,$.last=D,$.tail=T,$.tailMode=F)}function ew(f,_,T){var D=_.pendingProps,F=D.revealOrder,$=D.tail;if(Ea(f,_,D.children,T),D=ts.current,(D&2)!==0)D=D&1|2,_.flags|=128;else{if(f!==null&&(f.flags&128)!==0)e:for(f=_.child;f!==null;){if(f.tag===13)f.memoizedState!==null&&JI(f,T,_);else if(f.tag===19)JI(f,T,_);else if(f.child!==null){f.child.return=f,f=f.child;continue}if(f===_)break e;for(;f.sibling===null;){if(f.return===null||f.return===_)break e;f=f.return}f.sibling.return=f.return,f=f.sibling}D&=1}if(Li(ts,D),(_.mode&1)===0)_.memoizedState=null;else switch(F){case"forwards":for(T=_.child,F=null;T!==null;)f=T.alternate,f!==null&&GE(f)===null&&(F=T),T=T.sibling;T=F,T===null?(F=_.child,_.child=null):(F=T.sibling,T.sibling=null),tv(_,!1,F,T,$);break;case"backwards":for(T=null,F=_.child,_.child=null;F!==null;){if(f=F.alternate,f!==null&&GE(f)===null){_.child=F;break}f=F.sibling,F.sibling=T,T=F,F=f}tv(_,!0,T,null,$);break;case"together":tv(_,!1,null,null,void 0);break;default:_.memoizedState=null}return _.child}function nv(f,_){(_.mode&1)===0&&f!==null&&(f.alternate=null,_.alternate=null,_.flags|=2)}function Nd(f,_,T){if(f!==null&&(_.dependencies=f.dependencies),ef|=_.lanes,(T&_.childLanes)===0)return null;if(f!==null&&_.child!==f.child)throw Error(i(153));if(_.child!==null){for(f=_.child,T=Fh(f,f.pendingProps),_.child=T,T.return=_;f.sibling!==null;)f=f.sibling,T=T.sibling=Fh(f,f.pendingProps),T.return=_;T.sibling=null}return _.child}function rv(f,_,T){switch(_.tag){case 3:qI(_),Hp();break;case 5:PI(_);break;case 1:Ga(_.type)&&DE(_);break;case 4:Ob(_,_.stateNode.containerInfo);break;case 10:var D=_.type._context,F=_.memoizedProps.value;Li(FE,D._currentValue),D._currentValue=F;break;case 13:if(D=_.memoizedState,D!==null)return D.dehydrated!==null?(Li(ts,ts.current&1),_.flags|=128,null):(T&_.child.childLanes)!==0?XI(f,_,T):(Li(ts,ts.current&1),f=Nd(f,_,T),f!==null?f.sibling:null);Li(ts,ts.current&1);break;case 19:if(D=(T&_.childLanes)!==0,(f.flags&128)!==0){if(D)return ew(f,_,T);_.flags|=128}if(F=_.memoizedState,F!==null&&(F.rendering=null,F.tail=null,F.lastEffect=null),Li(ts,ts.current),D)break;return null;case 22:case 23:return _.lanes=0,wu(f,_,T)}return Nd(f,_,T)}var iv,sv,P_,tw;iv=function(f,_){for(var T=_.child;T!==null;){if(T.tag===5||T.tag===6)f.appendChild(T.stateNode);else if(T.tag!==4&&T.child!==null){T.child.return=T,T=T.child;continue}if(T===_)break;for(;T.sibling===null;){if(T.return===null||T.return===_)return;T=T.return}T.sibling.return=T.return,T=T.sibling}},sv=function(){},P_=function(f,_,T,D){var F=f.memoizedProps;if(F!==D){f=_.stateNode,Ah(bu.current);var $=null;switch(T){case"input":F=ut(f,F),D=ut(f,D),$=[];break;case"select":F=Oe({},F,{value:void 0}),D=Oe({},D,{value:void 0}),$=[];break;case"textarea":F=Ot(f,F),D=Ot(f,D),$=[];break;default:typeof F.onClick!="function"&&typeof D.onClick=="function"&&(f.onclick=h_)}Xn(T,D);var me;T=null;for(at in F)if(!D.hasOwnProperty(at)&&F.hasOwnProperty(at)&&F[at]!=null)if(at==="style"){var Ae=F[at];for(me in Ae)Ae.hasOwnProperty(me)&&(T||(T={}),T[me]="")}else at!=="dangerouslySetInnerHTML"&&at!=="children"&&at!=="suppressContentEditableWarning"&&at!=="suppressHydrationWarning"&&at!=="autoFocus"&&(l.hasOwnProperty(at)?$||($=[]):($=$||[]).push(at,null));for(at in D){var Ve=D[at];if(Ae=F!=null?F[at]:void 0,D.hasOwnProperty(at)&&Ve!==Ae&&(Ve!=null||Ae!=null))if(at==="style")if(Ae){for(me in Ae)!Ae.hasOwnProperty(me)||Ve&&Ve.hasOwnProperty(me)||(T||(T={}),T[me]="");for(me in Ve)Ve.hasOwnProperty(me)&&Ae[me]!==Ve[me]&&(T||(T={}),T[me]=Ve[me])}else T||($||($=[]),$.push(at,T)),T=Ve;else at==="dangerouslySetInnerHTML"?(Ve=Ve?Ve.__html:void 0,Ae=Ae?Ae.__html:void 0,Ve!=null&&Ae!==Ve&&($=$||[]).push(at,Ve)):at==="children"?typeof Ve!="string"&&typeof Ve!="number"||($=$||[]).push(at,""+Ve):at!=="suppressContentEditableWarning"&&at!=="suppressHydrationWarning"&&(l.hasOwnProperty(at)?(Ve!=null&&at==="onScroll"&&xi("scroll",f),$||Ae===Ve||($=[])):($=$||[]).push(at,Ve))}T&&($=$||[]).push("style",T);var at=$;(_.updateQueue=at)&&(_.flags|=4)}},tw=function(f,_,T,D){T!==D&&(_.flags|=4)};function k_(f,_){if(!Bi)switch(f.tailMode){case"hidden":_=f.tail;for(var T=null;_!==null;)_.alternate!==null&&(T=_),_=_.sibling;T===null?f.tail=null:T.sibling=null;break;case"collapsed":T=f.tail;for(var D=null;T!==null;)T.alternate!==null&&(D=T),T=T.sibling;D===null?_||f.tail===null?f.tail=null:f.tail.sibling=null:D.sibling=null}}function Co(f){var _=f.alternate!==null&&f.alternate.child===f.child,T=0,D=0;if(_)for(var F=f.child;F!==null;)T|=F.lanes|F.childLanes,D|=F.subtreeFlags&14680064,D|=F.flags&14680064,F.return=f,F=F.sibling;else for(F=f.child;F!==null;)T|=F.lanes|F.childLanes,D|=F.subtreeFlags,D|=F.flags,F.return=f,F=F.sibling;return f.subtreeFlags|=D,f.childLanes=T,_}function ov(f,_,T){var D=_.pendingProps;switch(UE(_),_.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Co(_),null;case 1:return Ga(_.type)&&NE(),Co(_),null;case 3:return D=_.stateNode,qp(),Ti(_a),Ti(qo),xb(),D.pendingContext&&(D.context=D.pendingContext,D.pendingContext=null),(f===null||f.child===null)&&(Sm(_)?_.flags|=4:f===null||f.memoizedState.isDehydrated&&(_.flags&256)===0||(_.flags|=1024,xl!==null&&(fw(xl),xl=null))),sv(f,_),Co(_),null;case 5:Nb(_);var F=Ah(v_.current);if(T=_.type,f!==null&&_.stateNode!=null)P_(f,_,T,D,F),f.ref!==_.ref&&(_.flags|=512,_.flags|=2097152);else{if(!D){if(_.stateNode===null)throw Error(i(166));return Co(_),null}if(f=Ah(bu.current),Sm(_)){D=_.stateNode,T=_.type;var $=_.memoizedProps;switch(D[Su]=_,D[p_]=$,f=(_.mode&1)!==0,T){case"dialog":xi("cancel",D),xi("close",D);break;case"iframe":case"object":case"embed":xi("load",D);break;case"video":case"audio":for(F=0;F<c_.length;F++)xi(c_[F],D);break;case"source":xi("error",D);break;case"img":case"image":case"link":xi("error",D),xi("load",D);break;case"details":xi("toggle",D);break;case"input":Ft(D,$),xi("invalid",D);break;case"select":D._wrapperState={wasMultiple:!!$.multiple},xi("invalid",D);break;case"textarea":Et(D,$),xi("invalid",D)}Xn(T,$),F=null;for(var me in $)if($.hasOwnProperty(me)){var Ae=$[me];me==="children"?typeof Ae=="string"?D.textContent!==Ae&&($.suppressHydrationWarning!==!0&&d_(D.textContent,Ae,f),F=["children",Ae]):typeof Ae=="number"&&D.textContent!==""+Ae&&($.suppressHydrationWarning!==!0&&d_(D.textContent,Ae,f),F=["children",""+Ae]):l.hasOwnProperty(me)&&Ae!=null&&me==="onScroll"&&xi("scroll",D)}switch(T){case"input":un(D),Se(D,$,!0);break;case"textarea":un(D),pn(D);break;case"select":case"option":break;default:typeof $.onClick=="function"&&(D.onclick=h_)}D=F,_.updateQueue=D,D!==null&&(_.flags|=4)}else{me=F.nodeType===9?F:F.ownerDocument,f==="http://www.w3.org/1999/xhtml"&&(f=Cn(T)),f==="http://www.w3.org/1999/xhtml"?T==="script"?(f=me.createElement("div"),f.innerHTML="<script><\/script>",f=f.removeChild(f.firstChild)):typeof D.is=="string"?f=me.createElement(T,{is:D.is}):(f=me.createElement(T),T==="select"&&(me=f,D.multiple?me.multiple=!0:D.size&&(me.size=D.size))):f=me.createElementNS(f,T),f[Su]=_,f[p_]=D,iv(f,_,!1,!1),_.stateNode=f;e:{switch(me=oa(T,D),T){case"dialog":xi("cancel",f),xi("close",f),F=D;break;case"iframe":case"object":case"embed":xi("load",f),F=D;break;case"video":case"audio":for(F=0;F<c_.length;F++)xi(c_[F],f);F=D;break;case"source":xi("error",f),F=D;break;case"img":case"image":case"link":xi("error",f),xi("load",f),F=D;break;case"details":xi("toggle",f),F=D;break;case"input":Ft(f,D),F=ut(f,D),xi("invalid",f);break;case"option":F=D;break;case"select":f._wrapperState={wasMultiple:!!D.multiple},F=Oe({},D,{value:void 0}),xi("invalid",f);break;case"textarea":Et(f,D),F=Ot(f,D),xi("invalid",f);break;default:F=D}Xn(T,F),Ae=F;for($ in Ae)if(Ae.hasOwnProperty($)){var Ve=Ae[$];$==="style"?ji(f,Ve):$==="dangerouslySetInnerHTML"?(Ve=Ve?Ve.__html:void 0,Ve!=null&&cr(f,Ve)):$==="children"?typeof Ve=="string"?(T!=="textarea"||Ve!=="")&&Lt(f,Ve):typeof Ve=="number"&&Lt(f,""+Ve):$!=="suppressContentEditableWarning"&&$!=="suppressHydrationWarning"&&$!=="autoFocus"&&(l.hasOwnProperty($)?Ve!=null&&$==="onScroll"&&xi("scroll",f):Ve!=null&&re(f,$,Ve,me))}switch(T){case"input":un(f),Se(f,D,!1);break;case"textarea":un(f),pn(f);break;case"option":D.value!=null&&f.setAttribute("value",""+mt(D.value));break;case"select":f.multiple=!!D.multiple,$=D.value,$!=null?Pt(f,!!D.multiple,$,!1):D.defaultValue!=null&&Pt(f,!!D.multiple,D.defaultValue,!0);break;default:typeof F.onClick=="function"&&(f.onclick=h_)}switch(T){case"button":case"input":case"select":case"textarea":D=!!D.autoFocus;break e;case"img":D=!0;break e;default:D=!1}}D&&(_.flags|=4)}_.ref!==null&&(_.flags|=512,_.flags|=2097152)}return Co(_),null;case 6:if(f&&_.stateNode!=null)tw(f,_,f.memoizedProps,D);else{if(typeof D!="string"&&_.stateNode===null)throw Error(i(166));if(T=Ah(v_.current),Ah(bu.current),Sm(_)){if(D=_.stateNode,T=_.memoizedProps,D[Su]=_,($=D.nodeValue!==T)&&(f=gc,f!==null))switch(f.tag){case 3:d_(D.nodeValue,T,(f.mode&1)!==0);break;case 5:f.memoizedProps.suppressHydrationWarning!==!0&&d_(D.nodeValue,T,(f.mode&1)!==0)}$&&(_.flags|=4)}else D=(T.nodeType===9?T:T.ownerDocument).createTextNode(D),D[Su]=_,_.stateNode=D}return Co(_),null;case 13:if(Ti(ts),D=_.memoizedState,f===null||f.memoizedState!==null&&f.memoizedState.dehydrated!==null){if(Bi&&_c!==null&&(_.mode&1)!==0&&(_.flags&128)===0)bb(),Hp(),_.flags|=98560,$=!1;else if($=Sm(_),D!==null&&D.dehydrated!==null){if(f===null){if(!$)throw Error(i(318));if($=_.memoizedState,$=$!==null?$.dehydrated:null,!$)throw Error(i(317));$[Su]=_}else Hp(),(_.flags&128)===0&&(_.memoizedState=null),_.flags|=4;Co(_),$=!1}else xl!==null&&(fw(xl),xl=null),$=!0;if(!$)return _.flags&65536?_:null}return(_.flags&128)!==0?(_.lanes=T,_):(D=D!==null,D!==(f!==null&&f.memoizedState!==null)&&D&&(_.child.flags|=8192,(_.mode&1)!==0&&(f===null||(ts.current&1)!==0?Ks===0&&(Ks=3):Nm())),_.updateQueue!==null&&(_.flags|=4),Co(_),null);case 4:return qp(),sv(f,_),f===null&&vd(_.stateNode.containerInfo),Co(_),null;case 10:return Ib(_.type._context),Co(_),null;case 17:return Ga(_.type)&&NE(),Co(_),null;case 19:if(Ti(ts),$=_.memoizedState,$===null)return Co(_),null;if(D=(_.flags&128)!==0,me=$.rendering,me===null)if(D)k_($,!1);else{if(Ks!==0||f!==null&&(f.flags&128)!==0)for(f=_.child;f!==null;){if(me=GE(f),me!==null){for(_.flags|=128,k_($,!1),D=me.updateQueue,D!==null&&(_.updateQueue=D,_.flags|=4),_.subtreeFlags=0,D=T,T=_.child;T!==null;)$=T,f=D,$.flags&=14680066,me=$.alternate,me===null?($.childLanes=0,$.lanes=f,$.child=null,$.subtreeFlags=0,$.memoizedProps=null,$.memoizedState=null,$.updateQueue=null,$.dependencies=null,$.stateNode=null):($.childLanes=me.childLanes,$.lanes=me.lanes,$.child=me.child,$.subtreeFlags=0,$.deletions=null,$.memoizedProps=me.memoizedProps,$.memoizedState=me.memoizedState,$.updateQueue=me.updateQueue,$.type=me.type,f=me.dependencies,$.dependencies=f===null?null:{lanes:f.lanes,firstContext:f.firstContext}),T=T.sibling;return Li(ts,ts.current&1|2),_.child}f=f.sibling}$.tail!==null&&In()>Gc&&(_.flags|=128,D=!0,k_($,!1),_.lanes=4194304)}else{if(!D)if(f=GE(me),f!==null){if(_.flags|=128,D=!0,T=f.updateQueue,T!==null&&(_.updateQueue=T,_.flags|=4),k_($,!0),$.tail===null&&$.tailMode==="hidden"&&!me.alternate&&!Bi)return Co(_),null}else 2*In()-$.renderingStartTime>Gc&&T!==1073741824&&(_.flags|=128,D=!0,k_($,!1),_.lanes=4194304);$.isBackwards?(me.sibling=_.child,_.child=me):(T=$.last,T!==null?T.sibling=me:_.child=me,$.last=me)}return $.tail!==null?(_=$.tail,$.rendering=_,$.tail=_.sibling,$.renderingStartTime=In(),_.sibling=null,T=ts.current,Li(ts,D?T&1|2:T&1),_):(Co(_),null);case 22:case 23:return U_(),D=_.memoizedState!==null,f!==null&&f.memoizedState!==null!==D&&(_.flags|=8192),D&&(_.mode&1)!==0?(Ec&1073741824)!==0&&(Co(_),_.subtreeFlags&6&&(_.flags|=8192)):Co(_),null;case 24:return null;case 25:return null}throw Error(i(156,_.tag))}function ND(f,_){switch(UE(_),_.tag){case 1:return Ga(_.type)&&NE(),f=_.flags,f&65536?(_.flags=f&-65537|128,_):null;case 3:return qp(),Ti(_a),Ti(qo),xb(),f=_.flags,(f&65536)!==0&&(f&128)===0?(_.flags=f&-65537|128,_):null;case 5:return Nb(_),null;case 13:if(Ti(ts),f=_.memoizedState,f!==null&&f.dehydrated!==null){if(_.alternate===null)throw Error(i(340));Hp()}return f=_.flags,f&65536?(_.flags=f&-65537|128,_):null;case 19:return Ti(ts),null;case 4:return qp(),null;case 10:return Ib(_.type._context),null;case 22:case 23:return U_(),null;case 24:return null;default:return null}}var O_=!1,Ro=!1,DD=typeof WeakSet=="function"?WeakSet:Set,sn=null;function Zp(f,_){var T=f.ref;if(T!==null)if(typeof T=="function")try{T(null)}catch(D){ns(f,_,D)}else T.current=null}function nw(f,_,T){try{T()}catch(D){ns(f,_,D)}}var QI=!1;function xD(f,_){if(mb=be,f=ab(),cb(f)){if("selectionStart"in f)var T={start:f.selectionStart,end:f.selectionEnd};else e:{T=(T=f.ownerDocument)&&T.defaultView||window;var D=T.getSelection&&T.getSelection();if(D&&D.rangeCount!==0){T=D.anchorNode;var F=D.anchorOffset,$=D.focusNode;D=D.focusOffset;try{T.nodeType,$.nodeType}catch{T=null;break e}var me=0,Ae=-1,Ve=-1,at=0,Dt=0,Mt=f,Nt=null;t:for(;;){for(var nn;Mt!==T||F!==0&&Mt.nodeType!==3||(Ae=me+F),Mt!==$||D!==0&&Mt.nodeType!==3||(Ve=me+D),Mt.nodeType===3&&(me+=Mt.nodeValue.length),(nn=Mt.firstChild)!==null;)Nt=Mt,Mt=nn;for(;;){if(Mt===f)break t;if(Nt===T&&++at===F&&(Ae=me),Nt===$&&++Dt===D&&(Ve=me),(nn=Mt.nextSibling)!==null)break;Mt=Nt,Nt=Mt.parentNode}Mt=nn}T=Ae===-1||Ve===-1?null:{start:Ae,end:Ve}}else T=null}T=T||{start:0,end:0}}else T=null;for(PE={focusedElem:f,selectionRange:T},be=!1,sn=_;sn!==null;)if(_=sn,f=_.child,(_.subtreeFlags&1028)!==0&&f!==null)f.return=_,sn=f;else for(;sn!==null;){_=sn;try{var dn=_.alternate;if((_.flags&1024)!==0)switch(_.tag){case 0:case 11:case 15:break;case 1:if(dn!==null){var fn=dn.memoizedProps,rs=dn.memoizedState,Xe=_.stateNode,Fe=Xe.getSnapshotBeforeUpdate(_.elementType===_.type?fn:Wc(_.type,fn),rs);Xe.__reactInternalSnapshotBeforeUpdate=Fe}break;case 3:var it=_.stateNode.containerInfo;it.nodeType===1?it.textContent="":it.nodeType===9&&it.documentElement&&it.removeChild(it.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(i(163))}}catch(jt){ns(_,_.return,jt)}if(f=_.sibling,f!==null){f.return=_.return,sn=f;break}sn=_.return}return dn=QI,QI=!1,dn}function kh(f,_,T){var D=_.updateQueue;if(D=D!==null?D.lastEffect:null,D!==null){var F=D=D.next;do{if((F.tag&f)===f){var $=F.destroy;F.destroy=void 0,$!==void 0&&nw(_,T,$)}F=F.next}while(F!==D)}}function av(f,_){if(_=_.updateQueue,_=_!==null?_.lastEffect:null,_!==null){var T=_=_.next;do{if((T.tag&f)===f){var D=T.create;T.destroy=D()}T=T.next}while(T!==_)}}function rw(f){var _=f.ref;if(_!==null){var T=f.stateNode;switch(f.tag){case 5:f=T;break;default:f=T}typeof _=="function"?_(f):_.current=f}}function ZI(f){var _=f.alternate;_!==null&&(f.alternate=null,ZI(_)),f.child=null,f.deletions=null,f.sibling=null,f.tag===5&&(_=f.stateNode,_!==null&&(delete _[Su],delete _[p_],delete _[_b],delete _[wD],delete _[TD])),f.stateNode=null,f.return=null,f.dependencies=null,f.memoizedProps=null,f.memoizedState=null,f.pendingProps=null,f.stateNode=null,f.updateQueue=null}function iw(f){return f.tag===5||f.tag===3||f.tag===4}function eA(f){e:for(;;){for(;f.sibling===null;){if(f.return===null||iw(f.return))return null;f=f.return}for(f.sibling.return=f.return,f=f.sibling;f.tag!==5&&f.tag!==6&&f.tag!==18;){if(f.flags&2||f.child===null||f.tag===4)continue e;f.child.return=f,f=f.child}if(!(f.flags&2))return f.stateNode}}function sw(f,_,T){var D=f.tag;if(D===5||D===6)f=f.stateNode,_?T.nodeType===8?T.parentNode.insertBefore(f,_):T.insertBefore(f,_):(T.nodeType===8?(_=T.parentNode,_.insertBefore(f,T)):(_=T,_.appendChild(f)),T=T._reactRootContainer,T!=null||_.onclick!==null||(_.onclick=h_));else if(D!==4&&(f=f.child,f!==null))for(sw(f,_,T),f=f.sibling;f!==null;)sw(f,_,T),f=f.sibling}function N_(f,_,T){var D=f.tag;if(D===5||D===6)f=f.stateNode,_?T.insertBefore(f,_):T.appendChild(f);else if(D!==4&&(f=f.child,f!==null))for(N_(f,_,T),f=f.sibling;f!==null;)N_(f,_,T),f=f.sibling}var Io=null,yc=!1;function Oh(f,_,T){for(T=T.child;T!==null;)ow(f,_,T),T=T.sibling}function ow(f,_,T){if(la&&typeof la.onCommitFiberUnmount=="function")try{la.onCommitFiberUnmount(Mc,T)}catch{}switch(T.tag){case 5:Ro||Zp(T,_);case 6:var D=Io,F=yc;Io=null,Oh(f,_,T),Io=D,yc=F,Io!==null&&(yc?(f=Io,T=T.stateNode,f.nodeType===8?f.parentNode.removeChild(T):f.removeChild(T)):Io.removeChild(T.stateNode));break;case 18:Io!==null&&(yc?(f=Io,T=T.stateNode,f.nodeType===8?kE(f.parentNode,T):f.nodeType===1&&kE(f,T),ma(f)):kE(Io,T.stateNode));break;case 4:D=Io,F=yc,Io=T.stateNode.containerInfo,yc=!0,Oh(f,_,T),Io=D,yc=F;break;case 0:case 11:case 14:case 15:if(!Ro&&(D=T.updateQueue,D!==null&&(D=D.lastEffect,D!==null))){F=D=D.next;do{var $=F,me=$.destroy;$=$.tag,me!==void 0&&(($&2)!==0||($&4)!==0)&&nw(T,_,me),F=F.next}while(F!==D)}Oh(f,_,T);break;case 1:if(!Ro&&(Zp(T,_),D=T.stateNode,typeof D.componentWillUnmount=="function"))try{D.props=T.memoizedProps,D.state=T.memoizedState,D.componentWillUnmount()}catch(Ae){ns(T,_,Ae)}Oh(f,_,T);break;case 21:Oh(f,_,T);break;case 22:T.mode&1?(Ro=(D=Ro)||T.memoizedState!==null,Oh(f,_,T),Ro=D):Oh(f,_,T);break;default:Oh(f,_,T)}}function tA(f){var _=f.updateQueue;if(_!==null){f.updateQueue=null;var T=f.stateNode;T===null&&(T=f.stateNode=new DD),_.forEach(function(D){var F=Dm.bind(null,f,D);T.has(D)||(T.add(D),D.then(F,F))})}}function Fl(f,_){var T=_.deletions;if(T!==null)for(var D=0;D<T.length;D++){var F=T[D];try{var $=f,me=_,Ae=me;e:for(;Ae!==null;){switch(Ae.tag){case 5:Io=Ae.stateNode,yc=!1;break e;case 3:Io=Ae.stateNode.containerInfo,yc=!0;break e;case 4:Io=Ae.stateNode.containerInfo,yc=!0;break e}Ae=Ae.return}if(Io===null)throw Error(i(160));ow($,me,F),Io=null,yc=!1;var Ve=F.alternate;Ve!==null&&(Ve.return=null),F.return=null}catch(at){ns(F,_,at)}}if(_.subtreeFlags&12854)for(_=_.child;_!==null;)aw(_,f),_=_.sibling}function aw(f,_){var T=f.alternate,D=f.flags;switch(f.tag){case 0:case 11:case 14:case 15:if(Fl(_,f),Tu(f),D&4){try{kh(3,f,f.return),av(3,f)}catch(fn){ns(f,f.return,fn)}try{kh(5,f,f.return)}catch(fn){ns(f,f.return,fn)}}break;case 1:Fl(_,f),Tu(f),D&512&&T!==null&&Zp(T,T.return);break;case 5:if(Fl(_,f),Tu(f),D&512&&T!==null&&Zp(T,T.return),f.flags&32){var F=f.stateNode;try{Lt(F,"")}catch(fn){ns(f,f.return,fn)}}if(D&4&&(F=f.stateNode,F!=null)){var $=f.memoizedProps,me=T!==null?T.memoizedProps:$,Ae=f.type,Ve=f.updateQueue;if(f.updateQueue=null,Ve!==null)try{Ae==="input"&&$.type==="radio"&&$.name!=null&&on(F,$),oa(Ae,me);var at=oa(Ae,$);for(me=0;me<Ve.length;me+=2){var Dt=Ve[me],Mt=Ve[me+1];Dt==="style"?ji(F,Mt):Dt==="dangerouslySetInnerHTML"?cr(F,Mt):Dt==="children"?Lt(F,Mt):re(F,Dt,Mt,at)}switch(Ae){case"input":Ht(F,$);break;case"textarea":xt(F,$);break;case"select":var Nt=F._wrapperState.wasMultiple;F._wrapperState.wasMultiple=!!$.multiple;var nn=$.value;nn!=null?Pt(F,!!$.multiple,nn,!1):Nt!==!!$.multiple&&($.defaultValue!=null?Pt(F,!!$.multiple,$.defaultValue,!0):Pt(F,!!$.multiple,$.multiple?[]:"",!1))}F[p_]=$}catch(fn){ns(f,f.return,fn)}}break;case 6:if(Fl(_,f),Tu(f),D&4){if(f.stateNode===null)throw Error(i(162));F=f.stateNode,$=f.memoizedProps;try{F.nodeValue=$}catch(fn){ns(f,f.return,fn)}}break;case 3:if(Fl(_,f),Tu(f),D&4&&T!==null&&T.memoizedState.isDehydrated)try{ma(_.containerInfo)}catch(fn){ns(f,f.return,fn)}break;case 4:Fl(_,f),Tu(f);break;case 13:Fl(_,f),Tu(f),F=f.child,F.flags&8192&&($=F.memoizedState!==null,F.stateNode.isHidden=$,!$||F.alternate!==null&&F.alternate.memoizedState!==null||(dw=In())),D&4&&tA(f);break;case 22:if(Dt=T!==null&&T.memoizedState!==null,f.mode&1?(Ro=(at=Ro)||Dt,Fl(_,f),Ro=at):Fl(_,f),Tu(f),D&8192){if(at=f.memoizedState!==null,(f.stateNode.isHidden=at)&&!Dt&&(f.mode&1)!==0)for(sn=f,Dt=f.child;Dt!==null;){for(Mt=sn=Dt;sn!==null;){switch(Nt=sn,nn=Nt.child,Nt.tag){case 0:case 11:case 14:case 15:kh(4,Nt,Nt.return);break;case 1:Zp(Nt,Nt.return);var dn=Nt.stateNode;if(typeof dn.componentWillUnmount=="function"){D=Nt,T=Nt.return;try{_=D,dn.props=_.memoizedProps,dn.state=_.memoizedState,dn.componentWillUnmount()}catch(fn){ns(D,T,fn)}}break;case 5:Zp(Nt,Nt.return);break;case 22:if(Nt.memoizedState!==null){cv(Mt);continue}}nn!==null?(nn.return=Nt,sn=nn):cv(Mt)}Dt=Dt.sibling}e:for(Dt=null,Mt=f;;){if(Mt.tag===5){if(Dt===null){Dt=Mt;try{F=Mt.stateNode,at?($=F.style,typeof $.setProperty=="function"?$.setProperty("display","none","important"):$.display="none"):(Ae=Mt.stateNode,Ve=Mt.memoizedProps.style,me=Ve!=null&&Ve.hasOwnProperty("display")?Ve.display:null,Ae.style.display=Oi("display",me))}catch(fn){ns(f,f.return,fn)}}}else if(Mt.tag===6){if(Dt===null)try{Mt.stateNode.nodeValue=at?"":Mt.memoizedProps}catch(fn){ns(f,f.return,fn)}}else if((Mt.tag!==22&&Mt.tag!==23||Mt.memoizedState===null||Mt===f)&&Mt.child!==null){Mt.child.return=Mt,Mt=Mt.child;continue}if(Mt===f)break e;for(;Mt.sibling===null;){if(Mt.return===null||Mt.return===f)break e;Dt===Mt&&(Dt=null),Mt=Mt.return}Dt===Mt&&(Dt=null),Mt.sibling.return=Mt.return,Mt=Mt.sibling}}break;case 19:Fl(_,f),Tu(f),D&4&&tA(f);break;case 21:break;default:Fl(_,f),Tu(f)}}function Tu(f){var _=f.flags;if(_&2){try{e:{for(var T=f.return;T!==null;){if(iw(T)){var D=T;break e}T=T.return}throw Error(i(160))}switch(D.tag){case 5:var F=D.stateNode;D.flags&32&&(Lt(F,""),D.flags&=-33);var $=eA(f);N_(f,$,F);break;case 3:case 4:var me=D.stateNode.containerInfo,Ae=eA(f);sw(f,Ae,me);break;default:throw Error(i(161))}}catch(Ve){ns(f,f.return,Ve)}f.flags&=-3}_&4096&&(f.flags&=-4097)}function LD(f,_,T){sn=f,cw(f)}function cw(f,_,T){for(var D=(f.mode&1)!==0;sn!==null;){var F=sn,$=F.child;if(F.tag===22&&D){var me=F.memoizedState!==null||O_;if(!me){var Ae=F.alternate,Ve=Ae!==null&&Ae.memoizedState!==null||Ro;Ae=O_;var at=Ro;if(O_=me,(Ro=Ve)&&!at)for(sn=F;sn!==null;)me=sn,Ve=me.child,me.tag===22&&me.memoizedState!==null?nA(F):Ve!==null?(Ve.return=me,sn=Ve):nA(F);for(;$!==null;)sn=$,cw($),$=$.sibling;sn=F,O_=Ae,Ro=at}lw(f)}else(F.subtreeFlags&8772)!==0&&$!==null?($.return=F,sn=$):lw(f)}}function lw(f){for(;sn!==null;){var _=sn;if((_.flags&8772)!==0){var T=_.alternate;try{if((_.flags&8772)!==0)switch(_.tag){case 0:case 11:case 15:Ro||av(5,_);break;case 1:var D=_.stateNode;if(_.flags&4&&!Ro)if(T===null)D.componentDidMount();else{var F=_.elementType===_.type?T.memoizedProps:Wc(_.type,T.memoizedProps);D.componentDidUpdate(F,T.memoizedState,D.__reactInternalSnapshotBeforeUpdate)}var $=_.updateQueue;$!==null&&AI(_,$,D);break;case 3:var me=_.updateQueue;if(me!==null){if(T=null,_.child!==null)switch(_.child.tag){case 5:T=_.child.stateNode;break;case 1:T=_.child.stateNode}AI(_,me,T)}break;case 5:var Ae=_.stateNode;if(T===null&&_.flags&4){T=Ae;var Ve=_.memoizedProps;switch(_.type){case"button":case"input":case"select":case"textarea":Ve.autoFocus&&T.focus();break;case"img":Ve.src&&(T.src=Ve.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(_.memoizedState===null){var at=_.alternate;if(at!==null){var Dt=at.memoizedState;if(Dt!==null){var Mt=Dt.dehydrated;Mt!==null&&ma(Mt)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(i(163))}Ro||_.flags&512&&rw(_)}catch(Nt){ns(_,_.return,Nt)}}if(_===f){sn=null;break}if(T=_.sibling,T!==null){T.return=_.return,sn=T;break}sn=_.return}}function cv(f){for(;sn!==null;){var _=sn;if(_===f){sn=null;break}var T=_.sibling;if(T!==null){T.return=_.return,sn=T;break}sn=_.return}}function nA(f){for(;sn!==null;){var _=sn;try{switch(_.tag){case 0:case 11:case 15:var T=_.return;try{av(4,_)}catch(Ve){ns(_,T,Ve)}break;case 1:var D=_.stateNode;if(typeof D.componentDidMount=="function"){var F=_.return;try{D.componentDidMount()}catch(Ve){ns(_,F,Ve)}}var $=_.return;try{rw(_)}catch(Ve){ns(_,$,Ve)}break;case 5:var me=_.return;try{rw(_)}catch(Ve){ns(_,me,Ve)}}}catch(Ve){ns(_,_.return,Ve)}if(_===f){sn=null;break}var Ae=_.sibling;if(Ae!==null){Ae.return=_.return,sn=Ae;break}sn=_.return}}var MD=Math.ceil,Nh=ce.ReactCurrentDispatcher,lv=ce.ReactCurrentOwner,Xo=ce.ReactCurrentBatchConfig,Cr=0,$s=null,hs=null,Ds=0,Ec=0,Pm=Dl(0),Ks=0,km=null,ef=0,uv=0,uw=0,tf=null,Es=null,dw=0,Gc=1/0,Cu=null,Jo=!1,hw=null,Dh=null,D_=!1,xh=null,x_=0,Om=0,pw=null,L_=-1,dv=0;function va(){return(Cr&6)!==0?In():L_!==-1?L_:L_=In()}function Lh(f){return(f.mode&1)===0?1:(Cr&2)!==0&&Ds!==0?Ds&-Ds:__.transition!==null?(dv===0&&(dv=md()),dv):(f=mr,f!==0||(f=window.event,f=f===void 0?16:si(f.type)),f)}function vc(f,_,T,D){if(50<Om)throw Om=0,pw=null,Error(i(185));hu(f,T,D),((Cr&2)===0||f!==$s)&&(f===$s&&((Cr&2)===0&&(uv|=T),Ks===4&&Mh(f,Ds)),Qo(f,D),T===1&&Cr===0&&(_.mode&1)===0&&(Gc=In()+500,xE&&Rh()))}function Qo(f,_){var T=f.callbackNode;Va(f,_);var D=pd(f,f===$s?Ds:0);if(D===0)T!==null&&dc(T),f.callbackNode=null,f.callbackPriority=0;else if(_=D&-D,f.callbackPriority!==_){if(T!=null&&dc(T),_===1)f.tag===0?CD(hv.bind(null,f)):vb(hv.bind(null,f)),SD(function(){(Cr&6)===0&&Rh()}),T=null;else{switch(Il(D)){case 1:T=ti;break;case 4:T=Tl;break;case 16:T=Ua;break;case 536870912:T=tm;break;default:T=Ua}T=vw(T,rA.bind(null,f))}f.callbackPriority=_,f.callbackNode=T}}function rA(f,_){if(L_=-1,dv=0,(Cr&6)!==0)throw Error(i(327));var T=f.callbackNode;if(Vh()&&f.callbackNode!==T)return null;var D=pd(f,f===$s?Ds:0);if(D===0)return null;if((D&30)!==0||(D&f.expiredLanes)!==0||_)_=V_(f,D);else{_=D;var F=Cr;Cr|=2;var $=gw();($s!==f||Ds!==_)&&(Cu=null,Gc=In()+500,Dd(f,_));do try{VD();break}catch(Ae){mw(f,Ae)}while(!0);Rb(),Nh.current=$,Cr=F,hs!==null?_=0:($s=null,Ds=0,_=Ks)}if(_!==0){if(_===2&&(F=ua(f),F!==0&&(D=F,_=M_(f,F))),_===1)throw T=km,Dd(f,0),Mh(f,D),Qo(f,In()),T;if(_===6)Mh(f,D);else{if(F=f.current.alternate,(D&30)===0&&!iA(F)&&(_=V_(f,D),_===2&&($=ua(f),$!==0&&(D=$,_=M_(f,$))),_===1))throw T=km,Dd(f,0),Mh(f,D),Qo(f,In()),T;switch(f.finishedWork=F,f.finishedLanes=D,_){case 0:case 1:throw Error(i(345));case 2:Hc(f,Es,Cu);break;case 3:if(Mh(f,D),(D&130023424)===D&&(_=dw+500-In(),10<_)){if(pd(f,0)!==0)break;if(F=f.suspendedLanes,(F&D)!==D){va(),f.pingedLanes|=f.suspendedLanes&F;break}f.timeoutHandle=gb(Hc.bind(null,f,Es,Cu),_);break}Hc(f,Es,Cu);break;case 4:if(Mh(f,D),(D&4194240)===D)break;for(_=f.eventTimes,F=-1;0<D;){var me=31-wo(D);$=1<<me,me=_[me],me>F&&(F=me),D&=~$}if(D=F,D=In()-D,D=(120>D?120:480>D?480:1080>D?1080:1920>D?1920:3e3>D?3e3:4320>D?4320:1960*MD(D/1960))-D,10<D){f.timeoutHandle=gb(Hc.bind(null,f,Es,Cu),D);break}Hc(f,Es,Cu);break;case 5:Hc(f,Es,Cu);break;default:throw Error(i(329))}}}return Qo(f,In()),f.callbackNode===T?rA.bind(null,f):null}function M_(f,_){var T=tf;return f.current.memoizedState.isDehydrated&&(Dd(f,_).flags|=256),f=V_(f,_),f!==2&&(_=Es,Es=T,_!==null&&fw(_)),f}function fw(f){Es===null?Es=f:Es.push.apply(Es,f)}function iA(f){for(var _=f;;){if(_.flags&16384){var T=_.updateQueue;if(T!==null&&(T=T.stores,T!==null))for(var D=0;D<T.length;D++){var F=T[D],$=F.getSnapshot;F=F.value;try{if(!Ol($(),F))return!1}catch{return!1}}}if(T=_.child,_.subtreeFlags&16384&&T!==null)T.return=_,_=T;else{if(_===f)break;for(;_.sibling===null;){if(_.return===null||_.return===f)return!0;_=_.return}_.sibling.return=_.return,_=_.sibling}}return!0}function Mh(f,_){for(_&=~uw,_&=~uv,f.suspendedLanes|=_,f.pingedLanes&=~_,f=f.expirationTimes;0<_;){var T=31-wo(_),D=1<<T;f[T]=-1,_&=~D}}function hv(f){if((Cr&6)!==0)throw Error(i(327));Vh();var _=pd(f,0);if((_&1)===0)return Qo(f,In()),null;var T=V_(f,_);if(f.tag!==0&&T===2){var D=ua(f);D!==0&&(_=D,T=M_(f,D))}if(T===1)throw T=km,Dd(f,0),Mh(f,_),Qo(f,In()),T;if(T===6)throw Error(i(345));return f.finishedWork=f.current.alternate,f.finishedLanes=_,Hc(f,Es,Cu),Qo(f,In()),null}function nf(f,_){var T=Cr;Cr|=1;try{return f(_)}finally{Cr=T,Cr===0&&(Gc=In()+500,xE&&Rh())}}function Uh(f){xh!==null&&xh.tag===0&&(Cr&6)===0&&Vh();var _=Cr;Cr|=1;var T=Xo.transition,D=mr;try{if(Xo.transition=null,mr=1,f)return f()}finally{mr=D,Xo.transition=T,Cr=_,(Cr&6)===0&&Rh()}}function U_(){Ec=Pm.current,Ti(Pm)}function Dd(f,_){f.finishedWork=null,f.finishedLanes=0;var T=f.timeoutHandle;if(T!==-1&&(f.timeoutHandle=-1,vD(T)),hs!==null)for(T=hs.return;T!==null;){var D=T;switch(UE(D),D.tag){case 1:D=D.type.childContextTypes,D!=null&&NE();break;case 3:qp(),Ti(_a),Ti(qo),xb();break;case 5:Nb(D);break;case 4:qp();break;case 13:Ti(ts);break;case 19:Ti(ts);break;case 10:Ib(D.type._context);break;case 22:case 23:U_()}T=T.return}if($s=f,hs=f=Fh(f.current,null),Ds=Ec=_,Ks=0,km=null,uw=uv=ef=0,Es=tf=null,$p!==null){for(_=0;_<$p.length;_++)if(T=$p[_],D=T.interleaved,D!==null){T.interleaved=null;var F=D.next,$=T.pending;if($!==null){var me=$.next;$.next=F,D.next=me}T.pending=D}$p=null}return f}function mw(f,_){do{var T=hs;try{if(Rb(),S_.current=Im,b_){for(var D=qi.memoizedState;D!==null;){var F=D.queue;F!==null&&(F.pending=null),D=D.next}b_=!1}if(Yp=0,ys=Hs=qi=null,Pd=!1,w_=0,lv.current=null,T===null||T.return===null){Ks=1,km=_,hs=null;break}e:{var $=f,me=T.return,Ae=T,Ve=_;if(_=Ds,Ae.flags|=32768,Ve!==null&&typeof Ve=="object"&&typeof Ve.then=="function"){var at=Ve,Dt=Ae,Mt=Dt.tag;if((Dt.mode&1)===0&&(Mt===0||Mt===11||Mt===15)){var Nt=Dt.alternate;Nt?(Dt.updateQueue=Nt.updateQueue,Dt.memoizedState=Nt.memoizedState,Dt.lanes=Nt.lanes):(Dt.updateQueue=null,Dt.memoizedState=null)}var nn=zI(me);if(nn!==null){nn.flags&=-257,WI(nn,me,Ae,$,_),nn.mode&1&&qb($,at,_),_=nn,Ve=at;var dn=_.updateQueue;if(dn===null){var fn=new Set;fn.add(Ve),_.updateQueue=fn}else dn.add(Ve);break e}else{if((_&1)===0){qb($,at,_),Nm();break e}Ve=Error(i(426))}}else if(Bi&&Ae.mode&1){var rs=zI(me);if(rs!==null){(rs.flags&65536)===0&&(rs.flags|=256),WI(rs,me,Ae,$,_),bm(Am(Ve,Ae));break e}}$=Ve=Am(Ve,Ae),Ks!==4&&(Ks=2),tf===null?tf=[$]:tf.push($),$=me;do{switch($.tag){case 3:$.flags|=65536,_&=-_,$.lanes|=_;var Xe=Kb($,Ve,_);II($,Xe);break e;case 1:Ae=Ve;var Fe=$.type,it=$.stateNode;if(($.flags&128)===0&&(typeof Fe.getDerivedStateFromError=="function"||it!==null&&typeof it.componentDidCatch=="function"&&(Dh===null||!Dh.has(it)))){$.flags|=65536,_&=-_,$.lanes|=_;var jt=BI($,Ae,_);II($,jt);break e}}$=$.return}while($!==null)}yw(T)}catch(mn){_=mn,hs===T&&T!==null&&(hs=T=T.return);continue}break}while(!0)}function gw(){var f=Nh.current;return Nh.current=Im,f===null?Im:f}function Nm(){(Ks===0||Ks===3||Ks===2)&&(Ks=4),$s===null||(ef&268435455)===0&&(uv&268435455)===0||Mh($s,Ds)}function V_(f,_){var T=Cr;Cr|=2;var D=gw();($s!==f||Ds!==_)&&(Cu=null,Dd(f,_));do try{UD();break}catch(F){mw(f,F)}while(!0);if(Rb(),Cr=T,Nh.current=D,hs!==null)throw Error(i(261));return $s=null,Ds=0,Ks}function UD(){for(;hs!==null;)_w(hs)}function VD(){for(;hs!==null&&!Ko();)_w(hs)}function _w(f){var _=aA(f.alternate,f,Ec);f.memoizedProps=f.pendingProps,_===null?yw(f):hs=_,lv.current=null}function yw(f){var _=f;do{var T=_.alternate;if(f=_.return,(_.flags&32768)===0){if(T=ov(T,_,Ec),T!==null){hs=T;return}}else{if(T=ND(T,_),T!==null){T.flags&=32767,hs=T;return}if(f!==null)f.flags|=32768,f.subtreeFlags=0,f.deletions=null;else{Ks=6,hs=null;return}}if(_=_.sibling,_!==null){hs=_;return}hs=_=f}while(_!==null);Ks===0&&(Ks=5)}function Hc(f,_,T){var D=mr,F=Xo.transition;try{Xo.transition=null,mr=1,Ew(f,_,T,D)}finally{Xo.transition=F,mr=D}return null}function Ew(f,_,T,D){do Vh();while(xh!==null);if((Cr&6)!==0)throw Error(i(327));T=f.finishedWork;var F=f.finishedLanes;if(T===null)return null;if(f.finishedWork=null,f.finishedLanes=0,T===f.current)throw Error(i(177));f.callbackNode=null,f.callbackPriority=0;var $=T.lanes|T.childLanes;if(ui(f,$),f===$s&&(hs=$s=null,Ds=0),(T.subtreeFlags&2064)===0&&(T.flags&2064)===0||D_||(D_=!0,vw(Ua,function(){return Vh(),null})),$=(T.flags&15990)!==0,(T.subtreeFlags&15990)!==0||$){$=Xo.transition,Xo.transition=null;var me=mr;mr=1;var Ae=Cr;Cr|=4,lv.current=null,xD(f,T),aw(T,f),mD(PE),be=!!mb,PE=mb=null,f.current=T,LD(T),ei(),Cr=Ae,mr=me,Xo.transition=$}else f.current=T;if(D_&&(D_=!1,xh=f,x_=F),$=f.pendingLanes,$===0&&(Dh=null),Up(T.stateNode),Qo(f,In()),_!==null)for(D=f.onRecoverableError,T=0;T<_.length;T++)F=_[T],D(F.value,{componentStack:F.stack,digest:F.digest});if(Jo)throw Jo=!1,f=hw,hw=null,f;return(x_&1)!==0&&f.tag!==0&&Vh(),$=f.pendingLanes,($&1)!==0?f===pw?Om++:(Om=0,pw=f):Om=0,Rh(),null}function Vh(){if(xh!==null){var f=Il(x_),_=Xo.transition,T=mr;try{if(Xo.transition=null,mr=16>f?16:f,xh===null)var D=!1;else{if(f=xh,xh=null,x_=0,(Cr&6)!==0)throw Error(i(331));var F=Cr;for(Cr|=4,sn=f.current;sn!==null;){var $=sn,me=$.child;if((sn.flags&16)!==0){var Ae=$.deletions;if(Ae!==null){for(var Ve=0;Ve<Ae.length;Ve++){var at=Ae[Ve];for(sn=at;sn!==null;){var Dt=sn;switch(Dt.tag){case 0:case 11:case 15:kh(8,Dt,$)}var Mt=Dt.child;if(Mt!==null)Mt.return=Dt,sn=Mt;else for(;sn!==null;){Dt=sn;var Nt=Dt.sibling,nn=Dt.return;if(ZI(Dt),Dt===at){sn=null;break}if(Nt!==null){Nt.return=nn,sn=Nt;break}sn=nn}}}var dn=$.alternate;if(dn!==null){var fn=dn.child;if(fn!==null){dn.child=null;do{var rs=fn.sibling;fn.sibling=null,fn=rs}while(fn!==null)}}sn=$}}if(($.subtreeFlags&2064)!==0&&me!==null)me.return=$,sn=me;else e:for(;sn!==null;){if($=sn,($.flags&2048)!==0)switch($.tag){case 0:case 11:case 15:kh(9,$,$.return)}var Xe=$.sibling;if(Xe!==null){Xe.return=$.return,sn=Xe;break e}sn=$.return}}var Fe=f.current;for(sn=Fe;sn!==null;){me=sn;var it=me.child;if((me.subtreeFlags&2064)!==0&&it!==null)it.return=me,sn=it;else e:for(me=Fe;sn!==null;){if(Ae=sn,(Ae.flags&2048)!==0)try{switch(Ae.tag){case 0:case 11:case 15:av(9,Ae)}}catch(mn){ns(Ae,Ae.return,mn)}if(Ae===me){sn=null;break e}var jt=Ae.sibling;if(jt!==null){jt.return=Ae.return,sn=jt;break e}sn=Ae.return}}if(Cr=F,Rh(),la&&typeof la.onPostCommitFiberRoot=="function")try{la.onPostCommitFiberRoot(Mc,f)}catch{}D=!0}return D}finally{mr=T,Xo.transition=_}}return!1}function pv(f,_,T){_=Am(T,_),_=Kb(f,_,1),f=Ml(f,_,1),_=va(),f!==null&&(hu(f,1,_),Qo(f,_))}function ns(f,_,T){if(f.tag===3)pv(f,f,T);else for(;_!==null;){if(_.tag===3){pv(_,f,T);break}else if(_.tag===1){var D=_.stateNode;if(typeof _.type.getDerivedStateFromError=="function"||typeof D.componentDidCatch=="function"&&(Dh===null||!Dh.has(D))){f=Am(T,f),f=BI(_,f,1),_=Ml(_,f,1),f=va(),_!==null&&(hu(_,1,f),Qo(_,f));break}}_=_.return}}function sA(f,_,T){var D=f.pingCache;D!==null&&D.delete(_),_=va(),f.pingedLanes|=f.suspendedLanes&T,$s===f&&(Ds&T)===T&&(Ks===4||Ks===3&&(Ds&130023424)===Ds&&500>In()-dw?Dd(f,0):uw|=T),Qo(f,_)}function oA(f,_){_===0&&((f.mode&1)===0?_=1:(_=gh,gh<<=1,(gh&130023424)===0&&(gh=4194304)));var T=va();f=Rd(f,_),f!==null&&(hu(f,_,T),Qo(f,T))}function FD(f){var _=f.memoizedState,T=0;_!==null&&(T=_.retryLane),oA(f,T)}function Dm(f,_){var T=0;switch(f.tag){case 13:var D=f.stateNode,F=f.memoizedState;F!==null&&(T=F.retryLane);break;case 19:D=f.stateNode;break;default:throw Error(i(314))}D!==null&&D.delete(_),oA(f,T)}var aA;aA=function(f,_,T){if(f!==null)if(f.memoizedProps!==_.pendingProps||_a.current)$a=!0;else{if((f.lanes&T)===0&&(_.flags&128)===0)return $a=!1,rv(f,_,T);$a=(f.flags&131072)!==0}else $a=!1,Bi&&(_.flags&1048576)!==0&&bI(_,ME,_.index);switch(_.lanes=0,_.tag){case 2:var D=_.type;nv(f,_),f=_.pendingProps;var F=Ch(_,qo.current);Ll(_,T),F=Cm(null,_,D,f,F,T);var $=Ub();return _.flags|=1,typeof F=="object"&&F!==null&&typeof F.render=="function"&&F.$$typeof===void 0?(_.tag=1,_.memoizedState=null,_.updateQueue=null,Ga(D)?($=!0,DE(_)):$=!1,_.memoizedState=F.state!==null&&F.state!==void 0?F.state:null,kb(_),F.updater=QE,_.stateNode=F,F._reactInternals=_,Gb(_,D,f,T),_=Jb(null,_,D,!0,$,T)):(_.tag=0,Bi&&$&&vm(_),Ea(null,_,F,T),_=_.child),_;case 16:D=_.elementType;e:{switch(nv(f,_),f=_.pendingProps,F=D._init,D=F(D._payload),_.type=D,F=_.tag=jD(D),f=Wc(D,f),F){case 0:_=Xb(null,_,D,f,T);break e;case 1:_=KI(null,_,D,f,T);break e;case 11:_=GI(null,_,D,f,T);break e;case 14:_=HI(null,_,D,Wc(D.type,f),T);break e}throw Error(i(306,D,""))}return _;case 0:return D=_.type,F=_.pendingProps,F=_.elementType===D?F:Wc(D,F),Xb(f,_,D,F,T);case 1:return D=_.type,F=_.pendingProps,F=_.elementType===D?F:Wc(D,F),KI(f,_,D,F,T);case 3:e:{if(qI(_),f===null)throw Error(i(387));D=_.pendingProps,$=_.memoizedState,F=$.element,RI(f,_),WE(_,D,null,T);var me=_.memoizedState;if(D=me.element,$.isDehydrated)if($={element:D,isDehydrated:!1,cache:me.cache,pendingSuspenseBoundaries:me.pendingSuspenseBoundaries,transitions:me.transitions},_.updateQueue.baseState=$,_.memoizedState=$,_.flags&256){F=Am(Error(i(423)),_),_=YI(f,_,D,T,F);break e}else if(D!==F){F=Am(Error(i(424)),_),_=YI(f,_,D,T,F);break e}else for(_c=vu(_.stateNode.containerInfo.firstChild),gc=_,Bi=!0,xl=null,T=Tb(_,null,D,T),_.child=T;T;)T.flags=T.flags&-3|4096,T=T.sibling;else{if(Hp(),D===F){_=Nd(f,_,T);break e}Ea(f,_,D,T)}_=_.child}return _;case 5:return PI(_),f===null&&g_(_),D=_.type,F=_.pendingProps,$=f!==null?f.memoizedProps:null,me=F.children,gm(D,F)?me=null:$!==null&&gm(D,$)&&(_.flags|=32),$I(f,_),Ea(f,_,me,T),_.child;case 6:return f===null&&g_(_),null;case 13:return XI(f,_,T);case 4:return Ob(_,_.stateNode.containerInfo),D=_.pendingProps,f===null?_.child=wm(_,null,D,T):Ea(f,_,D,T),_.child;case 11:return D=_.type,F=_.pendingProps,F=_.elementType===D?F:Wc(D,F),GI(f,_,D,F,T);case 7:return Ea(f,_,_.pendingProps,T),_.child;case 8:return Ea(f,_,_.pendingProps.children,T),_.child;case 12:return Ea(f,_,_.pendingProps.children,T),_.child;case 10:e:{if(D=_.type._context,F=_.pendingProps,$=_.memoizedProps,me=F.value,Li(FE,D._currentValue),D._currentValue=me,$!==null)if(Ol($.value,me)){if($.children===F.children&&!_a.current){_=Nd(f,_,T);break e}}else for($=_.child,$!==null&&($.return=_);$!==null;){var Ae=$.dependencies;if(Ae!==null){me=$.child;for(var Ve=Ae.firstContext;Ve!==null;){if(Ve.context===D){if($.tag===1){Ve=Ad(-1,T&-T),Ve.tag=2;var at=$.updateQueue;if(at!==null){at=at.shared;var Dt=at.pending;Dt===null?Ve.next=Ve:(Ve.next=Dt.next,Dt.next=Ve),at.pending=Ve}}$.lanes|=T,Ve=$.alternate,Ve!==null&&(Ve.lanes|=T),BE($.return,T,_),Ae.lanes|=T;break}Ve=Ve.next}}else if($.tag===10)me=$.type===_.type?null:$.child;else if($.tag===18){if(me=$.return,me===null)throw Error(i(341));me.lanes|=T,Ae=me.alternate,Ae!==null&&(Ae.lanes|=T),BE(me,T,_),me=$.sibling}else me=$.child;if(me!==null)me.return=$;else for(me=$;me!==null;){if(me===_){me=null;break}if($=me.sibling,$!==null){$.return=me.return,me=$;break}me=me.return}$=me}Ea(f,_,F.children,T),_=_.child}return _;case 9:return F=_.type,D=_.pendingProps.children,Ll(_,T),F=zc(F),D=D(F),_.flags|=1,Ea(f,_,D,T),_.child;case 14:return D=_.type,F=Wc(D,_.pendingProps),F=Wc(D.type,F),HI(f,_,D,F,T);case 15:return Yb(f,_,_.type,_.pendingProps,T);case 17:return D=_.type,F=_.pendingProps,F=_.elementType===D?F:Wc(D,F),nv(f,_),_.tag=1,Ga(D)?(f=!0,DE(_)):f=!1,Ll(_,T),FI(_,D,F),Gb(_,D,F,T),Jb(null,_,D,!0,f,T);case 19:return ew(f,_,T);case 22:return wu(f,_,T)}throw Error(i(156,_.tag))};function vw(f,_){return ca(f,_)}function Sw(f,_,T,D){this.tag=f,this.key=T,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=_,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=D,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function $c(f,_,T,D){return new Sw(f,_,T,D)}function bw(f){return f=f.prototype,!(!f||!f.isReactComponent)}function jD(f){if(typeof f=="function")return bw(f)?1:0;if(f!=null){if(f=f.$$typeof,f===fe)return 11;if(f===De)return 14}return 2}function Fh(f,_){var T=f.alternate;return T===null?(T=$c(f.tag,_,f.key,f.mode),T.elementType=f.elementType,T.type=f.type,T.stateNode=f.stateNode,T.alternate=f,f.alternate=T):(T.pendingProps=_,T.type=f.type,T.flags=0,T.subtreeFlags=0,T.deletions=null),T.flags=f.flags&14680064,T.childLanes=f.childLanes,T.lanes=f.lanes,T.child=f.child,T.memoizedProps=f.memoizedProps,T.memoizedState=f.memoizedState,T.updateQueue=f.updateQueue,_=f.dependencies,T.dependencies=_===null?null:{lanes:_.lanes,firstContext:_.firstContext},T.sibling=f.sibling,T.index=f.index,T.ref=f.ref,T}function xm(f,_,T,D,F,$){var me=2;if(D=f,typeof f=="function")bw(f)&&(me=1);else if(typeof f=="string")me=5;else e:switch(f){case H:return jh(T.children,F,$,_);case X:me=8,F|=8;break;case Q:return f=$c(12,T,_,F|2),f.elementType=Q,f.lanes=$,f;case de:return f=$c(13,T,_,F),f.elementType=de,f.lanes=$,f;case ke:return f=$c(19,T,_,F),f.elementType=ke,f.lanes=$,f;case Te:return F_(T,F,$,_);default:if(typeof f=="object"&&f!==null)switch(f.$$typeof){case ne:me=10;break e;case he:me=9;break e;case fe:me=11;break e;case De:me=14;break e;case je:me=16,D=null;break e}throw Error(i(130,f==null?f:typeof f,""))}return _=$c(me,T,_,F),_.elementType=f,_.type=D,_.lanes=$,_}function jh(f,_,T,D){return f=$c(7,f,D,_),f.lanes=T,f}function F_(f,_,T,D){return f=$c(22,f,D,_),f.elementType=Te,f.lanes=T,f.stateNode={isHidden:!1},f}function fv(f,_,T){return f=$c(6,f,null,_),f.lanes=T,f}function Lm(f,_,T){return _=$c(4,f.children!==null?f.children:[],f.key,_),_.lanes=T,_.stateNode={containerInfo:f.containerInfo,pendingChildren:null,implementation:f.implementation},_}function ww(f,_,T,D,F){this.tag=_,this.containerInfo=f,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=Rl(0),this.expirationTimes=Rl(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=Rl(0),this.identifierPrefix=D,this.onRecoverableError=F,this.mutableSourceEagerHydrationData=null}function Mm(f,_,T,D,F,$,me,Ae,Ve){return f=new ww(f,_,T,Ae,Ve),_===1?(_=1,$===!0&&(_|=8)):_=0,$=$c(3,null,null,_),f.current=$,$.stateNode=f,$.memoizedState={element:D,isDehydrated:T,cache:null,transitions:null,pendingSuspenseBoundaries:null},kb($),f}function mv(f,_,T){var D=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:pe,key:D==null?null:""+D,children:f,containerInfo:_,implementation:T}}function Tw(f){if(!f)return wh;f=f._reactInternals;e:{if(es(f)!==f||f.tag!==1)throw Error(i(170));var _=f;do{switch(_.tag){case 3:_=_.stateNode.context;break e;case 1:if(Ga(_.type)){_=_.stateNode.__reactInternalMemoizedMergedChildContext;break e}}_=_.return}while(_!==null);throw Error(i(171))}if(f.tag===1){var T=f.type;if(Ga(T))return vI(f,T,_)}return _}function rf(f,_,T,D,F,$,me,Ae,Ve){return f=Mm(T,D,!0,f,F,$,me,Ae,Ve),f.context=Tw(null),T=f.current,D=va(),F=Lh(T),$=Ad(D,F),$.callback=_??null,Ml(T,$,F),f.current.lanes=F,hu(f,F,D),Qo(f,D),f}function Ru(f,_,T,D){var F=_.current,$=va(),me=Lh(F);return T=Tw(T),_.context===null?_.context=T:_.pendingContext=T,_=Ad($,me),_.payload={element:f},D=D===void 0?null:D,D!==null&&(_.callback=D),f=Ml(F,_,me),f!==null&&(vc(f,F,me,$),zE(f,F,me)),me}function gv(f){if(f=f.current,!f.child)return null;switch(f.child.tag){case 5:return f.child.stateNode;default:return f.child.stateNode}}function Um(f,_){if(f=f.memoizedState,f!==null&&f.dehydrated!==null){var T=f.retryLane;f.retryLane=T!==0&&T<_?T:_}}function Cw(f,_){Um(f,_),(f=f.alternate)&&Um(f,_)}function BD(){return null}var cA=typeof reportError=="function"?reportError:function(f){console.error(f)};function Rw(f){this._internalRoot=f}j_.prototype.render=Rw.prototype.render=function(f){var _=this._internalRoot;if(_===null)throw Error(i(409));Ru(f,_,null,null)},j_.prototype.unmount=Rw.prototype.unmount=function(){var f=this._internalRoot;if(f!==null){this._internalRoot=null;var _=f.containerInfo;Uh(function(){Ru(null,f,null,null)}),_[Sd]=null}};function j_(f){this._internalRoot=f}j_.prototype.unstable_scheduleHydration=function(f){if(f){var _=rm();f={blockedOn:null,target:f,priority:_};for(var T=0;T<Fa.length&&_!==0&&_<Fa[T].priority;T++);Fa.splice(T,0,f),T===0&&Al(f)}};function B_(f){return!(!f||f.nodeType!==1&&f.nodeType!==9&&f.nodeType!==11)}function z_(f){return!(!f||f.nodeType!==1&&f.nodeType!==9&&f.nodeType!==11&&(f.nodeType!==8||f.nodeValue!==" react-mount-point-unstable "))}function lA(){}function uA(f,_,T,D,F){if(F){if(typeof D=="function"){var $=D;D=function(){var at=gv(me);$.call(at)}}var me=rf(_,D,f,0,null,!1,!1,"",lA);return f._reactRootContainer=me,f[Sd]=me.current,vd(f.nodeType===8?f.parentNode:f),Uh(),me}for(;F=f.lastChild;)f.removeChild(F);if(typeof D=="function"){var Ae=D;D=function(){var at=gv(Ve);Ae.call(at)}}var Ve=Mm(f,0,!1,null,null,!1,!1,"",lA);return f._reactRootContainer=Ve,f[Sd]=Ve.current,vd(f.nodeType===8?f.parentNode:f),Uh(function(){Ru(_,Ve,T,D)}),Ve}function _v(f,_,T,D,F){var $=T._reactRootContainer;if($){var me=$;if(typeof F=="function"){var Ae=F;F=function(){var Ve=gv(me);Ae.call(Ve)}}Ru(_,me,f,F)}else me=uA(T,_,f,F,D);return gv(me)}_h=function(f){switch(f.tag){case 3:var _=f.stateNode;if(_.current.memoizedState.isDehydrated){var T=Nr(_.pendingLanes);T!==0&&(pu(_,T|1),Qo(_,In()),(Cr&6)===0&&(Gc=In()+500,Rh()))}break;case 13:Uh(function(){var D=Rd(f,1);if(D!==null){var F=va();vc(D,f,1,F)}}),Cw(f,1)}},yh=function(f){if(f.tag===13){var _=Rd(f,134217728);if(_!==null){var T=va();vc(_,f,134217728,T)}Cw(f,134217728)}},fu=function(f){if(f.tag===13){var _=Lh(f),T=Rd(f,_);if(T!==null){var D=va();vc(T,f,_,D)}Cw(f,_)}},rm=function(){return mr},Fp=function(f,_){var T=mr;try{return mr=f,_()}finally{mr=T}},Sl=function(f,_,T){switch(_){case"input":if(Ht(f,T),_=T.name,T.type==="radio"&&_!=null){for(T=f;T.parentNode;)T=T.parentNode;for(T=T.querySelectorAll("input[name="+JSON.stringify(""+_)+'][type="radio"]'),_=0;_<T.length;_++){var D=T[_];if(D!==f&&D.form===f.form){var F=OE(D);if(!F)throw Error(i(90));ft(D),Ht(D,F)}}}break;case"textarea":xt(f,T);break;case"select":_=T.value,_!=null&&Pt(f,!!T.multiple,_,!1)}},Go=nf,dd=Uh;var W_={usingClientEntryPoint:!1,Events:[f_,_m,OE,uo,ud,nf]},Ka={findFiberByHostInstance:zp,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},dA={bundleType:Ka.bundleType,version:Ka.version,rendererPackageName:Ka.rendererPackageName,rendererConfig:Ka.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:ce.ReactCurrentDispatcher,findHostInstanceByFiber:function(f){return f=Lc(f),f===null?null:f.stateNode},findFiberByHostInstance:Ka.findFiberByHostInstance||BD,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var yv=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!yv.isDisabled&&yv.supportsFiber)try{Mc=yv.inject(dA),la=yv}catch{}}return ol.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=W_,ol.createPortal=function(f,_){var T=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!B_(_))throw Error(i(200));return mv(f,_,null,T)},ol.createRoot=function(f,_){if(!B_(f))throw Error(i(299));var T=!1,D="",F=cA;return _!=null&&(_.unstable_strictMode===!0&&(T=!0),_.identifierPrefix!==void 0&&(D=_.identifierPrefix),_.onRecoverableError!==void 0&&(F=_.onRecoverableError)),_=Mm(f,1,!1,null,null,T,!1,D,F),f[Sd]=_.current,vd(f.nodeType===8?f.parentNode:f),new Rw(_)},ol.findDOMNode=function(f){if(f==null)return null;if(f.nodeType===1)return f;var _=f._reactInternals;if(_===void 0)throw typeof f.render=="function"?Error(i(188)):(f=Object.keys(f).join(","),Error(i(268,f)));return f=Lc(_),f=f===null?null:f.stateNode,f},ol.flushSync=function(f){return Uh(f)},ol.hydrate=function(f,_,T){if(!z_(_))throw Error(i(200));return _v(null,f,_,!0,T)},ol.hydrateRoot=function(f,_,T){if(!B_(f))throw Error(i(405));var D=T!=null&&T.hydratedSources||null,F=!1,$="",me=cA;if(T!=null&&(T.unstable_strictMode===!0&&(F=!0),T.identifierPrefix!==void 0&&($=T.identifierPrefix),T.onRecoverableError!==void 0&&(me=T.onRecoverableError)),_=rf(_,null,f,1,T??null,F,!1,$,me),f[Sd]=_.current,vd(f),D)for(f=0;f<D.length;f++)T=D[f],F=T._getVersion,F=F(T._source),_.mutableSourceEagerHydrationData==null?_.mutableSourceEagerHydrationData=[T,F]:_.mutableSourceEagerHydrationData.push(T,F);return new j_(_)},ol.render=function(f,_,T){if(!z_(_))throw Error(i(200));return _v(null,f,_,!1,T)},ol.unmountComponentAtNode=function(f){if(!z_(f))throw Error(i(40));return f._reactRootContainer?(Uh(function(){_v(null,null,f,!1,function(){f._reactRootContainer=null,f[Sd]=null})}),!0):!1},ol.unstable_batchedUpdates=nf,ol.unstable_renderSubtreeIntoContainer=function(f,_,T,D){if(!z_(T))throw Error(i(200));if(f==null||f._reactInternals===void 0)throw Error(i(38));return _v(f,_,T,!1,D)},ol.version="18.3.1-next-f1338f8080-20240426",ol}var oq;function $Z(){if(oq)return WM.exports;oq=1;function n(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(n)}catch(e){console.error(e)}}return n(),WM.exports=GEe(),WM.exports}var aq;function HEe(){if(aq)return M1;aq=1;var n=$Z();return M1.createRoot=n.createRoot,M1.hydrateRoot=n.hydrateRoot,M1}var $Ee=HEe();const GO=$g($Ee);function KEe(n,e,i,o){return n.addEventListener(e,i,o),()=>{n.removeEventListener(e,i,o)}}function HO(n){return n!=null&&typeof n=="object"&&"nodeType"in n&&n.nodeType===Node.ELEMENT_NODE}function qEe(){return!!(globalThis!=null&&globalThis.document)}function KZ(n){return n.parentElement&&KZ(n.parentElement)?!0:n.hidden}function YEe(n){const e=n.getAttribute("contenteditable");return e!=="false"&&e!=null}function XEe(n){return!!n.getAttribute("disabled")||!!n.getAttribute("aria-disabled")}function JEe(n){var e;return((e=qZ(n))==null?void 0:e.defaultView)??window}function qZ(n){return HO(n)?n.ownerDocument:document}function QEe(n){return n.view??window}function ZEe(n){return qZ(n).activeElement}function eve(n){const e=QEe(n);return typeof e.PointerEvent<"u"&&n instanceof e.PointerEvent?n.pointerType==="mouse":n instanceof e.MouseEvent}function YZ(n){return!!n.touches}function tve(n){return YZ(n)&&n.touches.length>1}function nve(n,e="page"){const i=n.touches[0]||n.changedTouches[0];return{x:i[`${e}X`],y:i[`${e}Y`]}}function rve(n,e="page"){return{x:n[`${e}X`],y:n[`${e}Y`]}}function XZ(n,e="page"){return YZ(n)?nve(n,e):rve(n,e)}function ive(n){return e=>{const i=eve(e);(!i||i&&e.button===0)&&n(e)}}function sve(n,e=!1){function i(l){n(l,{point:XZ(l)})}return e?ive(i):i}function gk(n,e,i,o){return KEe(n,e,sve(i,e==="pointerdown"),o)}function ove(n,...e){if(n==null)throw new TypeError("Cannot convert undefined or null to object");const i={...n};for(const o of e)if(o!=null)for(const l in o)Object.prototype.hasOwnProperty.call(o,l)&&(l in i&&delete i[l],i[l]=o[l]);return i}const ur=n=>n?"":void 0,Nf=n=>n?!0:void 0;function ave(n){return Array.isArray(n)}function ed(n){const e=typeof n;return n!=null&&(e==="object"||e==="function")&&!ave(n)}function cve(n){const e=n==null?0:n.length;return e?n[e-1]:void 0}function lve(n){const e=parseFloat(n.toString()),i=n.toString().replace(String(e),"");return{unitless:!i,value:e,unit:i}}function mV(n){if(n==null)return n;const{unitless:e}=lve(n);return e||typeof n=="number"?`${n}px`:n}const JZ=(n,e)=>parseInt(n[1],10)>parseInt(e[1],10)?1:-1,JF=n=>Object.fromEntries(Object.entries(n).sort(JZ));function cq(n){const e=JF(n);return Object.assign(Object.values(e),e)}function uve(n){const e=Object.keys(JF(n));return new Set(e)}function lq(n){if(!n)return n;n=mV(n)??n;const e=-.02;return typeof n=="number"?`${n+e}`:n.replace(/(\d+\.?\d*)/u,i=>`${parseFloat(i)+e}`)}function iC(n,e){const i=["@media screen"];return n&&i.push("and",`(min-width: ${mV(n)})`),e&&i.push("and",`(max-width: ${mV(e)})`),i.join(" ")}function dve(n){if(!n)return null;n.base=n.base??"0px";const e=cq(n),i=Object.entries(n).sort(JZ).map(([u,p],y,v)=>{let[,w]=v[y+1]??[];return w=parseFloat(w)>0?lq(w):void 0,{_minW:lq(p),breakpoint:u,minW:p,maxW:w,maxWQuery:iC(null,w),minWQuery:iC(p),minMaxQuery:iC(p,w)}}),o=uve(n),l=Array.from(o.values());return{keys:o,normalized:e,isResponsive(u){const p=Object.keys(u);return p.length>0&&p.every(y=>o.has(y))},asObject:JF(n),asArray:cq(n),details:i,get(u){return i.find(p=>p.breakpoint===u)},media:[null,...e.map(u=>iC(u)).slice(1)],toArrayValue(u){if(!ed(u))throw new Error("toArrayValue: value must be an object");const p=l.map(y=>u[y]??null);for(;cve(p)===null;)p.pop();return p},toObjectValue(u){if(!Array.isArray(u))throw new Error("toObjectValue: value must be an array");return u.reduce((p,y,v)=>{const w=l[v];return w!=null&&y!=null&&(p[w]=y),p},{})}}}function QZ(...n){return function(...i){n.forEach(o=>o==null?void 0:o(...i))}}function Un(...n){return function(i){n.some(o=>(o==null||o(i),i==null?void 0:i.defaultPrevented))}}function $O(n){return O.Children.toArray(n).filter(e=>O.isValidElement(e))}function KO(n){const e=Object.assign({},n);for(let i in e)e[i]===void 0&&delete e[i];return e}function hve(n,e){return`${n} returned \`undefined\`. Seems you forgot to wrap component within ${e}`}function ki(n={}){const{name:e,strict:i=!0,hookName:o="useContext",providerName:l="Provider",errorMessage:u,defaultValue:p}=n,y=O.createContext(p);y.displayName=e;function v(){var C;const w=O.useContext(y);if(!w&&i){const R=new Error(u??hve(o,l));throw R.name="ContextError",(C=Error.captureStackTrace)==null||C.call(Error,R,v),R}return w}return[y.Provider,v,y]}const yn=(...n)=>n.filter(Boolean).join(" "),ZZ=n=>n.hasAttribute("tabindex"),pve=n=>ZZ(n)&&n.tabIndex===-1;function Zk(n){if(!HO(n)||KZ(n)||XEe(n))return!1;const{localName:e}=n;if(["input","select","textarea","button"].indexOf(e)>=0)return!0;const o={a:()=>n.hasAttribute("href"),audio:()=>n.hasAttribute("controls"),video:()=>n.hasAttribute("controls")};return e in o?o[e]():YEe(n)?!0:ZZ(n)}function fve(n){return n?HO(n)&&Zk(n)&&!pve(n):!1}const mve=["input:not(:disabled):not([disabled])","select:not(:disabled):not([disabled])","textarea:not(:disabled):not([disabled])","embed","iframe","object","a[href]","area[href]","button:not(:disabled):not([disabled])","[tabindex]","audio[controls]","video[controls]","*[tabindex]:not([aria-disabled])","*[contenteditable]"],gve=mve.join(),_ve=n=>n.offsetWidth>0&&n.offsetHeight>0;function eee(n){const e=Array.from(n.querySelectorAll(gve));return e.unshift(n),e.filter(i=>Zk(i)&&_ve(i))}function yve(n,e,i,o){const l=typeof e=="string"?e.split("."):[e];for(o=0;o<l.length&&n;o+=1)n=n[l[o]];return n===void 0?i:n}const Eve=n=>{const e=new WeakMap;return(o,l,u,p)=>{if(typeof o>"u")return n(o,l,u);e.has(o)||e.set(o,new Map);const y=e.get(o);if(y.has(l))return y.get(l);const v=n(o,l,u,p);return y.set(l,v),v}},tee=Eve(yve),vve=n=>n.default||n;function QF(n){const{wasSelected:e,enabled:i,isSelected:o,mode:l="unmount"}=n;return!!(!i||o||l==="keepMounted"&&e)}function Sve(n){const e=parseFloat(n);return typeof e!="number"||Number.isNaN(e)?0:e}function ZF(n,e){let i=Sve(n);const o=10**(e??10);return i=Math.round(i*o)/o,e?i.toFixed(e):i.toString()}function gV(n){if(!Number.isFinite(n))return 0;let e=1,i=0;for(;Math.round(n*e)/e!==n;)e*=10,i+=1;return i}function uq(n,e,i){return(n-e)*100/(i-e)}function bve(n,e,i){return(i-e)*n+e}function dq(n,e,i){const o=Math.round((n-e)/i)*i+e,l=gV(i);return ZF(o,l)}function _k(n,e,i){return n==null?n:(i<e&&console.warn("clamp: max cannot be less than min"),Math.min(Math.max(n,e),i))}function GS(n,e=[]){const i=Object.assign({},n);for(const o of e)o in i&&delete i[o];return i}function nee(n,e){const i={};for(const o of e)o in n&&(i[o]=n[o]);return i}function qO(n,e){return Array.isArray(n)?n.map(i=>i===null?null:e(i)):ed(n)?Object.keys(n).reduce((i,o)=>(i[o]=e(n[o]),i),{}):n!=null?e(n):null}const wve=n=>typeof n=="function";function pl(n,...e){return wve(n)?n(...e):n}function Tve(n){const e=n.ownerDocument.defaultView||window,{overflow:i,overflowX:o,overflowY:l}=e.getComputedStyle(n);return/auto|scroll|overlay|hidden/.test(i+l+o)}function Cve(n){return n.localName==="html"?n:n.assignedSlot||n.parentElement||n.ownerDocument.documentElement}function ree(n){return["html","body","#document"].includes(n.localName)?n.ownerDocument.body:HO(n)&&Tve(n)?n:ree(Cve(n))}function Rve(n,e){const i={},o={};for(const[l,u]of Object.entries(n))e.includes(l)?i[l]=u:o[l]=u;return[i,o]}function Ive(n,...e){const i=Object.getOwnPropertyDescriptors(n),o=Object.keys(i),l=p=>{const y={};for(let v=0;v<p.length;v++){const w=p[v];i[w]&&(Object.defineProperty(y,w,i[w]),delete i[w])}return y},u=p=>l(Array.isArray(p)?p:o.filter(p));return e.map(u).concat(l(o))}function hq(n,e,i={}){const{stop:o,getKey:l}=i;function u(p,y=[]){if(ed(p)||Array.isArray(p)){const v={};for(const[w,C]of Object.entries(p)){const R=(l==null?void 0:l(w))??w,N=[...y,R];if(o!=null&&o(p,N))return e(p,y);v[R]=u(C,N)}return v}return e(p,y)}return u(n)}var sC={exports:{}};sC.exports;var pq;function Ave(){return pq||(pq=1,function(n,e){var i=200,o="__lodash_hash_undefined__",l=800,u=16,p=9007199254740991,y="[object Arguments]",v="[object Array]",w="[object AsyncFunction]",C="[object Boolean]",R="[object Date]",N="[object Error]",M="[object Function]",L="[object GeneratorFunction]",U="[object Map]",z="[object Number]",J="[object Null]",q="[object Object]",re="[object Proxy]",ce="[object RegExp]",ae="[object Set]",pe="[object String]",H="[object Undefined]",X="[object WeakMap]",Q="[object ArrayBuffer]",ne="[object DataView]",he="[object Float32Array]",fe="[object Float64Array]",de="[object Int8Array]",ke="[object Int16Array]",De="[object Int32Array]",je="[object Uint8Array]",Te="[object Uint8ClampedArray]",we="[object Uint16Array]",Ie="[object Uint32Array]",Oe=/[\\^$.*+?()[\]{}|]/g,ve=/^\[object .+?Constructor\]$/,xe=/^(?:0|[1-9]\d*)$/,Ge={};Ge[he]=Ge[fe]=Ge[de]=Ge[ke]=Ge[De]=Ge[je]=Ge[Te]=Ge[we]=Ge[Ie]=!0,Ge[y]=Ge[v]=Ge[Q]=Ge[C]=Ge[ne]=Ge[R]=Ge[N]=Ge[M]=Ge[U]=Ge[z]=Ge[q]=Ge[ce]=Ge[ae]=Ge[pe]=Ge[X]=!1;var Ze=typeof Ny=="object"&&Ny&&Ny.Object===Object&&Ny,lt=typeof self=="object"&&self&&self.Object===Object&&self,vt=Ze||lt||Function("return this")(),nt=e&&!e.nodeType&&e,mt=nt&&!0&&n&&!n.nodeType&&n,et=mt&&mt.exports===nt,St=et&&Ze.process,un=function(){try{var be=mt&&mt.require&&mt.require("util").types;return be||St&&St.binding&&St.binding("util")}catch{}}(),ft=un&&un.isTypedArray;function Ct(be,Me,ot){switch(ot.length){case 0:return be.call(Me);case 1:return be.call(Me,ot[0]);case 2:return be.call(Me,ot[0],ot[1]);case 3:return be.call(Me,ot[0],ot[1],ot[2])}return be.apply(Me,ot)}function ut(be,Me){for(var ot=-1,Kt=Array(be);++ot<be;)Kt[ot]=Me(ot);return Kt}function Ft(be){return function(Me){return be(Me)}}function on(be,Me){return be==null?void 0:be[Me]}function Ht(be,Me){return function(ot){return be(Me(ot))}}var Se=Array.prototype,Ne=Function.prototype,$e=Object.prototype,Pt=vt["__core-js_shared__"],Ot=Ne.toString,Et=$e.hasOwnProperty,xt=function(){var be=/[^.]+$/.exec(Pt&&Pt.keys&&Pt.keys.IE_PROTO||"");return be?"Symbol(src)_1."+be:""}(),pn=$e.toString,Cn=Ot.call(Object),En=RegExp("^"+Ot.call(Et).replace(Oe,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),It=et?vt.Buffer:void 0,cr=vt.Symbol,Lt=vt.Uint8Array;It&&It.allocUnsafe;var Yt=Ht(Object.getPrototypeOf,Object),Or=Object.create,Oi=$e.propertyIsEnumerable,ji=Se.splice,Fr=cr?cr.toStringTag:void 0,Xn=function(){try{var be=Va(Object,"defineProperty");return be({},"",{}),be}catch{}}(),oa=It?It.isBuffer:void 0,Ki=Math.max,xa=Date.now,Sl=Va(vt,"Map"),Ps=Va(Object,"create"),La=function(){function be(){}return function(Me){if(!Uc(Me))return{};if(Or)return Or(Me);be.prototype=Me;var ot=new be;return be.prototype=void 0,ot}}();function Wo(be){var Me=-1,ot=be==null?0:be.length;for(this.clear();++Me<ot;){var Kt=be[Me];this.set(Kt[0],Kt[1])}}function uo(){this.__data__=Ps?Ps(null):{},this.size=0}function ud(be){var Me=this.has(be)&&delete this.__data__[be];return this.size-=Me?1:0,Me}function Go(be){var Me=this.__data__;if(Ps){var ot=Me[be];return ot===o?void 0:ot}return Et.call(Me,be)?Me[be]:void 0}function dd(be){var Me=this.__data__;return Ps?Me[be]!==void 0:Et.call(Me,be)}function uc(be,Me){var ot=this.__data__;return this.size+=this.has(be)?0:1,ot[be]=Ps&&Me===void 0?o:Me,this}Wo.prototype.clear=uo,Wo.prototype.delete=ud,Wo.prototype.get=Go,Wo.prototype.has=dd,Wo.prototype.set=uc;function bo(be){var Me=-1,ot=be==null?0:be.length;for(this.clear();++Me<ot;){var Kt=be[Me];this.set(Kt[0],Kt[1])}}function Tr(){this.__data__=[],this.size=0}function lu(be){var Me=this.__data__,ot=ei(Me,be);if(ot<0)return!1;var Kt=Me.length-1;return ot==Kt?Me.pop():ji.call(Me,ot,1),--this.size,!0}function aa(be){var Me=this.__data__,ot=ei(Me,be);return ot<0?void 0:Me[ot][1]}function Ma(be){return ei(this.__data__,be)>-1}function xc(be,Me){var ot=this.__data__,Kt=ei(ot,be);return Kt<0?(++this.size,ot.push([be,Me])):ot[Kt][1]=Me,this}bo.prototype.clear=Tr,bo.prototype.delete=lu,bo.prototype.get=aa,bo.prototype.has=Ma,bo.prototype.set=xc;function Ho(be){var Me=-1,ot=be==null?0:be.length;for(this.clear();++Me<ot;){var Kt=be[Me];this.set(Kt[0],Kt[1])}}function gt(){this.size=0,this.__data__={hash:new Wo,map:new(Sl||bo),string:new Wo}}function _n(be){var Me=fd(this,be).delete(be);return this.size-=Me?1:0,Me}function jr(be){return fd(this,be).get(be)}function Ni(be){return fd(this,be).has(be)}function uu(be,Me){var ot=fd(this,be),Kt=ot.size;return ot.set(be,Me),this.size+=ot.size==Kt?0:1,this}Ho.prototype.clear=gt,Ho.prototype.delete=_n,Ho.prototype.get=jr,Ho.prototype.has=Ni,Ho.prototype.set=uu;function es(be){var Me=this.__data__=new bo(be);this.size=Me.size}function bl(){this.__data__=new bo,this.size=0}function $o(be){var Me=this.__data__,ot=Me.delete(be);return this.size=Me.size,ot}function hd(be){return this.__data__.get(be)}function Lc(be){return this.__data__.has(be)}function wl(be,Me){var ot=this.__data__;if(ot instanceof bo){var Kt=ot.__data__;if(!Sl||Kt.length<i-1)return Kt.push([be,Me]),this.size=++ot.size,this;ot=this.__data__=new Ho(Kt)}return ot.set(be,Me),this.size=ot.size,this}es.prototype.clear=bl,es.prototype.delete=$o,es.prototype.get=hd,es.prototype.has=Lc,es.prototype.set=wl;function ca(be,Me){var ot=ha(be),Kt=!ot&&_s(be),sr=!ot&&!Kt&&fa(be),Br=!ot&&!Kt&&!sr&&Al(be),si=ot||Kt||sr||Br,er=si?ut(be.length,String):[],tr=er.length;for(var Di in be)si&&(Di=="length"||sr&&(Di=="offset"||Di=="parent")||Br&&(Di=="buffer"||Di=="byteLength"||Di=="byteOffset")||Rl(Di,tr))||er.push(Di);return er}function dc(be,Me,ot){(ot!==void 0&&!da(be[Me],ot)||ot===void 0&&!(Me in be))&&In(be,Me,ot)}function Ko(be,Me,ot){var Kt=be[Me];(!(Et.call(be,Me)&&da(Kt,ot))||ot===void 0&&!(Me in be))&&In(be,Me,ot)}function ei(be,Me){for(var ot=be.length;ot--;)if(da(be[ot][0],Me))return ot;return-1}function In(be,Me,ot){Me=="__proto__"&&Xn?Xn(be,Me,{configurable:!0,enumerable:!0,value:ot,writable:!0}):be[Me]=ot}var em=pd();function ti(be){return be==null?be===void 0?H:J:Fr&&Fr in Object(be)?ua(be):_h(be)}function Tl(be){return ks(be)&&ti(be)==y}function Ua(be){if(!Uc(be)||pu(be))return!1;var Me=Fa(be)?En:ve;return Me.test(jp(be))}function Mp(be){return ks(be)&&Bp(be.length)&&!!Ge[ti(be)]}function tm(be){if(!Uc(be))return Il(be);var Me=mr(be),ot=[];for(var Kt in be)Kt=="constructor"&&(Me||!Et.call(be,Kt))||ot.push(Kt);return ot}function Mc(be,Me,ot,Kt,sr){be!==Me&&em(Me,function(Br,si){if(sr||(sr=new es),Uc(Br))la(be,Me,si,ot,Mc,Kt,sr);else{var er=Kt?Kt(fu(be,si),Br,si+"",be,Me,sr):void 0;er===void 0&&(er=Br),dc(be,si,er)}},gu)}function la(be,Me,ot,Kt,sr,Br,si){var er=fu(be,ot),tr=fu(Me,ot),Di=si.get(tr);if(Di){dc(be,ot,Di);return}var Ws=Br?Br(er,tr,ot+"",be,Me,si):void 0,Vc=Ws===void 0;if(Vc){var To=ha(tr),_u=!To&&fa(tr),Os=!To&&!_u&&Al(tr);Ws=tr,To||_u||Os?ha(er)?Ws=er:mu(er)?Ws=du(er):_u?(Vc=!1,Ws=Vp(tr)):Os?(Vc=!1,Ws=Cl(tr)):Ws=[]:Zg(tr)||_s(tr)?(Ws=er,_s(er)?Ws=Pl(er):(!Uc(er)||Fa(er))&&(Ws=md(tr))):Vc=!1}Vc&&(si.set(tr,Ws),sr(Ws,tr,Kt,Br,si),si.delete(tr)),dc(be,ot,Ws)}function Up(be,Me){return rm(yh(be,Me,ma),be+"")}var wo=Xn?function(be,Me){return Xn(be,"toString",{configurable:!0,enumerable:!1,value:hc(Me),writable:!0})}:ma;function Vp(be,Me){return be.slice()}function nm(be){var Me=new be.constructor(be.byteLength);return new Lt(Me).set(new Lt(be)),Me}function Cl(be,Me){var ot=nm(be.buffer);return new be.constructor(ot,be.byteOffset,be.length)}function du(be,Me){var ot=-1,Kt=be.length;for(Me||(Me=Array(Kt));++ot<Kt;)Me[ot]=be[ot];return Me}function gh(be,Me,ot,Kt){var sr=!ot;ot||(ot={});for(var Br=-1,si=Me.length;++Br<si;){var er=Me[Br],tr=void 0;tr===void 0&&(tr=be[er]),sr?In(ot,er,tr):Ko(ot,er,tr)}return ot}function Nr(be){return Up(function(Me,ot){var Kt=-1,sr=ot.length,Br=sr>1?ot[sr-1]:void 0,si=sr>2?ot[2]:void 0;for(Br=be.length>3&&typeof Br=="function"?(sr--,Br):void 0,si&&hu(ot[0],ot[1],si)&&(Br=sr<3?void 0:Br,sr=1),Me=Object(Me);++Kt<sr;){var er=ot[Kt];er&&be(Me,er,Kt,Br)}return Me})}function pd(be){return function(Me,ot,Kt){for(var sr=-1,Br=Object(Me),si=Kt(Me),er=si.length;er--;){var tr=si[++sr];if(ot(Br[tr],tr,Br)===!1)break}return Me}}function fd(be,Me){var ot=be.__data__;return ui(Me)?ot[typeof Me=="string"?"string":"hash"]:ot.map}function Va(be,Me){var ot=on(be,Me);return Ua(ot)?ot:void 0}function ua(be){var Me=Et.call(be,Fr),ot=be[Fr];try{be[Fr]=void 0;var Kt=!0}catch{}var sr=pn.call(be);return Kt&&(Me?be[Fr]=ot:delete be[Fr]),sr}function md(be){return typeof be.constructor=="function"&&!mr(be)?La(Yt(be)):{}}function Rl(be,Me){var ot=typeof be;return Me=Me??p,!!Me&&(ot=="number"||ot!="symbol"&&xe.test(be))&&be>-1&&be%1==0&&be<Me}function hu(be,Me,ot){if(!Uc(ot))return!1;var Kt=typeof Me;return(Kt=="number"?pa(ot)&&Rl(Me,ot.length):Kt=="string"&&Me in ot)?da(ot[Me],be):!1}function ui(be){var Me=typeof be;return Me=="string"||Me=="number"||Me=="symbol"||Me=="boolean"?be!=="__proto__":be===null}function pu(be){return!!xt&&xt in be}function mr(be){var Me=be&&be.constructor,ot=typeof Me=="function"&&Me.prototype||$e;return be===ot}function Il(be){var Me=[];if(be!=null)for(var ot in Object(be))Me.push(ot);return Me}function _h(be){return pn.call(be)}function yh(be,Me,ot){return Me=Ki(Me===void 0?be.length-1:Me,0),function(){for(var Kt=arguments,sr=-1,Br=Ki(Kt.length-Me,0),si=Array(Br);++sr<Br;)si[sr]=Kt[Me+sr];sr=-1;for(var er=Array(Me+1);++sr<Me;)er[sr]=Kt[sr];return er[Me]=ot(si),Ct(be,this,er)}}function fu(be,Me){if(!(Me==="constructor"&&typeof be[Me]=="function")&&Me!="__proto__")return be[Me]}var rm=Fp(wo);function Fp(be){var Me=0,ot=0;return function(){var Kt=xa(),sr=u-(Kt-ot);if(ot=Kt,sr>0){if(++Me>=l)return arguments[0]}else Me=0;return be.apply(void 0,arguments)}}function jp(be){if(be!=null){try{return Ot.call(be)}catch{}try{return be+""}catch{}}return""}function da(be,Me){return be===Me||be!==be&&Me!==Me}var _s=Tl(function(){return arguments}())?Tl:function(be){return ks(be)&&Et.call(be,"callee")&&!Oi.call(be,"callee")},ha=Array.isArray;function pa(be){return be!=null&&Bp(be.length)&&!Fa(be)}function mu(be){return ks(be)&&pa(be)}var fa=oa||kl;function Fa(be){if(!Uc(be))return!1;var Me=ti(be);return Me==M||Me==L||Me==w||Me==re}function Bp(be){return typeof be=="number"&&be>-1&&be%1==0&&be<=p}function Uc(be){var Me=typeof be;return be!=null&&(Me=="object"||Me=="function")}function ks(be){return be!=null&&typeof be=="object"}function Zg(be){if(!ks(be)||ti(be)!=q)return!1;var Me=Yt(be);if(Me===null)return!0;var ot=Et.call(Me,"constructor")&&Me.constructor;return typeof ot=="function"&&ot instanceof ot&&Ot.call(ot)==Cn}var Al=ft?Ft(ft):Mp;function Pl(be){return gh(be,gu(be))}function gu(be){return pa(be)?ca(be):tm(be)}var im=Nr(function(be,Me,ot,Kt){Mc(be,Me,ot,Kt)});function hc(be){return function(){return be}}function ma(be){return be}function kl(){return!1}n.exports=im}(sC,sC.exports)),sC.exports}var Pve=Ave();const _p=$g(Pve);function so(n,e=[]){const i=O.useRef(n);return O.useEffect(()=>{i.current=n}),O.useCallback((...o)=>{var l;return(l=i.current)==null?void 0:l.call(i,...o)},e)}function Vy(n,e,i,o){const l=so(i);return O.useEffect(()=>{const u=typeof n=="function"?n():n??document;if(!(!i||!u))return u.addEventListener(e,l,o),()=>{u.removeEventListener(e,l,o)}},[e,n,o,l,i]),()=>{const u=typeof n=="function"?n():n??document;u==null||u.removeEventListener(e,l,o)}}function iee(n){const{isOpen:e,ref:i}=n,[o,l]=O.useState(e),[u,p]=O.useState(!1);return O.useEffect(()=>{u||(l(e),p(!0))},[e,u,o]),Vy(()=>i.current,"animationend",()=>{l(e)}),{present:!(e?!1:!o),onComplete(){var C;const v=JEe(i.current),w=new v.CustomEvent("animationend",{bubbles:!0});(C=i.current)==null||C.dispatchEvent(w)}}}var $M,fq;function kve(){return fq||(fq=1,$M=function(){var n=document.getSelection();if(!n.rangeCount)return function(){};for(var e=document.activeElement,i=[],o=0;o<n.rangeCount;o++)i.push(n.getRangeAt(o));switch(e.tagName.toUpperCase()){case"INPUT":case"TEXTAREA":e.blur();break;default:e=null;break}return n.removeAllRanges(),function(){n.type==="Caret"&&n.removeAllRanges(),n.rangeCount||i.forEach(function(l){n.addRange(l)}),e&&e.focus()}}),$M}var KM,mq;function Ove(){if(mq)return KM;mq=1;var n=kve(),e={"text/plain":"Text","text/html":"Url",default:"Text"},i="Copy to clipboard: #{key}, Enter";function o(u){var p=(/mac os x/i.test(navigator.userAgent)?"":"Ctrl")+"+C";return u.replace(/#{\s*key\s*}/g,p)}function l(u,p){var y,v,w,C,R,N,M=!1;p||(p={}),y=p.debug||!1;try{w=n(),C=document.createRange(),R=document.getSelection(),N=document.createElement("span"),N.textContent=u,N.ariaHidden="true",N.style.all="unset",N.style.position="fixed",N.style.top=0,N.style.clip="rect(0, 0, 0, 0)",N.style.whiteSpace="pre",N.style.webkitUserSelect="text",N.style.MozUserSelect="text",N.style.msUserSelect="text",N.style.userSelect="text",N.addEventListener("copy",function(U){if(U.stopPropagation(),p.format)if(U.preventDefault(),typeof U.clipboardData>"u"){y&&console.warn("unable to use e.clipboardData"),y&&console.warn("trying IE specific stuff"),window.clipboardData.clearData();var z=e[p.format]||e.default;window.clipboardData.setData(z,u)}else U.clipboardData.clearData(),U.clipboardData.setData(p.format,u);p.onCopy&&(U.preventDefault(),p.onCopy(U.clipboardData))}),document.body.appendChild(N),C.selectNodeContents(N),R.addRange(C);var L=document.execCommand("copy");if(!L)throw new Error("copy command was unsuccessful");M=!0}catch(U){y&&console.error("unable to copy using execCommand: ",U),y&&console.warn("trying IE specific stuff");try{window.clipboardData.setData(p.format||"text",u),p.onCopy&&p.onCopy(window.clipboardData),M=!0}catch(z){y&&console.error("unable to copy using clipboardData: ",z),y&&console.error("falling back to prompt"),v=o("message"in p?p.message:i),window.prompt(v,u)}}finally{R&&(typeof R.removeRange=="function"?R.removeRange(C):R.removeAllRanges()),N&&document.body.removeChild(N),w()}return M}return KM=l,KM}var Nve=Ove();const gq=$g(Nve);function _q(n,e={}){const[i,o]=O.useState(!1),[l,u]=O.useState(n);O.useEffect(()=>u(n),[n]);const{timeout:p=1500,...y}=typeof e=="number"?{timeout:e}:e,v=O.useCallback(w=>{const C=typeof w=="string"?w:l;"clipboard"in navigator?navigator.clipboard.writeText(C).then(()=>o(!0)).catch(()=>o(gq(C,y))):o(gq(C,y))},[l,y]);return O.useEffect(()=>{let w=null;return i&&(w=window.setTimeout(()=>{o(!1)},p)),()=>{w&&window.clearTimeout(w)}},[p,i]),{value:l,setValue:u,onCopy:v,hasCopied:i}}function see(n){const{value:e,defaultValue:i,onChange:o,shouldUpdate:l=(N,M)=>N!==M}=n,u=so(o),p=so(l),[y,v]=O.useState(i),w=e!==void 0,C=w?e:y,R=so(N=>{const L=typeof N=="function"?N(C):N;p(C,L)&&(w||v(L),u(L))},[w,u,C,p]);return[C,R]}function Dve(n={}){const{onChange:e,precision:i,defaultValue:o,value:l,step:u=1,min:p=Number.MIN_SAFE_INTEGER,max:y=Number.MAX_SAFE_INTEGER,keepWithinRange:v=!0}=n,w=so(e),[C,R]=O.useState(()=>o==null?"":qM(o,u,i)??""),N=typeof l<"u",M=N?l:C,L=oee(mg(M),u),U=i??L,z=O.useCallback(ne=>{ne!==M&&(N||R(ne.toString()),w==null||w(ne.toString(),mg(ne)))},[w,N,M]),J=O.useCallback(ne=>{let he=ne;return v&&(he=_k(he,p,y)),ZF(he,U)},[U,v,y,p]),q=O.useCallback((ne=u)=>{let he;M===""?he=mg(ne):he=mg(M)+ne,he=J(he),z(he)},[J,u,z,M]),re=O.useCallback((ne=u)=>{let he;M===""?he=mg(-ne):he=mg(M)-ne,he=J(he),z(he)},[J,u,z,M]),ce=O.useCallback(()=>{let ne;o==null?ne="":ne=qM(o,u,i)??p,z(ne)},[o,i,u,z,p]),ae=O.useCallback(ne=>{const he=qM(ne,u,U)??p;z(he)},[U,u,z,p]),pe=mg(M);return{isOutOfRange:pe>y||pe<p,isAtMax:pe===y,isAtMin:pe===p,precision:U,value:M,valueAsNumber:pe,update:z,reset:ce,increment:q,decrement:re,clamp:J,cast:ae,setValue:R}}function mg(n){return parseFloat(n.toString().replace(/[^\w.-]+/g,""))}function oee(n,e){return Math.max(gV(e),gV(n))}function qM(n,e,i){const o=mg(n);if(Number.isNaN(o))return;const l=oee(o,e);return ZF(o,i??l)}function od(n={}){const{onClose:e,onOpen:i,isOpen:o,id:l}=n,u=so(i),p=so(e),[y,v]=O.useState(n.defaultIsOpen||!1),w=o!==void 0?o:y,C=o!==void 0,R=O.useId(),N=l??`disclosure-${R}`,M=O.useCallback(()=>{C||v(!1),p==null||p()},[C,p]),L=O.useCallback(()=>{C||v(!0),u==null||u()},[C,u]),U=O.useCallback(()=>{w?M():L()},[w,L,M]);function z(q={}){return{...q,"aria-expanded":w,"aria-controls":N,onClick(re){var ce;(ce=q.onClick)==null||ce.call(q,re),U()}}}function J(q={}){return{...q,hidden:!w,id:N}}return{isOpen:w,onOpen:L,onClose:M,onToggle:U,isControlled:C,getButtonProps:z,getDisclosureProps:J}}const Sp=globalThis!=null&&globalThis.document?O.useLayoutEffect:O.useEffect,jf=(n,e)=>{const i=O.useRef(!1),o=O.useRef(!1);O.useEffect(()=>{if(i.current&&o.current)return n();o.current=!0},e),O.useEffect(()=>(i.current=!0,()=>{i.current=!1}),[])};function xve(n){const e=n.current;if(!e)return!1;const i=ZEe(e);return!i||e.contains(i)?!1:!!fve(i)}function aee(n,e){const{shouldFocus:i,visible:o,focusRef:l}=e,u=i&&!o;jf(()=>{if(!u||xve(n))return;const p=(l==null?void 0:l.current)||n.current;let y;if(p)return y=requestAnimationFrame(()=>{p.focus({preventScroll:!0})}),()=>{cancelAnimationFrame(y)}},[u,n,l])}const Lve={preventScroll:!0,shouldFocus:!1};function Mve(n,e=Lve){const{focusRef:i,preventScroll:o,shouldFocus:l,visible:u}=e,p=Uve(n)?n.current:n,y=l&&u,v=O.useRef(y),w=O.useRef(u);Sp(()=>{!w.current&&u&&(v.current=y),w.current=u},[u,y]);const C=O.useCallback(()=>{if(!(!u||!p||!v.current)&&(v.current=!1,!p.contains(document.activeElement)))if(i!=null&&i.current)requestAnimationFrame(()=>{var R;(R=i.current)==null||R.focus({preventScroll:o})});else{const R=eee(p);R.length>0&&requestAnimationFrame(()=>{R[0].focus({preventScroll:o})})}},[u,o,p,i]);jf(()=>{C()},[C]),Vy(p,"transitionend",C)}function Uve(n){return"current"in n}function Vve(n){return"current"in n}const cee=()=>typeof window<"u";function Fve(){const n=navigator.userAgentData;return(n==null?void 0:n.platform)??navigator.platform}const jve=n=>cee()&&n.test(navigator.vendor),Bve=n=>cee()&&n.test(Fve()),zve=()=>Bve(/mac|iphone|ipad|ipod/i),Wve=()=>zve()&&jve(/apple/i);function Gve(n){const{ref:e,elements:i,enabled:o}=n,l=()=>{var u;return((u=e.current)==null?void 0:u.ownerDocument)??document};Vy(l,"pointerdown",u=>{var w,C;if(!Wve()||!o)return;const p=((C=(w=u.composedPath)==null?void 0:w.call(u))==null?void 0:C[0])??u.target,v=(i??[e]).some(R=>{const N=Vve(R)?R.current:R;return(N==null?void 0:N.contains(p))||N===p});l().activeElement!==p&&v&&(u.preventDefault(),p.focus())})}function Hve(n,e){const i=O.useId();return O.useMemo(()=>n||[e,i].filter(Boolean).join("-"),[n,e,i])}function $ve(n,...e){const i=Hve(n);return O.useMemo(()=>e.map(o=>`${o}-${i}`),[i,e])}function Kve(n,e){const i=so(n);O.useEffect(()=>{let o=null;const l=()=>i();return e!==null&&(o=window.setInterval(l,e)),()=>{o&&window.clearInterval(o)}},[e,i])}function lee(n){const e=O.useRef(null);return e.current=n,e}function qve(n,e){if(n!=null){if(typeof n=="function"){n(e);return}try{n.current=e}catch{throw new Error(`Cannot assign value '${e}' to ref '${n}'`)}}}function $i(...n){return e=>{n.forEach(i=>{qve(i,e)})}}function Yve(...n){return O.useMemo(()=>$i(...n),n)}function uee(n){const{ref:e,handler:i,enabled:o=!0}=n,l=so(i),p=O.useRef({isPointerDown:!1,ignoreEmulatedMouseEvents:!1}).current;O.useEffect(()=>{if(!o)return;const y=R=>{YM(R,e)&&(p.isPointerDown=!0)},v=R=>{if(p.ignoreEmulatedMouseEvents){p.ignoreEmulatedMouseEvents=!1;return}p.isPointerDown&&i&&YM(R,e)&&(p.isPointerDown=!1,l(R))},w=R=>{p.ignoreEmulatedMouseEvents=!0,i&&p.isPointerDown&&YM(R,e)&&(p.isPointerDown=!1,l(R))},C=dee(e.current);return C.addEventListener("mousedown",y,!0),C.addEventListener("mouseup",v,!0),C.addEventListener("touchstart",y,!0),C.addEventListener("touchend",w,!0),()=>{C.removeEventListener("mousedown",y,!0),C.removeEventListener("mouseup",v,!0),C.removeEventListener("touchstart",y,!0),C.removeEventListener("touchend",w,!0)}},[i,e,l,p,o])}function YM(n,e){var o,l;const i=((o=n.composedPath)==null?void 0:o.call(n)[0])??n.target;return i&&!dee(i).contains(i)?!1:!((l=e.current)!=null&&l.contains(i))}function dee(n){return(n==null?void 0:n.ownerDocument)??document}function Xve(n,e){const i=so(n);O.useEffect(()=>{if(e==null)return;let o=null;return o=window.setTimeout(()=>{i()},e),()=>{o&&window.clearTimeout(o)}},[e,i])}const hee=1/60*1e3,Jve=typeof performance<"u"?()=>performance.now():()=>Date.now(),pee=typeof window<"u"?n=>window.requestAnimationFrame(n):n=>setTimeout(()=>n(Jve()),hee);function Qve(n){let e=[],i=[],o=0,l=!1,u=!1;const p=new WeakSet,y={schedule:(v,w=!1,C=!1)=>{const R=C&&l,N=R?e:i;return w&&p.add(v),N.indexOf(v)===-1&&(N.push(v),R&&l&&(o=e.length)),v},cancel:v=>{const w=i.indexOf(v);w!==-1&&i.splice(w,1),p.delete(v)},process:v=>{if(l){u=!0;return}if(l=!0,[e,i]=[i,e],i.length=0,o=e.length,o)for(let w=0;w<o;w++){const C=e[w];C(v),p.has(C)&&(y.schedule(C),n())}l=!1,u&&(u=!1,y.process(v))}};return y}const Zve=40;let _V=!0,HC=!1,yV=!1;const J0={delta:0,timestamp:0},wR=["read","update","preRender","render","postRender"],YO=wR.reduce((n,e)=>(n[e]=Qve(()=>HC=!0),n),{}),e0e=wR.reduce((n,e)=>{const i=YO[e];return n[e]=(o,l=!1,u=!1)=>(HC||r0e(),i.schedule(o,l,u)),n},{}),t0e=wR.reduce((n,e)=>(n[e]=YO[e].cancel,n),{});wR.reduce((n,e)=>(n[e]=()=>YO[e].process(J0),n),{});const n0e=n=>YO[n].process(J0),fee=n=>{HC=!1,J0.delta=_V?hee:Math.max(Math.min(n-J0.timestamp,Zve),1),J0.timestamp=n,yV=!0,wR.forEach(n0e),yV=!1,HC&&(_V=!1,pee(fee))},r0e=()=>{HC=!0,_V=!0,yV||pee(fee)},yq=()=>J0;var i0e=Object.defineProperty,s0e=(n,e,i)=>e in n?i0e(n,e,{enumerable:!0,configurable:!0,writable:!0,value:i}):n[e]=i,eh=(n,e,i)=>(s0e(n,typeof e!="symbol"?e+"":e,i),i);class o0e{constructor(e,i,o){if(eh(this,"history",[]),eh(this,"startEvent",null),eh(this,"lastEvent",null),eh(this,"lastEventInfo",null),eh(this,"handlers",{}),eh(this,"removeListeners",()=>{}),eh(this,"threshold",3),eh(this,"win"),eh(this,"updatePoint",()=>{if(!(this.lastEvent&&this.lastEventInfo))return;const y=XM(this.lastEventInfo,this.history),v=this.startEvent!==null,w=u0e(y.offset,{x:0,y:0})>=this.threshold;if(!v&&!w)return;const{timestamp:C}=yq();this.history.push({...y.point,timestamp:C});const{onStart:R,onMove:N}=this.handlers;v||(R==null||R(this.lastEvent,y),this.startEvent=this.lastEvent),N==null||N(this.lastEvent,y)}),eh(this,"onPointerMove",(y,v)=>{this.lastEvent=y,this.lastEventInfo=v,e0e.update(this.updatePoint,!0)}),eh(this,"onPointerUp",(y,v)=>{const w=XM(v,this.history),{onEnd:C,onSessionEnd:R}=this.handlers;R==null||R(y,w),this.end(),!(!C||!this.startEvent)&&(C==null||C(y,w))}),this.win=e.view??window,tve(e))return;this.handlers=i,o&&(this.threshold=o),e.stopPropagation(),e.preventDefault();const l={point:XZ(e)},{timestamp:u}=yq();this.history=[{...l.point,timestamp:u}];const{onSessionStart:p}=i;p==null||p(e,XM(l,this.history)),this.removeListeners=l0e(gk(this.win,"pointermove",this.onPointerMove),gk(this.win,"pointerup",this.onPointerUp),gk(this.win,"pointercancel",this.onPointerUp))}updateHandlers(e){this.handlers=e}end(){var e;(e=this.removeListeners)==null||e.call(this),t0e.update(this.updatePoint)}}function Eq(n,e){return{x:n.x-e.x,y:n.y-e.y}}function XM(n,e){return{point:n.point,delta:Eq(n.point,e[e.length-1]),offset:Eq(n.point,e[0]),velocity:c0e(e,.1)}}const a0e=n=>n*1e3;function c0e(n,e){if(n.length<2)return{x:0,y:0};let i=n.length-1,o=null;const l=n[n.length-1];for(;i>=0&&(o=n[i],!(l.timestamp-o.timestamp>a0e(e)));)i--;if(!o)return{x:0,y:0};const u=(l.timestamp-o.timestamp)/1e3;if(u===0)return{x:0,y:0};const p={x:(l.x-o.x)/u,y:(l.y-o.y)/u};return p.x===1/0&&(p.x=0),p.y===1/0&&(p.y=0),p}function l0e(...n){return e=>n.reduce((i,o)=>o(i),e)}function JM(n,e){return Math.abs(n-e)}function vq(n){return"x"in n&&"y"in n}function u0e(n,e){if(typeof n=="number"&&typeof e=="number")return JM(n,e);if(vq(n)&&vq(e)){const i=JM(n.x,e.x),o=JM(n.y,e.y);return Math.sqrt(i**2+o**2)}return 0}function d0e(n,e){const{onPan:i,onPanStart:o,onPanEnd:l,onPanSessionStart:u,onPanSessionEnd:p,threshold:y}=e,v=!!(i||o||l||u||p),w=O.useRef(null),C=lee({onSessionStart:u,onSessionEnd:p,onStart:o,onMove:i,onEnd(R,N){w.current=null,l==null||l(R,N)}});O.useEffect(()=>{var R;(R=w.current)==null||R.updateHandlers(C.current)}),O.useEffect(()=>{const R=n.current;if(!R||!v)return;function N(M){w.current=new o0e(M,C.current,y)}return gk(R,"pointerdown",N)},[n,v,C,y]),O.useEffect(()=>()=>{var R;(R=w.current)==null||R.end(),w.current=null},[])}const No={open:(n,e)=>`${n}[data-open], ${n}[open], ${n}[data-state=open] ${e}`,closed:(n,e)=>`${n}[data-closed], ${n}[data-state=closed] ${e}`,hover:(n,e)=>`${n}:hover ${e}, ${n}[data-hover] ${e}`,focus:(n,e)=>`${n}:focus ${e}, ${n}[data-focus] ${e}`,focusVisible:(n,e)=>`${n}:focus-visible ${e}`,focusWithin:(n,e)=>`${n}:focus-within ${e}`,active:(n,e)=>`${n}:active ${e}, ${n}[data-active] ${e}`,disabled:(n,e)=>`${n}:disabled ${e}, ${n}[data-disabled] ${e}`,invalid:(n,e)=>`${n}:invalid ${e}, ${n}[data-invalid] ${e}`,checked:(n,e)=>`${n}:checked ${e}, ${n}[data-checked] ${e}`,placeholderShown:(n,e)=>`${n}:placeholder-shown ${e}`},sp=n=>mee(e=>n(e,"&"),"[role=group]","[data-group]",".group"),Sf=n=>mee(e=>n(e,"~ &"),"[data-peer]",".peer"),mee=(n,...e)=>e.map(n).join(", "),Q0={_hover:"&:hover, &[data-hover]",_active:"&:active, &[data-active]",_focus:"&:focus, &[data-focus]",_highlighted:"&[data-highlighted]",_focusWithin:"&:focus-within, &[data-focus-within]",_focusVisible:"&:focus-visible, &[data-focus-visible]",_disabled:"&:disabled, &[disabled], &[aria-disabled=true], &[data-disabled]",_readOnly:"&[aria-readonly=true], &[readonly], &[data-readonly]",_before:"&::before",_after:"&::after",_empty:"&:empty, &[data-empty]",_expanded:"&[aria-expanded=true], &[data-expanded], &[data-state=expanded]",_checked:"&[aria-checked=true], &[data-checked], &[data-state=checked]",_grabbed:"&[aria-grabbed=true], &[data-grabbed]",_pressed:"&[aria-pressed=true], &[data-pressed]",_invalid:"&[aria-invalid=true], &[data-invalid]",_valid:"&[data-valid], &[data-state=valid]",_loading:"&[data-loading], &[aria-busy=true]",_selected:"&[aria-selected=true], &[data-selected]",_hidden:"&[hidden], &[data-hidden]",_autofill:"&:-webkit-autofill",_even:"&:nth-of-type(even)",_odd:"&:nth-of-type(odd)",_first:"&:first-of-type",_firstLetter:"&::first-letter",_last:"&:last-of-type",_notFirst:"&:not(:first-of-type)",_notLast:"&:not(:last-of-type)",_visited:"&:visited",_activeLink:"&[aria-current=page]",_activeStep:"&[aria-current=step]",_indeterminate:"&:indeterminate, &[aria-checked=mixed], &[data-indeterminate], &[data-state=indeterminate]",_groupOpen:sp(No.open),_groupClosed:sp(No.closed),_groupHover:sp(No.hover),_peerHover:Sf(No.hover),_groupFocus:sp(No.focus),_peerFocus:Sf(No.focus),_groupFocusVisible:sp(No.focusVisible),_peerFocusVisible:Sf(No.focusVisible),_groupActive:sp(No.active),_peerActive:Sf(No.active),_groupDisabled:sp(No.disabled),_peerDisabled:Sf(No.disabled),_groupInvalid:sp(No.invalid),_peerInvalid:Sf(No.invalid),_groupChecked:sp(No.checked),_peerChecked:Sf(No.checked),_groupFocusWithin:sp(No.focusWithin),_peerFocusWithin:Sf(No.focusWithin),_peerPlaceholderShown:Sf(No.placeholderShown),_placeholder:"&::placeholder, &[data-placeholder]",_placeholderShown:"&:placeholder-shown, &[data-placeholder-shown]",_fullScreen:"&:fullscreen, &[data-fullscreen]",_selection:"&::selection",_rtl:"[dir=rtl] &, &[dir=rtl]",_ltr:"[dir=ltr] &, &[dir=ltr]",_mediaDark:"@media (prefers-color-scheme: dark)",_mediaReduceMotion:"@media (prefers-reduced-motion: reduce)",_dark:".chakra-ui-dark &:not([data-theme]),[data-theme=dark] &:not([data-theme]),&[data-theme=dark]",_light:".chakra-ui-light &:not([data-theme]),[data-theme=light] &:not([data-theme]),&[data-theme=light]",_horizontal:"&[data-orientation=horizontal]",_vertical:"&[data-orientation=vertical]",_open:"&[data-open], &[open], &[data-state=open]",_closed:"&[data-closed], &[data-state=closed]",_complete:"&[data-complete]",_incomplete:"&[data-incomplete]",_current:"&[data-current]"},gee=Object.keys(Q0),h0e=n=>/!(important)?$/.test(n),Sq=n=>typeof n=="string"?n.replace(/!(important)?$/,"").trim():n,p0e=(n,e)=>i=>{const o=String(e),l=h0e(o),u=Sq(o),p=n?`${n}.${u}`:u;let y=ed(i.__cssMap)&&p in i.__cssMap?i.__cssMap[p].varRef:e;return y=Sq(y),l?`${y} !important`:y};function ej(n){const{scale:e,transform:i,compose:o}=n;return(u,p)=>{const y=p0e(e,u)(p);let v=(i==null?void 0:i(y,p))??y;return o&&(v=o(v,p)),v}}const U1=(...n)=>e=>n.reduce((i,o)=>o(i),e);function qu(n,e){return i=>{const o={property:i,scale:n};return o.transform=ej({scale:n,transform:e}),o}}const f0e=({rtl:n,ltr:e})=>i=>i.direction==="rtl"?n:e;function m0e(n){const{property:e,scale:i,transform:o}=n;return{scale:i,property:f0e(e),transform:i?ej({scale:i,compose:o}):o}}const _ee=["rotate(var(--chakra-rotate, 0))","scaleX(var(--chakra-scale-x, 1))","scaleY(var(--chakra-scale-y, 1))","skewX(var(--chakra-skew-x, 0))","skewY(var(--chakra-skew-y, 0))"];function g0e(){return["translateX(var(--chakra-translate-x, 0))","translateY(var(--chakra-translate-y, 0))",..._ee].join(" ")}function _0e(){return["translate3d(var(--chakra-translate-x, 0), var(--chakra-translate-y, 0), 0)",..._ee].join(" ")}const y0e={"--chakra-blur":"var(--chakra-empty,/*!*/ /*!*/)","--chakra-brightness":"var(--chakra-empty,/*!*/ /*!*/)","--chakra-contrast":"var(--chakra-empty,/*!*/ /*!*/)","--chakra-grayscale":"var(--chakra-empty,/*!*/ /*!*/)","--chakra-hue-rotate":"var(--chakra-empty,/*!*/ /*!*/)","--chakra-invert":"var(--chakra-empty,/*!*/ /*!*/)","--chakra-saturate":"var(--chakra-empty,/*!*/ /*!*/)","--chakra-sepia":"var(--chakra-empty,/*!*/ /*!*/)","--chakra-drop-shadow":"var(--chakra-empty,/*!*/ /*!*/)",filter:["var(--chakra-blur)","var(--chakra-brightness)","var(--chakra-contrast)","var(--chakra-grayscale)","var(--chakra-hue-rotate)","var(--chakra-invert)","var(--chakra-saturate)","var(--chakra-sepia)","var(--chakra-drop-shadow)"].join(" ")},E0e={backdropFilter:["var(--chakra-backdrop-blur)","var(--chakra-backdrop-brightness)","var(--chakra-backdrop-contrast)","var(--chakra-backdrop-grayscale)","var(--chakra-backdrop-hue-rotate)","var(--chakra-backdrop-invert)","var(--chakra-backdrop-opacity)","var(--chakra-backdrop-saturate)","var(--chakra-backdrop-sepia)"].join(" "),"--chakra-backdrop-blur":"var(--chakra-empty,/*!*/ /*!*/)","--chakra-backdrop-brightness":"var(--chakra-empty,/*!*/ /*!*/)","--chakra-backdrop-contrast":"var(--chakra-empty,/*!*/ /*!*/)","--chakra-backdrop-grayscale":"var(--chakra-empty,/*!*/ /*!*/)","--chakra-backdrop-hue-rotate":"var(--chakra-empty,/*!*/ /*!*/)","--chakra-backdrop-invert":"var(--chakra-empty,/*!*/ /*!*/)","--chakra-backdrop-opacity":"var(--chakra-empty,/*!*/ /*!*/)","--chakra-backdrop-saturate":"var(--chakra-empty,/*!*/ /*!*/)","--chakra-backdrop-sepia":"var(--chakra-empty,/*!*/ /*!*/)"};function v0e(n){return{"--chakra-ring-offset-shadow":"var(--chakra-ring-inset) 0 0 0 var(--chakra-ring-offset-width) var(--chakra-ring-offset-color)","--chakra-ring-shadow":"var(--chakra-ring-inset) 0 0 0 calc(var(--chakra-ring-width) + var(--chakra-ring-offset-width)) var(--chakra-ring-color)","--chakra-ring-width":n,boxShadow:["var(--chakra-ring-offset-shadow)","var(--chakra-ring-shadow)","var(--chakra-shadow, 0 0 #0000)"].join(", ")}}const S0e={"row-reverse":{space:"--chakra-space-x-reverse",divide:"--chakra-divide-x-reverse"},"column-reverse":{space:"--chakra-space-y-reverse",divide:"--chakra-divide-y-reverse"}},EV={"to-t":"to top","to-tr":"to top right","to-r":"to right","to-br":"to bottom right","to-b":"to bottom","to-bl":"to bottom left","to-l":"to left","to-tl":"to top left"},b0e=new Set(Object.values(EV)),vV=new Set(["none","-moz-initial","inherit","initial","revert","unset"]),w0e=n=>n.trim();function T0e(n,e){if(n==null||vV.has(n))return n;if(!(SV(n)||vV.has(n)))return`url('${n}')`;const l=/(^[a-z-A-Z]+)\((.*)\)/g.exec(n),u=l==null?void 0:l[1],p=l==null?void 0:l[2];if(!u||!p)return n;const y=u.includes("-gradient")?u:`${u}-gradient`,[v,...w]=p.split(",").map(w0e).filter(Boolean);if((w==null?void 0:w.length)===0)return n;const C=v in EV?EV[v]:v;w.unshift(C);const R=w.map(N=>{if(b0e.has(N))return N;const M=N.indexOf(" "),[L,U]=M!==-1?[N.substr(0,M),N.substr(M+1)]:[N],z=SV(U)?U:U&&U.split(" "),J=`colors.${L}`,q=J in e.__cssMap?e.__cssMap[J].varRef:L;return z?[q,...Array.isArray(z)?z:[z]].join(" "):q});return`${y}(${R.join(", ")})`}const SV=n=>typeof n=="string"&&n.includes("(")&&n.includes(")"),C0e=(n,e)=>T0e(n,e??{});function R0e(n){return/^var\(--.+\)$/.test(n)}const I0e=n=>{const e=parseFloat(n.toString()),i=n.toString().replace(String(e),"");return{unitless:!i,value:e,unit:i}},op=n=>e=>`${n}(${e})`,Yr={filter(n){return n!=="auto"?n:y0e},backdropFilter(n){return n!=="auto"?n:E0e},ring(n){return v0e(Yr.px(n))},bgClip(n){return n==="text"?{color:"transparent",backgroundClip:"text"}:{backgroundClip:n}},transform(n){return n==="auto"?g0e():n==="auto-gpu"?_0e():n},vh(n){return n==="$100vh"?"var(--chakra-vh)":n},px(n){if(n==null)return n;const{unitless:e}=I0e(n);return e||typeof n=="number"?`${n}px`:n},fraction(n){return typeof n!="number"||n>1?n:`${n*100}%`},float(n,e){const i={left:"right",right:"left"};return e.direction==="rtl"?i[n]:n},degree(n){if(R0e(n)||n==null)return n;const e=typeof n=="string"&&!n.endsWith("deg");return typeof n=="number"||e?`${n}deg`:n},gradient:C0e,blur:op("blur"),opacity:op("opacity"),brightness:op("brightness"),contrast:op("contrast"),dropShadow:op("drop-shadow"),grayscale:op("grayscale"),hueRotate:n=>op("hue-rotate")(Yr.degree(n)),invert:op("invert"),saturate:op("saturate"),sepia:op("sepia"),bgImage(n){return n==null||SV(n)||vV.has(n)?n:`url(${n})`},outline(n){const e=String(n)==="0"||String(n)==="none";return n!==null&&e?{outline:"2px solid transparent",outlineOffset:"2px"}:{outline:n}},flexDirection(n){const{space:e,divide:i}=S0e[n]??{},o={flexDirection:n};return e&&(o[e]=1),i&&(o[i]=1),o}},We={borderWidths:qu("borderWidths"),borderStyles:qu("borderStyles"),colors:qu("colors"),borders:qu("borders"),gradients:qu("gradients",Yr.gradient),radii:qu("radii",Yr.px),space:qu("space",U1(Yr.vh,Yr.px)),spaceT:qu("space",U1(Yr.vh,Yr.px)),degreeT(n){return{property:n,transform:Yr.degree}},prop(n,e,i){return{property:n,scale:e,...e&&{transform:ej({scale:e,transform:i})}}},propT(n,e){return{property:n,transform:e}},sizes:qu("sizes",U1(Yr.vh,Yr.px)),sizesT:qu("sizes",U1(Yr.vh,Yr.fraction)),shadows:qu("shadows"),logical:m0e,blur:qu("blur",Yr.blur)},yk={background:We.colors("background"),backgroundColor:We.colors("backgroundColor"),backgroundImage:We.gradients("backgroundImage"),backgroundSize:!0,backgroundPosition:!0,backgroundRepeat:!0,backgroundAttachment:!0,backgroundClip:{transform:Yr.bgClip},bgSize:We.prop("backgroundSize"),bgPosition:We.prop("backgroundPosition"),bg:We.colors("background"),bgColor:We.colors("backgroundColor"),bgPos:We.prop("backgroundPosition"),bgRepeat:We.prop("backgroundRepeat"),bgAttachment:We.prop("backgroundAttachment"),bgGradient:We.gradients("backgroundImage"),bgClip:{transform:Yr.bgClip}};Object.assign(yk,{bgImage:yk.backgroundImage,bgImg:yk.backgroundImage});const pi={border:We.borders("border"),borderWidth:We.borderWidths("borderWidth"),borderStyle:We.borderStyles("borderStyle"),borderColor:We.colors("borderColor"),borderRadius:We.radii("borderRadius"),borderTop:We.borders("borderTop"),borderBlockStart:We.borders("borderBlockStart"),borderTopLeftRadius:We.radii("borderTopLeftRadius"),borderStartStartRadius:We.logical({scale:"radii",property:{ltr:"borderTopLeftRadius",rtl:"borderTopRightRadius"}}),borderEndStartRadius:We.logical({scale:"radii",property:{ltr:"borderBottomLeftRadius",rtl:"borderBottomRightRadius"}}),borderTopRightRadius:We.radii("borderTopRightRadius"),borderStartEndRadius:We.logical({scale:"radii",property:{ltr:"borderTopRightRadius",rtl:"borderTopLeftRadius"}}),borderEndEndRadius:We.logical({scale:"radii",property:{ltr:"borderBottomRightRadius",rtl:"borderBottomLeftRadius"}}),borderRight:We.borders("borderRight"),borderInlineEnd:We.borders("borderInlineEnd"),borderBottom:We.borders("borderBottom"),borderBlockEnd:We.borders("borderBlockEnd"),borderBottomLeftRadius:We.radii("borderBottomLeftRadius"),borderBottomRightRadius:We.radii("borderBottomRightRadius"),borderLeft:We.borders("borderLeft"),borderInlineStart:{property:"borderInlineStart",scale:"borders"},borderInlineStartRadius:We.logical({scale:"radii",property:{ltr:["borderTopLeftRadius","borderBottomLeftRadius"],rtl:["borderTopRightRadius","borderBottomRightRadius"]}}),borderInlineEndRadius:We.logical({scale:"radii",property:{ltr:["borderTopRightRadius","borderBottomRightRadius"],rtl:["borderTopLeftRadius","borderBottomLeftRadius"]}}),borderX:We.borders(["borderLeft","borderRight"]),borderInline:We.borders("borderInline"),borderY:We.borders(["borderTop","borderBottom"]),borderBlock:We.borders("borderBlock"),borderTopWidth:We.borderWidths("borderTopWidth"),borderBlockStartWidth:We.borderWidths("borderBlockStartWidth"),borderTopColor:We.colors("borderTopColor"),borderBlockStartColor:We.colors("borderBlockStartColor"),borderTopStyle:We.borderStyles("borderTopStyle"),borderBlockStartStyle:We.borderStyles("borderBlockStartStyle"),borderBottomWidth:We.borderWidths("borderBottomWidth"),borderBlockEndWidth:We.borderWidths("borderBlockEndWidth"),borderBottomColor:We.colors("borderBottomColor"),borderBlockEndColor:We.colors("borderBlockEndColor"),borderBottomStyle:We.borderStyles("borderBottomStyle"),borderBlockEndStyle:We.borderStyles("borderBlockEndStyle"),borderLeftWidth:We.borderWidths("borderLeftWidth"),borderInlineStartWidth:We.borderWidths("borderInlineStartWidth"),borderLeftColor:We.colors("borderLeftColor"),borderInlineStartColor:We.colors("borderInlineStartColor"),borderLeftStyle:We.borderStyles("borderLeftStyle"),borderInlineStartStyle:We.borderStyles("borderInlineStartStyle"),borderRightWidth:We.borderWidths("borderRightWidth"),borderInlineEndWidth:We.borderWidths("borderInlineEndWidth"),borderRightColor:We.colors("borderRightColor"),borderInlineEndColor:We.colors("borderInlineEndColor"),borderRightStyle:We.borderStyles("borderRightStyle"),borderInlineEndStyle:We.borderStyles("borderInlineEndStyle"),borderTopRadius:We.radii(["borderTopLeftRadius","borderTopRightRadius"]),borderBottomRadius:We.radii(["borderBottomLeftRadius","borderBottomRightRadius"]),borderLeftRadius:We.radii(["borderTopLeftRadius","borderBottomLeftRadius"]),borderRightRadius:We.radii(["borderTopRightRadius","borderBottomRightRadius"])};Object.assign(pi,{rounded:pi.borderRadius,roundedTop:pi.borderTopRadius,roundedTopLeft:pi.borderTopLeftRadius,roundedTopRight:pi.borderTopRightRadius,roundedTopStart:pi.borderStartStartRadius,roundedTopEnd:pi.borderStartEndRadius,roundedBottom:pi.borderBottomRadius,roundedBottomLeft:pi.borderBottomLeftRadius,roundedBottomRight:pi.borderBottomRightRadius,roundedBottomStart:pi.borderEndStartRadius,roundedBottomEnd:pi.borderEndEndRadius,roundedLeft:pi.borderLeftRadius,roundedRight:pi.borderRightRadius,roundedStart:pi.borderInlineStartRadius,roundedEnd:pi.borderInlineEndRadius,borderStart:pi.borderInlineStart,borderEnd:pi.borderInlineEnd,borderTopStartRadius:pi.borderStartStartRadius,borderTopEndRadius:pi.borderStartEndRadius,borderBottomStartRadius:pi.borderEndStartRadius,borderBottomEndRadius:pi.borderEndEndRadius,borderStartRadius:pi.borderInlineStartRadius,borderEndRadius:pi.borderInlineEndRadius,borderStartWidth:pi.borderInlineStartWidth,borderEndWidth:pi.borderInlineEndWidth,borderStartColor:pi.borderInlineStartColor,borderEndColor:pi.borderInlineEndColor,borderStartStyle:pi.borderInlineStartStyle,borderEndStyle:pi.borderInlineEndStyle});const A0e={color:We.colors("color"),textColor:We.colors("color"),fill:We.colors("fill"),stroke:We.colors("stroke"),accentColor:We.colors("accentColor"),textFillColor:We.colors("textFillColor")},eO={alignItems:!0,alignContent:!0,justifyItems:!0,justifyContent:!0,flexWrap:!0,flexDirection:{transform:Yr.flexDirection},flex:!0,flexFlow:!0,flexGrow:!0,flexShrink:!0,flexBasis:We.sizes("flexBasis"),justifySelf:!0,alignSelf:!0,order:!0,placeItems:!0,placeContent:!0,placeSelf:!0,gap:We.space("gap"),rowGap:We.space("rowGap"),columnGap:We.space("columnGap")};Object.assign(eO,{flexDir:eO.flexDirection});const Ju={width:We.sizesT("width"),inlineSize:We.sizesT("inlineSize"),height:We.sizes("height"),blockSize:We.sizes("blockSize"),boxSize:We.sizes(["width","height"]),minWidth:We.sizes("minWidth"),minInlineSize:We.sizes("minInlineSize"),minHeight:We.sizes("minHeight"),minBlockSize:We.sizes("minBlockSize"),maxWidth:We.sizes("maxWidth"),maxInlineSize:We.sizes("maxInlineSize"),maxHeight:We.sizes("maxHeight"),maxBlockSize:We.sizes("maxBlockSize"),overflow:!0,overflowX:!0,overflowY:!0,overscrollBehavior:!0,overscrollBehaviorX:!0,overscrollBehaviorY:!0,display:!0,aspectRatio:!0,hideFrom:{scale:"breakpoints",transform:(n,e)=>{var l,u;return{[`@media screen and (min-width: ${((u=(l=e.__breakpoints)==null?void 0:l.get(n))==null?void 0:u.minW)??n})`]:{display:"none"}}}},hideBelow:{scale:"breakpoints",transform:(n,e)=>{var l,u;return{[`@media screen and (max-width: ${((u=(l=e.__breakpoints)==null?void 0:l.get(n))==null?void 0:u._minW)??n})`]:{display:"none"}}}},verticalAlign:!0,boxSizing:!0,boxDecorationBreak:!0,float:We.propT("float",Yr.float),objectFit:!0,objectPosition:!0,visibility:!0,isolation:!0};Object.assign(Ju,{w:Ju.width,h:Ju.height,minW:Ju.minWidth,maxW:Ju.maxWidth,minH:Ju.minHeight,maxH:Ju.maxHeight,overscroll:Ju.overscrollBehavior,overscrollX:Ju.overscrollBehaviorX,overscrollY:Ju.overscrollBehaviorY});const P0e={filter:{transform:Yr.filter},blur:We.blur("--chakra-blur"),brightness:We.propT("--chakra-brightness",Yr.brightness),contrast:We.propT("--chakra-contrast",Yr.contrast),hueRotate:We.propT("--chakra-hue-rotate",Yr.hueRotate),invert:We.propT("--chakra-invert",Yr.invert),saturate:We.propT("--chakra-saturate",Yr.saturate),dropShadow:We.propT("--chakra-drop-shadow",Yr.dropShadow),backdropFilter:{transform:Yr.backdropFilter},backdropBlur:We.blur("--chakra-backdrop-blur"),backdropBrightness:We.propT("--chakra-backdrop-brightness",Yr.brightness),backdropContrast:We.propT("--chakra-backdrop-contrast",Yr.contrast),backdropHueRotate:We.propT("--chakra-backdrop-hue-rotate",Yr.hueRotate),backdropInvert:We.propT("--chakra-backdrop-invert",Yr.invert),backdropSaturate:We.propT("--chakra-backdrop-saturate",Yr.saturate)},k0e={ring:{transform:Yr.ring},ringColor:We.colors("--chakra-ring-color"),ringOffset:We.prop("--chakra-ring-offset-width"),ringOffsetColor:We.colors("--chakra-ring-offset-color"),ringInset:We.prop("--chakra-ring-inset")},O0e={appearance:!0,cursor:!0,resize:!0,userSelect:!0,pointerEvents:!0,outline:{transform:Yr.outline},outlineOffset:!0,outlineColor:We.colors("outlineColor")},yee={gridGap:We.space("gridGap"),gridColumnGap:We.space("gridColumnGap"),gridRowGap:We.space("gridRowGap"),gridColumn:!0,gridRow:!0,gridAutoFlow:!0,gridAutoColumns:!0,gridColumnStart:!0,gridColumnEnd:!0,gridRowStart:!0,gridRowEnd:!0,gridAutoRows:!0,gridTemplate:!0,gridTemplateColumns:!0,gridTemplateRows:!0,gridTemplateAreas:!0,gridArea:!0};function N0e(n,e,i,o){const l=typeof e=="string"?e.split("."):[e];for(o=0;o<l.length&&n;o+=1)n=n[l[o]];return n===void 0?i:n}const D0e=n=>{const e=new WeakMap;return(o,l,u,p)=>{if(typeof o>"u")return n(o,l,u);e.has(o)||e.set(o,new Map);const y=e.get(o);if(y.has(l))return y.get(l);const v=n(o,l,u,p);return y.set(l,v),v}},x0e=D0e(N0e),L0e={border:"0px",clip:"rect(0, 0, 0, 0)",width:"1px",height:"1px",margin:"-1px",padding:"0px",overflow:"hidden",whiteSpace:"nowrap",position:"absolute"},M0e={position:"static",width:"auto",height:"auto",clip:"auto",padding:"0",margin:"0",overflow:"visible",whiteSpace:"normal"},QM=(n,e,i)=>{const o={},l=x0e(n,e,{});for(const u in l)u in i&&i[u]!=null||(o[u]=l[u]);return o},U0e={srOnly:{transform(n){return n===!0?L0e:n==="focusable"?M0e:{}}},layerStyle:{processResult:!0,transform:(n,e,i)=>QM(e,`layerStyles.${n}`,i)},textStyle:{processResult:!0,transform:(n,e,i)=>QM(e,`textStyles.${n}`,i)},apply:{processResult:!0,transform:(n,e,i)=>QM(e,n,i)}},wC={position:!0,pos:We.prop("position"),zIndex:We.prop("zIndex","zIndices"),inset:We.spaceT("inset"),insetX:We.spaceT(["left","right"]),insetInline:We.spaceT("insetInline"),insetY:We.spaceT(["top","bottom"]),insetBlock:We.spaceT("insetBlock"),top:We.spaceT("top"),insetBlockStart:We.spaceT("insetBlockStart"),bottom:We.spaceT("bottom"),insetBlockEnd:We.spaceT("insetBlockEnd"),left:We.spaceT("left"),insetInlineStart:We.logical({scale:"space",property:{ltr:"left",rtl:"right"}}),right:We.spaceT("right"),insetInlineEnd:We.logical({scale:"space",property:{ltr:"right",rtl:"left"}})};Object.assign(wC,{insetStart:wC.insetInlineStart,insetEnd:wC.insetInlineEnd});const bV={boxShadow:We.shadows("boxShadow"),mixBlendMode:!0,blendMode:We.prop("mixBlendMode"),backgroundBlendMode:!0,bgBlendMode:We.prop("backgroundBlendMode"),opacity:!0};Object.assign(bV,{shadow:bV.boxShadow});const os={margin:We.spaceT("margin"),marginTop:We.spaceT("marginTop"),marginBlockStart:We.spaceT("marginBlockStart"),marginRight:We.spaceT("marginRight"),marginInlineEnd:We.spaceT("marginInlineEnd"),marginBottom:We.spaceT("marginBottom"),marginBlockEnd:We.spaceT("marginBlockEnd"),marginLeft:We.spaceT("marginLeft"),marginInlineStart:We.spaceT("marginInlineStart"),marginX:We.spaceT(["marginInlineStart","marginInlineEnd"]),marginInline:We.spaceT("marginInline"),marginY:We.spaceT(["marginTop","marginBottom"]),marginBlock:We.spaceT("marginBlock"),padding:We.space("padding"),paddingTop:We.space("paddingTop"),paddingBlockStart:We.space("paddingBlockStart"),paddingRight:We.space("paddingRight"),paddingBottom:We.space("paddingBottom"),paddingBlockEnd:We.space("paddingBlockEnd"),paddingLeft:We.space("paddingLeft"),paddingInlineStart:We.space("paddingInlineStart"),paddingInlineEnd:We.space("paddingInlineEnd"),paddingX:We.space(["paddingInlineStart","paddingInlineEnd"]),paddingInline:We.space("paddingInline"),paddingY:We.space(["paddingTop","paddingBottom"]),paddingBlock:We.space("paddingBlock")};Object.assign(os,{m:os.margin,mt:os.marginTop,mr:os.marginRight,me:os.marginInlineEnd,marginEnd:os.marginInlineEnd,mb:os.marginBottom,ml:os.marginLeft,ms:os.marginInlineStart,marginStart:os.marginInlineStart,mx:os.marginX,my:os.marginY,p:os.padding,pt:os.paddingTop,py:os.paddingY,px:os.paddingX,pb:os.paddingBottom,pl:os.paddingLeft,ps:os.paddingInlineStart,paddingStart:os.paddingInlineStart,pr:os.paddingRight,pe:os.paddingInlineEnd,paddingEnd:os.paddingInlineEnd});const V0e={scrollBehavior:!0,scrollSnapAlign:!0,scrollSnapStop:!0,scrollSnapType:!0,scrollMargin:We.spaceT("scrollMargin"),scrollMarginTop:We.spaceT("scrollMarginTop"),scrollMarginBottom:We.spaceT("scrollMarginBottom"),scrollMarginLeft:We.spaceT("scrollMarginLeft"),scrollMarginRight:We.spaceT("scrollMarginRight"),scrollMarginX:We.spaceT(["scrollMarginLeft","scrollMarginRight"]),scrollMarginY:We.spaceT(["scrollMarginTop","scrollMarginBottom"]),scrollPadding:We.spaceT("scrollPadding"),scrollPaddingTop:We.spaceT("scrollPaddingTop"),scrollPaddingBottom:We.spaceT("scrollPaddingBottom"),scrollPaddingLeft:We.spaceT("scrollPaddingLeft"),scrollPaddingRight:We.spaceT("scrollPaddingRight"),scrollPaddingX:We.spaceT(["scrollPaddingLeft","scrollPaddingRight"]),scrollPaddingY:We.spaceT(["scrollPaddingTop","scrollPaddingBottom"])},F0e={fontFamily:We.prop("fontFamily","fonts"),fontSize:We.prop("fontSize","fontSizes",Yr.px),fontWeight:We.prop("fontWeight","fontWeights"),lineHeight:We.prop("lineHeight","lineHeights"),letterSpacing:We.prop("letterSpacing","letterSpacings"),textAlign:!0,fontStyle:!0,textIndent:!0,wordBreak:!0,overflowWrap:!0,textOverflow:!0,textTransform:!0,whiteSpace:!0,isTruncated:{transform(n){if(n===!0)return{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"}}},noOfLines:{static:{overflow:"hidden",textOverflow:"ellipsis",display:"-webkit-box",WebkitBoxOrient:"vertical",WebkitLineClamp:"var(--chakra-line-clamp)"},property:"--chakra-line-clamp"}},j0e={textDecorationColor:We.colors("textDecorationColor"),textDecoration:!0,textDecor:{property:"textDecoration"},textDecorationLine:!0,textDecorationStyle:!0,textDecorationThickness:!0,textUnderlineOffset:!0,textShadow:We.shadows("textShadow")},B0e={clipPath:!0,transform:We.propT("transform",Yr.transform),transformOrigin:!0,translateX:We.spaceT("--chakra-translate-x"),translateY:We.spaceT("--chakra-translate-y"),skewX:We.degreeT("--chakra-skew-x"),skewY:We.degreeT("--chakra-skew-y"),scaleX:We.prop("--chakra-scale-x"),scaleY:We.prop("--chakra-scale-y"),scale:We.prop(["--chakra-scale-x","--chakra-scale-y"]),rotate:We.degreeT("--chakra-rotate")},z0e={listStyleType:!0,listStylePosition:!0,listStylePos:We.prop("listStylePosition"),listStyleImage:!0,listStyleImg:We.prop("listStyleImage")},W0e={transition:!0,transitionDelay:!0,animation:!0,willChange:!0,transitionDuration:We.prop("transitionDuration","transition.duration"),transitionProperty:We.prop("transitionProperty","transition.property"),transitionTimingFunction:We.prop("transitionTimingFunction","transition.easing")},tj=_p({},yk,pi,A0e,eO,Ju,P0e,k0e,O0e,yee,U0e,wC,bV,os,V0e,F0e,j0e,B0e,z0e,W0e),G0e=Object.assign({},os,Ju,eO,yee,wC),H0e=Object.keys(G0e),$0e=[...Object.keys(tj),...gee],K0e={...tj,...Q0},q0e=n=>n in K0e,Y0e=n=>e=>{if(!e.__breakpoints)return n;const{isResponsive:i,toArrayValue:o,media:l}=e.__breakpoints,u={};for(const p in n){let y=pl(n[p],e);if(y==null)continue;if(y=ed(y)&&i(y)?o(y):y,!Array.isArray(y)){u[p]=y;continue}const v=y.slice(0,l.length).length;for(let w=0;w<v;w+=1){const C=l==null?void 0:l[w];if(!C){u[p]=y[w];continue}u[C]=u[C]||{},y[w]!=null&&(u[C][p]=y[w])}}return u};function X0e(n){const e=[];let i="",o=!1;for(let l=0;l<n.length;l++){const u=n[l];u==="("?(o=!0,i+=u):u===")"?(o=!1,i+=u):u===","&&!o?(e.push(i),i=""):i+=u}return i=i.trim(),i&&e.push(i),e}function J0e(n){return/^var\(--.+\)$/.test(n)}const Q0e=(n,e)=>n.startsWith("--")&&typeof e=="string"&&!J0e(e),Z0e=(n,e)=>{if(e==null)return e;const i=p=>{var y,v;return(v=(y=n.__cssMap)==null?void 0:y[p])==null?void 0:v.varRef},o=p=>i(p)??p,[l,u]=X0e(e);return e=i(l)??o(u)??o(e),e};function eSe(n){const{configs:e={},pseudos:i={},theme:o}=n,l=(u,p=!1)=>{var C;const y=pl(u,o),v=Y0e(y)(o);let w={};for(let R in v){const N=v[R];let M=pl(N,o);R in i&&(R=i[R]),Q0e(R,M)&&(M=Z0e(o,M));let L=e[R];if(L===!0&&(L={property:R}),ed(M)){w[R]=w[R]??{},w[R]=_p({},w[R],l(M,!0));continue}let U=((C=L==null?void 0:L.transform)==null?void 0:C.call(L,M,o,y))??M;U=L!=null&&L.processResult?l(U,!0):U;const z=pl(L==null?void 0:L.property,o);if(!p&&(L!=null&&L.static)){const J=pl(L.static,o);w=_p({},w,J)}if(z&&Array.isArray(z)){for(const J of z)w[J]=U;continue}if(z){z==="&"&&ed(U)?w=_p({},w,U):w[z]=U;continue}if(ed(U)){w=_p({},w,U);continue}w[R]=U}return w};return l}const Eee=n=>e=>eSe({theme:e,pseudos:Q0,configs:tj})(n);function SHe(n){return n}function bHe(n){return n}function Qi(n){return{definePartsStyle(e){return e},defineMultiStyleConfig(e){return{parts:n,...e}}}}function tSe(n,e,i){var o,l;return((l=(o=n.__cssMap)==null?void 0:o[`${e}.${i}`])==null?void 0:l.varRef)??i}function nSe(n,e){if(Array.isArray(n))return n;if(ed(n))return e(n);if(n!=null)return[n]}function rSe(n,e){for(let i=e+1;i<n.length;i++)if(n[i]!=null)return i;return-1}function iSe(n){const e=n.__breakpoints;return function(o,l,u,p){var N,M;if(!e)return;const y={},v=nSe(u,e.toArrayValue);if(!v)return y;const w=v.length,C=w===1,R=!!o.parts;for(let L=0;L<w;L++){const U=e.details[L],z=e.details[rSe(v,L)],J=iC(U.minW,z==null?void 0:z._minW),q=pl((N=o[l])==null?void 0:N[v[L]],p);if(q){if(R){(M=o.parts)==null||M.forEach(re=>{_p(y,{[re]:C?q[re]:{[J]:q[re]}})});continue}if(!R){C?_p(y,q):y[J]=q;continue}y[J]=q}}return y}}function sSe(n){return e=>{const{variant:i,size:o,theme:l}=e,u=iSe(l);return _p({},pl(n.baseStyle??{},e),u(n,"sizes",o,e),u(n,"variants",i,e))}}function Fi(n){return GS(n,["styleConfig","size","variant","colorScheme"])}function vee(n){return ed(n)&&n.reference?n.reference:String(n)}const XO=(n,...e)=>e.map(vee).join(` ${n} `).replace(/calc/g,""),bq=(...n)=>`calc(${XO("+",...n)})`,wq=(...n)=>`calc(${XO("-",...n)})`,wV=(...n)=>`calc(${XO("*",...n)})`,Tq=(...n)=>`calc(${XO("/",...n)})`,Cq=n=>{const e=vee(n);return e!=null&&!Number.isNaN(parseFloat(e))?String(e).startsWith("-")?String(e).slice(1):`-${e}`:wV(e,-1)},Tf=Object.assign(n=>({add:(...e)=>Tf(bq(n,...e)),subtract:(...e)=>Tf(wq(n,...e)),multiply:(...e)=>Tf(wV(n,...e)),divide:(...e)=>Tf(Tq(n,...e)),negate:()=>Tf(Cq(n)),toString:()=>n.toString()}),{add:bq,subtract:wq,multiply:wV,divide:Tq,negate:Cq});function oSe(n,e="-"){return n.replace(/\s+/g,e)}function aSe(n){const e=oSe(n.toString());return lSe(cSe(e))}function cSe(n){return n.includes("\\.")?n:!Number.isInteger(parseFloat(n.toString()))?n.replace(".","\\."):n}function lSe(n){return n.replace(/[!-,/:-@[-^`{-~]/g,"\\$&")}function uSe(n,e=""){return[e,n].filter(Boolean).join("-")}function dSe(n,e){return`var(${n}${e?`, ${e}`:""})`}function hSe(n,e=""){return aSe(`--${uSe(n,e)}`)}function Wn(n,e,i){const o=hSe(n,i);return{variable:o,reference:dSe(o,e)}}function pSe(n,e){const i={};for(const o of e){if(Array.isArray(o)){const[l,u]=o;i[l]=Wn(`${n}-${l}`,u);continue}i[o]=Wn(`${n}-${o}`)}return i}const fSe=["colors","borders","borderWidths","borderStyles","fonts","fontSizes","fontWeights","gradients","letterSpacings","lineHeights","radii","space","shadows","sizes","zIndices","transition","blur","breakpoints"];function mSe(n){return nee(n,fSe)}function gSe(n){return n.semanticTokens}function _Se(n){const{__cssMap:e,__cssVars:i,__breakpoints:o,...l}=n;return l}function ySe(n){const e=mSe(n),i=gSe(n),o=u=>gee.includes(u)||u==="default",l={};return hq(e,(u,p)=>{u!=null&&(l[p.join(".")]={isSemantic:!1,value:u})}),hq(i,(u,p)=>{u!=null&&(l[p.join(".")]={isSemantic:!0,value:u})},{stop:u=>Object.keys(u).every(o)}),l}function Rq(n,e){return Wn(String(n).replace(/\./g,"-"),void 0,e)}function ESe(n){var p;const e=ySe(n),i=(p=n.config)==null?void 0:p.cssVarPrefix;let o={};const l={};function u(y,v){const C=[String(y).split(".")[0],v].join(".");if(!e[C])return v;const{reference:N}=Rq(C,i);return N}for(const[y,v]of Object.entries(e)){const{isSemantic:w,value:C}=v,{variable:R,reference:N}=Rq(y,i);if(!w){if(y.startsWith("space")){const L=y.split("."),[U,...z]=L,J=`${U}.-${z.join(".")}`,q=Tf.negate(C),re=Tf.negate(N);l[J]={value:q,var:R,varRef:re}}o[R]=C,l[y]={value:C,var:R,varRef:N};continue}const M=ed(C)?C:{default:C};o=_p(o,Object.entries(M).reduce((L,[U,z])=>{if(!z)return L;const J=u(y,`${z}`);if(U==="default")return L[R]=J,L;const q=(Q0==null?void 0:Q0[U])??U;return L[q]={[R]:J},L},{})),l[y]={value:N,var:R,varRef:N}}return{cssVars:o,cssMap:l}}function vSe(n){const e=_Se(n),{cssMap:i,cssVars:o}=ESe(e);return Object.assign(e,{__cssVars:{...{"--chakra-ring-inset":"var(--chakra-empty,/*!*/ /*!*/)","--chakra-ring-offset-width":"0px","--chakra-ring-offset-color":"#fff","--chakra-ring-color":"rgba(66, 153, 225, 0.6)","--chakra-ring-offset-shadow":"0 0 #0000","--chakra-ring-shadow":"0 0 #0000","--chakra-space-x-reverse":"0","--chakra-space-y-reverse":"0"},...o},__cssMap:i,__breakpoints:dve(e.breakpoints)}),e}function yi(n,e={}){let i=!1;function o(){if(!i){i=!0;return}throw new Error("[anatomy] .part(...) should only be called once. Did you mean to use .extend(...) ?")}function l(...C){o();for(const R of C)e[R]=v(R);return yi(n,e)}function u(...C){for(const R of C)R in e||(e[R]=v(R));return yi(n,e)}function p(){return Object.fromEntries(Object.entries(e).map(([R,N])=>[R,N.selector]))}function y(){return Object.fromEntries(Object.entries(e).map(([R,N])=>[R,N.className]))}function v(C){const M=`chakra-${(["container","root"].includes(C??"")?[n]:[n,C]).filter(Boolean).join("__")}`;return{className:M,selector:`.${M}`,toString:()=>C}}return{parts:l,toPart:v,extend:u,selectors:p,classnames:y,get keys(){return Object.keys(e)},__type:{}}}const SSe=yi("accordion").parts("root","container","button","panel","icon"),bSe=yi("alert").parts("title","description","container","icon","spinner"),wSe=yi("avatar").parts("label","badge","container","excessLabel","group"),TSe=yi("breadcrumb").parts("link","item","container","separator");yi("button").parts();const CSe=yi("checkbox").parts("control","icon","container","label");yi("progress").parts("track","filledTrack","label");const RSe=yi("drawer").parts("overlay","dialogContainer","dialog","header","closeButton","body","footer"),ISe=yi("editable").parts("preview","input","textarea"),ASe=yi("form").parts("container","requiredIndicator","helperText"),PSe=yi("formError").parts("text","icon"),kSe=yi("input").parts("addon","field","element","group"),OSe=yi("list").parts("container","item","icon"),NSe=yi("menu").parts("button","list","item","groupTitle","icon","command","divider"),DSe=yi("modal").parts("overlay","dialogContainer","dialog","header","closeButton","body","footer"),xSe=yi("numberinput").parts("root","field","stepperGroup","stepper");yi("pininput").parts("field");const LSe=yi("popover").parts("content","header","body","footer","popper","arrow","closeButton"),MSe=yi("progress").parts("label","filledTrack","track"),USe=yi("radio").parts("container","control","label"),VSe=yi("select").parts("field","icon"),FSe=yi("slider").parts("container","track","thumb","filledTrack","mark"),jSe=yi("stat").parts("container","label","helpText","number","icon"),BSe=yi("switch").parts("container","track","thumb","label"),zSe=yi("table").parts("table","thead","tbody","tr","th","td","tfoot","caption"),WSe=yi("tabs").parts("root","tab","tablist","tabpanel","tabpanels","indicator"),GSe=yi("tag").parts("container","label","closeButton"),HSe=yi("card").parts("container","header","body","footer");yi("stepper").parts("stepper","step","title","description","indicator","separator","icon","number");const{definePartsStyle:$Se,defineMultiStyleConfig:KSe}=Qi(SSe.keys),qSe={borderTopWidth:"1px",borderColor:"inherit",_last:{borderBottomWidth:"1px"}},YSe={transitionProperty:"common",transitionDuration:"normal",fontSize:"md",_focusVisible:{boxShadow:"outline"},_hover:{bg:"blackAlpha.50"},_disabled:{opacity:.4,cursor:"not-allowed"},px:"4",py:"2"},XSe={pt:"2",px:"4",pb:"5"},JSe={fontSize:"1.25em"},QSe=$Se({container:qSe,button:YSe,panel:XSe,icon:JSe}),ZSe=KSe({baseStyle:QSe});function Dy(n,e,i){return Math.min(Math.max(n,i),e)}class ebe extends Error{constructor(e){super(`Failed to parse color: "${e}"`)}}var oC=ebe;function nj(n){if(typeof n!="string")throw new oC(n);if(n.trim().toLowerCase()==="transparent")return[0,0,0,0];let e=n.trim();e=cbe.test(n)?rbe(n):n;const i=ibe.exec(e);if(i){const p=Array.from(i).slice(1);return[...p.slice(0,3).map(y=>parseInt($C(y,2),16)),parseInt($C(p[3]||"f",2),16)/255]}const o=sbe.exec(e);if(o){const p=Array.from(o).slice(1);return[...p.slice(0,3).map(y=>parseInt(y,16)),parseInt(p[3]||"ff",16)/255]}const l=obe.exec(e);if(l){const p=Array.from(l).slice(1);return[...p.slice(0,3).map(y=>parseInt(y,10)),parseFloat(p[3]||"1")]}const u=abe.exec(e);if(u){const[p,y,v,w]=Array.from(u).slice(1).map(parseFloat);if(Dy(0,100,y)!==y)throw new oC(n);if(Dy(0,100,v)!==v)throw new oC(n);return[...lbe(p,y,v),Number.isNaN(w)?1:w]}throw new oC(n)}function tbe(n){let e=5381,i=n.length;for(;i;)e=e*33^n.charCodeAt(--i);return(e>>>0)%2341}const Iq=n=>parseInt(n.replace(/_/g,""),36),nbe="1q29ehhb 1n09sgk7 1kl1ekf_ _yl4zsno 16z9eiv3 1p29lhp8 _bd9zg04 17u0____ _iw9zhe5 _to73___ _r45e31e _7l6g016 _jh8ouiv _zn3qba8 1jy4zshs 11u87k0u 1ro9yvyo 1aj3xael 1gz9zjz0 _3w8l4xo 1bf1ekf_ _ke3v___ _4rrkb__ 13j776yz _646mbhl _nrjr4__ _le6mbhl 1n37ehkb _m75f91n _qj3bzfz 1939yygw 11i5z6x8 _1k5f8xs 1509441m 15t5lwgf _ae2th1n _tg1ugcv 1lp1ugcv 16e14up_ _h55rw7n _ny9yavn _7a11xb_ 1ih442g9 _pv442g9 1mv16xof 14e6y7tu 1oo9zkds 17d1cisi _4v9y70f _y98m8kc 1019pq0v 12o9zda8 _348j4f4 1et50i2o _8epa8__ _ts6senj 1o350i2o 1mi9eiuo 1259yrp0 1ln80gnw _632xcoy 1cn9zldc _f29edu4 1n490c8q _9f9ziet 1b94vk74 _m49zkct 1kz6s73a 1eu9dtog _q58s1rz 1dy9sjiq __u89jo3 _aj5nkwg _ld89jo3 13h9z6wx _qa9z2ii _l119xgq _bs5arju 1hj4nwk9 1qt4nwk9 1ge6wau6 14j9zlcw 11p1edc_ _ms1zcxe _439shk6 _jt9y70f _754zsow 1la40eju _oq5p___ _x279qkz 1fa5r3rv _yd2d9ip _424tcku _8y1di2_ _zi2uabw _yy7rn9h 12yz980_ __39ljp6 1b59zg0x _n39zfzp 1fy9zest _b33k___ _hp9wq92 1il50hz4 _io472ub _lj9z3eo 19z9ykg0 _8t8iu3a 12b9bl4a 1ak5yw0o _896v4ku _tb8k8lv _s59zi6t _c09ze0p 1lg80oqn 1id9z8wb _238nba5 1kq6wgdi _154zssg _tn3zk49 _da9y6tc 1sg7cv4f _r12jvtt 1gq5fmkz 1cs9rvci _lp9jn1c _xw1tdnb 13f9zje6 16f6973h _vo7ir40 _bt5arjf _rc45e4t _hr4e100 10v4e100 _hc9zke2 _w91egv_ _sj2r1kk 13c87yx8 _vqpds__ _ni8ggk8 _tj9yqfb 1ia2j4r4 _7x9b10u 1fc9ld4j 1eq9zldr _5j9lhpx _ez9zl6o _md61fzm".split(" ").reduce((n,e)=>{const i=Iq(e.substring(0,3)),o=Iq(e.substring(3)).toString(16);let l="";for(let u=0;u<6-o.length;u++)l+="0";return n[i]=`${l}${o}`,n},{});function rbe(n){const e=n.toLowerCase().trim(),i=nbe[tbe(e)];if(!i)throw new oC(n);return`#${i}`}const $C=(n,e)=>Array.from(Array(e)).map(()=>n).join(""),ibe=new RegExp(`^#${$C("([a-f0-9])",3)}([a-f0-9])?$`,"i"),sbe=new RegExp(`^#${$C("([a-f0-9]{2})",3)}([a-f0-9]{2})?$`,"i"),obe=new RegExp(`^rgba?\\(\\s*(\\d+)\\s*${$C(",\\s*(\\d+)\\s*",2)}(?:,\\s*([\\d.]+))?\\s*\\)$`,"i"),abe=/^hsla?\(\s*([\d.]+)\s*,\s*([\d.]+)%\s*,\s*([\d.]+)%(?:\s*,\s*([\d.]+))?\s*\)$/i,cbe=/^[a-z]+$/i,Aq=n=>Math.round(n*255),lbe=(n,e,i)=>{let o=i/100;if(e===0)return[o,o,o].map(Aq);const l=(n%360+360)%360/60,u=(1-Math.abs(2*o-1))*(e/100),p=u*(1-Math.abs(l%2-1));let y=0,v=0,w=0;l>=0&&l<1?(y=u,v=p):l>=1&&l<2?(y=p,v=u):l>=2&&l<3?(v=u,w=p):l>=3&&l<4?(v=p,w=u):l>=4&&l<5?(y=p,w=u):l>=5&&l<6&&(y=u,w=p);const C=o-u/2,R=y+C,N=v+C,M=w+C;return[R,N,M].map(Aq)};function ube(n,e,i,o){return`rgba(${Dy(0,255,n).toFixed()}, ${Dy(0,255,e).toFixed()}, ${Dy(0,255,i).toFixed()}, ${parseFloat(Dy(0,1,o).toFixed(3))})`}function dbe(n,e){const[i,o,l,u]=nj(n);return ube(i,o,l,u-e)}function hbe(n){const[e,i,o,l]=nj(n);let u=p=>{const y=Dy(0,255,p).toString(16);return y.length===1?`0${y}`:y};return`#${u(e)}${u(i)}${u(o)}${l<1?u(Math.round(l*255)):""}`}const pbe=n=>Object.keys(n).length===0;function fbe(n,e,i,o,l){for(e=e.split?e.split("."):e,o=0;o<e.length;o++)n=n?n[e[o]]:l;return n===l?i:n}const kc=(n,e,i)=>{const o=fbe(n,`colors.${e}`,e);try{return hbe(o),o}catch{return i??"#000000"}},mbe=n=>{const[e,i,o]=nj(n);return(e*299+i*587+o*114)/1e3},gbe=n=>e=>{const i=kc(e,n);return mbe(i)<128?"dark":"light"},_be=n=>e=>gbe(n)(e)==="dark",yS=(n,e)=>i=>{const o=kc(i,n);return dbe(o,1-e)};function Pq(n="1rem",e="rgba(255, 255, 255, 0.15)"){return{backgroundImage:`linear-gradient(
    45deg,
    ${e} 25%,
    transparent 25%,
    transparent 50%,
    ${e} 50%,
    ${e} 75%,
    transparent 75%,
    transparent
  )`,backgroundSize:`${n} ${n}`}}const ybe=()=>`#${Math.floor(Math.random()*16777215).toString(16).padEnd(6,"0")}`;function Ebe(n){const e=ybe();return!n||pbe(n)?e:n.string&&n.colors?Sbe(n.string,n.colors):n.string&&!n.colors?vbe(n.string):n.colors&&!n.string?bbe(n.colors):e}function vbe(n){let e=0;if(n.length===0)return e.toString();for(let o=0;o<n.length;o+=1)e=n.charCodeAt(o)+((e<<5)-e),e=e&e;let i="#";for(let o=0;o<3;o+=1){const l=e>>o*8&255;i+=`00${l.toString(16)}`.substr(-2)}return i}function Sbe(n,e){let i=0;if(n.length===0)return e[0];for(let o=0;o<n.length;o+=1)i=n.charCodeAt(o)+((i<<5)-i),i=i&i;return i=(i%e.length+e.length)%e.length,e[i]}function bbe(n){return n[Math.floor(Math.random()*n.length)]}function zn(n,e){return i=>i.colorMode==="dark"?e:n}function rj(n){const{orientation:e,vertical:i,horizontal:o}=n;return e?e==="vertical"?i:o:{}}function See(n){return ed(n)&&n.reference?n.reference:String(n)}const JO=(n,...e)=>e.map(See).join(` ${n} `).replace(/calc/g,""),kq=(...n)=>`calc(${JO("+",...n)})`,Oq=(...n)=>`calc(${JO("-",...n)})`,TV=(...n)=>`calc(${JO("*",...n)})`,Nq=(...n)=>`calc(${JO("/",...n)})`,Dq=n=>{const e=See(n);return e!=null&&!Number.isNaN(parseFloat(e))?String(e).startsWith("-")?String(e).slice(1):`-${e}`:TV(e,-1)},Cf=Object.assign(n=>({add:(...e)=>Cf(kq(n,...e)),subtract:(...e)=>Cf(Oq(n,...e)),multiply:(...e)=>Cf(TV(n,...e)),divide:(...e)=>Cf(Nq(n,...e)),negate:()=>Cf(Dq(n)),toString:()=>n.toString()}),{add:kq,subtract:Oq,multiply:TV,divide:Nq,negate:Dq});function wbe(n){return!Number.isInteger(parseFloat(n.toString()))}function Tbe(n,e="-"){return n.replace(/\s+/g,e)}function bee(n){const e=Tbe(n.toString());return e.includes("\\.")?n:wbe(n)?e.replace(".","\\."):n}function Cbe(n,e=""){return[e,bee(n)].filter(Boolean).join("-")}function Rbe(n,e){return`var(${bee(n)}${e?`, ${e}`:""})`}function Ibe(n,e=""){return`--${Cbe(n,e)}`}function zo(n,e){const i=Ibe(n,e==null?void 0:e.prefix);return{variable:i,reference:Rbe(i,Abe(e==null?void 0:e.fallback))}}function Abe(n){return n==null?void 0:n.reference}const{definePartsStyle:TR,defineMultiStyleConfig:Pbe}=Qi(bSe.keys),nu=Wn("alert-fg"),Bf=Wn("alert-bg"),kbe=TR({container:{bg:Bf.reference,px:"4",py:"3"},title:{fontWeight:"bold",lineHeight:"6",marginEnd:"2"},description:{lineHeight:"6"},icon:{color:nu.reference,flexShrink:0,marginEnd:"3",w:"5",h:"6"},spinner:{color:nu.reference,flexShrink:0,marginEnd:"3",w:"5",h:"5"}});function ij(n){const{theme:e,colorScheme:i}=n,o=yS(`${i}.200`,.16)(e);return{light:`colors.${i}.100`,dark:o}}const Obe=TR(n=>{const{colorScheme:e}=n,i=ij(n);return{container:{[nu.variable]:`colors.${e}.600`,[Bf.variable]:i.light,_dark:{[nu.variable]:`colors.${e}.200`,[Bf.variable]:i.dark}}}}),Nbe=TR(n=>{const{colorScheme:e}=n,i=ij(n);return{container:{[nu.variable]:`colors.${e}.600`,[Bf.variable]:i.light,_dark:{[nu.variable]:`colors.${e}.200`,[Bf.variable]:i.dark},paddingStart:"3",borderStartWidth:"4px",borderStartColor:nu.reference}}}),Dbe=TR(n=>{const{colorScheme:e}=n,i=ij(n);return{container:{[nu.variable]:`colors.${e}.600`,[Bf.variable]:i.light,_dark:{[nu.variable]:`colors.${e}.200`,[Bf.variable]:i.dark},pt:"2",borderTopWidth:"4px",borderTopColor:nu.reference}}}),xbe=TR(n=>{const{colorScheme:e}=n;return{container:{[nu.variable]:"colors.white",[Bf.variable]:`colors.${e}.600`,_dark:{[nu.variable]:"colors.gray.900",[Bf.variable]:`colors.${e}.200`},color:nu.reference}}}),Lbe={subtle:Obe,"left-accent":Nbe,"top-accent":Dbe,solid:xbe},Mbe=Pbe({baseStyle:kbe,variants:Lbe,defaultProps:{variant:"subtle",colorScheme:"blue"}}),wee={px:"1px",.5:"0.125rem",1:"0.25rem",1.5:"0.375rem",2:"0.5rem",2.5:"0.625rem",3:"0.75rem",3.5:"0.875rem",4:"1rem",5:"1.25rem",6:"1.5rem",7:"1.75rem",8:"2rem",9:"2.25rem",10:"2.5rem",12:"3rem",14:"3.5rem",16:"4rem",20:"5rem",24:"6rem",28:"7rem",32:"8rem",36:"9rem",40:"10rem",44:"11rem",48:"12rem",52:"13rem",56:"14rem",60:"15rem",64:"16rem",72:"18rem",80:"20rem",96:"24rem"},Ube={max:"max-content",min:"min-content",full:"100%","3xs":"14rem","2xs":"16rem",xs:"20rem",sm:"24rem",md:"28rem",lg:"32rem",xl:"36rem","2xl":"42rem","3xl":"48rem","4xl":"56rem","5xl":"64rem","6xl":"72rem","7xl":"80rem","8xl":"90rem",prose:"60ch"},Vbe={sm:"640px",md:"768px",lg:"1024px",xl:"1280px"},Tee={...wee,...Ube,container:Vbe},Fbe=n=>typeof n=="function";function Oc(n,...e){return Fbe(n)?n(...e):n}const{definePartsStyle:Cee,defineMultiStyleConfig:jbe}=Qi(wSe.keys),Z0=Wn("avatar-border-color"),TC=Wn("avatar-bg"),KC=Wn("avatar-font-size"),ES=Wn("avatar-size"),Bbe={borderRadius:"full",border:"0.2em solid",borderColor:Z0.reference,[Z0.variable]:"white",_dark:{[Z0.variable]:"colors.gray.800"}},zbe={bg:TC.reference,fontSize:KC.reference,width:ES.reference,height:ES.reference,lineHeight:"1",[TC.variable]:"colors.gray.200",_dark:{[TC.variable]:"colors.whiteAlpha.400"}},Wbe=n=>{const{name:e,theme:i}=n,o=e?Ebe({string:e}):"colors.gray.400",l=_be(o)(i);let u="white";return l||(u="gray.800"),{bg:TC.reference,fontSize:KC.reference,color:u,borderColor:Z0.reference,verticalAlign:"top",width:ES.reference,height:ES.reference,"&:not([data-loaded])":{[TC.variable]:o},[Z0.variable]:"colors.white",_dark:{[Z0.variable]:"colors.gray.800"}}},Gbe={fontSize:KC.reference,lineHeight:"1"},Hbe=Cee(n=>({badge:Oc(Bbe,n),excessLabel:Oc(zbe,n),container:Oc(Wbe,n),label:Gbe}));function dg(n){const e=n!=="100%"?Tee[n]:void 0;return Cee({container:{[ES.variable]:e??n,[KC.variable]:`calc(${e??n} / 2.5)`},excessLabel:{[ES.variable]:e??n,[KC.variable]:`calc(${e??n} / 2.5)`}})}const $be={"2xs":dg(4),xs:dg(6),sm:dg(8),md:dg(12),lg:dg(16),xl:dg(24),"2xl":dg(32),full:dg("100%")},Kbe=jbe({baseStyle:Hbe,sizes:$be,defaultProps:{size:"md"}}),oo=pSe("badge",["bg","color","shadow"]),qbe={px:1,textTransform:"uppercase",fontSize:"xs",borderRadius:"sm",fontWeight:"bold",bg:oo.bg.reference,color:oo.color.reference,boxShadow:oo.shadow.reference},Ybe=n=>{const{colorScheme:e,theme:i}=n,o=yS(`${e}.500`,.6)(i);return{[oo.bg.variable]:`colors.${e}.500`,[oo.color.variable]:"colors.white",_dark:{[oo.bg.variable]:o,[oo.color.variable]:"colors.whiteAlpha.800"}}},Xbe=n=>{const{colorScheme:e,theme:i}=n,o=yS(`${e}.200`,.16)(i);return{[oo.bg.variable]:`colors.${e}.100`,[oo.color.variable]:`colors.${e}.800`,_dark:{[oo.bg.variable]:o,[oo.color.variable]:`colors.${e}.200`}}},Jbe=n=>{const{colorScheme:e,theme:i}=n,o=yS(`${e}.200`,.8)(i);return{[oo.color.variable]:`colors.${e}.500`,_dark:{[oo.color.variable]:o},[oo.shadow.variable]:`inset 0 0 0px 1px ${oo.color.reference}`}},Qbe={solid:Ybe,subtle:Xbe,outline:Jbe},CC={baseStyle:qbe,variants:Qbe,defaultProps:{variant:"subtle",colorScheme:"gray"}},{defineMultiStyleConfig:Zbe,definePartsStyle:ewe}=Qi(TSe.keys),ZM=Wn("breadcrumb-link-decor"),twe={transitionProperty:"common",transitionDuration:"fast",transitionTimingFunction:"ease-out",outline:"none",color:"inherit",textDecoration:ZM.reference,[ZM.variable]:"none","&:not([aria-current=page])":{cursor:"pointer",_hover:{[ZM.variable]:"underline"},_focusVisible:{boxShadow:"outline"}}},nwe=ewe({link:twe}),rwe=Zbe({baseStyle:nwe}),iwe={lineHeight:"1.2",borderRadius:"md",fontWeight:"semibold",transitionProperty:"common",transitionDuration:"normal",_focusVisible:{boxShadow:"outline"},_disabled:{opacity:.4,cursor:"not-allowed",boxShadow:"none"},_hover:{_disabled:{bg:"initial"}}},Ree=n=>{const{colorScheme:e,theme:i}=n;if(e==="gray")return{color:zn("gray.800","whiteAlpha.900")(n),_hover:{bg:zn("gray.100","whiteAlpha.200")(n)},_active:{bg:zn("gray.200","whiteAlpha.300")(n)}};const o=yS(`${e}.200`,.12)(i),l=yS(`${e}.200`,.24)(i);return{color:zn(`${e}.600`,`${e}.200`)(n),bg:"transparent",_hover:{bg:zn(`${e}.50`,o)(n)},_active:{bg:zn(`${e}.100`,l)(n)}}},swe=n=>{const{colorScheme:e}=n,i=zn("gray.200","whiteAlpha.300")(n);return{border:"1px solid",borderColor:e==="gray"?i:"currentColor",".chakra-button__group[data-attached][data-orientation=horizontal] > &:not(:last-of-type)":{marginEnd:"-1px"},".chakra-button__group[data-attached][data-orientation=vertical] > &:not(:last-of-type)":{marginBottom:"-1px"},...Oc(Ree,n)}},owe={yellow:{bg:"yellow.400",color:"black",hoverBg:"yellow.500",activeBg:"yellow.600"},cyan:{bg:"cyan.400",color:"black",hoverBg:"cyan.500",activeBg:"cyan.600"}},awe=n=>{const{colorScheme:e}=n;if(e==="gray"){const y=zn("gray.100","whiteAlpha.200")(n);return{bg:y,color:zn("gray.800","whiteAlpha.900")(n),_hover:{bg:zn("gray.200","whiteAlpha.300")(n),_disabled:{bg:y}},_active:{bg:zn("gray.300","whiteAlpha.400")(n)}}}const{bg:i=`${e}.500`,color:o="white",hoverBg:l=`${e}.600`,activeBg:u=`${e}.700`}=owe[e]??{},p=zn(i,`${e}.200`)(n);return{bg:p,color:zn(o,"gray.800")(n),_hover:{bg:zn(l,`${e}.300`)(n),_disabled:{bg:p}},_active:{bg:zn(u,`${e}.400`)(n)}}},cwe=n=>{const{colorScheme:e}=n;return{padding:0,height:"auto",lineHeight:"normal",verticalAlign:"baseline",color:zn(`${e}.500`,`${e}.200`)(n),_hover:{textDecoration:"underline",_disabled:{textDecoration:"none"}},_active:{color:zn(`${e}.700`,`${e}.500`)(n)}}},lwe={bg:"none",color:"inherit",display:"inline",lineHeight:"inherit",m:"0",p:"0"},uwe={ghost:Ree,outline:swe,solid:awe,link:cwe,unstyled:lwe},dwe={lg:{h:"12",minW:"12",fontSize:"lg",px:"6"},md:{h:"10",minW:"10",fontSize:"md",px:"4"},sm:{h:"8",minW:"8",fontSize:"sm",px:"3"},xs:{h:"6",minW:"6",fontSize:"xs",px:"2"}},hwe={baseStyle:iwe,variants:uwe,sizes:dwe,defaultProps:{variant:"solid",size:"md",colorScheme:"gray"}},{definePartsStyle:Fy,defineMultiStyleConfig:pwe}=Qi(HSe.keys),tO=Wn("card-bg"),Df=Wn("card-padding"),Iee=Wn("card-shadow"),Ek=Wn("card-radius"),Aee=Wn("card-border-width","0"),Pee=Wn("card-border-color"),fwe=Fy({container:{[tO.variable]:"colors.chakra-body-bg",backgroundColor:tO.reference,boxShadow:Iee.reference,borderRadius:Ek.reference,color:"chakra-body-text",borderWidth:Aee.reference,borderColor:Pee.reference},body:{padding:Df.reference,flex:"1 1 0%"},header:{padding:Df.reference},footer:{padding:Df.reference}}),mwe={sm:Fy({container:{[Ek.variable]:"radii.base",[Df.variable]:"space.3"}}),md:Fy({container:{[Ek.variable]:"radii.md",[Df.variable]:"space.5"}}),lg:Fy({container:{[Ek.variable]:"radii.xl",[Df.variable]:"space.7"}})},gwe={elevated:Fy({container:{[Iee.variable]:"shadows.base",_dark:{[tO.variable]:"colors.gray.700"}}}),outline:Fy({container:{[Aee.variable]:"1px",[Pee.variable]:"colors.chakra-border-color"}}),filled:Fy({container:{[tO.variable]:"colors.chakra-subtle-bg"}}),unstyled:{body:{[Df.variable]:0},header:{[Df.variable]:0},footer:{[Df.variable]:0}}},_we=pwe({baseStyle:fwe,variants:gwe,sizes:mwe,defaultProps:{variant:"elevated",size:"md"}}),{definePartsStyle:vk,defineMultiStyleConfig:ywe}=Qi(CSe.keys),RC=Wn("checkbox-size"),Ewe=n=>{const{colorScheme:e}=n;return{w:RC.reference,h:RC.reference,transitionProperty:"box-shadow",transitionDuration:"normal",border:"2px solid",borderRadius:"sm",borderColor:"inherit",color:"white",_checked:{bg:zn(`${e}.500`,`${e}.200`)(n),borderColor:zn(`${e}.500`,`${e}.200`)(n),color:zn("white","gray.900")(n),_hover:{bg:zn(`${e}.600`,`${e}.300`)(n),borderColor:zn(`${e}.600`,`${e}.300`)(n)},_disabled:{borderColor:zn("gray.200","transparent")(n),bg:zn("gray.200","whiteAlpha.300")(n),color:zn("gray.500","whiteAlpha.500")(n)}},_indeterminate:{bg:zn(`${e}.500`,`${e}.200`)(n),borderColor:zn(`${e}.500`,`${e}.200`)(n),color:zn("white","gray.900")(n)},_disabled:{bg:zn("gray.100","whiteAlpha.100")(n),borderColor:zn("gray.100","transparent")(n)},_focusVisible:{boxShadow:"outline"},_invalid:{borderColor:zn("red.500","red.300")(n)}}},vwe={_disabled:{cursor:"not-allowed"}},Swe={userSelect:"none",_disabled:{opacity:.4}},bwe={transitionProperty:"transform",transitionDuration:"normal"},wwe=vk(n=>({icon:bwe,container:vwe,control:Oc(Ewe,n),label:Swe})),Twe={sm:vk({control:{[RC.variable]:"sizes.3"},label:{fontSize:"sm"},icon:{fontSize:"3xs"}}),md:vk({control:{[RC.variable]:"sizes.4"},label:{fontSize:"md"},icon:{fontSize:"2xs"}}),lg:vk({control:{[RC.variable]:"sizes.5"},label:{fontSize:"lg"},icon:{fontSize:"2xs"}})},_g=ywe({baseStyle:wwe,sizes:Twe,defaultProps:{size:"md",colorScheme:"blue"}}),IC=zo("close-button-size"),jT=zo("close-button-bg"),Cwe={w:[IC.reference],h:[IC.reference],borderRadius:"md",transitionProperty:"common",transitionDuration:"normal",_disabled:{opacity:.4,cursor:"not-allowed",boxShadow:"none"},_hover:{[jT.variable]:"colors.blackAlpha.100",_dark:{[jT.variable]:"colors.whiteAlpha.100"}},_active:{[jT.variable]:"colors.blackAlpha.200",_dark:{[jT.variable]:"colors.whiteAlpha.200"}},_focusVisible:{boxShadow:"outline"},bg:jT.reference},Rwe={lg:{[IC.variable]:"sizes.10",fontSize:"md"},md:{[IC.variable]:"sizes.8",fontSize:"xs"},sm:{[IC.variable]:"sizes.6",fontSize:"2xs"}},Iwe={baseStyle:Cwe,sizes:Rwe,defaultProps:{size:"md"}},{variants:Awe,defaultProps:Pwe}=CC,kwe={fontFamily:"mono",fontSize:"sm",px:"0.2em",borderRadius:"sm",bg:oo.bg.reference,color:oo.color.reference,boxShadow:oo.shadow.reference},Owe={baseStyle:kwe,variants:Awe,defaultProps:Pwe},Nwe={w:"100%",mx:"auto",maxW:"prose",px:"4"},Dwe={baseStyle:Nwe},xwe={opacity:.6,borderColor:"inherit"},Lwe={borderStyle:"solid"},Mwe={borderStyle:"dashed"},Uwe={solid:Lwe,dashed:Mwe},Vwe={baseStyle:xwe,variants:Uwe,defaultProps:{variant:"solid"}},{definePartsStyle:CV,defineMultiStyleConfig:Fwe}=Qi(RSe.keys),eU=Wn("drawer-bg"),tU=Wn("drawer-box-shadow");function T0(n){return CV(n==="full"?{dialog:{maxW:"100vw",h:"100vh"}}:{dialog:{maxW:n}})}const jwe={bg:"blackAlpha.600",zIndex:"modal"},Bwe={display:"flex",zIndex:"modal",justifyContent:"center"},zwe=n=>{const{isFullHeight:e}=n;return{...e&&{height:"100vh"},zIndex:"modal",maxH:"100vh",color:"inherit",[eU.variable]:"colors.white",[tU.variable]:"shadows.lg",_dark:{[eU.variable]:"colors.gray.700",[tU.variable]:"shadows.dark-lg"},bg:eU.reference,boxShadow:tU.reference}},Wwe={px:"6",py:"4",fontSize:"xl",fontWeight:"semibold"},Gwe={position:"absolute",top:"2",insetEnd:"3"},Hwe={px:"6",py:"2",flex:"1",overflow:"auto"},$we={px:"6",py:"4"},Kwe=CV(n=>({overlay:jwe,dialogContainer:Bwe,dialog:Oc(zwe,n),header:Wwe,closeButton:Gwe,body:Hwe,footer:$we})),qwe={xs:T0("xs"),sm:T0("md"),md:T0("lg"),lg:T0("2xl"),xl:T0("4xl"),full:T0("full")},Ywe=Fwe({baseStyle:Kwe,sizes:qwe,defaultProps:{size:"xs"}}),{definePartsStyle:Xwe,defineMultiStyleConfig:Jwe}=Qi(ISe.keys),Qwe={borderRadius:"md",py:"1",transitionProperty:"common",transitionDuration:"normal"},Zwe={borderRadius:"md",py:"1",transitionProperty:"common",transitionDuration:"normal",width:"full",_focusVisible:{boxShadow:"outline"},_placeholder:{opacity:.6}},eTe={borderRadius:"md",py:"1",transitionProperty:"common",transitionDuration:"normal",width:"full",_focusVisible:{boxShadow:"outline"},_placeholder:{opacity:.6}},tTe=Xwe({preview:Qwe,input:Zwe,textarea:eTe}),nTe=Jwe({baseStyle:tTe}),{definePartsStyle:rTe,defineMultiStyleConfig:iTe}=Qi(ASe.keys),eS=Wn("form-control-color"),sTe={marginStart:"1",[eS.variable]:"colors.red.500",_dark:{[eS.variable]:"colors.red.300"},color:eS.reference},oTe={mt:"2",[eS.variable]:"colors.gray.600",_dark:{[eS.variable]:"colors.whiteAlpha.600"},color:eS.reference,lineHeight:"normal",fontSize:"sm"},aTe=rTe({container:{width:"100%",position:"relative"},requiredIndicator:sTe,helperText:oTe}),cTe=iTe({baseStyle:aTe}),{definePartsStyle:lTe,defineMultiStyleConfig:uTe}=Qi(PSe.keys),tS=Wn("form-error-color"),dTe={[tS.variable]:"colors.red.500",_dark:{[tS.variable]:"colors.red.300"},color:tS.reference,mt:"2",fontSize:"sm",lineHeight:"normal"},hTe={marginEnd:"0.5em",[tS.variable]:"colors.red.500",_dark:{[tS.variable]:"colors.red.300"},color:tS.reference},pTe=lTe({text:dTe,icon:hTe}),fTe=uTe({baseStyle:pTe}),mTe={fontSize:"md",marginEnd:"3",mb:"2",fontWeight:"medium",transitionProperty:"common",transitionDuration:"normal",opacity:1,_disabled:{opacity:.4}},gTe={baseStyle:mTe},_Te={fontFamily:"heading",fontWeight:"bold"},yTe={"4xl":{fontSize:["6xl",null,"7xl"],lineHeight:1},"3xl":{fontSize:["5xl",null,"6xl"],lineHeight:1},"2xl":{fontSize:["4xl",null,"5xl"],lineHeight:[1.2,null,1]},xl:{fontSize:["3xl",null,"4xl"],lineHeight:[1.33,null,1.2]},lg:{fontSize:["2xl",null,"3xl"],lineHeight:[1.33,null,1.2]},md:{fontSize:"xl",lineHeight:1.2},sm:{fontSize:"md",lineHeight:1.2},xs:{fontSize:"sm",lineHeight:1.2}},ETe={baseStyle:_Te,sizes:yTe,defaultProps:{size:"xl"}},{definePartsStyle:Af,defineMultiStyleConfig:vTe}=Qi(kSe.keys),V0=Wn("input-height"),F0=Wn("input-font-size"),j0=Wn("input-padding"),B0=Wn("input-border-radius"),STe=Af({addon:{height:V0.reference,fontSize:F0.reference,px:j0.reference,borderRadius:B0.reference},field:{width:"100%",height:V0.reference,fontSize:F0.reference,px:j0.reference,borderRadius:B0.reference,minWidth:0,outline:0,position:"relative",appearance:"none",transitionProperty:"common",transitionDuration:"normal",_disabled:{opacity:.4,cursor:"not-allowed"}}}),hg={lg:{[F0.variable]:"fontSizes.lg",[j0.variable]:"space.4",[B0.variable]:"radii.md",[V0.variable]:"sizes.12"},md:{[F0.variable]:"fontSizes.md",[j0.variable]:"space.4",[B0.variable]:"radii.md",[V0.variable]:"sizes.10"},sm:{[F0.variable]:"fontSizes.sm",[j0.variable]:"space.3",[B0.variable]:"radii.sm",[V0.variable]:"sizes.8"},xs:{[F0.variable]:"fontSizes.xs",[j0.variable]:"space.2",[B0.variable]:"radii.sm",[V0.variable]:"sizes.6"}},bTe={lg:Af({field:hg.lg,group:hg.lg}),md:Af({field:hg.md,group:hg.md}),sm:Af({field:hg.sm,group:hg.sm}),xs:Af({field:hg.xs,group:hg.xs})};function sj(n){const{focusBorderColor:e,errorBorderColor:i}=n;return{focusBorderColor:e||zn("blue.500","blue.300")(n),errorBorderColor:i||zn("red.500","red.300")(n)}}const wTe=Af(n=>{const{theme:e}=n,{focusBorderColor:i,errorBorderColor:o}=sj(n);return{field:{border:"1px solid",borderColor:"inherit",bg:"inherit",_hover:{borderColor:zn("gray.300","whiteAlpha.400")(n)},_readOnly:{boxShadow:"none !important",userSelect:"all"},_invalid:{borderColor:kc(e,o),boxShadow:`0 0 0 1px ${kc(e,o)}`},_focusVisible:{zIndex:1,borderColor:kc(e,i),boxShadow:`0 0 0 1px ${kc(e,i)}`}},addon:{border:"1px solid",borderColor:zn("inherit","whiteAlpha.50")(n),bg:zn("gray.100","whiteAlpha.300")(n)}}}),TTe=Af(n=>{const{theme:e}=n,{focusBorderColor:i,errorBorderColor:o}=sj(n);return{field:{border:"2px solid",borderColor:"transparent",bg:zn("gray.100","whiteAlpha.50")(n),_hover:{bg:zn("gray.200","whiteAlpha.100")(n)},_readOnly:{boxShadow:"none !important",userSelect:"all"},_invalid:{borderColor:kc(e,o)},_focusVisible:{bg:"transparent",borderColor:kc(e,i)}},addon:{border:"2px solid",borderColor:"transparent",bg:zn("gray.100","whiteAlpha.50")(n)}}}),CTe=Af(n=>{const{theme:e}=n,{focusBorderColor:i,errorBorderColor:o}=sj(n);return{field:{borderBottom:"1px solid",borderColor:"inherit",borderRadius:"0",px:"0",bg:"transparent",_readOnly:{boxShadow:"none !important",userSelect:"all"},_invalid:{borderColor:kc(e,o),boxShadow:`0px 1px 0px 0px ${kc(e,o)}`},_focusVisible:{borderColor:kc(e,i),boxShadow:`0px 1px 0px 0px ${kc(e,i)}`}},addon:{borderBottom:"2px solid",borderColor:"inherit",borderRadius:"0",px:"0",bg:"transparent"}}}),RTe=Af({field:{bg:"transparent",px:"0",height:"auto"},addon:{bg:"transparent",px:"0",height:"auto"}}),ITe={outline:wTe,filled:TTe,flushed:CTe,unstyled:RTe},_i=vTe({baseStyle:STe,sizes:bTe,variants:ITe,defaultProps:{size:"md",variant:"outline"}}),nU=Wn("kbd-bg"),ATe={[nU.variable]:"colors.gray.100",_dark:{[nU.variable]:"colors.whiteAlpha.100"},bg:nU.reference,borderRadius:"md",borderWidth:"1px",borderBottomWidth:"3px",fontSize:"0.8em",fontWeight:"bold",lineHeight:"normal",px:"0.4em",whiteSpace:"nowrap"},PTe={baseStyle:ATe},kTe={transitionProperty:"common",transitionDuration:"fast",transitionTimingFunction:"ease-out",cursor:"pointer",textDecoration:"none",outline:"none",color:"inherit",_hover:{textDecoration:"underline"},_focusVisible:{boxShadow:"outline"}},OTe={baseStyle:kTe},{defineMultiStyleConfig:NTe,definePartsStyle:DTe}=Qi(OSe.keys),xTe={marginEnd:"2",display:"inline",verticalAlign:"text-bottom"},LTe=DTe({icon:xTe}),MTe=NTe({baseStyle:LTe}),{defineMultiStyleConfig:UTe,definePartsStyle:VTe}=Qi(NSe.keys),ap=Wn("menu-bg"),rU=Wn("menu-shadow"),FTe={[ap.variable]:"#fff",[rU.variable]:"shadows.sm",_dark:{[ap.variable]:"colors.gray.700",[rU.variable]:"shadows.dark-lg"},color:"inherit",minW:"3xs",py:"2",zIndex:"dropdown",borderRadius:"md",borderWidth:"1px",bg:ap.reference,boxShadow:rU.reference},jTe={py:"1.5",px:"3",transitionProperty:"background",transitionDuration:"ultra-fast",transitionTimingFunction:"ease-in",_focus:{[ap.variable]:"colors.gray.100",_dark:{[ap.variable]:"colors.whiteAlpha.100"}},_active:{[ap.variable]:"colors.gray.200",_dark:{[ap.variable]:"colors.whiteAlpha.200"}},_expanded:{[ap.variable]:"colors.gray.100",_dark:{[ap.variable]:"colors.whiteAlpha.100"}},_disabled:{opacity:.4,cursor:"not-allowed"},bg:ap.reference},BTe={mx:4,my:2,fontWeight:"semibold",fontSize:"sm"},zTe={display:"inline-flex",alignItems:"center",justifyContent:"center",flexShrink:0},WTe={opacity:.6},GTe={border:0,borderBottom:"1px solid",borderColor:"inherit",my:"2",opacity:.6},HTe={transitionProperty:"common",transitionDuration:"normal"},$Te=VTe({button:HTe,list:FTe,item:jTe,groupTitle:BTe,icon:zTe,command:WTe,divider:GTe}),KTe=UTe({baseStyle:$Te}),{defineMultiStyleConfig:qTe,definePartsStyle:RV}=Qi(DSe.keys),iU=Wn("modal-bg"),sU=Wn("modal-shadow"),YTe={bg:"blackAlpha.600",zIndex:"modal"},XTe=n=>{const{isCentered:e,scrollBehavior:i}=n;return{display:"flex",zIndex:"modal",justifyContent:"center",alignItems:e?"center":"flex-start",overflow:i==="inside"?"hidden":"auto",overscrollBehaviorY:"none"}},JTe=n=>{const{isCentered:e,scrollBehavior:i}=n;return{borderRadius:"md",color:"inherit",my:e?"auto":"16",mx:e?"auto":void 0,zIndex:"modal",maxH:i==="inside"?"calc(100% - 7.5rem)":void 0,[iU.variable]:"colors.white",[sU.variable]:"shadows.lg",_dark:{[iU.variable]:"colors.gray.700",[sU.variable]:"shadows.dark-lg"},bg:iU.reference,boxShadow:sU.reference}},QTe={px:"6",py:"4",fontSize:"xl",fontWeight:"semibold"},ZTe={position:"absolute",top:"2",insetEnd:"3"},eCe=n=>{const{scrollBehavior:e}=n;return{px:"6",py:"2",flex:"1",overflow:e==="inside"?"auto":void 0}},tCe={px:"6",py:"4"},nCe=RV(n=>({overlay:YTe,dialogContainer:Oc(XTe,n),dialog:Oc(JTe,n),header:QTe,closeButton:ZTe,body:Oc(eCe,n),footer:tCe}));function th(n){return RV(n==="full"?{dialog:{maxW:"100vw",minH:"$100vh",my:"0",borderRadius:"0"}}:{dialog:{maxW:n}})}const rCe={xs:th("xs"),sm:th("sm"),md:th("md"),lg:th("lg"),xl:th("xl"),"2xl":th("2xl"),"3xl":th("3xl"),"4xl":th("4xl"),"5xl":th("5xl"),"6xl":th("6xl"),full:th("full")},iCe=qTe({baseStyle:nCe,sizes:rCe,defaultProps:{size:"md"}}),kee={letterSpacings:{tighter:"-0.05em",tight:"-0.025em",normal:"0",wide:"0.025em",wider:"0.05em",widest:"0.1em"},lineHeights:{normal:"normal",none:1,shorter:1.25,short:1.375,base:1.5,tall:1.625,taller:"2",3:".75rem",4:"1rem",5:"1.25rem",6:"1.5rem",7:"1.75rem",8:"2rem",9:"2.25rem",10:"2.5rem"},fontWeights:{hairline:100,thin:200,light:300,normal:400,medium:500,semibold:600,bold:700,extrabold:800,black:900},fonts:{heading:'-apple-system, BlinkMacSystemFont, "Segoe UI", Helvetica, Arial, sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol"',body:'-apple-system, BlinkMacSystemFont, "Segoe UI", Helvetica, Arial, sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol"',mono:'SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono","Courier New",monospace'},fontSizes:{"3xs":"0.45rem","2xs":"0.625rem",xs:"0.75rem",sm:"0.875rem",md:"1rem",lg:"1.125rem",xl:"1.25rem","2xl":"1.5rem","3xl":"1.875rem","4xl":"2.25rem","5xl":"3rem","6xl":"3.75rem","7xl":"4.5rem","8xl":"6rem","9xl":"8rem"}},{defineMultiStyleConfig:sCe,definePartsStyle:Oee}=Qi(xSe.keys),oj=zo("number-input-stepper-width"),Nee=zo("number-input-input-padding"),oCe=Cf(oj).add("0.5rem").toString(),oU=zo("number-input-bg"),aU=zo("number-input-color"),cU=zo("number-input-border-color"),aCe={[oj.variable]:"sizes.6",[Nee.variable]:oCe},cCe=n=>{var e;return((e=Oc(_i.baseStyle,n))==null?void 0:e.field)??{}},lCe={width:oj.reference},uCe={borderStart:"1px solid",borderStartColor:cU.reference,color:aU.reference,bg:oU.reference,[aU.variable]:"colors.chakra-body-text",[cU.variable]:"colors.chakra-border-color",_dark:{[aU.variable]:"colors.whiteAlpha.800",[cU.variable]:"colors.whiteAlpha.300"},_active:{[oU.variable]:"colors.gray.200",_dark:{[oU.variable]:"colors.whiteAlpha.300"}},_disabled:{opacity:.4,cursor:"not-allowed"}},dCe=Oee(n=>({root:aCe,field:Oc(cCe,n)??{},stepperGroup:lCe,stepper:uCe}));function V1(n){var u,p;const e=(u=_i.sizes)==null?void 0:u[n],i={lg:"md",md:"md",sm:"sm",xs:"sm"},o=((p=e.field)==null?void 0:p.fontSize)??"md",l=kee.fontSizes[o];return Oee({field:{...e.field,paddingInlineEnd:Nee.reference,verticalAlign:"top"},stepper:{fontSize:Cf(l).multiply(.75).toString(),_first:{borderTopEndRadius:i[n]},_last:{borderBottomEndRadius:i[n],mt:"-1px",borderTopWidth:1}}})}const hCe={xs:V1("xs"),sm:V1("sm"),md:V1("md"),lg:V1("lg")},pCe=sCe({baseStyle:dCe,sizes:hCe,variants:_i.variants,defaultProps:_i.defaultProps});var PZ;const fCe={...(PZ=_i.baseStyle)==null?void 0:PZ.field,textAlign:"center"},mCe={lg:{fontSize:"lg",w:12,h:12,borderRadius:"md"},md:{fontSize:"md",w:10,h:10,borderRadius:"md"},sm:{fontSize:"sm",w:8,h:8,borderRadius:"sm"},xs:{fontSize:"xs",w:6,h:6,borderRadius:"sm"}};var kZ;const gCe={outline:n=>{var e,i;return((i=Oc((e=_i.variants)==null?void 0:e.outline,n))==null?void 0:i.field)??{}},flushed:n=>{var e,i;return((i=Oc((e=_i.variants)==null?void 0:e.flushed,n))==null?void 0:i.field)??{}},filled:n=>{var e,i;return((i=Oc((e=_i.variants)==null?void 0:e.filled,n))==null?void 0:i.field)??{}},unstyled:((kZ=_i.variants)==null?void 0:kZ.unstyled.field)??{}},_Ce={baseStyle:fCe,sizes:mCe,variants:gCe,defaultProps:_i.defaultProps},{defineMultiStyleConfig:yCe,definePartsStyle:ECe}=Qi(LSe.keys),F1=zo("popper-bg"),vCe=zo("popper-arrow-bg"),xq=zo("popper-arrow-shadow-color"),SCe={zIndex:"popover"},bCe={[F1.variable]:"colors.white",bg:F1.reference,[vCe.variable]:F1.reference,[xq.variable]:"colors.gray.200",_dark:{[F1.variable]:"colors.gray.700",[xq.variable]:"colors.whiteAlpha.300"},width:"xs",border:"1px solid",borderColor:"inherit",borderRadius:"md",boxShadow:"sm",zIndex:"inherit",_focusVisible:{outline:0,boxShadow:"outline"}},wCe={px:3,py:2,borderBottomWidth:"1px"},TCe={px:3,py:2},CCe={px:3,py:2,borderTopWidth:"1px"},RCe={position:"absolute",borderRadius:"md",top:1,insetEnd:2,padding:2},ICe=ECe({popper:SCe,content:bCe,header:wCe,body:TCe,footer:CCe,closeButton:RCe}),ACe=yCe({baseStyle:ICe}),{defineMultiStyleConfig:PCe,definePartsStyle:aC}=Qi(MSe.keys),kCe=n=>{const{colorScheme:e,theme:i,isIndeterminate:o,hasStripe:l}=n,u=zn(Pq(),Pq("1rem","rgba(0,0,0,0.1)"))(n),p=zn(`${e}.500`,`${e}.200`)(n),y=`linear-gradient(
    to right,
    transparent 0%,
    ${kc(i,p)} 50%,
    transparent 100%
  )`;return{...!o&&l&&u,...o?{bgImage:y}:{bgColor:p}}},OCe={lineHeight:"1",fontSize:"0.25em",fontWeight:"bold",color:"white"},NCe=n=>({bg:zn("gray.100","whiteAlpha.300")(n)}),DCe=n=>({transitionProperty:"common",transitionDuration:"slow",...kCe(n)}),xCe=aC(n=>({label:OCe,filledTrack:DCe(n),track:NCe(n)})),LCe={xs:aC({track:{h:"1"}}),sm:aC({track:{h:"2"}}),md:aC({track:{h:"3"}}),lg:aC({track:{h:"4"}})},MCe=PCe({sizes:LCe,baseStyle:xCe,defaultProps:{size:"md",colorScheme:"blue"}}),{defineMultiStyleConfig:UCe,definePartsStyle:Sk}=Qi(USe.keys),VCe=n=>{var i;const e=(i=Oc(_g.baseStyle,n))==null?void 0:i.control;return{...e,borderRadius:"full",_checked:{...e==null?void 0:e._checked,_before:{content:'""',display:"inline-block",pos:"relative",w:"50%",h:"50%",borderRadius:"50%",bg:"currentColor"}}}},FCe=Sk(n=>{var e,i;return{label:(e=_g.baseStyle)==null?void 0:e.call(_g,n).label,container:(i=_g.baseStyle)==null?void 0:i.call(_g,n).container,control:VCe(n)}}),jCe={md:Sk({control:{w:"4",h:"4"},label:{fontSize:"md"}}),lg:Sk({control:{w:"5",h:"5"},label:{fontSize:"lg"}}),sm:Sk({control:{width:"3",height:"3"},label:{fontSize:"sm"}})},BCe=UCe({baseStyle:FCe,sizes:jCe,defaultProps:{size:"md",colorScheme:"blue"}}),{defineMultiStyleConfig:zCe,definePartsStyle:WCe}=Qi(VSe.keys),j1=Wn("select-bg");var OZ;const GCe={...(OZ=_i.baseStyle)==null?void 0:OZ.field,appearance:"none",paddingBottom:"1px",lineHeight:"normal",bg:j1.reference,[j1.variable]:"colors.white",_dark:{[j1.variable]:"colors.gray.700"},"> option, > optgroup":{bg:j1.reference}},HCe={width:"6",height:"100%",insetEnd:"2",position:"relative",color:"currentColor",fontSize:"xl",_disabled:{opacity:.5}},$Ce=WCe({field:GCe,icon:HCe}),B1={paddingInlineEnd:"8"};var NZ,DZ,xZ,LZ,MZ,UZ,VZ,FZ;const KCe={lg:{...(NZ=_i.sizes)==null?void 0:NZ.lg,field:{...(DZ=_i.sizes)==null?void 0:DZ.lg.field,...B1}},md:{...(xZ=_i.sizes)==null?void 0:xZ.md,field:{...(LZ=_i.sizes)==null?void 0:LZ.md.field,...B1}},sm:{...(MZ=_i.sizes)==null?void 0:MZ.sm,field:{...(UZ=_i.sizes)==null?void 0:UZ.sm.field,...B1}},xs:{...(VZ=_i.sizes)==null?void 0:VZ.xs,field:{...(FZ=_i.sizes)==null?void 0:FZ.xs.field,...B1},icon:{insetEnd:"1"}}},qCe=zCe({baseStyle:$Ce,sizes:KCe,variants:_i.variants,defaultProps:_i.defaultProps}),lU=Wn("skeleton-start-color"),uU=Wn("skeleton-end-color"),YCe={[lU.variable]:"colors.gray.100",[uU.variable]:"colors.gray.400",_dark:{[lU.variable]:"colors.gray.800",[uU.variable]:"colors.gray.600"},background:lU.reference,borderColor:uU.reference,opacity:.7,borderRadius:"sm"},XCe={baseStyle:YCe},dU=Wn("skip-link-bg"),JCe={borderRadius:"md",fontWeight:"semibold",_focusVisible:{boxShadow:"outline",padding:"4",position:"fixed",top:"6",insetStart:"6",[dU.variable]:"colors.white",_dark:{[dU.variable]:"colors.gray.700"},bg:dU.reference}},QCe={baseStyle:JCe},{defineMultiStyleConfig:ZCe,definePartsStyle:QO}=Qi(FSe.keys),Xy=Wn("slider-thumb-size"),qC=Wn("slider-track-size"),yg=Wn("slider-bg"),eRe=n=>{const{orientation:e}=n;return{display:"inline-block",position:"relative",cursor:"pointer",_disabled:{opacity:.6,cursor:"default",pointerEvents:"none"},...rj({orientation:e,vertical:{h:"100%",px:Tf(Xy.reference).divide(2).toString()},horizontal:{w:"100%",py:Tf(Xy.reference).divide(2).toString()}})}},tRe=n=>({...rj({orientation:n.orientation,horizontal:{h:qC.reference},vertical:{w:qC.reference}}),overflow:"hidden",borderRadius:"sm",[yg.variable]:"colors.gray.200",_dark:{[yg.variable]:"colors.whiteAlpha.200"},_disabled:{[yg.variable]:"colors.gray.300",_dark:{[yg.variable]:"colors.whiteAlpha.300"}},bg:yg.reference}),nRe=n=>{const{orientation:e}=n;return{...rj({orientation:e,vertical:{left:"50%",transform:"translateX(-50%)",_active:{transform:"translateX(-50%) scale(1.15)"}},horizontal:{top:"50%",transform:"translateY(-50%)",_active:{transform:"translateY(-50%) scale(1.15)"}}}),w:Xy.reference,h:Xy.reference,display:"flex",alignItems:"center",justifyContent:"center",position:"absolute",outline:0,zIndex:1,borderRadius:"full",bg:"white",boxShadow:"base",border:"1px solid",borderColor:"transparent",transitionProperty:"transform",transitionDuration:"normal",_focusVisible:{boxShadow:"outline"},_disabled:{bg:"gray.300"}}},rRe=n=>{const{colorScheme:e}=n;return{width:"inherit",height:"inherit",[yg.variable]:`colors.${e}.500`,_dark:{[yg.variable]:`colors.${e}.200`},bg:yg.reference}},iRe=QO(n=>({container:eRe(n),track:tRe(n),thumb:nRe(n),filledTrack:rRe(n)})),sRe=QO({container:{[Xy.variable]:"sizes.4",[qC.variable]:"sizes.1"}}),oRe=QO({container:{[Xy.variable]:"sizes.3.5",[qC.variable]:"sizes.1"}}),aRe=QO({container:{[Xy.variable]:"sizes.2.5",[qC.variable]:"sizes.0.5"}}),cRe={lg:sRe,md:oRe,sm:aRe},lRe=ZCe({baseStyle:iRe,sizes:cRe,defaultProps:{size:"md",colorScheme:"blue"}}),Oy=zo("spinner-size"),uRe={width:[Oy.reference],height:[Oy.reference]},dRe={xs:{[Oy.variable]:"sizes.3"},sm:{[Oy.variable]:"sizes.4"},md:{[Oy.variable]:"sizes.6"},lg:{[Oy.variable]:"sizes.8"},xl:{[Oy.variable]:"sizes.12"}},hRe={baseStyle:uRe,sizes:dRe,defaultProps:{size:"md"}},{defineMultiStyleConfig:pRe,definePartsStyle:Dee}=Qi(jSe.keys),fRe={fontWeight:"medium"},mRe={opacity:.8,marginBottom:"2"},gRe={verticalAlign:"baseline",fontWeight:"semibold"},_Re={marginEnd:1,w:"3.5",h:"3.5",verticalAlign:"middle"},yRe=Dee({container:{},label:fRe,helpText:mRe,number:gRe,icon:_Re}),ERe={md:Dee({label:{fontSize:"sm"},helpText:{fontSize:"sm"},number:{fontSize:"2xl"}})},vRe=pRe({baseStyle:yRe,sizes:ERe,defaultProps:{size:"md"}}),{defineMultiStyleConfig:SRe,definePartsStyle:cC}=Qi(["stepper","step","title","description","indicator","separator","icon","number"]),Rf=Wn("stepper-indicator-size"),z0=Wn("stepper-icon-size"),W0=Wn("stepper-title-font-size"),lC=Wn("stepper-description-font-size"),BT=Wn("stepper-accent-color"),bRe=cC(({colorScheme:n})=>({stepper:{display:"flex",justifyContent:"space-between",gap:"4","&[data-orientation=vertical]":{flexDirection:"column",alignItems:"flex-start"},"&[data-orientation=horizontal]":{flexDirection:"row",alignItems:"center"},[BT.variable]:`colors.${n}.500`,_dark:{[BT.variable]:`colors.${n}.200`}},title:{fontSize:W0.reference,fontWeight:"medium"},description:{fontSize:lC.reference,color:"chakra-subtle-text"},number:{fontSize:W0.reference},step:{flexShrink:0,position:"relative",display:"flex",gap:"2","&[data-orientation=horizontal]":{alignItems:"center"},flex:"1","&:last-of-type:not([data-stretch])":{flex:"initial"}},icon:{flexShrink:0,width:z0.reference,height:z0.reference},indicator:{flexShrink:0,borderRadius:"full",width:Rf.reference,height:Rf.reference,display:"flex",justifyContent:"center",alignItems:"center","&[data-status=active]":{borderWidth:"2px",borderColor:BT.reference},"&[data-status=complete]":{bg:BT.reference,color:"chakra-inverse-text"},"&[data-status=incomplete]":{borderWidth:"2px"}},separator:{bg:"chakra-border-color",flex:"1","&[data-status=complete]":{bg:BT.reference},"&[data-orientation=horizontal]":{width:"100%",height:"2px",marginStart:"2"},"&[data-orientation=vertical]":{width:"2px",position:"absolute",height:"100%",maxHeight:`calc(100% - ${Rf.reference} - 8px)`,top:`calc(${Rf.reference} + 4px)`,insetStart:`calc(${Rf.reference} / 2 - 1px)`}}})),wRe=SRe({baseStyle:bRe,sizes:{xs:cC({stepper:{[Rf.variable]:"sizes.4",[z0.variable]:"sizes.3",[W0.variable]:"fontSizes.xs",[lC.variable]:"fontSizes.xs"}}),sm:cC({stepper:{[Rf.variable]:"sizes.6",[z0.variable]:"sizes.4",[W0.variable]:"fontSizes.sm",[lC.variable]:"fontSizes.xs"}}),md:cC({stepper:{[Rf.variable]:"sizes.8",[z0.variable]:"sizes.5",[W0.variable]:"fontSizes.md",[lC.variable]:"fontSizes.sm"}}),lg:cC({stepper:{[Rf.variable]:"sizes.10",[z0.variable]:"sizes.6",[W0.variable]:"fontSizes.lg",[lC.variable]:"fontSizes.md"}})},defaultProps:{size:"md",colorScheme:"blue"}}),{defineMultiStyleConfig:TRe,definePartsStyle:bk}=Qi(BSe.keys),AC=zo("switch-track-width"),jy=zo("switch-track-height"),hU=zo("switch-track-diff"),CRe=Cf.subtract(AC,jy),IV=zo("switch-thumb-x"),zT=zo("switch-bg"),RRe=n=>{const{colorScheme:e}=n;return{borderRadius:"full",p:"0.5",width:[AC.reference],height:[jy.reference],transitionProperty:"common",transitionDuration:"fast",[zT.variable]:"colors.gray.300",_dark:{[zT.variable]:"colors.whiteAlpha.400"},_focusVisible:{boxShadow:"outline"},_disabled:{opacity:.4,cursor:"not-allowed"},_checked:{[zT.variable]:`colors.${e}.500`,_dark:{[zT.variable]:`colors.${e}.200`}},bg:zT.reference}},IRe={bg:"white",transitionProperty:"transform",transitionDuration:"normal",borderRadius:"inherit",width:[jy.reference],height:[jy.reference],_checked:{transform:`translateX(${IV.reference})`}},ARe=bk(n=>({container:{[hU.variable]:CRe,[IV.variable]:hU.reference,_rtl:{[IV.variable]:Cf(hU).negate().toString()}},track:RRe(n),thumb:IRe})),PRe={sm:bk({container:{[AC.variable]:"1.375rem",[jy.variable]:"sizes.3"}}),md:bk({container:{[AC.variable]:"1.875rem",[jy.variable]:"sizes.4"}}),lg:bk({container:{[AC.variable]:"2.875rem",[jy.variable]:"sizes.6"}})},kRe=TRe({baseStyle:ARe,sizes:PRe,defaultProps:{size:"md",colorScheme:"blue"}}),{defineMultiStyleConfig:ORe,definePartsStyle:nS}=Qi(zSe.keys),NRe=nS({table:{fontVariantNumeric:"lining-nums tabular-nums",borderCollapse:"collapse",width:"full"},th:{fontFamily:"heading",fontWeight:"bold",textTransform:"uppercase",letterSpacing:"wider",textAlign:"start"},td:{textAlign:"start"},caption:{mt:4,fontFamily:"heading",textAlign:"center",fontWeight:"medium"}}),nO={"&[data-is-numeric=true]":{textAlign:"end"}},DRe=nS(n=>{const{colorScheme:e}=n;return{th:{color:zn("gray.600","gray.400")(n),borderBottom:"1px",borderColor:zn(`${e}.100`,`${e}.700`)(n),...nO},td:{borderBottom:"1px",borderColor:zn(`${e}.100`,`${e}.700`)(n),...nO},caption:{color:zn("gray.600","gray.100")(n)},tfoot:{tr:{"&:last-of-type":{th:{borderBottomWidth:0}}}}}}),xRe=nS(n=>{const{colorScheme:e}=n;return{th:{color:zn("gray.600","gray.400")(n),borderBottom:"1px",borderColor:zn(`${e}.100`,`${e}.700`)(n),...nO},td:{borderBottom:"1px",borderColor:zn(`${e}.100`,`${e}.700`)(n),...nO},caption:{color:zn("gray.600","gray.100")(n)},tbody:{tr:{"&:nth-of-type(odd)":{"th, td":{borderBottomWidth:"1px",borderColor:zn(`${e}.100`,`${e}.700`)(n)},td:{background:zn(`${e}.100`,`${e}.700`)(n)}}}},tfoot:{tr:{"&:last-of-type":{th:{borderBottomWidth:0}}}}}}),LRe={simple:DRe,striped:xRe,unstyled:{}},MRe={sm:nS({th:{px:"4",py:"1",lineHeight:"4",fontSize:"xs"},td:{px:"4",py:"2",fontSize:"sm",lineHeight:"4"},caption:{px:"4",py:"2",fontSize:"xs"}}),md:nS({th:{px:"6",py:"3",lineHeight:"4",fontSize:"xs"},td:{px:"6",py:"4",lineHeight:"5"},caption:{px:"6",py:"2",fontSize:"sm"}}),lg:nS({th:{px:"8",py:"4",lineHeight:"5",fontSize:"sm"},td:{px:"8",py:"5",lineHeight:"6"},caption:{px:"6",py:"2",fontSize:"md"}})},URe=ORe({baseStyle:NRe,variants:LRe,sizes:MRe,defaultProps:{variant:"simple",size:"md",colorScheme:"gray"}}),ul=Wn("tabs-color"),oh=Wn("tabs-bg"),z1=Wn("tabs-border-color"),{defineMultiStyleConfig:VRe,definePartsStyle:bp}=Qi(WSe.keys),FRe=n=>{const{orientation:e}=n;return{display:e==="vertical"?"flex":"block"}},jRe=n=>{const{isFitted:e}=n;return{flex:e?1:void 0,transitionProperty:"common",transitionDuration:"normal",_focusVisible:{zIndex:1,boxShadow:"outline"},_disabled:{cursor:"not-allowed",opacity:.4}}},BRe=n=>{const{align:e="start",orientation:i}=n;return{justifyContent:{end:"flex-end",center:"center",start:"flex-start"}[e],flexDirection:i==="vertical"?"column":"row"}},zRe={p:4},WRe=bp(n=>({root:FRe(n),tab:jRe(n),tablist:BRe(n),tabpanel:zRe})),GRe={sm:bp({tab:{py:1,px:4,fontSize:"sm"}}),md:bp({tab:{fontSize:"md",py:2,px:4}}),lg:bp({tab:{fontSize:"lg",py:3,px:4}})},HRe=bp(n=>{const{colorScheme:e,orientation:i}=n,o=i==="vertical",l=o?"borderStart":"borderBottom",u=o?"marginStart":"marginBottom";return{tablist:{[l]:"2px solid",borderColor:"inherit"},tab:{[l]:"2px solid",borderColor:"transparent",[u]:"-2px",_selected:{[ul.variable]:`colors.${e}.600`,_dark:{[ul.variable]:`colors.${e}.300`},borderColor:"currentColor"},_active:{[oh.variable]:"colors.gray.200",_dark:{[oh.variable]:"colors.whiteAlpha.300"}},_disabled:{_active:{bg:"none"}},color:ul.reference,bg:oh.reference}}}),$Re=bp(n=>{const{colorScheme:e}=n;return{tab:{borderTopRadius:"md",border:"1px solid",borderColor:"transparent",mb:"-1px",[z1.variable]:"transparent",_selected:{[ul.variable]:`colors.${e}.600`,[z1.variable]:"colors.white",_dark:{[ul.variable]:`colors.${e}.300`,[z1.variable]:"colors.gray.800"},borderColor:"inherit",borderBottomColor:z1.reference},color:ul.reference},tablist:{mb:"-1px",borderBottom:"1px solid",borderColor:"inherit"}}}),KRe=bp(n=>{const{colorScheme:e}=n;return{tab:{border:"1px solid",borderColor:"inherit",[oh.variable]:"colors.gray.50",_dark:{[oh.variable]:"colors.whiteAlpha.50"},mb:"-1px",_notLast:{marginEnd:"-1px"},_selected:{[oh.variable]:"colors.white",[ul.variable]:`colors.${e}.600`,_dark:{[oh.variable]:"colors.gray.800",[ul.variable]:`colors.${e}.300`},borderColor:"inherit",borderTopColor:"currentColor",borderBottomColor:"transparent"},color:ul.reference,bg:oh.reference},tablist:{mb:"-1px",borderBottom:"1px solid",borderColor:"inherit"}}}),qRe=bp(n=>{const{colorScheme:e,theme:i}=n;return{tab:{borderRadius:"full",fontWeight:"semibold",color:"gray.600",_selected:{color:kc(i,`${e}.700`),bg:kc(i,`${e}.100`)}}}}),YRe=bp(n=>{const{colorScheme:e}=n;return{tab:{borderRadius:"full",fontWeight:"semibold",[ul.variable]:"colors.gray.600",_dark:{[ul.variable]:"inherit"},_selected:{[ul.variable]:"colors.white",[oh.variable]:`colors.${e}.600`,_dark:{[ul.variable]:"colors.gray.800",[oh.variable]:`colors.${e}.300`}},color:ul.reference,bg:oh.reference}}}),XRe=bp({}),JRe={line:HRe,enclosed:$Re,"enclosed-colored":KRe,"soft-rounded":qRe,"solid-rounded":YRe,unstyled:XRe},QRe=VRe({baseStyle:WRe,sizes:GRe,variants:JRe,defaultProps:{size:"md",variant:"line",colorScheme:"blue"}}),{defineMultiStyleConfig:ZRe,definePartsStyle:By}=Qi(GSe.keys),Lq=Wn("tag-bg"),Mq=Wn("tag-color"),pU=Wn("tag-shadow"),wk=Wn("tag-min-height"),Tk=Wn("tag-min-width"),Ck=Wn("tag-font-size"),Rk=Wn("tag-padding-inline"),eIe={fontWeight:"medium",lineHeight:1.2,outline:0,[Mq.variable]:oo.color.reference,[Lq.variable]:oo.bg.reference,[pU.variable]:oo.shadow.reference,color:Mq.reference,bg:Lq.reference,boxShadow:pU.reference,borderRadius:"md",minH:wk.reference,minW:Tk.reference,fontSize:Ck.reference,px:Rk.reference,_focusVisible:{[pU.variable]:"shadows.outline"}},tIe={lineHeight:1.2,overflow:"visible"},nIe={fontSize:"lg",w:"5",h:"5",transitionProperty:"common",transitionDuration:"normal",borderRadius:"full",marginStart:"1.5",marginEnd:"-1",opacity:.5,_disabled:{opacity:.4},_focusVisible:{boxShadow:"outline",bg:"rgba(0, 0, 0, 0.14)"},_hover:{opacity:.8},_active:{opacity:1}},rIe=By({container:eIe,label:tIe,closeButton:nIe}),iIe={sm:By({container:{[wk.variable]:"sizes.5",[Tk.variable]:"sizes.5",[Ck.variable]:"fontSizes.xs",[Rk.variable]:"space.2"},closeButton:{marginEnd:"-2px",marginStart:"0.35rem"}}),md:By({container:{[wk.variable]:"sizes.6",[Tk.variable]:"sizes.6",[Ck.variable]:"fontSizes.sm",[Rk.variable]:"space.2"}}),lg:By({container:{[wk.variable]:"sizes.8",[Tk.variable]:"sizes.8",[Ck.variable]:"fontSizes.md",[Rk.variable]:"space.3"}})},sIe={subtle:By(n=>{var e;return{container:(e=CC.variants)==null?void 0:e.subtle(n)}}),solid:By(n=>{var e;return{container:(e=CC.variants)==null?void 0:e.solid(n)}}),outline:By(n=>{var e;return{container:(e=CC.variants)==null?void 0:e.outline(n)}})},oIe=ZRe({variants:sIe,baseStyle:rIe,sizes:iIe,defaultProps:{size:"md",variant:"subtle",colorScheme:"gray"}});var jZ;const aIe={...(jZ=_i.baseStyle)==null?void 0:jZ.field,paddingY:"2",minHeight:"20",lineHeight:"short",verticalAlign:"top"};var BZ;const cIe={outline:n=>{var e;return((e=_i.variants)==null?void 0:e.outline(n).field)??{}},flushed:n=>{var e;return((e=_i.variants)==null?void 0:e.flushed(n).field)??{}},filled:n=>{var e;return((e=_i.variants)==null?void 0:e.filled(n).field)??{}},unstyled:((BZ=_i.variants)==null?void 0:BZ.unstyled.field)??{}};var zZ,WZ,GZ,HZ;const lIe={xs:((zZ=_i.sizes)==null?void 0:zZ.xs.field)??{},sm:((WZ=_i.sizes)==null?void 0:WZ.sm.field)??{},md:((GZ=_i.sizes)==null?void 0:GZ.md.field)??{},lg:((HZ=_i.sizes)==null?void 0:HZ.lg.field)??{}},uIe={baseStyle:aIe,sizes:lIe,variants:cIe,defaultProps:{size:"md",variant:"outline"}},W1=zo("tooltip-bg"),fU=zo("tooltip-fg"),dIe=zo("popper-arrow-bg"),hIe={bg:W1.reference,color:fU.reference,[W1.variable]:"colors.gray.700",[fU.variable]:"colors.whiteAlpha.900",_dark:{[W1.variable]:"colors.gray.300",[fU.variable]:"colors.gray.900"},[dIe.variable]:W1.reference,px:"2",py:"0.5",borderRadius:"sm",fontWeight:"medium",fontSize:"sm",boxShadow:"md",maxW:"xs",zIndex:"tooltip"},pIe={baseStyle:hIe},fIe={Accordion:ZSe,Alert:Mbe,Avatar:Kbe,Badge:CC,Breadcrumb:rwe,Button:hwe,Checkbox:_g,CloseButton:Iwe,Code:Owe,Container:Dwe,Divider:Vwe,Drawer:Ywe,Editable:nTe,Form:cTe,FormError:fTe,FormLabel:gTe,Heading:ETe,Input:_i,Kbd:PTe,Link:OTe,List:MTe,Menu:KTe,Modal:iCe,NumberInput:pCe,PinInput:_Ce,Popover:ACe,Progress:MCe,Radio:BCe,Select:qCe,Skeleton:XCe,SkipLink:QCe,Slider:lRe,Spinner:hRe,Stat:vRe,Switch:kRe,Table:URe,Tabs:QRe,Tag:oIe,Textarea:uIe,Tooltip:pIe,Card:_we,Stepper:wRe},mIe={none:0,"1px":"1px solid","2px":"2px solid","4px":"4px solid","8px":"8px solid"},gIe={base:"0em",sm:"30em",md:"48em",lg:"62em",xl:"80em","2xl":"96em"},_Ie={transparent:"transparent",current:"currentColor",black:"#000000",white:"#FFFFFF",whiteAlpha:{50:"rgba(255, 255, 255, 0.04)",100:"rgba(255, 255, 255, 0.06)",200:"rgba(255, 255, 255, 0.08)",300:"rgba(255, 255, 255, 0.16)",400:"rgba(255, 255, 255, 0.24)",500:"rgba(255, 255, 255, 0.36)",600:"rgba(255, 255, 255, 0.48)",700:"rgba(255, 255, 255, 0.64)",800:"rgba(255, 255, 255, 0.80)",900:"rgba(255, 255, 255, 0.92)"},blackAlpha:{50:"rgba(0, 0, 0, 0.04)",100:"rgba(0, 0, 0, 0.06)",200:"rgba(0, 0, 0, 0.08)",300:"rgba(0, 0, 0, 0.16)",400:"rgba(0, 0, 0, 0.24)",500:"rgba(0, 0, 0, 0.36)",600:"rgba(0, 0, 0, 0.48)",700:"rgba(0, 0, 0, 0.64)",800:"rgba(0, 0, 0, 0.80)",900:"rgba(0, 0, 0, 0.92)"},gray:{50:"#F7FAFC",100:"#EDF2F7",200:"#E2E8F0",300:"#CBD5E0",400:"#A0AEC0",500:"#718096",600:"#4A5568",700:"#2D3748",800:"#1A202C",900:"#171923"},red:{50:"#FFF5F5",100:"#FED7D7",200:"#FEB2B2",300:"#FC8181",400:"#F56565",500:"#E53E3E",600:"#C53030",700:"#9B2C2C",800:"#822727",900:"#63171B"},orange:{50:"#FFFAF0",100:"#FEEBC8",200:"#FBD38D",300:"#F6AD55",400:"#ED8936",500:"#DD6B20",600:"#C05621",700:"#9C4221",800:"#7B341E",900:"#652B19"},yellow:{50:"#FFFFF0",100:"#FEFCBF",200:"#FAF089",300:"#F6E05E",400:"#ECC94B",500:"#D69E2E",600:"#B7791F",700:"#975A16",800:"#744210",900:"#5F370E"},green:{50:"#F0FFF4",100:"#C6F6D5",200:"#9AE6B4",300:"#68D391",400:"#48BB78",500:"#38A169",600:"#2F855A",700:"#276749",800:"#22543D",900:"#1C4532"},teal:{50:"#E6FFFA",100:"#B2F5EA",200:"#81E6D9",300:"#4FD1C5",400:"#38B2AC",500:"#319795",600:"#2C7A7B",700:"#285E61",800:"#234E52",900:"#1D4044"},blue:{50:"#ebf8ff",100:"#bee3f8",200:"#90cdf4",300:"#63b3ed",400:"#4299e1",500:"#3182ce",600:"#2b6cb0",700:"#2c5282",800:"#2a4365",900:"#1A365D"},cyan:{50:"#EDFDFD",100:"#C4F1F9",200:"#9DECF9",300:"#76E4F7",400:"#0BC5EA",500:"#00B5D8",600:"#00A3C4",700:"#0987A0",800:"#086F83",900:"#065666"},purple:{50:"#FAF5FF",100:"#E9D8FD",200:"#D6BCFA",300:"#B794F4",400:"#9F7AEA",500:"#805AD5",600:"#6B46C1",700:"#553C9A",800:"#44337A",900:"#322659"},pink:{50:"#FFF5F7",100:"#FED7E2",200:"#FBB6CE",300:"#F687B3",400:"#ED64A6",500:"#D53F8C",600:"#B83280",700:"#97266D",800:"#702459",900:"#521B41"}},yIe={none:"0",sm:"0.125rem",base:"0.25rem",md:"0.375rem",lg:"0.5rem",xl:"0.75rem","2xl":"1rem","3xl":"1.5rem",full:"9999px"},EIe={xs:"0 0 0 1px rgba(0, 0, 0, 0.05)",sm:"0 1px 2px 0 rgba(0, 0, 0, 0.05)",base:"0 1px 3px 0 rgba(0, 0, 0, 0.1), 0 1px 2px 0 rgba(0, 0, 0, 0.06)",md:"0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06)",lg:"0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05)",xl:"0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04)","2xl":"0 25px 50px -12px rgba(0, 0, 0, 0.25)",outline:"0 0 0 3px rgba(66, 153, 225, 0.6)",inner:"inset 0 2px 4px 0 rgba(0,0,0,0.06)",none:"none","dark-lg":"rgba(0, 0, 0, 0.1) 0px 0px 0px 1px, rgba(0, 0, 0, 0.2) 0px 5px 10px, rgba(0, 0, 0, 0.4) 0px 15px 40px"},vIe={common:"background-color, border-color, color, fill, stroke, opacity, box-shadow, transform",colors:"background-color, border-color, color, fill, stroke",dimensions:"width, height",position:"left, right, top, bottom",background:"background-color, background-image, background-position"},SIe={"ease-in":"cubic-bezier(0.4, 0, 1, 1)","ease-out":"cubic-bezier(0, 0, 0.2, 1)","ease-in-out":"cubic-bezier(0.4, 0, 0.2, 1)"},bIe={"ultra-fast":"50ms",faster:"100ms",fast:"150ms",normal:"200ms",slow:"300ms",slower:"400ms","ultra-slow":"500ms"},wIe={property:vIe,easing:SIe,duration:bIe},TIe={hide:-1,auto:"auto",base:0,docked:10,dropdown:1e3,sticky:1100,banner:1200,overlay:1300,modal:1400,popover:1500,skipLink:1600,toast:1700,tooltip:1800},CIe={none:0,sm:"4px",base:"8px",md:"12px",lg:"16px",xl:"24px","2xl":"40px","3xl":"64px"},RIe={breakpoints:gIe,zIndices:TIe,radii:yIe,blur:CIe,colors:_Ie,...kee,sizes:Tee,shadows:EIe,space:wee,borders:mIe,transition:wIe},IIe={colors:{"chakra-body-text":{_light:"gray.800",_dark:"whiteAlpha.900"},"chakra-body-bg":{_light:"white",_dark:"gray.800"},"chakra-border-color":{_light:"gray.200",_dark:"whiteAlpha.300"},"chakra-inverse-text":{_light:"white",_dark:"gray.800"},"chakra-subtle-bg":{_light:"gray.100",_dark:"gray.700"},"chakra-subtle-text":{_light:"gray.600",_dark:"gray.400"},"chakra-placeholder-color":{_light:"gray.500",_dark:"whiteAlpha.400"}}},AIe={global:{body:{fontFamily:"body",color:"chakra-body-text",bg:"chakra-body-bg",transitionProperty:"background-color",transitionDuration:"normal",lineHeight:"base"},"*::placeholder":{color:"chakra-placeholder-color"},"*, *::before, &::after":{borderColor:"chakra-border-color"}}},PIe="ltr",kIe={useSystemColorMode:!1,initialColorMode:"light",cssVarPrefix:"chakra"},OIe={semanticTokens:IIe,direction:PIe,...RIe,components:fIe,styles:AIe,config:kIe};function NIe(n){if(n.sheet)return n.sheet;for(var e=0;e<document.styleSheets.length;e++)if(document.styleSheets[e].ownerNode===n)return document.styleSheets[e]}function DIe(n){var e=document.createElement("style");return e.setAttribute("data-emotion",n.key),n.nonce!==void 0&&e.setAttribute("nonce",n.nonce),e.appendChild(document.createTextNode("")),e.setAttribute("data-s",""),e}var xIe=function(){function n(i){var o=this;this._insertTag=function(l){var u;o.tags.length===0?o.insertionPoint?u=o.insertionPoint.nextSibling:o.prepend?u=o.container.firstChild:u=o.before:u=o.tags[o.tags.length-1].nextSibling,o.container.insertBefore(l,u),o.tags.push(l)},this.isSpeedy=i.speedy===void 0?!0:i.speedy,this.tags=[],this.ctr=0,this.nonce=i.nonce,this.key=i.key,this.container=i.container,this.prepend=i.prepend,this.insertionPoint=i.insertionPoint,this.before=null}var e=n.prototype;return e.hydrate=function(o){o.forEach(this._insertTag)},e.insert=function(o){this.ctr%(this.isSpeedy?65e3:1)===0&&this._insertTag(DIe(this));var l=this.tags[this.tags.length-1];if(this.isSpeedy){var u=NIe(l);try{u.insertRule(o,u.cssRules.length)}catch{}}else l.appendChild(document.createTextNode(o));this.ctr++},e.flush=function(){this.tags.forEach(function(o){var l;return(l=o.parentNode)==null?void 0:l.removeChild(o)}),this.tags=[],this.ctr=0},n}(),nc="-ms-",rO="-moz-",fi="-webkit-",xee="comm",aj="rule",cj="decl",LIe="@import",Lee="@keyframes",MIe="@layer",UIe=Math.abs,ZO=String.fromCharCode,VIe=Object.assign;function FIe(n,e){return Pa(n,0)^45?(((e<<2^Pa(n,0))<<2^Pa(n,1))<<2^Pa(n,2))<<2^Pa(n,3):0}function Mee(n){return n.trim()}function jIe(n,e){return(n=e.exec(n))?n[0]:n}function mi(n,e,i){return n.replace(e,i)}function AV(n,e){return n.indexOf(e)}function Pa(n,e){return n.charCodeAt(e)|0}function YC(n,e,i){return n.slice(e,i)}function up(n){return n.length}function lj(n){return n.length}function G1(n,e){return e.push(n),n}function BIe(n,e){return n.map(e).join("")}var eN=1,vS=1,Uee=0,vl=0,yo=0,HS="";function tN(n,e,i,o,l,u,p){return{value:n,root:e,parent:i,type:o,props:l,children:u,line:eN,column:vS,length:p,return:""}}function WT(n,e){return VIe(tN("",null,null,"",null,null,0),n,{length:-n.length},e)}function zIe(){return yo}function WIe(){return yo=vl>0?Pa(HS,--vl):0,vS--,yo===10&&(vS=1,eN--),yo}function ru(){return yo=vl<Uee?Pa(HS,vl++):0,vS++,yo===10&&(vS=1,eN++),yo}function wp(){return Pa(HS,vl)}function Ik(){return vl}function CR(n,e){return YC(HS,n,e)}function XC(n){switch(n){case 0:case 9:case 10:case 13:case 32:return 5;case 33:case 43:case 44:case 47:case 62:case 64:case 126:case 59:case 123:case 125:return 4;case 58:return 3;case 34:case 39:case 40:case 91:return 2;case 41:case 93:return 1}return 0}function Vee(n){return eN=vS=1,Uee=up(HS=n),vl=0,[]}function Fee(n){return HS="",n}function Ak(n){return Mee(CR(vl-1,PV(n===91?n+2:n===40?n+1:n)))}function GIe(n){for(;(yo=wp())&&yo<33;)ru();return XC(n)>2||XC(yo)>3?"":" "}function HIe(n,e){for(;--e&&ru()&&!(yo<48||yo>102||yo>57&&yo<65||yo>70&&yo<97););return CR(n,Ik()+(e<6&&wp()==32&&ru()==32))}function PV(n){for(;ru();)switch(yo){case n:return vl;case 34:case 39:n!==34&&n!==39&&PV(yo);break;case 40:n===41&&PV(n);break;case 92:ru();break}return vl}function $Ie(n,e){for(;ru()&&n+yo!==57;)if(n+yo===84&&wp()===47)break;return"/*"+CR(e,vl-1)+"*"+ZO(n===47?n:ru())}function KIe(n){for(;!XC(wp());)ru();return CR(n,vl)}function qIe(n){return Fee(Pk("",null,null,null,[""],n=Vee(n),0,[0],n))}function Pk(n,e,i,o,l,u,p,y,v){for(var w=0,C=0,R=p,N=0,M=0,L=0,U=1,z=1,J=1,q=0,re="",ce=l,ae=u,pe=o,H=re;z;)switch(L=q,q=ru()){case 40:if(L!=108&&Pa(H,R-1)==58){AV(H+=mi(Ak(q),"&","&\f"),"&\f")!=-1&&(J=-1);break}case 34:case 39:case 91:H+=Ak(q);break;case 9:case 10:case 13:case 32:H+=GIe(L);break;case 92:H+=HIe(Ik()-1,7);continue;case 47:switch(wp()){case 42:case 47:G1(YIe($Ie(ru(),Ik()),e,i),v);break;default:H+="/"}break;case 123*U:y[w++]=up(H)*J;case 125*U:case 59:case 0:switch(q){case 0:case 125:z=0;case 59+C:J==-1&&(H=mi(H,/\f/g,"")),M>0&&up(H)-R&&G1(M>32?Vq(H+";",o,i,R-1):Vq(mi(H," ","")+";",o,i,R-2),v);break;case 59:H+=";";default:if(G1(pe=Uq(H,e,i,w,C,l,y,re,ce=[],ae=[],R),u),q===123)if(C===0)Pk(H,e,pe,pe,ce,u,R,y,ae);else switch(N===99&&Pa(H,3)===110?100:N){case 100:case 108:case 109:case 115:Pk(n,pe,pe,o&&G1(Uq(n,pe,pe,0,0,l,y,re,l,ce=[],R),ae),l,ae,R,y,o?ce:ae);break;default:Pk(H,pe,pe,pe,[""],ae,0,y,ae)}}w=C=M=0,U=J=1,re=H="",R=p;break;case 58:R=1+up(H),M=L;default:if(U<1){if(q==123)--U;else if(q==125&&U++==0&&WIe()==125)continue}switch(H+=ZO(q),q*U){case 38:J=C>0?1:(H+="\f",-1);break;case 44:y[w++]=(up(H)-1)*J,J=1;break;case 64:wp()===45&&(H+=Ak(ru())),N=wp(),C=R=up(re=H+=KIe(Ik())),q++;break;case 45:L===45&&up(H)==2&&(U=0)}}return u}function Uq(n,e,i,o,l,u,p,y,v,w,C){for(var R=l-1,N=l===0?u:[""],M=lj(N),L=0,U=0,z=0;L<o;++L)for(var J=0,q=YC(n,R+1,R=UIe(U=p[L])),re=n;J<M;++J)(re=Mee(U>0?N[J]+" "+q:mi(q,/&\f/g,N[J])))&&(v[z++]=re);return tN(n,e,i,l===0?aj:y,v,w,C)}function YIe(n,e,i){return tN(n,e,i,xee,ZO(zIe()),YC(n,2,-2),0)}function Vq(n,e,i,o){return tN(n,e,i,cj,YC(n,0,o),YC(n,o+1,-1),o)}function rS(n,e){for(var i="",o=lj(n),l=0;l<o;l++)i+=e(n[l],l,n,e)||"";return i}function XIe(n,e,i,o){switch(n.type){case MIe:if(n.children.length)break;case LIe:case cj:return n.return=n.return||n.value;case xee:return"";case Lee:return n.return=n.value+"{"+rS(n.children,o)+"}";case aj:n.value=n.props.join(",")}return up(i=rS(n.children,o))?n.return=n.value+"{"+i+"}":""}function JIe(n){var e=lj(n);return function(i,o,l,u){for(var p="",y=0;y<e;y++)p+=n[y](i,o,l,u)||"";return p}}function QIe(n){return function(e){e.root||(e=e.return)&&n(e)}}var Fq=function(e){var i=new WeakMap;return function(o){if(i.has(o))return i.get(o);var l=e(o);return i.set(o,l),l}};function jee(n){var e=Object.create(null);return function(i){return e[i]===void 0&&(e[i]=n(i)),e[i]}}var ZIe=function(e,i,o){for(var l=0,u=0;l=u,u=wp(),l===38&&u===12&&(i[o]=1),!XC(u);)ru();return CR(e,vl)},eAe=function(e,i){var o=-1,l=44;do switch(XC(l)){case 0:l===38&&wp()===12&&(i[o]=1),e[o]+=ZIe(vl-1,i,o);break;case 2:e[o]+=Ak(l);break;case 4:if(l===44){e[++o]=wp()===58?"&\f":"",i[o]=e[o].length;break}default:e[o]+=ZO(l)}while(l=ru());return e},tAe=function(e,i){return Fee(eAe(Vee(e),i))},jq=new WeakMap,nAe=function(e){if(!(e.type!=="rule"||!e.parent||e.length<1)){for(var i=e.value,o=e.parent,l=e.column===o.column&&e.line===o.line;o.type!=="rule";)if(o=o.parent,!o)return;if(!(e.props.length===1&&i.charCodeAt(0)!==58&&!jq.get(o))&&!l){jq.set(e,!0);for(var u=[],p=tAe(i,u),y=o.props,v=0,w=0;v<p.length;v++)for(var C=0;C<y.length;C++,w++)e.props[w]=u[v]?p[v].replace(/&\f/g,y[C]):y[C]+" "+p[v]}}},rAe=function(e){if(e.type==="decl"){var i=e.value;i.charCodeAt(0)===108&&i.charCodeAt(2)===98&&(e.return="",e.value="")}};function Bee(n,e){switch(FIe(n,e)){case 5103:return fi+"print-"+n+n;case 5737:case 4201:case 3177:case 3433:case 1641:case 4457:case 2921:case 5572:case 6356:case 5844:case 3191:case 6645:case 3005:case 6391:case 5879:case 5623:case 6135:case 4599:case 4855:case 4215:case 6389:case 5109:case 5365:case 5621:case 3829:return fi+n+n;case 5349:case 4246:case 4810:case 6968:case 2756:return fi+n+rO+n+nc+n+n;case 6828:case 4268:return fi+n+nc+n+n;case 6165:return fi+n+nc+"flex-"+n+n;case 5187:return fi+n+mi(n,/(\w+).+(:[^]+)/,fi+"box-$1$2"+nc+"flex-$1$2")+n;case 5443:return fi+n+nc+"flex-item-"+mi(n,/flex-|-self/,"")+n;case 4675:return fi+n+nc+"flex-line-pack"+mi(n,/align-content|flex-|-self/,"")+n;case 5548:return fi+n+nc+mi(n,"shrink","negative")+n;case 5292:return fi+n+nc+mi(n,"basis","preferred-size")+n;case 6060:return fi+"box-"+mi(n,"-grow","")+fi+n+nc+mi(n,"grow","positive")+n;case 4554:return fi+mi(n,/([^-])(transform)/g,"$1"+fi+"$2")+n;case 6187:return mi(mi(mi(n,/(zoom-|grab)/,fi+"$1"),/(image-set)/,fi+"$1"),n,"")+n;case 5495:case 3959:return mi(n,/(image-set\([^]*)/,fi+"$1$`$1");case 4968:return mi(mi(n,/(.+:)(flex-)?(.*)/,fi+"box-pack:$3"+nc+"flex-pack:$3"),/s.+-b[^;]+/,"justify")+fi+n+n;case 4095:case 3583:case 4068:case 2532:return mi(n,/(.+)-inline(.+)/,fi+"$1$2")+n;case 8116:case 7059:case 5753:case 5535:case 5445:case 5701:case 4933:case 4677:case 5533:case 5789:case 5021:case 4765:if(up(n)-1-e>6)switch(Pa(n,e+1)){case 109:if(Pa(n,e+4)!==45)break;case 102:return mi(n,/(.+:)(.+)-([^]+)/,"$1"+fi+"$2-$3$1"+rO+(Pa(n,e+3)==108?"$3":"$2-$3"))+n;case 115:return~AV(n,"stretch")?Bee(mi(n,"stretch","fill-available"),e)+n:n}break;case 4949:if(Pa(n,e+1)!==115)break;case 6444:switch(Pa(n,up(n)-3-(~AV(n,"!important")&&10))){case 107:return mi(n,":",":"+fi)+n;case 101:return mi(n,/(.+:)([^;!]+)(;|!.+)?/,"$1"+fi+(Pa(n,14)===45?"inline-":"")+"box$3$1"+fi+"$2$3$1"+nc+"$2box$3")+n}break;case 5936:switch(Pa(n,e+11)){case 114:return fi+n+nc+mi(n,/[svh]\w+-[tblr]{2}/,"tb")+n;case 108:return fi+n+nc+mi(n,/[svh]\w+-[tblr]{2}/,"tb-rl")+n;case 45:return fi+n+nc+mi(n,/[svh]\w+-[tblr]{2}/,"lr")+n}return fi+n+nc+n+n}return n}var iAe=function(e,i,o,l){if(e.length>-1&&!e.return)switch(e.type){case cj:e.return=Bee(e.value,e.length);break;case Lee:return rS([WT(e,{value:mi(e.value,"@","@"+fi)})],l);case aj:if(e.length)return BIe(e.props,function(u){switch(jIe(u,/(::plac\w+|:read-\w+)/)){case":read-only":case":read-write":return rS([WT(e,{props:[mi(u,/:(read-\w+)/,":"+rO+"$1")]})],l);case"::placeholder":return rS([WT(e,{props:[mi(u,/:(plac\w+)/,":"+fi+"input-$1")]}),WT(e,{props:[mi(u,/:(plac\w+)/,":"+rO+"$1")]}),WT(e,{props:[mi(u,/:(plac\w+)/,nc+"input-$1")]})],l)}return""})}},sAe=[iAe],oAe=function(e){var i=e.key;if(i==="css"){var o=document.querySelectorAll("style[data-emotion]:not([data-s])");Array.prototype.forEach.call(o,function(U){var z=U.getAttribute("data-emotion");z.indexOf(" ")!==-1&&(document.head.appendChild(U),U.setAttribute("data-s",""))})}var l=e.stylisPlugins||sAe,u={},p,y=[];p=e.container||document.head,Array.prototype.forEach.call(document.querySelectorAll('style[data-emotion^="'+i+' "]'),function(U){for(var z=U.getAttribute("data-emotion").split(" "),J=1;J<z.length;J++)u[z[J]]=!0;y.push(U)});var v,w=[nAe,rAe];{var C,R=[XIe,QIe(function(U){C.insert(U)})],N=JIe(w.concat(l,R)),M=function(z){return rS(qIe(z),N)};v=function(z,J,q,re){C=q,M(z?z+"{"+J.styles+"}":J.styles),re&&(L.inserted[J.name]=!0)}}var L={key:i,sheet:new xIe({key:i,container:p,nonce:e.nonce,speedy:e.speedy,prepend:e.prepend,insertionPoint:e.insertionPoint}),nonce:e.nonce,inserted:u,registered:{},insert:v};return L.sheet.hydrate(y),L};function Jy(){return Jy=Object.assign?Object.assign.bind():function(n){for(var e=1;e<arguments.length;e++){var i=arguments[e];for(var o in i)({}).hasOwnProperty.call(i,o)&&(n[o]=i[o])}return n},Jy.apply(null,arguments)}var mU={exports:{}},Si={};/** @license React v16.13.1
 * react-is.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Bq;function aAe(){if(Bq)return Si;Bq=1;var n=typeof Symbol=="function"&&Symbol.for,e=n?Symbol.for("react.element"):60103,i=n?Symbol.for("react.portal"):60106,o=n?Symbol.for("react.fragment"):60107,l=n?Symbol.for("react.strict_mode"):60108,u=n?Symbol.for("react.profiler"):60114,p=n?Symbol.for("react.provider"):60109,y=n?Symbol.for("react.context"):60110,v=n?Symbol.for("react.async_mode"):60111,w=n?Symbol.for("react.concurrent_mode"):60111,C=n?Symbol.for("react.forward_ref"):60112,R=n?Symbol.for("react.suspense"):60113,N=n?Symbol.for("react.suspense_list"):60120,M=n?Symbol.for("react.memo"):60115,L=n?Symbol.for("react.lazy"):60116,U=n?Symbol.for("react.block"):60121,z=n?Symbol.for("react.fundamental"):60117,J=n?Symbol.for("react.responder"):60118,q=n?Symbol.for("react.scope"):60119;function re(ae){if(typeof ae=="object"&&ae!==null){var pe=ae.$$typeof;switch(pe){case e:switch(ae=ae.type,ae){case v:case w:case o:case u:case l:case R:return ae;default:switch(ae=ae&&ae.$$typeof,ae){case y:case C:case L:case M:case p:return ae;default:return pe}}case i:return pe}}}function ce(ae){return re(ae)===w}return Si.AsyncMode=v,Si.ConcurrentMode=w,Si.ContextConsumer=y,Si.ContextProvider=p,Si.Element=e,Si.ForwardRef=C,Si.Fragment=o,Si.Lazy=L,Si.Memo=M,Si.Portal=i,Si.Profiler=u,Si.StrictMode=l,Si.Suspense=R,Si.isAsyncMode=function(ae){return ce(ae)||re(ae)===v},Si.isConcurrentMode=ce,Si.isContextConsumer=function(ae){return re(ae)===y},Si.isContextProvider=function(ae){return re(ae)===p},Si.isElement=function(ae){return typeof ae=="object"&&ae!==null&&ae.$$typeof===e},Si.isForwardRef=function(ae){return re(ae)===C},Si.isFragment=function(ae){return re(ae)===o},Si.isLazy=function(ae){return re(ae)===L},Si.isMemo=function(ae){return re(ae)===M},Si.isPortal=function(ae){return re(ae)===i},Si.isProfiler=function(ae){return re(ae)===u},Si.isStrictMode=function(ae){return re(ae)===l},Si.isSuspense=function(ae){return re(ae)===R},Si.isValidElementType=function(ae){return typeof ae=="string"||typeof ae=="function"||ae===o||ae===w||ae===u||ae===l||ae===R||ae===N||typeof ae=="object"&&ae!==null&&(ae.$$typeof===L||ae.$$typeof===M||ae.$$typeof===p||ae.$$typeof===y||ae.$$typeof===C||ae.$$typeof===z||ae.$$typeof===J||ae.$$typeof===q||ae.$$typeof===U)},Si.typeOf=re,Si}var zq;function cAe(){return zq||(zq=1,mU.exports=aAe()),mU.exports}var gU,Wq;function lAe(){if(Wq)return gU;Wq=1;var n=cAe(),e={childContextTypes:!0,contextType:!0,contextTypes:!0,defaultProps:!0,displayName:!0,getDefaultProps:!0,getDerivedStateFromError:!0,getDerivedStateFromProps:!0,mixins:!0,propTypes:!0,type:!0},i={name:!0,length:!0,prototype:!0,caller:!0,callee:!0,arguments:!0,arity:!0},o={$$typeof:!0,render:!0,defaultProps:!0,displayName:!0,propTypes:!0},l={$$typeof:!0,compare:!0,defaultProps:!0,displayName:!0,propTypes:!0,type:!0},u={};u[n.ForwardRef]=o,u[n.Memo]=l;function p(L){return n.isMemo(L)?l:u[L.$$typeof]||e}var y=Object.defineProperty,v=Object.getOwnPropertyNames,w=Object.getOwnPropertySymbols,C=Object.getOwnPropertyDescriptor,R=Object.getPrototypeOf,N=Object.prototype;function M(L,U,z){if(typeof U!="string"){if(N){var J=R(U);J&&J!==N&&M(L,J,z)}var q=v(U);w&&(q=q.concat(w(U)));for(var re=p(L),ce=p(U),ae=0;ae<q.length;++ae){var pe=q[ae];if(!i[pe]&&!(z&&z[pe])&&!(ce&&ce[pe])&&!(re&&re[pe])){var H=C(U,pe);try{y(L,pe,H)}catch{}}}}return L}return gU=M,gU}var uAe=lAe();const dAe=$g(uAe);var hAe=!0;function zee(n,e,i){var o="";return i.split(" ").forEach(function(l){n[l]!==void 0?e.push(n[l]+";"):l&&(o+=l+" ")}),o}var uj=function(e,i,o){var l=e.key+"-"+i.name;(o===!1||hAe===!1)&&e.registered[l]===void 0&&(e.registered[l]=i.styles)},dj=function(e,i,o){uj(e,i,o);var l=e.key+"-"+i.name;if(e.inserted[i.name]===void 0){var u=i;do e.insert(i===u?"."+l:"",u,e.sheet,!0),u=u.next;while(u!==void 0)}};function pAe(n){for(var e=0,i,o=0,l=n.length;l>=4;++o,l-=4)i=n.charCodeAt(o)&255|(n.charCodeAt(++o)&255)<<8|(n.charCodeAt(++o)&255)<<16|(n.charCodeAt(++o)&255)<<24,i=(i&65535)*1540483477+((i>>>16)*59797<<16),i^=i>>>24,e=(i&65535)*1540483477+((i>>>16)*59797<<16)^(e&65535)*1540483477+((e>>>16)*59797<<16);switch(l){case 3:e^=(n.charCodeAt(o+2)&255)<<16;case 2:e^=(n.charCodeAt(o+1)&255)<<8;case 1:e^=n.charCodeAt(o)&255,e=(e&65535)*1540483477+((e>>>16)*59797<<16)}return e^=e>>>13,e=(e&65535)*1540483477+((e>>>16)*59797<<16),((e^e>>>15)>>>0).toString(36)}var fAe={animationIterationCount:1,aspectRatio:1,borderImageOutset:1,borderImageSlice:1,borderImageWidth:1,boxFlex:1,boxFlexGroup:1,boxOrdinalGroup:1,columnCount:1,columns:1,flex:1,flexGrow:1,flexPositive:1,flexShrink:1,flexNegative:1,flexOrder:1,gridRow:1,gridRowEnd:1,gridRowSpan:1,gridRowStart:1,gridColumn:1,gridColumnEnd:1,gridColumnSpan:1,gridColumnStart:1,msGridRow:1,msGridRowSpan:1,msGridColumn:1,msGridColumnSpan:1,fontWeight:1,lineHeight:1,opacity:1,order:1,orphans:1,scale:1,tabSize:1,widows:1,zIndex:1,zoom:1,WebkitLineClamp:1,fillOpacity:1,floodOpacity:1,stopOpacity:1,strokeDasharray:1,strokeDashoffset:1,strokeMiterlimit:1,strokeOpacity:1,strokeWidth:1},mAe=/[A-Z]|^ms/g,gAe=/_EMO_([^_]+?)_([^]*?)_EMO_/g,Wee=function(e){return e.charCodeAt(1)===45},Gq=function(e){return e!=null&&typeof e!="boolean"},_U=jee(function(n){return Wee(n)?n:n.replace(mAe,"-$&").toLowerCase()}),Hq=function(e,i){switch(e){case"animation":case"animationName":if(typeof i=="string")return i.replace(gAe,function(o,l,u){return dp={name:l,styles:u,next:dp},l})}return fAe[e]!==1&&!Wee(e)&&typeof i=="number"&&i!==0?i+"px":i};function JC(n,e,i){if(i==null)return"";var o=i;if(o.__emotion_styles!==void 0)return o;switch(typeof i){case"boolean":return"";case"object":{var l=i;if(l.anim===1)return dp={name:l.name,styles:l.styles,next:dp},l.name;var u=i;if(u.styles!==void 0){var p=u.next;if(p!==void 0)for(;p!==void 0;)dp={name:p.name,styles:p.styles,next:dp},p=p.next;var y=u.styles+";";return y}return _Ae(n,e,i)}case"function":{if(n!==void 0){var v=dp,w=i(n);return dp=v,JC(n,e,w)}break}}var C=i;if(e==null)return C;var R=e[C];return R!==void 0?R:C}function _Ae(n,e,i){var o="";if(Array.isArray(i))for(var l=0;l<i.length;l++)o+=JC(n,e,i[l])+";";else for(var u in i){var p=i[u];if(typeof p!="object"){var y=p;e!=null&&e[y]!==void 0?o+=u+"{"+e[y]+"}":Gq(y)&&(o+=_U(u)+":"+Hq(u,y)+";")}else if(Array.isArray(p)&&typeof p[0]=="string"&&(e==null||e[p[0]]===void 0))for(var v=0;v<p.length;v++)Gq(p[v])&&(o+=_U(u)+":"+Hq(u,p[v])+";");else{var w=JC(n,e,p);switch(u){case"animation":case"animationName":{o+=_U(u)+":"+w+";";break}default:o+=u+"{"+w+"}"}}}return o}var $q=/label:\s*([^\s;{]+)\s*(;|$)/g,dp;function nN(n,e,i){if(n.length===1&&typeof n[0]=="object"&&n[0]!==null&&n[0].styles!==void 0)return n[0];var o=!0,l="";dp=void 0;var u=n[0];if(u==null||u.raw===void 0)o=!1,l+=JC(i,e,u);else{var p=u;l+=p[0]}for(var y=1;y<n.length;y++)if(l+=JC(i,e,n[y]),o){var v=u;l+=v[y]}$q.lastIndex=0;for(var w="",C;(C=$q.exec(l))!==null;)w+="-"+C[1];var R=pAe(l)+w;return{name:R,styles:l,next:dp}}var yAe=function(e){return e()},Gee=nq.useInsertionEffect?nq.useInsertionEffect:!1,Hee=Gee||yAe,Kq=Gee||O.useLayoutEffect,hj=O.createContext(typeof HTMLElement<"u"?oAe({key:"css"}):null);hj.Provider;var EAe=function(){return O.useContext(hj)},pj=function(e){return O.forwardRef(function(i,o){var l=O.useContext(hj);return e(i,l,o)})},SS=O.createContext({}),vAe=function(e,i){if(typeof i=="function"){var o=i(e);return o}return Jy({},e,i)},SAe=Fq(function(n){return Fq(function(e){return vAe(n,e)})}),bAe=function(e){var i=O.useContext(SS);return e.theme!==i&&(i=SAe(i)(e.theme)),O.createElement(SS.Provider,{value:i},e.children)},fj={}.hasOwnProperty,kV="__EMOTION_TYPE_PLEASE_DO_NOT_USE__",wAe=function(e,i){var o={};for(var l in i)fj.call(i,l)&&(o[l]=i[l]);return o[kV]=e,o},TAe=function(e){var i=e.cache,o=e.serialized,l=e.isStringTag;return uj(i,o,l),Hee(function(){return dj(i,o,l)}),null},CAe=pj(function(n,e,i){var o=n.css;typeof o=="string"&&e.registered[o]!==void 0&&(o=e.registered[o]);var l=n[kV],u=[o],p="";typeof n.className=="string"?p=zee(e.registered,u,n.className):n.className!=null&&(p=n.className+" ");var y=nN(u,void 0,O.useContext(SS));p+=e.key+"-"+y.name;var v={};for(var w in n)fj.call(n,w)&&w!=="css"&&w!==kV&&(v[w]=n[w]);return v.className=p,i&&(v.ref=i),O.createElement(O.Fragment,null,O.createElement(TAe,{cache:e,serialized:y,isStringTag:typeof l=="string"}),O.createElement(l,v))}),RAe=CAe,qq=function(e,i){var o=arguments;if(i==null||!fj.call(i,"css"))return O.createElement.apply(void 0,o);var l=o.length,u=new Array(l);u[0]=RAe,u[1]=wAe(e,i);for(var p=2;p<l;p++)u[p]=o[p];return O.createElement.apply(null,u)};(function(n){var e;e||(e=n.JSX||(n.JSX={}))})(qq||(qq={}));var rN=pj(function(n,e){var i=n.styles,o=nN([i],void 0,O.useContext(SS)),l=O.useRef();return Kq(function(){var u=e.key+"-global",p=new e.sheet.constructor({key:u,nonce:e.sheet.nonce,container:e.sheet.container,speedy:e.sheet.isSpeedy}),y=!1,v=document.querySelector('style[data-emotion="'+u+" "+o.name+'"]');return e.sheet.tags.length&&(p.before=e.sheet.tags[0]),v!==null&&(y=!0,v.setAttribute("data-emotion",u),p.hydrate([v])),l.current=[p,y],function(){p.flush()}},[e]),Kq(function(){var u=l.current,p=u[0],y=u[1];if(y){u[1]=!1;return}if(o.next!==void 0&&dj(e,o.next,!0),p.tags.length){var v=p.tags[p.tags.length-1].nextElementSibling;p.before=v,p.flush()}e.insert("",o,p,!1)},[e,o.name]),null});function IAe(){for(var n=arguments.length,e=new Array(n),i=0;i<n;i++)e[i]=arguments[i];return nN(e)}function RR(){var n=IAe.apply(void 0,arguments),e="animation-"+n.name;return{name:e,styles:"@keyframes "+e+"{"+n.styles+"}",anim:1,toString:function(){return"_EMO_"+this.name+"_"+this.styles+"_EMO_"}}}const mj=O.createContext({});mj.displayName="ColorModeContext";function iN(){const n=O.useContext(mj);if(n===void 0)throw new Error("useColorMode must be used within a ColorModeProvider");return n}function Cg(n,e){const{colorMode:i}=iN();return i==="dark"?e:n}const H1={light:"chakra-ui-light",dark:"chakra-ui-dark"};function AAe(n={}){const{preventTransition:e=!0,nonce:i}=n,o={setDataset:l=>{const u=e?o.preventTransition():void 0;document.documentElement.dataset.theme=l,document.documentElement.style.colorScheme=l,u==null||u()},setClassName(l){document.body.classList.add(l?H1.dark:H1.light),document.body.classList.remove(l?H1.light:H1.dark)},query(){return window.matchMedia("(prefers-color-scheme: dark)")},getSystemTheme(l){return o.query().matches??l==="dark"?"dark":"light"},addListener(l){const u=o.query(),p=y=>{l(y.matches?"dark":"light")};return typeof u.addListener=="function"?u.addListener(p):u.addEventListener("change",p),()=>{typeof u.removeListener=="function"?u.removeListener(p):u.removeEventListener("change",p)}},preventTransition(){const l=document.createElement("style");return l.appendChild(document.createTextNode("*{-webkit-transition:none!important;-moz-transition:none!important;-o-transition:none!important;-ms-transition:none!important;transition:none!important}")),i!==void 0&&(l.nonce=i),document.head.appendChild(l),()=>{window.getComputedStyle(document.body),requestAnimationFrame(()=>{requestAnimationFrame(()=>{document.head.removeChild(l)})})}}};return o}const PAe="chakra-ui-color-mode";function kAe(n){return{ssr:!1,type:"localStorage",get(e){if(!(globalThis!=null&&globalThis.document))return e;let i;try{i=localStorage.getItem(n)||e}catch{}return i||e},set(e){try{localStorage.setItem(n,e)}catch{}}}}const OAe=kAe(PAe),Yq=()=>{},NAe=qEe()?O.useLayoutEffect:O.useEffect;function Xq(n,e){return n.type==="cookie"&&n.ssr?n.get(e):e}const $ee=function(e){const{value:i,children:o,options:{useSystemColorMode:l,initialColorMode:u,disableTransitionOnChange:p}={},colorModeManager:y=OAe}=e,v=EAe(),w=u==="dark"?"dark":"light",[C,R]=O.useState(()=>Xq(y,w)),[N,M]=O.useState(()=>Xq(y)),{getSystemTheme:L,setClassName:U,setDataset:z,addListener:J}=O.useMemo(()=>AAe({preventTransition:p,nonce:v==null?void 0:v.nonce}),[p,v==null?void 0:v.nonce]),q=u==="system"&&!C?N:C,re=O.useCallback(pe=>{const H=pe==="system"?L():pe;R(H),U(H==="dark"),z(H),y.set(H)},[y,L,U,z]);NAe(()=>{u==="system"&&M(L())},[]),O.useEffect(()=>{const pe=y.get();if(pe){re(pe);return}if(u==="system"){re("system");return}re(w)},[y,w,u,re]);const ce=O.useCallback(()=>{re(q==="dark"?"light":"dark")},[q,re]);O.useEffect(()=>{if(l)return J(re)},[l,J,re]);const ae=O.useMemo(()=>({colorMode:i??q,toggleColorMode:i?Yq:ce,setColorMode:i?Yq:re,forced:i!==void 0}),[q,ce,re,i]);return S.jsx(mj.Provider,{value:ae,children:o})};$ee.displayName="ColorModeProvider";const Kee=String.raw,qee=Kee`
  :root,
  :host {
    --chakra-vh: 100vh;
  }

  @supports (height: -webkit-fill-available) {
    :root,
    :host {
      --chakra-vh: -webkit-fill-available;
    }
  }

  @supports (height: -moz-fill-available) {
    :root,
    :host {
      --chakra-vh: -moz-fill-available;
    }
  }

  @supports (height: 100dvh) {
    :root,
    :host {
      --chakra-vh: 100dvh;
    }
  }
`,DAe=()=>S.jsx(rN,{styles:qee}),xAe=({scope:n=""})=>S.jsx(rN,{styles:Kee`
      html {
        line-height: 1.5;
        -webkit-text-size-adjust: 100%;
        font-family: system-ui, sans-serif;
        -webkit-font-smoothing: antialiased;
        text-rendering: optimizeLegibility;
        -moz-osx-font-smoothing: grayscale;
        touch-action: manipulation;
      }

      body {
        position: relative;
        min-height: 100%;
        margin: 0;
        font-feature-settings: "kern";
      }

      ${n} :where(*, *::before, *::after) {
        border-width: 0;
        border-style: solid;
        box-sizing: border-box;
        word-wrap: break-word;
      }

      main {
        display: block;
      }

      ${n} hr {
        border-top-width: 1px;
        box-sizing: content-box;
        height: 0;
        overflow: visible;
      }

      ${n} :where(pre, code, kbd,samp) {
        font-family: SFMono-Regular, Menlo, Monaco, Consolas, monospace;
        font-size: 1em;
      }

      ${n} a {
        background-color: transparent;
        color: inherit;
        text-decoration: inherit;
      }

      ${n} abbr[title] {
        border-bottom: none;
        text-decoration: underline;
        -webkit-text-decoration: underline dotted;
        text-decoration: underline dotted;
      }

      ${n} :where(b, strong) {
        font-weight: bold;
      }

      ${n} small {
        font-size: 80%;
      }

      ${n} :where(sub,sup) {
        font-size: 75%;
        line-height: 0;
        position: relative;
        vertical-align: baseline;
      }

      ${n} sub {
        bottom: -0.25em;
      }

      ${n} sup {
        top: -0.5em;
      }

      ${n} img {
        border-style: none;
      }

      ${n} :where(button, input, optgroup, select, textarea) {
        font-family: inherit;
        font-size: 100%;
        line-height: 1.15;
        margin: 0;
      }

      ${n} :where(button, input) {
        overflow: visible;
      }

      ${n} :where(button, select) {
        text-transform: none;
      }

      ${n} :where(
          button::-moz-focus-inner,
          [type="button"]::-moz-focus-inner,
          [type="reset"]::-moz-focus-inner,
          [type="submit"]::-moz-focus-inner
        ) {
        border-style: none;
        padding: 0;
      }

      ${n} fieldset {
        padding: 0.35em 0.75em 0.625em;
      }

      ${n} legend {
        box-sizing: border-box;
        color: inherit;
        display: table;
        max-width: 100%;
        padding: 0;
        white-space: normal;
      }

      ${n} progress {
        vertical-align: baseline;
      }

      ${n} textarea {
        overflow: auto;
      }

      ${n} :where([type="checkbox"], [type="radio"]) {
        box-sizing: border-box;
        padding: 0;
      }

      ${n} input[type="number"]::-webkit-inner-spin-button,
      ${n} input[type="number"]::-webkit-outer-spin-button {
        -webkit-appearance: none !important;
      }

      ${n} input[type="number"] {
        -moz-appearance: textfield;
      }

      ${n} input[type="search"] {
        -webkit-appearance: textfield;
        outline-offset: -2px;
      }

      ${n} input[type="search"]::-webkit-search-decoration {
        -webkit-appearance: none !important;
      }

      ${n} ::-webkit-file-upload-button {
        -webkit-appearance: button;
        font: inherit;
      }

      ${n} details {
        display: block;
      }

      ${n} summary {
        display: list-item;
      }

      template {
        display: none;
      }

      [hidden] {
        display: none !important;
      }

      ${n} :where(
          blockquote,
          dl,
          dd,
          h1,
          h2,
          h3,
          h4,
          h5,
          h6,
          hr,
          figure,
          p,
          pre
        ) {
        margin: 0;
      }

      ${n} button {
        background: transparent;
        padding: 0;
      }

      ${n} fieldset {
        margin: 0;
        padding: 0;
      }

      ${n} :where(ol, ul) {
        margin: 0;
        padding: 0;
      }

      ${n} textarea {
        resize: vertical;
      }

      ${n} :where(button, [role="button"]) {
        cursor: pointer;
      }

      ${n} button::-moz-focus-inner {
        border: 0 !important;
      }

      ${n} table {
        border-collapse: collapse;
      }

      ${n} :where(h1, h2, h3, h4, h5, h6) {
        font-size: inherit;
        font-weight: inherit;
      }

      ${n} :where(button, input, optgroup, select, textarea) {
        padding: 0;
        line-height: inherit;
        color: inherit;
      }

      ${n} :where(img, svg, video, canvas, audio, iframe, embed, object) {
        display: block;
      }

      ${n} :where(img, video) {
        max-width: 100%;
        height: auto;
      }

      [data-js-focus-visible]
        :focus:not([data-focus-visible-added]):not(
          [data-focus-visible-disabled]
        ) {
        outline: none;
        box-shadow: none;
      }

      ${n} select::-ms-expand {
        display: none;
      }

      ${qee}
    `});function LAe(n){const{cssVarsRoot:e,theme:i,children:o}=n,l=O.useMemo(()=>vSe(i),[i]);return S.jsxs(bAe,{theme:l,children:[S.jsx(MAe,{root:e}),o]})}function MAe({root:n=":host, :root"}){const e=[n,"[data-theme]"].join(",");return S.jsx(rN,{styles:i=>({[e]:i.__cssVars})})}ki({name:"StylesContext",errorMessage:"useStyles: `styles` is undefined. Seems you forgot to wrap the components in `<StylesProvider />` "});function UAe(){const{colorMode:n}=iN();return S.jsx(rN,{styles:e=>{const i=tee(e,"styles.global"),o=pl(i,{theme:e,colorMode:n});return o?Eee(o)(e):void 0}})}const[VAe,FAe]=ki({strict:!1,name:"PortalManagerContext"});function gj(n){const{children:e,zIndex:i}=n;return S.jsx(VAe,{value:{zIndex:i},children:e})}gj.displayName="PortalManager";const _j=O.createContext({getDocument(){return document},getWindow(){return window}});_j.displayName="EnvironmentContext";function jAe({defer:n}={}){const[,e]=O.useReducer(i=>i+1,0);return Sp(()=>{n&&e()},[n]),O.useContext(_j)}function Yee(n){const{children:e,environment:i,disabled:o}=n,l=O.useRef(null),u=O.useMemo(()=>i||{getDocument:()=>{var y;return((y=l.current)==null?void 0:y.ownerDocument)??document},getWindow:()=>{var y;return((y=l.current)==null?void 0:y.ownerDocument.defaultView)??window}},[i]),p=!o||!i;return S.jsxs(_j.Provider,{value:u,children:[e,p&&S.jsx("span",{id:"__chakra_env",hidden:!0,ref:l})]})}Yee.displayName="EnvironmentProvider";const BAe=n=>{const{children:e,colorModeManager:i,portalZIndex:o,resetScope:l,resetCSS:u=!0,theme:p={},environment:y,cssVarsRoot:v,disableEnvironment:w,disableGlobalStyle:C}=n,R=S.jsx(Yee,{environment:y,disabled:w,children:e});return S.jsx(LAe,{theme:p,cssVarsRoot:v,children:S.jsxs($ee,{colorModeManager:i,options:p.config,children:[u?S.jsx(xAe,{scope:l}):S.jsx(DAe,{}),!C&&S.jsx(UAe,{}),o?S.jsx(gj,{zIndex:o,children:R}):R]})})},yj=O.createContext({});function Ej(n){const e=O.useRef(null);return e.current===null&&(e.current=n()),e.current}const IR=O.createContext(null),vj=O.createContext({transformPagePoint:n=>n,isStatic:!1,reducedMotion:"never"});class zAe extends O.Component{getSnapshotBeforeUpdate(e){const i=this.props.childRef.current;if(i&&e.isPresent&&!this.props.isPresent){const o=this.props.sizeRef.current;o.height=i.offsetHeight||0,o.width=i.offsetWidth||0,o.top=i.offsetTop,o.left=i.offsetLeft}return null}componentDidUpdate(){}render(){return this.props.children}}function WAe({children:n,isPresent:e}){const i=O.useId(),o=O.useRef(null),l=O.useRef({width:0,height:0,top:0,left:0}),{nonce:u}=O.useContext(vj);return O.useInsertionEffect(()=>{const{width:p,height:y,top:v,left:w}=l.current;if(e||!o.current||!p||!y)return;o.current.dataset.motionPopId=i;const C=document.createElement("style");return u&&(C.nonce=u),document.head.appendChild(C),C.sheet&&C.sheet.insertRule(`
          [data-motion-pop-id="${i}"] {
            position: absolute !important;
            width: ${p}px !important;
            height: ${y}px !important;
            top: ${v}px !important;
            left: ${w}px !important;
          }
        `),()=>{document.head.removeChild(C)}},[e]),S.jsx(zAe,{isPresent:e,childRef:o,sizeRef:l,children:O.cloneElement(n,{ref:o})})}const GAe=({children:n,initial:e,isPresent:i,onExitComplete:o,custom:l,presenceAffectsLayout:u,mode:p})=>{const y=Ej(HAe),v=O.useId(),w=O.useCallback(R=>{y.set(R,!0);for(const N of y.values())if(!N)return;o&&o()},[y,o]),C=O.useMemo(()=>({id:v,initial:e,isPresent:i,custom:l,onExitComplete:w,register:R=>(y.set(R,!1),()=>y.delete(R))}),u?[Math.random(),w]:[i,w]);return O.useMemo(()=>{y.forEach((R,N)=>y.set(N,!1))},[i]),O.useEffect(()=>{!i&&!y.size&&o&&o()},[i]),p==="popLayout"&&(n=S.jsx(WAe,{isPresent:i,children:n})),S.jsx(IR.Provider,{value:C,children:n})};function HAe(){return new Map}function Sj(n=!0){const e=O.useContext(IR);if(e===null)return[!0,null];const{isPresent:i,onExitComplete:o,register:l}=e,u=O.useId();O.useEffect(()=>{n&&l(u)},[n]);const p=O.useCallback(()=>n&&o&&o(u),[u,o,n]);return!i&&o?[!1,p]:[!0]}function $Ae(){return KAe(O.useContext(IR))}function KAe(n){return n===null?!0:n.isPresent}const $1=n=>n.key||"";function Jq(n){const e=[];return O.Children.forEach(n,i=>{O.isValidElement(i)&&e.push(i)}),e}const bj=typeof window<"u",Xee=bj?O.useLayoutEffect:O.useEffect,$S=({children:n,custom:e,initial:i=!0,onExitComplete:o,presenceAffectsLayout:l=!0,mode:u="sync",propagate:p=!1})=>{const[y,v]=Sj(p),w=O.useMemo(()=>Jq(n),[n]),C=p&&!y?[]:w.map($1),R=O.useRef(!0),N=O.useRef(w),M=Ej(()=>new Map),[L,U]=O.useState(w),[z,J]=O.useState(w);Xee(()=>{R.current=!1,N.current=w;for(let ce=0;ce<z.length;ce++){const ae=$1(z[ce]);C.includes(ae)?M.delete(ae):M.get(ae)!==!0&&M.set(ae,!1)}},[z,C.length,C.join("-")]);const q=[];if(w!==L){let ce=[...w];for(let ae=0;ae<z.length;ae++){const pe=z[ae],H=$1(pe);C.includes(H)||(ce.splice(ae,0,pe),q.push(pe))}u==="wait"&&q.length&&(ce=q),J(Jq(ce)),U(w);return}const{forceRender:re}=O.useContext(yj);return S.jsx(S.Fragment,{children:z.map(ce=>{const ae=$1(ce),pe=p&&!y?!1:w===z||C.includes(ae),H=()=>{if(M.has(ae))M.set(ae,!0);else return;let X=!0;M.forEach(Q=>{Q||(X=!1)}),X&&(re==null||re(),J(N.current),p&&(v==null||v()),o&&o())};return S.jsx(GAe,{isPresent:pe,initial:!R.current||i?void 0:!1,custom:pe?void 0:e,presenceAffectsLayout:l,mode:u,onExitComplete:pe?void 0:H,children:ce},ae)})})},iu=n=>n;let Jee=iu;function wj(n){let e;return()=>(e===void 0&&(e=n()),e)}const bS=(n,e,i)=>{const o=e-n;return o===0?1:(i-n)/o},xf=n=>n*1e3,Lf=n=>n/1e3,qAe={useManualTiming:!1};function YAe(n){let e=new Set,i=new Set,o=!1,l=!1;const u=new WeakSet;let p={delta:0,timestamp:0,isProcessing:!1};function y(w){u.has(w)&&(v.schedule(w),n()),w(p)}const v={schedule:(w,C=!1,R=!1)=>{const M=R&&o?e:i;return C&&u.add(w),M.has(w)||M.add(w),w},cancel:w=>{i.delete(w),u.delete(w)},process:w=>{if(p=w,o){l=!0;return}o=!0,[e,i]=[i,e],e.forEach(y),e.clear(),o=!1,l&&(l=!1,v.process(w))}};return v}const K1=["read","resolveKeyframes","update","preRender","render","postRender"],XAe=40;function Qee(n,e){let i=!1,o=!0;const l={delta:0,timestamp:0,isProcessing:!1},u=()=>i=!0,p=K1.reduce((J,q)=>(J[q]=YAe(u),J),{}),{read:y,resolveKeyframes:v,update:w,preRender:C,render:R,postRender:N}=p,M=()=>{const J=performance.now();i=!1,l.delta=o?1e3/60:Math.max(Math.min(J-l.timestamp,XAe),1),l.timestamp=J,l.isProcessing=!0,y.process(l),v.process(l),w.process(l),C.process(l),R.process(l),N.process(l),l.isProcessing=!1,i&&e&&(o=!1,n(M))},L=()=>{i=!0,o=!0,l.isProcessing||n(M)};return{schedule:K1.reduce((J,q)=>{const re=p[q];return J[q]=(ce,ae=!1,pe=!1)=>(i||L(),re.schedule(ce,ae,pe)),J},{}),cancel:J=>{for(let q=0;q<K1.length;q++)p[K1[q]].cancel(J)},state:l,steps:p}}const{schedule:cs,cancel:Lg,state:Ra,steps:yU}=Qee(typeof requestAnimationFrame<"u"?requestAnimationFrame:iu,!0),Zee=O.createContext({strict:!1}),Qq={animation:["animate","variants","whileHover","whileTap","exit","whileInView","whileFocus","whileDrag"],exit:["exit"],drag:["drag","dragControls"],focus:["whileFocus"],hover:["whileHover","onHoverStart","onHoverEnd"],tap:["whileTap","onTap","onTapStart","onTapCancel"],pan:["onPan","onPanStart","onPanSessionStart","onPanEnd"],inView:["whileInView","onViewportEnter","onViewportLeave"],layout:["layout","layoutId"]},wS={};for(const n in Qq)wS[n]={isEnabled:e=>Qq[n].some(i=>!!e[i])};function JAe(n){for(const e in n)wS[e]={...wS[e],...n[e]}}const QAe=new Set(["animate","exit","variants","initial","style","values","variants","transition","transformTemplate","custom","inherit","onBeforeLayoutMeasure","onAnimationStart","onAnimationComplete","onUpdate","onDragStart","onDrag","onDragEnd","onMeasureDragConstraints","onDirectionLock","onDragTransitionEnd","_dragX","_dragY","onHoverStart","onHoverEnd","onViewportEnter","onViewportLeave","globalTapTarget","ignoreStrict","viewport"]);function iO(n){return n.startsWith("while")||n.startsWith("drag")&&n!=="draggable"||n.startsWith("layout")||n.startsWith("onTap")||n.startsWith("onPan")||n.startsWith("onLayout")||QAe.has(n)}let ete=n=>!iO(n);function ZAe(n){n&&(ete=e=>e.startsWith("on")?!iO(e):n(e))}try{ZAe(require("@emotion/is-prop-valid").default)}catch{}function ePe(n,e,i){const o={};for(const l in n)l==="values"&&typeof n.values=="object"||(ete(l)||i===!0&&iO(l)||!e&&!iO(l)||n.draggable&&l.startsWith("onDrag"))&&(o[l]=n[l]);return o}function tPe(n){if(typeof Proxy>"u")return n;const e=new Map,i=(...o)=>n(...o);return new Proxy(i,{get:(o,l)=>l==="create"?n:(e.has(l)||e.set(l,n(l)),e.get(l))})}const sN=O.createContext({});function QC(n){return typeof n=="string"||Array.isArray(n)}function oN(n){return n!==null&&typeof n=="object"&&typeof n.start=="function"}const Tj=["animate","whileInView","whileFocus","whileHover","whileTap","whileDrag","exit"],Cj=["initial",...Tj];function aN(n){return oN(n.animate)||Cj.some(e=>QC(n[e]))}function tte(n){return!!(aN(n)||n.variants)}function nPe(n,e){if(aN(n)){const{initial:i,animate:o}=n;return{initial:i===!1||QC(i)?i:void 0,animate:QC(o)?o:void 0}}return n.inherit!==!1?e:{}}function rPe(n){const{initial:e,animate:i}=nPe(n,O.useContext(sN));return O.useMemo(()=>({initial:e,animate:i}),[Zq(e),Zq(i)])}function Zq(n){return Array.isArray(n)?n.join(" "):n}const iPe=Symbol.for("motionComponentSymbol");function G0(n){return n&&typeof n=="object"&&Object.prototype.hasOwnProperty.call(n,"current")}function sPe(n,e,i){return O.useCallback(o=>{o&&n.onMount&&n.onMount(o),e&&(o?e.mount(o):e.unmount()),i&&(typeof i=="function"?i(o):G0(i)&&(i.current=o))},[e])}const Rj=n=>n.replace(/([a-z])([A-Z])/gu,"$1-$2").toLowerCase(),oPe="framerAppearId",nte="data-"+Rj(oPe),{schedule:Ij}=Qee(queueMicrotask,!1),rte=O.createContext({});function aPe(n,e,i,o,l){var u,p;const{visualElement:y}=O.useContext(sN),v=O.useContext(Zee),w=O.useContext(IR),C=O.useContext(vj).reducedMotion,R=O.useRef(null);o=o||v.renderer,!R.current&&o&&(R.current=o(n,{visualState:e,parent:y,props:i,presenceContext:w,blockInitialAnimation:w?w.initial===!1:!1,reducedMotionConfig:C}));const N=R.current,M=O.useContext(rte);N&&!N.projection&&l&&(N.type==="html"||N.type==="svg")&&cPe(R.current,i,l,M);const L=O.useRef(!1);O.useInsertionEffect(()=>{N&&L.current&&N.update(i,w)});const U=i[nte],z=O.useRef(!!U&&!(!((u=window.MotionHandoffIsComplete)===null||u===void 0)&&u.call(window,U))&&((p=window.MotionHasOptimisedAnimation)===null||p===void 0?void 0:p.call(window,U)));return Xee(()=>{N&&(L.current=!0,window.MotionIsMounted=!0,N.updateFeatures(),Ij.render(N.render),z.current&&N.animationState&&N.animationState.animateChanges())}),O.useEffect(()=>{N&&(!z.current&&N.animationState&&N.animationState.animateChanges(),z.current&&(queueMicrotask(()=>{var J;(J=window.MotionHandoffMarkAsComplete)===null||J===void 0||J.call(window,U)}),z.current=!1))}),N}function cPe(n,e,i,o){const{layoutId:l,layout:u,drag:p,dragConstraints:y,layoutScroll:v,layoutRoot:w}=e;n.projection=new i(n.latestValues,e["data-framer-portal-id"]?void 0:ite(n.parent)),n.projection.setOptions({layoutId:l,layout:u,alwaysMeasureLayout:!!p||y&&G0(y),visualElement:n,animationType:typeof u=="string"?u:"both",initialPromotionConfig:o,layoutScroll:v,layoutRoot:w})}function ite(n){if(n)return n.options.allowProjection!==!1?n.projection:ite(n.parent)}function lPe({preloadedFeatures:n,createVisualElement:e,useRender:i,useVisualState:o,Component:l}){var u,p;n&&JAe(n);function y(w,C){let R;const N={...O.useContext(vj),...w,layoutId:uPe(w)},{isStatic:M}=N,L=rPe(w),U=o(w,M);if(!M&&bj){dPe();const z=hPe(N);R=z.MeasureLayout,L.visualElement=aPe(l,U,N,e,z.ProjectionNode)}return S.jsxs(sN.Provider,{value:L,children:[R&&L.visualElement?S.jsx(R,{visualElement:L.visualElement,...N}):null,i(l,w,sPe(U,L.visualElement,C),U,M,L.visualElement)]})}y.displayName=`motion.${typeof l=="string"?l:`create(${(p=(u=l.displayName)!==null&&u!==void 0?u:l.name)!==null&&p!==void 0?p:""})`}`;const v=O.forwardRef(y);return v[iPe]=l,v}function uPe({layoutId:n}){const e=O.useContext(yj).id;return e&&n!==void 0?e+"-"+n:n}function dPe(n,e){O.useContext(Zee).strict}function hPe(n){const{drag:e,layout:i}=wS;if(!e&&!i)return{};const o={...e,...i};return{MeasureLayout:e!=null&&e.isEnabled(n)||i!=null&&i.isEnabled(n)?o.MeasureLayout:void 0,ProjectionNode:o.ProjectionNode}}const pPe=["animate","circle","defs","desc","ellipse","g","image","line","filter","marker","mask","metadata","path","pattern","polygon","polyline","rect","stop","switch","symbol","svg","text","tspan","use","view"];function Aj(n){return typeof n!="string"||n.includes("-")?!1:!!(pPe.indexOf(n)>-1||/[A-Z]/u.test(n))}function eY(n){const e=[{},{}];return n==null||n.values.forEach((i,o)=>{e[0][o]=i.get(),e[1][o]=i.getVelocity()}),e}function Pj(n,e,i,o){if(typeof e=="function"){const[l,u]=eY(o);e=e(i!==void 0?i:n.custom,l,u)}if(typeof e=="string"&&(e=n.variants&&n.variants[e]),typeof e=="function"){const[l,u]=eY(o);e=e(i!==void 0?i:n.custom,l,u)}return e}const OV=n=>Array.isArray(n),fPe=n=>!!(n&&typeof n=="object"&&n.mix&&n.toValue),mPe=n=>OV(n)?n[n.length-1]||0:n,oc=n=>!!(n&&n.getVelocity);function kk(n){const e=oc(n)?n.get():n;return fPe(e)?e.toValue():e}function gPe({scrapeMotionValuesFromProps:n,createRenderState:e,onUpdate:i},o,l,u){const p={latestValues:_Pe(o,l,u,n),renderState:e()};return i&&(p.onMount=y=>i({props:o,current:y,...p}),p.onUpdate=y=>i(y)),p}const ste=n=>(e,i)=>{const o=O.useContext(sN),l=O.useContext(IR),u=()=>gPe(n,e,o,l);return i?u():Ej(u)};function _Pe(n,e,i,o){const l={},u=o(n,{});for(const N in u)l[N]=kk(u[N]);let{initial:p,animate:y}=n;const v=aN(n),w=tte(n);e&&w&&!v&&n.inherit!==!1&&(p===void 0&&(p=e.initial),y===void 0&&(y=e.animate));let C=i?i.initial===!1:!1;C=C||p===!1;const R=C?y:p;if(R&&typeof R!="boolean"&&!oN(R)){const N=Array.isArray(R)?R:[R];for(let M=0;M<N.length;M++){const L=Pj(n,N[M]);if(L){const{transitionEnd:U,transition:z,...J}=L;for(const q in J){let re=J[q];if(Array.isArray(re)){const ce=C?re.length-1:0;re=re[ce]}re!==null&&(l[q]=re)}for(const q in U)l[q]=U[q]}}}return l}const KS=["transformPerspective","x","y","z","translateX","translateY","translateZ","scale","scaleX","scaleY","rotate","rotateX","rotateY","rotateZ","skew","skewX","skewY"],lE=new Set(KS),ote=n=>e=>typeof e=="string"&&e.startsWith(n),ate=ote("--"),yPe=ote("var(--"),kj=n=>yPe(n)?EPe.test(n.split("/*")[0].trim()):!1,EPe=/var\(--(?:[\w-]+\s*|[\w-]+\s*,(?:\s*[^)(\s]|\s*\((?:[^)(]|\([^)(]*\))*\))+\s*)\)$/iu,cte=(n,e)=>e&&typeof n=="number"?e.transform(n):n,zf=(n,e,i)=>i>e?e:i<n?n:i,qS={test:n=>typeof n=="number",parse:parseFloat,transform:n=>n},ZC={...qS,transform:n=>zf(0,1,n)},q1={...qS,default:1},AR=n=>({test:e=>typeof e=="string"&&e.endsWith(n)&&e.split(" ").length===1,parse:parseFloat,transform:e=>`${e}${n}`}),gg=AR("deg"),Tp=AR("%"),$n=AR("px"),vPe=AR("vh"),SPe=AR("vw"),tY={...Tp,parse:n=>Tp.parse(n)/100,transform:n=>Tp.transform(n*100)},bPe={borderWidth:$n,borderTopWidth:$n,borderRightWidth:$n,borderBottomWidth:$n,borderLeftWidth:$n,borderRadius:$n,radius:$n,borderTopLeftRadius:$n,borderTopRightRadius:$n,borderBottomRightRadius:$n,borderBottomLeftRadius:$n,width:$n,maxWidth:$n,height:$n,maxHeight:$n,top:$n,right:$n,bottom:$n,left:$n,padding:$n,paddingTop:$n,paddingRight:$n,paddingBottom:$n,paddingLeft:$n,margin:$n,marginTop:$n,marginRight:$n,marginBottom:$n,marginLeft:$n,backgroundPositionX:$n,backgroundPositionY:$n},wPe={rotate:gg,rotateX:gg,rotateY:gg,rotateZ:gg,scale:q1,scaleX:q1,scaleY:q1,scaleZ:q1,skew:gg,skewX:gg,skewY:gg,distance:$n,translateX:$n,translateY:$n,translateZ:$n,x:$n,y:$n,z:$n,perspective:$n,transformPerspective:$n,opacity:ZC,originX:tY,originY:tY,originZ:$n},nY={...qS,transform:Math.round},Oj={...bPe,...wPe,zIndex:nY,size:$n,fillOpacity:ZC,strokeOpacity:ZC,numOctaves:nY},TPe={x:"translateX",y:"translateY",z:"translateZ",transformPerspective:"perspective"},CPe=KS.length;function RPe(n,e,i){let o="",l=!0;for(let u=0;u<CPe;u++){const p=KS[u],y=n[p];if(y===void 0)continue;let v=!0;if(typeof y=="number"?v=y===(p.startsWith("scale")?1:0):v=parseFloat(y)===0,!v||i){const w=cte(y,Oj[p]);if(!v){l=!1;const C=TPe[p]||p;o+=`${C}(${w}) `}i&&(e[p]=w)}}return o=o.trim(),i?o=i(e,l?"":o):l&&(o="none"),o}function Nj(n,e,i){const{style:o,vars:l,transformOrigin:u}=n;let p=!1,y=!1;for(const v in e){const w=e[v];if(lE.has(v)){p=!0;continue}else if(ate(v)){l[v]=w;continue}else{const C=cte(w,Oj[v]);v.startsWith("origin")?(y=!0,u[v]=C):o[v]=C}}if(e.transform||(p||i?o.transform=RPe(e,n.transform,i):o.transform&&(o.transform="none")),y){const{originX:v="50%",originY:w="50%",originZ:C=0}=u;o.transformOrigin=`${v} ${w} ${C}`}}const IPe={offset:"stroke-dashoffset",array:"stroke-dasharray"},APe={offset:"strokeDashoffset",array:"strokeDasharray"};function PPe(n,e,i=1,o=0,l=!0){n.pathLength=1;const u=l?IPe:APe;n[u.offset]=$n.transform(-o);const p=$n.transform(e),y=$n.transform(i);n[u.array]=`${p} ${y}`}function rY(n,e,i){return typeof n=="string"?n:$n.transform(e+i*n)}function kPe(n,e,i){const o=rY(e,n.x,n.width),l=rY(i,n.y,n.height);return`${o} ${l}`}function Dj(n,{attrX:e,attrY:i,attrScale:o,originX:l,originY:u,pathLength:p,pathSpacing:y=1,pathOffset:v=0,...w},C,R){if(Nj(n,w,R),C){n.style.viewBox&&(n.attrs.viewBox=n.style.viewBox);return}n.attrs=n.style,n.style={};const{attrs:N,style:M,dimensions:L}=n;N.transform&&(L&&(M.transform=N.transform),delete N.transform),L&&(l!==void 0||u!==void 0||M.transform)&&(M.transformOrigin=kPe(L,l!==void 0?l:.5,u!==void 0?u:.5)),e!==void 0&&(N.x=e),i!==void 0&&(N.y=i),o!==void 0&&(N.scale=o),p!==void 0&&PPe(N,p,y,v,!1)}const xj=()=>({style:{},transform:{},transformOrigin:{},vars:{}}),lte=()=>({...xj(),attrs:{}}),Lj=n=>typeof n=="string"&&n.toLowerCase()==="svg";function ute(n,{style:e,vars:i},o,l){Object.assign(n.style,e,l&&l.getProjectionStyles(o));for(const u in i)n.style.setProperty(u,i[u])}const dte=new Set(["baseFrequency","diffuseConstant","kernelMatrix","kernelUnitLength","keySplines","keyTimes","limitingConeAngle","markerHeight","markerWidth","numOctaves","targetX","targetY","surfaceScale","specularConstant","specularExponent","stdDeviation","tableValues","viewBox","gradientTransform","pathLength","startOffset","textLength","lengthAdjust"]);function hte(n,e,i,o){ute(n,e,void 0,o);for(const l in e.attrs)n.setAttribute(dte.has(l)?l:Rj(l),e.attrs[l])}const sO={};function OPe(n){Object.assign(sO,n)}function pte(n,{layout:e,layoutId:i}){return lE.has(n)||n.startsWith("origin")||(e||i!==void 0)&&(!!sO[n]||n==="opacity")}function Mj(n,e,i){var o;const{style:l}=n,u={};for(const p in l)(oc(l[p])||e.style&&oc(e.style[p])||pte(p,n)||((o=i==null?void 0:i.getValue(p))===null||o===void 0?void 0:o.liveStyle)!==void 0)&&(u[p]=l[p]);return u}function fte(n,e,i){const o=Mj(n,e,i);for(const l in n)if(oc(n[l])||oc(e[l])){const u=KS.indexOf(l)!==-1?"attr"+l.charAt(0).toUpperCase()+l.substring(1):l;o[u]=n[l]}return o}function NPe(n,e){try{e.dimensions=typeof n.getBBox=="function"?n.getBBox():n.getBoundingClientRect()}catch{e.dimensions={x:0,y:0,width:0,height:0}}}const iY=["x","y","width","height","cx","cy","r"],DPe={useVisualState:ste({scrapeMotionValuesFromProps:fte,createRenderState:lte,onUpdate:({props:n,prevProps:e,current:i,renderState:o,latestValues:l})=>{if(!i)return;let u=!!n.drag;if(!u){for(const y in l)if(lE.has(y)){u=!0;break}}if(!u)return;let p=!e;if(e)for(let y=0;y<iY.length;y++){const v=iY[y];n[v]!==e[v]&&(p=!0)}p&&cs.read(()=>{NPe(i,o),cs.render(()=>{Dj(o,l,Lj(i.tagName),n.transformTemplate),hte(i,o)})})}})},xPe={useVisualState:ste({scrapeMotionValuesFromProps:Mj,createRenderState:xj})};function mte(n,e,i){for(const o in e)!oc(e[o])&&!pte(o,i)&&(n[o]=e[o])}function LPe({transformTemplate:n},e){return O.useMemo(()=>{const i=xj();return Nj(i,e,n),Object.assign({},i.vars,i.style)},[e])}function MPe(n,e){const i=n.style||{},o={};return mte(o,i,n),Object.assign(o,LPe(n,e)),o}function UPe(n,e){const i={},o=MPe(n,e);return n.drag&&n.dragListener!==!1&&(i.draggable=!1,o.userSelect=o.WebkitUserSelect=o.WebkitTouchCallout="none",o.touchAction=n.drag===!0?"none":`pan-${n.drag==="x"?"y":"x"}`),n.tabIndex===void 0&&(n.onTap||n.onTapStart||n.whileTap)&&(i.tabIndex=0),i.style=o,i}function VPe(n,e,i,o){const l=O.useMemo(()=>{const u=lte();return Dj(u,e,Lj(o),n.transformTemplate),{...u.attrs,style:{...u.style}}},[e]);if(n.style){const u={};mte(u,n.style,n),l.style={...u,...l.style}}return l}function FPe(n=!1){return(i,o,l,{latestValues:u},p)=>{const v=(Aj(i)?VPe:UPe)(o,u,p,i),w=ePe(o,typeof i=="string",n),C=i!==O.Fragment?{...w,...v,ref:l}:{},{children:R}=o,N=O.useMemo(()=>oc(R)?R.get():R,[R]);return O.createElement(i,{...C,children:N})}}function jPe(n,e){return function(o,{forwardMotionProps:l}={forwardMotionProps:!1}){const p={...Aj(o)?DPe:xPe,preloadedFeatures:n,useRender:FPe(l),createVisualElement:e,Component:o};return lPe(p)}}function gte(n,e){if(!Array.isArray(e))return!1;const i=e.length;if(i!==n.length)return!1;for(let o=0;o<i;o++)if(e[o]!==n[o])return!1;return!0}function cN(n,e,i){const o=n.getProps();return Pj(o,e,i!==void 0?i:o.custom,n)}const BPe=wj(()=>window.ScrollTimeline!==void 0);class zPe{constructor(e){this.stop=()=>this.runAll("stop"),this.animations=e.filter(Boolean)}get finished(){return Promise.all(this.animations.map(e=>"finished"in e?e.finished:e))}getAll(e){return this.animations[0][e]}setAll(e,i){for(let o=0;o<this.animations.length;o++)this.animations[o][e]=i}attachTimeline(e,i){const o=this.animations.map(l=>{if(BPe()&&l.attachTimeline)return l.attachTimeline(e);if(typeof i=="function")return i(l)});return()=>{o.forEach((l,u)=>{l&&l(),this.animations[u].stop()})}}get time(){return this.getAll("time")}set time(e){this.setAll("time",e)}get speed(){return this.getAll("speed")}set speed(e){this.setAll("speed",e)}get startTime(){return this.getAll("startTime")}get duration(){let e=0;for(let i=0;i<this.animations.length;i++)e=Math.max(e,this.animations[i].duration);return e}runAll(e){this.animations.forEach(i=>i[e]())}flatten(){this.runAll("flatten")}play(){this.runAll("play")}pause(){this.runAll("pause")}cancel(){this.runAll("cancel")}complete(){this.runAll("complete")}}class WPe extends zPe{then(e,i){return Promise.all(this.animations).then(e).catch(i)}}function Uj(n,e){return n?n[e]||n.default||n:void 0}const NV=2e4;function _te(n){let e=0;const i=50;let o=n.next(e);for(;!o.done&&e<NV;)e+=i,o=n.next(e);return e>=NV?1/0:e}function Vj(n){return typeof n=="function"}function sY(n,e){n.timeline=e,n.onfinish=null}const Fj=n=>Array.isArray(n)&&typeof n[0]=="number",GPe={linearEasing:void 0};function HPe(n,e){const i=wj(n);return()=>{var o;return(o=GPe[e])!==null&&o!==void 0?o:i()}}const oO=HPe(()=>{try{document.createElement("div").animate({opacity:0},{easing:"linear(0, 1)"})}catch{return!1}return!0},"linearEasing"),yte=(n,e,i=10)=>{let o="";const l=Math.max(Math.round(e/i),2);for(let u=0;u<l;u++)o+=n(bS(0,l-1,u))+", ";return`linear(${o.substring(0,o.length-2)})`};function Ete(n){return!!(typeof n=="function"&&oO()||!n||typeof n=="string"&&(n in DV||oO())||Fj(n)||Array.isArray(n)&&n.every(Ete))}const uC=([n,e,i,o])=>`cubic-bezier(${n}, ${e}, ${i}, ${o})`,DV={linear:"linear",ease:"ease",easeIn:"ease-in",easeOut:"ease-out",easeInOut:"ease-in-out",circIn:uC([0,.65,.55,1]),circOut:uC([.55,0,1,.45]),backIn:uC([.31,.01,.66,-.59]),backOut:uC([.33,1.53,.69,.99])};function vte(n,e){if(n)return typeof n=="function"&&oO()?yte(n,e):Fj(n)?uC(n):Array.isArray(n)?n.map(i=>vte(i,e)||DV.easeOut):DV[n]}const ih={x:!1,y:!1};function Ste(){return ih.x||ih.y}function $Pe(n,e,i){var o;if(n instanceof Element)return[n];if(typeof n=="string"){let l=document;const u=(o=void 0)!==null&&o!==void 0?o:l.querySelectorAll(n);return u?Array.from(u):[]}return Array.from(n)}function bte(n,e){const i=$Pe(n),o=new AbortController,l={passive:!0,...e,signal:o.signal};return[i,l,()=>o.abort()]}function oY(n){return e=>{e.pointerType==="touch"||Ste()||n(e)}}function KPe(n,e,i={}){const[o,l,u]=bte(n,i),p=oY(y=>{const{target:v}=y,w=e(y);if(typeof w!="function"||!v)return;const C=oY(R=>{w(R),v.removeEventListener("pointerleave",C)});v.addEventListener("pointerleave",C,l)});return o.forEach(y=>{y.addEventListener("pointerenter",p,l)}),u}const wte=(n,e)=>e?n===e?!0:wte(n,e.parentElement):!1,jj=n=>n.pointerType==="mouse"?typeof n.button!="number"||n.button<=0:n.isPrimary!==!1,qPe=new Set(["BUTTON","INPUT","SELECT","TEXTAREA","A"]);function YPe(n){return qPe.has(n.tagName)||n.tabIndex!==-1}const dC=new WeakSet;function aY(n){return e=>{e.key==="Enter"&&n(e)}}function EU(n,e){n.dispatchEvent(new PointerEvent("pointer"+e,{isPrimary:!0,bubbles:!0}))}const XPe=(n,e)=>{const i=n.currentTarget;if(!i)return;const o=aY(()=>{if(dC.has(i))return;EU(i,"down");const l=aY(()=>{EU(i,"up")}),u=()=>EU(i,"cancel");i.addEventListener("keyup",l,e),i.addEventListener("blur",u,e)});i.addEventListener("keydown",o,e),i.addEventListener("blur",()=>i.removeEventListener("keydown",o),e)};function cY(n){return jj(n)&&!Ste()}function JPe(n,e,i={}){const[o,l,u]=bte(n,i),p=y=>{const v=y.currentTarget;if(!cY(y)||dC.has(v))return;dC.add(v);const w=e(y),C=(M,L)=>{window.removeEventListener("pointerup",R),window.removeEventListener("pointercancel",N),!(!cY(M)||!dC.has(v))&&(dC.delete(v),typeof w=="function"&&w(M,{success:L}))},R=M=>{C(M,i.useGlobalTarget||wte(v,M.target))},N=M=>{C(M,!1)};window.addEventListener("pointerup",R,l),window.addEventListener("pointercancel",N,l)};return o.forEach(y=>{!YPe(y)&&y.getAttribute("tabindex")===null&&(y.tabIndex=0),(i.useGlobalTarget?window:y).addEventListener("pointerdown",p,l),y.addEventListener("focus",w=>XPe(w,l),l)}),u}function QPe(n){return n==="x"||n==="y"?ih[n]?null:(ih[n]=!0,()=>{ih[n]=!1}):ih.x||ih.y?null:(ih.x=ih.y=!0,()=>{ih.x=ih.y=!1})}const Tte=new Set(["width","height","top","left","right","bottom",...KS]);let Ok;function ZPe(){Ok=void 0}const Cp={now:()=>(Ok===void 0&&Cp.set(Ra.isProcessing||qAe.useManualTiming?Ra.timestamp:performance.now()),Ok),set:n=>{Ok=n,queueMicrotask(ZPe)}};function Bj(n,e){n.indexOf(e)===-1&&n.push(e)}function zj(n,e){const i=n.indexOf(e);i>-1&&n.splice(i,1)}class Wj{constructor(){this.subscriptions=[]}add(e){return Bj(this.subscriptions,e),()=>zj(this.subscriptions,e)}notify(e,i,o){const l=this.subscriptions.length;if(l)if(l===1)this.subscriptions[0](e,i,o);else for(let u=0;u<l;u++){const p=this.subscriptions[u];p&&p(e,i,o)}}getSize(){return this.subscriptions.length}clear(){this.subscriptions.length=0}}function Cte(n,e){return e?n*(1e3/e):0}const lY=30,e1e=n=>!isNaN(parseFloat(n));class t1e{constructor(e,i={}){this.version="11.18.2",this.canTrackVelocity=null,this.events={},this.updateAndNotify=(o,l=!0)=>{const u=Cp.now();this.updatedAt!==u&&this.setPrevFrameValue(),this.prev=this.current,this.setCurrent(o),this.current!==this.prev&&this.events.change&&this.events.change.notify(this.current),l&&this.events.renderRequest&&this.events.renderRequest.notify(this.current)},this.hasAnimated=!1,this.setCurrent(e),this.owner=i.owner}setCurrent(e){this.current=e,this.updatedAt=Cp.now(),this.canTrackVelocity===null&&e!==void 0&&(this.canTrackVelocity=e1e(this.current))}setPrevFrameValue(e=this.current){this.prevFrameValue=e,this.prevUpdatedAt=this.updatedAt}onChange(e){return this.on("change",e)}on(e,i){this.events[e]||(this.events[e]=new Wj);const o=this.events[e].add(i);return e==="change"?()=>{o(),cs.read(()=>{this.events.change.getSize()||this.stop()})}:o}clearListeners(){for(const e in this.events)this.events[e].clear()}attach(e,i){this.passiveEffect=e,this.stopPassiveEffect=i}set(e,i=!0){!i||!this.passiveEffect?this.updateAndNotify(e,i):this.passiveEffect(e,this.updateAndNotify)}setWithVelocity(e,i,o){this.set(i),this.prev=void 0,this.prevFrameValue=e,this.prevUpdatedAt=this.updatedAt-o}jump(e,i=!0){this.updateAndNotify(e),this.prev=e,this.prevUpdatedAt=this.prevFrameValue=void 0,i&&this.stop(),this.stopPassiveEffect&&this.stopPassiveEffect()}get(){return this.current}getPrevious(){return this.prev}getVelocity(){const e=Cp.now();if(!this.canTrackVelocity||this.prevFrameValue===void 0||e-this.updatedAt>lY)return 0;const i=Math.min(this.updatedAt-this.prevUpdatedAt,lY);return Cte(parseFloat(this.current)-parseFloat(this.prevFrameValue),i)}start(e){return this.stop(),new Promise(i=>{this.hasAnimated=!0,this.animation=e(i),this.events.animationStart&&this.events.animationStart.notify()}).then(()=>{this.events.animationComplete&&this.events.animationComplete.notify(),this.clearAnimation()})}stop(){this.animation&&(this.animation.stop(),this.events.animationCancel&&this.events.animationCancel.notify()),this.clearAnimation()}isAnimating(){return!!this.animation}clearAnimation(){delete this.animation}destroy(){this.clearListeners(),this.stop(),this.stopPassiveEffect&&this.stopPassiveEffect()}}function eR(n,e){return new t1e(n,e)}function n1e(n,e,i){n.hasValue(e)?n.getValue(e).set(i):n.addValue(e,eR(i))}function r1e(n,e){const i=cN(n,e);let{transitionEnd:o={},transition:l={},...u}=i||{};u={...u,...o};for(const p in u){const y=mPe(u[p]);n1e(n,p,y)}}function i1e(n){return!!(oc(n)&&n.add)}function xV(n,e){const i=n.getValue("willChange");if(i1e(i))return i.add(e)}function Rte(n){return n.props[nte]}const Ite=(n,e,i)=>(((1-3*i+3*e)*n+(3*i-6*e))*n+3*e)*n,s1e=1e-7,o1e=12;function a1e(n,e,i,o,l){let u,p,y=0;do p=e+(i-e)/2,u=Ite(p,o,l)-n,u>0?i=p:e=p;while(Math.abs(u)>s1e&&++y<o1e);return p}function PR(n,e,i,o){if(n===e&&i===o)return iu;const l=u=>a1e(u,0,1,n,i);return u=>u===0||u===1?u:Ite(l(u),e,o)}const Ate=n=>e=>e<=.5?n(2*e)/2:(2-n(2*(1-e)))/2,Pte=n=>e=>1-n(1-e),kte=PR(.33,1.53,.69,.99),Gj=Pte(kte),Ote=Ate(Gj),Nte=n=>(n*=2)<1?.5*Gj(n):.5*(2-Math.pow(2,-10*(n-1))),Hj=n=>1-Math.sin(Math.acos(n)),Dte=Pte(Hj),xte=Ate(Hj),Lte=n=>/^0[^.\s]+$/u.test(n);function c1e(n){return typeof n=="number"?n===0:n!==null?n==="none"||n==="0"||Lte(n):!0}const PC=n=>Math.round(n*1e5)/1e5,$j=/-?(?:\d+(?:\.\d+)?|\.\d+)/gu;function l1e(n){return n==null}const u1e=/^(?:#[\da-f]{3,8}|(?:rgb|hsl)a?\((?:-?[\d.]+%?[,\s]+){2}-?[\d.]+%?\s*(?:[,/]\s*)?(?:\b\d+(?:\.\d+)?|\.\d+)?%?\))$/iu,Kj=(n,e)=>i=>!!(typeof i=="string"&&u1e.test(i)&&i.startsWith(n)||e&&!l1e(i)&&Object.prototype.hasOwnProperty.call(i,e)),Mte=(n,e,i)=>o=>{if(typeof o!="string")return o;const[l,u,p,y]=o.match($j);return{[n]:parseFloat(l),[e]:parseFloat(u),[i]:parseFloat(p),alpha:y!==void 0?parseFloat(y):1}},d1e=n=>zf(0,255,n),vU={...qS,transform:n=>Math.round(d1e(n))},xy={test:Kj("rgb","red"),parse:Mte("red","green","blue"),transform:({red:n,green:e,blue:i,alpha:o=1})=>"rgba("+vU.transform(n)+", "+vU.transform(e)+", "+vU.transform(i)+", "+PC(ZC.transform(o))+")"};function h1e(n){let e="",i="",o="",l="";return n.length>5?(e=n.substring(1,3),i=n.substring(3,5),o=n.substring(5,7),l=n.substring(7,9)):(e=n.substring(1,2),i=n.substring(2,3),o=n.substring(3,4),l=n.substring(4,5),e+=e,i+=i,o+=o,l+=l),{red:parseInt(e,16),green:parseInt(i,16),blue:parseInt(o,16),alpha:l?parseInt(l,16)/255:1}}const LV={test:Kj("#"),parse:h1e,transform:xy.transform},H0={test:Kj("hsl","hue"),parse:Mte("hue","saturation","lightness"),transform:({hue:n,saturation:e,lightness:i,alpha:o=1})=>"hsla("+Math.round(n)+", "+Tp.transform(PC(e))+", "+Tp.transform(PC(i))+", "+PC(ZC.transform(o))+")"},rc={test:n=>xy.test(n)||LV.test(n)||H0.test(n),parse:n=>xy.test(n)?xy.parse(n):H0.test(n)?H0.parse(n):LV.parse(n),transform:n=>typeof n=="string"?n:n.hasOwnProperty("red")?xy.transform(n):H0.transform(n)},p1e=/(?:#[\da-f]{3,8}|(?:rgb|hsl)a?\((?:-?[\d.]+%?[,\s]+){2}-?[\d.]+%?\s*(?:[,/]\s*)?(?:\b\d+(?:\.\d+)?|\.\d+)?%?\))/giu;function f1e(n){var e,i;return isNaN(n)&&typeof n=="string"&&(((e=n.match($j))===null||e===void 0?void 0:e.length)||0)+(((i=n.match(p1e))===null||i===void 0?void 0:i.length)||0)>0}const Ute="number",Vte="color",m1e="var",g1e="var(",uY="${}",_1e=/var\s*\(\s*--(?:[\w-]+\s*|[\w-]+\s*,(?:\s*[^)(\s]|\s*\((?:[^)(]|\([^)(]*\))*\))+\s*)\)|#[\da-f]{3,8}|(?:rgb|hsl)a?\((?:-?[\d.]+%?[,\s]+){2}-?[\d.]+%?\s*(?:[,/]\s*)?(?:\b\d+(?:\.\d+)?|\.\d+)?%?\)|-?(?:\d+(?:\.\d+)?|\.\d+)/giu;function tR(n){const e=n.toString(),i=[],o={color:[],number:[],var:[]},l=[];let u=0;const y=e.replace(_1e,v=>(rc.test(v)?(o.color.push(u),l.push(Vte),i.push(rc.parse(v))):v.startsWith(g1e)?(o.var.push(u),l.push(m1e),i.push(v)):(o.number.push(u),l.push(Ute),i.push(parseFloat(v))),++u,uY)).split(uY);return{values:i,split:y,indexes:o,types:l}}function Fte(n){return tR(n).values}function jte(n){const{split:e,types:i}=tR(n),o=e.length;return l=>{let u="";for(let p=0;p<o;p++)if(u+=e[p],l[p]!==void 0){const y=i[p];y===Ute?u+=PC(l[p]):y===Vte?u+=rc.transform(l[p]):u+=l[p]}return u}}const y1e=n=>typeof n=="number"?0:n;function E1e(n){const e=Fte(n);return jte(n)(e.map(y1e))}const Mg={test:f1e,parse:Fte,createTransformer:jte,getAnimatableNone:E1e},v1e=new Set(["brightness","contrast","saturate","opacity"]);function S1e(n){const[e,i]=n.slice(0,-1).split("(");if(e==="drop-shadow")return n;const[o]=i.match($j)||[];if(!o)return n;const l=i.replace(o,"");let u=v1e.has(e)?1:0;return o!==i&&(u*=100),e+"("+u+l+")"}const b1e=/\b([a-z-]*)\(.*?\)/gu,MV={...Mg,getAnimatableNone:n=>{const e=n.match(b1e);return e?e.map(S1e).join(" "):n}},w1e={...Oj,color:rc,backgroundColor:rc,outlineColor:rc,fill:rc,stroke:rc,borderColor:rc,borderTopColor:rc,borderRightColor:rc,borderBottomColor:rc,borderLeftColor:rc,filter:MV,WebkitFilter:MV},qj=n=>w1e[n];function Bte(n,e){let i=qj(n);return i!==MV&&(i=Mg),i.getAnimatableNone?i.getAnimatableNone(e):void 0}const T1e=new Set(["auto","none","0"]);function C1e(n,e,i){let o=0,l;for(;o<n.length&&!l;){const u=n[o];typeof u=="string"&&!T1e.has(u)&&tR(u).values.length&&(l=n[o]),o++}if(l&&i)for(const u of e)n[u]=Bte(i,l)}const dY=n=>n===qS||n===$n,hY=(n,e)=>parseFloat(n.split(", ")[e]),pY=(n,e)=>(i,{transform:o})=>{if(o==="none"||!o)return 0;const l=o.match(/^matrix3d\((.+)\)$/u);if(l)return hY(l[1],e);{const u=o.match(/^matrix\((.+)\)$/u);return u?hY(u[1],n):0}},R1e=new Set(["x","y","z"]),I1e=KS.filter(n=>!R1e.has(n));function A1e(n){const e=[];return I1e.forEach(i=>{const o=n.getValue(i);o!==void 0&&(e.push([i,o.get()]),o.set(i.startsWith("scale")?1:0))}),e}const TS={width:({x:n},{paddingLeft:e="0",paddingRight:i="0"})=>n.max-n.min-parseFloat(e)-parseFloat(i),height:({y:n},{paddingTop:e="0",paddingBottom:i="0"})=>n.max-n.min-parseFloat(e)-parseFloat(i),top:(n,{top:e})=>parseFloat(e),left:(n,{left:e})=>parseFloat(e),bottom:({y:n},{top:e})=>parseFloat(e)+(n.max-n.min),right:({x:n},{left:e})=>parseFloat(e)+(n.max-n.min),x:pY(4,13),y:pY(5,14)};TS.translateX=TS.x;TS.translateY=TS.y;const zy=new Set;let UV=!1,VV=!1;function zte(){if(VV){const n=Array.from(zy).filter(o=>o.needsMeasurement),e=new Set(n.map(o=>o.element)),i=new Map;e.forEach(o=>{const l=A1e(o);l.length&&(i.set(o,l),o.render())}),n.forEach(o=>o.measureInitialState()),e.forEach(o=>{o.render();const l=i.get(o);l&&l.forEach(([u,p])=>{var y;(y=o.getValue(u))===null||y===void 0||y.set(p)})}),n.forEach(o=>o.measureEndState()),n.forEach(o=>{o.suspendedScrollY!==void 0&&window.scrollTo(0,o.suspendedScrollY)})}VV=!1,UV=!1,zy.forEach(n=>n.complete()),zy.clear()}function Wte(){zy.forEach(n=>{n.readKeyframes(),n.needsMeasurement&&(VV=!0)})}function P1e(){Wte(),zte()}class Yj{constructor(e,i,o,l,u,p=!1){this.isComplete=!1,this.isAsync=!1,this.needsMeasurement=!1,this.isScheduled=!1,this.unresolvedKeyframes=[...e],this.onComplete=i,this.name=o,this.motionValue=l,this.element=u,this.isAsync=p}scheduleResolve(){this.isScheduled=!0,this.isAsync?(zy.add(this),UV||(UV=!0,cs.read(Wte),cs.resolveKeyframes(zte))):(this.readKeyframes(),this.complete())}readKeyframes(){const{unresolvedKeyframes:e,name:i,element:o,motionValue:l}=this;for(let u=0;u<e.length;u++)if(e[u]===null)if(u===0){const p=l==null?void 0:l.get(),y=e[e.length-1];if(p!==void 0)e[0]=p;else if(o&&i){const v=o.readValue(i,y);v!=null&&(e[0]=v)}e[0]===void 0&&(e[0]=y),l&&p===void 0&&l.set(e[0])}else e[u]=e[u-1]}setFinalKeyframe(){}measureInitialState(){}renderEndStyles(){}measureEndState(){}complete(){this.isComplete=!0,this.onComplete(this.unresolvedKeyframes,this.finalKeyframe),zy.delete(this)}cancel(){this.isComplete||(this.isScheduled=!1,zy.delete(this))}resume(){this.isComplete||this.scheduleResolve()}}const Gte=n=>/^-?(?:\d+(?:\.\d+)?|\.\d+)$/u.test(n),k1e=/^var\(--(?:([\w-]+)|([\w-]+), ?([a-zA-Z\d ()%#.,-]+))\)/u;function O1e(n){const e=k1e.exec(n);if(!e)return[,];const[,i,o,l]=e;return[`--${i??o}`,l]}function Hte(n,e,i=1){const[o,l]=O1e(n);if(!o)return;const u=window.getComputedStyle(e).getPropertyValue(o);if(u){const p=u.trim();return Gte(p)?parseFloat(p):p}return kj(l)?Hte(l,e,i+1):l}const $te=n=>e=>e.test(n),N1e={test:n=>n==="auto",parse:n=>n},Kte=[qS,$n,Tp,gg,SPe,vPe,N1e],fY=n=>Kte.find($te(n));class qte extends Yj{constructor(e,i,o,l,u){super(e,i,o,l,u,!0)}readKeyframes(){const{unresolvedKeyframes:e,element:i,name:o}=this;if(!i||!i.current)return;super.readKeyframes();for(let v=0;v<e.length;v++){let w=e[v];if(typeof w=="string"&&(w=w.trim(),kj(w))){const C=Hte(w,i.current);C!==void 0&&(e[v]=C),v===e.length-1&&(this.finalKeyframe=w)}}if(this.resolveNoneKeyframes(),!Tte.has(o)||e.length!==2)return;const[l,u]=e,p=fY(l),y=fY(u);if(p!==y)if(dY(p)&&dY(y))for(let v=0;v<e.length;v++){const w=e[v];typeof w=="string"&&(e[v]=parseFloat(w))}else this.needsMeasurement=!0}resolveNoneKeyframes(){const{unresolvedKeyframes:e,name:i}=this,o=[];for(let l=0;l<e.length;l++)c1e(e[l])&&o.push(l);o.length&&C1e(e,o,i)}measureInitialState(){const{element:e,unresolvedKeyframes:i,name:o}=this;if(!e||!e.current)return;o==="height"&&(this.suspendedScrollY=window.pageYOffset),this.measuredOrigin=TS[o](e.measureViewportBox(),window.getComputedStyle(e.current)),i[0]=this.measuredOrigin;const l=i[i.length-1];l!==void 0&&e.getValue(o,l).jump(l,!1)}measureEndState(){var e;const{element:i,name:o,unresolvedKeyframes:l}=this;if(!i||!i.current)return;const u=i.getValue(o);u&&u.jump(this.measuredOrigin,!1);const p=l.length-1,y=l[p];l[p]=TS[o](i.measureViewportBox(),window.getComputedStyle(i.current)),y!==null&&this.finalKeyframe===void 0&&(this.finalKeyframe=y),!((e=this.removedTransforms)===null||e===void 0)&&e.length&&this.removedTransforms.forEach(([v,w])=>{i.getValue(v).set(w)}),this.resolveNoneKeyframes()}}const mY=(n,e)=>e==="zIndex"?!1:!!(typeof n=="number"||Array.isArray(n)||typeof n=="string"&&(Mg.test(n)||n==="0")&&!n.startsWith("url("));function D1e(n){const e=n[0];if(n.length===1)return!0;for(let i=0;i<n.length;i++)if(n[i]!==e)return!0}function x1e(n,e,i,o){const l=n[0];if(l===null)return!1;if(e==="display"||e==="visibility")return!0;const u=n[n.length-1],p=mY(l,e),y=mY(u,e);return!p||!y?!1:D1e(n)||(i==="spring"||Vj(i))&&o}const L1e=n=>n!==null;function lN(n,{repeat:e,repeatType:i="loop"},o){const l=n.filter(L1e),u=e&&i!=="loop"&&e%2===1?0:l.length-1;return!u||o===void 0?l[u]:o}const M1e=40;class Yte{constructor({autoplay:e=!0,delay:i=0,type:o="keyframes",repeat:l=0,repeatDelay:u=0,repeatType:p="loop",...y}){this.isStopped=!1,this.hasAttemptedResolve=!1,this.createdAt=Cp.now(),this.options={autoplay:e,delay:i,type:o,repeat:l,repeatDelay:u,repeatType:p,...y},this.updateFinishedPromise()}calcStartTime(){return this.resolvedAt?this.resolvedAt-this.createdAt>M1e?this.resolvedAt:this.createdAt:this.createdAt}get resolved(){return!this._resolved&&!this.hasAttemptedResolve&&P1e(),this._resolved}onKeyframesResolved(e,i){this.resolvedAt=Cp.now(),this.hasAttemptedResolve=!0;const{name:o,type:l,velocity:u,delay:p,onComplete:y,onUpdate:v,isGenerator:w}=this.options;if(!w&&!x1e(e,o,l,u))if(p)this.options.duration=0;else{v&&v(lN(e,this.options,i)),y&&y(),this.resolveFinishedPromise();return}const C=this.initPlayback(e,i);C!==!1&&(this._resolved={keyframes:e,finalKeyframe:i,...C},this.onPostResolved())}onPostResolved(){}then(e,i){return this.currentFinishedPromise.then(e,i)}flatten(){this.options.type="keyframes",this.options.ease="linear"}updateFinishedPromise(){this.currentFinishedPromise=new Promise(e=>{this.resolveFinishedPromise=e})}}const Rs=(n,e,i)=>n+(e-n)*i;function SU(n,e,i){return i<0&&(i+=1),i>1&&(i-=1),i<1/6?n+(e-n)*6*i:i<1/2?e:i<2/3?n+(e-n)*(2/3-i)*6:n}function U1e({hue:n,saturation:e,lightness:i,alpha:o}){n/=360,e/=100,i/=100;let l=0,u=0,p=0;if(!e)l=u=p=i;else{const y=i<.5?i*(1+e):i+e-i*e,v=2*i-y;l=SU(v,y,n+1/3),u=SU(v,y,n),p=SU(v,y,n-1/3)}return{red:Math.round(l*255),green:Math.round(u*255),blue:Math.round(p*255),alpha:o}}function aO(n,e){return i=>i>0?e:n}const bU=(n,e,i)=>{const o=n*n,l=i*(e*e-o)+o;return l<0?0:Math.sqrt(l)},V1e=[LV,xy,H0],F1e=n=>V1e.find(e=>e.test(n));function gY(n){const e=F1e(n);if(!e)return!1;let i=e.parse(n);return e===H0&&(i=U1e(i)),i}const _Y=(n,e)=>{const i=gY(n),o=gY(e);if(!i||!o)return aO(n,e);const l={...i};return u=>(l.red=bU(i.red,o.red,u),l.green=bU(i.green,o.green,u),l.blue=bU(i.blue,o.blue,u),l.alpha=Rs(i.alpha,o.alpha,u),xy.transform(l))},j1e=(n,e)=>i=>e(n(i)),kR=(...n)=>n.reduce(j1e),FV=new Set(["none","hidden"]);function B1e(n,e){return FV.has(n)?i=>i<=0?n:e:i=>i>=1?e:n}function z1e(n,e){return i=>Rs(n,e,i)}function Xj(n){return typeof n=="number"?z1e:typeof n=="string"?kj(n)?aO:rc.test(n)?_Y:H1e:Array.isArray(n)?Xte:typeof n=="object"?rc.test(n)?_Y:W1e:aO}function Xte(n,e){const i=[...n],o=i.length,l=n.map((u,p)=>Xj(u)(u,e[p]));return u=>{for(let p=0;p<o;p++)i[p]=l[p](u);return i}}function W1e(n,e){const i={...n,...e},o={};for(const l in i)n[l]!==void 0&&e[l]!==void 0&&(o[l]=Xj(n[l])(n[l],e[l]));return l=>{for(const u in o)i[u]=o[u](l);return i}}function G1e(n,e){var i;const o=[],l={color:0,var:0,number:0};for(let u=0;u<e.values.length;u++){const p=e.types[u],y=n.indexes[p][l[p]],v=(i=n.values[y])!==null&&i!==void 0?i:0;o[u]=v,l[p]++}return o}const H1e=(n,e)=>{const i=Mg.createTransformer(e),o=tR(n),l=tR(e);return o.indexes.var.length===l.indexes.var.length&&o.indexes.color.length===l.indexes.color.length&&o.indexes.number.length>=l.indexes.number.length?FV.has(n)&&!l.values.length||FV.has(e)&&!o.values.length?B1e(n,e):kR(Xte(G1e(o,l),l.values),i):aO(n,e)};function Jte(n,e,i){return typeof n=="number"&&typeof e=="number"&&typeof i=="number"?Rs(n,e,i):Xj(n)(n,e)}const $1e=5;function Qte(n,e,i){const o=Math.max(e-$1e,0);return Cte(i-n(o),e-o)}const js={stiffness:100,damping:10,mass:1,velocity:0,duration:800,bounce:.3,visualDuration:.3,restSpeed:{granular:.01,default:2},restDelta:{granular:.005,default:.5},minDuration:.01,maxDuration:10,minDamping:.05,maxDamping:1},yY=.001;function K1e({duration:n=js.duration,bounce:e=js.bounce,velocity:i=js.velocity,mass:o=js.mass}){let l,u,p=1-e;p=zf(js.minDamping,js.maxDamping,p),n=zf(js.minDuration,js.maxDuration,Lf(n)),p<1?(l=w=>{const C=w*p,R=C*n,N=C-i,M=jV(w,p),L=Math.exp(-R);return yY-N/M*L},u=w=>{const R=w*p*n,N=R*i+i,M=Math.pow(p,2)*Math.pow(w,2)*n,L=Math.exp(-R),U=jV(Math.pow(w,2),p);return(-l(w)+yY>0?-1:1)*((N-M)*L)/U}):(l=w=>{const C=Math.exp(-w*n),R=(w-i)*n+1;return-.001+C*R},u=w=>{const C=Math.exp(-w*n),R=(i-w)*(n*n);return C*R});const y=5/n,v=Y1e(l,u,y);if(n=xf(n),isNaN(v))return{stiffness:js.stiffness,damping:js.damping,duration:n};{const w=Math.pow(v,2)*o;return{stiffness:w,damping:p*2*Math.sqrt(o*w),duration:n}}}const q1e=12;function Y1e(n,e,i){let o=i;for(let l=1;l<q1e;l++)o=o-n(o)/e(o);return o}function jV(n,e){return n*Math.sqrt(1-e*e)}const X1e=["duration","bounce"],J1e=["stiffness","damping","mass"];function EY(n,e){return e.some(i=>n[i]!==void 0)}function Q1e(n){let e={velocity:js.velocity,stiffness:js.stiffness,damping:js.damping,mass:js.mass,isResolvedFromDuration:!1,...n};if(!EY(n,J1e)&&EY(n,X1e))if(n.visualDuration){const i=n.visualDuration,o=2*Math.PI/(i*1.2),l=o*o,u=2*zf(.05,1,1-(n.bounce||0))*Math.sqrt(l);e={...e,mass:js.mass,stiffness:l,damping:u}}else{const i=K1e(n);e={...e,...i,mass:js.mass},e.isResolvedFromDuration=!0}return e}function Zte(n=js.visualDuration,e=js.bounce){const i=typeof n!="object"?{visualDuration:n,keyframes:[0,1],bounce:e}:n;let{restSpeed:o,restDelta:l}=i;const u=i.keyframes[0],p=i.keyframes[i.keyframes.length-1],y={done:!1,value:u},{stiffness:v,damping:w,mass:C,duration:R,velocity:N,isResolvedFromDuration:M}=Q1e({...i,velocity:-Lf(i.velocity||0)}),L=N||0,U=w/(2*Math.sqrt(v*C)),z=p-u,J=Lf(Math.sqrt(v/C)),q=Math.abs(z)<5;o||(o=q?js.restSpeed.granular:js.restSpeed.default),l||(l=q?js.restDelta.granular:js.restDelta.default);let re;if(U<1){const ae=jV(J,U);re=pe=>{const H=Math.exp(-U*J*pe);return p-H*((L+U*J*z)/ae*Math.sin(ae*pe)+z*Math.cos(ae*pe))}}else if(U===1)re=ae=>p-Math.exp(-J*ae)*(z+(L+J*z)*ae);else{const ae=J*Math.sqrt(U*U-1);re=pe=>{const H=Math.exp(-U*J*pe),X=Math.min(ae*pe,300);return p-H*((L+U*J*z)*Math.sinh(X)+ae*z*Math.cosh(X))/ae}}const ce={calculatedDuration:M&&R||null,next:ae=>{const pe=re(ae);if(M)y.done=ae>=R;else{let H=0;U<1&&(H=ae===0?xf(L):Qte(re,ae,pe));const X=Math.abs(H)<=o,Q=Math.abs(p-pe)<=l;y.done=X&&Q}return y.value=y.done?p:pe,y},toString:()=>{const ae=Math.min(_te(ce),NV),pe=yte(H=>ce.next(ae*H).value,ae,30);return ae+"ms "+pe}};return ce}function vY({keyframes:n,velocity:e=0,power:i=.8,timeConstant:o=325,bounceDamping:l=10,bounceStiffness:u=500,modifyTarget:p,min:y,max:v,restDelta:w=.5,restSpeed:C}){const R=n[0],N={done:!1,value:R},M=X=>y!==void 0&&X<y||v!==void 0&&X>v,L=X=>y===void 0?v:v===void 0||Math.abs(y-X)<Math.abs(v-X)?y:v;let U=i*e;const z=R+U,J=p===void 0?z:p(z);J!==z&&(U=J-R);const q=X=>-U*Math.exp(-X/o),re=X=>J+q(X),ce=X=>{const Q=q(X),ne=re(X);N.done=Math.abs(Q)<=w,N.value=N.done?J:ne};let ae,pe;const H=X=>{M(N.value)&&(ae=X,pe=Zte({keyframes:[N.value,L(N.value)],velocity:Qte(re,X,N.value),damping:l,stiffness:u,restDelta:w,restSpeed:C}))};return H(0),{calculatedDuration:null,next:X=>{let Q=!1;return!pe&&ae===void 0&&(Q=!0,ce(X),H(X)),ae!==void 0&&X>=ae?pe.next(X-ae):(!Q&&ce(X),N)}}}const Z1e=PR(.42,0,1,1),eke=PR(0,0,.58,1),ene=PR(.42,0,.58,1),tke=n=>Array.isArray(n)&&typeof n[0]!="number",nke={linear:iu,easeIn:Z1e,easeInOut:ene,easeOut:eke,circIn:Hj,circInOut:xte,circOut:Dte,backIn:Gj,backInOut:Ote,backOut:kte,anticipate:Nte},SY=n=>{if(Fj(n)){Jee(n.length===4);const[e,i,o,l]=n;return PR(e,i,o,l)}else if(typeof n=="string")return nke[n];return n};function rke(n,e,i){const o=[],l=i||Jte,u=n.length-1;for(let p=0;p<u;p++){let y=l(n[p],n[p+1]);if(e){const v=Array.isArray(e)?e[p]||iu:e;y=kR(v,y)}o.push(y)}return o}function ike(n,e,{clamp:i=!0,ease:o,mixer:l}={}){const u=n.length;if(Jee(u===e.length),u===1)return()=>e[0];if(u===2&&e[0]===e[1])return()=>e[1];const p=n[0]===n[1];n[0]>n[u-1]&&(n=[...n].reverse(),e=[...e].reverse());const y=rke(e,o,l),v=y.length,w=C=>{if(p&&C<n[0])return e[0];let R=0;if(v>1)for(;R<n.length-2&&!(C<n[R+1]);R++);const N=bS(n[R],n[R+1],C);return y[R](N)};return i?C=>w(zf(n[0],n[u-1],C)):w}function ske(n,e){const i=n[n.length-1];for(let o=1;o<=e;o++){const l=bS(0,e,o);n.push(Rs(i,1,l))}}function oke(n){const e=[0];return ske(e,n.length-1),e}function ake(n,e){return n.map(i=>i*e)}function cke(n,e){return n.map(()=>e||ene).splice(0,n.length-1)}function cO({duration:n=300,keyframes:e,times:i,ease:o="easeInOut"}){const l=tke(o)?o.map(SY):SY(o),u={done:!1,value:e[0]},p=ake(i&&i.length===e.length?i:oke(e),n),y=ike(p,e,{ease:Array.isArray(l)?l:cke(e,l)});return{calculatedDuration:n,next:v=>(u.value=y(v),u.done=v>=n,u)}}const lke=n=>{const e=({timestamp:i})=>n(i);return{start:()=>cs.update(e,!0),stop:()=>Lg(e),now:()=>Ra.isProcessing?Ra.timestamp:Cp.now()}},uke={decay:vY,inertia:vY,tween:cO,keyframes:cO,spring:Zte},dke=n=>n/100;class Jj extends Yte{constructor(e){super(e),this.holdTime=null,this.cancelTime=null,this.currentTime=0,this.playbackSpeed=1,this.pendingPlayState="running",this.startTime=null,this.state="idle",this.stop=()=>{if(this.resolver.cancel(),this.isStopped=!0,this.state==="idle")return;this.teardown();const{onStop:v}=this.options;v&&v()};const{name:i,motionValue:o,element:l,keyframes:u}=this.options,p=(l==null?void 0:l.KeyframeResolver)||Yj,y=(v,w)=>this.onKeyframesResolved(v,w);this.resolver=new p(u,y,i,o,l),this.resolver.scheduleResolve()}flatten(){super.flatten(),this._resolved&&Object.assign(this._resolved,this.initPlayback(this._resolved.keyframes))}initPlayback(e){const{type:i="keyframes",repeat:o=0,repeatDelay:l=0,repeatType:u,velocity:p=0}=this.options,y=Vj(i)?i:uke[i]||cO;let v,w;y!==cO&&typeof e[0]!="number"&&(v=kR(dke,Jte(e[0],e[1])),e=[0,100]);const C=y({...this.options,keyframes:e});u==="mirror"&&(w=y({...this.options,keyframes:[...e].reverse(),velocity:-p})),C.calculatedDuration===null&&(C.calculatedDuration=_te(C));const{calculatedDuration:R}=C,N=R+l,M=N*(o+1)-l;return{generator:C,mirroredGenerator:w,mapPercentToKeyframes:v,calculatedDuration:R,resolvedDuration:N,totalDuration:M}}onPostResolved(){const{autoplay:e=!0}=this.options;this.play(),this.pendingPlayState==="paused"||!e?this.pause():this.state=this.pendingPlayState}tick(e,i=!1){const{resolved:o}=this;if(!o){const{keyframes:X}=this.options;return{done:!0,value:X[X.length-1]}}const{finalKeyframe:l,generator:u,mirroredGenerator:p,mapPercentToKeyframes:y,keyframes:v,calculatedDuration:w,totalDuration:C,resolvedDuration:R}=o;if(this.startTime===null)return u.next(0);const{delay:N,repeat:M,repeatType:L,repeatDelay:U,onUpdate:z}=this.options;this.speed>0?this.startTime=Math.min(this.startTime,e):this.speed<0&&(this.startTime=Math.min(e-C/this.speed,this.startTime)),i?this.currentTime=e:this.holdTime!==null?this.currentTime=this.holdTime:this.currentTime=Math.round(e-this.startTime)*this.speed;const J=this.currentTime-N*(this.speed>=0?1:-1),q=this.speed>=0?J<0:J>C;this.currentTime=Math.max(J,0),this.state==="finished"&&this.holdTime===null&&(this.currentTime=C);let re=this.currentTime,ce=u;if(M){const X=Math.min(this.currentTime,C)/R;let Q=Math.floor(X),ne=X%1;!ne&&X>=1&&(ne=1),ne===1&&Q--,Q=Math.min(Q,M+1),!!(Q%2)&&(L==="reverse"?(ne=1-ne,U&&(ne-=U/R)):L==="mirror"&&(ce=p)),re=zf(0,1,ne)*R}const ae=q?{done:!1,value:v[0]}:ce.next(re);y&&(ae.value=y(ae.value));let{done:pe}=ae;!q&&w!==null&&(pe=this.speed>=0?this.currentTime>=C:this.currentTime<=0);const H=this.holdTime===null&&(this.state==="finished"||this.state==="running"&&pe);return H&&l!==void 0&&(ae.value=lN(v,this.options,l)),z&&z(ae.value),H&&this.finish(),ae}get duration(){const{resolved:e}=this;return e?Lf(e.calculatedDuration):0}get time(){return Lf(this.currentTime)}set time(e){e=xf(e),this.currentTime=e,this.holdTime!==null||this.speed===0?this.holdTime=e:this.driver&&(this.startTime=this.driver.now()-e/this.speed)}get speed(){return this.playbackSpeed}set speed(e){const i=this.playbackSpeed!==e;this.playbackSpeed=e,i&&(this.time=Lf(this.currentTime))}play(){if(this.resolver.isScheduled||this.resolver.resume(),!this._resolved){this.pendingPlayState="running";return}if(this.isStopped)return;const{driver:e=lke,onPlay:i,startTime:o}=this.options;this.driver||(this.driver=e(u=>this.tick(u))),i&&i();const l=this.driver.now();this.holdTime!==null?this.startTime=l-this.holdTime:this.startTime?this.state==="finished"&&(this.startTime=l):this.startTime=o??this.calcStartTime(),this.state==="finished"&&this.updateFinishedPromise(),this.cancelTime=this.startTime,this.holdTime=null,this.state="running",this.driver.start()}pause(){var e;if(!this._resolved){this.pendingPlayState="paused";return}this.state="paused",this.holdTime=(e=this.currentTime)!==null&&e!==void 0?e:0}complete(){this.state!=="running"&&this.play(),this.pendingPlayState=this.state="finished",this.holdTime=null}finish(){this.teardown(),this.state="finished";const{onComplete:e}=this.options;e&&e()}cancel(){this.cancelTime!==null&&this.tick(this.cancelTime),this.teardown(),this.updateFinishedPromise()}teardown(){this.state="idle",this.stopDriver(),this.resolveFinishedPromise(),this.updateFinishedPromise(),this.startTime=this.cancelTime=null,this.resolver.cancel()}stopDriver(){this.driver&&(this.driver.stop(),this.driver=void 0)}sample(e){return this.startTime=0,this.tick(e,!0)}}const hke=new Set(["opacity","clipPath","filter","transform"]);function pke(n,e,i,{delay:o=0,duration:l=300,repeat:u=0,repeatType:p="loop",ease:y="easeInOut",times:v}={}){const w={[e]:i};v&&(w.offset=v);const C=vte(y,l);return Array.isArray(C)&&(w.easing=C),n.animate(w,{delay:o,duration:l,easing:Array.isArray(C)?"linear":C,fill:"both",iterations:u+1,direction:p==="reverse"?"alternate":"normal"})}const fke=wj(()=>Object.hasOwnProperty.call(Element.prototype,"animate")),lO=10,mke=2e4;function gke(n){return Vj(n.type)||n.type==="spring"||!Ete(n.ease)}function _ke(n,e){const i=new Jj({...e,keyframes:n,repeat:0,delay:0,isGenerator:!0});let o={done:!1,value:n[0]};const l=[];let u=0;for(;!o.done&&u<mke;)o=i.sample(u),l.push(o.value),u+=lO;return{times:void 0,keyframes:l,duration:u-lO,ease:"linear"}}const tne={anticipate:Nte,backInOut:Ote,circInOut:xte};function yke(n){return n in tne}class bY extends Yte{constructor(e){super(e);const{name:i,motionValue:o,element:l,keyframes:u}=this.options;this.resolver=new qte(u,(p,y)=>this.onKeyframesResolved(p,y),i,o,l),this.resolver.scheduleResolve()}initPlayback(e,i){let{duration:o=300,times:l,ease:u,type:p,motionValue:y,name:v,startTime:w}=this.options;if(!y.owner||!y.owner.current)return!1;if(typeof u=="string"&&oO()&&yke(u)&&(u=tne[u]),gke(this.options)){const{onComplete:R,onUpdate:N,motionValue:M,element:L,...U}=this.options,z=_ke(e,U);e=z.keyframes,e.length===1&&(e[1]=e[0]),o=z.duration,l=z.times,u=z.ease,p="keyframes"}const C=pke(y.owner.current,v,e,{...this.options,duration:o,times:l,ease:u});return C.startTime=w??this.calcStartTime(),this.pendingTimeline?(sY(C,this.pendingTimeline),this.pendingTimeline=void 0):C.onfinish=()=>{const{onComplete:R}=this.options;y.set(lN(e,this.options,i)),R&&R(),this.cancel(),this.resolveFinishedPromise()},{animation:C,duration:o,times:l,type:p,ease:u,keyframes:e}}get duration(){const{resolved:e}=this;if(!e)return 0;const{duration:i}=e;return Lf(i)}get time(){const{resolved:e}=this;if(!e)return 0;const{animation:i}=e;return Lf(i.currentTime||0)}set time(e){const{resolved:i}=this;if(!i)return;const{animation:o}=i;o.currentTime=xf(e)}get speed(){const{resolved:e}=this;if(!e)return 1;const{animation:i}=e;return i.playbackRate}set speed(e){const{resolved:i}=this;if(!i)return;const{animation:o}=i;o.playbackRate=e}get state(){const{resolved:e}=this;if(!e)return"idle";const{animation:i}=e;return i.playState}get startTime(){const{resolved:e}=this;if(!e)return null;const{animation:i}=e;return i.startTime}attachTimeline(e){if(!this._resolved)this.pendingTimeline=e;else{const{resolved:i}=this;if(!i)return iu;const{animation:o}=i;sY(o,e)}return iu}play(){if(this.isStopped)return;const{resolved:e}=this;if(!e)return;const{animation:i}=e;i.playState==="finished"&&this.updateFinishedPromise(),i.play()}pause(){const{resolved:e}=this;if(!e)return;const{animation:i}=e;i.pause()}stop(){if(this.resolver.cancel(),this.isStopped=!0,this.state==="idle")return;this.resolveFinishedPromise(),this.updateFinishedPromise();const{resolved:e}=this;if(!e)return;const{animation:i,keyframes:o,duration:l,type:u,ease:p,times:y}=e;if(i.playState==="idle"||i.playState==="finished")return;if(this.time){const{motionValue:w,onUpdate:C,onComplete:R,element:N,...M}=this.options,L=new Jj({...M,keyframes:o,duration:l,type:u,ease:p,times:y,isGenerator:!0}),U=xf(this.time);w.setWithVelocity(L.sample(U-lO).value,L.sample(U).value,lO)}const{onStop:v}=this.options;v&&v(),this.cancel()}complete(){const{resolved:e}=this;e&&e.animation.finish()}cancel(){const{resolved:e}=this;e&&e.animation.cancel()}static supports(e){const{motionValue:i,name:o,repeatDelay:l,repeatType:u,damping:p,type:y}=e;if(!i||!i.owner||!(i.owner.current instanceof HTMLElement))return!1;const{onUpdate:v,transformTemplate:w}=i.owner.getProps();return fke()&&o&&hke.has(o)&&!v&&!w&&!l&&u!=="mirror"&&p!==0&&y!=="inertia"}}const Eke={type:"spring",stiffness:500,damping:25,restSpeed:10},vke=n=>({type:"spring",stiffness:550,damping:n===0?2*Math.sqrt(550):30,restSpeed:10}),Ske={type:"keyframes",duration:.8},bke={type:"keyframes",ease:[.25,.1,.35,1],duration:.3},wke=(n,{keyframes:e})=>e.length>2?Ske:lE.has(n)?n.startsWith("scale")?vke(e[1]):Eke:bke;function Tke({when:n,delay:e,delayChildren:i,staggerChildren:o,staggerDirection:l,repeat:u,repeatType:p,repeatDelay:y,from:v,elapsed:w,...C}){return!!Object.keys(C).length}const Qj=(n,e,i,o={},l,u)=>p=>{const y=Uj(o,n)||{},v=y.delay||o.delay||0;let{elapsed:w=0}=o;w=w-xf(v);let C={keyframes:Array.isArray(i)?i:[null,i],ease:"easeOut",velocity:e.getVelocity(),...y,delay:-w,onUpdate:N=>{e.set(N),y.onUpdate&&y.onUpdate(N)},onComplete:()=>{p(),y.onComplete&&y.onComplete()},name:n,motionValue:e,element:u?void 0:l};Tke(y)||(C={...C,...wke(n,C)}),C.duration&&(C.duration=xf(C.duration)),C.repeatDelay&&(C.repeatDelay=xf(C.repeatDelay)),C.from!==void 0&&(C.keyframes[0]=C.from);let R=!1;if((C.type===!1||C.duration===0&&!C.repeatDelay)&&(C.duration=0,C.delay===0&&(R=!0)),R&&!u&&e.get()!==void 0){const N=lN(C.keyframes,y);if(N!==void 0)return cs.update(()=>{C.onUpdate(N),C.onComplete()}),new WPe([])}return!u&&bY.supports(C)?new bY(C):new Jj(C)};function Cke({protectedKeys:n,needsAnimating:e},i){const o=n.hasOwnProperty(i)&&e[i]!==!0;return e[i]=!1,o}function nne(n,e,{delay:i=0,transitionOverride:o,type:l}={}){var u;let{transition:p=n.getDefaultTransition(),transitionEnd:y,...v}=e;o&&(p=o);const w=[],C=l&&n.animationState&&n.animationState.getState()[l];for(const R in v){const N=n.getValue(R,(u=n.latestValues[R])!==null&&u!==void 0?u:null),M=v[R];if(M===void 0||C&&Cke(C,R))continue;const L={delay:i,...Uj(p||{},R)};let U=!1;if(window.MotionHandoffAnimation){const J=Rte(n);if(J){const q=window.MotionHandoffAnimation(J,R,cs);q!==null&&(L.startTime=q,U=!0)}}xV(n,R),N.start(Qj(R,N,M,n.shouldReduceMotion&&Tte.has(R)?{type:!1}:L,n,U));const z=N.animation;z&&w.push(z)}return y&&Promise.all(w).then(()=>{cs.update(()=>{y&&r1e(n,y)})}),w}function BV(n,e,i={}){var o;const l=cN(n,e,i.type==="exit"?(o=n.presenceContext)===null||o===void 0?void 0:o.custom:void 0);let{transition:u=n.getDefaultTransition()||{}}=l||{};i.transitionOverride&&(u=i.transitionOverride);const p=l?()=>Promise.all(nne(n,l,i)):()=>Promise.resolve(),y=n.variantChildren&&n.variantChildren.size?(w=0)=>{const{delayChildren:C=0,staggerChildren:R,staggerDirection:N}=u;return Rke(n,e,C+w,R,N,i)}:()=>Promise.resolve(),{when:v}=u;if(v){const[w,C]=v==="beforeChildren"?[p,y]:[y,p];return w().then(()=>C())}else return Promise.all([p(),y(i.delay)])}function Rke(n,e,i=0,o=0,l=1,u){const p=[],y=(n.variantChildren.size-1)*o,v=l===1?(w=0)=>w*o:(w=0)=>y-w*o;return Array.from(n.variantChildren).sort(Ike).forEach((w,C)=>{w.notify("AnimationStart",e),p.push(BV(w,e,{...u,delay:i+v(C)}).then(()=>w.notify("AnimationComplete",e)))}),Promise.all(p)}function Ike(n,e){return n.sortNodePosition(e)}function Ake(n,e,i={}){n.notify("AnimationStart",e);let o;if(Array.isArray(e)){const l=e.map(u=>BV(n,u,i));o=Promise.all(l)}else if(typeof e=="string")o=BV(n,e,i);else{const l=typeof e=="function"?cN(n,e,i.custom):e;o=Promise.all(nne(n,l,i))}return o.then(()=>{n.notify("AnimationComplete",e)})}const Pke=Cj.length;function rne(n){if(!n)return;if(!n.isControllingVariants){const i=n.parent?rne(n.parent)||{}:{};return n.props.initial!==void 0&&(i.initial=n.props.initial),i}const e={};for(let i=0;i<Pke;i++){const o=Cj[i],l=n.props[o];(QC(l)||l===!1)&&(e[o]=l)}return e}const kke=[...Tj].reverse(),Oke=Tj.length;function Nke(n){return e=>Promise.all(e.map(({animation:i,options:o})=>Ake(n,i,o)))}function Dke(n){let e=Nke(n),i=wY(),o=!0;const l=v=>(w,C)=>{var R;const N=cN(n,C,v==="exit"?(R=n.presenceContext)===null||R===void 0?void 0:R.custom:void 0);if(N){const{transition:M,transitionEnd:L,...U}=N;w={...w,...U,...L}}return w};function u(v){e=v(n)}function p(v){const{props:w}=n,C=rne(n.parent)||{},R=[],N=new Set;let M={},L=1/0;for(let z=0;z<Oke;z++){const J=kke[z],q=i[J],re=w[J]!==void 0?w[J]:C[J],ce=QC(re),ae=J===v?q.isActive:null;ae===!1&&(L=z);let pe=re===C[J]&&re!==w[J]&&ce;if(pe&&o&&n.manuallyAnimateOnMount&&(pe=!1),q.protectedKeys={...M},!q.isActive&&ae===null||!re&&!q.prevProp||oN(re)||typeof re=="boolean")continue;const H=xke(q.prevProp,re);let X=H||J===v&&q.isActive&&!pe&&ce||z>L&&ce,Q=!1;const ne=Array.isArray(re)?re:[re];let he=ne.reduce(l(J),{});ae===!1&&(he={});const{prevResolvedValues:fe={}}=q,de={...fe,...he},ke=Te=>{X=!0,N.has(Te)&&(Q=!0,N.delete(Te)),q.needsAnimating[Te]=!0;const we=n.getValue(Te);we&&(we.liveStyle=!1)};for(const Te in de){const we=he[Te],Ie=fe[Te];if(M.hasOwnProperty(Te))continue;let Oe=!1;OV(we)&&OV(Ie)?Oe=!gte(we,Ie):Oe=we!==Ie,Oe?we!=null?ke(Te):N.add(Te):we!==void 0&&N.has(Te)?ke(Te):q.protectedKeys[Te]=!0}q.prevProp=re,q.prevResolvedValues=he,q.isActive&&(M={...M,...he}),o&&n.blockInitialAnimation&&(X=!1),X&&(!(pe&&H)||Q)&&R.push(...ne.map(Te=>({animation:Te,options:{type:J}})))}if(N.size){const z={};N.forEach(J=>{const q=n.getBaseTarget(J),re=n.getValue(J);re&&(re.liveStyle=!0),z[J]=q??null}),R.push({animation:z})}let U=!!R.length;return o&&(w.initial===!1||w.initial===w.animate)&&!n.manuallyAnimateOnMount&&(U=!1),o=!1,U?e(R):Promise.resolve()}function y(v,w){var C;if(i[v].isActive===w)return Promise.resolve();(C=n.variantChildren)===null||C===void 0||C.forEach(N=>{var M;return(M=N.animationState)===null||M===void 0?void 0:M.setActive(v,w)}),i[v].isActive=w;const R=p(v);for(const N in i)i[N].protectedKeys={};return R}return{animateChanges:p,setActive:y,setAnimateFunction:u,getState:()=>i,reset:()=>{i=wY(),o=!0}}}function xke(n,e){return typeof e=="string"?e!==n:Array.isArray(e)?!gte(e,n):!1}function Ty(n=!1){return{isActive:n,protectedKeys:{},needsAnimating:{},prevResolvedValues:{}}}function wY(){return{animate:Ty(!0),whileInView:Ty(),whileHover:Ty(),whileTap:Ty(),whileDrag:Ty(),whileFocus:Ty(),exit:Ty()}}class Kg{constructor(e){this.isMounted=!1,this.node=e}update(){}}class Lke extends Kg{constructor(e){super(e),e.animationState||(e.animationState=Dke(e))}updateAnimationControlsSubscription(){const{animate:e}=this.node.getProps();oN(e)&&(this.unmountControls=e.subscribe(this.node))}mount(){this.updateAnimationControlsSubscription()}update(){const{animate:e}=this.node.getProps(),{animate:i}=this.node.prevProps||{};e!==i&&this.updateAnimationControlsSubscription()}unmount(){var e;this.node.animationState.reset(),(e=this.unmountControls)===null||e===void 0||e.call(this)}}let Mke=0;class Uke extends Kg{constructor(){super(...arguments),this.id=Mke++}update(){if(!this.node.presenceContext)return;const{isPresent:e,onExitComplete:i}=this.node.presenceContext,{isPresent:o}=this.node.prevPresenceContext||{};if(!this.node.animationState||e===o)return;const l=this.node.animationState.setActive("exit",!e);i&&!e&&l.then(()=>i(this.id))}mount(){const{register:e}=this.node.presenceContext||{};e&&(this.unmount=e(this.id))}unmount(){}}const Vke={animation:{Feature:Lke},exit:{Feature:Uke}};function nR(n,e,i,o={passive:!0}){return n.addEventListener(e,i,o),()=>n.removeEventListener(e,i)}function OR(n){return{point:{x:n.pageX,y:n.pageY}}}const Fke=n=>e=>jj(e)&&n(e,OR(e));function kC(n,e,i,o){return nR(n,e,Fke(i),o)}const TY=(n,e)=>Math.abs(n-e);function jke(n,e){const i=TY(n.x,e.x),o=TY(n.y,e.y);return Math.sqrt(i**2+o**2)}class ine{constructor(e,i,{transformPagePoint:o,contextWindow:l,dragSnapToOrigin:u=!1}={}){if(this.startEvent=null,this.lastMoveEvent=null,this.lastMoveEventInfo=null,this.handlers={},this.contextWindow=window,this.updatePoint=()=>{if(!(this.lastMoveEvent&&this.lastMoveEventInfo))return;const R=TU(this.lastMoveEventInfo,this.history),N=this.startEvent!==null,M=jke(R.offset,{x:0,y:0})>=3;if(!N&&!M)return;const{point:L}=R,{timestamp:U}=Ra;this.history.push({...L,timestamp:U});const{onStart:z,onMove:J}=this.handlers;N||(z&&z(this.lastMoveEvent,R),this.startEvent=this.lastMoveEvent),J&&J(this.lastMoveEvent,R)},this.handlePointerMove=(R,N)=>{this.lastMoveEvent=R,this.lastMoveEventInfo=wU(N,this.transformPagePoint),cs.update(this.updatePoint,!0)},this.handlePointerUp=(R,N)=>{this.end();const{onEnd:M,onSessionEnd:L,resumeAnimation:U}=this.handlers;if(this.dragSnapToOrigin&&U&&U(),!(this.lastMoveEvent&&this.lastMoveEventInfo))return;const z=TU(R.type==="pointercancel"?this.lastMoveEventInfo:wU(N,this.transformPagePoint),this.history);this.startEvent&&M&&M(R,z),L&&L(R,z)},!jj(e))return;this.dragSnapToOrigin=u,this.handlers=i,this.transformPagePoint=o,this.contextWindow=l||window;const p=OR(e),y=wU(p,this.transformPagePoint),{point:v}=y,{timestamp:w}=Ra;this.history=[{...v,timestamp:w}];const{onSessionStart:C}=i;C&&C(e,TU(y,this.history)),this.removeListeners=kR(kC(this.contextWindow,"pointermove",this.handlePointerMove),kC(this.contextWindow,"pointerup",this.handlePointerUp),kC(this.contextWindow,"pointercancel",this.handlePointerUp))}updateHandlers(e){this.handlers=e}end(){this.removeListeners&&this.removeListeners(),Lg(this.updatePoint)}}function wU(n,e){return e?{point:e(n.point)}:n}function CY(n,e){return{x:n.x-e.x,y:n.y-e.y}}function TU({point:n},e){return{point:n,delta:CY(n,sne(e)),offset:CY(n,Bke(e)),velocity:zke(e,.1)}}function Bke(n){return n[0]}function sne(n){return n[n.length-1]}function zke(n,e){if(n.length<2)return{x:0,y:0};let i=n.length-1,o=null;const l=sne(n);for(;i>=0&&(o=n[i],!(l.timestamp-o.timestamp>xf(e)));)i--;if(!o)return{x:0,y:0};const u=Lf(l.timestamp-o.timestamp);if(u===0)return{x:0,y:0};const p={x:(l.x-o.x)/u,y:(l.y-o.y)/u};return p.x===1/0&&(p.x=0),p.y===1/0&&(p.y=0),p}const one=1e-4,Wke=1-one,Gke=1+one,ane=.01,Hke=0-ane,$ke=0+ane;function ou(n){return n.max-n.min}function Kke(n,e,i){return Math.abs(n-e)<=i}function RY(n,e,i,o=.5){n.origin=o,n.originPoint=Rs(e.min,e.max,n.origin),n.scale=ou(i)/ou(e),n.translate=Rs(i.min,i.max,n.origin)-n.originPoint,(n.scale>=Wke&&n.scale<=Gke||isNaN(n.scale))&&(n.scale=1),(n.translate>=Hke&&n.translate<=$ke||isNaN(n.translate))&&(n.translate=0)}function OC(n,e,i,o){RY(n.x,e.x,i.x,o?o.originX:void 0),RY(n.y,e.y,i.y,o?o.originY:void 0)}function IY(n,e,i){n.min=i.min+e.min,n.max=n.min+ou(e)}function qke(n,e,i){IY(n.x,e.x,i.x),IY(n.y,e.y,i.y)}function AY(n,e,i){n.min=e.min-i.min,n.max=n.min+ou(e)}function NC(n,e,i){AY(n.x,e.x,i.x),AY(n.y,e.y,i.y)}function Yke(n,{min:e,max:i},o){return e!==void 0&&n<e?n=o?Rs(e,n,o.min):Math.max(n,e):i!==void 0&&n>i&&(n=o?Rs(i,n,o.max):Math.min(n,i)),n}function PY(n,e,i){return{min:e!==void 0?n.min+e:void 0,max:i!==void 0?n.max+i-(n.max-n.min):void 0}}function Xke(n,{top:e,left:i,bottom:o,right:l}){return{x:PY(n.x,i,l),y:PY(n.y,e,o)}}function kY(n,e){let i=e.min-n.min,o=e.max-n.max;return e.max-e.min<n.max-n.min&&([i,o]=[o,i]),{min:i,max:o}}function Jke(n,e){return{x:kY(n.x,e.x),y:kY(n.y,e.y)}}function Qke(n,e){let i=.5;const o=ou(n),l=ou(e);return l>o?i=bS(e.min,e.max-o,n.min):o>l&&(i=bS(n.min,n.max-l,e.min)),zf(0,1,i)}function Zke(n,e){const i={};return e.min!==void 0&&(i.min=e.min-n.min),e.max!==void 0&&(i.max=e.max-n.min),i}const zV=.35;function eOe(n=zV){return n===!1?n=0:n===!0&&(n=zV),{x:OY(n,"left","right"),y:OY(n,"top","bottom")}}function OY(n,e,i){return{min:NY(n,e),max:NY(n,i)}}function NY(n,e){return typeof n=="number"?n:n[e]||0}const DY=()=>({translate:0,scale:1,origin:0,originPoint:0}),$0=()=>({x:DY(),y:DY()}),xY=()=>({min:0,max:0}),to=()=>({x:xY(),y:xY()});function Qu(n){return[n("x"),n("y")]}function cne({top:n,left:e,right:i,bottom:o}){return{x:{min:e,max:i},y:{min:n,max:o}}}function tOe({x:n,y:e}){return{top:e.min,right:n.max,bottom:e.max,left:n.min}}function nOe(n,e){if(!e)return n;const i=e({x:n.left,y:n.top}),o=e({x:n.right,y:n.bottom});return{top:i.y,left:i.x,bottom:o.y,right:o.x}}function CU(n){return n===void 0||n===1}function WV({scale:n,scaleX:e,scaleY:i}){return!CU(n)||!CU(e)||!CU(i)}function Ry(n){return WV(n)||lne(n)||n.z||n.rotate||n.rotateX||n.rotateY||n.skewX||n.skewY}function lne(n){return LY(n.x)||LY(n.y)}function LY(n){return n&&n!=="0%"}function uO(n,e,i){const o=n-i,l=e*o;return i+l}function MY(n,e,i,o,l){return l!==void 0&&(n=uO(n,l,o)),uO(n,i,o)+e}function GV(n,e=0,i=1,o,l){n.min=MY(n.min,e,i,o,l),n.max=MY(n.max,e,i,o,l)}function une(n,{x:e,y:i}){GV(n.x,e.translate,e.scale,e.originPoint),GV(n.y,i.translate,i.scale,i.originPoint)}const UY=.999999999999,VY=1.0000000000001;function rOe(n,e,i,o=!1){const l=i.length;if(!l)return;e.x=e.y=1;let u,p;for(let y=0;y<l;y++){u=i[y],p=u.projectionDelta;const{visualElement:v}=u.options;v&&v.props.style&&v.props.style.display==="contents"||(o&&u.options.layoutScroll&&u.scroll&&u!==u.root&&q0(n,{x:-u.scroll.offset.x,y:-u.scroll.offset.y}),p&&(e.x*=p.x.scale,e.y*=p.y.scale,une(n,p)),o&&Ry(u.latestValues)&&q0(n,u.latestValues))}e.x<VY&&e.x>UY&&(e.x=1),e.y<VY&&e.y>UY&&(e.y=1)}function K0(n,e){n.min=n.min+e,n.max=n.max+e}function FY(n,e,i,o,l=.5){const u=Rs(n.min,n.max,l);GV(n,e,i,u,o)}function q0(n,e){FY(n.x,e.x,e.scaleX,e.scale,e.originX),FY(n.y,e.y,e.scaleY,e.scale,e.originY)}function dne(n,e){return cne(nOe(n.getBoundingClientRect(),e))}function iOe(n,e,i){const o=dne(n,i),{scroll:l}=e;return l&&(K0(o.x,l.offset.x),K0(o.y,l.offset.y)),o}const hne=({current:n})=>n?n.ownerDocument.defaultView:null,sOe=new WeakMap;class oOe{constructor(e){this.openDragLock=null,this.isDragging=!1,this.currentDirection=null,this.originPoint={x:0,y:0},this.constraints=!1,this.hasMutatedConstraints=!1,this.elastic=to(),this.visualElement=e}start(e,{snapToCursor:i=!1}={}){const{presenceContext:o}=this.visualElement;if(o&&o.isPresent===!1)return;const l=C=>{const{dragSnapToOrigin:R}=this.getProps();R?this.pauseAnimation():this.stopAnimation(),i&&this.snapToCursor(OR(C).point)},u=(C,R)=>{const{drag:N,dragPropagation:M,onDragStart:L}=this.getProps();if(N&&!M&&(this.openDragLock&&this.openDragLock(),this.openDragLock=QPe(N),!this.openDragLock))return;this.isDragging=!0,this.currentDirection=null,this.resolveConstraints(),this.visualElement.projection&&(this.visualElement.projection.isAnimationBlocked=!0,this.visualElement.projection.target=void 0),Qu(z=>{let J=this.getAxisMotionValue(z).get()||0;if(Tp.test(J)){const{projection:q}=this.visualElement;if(q&&q.layout){const re=q.layout.layoutBox[z];re&&(J=ou(re)*(parseFloat(J)/100))}}this.originPoint[z]=J}),L&&cs.postRender(()=>L(C,R)),xV(this.visualElement,"transform");const{animationState:U}=this.visualElement;U&&U.setActive("whileDrag",!0)},p=(C,R)=>{const{dragPropagation:N,dragDirectionLock:M,onDirectionLock:L,onDrag:U}=this.getProps();if(!N&&!this.openDragLock)return;const{offset:z}=R;if(M&&this.currentDirection===null){this.currentDirection=aOe(z),this.currentDirection!==null&&L&&L(this.currentDirection);return}this.updateAxis("x",R.point,z),this.updateAxis("y",R.point,z),this.visualElement.render(),U&&U(C,R)},y=(C,R)=>this.stop(C,R),v=()=>Qu(C=>{var R;return this.getAnimationState(C)==="paused"&&((R=this.getAxisMotionValue(C).animation)===null||R===void 0?void 0:R.play())}),{dragSnapToOrigin:w}=this.getProps();this.panSession=new ine(e,{onSessionStart:l,onStart:u,onMove:p,onSessionEnd:y,resumeAnimation:v},{transformPagePoint:this.visualElement.getTransformPagePoint(),dragSnapToOrigin:w,contextWindow:hne(this.visualElement)})}stop(e,i){const o=this.isDragging;if(this.cancel(),!o)return;const{velocity:l}=i;this.startAnimation(l);const{onDragEnd:u}=this.getProps();u&&cs.postRender(()=>u(e,i))}cancel(){this.isDragging=!1;const{projection:e,animationState:i}=this.visualElement;e&&(e.isAnimationBlocked=!1),this.panSession&&this.panSession.end(),this.panSession=void 0;const{dragPropagation:o}=this.getProps();!o&&this.openDragLock&&(this.openDragLock(),this.openDragLock=null),i&&i.setActive("whileDrag",!1)}updateAxis(e,i,o){const{drag:l}=this.getProps();if(!o||!Y1(e,l,this.currentDirection))return;const u=this.getAxisMotionValue(e);let p=this.originPoint[e]+o[e];this.constraints&&this.constraints[e]&&(p=Yke(p,this.constraints[e],this.elastic[e])),u.set(p)}resolveConstraints(){var e;const{dragConstraints:i,dragElastic:o}=this.getProps(),l=this.visualElement.projection&&!this.visualElement.projection.layout?this.visualElement.projection.measure(!1):(e=this.visualElement.projection)===null||e===void 0?void 0:e.layout,u=this.constraints;i&&G0(i)?this.constraints||(this.constraints=this.resolveRefConstraints()):i&&l?this.constraints=Xke(l.layoutBox,i):this.constraints=!1,this.elastic=eOe(o),u!==this.constraints&&l&&this.constraints&&!this.hasMutatedConstraints&&Qu(p=>{this.constraints!==!1&&this.getAxisMotionValue(p)&&(this.constraints[p]=Zke(l.layoutBox[p],this.constraints[p]))})}resolveRefConstraints(){const{dragConstraints:e,onMeasureDragConstraints:i}=this.getProps();if(!e||!G0(e))return!1;const o=e.current,{projection:l}=this.visualElement;if(!l||!l.layout)return!1;const u=iOe(o,l.root,this.visualElement.getTransformPagePoint());let p=Jke(l.layout.layoutBox,u);if(i){const y=i(tOe(p));this.hasMutatedConstraints=!!y,y&&(p=cne(y))}return p}startAnimation(e){const{drag:i,dragMomentum:o,dragElastic:l,dragTransition:u,dragSnapToOrigin:p,onDragTransitionEnd:y}=this.getProps(),v=this.constraints||{},w=Qu(C=>{if(!Y1(C,i,this.currentDirection))return;let R=v&&v[C]||{};p&&(R={min:0,max:0});const N=l?200:1e6,M=l?40:1e7,L={type:"inertia",velocity:o?e[C]:0,bounceStiffness:N,bounceDamping:M,timeConstant:750,restDelta:1,restSpeed:10,...u,...R};return this.startAxisValueAnimation(C,L)});return Promise.all(w).then(y)}startAxisValueAnimation(e,i){const o=this.getAxisMotionValue(e);return xV(this.visualElement,e),o.start(Qj(e,o,0,i,this.visualElement,!1))}stopAnimation(){Qu(e=>this.getAxisMotionValue(e).stop())}pauseAnimation(){Qu(e=>{var i;return(i=this.getAxisMotionValue(e).animation)===null||i===void 0?void 0:i.pause()})}getAnimationState(e){var i;return(i=this.getAxisMotionValue(e).animation)===null||i===void 0?void 0:i.state}getAxisMotionValue(e){const i=`_drag${e.toUpperCase()}`,o=this.visualElement.getProps(),l=o[i];return l||this.visualElement.getValue(e,(o.initial?o.initial[e]:void 0)||0)}snapToCursor(e){Qu(i=>{const{drag:o}=this.getProps();if(!Y1(i,o,this.currentDirection))return;const{projection:l}=this.visualElement,u=this.getAxisMotionValue(i);if(l&&l.layout){const{min:p,max:y}=l.layout.layoutBox[i];u.set(e[i]-Rs(p,y,.5))}})}scalePositionWithinConstraints(){if(!this.visualElement.current)return;const{drag:e,dragConstraints:i}=this.getProps(),{projection:o}=this.visualElement;if(!G0(i)||!o||!this.constraints)return;this.stopAnimation();const l={x:0,y:0};Qu(p=>{const y=this.getAxisMotionValue(p);if(y&&this.constraints!==!1){const v=y.get();l[p]=Qke({min:v,max:v},this.constraints[p])}});const{transformTemplate:u}=this.visualElement.getProps();this.visualElement.current.style.transform=u?u({},""):"none",o.root&&o.root.updateScroll(),o.updateLayout(),this.resolveConstraints(),Qu(p=>{if(!Y1(p,e,null))return;const y=this.getAxisMotionValue(p),{min:v,max:w}=this.constraints[p];y.set(Rs(v,w,l[p]))})}addListeners(){if(!this.visualElement.current)return;sOe.set(this.visualElement,this);const e=this.visualElement.current,i=kC(e,"pointerdown",v=>{const{drag:w,dragListener:C=!0}=this.getProps();w&&C&&this.start(v)}),o=()=>{const{dragConstraints:v}=this.getProps();G0(v)&&v.current&&(this.constraints=this.resolveRefConstraints())},{projection:l}=this.visualElement,u=l.addEventListener("measure",o);l&&!l.layout&&(l.root&&l.root.updateScroll(),l.updateLayout()),cs.read(o);const p=nR(window,"resize",()=>this.scalePositionWithinConstraints()),y=l.addEventListener("didUpdate",({delta:v,hasLayoutChanged:w})=>{this.isDragging&&w&&(Qu(C=>{const R=this.getAxisMotionValue(C);R&&(this.originPoint[C]+=v[C].translate,R.set(R.get()+v[C].translate))}),this.visualElement.render())});return()=>{p(),i(),u(),y&&y()}}getProps(){const e=this.visualElement.getProps(),{drag:i=!1,dragDirectionLock:o=!1,dragPropagation:l=!1,dragConstraints:u=!1,dragElastic:p=zV,dragMomentum:y=!0}=e;return{...e,drag:i,dragDirectionLock:o,dragPropagation:l,dragConstraints:u,dragElastic:p,dragMomentum:y}}}function Y1(n,e,i){return(e===!0||e===n)&&(i===null||i===n)}function aOe(n,e=10){let i=null;return Math.abs(n.y)>e?i="y":Math.abs(n.x)>e&&(i="x"),i}class cOe extends Kg{constructor(e){super(e),this.removeGroupControls=iu,this.removeListeners=iu,this.controls=new oOe(e)}mount(){const{dragControls:e}=this.node.getProps();e&&(this.removeGroupControls=e.subscribe(this.controls)),this.removeListeners=this.controls.addListeners()||iu}unmount(){this.removeGroupControls(),this.removeListeners()}}const jY=n=>(e,i)=>{n&&cs.postRender(()=>n(e,i))};class lOe extends Kg{constructor(){super(...arguments),this.removePointerDownListener=iu}onPointerDown(e){this.session=new ine(e,this.createPanHandlers(),{transformPagePoint:this.node.getTransformPagePoint(),contextWindow:hne(this.node)})}createPanHandlers(){const{onPanSessionStart:e,onPanStart:i,onPan:o,onPanEnd:l}=this.node.getProps();return{onSessionStart:jY(e),onStart:jY(i),onMove:o,onEnd:(u,p)=>{delete this.session,l&&cs.postRender(()=>l(u,p))}}}mount(){this.removePointerDownListener=kC(this.node.current,"pointerdown",e=>this.onPointerDown(e))}update(){this.session&&this.session.updateHandlers(this.createPanHandlers())}unmount(){this.removePointerDownListener(),this.session&&this.session.end()}}const Nk={hasAnimatedSinceResize:!0,hasEverUpdated:!1};function BY(n,e){return e.max===e.min?0:n/(e.max-e.min)*100}const GT={correct:(n,e)=>{if(!e.target)return n;if(typeof n=="string")if($n.test(n))n=parseFloat(n);else return n;const i=BY(n,e.target.x),o=BY(n,e.target.y);return`${i}% ${o}%`}},uOe={correct:(n,{treeScale:e,projectionDelta:i})=>{const o=n,l=Mg.parse(n);if(l.length>5)return o;const u=Mg.createTransformer(n),p=typeof l[0]!="number"?1:0,y=i.x.scale*e.x,v=i.y.scale*e.y;l[0+p]/=y,l[1+p]/=v;const w=Rs(y,v,.5);return typeof l[2+p]=="number"&&(l[2+p]/=w),typeof l[3+p]=="number"&&(l[3+p]/=w),u(l)}};class dOe extends O.Component{componentDidMount(){const{visualElement:e,layoutGroup:i,switchLayoutGroup:o,layoutId:l}=this.props,{projection:u}=e;OPe(hOe),u&&(i.group&&i.group.add(u),o&&o.register&&l&&o.register(u),u.root.didUpdate(),u.addEventListener("animationComplete",()=>{this.safeToRemove()}),u.setOptions({...u.options,onExitComplete:()=>this.safeToRemove()})),Nk.hasEverUpdated=!0}getSnapshotBeforeUpdate(e){const{layoutDependency:i,visualElement:o,drag:l,isPresent:u}=this.props,p=o.projection;return p&&(p.isPresent=u,l||e.layoutDependency!==i||i===void 0?p.willUpdate():this.safeToRemove(),e.isPresent!==u&&(u?p.promote():p.relegate()||cs.postRender(()=>{const y=p.getStack();(!y||!y.members.length)&&this.safeToRemove()}))),null}componentDidUpdate(){const{projection:e}=this.props.visualElement;e&&(e.root.didUpdate(),Ij.postRender(()=>{!e.currentAnimation&&e.isLead()&&this.safeToRemove()}))}componentWillUnmount(){const{visualElement:e,layoutGroup:i,switchLayoutGroup:o}=this.props,{projection:l}=e;l&&(l.scheduleCheckAfterUnmount(),i&&i.group&&i.group.remove(l),o&&o.deregister&&o.deregister(l))}safeToRemove(){const{safeToRemove:e}=this.props;e&&e()}render(){return null}}function pne(n){const[e,i]=Sj(),o=O.useContext(yj);return S.jsx(dOe,{...n,layoutGroup:o,switchLayoutGroup:O.useContext(rte),isPresent:e,safeToRemove:i})}const hOe={borderRadius:{...GT,applyTo:["borderTopLeftRadius","borderTopRightRadius","borderBottomLeftRadius","borderBottomRightRadius"]},borderTopLeftRadius:GT,borderTopRightRadius:GT,borderBottomLeftRadius:GT,borderBottomRightRadius:GT,boxShadow:uOe};function pOe(n,e,i){const o=oc(n)?n:eR(n);return o.start(Qj("",o,e,i)),o.animation}function fOe(n){return n instanceof SVGElement&&n.tagName!=="svg"}const mOe=(n,e)=>n.depth-e.depth;class gOe{constructor(){this.children=[],this.isDirty=!1}add(e){Bj(this.children,e),this.isDirty=!0}remove(e){zj(this.children,e),this.isDirty=!0}forEach(e){this.isDirty&&this.children.sort(mOe),this.isDirty=!1,this.children.forEach(e)}}function _Oe(n,e){const i=Cp.now(),o=({timestamp:l})=>{const u=l-i;u>=e&&(Lg(o),n(u-e))};return cs.read(o,!0),()=>Lg(o)}const fne=["TopLeft","TopRight","BottomLeft","BottomRight"],yOe=fne.length,zY=n=>typeof n=="string"?parseFloat(n):n,WY=n=>typeof n=="number"||$n.test(n);function EOe(n,e,i,o,l,u){l?(n.opacity=Rs(0,i.opacity!==void 0?i.opacity:1,vOe(o)),n.opacityExit=Rs(e.opacity!==void 0?e.opacity:1,0,SOe(o))):u&&(n.opacity=Rs(e.opacity!==void 0?e.opacity:1,i.opacity!==void 0?i.opacity:1,o));for(let p=0;p<yOe;p++){const y=`border${fne[p]}Radius`;let v=GY(e,y),w=GY(i,y);if(v===void 0&&w===void 0)continue;v||(v=0),w||(w=0),v===0||w===0||WY(v)===WY(w)?(n[y]=Math.max(Rs(zY(v),zY(w),o),0),(Tp.test(w)||Tp.test(v))&&(n[y]+="%")):n[y]=w}(e.rotate||i.rotate)&&(n.rotate=Rs(e.rotate||0,i.rotate||0,o))}function GY(n,e){return n[e]!==void 0?n[e]:n.borderRadius}const vOe=mne(0,.5,Dte),SOe=mne(.5,.95,iu);function mne(n,e,i){return o=>o<n?0:o>e?1:i(bS(n,e,o))}function HY(n,e){n.min=e.min,n.max=e.max}function Yu(n,e){HY(n.x,e.x),HY(n.y,e.y)}function $Y(n,e){n.translate=e.translate,n.scale=e.scale,n.originPoint=e.originPoint,n.origin=e.origin}function KY(n,e,i,o,l){return n-=e,n=uO(n,1/i,o),l!==void 0&&(n=uO(n,1/l,o)),n}function bOe(n,e=0,i=1,o=.5,l,u=n,p=n){if(Tp.test(e)&&(e=parseFloat(e),e=Rs(p.min,p.max,e/100)-p.min),typeof e!="number")return;let y=Rs(u.min,u.max,o);n===u&&(y-=e),n.min=KY(n.min,e,i,y,l),n.max=KY(n.max,e,i,y,l)}function qY(n,e,[i,o,l],u,p){bOe(n,e[i],e[o],e[l],e.scale,u,p)}const wOe=["x","scaleX","originX"],TOe=["y","scaleY","originY"];function YY(n,e,i,o){qY(n.x,e,wOe,i?i.x:void 0,o?o.x:void 0),qY(n.y,e,TOe,i?i.y:void 0,o?o.y:void 0)}function XY(n){return n.translate===0&&n.scale===1}function gne(n){return XY(n.x)&&XY(n.y)}function JY(n,e){return n.min===e.min&&n.max===e.max}function COe(n,e){return JY(n.x,e.x)&&JY(n.y,e.y)}function QY(n,e){return Math.round(n.min)===Math.round(e.min)&&Math.round(n.max)===Math.round(e.max)}function _ne(n,e){return QY(n.x,e.x)&&QY(n.y,e.y)}function ZY(n){return ou(n.x)/ou(n.y)}function eX(n,e){return n.translate===e.translate&&n.scale===e.scale&&n.originPoint===e.originPoint}class ROe{constructor(){this.members=[]}add(e){Bj(this.members,e),e.scheduleRender()}remove(e){if(zj(this.members,e),e===this.prevLead&&(this.prevLead=void 0),e===this.lead){const i=this.members[this.members.length-1];i&&this.promote(i)}}relegate(e){const i=this.members.findIndex(l=>e===l);if(i===0)return!1;let o;for(let l=i;l>=0;l--){const u=this.members[l];if(u.isPresent!==!1){o=u;break}}return o?(this.promote(o),!0):!1}promote(e,i){const o=this.lead;if(e!==o&&(this.prevLead=o,this.lead=e,e.show(),o)){o.instance&&o.scheduleRender(),e.scheduleRender(),e.resumeFrom=o,i&&(e.resumeFrom.preserveOpacity=!0),o.snapshot&&(e.snapshot=o.snapshot,e.snapshot.latestValues=o.animationValues||o.latestValues),e.root&&e.root.isUpdating&&(e.isLayoutDirty=!0);const{crossfade:l}=e.options;l===!1&&o.hide()}}exitAnimationComplete(){this.members.forEach(e=>{const{options:i,resumingFrom:o}=e;i.onExitComplete&&i.onExitComplete(),o&&o.options.onExitComplete&&o.options.onExitComplete()})}scheduleRender(){this.members.forEach(e=>{e.instance&&e.scheduleRender(!1)})}removeLeadSnapshot(){this.lead&&this.lead.snapshot&&(this.lead.snapshot=void 0)}}function IOe(n,e,i){let o="";const l=n.x.translate/e.x,u=n.y.translate/e.y,p=(i==null?void 0:i.z)||0;if((l||u||p)&&(o=`translate3d(${l}px, ${u}px, ${p}px) `),(e.x!==1||e.y!==1)&&(o+=`scale(${1/e.x}, ${1/e.y}) `),i){const{transformPerspective:w,rotate:C,rotateX:R,rotateY:N,skewX:M,skewY:L}=i;w&&(o=`perspective(${w}px) ${o}`),C&&(o+=`rotate(${C}deg) `),R&&(o+=`rotateX(${R}deg) `),N&&(o+=`rotateY(${N}deg) `),M&&(o+=`skewX(${M}deg) `),L&&(o+=`skewY(${L}deg) `)}const y=n.x.scale*e.x,v=n.y.scale*e.y;return(y!==1||v!==1)&&(o+=`scale(${y}, ${v})`),o||"none"}const Iy={type:"projectionFrame",totalNodes:0,resolvedTargetDeltas:0,recalculatedProjection:0},hC=typeof window<"u"&&window.MotionDebug!==void 0,RU=["","X","Y","Z"],AOe={visibility:"hidden"},tX=1e3;let POe=0;function IU(n,e,i,o){const{latestValues:l}=e;l[n]&&(i[n]=l[n],e.setStaticValue(n,0),o&&(o[n]=0))}function yne(n){if(n.hasCheckedOptimisedAppear=!0,n.root===n)return;const{visualElement:e}=n.options;if(!e)return;const i=Rte(e);if(window.MotionHasOptimisedAnimation(i,"transform")){const{layout:l,layoutId:u}=n.options;window.MotionCancelOptimisedAnimation(i,"transform",cs,!(l||u))}const{parent:o}=n;o&&!o.hasCheckedOptimisedAppear&&yne(o)}function Ene({attachResizeListener:n,defaultParent:e,measureScroll:i,checkIsScrollRoot:o,resetTransform:l}){return class{constructor(p={},y=e==null?void 0:e()){this.id=POe++,this.animationId=0,this.children=new Set,this.options={},this.isTreeAnimating=!1,this.isAnimationBlocked=!1,this.isLayoutDirty=!1,this.isProjectionDirty=!1,this.isSharedProjectionDirty=!1,this.isTransformDirty=!1,this.updateManuallyBlocked=!1,this.updateBlockedByResize=!1,this.isUpdating=!1,this.isSVG=!1,this.needsReset=!1,this.shouldResetTransform=!1,this.hasCheckedOptimisedAppear=!1,this.treeScale={x:1,y:1},this.eventHandlers=new Map,this.hasTreeAnimated=!1,this.updateScheduled=!1,this.scheduleUpdate=()=>this.update(),this.projectionUpdateScheduled=!1,this.checkUpdateFailed=()=>{this.isUpdating&&(this.isUpdating=!1,this.clearAllSnapshots())},this.updateProjection=()=>{this.projectionUpdateScheduled=!1,hC&&(Iy.totalNodes=Iy.resolvedTargetDeltas=Iy.recalculatedProjection=0),this.nodes.forEach(NOe),this.nodes.forEach(UOe),this.nodes.forEach(VOe),this.nodes.forEach(DOe),hC&&window.MotionDebug.record(Iy)},this.resolvedRelativeTargetAt=0,this.hasProjected=!1,this.isVisible=!0,this.animationProgress=0,this.sharedNodes=new Map,this.latestValues=p,this.root=y?y.root||y:this,this.path=y?[...y.path,y]:[],this.parent=y,this.depth=y?y.depth+1:0;for(let v=0;v<this.path.length;v++)this.path[v].shouldResetTransform=!0;this.root===this&&(this.nodes=new gOe)}addEventListener(p,y){return this.eventHandlers.has(p)||this.eventHandlers.set(p,new Wj),this.eventHandlers.get(p).add(y)}notifyListeners(p,...y){const v=this.eventHandlers.get(p);v&&v.notify(...y)}hasListeners(p){return this.eventHandlers.has(p)}mount(p,y=this.root.hasTreeAnimated){if(this.instance)return;this.isSVG=fOe(p),this.instance=p;const{layoutId:v,layout:w,visualElement:C}=this.options;if(C&&!C.current&&C.mount(p),this.root.nodes.add(this),this.parent&&this.parent.children.add(this),y&&(w||v)&&(this.isLayoutDirty=!0),n){let R;const N=()=>this.root.updateBlockedByResize=!1;n(p,()=>{this.root.updateBlockedByResize=!0,R&&R(),R=_Oe(N,250),Nk.hasAnimatedSinceResize&&(Nk.hasAnimatedSinceResize=!1,this.nodes.forEach(rX))})}v&&this.root.registerSharedNode(v,this),this.options.animate!==!1&&C&&(v||w)&&this.addEventListener("didUpdate",({delta:R,hasLayoutChanged:N,hasRelativeTargetChanged:M,layout:L})=>{if(this.isTreeAnimationBlocked()){this.target=void 0,this.relativeTarget=void 0;return}const U=this.options.transition||C.getDefaultTransition()||WOe,{onLayoutAnimationStart:z,onLayoutAnimationComplete:J}=C.getProps(),q=!this.targetLayout||!_ne(this.targetLayout,L)||M,re=!N&&M;if(this.options.layoutRoot||this.resumeFrom&&this.resumeFrom.instance||re||N&&(q||!this.currentAnimation)){this.resumeFrom&&(this.resumingFrom=this.resumeFrom,this.resumingFrom.resumingFrom=void 0),this.setAnimationOrigin(R,re);const ce={...Uj(U,"layout"),onPlay:z,onComplete:J};(C.shouldReduceMotion||this.options.layoutRoot)&&(ce.delay=0,ce.type=!1),this.startAnimation(ce)}else N||rX(this),this.isLead()&&this.options.onExitComplete&&this.options.onExitComplete();this.targetLayout=L})}unmount(){this.options.layoutId&&this.willUpdate(),this.root.nodes.remove(this);const p=this.getStack();p&&p.remove(this),this.parent&&this.parent.children.delete(this),this.instance=void 0,Lg(this.updateProjection)}blockUpdate(){this.updateManuallyBlocked=!0}unblockUpdate(){this.updateManuallyBlocked=!1}isUpdateBlocked(){return this.updateManuallyBlocked||this.updateBlockedByResize}isTreeAnimationBlocked(){return this.isAnimationBlocked||this.parent&&this.parent.isTreeAnimationBlocked()||!1}startUpdate(){this.isUpdateBlocked()||(this.isUpdating=!0,this.nodes&&this.nodes.forEach(FOe),this.animationId++)}getTransformTemplate(){const{visualElement:p}=this.options;return p&&p.getProps().transformTemplate}willUpdate(p=!0){if(this.root.hasTreeAnimated=!0,this.root.isUpdateBlocked()){this.options.onExitComplete&&this.options.onExitComplete();return}if(window.MotionCancelOptimisedAnimation&&!this.hasCheckedOptimisedAppear&&yne(this),!this.root.isUpdating&&this.root.startUpdate(),this.isLayoutDirty)return;this.isLayoutDirty=!0;for(let C=0;C<this.path.length;C++){const R=this.path[C];R.shouldResetTransform=!0,R.updateScroll("snapshot"),R.options.layoutRoot&&R.willUpdate(!1)}const{layoutId:y,layout:v}=this.options;if(y===void 0&&!v)return;const w=this.getTransformTemplate();this.prevTransformTemplateValue=w?w(this.latestValues,""):void 0,this.updateSnapshot(),p&&this.notifyListeners("willUpdate")}update(){if(this.updateScheduled=!1,this.isUpdateBlocked()){this.unblockUpdate(),this.clearAllSnapshots(),this.nodes.forEach(nX);return}this.isUpdating||this.nodes.forEach(LOe),this.isUpdating=!1,this.nodes.forEach(MOe),this.nodes.forEach(kOe),this.nodes.forEach(OOe),this.clearAllSnapshots();const y=Cp.now();Ra.delta=zf(0,1e3/60,y-Ra.timestamp),Ra.timestamp=y,Ra.isProcessing=!0,yU.update.process(Ra),yU.preRender.process(Ra),yU.render.process(Ra),Ra.isProcessing=!1}didUpdate(){this.updateScheduled||(this.updateScheduled=!0,Ij.read(this.scheduleUpdate))}clearAllSnapshots(){this.nodes.forEach(xOe),this.sharedNodes.forEach(jOe)}scheduleUpdateProjection(){this.projectionUpdateScheduled||(this.projectionUpdateScheduled=!0,cs.preRender(this.updateProjection,!1,!0))}scheduleCheckAfterUnmount(){cs.postRender(()=>{this.isLayoutDirty?this.root.didUpdate():this.root.checkUpdateFailed()})}updateSnapshot(){this.snapshot||!this.instance||(this.snapshot=this.measure())}updateLayout(){if(!this.instance||(this.updateScroll(),!(this.options.alwaysMeasureLayout&&this.isLead())&&!this.isLayoutDirty))return;if(this.resumeFrom&&!this.resumeFrom.instance)for(let v=0;v<this.path.length;v++)this.path[v].updateScroll();const p=this.layout;this.layout=this.measure(!1),this.layoutCorrected=to(),this.isLayoutDirty=!1,this.projectionDelta=void 0,this.notifyListeners("measure",this.layout.layoutBox);const{visualElement:y}=this.options;y&&y.notify("LayoutMeasure",this.layout.layoutBox,p?p.layoutBox:void 0)}updateScroll(p="measure"){let y=!!(this.options.layoutScroll&&this.instance);if(this.scroll&&this.scroll.animationId===this.root.animationId&&this.scroll.phase===p&&(y=!1),y){const v=o(this.instance);this.scroll={animationId:this.root.animationId,phase:p,isRoot:v,offset:i(this.instance),wasRoot:this.scroll?this.scroll.isRoot:v}}}resetTransform(){if(!l)return;const p=this.isLayoutDirty||this.shouldResetTransform||this.options.alwaysMeasureLayout,y=this.projectionDelta&&!gne(this.projectionDelta),v=this.getTransformTemplate(),w=v?v(this.latestValues,""):void 0,C=w!==this.prevTransformTemplateValue;p&&(y||Ry(this.latestValues)||C)&&(l(this.instance,w),this.shouldResetTransform=!1,this.scheduleRender())}measure(p=!0){const y=this.measurePageBox();let v=this.removeElementScroll(y);return p&&(v=this.removeTransform(v)),GOe(v),{animationId:this.root.animationId,measuredBox:y,layoutBox:v,latestValues:{},source:this.id}}measurePageBox(){var p;const{visualElement:y}=this.options;if(!y)return to();const v=y.measureViewportBox();if(!(((p=this.scroll)===null||p===void 0?void 0:p.wasRoot)||this.path.some(HOe))){const{scroll:C}=this.root;C&&(K0(v.x,C.offset.x),K0(v.y,C.offset.y))}return v}removeElementScroll(p){var y;const v=to();if(Yu(v,p),!((y=this.scroll)===null||y===void 0)&&y.wasRoot)return v;for(let w=0;w<this.path.length;w++){const C=this.path[w],{scroll:R,options:N}=C;C!==this.root&&R&&N.layoutScroll&&(R.wasRoot&&Yu(v,p),K0(v.x,R.offset.x),K0(v.y,R.offset.y))}return v}applyTransform(p,y=!1){const v=to();Yu(v,p);for(let w=0;w<this.path.length;w++){const C=this.path[w];!y&&C.options.layoutScroll&&C.scroll&&C!==C.root&&q0(v,{x:-C.scroll.offset.x,y:-C.scroll.offset.y}),Ry(C.latestValues)&&q0(v,C.latestValues)}return Ry(this.latestValues)&&q0(v,this.latestValues),v}removeTransform(p){const y=to();Yu(y,p);for(let v=0;v<this.path.length;v++){const w=this.path[v];if(!w.instance||!Ry(w.latestValues))continue;WV(w.latestValues)&&w.updateSnapshot();const C=to(),R=w.measurePageBox();Yu(C,R),YY(y,w.latestValues,w.snapshot?w.snapshot.layoutBox:void 0,C)}return Ry(this.latestValues)&&YY(y,this.latestValues),y}setTargetDelta(p){this.targetDelta=p,this.root.scheduleUpdateProjection(),this.isProjectionDirty=!0}setOptions(p){this.options={...this.options,...p,crossfade:p.crossfade!==void 0?p.crossfade:!0}}clearMeasurements(){this.scroll=void 0,this.layout=void 0,this.snapshot=void 0,this.prevTransformTemplateValue=void 0,this.targetDelta=void 0,this.target=void 0,this.isLayoutDirty=!1}forceRelativeParentToResolveTarget(){this.relativeParent&&this.relativeParent.resolvedRelativeTargetAt!==Ra.timestamp&&this.relativeParent.resolveTargetDelta(!0)}resolveTargetDelta(p=!1){var y;const v=this.getLead();this.isProjectionDirty||(this.isProjectionDirty=v.isProjectionDirty),this.isTransformDirty||(this.isTransformDirty=v.isTransformDirty),this.isSharedProjectionDirty||(this.isSharedProjectionDirty=v.isSharedProjectionDirty);const w=!!this.resumingFrom||this!==v;if(!(p||w&&this.isSharedProjectionDirty||this.isProjectionDirty||!((y=this.parent)===null||y===void 0)&&y.isProjectionDirty||this.attemptToResolveRelativeTarget||this.root.updateBlockedByResize))return;const{layout:R,layoutId:N}=this.options;if(!(!this.layout||!(R||N))){if(this.resolvedRelativeTargetAt=Ra.timestamp,!this.targetDelta&&!this.relativeTarget){const M=this.getClosestProjectingParent();M&&M.layout&&this.animationProgress!==1?(this.relativeParent=M,this.forceRelativeParentToResolveTarget(),this.relativeTarget=to(),this.relativeTargetOrigin=to(),NC(this.relativeTargetOrigin,this.layout.layoutBox,M.layout.layoutBox),Yu(this.relativeTarget,this.relativeTargetOrigin)):this.relativeParent=this.relativeTarget=void 0}if(!(!this.relativeTarget&&!this.targetDelta)){if(this.target||(this.target=to(),this.targetWithTransforms=to()),this.relativeTarget&&this.relativeTargetOrigin&&this.relativeParent&&this.relativeParent.target?(this.forceRelativeParentToResolveTarget(),qke(this.target,this.relativeTarget,this.relativeParent.target)):this.targetDelta?(this.resumingFrom?this.target=this.applyTransform(this.layout.layoutBox):Yu(this.target,this.layout.layoutBox),une(this.target,this.targetDelta)):Yu(this.target,this.layout.layoutBox),this.attemptToResolveRelativeTarget){this.attemptToResolveRelativeTarget=!1;const M=this.getClosestProjectingParent();M&&!!M.resumingFrom==!!this.resumingFrom&&!M.options.layoutScroll&&M.target&&this.animationProgress!==1?(this.relativeParent=M,this.forceRelativeParentToResolveTarget(),this.relativeTarget=to(),this.relativeTargetOrigin=to(),NC(this.relativeTargetOrigin,this.target,M.target),Yu(this.relativeTarget,this.relativeTargetOrigin)):this.relativeParent=this.relativeTarget=void 0}hC&&Iy.resolvedTargetDeltas++}}}getClosestProjectingParent(){if(!(!this.parent||WV(this.parent.latestValues)||lne(this.parent.latestValues)))return this.parent.isProjecting()?this.parent:this.parent.getClosestProjectingParent()}isProjecting(){return!!((this.relativeTarget||this.targetDelta||this.options.layoutRoot)&&this.layout)}calcProjection(){var p;const y=this.getLead(),v=!!this.resumingFrom||this!==y;let w=!0;if((this.isProjectionDirty||!((p=this.parent)===null||p===void 0)&&p.isProjectionDirty)&&(w=!1),v&&(this.isSharedProjectionDirty||this.isTransformDirty)&&(w=!1),this.resolvedRelativeTargetAt===Ra.timestamp&&(w=!1),w)return;const{layout:C,layoutId:R}=this.options;if(this.isTreeAnimating=!!(this.parent&&this.parent.isTreeAnimating||this.currentAnimation||this.pendingAnimation),this.isTreeAnimating||(this.targetDelta=this.relativeTarget=void 0),!this.layout||!(C||R))return;Yu(this.layoutCorrected,this.layout.layoutBox);const N=this.treeScale.x,M=this.treeScale.y;rOe(this.layoutCorrected,this.treeScale,this.path,v),y.layout&&!y.target&&(this.treeScale.x!==1||this.treeScale.y!==1)&&(y.target=y.layout.layoutBox,y.targetWithTransforms=to());const{target:L}=y;if(!L){this.prevProjectionDelta&&(this.createProjectionDeltas(),this.scheduleRender());return}!this.projectionDelta||!this.prevProjectionDelta?this.createProjectionDeltas():($Y(this.prevProjectionDelta.x,this.projectionDelta.x),$Y(this.prevProjectionDelta.y,this.projectionDelta.y)),OC(this.projectionDelta,this.layoutCorrected,L,this.latestValues),(this.treeScale.x!==N||this.treeScale.y!==M||!eX(this.projectionDelta.x,this.prevProjectionDelta.x)||!eX(this.projectionDelta.y,this.prevProjectionDelta.y))&&(this.hasProjected=!0,this.scheduleRender(),this.notifyListeners("projectionUpdate",L)),hC&&Iy.recalculatedProjection++}hide(){this.isVisible=!1}show(){this.isVisible=!0}scheduleRender(p=!0){var y;if((y=this.options.visualElement)===null||y===void 0||y.scheduleRender(),p){const v=this.getStack();v&&v.scheduleRender()}this.resumingFrom&&!this.resumingFrom.instance&&(this.resumingFrom=void 0)}createProjectionDeltas(){this.prevProjectionDelta=$0(),this.projectionDelta=$0(),this.projectionDeltaWithTransform=$0()}setAnimationOrigin(p,y=!1){const v=this.snapshot,w=v?v.latestValues:{},C={...this.latestValues},R=$0();(!this.relativeParent||!this.relativeParent.options.layoutRoot)&&(this.relativeTarget=this.relativeTargetOrigin=void 0),this.attemptToResolveRelativeTarget=!y;const N=to(),M=v?v.source:void 0,L=this.layout?this.layout.source:void 0,U=M!==L,z=this.getStack(),J=!z||z.members.length<=1,q=!!(U&&!J&&this.options.crossfade===!0&&!this.path.some(zOe));this.animationProgress=0;let re;this.mixTargetDelta=ce=>{const ae=ce/1e3;iX(R.x,p.x,ae),iX(R.y,p.y,ae),this.setTargetDelta(R),this.relativeTarget&&this.relativeTargetOrigin&&this.layout&&this.relativeParent&&this.relativeParent.layout&&(NC(N,this.layout.layoutBox,this.relativeParent.layout.layoutBox),BOe(this.relativeTarget,this.relativeTargetOrigin,N,ae),re&&COe(this.relativeTarget,re)&&(this.isProjectionDirty=!1),re||(re=to()),Yu(re,this.relativeTarget)),U&&(this.animationValues=C,EOe(C,w,this.latestValues,ae,q,J)),this.root.scheduleUpdateProjection(),this.scheduleRender(),this.animationProgress=ae},this.mixTargetDelta(this.options.layoutRoot?1e3:0)}startAnimation(p){this.notifyListeners("animationStart"),this.currentAnimation&&this.currentAnimation.stop(),this.resumingFrom&&this.resumingFrom.currentAnimation&&this.resumingFrom.currentAnimation.stop(),this.pendingAnimation&&(Lg(this.pendingAnimation),this.pendingAnimation=void 0),this.pendingAnimation=cs.update(()=>{Nk.hasAnimatedSinceResize=!0,this.currentAnimation=pOe(0,tX,{...p,onUpdate:y=>{this.mixTargetDelta(y),p.onUpdate&&p.onUpdate(y)},onComplete:()=>{p.onComplete&&p.onComplete(),this.completeAnimation()}}),this.resumingFrom&&(this.resumingFrom.currentAnimation=this.currentAnimation),this.pendingAnimation=void 0})}completeAnimation(){this.resumingFrom&&(this.resumingFrom.currentAnimation=void 0,this.resumingFrom.preserveOpacity=void 0);const p=this.getStack();p&&p.exitAnimationComplete(),this.resumingFrom=this.currentAnimation=this.animationValues=void 0,this.notifyListeners("animationComplete")}finishAnimation(){this.currentAnimation&&(this.mixTargetDelta&&this.mixTargetDelta(tX),this.currentAnimation.stop()),this.completeAnimation()}applyTransformsToTarget(){const p=this.getLead();let{targetWithTransforms:y,target:v,layout:w,latestValues:C}=p;if(!(!y||!v||!w)){if(this!==p&&this.layout&&w&&vne(this.options.animationType,this.layout.layoutBox,w.layoutBox)){v=this.target||to();const R=ou(this.layout.layoutBox.x);v.x.min=p.target.x.min,v.x.max=v.x.min+R;const N=ou(this.layout.layoutBox.y);v.y.min=p.target.y.min,v.y.max=v.y.min+N}Yu(y,v),q0(y,C),OC(this.projectionDeltaWithTransform,this.layoutCorrected,y,C)}}registerSharedNode(p,y){this.sharedNodes.has(p)||this.sharedNodes.set(p,new ROe),this.sharedNodes.get(p).add(y);const w=y.options.initialPromotionConfig;y.promote({transition:w?w.transition:void 0,preserveFollowOpacity:w&&w.shouldPreserveFollowOpacity?w.shouldPreserveFollowOpacity(y):void 0})}isLead(){const p=this.getStack();return p?p.lead===this:!0}getLead(){var p;const{layoutId:y}=this.options;return y?((p=this.getStack())===null||p===void 0?void 0:p.lead)||this:this}getPrevLead(){var p;const{layoutId:y}=this.options;return y?(p=this.getStack())===null||p===void 0?void 0:p.prevLead:void 0}getStack(){const{layoutId:p}=this.options;if(p)return this.root.sharedNodes.get(p)}promote({needsReset:p,transition:y,preserveFollowOpacity:v}={}){const w=this.getStack();w&&w.promote(this,v),p&&(this.projectionDelta=void 0,this.needsReset=!0),y&&this.setOptions({transition:y})}relegate(){const p=this.getStack();return p?p.relegate(this):!1}resetSkewAndRotation(){const{visualElement:p}=this.options;if(!p)return;let y=!1;const{latestValues:v}=p;if((v.z||v.rotate||v.rotateX||v.rotateY||v.rotateZ||v.skewX||v.skewY)&&(y=!0),!y)return;const w={};v.z&&IU("z",p,w,this.animationValues);for(let C=0;C<RU.length;C++)IU(`rotate${RU[C]}`,p,w,this.animationValues),IU(`skew${RU[C]}`,p,w,this.animationValues);p.render();for(const C in w)p.setStaticValue(C,w[C]),this.animationValues&&(this.animationValues[C]=w[C]);p.scheduleRender()}getProjectionStyles(p){var y,v;if(!this.instance||this.isSVG)return;if(!this.isVisible)return AOe;const w={visibility:""},C=this.getTransformTemplate();if(this.needsReset)return this.needsReset=!1,w.opacity="",w.pointerEvents=kk(p==null?void 0:p.pointerEvents)||"",w.transform=C?C(this.latestValues,""):"none",w;const R=this.getLead();if(!this.projectionDelta||!this.layout||!R.target){const U={};return this.options.layoutId&&(U.opacity=this.latestValues.opacity!==void 0?this.latestValues.opacity:1,U.pointerEvents=kk(p==null?void 0:p.pointerEvents)||""),this.hasProjected&&!Ry(this.latestValues)&&(U.transform=C?C({},""):"none",this.hasProjected=!1),U}const N=R.animationValues||R.latestValues;this.applyTransformsToTarget(),w.transform=IOe(this.projectionDeltaWithTransform,this.treeScale,N),C&&(w.transform=C(N,w.transform));const{x:M,y:L}=this.projectionDelta;w.transformOrigin=`${M.origin*100}% ${L.origin*100}% 0`,R.animationValues?w.opacity=R===this?(v=(y=N.opacity)!==null&&y!==void 0?y:this.latestValues.opacity)!==null&&v!==void 0?v:1:this.preserveOpacity?this.latestValues.opacity:N.opacityExit:w.opacity=R===this?N.opacity!==void 0?N.opacity:"":N.opacityExit!==void 0?N.opacityExit:0;for(const U in sO){if(N[U]===void 0)continue;const{correct:z,applyTo:J}=sO[U],q=w.transform==="none"?N[U]:z(N[U],R);if(J){const re=J.length;for(let ce=0;ce<re;ce++)w[J[ce]]=q}else w[U]=q}return this.options.layoutId&&(w.pointerEvents=R===this?kk(p==null?void 0:p.pointerEvents)||"":"none"),w}clearSnapshot(){this.resumeFrom=this.snapshot=void 0}resetTree(){this.root.nodes.forEach(p=>{var y;return(y=p.currentAnimation)===null||y===void 0?void 0:y.stop()}),this.root.nodes.forEach(nX),this.root.sharedNodes.clear()}}}function kOe(n){n.updateLayout()}function OOe(n){var e;const i=((e=n.resumeFrom)===null||e===void 0?void 0:e.snapshot)||n.snapshot;if(n.isLead()&&n.layout&&i&&n.hasListeners("didUpdate")){const{layoutBox:o,measuredBox:l}=n.layout,{animationType:u}=n.options,p=i.source!==n.layout.source;u==="size"?Qu(R=>{const N=p?i.measuredBox[R]:i.layoutBox[R],M=ou(N);N.min=o[R].min,N.max=N.min+M}):vne(u,i.layoutBox,o)&&Qu(R=>{const N=p?i.measuredBox[R]:i.layoutBox[R],M=ou(o[R]);N.max=N.min+M,n.relativeTarget&&!n.currentAnimation&&(n.isProjectionDirty=!0,n.relativeTarget[R].max=n.relativeTarget[R].min+M)});const y=$0();OC(y,o,i.layoutBox);const v=$0();p?OC(v,n.applyTransform(l,!0),i.measuredBox):OC(v,o,i.layoutBox);const w=!gne(y);let C=!1;if(!n.resumeFrom){const R=n.getClosestProjectingParent();if(R&&!R.resumeFrom){const{snapshot:N,layout:M}=R;if(N&&M){const L=to();NC(L,i.layoutBox,N.layoutBox);const U=to();NC(U,o,M.layoutBox),_ne(L,U)||(C=!0),R.options.layoutRoot&&(n.relativeTarget=U,n.relativeTargetOrigin=L,n.relativeParent=R)}}}n.notifyListeners("didUpdate",{layout:o,snapshot:i,delta:v,layoutDelta:y,hasLayoutChanged:w,hasRelativeTargetChanged:C})}else if(n.isLead()){const{onExitComplete:o}=n.options;o&&o()}n.options.transition=void 0}function NOe(n){hC&&Iy.totalNodes++,n.parent&&(n.isProjecting()||(n.isProjectionDirty=n.parent.isProjectionDirty),n.isSharedProjectionDirty||(n.isSharedProjectionDirty=!!(n.isProjectionDirty||n.parent.isProjectionDirty||n.parent.isSharedProjectionDirty)),n.isTransformDirty||(n.isTransformDirty=n.parent.isTransformDirty))}function DOe(n){n.isProjectionDirty=n.isSharedProjectionDirty=n.isTransformDirty=!1}function xOe(n){n.clearSnapshot()}function nX(n){n.clearMeasurements()}function LOe(n){n.isLayoutDirty=!1}function MOe(n){const{visualElement:e}=n.options;e&&e.getProps().onBeforeLayoutMeasure&&e.notify("BeforeLayoutMeasure"),n.resetTransform()}function rX(n){n.finishAnimation(),n.targetDelta=n.relativeTarget=n.target=void 0,n.isProjectionDirty=!0}function UOe(n){n.resolveTargetDelta()}function VOe(n){n.calcProjection()}function FOe(n){n.resetSkewAndRotation()}function jOe(n){n.removeLeadSnapshot()}function iX(n,e,i){n.translate=Rs(e.translate,0,i),n.scale=Rs(e.scale,1,i),n.origin=e.origin,n.originPoint=e.originPoint}function sX(n,e,i,o){n.min=Rs(e.min,i.min,o),n.max=Rs(e.max,i.max,o)}function BOe(n,e,i,o){sX(n.x,e.x,i.x,o),sX(n.y,e.y,i.y,o)}function zOe(n){return n.animationValues&&n.animationValues.opacityExit!==void 0}const WOe={duration:.45,ease:[.4,0,.1,1]},oX=n=>typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().includes(n),aX=oX("applewebkit/")&&!oX("chrome/")?Math.round:iu;function cX(n){n.min=aX(n.min),n.max=aX(n.max)}function GOe(n){cX(n.x),cX(n.y)}function vne(n,e,i){return n==="position"||n==="preserve-aspect"&&!Kke(ZY(e),ZY(i),.2)}function HOe(n){var e;return n!==n.root&&((e=n.scroll)===null||e===void 0?void 0:e.wasRoot)}const $Oe=Ene({attachResizeListener:(n,e)=>nR(n,"resize",e),measureScroll:()=>({x:document.documentElement.scrollLeft||document.body.scrollLeft,y:document.documentElement.scrollTop||document.body.scrollTop}),checkIsScrollRoot:()=>!0}),AU={current:void 0},Sne=Ene({measureScroll:n=>({x:n.scrollLeft,y:n.scrollTop}),defaultParent:()=>{if(!AU.current){const n=new $Oe({});n.mount(window),n.setOptions({layoutScroll:!0}),AU.current=n}return AU.current},resetTransform:(n,e)=>{n.style.transform=e!==void 0?e:"none"},checkIsScrollRoot:n=>window.getComputedStyle(n).position==="fixed"}),KOe={pan:{Feature:lOe},drag:{Feature:cOe,ProjectionNode:Sne,MeasureLayout:pne}};function lX(n,e,i){const{props:o}=n;n.animationState&&o.whileHover&&n.animationState.setActive("whileHover",i==="Start");const l="onHover"+i,u=o[l];u&&cs.postRender(()=>u(e,OR(e)))}class qOe extends Kg{mount(){const{current:e}=this.node;e&&(this.unmount=KPe(e,i=>(lX(this.node,i,"Start"),o=>lX(this.node,o,"End"))))}unmount(){}}class YOe extends Kg{constructor(){super(...arguments),this.isActive=!1}onFocus(){let e=!1;try{e=this.node.current.matches(":focus-visible")}catch{e=!0}!e||!this.node.animationState||(this.node.animationState.setActive("whileFocus",!0),this.isActive=!0)}onBlur(){!this.isActive||!this.node.animationState||(this.node.animationState.setActive("whileFocus",!1),this.isActive=!1)}mount(){this.unmount=kR(nR(this.node.current,"focus",()=>this.onFocus()),nR(this.node.current,"blur",()=>this.onBlur()))}unmount(){}}function uX(n,e,i){const{props:o}=n;n.animationState&&o.whileTap&&n.animationState.setActive("whileTap",i==="Start");const l="onTap"+(i==="End"?"":i),u=o[l];u&&cs.postRender(()=>u(e,OR(e)))}class XOe extends Kg{mount(){const{current:e}=this.node;e&&(this.unmount=JPe(e,i=>(uX(this.node,i,"Start"),(o,{success:l})=>uX(this.node,o,l?"End":"Cancel")),{useGlobalTarget:this.node.props.globalTapTarget}))}unmount(){}}const HV=new WeakMap,PU=new WeakMap,JOe=n=>{const e=HV.get(n.target);e&&e(n)},QOe=n=>{n.forEach(JOe)};function ZOe({root:n,...e}){const i=n||document;PU.has(i)||PU.set(i,{});const o=PU.get(i),l=JSON.stringify(e);return o[l]||(o[l]=new IntersectionObserver(QOe,{root:n,...e})),o[l]}function eNe(n,e,i){const o=ZOe(e);return HV.set(n,i),o.observe(n),()=>{HV.delete(n),o.unobserve(n)}}const tNe={some:0,all:1};class nNe extends Kg{constructor(){super(...arguments),this.hasEnteredView=!1,this.isInView=!1}startObserver(){this.unmount();const{viewport:e={}}=this.node.getProps(),{root:i,margin:o,amount:l="some",once:u}=e,p={root:i?i.current:void 0,rootMargin:o,threshold:typeof l=="number"?l:tNe[l]},y=v=>{const{isIntersecting:w}=v;if(this.isInView===w||(this.isInView=w,u&&!w&&this.hasEnteredView))return;w&&(this.hasEnteredView=!0),this.node.animationState&&this.node.animationState.setActive("whileInView",w);const{onViewportEnter:C,onViewportLeave:R}=this.node.getProps(),N=w?C:R;N&&N(v)};return eNe(this.node.current,p,y)}mount(){this.startObserver()}update(){if(typeof IntersectionObserver>"u")return;const{props:e,prevProps:i}=this.node;["amount","margin","root"].some(rNe(e,i))&&this.startObserver()}unmount(){}}function rNe({viewport:n={}},{viewport:e={}}={}){return i=>n[i]!==e[i]}const iNe={inView:{Feature:nNe},tap:{Feature:XOe},focus:{Feature:YOe},hover:{Feature:qOe}},sNe={layout:{ProjectionNode:Sne,MeasureLayout:pne}},$V={current:null},bne={current:!1};function oNe(){if(bne.current=!0,!!bj)if(window.matchMedia){const n=window.matchMedia("(prefers-reduced-motion)"),e=()=>$V.current=n.matches;n.addListener(e),e()}else $V.current=!1}const aNe=[...Kte,rc,Mg],cNe=n=>aNe.find($te(n)),dX=new WeakMap;function lNe(n,e,i){for(const o in e){const l=e[o],u=i[o];if(oc(l))n.addValue(o,l);else if(oc(u))n.addValue(o,eR(l,{owner:n}));else if(u!==l)if(n.hasValue(o)){const p=n.getValue(o);p.liveStyle===!0?p.jump(l):p.hasAnimated||p.set(l)}else{const p=n.getStaticValue(o);n.addValue(o,eR(p!==void 0?p:l,{owner:n}))}}for(const o in i)e[o]===void 0&&n.removeValue(o);return e}const hX=["AnimationStart","AnimationComplete","Update","BeforeLayoutMeasure","LayoutMeasure","LayoutAnimationStart","LayoutAnimationComplete"];class uNe{scrapeMotionValuesFromProps(e,i,o){return{}}constructor({parent:e,props:i,presenceContext:o,reducedMotionConfig:l,blockInitialAnimation:u,visualState:p},y={}){this.current=null,this.children=new Set,this.isVariantNode=!1,this.isControllingVariants=!1,this.shouldReduceMotion=null,this.values=new Map,this.KeyframeResolver=Yj,this.features={},this.valueSubscriptions=new Map,this.prevMotionValues={},this.events={},this.propEventSubscriptions={},this.notifyUpdate=()=>this.notify("Update",this.latestValues),this.render=()=>{this.current&&(this.triggerBuild(),this.renderInstance(this.current,this.renderState,this.props.style,this.projection))},this.renderScheduledAt=0,this.scheduleRender=()=>{const M=Cp.now();this.renderScheduledAt<M&&(this.renderScheduledAt=M,cs.render(this.render,!1,!0))};const{latestValues:v,renderState:w,onUpdate:C}=p;this.onUpdate=C,this.latestValues=v,this.baseTarget={...v},this.initialValues=i.initial?{...v}:{},this.renderState=w,this.parent=e,this.props=i,this.presenceContext=o,this.depth=e?e.depth+1:0,this.reducedMotionConfig=l,this.options=y,this.blockInitialAnimation=!!u,this.isControllingVariants=aN(i),this.isVariantNode=tte(i),this.isVariantNode&&(this.variantChildren=new Set),this.manuallyAnimateOnMount=!!(e&&e.current);const{willChange:R,...N}=this.scrapeMotionValuesFromProps(i,{},this);for(const M in N){const L=N[M];v[M]!==void 0&&oc(L)&&L.set(v[M],!1)}}mount(e){this.current=e,dX.set(e,this),this.projection&&!this.projection.instance&&this.projection.mount(e),this.parent&&this.isVariantNode&&!this.isControllingVariants&&(this.removeFromVariantTree=this.parent.addVariantChild(this)),this.values.forEach((i,o)=>this.bindToMotionValue(o,i)),bne.current||oNe(),this.shouldReduceMotion=this.reducedMotionConfig==="never"?!1:this.reducedMotionConfig==="always"?!0:$V.current,this.parent&&this.parent.children.add(this),this.update(this.props,this.presenceContext)}unmount(){dX.delete(this.current),this.projection&&this.projection.unmount(),Lg(this.notifyUpdate),Lg(this.render),this.valueSubscriptions.forEach(e=>e()),this.valueSubscriptions.clear(),this.removeFromVariantTree&&this.removeFromVariantTree(),this.parent&&this.parent.children.delete(this);for(const e in this.events)this.events[e].clear();for(const e in this.features){const i=this.features[e];i&&(i.unmount(),i.isMounted=!1)}this.current=null}bindToMotionValue(e,i){this.valueSubscriptions.has(e)&&this.valueSubscriptions.get(e)();const o=lE.has(e),l=i.on("change",y=>{this.latestValues[e]=y,this.props.onUpdate&&cs.preRender(this.notifyUpdate),o&&this.projection&&(this.projection.isTransformDirty=!0)}),u=i.on("renderRequest",this.scheduleRender);let p;window.MotionCheckAppearSync&&(p=window.MotionCheckAppearSync(this,e,i)),this.valueSubscriptions.set(e,()=>{l(),u(),p&&p(),i.owner&&i.stop()})}sortNodePosition(e){return!this.current||!this.sortInstanceNodePosition||this.type!==e.type?0:this.sortInstanceNodePosition(this.current,e.current)}updateFeatures(){let e="animation";for(e in wS){const i=wS[e];if(!i)continue;const{isEnabled:o,Feature:l}=i;if(!this.features[e]&&l&&o(this.props)&&(this.features[e]=new l(this)),this.features[e]){const u=this.features[e];u.isMounted?u.update():(u.mount(),u.isMounted=!0)}}}triggerBuild(){this.build(this.renderState,this.latestValues,this.props)}measureViewportBox(){return this.current?this.measureInstanceViewportBox(this.current,this.props):to()}getStaticValue(e){return this.latestValues[e]}setStaticValue(e,i){this.latestValues[e]=i}update(e,i){(e.transformTemplate||this.props.transformTemplate)&&this.scheduleRender(),this.prevProps=this.props,this.props=e,this.prevPresenceContext=this.presenceContext,this.presenceContext=i;for(let o=0;o<hX.length;o++){const l=hX[o];this.propEventSubscriptions[l]&&(this.propEventSubscriptions[l](),delete this.propEventSubscriptions[l]);const u="on"+l,p=e[u];p&&(this.propEventSubscriptions[l]=this.on(l,p))}this.prevMotionValues=lNe(this,this.scrapeMotionValuesFromProps(e,this.prevProps,this),this.prevMotionValues),this.handleChildMotionValue&&this.handleChildMotionValue(),this.onUpdate&&this.onUpdate(this)}getProps(){return this.props}getVariant(e){return this.props.variants?this.props.variants[e]:void 0}getDefaultTransition(){return this.props.transition}getTransformPagePoint(){return this.props.transformPagePoint}getClosestVariantNode(){return this.isVariantNode?this:this.parent?this.parent.getClosestVariantNode():void 0}addVariantChild(e){const i=this.getClosestVariantNode();if(i)return i.variantChildren&&i.variantChildren.add(e),()=>i.variantChildren.delete(e)}addValue(e,i){const o=this.values.get(e);i!==o&&(o&&this.removeValue(e),this.bindToMotionValue(e,i),this.values.set(e,i),this.latestValues[e]=i.get())}removeValue(e){this.values.delete(e);const i=this.valueSubscriptions.get(e);i&&(i(),this.valueSubscriptions.delete(e)),delete this.latestValues[e],this.removeValueFromRenderState(e,this.renderState)}hasValue(e){return this.values.has(e)}getValue(e,i){if(this.props.values&&this.props.values[e])return this.props.values[e];let o=this.values.get(e);return o===void 0&&i!==void 0&&(o=eR(i===null?void 0:i,{owner:this}),this.addValue(e,o)),o}readValue(e,i){var o;let l=this.latestValues[e]!==void 0||!this.current?this.latestValues[e]:(o=this.getBaseTargetFromProps(this.props,e))!==null&&o!==void 0?o:this.readValueFromInstance(this.current,e,this.options);return l!=null&&(typeof l=="string"&&(Gte(l)||Lte(l))?l=parseFloat(l):!cNe(l)&&Mg.test(i)&&(l=Bte(e,i)),this.setBaseTarget(e,oc(l)?l.get():l)),oc(l)?l.get():l}setBaseTarget(e,i){this.baseTarget[e]=i}getBaseTarget(e){var i;const{initial:o}=this.props;let l;if(typeof o=="string"||typeof o=="object"){const p=Pj(this.props,o,(i=this.presenceContext)===null||i===void 0?void 0:i.custom);p&&(l=p[e])}if(o&&l!==void 0)return l;const u=this.getBaseTargetFromProps(this.props,e);return u!==void 0&&!oc(u)?u:this.initialValues[e]!==void 0&&l===void 0?void 0:this.baseTarget[e]}on(e,i){return this.events[e]||(this.events[e]=new Wj),this.events[e].add(i)}notify(e,...i){this.events[e]&&this.events[e].notify(...i)}}class wne extends uNe{constructor(){super(...arguments),this.KeyframeResolver=qte}sortInstanceNodePosition(e,i){return e.compareDocumentPosition(i)&2?1:-1}getBaseTargetFromProps(e,i){return e.style?e.style[i]:void 0}removeValueFromRenderState(e,{vars:i,style:o}){delete i[e],delete o[e]}handleChildMotionValue(){this.childSubscription&&(this.childSubscription(),delete this.childSubscription);const{children:e}=this.props;oc(e)&&(this.childSubscription=e.on("change",i=>{this.current&&(this.current.textContent=`${i}`)}))}}function dNe(n){return window.getComputedStyle(n)}class hNe extends wne{constructor(){super(...arguments),this.type="html",this.renderInstance=ute}readValueFromInstance(e,i){if(lE.has(i)){const o=qj(i);return o&&o.default||0}else{const o=dNe(e),l=(ate(i)?o.getPropertyValue(i):o[i])||0;return typeof l=="string"?l.trim():l}}measureInstanceViewportBox(e,{transformPagePoint:i}){return dne(e,i)}build(e,i,o){Nj(e,i,o.transformTemplate)}scrapeMotionValuesFromProps(e,i,o){return Mj(e,i,o)}}class pNe extends wne{constructor(){super(...arguments),this.type="svg",this.isSVGTag=!1,this.measureInstanceViewportBox=to}getBaseTargetFromProps(e,i){return e[i]}readValueFromInstance(e,i){if(lE.has(i)){const o=qj(i);return o&&o.default||0}return i=dte.has(i)?i:Rj(i),e.getAttribute(i)}scrapeMotionValuesFromProps(e,i,o){return fte(e,i,o)}build(e,i,o){Dj(e,i,this.isSVGTag,o.transformTemplate)}renderInstance(e,i,o,l){hte(e,i,o,l)}mount(e){this.isSVGTag=Lj(e.tagName),super.mount(e)}}const fNe=(n,e)=>Aj(n)?new pNe(e):new hNe(e,{allowProjection:n!==O.Fragment}),mNe=jPe({...Vke,...iNe,...KOe,...sNe},fNe),Dp=tPe(mNe),gNe=(n,e)=>n.find(i=>i.id===e);function pX(n,e){const i=Tne(n,e),o=i?n[i].findIndex(l=>l.id===e):-1;return{position:i,index:o}}function Tne(n,e){for(const[i,o]of Object.entries(n))if(gNe(o,e))return i}function _Ne(n){const e=n.includes("right"),i=n.includes("left");let o="center";return e&&(o="flex-end"),i&&(o="flex-start"),{display:"flex",flexDirection:"column",alignItems:o}}function yNe(n){const i=n==="top"||n==="bottom"?"0 auto":void 0,o=n.includes("top")?"env(safe-area-inset-top, 0px)":void 0,l=n.includes("bottom")?"env(safe-area-inset-bottom, 0px)":void 0,u=n.includes("left")?void 0:"env(safe-area-inset-right, 0px)",p=n.includes("right")?void 0:"env(safe-area-inset-left, 0px)";return{position:"fixed",zIndex:"var(--toast-z-index, 5500)",pointerEvents:"none",display:"flex",flexDirection:"column",margin:i,top:o,bottom:l,right:u,left:p}}var ENe=/^((children|dangerouslySetInnerHTML|key|ref|autoFocus|defaultValue|defaultChecked|innerHTML|suppressContentEditableWarning|suppressHydrationWarning|valueLink|abbr|accept|acceptCharset|accessKey|action|allow|allowUserMedia|allowPaymentRequest|allowFullScreen|allowTransparency|alt|async|autoComplete|autoPlay|capture|cellPadding|cellSpacing|challenge|charSet|checked|cite|classID|className|cols|colSpan|content|contentEditable|contextMenu|controls|controlsList|coords|crossOrigin|data|dateTime|decoding|default|defer|dir|disabled|disablePictureInPicture|disableRemotePlayback|download|draggable|encType|enterKeyHint|fetchpriority|fetchPriority|form|formAction|formEncType|formMethod|formNoValidate|formTarget|frameBorder|headers|height|hidden|high|href|hrefLang|htmlFor|httpEquiv|id|inputMode|integrity|is|keyParams|keyType|kind|label|lang|list|loading|loop|low|marginHeight|marginWidth|max|maxLength|media|mediaGroup|method|min|minLength|multiple|muted|name|nonce|noValidate|open|optimum|pattern|placeholder|playsInline|poster|preload|profile|radioGroup|readOnly|referrerPolicy|rel|required|reversed|role|rows|rowSpan|sandbox|scope|scoped|scrolling|seamless|selected|shape|size|sizes|slot|span|spellCheck|src|srcDoc|srcLang|srcSet|start|step|style|summary|tabIndex|target|title|translate|type|useMap|value|width|wmode|wrap|about|datatype|inlist|prefix|property|resource|typeof|vocab|autoCapitalize|autoCorrect|autoSave|color|incremental|fallback|inert|itemProp|itemScope|itemType|itemID|itemRef|on|option|results|security|unselectable|accentHeight|accumulate|additive|alignmentBaseline|allowReorder|alphabetic|amplitude|arabicForm|ascent|attributeName|attributeType|autoReverse|azimuth|baseFrequency|baselineShift|baseProfile|bbox|begin|bias|by|calcMode|capHeight|clip|clipPathUnits|clipPath|clipRule|colorInterpolation|colorInterpolationFilters|colorProfile|colorRendering|contentScriptType|contentStyleType|cursor|cx|cy|d|decelerate|descent|diffuseConstant|direction|display|divisor|dominantBaseline|dur|dx|dy|edgeMode|elevation|enableBackground|end|exponent|externalResourcesRequired|fill|fillOpacity|fillRule|filter|filterRes|filterUnits|floodColor|floodOpacity|focusable|fontFamily|fontSize|fontSizeAdjust|fontStretch|fontStyle|fontVariant|fontWeight|format|from|fr|fx|fy|g1|g2|glyphName|glyphOrientationHorizontal|glyphOrientationVertical|glyphRef|gradientTransform|gradientUnits|hanging|horizAdvX|horizOriginX|ideographic|imageRendering|in|in2|intercept|k|k1|k2|k3|k4|kernelMatrix|kernelUnitLength|kerning|keyPoints|keySplines|keyTimes|lengthAdjust|letterSpacing|lightingColor|limitingConeAngle|local|markerEnd|markerMid|markerStart|markerHeight|markerUnits|markerWidth|mask|maskContentUnits|maskUnits|mathematical|mode|numOctaves|offset|opacity|operator|order|orient|orientation|origin|overflow|overlinePosition|overlineThickness|panose1|paintOrder|pathLength|patternContentUnits|patternTransform|patternUnits|pointerEvents|points|pointsAtX|pointsAtY|pointsAtZ|preserveAlpha|preserveAspectRatio|primitiveUnits|r|radius|refX|refY|renderingIntent|repeatCount|repeatDur|requiredExtensions|requiredFeatures|restart|result|rotate|rx|ry|scale|seed|shapeRendering|slope|spacing|specularConstant|specularExponent|speed|spreadMethod|startOffset|stdDeviation|stemh|stemv|stitchTiles|stopColor|stopOpacity|strikethroughPosition|strikethroughThickness|string|stroke|strokeDasharray|strokeDashoffset|strokeLinecap|strokeLinejoin|strokeMiterlimit|strokeOpacity|strokeWidth|surfaceScale|systemLanguage|tableValues|targetX|targetY|textAnchor|textDecoration|textRendering|textLength|to|transform|u1|u2|underlinePosition|underlineThickness|unicode|unicodeBidi|unicodeRange|unitsPerEm|vAlphabetic|vHanging|vIdeographic|vMathematical|values|vectorEffect|version|vertAdvY|vertOriginX|vertOriginY|viewBox|viewTarget|visibility|widths|wordSpacing|writingMode|x|xHeight|x1|x2|xChannelSelector|xlinkActuate|xlinkArcrole|xlinkHref|xlinkRole|xlinkShow|xlinkTitle|xlinkType|xmlBase|xmlns|xmlnsXlink|xmlLang|xmlSpace|y|y1|y2|yChannelSelector|z|zoomAndPan|for|class|autofocus)|(([Dd][Aa][Tt][Aa]|[Aa][Rr][Ii][Aa]|x)-.*))$/,vNe=jee(function(n){return ENe.test(n)||n.charCodeAt(0)===111&&n.charCodeAt(1)===110&&n.charCodeAt(2)<91}),SNe=vNe,bNe=function(e){return e!=="theme"},fX=function(e){return typeof e=="string"&&e.charCodeAt(0)>96?SNe:bNe},mX=function(e,i,o){var l;if(i){var u=i.shouldForwardProp;l=e.__emotion_forwardProp&&u?function(p){return e.__emotion_forwardProp(p)&&u(p)}:u}return typeof l!="function"&&o&&(l=e.__emotion_forwardProp),l},wNe=function(e){var i=e.cache,o=e.serialized,l=e.isStringTag;return uj(i,o,l),Hee(function(){return dj(i,o,l)}),null},TNe=function n(e,i){var o=e.__emotion_real===e,l=o&&e.__emotion_base||e,u,p;i!==void 0&&(u=i.label,p=i.target);var y=mX(e,i,o),v=y||fX(l),w=!v("as");return function(){var C=arguments,R=o&&e.__emotion_styles!==void 0?e.__emotion_styles.slice(0):[];if(u!==void 0&&R.push("label:"+u+";"),C[0]==null||C[0].raw===void 0)R.push.apply(R,C);else{var N=C[0];R.push(N[0]);for(var M=C.length,L=1;L<M;L++)R.push(C[L],N[L])}var U=pj(function(z,J,q){var re=w&&z.as||l,ce="",ae=[],pe=z;if(z.theme==null){pe={};for(var H in z)pe[H]=z[H];pe.theme=O.useContext(SS)}typeof z.className=="string"?ce=zee(J.registered,ae,z.className):z.className!=null&&(ce=z.className+" ");var X=nN(R.concat(ae),J.registered,pe);ce+=J.key+"-"+X.name,p!==void 0&&(ce+=" "+p);var Q=w&&y===void 0?fX(re):v,ne={};for(var he in z)w&&he==="as"||Q(he)&&(ne[he]=z[he]);return ne.className=ce,q&&(ne.ref=q),O.createElement(O.Fragment,null,O.createElement(wNe,{cache:J,serialized:X,isStringTag:typeof re=="string"}),O.createElement(re,ne))});return U.displayName=u!==void 0?u:"Styled("+(typeof l=="string"?l:l.displayName||l.name||"Component")+")",U.defaultProps=e.defaultProps,U.__emotion_real=U,U.__emotion_base=l,U.__emotion_styles=R,U.__emotion_forwardProp=y,Object.defineProperty(U,"toString",{value:function(){return"."+p}}),U.withComponent=function(z,J){var q=n(z,Jy({},i,J,{shouldForwardProp:mX(U,J,!0)}));return q.apply(void 0,R)},U}},CNe=["a","abbr","address","area","article","aside","audio","b","base","bdi","bdo","big","blockquote","body","br","button","canvas","caption","cite","code","col","colgroup","data","datalist","dd","del","details","dfn","dialog","div","dl","dt","em","embed","fieldset","figcaption","figure","footer","form","h1","h2","h3","h4","h5","h6","head","header","hgroup","hr","html","i","iframe","img","input","ins","kbd","keygen","label","legend","li","link","main","map","mark","marquee","menu","menuitem","meta","meter","nav","noscript","object","ol","optgroup","option","output","p","param","picture","pre","progress","q","rp","rt","ruby","s","samp","script","section","select","small","source","span","strong","style","sub","summary","sup","table","tbody","td","textarea","tfoot","th","thead","time","title","tr","track","u","ul","var","video","wbr","circle","clipPath","defs","ellipse","foreignObject","g","image","line","linearGradient","mask","path","pattern","polygon","polyline","radialGradient","rect","stop","svg","text","tspan"],KV=TNe.bind(null);CNe.forEach(function(n){KV[n]=KV(n)});const RNe=new Set([...$0e,"textStyle","layerStyle","apply","noOfLines","focusBorderColor","errorBorderColor","as","__css","css","sx"]),INe=new Set(["htmlWidth","htmlHeight","htmlSize","htmlTranslate"]);function ANe(n){return(INe.has(n)||!RNe.has(n))&&n[0]!=="_"}const PNe=vve(KV),kNe=({baseStyle:n})=>e=>{const{theme:i,css:o,__css:l,sx:u,...p}=e,[y]=Ive(p,q0e),v=pl(n,e),w=ove({},l,v,KO(y),u),C=Eee(w)(e.theme);return o?[C,o]:C};function kU(n,e){const{baseStyle:i,...o}=e??{};o.shouldForwardProp||(o.shouldForwardProp=ANe);const l=kNe({baseStyle:i}),u=PNe(n,o)(l);return O.forwardRef(function(v,w){const{children:C,...R}=v,{colorMode:N,forced:M}=iN(),L=M?N:void 0;return O.createElement(u,{ref:w,"data-theme":L,...R},C)})}function ONe(){const n=new Map;return new Proxy(kU,{apply(e,i,o){return kU(...o)},get(e,i){return n.has(i)||n.set(i,kU(i)),n.get(i)}})}const Ut=ONe(),NNe={initial:n=>{const{position:e}=n,i=["top","bottom"].includes(e)?"y":"x";let o=["top-right","bottom-right"].includes(e)?1:-1;return e==="bottom"&&(o=1),{opacity:0,[i]:o*24}},animate:{opacity:1,y:0,x:0,scale:1,transition:{duration:.4,ease:[.4,0,.2,1]}},exit:{opacity:0,scale:.85,transition:{duration:.2,ease:[.4,0,1,1]}}},Cne=O.memo(n=>{const{id:e,message:i,onCloseComplete:o,onRequestRemove:l,requestClose:u=!1,position:p="bottom",duration:y=5e3,containerStyle:v,motionVariants:w=NNe,toastSpacing:C="0.5rem"}=n,[R,N]=O.useState(y),M=$Ae();jf(()=>{M||o==null||o()},[M]),jf(()=>{N(y)},[y]);const L=()=>N(null),U=()=>N(y),z=()=>{M&&l()};O.useEffect(()=>{M&&u&&l()},[M,u,l]),Xve(z,R);const J=O.useMemo(()=>({pointerEvents:"auto",maxWidth:560,minWidth:300,margin:C,...v}),[v,C]),q=O.useMemo(()=>_Ne(p),[p]);return S.jsx(Dp.div,{layout:!0,className:"chakra-toast",variants:w,initial:"initial",animate:"animate",exit:"exit",onHoverStart:L,onHoverEnd:U,custom:{position:p},style:q,children:S.jsx(Ut.div,{role:"status","aria-atomic":"true",className:"chakra-toast__inner",__css:J,children:pl(i,{id:e,onClose:z})})})});Cne.displayName="ToastComponent";function Bt(n){return O.forwardRef(n)}var OU,gX;function DNe(){if(gX)return OU;gX=1;var n=typeof Element<"u",e=typeof Map=="function",i=typeof Set=="function",o=typeof ArrayBuffer=="function"&&!!ArrayBuffer.isView;function l(u,p){if(u===p)return!0;if(u&&p&&typeof u=="object"&&typeof p=="object"){if(u.constructor!==p.constructor)return!1;var y,v,w;if(Array.isArray(u)){if(y=u.length,y!=p.length)return!1;for(v=y;v--!==0;)if(!l(u[v],p[v]))return!1;return!0}var C;if(e&&u instanceof Map&&p instanceof Map){if(u.size!==p.size)return!1;for(C=u.entries();!(v=C.next()).done;)if(!p.has(v.value[0]))return!1;for(C=u.entries();!(v=C.next()).done;)if(!l(v.value[1],p.get(v.value[0])))return!1;return!0}if(i&&u instanceof Set&&p instanceof Set){if(u.size!==p.size)return!1;for(C=u.entries();!(v=C.next()).done;)if(!p.has(v.value[0]))return!1;return!0}if(o&&ArrayBuffer.isView(u)&&ArrayBuffer.isView(p)){if(y=u.length,y!=p.length)return!1;for(v=y;v--!==0;)if(u[v]!==p[v])return!1;return!0}if(u.constructor===RegExp)return u.source===p.source&&u.flags===p.flags;if(u.valueOf!==Object.prototype.valueOf&&typeof u.valueOf=="function"&&typeof p.valueOf=="function")return u.valueOf()===p.valueOf();if(u.toString!==Object.prototype.toString&&typeof u.toString=="function"&&typeof p.toString=="function")return u.toString()===p.toString();if(w=Object.keys(u),y=w.length,y!==Object.keys(p).length)return!1;for(v=y;v--!==0;)if(!Object.prototype.hasOwnProperty.call(p,w[v]))return!1;if(n&&u instanceof Element)return!1;for(v=y;v--!==0;)if(!((w[v]==="_owner"||w[v]==="__v"||w[v]==="__o")&&u.$$typeof)&&!l(u[w[v]],p[w[v]]))return!1;return!0}return u!==u&&p!==p}return OU=function(p,y){try{return l(p,y)}catch(v){if((v.message||"").match(/stack|recursion/i))return console.warn("react-fast-compare cannot handle circular refs"),!1;throw v}},OU}var xNe=DNe();const LNe=$g(xNe);function YS(){const n=O.useContext(SS);if(!n)throw Error("useTheme: `theme` is undefined. Seems you forgot to wrap your app in `<ChakraProvider />` or `<ThemeProvider />`");return n}function Rne(){const n=iN(),e=YS();return{...n,theme:e}}function MNe(n,e,i){if(e==null)return e;const o=l=>{var u,p;return(p=(u=n.__cssMap)==null?void 0:u[l])==null?void 0:p.value};return o(e)??o(i)??i}function UNe(n,e,i){const o=Array.isArray(e)?e:[e],l=Array.isArray(i)?i:[i];return u=>{const p=l.filter(Boolean),y=o.map((v,w)=>{const C=`${n}.${v}`;return MNe(u,C,p[w]??v)});return Array.isArray(e)?y:y[0]}}function Ine(n,e={}){const{styleConfig:i,...o}=e,{theme:l,colorMode:u}=Rne(),p=n?tee(l,`components.${n}`):void 0,y=i||p,v=_p({theme:l,colorMode:u},(y==null?void 0:y.defaultProps)??{},KO(GS(o,["children"])),(C,R)=>C?void 0:R),w=O.useRef({});if(y){const R=sSe(y)(v);LNe(w.current,R)||(w.current=R)}return w.current}function cu(n,e={}){return Ine(n,e)}function Na(n,e={}){return Ine(n,e)}const _X={path:S.jsxs("g",{stroke:"currentColor",strokeWidth:"1.5",children:[S.jsx("path",{strokeLinecap:"round",fill:"none",d:"M9,9a3,3,0,1,1,4,2.829,1.5,1.5,0,0,0-1,1.415V14.25"}),S.jsx("path",{fill:"currentColor",strokeLinecap:"round",d:"M12,17.25a.375.375,0,1,0,.375.375A.375.375,0,0,0,12,17.25h0"}),S.jsx("circle",{fill:"none",strokeMiterlimit:"10",cx:"12",cy:"12",r:"11.25"})]}),viewBox:"0 0 24 24"},Sn=Bt((n,e)=>{const{as:i,viewBox:o,color:l="currentColor",focusable:u=!1,children:p,className:y,__css:v,...w}=n,C=yn("chakra-icon",y),R=cu("Icon",n),N={w:"1em",h:"1em",display:"inline-block",lineHeight:"1em",flexShrink:0,color:l,...v,...R},M={ref:e,focusable:u,className:C,__css:N},L=o??_X.viewBox;if(i&&typeof i!="string")return S.jsx(Ut.svg,{as:i,...M,...w});const U=p??_X.path;return S.jsx(Ut.svg,{verticalAlign:"middle",viewBox:L,...M,...w,children:U})});Sn.displayName="Icon";function VNe(n){return S.jsx(Sn,{viewBox:"0 0 24 24",...n,children:S.jsx("path",{fill:"currentColor",d:"M12,0A12,12,0,1,0,24,12,12.014,12.014,0,0,0,12,0Zm6.927,8.2-6.845,9.289a1.011,1.011,0,0,1-1.43.188L5.764,13.769a1,1,0,1,1,1.25-1.562l4.076,3.261,6.227-8.451A1,1,0,1,1,18.927,8.2Z"})})}function FNe(n){return S.jsx(Sn,{viewBox:"0 0 24 24",...n,children:S.jsx("path",{fill:"currentColor",d:"M12,0A12,12,0,1,0,24,12,12.013,12.013,0,0,0,12,0Zm.25,5a1.5,1.5,0,1,1-1.5,1.5A1.5,1.5,0,0,1,12.25,5ZM14.5,18.5h-4a1,1,0,0,1,0-2h.75a.25.25,0,0,0,.25-.25v-4.5a.25.25,0,0,0-.25-.25H10.5a1,1,0,0,1,0-2h1a2,2,0,0,1,2,2v4.75a.25.25,0,0,0,.25.25h.75a1,1,0,1,1,0,2Z"})})}function yX(n){return S.jsx(Sn,{viewBox:"0 0 24 24",...n,children:S.jsx("path",{fill:"currentColor",d:"M11.983,0a12.206,12.206,0,0,0-8.51,3.653A11.8,11.8,0,0,0,0,12.207,11.779,11.779,0,0,0,11.8,24h.214A12.111,12.111,0,0,0,24,11.791h0A11.766,11.766,0,0,0,11.983,0ZM10.5,16.542a1.476,1.476,0,0,1,1.449-1.53h.027a1.527,1.527,0,0,1,1.523,1.47,1.475,1.475,0,0,1-1.449,1.53h-.027A1.529,1.529,0,0,1,10.5,16.542ZM11,12.5v-6a1,1,0,0,1,2,0v6a1,1,0,1,1-2,0Z"})})}const jNe=RR({"0%":{transform:"rotate(0deg)"},"100%":{transform:"rotate(360deg)"}}),ld=Bt((n,e)=>{const i=cu("Spinner",n),{label:o="Loading...",thickness:l="2px",speed:u="0.45s",emptyColor:p="transparent",className:y,...v}=Fi(n),w=yn("chakra-spinner",y),C={display:"inline-block",borderColor:"currentColor",borderStyle:"solid",borderRadius:"99999px",borderWidth:l,borderBottomColor:p,borderLeftColor:p,animation:`${jNe} ${u} linear infinite`,...i};return S.jsx(Ut.div,{ref:e,__css:C,className:w,...v,children:o&&S.jsx(Ut.span,{srOnly:!0,children:o})})});ld.displayName="Spinner";const[BNe,Zj]=ki({name:"AlertContext",hookName:"useAlertContext",providerName:"<Alert />"}),[zNe,e5]=ki({name:"AlertStylesContext",hookName:"useAlertStyles",providerName:"<Alert />"}),Ane={info:{icon:FNe,colorScheme:"blue"},warning:{icon:yX,colorScheme:"orange"},success:{icon:VNe,colorScheme:"green"},error:{icon:yX,colorScheme:"red"},loading:{icon:ld,colorScheme:"blue"}};function WNe(n){return Ane[n].colorScheme}function GNe(n){return Ane[n].icon}const Ig=Bt(function(e,i){const{status:o="info",addRole:l=!0,...u}=Fi(e),p=e.colorScheme??WNe(o),y=Na("Alert",{...e,colorScheme:p}),v={width:"100%",display:"flex",alignItems:"center",position:"relative",overflow:"hidden",...y.container};return S.jsx(BNe,{value:{status:o},children:S.jsx(zNe,{value:y,children:S.jsx(Ut.div,{"data-status":o,role:l?"alert":void 0,ref:i,...u,className:yn("chakra-alert",e.className),__css:v})})})});Ig.displayName="Alert";function Ag(n){const{status:e}=Zj(),i=GNe(e),o=e5(),l=e==="loading"?o.spinner:o.icon;return S.jsx(Ut.span,{display:"inherit","data-status":e,...n,className:yn("chakra-alert__icon",n.className),__css:l,children:n.children||S.jsx(i,{h:"100%",w:"100%"})})}Ag.displayName="AlertIcon";const DC=Bt(function(e,i){const o=e5(),{status:l}=Zj();return S.jsx(Ut.div,{ref:i,"data-status":l,...e,className:yn("chakra-alert__title",e.className),__css:o.title})});DC.displayName="AlertTitle";const xC=Bt(function(e,i){const{status:o}=Zj(),l=e5(),u={display:"inline",...l.description};return S.jsx(Ut.div,{ref:i,"data-status":o,...e,className:yn("chakra-alert__desc",e.className),__css:u})});xC.displayName="AlertDescription";function HNe(n){return S.jsx(Sn,{focusable:"false","aria-hidden":!0,...n,children:S.jsx("path",{fill:"currentColor",d:"M.439,21.44a1.5,1.5,0,0,0,2.122,2.121L11.823,14.3a.25.25,0,0,1,.354,0l9.262,9.263a1.5,1.5,0,1,0,2.122-2.121L14.3,12.177a.25.25,0,0,1,0-.354l9.263-9.262A1.5,1.5,0,0,0,21.439.44L12.177,9.7a.25.25,0,0,1-.354,0L2.561.44A1.5,1.5,0,0,0,.439,2.561L9.7,11.823a.25.25,0,0,1,0,.354Z"})})}const t5=Bt(function(e,i){const o=cu("CloseButton",e),{children:l,isDisabled:u,__css:p,...y}=Fi(e),v={outline:0,display:"flex",alignItems:"center",justifyContent:"center",flexShrink:0};return S.jsx(Ut.button,{type:"button","aria-label":"Close",ref:i,disabled:u,__css:{...v,...o,...p},...y,children:l||S.jsx(HNe,{width:"1em",height:"1em"})})});t5.displayName="CloseButton";const $Ne=n=>{const{status:e,variant:i="solid",id:o,title:l,isClosable:u,onClose:p,description:y,colorScheme:v,icon:w}=n,C=o?{root:`toast-${o}`,title:`toast-${o}-title`,description:`toast-${o}-description`}:void 0;return S.jsxs(Ig,{addRole:!1,status:e,variant:i,id:C==null?void 0:C.root,alignItems:"start",borderRadius:"md",boxShadow:"lg",paddingEnd:8,textAlign:"start",width:"auto",colorScheme:v,children:[S.jsx(Ag,{children:w}),S.jsxs(Ut.div,{flex:"1",maxWidth:"100%",children:[l&&S.jsx(DC,{id:C==null?void 0:C.title,children:l}),y&&S.jsx(xC,{id:C==null?void 0:C.description,display:"block",children:y})]}),u&&S.jsx(t5,{size:"sm",onClick:p,position:"absolute",insetEnd:1,top:1})]})};function Pne(n={}){const{render:e,toastComponent:i=$Ne}=n;return l=>typeof e=="function"?e({...l,...n}):S.jsx(i,{...l,...n})}const KNe={top:[],"top-left":[],"top-right":[],"bottom-left":[],bottom:[],"bottom-right":[]},pp=qNe(KNe);function qNe(n){let e=n;const i=new Set,o=l=>{e=l(e),i.forEach(u=>u())};return{getState:()=>e,subscribe:l=>(i.add(l),()=>{o(()=>n),i.delete(l)}),removeToast:(l,u)=>{o(p=>({...p,[u]:p[u].filter(y=>y.id!=l)}))},notify:(l,u)=>{const p=YNe(l,u),{position:y,id:v}=p;return o(w=>{const R=y.includes("top")?[p,...w[y]??[]]:[...w[y]??[],p];return{...w,[y]:R}}),v},update:(l,u)=>{l&&o(p=>{const y={...p},{position:v,index:w}=pX(y,l);return v&&w!==-1&&(y[v][w]={...y[v][w],...u,message:Pne(u)}),y})},closeAll:({positions:l}={})=>{o(u=>(l??["bottom","bottom-right","bottom-left","top","top-left","top-right"]).reduce((v,w)=>(v[w]=u[w].map(C=>({...C,requestClose:!0})),v),{...u}))},close:l=>{o(u=>{const p=Tne(u,l);return p?{...u,[p]:u[p].map(y=>y.id==l?{...y,requestClose:!0}:y)}:u})},isActive:l=>!!pX(pp.getState(),l).position}}let EX=0;function YNe(n,e={}){EX+=1;const i=e.id??EX,o=e.position??"bottom";return{id:i,message:n,position:o,duration:e.duration,onCloseComplete:e.onCloseComplete,onRequestRemove:()=>pp.removeToast(String(i),o),status:e.status,requestClose:!1,containerStyle:e.containerStyle}}var kne=$Z();const[One,XNe]=ki({strict:!1,name:"PortalContext"}),n5="chakra-portal",JNe=".chakra-portal",QNe=n=>S.jsx("div",{className:"chakra-portal-zIndex",style:{position:"absolute",zIndex:n.zIndex,top:0,left:0,right:0},children:n.children}),ZNe=n=>{const{appendToParentPortal:e,children:i}=n,[o,l]=O.useState(null),u=O.useRef(null),[,p]=O.useState({});O.useEffect(()=>p({}),[]);const y=XNe(),v=FAe();Sp(()=>{if(!o)return;const C=o.ownerDocument,R=e?y??C.body:C.body;if(!R)return;u.current=C.createElement("div"),u.current.className=n5,R.appendChild(u.current),p({});const N=u.current;return()=>{R.contains(N)&&R.removeChild(N)}},[o]);const w=v!=null&&v.zIndex?S.jsx(QNe,{zIndex:v==null?void 0:v.zIndex,children:i}):i;return u.current?kne.createPortal(S.jsx(One,{value:u.current,children:w}),u.current):S.jsx("span",{ref:C=>{C&&l(C)}})},eDe=n=>{const{children:e,containerRef:i,appendToParentPortal:o}=n,l=i.current,u=l??(typeof window<"u"?document.body:void 0),p=O.useMemo(()=>{const v=l==null?void 0:l.ownerDocument.createElement("div");return v&&(v.className=n5),v},[l]),[,y]=O.useState({});return Sp(()=>y({}),[]),Sp(()=>{if(!(!p||!u))return u.appendChild(p),()=>{u.removeChild(p)}},[p,u]),u&&p?kne.createPortal(S.jsx(One,{value:o?p:null,children:e}),p):null};function Nc(n){const e={appendToParentPortal:!0,...n},{containerRef:i,...o}=e;return i?S.jsx(eDe,{containerRef:i,...o}):S.jsx(ZNe,{...o})}Nc.className=n5;Nc.selector=JNe;Nc.displayName="Portal";const[tDe,nDe]=ki({name:"ToastOptionsContext",strict:!1}),rDe=n=>{const e=O.useSyncExternalStore(pp.subscribe,pp.getState,pp.getState),{motionVariants:i,component:o=Cne,portalProps:l,animatePresenceProps:u}=n,y=Object.keys(e).map(v=>{const w=e[v];return S.jsx("div",{role:"region","aria-live":"polite","aria-label":`Notifications-${v}`,id:`chakra-toast-manager-${v}`,style:yNe(v),children:S.jsx($S,{...u,initial:!1,children:w.map(C=>S.jsx(o,{motionVariants:i,...C},C.id))})},v)});return S.jsx(Nc,{...l,children:y})},iDe=n=>function({children:i,theme:o=n,toastOptions:l,...u}){return S.jsxs(BAe,{theme:o,...u,children:[S.jsx(tDe,{value:l==null?void 0:l.defaultOptions,children:i}),S.jsx(rDe,{...l})]})},uN=iDe(OIe);function vX(n){return n.sort((e,i)=>{const o=e.compareDocumentPosition(i);if(o&Node.DOCUMENT_POSITION_FOLLOWING||o&Node.DOCUMENT_POSITION_CONTAINED_BY)return-1;if(o&Node.DOCUMENT_POSITION_PRECEDING||o&Node.DOCUMENT_POSITION_CONTAINS)return 1;if(o&Node.DOCUMENT_POSITION_DISCONNECTED||o&Node.DOCUMENT_POSITION_IMPLEMENTATION_SPECIFIC)throw Error("Cannot sort the given nodes.");return 0})}const sDe=n=>typeof n=="object"&&"nodeType"in n&&n.nodeType===Node.ELEMENT_NODE;function SX(n,e,i){let o=n+1;return i&&o>=e&&(o=0),o}function bX(n,e,i){let o=n-1;return i&&o<0&&(o=e),o}const NU=typeof window<"u"?O.useLayoutEffect:O.useEffect,wX=n=>n;var oDe=Object.defineProperty,aDe=(n,e,i)=>e in n?oDe(n,e,{enumerable:!0,configurable:!0,writable:!0,value:i}):n[e]=i,Fs=(n,e,i)=>(aDe(n,typeof e!="symbol"?e+"":e,i),i);class cDe{constructor(){Fs(this,"descendants",new Map),Fs(this,"register",e=>{if(e!=null)return sDe(e)?this.registerNode(e):i=>{this.registerNode(i,e)}}),Fs(this,"unregister",e=>{this.descendants.delete(e);const i=vX(Array.from(this.descendants.keys()));this.assignIndex(i)}),Fs(this,"destroy",()=>{this.descendants.clear()}),Fs(this,"assignIndex",e=>{this.descendants.forEach(i=>{const o=e.indexOf(i.node);i.index=o,i.node.dataset.index=i.index.toString()})}),Fs(this,"count",()=>this.descendants.size),Fs(this,"enabledCount",()=>this.enabledValues().length),Fs(this,"values",()=>Array.from(this.descendants.values()).sort((i,o)=>i.index-o.index)),Fs(this,"enabledValues",()=>this.values().filter(e=>!e.disabled)),Fs(this,"item",e=>{if(this.count()!==0)return this.values()[e]}),Fs(this,"enabledItem",e=>{if(this.enabledCount()!==0)return this.enabledValues()[e]}),Fs(this,"first",()=>this.item(0)),Fs(this,"firstEnabled",()=>this.enabledItem(0)),Fs(this,"last",()=>this.item(this.descendants.size-1)),Fs(this,"lastEnabled",()=>{const e=this.enabledValues().length-1;return this.enabledItem(e)}),Fs(this,"indexOf",e=>{var i;return e?((i=this.descendants.get(e))==null?void 0:i.index)??-1:-1}),Fs(this,"enabledIndexOf",e=>e==null?-1:this.enabledValues().findIndex(i=>i.node.isSameNode(e))),Fs(this,"next",(e,i=!0)=>{const o=SX(e,this.count(),i);return this.item(o)}),Fs(this,"nextEnabled",(e,i=!0)=>{const o=this.item(e);if(!o)return;const l=this.enabledIndexOf(o.node),u=SX(l,this.enabledCount(),i);return this.enabledItem(u)}),Fs(this,"prev",(e,i=!0)=>{const o=bX(e,this.count()-1,i);return this.item(o)}),Fs(this,"prevEnabled",(e,i=!0)=>{const o=this.item(e);if(!o)return;const l=this.enabledIndexOf(o.node),u=bX(l,this.enabledCount()-1,i);return this.enabledItem(u)}),Fs(this,"registerNode",(e,i)=>{if(!e||this.descendants.has(e))return;const o=Array.from(this.descendants.keys()).concat(e),l=vX(o);i!=null&&i.disabled&&(i.disabled=!!i.disabled);const u={node:e,index:-1,...i};this.descendants.set(e,u),this.assignIndex(l)})}}function Nne(){const[n,e]=ki({name:"DescendantsProvider",errorMessage:"useDescendantsContext must be used within DescendantsProvider"});return[n,e,()=>{const l=O.useRef(new cDe);return NU(()=>()=>l.current.destroy()),l.current},l=>{const u=e(),[p,y]=O.useState(-1),v=O.useRef(null);NU(()=>()=>{v.current&&u.unregister(v.current)},[]),NU(()=>{if(!v.current)return;const C=Number(v.current.dataset.index);p!=C&&!Number.isNaN(C)&&y(C)});const w=wX(l?u.register(l):u.register);return{descendants:u,index:p,enabledIndex:u.enabledIndexOf(v.current),register:$i(w,v)}}]}const TX={easeIn:[.4,0,1,1],easeOut:[0,0,.2,1]},Wy={enter:{duration:.2,ease:TX.easeOut},exit:{duration:.1,ease:TX.easeIn}},Gy={enter:(n,e)=>({...n,delay:typeof e=="number"?e:e==null?void 0:e.enter}),exit:(n,e)=>({...n,delay:typeof e=="number"?e:e==null?void 0:e.exit})},Dne=Bt(function(n,e){const{ratio:i=4/3,children:o,className:l,...u}=n,p=O.Children.only(o),y=yn("chakra-aspect-ratio",l);return S.jsx(Ut.div,{ref:e,position:"relative",className:y,_before:{height:0,content:'""',display:"block",paddingBottom:qO(i,v=>`${1/v*100}%`)},__css:{"& > *:not(style)":{overflow:"hidden",position:"absolute",top:"0",right:"0",bottom:"0",left:"0",display:"flex",justifyContent:"center",alignItems:"center",width:"100%",height:"100%"},"& > img, & > video":{objectFit:"cover"}},...u,children:p})});Dne.displayName="AspectRatio";const[lDe,uDe]=ki({name:"AvatarStylesContext",hookName:"useAvatarStyles",providerName:"<Avatar/>"});function dDe(n){const e=n.trim().split(" "),i=e[0]??"",o=e.length>1?e[e.length-1]:"";return i&&o?`${i.charAt(0)}${o.charAt(0)}`:i.charAt(0)}function xne(n){const{name:e,getInitials:i,...o}=n,l=uDe();return S.jsx(Ut.div,{role:"img","aria-label":e,...o,__css:l.label,children:e?i==null?void 0:i(e):null})}xne.displayName="AvatarName";const Lne=n=>S.jsxs(Ut.svg,{viewBox:"0 0 128 128",color:"#fff",width:"100%",height:"100%",className:"chakra-avatar__svg",...n,children:[S.jsx("path",{fill:"currentColor",d:"M103,102.1388 C93.094,111.92 79.3504,118 64.1638,118 C48.8056,118 34.9294,111.768 25,101.7892 L25,95.2 C25,86.8096 31.981,80 40.6,80 L87.4,80 C96.019,80 103,86.8096 103,95.2 L103,102.1388 Z"}),S.jsx("path",{fill:"currentColor",d:"M63.9961647,24 C51.2938136,24 41,34.2938136 41,46.9961647 C41,59.7061864 51.2938136,70 63.9961647,70 C76.6985159,70 87,59.7061864 87,46.9961647 C87,34.2938136 76.6985159,24 63.9961647,24"})]});function Mne(n){const{loading:e,src:i,srcSet:o,onLoad:l,onError:u,crossOrigin:p,sizes:y,ignoreFallback:v}=n,[w,C]=O.useState("pending");O.useEffect(()=>{C(i?"loading":"pending")},[i]);const R=O.useRef(null),N=O.useCallback(()=>{if(!i)return;M();const L=new Image;L.src=i,p&&(L.crossOrigin=p),o&&(L.srcset=o),y&&(L.sizes=y),e&&(L.loading=e),L.onload=U=>{M(),C("loaded"),l==null||l(U)},L.onerror=U=>{M(),C("failed"),u==null||u(U)},R.current=L},[i,p,o,y,l,u,e]),M=()=>{R.current&&(R.current.onload=null,R.current.onerror=null,R.current=null)};return Sp(()=>{if(!v)return w==="loading"&&N(),()=>{M()}},[w,N,v]),v?"loaded":w}const hDe=(n,e)=>n!=="loaded"&&e==="beforeLoadOrError"||n==="failed"&&e==="onError";function Une(n){const{src:e,srcSet:i,onError:o,onLoad:l,getInitials:u,name:p,borderRadius:y,loading:v,iconLabel:w,icon:C=S.jsx(Lne,{}),ignoreFallback:R,referrerPolicy:N,crossOrigin:M}=n,U=Mne({src:e,onError:o,crossOrigin:M,ignoreFallback:R})==="loaded";return!e||!U?p?S.jsx(xne,{className:"chakra-avatar__initials",getInitials:u,name:p}):O.cloneElement(C,{role:"img","aria-label":w}):S.jsx(Ut.img,{src:e,srcSet:i,alt:p??w,onLoad:l,referrerPolicy:N,crossOrigin:M??void 0,className:"chakra-avatar__img",loading:v,__css:{width:"100%",height:"100%",objectFit:"cover",borderRadius:y}})}Une.displayName="AvatarImage";const pDe={display:"inline-flex",alignItems:"center",justifyContent:"center",textAlign:"center",textTransform:"uppercase",fontWeight:"medium",position:"relative",flexShrink:0},ml=Bt((n,e)=>{const i=Na("Avatar",n),[o,l]=O.useState(!1),{src:u,srcSet:p,name:y,showBorder:v,borderRadius:w="full",onError:C,onLoad:R,getInitials:N=dDe,icon:M=S.jsx(Lne,{}),iconLabel:L=" avatar",loading:U,children:z,borderColor:J,ignoreFallback:q,crossOrigin:re,referrerPolicy:ce,...ae}=Fi(n),pe={borderRadius:w,borderWidth:v?"2px":void 0,...pDe,...i.container};return J&&(pe.borderColor=J),S.jsx(Ut.span,{ref:e,...ae,className:yn("chakra-avatar",n.className),"data-loaded":ur(o),__css:pe,children:S.jsxs(lDe,{value:i,children:[S.jsx(Une,{src:u,srcSet:p,loading:U,onLoad:Un(R,()=>{l(!0)}),onError:C,getInitials:N,name:y,borderRadius:w,icon:M,iconLabel:L,ignoreFallback:q,crossOrigin:re,referrerPolicy:ce}),z]})})});ml.displayName="Avatar";const sh=Bt(function(e,i){const o=cu("Badge",e),{className:l,...u}=Fi(e);return S.jsx(Ut.span,{ref:i,className:yn("chakra-badge",e.className),...u,__css:{display:"inline-block",whiteSpace:"nowrap",verticalAlign:"middle",...o}})});sh.displayName="Badge";const ct=Ut("div");ct.displayName="Box";const[THe,fDe]=ki({strict:!1,name:"ButtonGroupContext"});function pC(n){const{children:e,className:i,...o}=n,l=O.isValidElement(e)?O.cloneElement(e,{"aria-hidden":!0,focusable:!1}):e,u=yn("chakra-button__icon",i);return S.jsx(Ut.span,{display:"inline-flex",alignSelf:"center",flexShrink:0,...o,className:u,children:l})}pC.displayName="ButtonIcon";function qV(n){const{label:e,placement:i,spacing:o="0.5rem",children:l=S.jsx(ld,{color:"currentColor",width:"1em",height:"1em"}),className:u,__css:p,...y}=n,v=yn("chakra-button__spinner",u),w=i==="start"?"marginEnd":"marginStart",C=O.useMemo(()=>({display:"flex",alignItems:"center",position:e?"relative":"absolute",[w]:e?o:0,fontSize:"1em",lineHeight:"normal",...p}),[p,e,w,o]);return S.jsx(Ut.div,{className:v,...y,__css:C,children:l})}qV.displayName="ButtonSpinner";function mDe(n){const[e,i]=O.useState(!n);return{ref:O.useCallback(u=>{u&&i(u.tagName==="BUTTON")},[]),type:e?"button":void 0}}const Nn=Bt((n,e)=>{const i=fDe(),o=cu("Button",{...i,...n}),{isDisabled:l=i==null?void 0:i.isDisabled,isLoading:u,isActive:p,children:y,leftIcon:v,rightIcon:w,loadingText:C,iconSpacing:R="0.5rem",type:N,spinner:M,spinnerPlacement:L="start",className:U,as:z,shouldWrapChildren:J,...q}=Fi(n),re=O.useMemo(()=>{const H={...o==null?void 0:o._focus,zIndex:1};return{display:"inline-flex",appearance:"none",alignItems:"center",justifyContent:"center",userSelect:"none",position:"relative",whiteSpace:"nowrap",verticalAlign:"middle",outline:"none",...o,...!!i&&{_focus:H}}},[o,i]),{ref:ce,type:ae}=mDe(z),pe={rightIcon:w,leftIcon:v,iconSpacing:R,children:y,shouldWrapChildren:J};return S.jsxs(Ut.button,{disabled:l||u,ref:Yve(e,ce),as:z,type:N??ae,"data-active":ur(p),"data-loading":ur(u),__css:re,className:yn("chakra-button",U),...q,children:[u&&L==="start"&&S.jsx(qV,{className:"chakra-button__spinner--start",label:C,placement:"start",spacing:R,children:M}),u?C||S.jsx(Ut.span,{opacity:0,children:S.jsx(CX,{...pe})}):S.jsx(CX,{...pe}),u&&L==="end"&&S.jsx(qV,{className:"chakra-button__spinner--end",label:C,placement:"end",spacing:R,children:M})]})});Nn.displayName="Button";function CX(n){const{leftIcon:e,rightIcon:i,children:o,iconSpacing:l,shouldWrapChildren:u}=n;return u?S.jsxs("span",{style:{display:"contents"},children:[e&&S.jsx(pC,{marginEnd:l,children:e}),o,i&&S.jsx(pC,{marginStart:l,children:i})]}):S.jsxs(S.Fragment,{children:[e&&S.jsx(pC,{marginEnd:l,children:e}),o,i&&S.jsx(pC,{marginStart:l,children:i})]})}const Pc=Bt((n,e)=>{const{icon:i,children:o,isRound:l,"aria-label":u,...p}=n,y=i||o,v=O.isValidElement(y)?O.cloneElement(y,{"aria-hidden":!0,focusable:!1}):null;return S.jsx(Nn,{px:"0",py:"0",borderRadius:l?"full":void 0,ref:e,"aria-label":u,...p,children:v})});Pc.displayName="IconButton";const Vne=Ut("div",{baseStyle:{display:"flex",alignItems:"center",justifyContent:"center"}});Vne.displayName="Center";const gDe={horizontal:{insetStart:"50%",transform:"translateX(-50%)"},vertical:{top:"50%",transform:"translateY(-50%)"},both:{insetStart:"50%",top:"50%",transform:"translate(-50%, -50%)"}};Bt(function(e,i){const{axis:o="both",...l}=e;return S.jsx(Ut.div,{ref:i,__css:gDe[o],...l,position:"absolute"})});var _De=()=>typeof document<"u",RX=!1,NR=null,Qy=!1,YV=!1,XV=new Set;function r5(n,e){XV.forEach(i=>i(n,e))}var yDe=typeof window<"u"&&window.navigator!=null?/^Mac/.test(window.navigator.platform):!1;function EDe(n){return!(n.metaKey||!yDe&&n.altKey||n.ctrlKey||n.key==="Control"||n.key==="Shift"||n.key==="Meta")}function IX(n){Qy=!0,EDe(n)&&(NR="keyboard",r5("keyboard",n))}function C0(n){if(NR="pointer",n.type==="mousedown"||n.type==="pointerdown"){Qy=!0;const e=n.composedPath?n.composedPath()[0]:n.target;let i=!1;try{i=e.matches(":focus-visible")}catch{}if(i)return;r5("pointer",n)}}function vDe(n){return n.mozInputSource===0&&n.isTrusted?!0:n.detail===0&&!n.pointerType}function SDe(n){vDe(n)&&(Qy=!0,NR="virtual")}function bDe(n){n.target===window||n.target===document||n.target instanceof Element&&n.target.hasAttribute("tabindex")||(!Qy&&!YV&&(NR="virtual",r5("virtual",n)),Qy=!1,YV=!1)}function wDe(){Qy=!1,YV=!0}function AX(){return NR!=="pointer"}function TDe(){if(!_De()||RX)return;const{focus:n}=HTMLElement.prototype;HTMLElement.prototype.focus=function(...i){Qy=!0,n.apply(this,i)},document.addEventListener("keydown",IX,!0),document.addEventListener("keyup",IX,!0),document.addEventListener("click",SDe,!0),window.addEventListener("focus",bDe,!0),window.addEventListener("blur",wDe,!1),typeof PointerEvent<"u"?(document.addEventListener("pointerdown",C0,!0),document.addEventListener("pointermove",C0,!0),document.addEventListener("pointerup",C0,!0)):(document.addEventListener("mousedown",C0,!0),document.addEventListener("mousemove",C0,!0),document.addEventListener("mouseup",C0,!0)),RX=!0}function CDe(n){TDe(),n(AX());const e=()=>n(AX());return XV.add(e),()=>{XV.delete(e)}}const[RDe,Fne]=ki({name:"FormControlStylesContext",errorMessage:`useFormControlStyles returned is 'undefined'. Seems you forgot to wrap the components in "<FormControl />" `}),[IDe,XS]=ki({strict:!1,name:"FormControlContext"});function ADe(n){const{id:e,isRequired:i,isInvalid:o,isDisabled:l,isReadOnly:u,...p}=n,y=O.useId(),v=e||`field-${y}`,w=`${v}-label`,C=`${v}-feedback`,R=`${v}-helptext`,[N,M]=O.useState(!1),[L,U]=O.useState(!1),[z,J]=O.useState(!1),q=O.useCallback((H={},X=null)=>({id:R,...H,ref:$i(X,Q=>{Q&&U(!0)})}),[R]),re=O.useCallback((H={},X=null)=>({...H,ref:X,"data-focus":ur(z),"data-disabled":ur(l),"data-invalid":ur(o),"data-readonly":ur(u),id:H.id!==void 0?H.id:w,htmlFor:H.htmlFor!==void 0?H.htmlFor:v}),[v,l,z,o,u,w]),ce=O.useCallback((H={},X=null)=>({id:C,...H,ref:$i(X,Q=>{Q&&M(!0)}),"aria-live":"polite"}),[C]),ae=O.useCallback((H={},X=null)=>({...H,...p,ref:X,role:"group","data-focus":ur(z),"data-disabled":ur(l),"data-invalid":ur(o),"data-readonly":ur(u)}),[p,l,z,o,u]),pe=O.useCallback((H={},X=null)=>({...H,ref:X,role:"presentation","aria-hidden":!0,children:H.children||"*"}),[]);return{isRequired:!!i,isInvalid:!!o,isReadOnly:!!u,isDisabled:!!l,isFocused:!!z,onFocus:()=>J(!0),onBlur:()=>J(!1),hasFeedbackText:N,setHasFeedbackText:M,hasHelpText:L,setHasHelpText:U,id:v,labelId:w,feedbackId:C,helpTextId:R,htmlProps:p,getHelpTextProps:q,getErrorMessageProps:ce,getRootProps:ae,getLabelProps:re,getRequiredIndicatorProps:pe}}const br=Bt(function(e,i){const o=Na("Form",e),l=Fi(e),{getRootProps:u,htmlProps:p,...y}=ADe(l),v=yn("chakra-form-control",e.className);return S.jsx(IDe,{value:y,children:S.jsx(RDe,{value:o,children:S.jsx(Ut.div,{...u({},i),className:v,__css:o.container})})})});br.displayName="FormControl";const Hy=Bt(function(e,i){const o=XS(),l=Fne(),u=yn("chakra-form__helper-text",e.className);return S.jsx(Ut.div,{...o==null?void 0:o.getHelpTextProps(e,i),__css:l.helperText,className:u})});Hy.displayName="FormHelperText";function i5(n){const{isDisabled:e,isInvalid:i,isReadOnly:o,isRequired:l,...u}=s5(n);return{...u,disabled:e,readOnly:o,required:l,"aria-invalid":Nf(i),"aria-required":Nf(l),"aria-readonly":Nf(o)}}function s5(n){const e=XS(),{id:i,disabled:o,readOnly:l,required:u,isRequired:p,isInvalid:y,isReadOnly:v,isDisabled:w,onFocus:C,onBlur:R,...N}=n,M=n["aria-describedby"]?[n["aria-describedby"]]:[];return e!=null&&e.hasFeedbackText&&(e!=null&&e.isInvalid)&&M.push(e.feedbackId),e!=null&&e.hasHelpText&&M.push(e.helpTextId),{...N,"aria-describedby":M.join(" ")||void 0,id:i??(e==null?void 0:e.id),isDisabled:o??w??(e==null?void 0:e.isDisabled),isReadOnly:l??v??(e==null?void 0:e.isReadOnly),isRequired:u??p??(e==null?void 0:e.isRequired),isInvalid:y??(e==null?void 0:e.isInvalid),onFocus:Un(e==null?void 0:e.onFocus,C),onBlur:Un(e==null?void 0:e.onBlur,R)}}const PDe={border:"0",clip:"rect(0, 0, 0, 0)",height:"1px",width:"1px",margin:"-1px",padding:"0",overflow:"hidden",whiteSpace:"nowrap",position:"absolute"};function kDe(n={}){const e=s5(n),{isDisabled:i,isReadOnly:o,isRequired:l,isInvalid:u,id:p,onBlur:y,onFocus:v,"aria-describedby":w}=e,{defaultChecked:C,isChecked:R,isFocusable:N,onChange:M,isIndeterminate:L,name:U,value:z,tabIndex:J=void 0,"aria-label":q,"aria-labelledby":re,"aria-invalid":ce,...ae}=n,pe=GS(ae,["isDisabled","isReadOnly","isRequired","isInvalid","id","onBlur","onFocus","aria-describedby"]),H=so(M),X=so(y),Q=so(v),[ne,he]=O.useState(!1),[fe,de]=O.useState(!1),[ke,De]=O.useState(!1),[je,Te]=O.useState(!1);O.useEffect(()=>CDe(he),[]);const we=O.useRef(null),[Ie,Oe]=O.useState(!0),[ve,xe]=O.useState(!!C),Ge=R!==void 0,Ze=Ge?R:ve,lt=O.useCallback(Ft=>{if(o||i){Ft.preventDefault();return}Ge||xe(Ze?Ft.currentTarget.checked:L?!0:Ft.currentTarget.checked),H==null||H(Ft)},[o,i,Ze,Ge,L,H]);Sp(()=>{we.current&&(we.current.indeterminate=!!L)},[L]),jf(()=>{i&&de(!1)},[i,de]),Sp(()=>{const Ft=we.current;if(!(Ft!=null&&Ft.form))return;const on=()=>{xe(!!C)};return Ft.form.addEventListener("reset",on),()=>{var Ht;return(Ht=Ft.form)==null?void 0:Ht.removeEventListener("reset",on)}},[]);const vt=i&&!N,nt=O.useCallback(Ft=>{Ft.key===" "&&Te(!0)},[Te]),mt=O.useCallback(Ft=>{Ft.key===" "&&Te(!1)},[Te]);Sp(()=>{if(!we.current)return;we.current.checked!==Ze&&xe(we.current.checked)},[we.current]);const et=O.useCallback((Ft={},on=null)=>{const Ht=Se=>{fe&&Se.preventDefault(),Te(!0)};return{...Ft,ref:on,"data-active":ur(je),"data-hover":ur(ke),"data-checked":ur(Ze),"data-focus":ur(fe),"data-focus-visible":ur(fe&&ne),"data-indeterminate":ur(L),"data-disabled":ur(i),"data-invalid":ur(u),"data-readonly":ur(o),"aria-hidden":!0,onMouseDown:Un(Ft.onMouseDown,Ht),onMouseUp:Un(Ft.onMouseUp,()=>Te(!1)),onMouseEnter:Un(Ft.onMouseEnter,()=>De(!0)),onMouseLeave:Un(Ft.onMouseLeave,()=>De(!1))}},[je,Ze,i,fe,ne,ke,L,u,o]),St=O.useCallback((Ft={},on=null)=>({...Ft,ref:on,"data-active":ur(je),"data-hover":ur(ke),"data-checked":ur(Ze),"data-focus":ur(fe),"data-focus-visible":ur(fe&&ne),"data-indeterminate":ur(L),"data-disabled":ur(i),"data-invalid":ur(u),"data-readonly":ur(o)}),[je,Ze,i,fe,ne,ke,L,u,o]),un=O.useCallback((Ft={},on=null)=>({...pe,htmlFor:Ie?p:void 0,...Ft,ref:$i(on,Ht=>{Ht&&Oe(Ht.tagName==="LABEL")}),onClick:Un(Ft.onClick,()=>{var Ht;Ie||((Ht=we.current)==null||Ht.click(),requestAnimationFrame(()=>{var Se;(Se=we.current)==null||Se.focus({preventScroll:!0})}))}),"data-disabled":ur(i),"data-checked":ur(Ze),"data-invalid":ur(u)}),[pe,i,Ze,u,Ie,p]),ft=O.useCallback((Ft={},on=null)=>({...Ft,ref:$i(we,on),type:"checkbox",name:U,value:z,id:p,tabIndex:J,onChange:Un(Ft.onChange,lt),onBlur:Un(Ft.onBlur,X,()=>de(!1)),onFocus:Un(Ft.onFocus,Q,()=>de(!0)),onKeyDown:Un(Ft.onKeyDown,nt),onKeyUp:Un(Ft.onKeyUp,mt),required:l,checked:Ze,disabled:vt,readOnly:o,"aria-label":q,"aria-labelledby":re,"aria-invalid":ce?!!ce:u,"aria-describedby":w,"aria-disabled":i,"aria-checked":L?"mixed":Ze,style:PDe}),[U,z,p,J,lt,X,Q,nt,mt,l,Ze,vt,o,q,re,ce,u,w,i,L]),Ct=O.useCallback((Ft={},on=null)=>({...Ft,ref:on,onMouseDown:Un(Ft.onMouseDown,ODe),"data-disabled":ur(i),"data-checked":ur(Ze),"data-invalid":ur(u)}),[Ze,i,u]);return{state:{isInvalid:u,isFocused:fe,isChecked:Ze,isActive:je,isHovered:ke,isIndeterminate:L,isDisabled:i,isReadOnly:o,isRequired:l},getRootProps:un,getCheckboxProps:et,getIndicatorProps:St,getInputProps:ft,getLabelProps:Ct,htmlProps:pe}}function ODe(n){n.preventDefault(),n.stopPropagation()}const JV=Bt(function(e,i){const{className:o,centerContent:l,...u}=Fi(e),p=cu("Container",e);return S.jsx(Ut.div,{ref:i,className:yn("chakra-container",o),...u,__css:{...p,...l&&{display:"flex",flexDirection:"column",alignItems:"center"}}})});JV.displayName="Container";const Ug=Bt(function(e,i){const{borderLeftWidth:o,borderBottomWidth:l,borderTopWidth:u,borderRightWidth:p,borderWidth:y,borderStyle:v,borderColor:w,...C}=cu("Divider",e),{className:R,orientation:N="horizontal",__css:M,...L}=Fi(e),U={vertical:{borderLeftWidth:o||p||y||"1px",height:"100%"},horizontal:{borderBottomWidth:l||u||y||"1px",width:"100%"}};return S.jsx(Ut.hr,{ref:i,"aria-orientation":N,...L,__css:{...C,border:"0",borderColor:w,borderStyle:v,...U[N],...M},className:yn("chakra-divider",R)})});Ug.displayName="Divider";const Ur=Bt(function(e,i){const{direction:o,align:l,justify:u,wrap:p,basis:y,grow:v,shrink:w,...C}=e,R={display:"flex",flexDirection:o,alignItems:l,justifyContent:u,flexWrap:p,flexBasis:y,flexGrow:v,flexShrink:w};return S.jsx(Ut.div,{ref:i,__css:R,...C})});Ur.displayName="Flex";function NDe(n,e){if(n==null)return{};var i={};for(var o in n)if({}.hasOwnProperty.call(n,o)){if(e.indexOf(o)!==-1)continue;i[o]=n[o]}return i}var DU={exports:{}},xU,PX;function DDe(){if(PX)return xU;PX=1;var n="SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED";return xU=n,xU}var LU,kX;function xDe(){if(kX)return LU;kX=1;var n=DDe();function e(){}function i(){}return i.resetWarningCache=e,LU=function(){function o(p,y,v,w,C,R){if(R!==n){var N=new Error("Calling PropTypes validators directly is not supported by the `prop-types` package. Use PropTypes.checkPropTypes() to call them. Read more at http://fb.me/use-check-prop-types");throw N.name="Invariant Violation",N}}o.isRequired=o;function l(){return o}var u={array:o,bigint:o,bool:o,func:o,number:o,object:o,string:o,symbol:o,any:o,arrayOf:l,element:o,elementType:o,instanceOf:l,node:o,objectOf:l,oneOf:l,oneOfType:l,shape:l,exact:l,checkPropTypes:i,resetWarningCache:e};return u.PropTypes=u,u},LU}var OX;function LDe(){return OX||(OX=1,DU.exports=xDe()()),DU.exports}var MDe=LDe();const Tn=$g(MDe);var QV="data-focus-lock",jne="data-focus-lock-disabled",UDe="data-no-focus-lock",VDe="data-autofocus-inside",FDe="data-no-autofocus";function MU(n,e){return typeof n=="function"?n(e):n&&(n.current=e),n}function jDe(n,e){var i=O.useState(function(){return{value:n,callback:e,facade:{get current(){return i.value},set current(o){var l=i.value;l!==o&&(i.value=o,i.callback(o,l))}}}})[0];return i.callback=e,i.facade}var BDe=typeof window<"u"?O.useLayoutEffect:O.useEffect,NX=new WeakMap;function Bne(n,e){var i=jDe(null,function(o){return n.forEach(function(l){return MU(l,o)})});return BDe(function(){var o=NX.get(i);if(o){var l=new Set(o),u=new Set(n),p=i.current;l.forEach(function(y){u.has(y)||MU(y,null)}),u.forEach(function(y){l.has(y)||MU(y,p)})}NX.set(i,n)},[n]),i}var UU={width:"1px",height:"0px",padding:0,overflow:"hidden",position:"fixed",top:"1px",left:"1px"},fp=function(){return fp=Object.assign||function(e){for(var i,o=1,l=arguments.length;o<l;o++){i=arguments[o];for(var u in i)Object.prototype.hasOwnProperty.call(i,u)&&(e[u]=i[u])}return e},fp.apply(this,arguments)};function DR(n,e){var i={};for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&e.indexOf(o)<0&&(i[o]=n[o]);if(n!=null&&typeof Object.getOwnPropertySymbols=="function")for(var l=0,o=Object.getOwnPropertySymbols(n);l<o.length;l++)e.indexOf(o[l])<0&&Object.prototype.propertyIsEnumerable.call(n,o[l])&&(i[o[l]]=n[o[l]]);return i}function zDe(n,e,i){if(i||arguments.length===2)for(var o=0,l=e.length,u;o<l;o++)(u||!(o in e))&&(u||(u=Array.prototype.slice.call(e,0,o)),u[o]=e[o]);return n.concat(u||Array.prototype.slice.call(e))}function zne(n){return n}function Wne(n,e){e===void 0&&(e=zne);var i=[],o=!1,l={read:function(){if(o)throw new Error("Sidecar: could not `read` from an `assigned` medium. `read` could be used only with `useMedium`.");return i.length?i[i.length-1]:n},useMedium:function(u){var p=e(u,o);return i.push(p),function(){i=i.filter(function(y){return y!==p})}},assignSyncMedium:function(u){for(o=!0;i.length;){var p=i;i=[],p.forEach(u)}i={push:function(y){return u(y)},filter:function(){return i}}},assignMedium:function(u){o=!0;var p=[];if(i.length){var y=i;i=[],y.forEach(u),p=i}var v=function(){var C=p;p=[],C.forEach(u)},w=function(){return Promise.resolve().then(v)};w(),i={push:function(C){p.push(C),w()},filter:function(C){return p=p.filter(C),i}}}};return l}function o5(n,e){return e===void 0&&(e=zne),Wne(n,e)}function Gne(n){n===void 0&&(n={});var e=Wne(null);return e.options=fp({async:!0,ssr:!1},n),e}var Hne=function(n){var e=n.sideCar,i=DR(n,["sideCar"]);if(!e)throw new Error("Sidecar: please provide `sideCar` property to import the right car");var o=e.read();if(!o)throw new Error("Sidecar medium not found");return O.createElement(o,fp({},i))};Hne.isSideCarExport=!0;function WDe(n,e){return n.useMedium(e),Hne}var $ne=o5({},function(n){var e=n.target,i=n.currentTarget;return{target:e,currentTarget:i}}),Kne=o5(),GDe=o5(),HDe=Gne({async:!0,ssr:typeof document<"u"}),$De=O.createContext(void 0),KDe=[],a5=O.forwardRef(function(e,i){var o,l=O.useState(),u=l[0],p=l[1],y=O.useRef(),v=O.useRef(!1),w=O.useRef(null),C=O.useState({}),R=C[1],N=e.children,M=e.disabled,L=M===void 0?!1:M,U=e.noFocusGuards,z=U===void 0?!1:U,J=e.persistentFocus,q=J===void 0?!1:J,re=e.crossFrame,ce=re===void 0?!0:re,ae=e.autoFocus,pe=ae===void 0?!0:ae;e.allowTextSelection;var H=e.group,X=e.className,Q=e.whiteList,ne=e.hasPositiveIndices,he=e.shards,fe=he===void 0?KDe:he,de=e.as,ke=de===void 0?"div":de,De=e.lockProps,je=De===void 0?{}:De,Te=e.sideCar,we=e.returnFocus,Ie=we===void 0?!1:we,Oe=e.focusOptions,ve=e.onActivation,xe=e.onDeactivation,Ge=O.useState({}),Ze=Ge[0],lt=O.useCallback(function(on){var Ht=on.captureFocusRestore;if(!w.current){var Se,Ne=(Se=document)==null?void 0:Se.activeElement;w.current=Ne,Ne!==document.body&&(w.current=Ht(Ne))}y.current&&ve&&ve(y.current),v.current=!0,R()},[ve]),vt=O.useCallback(function(){v.current=!1,xe&&xe(y.current),R()},[xe]),nt=O.useCallback(function(on){var Ht=w.current;if(Ht){var Se=(typeof Ht=="function"?Ht():Ht)||document.body,Ne=typeof Ie=="function"?Ie(Se):Ie;if(Ne){var $e=typeof Ne=="object"?Ne:void 0;w.current=null,on?Promise.resolve().then(function(){return Se.focus($e)}):Se.focus($e)}}},[Ie]),mt=O.useCallback(function(on){v.current&&$ne.useMedium(on)},[]),et=Kne.useMedium,St=O.useCallback(function(on){y.current!==on&&(y.current=on,p(on))},[]),un=Jy((o={},o[jne]=L&&"disabled",o[QV]=H,o),je),ft=z!==!0,Ct=ft&&z!=="tail",ut=Bne([i,St]),Ft=O.useMemo(function(){return{observed:y,shards:fe,enabled:!L,active:v.current}},[L,v.current,fe,u]);return bi.createElement(O.Fragment,null,ft&&[bi.createElement("div",{key:"guard-first","data-focus-guard":!0,tabIndex:L?-1:0,style:UU}),ne?bi.createElement("div",{key:"guard-nearest","data-focus-guard":!0,tabIndex:L?-1:1,style:UU}):null],!L&&bi.createElement(Te,{id:Ze,sideCar:HDe,observed:u,disabled:L,persistentFocus:q,crossFrame:ce,autoFocus:pe,whiteList:Q,shards:fe,onActivation:lt,onDeactivation:vt,returnFocus:nt,focusOptions:Oe,noFocusGuards:z}),bi.createElement(ke,Jy({ref:ut},un,{className:X,onBlur:et,onFocus:mt}),bi.createElement($De.Provider,{value:Ft},N)),Ct&&bi.createElement("div",{"data-focus-guard":!0,tabIndex:L?-1:0,style:UU}))});a5.propTypes={};function ZV(n,e){return ZV=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(i,o){return i.__proto__=o,i},ZV(n,e)}function qDe(n,e){n.prototype=Object.create(e.prototype),n.prototype.constructor=n,ZV(n,e)}function rR(n){"@babel/helpers - typeof";return rR=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},rR(n)}function YDe(n,e){if(rR(n)!="object"||!n)return n;var i=n[Symbol.toPrimitive];if(i!==void 0){var o=i.call(n,e);if(rR(o)!="object")return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(n)}function XDe(n){var e=YDe(n,"string");return rR(e)=="symbol"?e:e+""}function JDe(n,e,i){return(e=XDe(e))in n?Object.defineProperty(n,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):n[e]=i,n}function QDe(n,e){function i(o){return o.displayName||o.name||"Component"}return function(l){var u=[],p;function y(){p=n(u.map(function(w){return w.props})),e(p)}var v=function(w){qDe(C,w);function C(){return w.apply(this,arguments)||this}C.peek=function(){return p};var R=C.prototype;return R.componentDidMount=function(){u.push(this),y()},R.componentDidUpdate=function(){y()},R.componentWillUnmount=function(){var M=u.indexOf(this);u.splice(M,1),y()},R.render=function(){return bi.createElement(l,this.props)},C}(O.PureComponent);return JDe(v,"displayName","SideEffect("+i(l)+")"),v}}var xp=function(n){for(var e=Array(n.length),i=0;i<n.length;++i)e[i]=n[i];return e},Zy=function(n){return Array.isArray(n)?n:[n]},qne=function(n){return Array.isArray(n)?n[0]:n},ZDe=function(n){if(n.nodeType!==Node.ELEMENT_NODE)return!1;var e=window.getComputedStyle(n,null);return!e||!e.getPropertyValue?!1:e.getPropertyValue("display")==="none"||e.getPropertyValue("visibility")==="hidden"},Yne=function(n){return n.parentNode&&n.parentNode.nodeType===Node.DOCUMENT_FRAGMENT_NODE?n.parentNode.host:n.parentNode},Xne=function(n){return n===document||n&&n.nodeType===Node.DOCUMENT_NODE},exe=function(n){return n.hasAttribute("inert")},txe=function(n,e){return!n||Xne(n)||!ZDe(n)&&!exe(n)&&e(Yne(n))},Jne=function(n,e){var i=n.get(e);if(i!==void 0)return i;var o=txe(e,Jne.bind(void 0,n));return n.set(e,o),o},nxe=function(n,e){return n&&!Xne(n)?sxe(n)?e(Yne(n)):!1:!0},Qne=function(n,e){var i=n.get(e);if(i!==void 0)return i;var o=nxe(e,Qne.bind(void 0,n));return n.set(e,o),o},Zne=function(n){return n.dataset},rxe=function(n){return n.tagName==="BUTTON"},ere=function(n){return n.tagName==="INPUT"},tre=function(n){return ere(n)&&n.type==="radio"},ixe=function(n){return!((ere(n)||rxe(n))&&(n.type==="hidden"||n.disabled))},sxe=function(n){var e=n.getAttribute(FDe);return![!0,"true",""].includes(e)},c5=function(n){var e;return!!(n&&(!((e=Zne(n))===null||e===void 0)&&e.focusGuard))},eF=function(n){return!c5(n)},oxe=function(n){return!!n},axe=function(n,e){var i=Math.max(0,n.tabIndex),o=Math.max(0,e.tabIndex),l=i-o,u=n.index-e.index;if(l){if(!i)return 1;if(!o)return-1}return l||u},cxe=function(n){return n.tabIndex<0&&!n.hasAttribute("tabindex")?0:n.tabIndex},l5=function(n,e,i){return xp(n).map(function(o,l){var u=cxe(o);return{node:o,index:l,tabIndex:i&&u===-1?(o.dataset||{}).focusGuard?0:-1:u}}).filter(function(o){return!e||o.tabIndex>=0}).sort(axe)},lxe=["button:enabled","select:enabled","textarea:enabled","input:enabled","a[href]","area[href]","summary","iframe","object","embed","audio[controls]","video[controls]","[tabindex]","[contenteditable]","[autofocus]"],u5=lxe.join(","),uxe="".concat(u5,", [data-focus-guard]"),nre=function(n,e){return xp((n.shadowRoot||n).children).reduce(function(i,o){return i.concat(o.matches(e?uxe:u5)?[o]:[],nre(o))},[])},dxe=function(n,e){var i;return n instanceof HTMLIFrameElement&&(!((i=n.contentDocument)===null||i===void 0)&&i.body)?CS([n.contentDocument.body],e):[n]},CS=function(n,e){return n.reduce(function(i,o){var l,u=nre(o,e),p=(l=[]).concat.apply(l,u.map(function(y){return dxe(y,e)}));return i.concat(p,o.parentNode?xp(o.parentNode.querySelectorAll(u5)).filter(function(y){return y===o}):[])},[])},hxe=function(n){var e=n.querySelectorAll("[".concat(VDe,"]"));return xp(e).map(function(i){return CS([i])}).reduce(function(i,o){return i.concat(o)},[])},d5=function(n,e){return xp(n).filter(function(i){return Jne(e,i)}).filter(function(i){return ixe(i)})},DX=function(n,e){return e===void 0&&(e=new Map),xp(n).filter(function(i){return Qne(e,i)})},h5=function(n,e,i){return l5(d5(CS(n,i),e),!0,i)},iR=function(n,e){return l5(d5(CS(n),e),!1)},pxe=function(n,e){return d5(hxe(n),e)},$y=function(n,e){return n.shadowRoot?$y(n.shadowRoot,e):Object.getPrototypeOf(n).contains!==void 0&&Object.getPrototypeOf(n).contains.call(n,e)?!0:xp(n.children).some(function(i){var o;if(i instanceof HTMLIFrameElement){var l=(o=i.contentDocument)===null||o===void 0?void 0:o.body;return l?$y(l,e):!1}return $y(i,e)})},fxe=function(n){for(var e=new Set,i=n.length,o=0;o<i;o+=1)for(var l=o+1;l<i;l+=1){var u=n[o].compareDocumentPosition(n[l]);(u&Node.DOCUMENT_POSITION_CONTAINED_BY)>0&&e.add(l),(u&Node.DOCUMENT_POSITION_CONTAINS)>0&&e.add(o)}return n.filter(function(p,y){return!e.has(y)})},rre=function(n){return n.parentNode?rre(n.parentNode):n},p5=function(n){var e=Zy(n);return e.filter(Boolean).reduce(function(i,o){var l=o.getAttribute(QV);return i.push.apply(i,l?fxe(xp(rre(o).querySelectorAll("[".concat(QV,'="').concat(l,'"]:not([').concat(jne,'="disabled"])')))):[o]),i},[])},mxe=function(n){try{return n()}catch{return}},sR=function(n){if(n===void 0&&(n=document),!(!n||!n.activeElement)){var e=n.activeElement;return e.shadowRoot?sR(e.shadowRoot):e instanceof HTMLIFrameElement&&mxe(function(){return e.contentWindow.document})?sR(e.contentWindow.document):e}},gxe=function(n,e){return n===e},_xe=function(n,e){return!!xp(n.querySelectorAll("iframe")).some(function(i){return gxe(i,e)})},ire=function(n,e){return e===void 0&&(e=sR(qne(n).ownerDocument)),!e||e.dataset&&e.dataset.focusGuard?!1:p5(n).some(function(i){return $y(i,e)||_xe(i,e)})},yxe=function(n){n===void 0&&(n=document);var e=sR(n);return e?xp(n.querySelectorAll("[".concat(UDe,"]"))).some(function(i){return $y(i,e)}):!1},Exe=function(n,e){return e.filter(tre).filter(function(i){return i.name===n.name}).filter(function(i){return i.checked})[0]||n},f5=function(n,e){return tre(n)&&n.name?Exe(n,e):n},vxe=function(n){var e=new Set;return n.forEach(function(i){return e.add(f5(i,n))}),n.filter(function(i){return e.has(i)})},xX=function(n){return n[0]&&n.length>1?f5(n[0],n):n[0]},LX=function(n,e){return n.indexOf(f5(e,n))},tF="NEW_FOCUS",Sxe=function(n,e,i,o,l){var u=n.length,p=n[0],y=n[u-1],v=c5(o);if(!(o&&n.indexOf(o)>=0)){var w=o!==void 0?i.indexOf(o):-1,C=l?i.indexOf(l):w,R=l?n.indexOf(l):-1;if(w===-1)return R!==-1?R:tF;if(R===-1)return tF;var N=w-C,M=i.indexOf(p),L=i.indexOf(y),U=vxe(i),z=o!==void 0?U.indexOf(o):-1,J=l?U.indexOf(l):z,q=U.filter(function(X){return X.tabIndex>=0}),re=o!==void 0?q.indexOf(o):-1,ce=l?q.indexOf(l):re,ae=re>=0&&ce>=0?ce-re:J-z;if(!N&&R>=0||e.length===0)return R;var pe=LX(n,e[0]),H=LX(n,e[e.length-1]);if(w<=M&&v&&Math.abs(N)>1)return H;if(w>=L&&v&&Math.abs(N)>1)return pe;if(N&&Math.abs(ae)>1)return R;if(w<=M)return H;if(w>L)return pe;if(N)return Math.abs(N)>1?R:(u+R+N)%u}},bxe=function(n){return function(e){var i,o=(i=Zne(e))===null||i===void 0?void 0:i.autofocus;return e.autofocus||o!==void 0&&o!=="false"||n.indexOf(e)>=0}},MX=function(n,e,i){var o=n.map(function(u){var p=u.node;return p}),l=DX(o.filter(bxe(i)));return l&&l.length?xX(l):xX(DX(e))},nF=function(n,e){return e===void 0&&(e=[]),e.push(n),n.parentNode&&nF(n.parentNode.host||n.parentNode,e),e},VU=function(n,e){for(var i=nF(n),o=nF(e),l=0;l<i.length;l+=1){var u=i[l];if(o.indexOf(u)>=0)return u}return!1},sre=function(n,e,i){var o=Zy(n),l=Zy(e),u=o[0],p=!1;return l.filter(Boolean).forEach(function(y){p=VU(p||y,y)||p,i.filter(Boolean).forEach(function(v){var w=VU(u,v);w&&(!p||$y(w,p)?p=w:p=VU(w,p))})}),p},UX=function(n,e){return n.reduce(function(i,o){return i.concat(pxe(o,e))},[])},wxe=function(n,e){var i=new Map;return e.forEach(function(o){return i.set(o.node,o)}),n.map(function(o){return i.get(o)}).filter(oxe)},Txe=function(n,e){var i=sR(Zy(n).length>0?document:qne(n).ownerDocument),o=p5(n).filter(eF),l=sre(i||n,n,o),u=new Map,p=iR(o,u),y=p.filter(function(L){var U=L.node;return eF(U)});if(y[0]){var v=iR([l],u).map(function(L){var U=L.node;return U}),w=wxe(v,y),C=w.map(function(L){var U=L.node;return U}),R=w.filter(function(L){var U=L.tabIndex;return U>=0}).map(function(L){var U=L.node;return U}),N=Sxe(C,R,v,i,e);if(N===tF){var M=MX(p,R,UX(o,u))||MX(p,C,UX(o,u));if(M)return{node:M};console.warn("focus-lock: cannot find any node to move focus into");return}return N===void 0?N:w[N]}},Cxe=function(n){var e=p5(n).filter(eF),i=sre(n,n,e),o=l5(CS([i],!0),!0,!0),l=CS(e,!1);return o.map(function(u){var p=u.node,y=u.index;return{node:p,index:y,lockItem:l.indexOf(p)>=0,guard:c5(p)}})},m5=function(n,e){n&&("focus"in n&&n.focus(e),"contentWindow"in n&&n.contentWindow&&n.contentWindow.focus())},FU=0,jU=!1,ore=function(n,e,i){i===void 0&&(i={});var o=Txe(n,e);if(!jU&&o){if(FU>2){console.error("FocusLock: focus-fighting detected. Only one focus management system could be active. See https://github.com/theKashey/focus-lock/#focus-fighting"),jU=!0,setTimeout(function(){jU=!1},1);return}FU++,m5(o.node,i.focusOptions),FU--}};function HT(n){if(!n)return null;if(typeof WeakRef>"u")return function(){return n||null};var e=n?new WeakRef(n):null;return function(){return(e==null?void 0:e.deref())||null}}var Rxe=function(n){if(!n)return null;for(var e=[],i=n;i&&i!==document.body;)e.push({current:HT(i),parent:HT(i.parentElement),left:HT(i.previousElementSibling),right:HT(i.nextElementSibling)}),i=i.parentElement;return{element:HT(n),stack:e,ownerDocument:n.ownerDocument}},Ixe=function(n){var e,i,o,l,u;if(n)for(var p=n.stack,y=n.ownerDocument,v=new Map,w=0,C=p;w<C.length;w++){var R=C[w],N=(e=R.parent)===null||e===void 0?void 0:e.call(R);if(N&&y.contains(N)){for(var M=(i=R.left)===null||i===void 0?void 0:i.call(R),L=R.current(),U=N.contains(L)?L:void 0,z=(o=R.right)===null||o===void 0?void 0:o.call(R),J=h5([N],v),q=(u=(l=U??(M==null?void 0:M.nextElementSibling))!==null&&l!==void 0?l:z)!==null&&u!==void 0?u:M;q;){for(var re=0,ce=J;re<ce.length;re++){var ae=ce[re];if(q!=null&&q.contains(ae.node))return ae.node}q=q.nextElementSibling}if(J.length)return J[0].node}}},are=function(n){var e=Rxe(n);return function(){return Ixe(e)}},Axe=function(n,e,i){if(!n||!e)return console.error("no element or scope given"),{};var o=Zy(e);if(o.every(function(p){return!$y(p,n)}))return console.error("Active element is not contained in the scope"),{};var l=i?h5(o,new Map):iR(o,new Map),u=l.findIndex(function(p){var y=p.node;return y===n});if(u!==-1)return{prev:l[u-1],next:l[u+1],first:l[0],last:l[l.length-1]}},Pxe=function(n,e){var i=e?h5(Zy(n),new Map):iR(Zy(n),new Map);return{first:i[0],last:i[i.length-1]}},kxe=function(n){return Object.assign({scope:document.body,cycle:!0,onlyTabbable:!0},n)},cre=function(n,e,i){e===void 0&&(e={});var o=kxe(e),l=Axe(n,o.scope,o.onlyTabbable);if(l){var u=i(l,o.cycle);u&&m5(u.node,o.focusOptions)}},Oxe=function(n,e){e===void 0&&(e={}),cre(n,e,function(i,o){var l=i.next,u=i.first;return l||o&&u})},Nxe=function(n,e){e===void 0&&(e={}),cre(n,e,function(i,o){var l=i.prev,u=i.last;return l||o&&u})},lre=function(n,e,i){var o,l=Pxe(n,(o=e.onlyTabbable)!==null&&o!==void 0?o:!0),u=l[i];u&&m5(u.node,e.focusOptions)},Dxe=function(n,e){e===void 0&&(e={}),lre(n,e,"first")},xxe=function(n,e){e===void 0&&(e={}),lre(n,e,"last")};function g5(n){setTimeout(n,1)}var Lxe=function(e){return e&&"current"in e?e.current:e},ure=function(){return document&&document.activeElement===document.body},Mxe=function(){return ure()||yxe()},iS=null,al=null,VX=function(){return null},sS=null,oR=!1,_5=!1,Uxe=function(){return!0},Vxe=function(e){return(iS.whiteList||Uxe)(e)},Fxe=function(e,i){sS={observerNode:e,portaledElement:i}},jxe=function(e){return sS&&sS.portaledElement===e};function FX(n,e,i,o){var l=null,u=n;do{var p=o[u];if(p.guard)p.node.dataset.focusAutoGuard&&(l=p);else if(p.lockItem){if(u!==n)return;l=null}else break}while((u+=i)!==e);l&&(l.node.tabIndex=0)}var Bxe=function(e){return e?!!oR:oR==="meanwhile"},zxe=function n(e,i,o){return i&&(i.host===e&&(!i.activeElement||o.contains(i.activeElement))||i.parentNode&&n(e,i.parentNode,o))},Wxe=function(e,i){return i.some(function(o){return zxe(e,o,o)})},dre=function(e){return iR(e,new Map)},Gxe=function(e){return!dre([e.parentNode]).some(function(i){return i.node===e})},dO=function(){var e=!1;if(iS){var i=iS,o=i.observed,l=i.persistentFocus,u=i.autoFocus,p=i.shards,y=i.crossFrame,v=i.focusOptions,w=i.noFocusGuards,C=o||sS&&sS.portaledElement;if(ure()&&al&&al!==document.body&&(!document.body.contains(al)||Gxe(al))){var R=VX();R&&R.focus()}var N=document&&document.activeElement;if(C){var M=[C].concat(p.map(Lxe).filter(Boolean)),L=function(){if(!Bxe(y)||!w||!al||_5)return!1;var re=dre(M),ce=re.findIndex(function(ae){var pe=ae.node;return pe===al});return ce===0||ce===re.length-1};if((!N||Vxe(N))&&(l||L()||!Mxe()||!al&&u)&&(C&&!(ire(M)||N&&Wxe(N,M)||jxe(N))&&(document&&!al&&N&&!u?(N.blur&&N.blur(),document.body.focus()):(e=ore(M,al,{focusOptions:v}),sS={})),al=document&&document.activeElement,al!==document.body&&(VX=are(al)),oR=!1),document&&N!==document.activeElement&&document.querySelector("[data-focus-auto-guard]")){var U=document&&document.activeElement,z=Cxe(M),J=z.map(function(q){var re=q.node;return re}).indexOf(U);J>-1&&(z.filter(function(q){var re=q.guard,ce=q.node;return re&&ce.dataset.focusAutoGuard}).forEach(function(q){var re=q.node;return re.removeAttribute("tabIndex")}),FX(J,z.length,1,z),FX(J,-1,-1,z))}}}return e},hre=function(e){dO()&&e&&(e.stopPropagation(),e.preventDefault())},y5=function(){return g5(dO)},Hxe=function(e){var i=e.target,o=e.currentTarget;o.contains(i)||Fxe(o,i)},$xe=function(){return null},pre=function(){_5=!0},fre=function(){_5=!1,oR="just",g5(function(){oR="meanwhile"})},Kxe=function(){document.addEventListener("focusin",hre),document.addEventListener("focusout",y5),window.addEventListener("focus",pre),window.addEventListener("blur",fre)},qxe=function(){document.removeEventListener("focusin",hre),document.removeEventListener("focusout",y5),window.removeEventListener("focus",pre),window.removeEventListener("blur",fre)};function Yxe(n){return n.filter(function(e){var i=e.disabled;return!i})}var mre={moveFocusInside:ore,focusInside:ire,focusNextElement:Oxe,focusPrevElement:Nxe,focusFirstElement:Dxe,focusLastElement:xxe,captureFocusRestore:are};function Xxe(n){var e=n.slice(-1)[0];e&&!iS&&Kxe();var i=iS,o=i&&e&&e.id===i.id;iS=e,i&&!o&&(i.onDeactivation(),n.filter(function(l){var u=l.id;return u===i.id}).length||i.returnFocus(!e)),e?(al=null,(!o||i.observed!==e.observed)&&e.onActivation(mre),dO(),g5(dO)):(qxe(),al=null)}$ne.assignSyncMedium(Hxe);Kne.assignMedium(y5);GDe.assignMedium(function(n){return n(mre)});const Jxe=QDe(Yxe,Xxe)($xe);var rF=O.forwardRef(function(e,i){return bi.createElement(a5,Jy({sideCar:Jxe,ref:i},e))}),gre=a5.propTypes||{};gre.sideCar;NDe(gre,["sideCar"]);rF.propTypes={};const Qxe=rF.default??rF,_re=n=>{const{initialFocusRef:e,finalFocusRef:i,contentRef:o,restoreFocus:l,children:u,isDisabled:p,autoFocus:y,persistentFocus:v,lockFocusAcrossFrames:w}=n,C=O.useCallback(()=>{e!=null&&e.current?e.current.focus():o!=null&&o.current&&eee(o.current).length===0&&requestAnimationFrame(()=>{var L;(L=o.current)==null||L.focus()})},[e,o]),R=O.useCallback(()=>{var M;(M=i==null?void 0:i.current)==null||M.focus()},[i]),N=l&&!i;return S.jsx(Qxe,{crossFrame:w,persistentFocus:v,autoFocus:y,disabled:p,onActivation:C,onDeactivation:R,returnFocus:N,children:u})};_re.displayName="FocusLock";const[Zxe,eLe]=ki({name:"FormErrorStylesContext",errorMessage:`useFormErrorStyles returned is 'undefined'. Seems you forgot to wrap the components in "<FormError />" `}),hp=Bt((n,e)=>{const i=Na("FormError",n),o=Fi(n),l=XS();return l!=null&&l.isInvalid?S.jsx(Zxe,{value:i,children:S.jsx(Ut.div,{...l==null?void 0:l.getErrorMessageProps(o,e),className:yn("chakra-form__error-message",n.className),__css:{display:"flex",alignItems:"center",...i.text}})}):null});hp.displayName="FormErrorMessage";const tLe=Bt((n,e)=>{const i=eLe(),o=XS();if(!(o!=null&&o.isInvalid))return null;const l=yn("chakra-form__error-icon",n.className);return S.jsx(Sn,{ref:e,"aria-hidden":!0,...n,__css:i.icon,className:l,children:S.jsx("path",{fill:"currentColor",d:"M11.983,0a12.206,12.206,0,0,0-8.51,3.653A11.8,11.8,0,0,0,0,12.207,11.779,11.779,0,0,0,11.8,24h.214A12.111,12.111,0,0,0,24,11.791h0A11.766,11.766,0,0,0,11.983,0ZM10.5,16.542a1.476,1.476,0,0,1,1.449-1.53h.027a1.527,1.527,0,0,1,1.523,1.47,1.475,1.475,0,0,1-1.449,1.53h-.027A1.529,1.529,0,0,1,10.5,16.542ZM11,12.5v-6a1,1,0,0,1,2,0v6a1,1,0,1,1-2,0Z"})})});tLe.displayName="FormErrorIcon";const gi=Bt(function(e,i){const o=cu("FormLabel",e),l=Fi(e),{className:u,children:p,requiredIndicator:y=S.jsx(yre,{}),optionalIndicator:v=null,...w}=l,C=XS(),R=(C==null?void 0:C.getLabelProps(w,i))??{ref:i,...w};return S.jsxs(Ut.label,{...R,className:yn("chakra-form__label",l.className),__css:{display:"block",textAlign:"start",...o},children:[p,C!=null&&C.isRequired?y:v]})});gi.displayName="FormLabel";const yre=Bt(function(e,i){const o=XS(),l=Fne();if(!(o!=null&&o.isRequired))return null;const u=yn("chakra-form__required-indicator",e.className);return S.jsx(Ut.span,{...o==null?void 0:o.getRequiredIndicatorProps(e,i),__css:l.requiredIndicator,className:u})});yre.displayName="RequiredIndicator";const E5=Bt(function(e,i){const{templateAreas:o,gap:l,rowGap:u,columnGap:p,column:y,row:v,autoFlow:w,autoRows:C,templateRows:R,autoColumns:N,templateColumns:M,...L}=e,U={display:"grid",gridTemplateAreas:o,gridGap:l,gridRowGap:u,gridColumnGap:p,gridAutoColumns:N,gridColumn:y,gridRow:v,gridAutoFlow:w,gridAutoRows:C,gridTemplateRows:R,gridTemplateColumns:M};return S.jsx(Ut.div,{ref:i,__css:U,...L})});E5.displayName="Grid";const Ere=Bt(function(e,i){const{columns:o,spacingX:l,spacingY:u,spacing:p,minChildWidth:y,...v}=e,w=YS(),C=y?rLe(y,w):iLe(o);return S.jsx(E5,{ref:i,gap:p,columnGap:l,rowGap:u,templateColumns:C,...v})});Ere.displayName="SimpleGrid";function nLe(n){return typeof n=="number"?`${n}px`:n}function rLe(n,e){return qO(n,i=>{const o=UNe("sizes",i,nLe(i))(e);return i===null?null:`repeat(auto-fit, minmax(${o}, 1fr))`})}function iLe(n){return qO(n,e=>e===null?null:`repeat(${e}, minmax(0, 1fr))`)}function qg(n){const{viewBox:e="0 0 24 24",d:i,displayName:o,defaultProps:l={}}=n,u=O.Children.toArray(n.path),p=Bt((y,v)=>S.jsx(Sn,{ref:v,viewBox:e,...l,...y,children:u.length?u:S.jsx("path",{fill:"currentColor",d:i})}));return p.displayName=o,p}const iF=Bt(function(e,i){const{htmlWidth:o,htmlHeight:l,alt:u,...p}=e;return S.jsx("img",{width:o,height:l,ref:i,alt:u,...p})});iF.displayName="NativeImage";const yp=Bt(function(e,i){const{fallbackSrc:o,fallback:l,src:u,srcSet:p,align:y,fit:v,loading:w,ignoreFallback:C,crossOrigin:R,fallbackStrategy:N="beforeLoadOrError",referrerPolicy:M,...L}=e,U=o!==void 0||l!==void 0,z=w!=null||C||!U,J=Mne({...e,crossOrigin:R,ignoreFallback:z}),q=hDe(J,N),re={ref:i,objectFit:v,objectPosition:y,...z?L:GS(L,["onError","onLoad"])};return q?l||S.jsx(Ut.img,{as:iF,className:"chakra-image__placeholder",src:o,...re}):S.jsx(Ut.img,{as:iF,src:u,srcSet:p,crossOrigin:R,loading:w,referrerPolicy:M,className:"chakra-image",...re})});yp.displayName="Image";const li=Bt(function(e,i){const{htmlSize:o,...l}=e,u=Na("Input",l),p=Fi(l),y=i5(p),v=yn("chakra-input",e.className);return S.jsx(Ut.input,{size:o,...y,__css:u.field,ref:i,className:v})});li.displayName="Input";li.id="Input";const[sLe,vre]=ki({name:"InputGroupStylesContext",errorMessage:`useInputGroupStyles returned is 'undefined'. Seems you forgot to wrap the components in "<InputGroup />" `}),Pg=Bt(function(e,i){const o=Na("Input",e),{children:l,className:u,...p}=Fi(e),y=yn("chakra-input__group",u),v={},w=$O(l),C=o.field;w.forEach(N=>{o&&(C&&N.type.id==="InputLeftElement"&&(v.paddingStart=C.height??C.h),C&&N.type.id==="InputRightElement"&&(v.paddingEnd=C.height??C.h),N.type.id==="InputRightAddon"&&(v.borderEndRadius=0),N.type.id==="InputLeftAddon"&&(v.borderStartRadius=0))});const R=w.map(N=>{var L,U;const M=KO({size:((L=N.props)==null?void 0:L.size)||e.size,variant:((U=N.props)==null?void 0:U.variant)||e.variant});return N.type.id!=="Input"?O.cloneElement(N,M):O.cloneElement(N,Object.assign(M,v,N.props))});return S.jsx(Ut.div,{className:y,ref:i,__css:{width:"100%",display:"flex",position:"relative",isolation:"isolate",...o.group},"data-group":!0,...p,children:S.jsx(sLe,{value:o,children:R})})});Pg.displayName="InputGroup";const oLe={left:{marginEnd:"-1px",borderEndRadius:0,borderEndColor:"transparent"},right:{marginStart:"-1px",borderStartRadius:0,borderStartColor:"transparent"}},aLe=Ut("div",{baseStyle:{flex:"0 0 auto",width:"auto",display:"flex",alignItems:"center",whiteSpace:"nowrap"}}),v5=Bt(function(e,i){const{placement:o="left",...l}=e,u=oLe[o]??{},p=vre();return S.jsx(aLe,{ref:i,...l,__css:{...p.addon,...u}})});v5.displayName="InputAddon";const dN=Bt(function(e,i){return S.jsx(v5,{ref:i,placement:"left",...e,className:yn("chakra-input__left-addon",e.className)})});dN.displayName="InputLeftAddon";dN.id="InputLeftAddon";const Sre=Bt(function(e,i){return S.jsx(v5,{ref:i,placement:"right",...e,className:yn("chakra-input__right-addon",e.className)})});Sre.displayName="InputRightAddon";Sre.id="InputRightAddon";const cLe=Ut("div",{baseStyle:{display:"flex",alignItems:"center",justifyContent:"center",position:"absolute",top:"0",zIndex:2}}),hN=Bt(function(e,i){const{placement:o="left",...l}=e,u=vre(),p=u.field,v={[o==="left"?"insetStart":"insetEnd"]:"0",width:(p==null?void 0:p.height)??(p==null?void 0:p.h),height:(p==null?void 0:p.height)??(p==null?void 0:p.h),fontSize:p==null?void 0:p.fontSize,...u.element};return S.jsx(cLe,{ref:i,__css:v,...l})});hN.id="InputElement";hN.displayName="InputElement";const LC=Bt(function(e,i){const{className:o,...l}=e,u=yn("chakra-input__left-element",o);return S.jsx(hN,{ref:i,placement:"left",className:u,...l})});LC.id="InputLeftElement";LC.displayName="InputLeftElement";const hO=Bt(function(e,i){const{className:o,...l}=e,u=yn("chakra-input__right-element",o);return S.jsx(hN,{ref:i,placement:"right",className:u,...l})});hO.id="InputRightElement";hO.displayName="InputRightElement";const Zl=Bt(function(e,i){const o=cu("Link",e),{className:l,isExternal:u,...p}=Fi(e);return S.jsx(Ut.a,{target:u?"_blank":void 0,rel:u?"noopener":void 0,ref:i,className:yn("chakra-link",l),...p,__css:o})});Zl.displayName="Link";const[lLe,bre]=ki({name:"ListStylesContext",errorMessage:`useListStyles returned is 'undefined'. Seems you forgot to wrap the components in "<List />" `}),pN=Bt(function(e,i){const o=Na("List",e),{children:l,styleType:u="none",stylePosition:p,spacing:y,...v}=Fi(e),w=$O(l),R=y?{["& > *:not(style) ~ *:not(style)"]:{mt:y}}:{};return S.jsx(lLe,{value:o,children:S.jsx(Ut.ul,{ref:i,listStyleType:u,listStylePosition:p,role:"list",__css:{...o.container,...R},...v,children:w})})});pN.displayName="List";const uLe=Bt((n,e)=>{const{as:i,...o}=n;return S.jsx(pN,{ref:e,as:"ol",styleType:"decimal",marginStart:"1em",...o})});uLe.displayName="OrderedList";const dLe=Bt(function(e,i){const{as:o,...l}=e;return S.jsx(pN,{ref:i,as:"ul",styleType:"initial",marginStart:"1em",...l})});dLe.displayName="UnorderedList";const wre=Bt(function(e,i){const o=bre();return S.jsx(Ut.li,{ref:i,...e,__css:o.item})});wre.displayName="ListItem";const hLe=Bt(function(e,i){const o=bre();return S.jsx(Sn,{ref:i,role:"presentation",...e,__css:o.icon})});hLe.displayName="ListIcon";function pLe(n,e={}){const{ssr:i=!0,fallback:o}=e,{getWindow:l}=jAe(),u=Array.isArray(n)?n:[n];let p=Array.isArray(o)?o:[o];p=p.filter(w=>w!=null);const[y,v]=O.useState(()=>u.map((w,C)=>({media:w,matches:i?!!p[C]:l().matchMedia(w).matches})));return O.useEffect(()=>{const w=l();v(u.map(N=>({media:N,matches:w.matchMedia(N).matches})));const C=u.map(N=>w.matchMedia(N)),R=N=>{v(M=>M.slice().map(L=>L.media===N.media?{...L,matches:N.matches}:L))};return C.forEach(N=>{typeof N.addListener=="function"?N.addListener(R):N.addEventListener("change",R)}),()=>{C.forEach(N=>{typeof N.removeListener=="function"?N.removeListener(R):N.removeEventListener("change",R)})}},[l]),y.map(w=>w.matches)}function fLe(n,e,i,o){if(e==null)return o;if(!o)return n.find(p=>i(p).toLowerCase().startsWith(e.toLowerCase()));const l=n.filter(u=>i(u).toLowerCase().startsWith(e.toLowerCase()));if(l.length>0){let u;return l.includes(o)?(u=l.indexOf(o)+1,u===l.length&&(u=0),l[u]):(u=n.indexOf(l[0]),n[u])}return o}function mLe(n){const{key:e}=n;return e.length===1||e.length>1&&/[^a-zA-Z0-9]/.test(e)}function gLe(n={}){const{timeout:e=300,preventDefault:i=()=>!0}=n,[o,l]=O.useState([]),u=O.useRef(void 0),p=()=>{u.current&&(clearTimeout(u.current),u.current=null)},y=()=>{p(),u.current=setTimeout(()=>{l([]),u.current=null},e)};O.useEffect(()=>p,[]);function v(w){return C=>{if(C.key==="Backspace"){const R=[...o];R.pop(),l(R);return}if(mLe(C)){const R=o.concat(C.key);i(C)&&(C.preventDefault(),C.stopPropagation()),l(R),w(R.join("")),y()}}}return v}var gl="top",ad="bottom",cd="right",_l="left",S5="auto",xR=[gl,ad,cd,_l],RS="start",aR="end",_Le="clippingParents",Tre="viewport",$T="popper",yLe="reference",jX=xR.reduce(function(n,e){return n.concat([e+"-"+RS,e+"-"+aR])},[]),Cre=[].concat(xR,[S5]).reduce(function(n,e){return n.concat([e,e+"-"+RS,e+"-"+aR])},[]),ELe="beforeRead",vLe="read",SLe="afterRead",bLe="beforeMain",wLe="main",TLe="afterMain",CLe="beforeWrite",RLe="write",ILe="afterWrite",ALe=[ELe,vLe,SLe,bLe,wLe,TLe,CLe,RLe,ILe];function Op(n){return n?(n.nodeName||"").toLowerCase():null}function au(n){if(n==null)return window;if(n.toString()!=="[object Window]"){var e=n.ownerDocument;return e&&e.defaultView||window}return n}function eE(n){var e=au(n).Element;return n instanceof e||n instanceof Element}function td(n){var e=au(n).HTMLElement;return n instanceof e||n instanceof HTMLElement}function b5(n){if(typeof ShadowRoot>"u")return!1;var e=au(n).ShadowRoot;return n instanceof e||n instanceof ShadowRoot}function PLe(n){var e=n.state;Object.keys(e.elements).forEach(function(i){var o=e.styles[i]||{},l=e.attributes[i]||{},u=e.elements[i];!td(u)||!Op(u)||(Object.assign(u.style,o),Object.keys(l).forEach(function(p){var y=l[p];y===!1?u.removeAttribute(p):u.setAttribute(p,y===!0?"":y)}))})}function kLe(n){var e=n.state,i={popper:{position:e.options.strategy,left:"0",top:"0",margin:"0"},arrow:{position:"absolute"},reference:{}};return Object.assign(e.elements.popper.style,i.popper),e.styles=i,e.elements.arrow&&Object.assign(e.elements.arrow.style,i.arrow),function(){Object.keys(e.elements).forEach(function(o){var l=e.elements[o],u=e.attributes[o]||{},p=Object.keys(e.styles.hasOwnProperty(o)?e.styles[o]:i[o]),y=p.reduce(function(v,w){return v[w]="",v},{});!td(l)||!Op(l)||(Object.assign(l.style,y),Object.keys(u).forEach(function(v){l.removeAttribute(v)}))})}}const OLe={name:"applyStyles",enabled:!0,phase:"write",fn:PLe,effect:kLe,requires:["computeStyles"]};function Rp(n){return n.split("-")[0]}var Ky=Math.max,pO=Math.min,IS=Math.round;function sF(){var n=navigator.userAgentData;return n!=null&&n.brands&&Array.isArray(n.brands)?n.brands.map(function(e){return e.brand+"/"+e.version}).join(" "):navigator.userAgent}function Rre(){return!/^((?!chrome|android).)*safari/i.test(sF())}function AS(n,e,i){e===void 0&&(e=!1),i===void 0&&(i=!1);var o=n.getBoundingClientRect(),l=1,u=1;e&&td(n)&&(l=n.offsetWidth>0&&IS(o.width)/n.offsetWidth||1,u=n.offsetHeight>0&&IS(o.height)/n.offsetHeight||1);var p=eE(n)?au(n):window,y=p.visualViewport,v=!Rre()&&i,w=(o.left+(v&&y?y.offsetLeft:0))/l,C=(o.top+(v&&y?y.offsetTop:0))/u,R=o.width/l,N=o.height/u;return{width:R,height:N,top:C,right:w+R,bottom:C+N,left:w,x:w,y:C}}function w5(n){var e=AS(n),i=n.offsetWidth,o=n.offsetHeight;return Math.abs(e.width-i)<=1&&(i=e.width),Math.abs(e.height-o)<=1&&(o=e.height),{x:n.offsetLeft,y:n.offsetTop,width:i,height:o}}function Ire(n,e){var i=e.getRootNode&&e.getRootNode();if(n.contains(e))return!0;if(i&&b5(i)){var o=e;do{if(o&&n.isSameNode(o))return!0;o=o.parentNode||o.host}while(o)}return!1}function Wf(n){return au(n).getComputedStyle(n)}function NLe(n){return["table","td","th"].indexOf(Op(n))>=0}function Yg(n){return((eE(n)?n.ownerDocument:n.document)||window.document).documentElement}function fN(n){return Op(n)==="html"?n:n.assignedSlot||n.parentNode||(b5(n)?n.host:null)||Yg(n)}function BX(n){return!td(n)||Wf(n).position==="fixed"?null:n.offsetParent}function DLe(n){var e=/firefox/i.test(sF()),i=/Trident/i.test(sF());if(i&&td(n)){var o=Wf(n);if(o.position==="fixed")return null}var l=fN(n);for(b5(l)&&(l=l.host);td(l)&&["html","body"].indexOf(Op(l))<0;){var u=Wf(l);if(u.transform!=="none"||u.perspective!=="none"||u.contain==="paint"||["transform","perspective"].indexOf(u.willChange)!==-1||e&&u.willChange==="filter"||e&&u.filter&&u.filter!=="none")return l;l=l.parentNode}return null}function LR(n){for(var e=au(n),i=BX(n);i&&NLe(i)&&Wf(i).position==="static";)i=BX(i);return i&&(Op(i)==="html"||Op(i)==="body"&&Wf(i).position==="static")?e:i||DLe(n)||e}function T5(n){return["top","bottom"].indexOf(n)>=0?"x":"y"}function MC(n,e,i){return Ky(n,pO(e,i))}function xLe(n,e,i){var o=MC(n,e,i);return o>i?i:o}function Are(){return{top:0,right:0,bottom:0,left:0}}function Pre(n){return Object.assign({},Are(),n)}function kre(n,e){return e.reduce(function(i,o){return i[o]=n,i},{})}var LLe=function(e,i){return e=typeof e=="function"?e(Object.assign({},i.rects,{placement:i.placement})):e,Pre(typeof e!="number"?e:kre(e,xR))};function MLe(n){var e,i=n.state,o=n.name,l=n.options,u=i.elements.arrow,p=i.modifiersData.popperOffsets,y=Rp(i.placement),v=T5(y),w=[_l,cd].indexOf(y)>=0,C=w?"height":"width";if(!(!u||!p)){var R=LLe(l.padding,i),N=w5(u),M=v==="y"?gl:_l,L=v==="y"?ad:cd,U=i.rects.reference[C]+i.rects.reference[v]-p[v]-i.rects.popper[C],z=p[v]-i.rects.reference[v],J=LR(u),q=J?v==="y"?J.clientHeight||0:J.clientWidth||0:0,re=U/2-z/2,ce=R[M],ae=q-N[C]-R[L],pe=q/2-N[C]/2+re,H=MC(ce,pe,ae),X=v;i.modifiersData[o]=(e={},e[X]=H,e.centerOffset=H-pe,e)}}function ULe(n){var e=n.state,i=n.options,o=i.element,l=o===void 0?"[data-popper-arrow]":o;l!=null&&(typeof l=="string"&&(l=e.elements.popper.querySelector(l),!l)||Ire(e.elements.popper,l)&&(e.elements.arrow=l))}const VLe={name:"arrow",enabled:!0,phase:"main",fn:MLe,effect:ULe,requires:["popperOffsets"],requiresIfExists:["preventOverflow"]};function PS(n){return n.split("-")[1]}var FLe={top:"auto",right:"auto",bottom:"auto",left:"auto"};function jLe(n,e){var i=n.x,o=n.y,l=e.devicePixelRatio||1;return{x:IS(i*l)/l||0,y:IS(o*l)/l||0}}function zX(n){var e,i=n.popper,o=n.popperRect,l=n.placement,u=n.variation,p=n.offsets,y=n.position,v=n.gpuAcceleration,w=n.adaptive,C=n.roundOffsets,R=n.isFixed,N=p.x,M=N===void 0?0:N,L=p.y,U=L===void 0?0:L,z=typeof C=="function"?C({x:M,y:U}):{x:M,y:U};M=z.x,U=z.y;var J=p.hasOwnProperty("x"),q=p.hasOwnProperty("y"),re=_l,ce=gl,ae=window;if(w){var pe=LR(i),H="clientHeight",X="clientWidth";if(pe===au(i)&&(pe=Yg(i),Wf(pe).position!=="static"&&y==="absolute"&&(H="scrollHeight",X="scrollWidth")),pe=pe,l===gl||(l===_l||l===cd)&&u===aR){ce=ad;var Q=R&&pe===ae&&ae.visualViewport?ae.visualViewport.height:pe[H];U-=Q-o.height,U*=v?1:-1}if(l===_l||(l===gl||l===ad)&&u===aR){re=cd;var ne=R&&pe===ae&&ae.visualViewport?ae.visualViewport.width:pe[X];M-=ne-o.width,M*=v?1:-1}}var he=Object.assign({position:y},w&&FLe),fe=C===!0?jLe({x:M,y:U},au(i)):{x:M,y:U};if(M=fe.x,U=fe.y,v){var de;return Object.assign({},he,(de={},de[ce]=q?"0":"",de[re]=J?"0":"",de.transform=(ae.devicePixelRatio||1)<=1?"translate("+M+"px, "+U+"px)":"translate3d("+M+"px, "+U+"px, 0)",de))}return Object.assign({},he,(e={},e[ce]=q?U+"px":"",e[re]=J?M+"px":"",e.transform="",e))}function BLe(n){var e=n.state,i=n.options,o=i.gpuAcceleration,l=o===void 0?!0:o,u=i.adaptive,p=u===void 0?!0:u,y=i.roundOffsets,v=y===void 0?!0:y,w={placement:Rp(e.placement),variation:PS(e.placement),popper:e.elements.popper,popperRect:e.rects.popper,gpuAcceleration:l,isFixed:e.options.strategy==="fixed"};e.modifiersData.popperOffsets!=null&&(e.styles.popper=Object.assign({},e.styles.popper,zX(Object.assign({},w,{offsets:e.modifiersData.popperOffsets,position:e.options.strategy,adaptive:p,roundOffsets:v})))),e.modifiersData.arrow!=null&&(e.styles.arrow=Object.assign({},e.styles.arrow,zX(Object.assign({},w,{offsets:e.modifiersData.arrow,position:"absolute",adaptive:!1,roundOffsets:v})))),e.attributes.popper=Object.assign({},e.attributes.popper,{"data-popper-placement":e.placement})}const zLe={name:"computeStyles",enabled:!0,phase:"beforeWrite",fn:BLe,data:{}};var X1={passive:!0};function WLe(n){var e=n.state,i=n.instance,o=n.options,l=o.scroll,u=l===void 0?!0:l,p=o.resize,y=p===void 0?!0:p,v=au(e.elements.popper),w=[].concat(e.scrollParents.reference,e.scrollParents.popper);return u&&w.forEach(function(C){C.addEventListener("scroll",i.update,X1)}),y&&v.addEventListener("resize",i.update,X1),function(){u&&w.forEach(function(C){C.removeEventListener("scroll",i.update,X1)}),y&&v.removeEventListener("resize",i.update,X1)}}const GLe={name:"eventListeners",enabled:!0,phase:"write",fn:function(){},effect:WLe,data:{}};var HLe={left:"right",right:"left",bottom:"top",top:"bottom"};function Dk(n){return n.replace(/left|right|bottom|top/g,function(e){return HLe[e]})}var $Le={start:"end",end:"start"};function WX(n){return n.replace(/start|end/g,function(e){return $Le[e]})}function C5(n){var e=au(n),i=e.pageXOffset,o=e.pageYOffset;return{scrollLeft:i,scrollTop:o}}function R5(n){return AS(Yg(n)).left+C5(n).scrollLeft}function KLe(n,e){var i=au(n),o=Yg(n),l=i.visualViewport,u=o.clientWidth,p=o.clientHeight,y=0,v=0;if(l){u=l.width,p=l.height;var w=Rre();(w||!w&&e==="fixed")&&(y=l.offsetLeft,v=l.offsetTop)}return{width:u,height:p,x:y+R5(n),y:v}}function qLe(n){var e,i=Yg(n),o=C5(n),l=(e=n.ownerDocument)==null?void 0:e.body,u=Ky(i.scrollWidth,i.clientWidth,l?l.scrollWidth:0,l?l.clientWidth:0),p=Ky(i.scrollHeight,i.clientHeight,l?l.scrollHeight:0,l?l.clientHeight:0),y=-o.scrollLeft+R5(n),v=-o.scrollTop;return Wf(l||i).direction==="rtl"&&(y+=Ky(i.clientWidth,l?l.clientWidth:0)-u),{width:u,height:p,x:y,y:v}}function I5(n){var e=Wf(n),i=e.overflow,o=e.overflowX,l=e.overflowY;return/auto|scroll|overlay|hidden/.test(i+l+o)}function Ore(n){return["html","body","#document"].indexOf(Op(n))>=0?n.ownerDocument.body:td(n)&&I5(n)?n:Ore(fN(n))}function UC(n,e){var i;e===void 0&&(e=[]);var o=Ore(n),l=o===((i=n.ownerDocument)==null?void 0:i.body),u=au(o),p=l?[u].concat(u.visualViewport||[],I5(o)?o:[]):o,y=e.concat(p);return l?y:y.concat(UC(fN(p)))}function oF(n){return Object.assign({},n,{left:n.x,top:n.y,right:n.x+n.width,bottom:n.y+n.height})}function YLe(n,e){var i=AS(n,!1,e==="fixed");return i.top=i.top+n.clientTop,i.left=i.left+n.clientLeft,i.bottom=i.top+n.clientHeight,i.right=i.left+n.clientWidth,i.width=n.clientWidth,i.height=n.clientHeight,i.x=i.left,i.y=i.top,i}function GX(n,e,i){return e===Tre?oF(KLe(n,i)):eE(e)?YLe(e,i):oF(qLe(Yg(n)))}function XLe(n){var e=UC(fN(n)),i=["absolute","fixed"].indexOf(Wf(n).position)>=0,o=i&&td(n)?LR(n):n;return eE(o)?e.filter(function(l){return eE(l)&&Ire(l,o)&&Op(l)!=="body"}):[]}function JLe(n,e,i,o){var l=e==="clippingParents"?XLe(n):[].concat(e),u=[].concat(l,[i]),p=u[0],y=u.reduce(function(v,w){var C=GX(n,w,o);return v.top=Ky(C.top,v.top),v.right=pO(C.right,v.right),v.bottom=pO(C.bottom,v.bottom),v.left=Ky(C.left,v.left),v},GX(n,p,o));return y.width=y.right-y.left,y.height=y.bottom-y.top,y.x=y.left,y.y=y.top,y}function Nre(n){var e=n.reference,i=n.element,o=n.placement,l=o?Rp(o):null,u=o?PS(o):null,p=e.x+e.width/2-i.width/2,y=e.y+e.height/2-i.height/2,v;switch(l){case gl:v={x:p,y:e.y-i.height};break;case ad:v={x:p,y:e.y+e.height};break;case cd:v={x:e.x+e.width,y};break;case _l:v={x:e.x-i.width,y};break;default:v={x:e.x,y:e.y}}var w=l?T5(l):null;if(w!=null){var C=w==="y"?"height":"width";switch(u){case RS:v[w]=v[w]-(e[C]/2-i[C]/2);break;case aR:v[w]=v[w]+(e[C]/2-i[C]/2);break}}return v}function cR(n,e){e===void 0&&(e={});var i=e,o=i.placement,l=o===void 0?n.placement:o,u=i.strategy,p=u===void 0?n.strategy:u,y=i.boundary,v=y===void 0?_Le:y,w=i.rootBoundary,C=w===void 0?Tre:w,R=i.elementContext,N=R===void 0?$T:R,M=i.altBoundary,L=M===void 0?!1:M,U=i.padding,z=U===void 0?0:U,J=Pre(typeof z!="number"?z:kre(z,xR)),q=N===$T?yLe:$T,re=n.rects.popper,ce=n.elements[L?q:N],ae=JLe(eE(ce)?ce:ce.contextElement||Yg(n.elements.popper),v,C,p),pe=AS(n.elements.reference),H=Nre({reference:pe,element:re,placement:l}),X=oF(Object.assign({},re,H)),Q=N===$T?X:pe,ne={top:ae.top-Q.top+J.top,bottom:Q.bottom-ae.bottom+J.bottom,left:ae.left-Q.left+J.left,right:Q.right-ae.right+J.right},he=n.modifiersData.offset;if(N===$T&&he){var fe=he[l];Object.keys(ne).forEach(function(de){var ke=[cd,ad].indexOf(de)>=0?1:-1,De=[gl,ad].indexOf(de)>=0?"y":"x";ne[de]+=fe[De]*ke})}return ne}function QLe(n,e){e===void 0&&(e={});var i=e,o=i.placement,l=i.boundary,u=i.rootBoundary,p=i.padding,y=i.flipVariations,v=i.allowedAutoPlacements,w=v===void 0?Cre:v,C=PS(o),R=C?y?jX:jX.filter(function(L){return PS(L)===C}):xR,N=R.filter(function(L){return w.indexOf(L)>=0});N.length===0&&(N=R);var M=N.reduce(function(L,U){return L[U]=cR(n,{placement:U,boundary:l,rootBoundary:u,padding:p})[Rp(U)],L},{});return Object.keys(M).sort(function(L,U){return M[L]-M[U]})}function ZLe(n){if(Rp(n)===S5)return[];var e=Dk(n);return[WX(n),e,WX(e)]}function e2e(n){var e=n.state,i=n.options,o=n.name;if(!e.modifiersData[o]._skip){for(var l=i.mainAxis,u=l===void 0?!0:l,p=i.altAxis,y=p===void 0?!0:p,v=i.fallbackPlacements,w=i.padding,C=i.boundary,R=i.rootBoundary,N=i.altBoundary,M=i.flipVariations,L=M===void 0?!0:M,U=i.allowedAutoPlacements,z=e.options.placement,J=Rp(z),q=J===z,re=v||(q||!L?[Dk(z)]:ZLe(z)),ce=[z].concat(re).reduce(function(Ze,lt){return Ze.concat(Rp(lt)===S5?QLe(e,{placement:lt,boundary:C,rootBoundary:R,padding:w,flipVariations:L,allowedAutoPlacements:U}):lt)},[]),ae=e.rects.reference,pe=e.rects.popper,H=new Map,X=!0,Q=ce[0],ne=0;ne<ce.length;ne++){var he=ce[ne],fe=Rp(he),de=PS(he)===RS,ke=[gl,ad].indexOf(fe)>=0,De=ke?"width":"height",je=cR(e,{placement:he,boundary:C,rootBoundary:R,altBoundary:N,padding:w}),Te=ke?de?cd:_l:de?ad:gl;ae[De]>pe[De]&&(Te=Dk(Te));var we=Dk(Te),Ie=[];if(u&&Ie.push(je[fe]<=0),y&&Ie.push(je[Te]<=0,je[we]<=0),Ie.every(function(Ze){return Ze})){Q=he,X=!1;break}H.set(he,Ie)}if(X)for(var Oe=L?3:1,ve=function(lt){var vt=ce.find(function(nt){var mt=H.get(nt);if(mt)return mt.slice(0,lt).every(function(et){return et})});if(vt)return Q=vt,"break"},xe=Oe;xe>0;xe--){var Ge=ve(xe);if(Ge==="break")break}e.placement!==Q&&(e.modifiersData[o]._skip=!0,e.placement=Q,e.reset=!0)}}const t2e={name:"flip",enabled:!0,phase:"main",fn:e2e,requiresIfExists:["offset"],data:{_skip:!1}};function HX(n,e,i){return i===void 0&&(i={x:0,y:0}),{top:n.top-e.height-i.y,right:n.right-e.width+i.x,bottom:n.bottom-e.height+i.y,left:n.left-e.width-i.x}}function $X(n){return[gl,cd,ad,_l].some(function(e){return n[e]>=0})}function n2e(n){var e=n.state,i=n.name,o=e.rects.reference,l=e.rects.popper,u=e.modifiersData.preventOverflow,p=cR(e,{elementContext:"reference"}),y=cR(e,{altBoundary:!0}),v=HX(p,o),w=HX(y,l,u),C=$X(v),R=$X(w);e.modifiersData[i]={referenceClippingOffsets:v,popperEscapeOffsets:w,isReferenceHidden:C,hasPopperEscaped:R},e.attributes.popper=Object.assign({},e.attributes.popper,{"data-popper-reference-hidden":C,"data-popper-escaped":R})}const r2e={name:"hide",enabled:!0,phase:"main",requiresIfExists:["preventOverflow"],fn:n2e};function i2e(n,e,i){var o=Rp(n),l=[_l,gl].indexOf(o)>=0?-1:1,u=typeof i=="function"?i(Object.assign({},e,{placement:n})):i,p=u[0],y=u[1];return p=p||0,y=(y||0)*l,[_l,cd].indexOf(o)>=0?{x:y,y:p}:{x:p,y}}function s2e(n){var e=n.state,i=n.options,o=n.name,l=i.offset,u=l===void 0?[0,0]:l,p=Cre.reduce(function(C,R){return C[R]=i2e(R,e.rects,u),C},{}),y=p[e.placement],v=y.x,w=y.y;e.modifiersData.popperOffsets!=null&&(e.modifiersData.popperOffsets.x+=v,e.modifiersData.popperOffsets.y+=w),e.modifiersData[o]=p}const o2e={name:"offset",enabled:!0,phase:"main",requires:["popperOffsets"],fn:s2e};function a2e(n){var e=n.state,i=n.name;e.modifiersData[i]=Nre({reference:e.rects.reference,element:e.rects.popper,placement:e.placement})}const c2e={name:"popperOffsets",enabled:!0,phase:"read",fn:a2e,data:{}};function l2e(n){return n==="x"?"y":"x"}function u2e(n){var e=n.state,i=n.options,o=n.name,l=i.mainAxis,u=l===void 0?!0:l,p=i.altAxis,y=p===void 0?!1:p,v=i.boundary,w=i.rootBoundary,C=i.altBoundary,R=i.padding,N=i.tether,M=N===void 0?!0:N,L=i.tetherOffset,U=L===void 0?0:L,z=cR(e,{boundary:v,rootBoundary:w,padding:R,altBoundary:C}),J=Rp(e.placement),q=PS(e.placement),re=!q,ce=T5(J),ae=l2e(ce),pe=e.modifiersData.popperOffsets,H=e.rects.reference,X=e.rects.popper,Q=typeof U=="function"?U(Object.assign({},e.rects,{placement:e.placement})):U,ne=typeof Q=="number"?{mainAxis:Q,altAxis:Q}:Object.assign({mainAxis:0,altAxis:0},Q),he=e.modifiersData.offset?e.modifiersData.offset[e.placement]:null,fe={x:0,y:0};if(pe){if(u){var de,ke=ce==="y"?gl:_l,De=ce==="y"?ad:cd,je=ce==="y"?"height":"width",Te=pe[ce],we=Te+z[ke],Ie=Te-z[De],Oe=M?-X[je]/2:0,ve=q===RS?H[je]:X[je],xe=q===RS?-X[je]:-H[je],Ge=e.elements.arrow,Ze=M&&Ge?w5(Ge):{width:0,height:0},lt=e.modifiersData["arrow#persistent"]?e.modifiersData["arrow#persistent"].padding:Are(),vt=lt[ke],nt=lt[De],mt=MC(0,H[je],Ze[je]),et=re?H[je]/2-Oe-mt-vt-ne.mainAxis:ve-mt-vt-ne.mainAxis,St=re?-H[je]/2+Oe+mt+nt+ne.mainAxis:xe+mt+nt+ne.mainAxis,un=e.elements.arrow&&LR(e.elements.arrow),ft=un?ce==="y"?un.clientTop||0:un.clientLeft||0:0,Ct=(de=he==null?void 0:he[ce])!=null?de:0,ut=Te+et-Ct-ft,Ft=Te+St-Ct,on=MC(M?pO(we,ut):we,Te,M?Ky(Ie,Ft):Ie);pe[ce]=on,fe[ce]=on-Te}if(y){var Ht,Se=ce==="x"?gl:_l,Ne=ce==="x"?ad:cd,$e=pe[ae],Pt=ae==="y"?"height":"width",Ot=$e+z[Se],Et=$e-z[Ne],xt=[gl,_l].indexOf(J)!==-1,pn=(Ht=he==null?void 0:he[ae])!=null?Ht:0,Cn=xt?Ot:$e-H[Pt]-X[Pt]-pn+ne.altAxis,En=xt?$e+H[Pt]+X[Pt]-pn-ne.altAxis:Et,It=M&&xt?xLe(Cn,$e,En):MC(M?Cn:Ot,$e,M?En:Et);pe[ae]=It,fe[ae]=It-$e}e.modifiersData[o]=fe}}const d2e={name:"preventOverflow",enabled:!0,phase:"main",fn:u2e,requiresIfExists:["offset"]};function h2e(n){return{scrollLeft:n.scrollLeft,scrollTop:n.scrollTop}}function p2e(n){return n===au(n)||!td(n)?C5(n):h2e(n)}function f2e(n){var e=n.getBoundingClientRect(),i=IS(e.width)/n.offsetWidth||1,o=IS(e.height)/n.offsetHeight||1;return i!==1||o!==1}function m2e(n,e,i){i===void 0&&(i=!1);var o=td(e),l=td(e)&&f2e(e),u=Yg(e),p=AS(n,l,i),y={scrollLeft:0,scrollTop:0},v={x:0,y:0};return(o||!o&&!i)&&((Op(e)!=="body"||I5(u))&&(y=p2e(e)),td(e)?(v=AS(e,!0),v.x+=e.clientLeft,v.y+=e.clientTop):u&&(v.x=R5(u))),{x:p.left+y.scrollLeft-v.x,y:p.top+y.scrollTop-v.y,width:p.width,height:p.height}}function g2e(n){var e=new Map,i=new Set,o=[];n.forEach(function(u){e.set(u.name,u)});function l(u){i.add(u.name);var p=[].concat(u.requires||[],u.requiresIfExists||[]);p.forEach(function(y){if(!i.has(y)){var v=e.get(y);v&&l(v)}}),o.push(u)}return n.forEach(function(u){i.has(u.name)||l(u)}),o}function _2e(n){var e=g2e(n);return ALe.reduce(function(i,o){return i.concat(e.filter(function(l){return l.phase===o}))},[])}function y2e(n){var e;return function(){return e||(e=new Promise(function(i){Promise.resolve().then(function(){e=void 0,i(n())})})),e}}function E2e(n){var e=n.reduce(function(i,o){var l=i[o.name];return i[o.name]=l?Object.assign({},l,o,{options:Object.assign({},l.options,o.options),data:Object.assign({},l.data,o.data)}):o,i},{});return Object.keys(e).map(function(i){return e[i]})}var KX={placement:"bottom",modifiers:[],strategy:"absolute"};function qX(){for(var n=arguments.length,e=new Array(n),i=0;i<n;i++)e[i]=arguments[i];return!e.some(function(o){return!(o&&typeof o.getBoundingClientRect=="function")})}function v2e(n){n===void 0&&(n={});var e=n,i=e.defaultModifiers,o=i===void 0?[]:i,l=e.defaultOptions,u=l===void 0?KX:l;return function(y,v,w){w===void 0&&(w=u);var C={placement:"bottom",orderedModifiers:[],options:Object.assign({},KX,u),modifiersData:{},elements:{reference:y,popper:v},attributes:{},styles:{}},R=[],N=!1,M={state:C,setOptions:function(J){var q=typeof J=="function"?J(C.options):J;U(),C.options=Object.assign({},u,C.options,q),C.scrollParents={reference:eE(y)?UC(y):y.contextElement?UC(y.contextElement):[],popper:UC(v)};var re=_2e(E2e([].concat(o,C.options.modifiers)));return C.orderedModifiers=re.filter(function(ce){return ce.enabled}),L(),M.update()},forceUpdate:function(){if(!N){var J=C.elements,q=J.reference,re=J.popper;if(qX(q,re)){C.rects={reference:m2e(q,LR(re),C.options.strategy==="fixed"),popper:w5(re)},C.reset=!1,C.placement=C.options.placement,C.orderedModifiers.forEach(function(ne){return C.modifiersData[ne.name]=Object.assign({},ne.data)});for(var ce=0;ce<C.orderedModifiers.length;ce++){if(C.reset===!0){C.reset=!1,ce=-1;continue}var ae=C.orderedModifiers[ce],pe=ae.fn,H=ae.options,X=H===void 0?{}:H,Q=ae.name;typeof pe=="function"&&(C=pe({state:C,options:X,name:Q,instance:M})||C)}}}},update:y2e(function(){return new Promise(function(z){M.forceUpdate(),z(C)})}),destroy:function(){U(),N=!0}};if(!qX(y,v))return M;M.setOptions(w).then(function(z){!N&&w.onFirstUpdate&&w.onFirstUpdate(z)});function L(){C.orderedModifiers.forEach(function(z){var J=z.name,q=z.options,re=q===void 0?{}:q,ce=z.effect;if(typeof ce=="function"){var ae=ce({state:C,name:J,instance:M,options:re}),pe=function(){};R.push(ae||pe)}})}function U(){R.forEach(function(z){return z()}),R=[]}return M}}var S2e=[GLe,c2e,zLe,OLe,o2e,t2e,d2e,VLe,r2e],b2e=v2e({defaultModifiers:S2e});const R0=(n,e)=>({var:n,varRef:e?`var(${n}, ${e})`:`var(${n})`}),Eo={arrowShadowColor:R0("--popper-arrow-shadow-color"),arrowSize:R0("--popper-arrow-size","8px"),arrowSizeHalf:R0("--popper-arrow-size-half"),arrowBg:R0("--popper-arrow-bg"),transformOrigin:R0("--popper-transform-origin"),arrowOffset:R0("--popper-arrow-offset")};function w2e(n){if(n.includes("top"))return"1px 1px 0px 0 var(--popper-arrow-shadow-color)";if(n.includes("bottom"))return"-1px -1px 0px 0 var(--popper-arrow-shadow-color)";if(n.includes("right"))return"-1px 1px 0px 0 var(--popper-arrow-shadow-color)";if(n.includes("left"))return"1px -1px 0px 0 var(--popper-arrow-shadow-color)"}const T2e={top:"bottom center","top-start":"bottom left","top-end":"bottom right",bottom:"top center","bottom-start":"top left","bottom-end":"top right",left:"right center","left-start":"right top","left-end":"right bottom",right:"left center","right-start":"left top","right-end":"left bottom"},C2e=n=>T2e[n],YX={scroll:!0,resize:!0};function R2e(n){let e;return typeof n=="object"?e={enabled:!0,options:{...YX,...n}}:e={enabled:n,options:YX},e}const I2e={name:"matchWidth",enabled:!0,phase:"beforeWrite",requires:["computeStyles"],fn:({state:n})=>{n.styles.popper.width=`${n.rects.reference.width}px`},effect:({state:n})=>()=>{const e=n.elements.reference;n.elements.popper.style.width=`${e.offsetWidth}px`}},A2e={name:"transformOrigin",enabled:!0,phase:"write",fn:({state:n})=>{XX(n)},effect:({state:n})=>()=>{XX(n)}},XX=n=>{n.elements.popper.style.setProperty(Eo.transformOrigin.var,C2e(n.placement))},P2e={name:"positionArrow",enabled:!0,phase:"afterWrite",fn:({state:n})=>{k2e(n)}},k2e=n=>{var i;if(!n.placement)return;const e=O2e(n.placement);if((i=n.elements)!=null&&i.arrow&&e){Object.assign(n.elements.arrow.style,{[e.property]:e.value,width:Eo.arrowSize.varRef,height:Eo.arrowSize.varRef,zIndex:-1});const o={[Eo.arrowSizeHalf.var]:`calc(${Eo.arrowSize.varRef} / 2 - 1px)`,[Eo.arrowOffset.var]:`calc(${Eo.arrowSizeHalf.varRef} * -1)`};for(const l in o)n.elements.arrow.style.setProperty(l,o[l])}},O2e=n=>{if(n.startsWith("top"))return{property:"bottom",value:Eo.arrowOffset.varRef};if(n.startsWith("bottom"))return{property:"top",value:Eo.arrowOffset.varRef};if(n.startsWith("left"))return{property:"right",value:Eo.arrowOffset.varRef};if(n.startsWith("right"))return{property:"left",value:Eo.arrowOffset.varRef}},N2e={name:"innerArrow",enabled:!0,phase:"main",requires:["arrow"],fn:({state:n})=>{JX(n)},effect:({state:n})=>()=>{JX(n)}},JX=n=>{if(!n.elements.arrow)return;const e=n.elements.arrow.querySelector("[data-popper-arrow-inner]");if(!e)return;const i=w2e(n.placement);i&&e.style.setProperty("--popper-arrow-default-shadow",i),Object.assign(e.style,{transform:"rotate(45deg)",background:Eo.arrowBg.varRef,top:0,left:0,width:"100%",height:"100%",position:"absolute",zIndex:"inherit",boxShadow:"var(--popper-arrow-shadow, var(--popper-arrow-default-shadow))"})},D2e={"start-start":{ltr:"left-start",rtl:"right-start"},"start-end":{ltr:"left-end",rtl:"right-end"},"end-start":{ltr:"right-start",rtl:"left-start"},"end-end":{ltr:"right-end",rtl:"left-end"},start:{ltr:"left",rtl:"right"},end:{ltr:"right",rtl:"left"}},x2e={"auto-start":"auto-end","auto-end":"auto-start","top-start":"top-end","top-end":"top-start","bottom-start":"bottom-end","bottom-end":"bottom-start"};function L2e(n,e="ltr"){var o;const i=((o=D2e[n])==null?void 0:o[e])||n;return e==="ltr"?i:x2e[n]??i}function A5(n={}){const{enabled:e=!0,modifiers:i,placement:o="bottom",strategy:l="absolute",arrowPadding:u=8,eventListeners:p=!0,offset:y,gutter:v=8,flip:w=!0,boundary:C="clippingParents",preventOverflow:R=!0,matchWidth:N,direction:M="ltr"}=n,L=O.useRef(null),U=O.useRef(null),z=O.useRef(null),J=L2e(o,M),q=O.useRef(()=>{}),re=O.useCallback(()=>{var ne;!e||!L.current||!U.current||((ne=q.current)==null||ne.call(q),z.current=b2e(L.current,U.current,{placement:J,modifiers:[N2e,P2e,A2e,{...I2e,enabled:!!N},{name:"eventListeners",...R2e(p)},{name:"arrow",options:{padding:u}},{name:"offset",options:{offset:y??[0,v]}},{name:"flip",enabled:!!w,options:{padding:8}},{name:"preventOverflow",enabled:!!R,options:{boundary:C}},...i??[]],strategy:l}),z.current.forceUpdate(),q.current=z.current.destroy)},[J,e,i,N,p,u,y,v,w,R,C,l]);O.useEffect(()=>()=>{var ne;!L.current&&!U.current&&((ne=z.current)==null||ne.destroy(),z.current=null)},[]);const ce=O.useCallback(ne=>{L.current=ne,re()},[re]),ae=O.useCallback((ne={},he=null)=>({...ne,ref:$i(ce,he)}),[ce]),pe=O.useCallback(ne=>{U.current=ne,re()},[re]),H=O.useCallback((ne={},he=null)=>({...ne,ref:$i(pe,he),style:{...ne.style,position:l,minWidth:N?void 0:"max-content",inset:"0 auto auto 0"}}),[l,pe,N]),X=O.useCallback((ne={},he=null)=>{const{size:fe,shadowColor:de,bg:ke,style:De,...je}=ne;return{...je,ref:he,"data-popper-arrow":"",style:M2e(ne)}},[]),Q=O.useCallback((ne={},he=null)=>({...ne,ref:he,"data-popper-arrow-inner":""}),[]);return{update(){var ne;(ne=z.current)==null||ne.update()},forceUpdate(){var ne;(ne=z.current)==null||ne.forceUpdate()},transformOrigin:Eo.transformOrigin.varRef,referenceRef:ce,popperRef:pe,getPopperProps:H,getArrowProps:X,getArrowInnerProps:Q,getReferenceProps:ae}}function M2e(n){const{size:e,shadowColor:i,bg:o,style:l}=n,u={...l,position:"absolute"};return e&&(u["--popper-arrow-size"]=e),i&&(u["--popper-arrow-shadow-color"]=i),o&&(u["--popper-arrow-bg"]=o),u}function U2e(){const n=O.useRef(new Map),e=n.current,i=O.useCallback((l,u,p,y)=>{n.current.set(p,{type:u,el:l,options:y}),l.addEventListener(u,p,y)},[]),o=O.useCallback((l,u,p,y)=>{l.removeEventListener(u,p,y),n.current.delete(p)},[]);return O.useEffect(()=>()=>{e.forEach((l,u)=>{o(l.el,l.type,u,l.options)})},[o,e]),{add:i,remove:o}}function BU(n){var l,u;const e=((u=(l=n.composedPath)==null?void 0:l.call(n))==null?void 0:u[0])??n.target,{tagName:i,isContentEditable:o}=e;return i!=="INPUT"&&i!=="TEXTAREA"&&o!==!0}function Dre(n={}){const{ref:e,isDisabled:i,isFocusable:o,clickOnEnter:l=!0,clickOnSpace:u=!0,onMouseDown:p,onMouseUp:y,onClick:v,onKeyDown:w,onKeyUp:C,tabIndex:R,onMouseOver:N,onMouseLeave:M,...L}=n,[U,z]=O.useState(!0),[J,q]=O.useState(!1),re=U2e(),ce=Te=>{Te&&Te.tagName!=="BUTTON"&&z(!1)},ae=U?R:R||0,pe=i&&!o,H=O.useCallback(Te=>{if(i){Te.stopPropagation(),Te.preventDefault();return}Te.currentTarget.focus(),v==null||v(Te)},[i,v]),X=O.useCallback(Te=>{J&&BU(Te)&&(Te.preventDefault(),Te.stopPropagation(),q(!1),re.remove(document,"keyup",X,!1))},[J,re]),Q=O.useCallback(Te=>{if(w==null||w(Te),i||Te.defaultPrevented||Te.metaKey||!BU(Te.nativeEvent)||U)return;const we=l&&Te.key==="Enter";u&&Te.key===" "&&(Te.preventDefault(),q(!0)),we&&(Te.preventDefault(),Te.currentTarget.click()),re.add(document,"keyup",X,!1)},[i,U,w,l,u,re,X]),ne=O.useCallback(Te=>{if(C==null||C(Te),i||Te.defaultPrevented||Te.metaKey||!BU(Te.nativeEvent)||U)return;u&&Te.key===" "&&(Te.preventDefault(),q(!1),Te.currentTarget.click())},[u,U,i,C]),he=O.useCallback(Te=>{Te.button===0&&(q(!1),re.remove(document,"mouseup",he,!1))},[re]),fe=O.useCallback(Te=>{if(Te.button!==0)return;if(i){Te.stopPropagation(),Te.preventDefault();return}U||q(!0),Te.currentTarget.focus({preventScroll:!0}),re.add(document,"mouseup",he,!1),p==null||p(Te)},[i,U,p,re,he]),de=O.useCallback(Te=>{Te.button===0&&(U||q(!1),y==null||y(Te))},[y,U]),ke=O.useCallback(Te=>{if(i){Te.preventDefault();return}N==null||N(Te)},[i,N]),De=O.useCallback(Te=>{J&&(Te.preventDefault(),q(!1)),M==null||M(Te)},[J,M]),je=$i(e,ce);return U?{...L,ref:je,type:"button","aria-disabled":pe?void 0:i,disabled:pe,onClick:H,onMouseDown:p,onMouseUp:y,onKeyUp:C,onKeyDown:w,onMouseOver:N,onMouseLeave:M}:{...L,ref:je,role:"button","data-active":ur(J),"aria-disabled":i?"true":void 0,tabIndex:pe?void 0:ae,onClick:H,onMouseDown:fe,onMouseUp:de,onKeyUp:ne,onKeyDown:Q,onMouseOver:ke,onMouseLeave:De}}const[V2e,F2e,j2e,B2e]=Nne(),[z2e,MR]=ki({strict:!1,name:"MenuContext"});function xre(n){return(n==null?void 0:n.ownerDocument)??document}function W2e(n){return xre(n).activeElement===n}function G2e(n={}){const{id:e,closeOnSelect:i=!0,closeOnBlur:o=!0,initialFocusRef:l,autoSelect:u=!0,isLazy:p,isOpen:y,defaultIsOpen:v,onClose:w,onOpen:C,placement:R="bottom-start",lazyBehavior:N="unmount",direction:M,computePositionOnMount:L=!1,...U}=n,z=O.useRef(null),J=O.useRef(null),q=O.useRef(!0),re=j2e(),ce=O.useCallback(()=>{requestAnimationFrame(()=>{var Ge;(Ge=z.current)==null||Ge.focus({preventScroll:!1})})},[]),ae=O.useCallback(()=>{const Ge=setTimeout(()=>{var Ze,lt;if(l)(Ze=l.current)==null||Ze.focus();else if(!re.count())(lt=z.current)==null||lt.focus({preventScroll:!1});else{const vt=re.firstEnabled();vt&&ke(vt.index)}});Ie.current.add(Ge)},[re,l]),pe=O.useCallback(()=>{const Ge=setTimeout(()=>{var Ze;if(!re.count())(Ze=z.current)==null||Ze.focus({preventScroll:!1});else{const lt=re.lastEnabled();lt&&ke(lt.index)}});Ie.current.add(Ge)},[re]),H=O.useCallback(()=>{C==null||C(),u?ae():ce()},[u,ae,ce,C]),{isOpen:X,onOpen:Q,onClose:ne,onToggle:he}=od({isOpen:y,defaultIsOpen:v,onClose:w,onOpen:H});uee({enabled:X&&o,ref:z,handler:Ge=>{var lt,vt,nt;const Ze=((vt=(lt=Ge.composedPath)==null?void 0:lt.call(Ge))==null?void 0:vt[0])??Ge.target;(nt=J.current)!=null&&nt.contains(Ze)||ne()}});const fe=A5({...U,enabled:X||L,placement:R,direction:M}),[de,ke]=O.useState(-1);aee(z,{focusRef:J,visible:X,shouldFocus:!0});const De=iee({isOpen:X,ref:z}),[je,Te]=$ve(e,"menu-button","menu-list"),we=O.useCallback(()=>{Q(),ce()},[Q,ce]),Ie=O.useRef(new Set([]));O.useEffect(()=>{const Ge=Ie.current;return()=>{Ge.forEach(Ze=>clearTimeout(Ze)),Ge.clear()}},[]),jf(()=>{var Ge;X||(ke(-1),(Ge=z.current)==null||Ge.scrollTo(0,0))},[X]),jf(()=>{X&&de===-1&&ce()},[de,X]),O.useEffect(()=>{var Ze;if(!X)return;const Ge=re.item(de);(Ze=Ge==null?void 0:Ge.node)==null||Ze.focus({preventScroll:!q.current})},[re,de,X]);const Oe=O.useCallback(()=>{Q(),ae()},[ae,Q]),ve=O.useCallback(()=>{q.current=!0,Q(),pe()},[Q,pe]),xe=O.useCallback(()=>{var nt,mt;const Ge=xre(z.current),Ze=(nt=z.current)==null?void 0:nt.contains(Ge.activeElement);if(!(X&&!Ze))return;const vt=(mt=re.item(de))==null?void 0:mt.node;vt==null||vt.focus({preventScroll:!q.current})},[X,de,re]);return{openAndFocusMenu:we,openAndFocusFirstItem:Oe,openAndFocusLastItem:ve,onTransitionEnd:xe,unstable__animationState:De,descendants:re,popper:fe,buttonId:je,menuId:Te,forceUpdate:fe.forceUpdate,orientation:"vertical",isOpen:X,onToggle:he,onOpen:Q,onClose:ne,menuRef:z,buttonRef:J,focusedIndex:de,closeOnSelect:i,closeOnBlur:o,autoSelect:u,setFocusedIndex:ke,isLazy:p,lazyBehavior:N,initialFocusRef:l,scrollIntoViewRef:q}}function H2e(n={},e=null){const i=MR(),{onToggle:o,popper:l,openAndFocusFirstItem:u,openAndFocusLastItem:p,scrollIntoViewRef:y}=i,v=O.useCallback(w=>{const C=w.key,N={Enter:u,ArrowDown:u,ArrowUp:p}[C];N&&(y.current=!0,w.preventDefault(),w.stopPropagation(),N(w))},[u,p,y]);return{...n,ref:$i(i.buttonRef,e,l.referenceRef),id:i.buttonId,"data-active":ur(i.isOpen),"aria-expanded":i.isOpen,"aria-haspopup":"menu","aria-controls":i.menuId,onClick:Un(n.onClick,o),onKeyDown:Un(n.onKeyDown,v)}}function aF(n){var e;return Y2e(n)&&!!((e=n==null?void 0:n.getAttribute("role"))!=null&&e.startsWith("menuitem"))}function $2e(n={},e=null){const i=MR();if(!i)throw new Error("useMenuContext: context is undefined. Seems you forgot to wrap component within <Menu>");const{focusedIndex:o,setFocusedIndex:l,menuRef:u,isOpen:p,onClose:y,menuId:v,isLazy:w,lazyBehavior:C,scrollIntoViewRef:R,unstable__animationState:N}=i,M=F2e(),L=gLe({preventDefault:q=>q.key!==" "&&aF(q.target)}),U=O.useCallback(q=>{if(!q.currentTarget.contains(q.target))return;const re=q.key,ae={Tab:H=>H.preventDefault(),Escape:H=>{H.stopPropagation(),y()},ArrowDown:()=>{R.current=!0;const H=M.nextEnabled(o)??M.firstEnabled();H&&l(H.index)},ArrowUp:()=>{R.current=!0;const H=M.prevEnabled(o)??M.firstEnabled();H&&l(H.index)}}[re];if(ae){q.preventDefault(),ae(q);return}const pe=L(H=>{const X=fLe(M.values(),H,Q=>{var ne;return((ne=Q==null?void 0:Q.node)==null?void 0:ne.textContent)??""},M.item(o));if(X){const Q=M.indexOf(X.node);l(Q)}});aF(q.target)&&pe(q)},[M,o,L,y,l,R]),z=O.useRef(!1);p&&(z.current=!0);const J=QF({wasSelected:z.current,enabled:w,mode:C,isSelected:N.present});return{...n,ref:$i(u,e),children:J?n.children:null,tabIndex:-1,role:"menu",id:v,style:{...n.style,transformOrigin:"var(--popper-transform-origin)"},"aria-orientation":"vertical",onKeyDown:Un(n.onKeyDown,U)}}function K2e(n={}){const{popper:e,isOpen:i}=MR();return e.getPopperProps({...n,style:{visibility:i?"visible":"hidden",...n.style}})}function q2e(n={},e=null){const{onMouseEnter:i,onMouseMove:o,onMouseLeave:l,onClick:u,onFocus:p,isDisabled:y,isFocusable:v,closeOnSelect:w,type:C,...R}=n,N=MR(),{setFocusedIndex:M,focusedIndex:L,closeOnSelect:U,onClose:z,menuId:J,scrollIntoViewRef:q}=N,re=O.useRef(null),ce=`${J}-menuitem-${O.useId()}`,{index:ae,register:pe}=B2e({disabled:y&&!v}),H=O.useCallback(ke=>{i==null||i(ke),!y&&(q.current=!1,M(ae))},[M,ae,y,i,q]),X=O.useCallback(ke=>{o==null||o(ke),re.current&&!W2e(re.current)&&H(ke)},[H,o]),Q=O.useCallback(ke=>{l==null||l(ke),!y&&M(-1)},[M,y,l]),ne=O.useCallback(ke=>{u==null||u(ke),aF(ke.currentTarget)&&(w??U)&&z()},[z,u,U,w]),he=O.useCallback(ke=>{p==null||p(ke),M(ae)},[M,p,ae]),fe=ae===L,de=Dre({onClick:ne,onFocus:he,onMouseEnter:H,onMouseMove:X,onMouseLeave:Q,ref:$i(pe,re,e),isDisabled:y,isFocusable:v});return{...R,...de,type:C??de.type,id:ce,role:"menuitem",tabIndex:fe?0:-1}}function Y2e(n){if(!X2e(n))return!1;const e=n.ownerDocument.defaultView??window;return n instanceof e.HTMLElement}function X2e(n){return n!=null&&typeof n=="object"&&"nodeType"in n&&n.nodeType===Node.ELEMENT_NODE}const[J2e,UR]=ki({name:"MenuStylesContext",errorMessage:`useMenuStyles returned is 'undefined'. Seems you forgot to wrap the components in "<Menu />" `}),VR=n=>{const{children:e}=n,i=Na("Menu",n),o=Fi(n),{direction:l}=YS(),{descendants:u,...p}=G2e({...o,direction:l}),y=O.useMemo(()=>p,[p]),{isOpen:v,onClose:w,forceUpdate:C}=y;return S.jsx(V2e,{value:u,children:S.jsx(z2e,{value:y,children:S.jsx(J2e,{value:i,children:pl(e,{isOpen:v,onClose:w,forceUpdate:C})})})})};VR.displayName="Menu";const Q2e=Bt((n,e)=>{const i=UR();return S.jsx(Ut.button,{ref:e,...n,__css:{display:"inline-flex",appearance:"none",alignItems:"center",outline:0,...i.button}})}),FR=Bt((n,e)=>{const{children:i,as:o,...l}=n,u=H2e(l,e),p=o||Q2e;return S.jsx(p,{...u,className:yn("chakra-menu__menu-button",n.className),children:S.jsx(Ut.span,{__css:{pointerEvents:"none",flex:"1 1 auto",minW:0},children:n.children})})});FR.displayName="MenuButton";const Lre=Bt((n,e)=>{const i=UR();return S.jsx(Ut.span,{ref:e,...n,__css:i.command,className:"chakra-menu__command"})});Lre.displayName="MenuCommand";const Mre=n=>{const{className:e,children:i,...o}=n,l=UR(),u=O.Children.only(i),p=O.isValidElement(u)?O.cloneElement(u,{focusable:"false","aria-hidden":!0,className:yn("chakra-menu__icon",u.props.className)}):null,y=yn("chakra-menu__icon-wrapper",e);return S.jsx(Ut.span,{className:y,...o,__css:l.icon,children:p})};Mre.displayName="MenuIcon";const Z2e=Bt((n,e)=>{const{type:i,...o}=n,l=UR(),u=o.as||i?i??void 0:"button",p=O.useMemo(()=>({textDecoration:"none",color:"inherit",userSelect:"none",display:"flex",width:"100%",alignItems:"center",textAlign:"start",flex:"0 0 auto",outline:0,...l.item}),[l.item]);return S.jsx(Ut.button,{ref:e,type:u,...o,__css:p})}),mp=Bt((n,e)=>{const{icon:i,iconSpacing:o="0.75rem",command:l,commandSpacing:u="0.75rem",children:p,...y}=n,v=q2e(y,e),C=i||l?S.jsx("span",{style:{pointerEvents:"none",flex:1},children:p}):p;return S.jsxs(Z2e,{...v,className:yn("chakra-menu__menuitem",v.className),children:[i&&S.jsx(Mre,{fontSize:"0.8em",marginEnd:o,children:i}),C,l&&S.jsx(Lre,{marginStart:u,children:l})]})});mp.displayName="MenuItem";const eMe={enter:{visibility:"visible",opacity:1,scale:1,transition:{duration:.2,ease:[.4,0,.2,1]}},exit:{transitionEnd:{visibility:"hidden"},opacity:0,scale:.8,transition:{duration:.1,easings:"easeOut"}}},tMe=Ut(Dp.div),jR=Bt(function(e,i){var N;const{rootProps:o,motionProps:l,...u}=e,{isOpen:p,onTransitionEnd:y,unstable__animationState:v}=MR(),w=$2e(u,i),C=K2e(o),R=UR();return S.jsx(Ut.div,{...C,__css:{zIndex:e.zIndex??((N=R.list)==null?void 0:N.zIndex)},children:S.jsx(tMe,{variants:eMe,initial:!1,animate:p?"enter":"exit",__css:{outline:0,...R.list},...l,...w,className:yn("chakra-menu__menu-list",w.className),onUpdate:y,onAnimationComplete:QZ(v.onComplete,w.onAnimationComplete)})})});jR.displayName="MenuList";var nMe=function(n){if(typeof document>"u")return null;var e=Array.isArray(n)?n[0]:n;return e.ownerDocument.body},I0=new WeakMap,J1=new WeakMap,Q1={},zU=0,Ure=function(n){return n&&(n.host||Ure(n.parentNode))},rMe=function(n,e){return e.map(function(i){if(n.contains(i))return i;var o=Ure(i);return o&&n.contains(o)?o:(console.error("aria-hidden",i,"in not contained inside",n,". Doing nothing"),null)}).filter(function(i){return!!i})},iMe=function(n,e,i,o){var l=rMe(e,Array.isArray(n)?n:[n]);Q1[i]||(Q1[i]=new WeakMap);var u=Q1[i],p=[],y=new Set,v=new Set(l),w=function(R){!R||y.has(R)||(y.add(R),w(R.parentNode))};l.forEach(w);var C=function(R){!R||v.has(R)||Array.prototype.forEach.call(R.children,function(N){if(y.has(N))C(N);else try{var M=N.getAttribute(o),L=M!==null&&M!=="false",U=(I0.get(N)||0)+1,z=(u.get(N)||0)+1;I0.set(N,U),u.set(N,z),p.push(N),U===1&&L&&J1.set(N,!0),z===1&&N.setAttribute(i,"true"),L||N.setAttribute(o,"true")}catch(J){console.error("aria-hidden: cannot operate on ",N,J)}})};return C(e),y.clear(),zU++,function(){p.forEach(function(R){var N=I0.get(R)-1,M=u.get(R)-1;I0.set(R,N),u.set(R,M),N||(J1.has(R)||R.removeAttribute(o),J1.delete(R)),M||R.removeAttribute(i)}),zU--,zU||(I0=new WeakMap,I0=new WeakMap,J1=new WeakMap,Q1={})}},sMe=function(n,e,i){i===void 0&&(i="data-aria-hidden");var o=Array.from(Array.isArray(n)?n:[n]),l=nMe(n);return l?(o.push.apply(o,Array.from(l.querySelectorAll("[aria-live]"))),iMe(o,l,i,"aria-hidden")):function(){return null}},oMe=Object.defineProperty,aMe=(n,e,i)=>e in n?oMe(n,e,{enumerable:!0,configurable:!0,writable:!0,value:i}):n[e]=i,cMe=(n,e,i)=>(aMe(n,e+"",i),i);class lMe{constructor(){cMe(this,"modals"),this.modals=new Set}add(e){return this.modals.add(e),this.modals.size}remove(e){this.modals.delete(e)}isTopModal(e){if(!e)return!1;const i=Array.from(this.modals)[this.modals.size-1];return e===i}}const cF=new lMe;function Vre(n,e){const[i,o]=O.useState(0);return O.useEffect(()=>{const l=n.current;if(l){if(e){const u=cF.add(l);o(u)}return()=>{cF.remove(l),o(0)}}},[e,n]),i}function uMe(n){const{isOpen:e,onClose:i,id:o,closeOnOverlayClick:l=!0,closeOnEsc:u=!0,useInert:p=!0,onOverlayClick:y,onEsc:v}=n,w=O.useRef(null),C=O.useRef(null),[R,N,M]=hMe(o,"chakra-modal","chakra-modal--header","chakra-modal--body");dMe(w,e&&p);const L=Vre(w,e),U=O.useRef(null),z=O.useCallback(Q=>{U.current=Q.target},[]),J=O.useCallback(Q=>{Q.key==="Escape"&&(Q.stopPropagation(),u&&(i==null||i()),v==null||v())},[u,i,v]),[q,re]=O.useState(!1),[ce,ae]=O.useState(!1),pe=O.useCallback((Q={},ne=null)=>({role:"dialog",...Q,ref:$i(ne,w),id:R,tabIndex:-1,"aria-modal":!0,"aria-labelledby":q?N:void 0,"aria-describedby":ce?M:void 0,onClick:Un(Q.onClick,he=>he.stopPropagation())}),[M,ce,R,N,q]),H=O.useCallback(Q=>{Q.stopPropagation(),U.current===Q.target&&cF.isTopModal(w.current)&&(l&&(i==null||i()),y==null||y())},[i,l,y]),X=O.useCallback((Q={},ne=null)=>({...Q,ref:$i(ne,C),onClick:Un(Q.onClick,H),onKeyDown:Un(Q.onKeyDown,J),onMouseDown:Un(Q.onMouseDown,z)}),[J,z,H]);return{isOpen:e,onClose:i,headerId:N,bodyId:M,setBodyMounted:ae,setHeaderMounted:re,dialogRef:w,overlayRef:C,getDialogProps:pe,getDialogContainerProps:X,index:L}}function dMe(n,e){const i=n.current;O.useEffect(()=>{if(!(!n.current||!e))return sMe(n.current)},[e,n,i])}function hMe(n,...e){const i=O.useId(),o=n||i;return O.useMemo(()=>e.map(l=>`${l}-${o}`),[o,e])}const[pMe,JS]=ki({name:"ModalStylesContext",errorMessage:`useModalStyles returned is 'undefined'. Seems you forgot to wrap the components in "<Modal />" `}),[fMe,tE]=ki({strict:!0,name:"ModalContext",errorMessage:"useModalContext: `context` is undefined. Seems you forgot to wrap modal components in `<Modal />`"}),ls=n=>{const e={scrollBehavior:"outside",autoFocus:!0,trapFocus:!0,returnFocusOnClose:!0,blockScrollOnMount:!0,allowPinchZoom:!1,preserveScrollBarGap:!0,motionPreset:"scale",...n,lockFocusAcrossFrames:n.lockFocusAcrossFrames||!0},{portalProps:i,children:o,autoFocus:l,trapFocus:u,initialFocusRef:p,finalFocusRef:y,returnFocusOnClose:v,blockScrollOnMount:w,allowPinchZoom:C,preserveScrollBarGap:R,motionPreset:N,lockFocusAcrossFrames:M,animatePresenceProps:L,onCloseComplete:U}=e,z=Na("Modal",e),q={...uMe(e),autoFocus:l,trapFocus:u,initialFocusRef:p,finalFocusRef:y,returnFocusOnClose:v,blockScrollOnMount:w,allowPinchZoom:C,preserveScrollBarGap:R,motionPreset:N,lockFocusAcrossFrames:M};return S.jsx(fMe,{value:q,children:S.jsx(pMe,{value:z,children:S.jsx($S,{...L,onExitComplete:U,children:q.isOpen&&S.jsx(Nc,{...i,children:o})})})})};ls.displayName="Modal";var xk="right-scroll-bar-position",Lk="width-before-scroll-bar",mMe="with-scroll-bars-hidden",gMe="--removed-body-scroll-bar-size",Fre=Gne(),WU=function(){},mN=O.forwardRef(function(n,e){var i=O.useRef(null),o=O.useState({onScrollCapture:WU,onWheelCapture:WU,onTouchMoveCapture:WU}),l=o[0],u=o[1],p=n.forwardProps,y=n.children,v=n.className,w=n.removeScrollBar,C=n.enabled,R=n.shards,N=n.sideCar,M=n.noIsolation,L=n.inert,U=n.allowPinchZoom,z=n.as,J=z===void 0?"div":z,q=n.gapMode,re=DR(n,["forwardProps","children","className","removeScrollBar","enabled","shards","sideCar","noIsolation","inert","allowPinchZoom","as","gapMode"]),ce=N,ae=Bne([i,e]),pe=fp(fp({},re),l);return O.createElement(O.Fragment,null,C&&O.createElement(ce,{sideCar:Fre,removeScrollBar:w,shards:R,noIsolation:M,inert:L,setCallbacks:u,allowPinchZoom:!!U,lockRef:i,gapMode:q}),p?O.cloneElement(O.Children.only(y),fp(fp({},pe),{ref:ae})):O.createElement(J,fp({},pe,{className:v,ref:ae}),y))});mN.defaultProps={enabled:!0,removeScrollBar:!0,inert:!1};mN.classNames={fullWidth:Lk,zeroRight:xk};var _Me=function(){if(typeof __webpack_nonce__<"u")return __webpack_nonce__};function yMe(){if(!document)return null;var n=document.createElement("style");n.type="text/css";var e=_Me();return e&&n.setAttribute("nonce",e),n}function EMe(n,e){n.styleSheet?n.styleSheet.cssText=e:n.appendChild(document.createTextNode(e))}function vMe(n){var e=document.head||document.getElementsByTagName("head")[0];e.appendChild(n)}var SMe=function(){var n=0,e=null;return{add:function(i){n==0&&(e=yMe())&&(EMe(e,i),vMe(e)),n++},remove:function(){n--,!n&&e&&(e.parentNode&&e.parentNode.removeChild(e),e=null)}}},bMe=function(){var n=SMe();return function(e,i){O.useEffect(function(){return n.add(e),function(){n.remove()}},[e&&i])}},jre=function(){var n=bMe(),e=function(i){var o=i.styles,l=i.dynamic;return n(o,l),null};return e},wMe={left:0,top:0,right:0,gap:0},GU=function(n){return parseInt(n||"",10)||0},TMe=function(n){var e=window.getComputedStyle(document.body),i=e[n==="padding"?"paddingLeft":"marginLeft"],o=e[n==="padding"?"paddingTop":"marginTop"],l=e[n==="padding"?"paddingRight":"marginRight"];return[GU(i),GU(o),GU(l)]},CMe=function(n){if(n===void 0&&(n="margin"),typeof window>"u")return wMe;var e=TMe(n),i=document.documentElement.clientWidth,o=window.innerWidth;return{left:e[0],top:e[1],right:e[2],gap:Math.max(0,o-i+e[2]-e[0])}},RMe=jre(),oS="data-scroll-locked",IMe=function(n,e,i,o){var l=n.left,u=n.top,p=n.right,y=n.gap;return i===void 0&&(i="margin"),`
  .`.concat(mMe,` {
   overflow: hidden `).concat(o,`;
   padding-right: `).concat(y,"px ").concat(o,`;
  }
  body[`).concat(oS,`] {
    overflow: hidden `).concat(o,`;
    overscroll-behavior: contain;
    `).concat([e&&"position: relative ".concat(o,";"),i==="margin"&&`
    padding-left: `.concat(l,`px;
    padding-top: `).concat(u,`px;
    padding-right: `).concat(p,`px;
    margin-left:0;
    margin-top:0;
    margin-right: `).concat(y,"px ").concat(o,`;
    `),i==="padding"&&"padding-right: ".concat(y,"px ").concat(o,";")].filter(Boolean).join(""),`
  }
  
  .`).concat(xk,` {
    right: `).concat(y,"px ").concat(o,`;
  }
  
  .`).concat(Lk,` {
    margin-right: `).concat(y,"px ").concat(o,`;
  }
  
  .`).concat(xk," .").concat(xk,` {
    right: 0 `).concat(o,`;
  }
  
  .`).concat(Lk," .").concat(Lk,` {
    margin-right: 0 `).concat(o,`;
  }
  
  body[`).concat(oS,`] {
    `).concat(gMe,": ").concat(y,`px;
  }
`)},QX=function(){var n=parseInt(document.body.getAttribute(oS)||"0",10);return isFinite(n)?n:0},AMe=function(){O.useEffect(function(){return document.body.setAttribute(oS,(QX()+1).toString()),function(){var n=QX()-1;n<=0?document.body.removeAttribute(oS):document.body.setAttribute(oS,n.toString())}},[])},PMe=function(n){var e=n.noRelative,i=n.noImportant,o=n.gapMode,l=o===void 0?"margin":o;AMe();var u=O.useMemo(function(){return CMe(l)},[l]);return O.createElement(RMe,{styles:IMe(u,!e,l,i?"":"!important")})},lF=!1;if(typeof window<"u")try{var Z1=Object.defineProperty({},"passive",{get:function(){return lF=!0,!0}});window.addEventListener("test",Z1,Z1),window.removeEventListener("test",Z1,Z1)}catch{lF=!1}var A0=lF?{passive:!1}:!1,kMe=function(n){return n.tagName==="TEXTAREA"},Bre=function(n,e){if(!(n instanceof Element))return!1;var i=window.getComputedStyle(n);return i[e]!=="hidden"&&!(i.overflowY===i.overflowX&&!kMe(n)&&i[e]==="visible")},OMe=function(n){return Bre(n,"overflowY")},NMe=function(n){return Bre(n,"overflowX")},ZX=function(n,e){var i=e.ownerDocument,o=e;do{typeof ShadowRoot<"u"&&o instanceof ShadowRoot&&(o=o.host);var l=zre(n,o);if(l){var u=Wre(n,o),p=u[1],y=u[2];if(p>y)return!0}o=o.parentNode}while(o&&o!==i.body);return!1},DMe=function(n){var e=n.scrollTop,i=n.scrollHeight,o=n.clientHeight;return[e,i,o]},xMe=function(n){var e=n.scrollLeft,i=n.scrollWidth,o=n.clientWidth;return[e,i,o]},zre=function(n,e){return n==="v"?OMe(e):NMe(e)},Wre=function(n,e){return n==="v"?DMe(e):xMe(e)},LMe=function(n,e){return n==="h"&&e==="rtl"?-1:1},MMe=function(n,e,i,o,l){var u=LMe(n,window.getComputedStyle(e).direction),p=u*o,y=i.target,v=e.contains(y),w=!1,C=p>0,R=0,N=0;do{var M=Wre(n,y),L=M[0],U=M[1],z=M[2],J=U-z-u*L;(L||J)&&zre(n,y)&&(R+=J,N+=L),y instanceof ShadowRoot?y=y.host:y=y.parentNode}while(!v&&y!==document.body||v&&(e.contains(y)||e===y));return(C&&Math.abs(R)<1||!C&&Math.abs(N)<1)&&(w=!0),w},ek=function(n){return"changedTouches"in n?[n.changedTouches[0].clientX,n.changedTouches[0].clientY]:[0,0]},eJ=function(n){return[n.deltaX,n.deltaY]},tJ=function(n){return n&&"current"in n?n.current:n},UMe=function(n,e){return n[0]===e[0]&&n[1]===e[1]},VMe=function(n){return`
  .block-interactivity-`.concat(n,` {pointer-events: none;}
  .allow-interactivity-`).concat(n,` {pointer-events: all;}
`)},FMe=0,P0=[];function jMe(n){var e=O.useRef([]),i=O.useRef([0,0]),o=O.useRef(),l=O.useState(FMe++)[0],u=O.useState(jre)[0],p=O.useRef(n);O.useEffect(function(){p.current=n},[n]),O.useEffect(function(){if(n.inert){document.body.classList.add("block-interactivity-".concat(l));var U=zDe([n.lockRef.current],(n.shards||[]).map(tJ),!0).filter(Boolean);return U.forEach(function(z){return z.classList.add("allow-interactivity-".concat(l))}),function(){document.body.classList.remove("block-interactivity-".concat(l)),U.forEach(function(z){return z.classList.remove("allow-interactivity-".concat(l))})}}},[n.inert,n.lockRef.current,n.shards]);var y=O.useCallback(function(U,z){if("touches"in U&&U.touches.length===2||U.type==="wheel"&&U.ctrlKey)return!p.current.allowPinchZoom;var J=ek(U),q=i.current,re="deltaX"in U?U.deltaX:q[0]-J[0],ce="deltaY"in U?U.deltaY:q[1]-J[1],ae,pe=U.target,H=Math.abs(re)>Math.abs(ce)?"h":"v";if("touches"in U&&H==="h"&&pe.type==="range")return!1;var X=ZX(H,pe);if(!X)return!0;if(X?ae=H:(ae=H==="v"?"h":"v",X=ZX(H,pe)),!X)return!1;if(!o.current&&"changedTouches"in U&&(re||ce)&&(o.current=ae),!ae)return!0;var Q=o.current||ae;return MMe(Q,z,U,Q==="h"?re:ce)},[]),v=O.useCallback(function(U){var z=U;if(!(!P0.length||P0[P0.length-1]!==u)){var J="deltaY"in z?eJ(z):ek(z),q=e.current.filter(function(ae){return ae.name===z.type&&(ae.target===z.target||z.target===ae.shadowParent)&&UMe(ae.delta,J)})[0];if(q&&q.should){z.cancelable&&z.preventDefault();return}if(!q){var re=(p.current.shards||[]).map(tJ).filter(Boolean).filter(function(ae){return ae.contains(z.target)}),ce=re.length>0?y(z,re[0]):!p.current.noIsolation;ce&&z.cancelable&&z.preventDefault()}}},[]),w=O.useCallback(function(U,z,J,q){var re={name:U,delta:z,target:J,should:q,shadowParent:BMe(J)};e.current.push(re),setTimeout(function(){e.current=e.current.filter(function(ce){return ce!==re})},1)},[]),C=O.useCallback(function(U){i.current=ek(U),o.current=void 0},[]),R=O.useCallback(function(U){w(U.type,eJ(U),U.target,y(U,n.lockRef.current))},[]),N=O.useCallback(function(U){w(U.type,ek(U),U.target,y(U,n.lockRef.current))},[]);O.useEffect(function(){return P0.push(u),n.setCallbacks({onScrollCapture:R,onWheelCapture:R,onTouchMoveCapture:N}),document.addEventListener("wheel",v,A0),document.addEventListener("touchmove",v,A0),document.addEventListener("touchstart",C,A0),function(){P0=P0.filter(function(U){return U!==u}),document.removeEventListener("wheel",v,A0),document.removeEventListener("touchmove",v,A0),document.removeEventListener("touchstart",C,A0)}},[]);var M=n.removeScrollBar,L=n.inert;return O.createElement(O.Fragment,null,L?O.createElement(u,{styles:VMe(l)}):null,M?O.createElement(PMe,{gapMode:n.gapMode}):null)}function BMe(n){for(var e=null;n!==null;)n instanceof ShadowRoot&&(e=n.host,n=n.host),n=n.parentNode;return e}const zMe=WDe(Fre,jMe);var Gre=O.forwardRef(function(n,e){return O.createElement(mN,fp({},n,{ref:e,sideCar:zMe}))});Gre.classNames=mN.classNames;function WMe(n){const{autoFocus:e,trapFocus:i,dialogRef:o,initialFocusRef:l,blockScrollOnMount:u,allowPinchZoom:p,finalFocusRef:y,returnFocusOnClose:v,preserveScrollBarGap:w,lockFocusAcrossFrames:C,isOpen:R}=tE(),[N,M]=Sj();O.useEffect(()=>{!N&&M&&setTimeout(M)},[N,M]);const L=Vre(o,R);return S.jsx(_re,{autoFocus:e,isDisabled:!i,initialFocusRef:l,finalFocusRef:y,restoreFocus:v,contentRef:o,lockFocusAcrossFrames:C,children:S.jsx(Gre,{removeScrollBar:!w,allowPinchZoom:p,enabled:L===1&&u,forwardProps:!0,children:n.children})})}const GMe={initial:({offsetX:n,offsetY:e,transition:i,transitionEnd:o,delay:l})=>({opacity:0,x:n,y:e,transition:(i==null?void 0:i.exit)??Gy.exit(Wy.exit,l),transitionEnd:o==null?void 0:o.exit}),enter:({transition:n,transitionEnd:e,delay:i})=>({opacity:1,x:0,y:0,transition:(n==null?void 0:n.enter)??Gy.enter(Wy.enter,i),transitionEnd:e==null?void 0:e.enter}),exit:({offsetY:n,offsetX:e,transition:i,transitionEnd:o,reverse:l,delay:u})=>{const p={x:e,y:n};return{opacity:0,transition:(i==null?void 0:i.exit)??Gy.exit(Wy.exit,u),...l?{...p,transitionEnd:o==null?void 0:o.exit}:{transitionEnd:{...p,...o==null?void 0:o.exit}}}}},fC={initial:"initial",animate:"enter",exit:"exit",variants:GMe},HMe=O.forwardRef(function(e,i){const{unmountOnExit:o,in:l,reverse:u=!0,className:p,offsetX:y=0,offsetY:v=8,transition:w,transitionEnd:C,delay:R,animatePresenceProps:N,...M}=e,L=o?l&&o:!0,U=l||o?"enter":"exit",z={offsetX:y,offsetY:v,reverse:u,transition:w,transitionEnd:C,delay:R};return S.jsx($S,{...N,custom:z,children:L&&S.jsx(Dp.div,{ref:i,className:yn("chakra-offset-slide",p),custom:z,...fC,animate:U,...M})})});HMe.displayName="SlideFade";const $Me={exit:({reverse:n,initialScale:e,transition:i,transitionEnd:o,delay:l})=>({opacity:0,...n?{scale:e,transitionEnd:o==null?void 0:o.exit}:{transitionEnd:{scale:e,...o==null?void 0:o.exit}},transition:(i==null?void 0:i.exit)??Gy.exit(Wy.exit,l)}),enter:({transitionEnd:n,transition:e,delay:i})=>({opacity:1,scale:1,transition:(e==null?void 0:e.enter)??Gy.enter(Wy.enter,i),transitionEnd:n==null?void 0:n.enter})},Hre={initial:"exit",animate:"enter",exit:"exit",variants:$Me},KMe=O.forwardRef(function(e,i){const{unmountOnExit:o,in:l,reverse:u=!0,initialScale:p=.95,className:y,transition:v,transitionEnd:w,delay:C,animatePresenceProps:R,...N}=e,M=o?l&&o:!0,L=l||o?"enter":"exit",U={initialScale:p,reverse:u,transition:v,transitionEnd:w,delay:C};return S.jsx($S,{...R,custom:U,children:M&&S.jsx(Dp.div,{ref:i,className:yn("chakra-offset-slide",y),...Hre,animate:L,custom:U,...N})})});KMe.displayName="ScaleFade";const qMe={slideInBottom:{...fC,custom:{offsetY:16,reverse:!0}},slideInRight:{...fC,custom:{offsetX:16,reverse:!0}},slideInTop:{...fC,custom:{offsetY:-16,reverse:!0}},slideInLeft:{...fC,custom:{offsetX:-16,reverse:!0}},scale:{...Hre,custom:{initialScale:.95,reverse:!0}},none:{}},YMe=Ut(Dp.section),XMe=n=>qMe[n||"none"],$re=O.forwardRef((n,e)=>{const{preset:i,motionProps:o=XMe(i),...l}=n;return S.jsx(YMe,{ref:e,...o,...l})});$re.displayName="ModalTransition";const us=Bt((n,e)=>{const{className:i,children:o,containerProps:l,motionProps:u,...p}=n,{getDialogProps:y,getDialogContainerProps:v}=tE(),w=y(p,e),C=v(l),R=yn("chakra-modal__content",i),N=JS(),M={display:"flex",flexDirection:"column",position:"relative",width:"100%",outline:0,...N.dialog},L={display:"flex",width:"100vw",height:"$100vh",position:"fixed",left:0,top:0,...N.dialogContainer},{motionPreset:U}=tE();return S.jsx(WMe,{children:S.jsx(Ut.div,{...C,className:"chakra-modal__content-container",tabIndex:-1,__css:L,children:S.jsx($re,{preset:U,motionProps:u,className:R,...w,__css:M,children:o})})})});us.displayName="ModalContent";const gs=Bt((n,e)=>{const{className:i,...o}=n,{bodyId:l,setBodyMounted:u}=tE();O.useEffect(()=>(u(!0),()=>u(!1)),[u]);const p=yn("chakra-modal__body",i),y=JS();return S.jsx(Ut.div,{ref:e,className:p,id:l,...o,__css:y.body})});gs.displayName="ModalBody";const Is=Bt((n,e)=>{const{onClick:i,className:o,...l}=n,{onClose:u}=tE(),p=yn("chakra-modal__close-btn",o),y=JS();return S.jsx(t5,{ref:e,__css:y.closeButton,className:p,onClick:Un(i,v=>{v.stopPropagation(),u()}),...l})});Is.displayName="ModalCloseButton";const uh=Bt((n,e)=>{const{className:i,...o}=n,l=yn("chakra-modal__footer",i),u=JS(),p={display:"flex",alignItems:"center",justifyContent:"flex-end",...u.footer};return S.jsx(Ut.footer,{ref:e,...o,__css:p,className:l})});uh.displayName="ModalFooter";const co=Bt((n,e)=>{const{className:i,...o}=n,{headerId:l,setHeaderMounted:u}=tE();O.useEffect(()=>(u(!0),()=>u(!1)),[u]);const p=yn("chakra-modal__header",i),y=JS(),v={flex:0,...y.header};return S.jsx(Ut.header,{ref:e,className:p,id:l,...o,__css:v})});co.displayName="ModalHeader";const JMe={enter:({transition:n,transitionEnd:e,delay:i}={})=>({opacity:1,transition:(n==null?void 0:n.enter)??Gy.enter(Wy.enter,i),transitionEnd:e==null?void 0:e.enter}),exit:({transition:n,transitionEnd:e,delay:i}={})=>({opacity:0,transition:(n==null?void 0:n.exit)??Gy.exit(Wy.exit,i),transitionEnd:e==null?void 0:e.exit})},Kre={initial:"exit",animate:"enter",exit:"exit",variants:JMe},QMe=O.forwardRef(function(e,i){const{unmountOnExit:o,in:l,className:u,transition:p,transitionEnd:y,delay:v,animatePresenceProps:w,...C}=e,R=l||o?"enter":"exit",N=o?l&&o:!0,M={transition:p,transitionEnd:y,delay:v};return S.jsx($S,{...w,custom:M,children:N&&S.jsx(Dp.div,{ref:i,className:yn("chakra-fade",u),custom:M,...Kre,animate:R,...C})})});QMe.displayName="Fade";const ZMe=Ut(Dp.div),ds=Bt((n,e)=>{const{className:i,transition:o,motionProps:l,...u}=n,p=yn("chakra-modal__overlay",i),v={pos:"fixed",left:"0",top:"0",w:"100vw",h:"100vh",...JS().overlay},{motionPreset:w}=tE(),R=l||(w==="none"?{}:Kre);return S.jsx(ZMe,{...R,__css:v,ref:e,className:p,...u})});ds.displayName="ModalOverlay";function eUe(n){const{leastDestructiveRef:e,...i}=n;return S.jsx(ls,{...i,initialFocusRef:e})}const tUe=Bt((n,e)=>S.jsx(us,{ref:e,role:"alertdialog",...n})),nUe=n=>S.jsx(Sn,{viewBox:"0 0 24 24",...n,children:S.jsx("path",{fill:"currentColor",d:"M21,5H3C2.621,5,2.275,5.214,2.105,5.553C1.937,5.892,1.973,6.297,2.2,6.6l9,12 c0.188,0.252,0.485,0.4,0.8,0.4s0.611-0.148,0.8-0.4l9-12c0.228-0.303,0.264-0.708,0.095-1.047C21.725,5.214,21.379,5,21,5z"})}),rUe=n=>S.jsx(Sn,{viewBox:"0 0 24 24",...n,children:S.jsx("path",{fill:"currentColor",d:"M12.8,5.4c-0.377-0.504-1.223-0.504-1.6,0l-9,12c-0.228,0.303-0.264,0.708-0.095,1.047 C2.275,18.786,2.621,19,3,19h18c0.379,0,0.725-0.214,0.895-0.553c0.169-0.339,0.133-0.744-0.095-1.047L12.8,5.4z"})});function nJ(n,e,i,o){O.useEffect(()=>{if(!n.current||!o)return;const l=n.current.ownerDocument.defaultView??window,u=Array.isArray(e)?e:[e],p=new l.MutationObserver(y=>{for(const v of y)v.type==="attributes"&&v.attributeName&&u.includes(v.attributeName)&&i(v)});return p.observe(n.current,{attributes:!0,attributeFilter:u}),()=>p.disconnect()})}const iUe=50,rJ=300;function sUe(n,e){const[i,o]=O.useState(!1),[l,u]=O.useState(null),[p,y]=O.useState(!0),v=O.useRef(null),w=()=>clearTimeout(v.current);Kve(()=>{l==="increment"&&n(),l==="decrement"&&e()},i?iUe:null);const C=O.useCallback(()=>{p&&n(),v.current=setTimeout(()=>{y(!1),o(!0),u("increment")},rJ)},[n,p]),R=O.useCallback(()=>{p&&e(),v.current=setTimeout(()=>{y(!1),o(!0),u("decrement")},rJ)},[e,p]),N=O.useCallback(()=>{y(!0),o(!1),w()},[]);return O.useEffect(()=>()=>w(),[]),{up:C,down:R,stop:N,isSpinning:i}}const oUe=/^[Ee0-9+\-.]$/;function aUe(n){return oUe.test(n)}function cUe(n,e){if(n.key==null)return!0;const i=n.ctrlKey||n.altKey||n.metaKey;return!(n.key.length===1)||i?!0:e(n.key)}function lUe(n={}){const{focusInputOnChange:e=!0,clampValueOnBlur:i=!0,keepWithinRange:o=!0,min:l=Number.MIN_SAFE_INTEGER,max:u=Number.MAX_SAFE_INTEGER,step:p=1,isReadOnly:y,isDisabled:v,isRequired:w,isInvalid:C,pattern:R="[0-9]*(.[0-9]+)?",inputMode:N="decimal",allowMouseWheel:M,id:L,onChange:U,precision:z,name:J,"aria-describedby":q,"aria-label":re,"aria-labelledby":ce,onFocus:ae,onBlur:pe,onInvalid:H,getAriaValueText:X,isValidCharacter:Q,format:ne,parse:he,...fe}=n,de=so(ae),ke=so(pe),De=so(H),je=so(Q??aUe),Te=so(X),we=Dve(n),{update:Ie,increment:Oe,decrement:ve}=we,[xe,Ge]=O.useState(!1),Ze=!(y||v),lt=O.useRef(null),vt=O.useRef(null),nt=O.useRef(null),mt=O.useRef(null),et=O.useCallback(It=>It.split("").filter(je).join(""),[je]),St=O.useCallback(It=>(he==null?void 0:he(It))??It,[he]),un=O.useCallback(It=>((ne==null?void 0:ne(It))??It).toString(),[ne]);jf(()=>{(we.valueAsNumber>u||we.valueAsNumber<l)&&(De==null||De("rangeOverflow",un(we.value),we.valueAsNumber))},[we.valueAsNumber,we.value,un,De]),Sp(()=>{if(!lt.current)return;if(lt.current.value!=we.value){const cr=St(lt.current.value);we.setValue(et(cr))}},[St,et]);const ft=O.useCallback((It=p)=>{Ze&&Oe(It)},[Oe,Ze,p]),Ct=O.useCallback((It=p)=>{Ze&&ve(It)},[ve,Ze,p]),ut=sUe(ft,Ct);nJ(nt,"disabled",ut.stop,ut.isSpinning),nJ(mt,"disabled",ut.stop,ut.isSpinning);const Ft=O.useCallback(It=>{if(It.nativeEvent.isComposing)return;const Lt=St(It.currentTarget.value);Ie(et(Lt)),vt.current={start:It.currentTarget.selectionStart,end:It.currentTarget.selectionEnd}},[Ie,et,St]),on=O.useCallback(It=>{var cr;de==null||de(It),vt.current&&(It.currentTarget.selectionStart=vt.current.start??((cr=It.currentTarget.value)==null?void 0:cr.length),It.currentTarget.selectionEnd=vt.current.end??It.currentTarget.selectionStart)},[de]),Ht=O.useCallback(It=>{if(It.nativeEvent.isComposing)return;cUe(It,je)||It.preventDefault();const cr=Se(It)*p,Lt=It.key,Or={ArrowUp:()=>ft(cr),ArrowDown:()=>Ct(cr),Home:()=>Ie(l),End:()=>Ie(u)}[Lt];Or&&(It.preventDefault(),Or(It))},[je,p,ft,Ct,Ie,l,u]),Se=It=>{let cr=1;return(It.metaKey||It.ctrlKey)&&(cr=.1),It.shiftKey&&(cr=10),cr},Ne=O.useMemo(()=>{const It=Te==null?void 0:Te(we.value);if(It!=null)return It;const cr=we.value.toString();return cr||void 0},[we.value,Te]),$e=O.useCallback(()=>{let It=we.value;if(we.value==="")return;/^[eE]/.test(we.value.toString())?we.setValue(""):(we.valueAsNumber<l&&(It=l),we.valueAsNumber>u&&(It=u),we.cast(It))},[we,u,l]),Pt=O.useCallback(()=>{Ge(!1),i&&$e()},[i,Ge,$e]),Ot=O.useCallback(()=>{e&&requestAnimationFrame(()=>{var It;(It=lt.current)==null||It.focus()})},[e]),Et=O.useCallback(It=>{It.preventDefault(),ut.up(),Ot()},[Ot,ut]),xt=O.useCallback(It=>{It.preventDefault(),ut.down(),Ot()},[Ot,ut]);Vy(()=>lt.current,"wheel",It=>{var Oi;const Lt=(((Oi=lt.current)==null?void 0:Oi.ownerDocument)??document).activeElement===lt.current;if(!M||!Lt)return;It.preventDefault();const Yt=Se(It)*p,Or=Math.sign(It.deltaY);Or===-1?ft(Yt):Or===1&&Ct(Yt)},{passive:!1});const pn=O.useCallback((It={},cr=null)=>{const Lt=v||o&&we.isAtMax;return{...It,ref:$i(cr,nt),role:"button",tabIndex:-1,onPointerDown:Un(It.onPointerDown,Yt=>{Yt.button!==0||Lt||Et(Yt)}),onPointerLeave:Un(It.onPointerLeave,ut.stop),onPointerUp:Un(It.onPointerUp,ut.stop),disabled:Lt,"aria-disabled":Nf(Lt)}},[we.isAtMax,o,Et,ut.stop,v]),Cn=O.useCallback((It={},cr=null)=>{const Lt=v||o&&we.isAtMin;return{...It,ref:$i(cr,mt),role:"button",tabIndex:-1,onPointerDown:Un(It.onPointerDown,Yt=>{Yt.button!==0||Lt||xt(Yt)}),onPointerLeave:Un(It.onPointerLeave,ut.stop),onPointerUp:Un(It.onPointerUp,ut.stop),disabled:Lt,"aria-disabled":Nf(Lt)}},[we.isAtMin,o,xt,ut.stop,v]),En=O.useCallback((It={},cr=null)=>({name:J,inputMode:N,type:"text",pattern:R,"aria-labelledby":ce,"aria-label":re,"aria-describedby":q,id:L,disabled:v,role:"spinbutton",...It,readOnly:It.readOnly??y,"aria-readonly":It.readOnly??y,"aria-required":It.required??w,required:It.required??w,ref:$i(lt,cr),value:un(we.value),"aria-valuemin":l,"aria-valuemax":u,"aria-valuenow":Number.isNaN(we.valueAsNumber)?void 0:we.valueAsNumber,"aria-invalid":Nf(C??we.isOutOfRange),"aria-valuetext":Ne,autoComplete:"off",autoCorrect:"off",onChange:Un(It.onChange,Ft),onKeyDown:Un(It.onKeyDown,Ht),onFocus:Un(It.onFocus,on,()=>Ge(!0)),onBlur:Un(It.onBlur,ke,Pt)}),[J,N,R,ce,re,un,q,L,v,w,y,C,we.value,we.valueAsNumber,we.isOutOfRange,l,u,Ne,Ft,Ht,on,ke,Pt]);return{value:un(we.value),valueAsNumber:we.valueAsNumber,isFocused:xe,isDisabled:v,isReadOnly:y,getIncrementButtonProps:pn,getDecrementButtonProps:Cn,getInputProps:En,htmlProps:fe}}const[uUe,gN]=ki({name:"NumberInputStylesContext",errorMessage:`useNumberInputStyles returned is 'undefined'. Seems you forgot to wrap the components in "<NumberInput />" `}),[dUe,P5]=ki({name:"NumberInputContext",errorMessage:"useNumberInputContext: `context` is undefined. Seems you forgot to wrap number-input's components within <NumberInput />"}),xo=Bt(function(e,i){const o=Na("NumberInput",e),l=Fi(e),u=s5(l),{htmlProps:p,...y}=lUe(u),v=O.useMemo(()=>y,[y]);return S.jsx(dUe,{value:v,children:S.jsx(uUe,{value:o,children:S.jsx(Ut.div,{...p,ref:i,className:yn("chakra-numberinput",e.className),__css:{position:"relative",zIndex:0,...o.root}})})})});xo.displayName="NumberInput";const Lo=Bt(function(e,i){const o=gN();return S.jsx(Ut.div,{"aria-hidden":!0,ref:i,...e,__css:{display:"flex",flexDirection:"column",position:"absolute",top:"0",insetEnd:"0px",margin:"1px",height:"calc(100% - 2px)",zIndex:1,...o.stepperGroup}})});Lo.displayName="NumberInputStepper";const Mo=Bt(function(e,i){const{getInputProps:o}=P5(),l=o(e,i),u=gN();return S.jsx(Ut.input,{...l,className:yn("chakra-numberinput__field",e.className),__css:{width:"100%",...u.field}})});Mo.displayName="NumberInputField";const qre=Ut("div",{baseStyle:{display:"flex",justifyContent:"center",alignItems:"center",flex:1,transitionProperty:"common",transitionDuration:"normal",userSelect:"none",cursor:"pointer",lineHeight:"normal"}}),Uo=Bt(function(e,i){const o=gN(),{getDecrementButtonProps:l}=P5(),u=l(e,i);return S.jsx(qre,{...u,__css:o.stepper,children:e.children??S.jsx(nUe,{})})});Uo.displayName="NumberDecrementStepper";const Vo=Bt(function(e,i){const{getIncrementButtonProps:o}=P5(),l=o(e,i),u=gN();return S.jsx(qre,{...l,__css:u.stepper,children:e.children??S.jsx(rUe,{})})});Vo.displayName="NumberIncrementStepper";const[hUe,_N]=ki({name:"PopoverContext",errorMessage:"usePopoverContext: `context` is undefined. Seems you forgot to wrap all popover components within `<Popover />`"}),[pUe,Yre]=ki({name:"PopoverStylesContext",errorMessage:`usePopoverStyles returned is 'undefined'. Seems you forgot to wrap the components in "<Popover />" `}),k0={click:"click",hover:"hover"};function fUe(n={}){const{closeOnBlur:e=!0,closeOnEsc:i=!0,initialFocusRef:o,id:l,returnFocusOnClose:u=!0,autoFocus:p=!0,arrowSize:y,arrowShadowColor:v,trigger:w=k0.click,openDelay:C=200,closeDelay:R=200,isLazy:N,lazyBehavior:M="unmount",computePositionOnMount:L,...U}=n,{isOpen:z,onClose:J,onOpen:q,onToggle:re}=od(n),[ce,ae]=O.useState(u);O.useEffect(()=>ae(u),[u]);const pe=O.useRef(null),H=O.useRef(null),X=O.useRef(null),Q=O.useRef(!1),ne=O.useRef(!1);z&&(ne.current=!0);const[he,fe]=O.useState(!1),[de,ke]=O.useState(!1),De=O.useId(),je=l??De,[Te,we,Ie,Oe]=["popover-trigger","popover-content","popover-header","popover-body"].map(Ht=>`${Ht}-${je}`),{referenceRef:ve,getArrowProps:xe,getPopperProps:Ge,getArrowInnerProps:Ze,forceUpdate:lt}=A5({...U,enabled:z||!!L}),vt=iee({isOpen:z,ref:X});Gve({enabled:z,ref:H}),aee(X,{focusRef:H,visible:z,shouldFocus:ce&&w===k0.click}),Mve(X,{focusRef:o,visible:z,shouldFocus:p&&w===k0.click}),uee({enabled:z&&e,ref:X,handler(Ht){var Ne;const Se=((Ne=Ht.composedPath)==null?void 0:Ne.call(Ht)[0])??[Ht.target];tk(H.current,Se)||(Se&&ae(!Zk(Se)),J())}});const nt=QF({wasSelected:ne.current,enabled:N,mode:M,isSelected:vt.present}),mt=O.useCallback((Ht={},Se=null)=>{const Ne={...Ht,style:{...Ht.style,transformOrigin:Eo.transformOrigin.varRef,[Eo.arrowSize.var]:y?`${y}px`:void 0,[Eo.arrowShadowColor.var]:v},ref:$i(X,Se),children:nt?Ht.children:null,id:we,tabIndex:-1,role:"dialog",onKeyDown:Un(Ht.onKeyDown,$e=>{$e.nativeEvent.isComposing||i&&$e.key==="Escape"&&($e.preventDefault(),$e.stopPropagation(),J())}),onBlur:Un(Ht.onBlur,$e=>{const Pt=iJ($e),Ot=tk(X.current,Pt),Et=tk(H.current,Pt),xt=!Ot&&!Et;Pt&&ae(!Zk(Pt)),z&&e&&xt&&J()}),"aria-labelledby":he?Ie:void 0,"aria-describedby":de?Oe:void 0};return w===k0.hover&&(Ne.role="tooltip",Ne.onMouseEnter=Un(Ht.onMouseEnter,()=>{Q.current=!0}),Ne.onMouseLeave=Un(Ht.onMouseLeave,$e=>{$e.nativeEvent.relatedTarget!==null&&(Q.current=!1,setTimeout(()=>J(),R))})),Ne},[nt,we,he,Ie,de,Oe,w,i,J,z,e,R,v,y]),et=O.useCallback((Ht={},Se=null)=>Ge({...Ht,style:{visibility:z?"visible":"hidden",...Ht.style}},Se),[z,Ge]),St=O.useCallback((Ht,Se=null)=>({...Ht,ref:$i(Se,pe,ve)}),[pe,ve]),un=O.useRef(void 0),ft=O.useRef(void 0),Ct=O.useCallback(Ht=>{pe.current==null&&ve(Ht)},[ve]),ut=O.useCallback((Ht={},Se=null)=>{const Ne={...Ht,ref:$i(H,Se,Ct),id:Te,"aria-haspopup":"dialog","aria-expanded":z,"aria-controls":we};return w===k0.click&&(Ne.onClick=Un(Ht.onClick,re)),w===k0.hover&&(Ne.onFocus=Un(Ht.onFocus,()=>{un.current===void 0&&q()}),Ne.onBlur=Un(Ht.onBlur,$e=>{const Pt=iJ($e),Ot=!tk(X.current,Pt);z&&e&&Ot&&J()}),Ne.onKeyDown=Un(Ht.onKeyDown,$e=>{$e.key==="Escape"&&J()}),Ne.onMouseEnter=Un(Ht.onMouseEnter,()=>{Q.current=!0,un.current=window.setTimeout(()=>q(),C)}),Ne.onMouseLeave=Un(Ht.onMouseLeave,()=>{Q.current=!1,un.current&&(clearTimeout(un.current),un.current=void 0),ft.current=window.setTimeout(()=>{Q.current===!1&&J()},R)})),Ne},[Te,z,we,w,Ct,re,q,e,J,C,R]);O.useEffect(()=>()=>{un.current&&clearTimeout(un.current),ft.current&&clearTimeout(ft.current)},[]);const Ft=O.useCallback((Ht={},Se=null)=>({...Ht,id:Ie,ref:$i(Se,Ne=>{fe(!!Ne)})}),[Ie]),on=O.useCallback((Ht={},Se=null)=>({...Ht,id:Oe,ref:$i(Se,Ne=>{ke(!!Ne)})}),[Oe]);return{forceUpdate:lt,isOpen:z,onAnimationComplete:vt.onComplete,onClose:J,getAnchorProps:St,getArrowProps:xe,getArrowInnerProps:Ze,getPopoverPositionerProps:et,getPopoverProps:mt,getTriggerProps:ut,getHeaderProps:Ft,getBodyProps:on}}function tk(n,e){return n===e||(n==null?void 0:n.contains(e))}function iJ(n){const e=n.currentTarget.ownerDocument.activeElement;return n.relatedTarget??e}function Xre(n){const e=Na("Popover",n),{children:i,...o}=Fi(n),l=YS(),u=fUe({...o,direction:l.direction});return S.jsx(hUe,{value:u,children:S.jsx(pUe,{value:e,children:pl(i,{isOpen:u.isOpen,onClose:u.onClose,forceUpdate:u.forceUpdate})})})}Xre.displayName="Popover";function Jre(n){var i;const e=O.version;return typeof e!="string"||e.startsWith("18.")?n==null?void 0:n.ref:(i=n==null?void 0:n.props)==null?void 0:i.ref}const Qre=Bt(function(e,i){const{getBodyProps:o}=_N(),l=Yre();return S.jsx(Ut.div,{...o(e,i),className:yn("chakra-popover__body",e.className),__css:l.body})});Qre.displayName="PopoverBody";function mUe(n){if(n)return{enter:{...n.enter,visibility:"visible"},exit:{...n.exit,transitionEnd:{visibility:"hidden"}}}}const gUe={exit:{opacity:0,scale:.95,transition:{duration:.1,ease:[.4,0,1,1]}},enter:{scale:1,opacity:1,transition:{duration:.15,ease:[0,0,.2,1]}}},_Ue=Ut(Dp.section),Zre=Bt(function(e,i){const{variants:o=gUe,...l}=e,{isOpen:u}=_N();return S.jsx(_Ue,{ref:i,variants:mUe(o),initial:!1,animate:u?"enter":"exit",...l})});Zre.displayName="PopoverTransition";const eie=Bt(function(e,i){const{rootProps:o,motionProps:l,...u}=e,{getPopoverProps:p,getPopoverPositionerProps:y,onAnimationComplete:v}=_N(),w=Yre(),C={position:"relative",display:"flex",flexDirection:"column",...w.content};return S.jsx(Ut.div,{...y(o),__css:w.popper,className:"chakra-popover__popper",children:S.jsx(Zre,{...l,...p(u,i),onAnimationComplete:QZ(v,u.onAnimationComplete),className:yn("chakra-popover__content",e.className),__css:C})})});eie.displayName="PopoverContent";function tie(n){const e=O.Children.only(n.children),{getTriggerProps:i}=_N();return S.jsx(S.Fragment,{children:O.cloneElement(e,i(e.props,Jre(e)))})}tie.displayName="PopoverTrigger";function yUe(n,e,i){return(n-e)*100/(i-e)}RR({"0%":{strokeDasharray:"1, 400",strokeDashoffset:"0"},"50%":{strokeDasharray:"400, 400",strokeDashoffset:"-100"},"100%":{strokeDasharray:"400, 400",strokeDashoffset:"-260"}});RR({"0%":{transform:"rotate(0deg)"},"100%":{transform:"rotate(360deg)"}});const EUe=RR({"0%":{left:"-40%"},"100%":{left:"100%"}}),vUe=RR({from:{backgroundPosition:"1rem 0"},to:{backgroundPosition:"0 0"}});function SUe(n){const{value:e=0,min:i,max:o,valueText:l,getValueText:u,isIndeterminate:p,role:y="progressbar"}=n,v=yUe(e,i,o);return{bind:{"data-indeterminate":p?"":void 0,"aria-valuemax":o,"aria-valuemin":i,"aria-valuenow":p?void 0:e,"aria-valuetext":(()=>{if(e!=null)return typeof u=="function"?u(e,v):l})(),role:y},percent:v,value:e}}const[bUe,wUe]=ki({name:"ProgressStylesContext",errorMessage:`useProgressStyles returned is 'undefined'. Seems you forgot to wrap the components in "<Progress />" `}),TUe=Bt((n,e)=>{const{min:i,max:o,value:l,isIndeterminate:u,role:p,...y}=n,v=SUe({value:l,min:i,max:o,isIndeterminate:u,role:p}),C={height:"100%",...wUe().filledTrack};return S.jsx(Ut.div,{ref:e,style:{width:`${v.percent}%`,...y.style},...v.bind,...y,__css:C})}),qy=Bt((n,e)=>{var H;const{value:i,min:o=0,max:l=100,hasStripe:u,isAnimated:p,children:y,borderRadius:v,isIndeterminate:w,"aria-label":C,"aria-labelledby":R,"aria-valuetext":N,title:M,role:L,...U}=Fi(n),z=Na("Progress",n),J=v??((H=z.track)==null?void 0:H.borderRadius),q={animation:`${vUe} 1s linear infinite`},ae={...!w&&u&&p&&q,...w&&{position:"absolute",willChange:"left",minWidth:"50%",animation:`${EUe} 1s ease infinite normal none running`}},pe={overflow:"hidden",position:"relative",...z.track};return S.jsx(Ut.div,{ref:e,borderRadius:J,__css:pe,...U,children:S.jsxs(bUe,{value:z,children:[S.jsx(TUe,{"aria-label":C,"aria-labelledby":R,"aria-valuetext":N,min:o,max:l,value:i,isIndeterminate:w,css:ae,borderRadius:J,title:M,role:L}),y]})})});qy.displayName="Progress";const nie=Bt(function(e,i){const{children:o,placeholder:l,className:u,...p}=e;return S.jsxs(Ut.select,{...p,ref:i,className:yn("chakra-select",u),children:[l&&S.jsx("option",{value:"",children:l}),o]})});nie.displayName="SelectField";const rie=Bt((n,e)=>{var re;const i=Na("Select",n),{rootProps:o,placeholder:l,icon:u,color:p,height:y,h:v,minH:w,minHeight:C,iconColor:R,iconSize:N,...M}=Fi(n),[L,U]=Rve(M,H0e),z=i5(U),J={width:"100%",height:"fit-content",position:"relative",color:p},q={paddingEnd:"2rem",...i.field,_focus:{zIndex:"unset",...(re=i.field)==null?void 0:re._focus}};return S.jsxs(Ut.div,{className:"chakra-select__wrapper",__css:J,...L,...o,children:[S.jsx(nie,{ref:e,height:v??y,minH:w??C,placeholder:l,...z,__css:q,children:n.children}),S.jsx(iie,{"data-disabled":ur(z.disabled),...(R||p)&&{color:R||p},__css:i.icon,...N&&{fontSize:N},children:u})]})});rie.displayName="Select";const CUe=n=>S.jsx("svg",{viewBox:"0 0 24 24",...n,children:S.jsx("path",{fill:"currentColor",d:"M16.59 8.59L12 13.17 7.41 8.59 6 10l6 6 6-6z"})}),RUe=Ut("div",{baseStyle:{position:"absolute",display:"inline-flex",alignItems:"center",justifyContent:"center",pointerEvents:"none",top:"50%",transform:"translateY(-50%)"}}),iie=n=>{const{children:e=S.jsx(CUe,{}),...i}=n,o=O.cloneElement(e,{role:"presentation",className:"chakra-select__icon",focusable:!1,"aria-hidden":!0,style:{width:"1em",height:"1em",color:"currentColor"}});return S.jsx(RUe,{...i,className:"chakra-select__icon-wrapper",children:O.isValidElement(e)?o:null})};iie.displayName="SelectIcon";function HU(n){const{orientation:e,vertical:i,horizontal:o}=n;return e==="vertical"?i:o}function IUe(n){const{orientation:e,thumbPercents:i,isReversed:o}=n,l=M=>({position:"absolute",userSelect:"none",WebkitUserSelect:"none",MozUserSelect:"none",msUserSelect:"none",touchAction:"none",...HU({orientation:e,vertical:{bottom:`calc(${i[M]}% - var(--slider-thumb-size) / 2)`},horizontal:{left:`calc(${i[M]}% - var(--slider-thumb-size) / 2)`}})}),u={position:"relative",touchAction:"none",WebkitTapHighlightColor:"rgba(0,0,0,0)",userSelect:"none",outline:0},p={position:"absolute",...HU({orientation:e,vertical:{left:"50%",transform:"translateX(-50%)",height:"100%"},horizontal:{top:"50%",transform:"translateY(-50%)",width:"100%"}})},y=i.length===1,v=[0,o?100-i[0]:i[0]],w=y?v:i;let C=w[0];!y&&o&&(C=100-C);const R=Math.abs(w[w.length-1]-w[0]),N={...p,...HU({orientation:e,vertical:o?{height:`${R}%`,top:`${C}%`}:{height:`${R}%`,bottom:`${C}%`},horizontal:o?{width:`${R}%`,right:`${C}%`}:{width:`${R}%`,left:`${C}%`}})};return{trackStyle:p,innerTrackStyle:N,rootStyle:u,getThumbStyle:l}}function AUe(n){const{isReversed:e,direction:i,orientation:o}=n;return i==="ltr"||o==="vertical"?e:!e}function PUe(n){const{min:e=0,max:i=100,onChange:o,value:l,defaultValue:u,isReversed:p,direction:y="ltr",orientation:v="horizontal",id:w,isDisabled:C,isReadOnly:R,onChangeStart:N,onChangeEnd:M,step:L=1,getAriaValueText:U,"aria-valuetext":z,"aria-label":J,"aria-labelledby":q,name:re,focusThumbOnChange:ce=!0,...ae}=n,pe=so(N),H=so(M),X=so(U),Q=AUe({isReversed:p,direction:y,orientation:v}),[ne,he]=see({value:l,defaultValue:u??OUe(e,i),onChange:o}),[fe,de]=O.useState(!1),[ke,De]=O.useState(!1),je=!(C||R),Te=(i-e)/10,we=L||(i-e)/100,Ie=_k(ne,e,i),Oe=i-Ie+e,xe=uq(Q?Oe:Ie,e,i),Ge=v==="vertical",Ze=lee({min:e,max:i,step:L,isDisabled:C,value:Ie,isInteractive:je,isReversed:Q,isVertical:Ge,eventSource:null,focusThumbOnChange:ce,orientation:v}),lt=O.useRef(null),vt=O.useRef(null),nt=O.useRef(null),mt=O.useId(),et=w??mt,[St,un]=[`slider-thumb-${et}`,`slider-track-${et}`],ft=O.useCallback(Lt=>{var xa;if(!lt.current)return;const Yt=Ze.current;Yt.eventSource="pointer";const Or=lt.current.getBoundingClientRect(),{clientX:Oi,clientY:ji}=((xa=Lt.touches)==null?void 0:xa[0])??Lt,Fr=Ge?Or.bottom-ji:Oi-Or.left,Xn=Ge?Or.height:Or.width;let oa=Fr/Xn;Q&&(oa=1-oa);let Ki=bve(oa,Yt.min,Yt.max);return Yt.step&&(Ki=parseFloat(dq(Ki,Yt.min,Yt.step))),Ki=_k(Ki,Yt.min,Yt.max),Ki},[Ge,Q,Ze]),Ct=O.useCallback(Lt=>{const Yt=Ze.current;Yt.isInteractive&&(Lt=parseFloat(dq(Lt,Yt.min,we)),Lt=_k(Lt,Yt.min,Yt.max),he(Lt))},[we,he,Ze]),ut=O.useMemo(()=>({stepUp(Lt=we){const Yt=Q?Ie-Lt:Ie+Lt;Ct(Yt)},stepDown(Lt=we){const Yt=Q?Ie+Lt:Ie-Lt;Ct(Yt)},reset(){Ct(u||0)},stepTo(Lt){Ct(Lt)}}),[Ct,Q,Ie,we,u]),Ft=O.useCallback(Lt=>{const Yt=Ze.current,Oi={ArrowRight:()=>ut.stepUp(),ArrowUp:()=>ut.stepUp(),ArrowLeft:()=>ut.stepDown(),ArrowDown:()=>ut.stepDown(),PageUp:()=>ut.stepUp(Te),PageDown:()=>ut.stepDown(Te),Home:()=>Ct(Yt.min),End:()=>Ct(Yt.max)}[Lt.key];Oi&&(Lt.preventDefault(),Lt.stopPropagation(),Oi(Lt),Yt.eventSource="keyboard")},[ut,Ct,Te,Ze]),on=(X==null?void 0:X(Ie))??z,{getThumbStyle:Ht,rootStyle:Se,trackStyle:Ne,innerTrackStyle:$e}=O.useMemo(()=>{const Lt=Ze.current;return IUe({isReversed:Q,orientation:Lt.orientation,thumbPercents:[xe]})},[Q,xe,Ze]),Pt=O.useCallback(()=>{Ze.current.focusThumbOnChange&&setTimeout(()=>{var Yt;return(Yt=vt.current)==null?void 0:Yt.focus()})},[Ze]);jf(()=>{const Lt=Ze.current;Pt(),Lt.eventSource==="keyboard"&&(H==null||H(Lt.value))},[Ie,H]);function Ot(Lt){const Yt=ft(Lt);Yt!=null&&Yt!==Ze.current.value&&he(Yt)}d0e(nt,{onPanSessionStart(Lt){const Yt=Ze.current;Yt.isInteractive&&(de(!0),Pt(),Ot(Lt),pe==null||pe(Yt.value))},onPanSessionEnd(){const Lt=Ze.current;Lt.isInteractive&&(de(!1),H==null||H(Lt.value))},onPan(Lt){Ze.current.isInteractive&&Ot(Lt)}});const Et=O.useCallback((Lt={},Yt=null)=>({...Lt,...ae,ref:$i(Yt,nt),tabIndex:-1,"aria-disabled":Nf(C),"data-focused":ur(ke),style:{...Lt.style,...Se}}),[ae,C,ke,Se]),xt=O.useCallback((Lt={},Yt=null)=>({...Lt,ref:$i(Yt,lt),id:un,"data-disabled":ur(C),style:{...Lt.style,...Ne}}),[C,un,Ne]),pn=O.useCallback((Lt={},Yt=null)=>({...Lt,ref:Yt,style:{...Lt.style,...$e}}),[$e]),Cn=O.useCallback((Lt={},Yt=null)=>({...Lt,ref:$i(Yt,vt),role:"slider",tabIndex:je?0:void 0,id:St,"data-active":ur(fe),"aria-valuetext":on,"aria-valuemin":e,"aria-valuemax":i,"aria-valuenow":Ie,"aria-orientation":v,"aria-disabled":Nf(C),"aria-readonly":Nf(R),"aria-label":J,"aria-labelledby":J?void 0:q,style:{...Lt.style,...Ht(0)},onKeyDown:Un(Lt.onKeyDown,Ft),onFocus:Un(Lt.onFocus,()=>De(!0)),onBlur:Un(Lt.onBlur,()=>De(!1))}),[je,St,fe,on,e,i,Ie,v,C,R,J,q,Ht,Ft]),En=O.useCallback((Lt,Yt=null)=>{const Or=!(Lt.value<e||Lt.value>i),Oi=Ie>=Lt.value,ji=uq(Lt.value,e,i),Fr={position:"absolute",pointerEvents:"none",...kUe({orientation:v,vertical:{bottom:Q?`${100-ji}%`:`${ji}%`},horizontal:{left:Q?`${100-ji}%`:`${ji}%`}})};return{...Lt,ref:Yt,role:"presentation","aria-hidden":!0,"data-disabled":ur(C),"data-invalid":ur(!Or),"data-highlighted":ur(Oi),style:{...Lt.style,...Fr}}},[C,Q,i,e,v,Ie]),It=O.useCallback((Lt={},Yt=null)=>({...Lt,ref:Yt,type:"hidden",value:Ie,name:re}),[re,Ie]);return{state:{value:Ie,isFocused:ke,isDragging:fe},actions:ut,getRootProps:Et,getTrackProps:xt,getInnerTrackProps:pn,getThumbProps:Cn,getMarkerProps:En,getInputProps:It}}function kUe(n){const{orientation:e,vertical:i,horizontal:o}=n;return e==="vertical"?i:o}function OUe(n,e){return e<n?n:n+(e-n)/2}const[NUe,yN]=ki({name:"SliderContext",hookName:"useSliderContext",providerName:"<Slider />"}),[DUe,EN]=ki({name:"SliderStylesContext",hookName:"useSliderStyles",providerName:"<Slider />"}),aS=Bt((n,e)=>{const i={...n,orientation:(n==null?void 0:n.orientation)??"horizontal"},o=Na("Slider",i),l=Fi(i),{direction:u}=YS();l.direction=u;const{getInputProps:p,getRootProps:y,...v}=PUe(l),w=y(),C=p({},e);return S.jsx(NUe,{value:v,children:S.jsx(DUe,{value:o,children:S.jsxs(Ut.div,{...w,className:yn("chakra-slider",i.className),__css:o.container,children:[i.children,S.jsx("input",{...C})]})})})});aS.displayName="Slider";const cS=Bt((n,e)=>{const{getThumbProps:i}=yN(),o=EN(),l=i(n,e);return S.jsx(Ut.div,{...l,className:yn("chakra-slider__thumb",n.className),__css:o.thumb})});cS.displayName="SliderThumb";const lS=Bt((n,e)=>{const{getTrackProps:i}=yN(),o=EN(),l=i(n,e);return S.jsx(Ut.div,{...l,className:yn("chakra-slider__track",n.className),__css:o.track})});lS.displayName="SliderTrack";const uS=Bt((n,e)=>{const{getInnerTrackProps:i}=yN(),o=EN(),l=i(n,e);return S.jsx(Ut.div,{...l,className:yn("chakra-slider__filled-track",n.className),__css:o.filledTrack})});uS.displayName="SliderFilledTrack";const xUe=Bt((n,e)=>{const{getMarkerProps:i}=yN(),o=EN(),l=i(n,e);return S.jsx(Ut.div,{...l,className:yn("chakra-slider__marker",n.className),__css:o.mark})});xUe.displayName="SliderMark";const dS=Ut("div",{baseStyle:{flex:1,justifySelf:"stretch",alignSelf:"stretch"}});dS.displayName="Spacer";const sie=n=>S.jsx(Ut.div,{className:"chakra-stack__item",...n,__css:{display:"inline-block",flex:"0 0 auto",minWidth:0,...n.__css}});sie.displayName="StackItem";function LUe(n){const{spacing:e,direction:i}=n,o={column:{my:e,mx:0,borderLeftWidth:0,borderBottomWidth:"1px"},"column-reverse":{my:e,mx:0,borderLeftWidth:0,borderBottomWidth:"1px"},row:{mx:e,my:0,borderLeftWidth:"1px",borderBottomWidth:0},"row-reverse":{mx:e,my:0,borderLeftWidth:"1px",borderBottomWidth:0}};return{"&":qO(i,l=>o[l])}}const k5=Bt((n,e)=>{const{isInline:i,direction:o,align:l,justify:u,spacing:p="0.5rem",wrap:y,children:v,divider:w,className:C,shouldWrapChildren:R,...N}=n,M=i?"row":o??"column",L=O.useMemo(()=>LUe({spacing:p,direction:M}),[p,M]),U=!!w,z=!R&&!U,J=O.useMemo(()=>{const re=$O(v);return z?re:re.map((ce,ae)=>{const pe=typeof ce.key<"u"?ce.key:ae,H=ae+1===re.length,Q=R?S.jsx(sie,{children:ce},pe):ce;if(!U)return Q;const ne=O.cloneElement(w,{__css:L}),he=H?null:ne;return S.jsxs(O.Fragment,{children:[Q,he]},pe)})},[w,L,U,z,R,v]),q=yn("chakra-stack",C);return S.jsx(Ut.div,{ref:e,display:"flex",alignItems:l,justifyContent:u,flexDirection:M,flexWrap:y,gap:U?void 0:p,className:q,...N,children:J})});k5.displayName="Stack";const Qn=Bt((n,e)=>S.jsx(k5,{align:"center",...n,direction:"row",ref:e}));Qn.displayName="HStack";const Ir=Bt((n,e)=>S.jsx(k5,{align:"center",...n,direction:"column",ref:e}));Ir.displayName="VStack";const Mf=Bt(function(e,i){const o=Na("Switch",e),{spacing:l="0.5rem",children:u,...p}=Fi(e),{getIndicatorProps:y,getInputProps:v,getCheckboxProps:w,getRootProps:C,getLabelProps:R}=kDe(p),N=O.useMemo(()=>({display:"inline-block",position:"relative",verticalAlign:"middle",lineHeight:0,...o.container}),[o.container]),M=O.useMemo(()=>({display:"inline-flex",flexShrink:0,justifyContent:"flex-start",boxSizing:"content-box",cursor:"pointer",...o.track}),[o.track]),L=O.useMemo(()=>({userSelect:"none",marginStart:l,...o.label}),[l,o.label]);return S.jsxs(Ut.label,{...C(),className:yn("chakra-switch",e.className),__css:N,children:[S.jsx("input",{className:"chakra-switch__input",...v({},i)}),S.jsx(Ut.span,{...w(),className:"chakra-switch__track",__css:M,children:S.jsx(Ut.span,{__css:o.thumb,className:"chakra-switch__thumb",...y()})}),u&&S.jsx(Ut.span,{className:"chakra-switch__label",...R(),__css:L,children:u})]})});Mf.displayName="Switch";const[MUe,UUe,VUe,FUe]=Nne();function jUe(n){const{defaultIndex:e,onChange:i,index:o,isManual:l,isLazy:u,lazyBehavior:p="unmount",orientation:y="horizontal",direction:v="ltr",...w}=n,[C,R]=O.useState(e??0),[N,M]=see({defaultValue:e??0,value:o,onChange:i});O.useEffect(()=>{o!=null&&R(o)},[o]);const L=VUe(),U=O.useId();return{id:`tabs-${n.id??U}`,selectedIndex:N,focusedIndex:C,setSelectedIndex:M,setFocusedIndex:R,isManual:l,isLazy:u,lazyBehavior:p,orientation:y,descendants:L,direction:v,htmlProps:w}}const[BUe,vN]=ki({name:"TabsContext",errorMessage:"useTabsContext: `context` is undefined. Seems you forgot to wrap all tabs components within <Tabs />"});function zUe(n){const{focusedIndex:e,orientation:i,direction:o}=vN(),l=UUe(),u=O.useCallback(p=>{const y=()=>{var re;const q=l.nextEnabled(e);q&&((re=q.node)==null||re.focus())},v=()=>{var re;const q=l.prevEnabled(e);q&&((re=q.node)==null||re.focus())},w=()=>{var re;const q=l.firstEnabled();q&&((re=q.node)==null||re.focus())},C=()=>{var re;const q=l.lastEnabled();q&&((re=q.node)==null||re.focus())},R=i==="horizontal",N=i==="vertical",M=p.key,L=o==="ltr"?"ArrowLeft":"ArrowRight",U=o==="ltr"?"ArrowRight":"ArrowLeft",J={[L]:()=>R&&v(),[U]:()=>R&&y(),ArrowDown:()=>N&&y(),ArrowUp:()=>N&&v(),Home:w,End:C}[M];J&&(p.preventDefault(),J(p))},[l,e,i,o]);return{...n,role:"tablist","aria-orientation":i,onKeyDown:Un(n.onKeyDown,u)}}function WUe(n){const{isDisabled:e=!1,isFocusable:i=!1,...o}=n,{setSelectedIndex:l,isManual:u,id:p,setFocusedIndex:y,selectedIndex:v}=vN(),{index:w,register:C}=FUe({disabled:e&&!i}),R=w===v,N=()=>{l(w)},M=()=>{y(w),!u&&!(e&&i)&&l(w)};return{...Dre({...o,ref:$i(C,n.ref),isDisabled:e,isFocusable:i,onClick:Un(n.onClick,N)}),id:oie(p,w),role:"tab",tabIndex:R?0:-1,type:"button","aria-selected":R,"aria-controls":aie(p,w),onFocus:e?void 0:Un(n.onFocus,M)}}const[GUe,HUe]=ki({});function $Ue(n){const e=vN(),{id:i,selectedIndex:o}=e,u=$O(n.children).map((p,y)=>O.createElement(GUe,{key:p.key??y,value:{isSelected:y===o,id:aie(i,y),tabId:oie(i,y),selectedIndex:o}},p));return{...n,children:u}}function KUe(n){const{children:e,...i}=n,{isLazy:o,lazyBehavior:l}=vN(),{isSelected:u,id:p,tabId:y}=HUe(),v=O.useRef(!1);u&&(v.current=!0);const w=QF({wasSelected:v.current,isSelected:u,enabled:o,mode:l});return{tabIndex:0,...i,children:w?e:null,role:"tabpanel","aria-labelledby":y,hidden:!u,id:p}}function oie(n,e){return`${n}--tab-${e}`}function aie(n,e){return`${n}--tabpanel-${e}`}const[qUe,SN]=ki({name:"TabsStylesContext",errorMessage:`useTabsStyles returned is 'undefined'. Seems you forgot to wrap the components in "<Tabs />" `}),kS=Bt(function(e,i){const o=Na("Tabs",e),{children:l,className:u,...p}=Fi(e),{htmlProps:y,descendants:v,...w}=jUe(p),C=O.useMemo(()=>w,[w]),{isFitted:R,...N}=y,M={position:"relative",...o.root};return S.jsx(MUe,{value:v,children:S.jsx(BUe,{value:C,children:S.jsx(qUe,{value:o,children:S.jsx(Ut.div,{className:yn("chakra-tabs",u),ref:i,...N,__css:M,children:l})})})})});kS.displayName="Tabs";const Ia=Bt(function(e,i){const o=SN(),l=WUe({...e,ref:i}),u={outline:"0",display:"flex",alignItems:"center",justifyContent:"center",...o.tab};return S.jsx(Ut.button,{...l,className:yn("chakra-tabs__tab",e.className),__css:u})});Ia.displayName="Tab";const OS=Bt(function(e,i){const o=zUe({...e,ref:i}),l=SN(),u={display:"flex",...l.tablist};return S.jsx(Ut.div,{...o,className:yn("chakra-tabs__tablist",e.className),__css:u})});OS.displayName="TabList";const Ic=Bt(function(e,i){const o=KUe({...e,ref:i}),l=SN();return S.jsx(Ut.div,{outline:"0",...o,className:yn("chakra-tabs__tab-panel",e.className),__css:l.tabpanel})});Ic.displayName="TabPanel";const lR=Bt(function(e,i){const o=$Ue(e),l=SN();return S.jsx(Ut.div,{...o,width:"100%",ref:i,className:yn("chakra-tabs__tab-panels",e.className),__css:l.tabpanels})});lR.displayName="TabPanels";const[YUe,cie]=ki({name:"TagStylesContext",errorMessage:`useTagStyles returned is 'undefined'. Seems you forgot to wrap the components in "<Tag />" `}),lie=Bt((n,e)=>{const i=Na("Tag",n),o=Fi(n),l={display:"inline-flex",verticalAlign:"top",alignItems:"center",maxWidth:"100%",...i.container};return S.jsx(YUe,{value:i,children:S.jsx(Ut.span,{ref:e,...o,__css:l})})});lie.displayName="Tag";const uie=Bt((n,e)=>{const i=cie();return S.jsx(Ut.span,{ref:e,noOfLines:1,...n,__css:i.label})});uie.displayName="TagLabel";const XUe=Bt((n,e)=>S.jsx(Sn,{ref:e,verticalAlign:"top",marginEnd:"0.5rem",...n}));XUe.displayName="TagLeftIcon";const JUe=Bt((n,e)=>S.jsx(Sn,{ref:e,verticalAlign:"top",marginStart:"0.5rem",...n}));JUe.displayName="TagRightIcon";const die=n=>S.jsx(Sn,{verticalAlign:"inherit",viewBox:"0 0 512 512",...n,children:S.jsx("path",{fill:"currentColor",d:"M289.94 256l95-95A24 24 0 00351 127l-95 95-95-95a24 24 0 00-34 34l95 95-95 95a24 24 0 1034 34l95-95 95 95a24 24 0 0034-34z"})});die.displayName="TagCloseIcon";const hie=Bt((n,e)=>{const{isDisabled:i,children:o,...l}=n,p={display:"flex",alignItems:"center",justifyContent:"center",outline:"0",...cie().closeButton};return S.jsx(Ut.button,{ref:e,"aria-label":"close",...l,type:"button",disabled:i,__css:p,children:o||S.jsx(die,{})})});hie.displayName="TagCloseButton";const QUe=["h","minH","height","minHeight"],pie=Bt((n,e)=>{const i=cu("Textarea",n),{className:o,rows:l,...u}=Fi(n),p=i5(u),y=l?GS(i,QUe):i;return S.jsx(Ut.textarea,{ref:e,rows:l,...p,className:yn("chakra-textarea",o),__css:y})});pie.displayName="Textarea";function ZUe(n,e){const i=n??"bottom",l={"top-start":{ltr:"top-left",rtl:"top-right"},"top-end":{ltr:"top-right",rtl:"top-left"},"bottom-start":{ltr:"bottom-left",rtl:"bottom-right"},"bottom-end":{ltr:"bottom-right",rtl:"bottom-left"}}[i];return(l==null?void 0:l[e])??i}function eVe(n,e){const i=l=>({...e,...l,position:ZUe((l==null?void 0:l.position)??(e==null?void 0:e.position),n)}),o=l=>{const u=i(l),p=Pne(u);return pp.notify(p,u)};return o.update=(l,u)=>{pp.update(l,i(u))},o.promise=(l,u)=>{const p=o({...u.loading,status:"loading",duration:null});l.then(y=>o.update(p,{status:"success",duration:5e3,...pl(u.success,y)})).catch(y=>o.update(p,{status:"error",duration:5e3,...pl(u.error,y)}))},o.closeAll=pp.closeAll,o.close=pp.close,o.isActive=pp.isActive,o}function Da(n){const{theme:e}=Rne(),i=nDe();return O.useMemo(()=>eVe(e.direction,{...i,...n}),[n,e.direction,i])}const tVe={exit:{scale:.85,opacity:0,transition:{opacity:{duration:.15,easings:"easeInOut"},scale:{duration:.2,easings:"easeInOut"}}},enter:{scale:1,opacity:1,transition:{opacity:{easings:"easeOut",duration:.2},scale:{duration:.2,ease:[.175,.885,.4,1.1]}}}},uF=n=>{var e;return((e=n.current)==null?void 0:e.ownerDocument)||document},Mk=n=>{var e,i;return((i=(e=n.current)==null?void 0:e.ownerDocument)==null?void 0:i.defaultView)||window};function nVe(n={}){const{openDelay:e=0,closeDelay:i=0,closeOnClick:o=!0,closeOnMouseDown:l,closeOnScroll:u,closeOnPointerDown:p=l,closeOnEsc:y=!0,onOpen:v,onClose:w,placement:C,id:R,isOpen:N,defaultIsOpen:M,arrowSize:L=10,arrowShadowColor:U,arrowPadding:z,modifiers:J,isDisabled:q,gutter:re,offset:ce,direction:ae,...pe}=n,{isOpen:H,onOpen:X,onClose:Q}=od({isOpen:N,defaultIsOpen:M,onOpen:v,onClose:w}),{referenceRef:ne,getPopperProps:he,getArrowInnerProps:fe,getArrowProps:de}=A5({enabled:H,placement:C,arrowPadding:z,modifiers:J,gutter:re,offset:ce,direction:ae}),ke=O.useId(),je=`tooltip-${R??ke}`,Te=O.useRef(null),we=O.useRef(void 0),Ie=O.useCallback(()=>{we.current&&(clearTimeout(we.current),we.current=void 0)},[]),Oe=O.useRef(void 0),ve=O.useCallback(()=>{Oe.current&&(clearTimeout(Oe.current),Oe.current=void 0)},[]),xe=O.useCallback(()=>{ve(),Q()},[Q,ve]),Ge=rVe(Te,xe),Ze=O.useCallback(()=>{if(!q&&!we.current){H&&Ge();const ft=Mk(Te);we.current=ft.setTimeout(X,e)}},[Ge,q,H,X,e]),lt=O.useCallback(()=>{Ie();const ft=Mk(Te);Oe.current=ft.setTimeout(xe,i)},[i,xe,Ie]),vt=O.useCallback(()=>{H&&o&&lt()},[o,lt,H]),nt=O.useCallback(()=>{H&&p&&lt()},[p,lt,H]),mt=O.useCallback(ft=>{H&&ft.key==="Escape"&&lt()},[H,lt]);Vy(()=>uF(Te),"keydown",y?mt:void 0),Vy(()=>{if(!u)return null;const ft=Te.current;if(!ft)return null;const Ct=ree(ft);return Ct.localName==="body"?Mk(Te):Ct},"scroll",()=>{H&&u&&xe()},{passive:!0,capture:!0}),O.useEffect(()=>{q&&(Ie(),H&&Q())},[q,H,Q,Ie]),O.useEffect(()=>()=>{Ie(),ve()},[Ie,ve]),Vy(()=>Te.current,"pointerleave",lt);const et=O.useCallback((ft={},Ct=null)=>({...ft,ref:$i(Te,Ct,ne),onPointerEnter:Un(ft.onPointerEnter,Ft=>{Ft.pointerType!=="touch"&&Ze()}),onClick:Un(ft.onClick,vt),onPointerDown:Un(ft.onPointerDown,nt),onFocus:Un(ft.onFocus,Ze),onBlur:Un(ft.onBlur,lt),"aria-describedby":H?je:void 0}),[Ze,lt,nt,H,je,vt,ne]),St=O.useCallback((ft={},Ct=null)=>he({...ft,style:{...ft.style,[Eo.arrowSize.var]:L?`${L}px`:void 0,[Eo.arrowShadowColor.var]:U}},Ct),[he,L,U]),un=O.useCallback((ft={},Ct=null)=>{const ut={...ft.style,position:"relative",transformOrigin:Eo.transformOrigin.varRef};return{ref:Ct,...pe,...ft,id:je,role:"tooltip",style:ut}},[pe,je]);return{isOpen:H,show:Ze,hide:lt,getTriggerProps:et,getTooltipProps:un,getTooltipPositionerProps:St,getArrowProps:de,getArrowInnerProps:fe}}const $U="chakra-ui:close-tooltip";function rVe(n,e){return O.useEffect(()=>{const i=uF(n);return i.addEventListener($U,e),()=>i.removeEventListener($U,e)},[e,n]),()=>{const i=uF(n),o=Mk(n);i.dispatchEvent(new o.CustomEvent($U))}}const iVe=Ut(Dp.div),Uf=Bt((n,e)=>{const i=cu("Tooltip",n),o=Fi(n),l=YS(),{children:u,label:p,shouldWrapChildren:y,"aria-label":v,hasArrow:w,bg:C,portalProps:R,background:N,backgroundColor:M,bgColor:L,motionProps:U,animatePresenceProps:z,...J}=o,q=N??M??C??L;if(q){i.bg=q;const ne=tSe(l,"colors",q);i[Eo.arrowBg.var]=ne}const re=nVe({...J,direction:l.direction}),ce=!O.isValidElement(u)||y;let ae;if(ce)ae=S.jsx(Ut.span,{display:"inline-block",tabIndex:0,...re.getTriggerProps(),children:u});else{const ne=O.Children.only(u);ae=O.cloneElement(ne,re.getTriggerProps(ne.props,Jre(ne)))}const pe=!!v,H=re.getTooltipProps({},e),X=pe?GS(H,["role","id"]):H,Q=nee(H,["role","id"]);return p?S.jsxs(S.Fragment,{children:[ae,S.jsx($S,{...z,children:re.isOpen&&S.jsx(Nc,{...R,children:S.jsx(Ut.div,{...re.getTooltipPositionerProps(),__css:{zIndex:i.zIndex,pointerEvents:"none"},children:S.jsxs(iVe,{variants:tVe,initial:"exit",animate:"enter",exit:"exit",...U,...X,__css:i,children:[p,pe&&S.jsx(Ut.span,{srOnly:!0,...Q,children:v}),w&&S.jsx(Ut.div,{"data-popper-arrow":!0,className:"chakra-tooltip__arrow-wrapper",children:S.jsx(Ut.div,{"data-popper-arrow-inner":!0,className:"chakra-tooltip__arrow",__css:{bg:i.bg}})})]})})})})]}):S.jsx(S.Fragment,{children:u})});Uf.displayName="Tooltip";const uR=Bt(function(e,i){const o=cu("Heading",e),{className:l,...u}=Fi(e);return S.jsx(Ut.h2,{ref:i,className:yn("chakra-heading",e.className),...u,__css:o})});uR.displayName="Heading";const Ye=Bt(function(e,i){const o=cu("Text",e),{className:l,align:u,decoration:p,casing:y,...v}=Fi(e),w=KO({textAlign:e.align,textDecoration:e.decoration,textTransform:e.casing});return S.jsx(Ut.p,{ref:i,className:yn("chakra-text",e.className),...w,...v,__css:o})});Ye.displayName="Text";const fie=Bt(function(e,i){const{spacing:o="0.5rem",spacingX:l,spacingY:u,children:p,justify:y,direction:v,align:w,className:C,shouldWrapChildren:R,...N}=e,M=O.useMemo(()=>R?O.Children.map(p,(L,U)=>S.jsx(O5,{children:L},U)):p,[p,R]);return S.jsx(Ut.div,{ref:i,className:yn("chakra-wrap",C),...N,children:S.jsx(Ut.ul,{className:"chakra-wrap__list",__css:{display:"flex",flexWrap:"wrap",justifyContent:y,alignItems:w,flexDirection:v,listStyleType:"none",gap:o,columnGap:l,rowGap:u,padding:"0"},children:M})})});fie.displayName="Wrap";const O5=Bt(function(e,i){const{className:o,...l}=e;return S.jsx(Ut.li,{ref:i,__css:{display:"flex",alignItems:"flex-start"},className:yn("chakra-wrap__listitem",o),...l})});O5.displayName="WrapItem";const sVe="modulepreload",oVe=function(n,e){return new URL(n,e).href},sJ={},KU=function(e,i,o){let l=Promise.resolve();if(i&&i.length>0){let p=function(C){return Promise.all(C.map(R=>Promise.resolve(R).then(N=>({status:"fulfilled",value:N}),N=>({status:"rejected",reason:N}))))};const y=document.getElementsByTagName("link"),v=document.querySelector("meta[property=csp-nonce]"),w=(v==null?void 0:v.nonce)||(v==null?void 0:v.getAttribute("nonce"));l=p(i.map(C=>{if(C=oVe(C,o),C in sJ)return;sJ[C]=!0;const R=C.endsWith(".css"),N=R?'[rel="stylesheet"]':"";if(!!o)for(let U=y.length-1;U>=0;U--){const z=y[U];if(z.href===C&&(!R||z.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${C}"]${N}`))return;const L=document.createElement("link");if(L.rel=R?"stylesheet":sVe,R||(L.as="script"),L.crossOrigin="",L.href=C,w&&L.setAttribute("nonce",w),document.head.appendChild(L),R)return new Promise((U,z)=>{L.addEventListener("load",U),L.addEventListener("error",()=>z(new Error(`Unable to preload CSS for ${C}`)))})}))}function u(p){const y=new Event("vite:preloadError",{cancelable:!0});if(y.payload=p,window.dispatchEvent(y),!y.defaultPrevented)throw p}return l.then(p=>{for(const y of p||[])y.status==="rejected"&&u(y.reason);return e().catch(u)})},nk=()=>{const n=new Date,e=n.getHours().toString().padStart(2,"0"),i=n.getMinutes().toString().padStart(2,"0"),o=n.getSeconds().toString().padStart(2,"0"),l=n.getMilliseconds().toString().padStart(3,"0");return`${e}:${i}:${o}.${l}`},K={log:(...n)=>{{const e=n.map((i,o)=>o===0&&typeof i=="string"?`
${i}`:i);console.log(`[LOG] [${nk()}] `,...e)}},error:(...n)=>{{const e=n.map((i,o)=>o===0&&typeof i=="string"?`
${i}`:i);console.error(`[ERROR] [${nk()}] `,...e)}},warn:(...n)=>{{const e=n.map((i,o)=>o===0&&typeof i=="string"?`
${i}`:i);console.warn(`[WARN] [${nk()}]`,...e)}},trace:n=>{console.trace(`[TRACE] [${nk()}] ${n}`)}};async function dR(n){let e;try{switch(n){case"default":e=await KU(()=>import("./index.v0.1.5.js"),[],import.meta.url);break;default:e=await KU(()=>import("./index.v0.1.5.js"),[],import.meta.url)}return e.default}catch(i){return K.error("Failed to load theme:",i),e=await KU(()=>import("./index.v0.1.5.js"),[],import.meta.url),e.default}}const aVe=()=>{};var oJ={};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const mie=function(n){const e=[];let i=0;for(let o=0;o<n.length;o++){let l=n.charCodeAt(o);l<128?e[i++]=l:l<2048?(e[i++]=l>>6|192,e[i++]=l&63|128):(l&64512)===55296&&o+1<n.length&&(n.charCodeAt(o+1)&64512)===56320?(l=65536+((l&1023)<<10)+(n.charCodeAt(++o)&1023),e[i++]=l>>18|240,e[i++]=l>>12&63|128,e[i++]=l>>6&63|128,e[i++]=l&63|128):(e[i++]=l>>12|224,e[i++]=l>>6&63|128,e[i++]=l&63|128)}return e},cVe=function(n){const e=[];let i=0,o=0;for(;i<n.length;){const l=n[i++];if(l<128)e[o++]=String.fromCharCode(l);else if(l>191&&l<224){const u=n[i++];e[o++]=String.fromCharCode((l&31)<<6|u&63)}else if(l>239&&l<365){const u=n[i++],p=n[i++],y=n[i++],v=((l&7)<<18|(u&63)<<12|(p&63)<<6|y&63)-65536;e[o++]=String.fromCharCode(55296+(v>>10)),e[o++]=String.fromCharCode(56320+(v&1023))}else{const u=n[i++],p=n[i++];e[o++]=String.fromCharCode((l&15)<<12|(u&63)<<6|p&63)}}return e.join("")},gie={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:typeof atob=="function",encodeByteArray(n,e){if(!Array.isArray(n))throw Error("encodeByteArray takes an array as a parameter");this.init_();const i=e?this.byteToCharMapWebSafe_:this.byteToCharMap_,o=[];for(let l=0;l<n.length;l+=3){const u=n[l],p=l+1<n.length,y=p?n[l+1]:0,v=l+2<n.length,w=v?n[l+2]:0,C=u>>2,R=(u&3)<<4|y>>4;let N=(y&15)<<2|w>>6,M=w&63;v||(M=64,p||(N=64)),o.push(i[C],i[R],i[N],i[M])}return o.join("")},encodeString(n,e){return this.HAS_NATIVE_SUPPORT&&!e?btoa(n):this.encodeByteArray(mie(n),e)},decodeString(n,e){return this.HAS_NATIVE_SUPPORT&&!e?atob(n):cVe(this.decodeStringToByteArray(n,e))},decodeStringToByteArray(n,e){this.init_();const i=e?this.charToByteMapWebSafe_:this.charToByteMap_,o=[];for(let l=0;l<n.length;){const u=i[n.charAt(l++)],y=l<n.length?i[n.charAt(l)]:0;++l;const w=l<n.length?i[n.charAt(l)]:64;++l;const R=l<n.length?i[n.charAt(l)]:64;if(++l,u==null||y==null||w==null||R==null)throw new lVe;const N=u<<2|y>>4;if(o.push(N),w!==64){const M=y<<4&240|w>>2;if(o.push(M),R!==64){const L=w<<6&192|R;o.push(L)}}}return o},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let n=0;n<this.ENCODED_VALS.length;n++)this.byteToCharMap_[n]=this.ENCODED_VALS.charAt(n),this.charToByteMap_[this.byteToCharMap_[n]]=n,this.byteToCharMapWebSafe_[n]=this.ENCODED_VALS_WEBSAFE.charAt(n),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[n]]=n,n>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(n)]=n,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(n)]=n)}}};class lVe extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}const uVe=function(n){const e=mie(n);return gie.encodeByteArray(e,!0)},fO=function(n){return uVe(n).replace(/\./g,"")},_ie=function(n){try{return gie.decodeString(n,!0)}catch(e){console.error("base64Decode failed: ",e)}return null};/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function dVe(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("Unable to locate global object.")}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const hVe=()=>dVe().__FIREBASE_DEFAULTS__,pVe=()=>{if(typeof process>"u"||typeof oJ>"u")return;const n=oJ.__FIREBASE_DEFAULTS__;if(n)return JSON.parse(n)},fVe=()=>{if(typeof document>"u")return;let n;try{n=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch{return}const e=n&&_ie(n[1]);return e&&JSON.parse(e)},bN=()=>{try{return aVe()||hVe()||pVe()||fVe()}catch(n){console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${n}`);return}},yie=n=>{var e,i;return(i=(e=bN())===null||e===void 0?void 0:e.emulatorHosts)===null||i===void 0?void 0:i[n]},N5=n=>{const e=yie(n);if(!e)return;const i=e.lastIndexOf(":");if(i<=0||i+1===e.length)throw new Error(`Invalid host ${e} with no separate hostname and port!`);const o=parseInt(e.substring(i+1),10);return e[0]==="["?[e.substring(1,i-1),o]:[e.substring(0,i),o]},Eie=()=>{var n;return(n=bN())===null||n===void 0?void 0:n.config},vie=n=>{var e;return(e=bN())===null||e===void 0?void 0:e[`_${n}`]};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class mVe{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((e,i)=>{this.resolve=e,this.reject=i})}wrapCallback(e){return(i,o)=>{i?this.reject(i):this.resolve(o),typeof e=="function"&&(this.promise.catch(()=>{}),e.length===1?e(i):e(i,o))}}}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Sie(n,e){if(n.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');const i={alg:"none",type:"JWT"},o=e||"demo-project",l=n.iat||0,u=n.sub||n.user_id;if(!u)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");const p=Object.assign({iss:`https://securetoken.google.com/${o}`,aud:o,iat:l,exp:l+3600,auth_time:l,sub:u,user_id:u,firebase:{sign_in_provider:"custom",identities:{}}},n);return[fO(JSON.stringify(i)),fO(JSON.stringify(p)),""].join(".")}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function cc(){return typeof navigator<"u"&&typeof navigator.userAgent=="string"?navigator.userAgent:""}function gVe(){return typeof window<"u"&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(cc())}function _Ve(){var n;const e=(n=bN())===null||n===void 0?void 0:n.forceEnvironment;if(e==="node")return!0;if(e==="browser")return!1;try{return Object.prototype.toString.call(global.process)==="[object process]"}catch{return!1}}function yVe(){return typeof navigator<"u"&&navigator.userAgent==="Cloudflare-Workers"}function EVe(){const n=typeof chrome=="object"?chrome.runtime:typeof browser=="object"?browser.runtime:void 0;return typeof n=="object"&&n.id!==void 0}function vVe(){return typeof navigator=="object"&&navigator.product==="ReactNative"}function SVe(){const n=cc();return n.indexOf("MSIE ")>=0||n.indexOf("Trident/")>=0}function bVe(){return!_Ve()&&!!navigator.userAgent&&navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome")}function wVe(){try{return typeof indexedDB=="object"}catch{return!1}}function TVe(){return new Promise((n,e)=>{try{let i=!0;const o="validate-browser-context-for-indexeddb-analytics-module",l=self.indexedDB.open(o);l.onsuccess=()=>{l.result.close(),i||self.indexedDB.deleteDatabase(o),n(!0)},l.onupgradeneeded=()=>{i=!1},l.onerror=()=>{var u;e(((u=l.error)===null||u===void 0?void 0:u.message)||"")}}catch(i){e(i)}})}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const CVe="FirebaseError";class ph extends Error{constructor(e,i,o){super(i),this.code=e,this.customData=o,this.name=CVe,Object.setPrototypeOf(this,ph.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,BR.prototype.create)}}class BR{constructor(e,i,o){this.service=e,this.serviceName=i,this.errors=o}create(e,...i){const o=i[0]||{},l=`${this.service}/${e}`,u=this.errors[e],p=u?RVe(u,o):"Error",y=`${this.serviceName}: ${p} (${l}).`;return new ph(l,y,o)}}function RVe(n,e){return n.replace(IVe,(i,o)=>{const l=e[o];return l!=null?String(l):`<${o}?>`})}const IVe=/\{\$([^}]+)}/g;function AVe(n){for(const e in n)if(Object.prototype.hasOwnProperty.call(n,e))return!1;return!0}function Gf(n,e){if(n===e)return!0;const i=Object.keys(n),o=Object.keys(e);for(const l of i){if(!o.includes(l))return!1;const u=n[l],p=e[l];if(aJ(u)&&aJ(p)){if(!Gf(u,p))return!1}else if(u!==p)return!1}for(const l of o)if(!i.includes(l))return!1;return!0}function aJ(n){return n!==null&&typeof n=="object"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function zR(n){const e=[];for(const[i,o]of Object.entries(n))Array.isArray(o)?o.forEach(l=>{e.push(encodeURIComponent(i)+"="+encodeURIComponent(l))}):e.push(encodeURIComponent(i)+"="+encodeURIComponent(o));return e.length?"&"+e.join("&"):""}function mC(n){const e={};return n.replace(/^\?/,"").split("&").forEach(o=>{if(o){const[l,u]=o.split("=");e[decodeURIComponent(l)]=decodeURIComponent(u)}}),e}function gC(n){const e=n.indexOf("?");if(!e)return"";const i=n.indexOf("#",e);return n.substring(e,i>0?i:void 0)}function PVe(n,e){const i=new kVe(n,e);return i.subscribe.bind(i)}class kVe{constructor(e,i){this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=i,this.task.then(()=>{e(this)}).catch(o=>{this.error(o)})}next(e){this.forEachObserver(i=>{i.next(e)})}error(e){this.forEachObserver(i=>{i.error(e)}),this.close(e)}complete(){this.forEachObserver(e=>{e.complete()}),this.close()}subscribe(e,i,o){let l;if(e===void 0&&i===void 0&&o===void 0)throw new Error("Missing Observer.");OVe(e,["next","error","complete"])?l=e:l={next:e,error:i,complete:o},l.next===void 0&&(l.next=qU),l.error===void 0&&(l.error=qU),l.complete===void 0&&(l.complete=qU);const u=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then(()=>{try{this.finalError?l.error(this.finalError):l.complete()}catch{}}),this.observers.push(l),u}unsubscribeOne(e){this.observers===void 0||this.observers[e]===void 0||(delete this.observers[e],this.observerCount-=1,this.observerCount===0&&this.onNoObservers!==void 0&&this.onNoObservers(this))}forEachObserver(e){if(!this.finalized)for(let i=0;i<this.observers.length;i++)this.sendOne(i,e)}sendOne(e,i){this.task.then(()=>{if(this.observers!==void 0&&this.observers[e]!==void 0)try{i(this.observers[e])}catch(o){typeof console<"u"&&console.error&&console.error(o)}})}close(e){this.finalized||(this.finalized=!0,e!==void 0&&(this.finalError=e),this.task.then(()=>{this.observers=void 0,this.onNoObservers=void 0}))}}function OVe(n,e){if(typeof n!="object"||n===null)return!1;for(const i of e)if(i in n&&typeof n[i]=="function")return!0;return!1}function qU(){}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Pi(n){return n&&n._delegate?n._delegate:n}class Hf{constructor(e,i,o){this.name=e,this.instanceFactory=i,this.type=o,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(e){return this.instantiationMode=e,this}setMultipleInstances(e){return this.multipleInstances=e,this}setServiceProps(e){return this.serviceProps=e,this}setInstanceCreatedCallback(e){return this.onInstanceCreated=e,this}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ay="[DEFAULT]";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class NVe{constructor(e,i){this.name=e,this.container=i,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(e){const i=this.normalizeInstanceIdentifier(e);if(!this.instancesDeferred.has(i)){const o=new mVe;if(this.instancesDeferred.set(i,o),this.isInitialized(i)||this.shouldAutoInitialize())try{const l=this.getOrInitializeService({instanceIdentifier:i});l&&o.resolve(l)}catch{}}return this.instancesDeferred.get(i).promise}getImmediate(e){var i;const o=this.normalizeInstanceIdentifier(e==null?void 0:e.identifier),l=(i=e==null?void 0:e.optional)!==null&&i!==void 0?i:!1;if(this.isInitialized(o)||this.shouldAutoInitialize())try{return this.getOrInitializeService({instanceIdentifier:o})}catch(u){if(l)return null;throw u}else{if(l)return null;throw Error(`Service ${this.name} is not available`)}}getComponent(){return this.component}setComponent(e){if(e.name!==this.name)throw Error(`Mismatching Component ${e.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=e,!!this.shouldAutoInitialize()){if(xVe(e))try{this.getOrInitializeService({instanceIdentifier:Ay})}catch{}for(const[i,o]of this.instancesDeferred.entries()){const l=this.normalizeInstanceIdentifier(i);try{const u=this.getOrInitializeService({instanceIdentifier:l});o.resolve(u)}catch{}}}}clearInstance(e=Ay){this.instancesDeferred.delete(e),this.instancesOptions.delete(e),this.instances.delete(e)}async delete(){const e=Array.from(this.instances.values());await Promise.all([...e.filter(i=>"INTERNAL"in i).map(i=>i.INTERNAL.delete()),...e.filter(i=>"_delete"in i).map(i=>i._delete())])}isComponentSet(){return this.component!=null}isInitialized(e=Ay){return this.instances.has(e)}getOptions(e=Ay){return this.instancesOptions.get(e)||{}}initialize(e={}){const{options:i={}}=e,o=this.normalizeInstanceIdentifier(e.instanceIdentifier);if(this.isInitialized(o))throw Error(`${this.name}(${o}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);const l=this.getOrInitializeService({instanceIdentifier:o,options:i});for(const[u,p]of this.instancesDeferred.entries()){const y=this.normalizeInstanceIdentifier(u);o===y&&p.resolve(l)}return l}onInit(e,i){var o;const l=this.normalizeInstanceIdentifier(i),u=(o=this.onInitCallbacks.get(l))!==null&&o!==void 0?o:new Set;u.add(e),this.onInitCallbacks.set(l,u);const p=this.instances.get(l);return p&&e(p,l),()=>{u.delete(e)}}invokeOnInitCallbacks(e,i){const o=this.onInitCallbacks.get(i);if(o)for(const l of o)try{l(e,i)}catch{}}getOrInitializeService({instanceIdentifier:e,options:i={}}){let o=this.instances.get(e);if(!o&&this.component&&(o=this.component.instanceFactory(this.container,{instanceIdentifier:DVe(e),options:i}),this.instances.set(e,o),this.instancesOptions.set(e,i),this.invokeOnInitCallbacks(o,e),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,e,o)}catch{}return o||null}normalizeInstanceIdentifier(e=Ay){return this.component?this.component.multipleInstances?e:Ay:e}shouldAutoInitialize(){return!!this.component&&this.component.instantiationMode!=="EXPLICIT"}}function DVe(n){return n===Ay?void 0:n}function xVe(n){return n.instantiationMode==="EAGER"}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class LVe{constructor(e){this.name=e,this.providers=new Map}addComponent(e){const i=this.getProvider(e.name);if(i.isComponentSet())throw new Error(`Component ${e.name} has already been registered with ${this.name}`);i.setComponent(e)}addOrOverwriteComponent(e){this.getProvider(e.name).isComponentSet()&&this.providers.delete(e.name),this.addComponent(e)}getProvider(e){if(this.providers.has(e))return this.providers.get(e);const i=new NVe(e,this);return this.providers.set(e,i),i}getProviders(){return Array.from(this.providers.values())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Gr;(function(n){n[n.DEBUG=0]="DEBUG",n[n.VERBOSE=1]="VERBOSE",n[n.INFO=2]="INFO",n[n.WARN=3]="WARN",n[n.ERROR=4]="ERROR",n[n.SILENT=5]="SILENT"})(Gr||(Gr={}));const MVe={debug:Gr.DEBUG,verbose:Gr.VERBOSE,info:Gr.INFO,warn:Gr.WARN,error:Gr.ERROR,silent:Gr.SILENT},UVe=Gr.INFO,VVe={[Gr.DEBUG]:"log",[Gr.VERBOSE]:"log",[Gr.INFO]:"info",[Gr.WARN]:"warn",[Gr.ERROR]:"error"},FVe=(n,e,...i)=>{if(e<n.logLevel)return;const o=new Date().toISOString(),l=VVe[e];if(l)console[l](`[${o}]  ${n.name}:`,...i);else throw new Error(`Attempted to log a message with an invalid logType (value: ${e})`)};class D5{constructor(e){this.name=e,this._logLevel=UVe,this._logHandler=FVe,this._userLogHandler=null}get logLevel(){return this._logLevel}set logLevel(e){if(!(e in Gr))throw new TypeError(`Invalid value "${e}" assigned to \`logLevel\``);this._logLevel=e}setLogLevel(e){this._logLevel=typeof e=="string"?MVe[e]:e}get logHandler(){return this._logHandler}set logHandler(e){if(typeof e!="function")throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e}get userLogHandler(){return this._userLogHandler}set userLogHandler(e){this._userLogHandler=e}debug(...e){this._userLogHandler&&this._userLogHandler(this,Gr.DEBUG,...e),this._logHandler(this,Gr.DEBUG,...e)}log(...e){this._userLogHandler&&this._userLogHandler(this,Gr.VERBOSE,...e),this._logHandler(this,Gr.VERBOSE,...e)}info(...e){this._userLogHandler&&this._userLogHandler(this,Gr.INFO,...e),this._logHandler(this,Gr.INFO,...e)}warn(...e){this._userLogHandler&&this._userLogHandler(this,Gr.WARN,...e),this._logHandler(this,Gr.WARN,...e)}error(...e){this._userLogHandler&&this._userLogHandler(this,Gr.ERROR,...e),this._logHandler(this,Gr.ERROR,...e)}}const jVe=(n,e)=>e.some(i=>n instanceof i);let cJ,lJ;function BVe(){return cJ||(cJ=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function zVe(){return lJ||(lJ=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}const bie=new WeakMap,dF=new WeakMap,wie=new WeakMap,YU=new WeakMap,x5=new WeakMap;function WVe(n){const e=new Promise((i,o)=>{const l=()=>{n.removeEventListener("success",u),n.removeEventListener("error",p)},u=()=>{i(kg(n.result)),l()},p=()=>{o(n.error),l()};n.addEventListener("success",u),n.addEventListener("error",p)});return e.then(i=>{i instanceof IDBCursor&&bie.set(i,n)}).catch(()=>{}),x5.set(e,n),e}function GVe(n){if(dF.has(n))return;const e=new Promise((i,o)=>{const l=()=>{n.removeEventListener("complete",u),n.removeEventListener("error",p),n.removeEventListener("abort",p)},u=()=>{i(),l()},p=()=>{o(n.error||new DOMException("AbortError","AbortError")),l()};n.addEventListener("complete",u),n.addEventListener("error",p),n.addEventListener("abort",p)});dF.set(n,e)}let hF={get(n,e,i){if(n instanceof IDBTransaction){if(e==="done")return dF.get(n);if(e==="objectStoreNames")return n.objectStoreNames||wie.get(n);if(e==="store")return i.objectStoreNames[1]?void 0:i.objectStore(i.objectStoreNames[0])}return kg(n[e])},set(n,e,i){return n[e]=i,!0},has(n,e){return n instanceof IDBTransaction&&(e==="done"||e==="store")?!0:e in n}};function HVe(n){hF=n(hF)}function $Ve(n){return n===IDBDatabase.prototype.transaction&&!("objectStoreNames"in IDBTransaction.prototype)?function(e,...i){const o=n.call(XU(this),e,...i);return wie.set(o,e.sort?e.sort():[e]),kg(o)}:zVe().includes(n)?function(...e){return n.apply(XU(this),e),kg(bie.get(this))}:function(...e){return kg(n.apply(XU(this),e))}}function KVe(n){return typeof n=="function"?$Ve(n):(n instanceof IDBTransaction&&GVe(n),jVe(n,BVe())?new Proxy(n,hF):n)}function kg(n){if(n instanceof IDBRequest)return WVe(n);if(YU.has(n))return YU.get(n);const e=KVe(n);return e!==n&&(YU.set(n,e),x5.set(e,n)),e}const XU=n=>x5.get(n);function qVe(n,e,{blocked:i,upgrade:o,blocking:l,terminated:u}={}){const p=indexedDB.open(n,e),y=kg(p);return o&&p.addEventListener("upgradeneeded",v=>{o(kg(p.result),v.oldVersion,v.newVersion,kg(p.transaction),v)}),i&&p.addEventListener("blocked",v=>i(v.oldVersion,v.newVersion,v)),y.then(v=>{u&&v.addEventListener("close",()=>u()),l&&v.addEventListener("versionchange",w=>l(w.oldVersion,w.newVersion,w))}).catch(()=>{}),y}const YVe=["get","getKey","getAll","getAllKeys","count"],XVe=["put","add","delete","clear"],JU=new Map;function uJ(n,e){if(!(n instanceof IDBDatabase&&!(e in n)&&typeof e=="string"))return;if(JU.get(e))return JU.get(e);const i=e.replace(/FromIndex$/,""),o=e!==i,l=XVe.includes(i);if(!(i in(o?IDBIndex:IDBObjectStore).prototype)||!(l||YVe.includes(i)))return;const u=async function(p,...y){const v=this.transaction(p,l?"readwrite":"readonly");let w=v.store;return o&&(w=w.index(y.shift())),(await Promise.all([w[i](...y),l&&v.done]))[0]};return JU.set(e,u),u}HVe(n=>({...n,get:(e,i,o)=>uJ(e,i)||n.get(e,i,o),has:(e,i)=>!!uJ(e,i)||n.has(e,i)}));/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class JVe{constructor(e){this.container=e}getPlatformInfoString(){return this.container.getProviders().map(i=>{if(QVe(i)){const o=i.getImmediate();return`${o.library}/${o.version}`}else return null}).filter(i=>i).join(" ")}}function QVe(n){const e=n.getComponent();return(e==null?void 0:e.type)==="VERSION"}const pF="@firebase/app",dJ="0.11.3";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const $f=new D5("@firebase/app"),ZVe="@firebase/app-compat",eFe="@firebase/analytics-compat",tFe="@firebase/analytics",nFe="@firebase/app-check-compat",rFe="@firebase/app-check",iFe="@firebase/auth",sFe="@firebase/auth-compat",oFe="@firebase/database",aFe="@firebase/data-connect",cFe="@firebase/database-compat",lFe="@firebase/functions",uFe="@firebase/functions-compat",dFe="@firebase/installations",hFe="@firebase/installations-compat",pFe="@firebase/messaging",fFe="@firebase/messaging-compat",mFe="@firebase/performance",gFe="@firebase/performance-compat",_Fe="@firebase/remote-config",yFe="@firebase/remote-config-compat",EFe="@firebase/storage",vFe="@firebase/storage-compat",SFe="@firebase/firestore",bFe="@firebase/vertexai",wFe="@firebase/firestore-compat",TFe="firebase",CFe="11.5.0";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const fF="[DEFAULT]",RFe={[pF]:"fire-core",[ZVe]:"fire-core-compat",[tFe]:"fire-analytics",[eFe]:"fire-analytics-compat",[rFe]:"fire-app-check",[nFe]:"fire-app-check-compat",[iFe]:"fire-auth",[sFe]:"fire-auth-compat",[oFe]:"fire-rtdb",[aFe]:"fire-data-connect",[cFe]:"fire-rtdb-compat",[lFe]:"fire-fn",[uFe]:"fire-fn-compat",[dFe]:"fire-iid",[hFe]:"fire-iid-compat",[pFe]:"fire-fcm",[fFe]:"fire-fcm-compat",[mFe]:"fire-perf",[gFe]:"fire-perf-compat",[_Fe]:"fire-rc",[yFe]:"fire-rc-compat",[EFe]:"fire-gcs",[vFe]:"fire-gcs-compat",[SFe]:"fire-fst",[wFe]:"fire-fst-compat",[bFe]:"fire-vertex","fire-js":"fire-js",[TFe]:"fire-js-all"};/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const mO=new Map,IFe=new Map,mF=new Map;function hJ(n,e){try{n.container.addComponent(e)}catch(i){$f.debug(`Component ${e.name} failed to register with FirebaseApp ${n.name}`,i)}}function Vg(n){const e=n.name;if(mF.has(e))return $f.debug(`There were multiple attempts to register component ${e}.`),!1;mF.set(e,n);for(const i of mO.values())hJ(i,n);for(const i of IFe.values())hJ(i,n);return!0}function WR(n,e){const i=n.container.getProvider("heartbeat").getImmediate({optional:!0});return i&&i.triggerHeartbeat(),n.container.getProvider(e)}function dl(n){return n==null?!1:n.settings!==void 0}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const AFe={"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}'","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","server-app-deleted":"Firebase Server App has been deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}.","finalization-registry-not-supported":"FirebaseServerApp deleteOnDeref field defined but the JS runtime does not support FinalizationRegistry.","invalid-server-app-environment":"FirebaseServerApp is not for use in browser environments."},Og=new BR("app","Firebase",AFe);/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class PFe{constructor(e,i,o){this._isDeleted=!1,this._options=Object.assign({},e),this._config=Object.assign({},i),this._name=i.name,this._automaticDataCollectionEnabled=i.automaticDataCollectionEnabled,this._container=o,this.container.addComponent(new Hf("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this.checkDestroyed(),this._automaticDataCollectionEnabled=e}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(e){this._isDeleted=e}checkDestroyed(){if(this.isDeleted)throw Og.create("app-deleted",{appName:this._name})}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const uE=CFe;function Tie(n,e={}){let i=n;typeof e!="object"&&(e={name:e});const o=Object.assign({name:fF,automaticDataCollectionEnabled:!1},e),l=o.name;if(typeof l!="string"||!l)throw Og.create("bad-app-name",{appName:String(l)});if(i||(i=Eie()),!i)throw Og.create("no-options");const u=mO.get(l);if(u){if(Gf(i,u.options)&&Gf(o,u.config))return u;throw Og.create("duplicate-app",{appName:l})}const p=new LVe(l);for(const v of mF.values())p.addComponent(v);const y=new PFe(i,o,p);return mO.set(l,y),y}function wN(n=fF){const e=mO.get(n);if(!e&&n===fF&&Eie())return Tie();if(!e)throw Og.create("no-app",{appName:n});return e}function nd(n,e,i){var o;let l=(o=RFe[n])!==null&&o!==void 0?o:n;i&&(l+=`-${i}`);const u=l.match(/\s|\//),p=e.match(/\s|\//);if(u||p){const y=[`Unable to register library "${l}" with version "${e}":`];u&&y.push(`library name "${l}" contains illegal characters (whitespace or "/")`),u&&p&&y.push("and"),p&&y.push(`version name "${e}" contains illegal characters (whitespace or "/")`),$f.warn(y.join(" "));return}Vg(new Hf(`${l}-version`,()=>({library:l,version:e}),"VERSION"))}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const kFe="firebase-heartbeat-database",OFe=1,hR="firebase-heartbeat-store";let QU=null;function Cie(){return QU||(QU=qVe(kFe,OFe,{upgrade:(n,e)=>{switch(e){case 0:try{n.createObjectStore(hR)}catch(i){console.warn(i)}}}}).catch(n=>{throw Og.create("idb-open",{originalErrorMessage:n.message})})),QU}async function NFe(n){try{const i=(await Cie()).transaction(hR),o=await i.objectStore(hR).get(Rie(n));return await i.done,o}catch(e){if(e instanceof ph)$f.warn(e.message);else{const i=Og.create("idb-get",{originalErrorMessage:e==null?void 0:e.message});$f.warn(i.message)}}}async function pJ(n,e){try{const o=(await Cie()).transaction(hR,"readwrite");await o.objectStore(hR).put(e,Rie(n)),await o.done}catch(i){if(i instanceof ph)$f.warn(i.message);else{const o=Og.create("idb-set",{originalErrorMessage:i==null?void 0:i.message});$f.warn(o.message)}}}function Rie(n){return`${n.name}!${n.options.appId}`}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const DFe=1024,xFe=30;class LFe{constructor(e){this.container=e,this._heartbeatsCache=null;const i=this.container.getProvider("app").getImmediate();this._storage=new UFe(i),this._heartbeatsCachePromise=this._storage.read().then(o=>(this._heartbeatsCache=o,o))}async triggerHeartbeat(){var e,i;try{const l=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),u=fJ();if(((e=this._heartbeatsCache)===null||e===void 0?void 0:e.heartbeats)==null&&(this._heartbeatsCache=await this._heartbeatsCachePromise,((i=this._heartbeatsCache)===null||i===void 0?void 0:i.heartbeats)==null)||this._heartbeatsCache.lastSentHeartbeatDate===u||this._heartbeatsCache.heartbeats.some(p=>p.date===u))return;if(this._heartbeatsCache.heartbeats.push({date:u,agent:l}),this._heartbeatsCache.heartbeats.length>xFe){const p=VFe(this._heartbeatsCache.heartbeats);this._heartbeatsCache.heartbeats.splice(p,1)}return this._storage.overwrite(this._heartbeatsCache)}catch(o){$f.warn(o)}}async getHeartbeatsHeader(){var e;try{if(this._heartbeatsCache===null&&await this._heartbeatsCachePromise,((e=this._heartbeatsCache)===null||e===void 0?void 0:e.heartbeats)==null||this._heartbeatsCache.heartbeats.length===0)return"";const i=fJ(),{heartbeatsToSend:o,unsentEntries:l}=MFe(this._heartbeatsCache.heartbeats),u=fO(JSON.stringify({version:2,heartbeats:o}));return this._heartbeatsCache.lastSentHeartbeatDate=i,l.length>0?(this._heartbeatsCache.heartbeats=l,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),u}catch(i){return $f.warn(i),""}}}function fJ(){return new Date().toISOString().substring(0,10)}function MFe(n,e=DFe){const i=[];let o=n.slice();for(const l of n){const u=i.find(p=>p.agent===l.agent);if(u){if(u.dates.push(l.date),mJ(i)>e){u.dates.pop();break}}else if(i.push({agent:l.agent,dates:[l.date]}),mJ(i)>e){i.pop();break}o=o.slice(1)}return{heartbeatsToSend:i,unsentEntries:o}}class UFe{constructor(e){this.app=e,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return wVe()?TVe().then(()=>!0).catch(()=>!1):!1}async read(){if(await this._canUseIndexedDBPromise){const i=await NFe(this.app);return i!=null&&i.heartbeats?i:{heartbeats:[]}}else return{heartbeats:[]}}async overwrite(e){var i;if(await this._canUseIndexedDBPromise){const l=await this.read();return pJ(this.app,{lastSentHeartbeatDate:(i=e.lastSentHeartbeatDate)!==null&&i!==void 0?i:l.lastSentHeartbeatDate,heartbeats:e.heartbeats})}else return}async add(e){var i;if(await this._canUseIndexedDBPromise){const l=await this.read();return pJ(this.app,{lastSentHeartbeatDate:(i=e.lastSentHeartbeatDate)!==null&&i!==void 0?i:l.lastSentHeartbeatDate,heartbeats:[...l.heartbeats,...e.heartbeats]})}else return}}function mJ(n){return fO(JSON.stringify({version:2,heartbeats:n})).length}function VFe(n){if(n.length===0)return-1;let e=0,i=n[0].date;for(let o=1;o<n.length;o++)n[o].date<i&&(i=n[o].date,e=o);return e}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function FFe(n){Vg(new Hf("platform-logger",e=>new JVe(e),"PRIVATE")),Vg(new Hf("heartbeat",e=>new LFe(e),"PRIVATE")),nd(pF,dJ,n),nd(pF,dJ,"esm2017"),nd("fire-js","")}FFe("");function Iie(){return{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}}const jFe=Iie,Aie=new BR("auth","Firebase",Iie());/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const gO=new D5("@firebase/auth");function BFe(n,...e){gO.logLevel<=Gr.WARN&&gO.warn(`Auth (${uE}): ${n}`,...e)}function Uk(n,...e){gO.logLevel<=Gr.ERROR&&gO.error(`Auth (${uE}): ${n}`,...e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function dh(n,...e){throw L5(n,...e)}function Ip(n,...e){return L5(n,...e)}function Pie(n,e,i){const o=Object.assign(Object.assign({},jFe()),{[e]:i});return new BR("auth","Firebase",o).create(e,{appName:n.name})}function Vf(n){return Pie(n,"operation-not-supported-in-this-environment","Operations that alter the current user are not supported in conjunction with FirebaseServerApp")}function L5(n,...e){if(typeof n!="string"){const i=e[0],o=[...e.slice(1)];return o[0]&&(o[0].appName=n.name),n._errorFactory.create(i,...o)}return Aie.create(n,...e)}function qn(n,e,...i){if(!n)throw L5(e,...i)}function Pf(n){const e="INTERNAL ASSERTION FAILED: "+n;throw Uk(e),new Error(e)}function Kf(n,e){n||Pf(e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function gF(){var n;return typeof self<"u"&&((n=self.location)===null||n===void 0?void 0:n.href)||""}function zFe(){return gJ()==="http:"||gJ()==="https:"}function gJ(){var n;return typeof self<"u"&&((n=self.location)===null||n===void 0?void 0:n.protocol)||null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function WFe(){return typeof navigator<"u"&&navigator&&"onLine"in navigator&&typeof navigator.onLine=="boolean"&&(zFe()||EVe()||"connection"in navigator)?navigator.onLine:!0}function GFe(){if(typeof navigator>"u")return null;const n=navigator;return n.languages&&n.languages[0]||n.language||null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class GR{constructor(e,i){this.shortDelay=e,this.longDelay=i,Kf(i>e,"Short delay should be less than long delay!"),this.isMobile=gVe()||vVe()}get(){return WFe()?this.isMobile?this.longDelay:this.shortDelay:Math.min(5e3,this.shortDelay)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function M5(n,e){Kf(n.emulator,"Emulator should always be set here");const{url:i}=n.emulator;return e?`${i}${e.startsWith("/")?e.slice(1):e}`:i}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class kie{static initialize(e,i,o){this.fetchImpl=e,i&&(this.headersImpl=i),o&&(this.responseImpl=o)}static fetch(){if(this.fetchImpl)return this.fetchImpl;if(typeof self<"u"&&"fetch"in self)return self.fetch;if(typeof globalThis<"u"&&globalThis.fetch)return globalThis.fetch;if(typeof fetch<"u")return fetch;Pf("Could not find fetch implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static headers(){if(this.headersImpl)return this.headersImpl;if(typeof self<"u"&&"Headers"in self)return self.Headers;if(typeof globalThis<"u"&&globalThis.Headers)return globalThis.Headers;if(typeof Headers<"u")return Headers;Pf("Could not find Headers implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static response(){if(this.responseImpl)return this.responseImpl;if(typeof self<"u"&&"Response"in self)return self.Response;if(typeof globalThis<"u"&&globalThis.Response)return globalThis.Response;if(typeof Response<"u")return Response;Pf("Could not find Response implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const HFe={CREDENTIAL_MISMATCH:"custom-token-mismatch",MISSING_CUSTOM_TOKEN:"internal-error",INVALID_IDENTIFIER:"invalid-email",MISSING_CONTINUE_URI:"internal-error",INVALID_PASSWORD:"wrong-password",MISSING_PASSWORD:"missing-password",INVALID_LOGIN_CREDENTIALS:"invalid-credential",EMAIL_EXISTS:"email-already-in-use",PASSWORD_LOGIN_DISABLED:"operation-not-allowed",INVALID_IDP_RESPONSE:"invalid-credential",INVALID_PENDING_TOKEN:"invalid-credential",FEDERATED_USER_ID_ALREADY_LINKED:"credential-already-in-use",MISSING_REQ_TYPE:"internal-error",EMAIL_NOT_FOUND:"user-not-found",RESET_PASSWORD_EXCEED_LIMIT:"too-many-requests",EXPIRED_OOB_CODE:"expired-action-code",INVALID_OOB_CODE:"invalid-action-code",MISSING_OOB_CODE:"internal-error",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"requires-recent-login",INVALID_ID_TOKEN:"invalid-user-token",TOKEN_EXPIRED:"user-token-expired",USER_NOT_FOUND:"user-token-expired",TOO_MANY_ATTEMPTS_TRY_LATER:"too-many-requests",PASSWORD_DOES_NOT_MEET_REQUIREMENTS:"password-does-not-meet-requirements",INVALID_CODE:"invalid-verification-code",INVALID_SESSION_INFO:"invalid-verification-id",INVALID_TEMPORARY_PROOF:"invalid-credential",MISSING_SESSION_INFO:"missing-verification-id",SESSION_EXPIRED:"code-expired",MISSING_ANDROID_PACKAGE_NAME:"missing-android-pkg-name",UNAUTHORIZED_DOMAIN:"unauthorized-continue-uri",INVALID_OAUTH_CLIENT_ID:"invalid-oauth-client-id",ADMIN_ONLY_OPERATION:"admin-restricted-operation",INVALID_MFA_PENDING_CREDENTIAL:"invalid-multi-factor-session",MFA_ENROLLMENT_NOT_FOUND:"multi-factor-info-not-found",MISSING_MFA_ENROLLMENT_ID:"missing-multi-factor-info",MISSING_MFA_PENDING_CREDENTIAL:"missing-multi-factor-session",SECOND_FACTOR_EXISTS:"second-factor-already-in-use",SECOND_FACTOR_LIMIT_EXCEEDED:"maximum-second-factor-count-exceeded",BLOCKING_FUNCTION_ERROR_RESPONSE:"internal-error",RECAPTCHA_NOT_ENABLED:"recaptcha-not-enabled",MISSING_RECAPTCHA_TOKEN:"missing-recaptcha-token",INVALID_RECAPTCHA_TOKEN:"invalid-recaptcha-token",INVALID_RECAPTCHA_ACTION:"invalid-recaptcha-action",MISSING_CLIENT_TYPE:"missing-client-type",MISSING_RECAPTCHA_VERSION:"missing-recaptcha-version",INVALID_RECAPTCHA_VERSION:"invalid-recaptcha-version",INVALID_REQ_TYPE:"invalid-req-type"};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const $Fe=new GR(3e4,6e4);function Qf(n,e){return n.tenantId&&!e.tenantId?Object.assign(Object.assign({},e),{tenantId:n.tenantId}):e}async function Zf(n,e,i,o,l={}){return Oie(n,l,async()=>{let u={},p={};o&&(e==="GET"?p=o:u={body:JSON.stringify(o)});const y=zR(Object.assign({key:n.config.apiKey},p)).slice(1),v=await n._getAdditionalHeaders();v["Content-Type"]="application/json",n.languageCode&&(v["X-Firebase-Locale"]=n.languageCode);const w=Object.assign({method:e,headers:v},u);return yVe()||(w.referrerPolicy="no-referrer"),kie.fetch()(Nie(n,n.config.apiHost,i,y),w)})}async function Oie(n,e,i){n._canInitEmulator=!1;const o=Object.assign(Object.assign({},HFe),e);try{const l=new qFe(n),u=await Promise.race([i(),l.promise]);l.clearNetworkTimeout();const p=await u.json();if("needConfirmation"in p)throw rk(n,"account-exists-with-different-credential",p);if(u.ok&&!("errorMessage"in p))return p;{const y=u.ok?p.errorMessage:p.error.message,[v,w]=y.split(" : ");if(v==="FEDERATED_USER_ID_ALREADY_LINKED")throw rk(n,"credential-already-in-use",p);if(v==="EMAIL_EXISTS")throw rk(n,"email-already-in-use",p);if(v==="USER_DISABLED")throw rk(n,"user-disabled",p);const C=o[v]||v.toLowerCase().replace(/[_\s]+/g,"-");if(w)throw Pie(n,C,w);dh(n,C)}}catch(l){if(l instanceof ph)throw l;dh(n,"network-request-failed",{message:String(l)})}}async function HR(n,e,i,o,l={}){const u=await Zf(n,e,i,o,l);return"mfaPendingCredential"in u&&dh(n,"multi-factor-auth-required",{_serverResponse:u}),u}function Nie(n,e,i,o){const l=`${e}${i}?${o}`;return n.config.emulator?M5(n.config,l):`${n.config.apiScheme}://${l}`}function KFe(n){switch(n){case"ENFORCE":return"ENFORCE";case"AUDIT":return"AUDIT";case"OFF":return"OFF";default:return"ENFORCEMENT_STATE_UNSPECIFIED"}}class qFe{clearNetworkTimeout(){clearTimeout(this.timer)}constructor(e){this.auth=e,this.timer=null,this.promise=new Promise((i,o)=>{this.timer=setTimeout(()=>o(Ip(this.auth,"network-request-failed")),$Fe.get())})}}function rk(n,e,i){const o={appName:n.name};i.email&&(o.email=i.email),i.phoneNumber&&(o.phoneNumber=i.phoneNumber);const l=Ip(n,e,o);return l.customData._tokenResponse=i,l}function _J(n){return n!==void 0&&n.enterprise!==void 0}class YFe{constructor(e){if(this.siteKey="",this.recaptchaEnforcementState=[],e.recaptchaKey===void 0)throw new Error("recaptchaKey undefined");this.siteKey=e.recaptchaKey.split("/")[3],this.recaptchaEnforcementState=e.recaptchaEnforcementState}getProviderEnforcementState(e){if(!this.recaptchaEnforcementState||this.recaptchaEnforcementState.length===0)return null;for(const i of this.recaptchaEnforcementState)if(i.provider&&i.provider===e)return KFe(i.enforcementState);return null}isProviderEnabled(e){return this.getProviderEnforcementState(e)==="ENFORCE"||this.getProviderEnforcementState(e)==="AUDIT"}isAnyProviderEnabled(){return this.isProviderEnabled("EMAIL_PASSWORD_PROVIDER")||this.isProviderEnabled("PHONE_PROVIDER")}}async function XFe(n,e){return Zf(n,"GET","/v2/recaptchaConfig",Qf(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function JFe(n,e){return Zf(n,"POST","/v1/accounts:delete",e)}async function Die(n,e){return Zf(n,"POST","/v1/accounts:lookup",e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function VC(n){if(n)try{const e=new Date(Number(n));if(!isNaN(e.getTime()))return e.toUTCString()}catch{}}async function QFe(n,e=!1){const i=Pi(n),o=await i.getIdToken(e),l=U5(o);qn(l&&l.exp&&l.auth_time&&l.iat,i.auth,"internal-error");const u=typeof l.firebase=="object"?l.firebase:void 0,p=u==null?void 0:u.sign_in_provider;return{claims:l,token:o,authTime:VC(ZU(l.auth_time)),issuedAtTime:VC(ZU(l.iat)),expirationTime:VC(ZU(l.exp)),signInProvider:p||null,signInSecondFactor:(u==null?void 0:u.sign_in_second_factor)||null}}function ZU(n){return Number(n)*1e3}function U5(n){const[e,i,o]=n.split(".");if(e===void 0||i===void 0||o===void 0)return Uk("JWT malformed, contained fewer than 3 sections"),null;try{const l=_ie(i);return l?JSON.parse(l):(Uk("Failed to decode base64 JWT payload"),null)}catch(l){return Uk("Caught error parsing JWT payload as JSON",l==null?void 0:l.toString()),null}}function yJ(n){const e=U5(n);return qn(e,"internal-error"),qn(typeof e.exp<"u","internal-error"),qn(typeof e.iat<"u","internal-error"),Number(e.exp)-Number(e.iat)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function pR(n,e,i=!1){if(i)return e;try{return await e}catch(o){throw o instanceof ph&&ZFe(o)&&n.auth.currentUser===n&&await n.auth.signOut(),o}}function ZFe({code:n}){return n==="auth/user-disabled"||n==="auth/user-token-expired"}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class eje{constructor(e){this.user=e,this.isRunning=!1,this.timerId=null,this.errorBackoff=3e4}_start(){this.isRunning||(this.isRunning=!0,this.schedule())}_stop(){this.isRunning&&(this.isRunning=!1,this.timerId!==null&&clearTimeout(this.timerId))}getInterval(e){var i;if(e){const o=this.errorBackoff;return this.errorBackoff=Math.min(this.errorBackoff*2,96e4),o}else{this.errorBackoff=3e4;const l=((i=this.user.stsTokenManager.expirationTime)!==null&&i!==void 0?i:0)-Date.now()-3e5;return Math.max(0,l)}}schedule(e=!1){if(!this.isRunning)return;const i=this.getInterval(e);this.timerId=setTimeout(async()=>{await this.iteration()},i)}async iteration(){try{await this.user.getIdToken(!0)}catch(e){(e==null?void 0:e.code)==="auth/network-request-failed"&&this.schedule(!0);return}this.schedule()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class _F{constructor(e,i){this.createdAt=e,this.lastLoginAt=i,this._initializeTime()}_initializeTime(){this.lastSignInTime=VC(this.lastLoginAt),this.creationTime=VC(this.createdAt)}_copy(e){this.createdAt=e.createdAt,this.lastLoginAt=e.lastLoginAt,this._initializeTime()}toJSON(){return{createdAt:this.createdAt,lastLoginAt:this.lastLoginAt}}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function _O(n){var e;const i=n.auth,o=await n.getIdToken(),l=await pR(n,Die(i,{idToken:o}));qn(l==null?void 0:l.users.length,i,"internal-error");const u=l.users[0];n._notifyReloadListener(u);const p=!((e=u.providerUserInfo)===null||e===void 0)&&e.length?xie(u.providerUserInfo):[],y=nje(n.providerData,p),v=n.isAnonymous,w=!(n.email&&u.passwordHash)&&!(y!=null&&y.length),C=v?w:!1,R={uid:u.localId,displayName:u.displayName||null,photoURL:u.photoUrl||null,email:u.email||null,emailVerified:u.emailVerified||!1,phoneNumber:u.phoneNumber||null,tenantId:u.tenantId||null,providerData:y,metadata:new _F(u.createdAt,u.lastLoginAt),isAnonymous:C};Object.assign(n,R)}async function tje(n){const e=Pi(n);await _O(e),await e.auth._persistUserIfCurrent(e),e.auth._notifyListenersIfCurrent(e)}function nje(n,e){return[...n.filter(o=>!e.some(l=>l.providerId===o.providerId)),...e]}function xie(n){return n.map(e=>{var{providerId:i}=e,o=DR(e,["providerId"]);return{providerId:i,uid:o.rawId||"",displayName:o.displayName||null,email:o.email||null,phoneNumber:o.phoneNumber||null,photoURL:o.photoUrl||null}})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function rje(n,e){const i=await Oie(n,{},async()=>{const o=zR({grant_type:"refresh_token",refresh_token:e}).slice(1),{tokenApiHost:l,apiKey:u}=n.config,p=Nie(n,l,"/v1/token",`key=${u}`),y=await n._getAdditionalHeaders();return y["Content-Type"]="application/x-www-form-urlencoded",kie.fetch()(p,{method:"POST",headers:y,body:o})});return{accessToken:i.access_token,expiresIn:i.expires_in,refreshToken:i.refresh_token}}async function ije(n,e){return Zf(n,"POST","/v2/accounts:revokeToken",Qf(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class hS{constructor(){this.refreshToken=null,this.accessToken=null,this.expirationTime=null}get isExpired(){return!this.expirationTime||Date.now()>this.expirationTime-3e4}updateFromServerResponse(e){qn(e.idToken,"internal-error"),qn(typeof e.idToken<"u","internal-error"),qn(typeof e.refreshToken<"u","internal-error");const i="expiresIn"in e&&typeof e.expiresIn<"u"?Number(e.expiresIn):yJ(e.idToken);this.updateTokensAndExpiration(e.idToken,e.refreshToken,i)}updateFromIdToken(e){qn(e.length!==0,"internal-error");const i=yJ(e);this.updateTokensAndExpiration(e,null,i)}async getToken(e,i=!1){return!i&&this.accessToken&&!this.isExpired?this.accessToken:(qn(this.refreshToken,e,"user-token-expired"),this.refreshToken?(await this.refresh(e,this.refreshToken),this.accessToken):null)}clearRefreshToken(){this.refreshToken=null}async refresh(e,i){const{accessToken:o,refreshToken:l,expiresIn:u}=await rje(e,i);this.updateTokensAndExpiration(o,l,Number(u))}updateTokensAndExpiration(e,i,o){this.refreshToken=i||null,this.accessToken=e||null,this.expirationTime=Date.now()+o*1e3}static fromJSON(e,i){const{refreshToken:o,accessToken:l,expirationTime:u}=i,p=new hS;return o&&(qn(typeof o=="string","internal-error",{appName:e}),p.refreshToken=o),l&&(qn(typeof l=="string","internal-error",{appName:e}),p.accessToken=l),u&&(qn(typeof u=="number","internal-error",{appName:e}),p.expirationTime=u),p}toJSON(){return{refreshToken:this.refreshToken,accessToken:this.accessToken,expirationTime:this.expirationTime}}_assign(e){this.accessToken=e.accessToken,this.refreshToken=e.refreshToken,this.expirationTime=e.expirationTime}_clone(){return Object.assign(new hS,this.toJSON())}_performRefresh(){return Pf("not implemented")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function pg(n,e){qn(typeof n=="string"||typeof n>"u","internal-error",{appName:e})}class kf{constructor(e){var{uid:i,auth:o,stsTokenManager:l}=e,u=DR(e,["uid","auth","stsTokenManager"]);this.providerId="firebase",this.proactiveRefresh=new eje(this),this.reloadUserInfo=null,this.reloadListener=null,this.uid=i,this.auth=o,this.stsTokenManager=l,this.accessToken=l.accessToken,this.displayName=u.displayName||null,this.email=u.email||null,this.emailVerified=u.emailVerified||!1,this.phoneNumber=u.phoneNumber||null,this.photoURL=u.photoURL||null,this.isAnonymous=u.isAnonymous||!1,this.tenantId=u.tenantId||null,this.providerData=u.providerData?[...u.providerData]:[],this.metadata=new _F(u.createdAt||void 0,u.lastLoginAt||void 0)}async getIdToken(e){const i=await pR(this,this.stsTokenManager.getToken(this.auth,e));return qn(i,this.auth,"internal-error"),this.accessToken!==i&&(this.accessToken=i,await this.auth._persistUserIfCurrent(this),this.auth._notifyListenersIfCurrent(this)),i}getIdTokenResult(e){return QFe(this,e)}reload(){return tje(this)}_assign(e){this!==e&&(qn(this.uid===e.uid,this.auth,"internal-error"),this.displayName=e.displayName,this.photoURL=e.photoURL,this.email=e.email,this.emailVerified=e.emailVerified,this.phoneNumber=e.phoneNumber,this.isAnonymous=e.isAnonymous,this.tenantId=e.tenantId,this.providerData=e.providerData.map(i=>Object.assign({},i)),this.metadata._copy(e.metadata),this.stsTokenManager._assign(e.stsTokenManager))}_clone(e){const i=new kf(Object.assign(Object.assign({},this),{auth:e,stsTokenManager:this.stsTokenManager._clone()}));return i.metadata._copy(this.metadata),i}_onReload(e){qn(!this.reloadListener,this.auth,"internal-error"),this.reloadListener=e,this.reloadUserInfo&&(this._notifyReloadListener(this.reloadUserInfo),this.reloadUserInfo=null)}_notifyReloadListener(e){this.reloadListener?this.reloadListener(e):this.reloadUserInfo=e}_startProactiveRefresh(){this.proactiveRefresh._start()}_stopProactiveRefresh(){this.proactiveRefresh._stop()}async _updateTokensIfNecessary(e,i=!1){let o=!1;e.idToken&&e.idToken!==this.stsTokenManager.accessToken&&(this.stsTokenManager.updateFromServerResponse(e),o=!0),i&&await _O(this),await this.auth._persistUserIfCurrent(this),o&&this.auth._notifyListenersIfCurrent(this)}async delete(){if(dl(this.auth.app))return Promise.reject(Vf(this.auth));const e=await this.getIdToken();return await pR(this,JFe(this.auth,{idToken:e})),this.stsTokenManager.clearRefreshToken(),this.auth.signOut()}toJSON(){return Object.assign(Object.assign({uid:this.uid,email:this.email||void 0,emailVerified:this.emailVerified,displayName:this.displayName||void 0,isAnonymous:this.isAnonymous,photoURL:this.photoURL||void 0,phoneNumber:this.phoneNumber||void 0,tenantId:this.tenantId||void 0,providerData:this.providerData.map(e=>Object.assign({},e)),stsTokenManager:this.stsTokenManager.toJSON(),_redirectEventId:this._redirectEventId},this.metadata.toJSON()),{apiKey:this.auth.config.apiKey,appName:this.auth.name})}get refreshToken(){return this.stsTokenManager.refreshToken||""}static _fromJSON(e,i){var o,l,u,p,y,v,w,C;const R=(o=i.displayName)!==null&&o!==void 0?o:void 0,N=(l=i.email)!==null&&l!==void 0?l:void 0,M=(u=i.phoneNumber)!==null&&u!==void 0?u:void 0,L=(p=i.photoURL)!==null&&p!==void 0?p:void 0,U=(y=i.tenantId)!==null&&y!==void 0?y:void 0,z=(v=i._redirectEventId)!==null&&v!==void 0?v:void 0,J=(w=i.createdAt)!==null&&w!==void 0?w:void 0,q=(C=i.lastLoginAt)!==null&&C!==void 0?C:void 0,{uid:re,emailVerified:ce,isAnonymous:ae,providerData:pe,stsTokenManager:H}=i;qn(re&&H,e,"internal-error");const X=hS.fromJSON(this.name,H);qn(typeof re=="string",e,"internal-error"),pg(R,e.name),pg(N,e.name),qn(typeof ce=="boolean",e,"internal-error"),qn(typeof ae=="boolean",e,"internal-error"),pg(M,e.name),pg(L,e.name),pg(U,e.name),pg(z,e.name),pg(J,e.name),pg(q,e.name);const Q=new kf({uid:re,auth:e,email:N,emailVerified:ce,displayName:R,isAnonymous:ae,photoURL:L,phoneNumber:M,tenantId:U,stsTokenManager:X,createdAt:J,lastLoginAt:q});return pe&&Array.isArray(pe)&&(Q.providerData=pe.map(ne=>Object.assign({},ne))),z&&(Q._redirectEventId=z),Q}static async _fromIdTokenResponse(e,i,o=!1){const l=new hS;l.updateFromServerResponse(i);const u=new kf({uid:i.localId,auth:e,stsTokenManager:l,isAnonymous:o});return await _O(u),u}static async _fromGetAccountInfoResponse(e,i,o){const l=i.users[0];qn(l.localId!==void 0,"internal-error");const u=l.providerUserInfo!==void 0?xie(l.providerUserInfo):[],p=!(l.email&&l.passwordHash)&&!(u!=null&&u.length),y=new hS;y.updateFromIdToken(o);const v=new kf({uid:l.localId,auth:e,stsTokenManager:y,isAnonymous:p}),w={uid:l.localId,displayName:l.displayName||null,photoURL:l.photoUrl||null,email:l.email||null,emailVerified:l.emailVerified||!1,phoneNumber:l.phoneNumber||null,tenantId:l.tenantId||null,providerData:u,metadata:new _F(l.createdAt,l.lastLoginAt),isAnonymous:!(l.email&&l.passwordHash)&&!(u!=null&&u.length)};return Object.assign(v,w),v}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const EJ=new Map;function Of(n){Kf(n instanceof Function,"Expected a class definition");let e=EJ.get(n);return e?(Kf(e instanceof n,"Instance stored in cache mismatched with class"),e):(e=new n,EJ.set(n,e),e)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Lie{constructor(){this.type="NONE",this.storage={}}async _isAvailable(){return!0}async _set(e,i){this.storage[e]=i}async _get(e){const i=this.storage[e];return i===void 0?null:i}async _remove(e){delete this.storage[e]}_addListener(e,i){}_removeListener(e,i){}}Lie.type="NONE";const vJ=Lie;/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Vk(n,e,i){return`firebase:${n}:${e}:${i}`}class pS{constructor(e,i,o){this.persistence=e,this.auth=i,this.userKey=o;const{config:l,name:u}=this.auth;this.fullUserKey=Vk(this.userKey,l.apiKey,u),this.fullPersistenceKey=Vk("persistence",l.apiKey,u),this.boundEventHandler=i._onStorageEvent.bind(i),this.persistence._addListener(this.fullUserKey,this.boundEventHandler)}setCurrentUser(e){return this.persistence._set(this.fullUserKey,e.toJSON())}async getCurrentUser(){const e=await this.persistence._get(this.fullUserKey);return e?kf._fromJSON(this.auth,e):null}removeCurrentUser(){return this.persistence._remove(this.fullUserKey)}savePersistenceForRedirect(){return this.persistence._set(this.fullPersistenceKey,this.persistence.type)}async setPersistence(e){if(this.persistence===e)return;const i=await this.getCurrentUser();if(await this.removeCurrentUser(),this.persistence=e,i)return this.setCurrentUser(i)}delete(){this.persistence._removeListener(this.fullUserKey,this.boundEventHandler)}static async create(e,i,o="authUser"){if(!i.length)return new pS(Of(vJ),e,o);const l=(await Promise.all(i.map(async w=>{if(await w._isAvailable())return w}))).filter(w=>w);let u=l[0]||Of(vJ);const p=Vk(o,e.config.apiKey,e.name);let y=null;for(const w of i)try{const C=await w._get(p);if(C){const R=kf._fromJSON(e,C);w!==u&&(y=R),u=w;break}}catch{}const v=l.filter(w=>w._shouldAllowMigration);return!u._shouldAllowMigration||!v.length?new pS(u,e,o):(u=v[0],y&&await u._set(p,y.toJSON()),await Promise.all(i.map(async w=>{if(w!==u)try{await w._remove(p)}catch{}})),new pS(u,e,o))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function SJ(n){const e=n.toLowerCase();if(e.includes("opera/")||e.includes("opr/")||e.includes("opios/"))return"Opera";if(Fie(e))return"IEMobile";if(e.includes("msie")||e.includes("trident/"))return"IE";if(e.includes("edge/"))return"Edge";if(Mie(e))return"Firefox";if(e.includes("silk/"))return"Silk";if(Bie(e))return"Blackberry";if(zie(e))return"Webos";if(Uie(e))return"Safari";if((e.includes("chrome/")||Vie(e))&&!e.includes("edge/"))return"Chrome";if(jie(e))return"Android";{const i=/([a-zA-Z\d\.]+)\/[a-zA-Z\d\.]*$/,o=n.match(i);if((o==null?void 0:o.length)===2)return o[1]}return"Other"}function Mie(n=cc()){return/firefox\//i.test(n)}function Uie(n=cc()){const e=n.toLowerCase();return e.includes("safari/")&&!e.includes("chrome/")&&!e.includes("crios/")&&!e.includes("android")}function Vie(n=cc()){return/crios\//i.test(n)}function Fie(n=cc()){return/iemobile/i.test(n)}function jie(n=cc()){return/android/i.test(n)}function Bie(n=cc()){return/blackberry/i.test(n)}function zie(n=cc()){return/webos/i.test(n)}function V5(n=cc()){return/iphone|ipad|ipod/i.test(n)||/macintosh/i.test(n)&&/mobile/i.test(n)}function sje(n=cc()){var e;return V5(n)&&!!(!((e=window.navigator)===null||e===void 0)&&e.standalone)}function oje(){return SVe()&&document.documentMode===10}function Wie(n=cc()){return V5(n)||jie(n)||zie(n)||Bie(n)||/windows phone/i.test(n)||Fie(n)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Gie(n,e=[]){let i;switch(n){case"Browser":i=SJ(cc());break;case"Worker":i=`${SJ(cc())}-${n}`;break;default:i=n}const o=e.length?e.join(","):"FirebaseCore-web";return`${i}/JsCore/${uE}/${o}`}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class aje{constructor(e){this.auth=e,this.queue=[]}pushCallback(e,i){const o=u=>new Promise((p,y)=>{try{const v=e(u);p(v)}catch(v){y(v)}});o.onAbort=i,this.queue.push(o);const l=this.queue.length-1;return()=>{this.queue[l]=()=>Promise.resolve()}}async runMiddleware(e){if(this.auth.currentUser===e)return;const i=[];try{for(const o of this.queue)await o(e),o.onAbort&&i.push(o.onAbort)}catch(o){i.reverse();for(const l of i)try{l()}catch{}throw this.auth._errorFactory.create("login-blocked",{originalMessage:o==null?void 0:o.message})}}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function cje(n,e={}){return Zf(n,"GET","/v2/passwordPolicy",Qf(n,e))}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const lje=6;class uje{constructor(e){var i,o,l,u;const p=e.customStrengthOptions;this.customStrengthOptions={},this.customStrengthOptions.minPasswordLength=(i=p.minPasswordLength)!==null&&i!==void 0?i:lje,p.maxPasswordLength&&(this.customStrengthOptions.maxPasswordLength=p.maxPasswordLength),p.containsLowercaseCharacter!==void 0&&(this.customStrengthOptions.containsLowercaseLetter=p.containsLowercaseCharacter),p.containsUppercaseCharacter!==void 0&&(this.customStrengthOptions.containsUppercaseLetter=p.containsUppercaseCharacter),p.containsNumericCharacter!==void 0&&(this.customStrengthOptions.containsNumericCharacter=p.containsNumericCharacter),p.containsNonAlphanumericCharacter!==void 0&&(this.customStrengthOptions.containsNonAlphanumericCharacter=p.containsNonAlphanumericCharacter),this.enforcementState=e.enforcementState,this.enforcementState==="ENFORCEMENT_STATE_UNSPECIFIED"&&(this.enforcementState="OFF"),this.allowedNonAlphanumericCharacters=(l=(o=e.allowedNonAlphanumericCharacters)===null||o===void 0?void 0:o.join(""))!==null&&l!==void 0?l:"",this.forceUpgradeOnSignin=(u=e.forceUpgradeOnSignin)!==null&&u!==void 0?u:!1,this.schemaVersion=e.schemaVersion}validatePassword(e){var i,o,l,u,p,y;const v={isValid:!0,passwordPolicy:this};return this.validatePasswordLengthOptions(e,v),this.validatePasswordCharacterOptions(e,v),v.isValid&&(v.isValid=(i=v.meetsMinPasswordLength)!==null&&i!==void 0?i:!0),v.isValid&&(v.isValid=(o=v.meetsMaxPasswordLength)!==null&&o!==void 0?o:!0),v.isValid&&(v.isValid=(l=v.containsLowercaseLetter)!==null&&l!==void 0?l:!0),v.isValid&&(v.isValid=(u=v.containsUppercaseLetter)!==null&&u!==void 0?u:!0),v.isValid&&(v.isValid=(p=v.containsNumericCharacter)!==null&&p!==void 0?p:!0),v.isValid&&(v.isValid=(y=v.containsNonAlphanumericCharacter)!==null&&y!==void 0?y:!0),v}validatePasswordLengthOptions(e,i){const o=this.customStrengthOptions.minPasswordLength,l=this.customStrengthOptions.maxPasswordLength;o&&(i.meetsMinPasswordLength=e.length>=o),l&&(i.meetsMaxPasswordLength=e.length<=l)}validatePasswordCharacterOptions(e,i){this.updatePasswordCharacterOptionsStatuses(i,!1,!1,!1,!1);let o;for(let l=0;l<e.length;l++)o=e.charAt(l),this.updatePasswordCharacterOptionsStatuses(i,o>="a"&&o<="z",o>="A"&&o<="Z",o>="0"&&o<="9",this.allowedNonAlphanumericCharacters.includes(o))}updatePasswordCharacterOptionsStatuses(e,i,o,l,u){this.customStrengthOptions.containsLowercaseLetter&&(e.containsLowercaseLetter||(e.containsLowercaseLetter=i)),this.customStrengthOptions.containsUppercaseLetter&&(e.containsUppercaseLetter||(e.containsUppercaseLetter=o)),this.customStrengthOptions.containsNumericCharacter&&(e.containsNumericCharacter||(e.containsNumericCharacter=l)),this.customStrengthOptions.containsNonAlphanumericCharacter&&(e.containsNonAlphanumericCharacter||(e.containsNonAlphanumericCharacter=u))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class dje{constructor(e,i,o,l){this.app=e,this.heartbeatServiceProvider=i,this.appCheckServiceProvider=o,this.config=l,this.currentUser=null,this.emulatorConfig=null,this.operations=Promise.resolve(),this.authStateSubscription=new bJ(this),this.idTokenSubscription=new bJ(this),this.beforeStateQueue=new aje(this),this.redirectUser=null,this.isProactiveRefreshEnabled=!1,this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION=1,this._canInitEmulator=!0,this._isInitialized=!1,this._deleted=!1,this._initializationPromise=null,this._popupRedirectResolver=null,this._errorFactory=Aie,this._agentRecaptchaConfig=null,this._tenantRecaptchaConfigs={},this._projectPasswordPolicy=null,this._tenantPasswordPolicies={},this.lastNotifiedUid=void 0,this.languageCode=null,this.tenantId=null,this.settings={appVerificationDisabledForTesting:!1},this.frameworks=[],this.name=e.name,this.clientVersion=l.sdkClientVersion}_initializeWithPersistence(e,i){return i&&(this._popupRedirectResolver=Of(i)),this._initializationPromise=this.queue(async()=>{var o,l;if(!this._deleted&&(this.persistenceManager=await pS.create(this,e),!this._deleted)){if(!((o=this._popupRedirectResolver)===null||o===void 0)&&o._shouldInitProactively)try{await this._popupRedirectResolver._initialize(this)}catch{}await this.initializeCurrentUser(i),this.lastNotifiedUid=((l=this.currentUser)===null||l===void 0?void 0:l.uid)||null,!this._deleted&&(this._isInitialized=!0)}}),this._initializationPromise}async _onStorageEvent(){if(this._deleted)return;const e=await this.assertedPersistence.getCurrentUser();if(!(!this.currentUser&&!e)){if(this.currentUser&&e&&this.currentUser.uid===e.uid){this._currentUser._assign(e),await this.currentUser.getIdToken();return}await this._updateCurrentUser(e,!0)}}async initializeCurrentUserFromIdToken(e){try{const i=await Die(this,{idToken:e}),o=await kf._fromGetAccountInfoResponse(this,i,e);await this.directlySetCurrentUser(o)}catch(i){console.warn("FirebaseServerApp could not login user with provided authIdToken: ",i),await this.directlySetCurrentUser(null)}}async initializeCurrentUser(e){var i;if(dl(this.app)){const p=this.app.settings.authIdToken;return p?new Promise(y=>{setTimeout(()=>this.initializeCurrentUserFromIdToken(p).then(y,y))}):this.directlySetCurrentUser(null)}const o=await this.assertedPersistence.getCurrentUser();let l=o,u=!1;if(e&&this.config.authDomain){await this.getOrInitRedirectPersistenceManager();const p=(i=this.redirectUser)===null||i===void 0?void 0:i._redirectEventId,y=l==null?void 0:l._redirectEventId,v=await this.tryRedirectSignIn(e);(!p||p===y)&&(v!=null&&v.user)&&(l=v.user,u=!0)}if(!l)return this.directlySetCurrentUser(null);if(!l._redirectEventId){if(u)try{await this.beforeStateQueue.runMiddleware(l)}catch(p){l=o,this._popupRedirectResolver._overrideRedirectResult(this,()=>Promise.reject(p))}return l?this.reloadAndSetCurrentUserOrClear(l):this.directlySetCurrentUser(null)}return qn(this._popupRedirectResolver,this,"argument-error"),await this.getOrInitRedirectPersistenceManager(),this.redirectUser&&this.redirectUser._redirectEventId===l._redirectEventId?this.directlySetCurrentUser(l):this.reloadAndSetCurrentUserOrClear(l)}async tryRedirectSignIn(e){let i=null;try{i=await this._popupRedirectResolver._completeRedirectFn(this,e,!0)}catch{await this._setRedirectUser(null)}return i}async reloadAndSetCurrentUserOrClear(e){try{await _O(e)}catch(i){if((i==null?void 0:i.code)!=="auth/network-request-failed")return this.directlySetCurrentUser(null)}return this.directlySetCurrentUser(e)}useDeviceLanguage(){this.languageCode=GFe()}async _delete(){this._deleted=!0}async updateCurrentUser(e){if(dl(this.app))return Promise.reject(Vf(this));const i=e?Pi(e):null;return i&&qn(i.auth.config.apiKey===this.config.apiKey,this,"invalid-user-token"),this._updateCurrentUser(i&&i._clone(this))}async _updateCurrentUser(e,i=!1){if(!this._deleted)return e&&qn(this.tenantId===e.tenantId,this,"tenant-id-mismatch"),i||await this.beforeStateQueue.runMiddleware(e),this.queue(async()=>{await this.directlySetCurrentUser(e),this.notifyAuthListeners()})}async signOut(){return dl(this.app)?Promise.reject(Vf(this)):(await this.beforeStateQueue.runMiddleware(null),(this.redirectPersistenceManager||this._popupRedirectResolver)&&await this._setRedirectUser(null),this._updateCurrentUser(null,!0))}setPersistence(e){return dl(this.app)?Promise.reject(Vf(this)):this.queue(async()=>{await this.assertedPersistence.setPersistence(Of(e))})}_getRecaptchaConfig(){return this.tenantId==null?this._agentRecaptchaConfig:this._tenantRecaptchaConfigs[this.tenantId]}async validatePassword(e){this._getPasswordPolicyInternal()||await this._updatePasswordPolicy();const i=this._getPasswordPolicyInternal();return i.schemaVersion!==this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION?Promise.reject(this._errorFactory.create("unsupported-password-policy-schema-version",{})):i.validatePassword(e)}_getPasswordPolicyInternal(){return this.tenantId===null?this._projectPasswordPolicy:this._tenantPasswordPolicies[this.tenantId]}async _updatePasswordPolicy(){const e=await cje(this),i=new uje(e);this.tenantId===null?this._projectPasswordPolicy=i:this._tenantPasswordPolicies[this.tenantId]=i}_getPersistence(){return this.assertedPersistence.persistence.type}_updateErrorMap(e){this._errorFactory=new BR("auth","Firebase",e())}onAuthStateChanged(e,i,o){return this.registerStateListener(this.authStateSubscription,e,i,o)}beforeAuthStateChanged(e,i){return this.beforeStateQueue.pushCallback(e,i)}onIdTokenChanged(e,i,o){return this.registerStateListener(this.idTokenSubscription,e,i,o)}authStateReady(){return new Promise((e,i)=>{if(this.currentUser)e();else{const o=this.onAuthStateChanged(()=>{o(),e()},i)}})}async revokeAccessToken(e){if(this.currentUser){const i=await this.currentUser.getIdToken(),o={providerId:"apple.com",tokenType:"ACCESS_TOKEN",token:e,idToken:i};this.tenantId!=null&&(o.tenantId=this.tenantId),await ije(this,o)}}toJSON(){var e;return{apiKey:this.config.apiKey,authDomain:this.config.authDomain,appName:this.name,currentUser:(e=this._currentUser)===null||e===void 0?void 0:e.toJSON()}}async _setRedirectUser(e,i){const o=await this.getOrInitRedirectPersistenceManager(i);return e===null?o.removeCurrentUser():o.setCurrentUser(e)}async getOrInitRedirectPersistenceManager(e){if(!this.redirectPersistenceManager){const i=e&&Of(e)||this._popupRedirectResolver;qn(i,this,"argument-error"),this.redirectPersistenceManager=await pS.create(this,[Of(i._redirectPersistence)],"redirectUser"),this.redirectUser=await this.redirectPersistenceManager.getCurrentUser()}return this.redirectPersistenceManager}async _redirectUserForId(e){var i,o;return this._isInitialized&&await this.queue(async()=>{}),((i=this._currentUser)===null||i===void 0?void 0:i._redirectEventId)===e?this._currentUser:((o=this.redirectUser)===null||o===void 0?void 0:o._redirectEventId)===e?this.redirectUser:null}async _persistUserIfCurrent(e){if(e===this.currentUser)return this.queue(async()=>this.directlySetCurrentUser(e))}_notifyListenersIfCurrent(e){e===this.currentUser&&this.notifyAuthListeners()}_key(){return`${this.config.authDomain}:${this.config.apiKey}:${this.name}`}_startProactiveRefresh(){this.isProactiveRefreshEnabled=!0,this.currentUser&&this._currentUser._startProactiveRefresh()}_stopProactiveRefresh(){this.isProactiveRefreshEnabled=!1,this.currentUser&&this._currentUser._stopProactiveRefresh()}get _currentUser(){return this.currentUser}notifyAuthListeners(){var e,i;if(!this._isInitialized)return;this.idTokenSubscription.next(this.currentUser);const o=(i=(e=this.currentUser)===null||e===void 0?void 0:e.uid)!==null&&i!==void 0?i:null;this.lastNotifiedUid!==o&&(this.lastNotifiedUid=o,this.authStateSubscription.next(this.currentUser))}registerStateListener(e,i,o,l){if(this._deleted)return()=>{};const u=typeof i=="function"?i:i.next.bind(i);let p=!1;const y=this._isInitialized?Promise.resolve():this._initializationPromise;if(qn(y,this,"internal-error"),y.then(()=>{p||u(this.currentUser)}),typeof i=="function"){const v=e.addObserver(i,o,l);return()=>{p=!0,v()}}else{const v=e.addObserver(i);return()=>{p=!0,v()}}}async directlySetCurrentUser(e){this.currentUser&&this.currentUser!==e&&this._currentUser._stopProactiveRefresh(),e&&this.isProactiveRefreshEnabled&&e._startProactiveRefresh(),this.currentUser=e,e?await this.assertedPersistence.setCurrentUser(e):await this.assertedPersistence.removeCurrentUser()}queue(e){return this.operations=this.operations.then(e,e),this.operations}get assertedPersistence(){return qn(this.persistenceManager,this,"internal-error"),this.persistenceManager}_logFramework(e){!e||this.frameworks.includes(e)||(this.frameworks.push(e),this.frameworks.sort(),this.clientVersion=Gie(this.config.clientPlatform,this._getFrameworks()))}_getFrameworks(){return this.frameworks}async _getAdditionalHeaders(){var e;const i={"X-Client-Version":this.clientVersion};this.app.options.appId&&(i["X-Firebase-gmpid"]=this.app.options.appId);const o=await((e=this.heartbeatServiceProvider.getImmediate({optional:!0}))===null||e===void 0?void 0:e.getHeartbeatsHeader());o&&(i["X-Firebase-Client"]=o);const l=await this._getAppCheckToken();return l&&(i["X-Firebase-AppCheck"]=l),i}async _getAppCheckToken(){var e;if(dl(this.app)&&this.app.settings.appCheckToken)return this.app.settings.appCheckToken;const i=await((e=this.appCheckServiceProvider.getImmediate({optional:!0}))===null||e===void 0?void 0:e.getToken());return i!=null&&i.error&&BFe(`Error while retrieving App Check token: ${i.error}`),i==null?void 0:i.token}}function Xg(n){return Pi(n)}class bJ{constructor(e){this.auth=e,this.observer=null,this.addObserver=PVe(i=>this.observer=i)}get next(){return qn(this.observer,this.auth,"internal-error"),this.observer.next.bind(this.observer)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let TN={async loadJS(){throw new Error("Unable to load external scripts")},recaptchaV2Script:"",recaptchaEnterpriseScript:"",gapiScript:""};function hje(n){TN=n}function Hie(n){return TN.loadJS(n)}function pje(){return TN.recaptchaEnterpriseScript}function fje(){return TN.gapiScript}function mje(n){return`__${n}${Math.floor(Math.random()*1e6)}`}class gje{constructor(){this.enterprise=new _je}ready(e){e()}execute(e,i){return Promise.resolve("token")}render(e,i){return""}}class _je{ready(e){e()}execute(e,i){return Promise.resolve("token")}render(e,i){return""}}const yje="recaptcha-enterprise",$ie="NO_RECAPTCHA";class Eje{constructor(e){this.type=yje,this.auth=Xg(e)}async verify(e="verify",i=!1){async function o(u){if(!i){if(u.tenantId==null&&u._agentRecaptchaConfig!=null)return u._agentRecaptchaConfig.siteKey;if(u.tenantId!=null&&u._tenantRecaptchaConfigs[u.tenantId]!==void 0)return u._tenantRecaptchaConfigs[u.tenantId].siteKey}return new Promise(async(p,y)=>{XFe(u,{clientType:"CLIENT_TYPE_WEB",version:"RECAPTCHA_ENTERPRISE"}).then(v=>{if(v.recaptchaKey===void 0)y(new Error("recaptcha Enterprise site key undefined"));else{const w=new YFe(v);return u.tenantId==null?u._agentRecaptchaConfig=w:u._tenantRecaptchaConfigs[u.tenantId]=w,p(w.siteKey)}}).catch(v=>{y(v)})})}function l(u,p,y){const v=window.grecaptcha;_J(v)?v.enterprise.ready(()=>{v.enterprise.execute(u,{action:e}).then(w=>{p(w)}).catch(()=>{p($ie)})}):y(Error("No reCAPTCHA enterprise script loaded."))}return this.auth.settings.appVerificationDisabledForTesting?new gje().execute("siteKey",{action:"verify"}):new Promise((u,p)=>{o(this.auth).then(y=>{if(!i&&_J(window.grecaptcha))l(y,u,p);else{if(typeof window>"u"){p(new Error("RecaptchaVerifier is only supported in browser"));return}let v=pje();v.length!==0&&(v+=y),Hie(v).then(()=>{l(y,u,p)}).catch(w=>{p(w)})}}).catch(y=>{p(y)})})}}async function wJ(n,e,i,o=!1,l=!1){const u=new Eje(n);let p;if(l)p=$ie;else try{p=await u.verify(i)}catch{p=await u.verify(i,!0)}const y=Object.assign({},e);if(i==="mfaSmsEnrollment"||i==="mfaSmsSignIn"){if("phoneEnrollmentInfo"in y){const v=y.phoneEnrollmentInfo.phoneNumber,w=y.phoneEnrollmentInfo.recaptchaToken;Object.assign(y,{phoneEnrollmentInfo:{phoneNumber:v,recaptchaToken:w,captchaResponse:p,clientType:"CLIENT_TYPE_WEB",recaptchaVersion:"RECAPTCHA_ENTERPRISE"}})}else if("phoneSignInInfo"in y){const v=y.phoneSignInInfo.recaptchaToken;Object.assign(y,{phoneSignInInfo:{recaptchaToken:v,captchaResponse:p,clientType:"CLIENT_TYPE_WEB",recaptchaVersion:"RECAPTCHA_ENTERPRISE"}})}return y}return o?Object.assign(y,{captchaResp:p}):Object.assign(y,{captchaResponse:p}),Object.assign(y,{clientType:"CLIENT_TYPE_WEB"}),Object.assign(y,{recaptchaVersion:"RECAPTCHA_ENTERPRISE"}),y}async function yO(n,e,i,o,l){var u;if(!((u=n._getRecaptchaConfig())===null||u===void 0)&&u.isProviderEnabled("EMAIL_PASSWORD_PROVIDER")){const p=await wJ(n,e,i,i==="getOobCode");return o(n,p)}else return o(n,e).catch(async p=>{if(p.code==="auth/missing-recaptcha-token"){console.log(`${i} is protected by reCAPTCHA Enterprise for this project. Automatically triggering the reCAPTCHA flow and restarting the flow.`);const y=await wJ(n,e,i,i==="getOobCode");return o(n,y)}else return Promise.reject(p)})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function vje(n,e){const i=WR(n,"auth");if(i.isInitialized()){const l=i.getImmediate(),u=i.getOptions();if(Gf(u,e??{}))return l;dh(l,"already-initialized")}return i.initialize({options:e})}function Sje(n,e){const i=(e==null?void 0:e.persistence)||[],o=(Array.isArray(i)?i:[i]).map(Of);e!=null&&e.errorMap&&n._updateErrorMap(e.errorMap),n._initializeWithPersistence(o,e==null?void 0:e.popupRedirectResolver)}function bje(n,e,i){const o=Xg(n);qn(/^https?:\/\//.test(e),o,"invalid-emulator-scheme");const l=!1,u=Kie(e),{host:p,port:y}=wje(e),v=y===null?"":`:${y}`,w={url:`${u}//${p}${v}/`},C=Object.freeze({host:p,port:y,protocol:u.replace(":",""),options:Object.freeze({disableWarnings:l})});if(!o._canInitEmulator){qn(o.config.emulator&&o.emulatorConfig,o,"emulator-config-failed"),qn(Gf(w,o.config.emulator)&&Gf(C,o.emulatorConfig),o,"emulator-config-failed");return}o.config.emulator=w,o.emulatorConfig=C,o.settings.appVerificationDisabledForTesting=!0,Tje()}function Kie(n){const e=n.indexOf(":");return e<0?"":n.substr(0,e+1)}function wje(n){const e=Kie(n),i=/(\/\/)?([^?#/]+)/.exec(n.substr(e.length));if(!i)return{host:"",port:null};const o=i[2].split("@").pop()||"",l=/^(\[[^\]]+\])(:|$)/.exec(o);if(l){const u=l[1];return{host:u,port:TJ(o.substr(u.length+1))}}else{const[u,p]=o.split(":");return{host:u,port:TJ(p)}}}function TJ(n){if(!n)return null;const e=Number(n);return isNaN(e)?null:e}function Tje(){function n(){const e=document.createElement("p"),i=e.style;e.innerText="Running in emulator mode. Do not use with production credentials.",i.position="fixed",i.width="100%",i.backgroundColor="#ffffff",i.border=".1em solid #000000",i.color="#b50000",i.bottom="0px",i.left="0px",i.margin="0px",i.zIndex="10000",i.textAlign="center",e.classList.add("firebase-emulator-warning"),document.body.appendChild(e)}typeof console<"u"&&typeof console.info=="function"&&console.info("WARNING: You are using the Auth Emulator, which is intended for local testing only.  Do not use with production credentials."),typeof window<"u"&&typeof document<"u"&&(document.readyState==="loading"?window.addEventListener("DOMContentLoaded",n):n())}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class F5{constructor(e,i){this.providerId=e,this.signInMethod=i}toJSON(){return Pf("not implemented")}_getIdTokenResponse(e){return Pf("not implemented")}_linkToIdToken(e,i){return Pf("not implemented")}_getReauthenticationResolver(e){return Pf("not implemented")}}async function Cje(n,e){return Zf(n,"POST","/v1/accounts:signUp",e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Rje(n,e){return HR(n,"POST","/v1/accounts:signInWithPassword",Qf(n,e))}async function qie(n,e){return Zf(n,"POST","/v1/accounts:sendOobCode",Qf(n,e))}async function Ije(n,e){return qie(n,e)}async function Aje(n,e){return qie(n,e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Pje(n,e){return HR(n,"POST","/v1/accounts:signInWithEmailLink",Qf(n,e))}async function kje(n,e){return HR(n,"POST","/v1/accounts:signInWithEmailLink",Qf(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class fR extends F5{constructor(e,i,o,l=null){super("password",o),this._email=e,this._password=i,this._tenantId=l}static _fromEmailAndPassword(e,i){return new fR(e,i,"password")}static _fromEmailAndCode(e,i,o=null){return new fR(e,i,"emailLink",o)}toJSON(){return{email:this._email,password:this._password,signInMethod:this.signInMethod,tenantId:this._tenantId}}static fromJSON(e){const i=typeof e=="string"?JSON.parse(e):e;if(i!=null&&i.email&&(i!=null&&i.password)){if(i.signInMethod==="password")return this._fromEmailAndPassword(i.email,i.password);if(i.signInMethod==="emailLink")return this._fromEmailAndCode(i.email,i.password,i.tenantId)}return null}async _getIdTokenResponse(e){switch(this.signInMethod){case"password":const i={returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"};return yO(e,i,"signInWithPassword",Rje);case"emailLink":return Pje(e,{email:this._email,oobCode:this._password});default:dh(e,"internal-error")}}async _linkToIdToken(e,i){switch(this.signInMethod){case"password":const o={idToken:i,returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"};return yO(e,o,"signUpPassword",Cje);case"emailLink":return kje(e,{idToken:i,email:this._email,oobCode:this._password});default:dh(e,"internal-error")}}_getReauthenticationResolver(e){return this._getIdTokenResponse(e)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function fS(n,e){return HR(n,"POST","/v1/accounts:signInWithIdp",Qf(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Oje="http://localhost";class nE extends F5{constructor(){super(...arguments),this.pendingToken=null}static _fromParams(e){const i=new nE(e.providerId,e.signInMethod);return e.idToken||e.accessToken?(e.idToken&&(i.idToken=e.idToken),e.accessToken&&(i.accessToken=e.accessToken),e.nonce&&!e.pendingToken&&(i.nonce=e.nonce),e.pendingToken&&(i.pendingToken=e.pendingToken)):e.oauthToken&&e.oauthTokenSecret?(i.accessToken=e.oauthToken,i.secret=e.oauthTokenSecret):dh("argument-error"),i}toJSON(){return{idToken:this.idToken,accessToken:this.accessToken,secret:this.secret,nonce:this.nonce,pendingToken:this.pendingToken,providerId:this.providerId,signInMethod:this.signInMethod}}static fromJSON(e){const i=typeof e=="string"?JSON.parse(e):e,{providerId:o,signInMethod:l}=i,u=DR(i,["providerId","signInMethod"]);if(!o||!l)return null;const p=new nE(o,l);return p.idToken=u.idToken||void 0,p.accessToken=u.accessToken||void 0,p.secret=u.secret,p.nonce=u.nonce,p.pendingToken=u.pendingToken||null,p}_getIdTokenResponse(e){const i=this.buildRequest();return fS(e,i)}_linkToIdToken(e,i){const o=this.buildRequest();return o.idToken=i,fS(e,o)}_getReauthenticationResolver(e){const i=this.buildRequest();return i.autoCreate=!1,fS(e,i)}buildRequest(){const e={requestUri:Oje,returnSecureToken:!0};if(this.pendingToken)e.pendingToken=this.pendingToken;else{const i={};this.idToken&&(i.id_token=this.idToken),this.accessToken&&(i.access_token=this.accessToken),this.secret&&(i.oauth_token_secret=this.secret),i.providerId=this.providerId,this.nonce&&!this.pendingToken&&(i.nonce=this.nonce),e.postBody=zR(i)}return e}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Nje(n){switch(n){case"recoverEmail":return"RECOVER_EMAIL";case"resetPassword":return"PASSWORD_RESET";case"signIn":return"EMAIL_SIGNIN";case"verifyEmail":return"VERIFY_EMAIL";case"verifyAndChangeEmail":return"VERIFY_AND_CHANGE_EMAIL";case"revertSecondFactorAddition":return"REVERT_SECOND_FACTOR_ADDITION";default:return null}}function Dje(n){const e=mC(gC(n)).link,i=e?mC(gC(e)).deep_link_id:null,o=mC(gC(n)).deep_link_id;return(o?mC(gC(o)).link:null)||o||i||e||n}class j5{constructor(e){var i,o,l,u,p,y;const v=mC(gC(e)),w=(i=v.apiKey)!==null&&i!==void 0?i:null,C=(o=v.oobCode)!==null&&o!==void 0?o:null,R=Nje((l=v.mode)!==null&&l!==void 0?l:null);qn(w&&C&&R,"argument-error"),this.apiKey=w,this.operation=R,this.code=C,this.continueUrl=(u=v.continueUrl)!==null&&u!==void 0?u:null,this.languageCode=(p=v.languageCode)!==null&&p!==void 0?p:null,this.tenantId=(y=v.tenantId)!==null&&y!==void 0?y:null}static parseLink(e){const i=Dje(e);try{return new j5(i)}catch{return null}}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class QS{constructor(){this.providerId=QS.PROVIDER_ID}static credential(e,i){return fR._fromEmailAndPassword(e,i)}static credentialWithLink(e,i){const o=j5.parseLink(i);return qn(o,"argument-error"),fR._fromEmailAndCode(e,o.code,o.tenantId)}}QS.PROVIDER_ID="password";QS.EMAIL_PASSWORD_SIGN_IN_METHOD="password";QS.EMAIL_LINK_SIGN_IN_METHOD="emailLink";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Yie{constructor(e){this.providerId=e,this.defaultLanguageCode=null,this.customParameters={}}setDefaultLanguage(e){this.defaultLanguageCode=e}setCustomParameters(e){return this.customParameters=e,this}getCustomParameters(){return this.customParameters}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class $R extends Yie{constructor(){super(...arguments),this.scopes=[]}addScope(e){return this.scopes.includes(e)||this.scopes.push(e),this}getScopes(){return[...this.scopes]}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Eg extends $R{constructor(){super("facebook.com")}static credential(e){return nE._fromParams({providerId:Eg.PROVIDER_ID,signInMethod:Eg.FACEBOOK_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return Eg.credentialFromTaggedObject(e)}static credentialFromError(e){return Eg.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e)||!e.oauthAccessToken)return null;try{return Eg.credential(e.oauthAccessToken)}catch{return null}}}Eg.FACEBOOK_SIGN_IN_METHOD="facebook.com";Eg.PROVIDER_ID="facebook.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class vg extends $R{constructor(){super("google.com"),this.addScope("profile")}static credential(e,i){return nE._fromParams({providerId:vg.PROVIDER_ID,signInMethod:vg.GOOGLE_SIGN_IN_METHOD,idToken:e,accessToken:i})}static credentialFromResult(e){return vg.credentialFromTaggedObject(e)}static credentialFromError(e){return vg.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthIdToken:i,oauthAccessToken:o}=e;if(!i&&!o)return null;try{return vg.credential(i,o)}catch{return null}}}vg.GOOGLE_SIGN_IN_METHOD="google.com";vg.PROVIDER_ID="google.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Sg extends $R{constructor(){super("github.com")}static credential(e){return nE._fromParams({providerId:Sg.PROVIDER_ID,signInMethod:Sg.GITHUB_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return Sg.credentialFromTaggedObject(e)}static credentialFromError(e){return Sg.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e)||!e.oauthAccessToken)return null;try{return Sg.credential(e.oauthAccessToken)}catch{return null}}}Sg.GITHUB_SIGN_IN_METHOD="github.com";Sg.PROVIDER_ID="github.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class bg extends $R{constructor(){super("twitter.com")}static credential(e,i){return nE._fromParams({providerId:bg.PROVIDER_ID,signInMethod:bg.TWITTER_SIGN_IN_METHOD,oauthToken:e,oauthTokenSecret:i})}static credentialFromResult(e){return bg.credentialFromTaggedObject(e)}static credentialFromError(e){return bg.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthAccessToken:i,oauthTokenSecret:o}=e;if(!i||!o)return null;try{return bg.credential(i,o)}catch{return null}}}bg.TWITTER_SIGN_IN_METHOD="twitter.com";bg.PROVIDER_ID="twitter.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function xje(n,e){return HR(n,"POST","/v1/accounts:signUp",Qf(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class rE{constructor(e){this.user=e.user,this.providerId=e.providerId,this._tokenResponse=e._tokenResponse,this.operationType=e.operationType}static async _fromIdTokenResponse(e,i,o,l=!1){const u=await kf._fromIdTokenResponse(e,o,l),p=CJ(o);return new rE({user:u,providerId:p,_tokenResponse:o,operationType:i})}static async _forOperation(e,i,o){await e._updateTokensIfNecessary(o,!0);const l=CJ(o);return new rE({user:e,providerId:l,_tokenResponse:o,operationType:i})}}function CJ(n){return n.providerId?n.providerId:"phoneNumber"in n?"phone":null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class EO extends ph{constructor(e,i,o,l){var u;super(i.code,i.message),this.operationType=o,this.user=l,Object.setPrototypeOf(this,EO.prototype),this.customData={appName:e.name,tenantId:(u=e.tenantId)!==null&&u!==void 0?u:void 0,_serverResponse:i.customData._serverResponse,operationType:o}}static _fromErrorAndOperation(e,i,o,l){return new EO(e,i,o,l)}}function Xie(n,e,i,o){return(e==="reauthenticate"?i._getReauthenticationResolver(n):i._getIdTokenResponse(n)).catch(u=>{throw u.code==="auth/multi-factor-auth-required"?EO._fromErrorAndOperation(n,u,e,o):u})}async function Lje(n,e,i=!1){const o=await pR(n,e._linkToIdToken(n.auth,await n.getIdToken()),i);return rE._forOperation(n,"link",o)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Mje(n,e,i=!1){const{auth:o}=n;if(dl(o.app))return Promise.reject(Vf(o));const l="reauthenticate";try{const u=await pR(n,Xie(o,l,e,n),i);qn(u.idToken,o,"internal-error");const p=U5(u.idToken);qn(p,o,"internal-error");const{sub:y}=p;return qn(n.uid===y,o,"user-mismatch"),rE._forOperation(n,l,u)}catch(u){throw(u==null?void 0:u.code)==="auth/user-not-found"&&dh(o,"user-mismatch"),u}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Jie(n,e,i=!1){if(dl(n.app))return Promise.reject(Vf(n));const o="signIn",l=await Xie(n,o,e),u=await rE._fromIdTokenResponse(n,o,l);return i||await n._updateCurrentUser(u.user),u}async function Uje(n,e){return Jie(Xg(n),e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Qie(n){const e=Xg(n);e._getPasswordPolicyInternal()&&await e._updatePasswordPolicy()}async function Vje(n,e,i){const o=Xg(n);await yO(o,{requestType:"PASSWORD_RESET",email:e,clientType:"CLIENT_TYPE_WEB"},"getOobCode",Aje)}async function Fje(n,e,i){if(dl(n.app))return Promise.reject(Vf(n));const o=Xg(n),p=await yO(o,{returnSecureToken:!0,email:e,password:i,clientType:"CLIENT_TYPE_WEB"},"signUpPassword",xje).catch(v=>{throw v.code==="auth/password-does-not-meet-requirements"&&Qie(n),v}),y=await rE._fromIdTokenResponse(o,"signIn",p);return await o._updateCurrentUser(y.user),y}function jje(n,e,i){return dl(n.app)?Promise.reject(Vf(n)):Uje(Pi(n),QS.credential(e,i)).catch(async o=>{throw o.code==="auth/password-does-not-meet-requirements"&&Qie(n),o})}async function Zie(n,e){const i=Pi(n),l={requestType:"VERIFY_EMAIL",idToken:await n.getIdToken()},{email:u}=await Ije(i.auth,l);u!==n.email&&await n.reload()}function Bje(n,e,i,o){return Pi(n).onIdTokenChanged(e,i,o)}function zje(n,e,i){return Pi(n).beforeAuthStateChanged(e,i)}function Wje(n,e,i,o){return Pi(n).onAuthStateChanged(e,i,o)}function Gje(n){return Pi(n).signOut()}const vO="__sak";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ese{constructor(e,i){this.storageRetriever=e,this.type=i}_isAvailable(){try{return this.storage?(this.storage.setItem(vO,"1"),this.storage.removeItem(vO),Promise.resolve(!0)):Promise.resolve(!1)}catch{return Promise.resolve(!1)}}_set(e,i){return this.storage.setItem(e,JSON.stringify(i)),Promise.resolve()}_get(e){const i=this.storage.getItem(e);return Promise.resolve(i?JSON.parse(i):null)}_remove(e){return this.storage.removeItem(e),Promise.resolve()}get storage(){return this.storageRetriever()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Hje=1e3,$je=10;class tse extends ese{constructor(){super(()=>window.localStorage,"LOCAL"),this.boundEventHandler=(e,i)=>this.onStorageEvent(e,i),this.listeners={},this.localCache={},this.pollTimer=null,this.fallbackToPolling=Wie(),this._shouldAllowMigration=!0}forAllChangedKeys(e){for(const i of Object.keys(this.listeners)){const o=this.storage.getItem(i),l=this.localCache[i];o!==l&&e(i,l,o)}}onStorageEvent(e,i=!1){if(!e.key){this.forAllChangedKeys((p,y,v)=>{this.notifyListeners(p,v)});return}const o=e.key;i?this.detachListener():this.stopPolling();const l=()=>{const p=this.storage.getItem(o);!i&&this.localCache[o]===p||this.notifyListeners(o,p)},u=this.storage.getItem(o);oje()&&u!==e.newValue&&e.newValue!==e.oldValue?setTimeout(l,$je):l()}notifyListeners(e,i){this.localCache[e]=i;const o=this.listeners[e];if(o)for(const l of Array.from(o))l(i&&JSON.parse(i))}startPolling(){this.stopPolling(),this.pollTimer=setInterval(()=>{this.forAllChangedKeys((e,i,o)=>{this.onStorageEvent(new StorageEvent("storage",{key:e,oldValue:i,newValue:o}),!0)})},Hje)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}attachListener(){window.addEventListener("storage",this.boundEventHandler)}detachListener(){window.removeEventListener("storage",this.boundEventHandler)}_addListener(e,i){Object.keys(this.listeners).length===0&&(this.fallbackToPolling?this.startPolling():this.attachListener()),this.listeners[e]||(this.listeners[e]=new Set,this.localCache[e]=this.storage.getItem(e)),this.listeners[e].add(i)}_removeListener(e,i){this.listeners[e]&&(this.listeners[e].delete(i),this.listeners[e].size===0&&delete this.listeners[e]),Object.keys(this.listeners).length===0&&(this.detachListener(),this.stopPolling())}async _set(e,i){await super._set(e,i),this.localCache[e]=JSON.stringify(i)}async _get(e){const i=await super._get(e);return this.localCache[e]=JSON.stringify(i),i}async _remove(e){await super._remove(e),delete this.localCache[e]}}tse.type="LOCAL";const Kje=tse;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class nse extends ese{constructor(){super(()=>window.sessionStorage,"SESSION")}_addListener(e,i){}_removeListener(e,i){}}nse.type="SESSION";const rse=nse;/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function qje(n){return Promise.all(n.map(async e=>{try{return{fulfilled:!0,value:await e}}catch(i){return{fulfilled:!1,reason:i}}}))}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class CN{constructor(e){this.eventTarget=e,this.handlersMap={},this.boundEventHandler=this.handleEvent.bind(this)}static _getInstance(e){const i=this.receivers.find(l=>l.isListeningto(e));if(i)return i;const o=new CN(e);return this.receivers.push(o),o}isListeningto(e){return this.eventTarget===e}async handleEvent(e){const i=e,{eventId:o,eventType:l,data:u}=i.data,p=this.handlersMap[l];if(!(p!=null&&p.size))return;i.ports[0].postMessage({status:"ack",eventId:o,eventType:l});const y=Array.from(p).map(async w=>w(i.origin,u)),v=await qje(y);i.ports[0].postMessage({status:"done",eventId:o,eventType:l,response:v})}_subscribe(e,i){Object.keys(this.handlersMap).length===0&&this.eventTarget.addEventListener("message",this.boundEventHandler),this.handlersMap[e]||(this.handlersMap[e]=new Set),this.handlersMap[e].add(i)}_unsubscribe(e,i){this.handlersMap[e]&&i&&this.handlersMap[e].delete(i),(!i||this.handlersMap[e].size===0)&&delete this.handlersMap[e],Object.keys(this.handlersMap).length===0&&this.eventTarget.removeEventListener("message",this.boundEventHandler)}}CN.receivers=[];/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function B5(n="",e=10){let i="";for(let o=0;o<e;o++)i+=Math.floor(Math.random()*10);return n+i}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Yje{constructor(e){this.target=e,this.handlers=new Set}removeMessageHandler(e){e.messageChannel&&(e.messageChannel.port1.removeEventListener("message",e.onMessage),e.messageChannel.port1.close()),this.handlers.delete(e)}async _send(e,i,o=50){const l=typeof MessageChannel<"u"?new MessageChannel:null;if(!l)throw new Error("connection_unavailable");let u,p;return new Promise((y,v)=>{const w=B5("",20);l.port1.start();const C=setTimeout(()=>{v(new Error("unsupported_event"))},o);p={messageChannel:l,onMessage(R){const N=R;if(N.data.eventId===w)switch(N.data.status){case"ack":clearTimeout(C),u=setTimeout(()=>{v(new Error("timeout"))},3e3);break;case"done":clearTimeout(u),y(N.data.response);break;default:clearTimeout(C),clearTimeout(u),v(new Error("invalid_response"));break}}},this.handlers.add(p),l.port1.addEventListener("message",p.onMessage),this.target.postMessage({eventType:e,eventId:w,data:i},[l.port2])}).finally(()=>{p&&this.removeMessageHandler(p)})}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ap(){return window}function Xje(n){Ap().location.href=n}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ise(){return typeof Ap().WorkerGlobalScope<"u"&&typeof Ap().importScripts=="function"}async function Jje(){if(!(navigator!=null&&navigator.serviceWorker))return null;try{return(await navigator.serviceWorker.ready).active}catch{return null}}function Qje(){var n;return((n=navigator==null?void 0:navigator.serviceWorker)===null||n===void 0?void 0:n.controller)||null}function Zje(){return ise()?self:null}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const sse="firebaseLocalStorageDb",e5e=1,SO="firebaseLocalStorage",ose="fbase_key";class KR{constructor(e){this.request=e}toPromise(){return new Promise((e,i)=>{this.request.addEventListener("success",()=>{e(this.request.result)}),this.request.addEventListener("error",()=>{i(this.request.error)})})}}function RN(n,e){return n.transaction([SO],e?"readwrite":"readonly").objectStore(SO)}function t5e(){const n=indexedDB.deleteDatabase(sse);return new KR(n).toPromise()}function yF(){const n=indexedDB.open(sse,e5e);return new Promise((e,i)=>{n.addEventListener("error",()=>{i(n.error)}),n.addEventListener("upgradeneeded",()=>{const o=n.result;try{o.createObjectStore(SO,{keyPath:ose})}catch(l){i(l)}}),n.addEventListener("success",async()=>{const o=n.result;o.objectStoreNames.contains(SO)?e(o):(o.close(),await t5e(),e(await yF()))})})}async function RJ(n,e,i){const o=RN(n,!0).put({[ose]:e,value:i});return new KR(o).toPromise()}async function n5e(n,e){const i=RN(n,!1).get(e),o=await new KR(i).toPromise();return o===void 0?null:o.value}function IJ(n,e){const i=RN(n,!0).delete(e);return new KR(i).toPromise()}const r5e=800,i5e=3;class ase{constructor(){this.type="LOCAL",this._shouldAllowMigration=!0,this.listeners={},this.localCache={},this.pollTimer=null,this.pendingWrites=0,this.receiver=null,this.sender=null,this.serviceWorkerReceiverAvailable=!1,this.activeServiceWorker=null,this._workerInitializationPromise=this.initializeServiceWorkerMessaging().then(()=>{},()=>{})}async _openDb(){return this.db?this.db:(this.db=await yF(),this.db)}async _withRetries(e){let i=0;for(;;)try{const o=await this._openDb();return await e(o)}catch(o){if(i++>i5e)throw o;this.db&&(this.db.close(),this.db=void 0)}}async initializeServiceWorkerMessaging(){return ise()?this.initializeReceiver():this.initializeSender()}async initializeReceiver(){this.receiver=CN._getInstance(Zje()),this.receiver._subscribe("keyChanged",async(e,i)=>({keyProcessed:(await this._poll()).includes(i.key)})),this.receiver._subscribe("ping",async(e,i)=>["keyChanged"])}async initializeSender(){var e,i;if(this.activeServiceWorker=await Jje(),!this.activeServiceWorker)return;this.sender=new Yje(this.activeServiceWorker);const o=await this.sender._send("ping",{},800);o&&!((e=o[0])===null||e===void 0)&&e.fulfilled&&!((i=o[0])===null||i===void 0)&&i.value.includes("keyChanged")&&(this.serviceWorkerReceiverAvailable=!0)}async notifyServiceWorker(e){if(!(!this.sender||!this.activeServiceWorker||Qje()!==this.activeServiceWorker))try{await this.sender._send("keyChanged",{key:e},this.serviceWorkerReceiverAvailable?800:50)}catch{}}async _isAvailable(){try{if(!indexedDB)return!1;const e=await yF();return await RJ(e,vO,"1"),await IJ(e,vO),!0}catch{}return!1}async _withPendingWrite(e){this.pendingWrites++;try{await e()}finally{this.pendingWrites--}}async _set(e,i){return this._withPendingWrite(async()=>(await this._withRetries(o=>RJ(o,e,i)),this.localCache[e]=i,this.notifyServiceWorker(e)))}async _get(e){const i=await this._withRetries(o=>n5e(o,e));return this.localCache[e]=i,i}async _remove(e){return this._withPendingWrite(async()=>(await this._withRetries(i=>IJ(i,e)),delete this.localCache[e],this.notifyServiceWorker(e)))}async _poll(){const e=await this._withRetries(l=>{const u=RN(l,!1).getAll();return new KR(u).toPromise()});if(!e)return[];if(this.pendingWrites!==0)return[];const i=[],o=new Set;if(e.length!==0)for(const{fbase_key:l,value:u}of e)o.add(l),JSON.stringify(this.localCache[l])!==JSON.stringify(u)&&(this.notifyListeners(l,u),i.push(l));for(const l of Object.keys(this.localCache))this.localCache[l]&&!o.has(l)&&(this.notifyListeners(l,null),i.push(l));return i}notifyListeners(e,i){this.localCache[e]=i;const o=this.listeners[e];if(o)for(const l of Array.from(o))l(i)}startPolling(){this.stopPolling(),this.pollTimer=setInterval(async()=>this._poll(),r5e)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}_addListener(e,i){Object.keys(this.listeners).length===0&&this.startPolling(),this.listeners[e]||(this.listeners[e]=new Set,this._get(e)),this.listeners[e].add(i)}_removeListener(e,i){this.listeners[e]&&(this.listeners[e].delete(i),this.listeners[e].size===0&&delete this.listeners[e]),Object.keys(this.listeners).length===0&&this.stopPolling()}}ase.type="LOCAL";const s5e=ase;new GR(3e4,6e4);/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function o5e(n,e){return e?Of(e):(qn(n._popupRedirectResolver,n,"argument-error"),n._popupRedirectResolver)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class z5 extends F5{constructor(e){super("custom","custom"),this.params=e}_getIdTokenResponse(e){return fS(e,this._buildIdpRequest())}_linkToIdToken(e,i){return fS(e,this._buildIdpRequest(i))}_getReauthenticationResolver(e){return fS(e,this._buildIdpRequest())}_buildIdpRequest(e){const i={requestUri:this.params.requestUri,sessionId:this.params.sessionId,postBody:this.params.postBody,tenantId:this.params.tenantId,pendingToken:this.params.pendingToken,returnSecureToken:!0,returnIdpCredential:!0};return e&&(i.idToken=e),i}}function a5e(n){return Jie(n.auth,new z5(n),n.bypassAuthState)}function c5e(n){const{auth:e,user:i}=n;return qn(i,e,"internal-error"),Mje(i,new z5(n),n.bypassAuthState)}async function l5e(n){const{auth:e,user:i}=n;return qn(i,e,"internal-error"),Lje(i,new z5(n),n.bypassAuthState)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class cse{constructor(e,i,o,l,u=!1){this.auth=e,this.resolver=o,this.user=l,this.bypassAuthState=u,this.pendingPromise=null,this.eventManager=null,this.filter=Array.isArray(i)?i:[i]}execute(){return new Promise(async(e,i)=>{this.pendingPromise={resolve:e,reject:i};try{this.eventManager=await this.resolver._initialize(this.auth),await this.onExecution(),this.eventManager.registerConsumer(this)}catch(o){this.reject(o)}})}async onAuthEvent(e){const{urlResponse:i,sessionId:o,postBody:l,tenantId:u,error:p,type:y}=e;if(p){this.reject(p);return}const v={auth:this.auth,requestUri:i,sessionId:o,tenantId:u||void 0,postBody:l||void 0,user:this.user,bypassAuthState:this.bypassAuthState};try{this.resolve(await this.getIdpTask(y)(v))}catch(w){this.reject(w)}}onError(e){this.reject(e)}getIdpTask(e){switch(e){case"signInViaPopup":case"signInViaRedirect":return a5e;case"linkViaPopup":case"linkViaRedirect":return l5e;case"reauthViaPopup":case"reauthViaRedirect":return c5e;default:dh(this.auth,"internal-error")}}resolve(e){Kf(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.resolve(e),this.unregisterAndCleanUp()}reject(e){Kf(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.reject(e),this.unregisterAndCleanUp()}unregisterAndCleanUp(){this.eventManager&&this.eventManager.unregisterConsumer(this),this.pendingPromise=null,this.cleanUp()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const u5e=new GR(2e3,1e4);class Y0 extends cse{constructor(e,i,o,l,u){super(e,i,l,u),this.provider=o,this.authWindow=null,this.pollId=null,Y0.currentPopupAction&&Y0.currentPopupAction.cancel(),Y0.currentPopupAction=this}async executeNotNull(){const e=await this.execute();return qn(e,this.auth,"internal-error"),e}async onExecution(){Kf(this.filter.length===1,"Popup operations only handle one event");const e=B5();this.authWindow=await this.resolver._openPopup(this.auth,this.provider,this.filter[0],e),this.authWindow.associatedEvent=e,this.resolver._originValidation(this.auth).catch(i=>{this.reject(i)}),this.resolver._isIframeWebStorageSupported(this.auth,i=>{i||this.reject(Ip(this.auth,"web-storage-unsupported"))}),this.pollUserCancellation()}get eventId(){var e;return((e=this.authWindow)===null||e===void 0?void 0:e.associatedEvent)||null}cancel(){this.reject(Ip(this.auth,"cancelled-popup-request"))}cleanUp(){this.authWindow&&this.authWindow.close(),this.pollId&&window.clearTimeout(this.pollId),this.authWindow=null,this.pollId=null,Y0.currentPopupAction=null}pollUserCancellation(){const e=()=>{var i,o;if(!((o=(i=this.authWindow)===null||i===void 0?void 0:i.window)===null||o===void 0)&&o.closed){this.pollId=window.setTimeout(()=>{this.pollId=null,this.reject(Ip(this.auth,"popup-closed-by-user"))},8e3);return}this.pollId=window.setTimeout(e,u5e.get())};e()}}Y0.currentPopupAction=null;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const d5e="pendingRedirect",Fk=new Map;class h5e extends cse{constructor(e,i,o=!1){super(e,["signInViaRedirect","linkViaRedirect","reauthViaRedirect","unknown"],i,void 0,o),this.eventId=null}async execute(){let e=Fk.get(this.auth._key());if(!e){try{const o=await p5e(this.resolver,this.auth)?await super.execute():null;e=()=>Promise.resolve(o)}catch(i){e=()=>Promise.reject(i)}Fk.set(this.auth._key(),e)}return this.bypassAuthState||Fk.set(this.auth._key(),()=>Promise.resolve(null)),e()}async onAuthEvent(e){if(e.type==="signInViaRedirect")return super.onAuthEvent(e);if(e.type==="unknown"){this.resolve(null);return}if(e.eventId){const i=await this.auth._redirectUserForId(e.eventId);if(i)return this.user=i,super.onAuthEvent(e);this.resolve(null)}}async onExecution(){}cleanUp(){}}async function p5e(n,e){const i=g5e(e),o=m5e(n);if(!await o._isAvailable())return!1;const l=await o._get(i)==="true";return await o._remove(i),l}function f5e(n,e){Fk.set(n._key(),e)}function m5e(n){return Of(n._redirectPersistence)}function g5e(n){return Vk(d5e,n.config.apiKey,n.name)}async function _5e(n,e,i=!1){if(dl(n.app))return Promise.reject(Vf(n));const o=Xg(n),l=o5e(o,e),p=await new h5e(o,l,i).execute();return p&&!i&&(delete p.user._redirectEventId,await o._persistUserIfCurrent(p.user),await o._setRedirectUser(null,e)),p}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const y5e=10*60*1e3;class E5e{constructor(e){this.auth=e,this.cachedEventUids=new Set,this.consumers=new Set,this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1,this.lastProcessedEventTime=Date.now()}registerConsumer(e){this.consumers.add(e),this.queuedRedirectEvent&&this.isEventForConsumer(this.queuedRedirectEvent,e)&&(this.sendToConsumer(this.queuedRedirectEvent,e),this.saveEventToCache(this.queuedRedirectEvent),this.queuedRedirectEvent=null)}unregisterConsumer(e){this.consumers.delete(e)}onEvent(e){if(this.hasEventBeenHandled(e))return!1;let i=!1;return this.consumers.forEach(o=>{this.isEventForConsumer(e,o)&&(i=!0,this.sendToConsumer(e,o),this.saveEventToCache(e))}),this.hasHandledPotentialRedirect||!v5e(e)||(this.hasHandledPotentialRedirect=!0,i||(this.queuedRedirectEvent=e,i=!0)),i}sendToConsumer(e,i){var o;if(e.error&&!lse(e)){const l=((o=e.error.code)===null||o===void 0?void 0:o.split("auth/")[1])||"internal-error";i.onError(Ip(this.auth,l))}else i.onAuthEvent(e)}isEventForConsumer(e,i){const o=i.eventId===null||!!e.eventId&&e.eventId===i.eventId;return i.filter.includes(e.type)&&o}hasEventBeenHandled(e){return Date.now()-this.lastProcessedEventTime>=y5e&&this.cachedEventUids.clear(),this.cachedEventUids.has(AJ(e))}saveEventToCache(e){this.cachedEventUids.add(AJ(e)),this.lastProcessedEventTime=Date.now()}}function AJ(n){return[n.type,n.eventId,n.sessionId,n.tenantId].filter(e=>e).join("-")}function lse({type:n,error:e}){return n==="unknown"&&(e==null?void 0:e.code)==="auth/no-auth-event"}function v5e(n){switch(n.type){case"signInViaRedirect":case"linkViaRedirect":case"reauthViaRedirect":return!0;case"unknown":return lse(n);default:return!1}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function S5e(n,e={}){return Zf(n,"GET","/v1/projects",e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const b5e=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,w5e=/^https?/;async function T5e(n){if(n.config.emulator)return;const{authorizedDomains:e}=await S5e(n);for(const i of e)try{if(C5e(i))return}catch{}dh(n,"unauthorized-domain")}function C5e(n){const e=gF(),{protocol:i,hostname:o}=new URL(e);if(n.startsWith("chrome-extension://")){const p=new URL(n);return p.hostname===""&&o===""?i==="chrome-extension:"&&n.replace("chrome-extension://","")===e.replace("chrome-extension://",""):i==="chrome-extension:"&&p.hostname===o}if(!w5e.test(i))return!1;if(b5e.test(n))return o===n;const l=n.replace(/\./g,"\\.");return new RegExp("^(.+\\."+l+"|"+l+")$","i").test(o)}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const R5e=new GR(3e4,6e4);function PJ(){const n=Ap().___jsl;if(n!=null&&n.H){for(const e of Object.keys(n.H))if(n.H[e].r=n.H[e].r||[],n.H[e].L=n.H[e].L||[],n.H[e].r=[...n.H[e].L],n.CP)for(let i=0;i<n.CP.length;i++)n.CP[i]=null}}function I5e(n){return new Promise((e,i)=>{var o,l,u;function p(){PJ(),gapi.load("gapi.iframes",{callback:()=>{e(gapi.iframes.getContext())},ontimeout:()=>{PJ(),i(Ip(n,"network-request-failed"))},timeout:R5e.get()})}if(!((l=(o=Ap().gapi)===null||o===void 0?void 0:o.iframes)===null||l===void 0)&&l.Iframe)e(gapi.iframes.getContext());else if(!((u=Ap().gapi)===null||u===void 0)&&u.load)p();else{const y=mje("iframefcb");return Ap()[y]=()=>{gapi.load?p():i(Ip(n,"network-request-failed"))},Hie(`${fje()}?onload=${y}`).catch(v=>i(v))}}).catch(e=>{throw jk=null,e})}let jk=null;function A5e(n){return jk=jk||I5e(n),jk}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const P5e=new GR(5e3,15e3),k5e="__/auth/iframe",O5e="emulator/auth/iframe",N5e={style:{position:"absolute",top:"-100px",width:"1px",height:"1px"},"aria-hidden":"true",tabindex:"-1"},D5e=new Map([["identitytoolkit.googleapis.com","p"],["staging-identitytoolkit.sandbox.googleapis.com","s"],["test-identitytoolkit.sandbox.googleapis.com","t"]]);function x5e(n){const e=n.config;qn(e.authDomain,n,"auth-domain-config-required");const i=e.emulator?M5(e,O5e):`https://${n.config.authDomain}/${k5e}`,o={apiKey:e.apiKey,appName:n.name,v:uE},l=D5e.get(n.config.apiHost);l&&(o.eid=l);const u=n._getFrameworks();return u.length&&(o.fw=u.join(",")),`${i}?${zR(o).slice(1)}`}async function L5e(n){const e=await A5e(n),i=Ap().gapi;return qn(i,n,"internal-error"),e.open({where:document.body,url:x5e(n),messageHandlersFilter:i.iframes.CROSS_ORIGIN_IFRAMES_FILTER,attributes:N5e,dontclear:!0},o=>new Promise(async(l,u)=>{await o.restyle({setHideOnLeave:!1});const p=Ip(n,"network-request-failed"),y=Ap().setTimeout(()=>{u(p)},P5e.get());function v(){Ap().clearTimeout(y),l(o)}o.ping(v).then(v,()=>{u(p)})}))}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const M5e={location:"yes",resizable:"yes",statusbar:"yes",toolbar:"no"},U5e=500,V5e=600,F5e="_blank",j5e="http://localhost";class kJ{constructor(e){this.window=e,this.associatedEvent=null}close(){if(this.window)try{this.window.close()}catch{}}}function B5e(n,e,i,o=U5e,l=V5e){const u=Math.max((window.screen.availHeight-l)/2,0).toString(),p=Math.max((window.screen.availWidth-o)/2,0).toString();let y="";const v=Object.assign(Object.assign({},M5e),{width:o.toString(),height:l.toString(),top:u,left:p}),w=cc().toLowerCase();i&&(y=Vie(w)?F5e:i),Mie(w)&&(e=e||j5e,v.scrollbars="yes");const C=Object.entries(v).reduce((N,[M,L])=>`${N}${M}=${L},`,"");if(sje(w)&&y!=="_self")return z5e(e||"",y),new kJ(null);const R=window.open(e||"",y,C);qn(R,n,"popup-blocked");try{R.focus()}catch{}return new kJ(R)}function z5e(n,e){const i=document.createElement("a");i.href=n,i.target=e;const o=document.createEvent("MouseEvent");o.initMouseEvent("click",!0,!0,window,1,0,0,0,0,!1,!1,!1,!1,1,null),i.dispatchEvent(o)}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const W5e="__/auth/handler",G5e="emulator/auth/handler",H5e=encodeURIComponent("fac");async function OJ(n,e,i,o,l,u){qn(n.config.authDomain,n,"auth-domain-config-required"),qn(n.config.apiKey,n,"invalid-api-key");const p={apiKey:n.config.apiKey,appName:n.name,authType:i,redirectUrl:o,v:uE,eventId:l};if(e instanceof Yie){e.setDefaultLanguage(n.languageCode),p.providerId=e.providerId||"",AVe(e.getCustomParameters())||(p.customParameters=JSON.stringify(e.getCustomParameters()));for(const[C,R]of Object.entries({}))p[C]=R}if(e instanceof $R){const C=e.getScopes().filter(R=>R!=="");C.length>0&&(p.scopes=C.join(","))}n.tenantId&&(p.tid=n.tenantId);const y=p;for(const C of Object.keys(y))y[C]===void 0&&delete y[C];const v=await n._getAppCheckToken(),w=v?`#${H5e}=${encodeURIComponent(v)}`:"";return`${$5e(n)}?${zR(y).slice(1)}${w}`}function $5e({config:n}){return n.emulator?M5(n,G5e):`https://${n.authDomain}/${W5e}`}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const eV="webStorageSupport";class K5e{constructor(){this.eventManagers={},this.iframes={},this.originValidationPromises={},this._redirectPersistence=rse,this._completeRedirectFn=_5e,this._overrideRedirectResult=f5e}async _openPopup(e,i,o,l){var u;Kf((u=this.eventManagers[e._key()])===null||u===void 0?void 0:u.manager,"_initialize() not called before _openPopup()");const p=await OJ(e,i,o,gF(),l);return B5e(e,p,B5())}async _openRedirect(e,i,o,l){await this._originValidation(e);const u=await OJ(e,i,o,gF(),l);return Xje(u),new Promise(()=>{})}_initialize(e){const i=e._key();if(this.eventManagers[i]){const{manager:l,promise:u}=this.eventManagers[i];return l?Promise.resolve(l):(Kf(u,"If manager is not set, promise should be"),u)}const o=this.initAndGetManager(e);return this.eventManagers[i]={promise:o},o.catch(()=>{delete this.eventManagers[i]}),o}async initAndGetManager(e){const i=await L5e(e),o=new E5e(e);return i.register("authEvent",l=>(qn(l==null?void 0:l.authEvent,e,"invalid-auth-event"),{status:o.onEvent(l.authEvent)?"ACK":"ERROR"}),gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER),this.eventManagers[e._key()]={manager:o},this.iframes[e._key()]=i,o}_isIframeWebStorageSupported(e,i){this.iframes[e._key()].send(eV,{type:eV},l=>{var u;const p=(u=l==null?void 0:l[0])===null||u===void 0?void 0:u[eV];p!==void 0&&i(!!p),dh(e,"internal-error")},gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER)}_originValidation(e){const i=e._key();return this.originValidationPromises[i]||(this.originValidationPromises[i]=T5e(e)),this.originValidationPromises[i]}get _shouldInitProactively(){return Wie()||Uie()||V5()}}const q5e=K5e;var NJ="@firebase/auth",DJ="1.9.1";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Y5e{constructor(e){this.auth=e,this.internalListeners=new Map}getUid(){var e;return this.assertAuthConfigured(),((e=this.auth.currentUser)===null||e===void 0?void 0:e.uid)||null}async getToken(e){return this.assertAuthConfigured(),await this.auth._initializationPromise,this.auth.currentUser?{accessToken:await this.auth.currentUser.getIdToken(e)}:null}addAuthTokenListener(e){if(this.assertAuthConfigured(),this.internalListeners.has(e))return;const i=this.auth.onIdTokenChanged(o=>{e((o==null?void 0:o.stsTokenManager.accessToken)||null)});this.internalListeners.set(e,i),this.updateProactiveRefresh()}removeAuthTokenListener(e){this.assertAuthConfigured();const i=this.internalListeners.get(e);i&&(this.internalListeners.delete(e),i(),this.updateProactiveRefresh())}assertAuthConfigured(){qn(this.auth._initializationPromise,"dependent-sdk-initialized-before-auth")}updateProactiveRefresh(){this.internalListeners.size>0?this.auth._startProactiveRefresh():this.auth._stopProactiveRefresh()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function X5e(n){switch(n){case"Node":return"node";case"ReactNative":return"rn";case"Worker":return"webworker";case"Cordova":return"cordova";case"WebExtension":return"web-extension";default:return}}function J5e(n){Vg(new Hf("auth",(e,{options:i})=>{const o=e.getProvider("app").getImmediate(),l=e.getProvider("heartbeat"),u=e.getProvider("app-check-internal"),{apiKey:p,authDomain:y}=o.options;qn(p&&!p.includes(":"),"invalid-api-key",{appName:o.name});const v={apiKey:p,authDomain:y,clientPlatform:n,apiHost:"identitytoolkit.googleapis.com",tokenApiHost:"securetoken.googleapis.com",apiScheme:"https",sdkClientVersion:Gie(n)},w=new dje(o,l,u,v);return Sje(w,i),w},"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((e,i,o)=>{e.getProvider("auth-internal").initialize()})),Vg(new Hf("auth-internal",e=>{const i=Xg(e.getProvider("auth").getImmediate());return(o=>new Y5e(o))(i)},"PRIVATE").setInstantiationMode("EXPLICIT")),nd(NJ,DJ,X5e(n)),nd(NJ,DJ,"esm2017")}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Q5e=5*60,Z5e=vie("authIdTokenMaxAge")||Q5e;let xJ=null;const e3e=n=>async e=>{const i=e&&await e.getIdTokenResult(),o=i&&(new Date().getTime()-Date.parse(i.issuedAtTime))/1e3;if(o&&o>Z5e)return;const l=i==null?void 0:i.token;xJ!==l&&(xJ=l,await fetch(n,{method:l?"POST":"DELETE",headers:l?{Authorization:`Bearer ${l}`}:{}}))};function IN(n=wN()){const e=WR(n,"auth");if(e.isInitialized())return e.getImmediate();const i=vje(n,{popupRedirectResolver:q5e,persistence:[s5e,Kje,rse]}),o=vie("authTokenSyncURL");if(o&&typeof isSecureContext=="boolean"&&isSecureContext){const u=new URL(o,location.origin);if(location.origin===u.origin){const p=e3e(u.toString());zje(i,p,()=>p(i.currentUser)),Bje(i,y=>p(y))}}const l=yie("auth");return l&&bje(i,`http://${l}`),i}function t3e(){var n,e;return(e=(n=document.getElementsByTagName("head"))===null||n===void 0?void 0:n[0])!==null&&e!==void 0?e:document}hje({loadJS(n){return new Promise((e,i)=>{const o=document.createElement("script");o.setAttribute("src",n),o.onload=e,o.onerror=l=>{const u=Ip("internal-error");u.customData=l,i(u)},o.type="text/javascript",o.charset="UTF-8",t3e().appendChild(o)})},gapiScript:"https://apis.google.com/js/api.js",recaptchaV2Script:"https://www.google.com/recaptcha/api.js",recaptchaEnterpriseScript:"https://www.google.com/recaptcha/enterprise.js?render="});J5e("Browser");var LJ=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};/** @license
Copyright The Closure Library Authors.
SPDX-License-Identifier: Apache-2.0
*/var Ng,use;(function(){var n;/** @license

 Copyright The Closure Library Authors.
 SPDX-License-Identifier: Apache-2.0
*/function e(H,X){function Q(){}Q.prototype=X.prototype,H.D=X.prototype,H.prototype=new Q,H.prototype.constructor=H,H.C=function(ne,he,fe){for(var de=Array(arguments.length-2),ke=2;ke<arguments.length;ke++)de[ke-2]=arguments[ke];return X.prototype[he].apply(ne,de)}}function i(){this.blockSize=-1}function o(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.B=Array(this.blockSize),this.o=this.h=0,this.s()}e(o,i),o.prototype.s=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.o=this.h=0};function l(H,X,Q){Q||(Q=0);var ne=Array(16);if(typeof X=="string")for(var he=0;16>he;++he)ne[he]=X.charCodeAt(Q++)|X.charCodeAt(Q++)<<8|X.charCodeAt(Q++)<<16|X.charCodeAt(Q++)<<24;else for(he=0;16>he;++he)ne[he]=X[Q++]|X[Q++]<<8|X[Q++]<<16|X[Q++]<<24;X=H.g[0],Q=H.g[1],he=H.g[2];var fe=H.g[3],de=X+(fe^Q&(he^fe))+ne[0]+3614090360&4294967295;X=Q+(de<<7&4294967295|de>>>25),de=fe+(he^X&(Q^he))+ne[1]+3905402710&4294967295,fe=X+(de<<12&4294967295|de>>>20),de=he+(Q^fe&(X^Q))+ne[2]+606105819&4294967295,he=fe+(de<<17&4294967295|de>>>15),de=Q+(X^he&(fe^X))+ne[3]+3250441966&4294967295,Q=he+(de<<22&4294967295|de>>>10),de=X+(fe^Q&(he^fe))+ne[4]+4118548399&4294967295,X=Q+(de<<7&4294967295|de>>>25),de=fe+(he^X&(Q^he))+ne[5]+1200080426&4294967295,fe=X+(de<<12&4294967295|de>>>20),de=he+(Q^fe&(X^Q))+ne[6]+2821735955&4294967295,he=fe+(de<<17&4294967295|de>>>15),de=Q+(X^he&(fe^X))+ne[7]+4249261313&4294967295,Q=he+(de<<22&4294967295|de>>>10),de=X+(fe^Q&(he^fe))+ne[8]+1770035416&4294967295,X=Q+(de<<7&4294967295|de>>>25),de=fe+(he^X&(Q^he))+ne[9]+2336552879&4294967295,fe=X+(de<<12&4294967295|de>>>20),de=he+(Q^fe&(X^Q))+ne[10]+4294925233&4294967295,he=fe+(de<<17&4294967295|de>>>15),de=Q+(X^he&(fe^X))+ne[11]+2304563134&4294967295,Q=he+(de<<22&4294967295|de>>>10),de=X+(fe^Q&(he^fe))+ne[12]+1804603682&4294967295,X=Q+(de<<7&4294967295|de>>>25),de=fe+(he^X&(Q^he))+ne[13]+4254626195&4294967295,fe=X+(de<<12&4294967295|de>>>20),de=he+(Q^fe&(X^Q))+ne[14]+2792965006&4294967295,he=fe+(de<<17&4294967295|de>>>15),de=Q+(X^he&(fe^X))+ne[15]+1236535329&4294967295,Q=he+(de<<22&4294967295|de>>>10),de=X+(he^fe&(Q^he))+ne[1]+4129170786&4294967295,X=Q+(de<<5&4294967295|de>>>27),de=fe+(Q^he&(X^Q))+ne[6]+3225465664&4294967295,fe=X+(de<<9&4294967295|de>>>23),de=he+(X^Q&(fe^X))+ne[11]+643717713&4294967295,he=fe+(de<<14&4294967295|de>>>18),de=Q+(fe^X&(he^fe))+ne[0]+3921069994&4294967295,Q=he+(de<<20&4294967295|de>>>12),de=X+(he^fe&(Q^he))+ne[5]+3593408605&4294967295,X=Q+(de<<5&4294967295|de>>>27),de=fe+(Q^he&(X^Q))+ne[10]+38016083&4294967295,fe=X+(de<<9&4294967295|de>>>23),de=he+(X^Q&(fe^X))+ne[15]+3634488961&4294967295,he=fe+(de<<14&4294967295|de>>>18),de=Q+(fe^X&(he^fe))+ne[4]+3889429448&4294967295,Q=he+(de<<20&4294967295|de>>>12),de=X+(he^fe&(Q^he))+ne[9]+568446438&4294967295,X=Q+(de<<5&4294967295|de>>>27),de=fe+(Q^he&(X^Q))+ne[14]+3275163606&4294967295,fe=X+(de<<9&4294967295|de>>>23),de=he+(X^Q&(fe^X))+ne[3]+4107603335&4294967295,he=fe+(de<<14&4294967295|de>>>18),de=Q+(fe^X&(he^fe))+ne[8]+1163531501&4294967295,Q=he+(de<<20&4294967295|de>>>12),de=X+(he^fe&(Q^he))+ne[13]+2850285829&4294967295,X=Q+(de<<5&4294967295|de>>>27),de=fe+(Q^he&(X^Q))+ne[2]+4243563512&4294967295,fe=X+(de<<9&4294967295|de>>>23),de=he+(X^Q&(fe^X))+ne[7]+1735328473&4294967295,he=fe+(de<<14&4294967295|de>>>18),de=Q+(fe^X&(he^fe))+ne[12]+2368359562&4294967295,Q=he+(de<<20&4294967295|de>>>12),de=X+(Q^he^fe)+ne[5]+4294588738&4294967295,X=Q+(de<<4&4294967295|de>>>28),de=fe+(X^Q^he)+ne[8]+2272392833&4294967295,fe=X+(de<<11&4294967295|de>>>21),de=he+(fe^X^Q)+ne[11]+1839030562&4294967295,he=fe+(de<<16&4294967295|de>>>16),de=Q+(he^fe^X)+ne[14]+4259657740&4294967295,Q=he+(de<<23&4294967295|de>>>9),de=X+(Q^he^fe)+ne[1]+2763975236&4294967295,X=Q+(de<<4&4294967295|de>>>28),de=fe+(X^Q^he)+ne[4]+1272893353&4294967295,fe=X+(de<<11&4294967295|de>>>21),de=he+(fe^X^Q)+ne[7]+4139469664&4294967295,he=fe+(de<<16&4294967295|de>>>16),de=Q+(he^fe^X)+ne[10]+3200236656&4294967295,Q=he+(de<<23&4294967295|de>>>9),de=X+(Q^he^fe)+ne[13]+681279174&4294967295,X=Q+(de<<4&4294967295|de>>>28),de=fe+(X^Q^he)+ne[0]+3936430074&4294967295,fe=X+(de<<11&4294967295|de>>>21),de=he+(fe^X^Q)+ne[3]+3572445317&4294967295,he=fe+(de<<16&4294967295|de>>>16),de=Q+(he^fe^X)+ne[6]+76029189&4294967295,Q=he+(de<<23&4294967295|de>>>9),de=X+(Q^he^fe)+ne[9]+3654602809&4294967295,X=Q+(de<<4&4294967295|de>>>28),de=fe+(X^Q^he)+ne[12]+3873151461&4294967295,fe=X+(de<<11&4294967295|de>>>21),de=he+(fe^X^Q)+ne[15]+530742520&4294967295,he=fe+(de<<16&4294967295|de>>>16),de=Q+(he^fe^X)+ne[2]+3299628645&4294967295,Q=he+(de<<23&4294967295|de>>>9),de=X+(he^(Q|~fe))+ne[0]+4096336452&4294967295,X=Q+(de<<6&4294967295|de>>>26),de=fe+(Q^(X|~he))+ne[7]+1126891415&4294967295,fe=X+(de<<10&4294967295|de>>>22),de=he+(X^(fe|~Q))+ne[14]+2878612391&4294967295,he=fe+(de<<15&4294967295|de>>>17),de=Q+(fe^(he|~X))+ne[5]+4237533241&4294967295,Q=he+(de<<21&4294967295|de>>>11),de=X+(he^(Q|~fe))+ne[12]+1700485571&4294967295,X=Q+(de<<6&4294967295|de>>>26),de=fe+(Q^(X|~he))+ne[3]+2399980690&4294967295,fe=X+(de<<10&4294967295|de>>>22),de=he+(X^(fe|~Q))+ne[10]+4293915773&4294967295,he=fe+(de<<15&4294967295|de>>>17),de=Q+(fe^(he|~X))+ne[1]+2240044497&4294967295,Q=he+(de<<21&4294967295|de>>>11),de=X+(he^(Q|~fe))+ne[8]+1873313359&4294967295,X=Q+(de<<6&4294967295|de>>>26),de=fe+(Q^(X|~he))+ne[15]+4264355552&4294967295,fe=X+(de<<10&4294967295|de>>>22),de=he+(X^(fe|~Q))+ne[6]+2734768916&4294967295,he=fe+(de<<15&4294967295|de>>>17),de=Q+(fe^(he|~X))+ne[13]+1309151649&4294967295,Q=he+(de<<21&4294967295|de>>>11),de=X+(he^(Q|~fe))+ne[4]+4149444226&4294967295,X=Q+(de<<6&4294967295|de>>>26),de=fe+(Q^(X|~he))+ne[11]+3174756917&4294967295,fe=X+(de<<10&4294967295|de>>>22),de=he+(X^(fe|~Q))+ne[2]+718787259&4294967295,he=fe+(de<<15&4294967295|de>>>17),de=Q+(fe^(he|~X))+ne[9]+3951481745&4294967295,H.g[0]=H.g[0]+X&4294967295,H.g[1]=H.g[1]+(he+(de<<21&4294967295|de>>>11))&4294967295,H.g[2]=H.g[2]+he&4294967295,H.g[3]=H.g[3]+fe&4294967295}o.prototype.u=function(H,X){X===void 0&&(X=H.length);for(var Q=X-this.blockSize,ne=this.B,he=this.h,fe=0;fe<X;){if(he==0)for(;fe<=Q;)l(this,H,fe),fe+=this.blockSize;if(typeof H=="string"){for(;fe<X;)if(ne[he++]=H.charCodeAt(fe++),he==this.blockSize){l(this,ne),he=0;break}}else for(;fe<X;)if(ne[he++]=H[fe++],he==this.blockSize){l(this,ne),he=0;break}}this.h=he,this.o+=X},o.prototype.v=function(){var H=Array((56>this.h?this.blockSize:2*this.blockSize)-this.h);H[0]=128;for(var X=1;X<H.length-8;++X)H[X]=0;var Q=8*this.o;for(X=H.length-8;X<H.length;++X)H[X]=Q&255,Q/=256;for(this.u(H),H=Array(16),X=Q=0;4>X;++X)for(var ne=0;32>ne;ne+=8)H[Q++]=this.g[X]>>>ne&255;return H};function u(H,X){var Q=y;return Object.prototype.hasOwnProperty.call(Q,H)?Q[H]:Q[H]=X(H)}function p(H,X){this.h=X;for(var Q=[],ne=!0,he=H.length-1;0<=he;he--){var fe=H[he]|0;ne&&fe==X||(Q[he]=fe,ne=!1)}this.g=Q}var y={};function v(H){return-128<=H&&128>H?u(H,function(X){return new p([X|0],0>X?-1:0)}):new p([H|0],0>H?-1:0)}function w(H){if(isNaN(H)||!isFinite(H))return R;if(0>H)return z(w(-H));for(var X=[],Q=1,ne=0;H>=Q;ne++)X[ne]=H/Q|0,Q*=4294967296;return new p(X,0)}function C(H,X){if(H.length==0)throw Error("number format error: empty string");if(X=X||10,2>X||36<X)throw Error("radix out of range: "+X);if(H.charAt(0)=="-")return z(C(H.substring(1),X));if(0<=H.indexOf("-"))throw Error('number format error: interior "-" character');for(var Q=w(Math.pow(X,8)),ne=R,he=0;he<H.length;he+=8){var fe=Math.min(8,H.length-he),de=parseInt(H.substring(he,he+fe),X);8>fe?(fe=w(Math.pow(X,fe)),ne=ne.j(fe).add(w(de))):(ne=ne.j(Q),ne=ne.add(w(de)))}return ne}var R=v(0),N=v(1),M=v(16777216);n=p.prototype,n.m=function(){if(U(this))return-z(this).m();for(var H=0,X=1,Q=0;Q<this.g.length;Q++){var ne=this.i(Q);H+=(0<=ne?ne:4294967296+ne)*X,X*=4294967296}return H},n.toString=function(H){if(H=H||10,2>H||36<H)throw Error("radix out of range: "+H);if(L(this))return"0";if(U(this))return"-"+z(this).toString(H);for(var X=w(Math.pow(H,6)),Q=this,ne="";;){var he=ce(Q,X).g;Q=J(Q,he.j(X));var fe=((0<Q.g.length?Q.g[0]:Q.h)>>>0).toString(H);if(Q=he,L(Q))return fe+ne;for(;6>fe.length;)fe="0"+fe;ne=fe+ne}},n.i=function(H){return 0>H?0:H<this.g.length?this.g[H]:this.h};function L(H){if(H.h!=0)return!1;for(var X=0;X<H.g.length;X++)if(H.g[X]!=0)return!1;return!0}function U(H){return H.h==-1}n.l=function(H){return H=J(this,H),U(H)?-1:L(H)?0:1};function z(H){for(var X=H.g.length,Q=[],ne=0;ne<X;ne++)Q[ne]=~H.g[ne];return new p(Q,~H.h).add(N)}n.abs=function(){return U(this)?z(this):this},n.add=function(H){for(var X=Math.max(this.g.length,H.g.length),Q=[],ne=0,he=0;he<=X;he++){var fe=ne+(this.i(he)&65535)+(H.i(he)&65535),de=(fe>>>16)+(this.i(he)>>>16)+(H.i(he)>>>16);ne=de>>>16,fe&=65535,de&=65535,Q[he]=de<<16|fe}return new p(Q,Q[Q.length-1]&-2147483648?-1:0)};function J(H,X){return H.add(z(X))}n.j=function(H){if(L(this)||L(H))return R;if(U(this))return U(H)?z(this).j(z(H)):z(z(this).j(H));if(U(H))return z(this.j(z(H)));if(0>this.l(M)&&0>H.l(M))return w(this.m()*H.m());for(var X=this.g.length+H.g.length,Q=[],ne=0;ne<2*X;ne++)Q[ne]=0;for(ne=0;ne<this.g.length;ne++)for(var he=0;he<H.g.length;he++){var fe=this.i(ne)>>>16,de=this.i(ne)&65535,ke=H.i(he)>>>16,De=H.i(he)&65535;Q[2*ne+2*he]+=de*De,q(Q,2*ne+2*he),Q[2*ne+2*he+1]+=fe*De,q(Q,2*ne+2*he+1),Q[2*ne+2*he+1]+=de*ke,q(Q,2*ne+2*he+1),Q[2*ne+2*he+2]+=fe*ke,q(Q,2*ne+2*he+2)}for(ne=0;ne<X;ne++)Q[ne]=Q[2*ne+1]<<16|Q[2*ne];for(ne=X;ne<2*X;ne++)Q[ne]=0;return new p(Q,0)};function q(H,X){for(;(H[X]&65535)!=H[X];)H[X+1]+=H[X]>>>16,H[X]&=65535,X++}function re(H,X){this.g=H,this.h=X}function ce(H,X){if(L(X))throw Error("division by zero");if(L(H))return new re(R,R);if(U(H))return X=ce(z(H),X),new re(z(X.g),z(X.h));if(U(X))return X=ce(H,z(X)),new re(z(X.g),X.h);if(30<H.g.length){if(U(H)||U(X))throw Error("slowDivide_ only works with positive integers.");for(var Q=N,ne=X;0>=ne.l(H);)Q=ae(Q),ne=ae(ne);var he=pe(Q,1),fe=pe(ne,1);for(ne=pe(ne,2),Q=pe(Q,2);!L(ne);){var de=fe.add(ne);0>=de.l(H)&&(he=he.add(Q),fe=de),ne=pe(ne,1),Q=pe(Q,1)}return X=J(H,he.j(X)),new re(he,X)}for(he=R;0<=H.l(X);){for(Q=Math.max(1,Math.floor(H.m()/X.m())),ne=Math.ceil(Math.log(Q)/Math.LN2),ne=48>=ne?1:Math.pow(2,ne-48),fe=w(Q),de=fe.j(X);U(de)||0<de.l(H);)Q-=ne,fe=w(Q),de=fe.j(X);L(fe)&&(fe=N),he=he.add(fe),H=J(H,de)}return new re(he,H)}n.A=function(H){return ce(this,H).h},n.and=function(H){for(var X=Math.max(this.g.length,H.g.length),Q=[],ne=0;ne<X;ne++)Q[ne]=this.i(ne)&H.i(ne);return new p(Q,this.h&H.h)},n.or=function(H){for(var X=Math.max(this.g.length,H.g.length),Q=[],ne=0;ne<X;ne++)Q[ne]=this.i(ne)|H.i(ne);return new p(Q,this.h|H.h)},n.xor=function(H){for(var X=Math.max(this.g.length,H.g.length),Q=[],ne=0;ne<X;ne++)Q[ne]=this.i(ne)^H.i(ne);return new p(Q,this.h^H.h)};function ae(H){for(var X=H.g.length+1,Q=[],ne=0;ne<X;ne++)Q[ne]=H.i(ne)<<1|H.i(ne-1)>>>31;return new p(Q,H.h)}function pe(H,X){var Q=X>>5;X%=32;for(var ne=H.g.length-Q,he=[],fe=0;fe<ne;fe++)he[fe]=0<X?H.i(fe+Q)>>>X|H.i(fe+Q+1)<<32-X:H.i(fe+Q);return new p(he,H.h)}o.prototype.digest=o.prototype.v,o.prototype.reset=o.prototype.s,o.prototype.update=o.prototype.u,use=o,p.prototype.add=p.prototype.add,p.prototype.multiply=p.prototype.j,p.prototype.modulo=p.prototype.A,p.prototype.compare=p.prototype.l,p.prototype.toNumber=p.prototype.m,p.prototype.toString=p.prototype.toString,p.prototype.getBits=p.prototype.i,p.fromNumber=w,p.fromString=C,Ng=p}).apply(typeof LJ<"u"?LJ:typeof self<"u"?self:typeof window<"u"?window:{});var ik=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};/** @license
Copyright The Closure Library Authors.
SPDX-License-Identifier: Apache-2.0
*/var dse,_C,hse,Bk,EF,pse,fse,mse;(function(){var n,e=typeof Object.defineProperties=="function"?Object.defineProperty:function(P,G,ie){return P==Array.prototype||P==Object.prototype||(P[G]=ie.value),P};function i(P){P=[typeof globalThis=="object"&&globalThis,P,typeof window=="object"&&window,typeof self=="object"&&self,typeof ik=="object"&&ik];for(var G=0;G<P.length;++G){var ie=P[G];if(ie&&ie.Math==Math)return ie}throw Error("Cannot find global object")}var o=i(this);function l(P,G){if(G)e:{var ie=o;P=P.split(".");for(var Ee=0;Ee<P.length-1;Ee++){var Ke=P[Ee];if(!(Ke in ie))break e;ie=ie[Ke]}P=P[P.length-1],Ee=ie[P],G=G(Ee),G!=Ee&&G!=null&&e(ie,P,{configurable:!0,writable:!0,value:G})}}function u(P,G){P instanceof String&&(P+="");var ie=0,Ee=!1,Ke={next:function(){if(!Ee&&ie<P.length){var dt=ie++;return{value:G(dt,P[dt]),done:!1}}return Ee=!0,{done:!0,value:void 0}}};return Ke[Symbol.iterator]=function(){return Ke},Ke}l("Array.prototype.values",function(P){return P||function(){return u(this,function(G,ie){return ie})}});/** @license

 Copyright The Closure Library Authors.
 SPDX-License-Identifier: Apache-2.0
*/var p=p||{},y=this||self;function v(P){var G=typeof P;return G=G!="object"?G:P?Array.isArray(P)?"array":G:"null",G=="array"||G=="object"&&typeof P.length=="number"}function w(P){var G=typeof P;return G=="object"&&P!=null||G=="function"}function C(P,G,ie){return P.call.apply(P.bind,arguments)}function R(P,G,ie){if(!P)throw Error();if(2<arguments.length){var Ee=Array.prototype.slice.call(arguments,2);return function(){var Ke=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(Ke,Ee),P.apply(G,Ke)}}return function(){return P.apply(G,arguments)}}function N(P,G,ie){return N=Function.prototype.bind&&Function.prototype.bind.toString().indexOf("native code")!=-1?C:R,N.apply(null,arguments)}function M(P,G){var ie=Array.prototype.slice.call(arguments,1);return function(){var Ee=ie.slice();return Ee.push.apply(Ee,arguments),P.apply(this,Ee)}}function L(P,G){function ie(){}ie.prototype=G.prototype,P.aa=G.prototype,P.prototype=new ie,P.prototype.constructor=P,P.Qb=function(Ee,Ke,dt){for(var $t=Array(arguments.length-2),oi=2;oi<arguments.length;oi++)$t[oi-2]=arguments[oi];return G.prototype[Ke].apply(Ee,$t)}}function U(P){const G=P.length;if(0<G){const ie=Array(G);for(let Ee=0;Ee<G;Ee++)ie[Ee]=P[Ee];return ie}return[]}function z(P,G){for(let ie=1;ie<arguments.length;ie++){const Ee=arguments[ie];if(v(Ee)){const Ke=P.length||0,dt=Ee.length||0;P.length=Ke+dt;for(let $t=0;$t<dt;$t++)P[Ke+$t]=Ee[$t]}else P.push(Ee)}}class J{constructor(G,ie){this.i=G,this.j=ie,this.h=0,this.g=null}get(){let G;return 0<this.h?(this.h--,G=this.g,this.g=G.next,G.next=null):G=this.i(),G}}function q(P){return/^[\s\xa0]*$/.test(P)}function re(){var P=y.navigator;return P&&(P=P.userAgent)?P:""}function ce(P){return ce[" "](P),P}ce[" "]=function(){};var ae=re().indexOf("Gecko")!=-1&&!(re().toLowerCase().indexOf("webkit")!=-1&&re().indexOf("Edge")==-1)&&!(re().indexOf("Trident")!=-1||re().indexOf("MSIE")!=-1)&&re().indexOf("Edge")==-1;function pe(P,G,ie){for(const Ee in P)G.call(ie,P[Ee],Ee,P)}function H(P,G){for(const ie in P)G.call(void 0,P[ie],ie,P)}function X(P){const G={};for(const ie in P)G[ie]=P[ie];return G}const Q="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function ne(P,G){let ie,Ee;for(let Ke=1;Ke<arguments.length;Ke++){Ee=arguments[Ke];for(ie in Ee)P[ie]=Ee[ie];for(let dt=0;dt<Q.length;dt++)ie=Q[dt],Object.prototype.hasOwnProperty.call(Ee,ie)&&(P[ie]=Ee[ie])}}function he(P){var G=1;P=P.split(":");const ie=[];for(;0<G&&P.length;)ie.push(P.shift()),G--;return P.length&&ie.push(P.join(":")),ie}function fe(P){y.setTimeout(()=>{throw P},0)}function de(){var P=Ie;let G=null;return P.g&&(G=P.g,P.g=P.g.next,P.g||(P.h=null),G.next=null),G}class ke{constructor(){this.h=this.g=null}add(G,ie){const Ee=De.get();Ee.set(G,ie),this.h?this.h.next=Ee:this.g=Ee,this.h=Ee}}var De=new J(()=>new je,P=>P.reset());class je{constructor(){this.next=this.g=this.h=null}set(G,ie){this.h=G,this.g=ie,this.next=null}reset(){this.next=this.g=this.h=null}}let Te,we=!1,Ie=new ke,Oe=()=>{const P=y.Promise.resolve(void 0);Te=()=>{P.then(ve)}};var ve=()=>{for(var P;P=de();){try{P.h.call(P.g)}catch(ie){fe(ie)}var G=De;G.j(P),100>G.h&&(G.h++,P.next=G.g,G.g=P)}we=!1};function xe(){this.s=this.s,this.C=this.C}xe.prototype.s=!1,xe.prototype.ma=function(){this.s||(this.s=!0,this.N())},xe.prototype.N=function(){if(this.C)for(;this.C.length;)this.C.shift()()};function Ge(P,G){this.type=P,this.g=this.target=G,this.defaultPrevented=!1}Ge.prototype.h=function(){this.defaultPrevented=!0};var Ze=function(){if(!y.addEventListener||!Object.defineProperty)return!1;var P=!1,G=Object.defineProperty({},"passive",{get:function(){P=!0}});try{const ie=()=>{};y.addEventListener("test",ie,G),y.removeEventListener("test",ie,G)}catch{}return P}();function lt(P,G){if(Ge.call(this,P?P.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,P){var ie=this.type=P.type,Ee=P.changedTouches&&P.changedTouches.length?P.changedTouches[0]:null;if(this.target=P.target||P.srcElement,this.g=G,G=P.relatedTarget){if(ae){e:{try{ce(G.nodeName);var Ke=!0;break e}catch{}Ke=!1}Ke||(G=null)}}else ie=="mouseover"?G=P.fromElement:ie=="mouseout"&&(G=P.toElement);this.relatedTarget=G,Ee?(this.clientX=Ee.clientX!==void 0?Ee.clientX:Ee.pageX,this.clientY=Ee.clientY!==void 0?Ee.clientY:Ee.pageY,this.screenX=Ee.screenX||0,this.screenY=Ee.screenY||0):(this.clientX=P.clientX!==void 0?P.clientX:P.pageX,this.clientY=P.clientY!==void 0?P.clientY:P.pageY,this.screenX=P.screenX||0,this.screenY=P.screenY||0),this.button=P.button,this.key=P.key||"",this.ctrlKey=P.ctrlKey,this.altKey=P.altKey,this.shiftKey=P.shiftKey,this.metaKey=P.metaKey,this.pointerId=P.pointerId||0,this.pointerType=typeof P.pointerType=="string"?P.pointerType:vt[P.pointerType]||"",this.state=P.state,this.i=P,P.defaultPrevented&&lt.aa.h.call(this)}}L(lt,Ge);var vt={2:"touch",3:"pen",4:"mouse"};lt.prototype.h=function(){lt.aa.h.call(this);var P=this.i;P.preventDefault?P.preventDefault():P.returnValue=!1};var nt="closure_listenable_"+(1e6*Math.random()|0),mt=0;function et(P,G,ie,Ee,Ke){this.listener=P,this.proxy=null,this.src=G,this.type=ie,this.capture=!!Ee,this.ha=Ke,this.key=++mt,this.da=this.fa=!1}function St(P){P.da=!0,P.listener=null,P.proxy=null,P.src=null,P.ha=null}function un(P){this.src=P,this.g={},this.h=0}un.prototype.add=function(P,G,ie,Ee,Ke){var dt=P.toString();P=this.g[dt],P||(P=this.g[dt]=[],this.h++);var $t=Ct(P,G,Ee,Ke);return-1<$t?(G=P[$t],ie||(G.fa=!1)):(G=new et(G,this.src,dt,!!Ee,Ke),G.fa=ie,P.push(G)),G};function ft(P,G){var ie=G.type;if(ie in P.g){var Ee=P.g[ie],Ke=Array.prototype.indexOf.call(Ee,G,void 0),dt;(dt=0<=Ke)&&Array.prototype.splice.call(Ee,Ke,1),dt&&(St(G),P.g[ie].length==0&&(delete P.g[ie],P.h--))}}function Ct(P,G,ie,Ee){for(var Ke=0;Ke<P.length;++Ke){var dt=P[Ke];if(!dt.da&&dt.listener==G&&dt.capture==!!ie&&dt.ha==Ee)return Ke}return-1}var ut="closure_lm_"+(1e6*Math.random()|0),Ft={};function on(P,G,ie,Ee,Ke){if(Array.isArray(G)){for(var dt=0;dt<G.length;dt++)on(P,G[dt],ie,Ee,Ke);return null}return ie=pn(ie),P&&P[nt]?P.K(G,ie,w(Ee)?!!Ee.capture:!1,Ke):Ht(P,G,ie,!1,Ee,Ke)}function Ht(P,G,ie,Ee,Ke,dt){if(!G)throw Error("Invalid event type");var $t=w(Ke)?!!Ke.capture:!!Ke,oi=Et(P);if(oi||(P[ut]=oi=new un(P)),ie=oi.add(G,ie,Ee,$t,dt),ie.proxy)return ie;if(Ee=Se(),ie.proxy=Ee,Ee.src=P,Ee.listener=ie,P.addEventListener)Ze||(Ke=$t),Ke===void 0&&(Ke=!1),P.addEventListener(G.toString(),Ee,Ke);else if(P.attachEvent)P.attachEvent(Pt(G.toString()),Ee);else if(P.addListener&&P.removeListener)P.addListener(Ee);else throw Error("addEventListener and attachEvent are unavailable.");return ie}function Se(){function P(ie){return G.call(P.src,P.listener,ie)}const G=Ot;return P}function Ne(P,G,ie,Ee,Ke){if(Array.isArray(G))for(var dt=0;dt<G.length;dt++)Ne(P,G[dt],ie,Ee,Ke);else Ee=w(Ee)?!!Ee.capture:!!Ee,ie=pn(ie),P&&P[nt]?(P=P.i,G=String(G).toString(),G in P.g&&(dt=P.g[G],ie=Ct(dt,ie,Ee,Ke),-1<ie&&(St(dt[ie]),Array.prototype.splice.call(dt,ie,1),dt.length==0&&(delete P.g[G],P.h--)))):P&&(P=Et(P))&&(G=P.g[G.toString()],P=-1,G&&(P=Ct(G,ie,Ee,Ke)),(ie=-1<P?G[P]:null)&&$e(ie))}function $e(P){if(typeof P!="number"&&P&&!P.da){var G=P.src;if(G&&G[nt])ft(G.i,P);else{var ie=P.type,Ee=P.proxy;G.removeEventListener?G.removeEventListener(ie,Ee,P.capture):G.detachEvent?G.detachEvent(Pt(ie),Ee):G.addListener&&G.removeListener&&G.removeListener(Ee),(ie=Et(G))?(ft(ie,P),ie.h==0&&(ie.src=null,G[ut]=null)):St(P)}}}function Pt(P){return P in Ft?Ft[P]:Ft[P]="on"+P}function Ot(P,G){if(P.da)P=!0;else{G=new lt(G,this);var ie=P.listener,Ee=P.ha||P.src;P.fa&&$e(P),P=ie.call(Ee,G)}return P}function Et(P){return P=P[ut],P instanceof un?P:null}var xt="__closure_events_fn_"+(1e9*Math.random()>>>0);function pn(P){return typeof P=="function"?P:(P[xt]||(P[xt]=function(G){return P.handleEvent(G)}),P[xt])}function Cn(){xe.call(this),this.i=new un(this),this.M=this,this.F=null}L(Cn,xe),Cn.prototype[nt]=!0,Cn.prototype.removeEventListener=function(P,G,ie,Ee){Ne(this,P,G,ie,Ee)};function En(P,G){var ie,Ee=P.F;if(Ee)for(ie=[];Ee;Ee=Ee.F)ie.push(Ee);if(P=P.M,Ee=G.type||G,typeof G=="string")G=new Ge(G,P);else if(G instanceof Ge)G.target=G.target||P;else{var Ke=G;G=new Ge(Ee,P),ne(G,Ke)}if(Ke=!0,ie)for(var dt=ie.length-1;0<=dt;dt--){var $t=G.g=ie[dt];Ke=It($t,Ee,!0,G)&&Ke}if($t=G.g=P,Ke=It($t,Ee,!0,G)&&Ke,Ke=It($t,Ee,!1,G)&&Ke,ie)for(dt=0;dt<ie.length;dt++)$t=G.g=ie[dt],Ke=It($t,Ee,!1,G)&&Ke}Cn.prototype.N=function(){if(Cn.aa.N.call(this),this.i){var P=this.i,G;for(G in P.g){for(var ie=P.g[G],Ee=0;Ee<ie.length;Ee++)St(ie[Ee]);delete P.g[G],P.h--}}this.F=null},Cn.prototype.K=function(P,G,ie,Ee){return this.i.add(String(P),G,!1,ie,Ee)},Cn.prototype.L=function(P,G,ie,Ee){return this.i.add(String(P),G,!0,ie,Ee)};function It(P,G,ie,Ee){if(G=P.i.g[String(G)],!G)return!0;G=G.concat();for(var Ke=!0,dt=0;dt<G.length;++dt){var $t=G[dt];if($t&&!$t.da&&$t.capture==ie){var oi=$t.listener,Gs=$t.ha||$t.src;$t.fa&&ft(P.i,$t),Ke=oi.call(Gs,Ee)!==!1&&Ke}}return Ke&&!Ee.defaultPrevented}function cr(P,G,ie){if(typeof P=="function")ie&&(P=N(P,ie));else if(P&&typeof P.handleEvent=="function")P=N(P.handleEvent,P);else throw Error("Invalid listener argument");return 2147483647<Number(G)?-1:y.setTimeout(P,G||0)}function Lt(P){P.g=cr(()=>{P.g=null,P.i&&(P.i=!1,Lt(P))},P.l);const G=P.h;P.h=null,P.m.apply(null,G)}class Yt extends xe{constructor(G,ie){super(),this.m=G,this.l=ie,this.h=null,this.i=!1,this.g=null}j(G){this.h=arguments,this.g?this.i=!0:Lt(this)}N(){super.N(),this.g&&(y.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function Or(P){xe.call(this),this.h=P,this.g={}}L(Or,xe);var Oi=[];function ji(P){pe(P.g,function(G,ie){this.g.hasOwnProperty(ie)&&$e(G)},P),P.g={}}Or.prototype.N=function(){Or.aa.N.call(this),ji(this)},Or.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};var Fr=y.JSON.stringify,Xn=y.JSON.parse,oa=class{stringify(P){return y.JSON.stringify(P,void 0)}parse(P){return y.JSON.parse(P,void 0)}};function Ki(){}Ki.prototype.h=null;function xa(P){return P.h||(P.h=P.i())}function Sl(){}var Ps={OPEN:"a",kb:"b",Ja:"c",wb:"d"};function La(){Ge.call(this,"d")}L(La,Ge);function Wo(){Ge.call(this,"c")}L(Wo,Ge);var uo={},ud=null;function Go(){return ud=ud||new Cn}uo.La="serverreachability";function dd(P){Ge.call(this,uo.La,P)}L(dd,Ge);function uc(P){const G=Go();En(G,new dd(G))}uo.STAT_EVENT="statevent";function bo(P,G){Ge.call(this,uo.STAT_EVENT,P),this.stat=G}L(bo,Ge);function Tr(P){const G=Go();En(G,new bo(G,P))}uo.Ma="timingevent";function lu(P,G){Ge.call(this,uo.Ma,P),this.size=G}L(lu,Ge);function aa(P,G){if(typeof P!="function")throw Error("Fn must not be null and must be a function");return y.setTimeout(function(){P()},G)}function Ma(){this.g=!0}Ma.prototype.xa=function(){this.g=!1};function xc(P,G,ie,Ee,Ke,dt){P.info(function(){if(P.g)if(dt)for(var $t="",oi=dt.split("&"),Gs=0;Gs<oi.length;Gs++){var hr=oi[Gs].split("=");if(1<hr.length){var ho=hr[0];hr=hr[1];var Ns=ho.split("_");$t=2<=Ns.length&&Ns[1]=="type"?$t+(ho+"="+hr+"&"):$t+(ho+"=redacted&")}}else $t=null;else $t=dt;return"XMLHTTP REQ ("+Ee+") [attempt "+Ke+"]: "+G+`
`+ie+`
`+$t})}function Ho(P,G,ie,Ee,Ke,dt,$t){P.info(function(){return"XMLHTTP RESP ("+Ee+") [ attempt "+Ke+"]: "+G+`
`+ie+`
`+dt+" "+$t})}function gt(P,G,ie,Ee){P.info(function(){return"XMLHTTP TEXT ("+G+"): "+jr(P,ie)+(Ee?" "+Ee:"")})}function _n(P,G){P.info(function(){return"TIMEOUT: "+G})}Ma.prototype.info=function(){};function jr(P,G){if(!P.g)return G;if(!G)return null;try{var ie=JSON.parse(G);if(ie){for(P=0;P<ie.length;P++)if(Array.isArray(ie[P])){var Ee=ie[P];if(!(2>Ee.length)){var Ke=Ee[1];if(Array.isArray(Ke)&&!(1>Ke.length)){var dt=Ke[0];if(dt!="noop"&&dt!="stop"&&dt!="close")for(var $t=1;$t<Ke.length;$t++)Ke[$t]=""}}}}return Fr(ie)}catch{return G}}var Ni={NO_ERROR:0,gb:1,tb:2,sb:3,nb:4,rb:5,ub:6,Ia:7,TIMEOUT:8,xb:9},uu={lb:"complete",Hb:"success",Ja:"error",Ia:"abort",zb:"ready",Ab:"readystatechange",TIMEOUT:"timeout",vb:"incrementaldata",yb:"progress",ob:"downloadprogress",Pb:"uploadprogress"},es;function bl(){}L(bl,Ki),bl.prototype.g=function(){return new XMLHttpRequest},bl.prototype.i=function(){return{}},es=new bl;function $o(P,G,ie,Ee){this.j=P,this.i=G,this.l=ie,this.R=Ee||1,this.U=new Or(this),this.I=45e3,this.H=null,this.o=!1,this.m=this.A=this.v=this.L=this.F=this.S=this.B=null,this.D=[],this.g=null,this.C=0,this.s=this.u=null,this.X=-1,this.J=!1,this.O=0,this.M=null,this.W=this.K=this.T=this.P=!1,this.h=new hd}function hd(){this.i=null,this.g="",this.h=!1}var Lc={},wl={};function ca(P,G,ie){P.L=1,P.v=pu(ua(G)),P.m=ie,P.P=!0,dc(P,null)}function dc(P,G){P.F=Date.now(),In(P),P.A=ua(P.v);var ie=P.A,Ee=P.R;Array.isArray(Ee)||(Ee=[String(Ee)]),mu(ie.i,"t",Ee),P.C=0,ie=P.j.J,P.h=new hd,P.g=n_(P.j,ie?G:null,!P.m),0<P.O&&(P.M=new Yt(N(P.Y,P,P.g),P.O)),G=P.U,ie=P.g,Ee=P.ca;var Ke="readystatechange";Array.isArray(Ke)||(Ke&&(Oi[0]=Ke.toString()),Ke=Oi);for(var dt=0;dt<Ke.length;dt++){var $t=on(ie,Ke[dt],Ee||G.handleEvent,!1,G.h||G);if(!$t)break;G.g[$t.key]=$t}G=P.H?X(P.H):{},P.m?(P.u||(P.u="POST"),G["Content-Type"]="application/x-www-form-urlencoded",P.g.ea(P.A,P.u,P.m,G)):(P.u="GET",P.g.ea(P.A,P.u,null,G)),uc(),xc(P.i,P.u,P.A,P.l,P.R,P.m)}$o.prototype.ca=function(P){P=P.target;const G=this.M;G&&Di(P)==3?G.j():this.Y(P)},$o.prototype.Y=function(P){try{if(P==this.g)e:{const Ns=Di(this.g);var G=this.g.Ba();const jc=this.g.Z();if(!(3>Ns)&&(Ns!=3||this.g&&(this.h.h||this.g.oa()||Ws(this.g)))){this.J||Ns!=4||G==7||(G==8||0>=jc?uc(3):uc(2)),ti(this);var ie=this.g.Z();this.X=ie;t:if(Ko(this)){var Ee=Ws(this.g);P="";var Ke=Ee.length,dt=Di(this.g)==4;if(!this.h.i){if(typeof TextDecoder>"u"){Ua(this),Tl(this);var $t="";break t}this.h.i=new y.TextDecoder}for(G=0;G<Ke;G++)this.h.h=!0,P+=this.h.i.decode(Ee[G],{stream:!(dt&&G==Ke-1)});Ee.length=0,this.h.g+=P,this.C=0,$t=this.h.g}else $t=this.g.oa();if(this.o=ie==200,Ho(this.i,this.u,this.A,this.l,this.R,Ns,ie),this.o){if(this.T&&!this.K){t:{if(this.g){var oi,Gs=this.g;if((oi=Gs.g?Gs.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!q(oi)){var hr=oi;break t}}hr=null}if(ie=hr)gt(this.i,this.l,ie,"Initial handshake response via X-HTTP-Initial-Response"),this.K=!0,Mp(this,ie);else{this.o=!1,this.s=3,Tr(12),Ua(this),Tl(this);break e}}if(this.P){ie=!0;let Ba;for(;!this.J&&this.C<$t.length;)if(Ba=ei(this,$t),Ba==wl){Ns==4&&(this.s=4,Tr(14),ie=!1),gt(this.i,this.l,null,"[Incomplete Response]");break}else if(Ba==Lc){this.s=4,Tr(15),gt(this.i,this.l,$t,"[Invalid Chunk]"),ie=!1;break}else gt(this.i,this.l,Ba,null),Mp(this,Ba);if(Ko(this)&&this.C!=0&&(this.h.g=this.h.g.slice(this.C),this.C=0),Ns!=4||$t.length!=0||this.h.h||(this.s=1,Tr(16),ie=!1),this.o=this.o&&ie,!ie)gt(this.i,this.l,$t,"[Invalid Chunked Response]"),Ua(this),Tl(this);else if(0<$t.length&&!this.W){this.W=!0;var ho=this.j;ho.g==this&&ho.ba&&!ho.M&&(ho.j.info("Great, no buffering proxy detected. Bytes received: "+$t.length),t_(ho),ho.M=!0,Tr(11))}}else gt(this.i,this.l,$t,null),Mp(this,$t);Ns==4&&Ua(this),this.o&&!this.J&&(Ns==4?am(this.j,this):(this.o=!1,In(this)))}else Vc(this.g),ie==400&&0<$t.indexOf("Unknown SID")?(this.s=3,Tr(12)):(this.s=0,Tr(13)),Ua(this),Tl(this)}}}catch{}finally{}};function Ko(P){return P.g?P.u=="GET"&&P.L!=2&&P.j.Ca:!1}function ei(P,G){var ie=P.C,Ee=G.indexOf(`
`,ie);return Ee==-1?wl:(ie=Number(G.substring(ie,Ee)),isNaN(ie)?Lc:(Ee+=1,Ee+ie>G.length?wl:(G=G.slice(Ee,Ee+ie),P.C=Ee+ie,G)))}$o.prototype.cancel=function(){this.J=!0,Ua(this)};function In(P){P.S=Date.now()+P.I,em(P,P.I)}function em(P,G){if(P.B!=null)throw Error("WatchDog timer not null");P.B=aa(N(P.ba,P),G)}function ti(P){P.B&&(y.clearTimeout(P.B),P.B=null)}$o.prototype.ba=function(){this.B=null;const P=Date.now();0<=P-this.S?(_n(this.i,this.A),this.L!=2&&(uc(),Tr(17)),Ua(this),this.s=2,Tl(this)):em(this,this.S-P)};function Tl(P){P.j.G==0||P.J||am(P.j,P)}function Ua(P){ti(P);var G=P.M;G&&typeof G.ma=="function"&&G.ma(),P.M=null,ji(P.U),P.g&&(G=P.g,P.g=null,G.abort(),G.ma())}function Mp(P,G){try{var ie=P.j;if(ie.G!=0&&(ie.g==P||wo(ie.h,P))){if(!P.K&&wo(ie.h,P)&&ie.G==3){try{var Ee=ie.Da.g.parse(G)}catch{Ee=null}if(Array.isArray(Ee)&&Ee.length==3){var Ke=Ee;if(Ke[0]==0){e:if(!ie.u){if(ie.g)if(ie.g.F+3e3<P.F)om(ie),pc(ie);else break e;yu(ie),Tr(18)}}else ie.za=Ke[1],0<ie.za-ie.T&&37500>Ke[2]&&ie.F&&ie.v==0&&!ie.C&&(ie.C=aa(N(ie.Za,ie),6e3));if(1>=Up(ie.h)&&ie.ca){try{ie.ca()}catch{}ie.ca=void 0}}else ja(ie,11)}else if((P.K||ie.g==P)&&om(ie),!q(G))for(Ke=ie.Da.g.parse(G),G=0;G<Ke.length;G++){let hr=Ke[G];if(ie.T=hr[0],hr=hr[1],ie.G==2)if(hr[0]=="c"){ie.K=hr[1],ie.ia=hr[2];const ho=hr[3];ho!=null&&(ie.la=ho,ie.j.info("VER="+ie.la));const Ns=hr[4];Ns!=null&&(ie.Aa=Ns,ie.j.info("SVER="+ie.Aa));const jc=hr[5];jc!=null&&typeof jc=="number"&&0<jc&&(Ee=1.5*jc,ie.L=Ee,ie.j.info("backChannelRequestTimeoutMs_="+Ee)),Ee=ie;const Ba=P.g;if(Ba){const yd=Ba.g?Ba.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(yd){var dt=Ee.h;dt.g||yd.indexOf("spdy")==-1&&yd.indexOf("quic")==-1&&yd.indexOf("h2")==-1||(dt.j=dt.l,dt.g=new Set,dt.h&&(Vp(dt,dt.h),dt.h=null))}if(Ee.D){const cm=Ba.g?Ba.g.getResponseHeader("X-HTTP-Session-Id"):null;cm&&(Ee.ya=cm,ui(Ee.I,Ee.D,cm))}}ie.G=3,ie.l&&ie.l.ua(),ie.ba&&(ie.R=Date.now()-P.F,ie.j.info("Handshake RTT: "+ie.R+"ms")),Ee=ie;var $t=P;if(Ee.qa=_d(Ee,Ee.J?Ee.ia:null,Ee.W),$t.K){nm(Ee.h,$t);var oi=$t,Gs=Ee.L;Gs&&(oi.I=Gs),oi.B&&(ti(oi),In(oi)),Ee.g=$t}else fc(Ee);0<ie.i.length&&Fc(ie)}else hr[0]!="stop"&&hr[0]!="close"||ja(ie,7);else ie.G==3&&(hr[0]=="stop"||hr[0]=="close"?hr[0]=="stop"?ja(ie,7):Os(ie):hr[0]!="noop"&&ie.l&&ie.l.ta(hr),ie.v=0)}}uc(4)}catch{}}var tm=class{constructor(P,G){this.g=P,this.map=G}};function Mc(P){this.l=P||10,y.PerformanceNavigationTiming?(P=y.performance.getEntriesByType("navigation"),P=0<P.length&&(P[0].nextHopProtocol=="hq"||P[0].nextHopProtocol=="h2")):P=!!(y.chrome&&y.chrome.loadTimes&&y.chrome.loadTimes()&&y.chrome.loadTimes().wasFetchedViaSpdy),this.j=P?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}function la(P){return P.h?!0:P.g?P.g.size>=P.j:!1}function Up(P){return P.h?1:P.g?P.g.size:0}function wo(P,G){return P.h?P.h==G:P.g?P.g.has(G):!1}function Vp(P,G){P.g?P.g.add(G):P.h=G}function nm(P,G){P.h&&P.h==G?P.h=null:P.g&&P.g.has(G)&&P.g.delete(G)}Mc.prototype.cancel=function(){if(this.i=Cl(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&this.g.size!==0){for(const P of this.g.values())P.cancel();this.g.clear()}};function Cl(P){if(P.h!=null)return P.i.concat(P.h.D);if(P.g!=null&&P.g.size!==0){let G=P.i;for(const ie of P.g.values())G=G.concat(ie.D);return G}return U(P.i)}function du(P){if(P.V&&typeof P.V=="function")return P.V();if(typeof Map<"u"&&P instanceof Map||typeof Set<"u"&&P instanceof Set)return Array.from(P.values());if(typeof P=="string")return P.split("");if(v(P)){for(var G=[],ie=P.length,Ee=0;Ee<ie;Ee++)G.push(P[Ee]);return G}G=[],ie=0;for(Ee in P)G[ie++]=P[Ee];return G}function gh(P){if(P.na&&typeof P.na=="function")return P.na();if(!P.V||typeof P.V!="function"){if(typeof Map<"u"&&P instanceof Map)return Array.from(P.keys());if(!(typeof Set<"u"&&P instanceof Set)){if(v(P)||typeof P=="string"){var G=[];P=P.length;for(var ie=0;ie<P;ie++)G.push(ie);return G}G=[],ie=0;for(const Ee in P)G[ie++]=Ee;return G}}}function Nr(P,G){if(P.forEach&&typeof P.forEach=="function")P.forEach(G,void 0);else if(v(P)||typeof P=="string")Array.prototype.forEach.call(P,G,void 0);else for(var ie=gh(P),Ee=du(P),Ke=Ee.length,dt=0;dt<Ke;dt++)G.call(void 0,Ee[dt],ie&&ie[dt],P)}var pd=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function fd(P,G){if(P){P=P.split("&");for(var ie=0;ie<P.length;ie++){var Ee=P[ie].indexOf("="),Ke=null;if(0<=Ee){var dt=P[ie].substring(0,Ee);Ke=P[ie].substring(Ee+1)}else dt=P[ie];G(dt,Ke?decodeURIComponent(Ke.replace(/\+/g," ")):"")}}}function Va(P){if(this.g=this.o=this.j="",this.s=null,this.m=this.l="",this.h=!1,P instanceof Va){this.h=P.h,md(this,P.j),this.o=P.o,this.g=P.g,Rl(this,P.s),this.l=P.l;var G=P.i,ie=new da;ie.i=G.i,G.g&&(ie.g=new Map(G.g),ie.h=G.h),hu(this,ie),this.m=P.m}else P&&(G=String(P).match(pd))?(this.h=!1,md(this,G[1]||"",!0),this.o=mr(G[2]||""),this.g=mr(G[3]||"",!0),Rl(this,G[4]),this.l=mr(G[5]||"",!0),hu(this,G[6]||"",!0),this.m=mr(G[7]||"")):(this.h=!1,this.i=new da(null,this.h))}Va.prototype.toString=function(){var P=[],G=this.j;G&&P.push(Il(G,yh,!0),":");var ie=this.g;return(ie||G=="file")&&(P.push("//"),(G=this.o)&&P.push(Il(G,yh,!0),"@"),P.push(encodeURIComponent(String(ie)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),ie=this.s,ie!=null&&P.push(":",String(ie))),(ie=this.l)&&(this.g&&ie.charAt(0)!="/"&&P.push("/"),P.push(Il(ie,ie.charAt(0)=="/"?rm:fu,!0))),(ie=this.i.toString())&&P.push("?",ie),(ie=this.m)&&P.push("#",Il(ie,jp)),P.join("")};function ua(P){return new Va(P)}function md(P,G,ie){P.j=ie?mr(G,!0):G,P.j&&(P.j=P.j.replace(/:$/,""))}function Rl(P,G){if(G){if(G=Number(G),isNaN(G)||0>G)throw Error("Bad port number "+G);P.s=G}else P.s=null}function hu(P,G,ie){G instanceof da?(P.i=G,Fa(P.i,P.h)):(ie||(G=Il(G,Fp)),P.i=new da(G,P.h))}function ui(P,G,ie){P.i.set(G,ie)}function pu(P){return ui(P,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),P}function mr(P,G){return P?G?decodeURI(P.replace(/%25/g,"%2525")):decodeURIComponent(P):""}function Il(P,G,ie){return typeof P=="string"?(P=encodeURI(P).replace(G,_h),ie&&(P=P.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),P):null}function _h(P){return P=P.charCodeAt(0),"%"+(P>>4&15).toString(16)+(P&15).toString(16)}var yh=/[#\/\?@]/g,fu=/[#\?:]/g,rm=/[#\?]/g,Fp=/[#\?@]/g,jp=/#/g;function da(P,G){this.h=this.g=null,this.i=P||null,this.j=!!G}function _s(P){P.g||(P.g=new Map,P.h=0,P.i&&fd(P.i,function(G,ie){P.add(decodeURIComponent(G.replace(/\+/g," ")),ie)}))}n=da.prototype,n.add=function(P,G){_s(this),this.i=null,P=fa(this,P);var ie=this.g.get(P);return ie||this.g.set(P,ie=[]),ie.push(G),this.h+=1,this};function ha(P,G){_s(P),G=fa(P,G),P.g.has(G)&&(P.i=null,P.h-=P.g.get(G).length,P.g.delete(G))}function pa(P,G){return _s(P),G=fa(P,G),P.g.has(G)}n.forEach=function(P,G){_s(this),this.g.forEach(function(ie,Ee){ie.forEach(function(Ke){P.call(G,Ke,Ee,this)},this)},this)},n.na=function(){_s(this);const P=Array.from(this.g.values()),G=Array.from(this.g.keys()),ie=[];for(let Ee=0;Ee<G.length;Ee++){const Ke=P[Ee];for(let dt=0;dt<Ke.length;dt++)ie.push(G[Ee])}return ie},n.V=function(P){_s(this);let G=[];if(typeof P=="string")pa(this,P)&&(G=G.concat(this.g.get(fa(this,P))));else{P=Array.from(this.g.values());for(let ie=0;ie<P.length;ie++)G=G.concat(P[ie])}return G},n.set=function(P,G){return _s(this),this.i=null,P=fa(this,P),pa(this,P)&&(this.h-=this.g.get(P).length),this.g.set(P,[G]),this.h+=1,this},n.get=function(P,G){return P?(P=this.V(P),0<P.length?String(P[0]):G):G};function mu(P,G,ie){ha(P,G),0<ie.length&&(P.i=null,P.g.set(fa(P,G),U(ie)),P.h+=ie.length)}n.toString=function(){if(this.i)return this.i;if(!this.g)return"";const P=[],G=Array.from(this.g.keys());for(var ie=0;ie<G.length;ie++){var Ee=G[ie];const dt=encodeURIComponent(String(Ee)),$t=this.V(Ee);for(Ee=0;Ee<$t.length;Ee++){var Ke=dt;$t[Ee]!==""&&(Ke+="="+encodeURIComponent(String($t[Ee]))),P.push(Ke)}}return this.i=P.join("&")};function fa(P,G){return G=String(G),P.j&&(G=G.toLowerCase()),G}function Fa(P,G){G&&!P.j&&(_s(P),P.i=null,P.g.forEach(function(ie,Ee){var Ke=Ee.toLowerCase();Ee!=Ke&&(ha(this,Ee),mu(this,Ke,ie))},P)),P.j=G}function Bp(P,G){const ie=new Ma;if(y.Image){const Ee=new Image;Ee.onload=M(ks,ie,"TestLoadImage: loaded",!0,G,Ee),Ee.onerror=M(ks,ie,"TestLoadImage: error",!1,G,Ee),Ee.onabort=M(ks,ie,"TestLoadImage: abort",!1,G,Ee),Ee.ontimeout=M(ks,ie,"TestLoadImage: timeout",!1,G,Ee),y.setTimeout(function(){Ee.ontimeout&&Ee.ontimeout()},1e4),Ee.src=P}else G(!1)}function Uc(P,G){const ie=new Ma,Ee=new AbortController,Ke=setTimeout(()=>{Ee.abort(),ks(ie,"TestPingServer: timeout",!1,G)},1e4);fetch(P,{signal:Ee.signal}).then(dt=>{clearTimeout(Ke),dt.ok?ks(ie,"TestPingServer: ok",!0,G):ks(ie,"TestPingServer: server error",!1,G)}).catch(()=>{clearTimeout(Ke),ks(ie,"TestPingServer: error",!1,G)})}function ks(P,G,ie,Ee,Ke){try{Ke&&(Ke.onload=null,Ke.onerror=null,Ke.onabort=null,Ke.ontimeout=null),Ee(ie)}catch{}}function Zg(){this.g=new oa}function Al(P,G,ie){const Ee=ie||"";try{Nr(P,function(Ke,dt){let $t=Ke;w(Ke)&&($t=Fr(Ke)),G.push(Ee+dt+"="+encodeURIComponent($t))})}catch(Ke){throw G.push(Ee+"type="+encodeURIComponent("_badmap")),Ke}}function Pl(P){this.l=P.Ub||null,this.j=P.eb||!1}L(Pl,Ki),Pl.prototype.g=function(){return new gu(this.l,this.j)},Pl.prototype.i=function(P){return function(){return P}}({});function gu(P,G){Cn.call(this),this.D=P,this.o=G,this.m=void 0,this.status=this.readyState=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.u=new Headers,this.h=null,this.B="GET",this.A="",this.g=!1,this.v=this.j=this.l=null}L(gu,Cn),n=gu.prototype,n.open=function(P,G){if(this.readyState!=0)throw this.abort(),Error("Error reopening a connection");this.B=P,this.A=G,this.readyState=1,ma(this)},n.send=function(P){if(this.readyState!=1)throw this.abort(),Error("need to call open() first. ");this.g=!0;const G={headers:this.u,method:this.B,credentials:this.m,cache:void 0};P&&(G.body=P),(this.D||y).fetch(new Request(this.A,G)).then(this.Sa.bind(this),this.ga.bind(this))},n.abort=function(){this.response=this.responseText="",this.u=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),1<=this.readyState&&this.g&&this.readyState!=4&&(this.g=!1,hc(this)),this.readyState=0},n.Sa=function(P){if(this.g&&(this.l=P,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=P.headers,this.readyState=2,ma(this)),this.g&&(this.readyState=3,ma(this),this.g)))if(this.responseType==="arraybuffer")P.arrayBuffer().then(this.Qa.bind(this),this.ga.bind(this));else if(typeof y.ReadableStream<"u"&&"body"in P){if(this.j=P.body.getReader(),this.o){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.v=new TextDecoder;im(this)}else P.text().then(this.Ra.bind(this),this.ga.bind(this))};function im(P){P.j.read().then(P.Pa.bind(P)).catch(P.ga.bind(P))}n.Pa=function(P){if(this.g){if(this.o&&P.value)this.response.push(P.value);else if(!this.o){var G=P.value?P.value:new Uint8Array(0);(G=this.v.decode(G,{stream:!P.done}))&&(this.response=this.responseText+=G)}P.done?hc(this):ma(this),this.readyState==3&&im(this)}},n.Ra=function(P){this.g&&(this.response=this.responseText=P,hc(this))},n.Qa=function(P){this.g&&(this.response=P,hc(this))},n.ga=function(){this.g&&hc(this)};function hc(P){P.readyState=4,P.l=null,P.j=null,P.v=null,ma(P)}n.setRequestHeader=function(P,G){this.u.append(P,G)},n.getResponseHeader=function(P){return this.h&&this.h.get(P.toLowerCase())||""},n.getAllResponseHeaders=function(){if(!this.h)return"";const P=[],G=this.h.entries();for(var ie=G.next();!ie.done;)ie=ie.value,P.push(ie[0]+": "+ie[1]),ie=G.next();return P.join(`\r
`)};function ma(P){P.onreadystatechange&&P.onreadystatechange.call(P)}Object.defineProperty(gu.prototype,"withCredentials",{get:function(){return this.m==="include"},set:function(P){this.m=P?"include":"same-origin"}});function kl(P){let G="";return pe(P,function(ie,Ee){G+=Ee,G+=":",G+=ie,G+=`\r
`}),G}function be(P,G,ie){e:{for(Ee in ie){var Ee=!1;break e}Ee=!0}Ee||(ie=kl(ie),typeof P=="string"?ie!=null&&encodeURIComponent(String(ie)):ui(P,G,ie))}function Me(P){Cn.call(this),this.headers=new Map,this.o=P||null,this.h=!1,this.v=this.g=null,this.D="",this.m=0,this.l="",this.j=this.B=this.u=this.A=!1,this.I=null,this.H="",this.J=!1}L(Me,Cn);var ot=/^https?$/i,Kt=["POST","PUT"];n=Me.prototype,n.Ha=function(P){this.J=P},n.ea=function(P,G,ie,Ee){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.D+"; newUri="+P);G=G?G.toUpperCase():"GET",this.D=P,this.l="",this.m=0,this.A=!1,this.h=!0,this.g=this.o?this.o.g():es.g(),this.v=this.o?xa(this.o):xa(es),this.g.onreadystatechange=N(this.Ea,this);try{this.B=!0,this.g.open(G,String(P),!0),this.B=!1}catch(dt){sr(this,dt);return}if(P=ie||"",ie=new Map(this.headers),Ee)if(Object.getPrototypeOf(Ee)===Object.prototype)for(var Ke in Ee)ie.set(Ke,Ee[Ke]);else if(typeof Ee.keys=="function"&&typeof Ee.get=="function")for(const dt of Ee.keys())ie.set(dt,Ee.get(dt));else throw Error("Unknown input type for opt_headers: "+String(Ee));Ee=Array.from(ie.keys()).find(dt=>dt.toLowerCase()=="content-type"),Ke=y.FormData&&P instanceof y.FormData,!(0<=Array.prototype.indexOf.call(Kt,G,void 0))||Ee||Ke||ie.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(const[dt,$t]of ie)this.g.setRequestHeader(dt,$t);this.H&&(this.g.responseType=this.H),"withCredentials"in this.g&&this.g.withCredentials!==this.J&&(this.g.withCredentials=this.J);try{tr(this),this.u=!0,this.g.send(P),this.u=!1}catch(dt){sr(this,dt)}};function sr(P,G){P.h=!1,P.g&&(P.j=!0,P.g.abort(),P.j=!1),P.l=G,P.m=5,Br(P),er(P)}function Br(P){P.A||(P.A=!0,En(P,"complete"),En(P,"error"))}n.abort=function(P){this.g&&this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1,this.m=P||7,En(this,"complete"),En(this,"abort"),er(this))},n.N=function(){this.g&&(this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1),er(this,!0)),Me.aa.N.call(this)},n.Ea=function(){this.s||(this.B||this.u||this.j?si(this):this.bb())},n.bb=function(){si(this)};function si(P){if(P.h&&typeof p<"u"&&(!P.v[1]||Di(P)!=4||P.Z()!=2)){if(P.u&&Di(P)==4)cr(P.Ea,0,P);else if(En(P,"readystatechange"),Di(P)==4){P.h=!1;try{const $t=P.Z();e:switch($t){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var G=!0;break e;default:G=!1}var ie;if(!(ie=G)){var Ee;if(Ee=$t===0){var Ke=String(P.D).match(pd)[1]||null;!Ke&&y.self&&y.self.location&&(Ke=y.self.location.protocol.slice(0,-1)),Ee=!ot.test(Ke?Ke.toLowerCase():"")}ie=Ee}if(ie)En(P,"complete"),En(P,"success");else{P.m=6;try{var dt=2<Di(P)?P.g.statusText:""}catch{dt=""}P.l=dt+" ["+P.Z()+"]",Br(P)}}finally{er(P)}}}}function er(P,G){if(P.g){tr(P);const ie=P.g,Ee=P.v[0]?()=>{}:null;P.g=null,P.v=null,G||En(P,"ready");try{ie.onreadystatechange=Ee}catch{}}}function tr(P){P.I&&(y.clearTimeout(P.I),P.I=null)}n.isActive=function(){return!!this.g};function Di(P){return P.g?P.g.readyState:0}n.Z=function(){try{return 2<Di(this)?this.g.status:-1}catch{return-1}},n.oa=function(){try{return this.g?this.g.responseText:""}catch{return""}},n.Oa=function(P){if(this.g){var G=this.g.responseText;return P&&G.indexOf(P)==0&&(G=G.substring(P.length)),Xn(G)}};function Ws(P){try{if(!P.g)return null;if("response"in P.g)return P.g.response;switch(P.H){case"":case"text":return P.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in P.g)return P.g.mozResponseArrayBuffer}return null}catch{return null}}function Vc(P){const G={};P=(P.g&&2<=Di(P)&&P.g.getAllResponseHeaders()||"").split(`\r
`);for(let Ee=0;Ee<P.length;Ee++){if(q(P[Ee]))continue;var ie=he(P[Ee]);const Ke=ie[0];if(ie=ie[1],typeof ie!="string")continue;ie=ie.trim();const dt=G[Ke]||[];G[Ke]=dt,dt.push(ie)}H(G,function(Ee){return Ee.join(", ")})}n.Ba=function(){return this.m},n.Ka=function(){return typeof this.l=="string"?this.l:String(this.l)};function To(P,G,ie){return ie&&ie.internalChannelParams&&ie.internalChannelParams[P]||G}function _u(P){this.Aa=0,this.i=[],this.j=new Ma,this.ia=this.qa=this.I=this.W=this.g=this.ya=this.D=this.H=this.m=this.S=this.o=null,this.Ya=this.U=0,this.Va=To("failFast",!1,P),this.F=this.C=this.u=this.s=this.l=null,this.X=!0,this.za=this.T=-1,this.Y=this.v=this.B=0,this.Ta=To("baseRetryDelayMs",5e3,P),this.cb=To("retryDelaySeedMs",1e4,P),this.Wa=To("forwardChannelMaxRetries",2,P),this.wa=To("forwardChannelRequestTimeoutMs",2e4,P),this.pa=P&&P.xmlHttpFactory||void 0,this.Xa=P&&P.Tb||void 0,this.Ca=P&&P.useFetchStreams||!1,this.L=void 0,this.J=P&&P.supportsCrossDomainXhr||!1,this.K="",this.h=new Mc(P&&P.concurrentRequestLimit),this.Da=new Zg,this.P=P&&P.fastHandshake||!1,this.O=P&&P.encodeInitMessageHeaders||!1,this.P&&this.O&&(this.O=!1),this.Ua=P&&P.Rb||!1,P&&P.xa&&this.j.xa(),P&&P.forceLongPolling&&(this.X=!1),this.ba=!this.P&&this.X&&P&&P.detectBufferingProxy||!1,this.ja=void 0,P&&P.longPollingTimeout&&0<P.longPollingTimeout&&(this.ja=P.longPollingTimeout),this.ca=void 0,this.R=0,this.M=!1,this.ka=this.A=null}n=_u.prototype,n.la=8,n.G=1,n.connect=function(P,G,ie,Ee){Tr(0),this.W=P,this.H=G||{},ie&&Ee!==void 0&&(this.H.OSID=ie,this.H.OAID=Ee),this.F=this.X,this.I=_d(this,null,this.W),Fc(this)};function Os(P){if(sm(P),P.G==3){var G=P.U++,ie=ua(P.I);if(ui(ie,"SID",P.K),ui(ie,"RID",G),ui(ie,"TYPE","terminate"),gd(P,ie),G=new $o(P,P.j,G),G.L=2,G.v=pu(ua(ie)),ie=!1,y.navigator&&y.navigator.sendBeacon)try{ie=y.navigator.sendBeacon(G.v.toString(),"")}catch{}!ie&&y.Image&&(new Image().src=G.v,ie=!0),ie||(G.g=n_(G.j,null),G.g.ea(G.v)),G.F=Date.now(),In(G)}vE(P)}function pc(P){P.g&&(t_(P),P.g.cancel(),P.g=null)}function sm(P){pc(P),P.u&&(y.clearTimeout(P.u),P.u=null),om(P),P.h.cancel(),P.s&&(typeof P.s=="number"&&y.clearTimeout(P.s),P.s=null)}function Fc(P){if(!la(P.h)&&!P.s){P.s=!0;var G=P.Ga;Te||Oe(),we||(Te(),we=!0),Ie.add(G,P),P.B=0}}function e_(P,G){return Up(P.h)>=P.h.j-(P.s?1:0)?!1:P.s?(P.i=G.D.concat(P.i),!0):P.G==1||P.G==2||P.B>=(P.Va?0:P.Wa)?!1:(P.s=aa(N(P.Ga,P,G),EE(P,P.B)),P.B++,!0)}n.Ga=function(P){if(this.s)if(this.s=null,this.G==1){if(!P){this.U=Math.floor(1e5*Math.random()),P=this.U++;const Ke=new $o(this,this.j,P);let dt=this.o;if(this.S&&(dt?(dt=X(dt),ne(dt,this.S)):dt=this.S),this.m!==null||this.O||(Ke.H=dt,dt=null),this.P)e:{for(var G=0,ie=0;ie<this.i.length;ie++){t:{var Ee=this.i[ie];if("__data__"in Ee.map&&(Ee=Ee.map.__data__,typeof Ee=="string")){Ee=Ee.length;break t}Ee=void 0}if(Ee===void 0)break;if(G+=Ee,4096<G){G=ie;break e}if(G===4096||ie===this.i.length-1){G=ie+1;break e}}G=1e3}else G=1e3;G=vh(this,Ke,G),ie=ua(this.I),ui(ie,"RID",P),ui(ie,"CVER",22),this.D&&ui(ie,"X-HTTP-Session-Id",this.D),gd(this,ie),dt&&(this.O?G="headers="+encodeURIComponent(String(kl(dt)))+"&"+G:this.m&&be(ie,this.m,dt)),Vp(this.h,Ke),this.Ua&&ui(ie,"TYPE","init"),this.P?(ui(ie,"$req",G),ui(ie,"SID","null"),Ke.T=!0,ca(Ke,ie,null)):ca(Ke,ie,G),this.G=2}}else this.G==3&&(P?Eh(this,P):this.i.length==0||la(this.h)||Eh(this))};function Eh(P,G){var ie;G?ie=G.l:ie=P.U++;const Ee=ua(P.I);ui(Ee,"SID",P.K),ui(Ee,"RID",ie),ui(Ee,"AID",P.T),gd(P,Ee),P.m&&P.o&&be(Ee,P.m,P.o),ie=new $o(P,P.j,ie,P.B+1),P.m===null&&(ie.H=P.o),G&&(P.i=G.D.concat(P.i)),G=vh(P,ie,1e3),ie.I=Math.round(.5*P.wa)+Math.round(.5*P.wa*Math.random()),Vp(P.h,ie),ca(ie,Ee,G)}function gd(P,G){P.H&&pe(P.H,function(ie,Ee){ui(G,Ee,ie)}),P.l&&Nr({},function(ie,Ee){ui(G,Ee,ie)})}function vh(P,G,ie){ie=Math.min(P.i.length,ie);var Ee=P.l?N(P.l.Na,P.l,P):null;e:{var Ke=P.i;let dt=-1;for(;;){const $t=["count="+ie];dt==-1?0<ie?(dt=Ke[0].g,$t.push("ofs="+dt)):dt=0:$t.push("ofs="+dt);let oi=!0;for(let Gs=0;Gs<ie;Gs++){let hr=Ke[Gs].g;const ho=Ke[Gs].map;if(hr-=dt,0>hr)dt=Math.max(0,Ke[Gs].g-100),oi=!1;else try{Al(ho,$t,"req"+hr+"_")}catch{Ee&&Ee(ho)}}if(oi){Ee=$t.join("&");break e}}}return P=P.i.splice(0,ie),G.D=P,Ee}function fc(P){if(!P.g&&!P.u){P.Y=1;var G=P.Fa;Te||Oe(),we||(Te(),we=!0),Ie.add(G,P),P.v=0}}function yu(P){return P.g||P.u||3<=P.v?!1:(P.Y++,P.u=aa(N(P.Fa,P),EE(P,P.v)),P.v++,!0)}n.Fa=function(){if(this.u=null,yE(this),this.ba&&!(this.M||this.g==null||0>=this.R)){var P=2*this.R;this.j.info("BP detection timer enabled: "+P),this.A=aa(N(this.ab,this),P)}},n.ab=function(){this.A&&(this.A=null,this.j.info("BP detection timeout reached."),this.j.info("Buffering proxy detected and switch to long-polling!"),this.F=!1,this.M=!0,Tr(10),pc(this),yE(this))};function t_(P){P.A!=null&&(y.clearTimeout(P.A),P.A=null)}function yE(P){P.g=new $o(P,P.j,"rpc",P.Y),P.m===null&&(P.g.H=P.o),P.g.O=0;var G=ua(P.qa);ui(G,"RID","rpc"),ui(G,"SID",P.K),ui(G,"AID",P.T),ui(G,"CI",P.F?"0":"1"),!P.F&&P.ja&&ui(G,"TO",P.ja),ui(G,"TYPE","xmlhttp"),gd(P,G),P.m&&P.o&&be(G,P.m,P.o),P.L&&(P.g.I=P.L);var ie=P.g;P=P.ia,ie.L=1,ie.v=pu(ua(G)),ie.m=null,ie.P=!0,dc(ie,P)}n.Za=function(){this.C!=null&&(this.C=null,pc(this),yu(this),Tr(19))};function om(P){P.C!=null&&(y.clearTimeout(P.C),P.C=null)}function am(P,G){var ie=null;if(P.g==G){om(P),t_(P),P.g=null;var Ee=2}else if(wo(P.h,G))ie=G.D,nm(P.h,G),Ee=1;else return;if(P.G!=0){if(G.o)if(Ee==1){ie=G.m?G.m.length:0,G=Date.now()-G.F;var Ke=P.B;Ee=Go(),En(Ee,new lu(Ee,ie)),Fc(P)}else fc(P);else if(Ke=G.s,Ke==3||Ke==0&&0<G.X||!(Ee==1&&e_(P,G)||Ee==2&&yu(P)))switch(ie&&0<ie.length&&(G=P.h,G.i=G.i.concat(ie)),Ke){case 1:ja(P,5);break;case 4:ja(P,10);break;case 3:ja(P,6);break;default:ja(P,2)}}}function EE(P,G){let ie=P.Ta+Math.floor(Math.random()*P.cb);return P.isActive()||(ie*=2),ie*G}function ja(P,G){if(P.j.info("Error code "+G),G==2){var ie=N(P.fb,P),Ee=P.Xa;const Ke=!Ee;Ee=new Va(Ee||"//www.google.com/images/cleardot.gif"),y.location&&y.location.protocol=="http"||md(Ee,"https"),pu(Ee),Ke?Bp(Ee.toString(),ie):Uc(Ee.toString(),ie)}else Tr(2);P.G=0,P.l&&P.l.sa(G),vE(P),sm(P)}n.fb=function(P){P?(this.j.info("Successfully pinged google.com"),Tr(2)):(this.j.info("Failed to ping google.com"),Tr(1))};function vE(P){if(P.G=0,P.ka=[],P.l){const G=Cl(P.h);(G.length!=0||P.i.length!=0)&&(z(P.ka,G),z(P.ka,P.i),P.h.i.length=0,U(P.i),P.i.length=0),P.l.ra()}}function _d(P,G,ie){var Ee=ie instanceof Va?ua(ie):new Va(ie);if(Ee.g!="")G&&(Ee.g=G+"."+Ee.g),Rl(Ee,Ee.s);else{var Ke=y.location;Ee=Ke.protocol,G=G?G+"."+Ke.hostname:Ke.hostname,Ke=+Ke.port;var dt=new Va(null);Ee&&md(dt,Ee),G&&(dt.g=G),Ke&&Rl(dt,Ke),ie&&(dt.l=ie),Ee=dt}return ie=P.D,G=P.ya,ie&&G&&ui(Ee,ie,G),ui(Ee,"VER",P.la),gd(P,Ee),Ee}function n_(P,G,ie){if(G&&!P.J)throw Error("Can't create secondary domain capable XhrIo object.");return G=P.Ca&&!P.pa?new Me(new Pl({eb:ie})):new Me(P.pa),G.Ha(P.J),G}n.isActive=function(){return!!this.l&&this.l.isActive(this)};function r_(){}n=r_.prototype,n.ua=function(){},n.ta=function(){},n.sa=function(){},n.ra=function(){},n.isActive=function(){return!0},n.Na=function(){};function Gn(){}Gn.prototype.g=function(P,G){return new ga(P,G)};function ga(P,G){Cn.call(this),this.g=new _u(G),this.l=P,this.h=G&&G.messageUrlParams||null,P=G&&G.messageHeaders||null,G&&G.clientProtocolHeaderRequired&&(P?P["X-Client-Protocol"]="webchannel":P={"X-Client-Protocol":"webchannel"}),this.g.o=P,P=G&&G.initMessageHeaders||null,G&&G.messageContentType&&(P?P["X-WebChannel-Content-Type"]=G.messageContentType:P={"X-WebChannel-Content-Type":G.messageContentType}),G&&G.va&&(P?P["X-WebChannel-Client-Profile"]=G.va:P={"X-WebChannel-Client-Profile":G.va}),this.g.S=P,(P=G&&G.Sb)&&!q(P)&&(this.g.m=P),this.v=G&&G.supportsCrossDomainXhr||!1,this.u=G&&G.sendRawJson||!1,(G=G&&G.httpSessionIdParam)&&!q(G)&&(this.g.D=G,P=this.h,P!==null&&G in P&&(P=this.h,G in P&&delete P[G])),this.j=new Eu(this)}L(ga,Cn),ga.prototype.m=function(){this.g.l=this.j,this.v&&(this.g.J=!0),this.g.connect(this.l,this.h||void 0)},ga.prototype.close=function(){Os(this.g)},ga.prototype.o=function(P){var G=this.g;if(typeof P=="string"){var ie={};ie.__data__=P,P=ie}else this.u&&(ie={},ie.__data__=Fr(P),P=ie);G.i.push(new tm(G.Ya++,P)),G.G==3&&Fc(G)},ga.prototype.N=function(){this.g.l=null,delete this.j,Os(this.g),delete this.g,ga.aa.N.call(this)};function SE(P){La.call(this),P.__headers__&&(this.headers=P.__headers__,this.statusCode=P.__status__,delete P.__headers__,delete P.__status__);var G=P.__sm__;if(G){e:{for(const ie in G){P=ie;break e}P=void 0}(this.i=P)&&(P=this.i,G=G!==null&&P in G?G[P]:void 0),this.data=G}else this.data=P}L(SE,La);function bE(){Wo.call(this),this.status=1}L(bE,Wo);function Eu(P){this.g=P}L(Eu,r_),Eu.prototype.ua=function(){En(this.g,"a")},Eu.prototype.ta=function(P){En(this.g,new SE(P))},Eu.prototype.sa=function(P){En(this.g,new bE)},Eu.prototype.ra=function(){En(this.g,"b")},Gn.prototype.createWebChannel=Gn.prototype.g,ga.prototype.send=ga.prototype.o,ga.prototype.open=ga.prototype.m,ga.prototype.close=ga.prototype.close,mse=function(){return new Gn},fse=function(){return Go()},pse=uo,EF={mb:0,pb:1,qb:2,Jb:3,Ob:4,Lb:5,Mb:6,Kb:7,Ib:8,Nb:9,PROXY:10,NOPROXY:11,Gb:12,Cb:13,Db:14,Bb:15,Eb:16,Fb:17,ib:18,hb:19,jb:20},Ni.NO_ERROR=0,Ni.TIMEOUT=8,Ni.HTTP_ERROR=6,Bk=Ni,uu.COMPLETE="complete",hse=uu,Sl.EventType=Ps,Ps.OPEN="a",Ps.CLOSE="b",Ps.ERROR="c",Ps.MESSAGE="d",Cn.prototype.listen=Cn.prototype.K,_C=Sl,Me.prototype.listenOnce=Me.prototype.L,Me.prototype.getLastError=Me.prototype.Ka,Me.prototype.getLastErrorCode=Me.prototype.Ba,Me.prototype.getStatus=Me.prototype.Z,Me.prototype.getResponseJson=Me.prototype.Oa,Me.prototype.getResponseText=Me.prototype.oa,Me.prototype.send=Me.prototype.ea,Me.prototype.setWithCredentials=Me.prototype.Ha,dse=Me}).apply(typeof ik<"u"?ik:typeof self<"u"?self:typeof window<"u"?window:{});const MJ="@firebase/firestore",UJ="4.7.10";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ic{constructor(e){this.uid=e}isAuthenticated(){return this.uid!=null}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}}ic.UNAUTHENTICATED=new ic(null),ic.GOOGLE_CREDENTIALS=new ic("google-credentials-uid"),ic.FIRST_PARTY=new ic("first-party-uid"),ic.MOCK_USER=new ic("mock-user");/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let ZS="11.5.0";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const iE=new D5("@firebase/firestore");function D0(){return iE.logLevel}function ln(n,...e){if(iE.logLevel<=Gr.DEBUG){const i=e.map(W5);iE.debug(`Firestore (${ZS}): ${n}`,...i)}}function qf(n,...e){if(iE.logLevel<=Gr.ERROR){const i=e.map(W5);iE.error(`Firestore (${ZS}): ${n}`,...i)}}function NS(n,...e){if(iE.logLevel<=Gr.WARN){const i=e.map(W5);iE.warn(`Firestore (${ZS}): ${n}`,...i)}}function W5(n){if(typeof n=="string")return n;try{/**
* @license
* Copyright 2020 Google LLC
*
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
*   http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
*/return function(i){return JSON.stringify(i)}(n)}catch{return n}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Zn(n="Unexpected state"){const e=`FIRESTORE (${ZS}) INTERNAL ASSERTION FAILED: `+n;throw qf(e),new Error(e)}function wi(n,e){n||Zn()}function dr(n,e){return n}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const wt={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class Zt extends ph{constructor(e,i){super(e,i),this.code=e,this.message=i,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ff{constructor(){this.promise=new Promise((e,i)=>{this.resolve=e,this.reject=i})}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class gse{constructor(e,i){this.user=i,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${e}`)}}class n3e{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,i){e.enqueueRetryable(()=>i(ic.UNAUTHENTICATED))}shutdown(){}}class r3e{constructor(e){this.token=e,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(e,i){this.changeListener=i,e.enqueueRetryable(()=>i(this.token.user))}shutdown(){this.changeListener=null}}class i3e{constructor(e){this.t=e,this.currentUser=ic.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(e,i){wi(this.o===void 0);let o=this.i;const l=v=>this.i!==o?(o=this.i,i(v)):Promise.resolve();let u=new Ff;this.o=()=>{this.i++,this.currentUser=this.u(),u.resolve(),u=new Ff,e.enqueueRetryable(()=>l(this.currentUser))};const p=()=>{const v=u;e.enqueueRetryable(async()=>{await v.promise,await l(this.currentUser)})},y=v=>{ln("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=v,this.o&&(this.auth.addAuthTokenListener(this.o),p())};this.t.onInit(v=>y(v)),setTimeout(()=>{if(!this.auth){const v=this.t.getImmediate({optional:!0});v?y(v):(ln("FirebaseAuthCredentialsProvider","Auth not yet detected"),u.resolve(),u=new Ff)}},0),p()}getToken(){const e=this.i,i=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(i).then(o=>this.i!==e?(ln("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):o?(wi(typeof o.accessToken=="string"),new gse(o.accessToken,this.currentUser)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.o&&this.auth.removeAuthTokenListener(this.o),this.o=void 0}u(){const e=this.auth&&this.auth.getUid();return wi(e===null||typeof e=="string"),new ic(e)}}class s3e{constructor(e,i,o){this.l=e,this.h=i,this.P=o,this.type="FirstParty",this.user=ic.FIRST_PARTY,this.T=new Map}I(){return this.P?this.P():null}get headers(){this.T.set("X-Goog-AuthUser",this.l);const e=this.I();return e&&this.T.set("Authorization",e),this.h&&this.T.set("X-Goog-Iam-Authorization-Token",this.h),this.T}}class o3e{constructor(e,i,o){this.l=e,this.h=i,this.P=o}getToken(){return Promise.resolve(new s3e(this.l,this.h,this.P))}start(e,i){e.enqueueRetryable(()=>i(ic.FIRST_PARTY))}shutdown(){}invalidateToken(){}}class VJ{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&e.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class a3e{constructor(e,i){this.A=i,this.forceRefresh=!1,this.appCheck=null,this.R=null,this.V=null,dl(e)&&e.settings.appCheckToken&&(this.V=e.settings.appCheckToken)}start(e,i){wi(this.o===void 0);const o=u=>{u.error!=null&&ln("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${u.error.message}`);const p=u.token!==this.R;return this.R=u.token,ln("FirebaseAppCheckTokenProvider",`Received ${p?"new":"existing"} token.`),p?i(u.token):Promise.resolve()};this.o=u=>{e.enqueueRetryable(()=>o(u))};const l=u=>{ln("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=u,this.o&&this.appCheck.addTokenListener(this.o)};this.A.onInit(u=>l(u)),setTimeout(()=>{if(!this.appCheck){const u=this.A.getImmediate({optional:!0});u?l(u):ln("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}},0)}getToken(){if(this.V)return Promise.resolve(new VJ(this.V));const e=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(e).then(i=>i?(wi(typeof i.token=="string"),this.R=i.token,new VJ(i.token)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.o&&this.appCheck.removeTokenListener(this.o),this.o=void 0}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function c3e(n){const e=typeof self<"u"&&(self.crypto||self.msCrypto),i=new Uint8Array(n);if(e&&typeof e.getRandomValues=="function")e.getRandomValues(i);else for(let o=0;o<n;o++)i[o]=Math.floor(256*Math.random());return i}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function _se(){return new TextEncoder}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class yse{static newId(){const e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",i=62*Math.floor(4.129032258064516);let o="";for(;o.length<20;){const l=c3e(40);for(let u=0;u<l.length;++u)o.length<20&&l[u]<i&&(o+=e.charAt(l[u]%62))}return o}}function kr(n,e){return n<e?-1:n>e?1:0}function vF(n,e){let i=0;for(;i<n.length&&i<e.length;){const o=n.codePointAt(i),l=e.codePointAt(i);if(o!==l){if(o<128&&l<128)return kr(o,l);{const u=_se(),p=l3e(u.encode(FJ(n,i)),u.encode(FJ(e,i)));return p!==0?p:kr(o,l)}}i+=o>65535?2:1}return kr(n.length,e.length)}function FJ(n,e){return n.codePointAt(e)>65535?n.substring(e,e+2):n.substring(e,e+1)}function l3e(n,e){for(let i=0;i<n.length&&i<e.length;++i)if(n[i]!==e[i])return kr(n[i],e[i]);return kr(n.length,e.length)}function DS(n,e,i){return n.length===e.length&&n.every((o,l)=>i(o,e[l]))}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const jJ=-62135596800,BJ=1e6;class Fo{static now(){return Fo.fromMillis(Date.now())}static fromDate(e){return Fo.fromMillis(e.getTime())}static fromMillis(e){const i=Math.floor(e/1e3),o=Math.floor((e-1e3*i)*BJ);return new Fo(i,o)}constructor(e,i){if(this.seconds=e,this.nanoseconds=i,i<0)throw new Zt(wt.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+i);if(i>=1e9)throw new Zt(wt.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+i);if(e<jJ)throw new Zt(wt.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e);if(e>=253402300800)throw new Zt(wt.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/BJ}_compareTo(e){return this.seconds===e.seconds?kr(this.nanoseconds,e.nanoseconds):kr(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}}valueOf(){const e=this.seconds-jJ;return String(e).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ar{static fromTimestamp(e){return new ar(e)}static min(){return new ar(new Fo(0,0))}static max(){return new ar(new Fo(253402300799,999999999))}constructor(e){this.timestamp=e}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const zJ="__name__";class cp{constructor(e,i,o){i===void 0?i=0:i>e.length&&Zn(),o===void 0?o=e.length-i:o>e.length-i&&Zn(),this.segments=e,this.offset=i,this.len=o}get length(){return this.len}isEqual(e){return cp.comparator(this,e)===0}child(e){const i=this.segments.slice(this.offset,this.limit());return e instanceof cp?e.forEach(o=>{i.push(o)}):i.push(e),this.construct(i)}limit(){return this.offset+this.length}popFirst(e){return e=e===void 0?1:e,this.construct(this.segments,this.offset+e,this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return this.length===0}isPrefixOf(e){if(e.length<this.length)return!1;for(let i=0;i<this.length;i++)if(this.get(i)!==e.get(i))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let i=0;i<this.length;i++)if(this.get(i)!==e.get(i))return!1;return!0}forEach(e){for(let i=this.offset,o=this.limit();i<o;i++)e(this.segments[i])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,i){const o=Math.min(e.length,i.length);for(let l=0;l<o;l++){const u=cp.compareSegments(e.get(l),i.get(l));if(u!==0)return u}return kr(e.length,i.length)}static compareSegments(e,i){const o=cp.isNumericId(e),l=cp.isNumericId(i);return o&&!l?-1:!o&&l?1:o&&l?cp.extractNumericId(e).compare(cp.extractNumericId(i)):vF(e,i)}static isNumericId(e){return e.startsWith("__id")&&e.endsWith("__")}static extractNumericId(e){return Ng.fromString(e.substring(4,e.length-2))}}class Ji extends cp{construct(e,i,o){return new Ji(e,i,o)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(...e){const i=[];for(const o of e){if(o.indexOf("//")>=0)throw new Zt(wt.INVALID_ARGUMENT,`Invalid segment (${o}). Paths must not contain // in them.`);i.push(...o.split("/").filter(l=>l.length>0))}return new Ji(i)}static emptyPath(){return new Ji([])}}const u3e=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class ka extends cp{construct(e,i,o){return new ka(e,i,o)}static isValidIdentifier(e){return u3e.test(e)}canonicalString(){return this.toArray().map(e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),ka.isValidIdentifier(e)||(e="`"+e+"`"),e)).join(".")}toString(){return this.canonicalString()}isKeyField(){return this.length===1&&this.get(0)===zJ}static keyField(){return new ka([zJ])}static fromServerFormat(e){const i=[];let o="",l=0;const u=()=>{if(o.length===0)throw new Zt(wt.INVALID_ARGUMENT,`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);i.push(o),o=""};let p=!1;for(;l<e.length;){const y=e[l];if(y==="\\"){if(l+1===e.length)throw new Zt(wt.INVALID_ARGUMENT,"Path has trailing escape character: "+e);const v=e[l+1];if(v!=="\\"&&v!=="."&&v!=="`")throw new Zt(wt.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);o+=v,l+=2}else y==="`"?(p=!p,l++):y!=="."||p?(o+=y,l++):(u(),l++)}if(u(),p)throw new Zt(wt.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new ka(i)}static emptyPath(){return new ka([])}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Pn{constructor(e){this.path=e}static fromPath(e){return new Pn(Ji.fromString(e))}static fromName(e){return new Pn(Ji.fromString(e).popFirst(5))}static empty(){return new Pn(Ji.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(e){return e!==null&&Ji.comparator(this.path,e.path)===0}toString(){return this.path.toString()}static comparator(e,i){return Ji.comparator(e.path,i.path)}static isDocumentKey(e){return e.length%2==0}static fromSegments(e){return new Pn(new Ji(e.slice()))}}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const mR=-1;function d3e(n,e){const i=n.toTimestamp().seconds,o=n.toTimestamp().nanoseconds+1,l=ar.fromTimestamp(o===1e9?new Fo(i+1,0):new Fo(i,o));return new Fg(l,Pn.empty(),e)}function h3e(n){return new Fg(n.readTime,n.key,mR)}class Fg{constructor(e,i,o){this.readTime=e,this.documentKey=i,this.largestBatchId=o}static min(){return new Fg(ar.min(),Pn.empty(),mR)}static max(){return new Fg(ar.max(),Pn.empty(),mR)}}function p3e(n,e){let i=n.readTime.compareTo(e.readTime);return i!==0?i:(i=Pn.comparator(n.documentKey,e.documentKey),i!==0?i:kr(n.largestBatchId,e.largestBatchId))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const f3e="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.";class m3e{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach(e=>e())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function eb(n){if(n.code!==wt.FAILED_PRECONDITION||n.message!==f3e)throw n;ln("LocalStore","Unexpectedly lost primary lease")}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class kt{constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e(i=>{this.isDone=!0,this.result=i,this.nextCallback&&this.nextCallback(i)},i=>{this.isDone=!0,this.error=i,this.catchCallback&&this.catchCallback(i)})}catch(e){return this.next(void 0,e)}next(e,i){return this.callbackAttached&&Zn(),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(i,this.error):this.wrapSuccess(e,this.result):new kt((o,l)=>{this.nextCallback=u=>{this.wrapSuccess(e,u).next(o,l)},this.catchCallback=u=>{this.wrapFailure(i,u).next(o,l)}})}toPromise(){return new Promise((e,i)=>{this.next(e,i)})}wrapUserFunction(e){try{const i=e();return i instanceof kt?i:kt.resolve(i)}catch(i){return kt.reject(i)}}wrapSuccess(e,i){return e?this.wrapUserFunction(()=>e(i)):kt.resolve(i)}wrapFailure(e,i){return e?this.wrapUserFunction(()=>e(i)):kt.reject(i)}static resolve(e){return new kt((i,o)=>{i(e)})}static reject(e){return new kt((i,o)=>{o(e)})}static waitFor(e){return new kt((i,o)=>{let l=0,u=0,p=!1;e.forEach(y=>{++l,y.next(()=>{++u,p&&u===l&&i()},v=>o(v))}),p=!0,u===l&&i()})}static or(e){let i=kt.resolve(!1);for(const o of e)i=i.next(l=>l?kt.resolve(l):o());return i}static forEach(e,i){const o=[];return e.forEach((l,u)=>{o.push(i.call(this,l,u))}),this.waitFor(o)}static mapArray(e,i){return new kt((o,l)=>{const u=e.length,p=new Array(u);let y=0;for(let v=0;v<u;v++){const w=v;i(e[w]).next(C=>{p[w]=C,++y,y===u&&o(p)},C=>l(C))}})}static doWhile(e,i){return new kt((o,l)=>{const u=()=>{e()===!0?i().next(()=>{u()},l):o()};u()})}}function g3e(n){const e=n.match(/Android ([\d.]+)/i),i=e?e[1].split(".").slice(0,2).join("."):"-1";return Number(i)}function tb(n){return n.name==="IndexedDbTransactionError"}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class AN{constructor(e,i){this.previousValue=e,i&&(i.sequenceNumberHandler=o=>this.oe(o),this._e=o=>i.writeSequenceNumber(o))}oe(e){return this.previousValue=Math.max(e,this.previousValue),this.previousValue}next(){const e=++this.previousValue;return this._e&&this._e(e),e}}AN.ae=-1;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const G5=-1;function PN(n){return n==null}function bO(n){return n===0&&1/n==-1/0}function _3e(n){return typeof n=="number"&&Number.isInteger(n)&&!bO(n)&&n<=Number.MAX_SAFE_INTEGER&&n>=Number.MIN_SAFE_INTEGER}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ese="";function y3e(n){let e="";for(let i=0;i<n.length;i++)e.length>0&&(e=WJ(e)),e=E3e(n.get(i),e);return WJ(e)}function E3e(n,e){let i=e;const o=n.length;for(let l=0;l<o;l++){const u=n.charAt(l);switch(u){case"\0":i+="";break;case Ese:i+="";break;default:i+=u}}return i}function WJ(n){return n+Ese+""}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function GJ(n){let e=0;for(const i in n)Object.prototype.hasOwnProperty.call(n,i)&&e++;return e}function Jg(n,e){for(const i in n)Object.prototype.hasOwnProperty.call(n,i)&&e(i,n[i])}function vse(n){for(const e in n)if(Object.prototype.hasOwnProperty.call(n,e))return!1;return!0}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class As{constructor(e,i){this.comparator=e,this.root=i||Aa.EMPTY}insert(e,i){return new As(this.comparator,this.root.insert(e,i,this.comparator).copy(null,null,Aa.BLACK,null,null))}remove(e){return new As(this.comparator,this.root.remove(e,this.comparator).copy(null,null,Aa.BLACK,null,null))}get(e){let i=this.root;for(;!i.isEmpty();){const o=this.comparator(e,i.key);if(o===0)return i.value;o<0?i=i.left:o>0&&(i=i.right)}return null}indexOf(e){let i=0,o=this.root;for(;!o.isEmpty();){const l=this.comparator(e,o.key);if(l===0)return i+o.left.size;l<0?o=o.left:(i+=o.left.size+1,o=o.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(e){this.inorderTraversal((i,o)=>(e(i,o),!1))}toString(){const e=[];return this.inorderTraversal((i,o)=>(e.push(`${i}:${o}`),!1)),`{${e.join(", ")}}`}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new sk(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new sk(this.root,e,this.comparator,!1)}getReverseIterator(){return new sk(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new sk(this.root,e,this.comparator,!0)}}class sk{constructor(e,i,o,l){this.isReverse=l,this.nodeStack=[];let u=1;for(;!e.isEmpty();)if(u=i?o(e.key,i):1,i&&l&&(u*=-1),u<0)e=this.isReverse?e.left:e.right;else{if(u===0){this.nodeStack.push(e);break}this.nodeStack.push(e),e=this.isReverse?e.right:e.left}}getNext(){let e=this.nodeStack.pop();const i={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return i}hasNext(){return this.nodeStack.length>0}peek(){if(this.nodeStack.length===0)return null;const e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}}class Aa{constructor(e,i,o,l,u){this.key=e,this.value=i,this.color=o??Aa.RED,this.left=l??Aa.EMPTY,this.right=u??Aa.EMPTY,this.size=this.left.size+1+this.right.size}copy(e,i,o,l,u){return new Aa(e??this.key,i??this.value,o??this.color,l??this.left,u??this.right)}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,i,o){let l=this;const u=o(e,l.key);return l=u<0?l.copy(null,null,null,l.left.insert(e,i,o),null):u===0?l.copy(null,i,null,null,null):l.copy(null,null,null,null,l.right.insert(e,i,o)),l.fixUp()}removeMin(){if(this.left.isEmpty())return Aa.EMPTY;let e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),e=e.copy(null,null,null,e.left.removeMin(),null),e.fixUp()}remove(e,i){let o,l=this;if(i(e,l.key)<0)l.left.isEmpty()||l.left.isRed()||l.left.left.isRed()||(l=l.moveRedLeft()),l=l.copy(null,null,null,l.left.remove(e,i),null);else{if(l.left.isRed()&&(l=l.rotateRight()),l.right.isEmpty()||l.right.isRed()||l.right.left.isRed()||(l=l.moveRedRight()),i(e,l.key)===0){if(l.right.isEmpty())return Aa.EMPTY;o=l.right.min(),l=l.copy(o.key,o.value,null,null,l.right.removeMin())}l=l.copy(null,null,null,null,l.right.remove(e,i))}return l.fixUp()}isRed(){return this.color}fixUp(){let e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e}moveRedLeft(){let e=this.colorFlip();return e.right.left.isRed()&&(e=e.copy(null,null,null,null,e.right.rotateRight()),e=e.rotateLeft(),e=e.colorFlip()),e}moveRedRight(){let e=this.colorFlip();return e.left.left.isRed()&&(e=e.rotateRight(),e=e.colorFlip()),e}rotateLeft(){const e=this.copy(null,null,Aa.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight(){const e=this.copy(null,null,Aa.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip(){const e=this.left.copy(null,null,!this.left.color,null,null),i=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,i)}checkMaxDepth(){const e=this.check();return Math.pow(2,e)<=this.size+1}check(){if(this.isRed()&&this.left.isRed()||this.right.isRed())throw Zn();const e=this.left.check();if(e!==this.right.check())throw Zn();return e+(this.isRed()?0:1)}}Aa.EMPTY=null,Aa.RED=!0,Aa.BLACK=!1;Aa.EMPTY=new class{constructor(){this.size=0}get key(){throw Zn()}get value(){throw Zn()}get color(){throw Zn()}get left(){throw Zn()}get right(){throw Zn()}copy(e,i,o,l,u){return this}insert(e,i,o){return new Aa(e,i)}remove(e,i){return this}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class jo{constructor(e){this.comparator=e,this.data=new As(this.comparator)}has(e){return this.data.get(e)!==null}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(e){this.data.inorderTraversal((i,o)=>(e(i),!1))}forEachInRange(e,i){const o=this.data.getIteratorFrom(e[0]);for(;o.hasNext();){const l=o.getNext();if(this.comparator(l.key,e[1])>=0)return;i(l.key)}}forEachWhile(e,i){let o;for(o=i!==void 0?this.data.getIteratorFrom(i):this.data.getIterator();o.hasNext();)if(!e(o.getNext().key))return}firstAfterOrEqual(e){const i=this.data.getIteratorFrom(e);return i.hasNext()?i.getNext().key:null}getIterator(){return new HJ(this.data.getIterator())}getIteratorFrom(e){return new HJ(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let i=this;return i.size<e.size&&(i=e,e=this),e.forEach(o=>{i=i.add(o)}),i}isEqual(e){if(!(e instanceof jo)||this.size!==e.size)return!1;const i=this.data.getIterator(),o=e.data.getIterator();for(;i.hasNext();){const l=i.getNext().key,u=o.getNext().key;if(this.comparator(l,u)!==0)return!1}return!0}toArray(){const e=[];return this.forEach(i=>{e.push(i)}),e}toString(){const e=[];return this.forEach(i=>e.push(i)),"SortedSet("+e.toString()+")"}copy(e){const i=new jo(this.comparator);return i.data=e,i}}class HJ{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class eu{constructor(e){this.fields=e,e.sort(ka.comparator)}static empty(){return new eu([])}unionWith(e){let i=new jo(ka.comparator);for(const o of this.fields)i=i.add(o);for(const o of e)i=i.add(o);return new eu(i.toArray())}covers(e){for(const i of this.fields)if(i.isPrefixOf(e))return!0;return!1}isEqual(e){return DS(this.fields,e.fields,(i,o)=>i.isEqual(o))}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Sse extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Oa{constructor(e){this.binaryString=e}static fromBase64String(e){const i=function(l){try{return atob(l)}catch(u){throw typeof DOMException<"u"&&u instanceof DOMException?new Sse("Invalid base64 string: "+u):u}}(e);return new Oa(i)}static fromUint8Array(e){const i=function(l){let u="";for(let p=0;p<l.length;++p)u+=String.fromCharCode(l[p]);return u}(e);return new Oa(i)}[Symbol.iterator](){let e=0;return{next:()=>e<this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return function(i){return btoa(i)}(this.binaryString)}toUint8Array(){return function(i){const o=new Uint8Array(i.length);for(let l=0;l<i.length;l++)o[l]=i.charCodeAt(l);return o}(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(e){return kr(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}}Oa.EMPTY_BYTE_STRING=new Oa("");const v3e=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function jg(n){if(wi(!!n),typeof n=="string"){let e=0;const i=v3e.exec(n);if(wi(!!i),i[1]){let l=i[1];l=(l+"000000000").substr(0,9),e=Number(l)}const o=new Date(n);return{seconds:Math.floor(o.getTime()/1e3),nanos:e}}return{seconds:no(n.seconds),nanos:no(n.nanos)}}function no(n){return typeof n=="number"?n:typeof n=="string"?Number(n):0}function Bg(n){return typeof n=="string"?Oa.fromBase64String(n):Oa.fromUint8Array(n)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const bse="server_timestamp",wse="__type__",Tse="__previous_value__",Cse="__local_write_time__";function kN(n){var e,i;return((i=(((e=n==null?void 0:n.mapValue)===null||e===void 0?void 0:e.fields)||{})[wse])===null||i===void 0?void 0:i.stringValue)===bse}function ON(n){const e=n.mapValue.fields[Tse];return kN(e)?ON(e):e}function gR(n){const e=jg(n.mapValue.fields[Cse].timestampValue);return new Fo(e.seconds,e.nanos)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class S3e{constructor(e,i,o,l,u,p,y,v,w){this.databaseId=e,this.appId=i,this.persistenceKey=o,this.host=l,this.ssl=u,this.forceLongPolling=p,this.autoDetectLongPolling=y,this.longPollingOptions=v,this.useFetchStreams=w}}const wO="(default)";class _R{constructor(e,i){this.projectId=e,this.database=i||wO}static empty(){return new _R("","")}get isDefaultDatabase(){return this.database===wO}isEqual(e){return e instanceof _R&&e.projectId===this.projectId&&e.database===this.database}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Rse="__type__",b3e="__max__",ok={mapValue:{}},Ise="__vector__",TO="value";function zg(n){return"nullValue"in n?0:"booleanValue"in n?1:"integerValue"in n||"doubleValue"in n?2:"timestampValue"in n?3:"stringValue"in n?5:"bytesValue"in n?6:"referenceValue"in n?7:"geoPointValue"in n?8:"arrayValue"in n?9:"mapValue"in n?kN(n)?4:T3e(n)?9007199254740991:w3e(n)?10:11:Zn()}function Np(n,e){if(n===e)return!0;const i=zg(n);if(i!==zg(e))return!1;switch(i){case 0:case 9007199254740991:return!0;case 1:return n.booleanValue===e.booleanValue;case 4:return gR(n).isEqual(gR(e));case 3:return function(l,u){if(typeof l.timestampValue=="string"&&typeof u.timestampValue=="string"&&l.timestampValue.length===u.timestampValue.length)return l.timestampValue===u.timestampValue;const p=jg(l.timestampValue),y=jg(u.timestampValue);return p.seconds===y.seconds&&p.nanos===y.nanos}(n,e);case 5:return n.stringValue===e.stringValue;case 6:return function(l,u){return Bg(l.bytesValue).isEqual(Bg(u.bytesValue))}(n,e);case 7:return n.referenceValue===e.referenceValue;case 8:return function(l,u){return no(l.geoPointValue.latitude)===no(u.geoPointValue.latitude)&&no(l.geoPointValue.longitude)===no(u.geoPointValue.longitude)}(n,e);case 2:return function(l,u){if("integerValue"in l&&"integerValue"in u)return no(l.integerValue)===no(u.integerValue);if("doubleValue"in l&&"doubleValue"in u){const p=no(l.doubleValue),y=no(u.doubleValue);return p===y?bO(p)===bO(y):isNaN(p)&&isNaN(y)}return!1}(n,e);case 9:return DS(n.arrayValue.values||[],e.arrayValue.values||[],Np);case 10:case 11:return function(l,u){const p=l.mapValue.fields||{},y=u.mapValue.fields||{};if(GJ(p)!==GJ(y))return!1;for(const v in p)if(p.hasOwnProperty(v)&&(y[v]===void 0||!Np(p[v],y[v])))return!1;return!0}(n,e);default:return Zn()}}function yR(n,e){return(n.values||[]).find(i=>Np(i,e))!==void 0}function xS(n,e){if(n===e)return 0;const i=zg(n),o=zg(e);if(i!==o)return kr(i,o);switch(i){case 0:case 9007199254740991:return 0;case 1:return kr(n.booleanValue,e.booleanValue);case 2:return function(u,p){const y=no(u.integerValue||u.doubleValue),v=no(p.integerValue||p.doubleValue);return y<v?-1:y>v?1:y===v?0:isNaN(y)?isNaN(v)?0:-1:1}(n,e);case 3:return $J(n.timestampValue,e.timestampValue);case 4:return $J(gR(n),gR(e));case 5:return vF(n.stringValue,e.stringValue);case 6:return function(u,p){const y=Bg(u),v=Bg(p);return y.compareTo(v)}(n.bytesValue,e.bytesValue);case 7:return function(u,p){const y=u.split("/"),v=p.split("/");for(let w=0;w<y.length&&w<v.length;w++){const C=kr(y[w],v[w]);if(C!==0)return C}return kr(y.length,v.length)}(n.referenceValue,e.referenceValue);case 8:return function(u,p){const y=kr(no(u.latitude),no(p.latitude));return y!==0?y:kr(no(u.longitude),no(p.longitude))}(n.geoPointValue,e.geoPointValue);case 9:return KJ(n.arrayValue,e.arrayValue);case 10:return function(u,p){var y,v,w,C;const R=u.fields||{},N=p.fields||{},M=(y=R[TO])===null||y===void 0?void 0:y.arrayValue,L=(v=N[TO])===null||v===void 0?void 0:v.arrayValue,U=kr(((w=M==null?void 0:M.values)===null||w===void 0?void 0:w.length)||0,((C=L==null?void 0:L.values)===null||C===void 0?void 0:C.length)||0);return U!==0?U:KJ(M,L)}(n.mapValue,e.mapValue);case 11:return function(u,p){if(u===ok.mapValue&&p===ok.mapValue)return 0;if(u===ok.mapValue)return 1;if(p===ok.mapValue)return-1;const y=u.fields||{},v=Object.keys(y),w=p.fields||{},C=Object.keys(w);v.sort(),C.sort();for(let R=0;R<v.length&&R<C.length;++R){const N=vF(v[R],C[R]);if(N!==0)return N;const M=xS(y[v[R]],w[C[R]]);if(M!==0)return M}return kr(v.length,C.length)}(n.mapValue,e.mapValue);default:throw Zn()}}function $J(n,e){if(typeof n=="string"&&typeof e=="string"&&n.length===e.length)return kr(n,e);const i=jg(n),o=jg(e),l=kr(i.seconds,o.seconds);return l!==0?l:kr(i.nanos,o.nanos)}function KJ(n,e){const i=n.values||[],o=e.values||[];for(let l=0;l<i.length&&l<o.length;++l){const u=xS(i[l],o[l]);if(u)return u}return kr(i.length,o.length)}function LS(n){return SF(n)}function SF(n){return"nullValue"in n?"null":"booleanValue"in n?""+n.booleanValue:"integerValue"in n?""+n.integerValue:"doubleValue"in n?""+n.doubleValue:"timestampValue"in n?function(i){const o=jg(i);return`time(${o.seconds},${o.nanos})`}(n.timestampValue):"stringValue"in n?n.stringValue:"bytesValue"in n?function(i){return Bg(i).toBase64()}(n.bytesValue):"referenceValue"in n?function(i){return Pn.fromName(i).toString()}(n.referenceValue):"geoPointValue"in n?function(i){return`geo(${i.latitude},${i.longitude})`}(n.geoPointValue):"arrayValue"in n?function(i){let o="[",l=!0;for(const u of i.values||[])l?l=!1:o+=",",o+=SF(u);return o+"]"}(n.arrayValue):"mapValue"in n?function(i){const o=Object.keys(i.fields||{}).sort();let l="{",u=!0;for(const p of o)u?u=!1:l+=",",l+=`${p}:${SF(i.fields[p])}`;return l+"}"}(n.mapValue):Zn()}function zk(n){switch(zg(n)){case 0:case 1:return 4;case 2:return 8;case 3:case 8:return 16;case 4:const e=ON(n);return e?16+zk(e):16;case 5:return 2*n.stringValue.length;case 6:return Bg(n.bytesValue).approximateByteSize();case 7:return n.referenceValue.length;case 9:return function(o){return(o.values||[]).reduce((l,u)=>l+zk(u),0)}(n.arrayValue);case 10:case 11:return function(o){let l=0;return Jg(o.fields,(u,p)=>{l+=u.length+zk(p)}),l}(n.mapValue);default:throw Zn()}}function CO(n,e){return{referenceValue:`projects/${n.projectId}/databases/${n.database}/documents/${e.path.canonicalString()}`}}function bF(n){return!!n&&"integerValue"in n}function H5(n){return!!n&&"arrayValue"in n}function qJ(n){return!!n&&"nullValue"in n}function YJ(n){return!!n&&"doubleValue"in n&&isNaN(Number(n.doubleValue))}function Wk(n){return!!n&&"mapValue"in n}function w3e(n){var e,i;return((i=(((e=n==null?void 0:n.mapValue)===null||e===void 0?void 0:e.fields)||{})[Rse])===null||i===void 0?void 0:i.stringValue)===Ise}function FC(n){if(n.geoPointValue)return{geoPointValue:Object.assign({},n.geoPointValue)};if(n.timestampValue&&typeof n.timestampValue=="object")return{timestampValue:Object.assign({},n.timestampValue)};if(n.mapValue){const e={mapValue:{fields:{}}};return Jg(n.mapValue.fields,(i,o)=>e.mapValue.fields[i]=FC(o)),e}if(n.arrayValue){const e={arrayValue:{values:[]}};for(let i=0;i<(n.arrayValue.values||[]).length;++i)e.arrayValue.values[i]=FC(n.arrayValue.values[i]);return e}return Object.assign({},n)}function T3e(n){return(((n.mapValue||{}).fields||{}).__type__||{}).stringValue===b3e}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class hl{constructor(e){this.value=e}static empty(){return new hl({mapValue:{}})}field(e){if(e.isEmpty())return this.value;{let i=this.value;for(let o=0;o<e.length-1;++o)if(i=(i.mapValue.fields||{})[e.get(o)],!Wk(i))return null;return i=(i.mapValue.fields||{})[e.lastSegment()],i||null}}set(e,i){this.getFieldsMap(e.popLast())[e.lastSegment()]=FC(i)}setAll(e){let i=ka.emptyPath(),o={},l=[];e.forEach((p,y)=>{if(!i.isImmediateParentOf(y)){const v=this.getFieldsMap(i);this.applyChanges(v,o,l),o={},l=[],i=y.popLast()}p?o[y.lastSegment()]=FC(p):l.push(y.lastSegment())});const u=this.getFieldsMap(i);this.applyChanges(u,o,l)}delete(e){const i=this.field(e.popLast());Wk(i)&&i.mapValue.fields&&delete i.mapValue.fields[e.lastSegment()]}isEqual(e){return Np(this.value,e.value)}getFieldsMap(e){let i=this.value;i.mapValue.fields||(i.mapValue={fields:{}});for(let o=0;o<e.length;++o){let l=i.mapValue.fields[e.get(o)];Wk(l)&&l.mapValue.fields||(l={mapValue:{fields:{}}},i.mapValue.fields[e.get(o)]=l),i=l}return i.mapValue.fields}applyChanges(e,i,o){Jg(i,(l,u)=>e[l]=u);for(const l of o)delete e[l]}clone(){return new hl(FC(this.value))}}function Ase(n){const e=[];return Jg(n.fields,(i,o)=>{const l=new ka([i]);if(Wk(o)){const u=Ase(o.mapValue).fields;if(u.length===0)e.push(l);else for(const p of u)e.push(l.child(p))}else e.push(l)}),new eu(e)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class sc{constructor(e,i,o,l,u,p,y){this.key=e,this.documentType=i,this.version=o,this.readTime=l,this.createTime=u,this.data=p,this.documentState=y}static newInvalidDocument(e){return new sc(e,0,ar.min(),ar.min(),ar.min(),hl.empty(),0)}static newFoundDocument(e,i,o,l){return new sc(e,1,i,ar.min(),o,l,0)}static newNoDocument(e,i){return new sc(e,2,i,ar.min(),ar.min(),hl.empty(),0)}static newUnknownDocument(e,i){return new sc(e,3,i,ar.min(),ar.min(),hl.empty(),2)}convertToFoundDocument(e,i){return!this.createTime.isEqual(ar.min())||this.documentType!==2&&this.documentType!==0||(this.createTime=e),this.version=e,this.documentType=1,this.data=i,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=hl.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=hl.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=ar.min(),this}setReadTime(e){return this.readTime=e,this}get hasLocalMutations(){return this.documentState===1}get hasCommittedMutations(){return this.documentState===2}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return this.documentType!==0}isFoundDocument(){return this.documentType===1}isNoDocument(){return this.documentType===2}isUnknownDocument(){return this.documentType===3}isEqual(e){return e instanceof sc&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}mutableCopy(){return new sc(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class MS{constructor(e,i){this.position=e,this.inclusive=i}}function XJ(n,e,i){let o=0;for(let l=0;l<n.position.length;l++){const u=e[l],p=n.position[l];if(u.field.isKeyField()?o=Pn.comparator(Pn.fromName(p.referenceValue),i.key):o=xS(p,i.data.field(u.field)),u.dir==="desc"&&(o*=-1),o!==0)break}return o}function JJ(n,e){if(n===null)return e===null;if(e===null||n.inclusive!==e.inclusive||n.position.length!==e.position.length)return!1;for(let i=0;i<n.position.length;i++)if(!Np(n.position[i],e.position[i]))return!1;return!0}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ER{constructor(e,i="asc"){this.field=e,this.dir=i}}function C3e(n,e){return n.dir===e.dir&&n.field.isEqual(e.field)}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Pse{}class vo extends Pse{constructor(e,i,o){super(),this.field=e,this.op=i,this.value=o}static create(e,i,o){return e.isKeyField()?i==="in"||i==="not-in"?this.createKeyFieldInFilter(e,i,o):new I3e(e,i,o):i==="array-contains"?new k3e(e,o):i==="in"?new O3e(e,o):i==="not-in"?new N3e(e,o):i==="array-contains-any"?new D3e(e,o):new vo(e,i,o)}static createKeyFieldInFilter(e,i,o){return i==="in"?new A3e(e,o):new P3e(e,o)}matches(e){const i=e.data.field(this.field);return this.op==="!="?i!==null&&this.matchesComparison(xS(i,this.value)):i!==null&&zg(this.value)===zg(i)&&this.matchesComparison(xS(i,this.value))}matchesComparison(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return e===0;case"!=":return e!==0;case">":return e>0;case">=":return e>=0;default:return Zn()}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}}class hh extends Pse{constructor(e,i){super(),this.filters=e,this.op=i,this.ce=null}static create(e,i){return new hh(e,i)}matches(e){return kse(this)?this.filters.find(i=>!i.matches(e))===void 0:this.filters.find(i=>i.matches(e))!==void 0}getFlattenedFilters(){return this.ce!==null||(this.ce=this.filters.reduce((e,i)=>e.concat(i.getFlattenedFilters()),[])),this.ce}getFilters(){return Object.assign([],this.filters)}}function kse(n){return n.op==="and"}function Ose(n){return R3e(n)&&kse(n)}function R3e(n){for(const e of n.filters)if(e instanceof hh)return!1;return!0}function wF(n){if(n instanceof vo)return n.field.canonicalString()+n.op.toString()+LS(n.value);if(Ose(n))return n.filters.map(e=>wF(e)).join(",");{const e=n.filters.map(i=>wF(i)).join(",");return`${n.op}(${e})`}}function Nse(n,e){return n instanceof vo?function(o,l){return l instanceof vo&&o.op===l.op&&o.field.isEqual(l.field)&&Np(o.value,l.value)}(n,e):n instanceof hh?function(o,l){return l instanceof hh&&o.op===l.op&&o.filters.length===l.filters.length?o.filters.reduce((u,p,y)=>u&&Nse(p,l.filters[y]),!0):!1}(n,e):void Zn()}function Dse(n){return n instanceof vo?function(i){return`${i.field.canonicalString()} ${i.op} ${LS(i.value)}`}(n):n instanceof hh?function(i){return i.op.toString()+" {"+i.getFilters().map(Dse).join(" ,")+"}"}(n):"Filter"}class I3e extends vo{constructor(e,i,o){super(e,i,o),this.key=Pn.fromName(o.referenceValue)}matches(e){const i=Pn.comparator(e.key,this.key);return this.matchesComparison(i)}}class A3e extends vo{constructor(e,i){super(e,"in",i),this.keys=xse("in",i)}matches(e){return this.keys.some(i=>i.isEqual(e.key))}}class P3e extends vo{constructor(e,i){super(e,"not-in",i),this.keys=xse("not-in",i)}matches(e){return!this.keys.some(i=>i.isEqual(e.key))}}function xse(n,e){var i;return(((i=e.arrayValue)===null||i===void 0?void 0:i.values)||[]).map(o=>Pn.fromName(o.referenceValue))}class k3e extends vo{constructor(e,i){super(e,"array-contains",i)}matches(e){const i=e.data.field(this.field);return H5(i)&&yR(i.arrayValue,this.value)}}class O3e extends vo{constructor(e,i){super(e,"in",i)}matches(e){const i=e.data.field(this.field);return i!==null&&yR(this.value.arrayValue,i)}}class N3e extends vo{constructor(e,i){super(e,"not-in",i)}matches(e){if(yR(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;const i=e.data.field(this.field);return i!==null&&!yR(this.value.arrayValue,i)}}class D3e extends vo{constructor(e,i){super(e,"array-contains-any",i)}matches(e){const i=e.data.field(this.field);return!(!H5(i)||!i.arrayValue.values)&&i.arrayValue.values.some(o=>yR(this.value.arrayValue,o))}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class x3e{constructor(e,i=null,o=[],l=[],u=null,p=null,y=null){this.path=e,this.collectionGroup=i,this.orderBy=o,this.filters=l,this.limit=u,this.startAt=p,this.endAt=y,this.le=null}}function QJ(n,e=null,i=[],o=[],l=null,u=null,p=null){return new x3e(n,e,i,o,l,u,p)}function $5(n){const e=dr(n);if(e.le===null){let i=e.path.canonicalString();e.collectionGroup!==null&&(i+="|cg:"+e.collectionGroup),i+="|f:",i+=e.filters.map(o=>wF(o)).join(","),i+="|ob:",i+=e.orderBy.map(o=>function(u){return u.field.canonicalString()+u.dir}(o)).join(","),PN(e.limit)||(i+="|l:",i+=e.limit),e.startAt&&(i+="|lb:",i+=e.startAt.inclusive?"b:":"a:",i+=e.startAt.position.map(o=>LS(o)).join(",")),e.endAt&&(i+="|ub:",i+=e.endAt.inclusive?"a:":"b:",i+=e.endAt.position.map(o=>LS(o)).join(",")),e.le=i}return e.le}function K5(n,e){if(n.limit!==e.limit||n.orderBy.length!==e.orderBy.length)return!1;for(let i=0;i<n.orderBy.length;i++)if(!C3e(n.orderBy[i],e.orderBy[i]))return!1;if(n.filters.length!==e.filters.length)return!1;for(let i=0;i<n.filters.length;i++)if(!Nse(n.filters[i],e.filters[i]))return!1;return n.collectionGroup===e.collectionGroup&&!!n.path.isEqual(e.path)&&!!JJ(n.startAt,e.startAt)&&JJ(n.endAt,e.endAt)}function TF(n){return Pn.isDocumentKey(n.path)&&n.collectionGroup===null&&n.filters.length===0}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class dE{constructor(e,i=null,o=[],l=[],u=null,p="F",y=null,v=null){this.path=e,this.collectionGroup=i,this.explicitOrderBy=o,this.filters=l,this.limit=u,this.limitType=p,this.startAt=y,this.endAt=v,this.he=null,this.Pe=null,this.Te=null,this.startAt,this.endAt}}function L3e(n,e,i,o,l,u,p,y){return new dE(n,e,i,o,l,u,p,y)}function NN(n){return new dE(n)}function ZJ(n){return n.filters.length===0&&n.limit===null&&n.startAt==null&&n.endAt==null&&(n.explicitOrderBy.length===0||n.explicitOrderBy.length===1&&n.explicitOrderBy[0].field.isKeyField())}function q5(n){return n.collectionGroup!==null}function mS(n){const e=dr(n);if(e.he===null){e.he=[];const i=new Set;for(const u of e.explicitOrderBy)e.he.push(u),i.add(u.field.canonicalString());const o=e.explicitOrderBy.length>0?e.explicitOrderBy[e.explicitOrderBy.length-1].dir:"asc";(function(p){let y=new jo(ka.comparator);return p.filters.forEach(v=>{v.getFlattenedFilters().forEach(w=>{w.isInequality()&&(y=y.add(w.field))})}),y})(e).forEach(u=>{i.has(u.canonicalString())||u.isKeyField()||e.he.push(new ER(u,o))}),i.has(ka.keyField().canonicalString())||e.he.push(new ER(ka.keyField(),o))}return e.he}function Pp(n){const e=dr(n);return e.Pe||(e.Pe=M3e(e,mS(n))),e.Pe}function M3e(n,e){if(n.limitType==="F")return QJ(n.path,n.collectionGroup,e,n.filters,n.limit,n.startAt,n.endAt);{e=e.map(l=>{const u=l.dir==="desc"?"asc":"desc";return new ER(l.field,u)});const i=n.endAt?new MS(n.endAt.position,n.endAt.inclusive):null,o=n.startAt?new MS(n.startAt.position,n.startAt.inclusive):null;return QJ(n.path,n.collectionGroup,e,n.filters,n.limit,i,o)}}function CF(n,e){const i=n.filters.concat([e]);return new dE(n.path,n.collectionGroup,n.explicitOrderBy.slice(),i,n.limit,n.limitType,n.startAt,n.endAt)}function RO(n,e,i){return new dE(n.path,n.collectionGroup,n.explicitOrderBy.slice(),n.filters.slice(),e,i,n.startAt,n.endAt)}function DN(n,e){return K5(Pp(n),Pp(e))&&n.limitType===e.limitType}function Lse(n){return`${$5(Pp(n))}|lt:${n.limitType}`}function x0(n){return`Query(target=${function(i){let o=i.path.canonicalString();return i.collectionGroup!==null&&(o+=" collectionGroup="+i.collectionGroup),i.filters.length>0&&(o+=`, filters: [${i.filters.map(l=>Dse(l)).join(", ")}]`),PN(i.limit)||(o+=", limit: "+i.limit),i.orderBy.length>0&&(o+=`, orderBy: [${i.orderBy.map(l=>function(p){return`${p.field.canonicalString()} (${p.dir})`}(l)).join(", ")}]`),i.startAt&&(o+=", startAt: ",o+=i.startAt.inclusive?"b:":"a:",o+=i.startAt.position.map(l=>LS(l)).join(",")),i.endAt&&(o+=", endAt: ",o+=i.endAt.inclusive?"a:":"b:",o+=i.endAt.position.map(l=>LS(l)).join(",")),`Target(${o})`}(Pp(n))}; limitType=${n.limitType})`}function xN(n,e){return e.isFoundDocument()&&function(o,l){const u=l.key.path;return o.collectionGroup!==null?l.key.hasCollectionId(o.collectionGroup)&&o.path.isPrefixOf(u):Pn.isDocumentKey(o.path)?o.path.isEqual(u):o.path.isImmediateParentOf(u)}(n,e)&&function(o,l){for(const u of mS(o))if(!u.field.isKeyField()&&l.data.field(u.field)===null)return!1;return!0}(n,e)&&function(o,l){for(const u of o.filters)if(!u.matches(l))return!1;return!0}(n,e)&&function(o,l){return!(o.startAt&&!function(p,y,v){const w=XJ(p,y,v);return p.inclusive?w<=0:w<0}(o.startAt,mS(o),l)||o.endAt&&!function(p,y,v){const w=XJ(p,y,v);return p.inclusive?w>=0:w>0}(o.endAt,mS(o),l))}(n,e)}function U3e(n){return n.collectionGroup||(n.path.length%2==1?n.path.lastSegment():n.path.get(n.path.length-2))}function Mse(n){return(e,i)=>{let o=!1;for(const l of mS(n)){const u=V3e(l,e,i);if(u!==0)return u;o=o||l.field.isKeyField()}return 0}}function V3e(n,e,i){const o=n.field.isKeyField()?Pn.comparator(e.key,i.key):function(u,p,y){const v=p.data.field(u),w=y.data.field(u);return v!==null&&w!==null?xS(v,w):Zn()}(n.field,e,i);switch(n.dir){case"asc":return o;case"desc":return-1*o;default:return Zn()}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class hE{constructor(e,i){this.mapKeyFn=e,this.equalsFn=i,this.inner={},this.innerSize=0}get(e){const i=this.mapKeyFn(e),o=this.inner[i];if(o!==void 0){for(const[l,u]of o)if(this.equalsFn(l,e))return u}}has(e){return this.get(e)!==void 0}set(e,i){const o=this.mapKeyFn(e),l=this.inner[o];if(l===void 0)return this.inner[o]=[[e,i]],void this.innerSize++;for(let u=0;u<l.length;u++)if(this.equalsFn(l[u][0],e))return void(l[u]=[e,i]);l.push([e,i]),this.innerSize++}delete(e){const i=this.mapKeyFn(e),o=this.inner[i];if(o===void 0)return!1;for(let l=0;l<o.length;l++)if(this.equalsFn(o[l][0],e))return o.length===1?delete this.inner[i]:o.splice(l,1),this.innerSize--,!0;return!1}forEach(e){Jg(this.inner,(i,o)=>{for(const[l,u]of o)e(l,u)})}isEmpty(){return vse(this.inner)}size(){return this.innerSize}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const F3e=new As(Pn.comparator);function Yf(){return F3e}const Use=new As(Pn.comparator);function yC(...n){let e=Use;for(const i of n)e=e.insert(i.key,i);return e}function Vse(n){let e=Use;return n.forEach((i,o)=>e=e.insert(i,o.overlayedDocument)),e}function Ly(){return jC()}function Fse(){return jC()}function jC(){return new hE(n=>n.toString(),(n,e)=>n.isEqual(e))}const j3e=new As(Pn.comparator),B3e=new jo(Pn.comparator);function Hr(...n){let e=B3e;for(const i of n)e=e.add(i);return e}const z3e=new jo(kr);function W3e(){return z3e}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Y5(n,e){if(n.useProto3Json){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:bO(e)?"-0":e}}function jse(n){return{integerValue:""+n}}function G3e(n,e){return _3e(e)?jse(e):Y5(n,e)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class LN{constructor(){this._=void 0}}function H3e(n,e,i){return n instanceof IO?function(l,u){const p={fields:{[wse]:{stringValue:bse},[Cse]:{timestampValue:{seconds:l.seconds,nanos:l.nanoseconds}}}};return u&&kN(u)&&(u=ON(u)),u&&(p.fields[Tse]=u),{mapValue:p}}(i,e):n instanceof US?zse(n,e):n instanceof VS?Wse(n,e):function(l,u){const p=Bse(l,u),y=eQ(p)+eQ(l.Ie);return bF(p)&&bF(l.Ie)?jse(y):Y5(l.serializer,y)}(n,e)}function $3e(n,e,i){return n instanceof US?zse(n,e):n instanceof VS?Wse(n,e):i}function Bse(n,e){return n instanceof AO?function(o){return bF(o)||function(u){return!!u&&"doubleValue"in u}(o)}(e)?e:{integerValue:0}:null}class IO extends LN{}class US extends LN{constructor(e){super(),this.elements=e}}function zse(n,e){const i=Gse(e);for(const o of n.elements)i.some(l=>Np(l,o))||i.push(o);return{arrayValue:{values:i}}}class VS extends LN{constructor(e){super(),this.elements=e}}function Wse(n,e){let i=Gse(e);for(const o of n.elements)i=i.filter(l=>!Np(l,o));return{arrayValue:{values:i}}}class AO extends LN{constructor(e,i){super(),this.serializer=e,this.Ie=i}}function eQ(n){return no(n.integerValue||n.doubleValue)}function Gse(n){return H5(n)&&n.arrayValue.values?n.arrayValue.values.slice():[]}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Hse{constructor(e,i){this.field=e,this.transform=i}}function K3e(n,e){return n.field.isEqual(e.field)&&function(o,l){return o instanceof US&&l instanceof US||o instanceof VS&&l instanceof VS?DS(o.elements,l.elements,Np):o instanceof AO&&l instanceof AO?Np(o.Ie,l.Ie):o instanceof IO&&l instanceof IO}(n.transform,e.transform)}class q3e{constructor(e,i){this.version=e,this.transformResults=i}}class rd{constructor(e,i){this.updateTime=e,this.exists=i}static none(){return new rd}static exists(e){return new rd(void 0,e)}static updateTime(e){return new rd(e)}get isNone(){return this.updateTime===void 0&&this.exists===void 0}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}}function Gk(n,e){return n.updateTime!==void 0?e.isFoundDocument()&&e.version.isEqual(n.updateTime):n.exists===void 0||n.exists===e.isFoundDocument()}class MN{}function $se(n,e){if(!n.hasLocalMutations||e&&e.fields.length===0)return null;if(e===null)return n.isNoDocument()?new X5(n.key,rd.none()):new qR(n.key,n.data,rd.none());{const i=n.data,o=hl.empty();let l=new jo(ka.comparator);for(let u of e.fields)if(!l.has(u)){let p=i.field(u);p===null&&u.length>1&&(u=u.popLast(),p=i.field(u)),p===null?o.delete(u):o.set(u,p),l=l.add(u)}return new Qg(n.key,o,new eu(l.toArray()),rd.none())}}function Y3e(n,e,i){n instanceof qR?function(l,u,p){const y=l.value.clone(),v=nQ(l.fieldTransforms,u,p.transformResults);y.setAll(v),u.convertToFoundDocument(p.version,y).setHasCommittedMutations()}(n,e,i):n instanceof Qg?function(l,u,p){if(!Gk(l.precondition,u))return void u.convertToUnknownDocument(p.version);const y=nQ(l.fieldTransforms,u,p.transformResults),v=u.data;v.setAll(Kse(l)),v.setAll(y),u.convertToFoundDocument(p.version,v).setHasCommittedMutations()}(n,e,i):function(l,u,p){u.convertToNoDocument(p.version).setHasCommittedMutations()}(0,e,i)}function BC(n,e,i,o){return n instanceof qR?function(u,p,y,v){if(!Gk(u.precondition,p))return y;const w=u.value.clone(),C=rQ(u.fieldTransforms,v,p);return w.setAll(C),p.convertToFoundDocument(p.version,w).setHasLocalMutations(),null}(n,e,i,o):n instanceof Qg?function(u,p,y,v){if(!Gk(u.precondition,p))return y;const w=rQ(u.fieldTransforms,v,p),C=p.data;return C.setAll(Kse(u)),C.setAll(w),p.convertToFoundDocument(p.version,C).setHasLocalMutations(),y===null?null:y.unionWith(u.fieldMask.fields).unionWith(u.fieldTransforms.map(R=>R.field))}(n,e,i,o):function(u,p,y){return Gk(u.precondition,p)?(p.convertToNoDocument(p.version).setHasLocalMutations(),null):y}(n,e,i)}function X3e(n,e){let i=null;for(const o of n.fieldTransforms){const l=e.data.field(o.field),u=Bse(o.transform,l||null);u!=null&&(i===null&&(i=hl.empty()),i.set(o.field,u))}return i||null}function tQ(n,e){return n.type===e.type&&!!n.key.isEqual(e.key)&&!!n.precondition.isEqual(e.precondition)&&!!function(o,l){return o===void 0&&l===void 0||!(!o||!l)&&DS(o,l,(u,p)=>K3e(u,p))}(n.fieldTransforms,e.fieldTransforms)&&(n.type===0?n.value.isEqual(e.value):n.type!==1||n.data.isEqual(e.data)&&n.fieldMask.isEqual(e.fieldMask))}class qR extends MN{constructor(e,i,o,l=[]){super(),this.key=e,this.value=i,this.precondition=o,this.fieldTransforms=l,this.type=0}getFieldMask(){return null}}class Qg extends MN{constructor(e,i,o,l,u=[]){super(),this.key=e,this.data=i,this.fieldMask=o,this.precondition=l,this.fieldTransforms=u,this.type=1}getFieldMask(){return this.fieldMask}}function Kse(n){const e=new Map;return n.fieldMask.fields.forEach(i=>{if(!i.isEmpty()){const o=n.data.field(i);e.set(i,o)}}),e}function nQ(n,e,i){const o=new Map;wi(n.length===i.length);for(let l=0;l<i.length;l++){const u=n[l],p=u.transform,y=e.data.field(u.field);o.set(u.field,$3e(p,y,i[l]))}return o}function rQ(n,e,i){const o=new Map;for(const l of n){const u=l.transform,p=i.data.field(l.field);o.set(l.field,H3e(u,p,e))}return o}class X5 extends MN{constructor(e,i){super(),this.key=e,this.precondition=i,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}}class J3e extends MN{constructor(e,i){super(),this.key=e,this.precondition=i,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Q3e{constructor(e,i,o,l){this.batchId=e,this.localWriteTime=i,this.baseMutations=o,this.mutations=l}applyToRemoteDocument(e,i){const o=i.mutationResults;for(let l=0;l<this.mutations.length;l++){const u=this.mutations[l];u.key.isEqual(e.key)&&Y3e(u,e,o[l])}}applyToLocalView(e,i){for(const o of this.baseMutations)o.key.isEqual(e.key)&&(i=BC(o,e,i,this.localWriteTime));for(const o of this.mutations)o.key.isEqual(e.key)&&(i=BC(o,e,i,this.localWriteTime));return i}applyToLocalDocumentSet(e,i){const o=Fse();return this.mutations.forEach(l=>{const u=e.get(l.key),p=u.overlayedDocument;let y=this.applyToLocalView(p,u.mutatedFields);y=i.has(l.key)?null:y;const v=$se(p,y);v!==null&&o.set(l.key,v),p.isValidDocument()||p.convertToNoDocument(ar.min())}),o}keys(){return this.mutations.reduce((e,i)=>e.add(i.key),Hr())}isEqual(e){return this.batchId===e.batchId&&DS(this.mutations,e.mutations,(i,o)=>tQ(i,o))&&DS(this.baseMutations,e.baseMutations,(i,o)=>tQ(i,o))}}class J5{constructor(e,i,o,l){this.batch=e,this.commitVersion=i,this.mutationResults=o,this.docVersions=l}static from(e,i,o){wi(e.mutations.length===o.length);let l=function(){return j3e}();const u=e.mutations;for(let p=0;p<u.length;p++)l=l.insert(u[p].key,o[p].version);return new J5(e,i,o,l)}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Z3e{constructor(e,i){this.largestBatchId=e,this.mutation=i}getKey(){return this.mutation.key}isEqual(e){return e!==null&&this.mutation===e.mutation}toString(){return`Overlay{
      largestBatchId: ${this.largestBatchId},
      mutation: ${this.mutation.toString()}
    }`}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class e4e{constructor(e,i){this.count=e,this.unchangedNames=i}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var go,Zr;function t4e(n){switch(n){case wt.OK:return Zn();case wt.CANCELLED:case wt.UNKNOWN:case wt.DEADLINE_EXCEEDED:case wt.RESOURCE_EXHAUSTED:case wt.INTERNAL:case wt.UNAVAILABLE:case wt.UNAUTHENTICATED:return!1;case wt.INVALID_ARGUMENT:case wt.NOT_FOUND:case wt.ALREADY_EXISTS:case wt.PERMISSION_DENIED:case wt.FAILED_PRECONDITION:case wt.ABORTED:case wt.OUT_OF_RANGE:case wt.UNIMPLEMENTED:case wt.DATA_LOSS:return!0;default:return Zn()}}function qse(n){if(n===void 0)return qf("GRPC error has no .code"),wt.UNKNOWN;switch(n){case go.OK:return wt.OK;case go.CANCELLED:return wt.CANCELLED;case go.UNKNOWN:return wt.UNKNOWN;case go.DEADLINE_EXCEEDED:return wt.DEADLINE_EXCEEDED;case go.RESOURCE_EXHAUSTED:return wt.RESOURCE_EXHAUSTED;case go.INTERNAL:return wt.INTERNAL;case go.UNAVAILABLE:return wt.UNAVAILABLE;case go.UNAUTHENTICATED:return wt.UNAUTHENTICATED;case go.INVALID_ARGUMENT:return wt.INVALID_ARGUMENT;case go.NOT_FOUND:return wt.NOT_FOUND;case go.ALREADY_EXISTS:return wt.ALREADY_EXISTS;case go.PERMISSION_DENIED:return wt.PERMISSION_DENIED;case go.FAILED_PRECONDITION:return wt.FAILED_PRECONDITION;case go.ABORTED:return wt.ABORTED;case go.OUT_OF_RANGE:return wt.OUT_OF_RANGE;case go.UNIMPLEMENTED:return wt.UNIMPLEMENTED;case go.DATA_LOSS:return wt.DATA_LOSS;default:return Zn()}}(Zr=go||(go={}))[Zr.OK=0]="OK",Zr[Zr.CANCELLED=1]="CANCELLED",Zr[Zr.UNKNOWN=2]="UNKNOWN",Zr[Zr.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",Zr[Zr.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",Zr[Zr.NOT_FOUND=5]="NOT_FOUND",Zr[Zr.ALREADY_EXISTS=6]="ALREADY_EXISTS",Zr[Zr.PERMISSION_DENIED=7]="PERMISSION_DENIED",Zr[Zr.UNAUTHENTICATED=16]="UNAUTHENTICATED",Zr[Zr.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",Zr[Zr.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",Zr[Zr.ABORTED=10]="ABORTED",Zr[Zr.OUT_OF_RANGE=11]="OUT_OF_RANGE",Zr[Zr.UNIMPLEMENTED=12]="UNIMPLEMENTED",Zr[Zr.INTERNAL=13]="INTERNAL",Zr[Zr.UNAVAILABLE=14]="UNAVAILABLE",Zr[Zr.DATA_LOSS=15]="DATA_LOSS";/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const n4e=new Ng([4294967295,4294967295],0);function iQ(n){const e=_se().encode(n),i=new use;return i.update(e),new Uint8Array(i.digest())}function sQ(n){const e=new DataView(n.buffer),i=e.getUint32(0,!0),o=e.getUint32(4,!0),l=e.getUint32(8,!0),u=e.getUint32(12,!0);return[new Ng([i,o],0),new Ng([l,u],0)]}class Q5{constructor(e,i,o){if(this.bitmap=e,this.padding=i,this.hashCount=o,i<0||i>=8)throw new EC(`Invalid padding: ${i}`);if(o<0)throw new EC(`Invalid hash count: ${o}`);if(e.length>0&&this.hashCount===0)throw new EC(`Invalid hash count: ${o}`);if(e.length===0&&i!==0)throw new EC(`Invalid padding when bitmap length is 0: ${i}`);this.Ee=8*e.length-i,this.de=Ng.fromNumber(this.Ee)}Ae(e,i,o){let l=e.add(i.multiply(Ng.fromNumber(o)));return l.compare(n4e)===1&&(l=new Ng([l.getBits(0),l.getBits(1)],0)),l.modulo(this.de).toNumber()}Re(e){return!!(this.bitmap[Math.floor(e/8)]&1<<e%8)}mightContain(e){if(this.Ee===0)return!1;const i=iQ(e),[o,l]=sQ(i);for(let u=0;u<this.hashCount;u++){const p=this.Ae(o,l,u);if(!this.Re(p))return!1}return!0}static create(e,i,o){const l=e%8==0?0:8-e%8,u=new Uint8Array(Math.ceil(e/8)),p=new Q5(u,l,i);return o.forEach(y=>p.insert(y)),p}insert(e){if(this.Ee===0)return;const i=iQ(e),[o,l]=sQ(i);for(let u=0;u<this.hashCount;u++){const p=this.Ae(o,l,u);this.Ve(p)}}Ve(e){const i=Math.floor(e/8),o=e%8;this.bitmap[i]|=1<<o}}class EC extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class UN{constructor(e,i,o,l,u){this.snapshotVersion=e,this.targetChanges=i,this.targetMismatches=o,this.documentUpdates=l,this.resolvedLimboDocuments=u}static createSynthesizedRemoteEventForCurrentChange(e,i,o){const l=new Map;return l.set(e,YR.createSynthesizedTargetChangeForCurrentChange(e,i,o)),new UN(ar.min(),l,new As(kr),Yf(),Hr())}}class YR{constructor(e,i,o,l,u){this.resumeToken=e,this.current=i,this.addedDocuments=o,this.modifiedDocuments=l,this.removedDocuments=u}static createSynthesizedTargetChangeForCurrentChange(e,i,o){return new YR(o,i,Hr(),Hr(),Hr())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Hk{constructor(e,i,o,l){this.me=e,this.removedTargetIds=i,this.key=o,this.fe=l}}class Yse{constructor(e,i){this.targetId=e,this.ge=i}}class Xse{constructor(e,i,o=Oa.EMPTY_BYTE_STRING,l=null){this.state=e,this.targetIds=i,this.resumeToken=o,this.cause=l}}class oQ{constructor(){this.pe=0,this.ye=aQ(),this.we=Oa.EMPTY_BYTE_STRING,this.Se=!1,this.be=!0}get current(){return this.Se}get resumeToken(){return this.we}get De(){return this.pe!==0}get ve(){return this.be}Ce(e){e.approximateByteSize()>0&&(this.be=!0,this.we=e)}Fe(){let e=Hr(),i=Hr(),o=Hr();return this.ye.forEach((l,u)=>{switch(u){case 0:e=e.add(l);break;case 2:i=i.add(l);break;case 1:o=o.add(l);break;default:Zn()}}),new YR(this.we,this.Se,e,i,o)}Me(){this.be=!1,this.ye=aQ()}xe(e,i){this.be=!0,this.ye=this.ye.insert(e,i)}Oe(e){this.be=!0,this.ye=this.ye.remove(e)}Ne(){this.pe+=1}Be(){this.pe-=1,wi(this.pe>=0)}Le(){this.be=!0,this.Se=!0}}class r4e{constructor(e){this.ke=e,this.qe=new Map,this.Qe=Yf(),this.$e=ak(),this.Ue=ak(),this.Ke=new As(kr)}We(e){for(const i of e.me)e.fe&&e.fe.isFoundDocument()?this.Ge(i,e.fe):this.ze(i,e.key,e.fe);for(const i of e.removedTargetIds)this.ze(i,e.key,e.fe)}je(e){this.forEachTarget(e,i=>{const o=this.He(i);switch(e.state){case 0:this.Je(i)&&o.Ce(e.resumeToken);break;case 1:o.Be(),o.De||o.Me(),o.Ce(e.resumeToken);break;case 2:o.Be(),o.De||this.removeTarget(i);break;case 3:this.Je(i)&&(o.Le(),o.Ce(e.resumeToken));break;case 4:this.Je(i)&&(this.Ye(i),o.Ce(e.resumeToken));break;default:Zn()}})}forEachTarget(e,i){e.targetIds.length>0?e.targetIds.forEach(i):this.qe.forEach((o,l)=>{this.Je(l)&&i(l)})}Ze(e){const i=e.targetId,o=e.ge.count,l=this.Xe(i);if(l){const u=l.target;if(TF(u))if(o===0){const p=new Pn(u.path);this.ze(i,p,sc.newNoDocument(p,ar.min()))}else wi(o===1);else{const p=this.et(i);if(p!==o){const y=this.tt(e),v=y?this.nt(y,e,p):1;if(v!==0){this.Ye(i);const w=v===2?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch";this.Ke=this.Ke.insert(i,w)}}}}}tt(e){const i=e.ge.unchangedNames;if(!i||!i.bits)return null;const{bits:{bitmap:o="",padding:l=0},hashCount:u=0}=i;let p,y;try{p=Bg(o).toUint8Array()}catch(v){if(v instanceof Sse)return NS("Decoding the base64 bloom filter in existence filter failed ("+v.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw v}try{y=new Q5(p,l,u)}catch(v){return NS(v instanceof EC?"BloomFilter error: ":"Applying bloom filter failed: ",v),null}return y.Ee===0?null:y}nt(e,i,o){return i.ge.count===o-this.st(e,i.targetId)?0:2}st(e,i){const o=this.ke.getRemoteKeysForTarget(i);let l=0;return o.forEach(u=>{const p=this.ke.it(),y=`projects/${p.projectId}/databases/${p.database}/documents/${u.path.canonicalString()}`;e.mightContain(y)||(this.ze(i,u,null),l++)}),l}ot(e){const i=new Map;this.qe.forEach((u,p)=>{const y=this.Xe(p);if(y){if(u.current&&TF(y.target)){const v=new Pn(y.target.path);this._t(v).has(p)||this.ut(p,v)||this.ze(p,v,sc.newNoDocument(v,e))}u.ve&&(i.set(p,u.Fe()),u.Me())}});let o=Hr();this.Ue.forEach((u,p)=>{let y=!0;p.forEachWhile(v=>{const w=this.Xe(v);return!w||w.purpose==="TargetPurposeLimboResolution"||(y=!1,!1)}),y&&(o=o.add(u))}),this.Qe.forEach((u,p)=>p.setReadTime(e));const l=new UN(e,i,this.Ke,this.Qe,o);return this.Qe=Yf(),this.$e=ak(),this.Ue=ak(),this.Ke=new As(kr),l}Ge(e,i){if(!this.Je(e))return;const o=this.ut(e,i.key)?2:0;this.He(e).xe(i.key,o),this.Qe=this.Qe.insert(i.key,i),this.$e=this.$e.insert(i.key,this._t(i.key).add(e)),this.Ue=this.Ue.insert(i.key,this.ct(i.key).add(e))}ze(e,i,o){if(!this.Je(e))return;const l=this.He(e);this.ut(e,i)?l.xe(i,1):l.Oe(i),this.Ue=this.Ue.insert(i,this.ct(i).delete(e)),this.Ue=this.Ue.insert(i,this.ct(i).add(e)),o&&(this.Qe=this.Qe.insert(i,o))}removeTarget(e){this.qe.delete(e)}et(e){const i=this.He(e).Fe();return this.ke.getRemoteKeysForTarget(e).size+i.addedDocuments.size-i.removedDocuments.size}Ne(e){this.He(e).Ne()}He(e){let i=this.qe.get(e);return i||(i=new oQ,this.qe.set(e,i)),i}ct(e){let i=this.Ue.get(e);return i||(i=new jo(kr),this.Ue=this.Ue.insert(e,i)),i}_t(e){let i=this.$e.get(e);return i||(i=new jo(kr),this.$e=this.$e.insert(e,i)),i}Je(e){const i=this.Xe(e)!==null;return i||ln("WatchChangeAggregator","Detected inactive target",e),i}Xe(e){const i=this.qe.get(e);return i&&i.De?null:this.ke.lt(e)}Ye(e){this.qe.set(e,new oQ),this.ke.getRemoteKeysForTarget(e).forEach(i=>{this.ze(e,i,null)})}ut(e,i){return this.ke.getRemoteKeysForTarget(e).has(i)}}function ak(){return new As(Pn.comparator)}function aQ(){return new As(Pn.comparator)}const i4e={asc:"ASCENDING",desc:"DESCENDING"},s4e={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},o4e={and:"AND",or:"OR"};class a4e{constructor(e,i){this.databaseId=e,this.useProto3Json=i}}function RF(n,e){return n.useProto3Json||PN(e)?e:{value:e}}function PO(n,e){return n.useProto3Json?`${new Date(1e3*e.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+e.nanoseconds).slice(-9)}Z`:{seconds:""+e.seconds,nanos:e.nanoseconds}}function Jse(n,e){return n.useProto3Json?e.toBase64():e.toUint8Array()}function c4e(n,e){return PO(n,e.toTimestamp())}function kp(n){return wi(!!n),ar.fromTimestamp(function(i){const o=jg(i);return new Fo(o.seconds,o.nanos)}(n))}function Z5(n,e){return IF(n,e).canonicalString()}function IF(n,e){const i=function(l){return new Ji(["projects",l.projectId,"databases",l.database])}(n).child("documents");return e===void 0?i:i.child(e)}function Qse(n){const e=Ji.fromString(n);return wi(roe(e)),e}function AF(n,e){return Z5(n.databaseId,e.path)}function tV(n,e){const i=Qse(e);if(i.get(1)!==n.databaseId.projectId)throw new Zt(wt.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+i.get(1)+" vs "+n.databaseId.projectId);if(i.get(3)!==n.databaseId.database)throw new Zt(wt.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+i.get(3)+" vs "+n.databaseId.database);return new Pn(eoe(i))}function Zse(n,e){return Z5(n.databaseId,e)}function l4e(n){const e=Qse(n);return e.length===4?Ji.emptyPath():eoe(e)}function PF(n){return new Ji(["projects",n.databaseId.projectId,"databases",n.databaseId.database]).canonicalString()}function eoe(n){return wi(n.length>4&&n.get(4)==="documents"),n.popFirst(5)}function cQ(n,e,i){return{name:AF(n,e),fields:i.value.mapValue.fields}}function u4e(n,e){let i;if("targetChange"in e){e.targetChange;const o=function(w){return w==="NO_CHANGE"?0:w==="ADD"?1:w==="REMOVE"?2:w==="CURRENT"?3:w==="RESET"?4:Zn()}(e.targetChange.targetChangeType||"NO_CHANGE"),l=e.targetChange.targetIds||[],u=function(w,C){return w.useProto3Json?(wi(C===void 0||typeof C=="string"),Oa.fromBase64String(C||"")):(wi(C===void 0||C instanceof Buffer||C instanceof Uint8Array),Oa.fromUint8Array(C||new Uint8Array))}(n,e.targetChange.resumeToken),p=e.targetChange.cause,y=p&&function(w){const C=w.code===void 0?wt.UNKNOWN:qse(w.code);return new Zt(C,w.message||"")}(p);i=new Xse(o,l,u,y||null)}else if("documentChange"in e){e.documentChange;const o=e.documentChange;o.document,o.document.name,o.document.updateTime;const l=tV(n,o.document.name),u=kp(o.document.updateTime),p=o.document.createTime?kp(o.document.createTime):ar.min(),y=new hl({mapValue:{fields:o.document.fields}}),v=sc.newFoundDocument(l,u,p,y),w=o.targetIds||[],C=o.removedTargetIds||[];i=new Hk(w,C,v.key,v)}else if("documentDelete"in e){e.documentDelete;const o=e.documentDelete;o.document;const l=tV(n,o.document),u=o.readTime?kp(o.readTime):ar.min(),p=sc.newNoDocument(l,u),y=o.removedTargetIds||[];i=new Hk([],y,p.key,p)}else if("documentRemove"in e){e.documentRemove;const o=e.documentRemove;o.document;const l=tV(n,o.document),u=o.removedTargetIds||[];i=new Hk([],u,l,null)}else{if(!("filter"in e))return Zn();{e.filter;const o=e.filter;o.targetId;const{count:l=0,unchangedNames:u}=o,p=new e4e(l,u),y=o.targetId;i=new Yse(y,p)}}return i}function d4e(n,e){let i;if(e instanceof qR)i={update:cQ(n,e.key,e.value)};else if(e instanceof X5)i={delete:AF(n,e.key)};else if(e instanceof Qg)i={update:cQ(n,e.key,e.data),updateMask:v4e(e.fieldMask)};else{if(!(e instanceof J3e))return Zn();i={verify:AF(n,e.key)}}return e.fieldTransforms.length>0&&(i.updateTransforms=e.fieldTransforms.map(o=>function(u,p){const y=p.transform;if(y instanceof IO)return{fieldPath:p.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(y instanceof US)return{fieldPath:p.field.canonicalString(),appendMissingElements:{values:y.elements}};if(y instanceof VS)return{fieldPath:p.field.canonicalString(),removeAllFromArray:{values:y.elements}};if(y instanceof AO)return{fieldPath:p.field.canonicalString(),increment:y.Ie};throw Zn()}(0,o))),e.precondition.isNone||(i.currentDocument=function(l,u){return u.updateTime!==void 0?{updateTime:c4e(l,u.updateTime)}:u.exists!==void 0?{exists:u.exists}:Zn()}(n,e.precondition)),i}function h4e(n,e){return n&&n.length>0?(wi(e!==void 0),n.map(i=>function(l,u){let p=l.updateTime?kp(l.updateTime):kp(u);return p.isEqual(ar.min())&&(p=kp(u)),new q3e(p,l.transformResults||[])}(i,e))):[]}function p4e(n,e){return{documents:[Zse(n,e.path)]}}function f4e(n,e){const i={structuredQuery:{}},o=e.path;let l;e.collectionGroup!==null?(l=o,i.structuredQuery.from=[{collectionId:e.collectionGroup,allDescendants:!0}]):(l=o.popLast(),i.structuredQuery.from=[{collectionId:o.lastSegment()}]),i.parent=Zse(n,l);const u=function(w){if(w.length!==0)return noe(hh.create(w,"and"))}(e.filters);u&&(i.structuredQuery.where=u);const p=function(w){if(w.length!==0)return w.map(C=>function(N){return{field:L0(N.field),direction:_4e(N.dir)}}(C))}(e.orderBy);p&&(i.structuredQuery.orderBy=p);const y=RF(n,e.limit);return y!==null&&(i.structuredQuery.limit=y),e.startAt&&(i.structuredQuery.startAt=function(w){return{before:w.inclusive,values:w.position}}(e.startAt)),e.endAt&&(i.structuredQuery.endAt=function(w){return{before:!w.inclusive,values:w.position}}(e.endAt)),{ht:i,parent:l}}function m4e(n){let e=l4e(n.parent);const i=n.structuredQuery,o=i.from?i.from.length:0;let l=null;if(o>0){wi(o===1);const C=i.from[0];C.allDescendants?l=C.collectionId:e=e.child(C.collectionId)}let u=[];i.where&&(u=function(R){const N=toe(R);return N instanceof hh&&Ose(N)?N.getFilters():[N]}(i.where));let p=[];i.orderBy&&(p=function(R){return R.map(N=>function(L){return new ER(M0(L.field),function(z){switch(z){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(L.direction))}(N))}(i.orderBy));let y=null;i.limit&&(y=function(R){let N;return N=typeof R=="object"?R.value:R,PN(N)?null:N}(i.limit));let v=null;i.startAt&&(v=function(R){const N=!!R.before,M=R.values||[];return new MS(M,N)}(i.startAt));let w=null;return i.endAt&&(w=function(R){const N=!R.before,M=R.values||[];return new MS(M,N)}(i.endAt)),L3e(e,l,p,u,y,"F",v,w)}function g4e(n,e){const i=function(l){switch(l){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return Zn()}}(e.purpose);return i==null?null:{"goog-listen-tags":i}}function toe(n){return n.unaryFilter!==void 0?function(i){switch(i.unaryFilter.op){case"IS_NAN":const o=M0(i.unaryFilter.field);return vo.create(o,"==",{doubleValue:NaN});case"IS_NULL":const l=M0(i.unaryFilter.field);return vo.create(l,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":const u=M0(i.unaryFilter.field);return vo.create(u,"!=",{doubleValue:NaN});case"IS_NOT_NULL":const p=M0(i.unaryFilter.field);return vo.create(p,"!=",{nullValue:"NULL_VALUE"});default:return Zn()}}(n):n.fieldFilter!==void 0?function(i){return vo.create(M0(i.fieldFilter.field),function(l){switch(l){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";default:return Zn()}}(i.fieldFilter.op),i.fieldFilter.value)}(n):n.compositeFilter!==void 0?function(i){return hh.create(i.compositeFilter.filters.map(o=>toe(o)),function(l){switch(l){case"AND":return"and";case"OR":return"or";default:return Zn()}}(i.compositeFilter.op))}(n):Zn()}function _4e(n){return i4e[n]}function y4e(n){return s4e[n]}function E4e(n){return o4e[n]}function L0(n){return{fieldPath:n.canonicalString()}}function M0(n){return ka.fromServerFormat(n.fieldPath)}function noe(n){return n instanceof vo?function(i){if(i.op==="=="){if(YJ(i.value))return{unaryFilter:{field:L0(i.field),op:"IS_NAN"}};if(qJ(i.value))return{unaryFilter:{field:L0(i.field),op:"IS_NULL"}}}else if(i.op==="!="){if(YJ(i.value))return{unaryFilter:{field:L0(i.field),op:"IS_NOT_NAN"}};if(qJ(i.value))return{unaryFilter:{field:L0(i.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:L0(i.field),op:y4e(i.op),value:i.value}}}(n):n instanceof hh?function(i){const o=i.getFilters().map(l=>noe(l));return o.length===1?o[0]:{compositeFilter:{op:E4e(i.op),filters:o}}}(n):Zn()}function v4e(n){const e=[];return n.fields.forEach(i=>e.push(i.canonicalString())),{fieldPaths:e}}function roe(n){return n.length>=4&&n.get(0)==="projects"&&n.get(2)==="databases"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Rg{constructor(e,i,o,l,u=ar.min(),p=ar.min(),y=Oa.EMPTY_BYTE_STRING,v=null){this.target=e,this.targetId=i,this.purpose=o,this.sequenceNumber=l,this.snapshotVersion=u,this.lastLimboFreeSnapshotVersion=p,this.resumeToken=y,this.expectedCount=v}withSequenceNumber(e){return new Rg(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(e,i){return new Rg(this.target,this.targetId,this.purpose,this.sequenceNumber,i,this.lastLimboFreeSnapshotVersion,e,null)}withExpectedCount(e){return new Rg(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,e)}withLastLimboFreeSnapshotVersion(e){return new Rg(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken,this.expectedCount)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class S4e{constructor(e){this.Tt=e}}function b4e(n){const e=m4e({parent:n.parent,structuredQuery:n.structuredQuery});return n.limitType==="LAST"?RO(e,e.limit,"L"):e}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class w4e{constructor(){this.Tn=new T4e}addToCollectionParentIndex(e,i){return this.Tn.add(i),kt.resolve()}getCollectionParents(e,i){return kt.resolve(this.Tn.getEntries(i))}addFieldIndex(e,i){return kt.resolve()}deleteFieldIndex(e,i){return kt.resolve()}deleteAllFieldIndexes(e){return kt.resolve()}createTargetIndexes(e,i){return kt.resolve()}getDocumentsMatchingTarget(e,i){return kt.resolve(null)}getIndexType(e,i){return kt.resolve(0)}getFieldIndexes(e,i){return kt.resolve([])}getNextCollectionGroupToUpdate(e){return kt.resolve(null)}getMinOffset(e,i){return kt.resolve(Fg.min())}getMinOffsetFromCollectionGroup(e,i){return kt.resolve(Fg.min())}updateCollectionGroup(e,i,o){return kt.resolve()}updateIndexEntries(e,i){return kt.resolve()}}class T4e{constructor(){this.index={}}add(e){const i=e.lastSegment(),o=e.popLast(),l=this.index[i]||new jo(Ji.comparator),u=!l.has(o);return this.index[i]=l.add(o),u}has(e){const i=e.lastSegment(),o=e.popLast(),l=this.index[i];return l&&l.has(o)}getEntries(e){return(this.index[e]||new jo(Ji.comparator)).toArray()}}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const lQ={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0},ioe=41943040;class ll{static withCacheSize(e){return new ll(e,ll.DEFAULT_COLLECTION_PERCENTILE,ll.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}constructor(e,i,o){this.cacheSizeCollectionThreshold=e,this.percentileToCollect=i,this.maximumSequenceNumbersToCollect=o}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */ll.DEFAULT_COLLECTION_PERCENTILE=10,ll.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,ll.DEFAULT=new ll(ioe,ll.DEFAULT_COLLECTION_PERCENTILE,ll.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),ll.DISABLED=new ll(-1,0,0);/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class FS{constructor(e){this.$n=e}next(){return this.$n+=2,this.$n}static Un(){return new FS(0)}static Kn(){return new FS(-1)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const uQ="LruGarbageCollector",C4e=1048576;function dQ([n,e],[i,o]){const l=kr(n,i);return l===0?kr(e,o):l}class R4e{constructor(e){this.Hn=e,this.buffer=new jo(dQ),this.Jn=0}Yn(){return++this.Jn}Zn(e){const i=[e,this.Yn()];if(this.buffer.size<this.Hn)this.buffer=this.buffer.add(i);else{const o=this.buffer.last();dQ(i,o)<0&&(this.buffer=this.buffer.delete(o).add(i))}}get maxValue(){return this.buffer.last()[0]}}class I4e{constructor(e,i,o){this.garbageCollector=e,this.asyncQueue=i,this.localStore=o,this.Xn=null}start(){this.garbageCollector.params.cacheSizeCollectionThreshold!==-1&&this.er(6e4)}stop(){this.Xn&&(this.Xn.cancel(),this.Xn=null)}get started(){return this.Xn!==null}er(e){ln(uQ,`Garbage collection scheduled in ${e}ms`),this.Xn=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",e,async()=>{this.Xn=null;try{await this.localStore.collectGarbage(this.garbageCollector)}catch(i){tb(i)?ln(uQ,"Ignoring IndexedDB error during garbage collection: ",i):await eb(i)}await this.er(3e5)})}}class A4e{constructor(e,i){this.tr=e,this.params=i}calculateTargetCount(e,i){return this.tr.nr(e).next(o=>Math.floor(i/100*o))}nthSequenceNumber(e,i){if(i===0)return kt.resolve(AN.ae);const o=new R4e(i);return this.tr.forEachTarget(e,l=>o.Zn(l.sequenceNumber)).next(()=>this.tr.rr(e,l=>o.Zn(l))).next(()=>o.maxValue)}removeTargets(e,i,o){return this.tr.removeTargets(e,i,o)}removeOrphanedDocuments(e,i){return this.tr.removeOrphanedDocuments(e,i)}collect(e,i){return this.params.cacheSizeCollectionThreshold===-1?(ln("LruGarbageCollector","Garbage collection skipped; disabled"),kt.resolve(lQ)):this.getCacheSize(e).next(o=>o<this.params.cacheSizeCollectionThreshold?(ln("LruGarbageCollector",`Garbage collection skipped; Cache size ${o} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),lQ):this.ir(e,i))}getCacheSize(e){return this.tr.getCacheSize(e)}ir(e,i){let o,l,u,p,y,v,w;const C=Date.now();return this.calculateTargetCount(e,this.params.percentileToCollect).next(R=>(R>this.params.maximumSequenceNumbersToCollect?(ln("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${R}`),l=this.params.maximumSequenceNumbersToCollect):l=R,p=Date.now(),this.nthSequenceNumber(e,l))).next(R=>(o=R,y=Date.now(),this.removeTargets(e,o,i))).next(R=>(u=R,v=Date.now(),this.removeOrphanedDocuments(e,o))).next(R=>(w=Date.now(),D0()<=Gr.DEBUG&&ln("LruGarbageCollector",`LRU Garbage Collection
	Counted targets in ${p-C}ms
	Determined least recently used ${l} in `+(y-p)+`ms
	Removed ${u} targets in `+(v-y)+`ms
	Removed ${R} documents in `+(w-v)+`ms
Total Duration: ${w-C}ms`),kt.resolve({didRun:!0,sequenceNumbersCollected:l,targetsRemoved:u,documentsRemoved:R})))}}function P4e(n,e){return new A4e(n,e)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class k4e{constructor(){this.changes=new hE(e=>e.toString(),(e,i)=>e.isEqual(i)),this.changesApplied=!1}addEntry(e){this.assertNotApplied(),this.changes.set(e.key,e)}removeEntry(e,i){this.assertNotApplied(),this.changes.set(e,sc.newInvalidDocument(e).setReadTime(i))}getEntry(e,i){this.assertNotApplied();const o=this.changes.get(i);return o!==void 0?kt.resolve(o):this.getFromCache(e,i)}getEntries(e,i){return this.getAllFromCache(e,i)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class O4e{constructor(e,i){this.overlayedDocument=e,this.mutatedFields=i}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class N4e{constructor(e,i,o,l){this.remoteDocumentCache=e,this.mutationQueue=i,this.documentOverlayCache=o,this.indexManager=l}getDocument(e,i){let o=null;return this.documentOverlayCache.getOverlay(e,i).next(l=>(o=l,this.remoteDocumentCache.getEntry(e,i))).next(l=>(o!==null&&BC(o.mutation,l,eu.empty(),Fo.now()),l))}getDocuments(e,i){return this.remoteDocumentCache.getEntries(e,i).next(o=>this.getLocalViewOfDocuments(e,o,Hr()).next(()=>o))}getLocalViewOfDocuments(e,i,o=Hr()){const l=Ly();return this.populateOverlays(e,l,i).next(()=>this.computeViews(e,i,l,o).next(u=>{let p=yC();return u.forEach((y,v)=>{p=p.insert(y,v.overlayedDocument)}),p}))}getOverlayedDocuments(e,i){const o=Ly();return this.populateOverlays(e,o,i).next(()=>this.computeViews(e,i,o,Hr()))}populateOverlays(e,i,o){const l=[];return o.forEach(u=>{i.has(u)||l.push(u)}),this.documentOverlayCache.getOverlays(e,l).next(u=>{u.forEach((p,y)=>{i.set(p,y)})})}computeViews(e,i,o,l){let u=Yf();const p=jC(),y=function(){return jC()}();return i.forEach((v,w)=>{const C=o.get(w.key);l.has(w.key)&&(C===void 0||C.mutation instanceof Qg)?u=u.insert(w.key,w):C!==void 0?(p.set(w.key,C.mutation.getFieldMask()),BC(C.mutation,w,C.mutation.getFieldMask(),Fo.now())):p.set(w.key,eu.empty())}),this.recalculateAndSaveOverlays(e,u).next(v=>(v.forEach((w,C)=>p.set(w,C)),i.forEach((w,C)=>{var R;return y.set(w,new O4e(C,(R=p.get(w))!==null&&R!==void 0?R:null))}),y))}recalculateAndSaveOverlays(e,i){const o=jC();let l=new As((p,y)=>p-y),u=Hr();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(e,i).next(p=>{for(const y of p)y.keys().forEach(v=>{const w=i.get(v);if(w===null)return;let C=o.get(v)||eu.empty();C=y.applyToLocalView(w,C),o.set(v,C);const R=(l.get(y.batchId)||Hr()).add(v);l=l.insert(y.batchId,R)})}).next(()=>{const p=[],y=l.getReverseIterator();for(;y.hasNext();){const v=y.getNext(),w=v.key,C=v.value,R=Fse();C.forEach(N=>{if(!u.has(N)){const M=$se(i.get(N),o.get(N));M!==null&&R.set(N,M),u=u.add(N)}}),p.push(this.documentOverlayCache.saveOverlays(e,w,R))}return kt.waitFor(p)}).next(()=>o)}recalculateAndSaveOverlaysForDocumentKeys(e,i){return this.remoteDocumentCache.getEntries(e,i).next(o=>this.recalculateAndSaveOverlays(e,o))}getDocumentsMatchingQuery(e,i,o,l){return function(p){return Pn.isDocumentKey(p.path)&&p.collectionGroup===null&&p.filters.length===0}(i)?this.getDocumentsMatchingDocumentQuery(e,i.path):q5(i)?this.getDocumentsMatchingCollectionGroupQuery(e,i,o,l):this.getDocumentsMatchingCollectionQuery(e,i,o,l)}getNextDocuments(e,i,o,l){return this.remoteDocumentCache.getAllFromCollectionGroup(e,i,o,l).next(u=>{const p=l-u.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(e,i,o.largestBatchId,l-u.size):kt.resolve(Ly());let y=mR,v=u;return p.next(w=>kt.forEach(w,(C,R)=>(y<R.largestBatchId&&(y=R.largestBatchId),u.get(C)?kt.resolve():this.remoteDocumentCache.getEntry(e,C).next(N=>{v=v.insert(C,N)}))).next(()=>this.populateOverlays(e,w,u)).next(()=>this.computeViews(e,v,w,Hr())).next(C=>({batchId:y,changes:Vse(C)})))})}getDocumentsMatchingDocumentQuery(e,i){return this.getDocument(e,new Pn(i)).next(o=>{let l=yC();return o.isFoundDocument()&&(l=l.insert(o.key,o)),l})}getDocumentsMatchingCollectionGroupQuery(e,i,o,l){const u=i.collectionGroup;let p=yC();return this.indexManager.getCollectionParents(e,u).next(y=>kt.forEach(y,v=>{const w=function(R,N){return new dE(N,null,R.explicitOrderBy.slice(),R.filters.slice(),R.limit,R.limitType,R.startAt,R.endAt)}(i,v.child(u));return this.getDocumentsMatchingCollectionQuery(e,w,o,l).next(C=>{C.forEach((R,N)=>{p=p.insert(R,N)})})}).next(()=>p))}getDocumentsMatchingCollectionQuery(e,i,o,l){let u;return this.documentOverlayCache.getOverlaysForCollection(e,i.path,o.largestBatchId).next(p=>(u=p,this.remoteDocumentCache.getDocumentsMatchingQuery(e,i,o,u,l))).next(p=>{u.forEach((v,w)=>{const C=w.getKey();p.get(C)===null&&(p=p.insert(C,sc.newInvalidDocument(C)))});let y=yC();return p.forEach((v,w)=>{const C=u.get(v);C!==void 0&&BC(C.mutation,w,eu.empty(),Fo.now()),xN(i,w)&&(y=y.insert(v,w))}),y})}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class D4e{constructor(e){this.serializer=e,this.dr=new Map,this.Ar=new Map}getBundleMetadata(e,i){return kt.resolve(this.dr.get(i))}saveBundleMetadata(e,i){return this.dr.set(i.id,function(l){return{id:l.id,version:l.version,createTime:kp(l.createTime)}}(i)),kt.resolve()}getNamedQuery(e,i){return kt.resolve(this.Ar.get(i))}saveNamedQuery(e,i){return this.Ar.set(i.name,function(l){return{name:l.name,query:b4e(l.bundledQuery),readTime:kp(l.readTime)}}(i)),kt.resolve()}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class x4e{constructor(){this.overlays=new As(Pn.comparator),this.Rr=new Map}getOverlay(e,i){return kt.resolve(this.overlays.get(i))}getOverlays(e,i){const o=Ly();return kt.forEach(i,l=>this.getOverlay(e,l).next(u=>{u!==null&&o.set(l,u)})).next(()=>o)}saveOverlays(e,i,o){return o.forEach((l,u)=>{this.Et(e,i,u)}),kt.resolve()}removeOverlaysForBatchId(e,i,o){const l=this.Rr.get(o);return l!==void 0&&(l.forEach(u=>this.overlays=this.overlays.remove(u)),this.Rr.delete(o)),kt.resolve()}getOverlaysForCollection(e,i,o){const l=Ly(),u=i.length+1,p=new Pn(i.child("")),y=this.overlays.getIteratorFrom(p);for(;y.hasNext();){const v=y.getNext().value,w=v.getKey();if(!i.isPrefixOf(w.path))break;w.path.length===u&&v.largestBatchId>o&&l.set(v.getKey(),v)}return kt.resolve(l)}getOverlaysForCollectionGroup(e,i,o,l){let u=new As((w,C)=>w-C);const p=this.overlays.getIterator();for(;p.hasNext();){const w=p.getNext().value;if(w.getKey().getCollectionGroup()===i&&w.largestBatchId>o){let C=u.get(w.largestBatchId);C===null&&(C=Ly(),u=u.insert(w.largestBatchId,C)),C.set(w.getKey(),w)}}const y=Ly(),v=u.getIterator();for(;v.hasNext()&&(v.getNext().value.forEach((w,C)=>y.set(w,C)),!(y.size()>=l)););return kt.resolve(y)}Et(e,i,o){const l=this.overlays.get(o.key);if(l!==null){const p=this.Rr.get(l.largestBatchId).delete(o.key);this.Rr.set(l.largestBatchId,p)}this.overlays=this.overlays.insert(o.key,new Z3e(i,o));let u=this.Rr.get(i);u===void 0&&(u=Hr(),this.Rr.set(i,u)),this.Rr.set(i,u.add(o.key))}}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class L4e{constructor(){this.sessionToken=Oa.EMPTY_BYTE_STRING}getSessionToken(e){return kt.resolve(this.sessionToken)}setSessionToken(e,i){return this.sessionToken=i,kt.resolve()}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class e3{constructor(){this.Vr=new jo(sa.mr),this.gr=new jo(sa.pr)}isEmpty(){return this.Vr.isEmpty()}addReference(e,i){const o=new sa(e,i);this.Vr=this.Vr.add(o),this.gr=this.gr.add(o)}yr(e,i){e.forEach(o=>this.addReference(o,i))}removeReference(e,i){this.wr(new sa(e,i))}Sr(e,i){e.forEach(o=>this.removeReference(o,i))}br(e){const i=new Pn(new Ji([])),o=new sa(i,e),l=new sa(i,e+1),u=[];return this.gr.forEachInRange([o,l],p=>{this.wr(p),u.push(p.key)}),u}Dr(){this.Vr.forEach(e=>this.wr(e))}wr(e){this.Vr=this.Vr.delete(e),this.gr=this.gr.delete(e)}vr(e){const i=new Pn(new Ji([])),o=new sa(i,e),l=new sa(i,e+1);let u=Hr();return this.gr.forEachInRange([o,l],p=>{u=u.add(p.key)}),u}containsKey(e){const i=new sa(e,0),o=this.Vr.firstAfterOrEqual(i);return o!==null&&e.isEqual(o.key)}}class sa{constructor(e,i){this.key=e,this.Cr=i}static mr(e,i){return Pn.comparator(e.key,i.key)||kr(e.Cr,i.Cr)}static pr(e,i){return kr(e.Cr,i.Cr)||Pn.comparator(e.key,i.key)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class M4e{constructor(e,i){this.indexManager=e,this.referenceDelegate=i,this.mutationQueue=[],this.Fr=1,this.Mr=new jo(sa.mr)}checkEmpty(e){return kt.resolve(this.mutationQueue.length===0)}addMutationBatch(e,i,o,l){const u=this.Fr;this.Fr++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];const p=new Q3e(u,i,o,l);this.mutationQueue.push(p);for(const y of l)this.Mr=this.Mr.add(new sa(y.key,u)),this.indexManager.addToCollectionParentIndex(e,y.key.path.popLast());return kt.resolve(p)}lookupMutationBatch(e,i){return kt.resolve(this.Or(i))}getNextMutationBatchAfterBatchId(e,i){const o=i+1,l=this.Nr(o),u=l<0?0:l;return kt.resolve(this.mutationQueue.length>u?this.mutationQueue[u]:null)}getHighestUnacknowledgedBatchId(){return kt.resolve(this.mutationQueue.length===0?G5:this.Fr-1)}getAllMutationBatches(e){return kt.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(e,i){const o=new sa(i,0),l=new sa(i,Number.POSITIVE_INFINITY),u=[];return this.Mr.forEachInRange([o,l],p=>{const y=this.Or(p.Cr);u.push(y)}),kt.resolve(u)}getAllMutationBatchesAffectingDocumentKeys(e,i){let o=new jo(kr);return i.forEach(l=>{const u=new sa(l,0),p=new sa(l,Number.POSITIVE_INFINITY);this.Mr.forEachInRange([u,p],y=>{o=o.add(y.Cr)})}),kt.resolve(this.Br(o))}getAllMutationBatchesAffectingQuery(e,i){const o=i.path,l=o.length+1;let u=o;Pn.isDocumentKey(u)||(u=u.child(""));const p=new sa(new Pn(u),0);let y=new jo(kr);return this.Mr.forEachWhile(v=>{const w=v.key.path;return!!o.isPrefixOf(w)&&(w.length===l&&(y=y.add(v.Cr)),!0)},p),kt.resolve(this.Br(y))}Br(e){const i=[];return e.forEach(o=>{const l=this.Or(o);l!==null&&i.push(l)}),i}removeMutationBatch(e,i){wi(this.Lr(i.batchId,"removed")===0),this.mutationQueue.shift();let o=this.Mr;return kt.forEach(i.mutations,l=>{const u=new sa(l.key,i.batchId);return o=o.delete(u),this.referenceDelegate.markPotentiallyOrphaned(e,l.key)}).next(()=>{this.Mr=o})}qn(e){}containsKey(e,i){const o=new sa(i,0),l=this.Mr.firstAfterOrEqual(o);return kt.resolve(i.isEqual(l&&l.key))}performConsistencyCheck(e){return this.mutationQueue.length,kt.resolve()}Lr(e,i){return this.Nr(e)}Nr(e){return this.mutationQueue.length===0?0:e-this.mutationQueue[0].batchId}Or(e){const i=this.Nr(e);return i<0||i>=this.mutationQueue.length?null:this.mutationQueue[i]}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class U4e{constructor(e){this.kr=e,this.docs=function(){return new As(Pn.comparator)}(),this.size=0}setIndexManager(e){this.indexManager=e}addEntry(e,i){const o=i.key,l=this.docs.get(o),u=l?l.size:0,p=this.kr(i);return this.docs=this.docs.insert(o,{document:i.mutableCopy(),size:p}),this.size+=p-u,this.indexManager.addToCollectionParentIndex(e,o.path.popLast())}removeEntry(e){const i=this.docs.get(e);i&&(this.docs=this.docs.remove(e),this.size-=i.size)}getEntry(e,i){const o=this.docs.get(i);return kt.resolve(o?o.document.mutableCopy():sc.newInvalidDocument(i))}getEntries(e,i){let o=Yf();return i.forEach(l=>{const u=this.docs.get(l);o=o.insert(l,u?u.document.mutableCopy():sc.newInvalidDocument(l))}),kt.resolve(o)}getDocumentsMatchingQuery(e,i,o,l){let u=Yf();const p=i.path,y=new Pn(p.child("__id-9223372036854775808__")),v=this.docs.getIteratorFrom(y);for(;v.hasNext();){const{key:w,value:{document:C}}=v.getNext();if(!p.isPrefixOf(w.path))break;w.path.length>p.length+1||p3e(h3e(C),o)<=0||(l.has(C.key)||xN(i,C))&&(u=u.insert(C.key,C.mutableCopy()))}return kt.resolve(u)}getAllFromCollectionGroup(e,i,o,l){Zn()}qr(e,i){return kt.forEach(this.docs,o=>i(o))}newChangeBuffer(e){return new V4e(this)}getSize(e){return kt.resolve(this.size)}}class V4e extends k4e{constructor(e){super(),this.Ir=e}applyChanges(e){const i=[];return this.changes.forEach((o,l)=>{l.isValidDocument()?i.push(this.Ir.addEntry(e,l)):this.Ir.removeEntry(o)}),kt.waitFor(i)}getFromCache(e,i){return this.Ir.getEntry(e,i)}getAllFromCache(e,i){return this.Ir.getEntries(e,i)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class F4e{constructor(e){this.persistence=e,this.Qr=new hE(i=>$5(i),K5),this.lastRemoteSnapshotVersion=ar.min(),this.highestTargetId=0,this.$r=0,this.Ur=new e3,this.targetCount=0,this.Kr=FS.Un()}forEachTarget(e,i){return this.Qr.forEach((o,l)=>i(l)),kt.resolve()}getLastRemoteSnapshotVersion(e){return kt.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return kt.resolve(this.$r)}allocateTargetId(e){return this.highestTargetId=this.Kr.next(),kt.resolve(this.highestTargetId)}setTargetsMetadata(e,i,o){return o&&(this.lastRemoteSnapshotVersion=o),i>this.$r&&(this.$r=i),kt.resolve()}zn(e){this.Qr.set(e.target,e);const i=e.targetId;i>this.highestTargetId&&(this.Kr=new FS(i),this.highestTargetId=i),e.sequenceNumber>this.$r&&(this.$r=e.sequenceNumber)}addTargetData(e,i){return this.zn(i),this.targetCount+=1,kt.resolve()}updateTargetData(e,i){return this.zn(i),kt.resolve()}removeTargetData(e,i){return this.Qr.delete(i.target),this.Ur.br(i.targetId),this.targetCount-=1,kt.resolve()}removeTargets(e,i,o){let l=0;const u=[];return this.Qr.forEach((p,y)=>{y.sequenceNumber<=i&&o.get(y.targetId)===null&&(this.Qr.delete(p),u.push(this.removeMatchingKeysForTargetId(e,y.targetId)),l++)}),kt.waitFor(u).next(()=>l)}getTargetCount(e){return kt.resolve(this.targetCount)}getTargetData(e,i){const o=this.Qr.get(i)||null;return kt.resolve(o)}addMatchingKeys(e,i,o){return this.Ur.yr(i,o),kt.resolve()}removeMatchingKeys(e,i,o){this.Ur.Sr(i,o);const l=this.persistence.referenceDelegate,u=[];return l&&i.forEach(p=>{u.push(l.markPotentiallyOrphaned(e,p))}),kt.waitFor(u)}removeMatchingKeysForTargetId(e,i){return this.Ur.br(i),kt.resolve()}getMatchingKeysForTargetId(e,i){const o=this.Ur.vr(i);return kt.resolve(o)}containsKey(e,i){return kt.resolve(this.Ur.containsKey(i))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class soe{constructor(e,i){this.Wr={},this.overlays={},this.Gr=new AN(0),this.zr=!1,this.zr=!0,this.jr=new L4e,this.referenceDelegate=e(this),this.Hr=new F4e(this),this.indexManager=new w4e,this.remoteDocumentCache=function(l){return new U4e(l)}(o=>this.referenceDelegate.Jr(o)),this.serializer=new S4e(i),this.Yr=new D4e(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.zr=!1,Promise.resolve()}get started(){return this.zr}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(e){return this.indexManager}getDocumentOverlayCache(e){let i=this.overlays[e.toKey()];return i||(i=new x4e,this.overlays[e.toKey()]=i),i}getMutationQueue(e,i){let o=this.Wr[e.toKey()];return o||(o=new M4e(i,this.referenceDelegate),this.Wr[e.toKey()]=o),o}getGlobalsCache(){return this.jr}getTargetCache(){return this.Hr}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.Yr}runTransaction(e,i,o){ln("MemoryPersistence","Starting transaction:",e);const l=new j4e(this.Gr.next());return this.referenceDelegate.Zr(),o(l).next(u=>this.referenceDelegate.Xr(l).next(()=>u)).toPromise().then(u=>(l.raiseOnCommittedEvent(),u))}ei(e,i){return kt.or(Object.values(this.Wr).map(o=>()=>o.containsKey(e,i)))}}class j4e extends m3e{constructor(e){super(),this.currentSequenceNumber=e}}class t3{constructor(e){this.persistence=e,this.ti=new e3,this.ni=null}static ri(e){return new t3(e)}get ii(){if(this.ni)return this.ni;throw Zn()}addReference(e,i,o){return this.ti.addReference(o,i),this.ii.delete(o.toString()),kt.resolve()}removeReference(e,i,o){return this.ti.removeReference(o,i),this.ii.add(o.toString()),kt.resolve()}markPotentiallyOrphaned(e,i){return this.ii.add(i.toString()),kt.resolve()}removeTarget(e,i){this.ti.br(i.targetId).forEach(l=>this.ii.add(l.toString()));const o=this.persistence.getTargetCache();return o.getMatchingKeysForTargetId(e,i.targetId).next(l=>{l.forEach(u=>this.ii.add(u.toString()))}).next(()=>o.removeTargetData(e,i))}Zr(){this.ni=new Set}Xr(e){const i=this.persistence.getRemoteDocumentCache().newChangeBuffer();return kt.forEach(this.ii,o=>{const l=Pn.fromPath(o);return this.si(e,l).next(u=>{u||i.removeEntry(l,ar.min())})}).next(()=>(this.ni=null,i.apply(e)))}updateLimboDocument(e,i){return this.si(e,i).next(o=>{o?this.ii.delete(i.toString()):this.ii.add(i.toString())})}Jr(e){return 0}si(e,i){return kt.or([()=>kt.resolve(this.ti.containsKey(i)),()=>this.persistence.getTargetCache().containsKey(e,i),()=>this.persistence.ei(e,i)])}}class kO{constructor(e,i){this.persistence=e,this.oi=new hE(o=>y3e(o.path),(o,l)=>o.isEqual(l)),this.garbageCollector=P4e(this,i)}static ri(e,i){return new kO(e,i)}Zr(){}Xr(e){return kt.resolve()}forEachTarget(e,i){return this.persistence.getTargetCache().forEachTarget(e,i)}nr(e){const i=this.sr(e);return this.persistence.getTargetCache().getTargetCount(e).next(o=>i.next(l=>o+l))}sr(e){let i=0;return this.rr(e,o=>{i++}).next(()=>i)}rr(e,i){return kt.forEach(this.oi,(o,l)=>this.ar(e,o,l).next(u=>u?kt.resolve():i(l)))}removeTargets(e,i,o){return this.persistence.getTargetCache().removeTargets(e,i,o)}removeOrphanedDocuments(e,i){let o=0;const l=this.persistence.getRemoteDocumentCache(),u=l.newChangeBuffer();return l.qr(e,p=>this.ar(e,p,i).next(y=>{y||(o++,u.removeEntry(p,ar.min()))})).next(()=>u.apply(e)).next(()=>o)}markPotentiallyOrphaned(e,i){return this.oi.set(i,e.currentSequenceNumber),kt.resolve()}removeTarget(e,i){const o=i.withSequenceNumber(e.currentSequenceNumber);return this.persistence.getTargetCache().updateTargetData(e,o)}addReference(e,i,o){return this.oi.set(o,e.currentSequenceNumber),kt.resolve()}removeReference(e,i,o){return this.oi.set(o,e.currentSequenceNumber),kt.resolve()}updateLimboDocument(e,i){return this.oi.set(i,e.currentSequenceNumber),kt.resolve()}Jr(e){let i=e.key.toString().length;return e.isFoundDocument()&&(i+=zk(e.data.value)),i}ar(e,i,o){return kt.or([()=>this.persistence.ei(e,i),()=>this.persistence.getTargetCache().containsKey(e,i),()=>{const l=this.oi.get(i);return kt.resolve(l!==void 0&&l>o)}])}getCacheSize(e){return this.persistence.getRemoteDocumentCache().getSize(e)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class n3{constructor(e,i,o,l){this.targetId=e,this.fromCache=i,this.Hi=o,this.Ji=l}static Yi(e,i){let o=Hr(),l=Hr();for(const u of i.docChanges)switch(u.type){case 0:o=o.add(u.doc.key);break;case 1:l=l.add(u.doc.key)}return new n3(e,i.fromCache,o,l)}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class B4e{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(e){this._documentReadCount+=e}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class z4e{constructor(){this.Zi=!1,this.Xi=!1,this.es=100,this.ts=function(){return bVe()?8:g3e(cc())>0?6:4}()}initialize(e,i){this.ns=e,this.indexManager=i,this.Zi=!0}getDocumentsMatchingQuery(e,i,o,l){const u={result:null};return this.rs(e,i).next(p=>{u.result=p}).next(()=>{if(!u.result)return this.ss(e,i,l,o).next(p=>{u.result=p})}).next(()=>{if(u.result)return;const p=new B4e;return this._s(e,i,p).next(y=>{if(u.result=y,this.Xi)return this.us(e,i,p,y.size)})}).next(()=>u.result)}us(e,i,o,l){return o.documentReadCount<this.es?(D0()<=Gr.DEBUG&&ln("QueryEngine","SDK will not create cache indexes for query:",x0(i),"since it only creates cache indexes for collection contains","more than or equal to",this.es,"documents"),kt.resolve()):(D0()<=Gr.DEBUG&&ln("QueryEngine","Query:",x0(i),"scans",o.documentReadCount,"local documents and returns",l,"documents as results."),o.documentReadCount>this.ts*l?(D0()<=Gr.DEBUG&&ln("QueryEngine","The SDK decides to create cache indexes for query:",x0(i),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(e,Pp(i))):kt.resolve())}rs(e,i){if(ZJ(i))return kt.resolve(null);let o=Pp(i);return this.indexManager.getIndexType(e,o).next(l=>l===0?null:(i.limit!==null&&l===1&&(i=RO(i,null,"F"),o=Pp(i)),this.indexManager.getDocumentsMatchingTarget(e,o).next(u=>{const p=Hr(...u);return this.ns.getDocuments(e,p).next(y=>this.indexManager.getMinOffset(e,o).next(v=>{const w=this.cs(i,y);return this.ls(i,w,p,v.readTime)?this.rs(e,RO(i,null,"F")):this.hs(e,w,i,v)}))})))}ss(e,i,o,l){return ZJ(i)||l.isEqual(ar.min())?kt.resolve(null):this.ns.getDocuments(e,o).next(u=>{const p=this.cs(i,u);return this.ls(i,p,o,l)?kt.resolve(null):(D0()<=Gr.DEBUG&&ln("QueryEngine","Re-using previous result from %s to execute query: %s",l.toString(),x0(i)),this.hs(e,p,i,d3e(l,mR)).next(y=>y))})}cs(e,i){let o=new jo(Mse(e));return i.forEach((l,u)=>{xN(e,u)&&(o=o.add(u))}),o}ls(e,i,o,l){if(e.limit===null)return!1;if(o.size!==i.size)return!0;const u=e.limitType==="F"?i.last():i.first();return!!u&&(u.hasPendingWrites||u.version.compareTo(l)>0)}_s(e,i,o){return D0()<=Gr.DEBUG&&ln("QueryEngine","Using full collection scan to execute query:",x0(i)),this.ns.getDocumentsMatchingQuery(e,i,Fg.min(),o)}hs(e,i,o,l){return this.ns.getDocumentsMatchingQuery(e,o,l).next(u=>(i.forEach(p=>{u=u.insert(p.key,p)}),u))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const r3="LocalStore",W4e=3e8;class G4e{constructor(e,i,o,l){this.persistence=e,this.Ps=i,this.serializer=l,this.Ts=new As(kr),this.Is=new hE(u=>$5(u),K5),this.Es=new Map,this.ds=e.getRemoteDocumentCache(),this.Hr=e.getTargetCache(),this.Yr=e.getBundleCache(),this.As(o)}As(e){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(e),this.indexManager=this.persistence.getIndexManager(e),this.mutationQueue=this.persistence.getMutationQueue(e,this.indexManager),this.localDocuments=new N4e(this.ds,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.ds.setIndexManager(this.indexManager),this.Ps.initialize(this.localDocuments,this.indexManager)}collectGarbage(e){return this.persistence.runTransaction("Collect garbage","readwrite-primary",i=>e.collect(i,this.Ts))}}function H4e(n,e,i,o){return new G4e(n,e,i,o)}async function ooe(n,e){const i=dr(n);return await i.persistence.runTransaction("Handle user change","readonly",o=>{let l;return i.mutationQueue.getAllMutationBatches(o).next(u=>(l=u,i.As(e),i.mutationQueue.getAllMutationBatches(o))).next(u=>{const p=[],y=[];let v=Hr();for(const w of l){p.push(w.batchId);for(const C of w.mutations)v=v.add(C.key)}for(const w of u){y.push(w.batchId);for(const C of w.mutations)v=v.add(C.key)}return i.localDocuments.getDocuments(o,v).next(w=>({Rs:w,removedBatchIds:p,addedBatchIds:y}))})})}function $4e(n,e){const i=dr(n);return i.persistence.runTransaction("Acknowledge batch","readwrite-primary",o=>{const l=e.batch.keys(),u=i.ds.newChangeBuffer({trackRemovals:!0});return function(y,v,w,C){const R=w.batch,N=R.keys();let M=kt.resolve();return N.forEach(L=>{M=M.next(()=>C.getEntry(v,L)).next(U=>{const z=w.docVersions.get(L);wi(z!==null),U.version.compareTo(z)<0&&(R.applyToRemoteDocument(U,w),U.isValidDocument()&&(U.setReadTime(w.commitVersion),C.addEntry(U)))})}),M.next(()=>y.mutationQueue.removeMutationBatch(v,R))}(i,o,e,u).next(()=>u.apply(o)).next(()=>i.mutationQueue.performConsistencyCheck(o)).next(()=>i.documentOverlayCache.removeOverlaysForBatchId(o,l,e.batch.batchId)).next(()=>i.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(o,function(y){let v=Hr();for(let w=0;w<y.mutationResults.length;++w)y.mutationResults[w].transformResults.length>0&&(v=v.add(y.batch.mutations[w].key));return v}(e))).next(()=>i.localDocuments.getDocuments(o,l))})}function aoe(n){const e=dr(n);return e.persistence.runTransaction("Get last remote snapshot version","readonly",i=>e.Hr.getLastRemoteSnapshotVersion(i))}function K4e(n,e){const i=dr(n),o=e.snapshotVersion;let l=i.Ts;return i.persistence.runTransaction("Apply remote event","readwrite-primary",u=>{const p=i.ds.newChangeBuffer({trackRemovals:!0});l=i.Ts;const y=[];e.targetChanges.forEach((C,R)=>{const N=l.get(R);if(!N)return;y.push(i.Hr.removeMatchingKeys(u,C.removedDocuments,R).next(()=>i.Hr.addMatchingKeys(u,C.addedDocuments,R)));let M=N.withSequenceNumber(u.currentSequenceNumber);e.targetMismatches.get(R)!==null?M=M.withResumeToken(Oa.EMPTY_BYTE_STRING,ar.min()).withLastLimboFreeSnapshotVersion(ar.min()):C.resumeToken.approximateByteSize()>0&&(M=M.withResumeToken(C.resumeToken,o)),l=l.insert(R,M),function(U,z,J){return U.resumeToken.approximateByteSize()===0||z.snapshotVersion.toMicroseconds()-U.snapshotVersion.toMicroseconds()>=W4e?!0:J.addedDocuments.size+J.modifiedDocuments.size+J.removedDocuments.size>0}(N,M,C)&&y.push(i.Hr.updateTargetData(u,M))});let v=Yf(),w=Hr();if(e.documentUpdates.forEach(C=>{e.resolvedLimboDocuments.has(C)&&y.push(i.persistence.referenceDelegate.updateLimboDocument(u,C))}),y.push(q4e(u,p,e.documentUpdates).next(C=>{v=C.Vs,w=C.fs})),!o.isEqual(ar.min())){const C=i.Hr.getLastRemoteSnapshotVersion(u).next(R=>i.Hr.setTargetsMetadata(u,u.currentSequenceNumber,o));y.push(C)}return kt.waitFor(y).next(()=>p.apply(u)).next(()=>i.localDocuments.getLocalViewOfDocuments(u,v,w)).next(()=>v)}).then(u=>(i.Ts=l,u))}function q4e(n,e,i){let o=Hr(),l=Hr();return i.forEach(u=>o=o.add(u)),e.getEntries(n,o).next(u=>{let p=Yf();return i.forEach((y,v)=>{const w=u.get(y);v.isFoundDocument()!==w.isFoundDocument()&&(l=l.add(y)),v.isNoDocument()&&v.version.isEqual(ar.min())?(e.removeEntry(y,v.readTime),p=p.insert(y,v)):!w.isValidDocument()||v.version.compareTo(w.version)>0||v.version.compareTo(w.version)===0&&w.hasPendingWrites?(e.addEntry(v),p=p.insert(y,v)):ln(r3,"Ignoring outdated watch update for ",y,". Current version:",w.version," Watch version:",v.version)}),{Vs:p,fs:l}})}function Y4e(n,e){const i=dr(n);return i.persistence.runTransaction("Get next mutation batch","readonly",o=>(e===void 0&&(e=G5),i.mutationQueue.getNextMutationBatchAfterBatchId(o,e)))}function X4e(n,e){const i=dr(n);return i.persistence.runTransaction("Allocate target","readwrite",o=>{let l;return i.Hr.getTargetData(o,e).next(u=>u?(l=u,kt.resolve(l)):i.Hr.allocateTargetId(o).next(p=>(l=new Rg(e,p,"TargetPurposeListen",o.currentSequenceNumber),i.Hr.addTargetData(o,l).next(()=>l))))}).then(o=>{const l=i.Ts.get(o.targetId);return(l===null||o.snapshotVersion.compareTo(l.snapshotVersion)>0)&&(i.Ts=i.Ts.insert(o.targetId,o),i.Is.set(e,o.targetId)),o})}async function kF(n,e,i){const o=dr(n),l=o.Ts.get(e),u=i?"readwrite":"readwrite-primary";try{i||await o.persistence.runTransaction("Release target",u,p=>o.persistence.referenceDelegate.removeTarget(p,l))}catch(p){if(!tb(p))throw p;ln(r3,`Failed to update sequence numbers for target ${e}: ${p}`)}o.Ts=o.Ts.remove(e),o.Is.delete(l.target)}function hQ(n,e,i){const o=dr(n);let l=ar.min(),u=Hr();return o.persistence.runTransaction("Execute query","readwrite",p=>function(v,w,C){const R=dr(v),N=R.Is.get(C);return N!==void 0?kt.resolve(R.Ts.get(N)):R.Hr.getTargetData(w,C)}(o,p,Pp(e)).next(y=>{if(y)return l=y.lastLimboFreeSnapshotVersion,o.Hr.getMatchingKeysForTargetId(p,y.targetId).next(v=>{u=v})}).next(()=>o.Ps.getDocumentsMatchingQuery(p,e,i?l:ar.min(),i?u:Hr())).next(y=>(J4e(o,U3e(e),y),{documents:y,gs:u})))}function J4e(n,e,i){let o=n.Es.get(e)||ar.min();i.forEach((l,u)=>{u.readTime.compareTo(o)>0&&(o=u.readTime)}),n.Es.set(e,o)}class pQ{constructor(){this.activeTargetIds=W3e()}Ds(e){this.activeTargetIds=this.activeTargetIds.add(e)}vs(e){this.activeTargetIds=this.activeTargetIds.delete(e)}bs(){const e={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(e)}}class Q4e{constructor(){this.ho=new pQ,this.Po={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,i,o){}addLocalQueryTarget(e,i=!0){return i&&this.ho.Ds(e),this.Po[e]||"not-current"}updateQueryState(e,i,o){this.Po[e]=i}removeLocalQueryTarget(e){this.ho.vs(e)}isLocalQueryTarget(e){return this.ho.activeTargetIds.has(e)}clearQueryState(e){delete this.Po[e]}getAllActiveQueryTargets(){return this.ho.activeTargetIds}isActiveQueryTarget(e){return this.ho.activeTargetIds.has(e)}start(){return this.ho=new pQ,Promise.resolve()}handleUserChange(e,i,o){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(e){}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Z4e{To(e){}shutdown(){}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const fQ="ConnectivityMonitor";class mQ{constructor(){this.Io=()=>this.Eo(),this.Ao=()=>this.Ro(),this.Vo=[],this.mo()}To(e){this.Vo.push(e)}shutdown(){window.removeEventListener("online",this.Io),window.removeEventListener("offline",this.Ao)}mo(){window.addEventListener("online",this.Io),window.addEventListener("offline",this.Ao)}Eo(){ln(fQ,"Network connectivity changed: AVAILABLE");for(const e of this.Vo)e(0)}Ro(){ln(fQ,"Network connectivity changed: UNAVAILABLE");for(const e of this.Vo)e(1)}static D(){return typeof window<"u"&&window.addEventListener!==void 0&&window.removeEventListener!==void 0}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let ck=null;function OF(){return ck===null?ck=function(){return 268435456+Math.round(2147483648*Math.random())}():ck++,"0x"+ck.toString(16)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const nV="RestConnection",eBe={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"};class tBe{get fo(){return!1}constructor(e){this.databaseInfo=e,this.databaseId=e.databaseId;const i=e.ssl?"https":"http",o=encodeURIComponent(this.databaseId.projectId),l=encodeURIComponent(this.databaseId.database);this.po=i+"://"+e.host,this.yo=`projects/${o}/databases/${l}`,this.wo=this.databaseId.database===wO?`project_id=${o}`:`project_id=${o}&database_id=${l}`}So(e,i,o,l,u){const p=OF(),y=this.bo(e,i.toUriEncodedString());ln(nV,`Sending RPC '${e}' ${p}:`,y,o);const v={"google-cloud-resource-prefix":this.yo,"x-goog-request-params":this.wo};return this.Do(v,l,u),this.vo(e,y,v,o).then(w=>(ln(nV,`Received RPC '${e}' ${p}: `,w),w),w=>{throw NS(nV,`RPC '${e}' ${p} failed with error: `,w,"url: ",y,"request:",o),w})}Co(e,i,o,l,u,p){return this.So(e,i,o,l,u)}Do(e,i,o){e["X-Goog-Api-Client"]=function(){return"gl-js/ fire/"+ZS}(),e["Content-Type"]="text/plain",this.databaseInfo.appId&&(e["X-Firebase-GMPID"]=this.databaseInfo.appId),i&&i.headers.forEach((l,u)=>e[u]=l),o&&o.headers.forEach((l,u)=>e[u]=l)}bo(e,i){const o=eBe[e];return`${this.po}/v1/${i}:${o}`}terminate(){}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class nBe{constructor(e){this.Fo=e.Fo,this.Mo=e.Mo}xo(e){this.Oo=e}No(e){this.Bo=e}Lo(e){this.ko=e}onMessage(e){this.qo=e}close(){this.Mo()}send(e){this.Fo(e)}Qo(){this.Oo()}$o(){this.Bo()}Uo(e){this.ko(e)}Ko(e){this.qo(e)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const tc="WebChannelConnection";class rBe extends tBe{constructor(e){super(e),this.forceLongPolling=e.forceLongPolling,this.autoDetectLongPolling=e.autoDetectLongPolling,this.useFetchStreams=e.useFetchStreams,this.longPollingOptions=e.longPollingOptions}vo(e,i,o,l){const u=OF();return new Promise((p,y)=>{const v=new dse;v.setWithCredentials(!0),v.listenOnce(hse.COMPLETE,()=>{try{switch(v.getLastErrorCode()){case Bk.NO_ERROR:const C=v.getResponseJson();ln(tc,`XHR for RPC '${e}' ${u} received:`,JSON.stringify(C)),p(C);break;case Bk.TIMEOUT:ln(tc,`RPC '${e}' ${u} timed out`),y(new Zt(wt.DEADLINE_EXCEEDED,"Request time out"));break;case Bk.HTTP_ERROR:const R=v.getStatus();if(ln(tc,`RPC '${e}' ${u} failed with status:`,R,"response text:",v.getResponseText()),R>0){let N=v.getResponseJson();Array.isArray(N)&&(N=N[0]);const M=N==null?void 0:N.error;if(M&&M.status&&M.message){const L=function(z){const J=z.toLowerCase().replace(/_/g,"-");return Object.values(wt).indexOf(J)>=0?J:wt.UNKNOWN}(M.status);y(new Zt(L,M.message))}else y(new Zt(wt.UNKNOWN,"Server responded with status "+v.getStatus()))}else y(new Zt(wt.UNAVAILABLE,"Connection failed."));break;default:Zn()}}finally{ln(tc,`RPC '${e}' ${u} completed.`)}});const w=JSON.stringify(l);ln(tc,`RPC '${e}' ${u} sending request:`,l),v.send(i,"POST",w,o,15)})}Wo(e,i,o){const l=OF(),u=[this.po,"/","google.firestore.v1.Firestore","/",e,"/channel"],p=mse(),y=fse(),v={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},w=this.longPollingOptions.timeoutSeconds;w!==void 0&&(v.longPollingTimeout=Math.round(1e3*w)),this.useFetchStreams&&(v.useFetchStreams=!0),this.Do(v.initMessageHeaders,i,o),v.encodeInitMessageHeaders=!0;const C=u.join("");ln(tc,`Creating RPC '${e}' stream ${l}: ${C}`,v);const R=p.createWebChannel(C,v);let N=!1,M=!1;const L=new nBe({Fo:z=>{M?ln(tc,`Not sending because RPC '${e}' stream ${l} is closed:`,z):(N||(ln(tc,`Opening RPC '${e}' stream ${l} transport.`),R.open(),N=!0),ln(tc,`RPC '${e}' stream ${l} sending:`,z),R.send(z))},Mo:()=>R.close()}),U=(z,J,q)=>{z.listen(J,re=>{try{q(re)}catch(ce){setTimeout(()=>{throw ce},0)}})};return U(R,_C.EventType.OPEN,()=>{M||(ln(tc,`RPC '${e}' stream ${l} transport opened.`),L.Qo())}),U(R,_C.EventType.CLOSE,()=>{M||(M=!0,ln(tc,`RPC '${e}' stream ${l} transport closed`),L.Uo())}),U(R,_C.EventType.ERROR,z=>{M||(M=!0,NS(tc,`RPC '${e}' stream ${l} transport errored:`,z),L.Uo(new Zt(wt.UNAVAILABLE,"The operation could not be completed")))}),U(R,_C.EventType.MESSAGE,z=>{var J;if(!M){const q=z.data[0];wi(!!q);const re=q,ce=(re==null?void 0:re.error)||((J=re[0])===null||J===void 0?void 0:J.error);if(ce){ln(tc,`RPC '${e}' stream ${l} received error:`,ce);const ae=ce.status;let pe=function(Q){const ne=go[Q];if(ne!==void 0)return qse(ne)}(ae),H=ce.message;pe===void 0&&(pe=wt.INTERNAL,H="Unknown error status: "+ae+" with message "+ce.message),M=!0,L.Uo(new Zt(pe,H)),R.close()}else ln(tc,`RPC '${e}' stream ${l} received:`,q),L.Ko(q)}}),U(y,pse.STAT_EVENT,z=>{z.stat===EF.PROXY?ln(tc,`RPC '${e}' stream ${l} detected buffering proxy`):z.stat===EF.NOPROXY&&ln(tc,`RPC '${e}' stream ${l} detected no buffering proxy`)}),setTimeout(()=>{L.$o()},0),L}}function rV(){return typeof document<"u"?document:null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function VN(n){return new a4e(n,!0)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class coe{constructor(e,i,o=1e3,l=1.5,u=6e4){this.Ti=e,this.timerId=i,this.Go=o,this.zo=l,this.jo=u,this.Ho=0,this.Jo=null,this.Yo=Date.now(),this.reset()}reset(){this.Ho=0}Zo(){this.Ho=this.jo}Xo(e){this.cancel();const i=Math.floor(this.Ho+this.e_()),o=Math.max(0,Date.now()-this.Yo),l=Math.max(0,i-o);l>0&&ln("ExponentialBackoff",`Backing off for ${l} ms (base delay: ${this.Ho} ms, delay with jitter: ${i} ms, last attempt: ${o} ms ago)`),this.Jo=this.Ti.enqueueAfterDelay(this.timerId,l,()=>(this.Yo=Date.now(),e())),this.Ho*=this.zo,this.Ho<this.Go&&(this.Ho=this.Go),this.Ho>this.jo&&(this.Ho=this.jo)}t_(){this.Jo!==null&&(this.Jo.skipDelay(),this.Jo=null)}cancel(){this.Jo!==null&&(this.Jo.cancel(),this.Jo=null)}e_(){return(Math.random()-.5)*this.Ho}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const gQ="PersistentStream";class loe{constructor(e,i,o,l,u,p,y,v){this.Ti=e,this.n_=o,this.r_=l,this.connection=u,this.authCredentialsProvider=p,this.appCheckCredentialsProvider=y,this.listener=v,this.state=0,this.i_=0,this.s_=null,this.o_=null,this.stream=null,this.__=0,this.a_=new coe(e,i)}u_(){return this.state===1||this.state===5||this.c_()}c_(){return this.state===2||this.state===3}start(){this.__=0,this.state!==4?this.auth():this.l_()}async stop(){this.u_()&&await this.close(0)}h_(){this.state=0,this.a_.reset()}P_(){this.c_()&&this.s_===null&&(this.s_=this.Ti.enqueueAfterDelay(this.n_,6e4,()=>this.T_()))}I_(e){this.E_(),this.stream.send(e)}async T_(){if(this.c_())return this.close(0)}E_(){this.s_&&(this.s_.cancel(),this.s_=null)}d_(){this.o_&&(this.o_.cancel(),this.o_=null)}async close(e,i){this.E_(),this.d_(),this.a_.cancel(),this.i_++,e!==4?this.a_.reset():i&&i.code===wt.RESOURCE_EXHAUSTED?(qf(i.toString()),qf("Using maximum backoff delay to prevent overloading the backend."),this.a_.Zo()):i&&i.code===wt.UNAUTHENTICATED&&this.state!==3&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),this.stream!==null&&(this.A_(),this.stream.close(),this.stream=null),this.state=e,await this.listener.Lo(i)}A_(){}auth(){this.state=1;const e=this.R_(this.i_),i=this.i_;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then(([o,l])=>{this.i_===i&&this.V_(o,l)},o=>{e(()=>{const l=new Zt(wt.UNKNOWN,"Fetching auth token failed: "+o.message);return this.m_(l)})})}V_(e,i){const o=this.R_(this.i_);this.stream=this.f_(e,i),this.stream.xo(()=>{o(()=>this.listener.xo())}),this.stream.No(()=>{o(()=>(this.state=2,this.o_=this.Ti.enqueueAfterDelay(this.r_,1e4,()=>(this.c_()&&(this.state=3),Promise.resolve())),this.listener.No()))}),this.stream.Lo(l=>{o(()=>this.m_(l))}),this.stream.onMessage(l=>{o(()=>++this.__==1?this.g_(l):this.onNext(l))})}l_(){this.state=5,this.a_.Xo(async()=>{this.state=0,this.start()})}m_(e){return ln(gQ,`close with error: ${e}`),this.stream=null,this.close(4,e)}R_(e){return i=>{this.Ti.enqueueAndForget(()=>this.i_===e?i():(ln(gQ,"stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve()))}}}class iBe extends loe{constructor(e,i,o,l,u,p){super(e,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",i,o,l,p),this.serializer=u}f_(e,i){return this.connection.Wo("Listen",e,i)}g_(e){return this.onNext(e)}onNext(e){this.a_.reset();const i=u4e(this.serializer,e),o=function(u){if(!("targetChange"in u))return ar.min();const p=u.targetChange;return p.targetIds&&p.targetIds.length?ar.min():p.readTime?kp(p.readTime):ar.min()}(e);return this.listener.p_(i,o)}y_(e){const i={};i.database=PF(this.serializer),i.addTarget=function(u,p){let y;const v=p.target;if(y=TF(v)?{documents:p4e(u,v)}:{query:f4e(u,v).ht},y.targetId=p.targetId,p.resumeToken.approximateByteSize()>0){y.resumeToken=Jse(u,p.resumeToken);const w=RF(u,p.expectedCount);w!==null&&(y.expectedCount=w)}else if(p.snapshotVersion.compareTo(ar.min())>0){y.readTime=PO(u,p.snapshotVersion.toTimestamp());const w=RF(u,p.expectedCount);w!==null&&(y.expectedCount=w)}return y}(this.serializer,e);const o=g4e(this.serializer,e);o&&(i.labels=o),this.I_(i)}w_(e){const i={};i.database=PF(this.serializer),i.removeTarget=e,this.I_(i)}}class sBe extends loe{constructor(e,i,o,l,u,p){super(e,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",i,o,l,p),this.serializer=u}get S_(){return this.__>0}start(){this.lastStreamToken=void 0,super.start()}A_(){this.S_&&this.b_([])}f_(e,i){return this.connection.Wo("Write",e,i)}g_(e){return wi(!!e.streamToken),this.lastStreamToken=e.streamToken,wi(!e.writeResults||e.writeResults.length===0),this.listener.D_()}onNext(e){wi(!!e.streamToken),this.lastStreamToken=e.streamToken,this.a_.reset();const i=h4e(e.writeResults,e.commitTime),o=kp(e.commitTime);return this.listener.v_(o,i)}C_(){const e={};e.database=PF(this.serializer),this.I_(e)}b_(e){const i={streamToken:this.lastStreamToken,writes:e.map(o=>d4e(this.serializer,o))};this.I_(i)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class oBe{}class aBe extends oBe{constructor(e,i,o,l){super(),this.authCredentials=e,this.appCheckCredentials=i,this.connection=o,this.serializer=l,this.F_=!1}M_(){if(this.F_)throw new Zt(wt.FAILED_PRECONDITION,"The client has already been terminated.")}So(e,i,o,l){return this.M_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([u,p])=>this.connection.So(e,IF(i,o),l,u,p)).catch(u=>{throw u.name==="FirebaseError"?(u.code===wt.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),u):new Zt(wt.UNKNOWN,u.toString())})}Co(e,i,o,l,u){return this.M_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([p,y])=>this.connection.Co(e,IF(i,o),l,p,y,u)).catch(p=>{throw p.name==="FirebaseError"?(p.code===wt.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),p):new Zt(wt.UNKNOWN,p.toString())})}terminate(){this.F_=!0,this.connection.terminate()}}class cBe{constructor(e,i){this.asyncQueue=e,this.onlineStateHandler=i,this.state="Unknown",this.x_=0,this.O_=null,this.N_=!0}B_(){this.x_===0&&(this.L_("Unknown"),this.O_=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,()=>(this.O_=null,this.k_("Backend didn't respond within 10 seconds."),this.L_("Offline"),Promise.resolve())))}q_(e){this.state==="Online"?this.L_("Unknown"):(this.x_++,this.x_>=1&&(this.Q_(),this.k_(`Connection failed 1 times. Most recent error: ${e.toString()}`),this.L_("Offline")))}set(e){this.Q_(),this.x_=0,e==="Online"&&(this.N_=!1),this.L_(e)}L_(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}k_(e){const i=`Could not reach Cloud Firestore backend. ${e}
This typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.N_?(qf(i),this.N_=!1):ln("OnlineStateTracker",i)}Q_(){this.O_!==null&&(this.O_.cancel(),this.O_=null)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const sE="RemoteStore";class lBe{constructor(e,i,o,l,u){this.localStore=e,this.datastore=i,this.asyncQueue=o,this.remoteSyncer={},this.U_=[],this.K_=new Map,this.W_=new Set,this.G_=[],this.z_=u,this.z_.To(p=>{o.enqueueAndForget(async()=>{pE(this)&&(ln(sE,"Restarting streams for network reachability change."),await async function(v){const w=dr(v);w.W_.add(4),await XR(w),w.j_.set("Unknown"),w.W_.delete(4),await FN(w)}(this))})}),this.j_=new cBe(o,l)}}async function FN(n){if(pE(n))for(const e of n.G_)await e(!0)}async function XR(n){for(const e of n.G_)await e(!1)}function uoe(n,e){const i=dr(n);i.K_.has(e.targetId)||(i.K_.set(e.targetId,e),a3(i)?o3(i):nb(i).c_()&&s3(i,e))}function i3(n,e){const i=dr(n),o=nb(i);i.K_.delete(e),o.c_()&&doe(i,e),i.K_.size===0&&(o.c_()?o.P_():pE(i)&&i.j_.set("Unknown"))}function s3(n,e){if(n.H_.Ne(e.targetId),e.resumeToken.approximateByteSize()>0||e.snapshotVersion.compareTo(ar.min())>0){const i=n.remoteSyncer.getRemoteKeysForTarget(e.targetId).size;e=e.withExpectedCount(i)}nb(n).y_(e)}function doe(n,e){n.H_.Ne(e),nb(n).w_(e)}function o3(n){n.H_=new r4e({getRemoteKeysForTarget:e=>n.remoteSyncer.getRemoteKeysForTarget(e),lt:e=>n.K_.get(e)||null,it:()=>n.datastore.serializer.databaseId}),nb(n).start(),n.j_.B_()}function a3(n){return pE(n)&&!nb(n).u_()&&n.K_.size>0}function pE(n){return dr(n).W_.size===0}function hoe(n){n.H_=void 0}async function uBe(n){n.j_.set("Online")}async function dBe(n){n.K_.forEach((e,i)=>{s3(n,e)})}async function hBe(n,e){hoe(n),a3(n)?(n.j_.q_(e),o3(n)):n.j_.set("Unknown")}async function pBe(n,e,i){if(n.j_.set("Online"),e instanceof Xse&&e.state===2&&e.cause)try{await async function(l,u){const p=u.cause;for(const y of u.targetIds)l.K_.has(y)&&(await l.remoteSyncer.rejectListen(y,p),l.K_.delete(y),l.H_.removeTarget(y))}(n,e)}catch(o){ln(sE,"Failed to remove targets %s: %s ",e.targetIds.join(","),o),await OO(n,o)}else if(e instanceof Hk?n.H_.We(e):e instanceof Yse?n.H_.Ze(e):n.H_.je(e),!i.isEqual(ar.min()))try{const o=await aoe(n.localStore);i.compareTo(o)>=0&&await function(u,p){const y=u.H_.ot(p);return y.targetChanges.forEach((v,w)=>{if(v.resumeToken.approximateByteSize()>0){const C=u.K_.get(w);C&&u.K_.set(w,C.withResumeToken(v.resumeToken,p))}}),y.targetMismatches.forEach((v,w)=>{const C=u.K_.get(v);if(!C)return;u.K_.set(v,C.withResumeToken(Oa.EMPTY_BYTE_STRING,C.snapshotVersion)),doe(u,v);const R=new Rg(C.target,v,w,C.sequenceNumber);s3(u,R)}),u.remoteSyncer.applyRemoteEvent(y)}(n,i)}catch(o){ln(sE,"Failed to raise snapshot:",o),await OO(n,o)}}async function OO(n,e,i){if(!tb(e))throw e;n.W_.add(1),await XR(n),n.j_.set("Offline"),i||(i=()=>aoe(n.localStore)),n.asyncQueue.enqueueRetryable(async()=>{ln(sE,"Retrying IndexedDB access"),await i(),n.W_.delete(1),await FN(n)})}function poe(n,e){return e().catch(i=>OO(n,i,e))}async function jN(n){const e=dr(n),i=Wg(e);let o=e.U_.length>0?e.U_[e.U_.length-1].batchId:G5;for(;fBe(e);)try{const l=await Y4e(e.localStore,o);if(l===null){e.U_.length===0&&i.P_();break}o=l.batchId,mBe(e,l)}catch(l){await OO(e,l)}foe(e)&&moe(e)}function fBe(n){return pE(n)&&n.U_.length<10}function mBe(n,e){n.U_.push(e);const i=Wg(n);i.c_()&&i.S_&&i.b_(e.mutations)}function foe(n){return pE(n)&&!Wg(n).u_()&&n.U_.length>0}function moe(n){Wg(n).start()}async function gBe(n){Wg(n).C_()}async function _Be(n){const e=Wg(n);for(const i of n.U_)e.b_(i.mutations)}async function yBe(n,e,i){const o=n.U_.shift(),l=J5.from(o,e,i);await poe(n,()=>n.remoteSyncer.applySuccessfulWrite(l)),await jN(n)}async function EBe(n,e){e&&Wg(n).S_&&await async function(o,l){if(function(p){return t4e(p)&&p!==wt.ABORTED}(l.code)){const u=o.U_.shift();Wg(o).h_(),await poe(o,()=>o.remoteSyncer.rejectFailedWrite(u.batchId,l)),await jN(o)}}(n,e),foe(n)&&moe(n)}async function _Q(n,e){const i=dr(n);i.asyncQueue.verifyOperationInProgress(),ln(sE,"RemoteStore received new credentials");const o=pE(i);i.W_.add(3),await XR(i),o&&i.j_.set("Unknown"),await i.remoteSyncer.handleCredentialChange(e),i.W_.delete(3),await FN(i)}async function vBe(n,e){const i=dr(n);e?(i.W_.delete(2),await FN(i)):e||(i.W_.add(2),await XR(i),i.j_.set("Unknown"))}function nb(n){return n.J_||(n.J_=function(i,o,l){const u=dr(i);return u.M_(),new iBe(o,u.connection,u.authCredentials,u.appCheckCredentials,u.serializer,l)}(n.datastore,n.asyncQueue,{xo:uBe.bind(null,n),No:dBe.bind(null,n),Lo:hBe.bind(null,n),p_:pBe.bind(null,n)}),n.G_.push(async e=>{e?(n.J_.h_(),a3(n)?o3(n):n.j_.set("Unknown")):(await n.J_.stop(),hoe(n))})),n.J_}function Wg(n){return n.Y_||(n.Y_=function(i,o,l){const u=dr(i);return u.M_(),new sBe(o,u.connection,u.authCredentials,u.appCheckCredentials,u.serializer,l)}(n.datastore,n.asyncQueue,{xo:()=>Promise.resolve(),No:gBe.bind(null,n),Lo:EBe.bind(null,n),D_:_Be.bind(null,n),v_:yBe.bind(null,n)}),n.G_.push(async e=>{e?(n.Y_.h_(),await jN(n)):(await n.Y_.stop(),n.U_.length>0&&(ln(sE,`Stopping write stream with ${n.U_.length} pending writes`),n.U_=[]))})),n.Y_}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class c3{constructor(e,i,o,l,u){this.asyncQueue=e,this.timerId=i,this.targetTimeMs=o,this.op=l,this.removalCallback=u,this.deferred=new Ff,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(p=>{})}get promise(){return this.deferred.promise}static createAndSchedule(e,i,o,l,u){const p=Date.now()+o,y=new c3(e,i,p,l,u);return y.start(o),y}start(e){this.timerHandle=setTimeout(()=>this.handleDelayElapsed(),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){this.timerHandle!==null&&(this.clearTimeout(),this.deferred.reject(new Zt(wt.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget(()=>this.timerHandle!==null?(this.clearTimeout(),this.op().then(e=>this.deferred.resolve(e))):Promise.resolve())}clearTimeout(){this.timerHandle!==null&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function l3(n,e){if(qf("AsyncQueue",`${e}: ${n}`),tb(n))return new Zt(wt.UNAVAILABLE,`${e}: ${n}`);throw n}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class gS{static emptySet(e){return new gS(e.comparator)}constructor(e){this.comparator=e?(i,o)=>e(i,o)||Pn.comparator(i.key,o.key):(i,o)=>Pn.comparator(i.key,o.key),this.keyedMap=yC(),this.sortedSet=new As(this.comparator)}has(e){return this.keyedMap.get(e)!=null}get(e){return this.keyedMap.get(e)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(e){const i=this.keyedMap.get(e);return i?this.sortedSet.indexOf(i):-1}get size(){return this.sortedSet.size}forEach(e){this.sortedSet.inorderTraversal((i,o)=>(e(i),!1))}add(e){const i=this.delete(e.key);return i.copy(i.keyedMap.insert(e.key,e),i.sortedSet.insert(e,null))}delete(e){const i=this.get(e);return i?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(i)):this}isEqual(e){if(!(e instanceof gS)||this.size!==e.size)return!1;const i=this.sortedSet.getIterator(),o=e.sortedSet.getIterator();for(;i.hasNext();){const l=i.getNext().key,u=o.getNext().key;if(!l.isEqual(u))return!1}return!0}toString(){const e=[];return this.forEach(i=>{e.push(i.toString())}),e.length===0?"DocumentSet ()":`DocumentSet (
  `+e.join(`  
`)+`
)`}copy(e,i){const o=new gS;return o.comparator=this.comparator,o.keyedMap=e,o.sortedSet=i,o}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class yQ{constructor(){this.Z_=new As(Pn.comparator)}track(e){const i=e.doc.key,o=this.Z_.get(i);o?e.type!==0&&o.type===3?this.Z_=this.Z_.insert(i,e):e.type===3&&o.type!==1?this.Z_=this.Z_.insert(i,{type:o.type,doc:e.doc}):e.type===2&&o.type===2?this.Z_=this.Z_.insert(i,{type:2,doc:e.doc}):e.type===2&&o.type===0?this.Z_=this.Z_.insert(i,{type:0,doc:e.doc}):e.type===1&&o.type===0?this.Z_=this.Z_.remove(i):e.type===1&&o.type===2?this.Z_=this.Z_.insert(i,{type:1,doc:o.doc}):e.type===0&&o.type===1?this.Z_=this.Z_.insert(i,{type:2,doc:e.doc}):Zn():this.Z_=this.Z_.insert(i,e)}X_(){const e=[];return this.Z_.inorderTraversal((i,o)=>{e.push(o)}),e}}class jS{constructor(e,i,o,l,u,p,y,v,w){this.query=e,this.docs=i,this.oldDocs=o,this.docChanges=l,this.mutatedKeys=u,this.fromCache=p,this.syncStateChanged=y,this.excludesMetadataChanges=v,this.hasCachedResults=w}static fromInitialDocuments(e,i,o,l,u){const p=[];return i.forEach(y=>{p.push({type:0,doc:y})}),new jS(e,i,gS.emptySet(i),p,o,l,!0,!1,u)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(e){if(!(this.fromCache===e.fromCache&&this.hasCachedResults===e.hasCachedResults&&this.syncStateChanged===e.syncStateChanged&&this.mutatedKeys.isEqual(e.mutatedKeys)&&DN(this.query,e.query)&&this.docs.isEqual(e.docs)&&this.oldDocs.isEqual(e.oldDocs)))return!1;const i=this.docChanges,o=e.docChanges;if(i.length!==o.length)return!1;for(let l=0;l<i.length;l++)if(i[l].type!==o[l].type||!i[l].doc.isEqual(o[l].doc))return!1;return!0}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class SBe{constructor(){this.ea=void 0,this.ta=[]}na(){return this.ta.some(e=>e.ra())}}class bBe{constructor(){this.queries=EQ(),this.onlineState="Unknown",this.ia=new Set}terminate(){(function(i,o){const l=dr(i),u=l.queries;l.queries=EQ(),u.forEach((p,y)=>{for(const v of y.ta)v.onError(o)})})(this,new Zt(wt.ABORTED,"Firestore shutting down"))}}function EQ(){return new hE(n=>Lse(n),DN)}async function u3(n,e){const i=dr(n);let o=3;const l=e.query;let u=i.queries.get(l);u?!u.na()&&e.ra()&&(o=2):(u=new SBe,o=e.ra()?0:1);try{switch(o){case 0:u.ea=await i.onListen(l,!0);break;case 1:u.ea=await i.onListen(l,!1);break;case 2:await i.onFirstRemoteStoreListen(l)}}catch(p){const y=l3(p,`Initialization of query '${x0(e.query)}' failed`);return void e.onError(y)}i.queries.set(l,u),u.ta.push(e),e.sa(i.onlineState),u.ea&&e.oa(u.ea)&&h3(i)}async function d3(n,e){const i=dr(n),o=e.query;let l=3;const u=i.queries.get(o);if(u){const p=u.ta.indexOf(e);p>=0&&(u.ta.splice(p,1),u.ta.length===0?l=e.ra()?0:1:!u.na()&&e.ra()&&(l=2))}switch(l){case 0:return i.queries.delete(o),i.onUnlisten(o,!0);case 1:return i.queries.delete(o),i.onUnlisten(o,!1);case 2:return i.onLastRemoteStoreUnlisten(o);default:return}}function wBe(n,e){const i=dr(n);let o=!1;for(const l of e){const u=l.query,p=i.queries.get(u);if(p){for(const y of p.ta)y.oa(l)&&(o=!0);p.ea=l}}o&&h3(i)}function TBe(n,e,i){const o=dr(n),l=o.queries.get(e);if(l)for(const u of l.ta)u.onError(i);o.queries.delete(e)}function h3(n){n.ia.forEach(e=>{e.next()})}var NF,vQ;(vQ=NF||(NF={}))._a="default",vQ.Cache="cache";class p3{constructor(e,i,o){this.query=e,this.aa=i,this.ua=!1,this.ca=null,this.onlineState="Unknown",this.options=o||{}}oa(e){if(!this.options.includeMetadataChanges){const o=[];for(const l of e.docChanges)l.type!==3&&o.push(l);e=new jS(e.query,e.docs,e.oldDocs,o,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0,e.hasCachedResults)}let i=!1;return this.ua?this.la(e)&&(this.aa.next(e),i=!0):this.ha(e,this.onlineState)&&(this.Pa(e),i=!0),this.ca=e,i}onError(e){this.aa.error(e)}sa(e){this.onlineState=e;let i=!1;return this.ca&&!this.ua&&this.ha(this.ca,e)&&(this.Pa(this.ca),i=!0),i}ha(e,i){if(!e.fromCache||!this.ra())return!0;const o=i!=="Offline";return(!this.options.Ta||!o)&&(!e.docs.isEmpty()||e.hasCachedResults||i==="Offline")}la(e){if(e.docChanges.length>0)return!0;const i=this.ca&&this.ca.hasPendingWrites!==e.hasPendingWrites;return!(!e.syncStateChanged&&!i)&&this.options.includeMetadataChanges===!0}Pa(e){e=jS.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache,e.hasCachedResults),this.ua=!0,this.aa.next(e)}ra(){return this.options.source!==NF.Cache}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class goe{constructor(e){this.key=e}}class _oe{constructor(e){this.key=e}}class CBe{constructor(e,i){this.query=e,this.fa=i,this.ga=null,this.hasCachedResults=!1,this.current=!1,this.pa=Hr(),this.mutatedKeys=Hr(),this.ya=Mse(e),this.wa=new gS(this.ya)}get Sa(){return this.fa}ba(e,i){const o=i?i.Da:new yQ,l=i?i.wa:this.wa;let u=i?i.mutatedKeys:this.mutatedKeys,p=l,y=!1;const v=this.query.limitType==="F"&&l.size===this.query.limit?l.last():null,w=this.query.limitType==="L"&&l.size===this.query.limit?l.first():null;if(e.inorderTraversal((C,R)=>{const N=l.get(C),M=xN(this.query,R)?R:null,L=!!N&&this.mutatedKeys.has(N.key),U=!!M&&(M.hasLocalMutations||this.mutatedKeys.has(M.key)&&M.hasCommittedMutations);let z=!1;N&&M?N.data.isEqual(M.data)?L!==U&&(o.track({type:3,doc:M}),z=!0):this.va(N,M)||(o.track({type:2,doc:M}),z=!0,(v&&this.ya(M,v)>0||w&&this.ya(M,w)<0)&&(y=!0)):!N&&M?(o.track({type:0,doc:M}),z=!0):N&&!M&&(o.track({type:1,doc:N}),z=!0,(v||w)&&(y=!0)),z&&(M?(p=p.add(M),u=U?u.add(C):u.delete(C)):(p=p.delete(C),u=u.delete(C)))}),this.query.limit!==null)for(;p.size>this.query.limit;){const C=this.query.limitType==="F"?p.last():p.first();p=p.delete(C.key),u=u.delete(C.key),o.track({type:1,doc:C})}return{wa:p,Da:o,ls:y,mutatedKeys:u}}va(e,i){return e.hasLocalMutations&&i.hasCommittedMutations&&!i.hasLocalMutations}applyChanges(e,i,o,l){const u=this.wa;this.wa=e.wa,this.mutatedKeys=e.mutatedKeys;const p=e.Da.X_();p.sort((C,R)=>function(M,L){const U=z=>{switch(z){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return Zn()}};return U(M)-U(L)}(C.type,R.type)||this.ya(C.doc,R.doc)),this.Ca(o),l=l!=null&&l;const y=i&&!l?this.Fa():[],v=this.pa.size===0&&this.current&&!l?1:0,w=v!==this.ga;return this.ga=v,p.length!==0||w?{snapshot:new jS(this.query,e.wa,u,p,e.mutatedKeys,v===0,w,!1,!!o&&o.resumeToken.approximateByteSize()>0),Ma:y}:{Ma:y}}sa(e){return this.current&&e==="Offline"?(this.current=!1,this.applyChanges({wa:this.wa,Da:new yQ,mutatedKeys:this.mutatedKeys,ls:!1},!1)):{Ma:[]}}xa(e){return!this.fa.has(e)&&!!this.wa.has(e)&&!this.wa.get(e).hasLocalMutations}Ca(e){e&&(e.addedDocuments.forEach(i=>this.fa=this.fa.add(i)),e.modifiedDocuments.forEach(i=>{}),e.removedDocuments.forEach(i=>this.fa=this.fa.delete(i)),this.current=e.current)}Fa(){if(!this.current)return[];const e=this.pa;this.pa=Hr(),this.wa.forEach(o=>{this.xa(o.key)&&(this.pa=this.pa.add(o.key))});const i=[];return e.forEach(o=>{this.pa.has(o)||i.push(new _oe(o))}),this.pa.forEach(o=>{e.has(o)||i.push(new goe(o))}),i}Oa(e){this.fa=e.gs,this.pa=Hr();const i=this.ba(e.documents);return this.applyChanges(i,!0)}Na(){return jS.fromInitialDocuments(this.query,this.wa,this.mutatedKeys,this.ga===0,this.hasCachedResults)}}const f3="SyncEngine";class RBe{constructor(e,i,o){this.query=e,this.targetId=i,this.view=o}}class IBe{constructor(e){this.key=e,this.Ba=!1}}class ABe{constructor(e,i,o,l,u,p){this.localStore=e,this.remoteStore=i,this.eventManager=o,this.sharedClientState=l,this.currentUser=u,this.maxConcurrentLimboResolutions=p,this.La={},this.ka=new hE(y=>Lse(y),DN),this.qa=new Map,this.Qa=new Set,this.$a=new As(Pn.comparator),this.Ua=new Map,this.Ka=new e3,this.Wa={},this.Ga=new Map,this.za=FS.Kn(),this.onlineState="Unknown",this.ja=void 0}get isPrimaryClient(){return this.ja===!0}}async function PBe(n,e,i=!0){const o=woe(n);let l;const u=o.ka.get(e);return u?(o.sharedClientState.addLocalQueryTarget(u.targetId),l=u.view.Na()):l=await yoe(o,e,i,!0),l}async function kBe(n,e){const i=woe(n);await yoe(i,e,!0,!1)}async function yoe(n,e,i,o){const l=await X4e(n.localStore,Pp(e)),u=l.targetId,p=n.sharedClientState.addLocalQueryTarget(u,i);let y;return o&&(y=await OBe(n,e,u,p==="current",l.resumeToken)),n.isPrimaryClient&&i&&uoe(n.remoteStore,l),y}async function OBe(n,e,i,o,l){n.Ha=(R,N,M)=>async function(U,z,J,q){let re=z.view.ba(J);re.ls&&(re=await hQ(U.localStore,z.query,!1).then(({documents:H})=>z.view.ba(H,re)));const ce=q&&q.targetChanges.get(z.targetId),ae=q&&q.targetMismatches.get(z.targetId)!=null,pe=z.view.applyChanges(re,U.isPrimaryClient,ce,ae);return bQ(U,z.targetId,pe.Ma),pe.snapshot}(n,R,N,M);const u=await hQ(n.localStore,e,!0),p=new CBe(e,u.gs),y=p.ba(u.documents),v=YR.createSynthesizedTargetChangeForCurrentChange(i,o&&n.onlineState!=="Offline",l),w=p.applyChanges(y,n.isPrimaryClient,v);bQ(n,i,w.Ma);const C=new RBe(e,i,p);return n.ka.set(e,C),n.qa.has(i)?n.qa.get(i).push(e):n.qa.set(i,[e]),w.snapshot}async function NBe(n,e,i){const o=dr(n),l=o.ka.get(e),u=o.qa.get(l.targetId);if(u.length>1)return o.qa.set(l.targetId,u.filter(p=>!DN(p,e))),void o.ka.delete(e);o.isPrimaryClient?(o.sharedClientState.removeLocalQueryTarget(l.targetId),o.sharedClientState.isActiveQueryTarget(l.targetId)||await kF(o.localStore,l.targetId,!1).then(()=>{o.sharedClientState.clearQueryState(l.targetId),i&&i3(o.remoteStore,l.targetId),DF(o,l.targetId)}).catch(eb)):(DF(o,l.targetId),await kF(o.localStore,l.targetId,!0))}async function DBe(n,e){const i=dr(n),o=i.ka.get(e),l=i.qa.get(o.targetId);i.isPrimaryClient&&l.length===1&&(i.sharedClientState.removeLocalQueryTarget(o.targetId),i3(i.remoteStore,o.targetId))}async function xBe(n,e,i){const o=BBe(n);try{const l=await function(p,y){const v=dr(p),w=Fo.now(),C=y.reduce((M,L)=>M.add(L.key),Hr());let R,N;return v.persistence.runTransaction("Locally write mutations","readwrite",M=>{let L=Yf(),U=Hr();return v.ds.getEntries(M,C).next(z=>{L=z,L.forEach((J,q)=>{q.isValidDocument()||(U=U.add(J))})}).next(()=>v.localDocuments.getOverlayedDocuments(M,L)).next(z=>{R=z;const J=[];for(const q of y){const re=X3e(q,R.get(q.key).overlayedDocument);re!=null&&J.push(new Qg(q.key,re,Ase(re.value.mapValue),rd.exists(!0)))}return v.mutationQueue.addMutationBatch(M,w,J,y)}).next(z=>{N=z;const J=z.applyToLocalDocumentSet(R,U);return v.documentOverlayCache.saveOverlays(M,z.batchId,J)})}).then(()=>({batchId:N.batchId,changes:Vse(R)}))}(o.localStore,e);o.sharedClientState.addPendingMutation(l.batchId),function(p,y,v){let w=p.Wa[p.currentUser.toKey()];w||(w=new As(kr)),w=w.insert(y,v),p.Wa[p.currentUser.toKey()]=w}(o,l.batchId,i),await JR(o,l.changes),await jN(o.remoteStore)}catch(l){const u=l3(l,"Failed to persist write");i.reject(u)}}async function Eoe(n,e){const i=dr(n);try{const o=await K4e(i.localStore,e);e.targetChanges.forEach((l,u)=>{const p=i.Ua.get(u);p&&(wi(l.addedDocuments.size+l.modifiedDocuments.size+l.removedDocuments.size<=1),l.addedDocuments.size>0?p.Ba=!0:l.modifiedDocuments.size>0?wi(p.Ba):l.removedDocuments.size>0&&(wi(p.Ba),p.Ba=!1))}),await JR(i,o,e)}catch(o){await eb(o)}}function SQ(n,e,i){const o=dr(n);if(o.isPrimaryClient&&i===0||!o.isPrimaryClient&&i===1){const l=[];o.ka.forEach((u,p)=>{const y=p.view.sa(e);y.snapshot&&l.push(y.snapshot)}),function(p,y){const v=dr(p);v.onlineState=y;let w=!1;v.queries.forEach((C,R)=>{for(const N of R.ta)N.sa(y)&&(w=!0)}),w&&h3(v)}(o.eventManager,e),l.length&&o.La.p_(l),o.onlineState=e,o.isPrimaryClient&&o.sharedClientState.setOnlineState(e)}}async function LBe(n,e,i){const o=dr(n);o.sharedClientState.updateQueryState(e,"rejected",i);const l=o.Ua.get(e),u=l&&l.key;if(u){let p=new As(Pn.comparator);p=p.insert(u,sc.newNoDocument(u,ar.min()));const y=Hr().add(u),v=new UN(ar.min(),new Map,new As(kr),p,y);await Eoe(o,v),o.$a=o.$a.remove(u),o.Ua.delete(e),m3(o)}else await kF(o.localStore,e,!1).then(()=>DF(o,e,i)).catch(eb)}async function MBe(n,e){const i=dr(n),o=e.batch.batchId;try{const l=await $4e(i.localStore,e);Soe(i,o,null),voe(i,o),i.sharedClientState.updateMutationState(o,"acknowledged"),await JR(i,l)}catch(l){await eb(l)}}async function UBe(n,e,i){const o=dr(n);try{const l=await function(p,y){const v=dr(p);return v.persistence.runTransaction("Reject batch","readwrite-primary",w=>{let C;return v.mutationQueue.lookupMutationBatch(w,y).next(R=>(wi(R!==null),C=R.keys(),v.mutationQueue.removeMutationBatch(w,R))).next(()=>v.mutationQueue.performConsistencyCheck(w)).next(()=>v.documentOverlayCache.removeOverlaysForBatchId(w,C,y)).next(()=>v.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(w,C)).next(()=>v.localDocuments.getDocuments(w,C))})}(o.localStore,e);Soe(o,e,i),voe(o,e),o.sharedClientState.updateMutationState(e,"rejected",i),await JR(o,l)}catch(l){await eb(l)}}function voe(n,e){(n.Ga.get(e)||[]).forEach(i=>{i.resolve()}),n.Ga.delete(e)}function Soe(n,e,i){const o=dr(n);let l=o.Wa[o.currentUser.toKey()];if(l){const u=l.get(e);u&&(i?u.reject(i):u.resolve(),l=l.remove(e)),o.Wa[o.currentUser.toKey()]=l}}function DF(n,e,i=null){n.sharedClientState.removeLocalQueryTarget(e);for(const o of n.qa.get(e))n.ka.delete(o),i&&n.La.Ja(o,i);n.qa.delete(e),n.isPrimaryClient&&n.Ka.br(e).forEach(o=>{n.Ka.containsKey(o)||boe(n,o)})}function boe(n,e){n.Qa.delete(e.path.canonicalString());const i=n.$a.get(e);i!==null&&(i3(n.remoteStore,i),n.$a=n.$a.remove(e),n.Ua.delete(i),m3(n))}function bQ(n,e,i){for(const o of i)o instanceof goe?(n.Ka.addReference(o.key,e),VBe(n,o)):o instanceof _oe?(ln(f3,"Document no longer in limbo: "+o.key),n.Ka.removeReference(o.key,e),n.Ka.containsKey(o.key)||boe(n,o.key)):Zn()}function VBe(n,e){const i=e.key,o=i.path.canonicalString();n.$a.get(i)||n.Qa.has(o)||(ln(f3,"New document in limbo: "+i),n.Qa.add(o),m3(n))}function m3(n){for(;n.Qa.size>0&&n.$a.size<n.maxConcurrentLimboResolutions;){const e=n.Qa.values().next().value;n.Qa.delete(e);const i=new Pn(Ji.fromString(e)),o=n.za.next();n.Ua.set(o,new IBe(i)),n.$a=n.$a.insert(i,o),uoe(n.remoteStore,new Rg(Pp(NN(i.path)),o,"TargetPurposeLimboResolution",AN.ae))}}async function JR(n,e,i){const o=dr(n),l=[],u=[],p=[];o.ka.isEmpty()||(o.ka.forEach((y,v)=>{p.push(o.Ha(v,e,i).then(w=>{var C;if((w||i)&&o.isPrimaryClient){const R=w?!w.fromCache:(C=i==null?void 0:i.targetChanges.get(v.targetId))===null||C===void 0?void 0:C.current;o.sharedClientState.updateQueryState(v.targetId,R?"current":"not-current")}if(w){l.push(w);const R=n3.Yi(v.targetId,w);u.push(R)}}))}),await Promise.all(p),o.La.p_(l),await async function(v,w){const C=dr(v);try{await C.persistence.runTransaction("notifyLocalViewChanges","readwrite",R=>kt.forEach(w,N=>kt.forEach(N.Hi,M=>C.persistence.referenceDelegate.addReference(R,N.targetId,M)).next(()=>kt.forEach(N.Ji,M=>C.persistence.referenceDelegate.removeReference(R,N.targetId,M)))))}catch(R){if(!tb(R))throw R;ln(r3,"Failed to update sequence numbers: "+R)}for(const R of w){const N=R.targetId;if(!R.fromCache){const M=C.Ts.get(N),L=M.snapshotVersion,U=M.withLastLimboFreeSnapshotVersion(L);C.Ts=C.Ts.insert(N,U)}}}(o.localStore,u))}async function FBe(n,e){const i=dr(n);if(!i.currentUser.isEqual(e)){ln(f3,"User change. New user:",e.toKey());const o=await ooe(i.localStore,e);i.currentUser=e,function(u,p){u.Ga.forEach(y=>{y.forEach(v=>{v.reject(new Zt(wt.CANCELLED,p))})}),u.Ga.clear()}(i,"'waitForPendingWrites' promise is rejected due to a user change."),i.sharedClientState.handleUserChange(e,o.removedBatchIds,o.addedBatchIds),await JR(i,o.Rs)}}function jBe(n,e){const i=dr(n),o=i.Ua.get(e);if(o&&o.Ba)return Hr().add(o.key);{let l=Hr();const u=i.qa.get(e);if(!u)return l;for(const p of u){const y=i.ka.get(p);l=l.unionWith(y.view.Sa)}return l}}function woe(n){const e=dr(n);return e.remoteStore.remoteSyncer.applyRemoteEvent=Eoe.bind(null,e),e.remoteStore.remoteSyncer.getRemoteKeysForTarget=jBe.bind(null,e),e.remoteStore.remoteSyncer.rejectListen=LBe.bind(null,e),e.La.p_=wBe.bind(null,e.eventManager),e.La.Ja=TBe.bind(null,e.eventManager),e}function BBe(n){const e=dr(n);return e.remoteStore.remoteSyncer.applySuccessfulWrite=MBe.bind(null,e),e.remoteStore.remoteSyncer.rejectFailedWrite=UBe.bind(null,e),e}class NO{constructor(){this.kind="memory",this.synchronizeTabs=!1}async initialize(e){this.serializer=VN(e.databaseInfo.databaseId),this.sharedClientState=this.Za(e),this.persistence=this.Xa(e),await this.persistence.start(),this.localStore=this.eu(e),this.gcScheduler=this.tu(e,this.localStore),this.indexBackfillerScheduler=this.nu(e,this.localStore)}tu(e,i){return null}nu(e,i){return null}eu(e){return H4e(this.persistence,new z4e,e.initialUser,this.serializer)}Xa(e){return new soe(t3.ri,this.serializer)}Za(e){return new Q4e}async terminate(){var e,i;(e=this.gcScheduler)===null||e===void 0||e.stop(),(i=this.indexBackfillerScheduler)===null||i===void 0||i.stop(),this.sharedClientState.shutdown(),await this.persistence.shutdown()}}NO.provider={build:()=>new NO};class zBe extends NO{constructor(e){super(),this.cacheSizeBytes=e}tu(e,i){wi(this.persistence.referenceDelegate instanceof kO);const o=this.persistence.referenceDelegate.garbageCollector;return new I4e(o,e.asyncQueue,i)}Xa(e){const i=this.cacheSizeBytes!==void 0?ll.withCacheSize(this.cacheSizeBytes):ll.DEFAULT;return new soe(o=>kO.ri(o,i),this.serializer)}}class xF{async initialize(e,i){this.localStore||(this.localStore=e.localStore,this.sharedClientState=e.sharedClientState,this.datastore=this.createDatastore(i),this.remoteStore=this.createRemoteStore(i),this.eventManager=this.createEventManager(i),this.syncEngine=this.createSyncEngine(i,!e.synchronizeTabs),this.sharedClientState.onlineStateHandler=o=>SQ(this.syncEngine,o,1),this.remoteStore.remoteSyncer.handleCredentialChange=FBe.bind(null,this.syncEngine),await vBe(this.remoteStore,this.syncEngine.isPrimaryClient))}createEventManager(e){return function(){return new bBe}()}createDatastore(e){const i=VN(e.databaseInfo.databaseId),o=function(u){return new rBe(u)}(e.databaseInfo);return function(u,p,y,v){return new aBe(u,p,y,v)}(e.authCredentials,e.appCheckCredentials,o,i)}createRemoteStore(e){return function(o,l,u,p,y){return new lBe(o,l,u,p,y)}(this.localStore,this.datastore,e.asyncQueue,i=>SQ(this.syncEngine,i,0),function(){return mQ.D()?new mQ:new Z4e}())}createSyncEngine(e,i){return function(l,u,p,y,v,w,C){const R=new ABe(l,u,p,y,v,w);return C&&(R.ja=!0),R}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,e.initialUser,e.maxConcurrentLimboResolutions,i)}async terminate(){var e,i;await async function(l){const u=dr(l);ln(sE,"RemoteStore shutting down."),u.W_.add(5),await XR(u),u.z_.shutdown(),u.j_.set("Unknown")}(this.remoteStore),(e=this.datastore)===null||e===void 0||e.terminate(),(i=this.eventManager)===null||i===void 0||i.terminate()}}xF.provider={build:()=>new xF};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class g3{constructor(e){this.observer=e,this.muted=!1}next(e){this.muted||this.observer.next&&this.iu(this.observer.next,e)}error(e){this.muted||(this.observer.error?this.iu(this.observer.error,e):qf("Uncaught Error in snapshot listener:",e.toString()))}su(){this.muted=!0}iu(e,i){setTimeout(()=>{this.muted||e(i)},0)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Gg="FirestoreClient";class WBe{constructor(e,i,o,l,u){this.authCredentials=e,this.appCheckCredentials=i,this.asyncQueue=o,this.databaseInfo=l,this.user=ic.UNAUTHENTICATED,this.clientId=yse.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this._uninitializedComponentsProvider=u,this.authCredentials.start(o,async p=>{ln(Gg,"Received user=",p.uid),await this.authCredentialListener(p),this.user=p}),this.appCheckCredentials.start(o,p=>(ln(Gg,"Received new app check token=",p),this.appCheckCredentialListener(p,this.user)))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(e){this.authCredentialListener=e}setAppCheckTokenChangeListener(e){this.appCheckCredentialListener=e}terminate(){this.asyncQueue.enterRestrictedMode();const e=new Ff;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted(async()=>{try{this._onlineComponents&&await this._onlineComponents.terminate(),this._offlineComponents&&await this._offlineComponents.terminate(),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),e.resolve()}catch(i){const o=l3(i,"Failed to shutdown persistence");e.reject(o)}}),e.promise}}async function iV(n,e){n.asyncQueue.verifyOperationInProgress(),ln(Gg,"Initializing OfflineComponentProvider");const i=n.configuration;await e.initialize(i);let o=i.initialUser;n.setCredentialChangeListener(async l=>{o.isEqual(l)||(await ooe(e.localStore,l),o=l)}),e.persistence.setDatabaseDeletedListener(()=>n.terminate()),n._offlineComponents=e}async function wQ(n,e){n.asyncQueue.verifyOperationInProgress();const i=await GBe(n);ln(Gg,"Initializing OnlineComponentProvider"),await e.initialize(i,n.configuration),n.setCredentialChangeListener(o=>_Q(e.remoteStore,o)),n.setAppCheckTokenChangeListener((o,l)=>_Q(e.remoteStore,l)),n._onlineComponents=e}async function GBe(n){if(!n._offlineComponents)if(n._uninitializedComponentsProvider){ln(Gg,"Using user provided OfflineComponentProvider");try{await iV(n,n._uninitializedComponentsProvider._offline)}catch(e){const i=e;if(!function(l){return l.name==="FirebaseError"?l.code===wt.FAILED_PRECONDITION||l.code===wt.UNIMPLEMENTED:!(typeof DOMException<"u"&&l instanceof DOMException)||l.code===22||l.code===20||l.code===11}(i))throw i;NS("Error using user provided cache. Falling back to memory cache: "+i),await iV(n,new NO)}}else ln(Gg,"Using default OfflineComponentProvider"),await iV(n,new zBe(void 0));return n._offlineComponents}async function Toe(n){return n._onlineComponents||(n._uninitializedComponentsProvider?(ln(Gg,"Using user provided OnlineComponentProvider"),await wQ(n,n._uninitializedComponentsProvider._online)):(ln(Gg,"Using default OnlineComponentProvider"),await wQ(n,new xF))),n._onlineComponents}function HBe(n){return Toe(n).then(e=>e.syncEngine)}async function DO(n){const e=await Toe(n),i=e.eventManager;return i.onListen=PBe.bind(null,e.syncEngine),i.onUnlisten=NBe.bind(null,e.syncEngine),i.onFirstRemoteStoreListen=kBe.bind(null,e.syncEngine),i.onLastRemoteStoreUnlisten=DBe.bind(null,e.syncEngine),i}function $Be(n,e,i={}){const o=new Ff;return n.asyncQueue.enqueueAndForget(async()=>function(u,p,y,v,w){const C=new g3({next:N=>{C.su(),p.enqueueAndForget(()=>d3(u,R));const M=N.docs.has(y);!M&&N.fromCache?w.reject(new Zt(wt.UNAVAILABLE,"Failed to get document because the client is offline.")):M&&N.fromCache&&v&&v.source==="server"?w.reject(new Zt(wt.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):w.resolve(N)},error:N=>w.reject(N)}),R=new p3(NN(y.path),C,{includeMetadataChanges:!0,Ta:!0});return u3(u,R)}(await DO(n),n.asyncQueue,e,i,o)),o.promise}function KBe(n,e,i={}){const o=new Ff;return n.asyncQueue.enqueueAndForget(async()=>function(u,p,y,v,w){const C=new g3({next:N=>{C.su(),p.enqueueAndForget(()=>d3(u,R)),N.fromCache&&v.source==="server"?w.reject(new Zt(wt.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):w.resolve(N)},error:N=>w.reject(N)}),R=new p3(y,C,{includeMetadataChanges:!0,Ta:!0});return u3(u,R)}(await DO(n),n.asyncQueue,e,i,o)),o.promise}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Coe(n){const e={};return n.timeoutSeconds!==void 0&&(e.timeoutSeconds=n.timeoutSeconds),e}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const TQ=new Map;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Roe(n,e,i){if(!i)throw new Zt(wt.INVALID_ARGUMENT,`Function ${n}() cannot be called with an empty ${e}.`)}function qBe(n,e,i,o){if(e===!0&&o===!0)throw new Zt(wt.INVALID_ARGUMENT,`${n} and ${i} cannot be used together.`)}function CQ(n){if(!Pn.isDocumentKey(n))throw new Zt(wt.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${n} has ${n.length}.`)}function RQ(n){if(Pn.isDocumentKey(n))throw new Zt(wt.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${n} has ${n.length}.`)}function BN(n){if(n===void 0)return"undefined";if(n===null)return"null";if(typeof n=="string")return n.length>20&&(n=`${n.substring(0,20)}...`),JSON.stringify(n);if(typeof n=="number"||typeof n=="boolean")return""+n;if(typeof n=="object"){if(n instanceof Array)return"an array";{const e=function(o){return o.constructor?o.constructor.name:null}(n);return e?`a custom ${e} object`:"an object"}}return typeof n=="function"?"a function":Zn()}function yl(n,e){if("_delegate"in n&&(n=n._delegate),!(n instanceof e)){if(e.name===n.constructor.name)throw new Zt(wt.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{const i=BN(n);throw new Zt(wt.INVALID_ARGUMENT,`Expected type '${e.name}', but it was: ${i}`)}}return n}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ioe="firestore.googleapis.com",IQ=!0;class AQ{constructor(e){var i,o;if(e.host===void 0){if(e.ssl!==void 0)throw new Zt(wt.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host=Ioe,this.ssl=IQ}else this.host=e.host,this.ssl=(i=e.ssl)!==null&&i!==void 0?i:IQ;if(this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,this.localCache=e.localCache,e.cacheSizeBytes===void 0)this.cacheSizeBytes=ioe;else{if(e.cacheSizeBytes!==-1&&e.cacheSizeBytes<C4e)throw new Zt(wt.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=e.cacheSizeBytes}qBe("experimentalForceLongPolling",e.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",e.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:e.experimentalAutoDetectLongPolling===void 0?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!e.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=Coe((o=e.experimentalLongPollingOptions)!==null&&o!==void 0?o:{}),function(u){if(u.timeoutSeconds!==void 0){if(isNaN(u.timeoutSeconds))throw new Zt(wt.INVALID_ARGUMENT,`invalid long polling timeout: ${u.timeoutSeconds} (must not be NaN)`);if(u.timeoutSeconds<5)throw new Zt(wt.INVALID_ARGUMENT,`invalid long polling timeout: ${u.timeoutSeconds} (minimum allowed value is 5)`);if(u.timeoutSeconds>30)throw new Zt(wt.INVALID_ARGUMENT,`invalid long polling timeout: ${u.timeoutSeconds} (maximum allowed value is 30)`)}}(this.experimentalLongPollingOptions),this.useFetchStreams=!!e.useFetchStreams}isEqual(e){return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&function(o,l){return o.timeoutSeconds===l.timeoutSeconds}(this.experimentalLongPollingOptions,e.experimentalLongPollingOptions)&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}}class zN{constructor(e,i,o,l){this._authCredentials=e,this._appCheckCredentials=i,this._databaseId=o,this._app=l,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new AQ({}),this._settingsFrozen=!1,this._emulatorOptions={},this._terminateTask="notTerminated"}get app(){if(!this._app)throw new Zt(wt.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return this._terminateTask!=="notTerminated"}_setSettings(e){if(this._settingsFrozen)throw new Zt(wt.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new AQ(e),this._emulatorOptions=e.emulatorOptions||{},e.credentials!==void 0&&(this._authCredentials=function(o){if(!o)return new n3e;switch(o.type){case"firstParty":return new o3e(o.sessionIndex||"0",o.iamToken||null,o.authTokenFactory||null);case"provider":return o.client;default:throw new Zt(wt.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(e.credentials))}_getSettings(){return this._settings}_getEmulatorOptions(){return this._emulatorOptions}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask==="notTerminated"&&(this._terminateTask=this._terminate()),this._terminateTask}async _restart(){this._terminateTask==="notTerminated"?await this._terminate():this._terminateTask="notTerminated"}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return function(i){const o=TQ.get(i);o&&(ln("ComponentProvider","Removing Datastore"),TQ.delete(i),o.terminate())}(this),Promise.resolve()}}function YBe(n,e,i,o={}){var l;const u=(n=yl(n,zN))._getSettings(),p=Object.assign(Object.assign({},u),{emulatorOptions:n._getEmulatorOptions()}),y=`${e}:${i}`;u.host!==Ioe&&u.host!==y&&NS("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used.");const v=Object.assign(Object.assign({},u),{host:y,ssl:!1,emulatorOptions:o});if(!Gf(v,p)&&(n._setSettings(v),o.mockUserToken)){let w,C;if(typeof o.mockUserToken=="string")w=o.mockUserToken,C=ic.MOCK_USER;else{w=Sie(o.mockUserToken,(l=n._app)===null||l===void 0?void 0:l.options.projectId);const R=o.mockUserToken.sub||o.mockUserToken.user_id;if(!R)throw new Zt(wt.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");C=new ic(R)}n._authCredentials=new r3e(new gse(w,C))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Lp{constructor(e,i,o){this.converter=i,this._query=o,this.type="query",this.firestore=e}withConverter(e){return new Lp(this.firestore,e,this._query)}}class ac{constructor(e,i,o){this.converter=i,this._key=o,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new Dg(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new ac(this.firestore,e,this._key)}}class Dg extends Lp{constructor(e,i,o){super(e,i,NN(o)),this._path=o,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){const e=this._path.popLast();return e.isEmpty()?null:new ac(this.firestore,null,new Pn(e))}withConverter(e){return new Dg(this.firestore,e,this._path)}}function El(n,e,...i){if(n=Pi(n),Roe("collection","path",e),n instanceof zN){const o=Ji.fromString(e,...i);return RQ(o),new Dg(n,null,o)}{if(!(n instanceof ac||n instanceof Dg))throw new Zt(wt.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const o=n._path.child(Ji.fromString(e,...i));return RQ(o),new Dg(n.firestore,null,o)}}function wr(n,e,...i){if(n=Pi(n),arguments.length===1&&(e=yse.newId()),Roe("doc","path",e),n instanceof zN){const o=Ji.fromString(e,...i);return CQ(o),new ac(n,null,new Pn(o))}{if(!(n instanceof ac||n instanceof Dg))throw new Zt(wt.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const o=n._path.child(Ji.fromString(e,...i));return CQ(o),new ac(n.firestore,n instanceof Dg?n.converter:null,new Pn(o))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const PQ="AsyncQueue";class kQ{constructor(e=Promise.resolve()){this.Vu=[],this.mu=!1,this.fu=[],this.gu=null,this.pu=!1,this.yu=!1,this.wu=[],this.a_=new coe(this,"async_queue_retry"),this.Su=()=>{const o=rV();o&&ln(PQ,"Visibility state changed to "+o.visibilityState),this.a_.t_()},this.bu=e;const i=rV();i&&typeof i.addEventListener=="function"&&i.addEventListener("visibilitychange",this.Su)}get isShuttingDown(){return this.mu}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.Du(),this.vu(e)}enterRestrictedMode(e){if(!this.mu){this.mu=!0,this.yu=e||!1;const i=rV();i&&typeof i.removeEventListener=="function"&&i.removeEventListener("visibilitychange",this.Su)}}enqueue(e){if(this.Du(),this.mu)return new Promise(()=>{});const i=new Ff;return this.vu(()=>this.mu&&this.yu?Promise.resolve():(e().then(i.resolve,i.reject),i.promise)).then(()=>i.promise)}enqueueRetryable(e){this.enqueueAndForget(()=>(this.Vu.push(e),this.Cu()))}async Cu(){if(this.Vu.length!==0){try{await this.Vu[0](),this.Vu.shift(),this.a_.reset()}catch(e){if(!tb(e))throw e;ln(PQ,"Operation failed with retryable error: "+e)}this.Vu.length>0&&this.a_.Xo(()=>this.Cu())}}vu(e){const i=this.bu.then(()=>(this.pu=!0,e().catch(o=>{this.gu=o,this.pu=!1;const l=function(p){let y=p.message||"";return p.stack&&(y=p.stack.includes(p.message)?p.stack:p.message+`
`+p.stack),y}(o);throw qf("INTERNAL UNHANDLED ERROR: ",l),o}).then(o=>(this.pu=!1,o))));return this.bu=i,i}enqueueAfterDelay(e,i,o){this.Du(),this.wu.indexOf(e)>-1&&(i=0);const l=c3.createAndSchedule(this,e,i,o,u=>this.Fu(u));return this.fu.push(l),l}Du(){this.gu&&Zn()}verifyOperationInProgress(){}async Mu(){let e;do e=this.bu,await e;while(e!==this.bu)}xu(e){for(const i of this.fu)if(i.timerId===e)return!0;return!1}Ou(e){return this.Mu().then(()=>{this.fu.sort((i,o)=>i.targetTimeMs-o.targetTimeMs);for(const i of this.fu)if(i.skipDelay(),e!=="all"&&i.timerId===e)break;return this.Mu()})}Nu(e){this.wu.push(e)}Fu(e){const i=this.fu.indexOf(e);this.fu.splice(i,1)}}function OQ(n){return function(i,o){if(typeof i!="object"||i===null)return!1;const l=i;for(const u of o)if(u in l&&typeof l[u]=="function")return!0;return!1}(n,["next","error","complete"])}class Xf extends zN{constructor(e,i,o,l){super(e,i,o,l),this.type="firestore",this._queue=new kQ,this._persistenceKey=(l==null?void 0:l.name)||"[DEFAULT]"}async _terminate(){if(this._firestoreClient){const e=this._firestoreClient.terminate();this._queue=new kQ(e),this._firestoreClient=void 0,await e}}}function $k(n,e){const i=typeof n=="object"?n:wN(),o=typeof n=="string"?n:wO,l=WR(i,"firestore").getImmediate({identifier:o});if(!l._initialized){const u=N5("firestore");u&&YBe(l,...u)}return l}function WN(n){if(n._terminated)throw new Zt(wt.FAILED_PRECONDITION,"The client has already been terminated.");return n._firestoreClient||XBe(n),n._firestoreClient}function XBe(n){var e,i,o;const l=n._freezeSettings(),u=function(y,v,w,C){return new S3e(y,v,w,C.host,C.ssl,C.experimentalForceLongPolling,C.experimentalAutoDetectLongPolling,Coe(C.experimentalLongPollingOptions),C.useFetchStreams)}(n._databaseId,((e=n._app)===null||e===void 0?void 0:e.options.appId)||"",n._persistenceKey,l);n._componentsProvider||!((i=l.localCache)===null||i===void 0)&&i._offlineComponentProvider&&(!((o=l.localCache)===null||o===void 0)&&o._onlineComponentProvider)&&(n._componentsProvider={_offline:l.localCache._offlineComponentProvider,_online:l.localCache._onlineComponentProvider}),n._firestoreClient=new WBe(n._authCredentials,n._appCheckCredentials,n._queue,u,n._componentsProvider&&function(y){const v=y==null?void 0:y._online.build();return{_offline:y==null?void 0:y._offline.build(v),_online:v}}(n._componentsProvider))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class BS{constructor(e){this._byteString=e}static fromBase64String(e){try{return new BS(Oa.fromBase64String(e))}catch(i){throw new Zt(wt.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+i)}}static fromUint8Array(e){return new BS(Oa.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class GN{constructor(...e){for(let i=0;i<e.length;++i)if(e[i].length===0)throw new Zt(wt.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new ka(e)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class QR{constructor(e){this._methodName=e}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class _3{constructor(e,i){if(!isFinite(e)||e<-90||e>90)throw new Zt(wt.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(i)||i<-180||i>180)throw new Zt(wt.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+i);this._lat=e,this._long=i}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}toJSON(){return{latitude:this._lat,longitude:this._long}}_compareTo(e){return kr(this._lat,e._lat)||kr(this._long,e._long)}}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class y3{constructor(e){this._values=(e||[]).map(i=>i)}toArray(){return this._values.map(e=>e)}isEqual(e){return function(o,l){if(o.length!==l.length)return!1;for(let u=0;u<o.length;++u)if(o[u]!==l[u])return!1;return!0}(this._values,e._values)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const JBe=/^__.*__$/;class QBe{constructor(e,i,o){this.data=e,this.fieldMask=i,this.fieldTransforms=o}toMutation(e,i){return this.fieldMask!==null?new Qg(e,this.data,this.fieldMask,i,this.fieldTransforms):new qR(e,this.data,i,this.fieldTransforms)}}class Aoe{constructor(e,i,o){this.data=e,this.fieldMask=i,this.fieldTransforms=o}toMutation(e,i){return new Qg(e,this.data,this.fieldMask,i,this.fieldTransforms)}}function Poe(n){switch(n){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw Zn()}}class HN{constructor(e,i,o,l,u,p){this.settings=e,this.databaseId=i,this.serializer=o,this.ignoreUndefinedProperties=l,u===void 0&&this.Bu(),this.fieldTransforms=u||[],this.fieldMask=p||[]}get path(){return this.settings.path}get Lu(){return this.settings.Lu}ku(e){return new HN(Object.assign(Object.assign({},this.settings),e),this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}qu(e){var i;const o=(i=this.path)===null||i===void 0?void 0:i.child(e),l=this.ku({path:o,Qu:!1});return l.$u(e),l}Uu(e){var i;const o=(i=this.path)===null||i===void 0?void 0:i.child(e),l=this.ku({path:o,Qu:!1});return l.Bu(),l}Ku(e){return this.ku({path:void 0,Qu:!0})}Wu(e){return xO(e,this.settings.methodName,this.settings.Gu||!1,this.path,this.settings.zu)}contains(e){return this.fieldMask.find(i=>e.isPrefixOf(i))!==void 0||this.fieldTransforms.find(i=>e.isPrefixOf(i.field))!==void 0}Bu(){if(this.path)for(let e=0;e<this.path.length;e++)this.$u(this.path.get(e))}$u(e){if(e.length===0)throw this.Wu("Document fields must not be empty");if(Poe(this.Lu)&&JBe.test(e))throw this.Wu('Document fields cannot begin and end with "__"')}}class ZBe{constructor(e,i,o){this.databaseId=e,this.ignoreUndefinedProperties=i,this.serializer=o||VN(e)}ju(e,i,o,l=!1){return new HN({Lu:e,methodName:i,zu:o,path:ka.emptyPath(),Qu:!1,Gu:l},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}}function ZR(n){const e=n._freezeSettings(),i=VN(n._databaseId);return new ZBe(n._databaseId,!!e.ignoreUndefinedProperties,i)}function koe(n,e,i,o,l,u={}){const p=n.ju(u.merge||u.mergeFields?2:0,e,i,l);S3("Data must be an object, but it was:",p,o);const y=Doe(o,p);let v,w;if(u.merge)v=new eu(p.fieldMask),w=p.fieldTransforms;else if(u.mergeFields){const C=[];for(const R of u.mergeFields){const N=LF(e,R,i);if(!p.contains(N))throw new Zt(wt.INVALID_ARGUMENT,`Field '${N}' is specified in your field mask but missing from your input data.`);Loe(C,N)||C.push(N)}v=new eu(C),w=p.fieldTransforms.filter(R=>v.covers(R.field))}else v=null,w=p.fieldTransforms;return new QBe(new hl(y),v,w)}class $N extends QR{_toFieldTransform(e){if(e.Lu!==2)throw e.Lu===1?e.Wu(`${this._methodName}() can only appear at the top level of your update data`):e.Wu(`${this._methodName}() cannot be used with set() unless you pass {merge:true}`);return e.fieldMask.push(e.path),null}isEqual(e){return e instanceof $N}}function Ooe(n,e,i){return new HN({Lu:3,zu:e.settings.zu,methodName:n._methodName,Qu:i},e.databaseId,e.serializer,e.ignoreUndefinedProperties)}class E3 extends QR{constructor(e,i){super(e),this.Hu=i}_toFieldTransform(e){const i=Ooe(this,e,!0),o=this.Hu.map(u=>fE(u,i)),l=new US(o);return new Hse(e.path,l)}isEqual(e){return e instanceof E3&&Gf(this.Hu,e.Hu)}}class v3 extends QR{constructor(e,i){super(e),this.Hu=i}_toFieldTransform(e){const i=Ooe(this,e,!0),o=this.Hu.map(u=>fE(u,i)),l=new VS(o);return new Hse(e.path,l)}isEqual(e){return e instanceof v3&&Gf(this.Hu,e.Hu)}}function e6e(n,e,i,o){const l=n.ju(1,e,i);S3("Data must be an object, but it was:",l,o);const u=[],p=hl.empty();Jg(o,(v,w)=>{const C=b3(e,v,i);w=Pi(w);const R=l.Uu(C);if(w instanceof $N)u.push(C);else{const N=fE(w,R);N!=null&&(u.push(C),p.set(C,N))}});const y=new eu(u);return new Aoe(p,y,l.fieldTransforms)}function t6e(n,e,i,o,l,u){const p=n.ju(1,e,i),y=[LF(e,o,i)],v=[l];if(u.length%2!=0)throw new Zt(wt.INVALID_ARGUMENT,`Function ${e}() needs to be called with an even number of arguments that alternate between field names and values.`);for(let N=0;N<u.length;N+=2)y.push(LF(e,u[N])),v.push(u[N+1]);const w=[],C=hl.empty();for(let N=y.length-1;N>=0;--N)if(!Loe(w,y[N])){const M=y[N];let L=v[N];L=Pi(L);const U=p.Uu(M);if(L instanceof $N)w.push(M);else{const z=fE(L,U);z!=null&&(w.push(M),C.set(M,z))}}const R=new eu(w);return new Aoe(C,R,p.fieldTransforms)}function Noe(n,e,i,o=!1){return fE(i,n.ju(o?4:3,e))}function fE(n,e){if(xoe(n=Pi(n)))return S3("Unsupported field value:",e,n),Doe(n,e);if(n instanceof QR)return function(o,l){if(!Poe(l.Lu))throw l.Wu(`${o._methodName}() can only be used with update() and set()`);if(!l.path)throw l.Wu(`${o._methodName}() is not currently supported inside arrays`);const u=o._toFieldTransform(l);u&&l.fieldTransforms.push(u)}(n,e),null;if(n===void 0&&e.ignoreUndefinedProperties)return null;if(e.path&&e.fieldMask.push(e.path),n instanceof Array){if(e.settings.Qu&&e.Lu!==4)throw e.Wu("Nested arrays are not supported");return function(o,l){const u=[];let p=0;for(const y of o){let v=fE(y,l.Ku(p));v==null&&(v={nullValue:"NULL_VALUE"}),u.push(v),p++}return{arrayValue:{values:u}}}(n,e)}return function(o,l){if((o=Pi(o))===null)return{nullValue:"NULL_VALUE"};if(typeof o=="number")return G3e(l.serializer,o);if(typeof o=="boolean")return{booleanValue:o};if(typeof o=="string")return{stringValue:o};if(o instanceof Date){const u=Fo.fromDate(o);return{timestampValue:PO(l.serializer,u)}}if(o instanceof Fo){const u=new Fo(o.seconds,1e3*Math.floor(o.nanoseconds/1e3));return{timestampValue:PO(l.serializer,u)}}if(o instanceof _3)return{geoPointValue:{latitude:o.latitude,longitude:o.longitude}};if(o instanceof BS)return{bytesValue:Jse(l.serializer,o._byteString)};if(o instanceof ac){const u=l.databaseId,p=o.firestore._databaseId;if(!p.isEqual(u))throw l.Wu(`Document reference is for database ${p.projectId}/${p.database} but should be for database ${u.projectId}/${u.database}`);return{referenceValue:Z5(o.firestore._databaseId||l.databaseId,o._key.path)}}if(o instanceof y3)return function(p,y){return{mapValue:{fields:{[Rse]:{stringValue:Ise},[TO]:{arrayValue:{values:p.toArray().map(w=>{if(typeof w!="number")throw y.Wu("VectorValues must only contain numeric values.");return Y5(y.serializer,w)})}}}}}}(o,l);throw l.Wu(`Unsupported field value: ${BN(o)}`)}(n,e)}function Doe(n,e){const i={};return vse(n)?e.path&&e.path.length>0&&e.fieldMask.push(e.path):Jg(n,(o,l)=>{const u=fE(l,e.qu(o));u!=null&&(i[o]=u)}),{mapValue:{fields:i}}}function xoe(n){return!(typeof n!="object"||n===null||n instanceof Array||n instanceof Date||n instanceof Fo||n instanceof _3||n instanceof BS||n instanceof ac||n instanceof QR||n instanceof y3)}function S3(n,e,i){if(!xoe(i)||!function(l){return typeof l=="object"&&l!==null&&(Object.getPrototypeOf(l)===Object.prototype||Object.getPrototypeOf(l)===null)}(i)){const o=BN(i);throw o==="an object"?e.Wu(n+" a custom object"):e.Wu(n+" "+o)}}function LF(n,e,i){if((e=Pi(e))instanceof GN)return e._internalPath;if(typeof e=="string")return b3(n,e);throw xO("Field path arguments must be of type string or ",n,!1,void 0,i)}const n6e=new RegExp("[~\\*/\\[\\]]");function b3(n,e,i){if(e.search(n6e)>=0)throw xO(`Invalid field path (${e}). Paths must not contain '~', '*', '/', '[', or ']'`,n,!1,void 0,i);try{return new GN(...e.split("."))._internalPath}catch{throw xO(`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,n,!1,void 0,i)}}function xO(n,e,i,o,l){const u=o&&!o.isEmpty(),p=l!==void 0;let y=`Function ${e}() called with invalid data`;i&&(y+=" (via `toFirestore()`)"),y+=". ";let v="";return(u||p)&&(v+=" (found",u&&(v+=` in field ${o}`),p&&(v+=` in document ${l}`),v+=")"),new Zt(wt.INVALID_ARGUMENT,y+n+v)}function Loe(n,e){return n.some(i=>i.isEqual(e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class w3{constructor(e,i,o,l,u){this._firestore=e,this._userDataWriter=i,this._key=o,this._document=l,this._converter=u}get id(){return this._key.path.lastSegment()}get ref(){return new ac(this._firestore,this._converter,this._key)}exists(){return this._document!==null}data(){if(this._document){if(this._converter){const e=new r6e(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}return this._userDataWriter.convertValue(this._document.data.value)}}get(e){if(this._document){const i=this._document.data.field(KN("DocumentSnapshot.get",e));if(i!==null)return this._userDataWriter.convertValue(i)}}}class r6e extends w3{data(){return super.data()}}function KN(n,e){return typeof e=="string"?b3(n,e):e instanceof GN?e._internalPath:e._delegate._internalPath}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Moe(n){if(n.limitType==="L"&&n.explicitOrderBy.length===0)throw new Zt(wt.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}class T3{}class qN extends T3{}function LO(n,e,...i){let o=[];e instanceof T3&&o.push(e),o=o.concat(i),function(u){const p=u.filter(v=>v instanceof C3).length,y=u.filter(v=>v instanceof YN).length;if(p>1||p>0&&y>0)throw new Zt(wt.INVALID_ARGUMENT,"InvalidQuery. When using composite filters, you cannot use more than one filter at the top level. Consider nesting the multiple filters within an `and(...)` statement. For example: change `query(query, where(...), or(...))` to `query(query, and(where(...), or(...)))`.")}(o);for(const l of o)n=l._apply(n);return n}class YN extends qN{constructor(e,i,o){super(),this._field=e,this._op=i,this._value=o,this.type="where"}static _create(e,i,o){return new YN(e,i,o)}_apply(e){const i=this._parse(e);return Uoe(e._query,i),new Lp(e.firestore,e.converter,CF(e._query,i))}_parse(e){const i=ZR(e.firestore);return function(u,p,y,v,w,C,R){let N;if(w.isKeyField()){if(C==="array-contains"||C==="array-contains-any")throw new Zt(wt.INVALID_ARGUMENT,`Invalid Query. You can't perform '${C}' queries on documentId().`);if(C==="in"||C==="not-in"){xQ(R,C);const L=[];for(const U of R)L.push(DQ(v,u,U));N={arrayValue:{values:L}}}else N=DQ(v,u,R)}else C!=="in"&&C!=="not-in"&&C!=="array-contains-any"||xQ(R,C),N=Noe(y,p,R,C==="in"||C==="not-in");return vo.create(w,C,N)}(e._query,"where",i,e.firestore._databaseId,this._field,this._op,this._value)}}function NQ(n,e,i){const o=e,l=KN("where",n);return YN._create(l,o,i)}class C3 extends T3{constructor(e,i){super(),this.type=e,this._queryConstraints=i}static _create(e,i){return new C3(e,i)}_parse(e){const i=this._queryConstraints.map(o=>o._parse(e)).filter(o=>o.getFilters().length>0);return i.length===1?i[0]:hh.create(i,this._getOperator())}_apply(e){const i=this._parse(e);return i.getFilters().length===0?e:(function(l,u){let p=l;const y=u.getFlattenedFilters();for(const v of y)Uoe(p,v),p=CF(p,v)}(e._query,i),new Lp(e.firestore,e.converter,CF(e._query,i)))}_getQueryConstraints(){return this._queryConstraints}_getOperator(){return this.type==="and"?"and":"or"}}class R3 extends qN{constructor(e,i){super(),this._field=e,this._direction=i,this.type="orderBy"}static _create(e,i){return new R3(e,i)}_apply(e){const i=function(l,u,p){if(l.startAt!==null)throw new Zt(wt.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(l.endAt!==null)throw new Zt(wt.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");return new ER(u,p)}(e._query,this._field,this._direction);return new Lp(e.firestore,e.converter,function(l,u){const p=l.explicitOrderBy.concat([u]);return new dE(l.path,l.collectionGroup,p,l.filters.slice(),l.limit,l.limitType,l.startAt,l.endAt)}(e._query,i))}}function i6e(n,e="asc"){const i=e,o=KN("orderBy",n);return R3._create(o,i)}class I3 extends qN{constructor(e,i,o){super(),this.type=e,this._limit=i,this._limitType=o}static _create(e,i,o){return new I3(e,i,o)}_apply(e){return new Lp(e.firestore,e.converter,RO(e._query,this._limit,this._limitType))}}function s6e(n){return I3._create("limit",n,"F")}class A3 extends qN{constructor(e,i,o){super(),this.type=e,this._docOrFields=i,this._inclusive=o}static _create(e,i,o){return new A3(e,i,o)}_apply(e){const i=a6e(e,this.type,this._docOrFields,this._inclusive);return new Lp(e.firestore,e.converter,function(l,u){return new dE(l.path,l.collectionGroup,l.explicitOrderBy.slice(),l.filters.slice(),l.limit,l.limitType,u,l.endAt)}(e._query,i))}}function o6e(...n){return A3._create("startAt",n,!0)}function a6e(n,e,i,o){if(i[0]=Pi(i[0]),i[0]instanceof w3)return function(u,p,y,v,w){if(!v)throw new Zt(wt.NOT_FOUND,`Can't use a DocumentSnapshot that doesn't exist for ${y}().`);const C=[];for(const R of mS(u))if(R.field.isKeyField())C.push(CO(p,v.key));else{const N=v.data.field(R.field);if(kN(N))throw new Zt(wt.INVALID_ARGUMENT,'Invalid query. You are trying to start or end a query using a document for which the field "'+R.field+'" is an uncommitted server timestamp. (Since the value of this field is unknown, you cannot start/end a query with it.)');if(N===null){const M=R.field.canonicalString();throw new Zt(wt.INVALID_ARGUMENT,`Invalid query. You are trying to start or end a query using a document for which the field '${M}' (used as the orderBy) does not exist.`)}C.push(N)}return new MS(C,w)}(n._query,n.firestore._databaseId,e,i[0]._document,o);{const l=ZR(n.firestore);return function(p,y,v,w,C,R){const N=p.explicitOrderBy;if(C.length>N.length)throw new Zt(wt.INVALID_ARGUMENT,`Too many arguments provided to ${w}(). The number of arguments must be less than or equal to the number of orderBy() clauses`);const M=[];for(let L=0;L<C.length;L++){const U=C[L];if(N[L].field.isKeyField()){if(typeof U!="string")throw new Zt(wt.INVALID_ARGUMENT,`Invalid query. Expected a string for document ID in ${w}(), but got a ${typeof U}`);if(!q5(p)&&U.indexOf("/")!==-1)throw new Zt(wt.INVALID_ARGUMENT,`Invalid query. When querying a collection and ordering by documentId(), the value passed to ${w}() must be a plain document ID, but '${U}' contains a slash.`);const z=p.path.child(Ji.fromString(U));if(!Pn.isDocumentKey(z))throw new Zt(wt.INVALID_ARGUMENT,`Invalid query. When querying a collection group and ordering by documentId(), the value passed to ${w}() must result in a valid document path, but '${z}' is not because it contains an odd number of segments.`);const J=new Pn(z);M.push(CO(y,J))}else{const z=Noe(v,w,U);M.push(z)}}return new MS(M,R)}(n._query,n.firestore._databaseId,l,e,i,o)}}function DQ(n,e,i){if(typeof(i=Pi(i))=="string"){if(i==="")throw new Zt(wt.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!q5(e)&&i.indexOf("/")!==-1)throw new Zt(wt.INVALID_ARGUMENT,`Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '${i}' contains a '/' character.`);const o=e.path.child(Ji.fromString(i));if(!Pn.isDocumentKey(o))throw new Zt(wt.INVALID_ARGUMENT,`Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '${o}' is not because it has an odd number of segments (${o.length}).`);return CO(n,new Pn(o))}if(i instanceof ac)return CO(n,i._key);throw new Zt(wt.INVALID_ARGUMENT,`Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ${BN(i)}.`)}function xQ(n,e){if(!Array.isArray(n)||n.length===0)throw new Zt(wt.INVALID_ARGUMENT,`Invalid Query. A non-empty array is required for '${e.toString()}' filters.`)}function Uoe(n,e){const i=function(l,u){for(const p of l)for(const y of p.getFlattenedFilters())if(u.indexOf(y.op)>=0)return y.op;return null}(n.filters,function(l){switch(l){case"!=":return["!=","not-in"];case"array-contains-any":case"in":return["not-in"];case"not-in":return["array-contains-any","in","not-in","!="];default:return[]}}(e.op));if(i!==null)throw i===e.op?new Zt(wt.INVALID_ARGUMENT,`Invalid query. You cannot use more than one '${e.op.toString()}' filter.`):new Zt(wt.INVALID_ARGUMENT,`Invalid query. You cannot use '${e.op.toString()}' filters with '${i.toString()}' filters.`)}class c6e{convertValue(e,i="none"){switch(zg(e)){case 0:return null;case 1:return e.booleanValue;case 2:return no(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,i);case 5:return e.stringValue;case 6:return this.convertBytes(Bg(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,i);case 11:return this.convertObject(e.mapValue,i);case 10:return this.convertVectorValue(e.mapValue);default:throw Zn()}}convertObject(e,i){return this.convertObjectMap(e.fields,i)}convertObjectMap(e,i="none"){const o={};return Jg(e,(l,u)=>{o[l]=this.convertValue(u,i)}),o}convertVectorValue(e){var i,o,l;const u=(l=(o=(i=e.fields)===null||i===void 0?void 0:i[TO].arrayValue)===null||o===void 0?void 0:o.values)===null||l===void 0?void 0:l.map(p=>no(p.doubleValue));return new y3(u)}convertGeoPoint(e){return new _3(no(e.latitude),no(e.longitude))}convertArray(e,i){return(e.values||[]).map(o=>this.convertValue(o,i))}convertServerTimestamp(e,i){switch(i){case"previous":const o=ON(e);return o==null?null:this.convertValue(o,i);case"estimate":return this.convertTimestamp(gR(e));default:return null}}convertTimestamp(e){const i=jg(e);return new Fo(i.seconds,i.nanos)}convertDocumentKey(e,i){const o=Ji.fromString(e);wi(roe(o));const l=new _R(o.get(1),o.get(3)),u=new Pn(o.popFirst(5));return l.isEqual(i)||qf(`Document ${u} contains a document reference within a different database (${l.projectId}/${l.database}) which is not supported. It will be treated as a reference in the current database (${i.projectId}/${i.database}) instead.`),u}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Voe(n,e,i){let o;return o=n?i&&(i.merge||i.mergeFields)?n.toFirestore(e,i):n.toFirestore(e):e,o}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class vC{constructor(e,i){this.hasPendingWrites=e,this.fromCache=i}isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}}class Foe extends w3{constructor(e,i,o,l,u,p){super(e,i,o,l,p),this._firestore=e,this._firestoreImpl=e,this.metadata=u}exists(){return super.exists()}data(e={}){if(this._document){if(this._converter){const i=new Kk(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(i,e)}return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps)}}get(e,i={}){if(this._document){const o=this._document.data.field(KN("DocumentSnapshot.get",e));if(o!==null)return this._userDataWriter.convertValue(o,i.serverTimestamps)}}}class Kk extends Foe{data(e={}){return super.data(e)}}class joe{constructor(e,i,o,l){this._firestore=e,this._userDataWriter=i,this._snapshot=l,this.metadata=new vC(l.hasPendingWrites,l.fromCache),this.query=o}get docs(){const e=[];return this.forEach(i=>e.push(i)),e}get size(){return this._snapshot.docs.size}get empty(){return this.size===0}forEach(e,i){this._snapshot.docs.forEach(o=>{e.call(i,new Kk(this._firestore,this._userDataWriter,o.key,o,new vC(this._snapshot.mutatedKeys.has(o.key),this._snapshot.fromCache),this.query.converter))})}docChanges(e={}){const i=!!e.includeMetadataChanges;if(i&&this._snapshot.excludesMetadataChanges)throw new Zt(wt.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===i||(this._cachedChanges=function(l,u){if(l._snapshot.oldDocs.isEmpty()){let p=0;return l._snapshot.docChanges.map(y=>{const v=new Kk(l._firestore,l._userDataWriter,y.doc.key,y.doc,new vC(l._snapshot.mutatedKeys.has(y.doc.key),l._snapshot.fromCache),l.query.converter);return y.doc,{type:"added",doc:v,oldIndex:-1,newIndex:p++}})}{let p=l._snapshot.oldDocs;return l._snapshot.docChanges.filter(y=>u||y.type!==3).map(y=>{const v=new Kk(l._firestore,l._userDataWriter,y.doc.key,y.doc,new vC(l._snapshot.mutatedKeys.has(y.doc.key),l._snapshot.fromCache),l.query.converter);let w=-1,C=-1;return y.type!==0&&(w=p.indexOf(y.doc.key),p=p.delete(y.doc.key)),y.type!==1&&(p=p.add(y.doc),C=p.indexOf(y.doc.key)),{type:l6e(y.type),doc:v,oldIndex:w,newIndex:C}})}}(this,i),this._cachedChangesIncludeMetadataChanges=i),this._cachedChanges}}function l6e(n){switch(n){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return Zn()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Bo(n){n=yl(n,ac);const e=yl(n.firestore,Xf);return $Be(WN(e),n._key).then(i=>zoe(e,n,i))}class P3 extends c6e{constructor(e){super(),this.firestore=e}convertBytes(e){return new BS(e)}convertReference(e){const i=this.convertDocumentKey(e,this.firestore._databaseId);return new ac(this.firestore,null,i)}}function id(n){n=yl(n,Lp);const e=yl(n.firestore,Xf),i=WN(e),o=new P3(e);return Moe(n._query),KBe(i,n._query).then(l=>new joe(e,o,n,l))}function Hg(n,e,i){n=yl(n,ac);const o=yl(n.firestore,Xf),l=Voe(n.converter,e,i);return XN(o,[koe(ZR(o),"setDoc",n._key,l,n.converter!==null,i).toMutation(n._key,rd.none())])}function lo(n,e,i,...o){n=yl(n,ac);const l=yl(n.firestore,Xf),u=ZR(l);let p;return p=typeof(e=Pi(e))=="string"||e instanceof GN?t6e(u,"updateDoc",n._key,e,i,o):e6e(u,"updateDoc",n._key,e),XN(l,[p.toMutation(n._key,rd.exists(!0))])}function u6e(n){return XN(yl(n.firestore,Xf),[new X5(n._key,rd.none())])}function d6e(n,e){const i=yl(n.firestore,Xf),o=wr(n),l=Voe(n.converter,e);return XN(i,[koe(ZR(n.firestore),"addDoc",o._key,l,n.converter!==null,{}).toMutation(o._key,rd.exists(!1))]).then(()=>o)}function Boe(n,...e){var i,o,l;n=Pi(n);let u={includeMetadataChanges:!1,source:"default"},p=0;typeof e[p]!="object"||OQ(e[p])||(u=e[p],p++);const y={includeMetadataChanges:u.includeMetadataChanges,source:u.source};if(OQ(e[p])){const R=e[p];e[p]=(i=R.next)===null||i===void 0?void 0:i.bind(R),e[p+1]=(o=R.error)===null||o===void 0?void 0:o.bind(R),e[p+2]=(l=R.complete)===null||l===void 0?void 0:l.bind(R)}let v,w,C;if(n instanceof ac)w=yl(n.firestore,Xf),C=NN(n._key.path),v={next:R=>{e[p]&&e[p](zoe(w,n,R))},error:e[p+1],complete:e[p+2]};else{const R=yl(n,Lp);w=yl(R.firestore,Xf),C=R._query;const N=new P3(w);v={next:M=>{e[p]&&e[p](new joe(w,N,R,M))},error:e[p+1],complete:e[p+2]},Moe(n._query)}return function(N,M,L,U){const z=new g3(U),J=new p3(M,z,L);return N.asyncQueue.enqueueAndForget(async()=>u3(await DO(N),J)),()=>{z.su(),N.asyncQueue.enqueueAndForget(async()=>d3(await DO(N),J))}}(WN(w),C,y,v)}function XN(n,e){return function(o,l){const u=new Ff;return o.asyncQueue.enqueueAndForget(async()=>xBe(await HBe(o),l,u)),u.promise}(WN(n),e)}function zoe(n,e,i){const o=i.docs.get(e._key),l=new P3(n);return new Foe(n,l,e._key,o,new vC(i.hasPendingWrites,i.fromCache),e.converter)}function h6e(...n){return new E3("arrayUnion",n)}function Woe(...n){return new v3("arrayRemove",n)}(function(e,i=!0){(function(l){ZS=l})(uE),Vg(new Hf("firestore",(o,{instanceIdentifier:l,options:u})=>{const p=o.getProvider("app").getImmediate(),y=new Xf(new i3e(o.getProvider("auth-internal")),new a3e(p,o.getProvider("app-check-internal")),function(w,C){if(!Object.prototype.hasOwnProperty.apply(w.options,["projectId"]))throw new Zt(wt.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new _R(w.options.projectId,C)}(p,l),p);return u=Object.assign({useFetchStreams:i},u),y._setSettings(u),y},"PUBLIC").setMultipleInstances(!0)),nd(MJ,UJ,e),nd(MJ,UJ,"esm2017")})();var p6e="firebase",f6e="11.5.0";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */nd(p6e,f6e,"app");/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const m6e="type.googleapis.com/google.protobuf.Int64Value",g6e="type.googleapis.com/google.protobuf.UInt64Value";function Goe(n,e){const i={};for(const o in n)n.hasOwnProperty(o)&&(i[o]=e(n[o]));return i}function MO(n){if(n==null)return null;if(n instanceof Number&&(n=n.valueOf()),typeof n=="number"&&isFinite(n)||n===!0||n===!1||Object.prototype.toString.call(n)==="[object String]")return n;if(n instanceof Date)return n.toISOString();if(Array.isArray(n))return n.map(e=>MO(e));if(typeof n=="function"||typeof n=="object")return Goe(n,e=>MO(e));throw new Error("Data cannot be encoded in JSON: "+n)}function zS(n){if(n==null)return n;if(n["@type"])switch(n["@type"]){case m6e:case g6e:{const e=Number(n.value);if(isNaN(e))throw new Error("Data cannot be decoded from JSON: "+n);return e}default:throw new Error("Data cannot be decoded from JSON: "+n)}return Array.isArray(n)?n.map(e=>zS(e)):typeof n=="function"||typeof n=="object"?Goe(n,e=>zS(e)):n}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const k3="functions";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const LQ={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class fl extends ph{constructor(e,i,o){super(`${k3}/${e}`,i||""),this.details=o,Object.setPrototypeOf(this,fl.prototype)}}function _6e(n){if(n>=200&&n<300)return"ok";switch(n){case 0:return"internal";case 400:return"invalid-argument";case 401:return"unauthenticated";case 403:return"permission-denied";case 404:return"not-found";case 409:return"aborted";case 429:return"resource-exhausted";case 499:return"cancelled";case 500:return"internal";case 501:return"unimplemented";case 503:return"unavailable";case 504:return"deadline-exceeded"}return"unknown"}function UO(n,e){let i=_6e(n),o=i,l;try{const u=e&&e.error;if(u){const p=u.status;if(typeof p=="string"){if(!LQ[p])return new fl("internal","internal");i=LQ[p],o=p}const y=u.message;typeof y=="string"&&(o=y),l=u.details,l!==void 0&&(l=zS(l))}}catch{}return i==="ok"?null:new fl(i,o,l)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class y6e{constructor(e,i,o,l){this.app=e,this.auth=null,this.messaging=null,this.appCheck=null,this.serverAppAppCheckToken=null,dl(e)&&e.settings.appCheckToken&&(this.serverAppAppCheckToken=e.settings.appCheckToken),this.auth=i.getImmediate({optional:!0}),this.messaging=o.getImmediate({optional:!0}),this.auth||i.get().then(u=>this.auth=u,()=>{}),this.messaging||o.get().then(u=>this.messaging=u,()=>{}),this.appCheck||l==null||l.get().then(u=>this.appCheck=u,()=>{})}async getAuthToken(){if(this.auth)try{const e=await this.auth.getToken();return e==null?void 0:e.accessToken}catch{return}}async getMessagingToken(){if(!(!this.messaging||!("Notification"in self)||Notification.permission!=="granted"))try{return await this.messaging.getToken()}catch{return}}async getAppCheckToken(e){if(this.serverAppAppCheckToken)return this.serverAppAppCheckToken;if(this.appCheck){const i=e?await this.appCheck.getLimitedUseToken():await this.appCheck.getToken();return i.error?null:i.token}return null}async getContext(e){const i=await this.getAuthToken(),o=await this.getMessagingToken(),l=await this.getAppCheckToken(e);return{authToken:i,messagingToken:o,appCheckToken:l}}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const MF="us-central1",E6e=/^data: (.*?)(?:\n|$)/;function v6e(n){let e=null;return{promise:new Promise((i,o)=>{e=setTimeout(()=>{o(new fl("deadline-exceeded","deadline-exceeded"))},n)}),cancel:()=>{e&&clearTimeout(e)}}}class S6e{constructor(e,i,o,l,u=MF,p=(...y)=>fetch(...y)){this.app=e,this.fetchImpl=p,this.emulatorOrigin=null,this.contextProvider=new y6e(e,i,o,l),this.cancelAllRequests=new Promise(y=>{this.deleteService=()=>Promise.resolve(y())});try{const y=new URL(u);this.customDomain=y.origin+(y.pathname==="/"?"":y.pathname),this.region=MF}catch{this.customDomain=null,this.region=u}}_delete(){return this.deleteService()}_url(e){const i=this.app.options.projectId;return this.emulatorOrigin!==null?`${this.emulatorOrigin}/${i}/${this.region}/${e}`:this.customDomain!==null?`${this.customDomain}/${e}`:`https://${this.region}-${i}.cloudfunctions.net/${e}`}}function b6e(n,e,i){n.emulatorOrigin=`http://${e}:${i}`}function w6e(n,e,i){const o=l=>C6e(n,e,l,{});return o.stream=(l,u)=>I6e(n,e,l,u),o}async function T6e(n,e,i,o){i["Content-Type"]="application/json";let l;try{l=await o(n,{method:"POST",body:JSON.stringify(e),headers:i})}catch{return{status:0,json:null}}let u=null;try{u=await l.json()}catch{}return{status:l.status,json:u}}async function Hoe(n,e){const i={},o=await n.contextProvider.getContext(e.limitedUseAppCheckTokens);return o.authToken&&(i.Authorization="Bearer "+o.authToken),o.messagingToken&&(i["Firebase-Instance-ID-Token"]=o.messagingToken),o.appCheckToken!==null&&(i["X-Firebase-AppCheck"]=o.appCheckToken),i}function C6e(n,e,i,o){const l=n._url(e);return R6e(n,l,i,o)}async function R6e(n,e,i,o){i=MO(i);const l={data:i},u=await Hoe(n,o),p=o.timeout||7e4,y=v6e(p),v=await Promise.race([T6e(e,l,u,n.fetchImpl),y.promise,n.cancelAllRequests]);if(y.cancel(),!v)throw new fl("cancelled","Firebase Functions instance was deleted.");const w=UO(v.status,v.json);if(w)throw w;if(!v.json)throw new fl("internal","Response is not valid JSON object.");let C=v.json.data;if(typeof C>"u"&&(C=v.json.result),typeof C>"u")throw new fl("internal","Response is missing data field.");return{data:zS(C)}}function I6e(n,e,i,o){const l=n._url(e);return A6e(n,l,i,o||{})}async function A6e(n,e,i,o){var l;i=MO(i);const u={data:i},p=await Hoe(n,o);p["Content-Type"]="application/json",p.Accept="text/event-stream";let y;try{y=await n.fetchImpl(e,{method:"POST",body:JSON.stringify(u),headers:p,signal:o==null?void 0:o.signal})}catch(M){if(M instanceof Error&&M.name==="AbortError"){const U=new fl("cancelled","Request was cancelled.");return{data:Promise.reject(U),stream:{[Symbol.asyncIterator](){return{next(){return Promise.reject(U)}}}}}}const L=UO(0,null);return{data:Promise.reject(L),stream:{[Symbol.asyncIterator](){return{next(){return Promise.reject(L)}}}}}}let v,w;const C=new Promise((M,L)=>{v=M,w=L});(l=o==null?void 0:o.signal)===null||l===void 0||l.addEventListener("abort",()=>{const M=new fl("cancelled","Request was cancelled.");w(M)});const R=y.body.getReader(),N=P6e(R,v,w,o==null?void 0:o.signal);return{stream:{[Symbol.asyncIterator](){const M=N.getReader();return{async next(){const{value:L,done:U}=await M.read();return{value:L,done:U}},async return(){return await M.cancel(),{done:!0,value:void 0}}}}},data:C}}function P6e(n,e,i,o){const l=(p,y)=>{const v=p.match(E6e);if(!v)return;const w=v[1];try{const C=JSON.parse(w);if("result"in C){e(zS(C.result));return}if("message"in C){y.enqueue(zS(C.message));return}if("error"in C){const R=UO(0,C);y.error(R),i(R);return}}catch(C){if(C instanceof fl){y.error(C),i(C);return}}},u=new TextDecoder;return new ReadableStream({start(p){let y="";return v();async function v(){if(o!=null&&o.aborted){const w=new fl("cancelled","Request was cancelled");return p.error(w),i(w),Promise.resolve()}try{const{value:w,done:C}=await n.read();if(C){y.trim()&&l(y.trim(),p),p.close();return}if(o!=null&&o.aborted){const N=new fl("cancelled","Request was cancelled");p.error(N),i(N),await n.cancel();return}y+=u.decode(w,{stream:!0});const R=y.split(`
`);y=R.pop()||"";for(const N of R)N.trim()&&l(N.trim(),p);return v()}catch(w){const C=w instanceof fl?w:UO(0,null);p.error(C),i(C)}}},cancel(){return n.cancel()}})}const MQ="@firebase/functions",UQ="0.12.3";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const k6e="auth-internal",O6e="app-check-internal",N6e="messaging-internal";function D6e(n){const e=(i,{instanceIdentifier:o})=>{const l=i.getProvider("app").getImmediate(),u=i.getProvider(k6e),p=i.getProvider(N6e),y=i.getProvider(O6e);return new S6e(l,u,p,y,o)};Vg(new Hf(k3,e,"PUBLIC").setMultipleInstances(!0)),nd(MQ,UQ,n),nd(MQ,UQ,"esm2017")}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function x6e(n=wN(),e=MF){const o=WR(Pi(n),k3).getImmediate({identifier:e}),l=N5("functions");return l&&L6e(o,...l),o}function L6e(n,e,i){b6e(Pi(n),e,i)}function O3(n,e,i){return w6e(Pi(n),e)}D6e();const M6e=[{key:"VITE_FIREBASE_API_KEY",value:void 0},{key:"VITE_FIREBASE_AUTH_DOMAIN",value:void 0},{key:"VITE_FIREBASE_PROJECT_ID",value:void 0},{key:"VITE_FIREBASE_STORAGE_BUCKET",value:void 0},{key:"VITE_FIREBASE_MESSAGING_SENDER_ID",value:void 0},{key:"VITE_FIREBASE_APP_ID",value:void 0}],UF=M6e.filter(n=>!n.value);if(UF.length>0){const e=`Missing environment variables: ${UF.map(i=>i.key).join(", ")}. Using fallback values. For production, it's recommended to set up your .env file.`;K.warn(e),console.warn(e)}const U6e={apiKey:"AIzaSyCaxoNKRIMaXhotGzdAjXc5gkARoqtS3bU",authDomain:"disruptive-metaverse.firebaseapp.com",projectId:"disruptive-metaverse",storageBucket:"disruptive-metaverse.appspot.com",messagingSenderId:"294433070603",appId:"1:294433070603:web:136cddd196eea9614fb10e"},V6e=UF.length>0;K.log(`Firebase initializing with ${V6e?"fallback":"environment"} configuration`);let lk,N3,Yn,JN;try{lk=Tie(U6e),N3=IN(lk),Yn=$k(lk),JN=x6e(lk),K.log("Firebase initialized successfully")}catch(n){K.error("Failed to initialize Firebase:",n),console.error("Failed to initialize Firebase:",n)}const Zu=n=>!0,VQ=(n,e)=>{const o=(n+e.charAt(0)).toLowerCase().replace(/[^a-z0-9]/g,"").substring(0,11),l=Math.floor(1e3+Math.random()*9e3);return o+l},vR=async n=>{try{if(!n||typeof n!="string"||n.trim()==="")return K.error("userFirestore: Invalid username provided to isUsernameTaken"),!0;const e=n.toLowerCase().trim();K.log(`userFirestore: Checking if username "${e}" is taken`);const i=El(Yn,"users"),o=LO(i,s6e(100)),l=await id(o);let u=!1;return l.forEach(p=>{const y=p.data();y.username&&y.username.toLowerCase()===e&&(u=!0)}),K.log(`userFirestore: Username "${e}" is ${u?"taken":"available"}`),u}catch(e){return K.error("userFirestore: Error checking username availability:",e),!0}},F6e=async(n,e)=>{let i=VQ(n,e),o=0;const l=10;for(;o<l;){if(!await vR(i))return i;i=VQ(n,e),o++}return i+Math.floor(Math.random()*100)},su=async n=>{try{K.log("userFirestore: Get user PUBLIC profile data for user ID: "+n);const e=wr(Yn,"users",n),i=await Bo(e);if(i.exists()){const o=i.data();return K.log("userFirestore: Found PUBLIC Profile for : "+o.Nickname),delete o.email,delete o.emailVerified,o}else return K.error("userFirestore: user profile document not found"),null}catch(e){throw K.error("userFirestore: Error fetching user public profile data:",e),e}},j6e=async(n,e,i)=>{try{if(K.log("userFirestore: Starting registerUser process"),K.log("userFirestore: Fields in additionalData:",Object.keys(i||{}).join(", ")),!i)throw K.error("userFirestore: additionalData is null or undefined"),new Error("Registration data is missing");const o={firstName:i.firstName||"",lastName:i.lastName||"",companyName:i.companyName||"",linkedInProfile:i.linkedInProfile||"",username:i.username||"",Nickname:i.Nickname||"",rpmURL:i.rpmURL||"https://models.readyplayer.me/67c8408d38f7924e15a8bd0a.glb"};K.log("userFirestore: Critical fields captured for registration"),K.log("userFirestore: Creating user auth record");const u=(await Fje(N3,n,e)).user;await Zie(u),K.log("userFirestore: Verification email sent"),K.log("userFirestore: Waiting for Cloud Function to create initial document..."),await new Promise(M=>setTimeout(M,5e3));const p=wr(Yn,"users",u.uid),y=await Bo(p);if(y.exists()){K.log("userFirestore: Found document created by Cloud Function, updating with missing fields");const M=y.data(),L={};M.firstName||(L.firstName=o.firstName),M.lastName||(L.lastName=o.lastName),M.Nickname||(L.Nickname=o.Nickname),M.username||(L.username=o.username),M.companyName||(L.companyName=o.companyName),M.linkedInProfile||(L.linkedInProfile=o.linkedInProfile),M.rpmURL||(L.rpmURL=o.rpmURL),Object.keys(L).length>0&&(K.log("userFirestore: Updating document with fields:",Object.keys(L).join(", ")),await lo(p,{...L,lastUpdated:new Date}))}else{K.error("userFirestore: Cloud Function failed to create user document, creating manually"),await Hg(p,{...o,id:u.uid,groups:["users"],createdAt:new Date,lastUpdated:new Date});const M=wr(Yn,"users",u.uid,"private","data");await Hg(M,{email:u.email,emailVerified:!1})}const v=await Bo(p);if(!v.exists())throw new Error("User document does not exist even after creation attempts");let w=v.data();w.firstName||(w.firstName=o.firstName),w.lastName||(w.lastName=o.lastName),w.Nickname||(w.Nickname=o.Nickname),w.username||(w.username=o.username),w.companyName||(w.companyName=o.companyName);let C=!1,R={};for(const M in o)(!w[M]||w[M]==="")&&(R[M]=o[M],C=!0);(!w.groups||!w.groups.includes("users"))&&(R.groups=w.groups?[...w.groups,"users"]:["users"],C=!0,K.log("userFirestore: Adding user to users group")),C&&(K.log("userFirestore: Updating user document with missing fields"),K.log("userFirestore: Fields being updated:",Object.keys(R).join(", ")),await lo(p,R),w=(await Bo(p)).data());const N={...u,...w,firstName:o.firstName,lastName:o.lastName,Nickname:o.Nickname,username:o.username,companyName:o.companyName,linkedInProfile:o.linkedInProfile};return K.log("userFirestore: Registration complete, returning user data"),K.log("userFirestore: Fields included in return data:",Object.keys(N).join(", ")),N}catch(o){throw K.error("userFirestore: Error creating user:",o),o}},$oe=async(n,e)=>{try{K.log(`userFirestore: Updating rpmURL for user ID: ${n}`);const i=wr(Yn,"users",n);await lo(i,{rpmURL:e,lastUpdated:new Date().toISOString()}),K.log("userFirestore: rpmURL updated successfully.")}catch(i){throw K.error("userFirestore: Error updating rpmURL:",i),i}},B6e=async(n,e)=>{try{const i=await su(n);return i&&i.groups?i.groups.includes(e):!1}catch(i){return K.error("userFirestore: Error checking group membership:",i),!1}},z6e=async(n,e)=>{try{if(Zu(e),await vR(e))throw new Error("Username is already taken");const o=wr(Yn,"users",n);return await lo(o,{username:e,lastUpdated:new Date}),K.log(`userFirestore: Username updated for user ${n}`),!0}catch(i){throw K.error("userFirestore: Error updating username:",i),i}};var W6e={};const VO=()=>{const n=typeof process<"u"&&W6e&&!1;return typeof window<"u"&&new URLSearchParams(window.location.search).has("dev_mode"),n},G6e=(n,e)=>{if(!VO())return K.warn(" SECURITY WARNING: Permission override attempted outside of development environment"),!1},H6e=(n,e)=>{if(!VO())return K.warn(" SECURITY WARNING: Permission override attempted outside of development environment"),!1},D3=typeof VO=="function"?VO():!1;D3&&K.warn(" SECURITY WARNING: Permission overrides are ENABLED. This should only happen in development.");const $6e=async(n,e)=>{if(D3)return G6e();if(!n||!n.uid)return!1;try{if(n.groups){const l=`space_${e}_owners`;if(n.groups.includes(l))return console.log(`User ${n.uid} is an owner via groups property`),!0}const o=IN().currentUser;if(o&&o.uid===n.uid)try{const u=(await o.getIdTokenResult(!0)).claims.groups||[],p=`space_${e}_owners`;if(u.includes(p))return console.log(`User ${n.uid} is an owner via Firebase token claims`),!0}catch(l){console.error("Error getting token result:",l)}return!1}catch(i){return K.error("Error checking space owner permissions:",i),!1}},Koe=async(n,e)=>{if(D3)return H6e();try{if(K.log(`userPermissions: Checking if user ${n} belongs to group ${e}`),e==="users")return K.log(`userPermissions: TESTING MODE - Always allowing access to 'users' group for user ${n}`),!0;if(n){const i=await su(n);if(K.log(`userPermissions: User profile for ${n}:`,i),i&&i.groups&&Array.isArray(i.groups)){if(K.log(`userPermissions: User ${n} has groups:`,i.groups),i.groups.includes(e))return K.log(`userPermissions: User ${n} belongs to group ${e} (from user document)`),!0}else K.log(`userPermissions: User ${n} has no groups or groups is not an array`);if(e==="disruptiveAdmin")try{const l=IN().currentUser;if(l&&l.uid===n){const u=await l.getIdTokenResult();if(K.log(`userPermissions: Token claims for ${n}:`,u.claims),u.claims&&u.claims.groups&&Array.isArray(u.claims.groups)&&u.claims.groups.includes(e))return K.log(`userPermissions: User ${n} belongs to group ${e} (from token claims)`),!0}}catch(o){K.error("userPermissions: Error checking token claims:",o)}}return K.log(`userPermissions: User ${n} does not belong to group ${e}`),!1}catch(i){return K.error("userPermissions: Error checking if user belongs to group:",i),!1}},K6e=["email","name","rpmURL","Nickname","username","created_on","height_cm","companyName","firstName","lastName","linkedInProfile","groups"],ch={sendUserToUnity:"sendUserToUnity",playerInstantiated:"playerInstantiated",firstSceneLoaded:"firstSceneLoaded"};class q6e{constructor(){this.events={}}subscribe(e,i){this.events[e]||(this.events[e]=[]),this.events[e].push(i)}publish(e,i){const o=this.events[e];o?(o.forEach(l=>{l(i)}),K.log(`EventBus: Published event '${e}'`)):K.log(`EventBus: No subscribers for event '${e}'`)}unsubscribe(e,i){var l;const o=(l=this.events[e])==null?void 0:l.indexOf(i);o>-1&&this.events[e].splice(o,1)}}const lh=new q6e;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const qoe="firebasestorage.googleapis.com",Yoe="storageBucket",Y6e=2*60*1e3,X6e=10*60*1e3;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class zs extends ph{constructor(e,i,o=0){super(sV(e),`Firebase Storage: ${i} (${sV(e)})`),this.status_=o,this.customData={serverResponse:null},this._baseMessage=this.message,Object.setPrototypeOf(this,zs.prototype)}get status(){return this.status_}set status(e){this.status_=e}_codeEquals(e){return sV(e)===this.code}get serverResponse(){return this.customData.serverResponse}set serverResponse(e){this.customData.serverResponse=e,this.customData.serverResponse?this.message=`${this._baseMessage}
${this.customData.serverResponse}`:this.message=this._baseMessage}}var Bs;(function(n){n.UNKNOWN="unknown",n.OBJECT_NOT_FOUND="object-not-found",n.BUCKET_NOT_FOUND="bucket-not-found",n.PROJECT_NOT_FOUND="project-not-found",n.QUOTA_EXCEEDED="quota-exceeded",n.UNAUTHENTICATED="unauthenticated",n.UNAUTHORIZED="unauthorized",n.UNAUTHORIZED_APP="unauthorized-app",n.RETRY_LIMIT_EXCEEDED="retry-limit-exceeded",n.INVALID_CHECKSUM="invalid-checksum",n.CANCELED="canceled",n.INVALID_EVENT_NAME="invalid-event-name",n.INVALID_URL="invalid-url",n.INVALID_DEFAULT_BUCKET="invalid-default-bucket",n.NO_DEFAULT_BUCKET="no-default-bucket",n.CANNOT_SLICE_BLOB="cannot-slice-blob",n.SERVER_FILE_WRONG_SIZE="server-file-wrong-size",n.NO_DOWNLOAD_URL="no-download-url",n.INVALID_ARGUMENT="invalid-argument",n.INVALID_ARGUMENT_COUNT="invalid-argument-count",n.APP_DELETED="app-deleted",n.INVALID_ROOT_OPERATION="invalid-root-operation",n.INVALID_FORMAT="invalid-format",n.INTERNAL_ERROR="internal-error",n.UNSUPPORTED_ENVIRONMENT="unsupported-environment"})(Bs||(Bs={}));function sV(n){return"storage/"+n}function x3(){const n="An unknown error occurred, please check the error payload for server response.";return new zs(Bs.UNKNOWN,n)}function J6e(n){return new zs(Bs.OBJECT_NOT_FOUND,"Object '"+n+"' does not exist.")}function Q6e(n){return new zs(Bs.QUOTA_EXCEEDED,"Quota for bucket '"+n+"' exceeded, please view quota on https://firebase.google.com/pricing/.")}function Z6e(){const n="User is not authenticated, please authenticate using Firebase Authentication and try again.";return new zs(Bs.UNAUTHENTICATED,n)}function eze(){return new zs(Bs.UNAUTHORIZED_APP,"This app does not have permission to access Firebase Storage on this project.")}function tze(n){return new zs(Bs.UNAUTHORIZED,"User does not have permission to access '"+n+"'.")}function nze(){return new zs(Bs.RETRY_LIMIT_EXCEEDED,"Max retry time for operation exceeded, please try again.")}function rze(){return new zs(Bs.CANCELED,"User canceled the upload/download.")}function ize(n){return new zs(Bs.INVALID_URL,"Invalid URL '"+n+"'.")}function sze(n){return new zs(Bs.INVALID_DEFAULT_BUCKET,"Invalid default bucket '"+n+"'.")}function oze(){return new zs(Bs.NO_DEFAULT_BUCKET,"No default bucket found. Did you set the '"+Yoe+"' property when initializing the app?")}function aze(){return new zs(Bs.CANNOT_SLICE_BLOB,"Cannot slice blob for upload. Please retry the upload.")}function cze(){return new zs(Bs.NO_DOWNLOAD_URL,"The given file does not have any download URLs.")}function lze(n){return new zs(Bs.UNSUPPORTED_ENVIRONMENT,`${n} is missing. Make sure to install the required polyfills. See https://firebase.google.com/docs/web/environments-js-sdk#polyfills for more information.`)}function VF(n){return new zs(Bs.INVALID_ARGUMENT,n)}function Xoe(){return new zs(Bs.APP_DELETED,"The Firebase app was deleted.")}function uze(n){return new zs(Bs.INVALID_ROOT_OPERATION,"The operation '"+n+"' cannot be performed on a root reference, create a non-root reference using child, such as .child('file.png').")}function zC(n,e){return new zs(Bs.INVALID_FORMAT,"String does not match format '"+n+"': "+e)}function KT(n){throw new zs(Bs.INTERNAL_ERROR,"Internal error: "+n)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class tu{constructor(e,i){this.bucket=e,this.path_=i}get path(){return this.path_}get isRoot(){return this.path.length===0}fullServerUrl(){const e=encodeURIComponent;return"/b/"+e(this.bucket)+"/o/"+e(this.path)}bucketOnlyServerUrl(){return"/b/"+encodeURIComponent(this.bucket)+"/o"}static makeFromBucketSpec(e,i){let o;try{o=tu.makeFromUrl(e,i)}catch{return new tu(e,"")}if(o.path==="")return o;throw sze(e)}static makeFromUrl(e,i){let o=null;const l="([A-Za-z0-9.\\-_]+)";function u(ce){ce.path.charAt(ce.path.length-1)==="/"&&(ce.path_=ce.path_.slice(0,-1))}const p="(/(.*))?$",y=new RegExp("^gs://"+l+p,"i"),v={bucket:1,path:3};function w(ce){ce.path_=decodeURIComponent(ce.path)}const C="v[A-Za-z0-9_]+",R=i.replace(/[.]/g,"\\."),N="(/([^?#]*).*)?$",M=new RegExp(`^https?://${R}/${C}/b/${l}/o${N}`,"i"),L={bucket:1,path:3},U=i===qoe?"(?:storage.googleapis.com|storage.cloud.google.com)":i,z="([^?#]*)",J=new RegExp(`^https?://${U}/${l}/${z}`,"i"),re=[{regex:y,indices:v,postModify:u},{regex:M,indices:L,postModify:w},{regex:J,indices:{bucket:1,path:2},postModify:w}];for(let ce=0;ce<re.length;ce++){const ae=re[ce],pe=ae.regex.exec(e);if(pe){const H=pe[ae.indices.bucket];let X=pe[ae.indices.path];X||(X=""),o=new tu(H,X),ae.postModify(o);break}}if(o==null)throw ize(e);return o}}class dze{constructor(e){this.promise_=Promise.reject(e)}getPromise(){return this.promise_}cancel(e=!1){}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function hze(n,e,i){let o=1,l=null,u=null,p=!1,y=0;function v(){return y===2}let w=!1;function C(...z){w||(w=!0,e.apply(null,z))}function R(z){l=setTimeout(()=>{l=null,n(M,v())},z)}function N(){u&&clearTimeout(u)}function M(z,...J){if(w){N();return}if(z){N(),C.call(null,z,...J);return}if(v()||p){N(),C.call(null,z,...J);return}o<64&&(o*=2);let re;y===1?(y=2,re=0):re=(o+Math.random())*1e3,R(re)}let L=!1;function U(z){L||(L=!0,N(),!w&&(l!==null?(z||(y=2),clearTimeout(l),R(0)):z||(y=1)))}return R(0),u=setTimeout(()=>{p=!0,U(!0)},i),U}function pze(n){n(!1)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function fze(n){return n!==void 0}function mze(n){return typeof n=="object"&&!Array.isArray(n)}function L3(n){return typeof n=="string"||n instanceof String}function FQ(n){return M3()&&n instanceof Blob}function M3(){return typeof Blob<"u"}function jQ(n,e,i,o){if(o<e)throw VF(`Invalid value for '${n}'. Expected ${e} or greater.`);if(o>i)throw VF(`Invalid value for '${n}'. Expected ${i} or less.`)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function QN(n,e,i){let o=e;return i==null&&(o=`https://${e}`),`${i}://${o}/v0${n}`}function Joe(n){const e=encodeURIComponent;let i="?";for(const o in n)if(n.hasOwnProperty(o)){const l=e(o)+"="+e(n[o]);i=i+l+"&"}return i=i.slice(0,-1),i}var Yy;(function(n){n[n.NO_ERROR=0]="NO_ERROR",n[n.NETWORK_ERROR=1]="NETWORK_ERROR",n[n.ABORT=2]="ABORT"})(Yy||(Yy={}));/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function gze(n,e){const i=n>=500&&n<600,l=[408,429].indexOf(n)!==-1,u=e.indexOf(n)!==-1;return i||l||u}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class _ze{constructor(e,i,o,l,u,p,y,v,w,C,R,N=!0){this.url_=e,this.method_=i,this.headers_=o,this.body_=l,this.successCodes_=u,this.additionalRetryCodes_=p,this.callback_=y,this.errorCallback_=v,this.timeout_=w,this.progressCallback_=C,this.connectionFactory_=R,this.retry=N,this.pendingConnection_=null,this.backoffId_=null,this.canceled_=!1,this.appDelete_=!1,this.promise_=new Promise((M,L)=>{this.resolve_=M,this.reject_=L,this.start_()})}start_(){const e=(o,l)=>{if(l){o(!1,new uk(!1,null,!0));return}const u=this.connectionFactory_();this.pendingConnection_=u;const p=y=>{const v=y.loaded,w=y.lengthComputable?y.total:-1;this.progressCallback_!==null&&this.progressCallback_(v,w)};this.progressCallback_!==null&&u.addUploadProgressListener(p),u.send(this.url_,this.method_,this.body_,this.headers_).then(()=>{this.progressCallback_!==null&&u.removeUploadProgressListener(p),this.pendingConnection_=null;const y=u.getErrorCode()===Yy.NO_ERROR,v=u.getStatus();if(!y||gze(v,this.additionalRetryCodes_)&&this.retry){const C=u.getErrorCode()===Yy.ABORT;o(!1,new uk(!1,null,C));return}const w=this.successCodes_.indexOf(v)!==-1;o(!0,new uk(w,u))})},i=(o,l)=>{const u=this.resolve_,p=this.reject_,y=l.connection;if(l.wasSuccessCode)try{const v=this.callback_(y,y.getResponse());fze(v)?u(v):u()}catch(v){p(v)}else if(y!==null){const v=x3();v.serverResponse=y.getErrorText(),this.errorCallback_?p(this.errorCallback_(y,v)):p(v)}else if(l.canceled){const v=this.appDelete_?Xoe():rze();p(v)}else{const v=nze();p(v)}};this.canceled_?i(!1,new uk(!1,null,!0)):this.backoffId_=hze(e,i,this.timeout_)}getPromise(){return this.promise_}cancel(e){this.canceled_=!0,this.appDelete_=e||!1,this.backoffId_!==null&&pze(this.backoffId_),this.pendingConnection_!==null&&this.pendingConnection_.abort()}}class uk{constructor(e,i,o){this.wasSuccessCode=e,this.connection=i,this.canceled=!!o}}function yze(n,e){e!==null&&e.length>0&&(n.Authorization="Firebase "+e)}function Eze(n,e){n["X-Firebase-Storage-Version"]="webjs/"+(e??"AppManager")}function vze(n,e){e&&(n["X-Firebase-GMPID"]=e)}function Sze(n,e){e!==null&&(n["X-Firebase-AppCheck"]=e)}function bze(n,e,i,o,l,u,p=!0){const y=Joe(n.urlParams),v=n.url+y,w=Object.assign({},n.headers);return vze(w,e),yze(w,i),Eze(w,u),Sze(w,o),new _ze(v,n.method,w,n.body,n.successCodes,n.additionalRetryCodes,n.handler,n.errorHandler,n.timeout,n.progressCallback,l,p)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function wze(){return typeof BlobBuilder<"u"?BlobBuilder:typeof WebKitBlobBuilder<"u"?WebKitBlobBuilder:void 0}function Tze(...n){const e=wze();if(e!==void 0){const i=new e;for(let o=0;o<n.length;o++)i.append(n[o]);return i.getBlob()}else{if(M3())return new Blob(n);throw new zs(Bs.UNSUPPORTED_ENVIRONMENT,"This browser doesn't seem to support creating Blobs")}}function Cze(n,e,i){return n.webkitSlice?n.webkitSlice(e,i):n.mozSlice?n.mozSlice(e,i):n.slice?n.slice(e,i):null}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Rze(n){if(typeof atob>"u")throw lze("base-64");return atob(n)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ep={RAW:"raw",BASE64:"base64",BASE64URL:"base64url",DATA_URL:"data_url"};class oV{constructor(e,i){this.data=e,this.contentType=i||null}}function Ize(n,e){switch(n){case Ep.RAW:return new oV(Qoe(e));case Ep.BASE64:case Ep.BASE64URL:return new oV(Zoe(n,e));case Ep.DATA_URL:return new oV(Pze(e),kze(e))}throw x3()}function Qoe(n){const e=[];for(let i=0;i<n.length;i++){let o=n.charCodeAt(i);if(o<=127)e.push(o);else if(o<=2047)e.push(192|o>>6,128|o&63);else if((o&64512)===55296)if(!(i<n.length-1&&(n.charCodeAt(i+1)&64512)===56320))e.push(239,191,189);else{const u=o,p=n.charCodeAt(++i);o=65536|(u&1023)<<10|p&1023,e.push(240|o>>18,128|o>>12&63,128|o>>6&63,128|o&63)}else(o&64512)===56320?e.push(239,191,189):e.push(224|o>>12,128|o>>6&63,128|o&63)}return new Uint8Array(e)}function Aze(n){let e;try{e=decodeURIComponent(n)}catch{throw zC(Ep.DATA_URL,"Malformed data URL.")}return Qoe(e)}function Zoe(n,e){switch(n){case Ep.BASE64:{const l=e.indexOf("-")!==-1,u=e.indexOf("_")!==-1;if(l||u)throw zC(n,"Invalid character '"+(l?"-":"_")+"' found: is it base64url encoded?");break}case Ep.BASE64URL:{const l=e.indexOf("+")!==-1,u=e.indexOf("/")!==-1;if(l||u)throw zC(n,"Invalid character '"+(l?"+":"/")+"' found: is it base64 encoded?");e=e.replace(/-/g,"+").replace(/_/g,"/");break}}let i;try{i=Rze(e)}catch(l){throw l.message.includes("polyfill")?l:zC(n,"Invalid character found")}const o=new Uint8Array(i.length);for(let l=0;l<i.length;l++)o[l]=i.charCodeAt(l);return o}class eae{constructor(e){this.base64=!1,this.contentType=null;const i=e.match(/^data:([^,]+)?,/);if(i===null)throw zC(Ep.DATA_URL,"Must be formatted 'data:[<mediatype>][;base64],<data>");const o=i[1]||null;o!=null&&(this.base64=Oze(o,";base64"),this.contentType=this.base64?o.substring(0,o.length-7):o),this.rest=e.substring(e.indexOf(",")+1)}}function Pze(n){const e=new eae(n);return e.base64?Zoe(Ep.BASE64,e.rest):Aze(e.rest)}function kze(n){return new eae(n).contentType}function Oze(n,e){return n.length>=e.length?n.substring(n.length-e.length)===e:!1}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class wg{constructor(e,i){let o=0,l="";FQ(e)?(this.data_=e,o=e.size,l=e.type):e instanceof ArrayBuffer?(i?this.data_=new Uint8Array(e):(this.data_=new Uint8Array(e.byteLength),this.data_.set(new Uint8Array(e))),o=this.data_.length):e instanceof Uint8Array&&(i?this.data_=e:(this.data_=new Uint8Array(e.length),this.data_.set(e)),o=e.length),this.size_=o,this.type_=l}size(){return this.size_}type(){return this.type_}slice(e,i){if(FQ(this.data_)){const o=this.data_,l=Cze(o,e,i);return l===null?null:new wg(l)}else{const o=new Uint8Array(this.data_.buffer,e,i-e);return new wg(o,!0)}}static getBlob(...e){if(M3()){const i=e.map(o=>o instanceof wg?o.data_:o);return new wg(Tze.apply(null,i))}else{const i=e.map(p=>L3(p)?Ize(Ep.RAW,p).data:p.data_);let o=0;i.forEach(p=>{o+=p.byteLength});const l=new Uint8Array(o);let u=0;return i.forEach(p=>{for(let y=0;y<p.length;y++)l[u++]=p[y]}),new wg(l,!0)}}uploadData(){return this.data_}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function tae(n){let e;try{e=JSON.parse(n)}catch{return null}return mze(e)?e:null}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Nze(n){if(n.length===0)return null;const e=n.lastIndexOf("/");return e===-1?"":n.slice(0,e)}function Dze(n,e){const i=e.split("/").filter(o=>o.length>0).join("/");return n.length===0?i:n+"/"+i}function nae(n){const e=n.lastIndexOf("/",n.length-2);return e===-1?n:n.slice(e+1)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function xze(n,e){return e}class Rc{constructor(e,i,o,l){this.server=e,this.local=i||e,this.writable=!!o,this.xform=l||xze}}let dk=null;function Lze(n){return!L3(n)||n.length<2?n:nae(n)}function rae(){if(dk)return dk;const n=[];n.push(new Rc("bucket")),n.push(new Rc("generation")),n.push(new Rc("metageneration")),n.push(new Rc("name","fullPath",!0));function e(u,p){return Lze(p)}const i=new Rc("name");i.xform=e,n.push(i);function o(u,p){return p!==void 0?Number(p):p}const l=new Rc("size");return l.xform=o,n.push(l),n.push(new Rc("timeCreated")),n.push(new Rc("updated")),n.push(new Rc("md5Hash",null,!0)),n.push(new Rc("cacheControl",null,!0)),n.push(new Rc("contentDisposition",null,!0)),n.push(new Rc("contentEncoding",null,!0)),n.push(new Rc("contentLanguage",null,!0)),n.push(new Rc("contentType",null,!0)),n.push(new Rc("metadata","customMetadata",!0)),dk=n,dk}function Mze(n,e){function i(){const o=n.bucket,l=n.fullPath,u=new tu(o,l);return e._makeStorageReference(u)}Object.defineProperty(n,"ref",{get:i})}function Uze(n,e,i){const o={};o.type="file";const l=i.length;for(let u=0;u<l;u++){const p=i[u];o[p.local]=p.xform(o,e[p.server])}return Mze(o,n),o}function iae(n,e,i){const o=tae(e);return o===null?null:Uze(n,o,i)}function Vze(n,e,i,o){const l=tae(e);if(l===null||!L3(l.downloadTokens))return null;const u=l.downloadTokens;if(u.length===0)return null;const p=encodeURIComponent;return u.split(",").map(w=>{const C=n.bucket,R=n.fullPath,N="/b/"+p(C)+"/o/"+p(R),M=QN(N,i,o),L=Joe({alt:"media",token:w});return M+L})[0]}function Fze(n,e){const i={},o=e.length;for(let l=0;l<o;l++){const u=e[l];u.writable&&(i[u.server]=n[u.local])}return JSON.stringify(i)}class U3{constructor(e,i,o,l){this.url=e,this.method=i,this.handler=o,this.timeout=l,this.urlParams={},this.headers={},this.body=null,this.errorHandler=null,this.progressCallback=null,this.successCodes=[200],this.additionalRetryCodes=[]}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function sae(n){if(!n)throw x3()}function jze(n,e){function i(o,l){const u=iae(n,l,e);return sae(u!==null),u}return i}function Bze(n,e){function i(o,l){const u=iae(n,l,e);return sae(u!==null),Vze(u,l,n.host,n._protocol)}return i}function oae(n){function e(i,o){let l;return i.getStatus()===401?i.getErrorText().includes("Firebase App Check token is invalid")?l=eze():l=Z6e():i.getStatus()===402?l=Q6e(n.bucket):i.getStatus()===403?l=tze(n.path):l=o,l.status=i.getStatus(),l.serverResponse=o.serverResponse,l}return e}function aae(n){const e=oae(n);function i(o,l){let u=e(o,l);return o.getStatus()===404&&(u=J6e(n.path)),u.serverResponse=l.serverResponse,u}return i}function zze(n,e,i){const o=e.fullServerUrl(),l=QN(o,n.host,n._protocol),u="GET",p=n.maxOperationRetryTime,y=new U3(l,u,Bze(n,i),p);return y.errorHandler=aae(e),y}function Wze(n,e){const i=e.fullServerUrl(),o=QN(i,n.host,n._protocol),l="DELETE",u=n.maxOperationRetryTime;function p(v,w){}const y=new U3(o,l,p,u);return y.successCodes=[200,204],y.errorHandler=aae(e),y}function Gze(n,e){return n&&n.contentType||e&&e.type()||"application/octet-stream"}function Hze(n,e,i){const o=Object.assign({},i);return o.fullPath=n.path,o.size=e.size(),o.contentType||(o.contentType=Gze(null,e)),o}function $ze(n,e,i,o,l){const u=e.bucketOnlyServerUrl(),p={"X-Goog-Upload-Protocol":"multipart"};function y(){let re="";for(let ce=0;ce<2;ce++)re=re+Math.random().toString().slice(2);return re}const v=y();p["Content-Type"]="multipart/related; boundary="+v;const w=Hze(e,o,l),C=Fze(w,i),R="--"+v+`\r
Content-Type: application/json; charset=utf-8\r
\r
`+C+`\r
--`+v+`\r
Content-Type: `+w.contentType+`\r
\r
`,N=`\r
--`+v+"--",M=wg.getBlob(R,o,N);if(M===null)throw aze();const L={name:w.fullPath},U=QN(u,n.host,n._protocol),z="POST",J=n.maxUploadRetryTime,q=new U3(U,z,jze(n,i),J);return q.urlParams=L,q.headers=p,q.body=M.uploadData(),q.errorHandler=oae(e),q}class Kze{constructor(){this.sent_=!1,this.xhr_=new XMLHttpRequest,this.initXhr(),this.errorCode_=Yy.NO_ERROR,this.sendPromise_=new Promise(e=>{this.xhr_.addEventListener("abort",()=>{this.errorCode_=Yy.ABORT,e()}),this.xhr_.addEventListener("error",()=>{this.errorCode_=Yy.NETWORK_ERROR,e()}),this.xhr_.addEventListener("load",()=>{e()})})}send(e,i,o,l){if(this.sent_)throw KT("cannot .send() more than once");if(this.sent_=!0,this.xhr_.open(i,e,!0),l!==void 0)for(const u in l)l.hasOwnProperty(u)&&this.xhr_.setRequestHeader(u,l[u].toString());return o!==void 0?this.xhr_.send(o):this.xhr_.send(),this.sendPromise_}getErrorCode(){if(!this.sent_)throw KT("cannot .getErrorCode() before sending");return this.errorCode_}getStatus(){if(!this.sent_)throw KT("cannot .getStatus() before sending");try{return this.xhr_.status}catch{return-1}}getResponse(){if(!this.sent_)throw KT("cannot .getResponse() before sending");return this.xhr_.response}getErrorText(){if(!this.sent_)throw KT("cannot .getErrorText() before sending");return this.xhr_.statusText}abort(){this.xhr_.abort()}getResponseHeader(e){return this.xhr_.getResponseHeader(e)}addUploadProgressListener(e){this.xhr_.upload!=null&&this.xhr_.upload.addEventListener("progress",e)}removeUploadProgressListener(e){this.xhr_.upload!=null&&this.xhr_.upload.removeEventListener("progress",e)}}class qze extends Kze{initXhr(){this.xhr_.responseType="text"}}function V3(){return new qze}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class oE{constructor(e,i){this._service=e,i instanceof tu?this._location=i:this._location=tu.makeFromUrl(i,e.host)}toString(){return"gs://"+this._location.bucket+"/"+this._location.path}_newRef(e,i){return new oE(e,i)}get root(){const e=new tu(this._location.bucket,"");return this._newRef(this._service,e)}get bucket(){return this._location.bucket}get fullPath(){return this._location.path}get name(){return nae(this._location.path)}get storage(){return this._service}get parent(){const e=Nze(this._location.path);if(e===null)return null;const i=new tu(this._location.bucket,e);return new oE(this._service,i)}_throwIfRoot(e){if(this._location.path==="")throw uze(e)}}function Yze(n,e,i){n._throwIfRoot("uploadBytes");const o=$ze(n.storage,n._location,rae(),new wg(e,!0),i);return n.storage.makeRequestWithTokens(o,V3).then(l=>({metadata:l,ref:n}))}function Xze(n){n._throwIfRoot("getDownloadURL");const e=zze(n.storage,n._location,rae());return n.storage.makeRequestWithTokens(e,V3).then(i=>{if(i===null)throw cze();return i})}function Jze(n){n._throwIfRoot("deleteObject");const e=Wze(n.storage,n._location);return n.storage.makeRequestWithTokens(e,V3)}function Qze(n,e){const i=Dze(n._location.path,e),o=new tu(n._location.bucket,i);return new oE(n.storage,o)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Zze(n){return/^[A-Za-z]+:\/\//.test(n)}function e8e(n,e){return new oE(n,e)}function cae(n,e){if(n instanceof F3){const i=n;if(i._bucket==null)throw oze();const o=new oE(i,i._bucket);return e!=null?cae(o,e):o}else return e!==void 0?Qze(n,e):n}function t8e(n,e){if(e&&Zze(e)){if(n instanceof F3)return e8e(n,e);throw VF("To use ref(service, url), the first argument must be a Storage instance.")}else return cae(n,e)}function BQ(n,e){const i=e==null?void 0:e[Yoe];return i==null?null:tu.makeFromBucketSpec(i,n)}function n8e(n,e,i,o={}){n.host=`${e}:${i}`,n._protocol="http";const{mockUserToken:l}=o;l&&(n._overrideAuthToken=typeof l=="string"?l:Sie(l,n.app.options.projectId))}class F3{constructor(e,i,o,l,u){this.app=e,this._authProvider=i,this._appCheckProvider=o,this._url=l,this._firebaseVersion=u,this._bucket=null,this._host=qoe,this._protocol="https",this._appId=null,this._deleted=!1,this._maxOperationRetryTime=Y6e,this._maxUploadRetryTime=X6e,this._requests=new Set,l!=null?this._bucket=tu.makeFromBucketSpec(l,this._host):this._bucket=BQ(this._host,this.app.options)}get host(){return this._host}set host(e){this._host=e,this._url!=null?this._bucket=tu.makeFromBucketSpec(this._url,e):this._bucket=BQ(e,this.app.options)}get maxUploadRetryTime(){return this._maxUploadRetryTime}set maxUploadRetryTime(e){jQ("time",0,Number.POSITIVE_INFINITY,e),this._maxUploadRetryTime=e}get maxOperationRetryTime(){return this._maxOperationRetryTime}set maxOperationRetryTime(e){jQ("time",0,Number.POSITIVE_INFINITY,e),this._maxOperationRetryTime=e}async _getAuthToken(){if(this._overrideAuthToken)return this._overrideAuthToken;const e=this._authProvider.getImmediate({optional:!0});if(e){const i=await e.getToken();if(i!==null)return i.accessToken}return null}async _getAppCheckToken(){if(dl(this.app)&&this.app.settings.appCheckToken)return this.app.settings.appCheckToken;const e=this._appCheckProvider.getImmediate({optional:!0});return e?(await e.getToken()).token:null}_delete(){return this._deleted||(this._deleted=!0,this._requests.forEach(e=>e.cancel()),this._requests.clear()),Promise.resolve()}_makeStorageReference(e){return new oE(this,e)}_makeRequest(e,i,o,l,u=!0){if(this._deleted)return new dze(Xoe());{const p=bze(e,this._appId,o,l,i,this._firebaseVersion,u);return this._requests.add(p),p.getPromise().then(()=>this._requests.delete(p),()=>this._requests.delete(p)),p}}async makeRequestWithTokens(e,i){const[o,l]=await Promise.all([this._getAuthToken(),this._getAppCheckToken()]);return this._makeRequest(e,i,o,l).getPromise()}}const zQ="@firebase/storage",WQ="0.13.7";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const lae="storage";function j3(n,e,i){return n=Pi(n),Yze(n,e,i)}function ZN(n){return n=Pi(n),Xze(n)}function B3(n){return n=Pi(n),Jze(n)}function mE(n,e){return n=Pi(n),t8e(n,e)}function gE(n=wN(),e){n=Pi(n);const o=WR(n,lae).getImmediate({identifier:e}),l=N5("storage");return l&&r8e(o,...l),o}function r8e(n,e,i,o={}){n8e(n,e,i,o)}function i8e(n,{instanceIdentifier:e}){const i=n.getProvider("app").getImmediate(),o=n.getProvider("auth-internal"),l=n.getProvider("app-check-internal");return new F3(i,o,l,e,uE)}function s8e(){Vg(new Hf(lae,i8e,"PUBLIC").setMultipleInstances(!0)),nd(zQ,WQ,""),nd(zQ,WQ,"esm2017")}s8e();const qk=async n=>{const e=gE(),i=mE(e,n);try{return await ZN(i)}catch(o){throw K.error("Failed to fetch HTTP URL from gs:// URL:","/src/packages/shared/firebase/firebaseStorage.js",o),o}};let FF={};const sd=async n=>{try{const e=wr(Yn,"spaces",n),i=await Bo(e);if(i.exists()){let o=i.data();const l=o.name,u=o.description;if(o.webglBuildId){const p=wr(Yn,"webglBuilds",o.webglBuildId),y=await Bo(p);if(y.exists()){const v=y.data();o={...o,...v,name:l||v.name,description:u||v.description}}else K.warn(`spacesFirestore: No document found for webglBuildId: ${o.webglBuildId}`)}return o=await o8e(o),o=a8e(o),console.log("Space data:",o),K.log(`spacesFirestore: Caching space data for: ${n}`),FF[n]=o,o}else return K.warn(`spacesFirestore: No document found for item ID: ${n}`),null}catch(e){throw K.error("spacesFirestore: Error fetching item data:",e),e}},o8e=async n=>{const i=["gsUrlCode","gsUrlData","gsUrlFramework","gsUrlLoader","gsUrlLoadingBackground"].map(async o=>{const l=n[o];l&&l.startsWith("gs://")&&(n[o]=await qk(l))});return await Promise.all(i),n},a8e=n=>{const{gsUrlCode:e,gsUrlData:i,gsUrlFramework:o,gsUrlLoader:l,...u}=n;return{...u,codeUrl:e,dataUrl:i,frameworkUrl:o,loaderUrl:l}};let aV={};const uae=async n=>{K.log("spacesFirestore: Get Videos from Firestore for space: ",n);try{if(aV[n])return K.log("spacesFirestore: Returning cached videos for space:",n),aV[n];const e=El(Yn,`spaces/${n}/videos`),i=await id(e),o=[];return i.forEach(l=>{o.push({id:l.id,...l.data()})}),aV[n]=o,o}catch(e){throw K.error("spacesFirestore: Error fetching Space videos from Firestore:",e),e}},c8e=async(n,e)=>{try{if(!n||!e)throw new Error("Missing required parameters: spaceId and logoFile");if(!e.type.startsWith("image/"))throw new Error("File must be an image");const i=gE(),o=Date.now(),l=e.name.split(".").pop(),u=`logo_${o}.${l}`,p=mE(i,`spaces/${n}/logo/${u}`);K.log(`Uploading logo for space ${n}`);const y=await j3(p,e),v=await ZN(y.ref),w=wr(Yn,"spaces",n);return await lo(w,{logoUrl:v,logoGsUrl:`gs://${y.ref.bucket}/${y.ref.fullPath}`,logoFileName:u,updatedAt:new Date().toISOString()}),K.log(`Successfully uploaded logo for space ${n}`),v}catch(i){throw K.error("Error uploading space logo:",i),i}},l8e=async n=>{try{const e=wr(Yn,"spaces",n),i=await Bo(e);if(!i.exists())return K.warn(`No space found with ID: ${n}`),!1;const o=i.data();if(o.logoGsUrl){const l=gE(),u=mE(l,o.logoGsUrl);try{await B3(u),K.log(`Deleted logo file from storage: ${o.logoGsUrl}`)}catch(p){K.warn(`Could not delete logo file from storage: ${p.message}`)}}return await lo(e,{logoUrl:null,logoGsUrl:null,logoFileName:null,updatedAt:new Date().toISOString()}),K.log(`Successfully removed logo for space ${n}`),!0}catch(e){throw K.error("Error deleting space logo:",e),e}},u8e=async(n,e)=>{try{if(!n||!e)throw new Error("Missing required parameters: spaceId and backgroundFile");if(!e.type.startsWith("image/"))throw new Error("File must be an image");const i=gE(),o=Date.now(),l=e.name.split(".").pop(),u=`background_${o}.${l}`,p=mE(i,`spaces/${n}/background/${u}`);K.log(`Uploading background for space ${n}`);const y=await j3(p,e),v=await ZN(y.ref),w=wr(Yn,"spaces",n);return await lo(w,{backgroundUrl:v,backgroundGsUrl:`gs://${y.ref.bucket}/${y.ref.fullPath}`,backgroundFileName:u,gsUrlLoadingBackground:`gs://${y.ref.bucket}/${y.ref.fullPath}`,updatedAt:new Date().toISOString()}),K.log(`Successfully uploaded background for space ${n}`),v}catch(i){throw K.error("Error uploading space background:",i),i}},d8e=async n=>{try{const e=wr(Yn,"spaces",n),i=await Bo(e);if(!i.exists())return K.warn(`No space found with ID: ${n}`),!1;const o=i.data();if(o.backgroundGsUrl){const l=gE(),u=mE(l,o.backgroundGsUrl);try{await B3(u),K.log(`Deleted background file from storage: ${o.backgroundGsUrl}`)}catch(p){K.warn(`Could not delete background file from storage: ${p.message}`)}}return await lo(e,{backgroundUrl:null,backgroundGsUrl:null,backgroundFileName:null,gsUrlLoadingBackground:null,updatedAt:new Date().toISOString()}),K.log(`Successfully removed background for space ${n}`),!0}catch(e){throw K.error("Error deleting space background:",e),e}},h8e=async(n,e)=>{try{if(!n||!e||!e.uid)throw new Error("Missing required parameters");const i=wr(Yn,`spaces/${n}/BannedUsers`,e.uid),o=Object.entries({...e,bannedAt:e.bannedAt||new Date().toISOString()}).reduce((l,[u,p])=>(p!==void 0&&(l[u]=p),l),{});await Hg(i,o);try{const l=wr(Yn,"users",e.uid),u=await Bo(l);if(u.exists()){const p=u.data(),y=Array.isArray(p.groups)?p.groups:[],v=`space_${n}_banned`;y.includes(v)||await lo(l,{groups:[...y,v]})}}catch(l){K.error("spacesFirestore: failed to add banned group to user",l)}return K.log(`spacesFirestore: Added banned user ${e.uid} to space ${n}`),!0}catch(i){throw K.error("spacesFirestore: Error adding banned user:",i),i}},z3=async(n,e)=>{try{K.log(`spacesFirestore: Updating settings for space: ${n}`,e);const i=wr(Yn,"spaces",n);return await lo(i,{...e,updatedAt:new Date().toISOString()}),FF[n]&&delete FF[n],!0}catch(i){throw K.error("spacesFirestore: Error updating space settings:",i),i}},p8e=async(n,e)=>z3(n,{accessibleToAllUsers:e}),jF=async(n,e)=>z3(n,{HLSStreamURL:e}),dae=async n=>{try{const e=wr(Yn,"spaces",n),i=await Bo(e);return i.exists()&&i.data().HLSStreamURL||null}catch(e){throw K.error("spacesFirestore: Error getting HLS stream:",e),e}},f8e=async(n,e)=>(K.warn("uploadSpaceVideoBackground: Not implemented in simplified stub."),null),m8e=async n=>(K.warn("deleteSpaceVideoBackground: Not implemented in simplified stub."),null),Zi=O.createContext(null),hae=O.createContext(null),eD=({children:n})=>{const[e,i]=O.useState(null),o=O.useRef(null),[l,u]=O.useState(!0),[p,y]=O.useState(!1),v=IN(),w=pe=>pe?pe.Nickname?pe.Nickname:`${pe.firstName} ${pe.lastName}`:"Anon";O.useEffect(()=>{const pe=Wje(v,async H=>{if(K.log("UserProvider: Firebase onAuthStateChanged() fired"),H)try{const X=await su(H.uid),Q=w(X),ne={uid:H.uid,email:H.email,emailVerified:H.emailVerified,...X,displayName:Q};K.log(`UserProvider: User authenticated: ${H.uid}`),i(ne),o.current=ne,M(ne)}catch(X){K.error("UserProvider: Error fetching user profile data:",X)}else i(null),o.current=null;u(!1)});return()=>{pe&&pe()}},[]);const C=async(pe,H,X)=>{try{y(!0),K.log("UserProvider: Starting registration process"),K.log("UserProvider: Registration includes fields:",Object.keys(X||{}).join(", "));const Q={...X},ne=["firstName","lastName","username","companyName","linkedInProfile"],he=ne.filter(we=>!Q[we]);he.length>0&&K.warn(`UserProvider: Registration missing fields: ${he.join(", ")}`);const fe=Q.firstName&&Q.lastName?`${Q.firstName}${Q.lastName.charAt(0).toUpperCase()}`:"";K.log("UserProvider: Generated default nickname for registration");const de={firstName:"",lastName:"",companyName:"",linkedInProfile:"",username:"",Nickname:Q.Nickname||fe,groups:["users"],rpmURL:"https://models.readyplayer.me/67c8408d38f7924e15a8bd0a.glb",...Q};K.log("UserProvider: Prepared registration data with fields:",Object.keys(de).join(", "));const ke=await j6e(pe,H,de);K.log("UserProvider: Registration successful, received user data");const De=ne.filter(we=>!ke[we]);De.length>0&&K.warn(`UserProvider: Returned user data missing fields: ${De.join(", ")}`),["firstName","lastName","Nickname","username","companyName"].forEach(we=>{ke[we]||(K.warn(`UserProvider: ${we} is missing in returned data, using original value`),ke[we]=de[we])});const Te={uid:ke.uid,email:ke.email,...ke,displayName:w(ke)};return K.log("UserProvider: Created user object with fields:",Object.keys(Te).join(", ")),i(Te),o.current=Te,K.log("UserProvider: User registered successfully with groups:",de.groups),await new Promise(we=>setTimeout(we,2e3)),y(!1),Te}catch(Q){throw y(!1),K.error("UserProvider: Error during registration:",Q),Q}},R=async(pe,H,X)=>{try{if(K.log("UserProvider: Signing in user"),!X)throw new Error("CAPTCHA verification is required");const ne=(await jje(v,pe,H)).user;return K.log("UserProvider: User signed in successfully:",ne.email),ne}catch(Q){throw K.error("UserProvider: Error signing in:",Q),Q}},N=async()=>{try{await Gje(v),i(null),K.log("UserProvider: User signed out.")}catch(pe){throw K.error("UserProvider: Error signing out:",pe),pe}},M=()=>{const pe=o.current;if(pe){const H=L(pe);K.log("UserProvider: sendUserToUnity() using the eventBus",H),lh.publish(ch.sendUserToUnity,H)}else K.log("UserProvider: No current user to send to Unity.")},L=pe=>{const H={};return[...K6e,"uid"].forEach(Q=>{pe.hasOwnProperty(Q)&&(H[Q]=pe[Q])}),H},U=async pe=>!e||!e.uid?!1:await Koe(e.uid,pe),z=async pe=>{try{return!e||!e.uid?!1:e.groups&&e.groups.includes(`space_${pe}_banned`)?!0:(await Bo(wr(Yn,`spaces/${pe}/BannedUsers`,e.uid))).exists()}catch(H){return H.code!=="permission-denied"&&K.error("UserProvider: isUserBannedFromSpace error:",H),!1}},J=async pe=>{if(!e||!e.uid)return!1;try{if(await z(pe))return K.warn(`UserProvider: User ${e.uid} banned from ${pe}`),!1;const H=await sd(pe);if(H.usersAllowed.includes(e.uid)||H.userAdmin.includes(e.uid)||H.usersModerators.includes(e.uid))return!0;if(e.groups&&Array.isArray(e.groups)){const Q=`space_${pe}_owners`,ne=`space_${pe}_hosts`;if(e.groups.includes(Q)||e.groups.includes(ne))return K.log(`UserProvider: User ${e.uid} has access to space ${pe} as owner/host`),!0}return H.accessibleToAllUsers===!0&&e.groups?e.groups.includes("users"):!1}catch(H){return K.error("UserProvider: Error verifying user access to space:",H),!1}},q=async pe=>{if(!e||!e.uid)return!1;try{return(await sd(pe)).userAdmin.includes(e.uid)}catch(H){return K.error("UserProvider: Error verifying user admin status for space:",H),!1}},re=async pe=>{if(!e||!e.uid)return!1;try{return(await sd(pe)).usersModerators.includes(e.uid)}catch(H){return K.error("UserProvider: Error verifying user moderator status for space:",H),!1}},ce=async()=>{try{const pe=v.currentUser;return pe&&!pe.emailVerified?(await Zie(pe),K.log("UserProvider: Verification email resent to:",pe.email),!0):!1}catch(pe){throw K.error("UserProvider: Error resending verification email:",pe),pe}},ae=async()=>{try{const pe=v.currentUser;if(!pe)return K.warn("UserProvider: updateUser called but no current user exists"),null;K.log("UserProvider: Updating user data from Firestore");const H=await su(pe.uid);if(!H)return K.error("UserProvider: Failed to fetch updated user profile"),null;const X=w(H),Q={uid:pe.uid,email:pe.email,emailVerified:pe.emailVerified,...H,displayName:X};return K.log("UserProvider: User data updated with fields:",Object.keys(Q).join(", ")),i(Q),o.current=Q,M(Q),Q}catch(pe){throw K.error("UserProvider: Error updating user data:",pe),pe}};return S.jsx(hae.Provider,{value:{registrationInProgress:p},children:S.jsx(Zi.Provider,{value:{user:e,loading:l,register:C,signIn:R,signOut:N,sendUserToUnity:M,isUserInGroup:U,userHasAccessToSpace:J,userIsAdminOfSpace:q,userIsModeratorOfSpace:re,resendVerificationEmail:ce,updateUser:ae,isUserBannedFromSpace:z},children:n})})},g8e=()=>{const n=O.useContext(hae);if(n===void 0)throw new Error("useRegistration must be used within a UserProvider");return n},pae=O.createContext(),fh=()=>O.useContext(pae),W3=({children:n})=>{const[e,i]=O.useState(!1),o=O.useRef(null),[l,u]=O.useState(!1);O.useEffect(()=>{const v=()=>{const w=/iPhone|iPad|iPod|Android/i.test(navigator.userAgent);u(w)};return v(),window.addEventListener("resize",v),()=>window.removeEventListener("resize",v)},[]);const p=O.useCallback(v=>{o.current=v},[]),y=O.useCallback(()=>{const v=o.current;if(!v)return;const w=document.fullscreenElement||document.webkitFullscreenElement||document.mozFullScreenElement||document.msFullscreenElement;if(l){console.log("Attempting mobile fullscreen...");const C=v.querySelector("video")||v;if(/iPhone|iPad|iPod/i.test(navigator.userAgent)){if(C.webkitEnterFullscreen)try{C.webkitEnterFullscreen(),i(!0);return}catch(R){console.error("iOS fullscreen error:",R)}try{if(C.webkitRequestFullscreen){C.webkitRequestFullscreen(),i(!0);return}}catch(R){console.error("iOS fallback fullscreen error:",R)}}if(/Android/i.test(navigator.userAgent))try{w?(document.exitFullscreen?document.exitFullscreen():document.webkitExitFullscreen?document.webkitExitFullscreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.msExitFullscreen&&document.msExitFullscreen(),i(!1)):(v.requestFullscreen?v.requestFullscreen():v.webkitRequestFullscreen?v.webkitRequestFullscreen():v.mozRequestFullScreen?v.mozRequestFullScreen():v.msRequestFullscreen&&v.msRequestFullscreen(),i(!0));return}catch(R){console.error("Android fullscreen error:",R)}}try{w?document.exitFullscreen?document.exitFullscreen().then(()=>{i(!1)}).catch(C=>console.error("Error exiting fullscreen:",C)):document.webkitExitFullscreen?(document.webkitExitFullscreen(),i(!1)):document.mozCancelFullScreen?(document.mozCancelFullScreen(),i(!1)):document.msExitFullscreen&&(document.msExitFullscreen(),i(!1)):v.requestFullscreen?v.requestFullscreen().then(()=>{i(!0)}).catch(C=>console.error("Error entering fullscreen:",C)):v.webkitRequestFullscreen?(v.webkitRequestFullscreen(),i(!0)):v.mozRequestFullScreen?(v.mozRequestFullScreen(),i(!0)):v.msRequestFullscreen&&(v.msRequestFullscreen(),i(!0))}catch(C){console.error("Fullscreen error:",C)}},[l]);return O.useEffect(()=>{const v=()=>{const w=document.fullscreenElement||document.webkitFullscreenElement||document.mozFullScreenElement||document.msFullscreenElement;i(!!w)};return document.addEventListener("fullscreenchange",v),document.addEventListener("webkitfullscreenchange",v),document.addEventListener("mozfullscreenchange",v),document.addEventListener("MSFullscreenChange",v),()=>{document.removeEventListener("fullscreenchange",v),document.removeEventListener("webkitfullscreenchange",v),document.removeEventListener("mozfullscreenchange",v),document.removeEventListener("MSFullscreenChange",v)}},[]),S.jsx(pae.Provider,{value:{isFullscreen:e,toggleFullscreen:y,fullscreenRef:o,setFullscreenRef:p,isMobile:l},children:S.jsx("div",{ref:p,style:{position:"relative",zIndex:1,width:"100%",height:"100%",overflow:"hidden"},children:n})})},_8e=qg({d:"M0,12a1.5,1.5,0,0,0,1.5,1.5h8.75a.25.25,0,0,1,.25.25V22.5a1.5,1.5,0,0,0,3,0V13.75a.25.25,0,0,1,.25-.25H22.5a1.5,1.5,0,0,0,0-3H13.75a.25.25,0,0,1-.25-.25V1.5a1.5,1.5,0,0,0-3,0v8.75a.25.25,0,0,1-.25.25H1.5A1.5,1.5,0,0,0,0,12Z",displayName:"AddIcon"}),y8e=qg({viewBox:"0 0 14 14",d:"M14,7.77 L14,6.17 L12.06,5.53 L11.61,4.44 L12.49,2.6 L11.36,1.47 L9.55,2.38 L8.46,1.93 L7.77,0.01 L6.17,0.01 L5.54,1.95 L4.43,2.4 L2.59,1.52 L1.46,2.65 L2.37,4.46 L1.92,5.55 L0,6.23 L0,7.82 L1.94,8.46 L2.39,9.55 L1.51,11.39 L2.64,12.52 L4.45,11.61 L5.54,12.06 L6.23,13.98 L7.82,13.98 L8.45,12.04 L9.56,11.59 L11.4,12.47 L12.53,11.34 L11.61,9.53 L12.08,8.44 L14,7.75 L14,7.77 Z M7,10 C5.34,10 4,8.66 4,7 C4,5.34 5.34,4 7,4 C8.66,4 10,5.34 10,7 C10,8.66 8.66,10 7,10 Z",displayName:"SettingsIcon"}),E8e=qg({d:"M19.5,9.5h-.75V6.75a6.75,6.75,0,0,0-13.5,0V9.5H4.5a2,2,0,0,0-2,2V22a2,2,0,0,0,2,2h15a2,2,0,0,0,2-2V11.5A2,2,0,0,0,19.5,9.5Zm-9.5,6a2,2,0,1,1,3,1.723V19.5a1,1,0,0,1-2,0V17.223A1.994,1.994,0,0,1,10,15.5ZM7.75,6.75a4.25,4.25,0,0,1,8.5,0V9a.5.5,0,0,1-.5.5H8.25a.5.5,0,0,1-.5-.5Z",displayName:"LockIcon"}),fae=qg({displayName:"ChevronDownIcon",d:"M16.59 8.59L12 13.17 7.41 8.59 6 10l6 6 6-6z"}),GQ=qg({displayName:"EmailIcon",path:S.jsxs("g",{fill:"currentColor",children:[S.jsx("path",{d:"M11.114,14.556a1.252,1.252,0,0,0,1.768,0L22.568,4.87a.5.5,0,0,0-.281-.849A1.966,1.966,0,0,0,22,4H2a1.966,1.966,0,0,0-.289.021.5.5,0,0,0-.281.849Z"}),S.jsx("path",{d:"M23.888,5.832a.182.182,0,0,0-.2.039l-6.2,6.2a.251.251,0,0,0,0,.354l5.043,5.043a.75.75,0,1,1-1.06,1.061l-5.043-5.043a.25.25,0,0,0-.354,0l-2.129,2.129a2.75,2.75,0,0,1-3.888,0L7.926,13.488a.251.251,0,0,0-.354,0L2.529,18.531a.75.75,0,0,1-1.06-1.061l5.043-5.043a.251.251,0,0,0,0-.354l-6.2-6.2a.18.18,0,0,0-.2-.039A.182.182,0,0,0,0,6V18a2,2,0,0,0,2,2H22a2,2,0,0,0,2-2V6A.181.181,0,0,0,23.888,5.832Z"})]})}),v8e=qg({displayName:"CloseIcon",d:"M.439,21.44a1.5,1.5,0,0,0,2.122,2.121L11.823,14.3a.25.25,0,0,1,.354,0l9.262,9.263a1.5,1.5,0,1,0,2.122-2.121L14.3,12.177a.25.25,0,0,1,0-.354l9.263-9.262A1.5,1.5,0,0,0,21.439.44L12.177,9.7a.25.25,0,0,1-.354,0L2.561.44A1.5,1.5,0,0,0,.439,2.561L9.7,11.823a.25.25,0,0,1,0,.354Z"}),S8e=qg({displayName:"QuestionOutlineIcon",path:S.jsxs("g",{stroke:"currentColor",strokeWidth:"1.5",children:[S.jsx("path",{strokeLinecap:"round",fill:"none",d:"M9,9a3,3,0,1,1,4,2.829,1.5,1.5,0,0,0-1,1.415V14.25"}),S.jsx("path",{fill:"none",strokeLinecap:"round",d:"M12,17.25a.375.375,0,1,0,.375.375A.375.375,0,0,0,12,17.25h0"}),S.jsx("circle",{fill:"none",strokeMiterlimit:"10",cx:"12",cy:"12",r:"11.25"})]})}),b8e=qg({displayName:"HamburgerIcon",viewBox:"0 0 24 24",d:"M 3 5 A 1.0001 1.0001 0 1 0 3 7 L 21 7 A 1.0001 1.0001 0 1 0 21 5 L 3 5 z M 3 11 A 1.0001 1.0001 0 1 0 3 13 L 21 13 A 1.0001 1.0001 0 1 0 21 11 L 3 11 z M 3 17 A 1.0001 1.0001 0 1 0 3 19 L 21 19 A 1.0001 1.0001 0 1 0 21 17 L 3 17 z"});var eI=n=>n.type==="checkbox",My=n=>n instanceof Date,Ac=n=>n==null;const mae=n=>typeof n=="object";var ao=n=>!Ac(n)&&!Array.isArray(n)&&mae(n)&&!My(n),w8e=n=>ao(n)&&n.target?eI(n.target)?n.target.checked:n.target.value:n,T8e=n=>n.substring(0,n.search(/\.\d+(\.|$)/))||n,C8e=(n,e)=>n.has(T8e(e)),R8e=n=>{const e=n.constructor&&n.constructor.prototype;return ao(e)&&e.hasOwnProperty("isPrototypeOf")},G3=typeof window<"u"&&typeof window.HTMLElement<"u"&&typeof document<"u";function Xu(n){let e;const i=Array.isArray(n),o=typeof FileList<"u"?n instanceof FileList:!1;if(n instanceof Date)e=new Date(n);else if(n instanceof Set)e=new Set(n);else if(!(G3&&(n instanceof Blob||o))&&(i||ao(n)))if(e=i?[]:{},!i&&!R8e(n))e=n;else for(const l in n)n.hasOwnProperty(l)&&(e[l]=Xu(n[l]));else return n;return e}var tD=n=>Array.isArray(n)?n.filter(Boolean):[],_o=n=>n===void 0,gn=(n,e,i)=>{if(!e||!ao(n))return i;const o=tD(e.split(/[,[\].]+?/)).reduce((l,u)=>Ac(l)?l:l[u],n);return _o(o)||o===n?_o(n[e])?i:n[e]:o},lp=n=>typeof n=="boolean",H3=n=>/^\w*$/.test(n),gae=n=>tD(n.replace(/["|']|\]/g,"").split(/\.|\[/)),as=(n,e,i)=>{let o=-1;const l=H3(e)?[e]:gae(e),u=l.length,p=u-1;for(;++o<u;){const y=l[o];let v=i;if(o!==p){const w=n[y];v=ao(w)||Array.isArray(w)?w:isNaN(+l[o+1])?{}:[]}if(y==="__proto__"||y==="constructor"||y==="prototype")return;n[y]=v,n=n[y]}return n};const HQ={BLUR:"blur",FOCUS_OUT:"focusout"},ah={onBlur:"onBlur",onChange:"onChange",onSubmit:"onSubmit",onTouched:"onTouched",all:"all"},bf={max:"max",min:"min",maxLength:"maxLength",minLength:"minLength",pattern:"pattern",required:"required",validate:"validate"};bi.createContext(null);var I8e=(n,e,i,o=!0)=>{const l={defaultValues:e._defaultValues};for(const u in n)Object.defineProperty(l,u,{get:()=>{const p=u;return e._proxyFormState[p]!==ah.all&&(e._proxyFormState[p]=!o||ah.all),n[p]}});return l},cl=n=>ao(n)&&!Object.keys(n).length,A8e=(n,e,i,o)=>{i(n);const{name:l,...u}=n;return cl(u)||Object.keys(u).length>=Object.keys(e).length||Object.keys(u).find(p=>e[p]===ah.all)},Yk=n=>Array.isArray(n)?n:[n];function P8e(n){const e=bi.useRef(n);e.current=n,bi.useEffect(()=>{const i=!n.disabled&&e.current.subject&&e.current.subject.subscribe({next:e.current.next});return()=>{i&&i.unsubscribe()}},[n.disabled])}var vp=n=>typeof n=="string",k8e=(n,e,i,o,l)=>vp(n)?(o&&e.watch.add(n),gn(i,n,l)):Array.isArray(n)?n.map(u=>(o&&e.watch.add(u),gn(i,u))):(o&&(e.watchAll=!0),i),O8e=(n,e,i,o,l)=>e?{...i[n],types:{...i[n]&&i[n].types?i[n].types:{},[o]:l||!0}}:{},$Q=n=>({isOnSubmit:!n||n===ah.onSubmit,isOnBlur:n===ah.onBlur,isOnChange:n===ah.onChange,isOnAll:n===ah.all,isOnTouch:n===ah.onTouched}),KQ=(n,e,i)=>!i&&(e.watchAll||e.watch.has(n)||[...e.watch].some(o=>n.startsWith(o)&&/^\.\w+/.test(n.slice(o.length))));const WC=(n,e,i,o)=>{for(const l of i||Object.keys(n)){const u=gn(n,l);if(u){const{_f:p,...y}=u;if(p){if(p.refs&&p.refs[0]&&e(p.refs[0],l)&&!o)return!0;if(p.ref&&e(p.ref,p.name)&&!o)return!0;if(WC(y,e))break}else if(ao(y)&&WC(y,e))break}}};var N8e=(n,e,i)=>{const o=Yk(gn(n,i));return as(o,"root",e[i]),as(n,i,o),n},$3=n=>n.type==="file",gp=n=>typeof n=="function",FO=n=>{if(!G3)return!1;const e=n?n.ownerDocument:0;return n instanceof(e&&e.defaultView?e.defaultView.HTMLElement:HTMLElement)},Xk=n=>vp(n),K3=n=>n.type==="radio",jO=n=>n instanceof RegExp;const qQ={value:!1,isValid:!1},YQ={value:!0,isValid:!0};var _ae=n=>{if(Array.isArray(n)){if(n.length>1){const e=n.filter(i=>i&&i.checked&&!i.disabled).map(i=>i.value);return{value:e,isValid:!!e.length}}return n[0].checked&&!n[0].disabled?n[0].attributes&&!_o(n[0].attributes.value)?_o(n[0].value)||n[0].value===""?YQ:{value:n[0].value,isValid:!0}:YQ:qQ}return qQ};const XQ={isValid:!1,value:null};var yae=n=>Array.isArray(n)?n.reduce((e,i)=>i&&i.checked&&!i.disabled?{isValid:!0,value:i.value}:e,XQ):XQ;function JQ(n,e,i="validate"){if(Xk(n)||Array.isArray(n)&&n.every(Xk)||lp(n)&&!n)return{type:i,message:Xk(n)?n:"",ref:e}}var O0=n=>ao(n)&&!jO(n)?n:{value:n,message:""},QQ=async(n,e,i,o,l,u)=>{const{ref:p,refs:y,required:v,maxLength:w,minLength:C,min:R,max:N,pattern:M,validate:L,name:U,valueAsNumber:z,mount:J}=n._f,q=gn(i,U);if(!J||e.has(U))return{};const re=y?y[0]:p,ce=fe=>{l&&re.reportValidity&&(re.setCustomValidity(lp(fe)?"":fe||""),re.reportValidity())},ae={},pe=K3(p),H=eI(p),X=pe||H,Q=(z||$3(p))&&_o(p.value)&&_o(q)||FO(p)&&p.value===""||q===""||Array.isArray(q)&&!q.length,ne=O8e.bind(null,U,o,ae),he=(fe,de,ke,De=bf.maxLength,je=bf.minLength)=>{const Te=fe?de:ke;ae[U]={type:fe?De:je,message:Te,ref:p,...ne(fe?De:je,Te)}};if(u?!Array.isArray(q)||!q.length:v&&(!X&&(Q||Ac(q))||lp(q)&&!q||H&&!_ae(y).isValid||pe&&!yae(y).isValid)){const{value:fe,message:de}=Xk(v)?{value:!!v,message:v}:O0(v);if(fe&&(ae[U]={type:bf.required,message:de,ref:re,...ne(bf.required,de)},!o))return ce(de),ae}if(!Q&&(!Ac(R)||!Ac(N))){let fe,de;const ke=O0(N),De=O0(R);if(!Ac(q)&&!isNaN(q)){const je=p.valueAsNumber||q&&+q;Ac(ke.value)||(fe=je>ke.value),Ac(De.value)||(de=je<De.value)}else{const je=p.valueAsDate||new Date(q),Te=Oe=>new Date(new Date().toDateString()+" "+Oe),we=p.type=="time",Ie=p.type=="week";vp(ke.value)&&q&&(fe=we?Te(q)>Te(ke.value):Ie?q>ke.value:je>new Date(ke.value)),vp(De.value)&&q&&(de=we?Te(q)<Te(De.value):Ie?q<De.value:je<new Date(De.value))}if((fe||de)&&(he(!!fe,ke.message,De.message,bf.max,bf.min),!o))return ce(ae[U].message),ae}if((w||C)&&!Q&&(vp(q)||u&&Array.isArray(q))){const fe=O0(w),de=O0(C),ke=!Ac(fe.value)&&q.length>+fe.value,De=!Ac(de.value)&&q.length<+de.value;if((ke||De)&&(he(ke,fe.message,de.message),!o))return ce(ae[U].message),ae}if(M&&!Q&&vp(q)){const{value:fe,message:de}=O0(M);if(jO(fe)&&!q.match(fe)&&(ae[U]={type:bf.pattern,message:de,ref:p,...ne(bf.pattern,de)},!o))return ce(de),ae}if(L){if(gp(L)){const fe=await L(q,i),de=JQ(fe,re);if(de&&(ae[U]={...de,...ne(bf.validate,de.message)},!o))return ce(de.message),ae}else if(ao(L)){let fe={};for(const de in L){if(!cl(fe)&&!o)break;const ke=JQ(await L[de](q,i),re,de);ke&&(fe={...ke,...ne(de,ke.message)},ce(ke.message),o&&(ae[U]=fe))}if(!cl(fe)&&(ae[U]={ref:re,...fe},!o))return ae}}return ce(!0),ae};function D8e(n,e){const i=e.slice(0,-1).length;let o=0;for(;o<i;)n=_o(n)?o++:n[e[o++]];return n}function x8e(n){for(const e in n)if(n.hasOwnProperty(e)&&!_o(n[e]))return!1;return!0}function Do(n,e){const i=Array.isArray(e)?e:H3(e)?[e]:gae(e),o=i.length===1?n:D8e(n,i),l=i.length-1,u=i[l];return o&&delete o[u],l!==0&&(ao(o)&&cl(o)||Array.isArray(o)&&x8e(o))&&Do(n,i.slice(0,-1)),n}var cV=()=>{let n=[];return{get observers(){return n},next:l=>{for(const u of n)u.next&&u.next(l)},subscribe:l=>(n.push(l),{unsubscribe:()=>{n=n.filter(u=>u!==l)}}),unsubscribe:()=>{n=[]}}},BF=n=>Ac(n)||!mae(n);function Tg(n,e){if(BF(n)||BF(e))return n===e;if(My(n)&&My(e))return n.getTime()===e.getTime();const i=Object.keys(n),o=Object.keys(e);if(i.length!==o.length)return!1;for(const l of i){const u=n[l];if(!o.includes(l))return!1;if(l!=="ref"){const p=e[l];if(My(u)&&My(p)||ao(u)&&ao(p)||Array.isArray(u)&&Array.isArray(p)?!Tg(u,p):u!==p)return!1}}return!0}var Eae=n=>n.type==="select-multiple",L8e=n=>K3(n)||eI(n),lV=n=>FO(n)&&n.isConnected,vae=n=>{for(const e in n)if(gp(n[e]))return!0;return!1};function BO(n,e={}){const i=Array.isArray(n);if(ao(n)||i)for(const o in n)Array.isArray(n[o])||ao(n[o])&&!vae(n[o])?(e[o]=Array.isArray(n[o])?[]:{},BO(n[o],e[o])):Ac(n[o])||(e[o]=!0);return e}function Sae(n,e,i){const o=Array.isArray(n);if(ao(n)||o)for(const l in n)Array.isArray(n[l])||ao(n[l])&&!vae(n[l])?_o(e)||BF(i[l])?i[l]=Array.isArray(n[l])?BO(n[l],[]):{...BO(n[l])}:Sae(n[l],Ac(e)?{}:e[l],i[l]):i[l]=!Tg(n[l],e[l]);return i}var qT=(n,e)=>Sae(n,e,BO(e)),bae=(n,{valueAsNumber:e,valueAsDate:i,setValueAs:o})=>_o(n)?n:e?n===""?NaN:n&&+n:i&&vp(n)?new Date(n):o?o(n):n;function uV(n){const e=n.ref;return $3(e)?e.files:K3(e)?yae(n.refs).value:Eae(e)?[...e.selectedOptions].map(({value:i})=>i):eI(e)?_ae(n.refs).value:bae(_o(e.value)?n.ref.value:e.value,n)}var M8e=(n,e,i,o)=>{const l={};for(const u of n){const p=gn(e,u);p&&as(l,u,p._f)}return{criteriaMode:i,names:[...n],fields:l,shouldUseNativeValidation:o}},YT=n=>_o(n)?n:jO(n)?n.source:ao(n)?jO(n.value)?n.value.source:n.value:n;const ZQ="AsyncFunction";var U8e=n=>!!n&&!!n.validate&&!!(gp(n.validate)&&n.validate.constructor.name===ZQ||ao(n.validate)&&Object.values(n.validate).find(e=>e.constructor.name===ZQ)),V8e=n=>n.mount&&(n.required||n.min||n.max||n.maxLength||n.minLength||n.pattern||n.validate);function eZ(n,e,i){const o=gn(n,i);if(o||H3(i))return{error:o,name:i};const l=i.split(".");for(;l.length;){const u=l.join("."),p=gn(e,u),y=gn(n,u);if(p&&!Array.isArray(p)&&i!==u)return{name:i};if(y&&y.type)return{name:u,error:y};l.pop()}return{name:i}}var F8e=(n,e,i,o,l)=>l.isOnAll?!1:!i&&l.isOnTouch?!(e||n):(i?o.isOnBlur:l.isOnBlur)?!n:(i?o.isOnChange:l.isOnChange)?n:!0,j8e=(n,e)=>!tD(gn(n,e)).length&&Do(n,e);const B8e={mode:ah.onSubmit,reValidateMode:ah.onChange,shouldFocusError:!0};function z8e(n={}){let e={...B8e,...n},i={submitCount:0,isDirty:!1,isLoading:gp(e.defaultValues),isValidating:!1,isSubmitted:!1,isSubmitting:!1,isSubmitSuccessful:!1,isValid:!1,touchedFields:{},dirtyFields:{},validatingFields:{},errors:e.errors||{},disabled:e.disabled||!1},o={},l=ao(e.defaultValues)||ao(e.values)?Xu(e.defaultValues||e.values)||{}:{},u=e.shouldUnregister?{}:Xu(l),p={action:!1,mount:!1,watch:!1},y={mount:new Set,disabled:new Set,unMount:new Set,array:new Set,watch:new Set},v,w=0;const C={isDirty:!1,dirtyFields:!1,validatingFields:!1,touchedFields:!1,isValidating:!1,isValid:!1,errors:!1},R={values:cV(),array:cV(),state:cV()},N=$Q(e.mode),M=$Q(e.reValidateMode),L=e.criteriaMode===ah.all,U=Se=>Ne=>{clearTimeout(w),w=setTimeout(Se,Ne)},z=async Se=>{if(!e.disabled&&(C.isValid||Se)){const Ne=e.resolver?cl((await X()).errors):await ne(o,!0);Ne!==i.isValid&&R.state.next({isValid:Ne})}},J=(Se,Ne)=>{!e.disabled&&(C.isValidating||C.validatingFields)&&((Se||Array.from(y.mount)).forEach($e=>{$e&&(Ne?as(i.validatingFields,$e,Ne):Do(i.validatingFields,$e))}),R.state.next({validatingFields:i.validatingFields,isValidating:!cl(i.validatingFields)}))},q=(Se,Ne=[],$e,Pt,Ot=!0,Et=!0)=>{if(Pt&&$e&&!e.disabled){if(p.action=!0,Et&&Array.isArray(gn(o,Se))){const xt=$e(gn(o,Se),Pt.argA,Pt.argB);Ot&&as(o,Se,xt)}if(Et&&Array.isArray(gn(i.errors,Se))){const xt=$e(gn(i.errors,Se),Pt.argA,Pt.argB);Ot&&as(i.errors,Se,xt),j8e(i.errors,Se)}if(C.touchedFields&&Et&&Array.isArray(gn(i.touchedFields,Se))){const xt=$e(gn(i.touchedFields,Se),Pt.argA,Pt.argB);Ot&&as(i.touchedFields,Se,xt)}C.dirtyFields&&(i.dirtyFields=qT(l,u)),R.state.next({name:Se,isDirty:fe(Se,Ne),dirtyFields:i.dirtyFields,errors:i.errors,isValid:i.isValid})}else as(u,Se,Ne)},re=(Se,Ne)=>{as(i.errors,Se,Ne),R.state.next({errors:i.errors})},ce=Se=>{i.errors=Se,R.state.next({errors:i.errors,isValid:!1})},ae=(Se,Ne,$e,Pt)=>{const Ot=gn(o,Se);if(Ot){const Et=gn(u,Se,_o($e)?gn(l,Se):$e);_o(Et)||Pt&&Pt.defaultChecked||Ne?as(u,Se,Ne?Et:uV(Ot._f)):De(Se,Et),p.mount&&z()}},pe=(Se,Ne,$e,Pt,Ot)=>{let Et=!1,xt=!1;const pn={name:Se};if(!e.disabled){const Cn=!!(gn(o,Se)&&gn(o,Se)._f&&gn(o,Se)._f.disabled);if(!$e||Pt){C.isDirty&&(xt=i.isDirty,i.isDirty=pn.isDirty=fe(),Et=xt!==pn.isDirty);const En=Cn||Tg(gn(l,Se),Ne);xt=!!(!Cn&&gn(i.dirtyFields,Se)),En||Cn?Do(i.dirtyFields,Se):as(i.dirtyFields,Se,!0),pn.dirtyFields=i.dirtyFields,Et=Et||C.dirtyFields&&xt!==!En}if($e){const En=gn(i.touchedFields,Se);En||(as(i.touchedFields,Se,$e),pn.touchedFields=i.touchedFields,Et=Et||C.touchedFields&&En!==$e)}Et&&Ot&&R.state.next(pn)}return Et?pn:{}},H=(Se,Ne,$e,Pt)=>{const Ot=gn(i.errors,Se),Et=C.isValid&&lp(Ne)&&i.isValid!==Ne;if(e.delayError&&$e?(v=U(()=>re(Se,$e)),v(e.delayError)):(clearTimeout(w),v=null,$e?as(i.errors,Se,$e):Do(i.errors,Se)),($e?!Tg(Ot,$e):Ot)||!cl(Pt)||Et){const xt={...Pt,...Et&&lp(Ne)?{isValid:Ne}:{},errors:i.errors,name:Se};i={...i,...xt},R.state.next(xt)}},X=async Se=>{J(Se,!0);const Ne=await e.resolver(u,e.context,M8e(Se||y.mount,o,e.criteriaMode,e.shouldUseNativeValidation));return J(Se),Ne},Q=async Se=>{const{errors:Ne}=await X(Se);if(Se)for(const $e of Se){const Pt=gn(Ne,$e);Pt?as(i.errors,$e,Pt):Do(i.errors,$e)}else i.errors=Ne;return Ne},ne=async(Se,Ne,$e={valid:!0})=>{for(const Pt in Se){const Ot=Se[Pt];if(Ot){const{_f:Et,...xt}=Ot;if(Et){const pn=y.array.has(Et.name),Cn=Ot._f&&U8e(Ot._f);Cn&&C.validatingFields&&J([Pt],!0);const En=await QQ(Ot,y.disabled,u,L,e.shouldUseNativeValidation&&!Ne,pn);if(Cn&&C.validatingFields&&J([Pt]),En[Et.name]&&($e.valid=!1,Ne))break;!Ne&&(gn(En,Et.name)?pn?N8e(i.errors,En,Et.name):as(i.errors,Et.name,En[Et.name]):Do(i.errors,Et.name))}!cl(xt)&&await ne(xt,Ne,$e)}}return $e.valid},he=()=>{for(const Se of y.unMount){const Ne=gn(o,Se);Ne&&(Ne._f.refs?Ne._f.refs.every($e=>!lV($e)):!lV(Ne._f.ref))&&vt(Se)}y.unMount=new Set},fe=(Se,Ne)=>!e.disabled&&(Se&&Ne&&as(u,Se,Ne),!Tg(ve(),l)),de=(Se,Ne,$e)=>k8e(Se,y,{...p.mount?u:_o(Ne)?l:vp(Se)?{[Se]:Ne}:Ne},$e,Ne),ke=Se=>tD(gn(p.mount?u:l,Se,e.shouldUnregister?gn(l,Se,[]):[])),De=(Se,Ne,$e={})=>{const Pt=gn(o,Se);let Ot=Ne;if(Pt){const Et=Pt._f;Et&&(!Et.disabled&&as(u,Se,bae(Ne,Et)),Ot=FO(Et.ref)&&Ac(Ne)?"":Ne,Eae(Et.ref)?[...Et.ref.options].forEach(xt=>xt.selected=Ot.includes(xt.value)):Et.refs?eI(Et.ref)?Et.refs.length>1?Et.refs.forEach(xt=>(!xt.defaultChecked||!xt.disabled)&&(xt.checked=Array.isArray(Ot)?!!Ot.find(pn=>pn===xt.value):Ot===xt.value)):Et.refs[0]&&(Et.refs[0].checked=!!Ot):Et.refs.forEach(xt=>xt.checked=xt.value===Ot):$3(Et.ref)?Et.ref.value="":(Et.ref.value=Ot,Et.ref.type||R.values.next({name:Se,values:{...u}})))}($e.shouldDirty||$e.shouldTouch)&&pe(Se,Ot,$e.shouldTouch,$e.shouldDirty,!0),$e.shouldValidate&&Oe(Se)},je=(Se,Ne,$e)=>{for(const Pt in Ne){const Ot=Ne[Pt],Et=`${Se}.${Pt}`,xt=gn(o,Et);(y.array.has(Se)||ao(Ot)||xt&&!xt._f)&&!My(Ot)?je(Et,Ot,$e):De(Et,Ot,$e)}},Te=(Se,Ne,$e={})=>{const Pt=gn(o,Se),Ot=y.array.has(Se),Et=Xu(Ne);as(u,Se,Et),Ot?(R.array.next({name:Se,values:{...u}}),(C.isDirty||C.dirtyFields)&&$e.shouldDirty&&R.state.next({name:Se,dirtyFields:qT(l,u),isDirty:fe(Se,Et)})):Pt&&!Pt._f&&!Ac(Et)?je(Se,Et,$e):De(Se,Et,$e),KQ(Se,y)&&R.state.next({...i}),R.values.next({name:p.mount?Se:void 0,values:{...u}})},we=async Se=>{p.mount=!0;const Ne=Se.target;let $e=Ne.name,Pt=!0;const Ot=gn(o,$e),Et=()=>Ne.type?uV(Ot._f):w8e(Se),xt=pn=>{Pt=Number.isNaN(pn)||My(pn)&&isNaN(pn.getTime())||Tg(pn,gn(u,$e,pn))};if(Ot){let pn,Cn;const En=Et(),It=Se.type===HQ.BLUR||Se.type===HQ.FOCUS_OUT,cr=!V8e(Ot._f)&&!e.resolver&&!gn(i.errors,$e)&&!Ot._f.deps||F8e(It,gn(i.touchedFields,$e),i.isSubmitted,M,N),Lt=KQ($e,y,It);as(u,$e,En),It?(Ot._f.onBlur&&Ot._f.onBlur(Se),v&&v(0)):Ot._f.onChange&&Ot._f.onChange(Se);const Yt=pe($e,En,It,!1),Or=!cl(Yt)||Lt;if(!It&&R.values.next({name:$e,type:Se.type,values:{...u}}),cr)return C.isValid&&(e.mode==="onBlur"&&It?z():It||z()),Or&&R.state.next({name:$e,...Lt?{}:Yt});if(!It&&Lt&&R.state.next({...i}),e.resolver){const{errors:Oi}=await X([$e]);if(xt(En),Pt){const ji=eZ(i.errors,o,$e),Fr=eZ(Oi,o,ji.name||$e);pn=Fr.error,$e=Fr.name,Cn=cl(Oi)}}else J([$e],!0),pn=(await QQ(Ot,y.disabled,u,L,e.shouldUseNativeValidation))[$e],J([$e]),xt(En),Pt&&(pn?Cn=!1:C.isValid&&(Cn=await ne(o,!0)));Pt&&(Ot._f.deps&&Oe(Ot._f.deps),H($e,Cn,pn,Yt))}},Ie=(Se,Ne)=>{if(gn(i.errors,Ne)&&Se.focus)return Se.focus(),1},Oe=async(Se,Ne={})=>{let $e,Pt;const Ot=Yk(Se);if(e.resolver){const Et=await Q(_o(Se)?Se:Ot);$e=cl(Et),Pt=Se?!Ot.some(xt=>gn(Et,xt)):$e}else Se?(Pt=(await Promise.all(Ot.map(async Et=>{const xt=gn(o,Et);return await ne(xt&&xt._f?{[Et]:xt}:xt)}))).every(Boolean),!(!Pt&&!i.isValid)&&z()):Pt=$e=await ne(o);return R.state.next({...!vp(Se)||C.isValid&&$e!==i.isValid?{}:{name:Se},...e.resolver||!Se?{isValid:$e}:{},errors:i.errors}),Ne.shouldFocus&&!Pt&&WC(o,Ie,Se?Ot:y.mount),Pt},ve=Se=>{const Ne={...p.mount?u:l};return _o(Se)?Ne:vp(Se)?gn(Ne,Se):Se.map($e=>gn(Ne,$e))},xe=(Se,Ne)=>({invalid:!!gn((Ne||i).errors,Se),isDirty:!!gn((Ne||i).dirtyFields,Se),error:gn((Ne||i).errors,Se),isValidating:!!gn(i.validatingFields,Se),isTouched:!!gn((Ne||i).touchedFields,Se)}),Ge=Se=>{Se&&Yk(Se).forEach(Ne=>Do(i.errors,Ne)),R.state.next({errors:Se?i.errors:{}})},Ze=(Se,Ne,$e)=>{const Pt=(gn(o,Se,{_f:{}})._f||{}).ref,Ot=gn(i.errors,Se)||{},{ref:Et,message:xt,type:pn,...Cn}=Ot;as(i.errors,Se,{...Cn,...Ne,ref:Pt}),R.state.next({name:Se,errors:i.errors,isValid:!1}),$e&&$e.shouldFocus&&Pt&&Pt.focus&&Pt.focus()},lt=(Se,Ne)=>gp(Se)?R.values.subscribe({next:$e=>Se(de(void 0,Ne),$e)}):de(Se,Ne,!0),vt=(Se,Ne={})=>{for(const $e of Se?Yk(Se):y.mount)y.mount.delete($e),y.array.delete($e),Ne.keepValue||(Do(o,$e),Do(u,$e)),!Ne.keepError&&Do(i.errors,$e),!Ne.keepDirty&&Do(i.dirtyFields,$e),!Ne.keepTouched&&Do(i.touchedFields,$e),!Ne.keepIsValidating&&Do(i.validatingFields,$e),!e.shouldUnregister&&!Ne.keepDefaultValue&&Do(l,$e);R.values.next({values:{...u}}),R.state.next({...i,...Ne.keepDirty?{isDirty:fe()}:{}}),!Ne.keepIsValid&&z()},nt=({disabled:Se,name:Ne,field:$e,fields:Pt})=>{(lp(Se)&&p.mount||Se||y.disabled.has(Ne))&&(Se?y.disabled.add(Ne):y.disabled.delete(Ne),pe(Ne,uV($e?$e._f:gn(Pt,Ne)._f),!1,!1,!0))},mt=(Se,Ne={})=>{let $e=gn(o,Se);const Pt=lp(Ne.disabled)||lp(e.disabled);return as(o,Se,{...$e||{},_f:{...$e&&$e._f?$e._f:{ref:{name:Se}},name:Se,mount:!0,...Ne}}),y.mount.add(Se),$e?nt({field:$e,disabled:lp(Ne.disabled)?Ne.disabled:e.disabled,name:Se}):ae(Se,!0,Ne.value),{...Pt?{disabled:Ne.disabled||e.disabled}:{},...e.progressive?{required:!!Ne.required,min:YT(Ne.min),max:YT(Ne.max),minLength:YT(Ne.minLength),maxLength:YT(Ne.maxLength),pattern:YT(Ne.pattern)}:{},name:Se,onChange:we,onBlur:we,ref:Ot=>{if(Ot){mt(Se,Ne),$e=gn(o,Se);const Et=_o(Ot.value)&&Ot.querySelectorAll&&Ot.querySelectorAll("input,select,textarea")[0]||Ot,xt=L8e(Et),pn=$e._f.refs||[];if(xt?pn.find(Cn=>Cn===Et):Et===$e._f.ref)return;as(o,Se,{_f:{...$e._f,...xt?{refs:[...pn.filter(lV),Et,...Array.isArray(gn(l,Se))?[{}]:[]],ref:{type:Et.type,name:Se}}:{ref:Et}}}),ae(Se,!1,void 0,Et)}else $e=gn(o,Se,{}),$e._f&&($e._f.mount=!1),(e.shouldUnregister||Ne.shouldUnregister)&&!(C8e(y.array,Se)&&p.action)&&y.unMount.add(Se)}}},et=()=>e.shouldFocusError&&WC(o,Ie,y.mount),St=Se=>{lp(Se)&&(R.state.next({disabled:Se}),WC(o,(Ne,$e)=>{const Pt=gn(o,$e);Pt&&(Ne.disabled=Pt._f.disabled||Se,Array.isArray(Pt._f.refs)&&Pt._f.refs.forEach(Ot=>{Ot.disabled=Pt._f.disabled||Se}))},0,!1))},un=(Se,Ne)=>async $e=>{let Pt;$e&&($e.preventDefault&&$e.preventDefault(),$e.persist&&$e.persist());let Ot=Xu(u);if(y.disabled.size)for(const Et of y.disabled)as(Ot,Et,void 0);if(R.state.next({isSubmitting:!0}),e.resolver){const{errors:Et,values:xt}=await X();i.errors=Et,Ot=xt}else await ne(o);if(Do(i.errors,"root"),cl(i.errors)){R.state.next({errors:{}});try{await Se(Ot,$e)}catch(Et){Pt=Et}}else Ne&&await Ne({...i.errors},$e),et(),setTimeout(et);if(R.state.next({isSubmitted:!0,isSubmitting:!1,isSubmitSuccessful:cl(i.errors)&&!Pt,submitCount:i.submitCount+1,errors:i.errors}),Pt)throw Pt},ft=(Se,Ne={})=>{gn(o,Se)&&(_o(Ne.defaultValue)?Te(Se,Xu(gn(l,Se))):(Te(Se,Ne.defaultValue),as(l,Se,Xu(Ne.defaultValue))),Ne.keepTouched||Do(i.touchedFields,Se),Ne.keepDirty||(Do(i.dirtyFields,Se),i.isDirty=Ne.defaultValue?fe(Se,Xu(gn(l,Se))):fe()),Ne.keepError||(Do(i.errors,Se),C.isValid&&z()),R.state.next({...i}))},Ct=(Se,Ne={})=>{const $e=Se?Xu(Se):l,Pt=Xu($e),Ot=cl(Se),Et=Ot?l:Pt;if(Ne.keepDefaultValues||(l=$e),!Ne.keepValues){if(Ne.keepDirtyValues){const xt=new Set([...y.mount,...Object.keys(qT(l,u))]);for(const pn of Array.from(xt))gn(i.dirtyFields,pn)?as(Et,pn,gn(u,pn)):Te(pn,gn(Et,pn))}else{if(G3&&_o(Se))for(const xt of y.mount){const pn=gn(o,xt);if(pn&&pn._f){const Cn=Array.isArray(pn._f.refs)?pn._f.refs[0]:pn._f.ref;if(FO(Cn)){const En=Cn.closest("form");if(En){En.reset();break}}}}o={}}u=e.shouldUnregister?Ne.keepDefaultValues?Xu(l):{}:Xu(Et),R.array.next({values:{...Et}}),R.values.next({values:{...Et}})}y={mount:Ne.keepDirtyValues?y.mount:new Set,unMount:new Set,array:new Set,disabled:new Set,watch:new Set,watchAll:!1,focus:""},p.mount=!C.isValid||!!Ne.keepIsValid||!!Ne.keepDirtyValues,p.watch=!!e.shouldUnregister,R.state.next({submitCount:Ne.keepSubmitCount?i.submitCount:0,isDirty:Ot?!1:Ne.keepDirty?i.isDirty:!!(Ne.keepDefaultValues&&!Tg(Se,l)),isSubmitted:Ne.keepIsSubmitted?i.isSubmitted:!1,dirtyFields:Ot?{}:Ne.keepDirtyValues?Ne.keepDefaultValues&&u?qT(l,u):i.dirtyFields:Ne.keepDefaultValues&&Se?qT(l,Se):Ne.keepDirty?i.dirtyFields:{},touchedFields:Ne.keepTouched?i.touchedFields:{},errors:Ne.keepErrors?i.errors:{},isSubmitSuccessful:Ne.keepIsSubmitSuccessful?i.isSubmitSuccessful:!1,isSubmitting:!1})},ut=(Se,Ne)=>Ct(gp(Se)?Se(u):Se,Ne);return{control:{register:mt,unregister:vt,getFieldState:xe,handleSubmit:un,setError:Ze,_executeSchema:X,_getWatch:de,_getDirty:fe,_updateValid:z,_removeUnmounted:he,_updateFieldArray:q,_updateDisabledField:nt,_getFieldArray:ke,_reset:Ct,_resetDefaultValues:()=>gp(e.defaultValues)&&e.defaultValues().then(Se=>{ut(Se,e.resetOptions),R.state.next({isLoading:!1})}),_updateFormState:Se=>{i={...i,...Se}},_disableForm:St,_subjects:R,_proxyFormState:C,_setErrors:ce,get _fields(){return o},get _formValues(){return u},get _state(){return p},set _state(Se){p=Se},get _defaultValues(){return l},get _names(){return y},set _names(Se){y=Se},get _formState(){return i},set _formState(Se){i=Se},get _options(){return e},set _options(Se){e={...e,...Se}}},trigger:Oe,register:mt,handleSubmit:un,watch:lt,setValue:Te,getValues:ve,reset:ut,resetField:ft,clearErrors:Ge,unregister:vt,setError:Ze,setFocus:(Se,Ne={})=>{const $e=gn(o,Se),Pt=$e&&$e._f;if(Pt){const Ot=Pt.refs?Pt.refs[0]:Pt.ref;Ot.focus&&(Ot.focus(),Ne.shouldSelect&&gp(Ot.select)&&Ot.select())}},getFieldState:xe}}function wae(n={}){const e=bi.useRef(void 0),i=bi.useRef(void 0),[o,l]=bi.useState({isDirty:!1,isValidating:!1,isLoading:gp(n.defaultValues),isSubmitted:!1,isSubmitting:!1,isSubmitSuccessful:!1,isValid:!1,submitCount:0,dirtyFields:{},touchedFields:{},validatingFields:{},errors:n.errors||{},disabled:n.disabled||!1,defaultValues:gp(n.defaultValues)?void 0:n.defaultValues});e.current||(e.current={...z8e(n),formState:o});const u=e.current.control;return u._options=n,P8e({subject:u._subjects.state,next:p=>{A8e(p,u._proxyFormState,u._updateFormState)&&l({...u._formState})}}),bi.useEffect(()=>u._disableForm(n.disabled),[u,n.disabled]),bi.useEffect(()=>{if(u._proxyFormState.isDirty){const p=u._getDirty();p!==o.isDirty&&u._subjects.state.next({isDirty:p})}},[u,o.isDirty]),bi.useEffect(()=>{n.values&&!Tg(n.values,i.current)?(u._reset(n.values,u._options.resetOptions),i.current=n.values,l(p=>({...p}))):u._resetDefaultValues()},[n.values,u]),bi.useEffect(()=>{n.errors&&u._setErrors(n.errors)},[n.errors,u]),bi.useEffect(()=>{u._state.mount||(u._updateValid(),u._state.mount=!0),u._state.watch&&(u._state.watch=!1,u._subjects.state.next({...u._formState})),u._removeUnmounted()}),bi.useEffect(()=>{n.shouldUnregister&&u._subjects.values.next({values:u._getWatch()})},[n.shouldUnregister,u]),e.current.formState=I8e(o,u),e.current}var W8e=["sitekey","onChange","theme","type","tabindex","onExpired","onErrored","size","stoken","grecaptcha","badge","hl","isolated"];function zF(){return zF=Object.assign?Object.assign.bind():function(n){for(var e=1;e<arguments.length;e++){var i=arguments[e];for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(n[o]=i[o])}return n},zF.apply(this,arguments)}function G8e(n,e){if(n==null)return{};var i={},o=Object.keys(n),l,u;for(u=0;u<o.length;u++)l=o[u],!(e.indexOf(l)>=0)&&(i[l]=n[l]);return i}function hk(n){if(n===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return n}function H8e(n,e){n.prototype=Object.create(e.prototype),n.prototype.constructor=n,WF(n,e)}function WF(n,e){return WF=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(o,l){return o.__proto__=l,o},WF(n,e)}var nD=function(n){H8e(e,n);function e(){var o;return o=n.call(this)||this,o.handleExpired=o.handleExpired.bind(hk(o)),o.handleErrored=o.handleErrored.bind(hk(o)),o.handleChange=o.handleChange.bind(hk(o)),o.handleRecaptchaRef=o.handleRecaptchaRef.bind(hk(o)),o}var i=e.prototype;return i.getCaptchaFunction=function(l){return this.props.grecaptcha?this.props.grecaptcha.enterprise?this.props.grecaptcha.enterprise[l]:this.props.grecaptcha[l]:null},i.getValue=function(){var l=this.getCaptchaFunction("getResponse");return l&&this._widgetId!==void 0?l(this._widgetId):null},i.getWidgetId=function(){return this.props.grecaptcha&&this._widgetId!==void 0?this._widgetId:null},i.execute=function(){var l=this.getCaptchaFunction("execute");if(l&&this._widgetId!==void 0)return l(this._widgetId);this._executeRequested=!0},i.executeAsync=function(){var l=this;return new Promise(function(u,p){l.executionResolve=u,l.executionReject=p,l.execute()})},i.reset=function(){var l=this.getCaptchaFunction("reset");l&&this._widgetId!==void 0&&l(this._widgetId)},i.forceReset=function(){var l=this.getCaptchaFunction("reset");l&&l()},i.handleExpired=function(){this.props.onExpired?this.props.onExpired():this.handleChange(null)},i.handleErrored=function(){this.props.onErrored&&this.props.onErrored(),this.executionReject&&(this.executionReject(),delete this.executionResolve,delete this.executionReject)},i.handleChange=function(l){this.props.onChange&&this.props.onChange(l),this.executionResolve&&(this.executionResolve(l),delete this.executionReject,delete this.executionResolve)},i.explicitRender=function(){var l=this.getCaptchaFunction("render");if(l&&this._widgetId===void 0){var u=document.createElement("div");this._widgetId=l(u,{sitekey:this.props.sitekey,callback:this.handleChange,theme:this.props.theme,type:this.props.type,tabindex:this.props.tabindex,"expired-callback":this.handleExpired,"error-callback":this.handleErrored,size:this.props.size,stoken:this.props.stoken,hl:this.props.hl,badge:this.props.badge,isolated:this.props.isolated}),this.captcha.appendChild(u)}this._executeRequested&&this.props.grecaptcha&&this._widgetId!==void 0&&(this._executeRequested=!1,this.execute())},i.componentDidMount=function(){this.explicitRender()},i.componentDidUpdate=function(){this.explicitRender()},i.handleRecaptchaRef=function(l){this.captcha=l},i.render=function(){var l=this.props;l.sitekey,l.onChange,l.theme,l.type,l.tabindex,l.onExpired,l.onErrored,l.size,l.stoken,l.grecaptcha,l.badge,l.hl,l.isolated;var u=G8e(l,W8e);return O.createElement("div",zF({},u,{ref:this.handleRecaptchaRef}))},e}(O.Component);nD.displayName="ReCAPTCHA";nD.propTypes={sitekey:Tn.string.isRequired,onChange:Tn.func,grecaptcha:Tn.object,theme:Tn.oneOf(["dark","light"]),type:Tn.oneOf(["image","audio"]),tabindex:Tn.number,onExpired:Tn.func,onErrored:Tn.func,size:Tn.oneOf(["compact","normal","invisible"]),stoken:Tn.string,hl:Tn.string,badge:Tn.oneOf(["bottomright","bottomleft","inline"]),isolated:Tn.bool};nD.defaultProps={onChange:function(){},theme:"light",type:"image",tabindex:0,size:"normal",badge:"bottomright"};function GF(){return GF=Object.assign||function(n){for(var e=1;e<arguments.length;e++){var i=arguments[e];for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(n[o]=i[o])}return n},GF.apply(this,arguments)}function $8e(n,e){if(n==null)return{};var i={},o=Object.keys(n),l,u;for(u=0;u<o.length;u++)l=o[u],!(e.indexOf(l)>=0)&&(i[l]=n[l]);return i}function K8e(n,e){n.prototype=Object.create(e.prototype),n.prototype.constructor=n,n.__proto__=e}var nh={},q8e=0;function Y8e(n,e){return e=e||{},function(o){var l=o.displayName||o.name||"Component",u=function(y){K8e(v,y);function v(C,R){var N;return N=y.call(this,C,R)||this,N.state={},N.__scriptURL="",N}var w=v.prototype;return w.asyncScriptLoaderGetScriptLoaderID=function(){return this.__scriptLoaderID||(this.__scriptLoaderID="async-script-loader-"+q8e++),this.__scriptLoaderID},w.setupScriptURL=function(){return this.__scriptURL=typeof n=="function"?n():n,this.__scriptURL},w.asyncScriptLoaderHandleLoad=function(R){var N=this;this.setState(R,function(){return N.props.asyncScriptOnLoad&&N.props.asyncScriptOnLoad(N.state)})},w.asyncScriptLoaderTriggerOnScriptLoaded=function(){var R=nh[this.__scriptURL];if(!R||!R.loaded)throw new Error("Script is not loaded.");for(var N in R.observers)R.observers[N](R);delete window[e.callbackName]},w.componentDidMount=function(){var R=this,N=this.setupScriptURL(),M=this.asyncScriptLoaderGetScriptLoaderID(),L=e,U=L.globalName,z=L.callbackName,J=L.scriptId;if(U&&typeof window[U]<"u"&&(nh[N]={loaded:!0,observers:{}}),nh[N]){var q=nh[N];if(q&&(q.loaded||q.errored)){this.asyncScriptLoaderHandleLoad(q);return}q.observers[M]=function(H){return R.asyncScriptLoaderHandleLoad(H)};return}var re={};re[M]=function(H){return R.asyncScriptLoaderHandleLoad(H)},nh[N]={loaded:!1,observers:re};var ce=document.createElement("script");ce.src=N,ce.async=!0;for(var ae in e.attributes)ce.setAttribute(ae,e.attributes[ae]);J&&(ce.id=J);var pe=function(X){if(nh[N]){var Q=nh[N],ne=Q.observers;for(var he in ne)X(ne[he])&&delete ne[he]}};z&&typeof window<"u"&&(window[z]=function(){return R.asyncScriptLoaderTriggerOnScriptLoaded()}),ce.onload=function(){var H=nh[N];H&&(H.loaded=!0,pe(function(X){return z?!1:(X(H),!0)}))},ce.onerror=function(){var H=nh[N];H&&(H.errored=!0,pe(function(X){return X(H),!0}))},document.body.appendChild(ce)},w.componentWillUnmount=function(){var R=this.__scriptURL;if(e.removeOnUnmount===!0)for(var N=document.getElementsByTagName("script"),M=0;M<N.length;M+=1)N[M].src.indexOf(R)>-1&&N[M].parentNode&&N[M].parentNode.removeChild(N[M]);var L=nh[R];L&&(delete L.observers[this.asyncScriptLoaderGetScriptLoaderID()],e.removeOnUnmount===!0&&delete nh[R])},w.render=function(){var R=e.globalName,N=this.props;N.asyncScriptOnLoad;var M=N.forwardedRef,L=$8e(N,["asyncScriptOnLoad","forwardedRef"]);return R&&typeof window<"u"&&(L[R]=typeof window[R]<"u"?window[R]:void 0),L.ref=M,O.createElement(o,L)},v}(O.Component),p=O.forwardRef(function(y,v){return O.createElement(u,GF({},y,{forwardedRef:v}))});return p.displayName="AsyncScriptLoader("+l+")",p.propTypes={asyncScriptOnLoad:Tn.func},dAe(p,o)}}var HF="onloadcallback",X8e="grecaptcha";function $F(){return typeof window<"u"&&window.recaptchaOptions||{}}function J8e(){var n=$F(),e=n.useRecaptchaNet?"recaptcha.net":"www.google.com";return n.enterprise?"https://"+e+"/recaptcha/enterprise.js?onload="+HF+"&render=explicit":"https://"+e+"/recaptcha/api.js?onload="+HF+"&render=explicit"}const Tae=Y8e(J8e,{callbackName:HF,globalName:X8e,attributes:$F().nonce?{nonce:$F().nonce}:{}})(nD),rD=(n,e="generic-modal")=>{O.useEffect(()=>{if(!window.unityInstance)return;const i=()=>{try{window.unityInstance.SendMessage("WebGLInputManager","Disable"),K.log(`Unity input disabled for ${e}`),document.body.classList.add("unity-input-disabled"),window.unityInputDisabled=!0,window.unityInputDisabledBy=e}catch(l){K.error(`Failed to disable Unity input for ${e}:`,l)}},o=()=>{try{window.unityInputDisabledBy===e?(window.unityInstance.SendMessage("WebGLInputManager","Enable"),K.log(`Unity input re-enabled (was disabled by ${e})`),document.body.classList.remove("unity-input-disabled"),window.unityInputDisabled=!1,window.unityInputDisabledBy=null):K.log(`Not re-enabling Unity input for ${e} because it was disabled by ${window.unityInputDisabledBy}`)}catch(l){K.error(`Failed to enable Unity input for ${e}:`,l)}};return n?i():o(),()=>{n&&o()}},[n,e])},Cae=({isOpen:n,onClose:e,userData:i,onConfirm:o,fullscreenRef:l})=>{const[u,p]=O.useState((i==null?void 0:i.username)||""),[y,v]=O.useState((i==null?void 0:i.Nickname)||""),[w,C]=O.useState(!1),[R,N]=O.useState(null),[M,L]=O.useState(!1),U=Da(),z=ce=>!(!ce||ce.trim()===""||!/^[a-z0-9]{1,15}$/.test(ce)),J=async ce=>{var ae,pe;if(!z(ce))return!ce||ce.trim()===""?N("Username cannot be empty"):N("Username must be 1-15 characters, lowercase letters and numbers only"),!1;C(!0),N(null);try{let H=!1,X=0;const Q=3;for(;X<Q;)try{H=await vR(ce);break}catch(ne){if(K.error(`Attempt ${X+1}: Error checking username:`,ne),X++,X>=Q)throw ne;await new Promise(he=>setTimeout(he,1e3))}return H?(N("Username is already taken"),!1):!0}catch(H){return K.error("Error checking username after retries:",H),H.code==="permission-denied"||(ae=H.message)!=null&&ae.includes("permissions")?N("Username check unavailable. Please try again or pick a unique name."):N("Error checking username availability. Please try again."),H.code==="permission-denied"||((pe=H.message)==null?void 0:pe.includes("permissions"))}finally{C(!1)}};O.useEffect(()=>{if(!u){N("Username cannot be empty");return}if(u!==(i==null?void 0:i.username)){const ce=setTimeout(async()=>{await J(u)},500);return()=>clearTimeout(ce)}},[u]),O.useEffect(()=>{if(i&&i.firstName&&i.lastName){const ce=`${i.firstName}${i.lastName.charAt(0).toUpperCase()}`;v(ce)}},[i]);const q=async()=>{L(!0);try{if(!await J(u)){L(!1);return}if(y.length>15){N("Display Name must be at most 15 characters"),L(!1);return}Zu(y),K.log("UsernameConfirmation: Preparing to confirm user registration");const ae=i.firstName&&i.lastName?`${i.firstName}${i.lastName.charAt(0).toUpperCase()}`:"",pe={...i,firstName:i.firstName||"",lastName:i.lastName||"",companyName:i.companyName||"",linkedInProfile:i.linkedInProfile||"",username:u,Nickname:y||ae,email:i.email,password:i.password};K.log("UsernameConfirmation: Processed registration data with fields:",Object.keys(pe).join(", ")),await o(pe),e()}catch(ce){K.error("Error during username confirmation:",ce),U({title:"Error",description:"An error occurred. Please try again.",status:"error",duration:3e3,isClosable:!0})}finally{L(!1)}},re=()=>{M||e()};return S.jsxs(ls,{isOpen:n,onClose:re,size:"md",portalProps:{containerRef:l},isCentered:!0,motionPreset:"slideInBottom",closeOnOverlayClick:!M,closeOnEsc:!M,children:[S.jsx(ds,{bg:"blackAlpha.800",backdropFilter:"blur(5px)"}),S.jsxs(us,{bg:"gray.800",borderRadius:"xl",boxShadow:"xl",color:"white",maxW:"md",mx:4,position:"relative",children:[S.jsxs(co,{children:[S.jsx(uR,{size:"lg",mb:2,children:"Customize Your Profile"}),S.jsx(Ye,{fontSize:"sm",color:"gray.400",children:"Set your username and nickname"})]}),S.jsx(Is,{color:"gray.400",isDisabled:M}),S.jsx(gs,{children:S.jsxs(Ir,{spacing:6,align:"stretch",children:[S.jsxs(br,{isInvalid:!!R,children:[S.jsx(gi,{children:"Username"}),S.jsxs(Pg,{children:[S.jsx(dN,{bg:"gray.700",color:"gray.400",border:"none",children:"@"}),S.jsx(li,{placeholder:"username",value:u,onChange:ce=>p(ce.target.value.toLowerCase()),bg:"gray.700",border:"none",color:"white",_placeholder:{color:"gray.500"},_hover:{bg:"gray.600"},_focus:{bg:"gray.600",boxShadow:"0 0 0 1px var(--chakra-colors-blue-400)"},maxLength:15})]}),R?S.jsx(hp,{children:R}):S.jsx(Hy,{color:"gray.400",children:"Lowercase letters and numbers only, max 15 characters"})]}),S.jsxs(br,{children:[S.jsx(gi,{children:"Nickname"}),S.jsx(li,{placeholder:"Nickname",value:y,onChange:ce=>v(ce.target.value),bg:"gray.700",border:"none",color:"white",_placeholder:{color:"gray.500"},_hover:{bg:"gray.600"},_focus:{bg:"gray.600",boxShadow:"0 0 0 1px var(--chakra-colors-blue-400)"},maxLength:15}),S.jsx(Hy,{color:"gray.400",children:"This is the name shown to others, max 15 characters"})]})]})}),S.jsx(uh,{children:S.jsxs(Ur,{gap:3,width:"100%",children:[S.jsx(Nn,{variant:"outline",onClick:re,flex:"1",isDisabled:M,children:"Back"}),S.jsx(Nn,{colorScheme:"blue",onClick:q,isLoading:M||w,isDisabled:!!R||!u||M,flex:"2",children:"Finish"})]})})]})]})};Cae.propTypes={isOpen:Tn.bool.isRequired,onClose:Tn.func.isRequired,userData:Tn.object.isRequired,onConfirm:Tn.func.isRequired,fullscreenRef:Tn.object};const Q8e="6Le4oQUrAAAAAHe0GMH5Z0tpuqTV2qqDzK9Yk4Uv";function iD({mode:n,label:e,buttonProps:i={},isOpen:o,onClose:l}){const{register:u,handleSubmit:p,formState:{errors:y}}=wae(),{register:v}=O.useContext(Zi),w=Da(),{fullscreenRef:C}=fh(),[R,N]=O.useState(!1),[M,L]=O.useState(!1),[U,z]=O.useState(null),J=O.useRef(null),[q,re]=O.useState(!1),[ce,ae]=O.useState(null),[pe,H]=O.useState(!1),X=o!==void 0?o:R,Q=l||(()=>N(!1));rD(X||q),O.useEffect(()=>{!X&&J.current&&(J.current.reset(),z(null))},[X]);const ne=De=>{z(De)},he=async De=>{K.log("Register.jsx: Processing registration form submission");const{email:je,password:Te,confirmPassword:we,...Ie}=De;if(K.log("Register.jsx: Registration data fields:",Object.keys(Ie).join(", ")),!U){w({title:"Verification Required",description:"Please complete the reCAPTCHA verification.",status:"error",duration:3e3,isClosable:!0,position:"top"});return}if(Te!==we){w({title:"Error",description:"Passwords do not match.",status:"error",duration:3e3,isClosable:!0,position:"top"});return}Zu(Ie.firstName),Zu(Ie.lastName),Zu(Ie.companyName),L(!0);try{const Oe=await F6e(Ie.firstName||"",Ie.lastName||""),ve=Ie.firstName&&Ie.lastName?`${Ie.firstName}${Ie.lastName.charAt(0).toUpperCase()}`:"";ve&&Zu(ve),K.log("Register.jsx: Generated username and nickname for new user");const xe={...Ie,firstName:Ie.firstName||"",lastName:Ie.lastName||"",companyName:Ie.companyName||"",linkedInProfile:Ie.linkedInProfile||"",email:je,password:Te,username:Oe,Nickname:ve,captchaToken:U};K.log("Register.jsx: Prepared registration data with fields:",Object.keys(xe).join(", ")),ae(xe),re(!0)}catch(Oe){K.error("User: Registration Error:",Oe);let ve="An error occurred during registration. Please try again.",xe=!1;Oe.code==="auth/email-already-in-use"?(ve="This email address is already registered. Please sign in instead.",xe=!0):Oe.code==="auth/invalid-email"?ve="The email address is not valid. Please check and try again.":Oe.code==="auth/weak-password"?ve="The password is too weak. Please choose a stronger password.":Oe.message&&(ve=Oe.message),w({title:"Registration Failed",description:S.jsxs(S.Fragment,{children:[ve,xe&&S.jsx(Ye,{mt:2,children:S.jsx(Zl,{color:"blue.400",onClick:()=>{Q(),window.dispatchEvent(new CustomEvent("openSignInModal"))},children:"Go to Sign In"})})]}),status:"error",duration:5e3,isClosable:!0,position:"top"})}finally{L(!1),J.current&&J.current.reset()}},fe=async De=>{L(!0);try{K.log("Register.jsx: Completing registration with confirmed username");const{email:je,password:Te,...we}=De,Ie={...we,firstName:we.firstName||"",lastName:we.lastName||"",companyName:we.companyName||"",linkedInProfile:we.linkedInProfile||"",username:we.username||"",Nickname:we.Nickname||""};K.log("Register.jsx: Final registration data includes fields:",Object.keys(Ie).join(", "));const Oe=await v(je,Te,Ie);Q(),re(!1),K.log("User: Registration process complete."),w({title:"Registration Successful",description:"Please check your email for a verification link. You'll need to verify your email before signing in.",status:"success",duration:8e3,isClosable:!0,position:"top"}),ae(null),H(!1)}catch(je){K.error("User: Registration Error during final step:",je);let Te="An error occurred during registration. Please try again.";je.code==="auth/email-already-in-use"?Te="This email address is already in use. Please try another one.":je.message&&(Te=je.message),w({title:"Registration Failed",description:Te,status:"error",duration:5e3,isClosable:!0,position:"top"}),re(!1),ae(null),H(!1)}finally{L(!1)}},de=()=>{l?l():N(!R)},ke=n==="link"?S.jsx(Zl,{variant:"header",onClick:de,children:e}):S.jsx(Nn,{onClick:de,...i,children:e});return S.jsxs(S.Fragment,{children:[!o&&ke,S.jsxs(ls,{isOpen:X&&!q,onClose:Q,size:"md",portalProps:{containerRef:C},isCentered:!0,motionPreset:"slideInBottom",blockScrollOnMount:!1,children:[S.jsx(ds,{bg:"blackAlpha.800",backdropFilter:"blur(5px)"}),S.jsxs(us,{bg:"gray.800",borderRadius:"xl",boxShadow:"xl",color:"white",maxW:"md",mx:4,position:"relative",zIndex:9999,sx:{isolation:"isolate","& input":{position:"relative",zIndex:1e4,isolation:"isolate"},"& *":{pointerEvents:"auto !important"}},onKeyDown:De=>{De.stopPropagation()},children:[S.jsxs(co,{p:8,textAlign:"center",children:[S.jsx(uR,{size:"lg",mb:2,color:"white",children:"Create Account"}),S.jsx(Ye,{fontSize:"sm",color:"gray.400",children:"Fill in your details to get started"})]}),S.jsx(Is,{color:"white",bg:"rgba(255,255,255,0.1)",_hover:{color:"gray.400",bg:"transparent"},borderRadius:"full",size:"sm",top:2,right:3}),S.jsx(gs,{px:8,children:S.jsx("form",{onSubmit:p(he),children:S.jsxs(Ir,{spacing:4,children:[S.jsxs(br,{isInvalid:y.companyName,isRequired:!0,children:[S.jsx(li,{placeholder:"Company Name",bg:"gray.700",border:"none",color:"white",_placeholder:{color:"gray.500"},_hover:{bg:"gray.600"},_focus:{bg:"gray.600",boxShadow:"0 0 0 1px var(--chakra-colors-blue-400)"},...u("companyName",{required:"Company name is required",setValueAs:De=>De===""?"":De})}),S.jsx(hp,{children:y.companyName&&y.companyName.message})]}),S.jsxs(Ur,{gap:4,w:"100%",children:[S.jsxs(br,{isInvalid:y.firstName,isRequired:!0,children:[S.jsx(li,{placeholder:"First Name",bg:"gray.700",border:"none",color:"white",_placeholder:{color:"gray.500"},_hover:{bg:"gray.600"},_focus:{bg:"gray.600",boxShadow:"0 0 0 1px var(--chakra-colors-blue-400)"},...u("firstName",{required:"First name is required",setValueAs:De=>De===""?"":De})}),S.jsx(hp,{children:y.firstName&&y.firstName.message})]}),S.jsxs(br,{isInvalid:y.lastName,isRequired:!0,children:[S.jsx(li,{placeholder:"Last Name",bg:"gray.700",border:"none",color:"white",_placeholder:{color:"gray.500"},_hover:{bg:"gray.600"},_focus:{bg:"gray.600",boxShadow:"0 0 0 1px var(--chakra-colors-blue-400)"},...u("lastName",{required:"Last name is required",setValueAs:De=>De===""?"":De})}),S.jsx(hp,{children:y.lastName&&y.lastName.message})]})]}),S.jsxs(br,{isInvalid:y.email,isRequired:!0,children:[S.jsx(li,{type:"email",placeholder:"Work Email Address",bg:"gray.700",border:"none",color:"white",_placeholder:{color:"gray.500"},_hover:{bg:"gray.600"},_focus:{bg:"gray.600",boxShadow:"0 0 0 1px var(--chakra-colors-blue-400)"},...u("email",{required:"Email is required",pattern:{value:/^[^@ \t\r\n]+@[^@ \t\r\n]+\.[^@ \t\r\n]+$/,message:"Invalid email address"}})}),S.jsx(hp,{children:y.email&&y.email.message})]}),S.jsxs(Ur,{gap:4,w:"100%",children:[S.jsxs(br,{isInvalid:y.password,isRequired:!0,children:[S.jsx(li,{type:"password",placeholder:"Password",bg:"gray.700",border:"none",color:"white",_placeholder:{color:"gray.500"},_hover:{bg:"gray.600"},_focus:{bg:"gray.600",boxShadow:"0 0 0 1px var(--chakra-colors-blue-400)"},...u("password",{required:"Password is required",minLength:{value:8,message:"Password must be at least 8 characters long"}})}),S.jsx(hp,{children:y.password&&y.password.message})]}),S.jsxs(br,{isInvalid:y.confirmPassword,isRequired:!0,children:[S.jsx(li,{type:"password",placeholder:"Confirm Password",bg:"gray.700",border:"none",color:"white",_placeholder:{color:"gray.500"},_hover:{bg:"gray.600"},_focus:{bg:"gray.600",boxShadow:"0 0 0 1px var(--chakra-colors-blue-400)"},...u("confirmPassword",{required:"Confirm password is required"})}),S.jsx(hp,{children:y.confirmPassword&&y.confirmPassword.message})]})]}),S.jsx(br,{children:S.jsx(li,{placeholder:"LinkedIn Profile (optional)",bg:"gray.700",border:"none",color:"white",_placeholder:{color:"gray.500"},_hover:{bg:"gray.600"},_focus:{bg:"gray.600",boxShadow:"0 0 0 1px var(--chakra-colors-blue-400)"},...u("linkedInProfile",{setValueAs:De=>De===""?"":De})})}),S.jsx(ct,{width:"100%",display:"flex",justifyContent:"center",my:4,children:S.jsx(Tae,{ref:J,sitekey:Q8e,onChange:ne,theme:"dark"})})]})})}),S.jsxs(uh,{px:8,pb:8,flexDirection:"column",gap:4,children:[S.jsx(Nn,{type:"submit",colorScheme:"blue",size:"lg",width:"100%",onClick:p(he),isLoading:M,loadingText:"Processing",isDisabled:!U,children:"Next: Set Your Username"}),S.jsxs(Ye,{fontSize:"sm",color:"gray.400",textAlign:"center",children:["Already have an account?"," ",S.jsx(Zl,{color:"blue.400",onClick:()=>{Q(),window.dispatchEvent(new CustomEvent("openSignInModal"))},children:"Sign In"})]})]})]})]}),q&&S.jsx(Cae,{isOpen:q,onClose:()=>re(!1),userData:ce,onConfirm:fe,fullscreenRef:C,isRegistering:pe})]})}iD.propTypes={mode:Tn.oneOf(["button","link"]),label:Tn.string,buttonProps:Tn.object,isOpen:Tn.bool,onClose:Tn.func};const Z8e="6Le4oQUrAAAAAHe0GMH5Z0tpuqTV2qqDzK9Yk4Uv";function sD({mode:n="button",label:e="Sign In",buttonProps:i={},initialIsOpen:o=!1}){const{signIn:l}=O.useContext(Zi),{fullscreenRef:u}=fh(),p=Da(),{register:y,handleSubmit:v,formState:{errors:w}}=wae(),[C,R]=O.useState(!1),[N,M]=O.useState(o),[L,U]=O.useState(!1),[z,J]=O.useState(!1),[q,re]=O.useState(""),[ce,ae]=O.useState(!1),[pe,H]=O.useState(null),X=O.useRef(null);rD(N||z),O.useEffect(()=>{const je=()=>{M(!0)};return window.addEventListener("openSignInModal",je),()=>{window.removeEventListener("openSignInModal",je)}},[]);const Q=je=>{H(je)},ne=async je=>{if(!pe){p({title:"Verification Required",description:"Please complete the reCAPTCHA verification.",status:"error",duration:3e3,isClosable:!0,position:"top"});return}R(!0);try{await l(je.email,je.password,pe),K.log("User: Sign-in process complete."),M(!1),window.location.reload()}catch(Te){K.error("User: SignIn Error:",Te);const we=Te.message||"An error occurred while logging in. Please check your credentials.",Ie=we.includes("verify your email");p({title:Ie?"Email Verification Required":"Error",description:we,status:Ie?"warning":"error",duration:1e4,isClosable:!0,position:"top",container:u.current})}finally{R(!1),X.current&&X.current.reset()}},he=async()=>{if(!q){p({title:"Email Required",description:"Please enter your email address to reset your password.",status:"warning",duration:3e3,isClosable:!0,position:"top",container:u.current});return}try{ae(!0),await Vje(N3,q),p({title:"Password Reset Email Sent",description:"Check your email for instructions to reset your password.",status:"success",duration:5e3,isClosable:!0,position:"top",container:u.current}),J(!1)}catch(je){K.error("User: Reset Password Error:",je),p({title:"Error",description:je.message||"Failed to send password reset email. Please try again.",status:"error",duration:5e3,isClosable:!0,position:"top",container:u.current})}finally{ae(!1)}},fe=()=>M(je=>!je),de=()=>{M(!1),U(!0)},ke=()=>{J(!0)},De=n==="link"?S.jsx(Zl,{variant:"header",onClick:fe,children:e}):S.jsx(Nn,{onClick:fe,...i,children:e});return S.jsxs(S.Fragment,{children:[De,S.jsxs(ls,{isOpen:N,onClose:fe,size:"md",portalProps:{containerRef:u},isCentered:!0,motionPreset:"slideInBottom",blockScrollOnMount:!1,children:[S.jsx(ds,{bg:"blackAlpha.800",backdropFilter:"blur(5px)"}),S.jsx("form",{onSubmit:v(ne),children:S.jsxs(us,{bg:"gray.800",borderRadius:"xl",boxShadow:"xl",color:"white",maxW:"md",mx:4,position:"relative",zIndex:9999,sx:{isolation:"isolate","& input":{position:"relative",zIndex:1e4,isolation:"isolate"},"& *":{pointerEvents:"auto !important"}},onKeyDown:je=>{je.stopPropagation()},children:[S.jsxs(co,{p:8,textAlign:"center",children:[S.jsx(uR,{size:"lg",mb:2,color:"white",children:"Welcome Back"}),S.jsx(Ye,{fontSize:"sm",color:"gray.400",children:"Enter your credentials to access your account"})]}),S.jsx(Is,{color:"white",bg:"rgba(255,255,255,0.1)",_hover:{color:"gray.400",bg:"transparent"},borderRadius:"full",size:"sm",top:2,right:3}),S.jsx(gs,{px:8,pb:8,children:S.jsxs(Ir,{spacing:4,children:[S.jsxs(br,{isInvalid:w.email,children:[S.jsxs(Pg,{children:[S.jsx(LC,{pointerEvents:"none",children:S.jsx(GQ,{color:"gray.500"})}),S.jsx(li,{type:"email",placeholder:"Email",bg:"gray.700",border:"none",color:"white",_placeholder:{color:"gray.500"},_hover:{bg:"gray.600"},_focus:{bg:"gray.600",boxShadow:"0 0 0 1px var(--chakra-colors-blue-400)"},...y("email",{required:"Email is required."})})]}),S.jsx(hp,{children:w.email&&w.email.message})]}),S.jsxs(br,{isInvalid:w.password,children:[S.jsxs(Pg,{children:[S.jsx(LC,{pointerEvents:"none",children:S.jsx(E8e,{color:"gray.500"})}),S.jsx(li,{type:"password",placeholder:"Password",bg:"gray.700",border:"none",color:"white",_placeholder:{color:"gray.500"},_hover:{bg:"gray.600"},_focus:{bg:"gray.600",boxShadow:"0 0 0 1px var(--chakra-colors-blue-400)"},...y("password",{required:"Password is required."})})]}),S.jsx(hp,{children:w.password&&w.password.message})]}),S.jsx(ct,{alignSelf:"flex-end",children:S.jsx(Zl,{color:"blue.400",fontSize:"sm",onClick:ke,children:"Forgot Password?"})}),S.jsx(Ur,{width:"100%",justifyContent:"center",my:4,children:S.jsx(Tae,{ref:X,sitekey:Z8e,onChange:Q,theme:"dark"})})]})}),S.jsxs(uh,{px:8,pb:8,flexDirection:"column",gap:4,children:[S.jsx(Nn,{type:"submit",colorScheme:"blue",size:"lg",width:"100%",isLoading:C,loadingText:"Signing In",isDisabled:!pe,children:"Sign In"}),S.jsxs(Ye,{fontSize:"sm",color:"gray.400",textAlign:"center",children:["Don't have an account?"," ",S.jsx(Zl,{color:"blue.400",onClick:de,children:"Sign Up"})]})]})]})})]}),S.jsxs(ls,{isOpen:z,onClose:()=>J(!1),size:"md",portalProps:{containerRef:u},isCentered:!0,motionPreset:"slideInBottom",blockScrollOnMount:!1,children:[S.jsx(ds,{bg:"blackAlpha.800",backdropFilter:"blur(5px)"}),S.jsxs(us,{bg:"gray.800",borderRadius:"xl",boxShadow:"xl",color:"white",maxW:"md",mx:4,position:"relative",zIndex:9999,sx:{isolation:"isolate","& input":{position:"relative",zIndex:1e4,isolation:"isolate"},"& *":{pointerEvents:"auto !important"}},onKeyDown:je=>{je.stopPropagation()},children:[S.jsxs(co,{p:8,textAlign:"center",children:[S.jsx(uR,{size:"lg",mb:2,color:"white",children:"Reset Password"}),S.jsx(Ye,{fontSize:"sm",color:"gray.400",children:"Enter your email to receive password reset instructions"})]}),S.jsx(Is,{color:"white",bg:"rgba(255,255,255,0.1)",_hover:{color:"gray.400",bg:"transparent"},borderRadius:"full",size:"sm",top:2,right:3}),S.jsx(gs,{px:8,pb:4,children:S.jsx(br,{children:S.jsxs(Pg,{children:[S.jsx(LC,{pointerEvents:"none",children:S.jsx(GQ,{color:"gray.500"})}),S.jsx(li,{type:"email",placeholder:"Email",bg:"gray.700",border:"none",color:"white",_placeholder:{color:"gray.500"},_hover:{bg:"gray.600"},_focus:{bg:"gray.600",boxShadow:"0 0 0 1px var(--chakra-colors-blue-400)"},value:q,onChange:je=>re(je.target.value)})]})})}),S.jsxs(uh,{px:8,pb:8,flexDirection:"column",gap:4,children:[S.jsx(Nn,{colorScheme:"blue",size:"lg",width:"100%",onClick:he,isLoading:ce,loadingText:"Sending",children:"Send Reset Link"}),S.jsxs(Ye,{fontSize:"sm",color:"gray.400",textAlign:"center",children:["Remember your password?"," ",S.jsx(Zl,{color:"blue.400",onClick:()=>J(!1),children:"Back to Sign In"})]})]})]})]}),S.jsx(iD,{mode:"link",isOpen:L,onClose:()=>U(!1)})]})}sD.propTypes={mode:Tn.oneOf(["button","link"]),label:Tn.string,buttonProps:Tn.object,initialIsOpen:Tn.bool};function q3({mode:n="button",label:e="Sign Out"}){const i=Da(),{signOut:o}=O.useContext(Zi),{fullscreenRef:l}=fh(),u=async()=>{try{await o(),i({title:"Logged Out",description:"You have been successfully logged out.",status:"success",duration:3e3,isClosable:!0,position:"top",container:l.current}),window.location.href="/"}catch(y){console.error("SignOut Error:",y),i({title:"Error",description:"An error occurred while logging out.",status:"error",duration:3e3,isClosable:!0,position:"top",container:l.current})}},p=n==="link"?S.jsx(Zl,{variant:"header",onClick:u,style:{cursor:"pointer"},children:e}):null;return S.jsx(S.Fragment,{children:p})}q3.propTypes={mode:Tn.oneOf(["button","link"]),label:Tn.string};const WS=()=>window.unityInstance||window.gameInstance||window.reactUnityInstance,Y3=()=>{document.body.classList.add("unity-focused");const n=["ArrowUp","ArrowDown","ArrowLeft","ArrowRight","Space","PageUp","PageDown","Home","End"],e=o=>{if(n.includes(o.key)){const l=o.target.tagName==="INPUT"||o.target.tagName==="TEXTAREA"||o.target.isContentEditable,u=document.querySelector("canvas")||document.getElementById("unity-canvas"),p=o.target.closest("canvas")||o.target.closest("#webgl-root"),y=document.activeElement===u;!l&&(p||y)&&o.preventDefault()}},i=o=>{document.querySelector("canvas")||document.getElementById("unity-canvas"),document.getElementById("unity-container")||document.getElementById("webgl-root"),o.target.closest("canvas")||o.target.closest("#webgl-root")?document.body.classList.add("unity-focused"):document.body.classList.remove("unity-focused")};return document.addEventListener("keydown",e),document.addEventListener("click",i),()=>{document.body.classList.remove("unity-focused"),document.removeEventListener("keydown",e),document.removeEventListener("click",i)}},Rae=()=>{document.body.classList.remove("unity-focused")};function zO(n){return console.log(`Setting Unity keyboard capture: ${n}`),n?(document.body.classList.add("unity-focused"),window.unityKeyboardEnabled=!0):(document.body.classList.remove("unity-focused"),window.unityKeyboardEnabled=!1),n?Y3():Rae(),new Promise(e=>{try{const i=WS();if(i){try{n?i.SendMessage("WebGLInput","EnableKeyboardCapture"):i.SendMessage("WebGLInput","DisableKeyboardCapture"),console.log(`Unity keyboard capture ${n?"enabled":"disabled"} (using Unity preferred method)`),e(!0);return}catch(o){console.warn("Failed to use Unity preferred keyboard method, falling back to SetCaptureAllKeyboardInput",o)}try{i.SendMessage("WebGLInput","SetCaptureAllKeyboardInput",n),console.log(`Unity keyboard capture ${n?"enabled":"disabled"} (using fallback method)`),e(!0);return}catch(o){console.warn("Failed to use SetCaptureAllKeyboardInput, trying module method",o)}if(i.Module){!n&&i.Module.WebGLInputHandler&&!window._originalWebGLInputHandler&&(window._originalWebGLInputHandler=i.Module.WebGLInputHandler),n&&window._originalWebGLInputHandler?(i.Module.WebGLInputHandler=window._originalWebGLInputHandler,window._originalWebGLInputHandler=null):n||(i.Module.WebGLInputHandler=null),console.log(`Unity keyboard capture ${n?"enabled":"disabled"} (using Module method)`),e(!0);return}}else console.warn("Unity instance not available, cannot set keyboard capture"),window.__pendingKeyboardCaptureState=n,document.getElementById("webgl-root")&&(console.log("webgl-root detected, will poll for Unity instance"),KF(n)),e(!1)}catch(i){console.error("Error setting Unity keyboard capture:",i),e(!1)}})}function KF(n){window.__unityInstancePoller&&clearTimeout(window.__unityInstancePoller);const e=20;let i=0;const o=()=>{i++;const l=WS();if(l){console.log(`Unity instance found after ${i} attempts`);try{n?l.SendMessage("WebGLInput","EnableKeyboardCapture"):l.SendMessage("WebGLInput","DisableKeyboardCapture"),console.log(`Applied pending keyboard state: ${n}`),window.__pendingKeyboardCaptureState=null}catch(u){console.warn("Failed to apply pending keyboard state with preferred method, trying fallback",u);try{l.SendMessage("WebGLInput","SetCaptureAllKeyboardInput",n),console.log(`Applied pending keyboard state: ${n} (fallback method)`),window.__pendingKeyboardCaptureState=null}catch(p){console.error("Failed to apply pending keyboard state with fallback method",p)}}}else if(i<e){const u=Math.min(500*Math.pow(1.2,i),5e3);console.log(`Unity instance not found (attempt ${i}/${e}), retrying in ${u}ms`),window.__unityInstancePoller=setTimeout(o,u)}else console.warn(`Unity instance still not found after ${e} attempts, giving up`)};window.__unityInstancePoller=setTimeout(o,500)}function eWe(){const n=WS();if(!n)return!1;const e=document.querySelector("canvas")||document.getElementById("unity-canvas");return!!(e&&document.activeElement===e||n.Module&&n.Module.WebGLInputHandler)}function X0(n=!0){return console.log("Focusing Unity canvas"),n?Y3():Rae(),new Promise(e=>{try{const i=document.querySelector("canvas")||document.getElementById("unity-canvas");if(i){try{i.focus({preventScroll:!0})}catch{i.focus()}if(i.style.pointerEvents="auto",n){zO(!0).then(e);return}e(!0)}else console.warn("Unity canvas not found"),e(!1)}catch(i){console.error("Error focusing Unity canvas:",i),e(!1)}})}function If(n=!0){return console.log(`${n?"Blocking":"Unblocking"} Unity keyboard input`),Y3(),new Promise(e=>{try{if(n)zO(!1).then(i=>{var u;i&&console.log("Successfully disabled Unity keyboard capture");const o=document.querySelector("canvas")||document.getElementById("unity-canvas");o&&(o.blur(),o.style.pointerEvents="none"),window.__keyEventHandler||(window.__keyEventHandler=p=>{window.__blockKeyboardInput&&!["INPUT","TEXTAREA","SELECT"].includes(p.target.tagName)&&p.stopPropagation()},document.addEventListener("keydown",window.__keyEventHandler,!0),document.addEventListener("keyup",window.__keyEventHandler,!0),document.addEventListener("keypress",window.__keyEventHandler,!0)),window.__blockKeyboardInput=!0;const l=WS();(u=l==null?void 0:l.Module)!=null&&u.WebGLInputHandler&&(window._savedWebGLInputHandler=l.Module.WebGLInputHandler,l.Module.WebGLInputHandler=null),e(!0)});else{window.__blockKeyboardInput=!1,window.__keyEventHandler&&(document.removeEventListener("keydown",window.__keyEventHandler,!0),document.removeEventListener("keyup",window.__keyEventHandler,!0),document.removeEventListener("keypress",window.__keyEventHandler,!0),window.__keyEventHandler=null);const i=WS();i!=null&&i.Module&&window._savedWebGLInputHandler&&(i.Module.WebGLInputHandler=window._savedWebGLInputHandler,window._savedWebGLInputHandler=null);const o=document.querySelector("canvas")||document.getElementById("unity-canvas");o&&(o.style.pointerEvents="auto"),zO(!0).then(l=>{l&&console.log("Successfully re-enabled Unity keyboard capture"),e(!0)})}}catch(i){console.error("Error in blockUnityKeyboardInput:",i),e(!1)}})}function tWe(n){if(n){if(console.log("Registering Unity instance"),window.unityInstance=n,typeof window.__pendingKeyboardCaptureState=="boolean")try{const e=window.__pendingKeyboardCaptureState;console.log(`Applying pending keyboard state: ${e}`);try{e?n.SendMessage("WebGLInput","EnableKeyboardCapture"):n.SendMessage("WebGLInput","DisableKeyboardCapture"),console.log(`Applied pending keyboard state: ${e} (Unity preferred method)`),window.__pendingKeyboardCaptureState=null}catch(i){console.warn("Failed to apply pending keyboard state with preferred method, trying fallback",i);try{n.SendMessage("WebGLInput","SetCaptureAllKeyboardInput",e),console.log(`Applied pending keyboard state: ${e} (fallback method)`),window.__pendingKeyboardCaptureState=null}catch(o){console.error("Failed to apply pending keyboard state with fallback method",o)}}}catch(e){console.error("Error applying pending keyboard state:",e)}window.__unityInstancePoller&&(clearTimeout(window.__unityInstancePoller),window.__unityInstancePoller=null)}}function nWe(){if(console.log("Initializing Unity keyboard helpers"),window.setUnityKeyboardCapture=zO,window.focusUnity=X0,window.blockUnityKeyboardInput=If,window.hasUnityKeyboardFocus=eWe,window.getUnityInstance=WS,window.registerUnityInstance=tWe,document.getElementById("webgl-root")){const n=new MutationObserver(e=>{for(const i of e)if(i.addedNodes.length)for(let o=0;o<i.addedNodes.length;o++){const l=i.addedNodes[o];if(l.nodeName==="CANVAS"||l.querySelector&&l.querySelector("canvas")){console.log("Canvas detected, Unity might be loading. Setting up instance detection."),KF(!0),n.disconnect();break}}});n.observe(document.body,{childList:!0,subtree:!0}),document.querySelector("canvas")&&(console.log("Canvas already exists, Unity might be loaded. Starting instance detection."),KF(!0))}if(typeof window<"u"&&typeof require=="function")try{const n=require("react");window.useUnityKeyboardFocus=function(){const[i,o]=n.useState(!1);return n.useEffect(()=>(i?(console.log("useUnityKeyboardFocus: Blocking Unity keyboard input"),If(!0),window.dispatchEvent(new CustomEvent("modal-opened"))):(console.log("useUnityKeyboardFocus: Unblocking Unity keyboard input"),If(!1),window.dispatchEvent(new CustomEvent("modal-closed"))),()=>{i&&(console.log("useUnityKeyboardFocus: Cleanup - unblocking Unity keyboard input"),If(!1),window.dispatchEvent(new CustomEvent("modal-closed")))}),[i]),[i,o]},console.log("Created useUnityKeyboardFocus hook globally")}catch(n){console.warn("Could not create React hook, React might not be available yet:",n)}}typeof window<"u"&&setTimeout(nWe,0);const rWe=({isOpen:n,onClose:e,user:i,profileImageUrl:o})=>{const[l,u]=O.useState(!1),[p,y]=O.useState({Nickname:(i==null?void 0:i.Nickname)||"",username:(i==null?void 0:i.username)||"",companyName:(i==null?void 0:i.companyName)||"",firstName:(i==null?void 0:i.firstName)||"",lastName:(i==null?void 0:i.lastName)||"",linkedInProfile:(i==null?void 0:i.linkedInProfile)||""}),[v,w]=O.useState(!1),[C,R]=O.useState(!1),[N,M]=O.useState(""),[L,U]=O.useState(!1),z=Da(),{sendUserToUnity:J,updateUser:q}=O.useContext(Zi),re=O.useRef(null);O.useEffect(()=>{y({Nickname:(i==null?void 0:i.Nickname)||"",username:(i==null?void 0:i.username)||"",companyName:(i==null?void 0:i.companyName)||"",firstName:(i==null?void 0:i.firstName)||"",lastName:(i==null?void 0:i.lastName)||"",linkedInProfile:(i==null?void 0:i.linkedInProfile)||""})},[i]),O.useEffect(()=>(n?(console.log("ProfileModal: Modal opened, blocking Unity keyboard input"),If(!0),window.dispatchEvent(new CustomEvent("modal-opened"))):(console.log("ProfileModal: Modal closed, unblocking Unity keyboard input"),If(!1).then(()=>{setTimeout(()=>{X0(!0)},100)}),window.dispatchEvent(new CustomEvent("modal-closed"))),()=>{n&&(console.log("ProfileModal: Cleanup on unmount, unblocking Unity keyboard input"),If(!1),window.dispatchEvent(new CustomEvent("modal-closed")))}),[n]),O.useEffect(()=>{if(l&&re.current){const Q=()=>{re.current.focus(),R(!0),If(!0)};Q();const ne=setTimeout(Q,100),he=setTimeout(Q,300);return()=>{clearTimeout(ne),clearTimeout(he)}}else R(!1)},[l]),O.useEffect(()=>{const ne=setTimeout(async()=>{if(p.username&&p.username!==(i==null?void 0:i.username)){U(!0),M("");try{if(!/^[a-z0-9]{1,15}$/.test(p.username)){M("Username must be 1-15 characters, lowercase letters and numbers only"),U(!1);return}Zu(p.username),await vR(p.username)&&M("Username is already taken")}catch(he){K.error("Error checking username:",he),M("Error checking username availability")}finally{U(!1)}}},500);return()=>clearTimeout(ne)},[p.username,i==null?void 0:i.username]);const ce=()=>{u(!1),R(!1),e()},ae=Q=>{const{name:ne,value:he}=Q.target;if(ne==="username"){const fe=he.toLowerCase().replace(/[^a-z0-9]/g,"");y(de=>({...de,[ne]:fe}))}else y(fe=>({...fe,[ne]:he}))},pe=async()=>{if(p.Nickname.trim()===""){z({title:"Error",description:"Display Name cannot be empty",status:"error",duration:3e3,isClosable:!0});return}if(Zu(p.Nickname),p.firstName&&Zu(p.firstName),p.lastName&&Zu(p.lastName),p.companyName&&Zu(p.companyName),N){z({title:"Error",description:N,status:"error",duration:3e3,isClosable:!0});return}w(!0);try{if(p.username!==i.username&&(Zu(p.username),await vR(p.username))){M("Username is already taken"),z({title:"Error",description:"Username is already taken",status:"error",duration:3e3,isClosable:!0}),w(!1);return}const Q=wr(Yn,"users",i.uid);if(p.username!==i.username)try{if(K.log("ProfileModal: Updating username from",i.username,"to",p.username),!await z6e(i.uid,p.username))throw new Error("Failed to update username");K.log("ProfileModal: Username updated successfully")}catch(ne){K.error("Error updating username:",ne),z({title:"Error",description:"Failed to update username: "+(ne.message||"Please try again"),status:"error",duration:3e3,isClosable:!0}),w(!1);return}K.log("ProfileModal: Updating user profile");try{const ne={Nickname:p.Nickname,companyName:p.companyName,firstName:p.firstName,lastName:p.lastName,linkedInProfile:p.linkedInProfile,username:p.username,lastUpdated:new Date().toISOString()};await lo(Q,ne),K.log("ProfileModal: Profile updated successfully");const he=Boe(Q,fe=>{if(fe.exists()&&fe.data().Nickname===p.Nickname){try{J()}catch(ke){K.error("Error sending user to Unity:",ke)}he()}},fe=>{K.error("Error in profile update listener:",fe)});try{await q()}catch(fe){K.error("Error updating user context:",fe)}y({Nickname:p.Nickname,username:p.username,companyName:p.companyName,firstName:p.firstName,lastName:p.lastName,linkedInProfile:p.linkedInProfile}),z({title:"Success",description:"Profile updated successfully",status:"success",duration:3e3,isClosable:!0}),u(!1)}catch(ne){K.error("Error updating profile data:",ne),z({title:"Error",description:"Failed to update profile: "+(ne.message||"Please try again"),status:"error",duration:3e3,isClosable:!0})}}catch(Q){K.error("Error in handleSave:",Q),z({title:"Error",description:"An unexpected error occurred: "+(Q.message||"Please try again"),status:"error",duration:3e3,isClosable:!0})}finally{w(!1)}},H=()=>S.jsxs(Ir,{spacing:4,align:"stretch",w:"100%",children:[S.jsxs(Ur,{direction:"column",align:"center",gap:2,children:[S.jsx(Ye,{fontSize:"2xl",fontWeight:"bold",children:i.Nickname}),S.jsxs(Ye,{fontSize:"md",color:"gray.400",children:["@",i.username]})]}),S.jsxs(Ir,{spacing:3,align:"stretch",bg:"gray.700",p:4,borderRadius:"md",children:[S.jsxs(Ur,{direction:"column",children:[S.jsx(Ye,{color:"gray.400",fontSize:"sm",children:"Company"}),S.jsx(Ye,{children:i.companyName||"Not specified"})]}),S.jsxs(Ur,{direction:"column",children:[S.jsx(Ye,{color:"gray.400",fontSize:"sm",children:"Full Name"}),S.jsx(Ye,{children:`${i.firstName||""} ${i.lastName||""}`.trim()||"Not specified"})]}),S.jsxs(Ur,{direction:"column",children:[S.jsx(Ye,{color:"gray.400",fontSize:"sm",children:"LinkedIn"}),S.jsx(Ye,{children:i.linkedInProfile||"Not specified"})]})]}),S.jsx(Nn,{onClick:()=>u(!0),size:"sm",variant:"outline",_hover:{bg:"gray.700"},color:"white",borderColor:"gray.600",children:"Edit Profile"})]}),X=()=>S.jsxs(Ir,{spacing:4,align:"stretch",w:"100%",children:[S.jsxs(br,{children:[S.jsx(gi,{color:"gray.400",fontSize:"sm",children:"Display Name"}),S.jsx(li,{ref:re,name:"Nickname",value:p.Nickname,onChange:ae,onFocus:()=>{R(!0),If(!0)},placeholder:"Enter display name",bg:"gray.700",border:"none",color:"white",_placeholder:{color:"gray.500"},_hover:{bg:"gray.600"},_focus:{bg:"gray.600",boxShadow:"0 0 0 1px var(--chakra-colors-blue-400)"},maxLength:15})]}),S.jsxs(br,{isInvalid:!!N,children:[S.jsx(gi,{color:"gray.400",fontSize:"sm",children:"Username"}),S.jsxs(Pg,{children:[S.jsx(dN,{bg:"gray.700",color:"gray.400",border:"none",children:"@"}),S.jsx(li,{name:"username",value:p.username,onChange:ae,placeholder:"username",bg:"gray.700",border:"none",color:"white",_placeholder:{color:"gray.500"},_hover:{bg:"gray.600"},_focus:{bg:"gray.600",boxShadow:"0 0 0 1px var(--chakra-colors-blue-400)"},maxLength:15,isDisabled:L})]}),N&&S.jsx(Ye,{color:"red.400",fontSize:"sm",mt:1,children:N}),S.jsx(Hy,{color:"gray.400",children:"Lowercase letters and numbers only, max 15 characters"})]}),S.jsxs(br,{children:[S.jsx(gi,{color:"gray.400",fontSize:"sm",children:"Company Name"}),S.jsx(li,{name:"companyName",value:p.companyName,onChange:ae,placeholder:"Enter company name",bg:"gray.700",border:"none",color:"white",_placeholder:{color:"gray.500"},_hover:{bg:"gray.600"},_focus:{bg:"gray.600",boxShadow:"0 0 0 1px var(--chakra-colors-blue-400)"}})]}),S.jsxs(Ur,{gap:4,children:[S.jsxs(br,{children:[S.jsx(gi,{color:"gray.400",fontSize:"sm",children:"First Name"}),S.jsx(li,{name:"firstName",value:p.firstName,onChange:ae,placeholder:"Enter first name",bg:"gray.700",border:"none",color:"white",_placeholder:{color:"gray.500"},_hover:{bg:"gray.600"},_focus:{bg:"gray.600",boxShadow:"0 0 0 1px var(--chakra-colors-blue-400)"}})]}),S.jsxs(br,{children:[S.jsx(gi,{color:"gray.400",fontSize:"sm",children:"Last Name"}),S.jsx(li,{name:"lastName",value:p.lastName,onChange:ae,placeholder:"Enter last name",bg:"gray.700",border:"none",color:"white",_placeholder:{color:"gray.500"},_hover:{bg:"gray.600"},_focus:{bg:"gray.600",boxShadow:"0 0 0 1px var(--chakra-colors-blue-400)"}})]})]}),S.jsxs(br,{children:[S.jsx(gi,{color:"gray.400",fontSize:"sm",children:"LinkedIn Profile"}),S.jsx(li,{name:"linkedInProfile",value:p.linkedInProfile,onChange:ae,placeholder:"Enter LinkedIn profile URL",bg:"gray.700",border:"none",color:"white",_placeholder:{color:"gray.500"},_hover:{bg:"gray.600"},_focus:{bg:"gray.600",boxShadow:"0 0 0 1px var(--chakra-colors-blue-400)"}})]}),S.jsxs(Ur,{gap:2,justify:"flex-end",mt:2,children:[S.jsx(Nn,{onClick:()=>{y({Nickname:(i==null?void 0:i.Nickname)||"",username:(i==null?void 0:i.username)||"",companyName:(i==null?void 0:i.companyName)||"",firstName:(i==null?void 0:i.firstName)||"",lastName:(i==null?void 0:i.lastName)||"",linkedInProfile:(i==null?void 0:i.linkedInProfile)||""}),u(!1),M("")},variant:"outline",size:"sm",isDisabled:v,color:"white",borderColor:"gray.600",_hover:{bg:"gray.700"},children:"Cancel"}),S.jsx(Nn,{onClick:pe,colorScheme:"blue",size:"sm",isLoading:v||L,isDisabled:!!N||L,children:"Save Changes"})]})]});return S.jsxs(ls,{isOpen:n,onClose:ce,isCentered:!0,closeOnOverlayClick:!l,trapFocus:!0,blockScrollOnMount:!1,size:"md",children:[S.jsx(ds,{bg:"rgba(0, 0, 0, 0.8)",backdropFilter:"blur(8px)"}),S.jsxs(us,{bg:"#1a1a1a",color:"white",borderRadius:"xl",border:"1px solid #333",children:[S.jsx(co,{fontSize:"md",fontWeight:"600",pb:1,pt:3,px:4,color:"white",children:"Profile"}),S.jsx(Is,{color:"white",bg:"rgba(255,255,255,0.1)",_hover:{color:"gray.400",bg:"transparent"},borderRadius:"full",size:"sm",top:2,right:3}),S.jsx(gs,{pb:6,children:S.jsxs(Ir,{spacing:6,children:[S.jsx(ml,{src:o,size:"2xl",borderRadius:"full"}),l?X():H(),!l&&S.jsx(Nn,{variant:"ghost",size:"sm",colorScheme:"blue",width:"100%",onClick:()=>window.open("https://support.spacesmetaverse.com/","_blank"),children:"Visit Support Site"})]})})]})]})},pk={bg:"white",color:"black",borderRadius:"full",px:"6",py:"2",height:"auto",fontSize:"md",fontWeight:"medium",_hover:{bg:"gray.100"},display:"flex",alignItems:"center",gap:2},Iae=()=>{var C;const{user:n,updateUser:e}=O.useContext(Zi),[i,o]=O.useState(!0),{isOpen:l,onOpen:u,onClose:p}=od();O.useEffect(()=>{const R=setTimeout(()=>{o(!1)},500);return()=>clearTimeout(R)},[]);const y=()=>{p(),e()},v=n!=null&&n.rpmURL?n.rpmURL.replace(".glb",".png?scene=fullbody-portrait-closeupfront&w=640&q=75"):null,w=(C=n==null?void 0:n.groups)==null?void 0:C.includes("disruptiveAdmin");return i?null:S.jsx(Ur,{align:"center",gap:"4",children:n?S.jsxs(S.Fragment,{children:[S.jsx(rWe,{isOpen:l,onClose:y,user:n,profileImageUrl:v}),S.jsxs(VR,{children:[S.jsx(FR,{as:ct,cursor:"pointer",children:S.jsx(Ur,{align:"center",height:"40px",px:4,borderRadius:"full",border:"1px solid rgba(255, 255, 255, 0.3)",transition:"all 0.2s",sx:{"&:hover":{border:"2px solid white"}},children:S.jsxs(Ur,{align:"center",gap:"3",children:[S.jsx(ct,{width:"28px",height:"28px",borderRadius:"full",overflow:"hidden",bg:"white",display:"flex",alignItems:"center",justifyContent:"center",children:S.jsx(ml,{src:v,width:"100%",height:"100%",borderRadius:"full"})}),S.jsx(Ye,{color:"white",fontWeight:"medium",children:n.Nickname}),S.jsx(ct,{display:"flex",alignItems:"center",height:"28px",children:S.jsx(fae,{color:"white",w:4,h:4})})]})})}),S.jsx(Nc,{children:S.jsxs(jR,{bg:"gray.800",borderColor:"gray.700",zIndex:9999,children:[S.jsxs(ct,{p:4,display:"flex",alignItems:"center",gap:3,children:[S.jsx(ml,{src:v,size:"md",borderRadius:"full"}),S.jsx(Ye,{fontSize:"xl",fontWeight:"bold",color:"white",children:n.Nickname})]}),S.jsx(Ug,{borderColor:"gray.700"}),w&&S.jsx(mp,{as:"a",href:"/myadmin",_hover:{bg:"gray.700"},color:"white",bg:"gray.800",children:"My Admin"}),S.jsx(mp,{_hover:{bg:"gray.700"},color:"white",bg:"gray.800",children:"My Spaces"}),S.jsx(mp,{onClick:u,_hover:{bg:"gray.700"},color:"white",bg:"gray.800",children:"View Profile"}),S.jsx(Ug,{borderColor:"gray.700"}),S.jsx(mp,{_hover:{bg:"gray.700"},color:"white",bg:"gray.800",children:"Support"}),S.jsx(mp,{_hover:{bg:"gray.700"},color:"white",bg:"gray.800",children:S.jsx(q3,{mode:"link",label:"Log out",linkProps:{color:"white",_hover:{textDecoration:"none"}}})})]})})]})]}):S.jsxs(S.Fragment,{children:[S.jsx(iD,{mode:"button",label:"Register",buttonProps:{...pk,width:["100%","auto"]},customButton:S.jsxs(Nn,{...pk,children:[S.jsx(ct,{as:"span",fontSize:"xl",children:""}),"Register"]})}),S.jsx(sD,{mode:"button",label:"Sign In",buttonProps:{...pk,width:["100%","auto"]},customButton:S.jsxs(Nn,{...pk,children:[S.jsx(ct,{as:"span",fontSize:"xl",children:""}),"Sign In"]})})]})})},iWe=()=>{const{registrationInProgress:n}=g8e();return n?S.jsxs(ls,{isOpen:!0,onClose:()=>{},closeOnEsc:!1,closeOnOverlayClick:!1,isCentered:!0,motionPreset:"none",size:"full",children:[S.jsx(ds,{bg:"rgba(0,0,0,0.8)",backdropFilter:"blur(8px)"}),S.jsx(us,{bg:"transparent",boxShadow:"none",maxW:"100%",maxH:"100%",display:"flex",alignItems:"center",justifyContent:"center",children:S.jsxs(Ur,{direction:"column",align:"center",justify:"center",p:8,maxW:"md",textAlign:"center",children:[S.jsx(ld,{size:"xl",thickness:"4px",speed:"0.8s",color:"blue.400",mb:6}),S.jsx(Ye,{fontSize:"2xl",fontWeight:"bold",color:"white",mb:4,children:"Creating Your Account"}),S.jsx(Ye,{fontSize:"md",color:"gray.300",mb:3,children:"Please wait while we set up your profile with Spaces Metaverse"}),S.jsx(Ye,{fontSize:"sm",color:"gray.400",mb:1,children:"This typically takes 5-10 seconds to complete"}),S.jsx(Ye,{fontSize:"sm",color:"gray.400",children:"Please do not refresh or close this page"})]})})]}):null},dV=document.getElementById("header-auth-root");if(dV){const n=dV.getAttribute("data-theme")||"default",e=()=>{const[i,o]=O.useState(null);return O.useEffect(()=>{dR(n).then(o)},[]),i?S.jsx(uN,{theme:i,children:S.jsx(eD,{children:S.jsxs(W3,{children:[S.jsx(Iae,{}),S.jsx(iWe,{})]})})}):S.jsx("div",{children:"Loading theme..."})};GO.createRoot(dV).render(S.jsx(e,{}))}else console.error("Root element 'header-auth-root' not found.");var hV={},wf={},XT={},tZ;function sWe(){if(tZ)return XT;tZ=1,Object.defineProperty(XT,"__esModule",{value:!0}),XT.useCanvasIdentifier=void 0;var n=Jf(),e=0,i="react-unity-webgl-canvas",o=function(l){var u=(0,n.useState)(0),p=u[0],y=u[1],v=(0,n.useCallback)(function(){y(function(C){return C+1})},[]);if(l!==void 0)return[l,v];var w=(0,n.useMemo)(function(){return[i,e].join("-")},[p]);return[w,v]};return XT.useCanvasIdentifier=o,XT}var JT={},QT={},nZ;function Aae(){return nZ||(nZ=1,Object.defineProperty(QT,"__esModule",{value:!0}),QT.isBrowserEnvironment=void 0,QT.isBrowserEnvironment=typeof window<"u"&&typeof document<"u"),QT}var rZ;function oWe(){if(rZ)return JT;rZ=1,Object.defineProperty(JT,"__esModule",{value:!0}),JT.useUnityLoader=void 0;var n=Jf(),e=Aae(),i=function(o){var l=(0,n.useState)("Loading"),u=l[0],p=l[1];return(0,n.useEffect)(function(){if(e.isBrowserEnvironment!==!1){if(o===null){p("Idle");return}var y=window.document.querySelector('script[src="'.concat(o,'"]'));y===null?(y=window.document.createElement("script"),y.type="text/javascript",y.src=o,y.async=!0,y.setAttribute("data-status","loading"),window.document.body.appendChild(y),y.addEventListener("load",function(){return y==null?void 0:y.setAttribute("data-status","loaded")}),y.addEventListener("error",function(){return y==null?void 0:y.setAttribute("data-status","error")})):p(y.getAttribute("data-status")==="loaded"?"Loaded":"Error");var v=function(w){return p(w.type==="load"?"Loaded":"Error")};return y.addEventListener("load",v),y.addEventListener("error",v),function(){y!==null&&(y.removeEventListener("load",v),y.removeEventListener("error",v),y.remove())}}},[o]),u};return JT.useUnityLoader=i,JT}var iZ;function aWe(){if(iZ)return wf;iZ=1;var n=wf&&wf.__awaiter||function(p,y,v,w){function C(R){return R instanceof v?R:new v(function(N){N(R)})}return new(v||(v=Promise))(function(R,N){function M(z){try{U(w.next(z))}catch(J){N(J)}}function L(z){try{U(w.throw(z))}catch(J){N(J)}}function U(z){z.done?R(z.value):C(z.value).then(M,L)}U((w=w.apply(p,y||[])).next())})},e=wf&&wf.__generator||function(p,y){var v={label:0,sent:function(){if(R[0]&1)throw R[1];return R[1]},trys:[],ops:[]},w,C,R,N=Object.create((typeof Iterator=="function"?Iterator:Object).prototype);return N.next=M(0),N.throw=M(1),N.return=M(2),typeof Symbol=="function"&&(N[Symbol.iterator]=function(){return this}),N;function M(U){return function(z){return L([U,z])}}function L(U){if(w)throw new TypeError("Generator is already executing.");for(;N&&(N=0,U[0]&&(v=0)),v;)try{if(w=1,C&&(R=U[0]&2?C.return:U[0]?C.throw||((R=C.return)&&R.call(C),0):C.next)&&!(R=R.call(C,U[1])).done)return R;switch(C=0,R&&(U=[U[0]&2,R.value]),U[0]){case 0:case 1:R=U;break;case 4:return v.label++,{value:U[1],done:!1};case 5:v.label++,C=U[1],U=[0];continue;case 7:U=v.ops.pop(),v.trys.pop();continue;default:if(R=v.trys,!(R=R.length>0&&R[R.length-1])&&(U[0]===6||U[0]===2)){v=0;continue}if(U[0]===3&&(!R||U[1]>R[0]&&U[1]<R[3])){v.label=U[1];break}if(U[0]===6&&v.label<R[1]){v.label=R[1],R=U;break}if(R&&v.label<R[2]){v.label=R[2],v.ops.push(U);break}R[2]&&v.ops.pop(),v.trys.pop();continue}U=y.call(p,v)}catch(z){U=[6,z],C=0}finally{w=R=0}if(U[0]&5)throw U[1];return{value:U[0]?U[1]:void 0,done:!0}}};Object.defineProperty(wf,"__esModule",{value:!0}),wf.Unity=void 0;var i=Jf(),o=sWe(),l=oWe(),u=(0,i.forwardRef)(function(p,y){var v=(0,i.useState)(null),w=v[0],C=v[1],R=(0,i.useState)(null),N=R[0],M=R[1],L=(0,o.useCanvasIdentifier)(p.id),U=L[0],z=L[1],J=(0,l.useUnityLoader)(p.unityProvider.loaderUrl),q=(0,i.useCallback)(function(re){p.unityProvider.setLoadingProgression(re),re===1&&p.unityProvider.setIsLoaded(!0)},[p.unityProvider]);return(0,i.useEffect)(function(){var re=function(){return n(void 0,void 0,void 0,function(){var ae,pe,H,X,Q;return e(this,function(ne){switch(ne.label){case 0:if(!w||N||J!=="Loaded")return[2];console.log("React Unity WebGL: Initializing Unity instance..."),p.unityProvider.setUnityInstance(null),M(null),p.unityProvider.setLoadingProgression(0),(Q=(X=p.unityProvider).setIsLoaded)===null||Q===void 0||Q.call(X,!1),p.unityProvider.setInitialisationError(void 0),z(),ae={companyName:p.unityProvider.companyName,productName:p.unityProvider.productName,productVersion:p.unityProvider.productVersion,dataUrl:p.unityProvider.dataUrl,frameworkUrl:p.unityProvider.frameworkUrl,codeUrl:p.unityProvider.codeUrl,workerUrl:p.unityProvider.workerUrl,memoryUrl:p.unityProvider.memoryUrl,symbolsUrl:p.unityProvider.symbolsUrl,streamingAssetsUrl:p.unityProvider.streamingAssetsUrl,devicePixelRatio:p.devicePixelRatio,webglContextAttributes:p.unityProvider.webglContextAttributes,cacheControl:p.unityProvider.cacheControl,autoSyncPersistentDataPath:p.unityProvider.autoSyncPersistentDataPath,matchWebGLToCanvasSize:p.matchWebGLToCanvasSize,disabledCanvasEvents:p.disabledCanvasEvents},Object.keys(ae).forEach(function(he){(ae[he]===null||ae[he]===void 0)&&delete ae[he]}),ne.label=1;case 1:return ne.trys.push([1,3,,4]),[4,window.createUnityInstance(w,ae,q)];case 2:return pe=ne.sent(),M(pe),p.unityProvider.setUnityInstance(pe),[3,4];case 3:return H=ne.sent(),console.error("React Unity WebGL: Error initializing Unity instance:",H),p.unityProvider.setInitialisationError(H),[3,4];case 4:return[2]}})})},ce=function(){return n(void 0,void 0,void 0,function(){var ae,pe,H;return e(this,function(X){switch(X.label){case 0:return!N||!w?[2]:(console.log("React Unity WebGL: Detaching Unity instance..."),p.unityProvider.setUnityInstance(null),M(null),p.unityProvider.setLoadingProgression(0),(H=(pe=p.unityProvider).setIsLoaded)===null||H===void 0||H.call(pe,!1),p.unityProvider.setInitialisationError(void 0),ae=document.createElement("canvas"),ae.id=w.id,ae.setAttribute("react-unity-webgl-role","cleanup"),ae.style.display="none",document.body.appendChild(ae),N.Module.canvas=ae,M(null),[4,N.Quit()]);case 1:return X.sent(),document.body.removeChild(ae),[2]}})})};return re(),function(){ce()}},[w,N,J,p.unityProvider]),(0,i.useImperativeHandle)(y,function(){return w}),(0,i.createElement)("canvas",{ref:C,id:U,style:p.style,className:p.className,tabIndex:p.tabIndex})});return wf.Unity=u,wf}var ZT={},Cy={},sZ;function cWe(){if(sZ)return Cy;sZ=1;var n=Cy&&Cy.__spreadArray||function(p,y,v){if(v||arguments.length===2)for(var w=0,C=y.length,R;w<C;w++)(R||!(w in y))&&(R||(R=Array.prototype.slice.call(y,0,w)),R[w]=y[w]);return p.concat(R||Array.prototype.slice.call(y))};Object.defineProperty(Cy,"__esModule",{value:!0}),Cy.useEventSystem=void 0;var e=Jf(),i=Aae(),o=[],l=function(p){for(var y=[],v=1;v<arguments.length;v++)y[v-1]=arguments[v];var w=void 0;return o.forEach(function(C){w=C.apply(void 0,n([p],y,!1))}),w};i.isBrowserEnvironment===!0&&(window.dispatchReactUnityEvent=l);var u=function(){var p=(0,e.useRef)([]),y=(0,e.useCallback)(function(C,R){p.current=n(n([],p.current,!0),[{eventName:C,callback:R}],!1)},[p]),v=(0,e.useCallback)(function(C,R){p.current=p.current.filter(function(N){return N.eventName!==C&&N.callback!==R})},[p]),w=(0,e.useCallback)(function(C){for(var R=[],N=1;N<arguments.length;N++)R[N-1]=arguments[N];var M=p.current.find(function(L){return L.eventName===C});if(!(typeof M>"u"))return M.callback.apply(M,R)},[p]);return(0,e.useEffect)(function(){return o.push(w),function(){o.splice(o.indexOf(w),1)}},[w]),{addEventListener:y,removeEventListener:v}};return Cy.useEventSystem=u,Cy}var oZ;function lWe(){if(oZ)return ZT;oZ=1,Object.defineProperty(ZT,"__esModule",{value:!0}),ZT.useUnityContext=void 0;var n=Jf(),e=cWe(),i=function(o){var l=(0,n.useState)(null),u=l[0],p=l[1],y=(0,n.useState)(0),v=y[0],w=y[1],C=(0,n.useState)(!1),R=C[0],N=C[1],M=(0,n.useState)(),L=M[0],U=M[1],z=(0,e.useEventSystem)(),J=(0,n.useRef)({companyName:o.companyName,productName:o.productName,productVersion:o.productVersion,codeUrl:o.codeUrl,dataUrl:o.dataUrl,frameworkUrl:o.frameworkUrl,loaderUrl:o.loaderUrl,memoryUrl:o.memoryUrl,symbolsUrl:o.symbolsUrl,streamingAssetsUrl:o.streamingAssetsUrl,workerUrl:o.workerUrl,webglContextAttributes:o.webglContextAttributes,cacheControl:o.cacheControl,autoSyncPersistentDataPath:o.autoSyncPersistentDataPath,setUnityInstance:p,setLoadingProgression:w,setIsLoaded:N,setInitialisationError:U}),q=(0,n.useCallback)(function(X){return u==null?void 0:u.SetFullscreen(X?1:0)},[u]),re=(0,n.useCallback)(function(){var X;return(X=u==null?void 0:u.Module.canvas)===null||X===void 0?void 0:X.requestPointerLock()},[u]),ce=(0,n.useCallback)(function(X,Q,ne){return u==null?void 0:u.SendMessage(X,Q,ne)},[u]),ae=(0,n.useCallback)(function(X,Q){var ne;return(ne=u==null?void 0:u.Module.canvas)===null||ne===void 0?void 0:ne.toDataURL(X,Q)},[u]),pe=(0,n.useCallback)(function(){var X;return(X=u==null?void 0:u.Quit())!==null&&X!==void 0?X:Promise.reject()},[u]),H=(0,n.useCallback)(function(){var X;return(X=u==null?void 0:u.GetMetricsInfo)===null||X===void 0?void 0:X.call(u)},[u]);return{unityProvider:J.current,loadingProgression:v,isLoaded:R,initialisationError:L,requestFullscreen:q,requestPointerLock:re,sendMessage:ce,takeScreenshot:ae,unload:pe,getMetricsInfo:H,addEventListener:z.addEventListener,removeEventListener:z.removeEventListener,UNSAFE__unityInstance:u}};return ZT.useUnityContext=i,ZT}var eC={},aZ;function uWe(){if(aZ)return eC;aZ=1,Object.defineProperty(eC,"__esModule",{value:!0}),eC.useUnityMetricsInfo=void 0;var n=Jf(),e=function(i,o){var l=(0,n.useState)({}),u=l[0],p=l[1];return(0,n.useEffect)(function(){var y=setInterval(function(){var v=i();typeof v>"u"||p(v)},o.interval||1e3);return function(){clearInterval(y)}},[i,o.interval]),u};return eC.useUnityMetricsInfo=e,eC}var cZ;function dWe(){return cZ||(cZ=1,function(n){Object.defineProperty(n,"__esModule",{value:!0}),n.useUnityMetricsInfo=n.useUnityContext=n.Unity=void 0;var e=aWe();Object.defineProperty(n,"Unity",{enumerable:!0,get:function(){return e.Unity}});var i=lWe();Object.defineProperty(n,"useUnityContext",{enumerable:!0,get:function(){return i.useUnityContext}});var o=uWe();Object.defineProperty(n,"useUnityMetricsInfo",{enumerable:!0,get:function(){return o.useUnityMetricsInfo}})}(hV)),hV}var Pae=dWe();const rh="[UnityProvider]",qF=O.createContext(),hWe=({spaceID:n,children:e,loaderUrl:i,dataUrl:o,frameworkUrl:l,codeUrl:u,loadingBackground:p,showLoginButton:y,showDisruptiveLogo:v})=>{K.log(`${rh} Initializing with spaceID:`,n),K.log(`${rh} Unity URLs:`,{loaderUrl:i,dataUrl:o,frameworkUrl:l,codeUrl:u});const{unityProvider:w,loadingProgression:C,isLoaded:R,sendMessage:N,addEventListener:M,removeEventListener:L,error:U}=Pae.useUnityContext({loaderUrl:i,dataUrl:o,frameworkUrl:l,codeUrl:u}),z={unityProvider:w,loadingProgression:C,isLoaded:R,sendMessage:N,addEventListener:M,removeEventListener:L,error:U,spaceID:n},J=O.useRef(null),q=O.useRef(Date.now());O.useEffect(()=>{const pe=()=>{document.hidden?(K.log(`${rh} Page hidden, starting keep-alive`),re()):(K.log(`${rh} Page visible, stopping keep-alive`),ce())};return document.addEventListener("visibilitychange",pe),()=>{document.removeEventListener("visibilitychange",pe),ce()}},[]),O.useEffect(()=>{const pe=()=>{q.current=Date.now(),document.hidden&&N("WebGLInputManager","KeepAlive")};return window.addEventListener("mousemove",pe),window.addEventListener("keydown",pe),window.addEventListener("touchstart",pe),()=>{window.removeEventListener("mousemove",pe),window.removeEventListener("keydown",pe),window.removeEventListener("touchstart",pe)}},[N]);const re=()=>{J.current||(J.current=setInterval(()=>{R&&document.hidden&&(N("WebGLInputManager","KeepAlive"),K.debug(`${rh} Sent keep-alive message`))},1e4))},ce=()=>{J.current&&(clearInterval(J.current),J.current=null)};O.useEffect(()=>(K.log(`${rh} Component mounted`),()=>{K.log(`${rh} Component unmounting`),ce()}),[]),O.useEffect(()=>{K.log(`${rh} Loading progress:`,C)},[C]),O.useEffect(()=>{R&&(K.log(`${rh} Unity instance loaded for:`,n),document.hidden&&re())},[R,n]),O.useEffect(()=>{U&&K.error(`${rh} Unity error:`,U)},[U]),K.log(`${rh} Rendering provider with instance:`,z),O.useEffect(()=>{K.log("UnityProvider: Unity build URLs:",{loaderUrl:i,dataUrl:o,frameworkUrl:l,codeUrl:u})},[i,o,l,u]);const ae=[];if(i||ae.push("loaderUrl"),o||ae.push("dataUrl"),l||ae.push("frameworkUrl"),u||ae.push("codeUrl"),ae.length>0)return K.error(`UnityProvider: Missing required Unity build URLs: ${ae.join(", ")}`),S.jsx(qF.Provider,{value:{unityProvider:null,loadingProgression:0,isLoaded:!1,sendMessage:()=>{},addEventListener:()=>{},removeEventListener:()=>{},error:new Error(`Missing required Unity build URLs: ${ae.join(", ")}`),spaceID:n},children:e});try{return O.useEffect(()=>{K.log("UnityProvider: Unity context created:",w),w?K.log("UnityProvider: Unity provider is available"):K.error("UnityProvider: Unity provider is not available"),R?K.log("UnityProvider: Unity is loaded"):K.log("UnityProvider: Unity is not loaded yet")},[w,R]),S.jsx(qF.Provider,{value:z,children:e})}catch(pe){return K.error("UnityProvider: Error creating Unity context:",pe),S.jsxs("div",{style:{padding:"20px",color:"red",backgroundColor:"#ffeeee",border:"1px solid red",borderRadius:"5px"},children:[S.jsx("h3",{children:"Unity Error"}),S.jsxs("p",{children:["Error creating Unity context: ",pe.message]}),S.jsx("p",{children:"Please check the console for more details."})]})}},So=()=>O.useContext(qF),lc=()=>{const{sendMessage:n,isLoaded:e}=So(),i=O.useRef([]),o=O.useCallback(()=>{if(e)for(;i.current.length>0;){const{eventName:u,data:p}=i.current.shift();K.log("useSendUnityEvent: Processing queued event to Unity:",u,p);try{n("ReactIncomingEvent","HandleEvent",JSON.stringify({eventName:u,data:JSON.stringify(p)}))}catch(y){K.error("useSendUnityEvent: Error sending event to Unity:",y),i.current.unshift({eventName:u,data:p});break}}},[n,e]);return O.useEffect(()=>{const u=setInterval(()=>{o()},1e3);return()=>clearInterval(u)},[o]),O.useCallback((u,p)=>{K.log("useSendUnityEvent: Queuing event for Unity:",u),i.current.push({eventName:u,data:p}),o()},[o])},Dc=()=>{const{addEventListener:n,removeEventListener:e}=So();return O.useCallback((i,o)=>{const l=u=>{K.log(i+" unity message received.");let p=null;if(u)try{p=JSON.parse(u)}catch(y){K.warn("Failed to parse JSON data from Unity message:",y)}o(p)};return n(i,l),()=>{e(i,l)}},[n,e])},kae=()=>{const[n,e]=O.useState({}),[i,o]=O.useState(!1),[l,u]=O.useState(null),[p,y]=O.useState(0),v=lc(),w=Dc(),{spaceID:C,sendMessage:R,isLoaded:N}=So(),M=O.useCallback((J,q)=>{if(!J)return;K.log(`useHLSStream: Sending stream URL to Unity: ${J} for player ${q}`);const re={identifier:"LiveProjector",playerIndex:q.toString(),streamUrl:J};if(v("SetHLSStream",re),N&&R)try{K.log("useHLSStream: Sending with ReactIncomingEvent approach"),R("ReactIncomingEvent","HandleEvent",JSON.stringify({eventName:"SetHLSStream",data:JSON.stringify(re)})),K.log("useHLSStream: Sending with direct HLSStream approach"),R("HLSStream","SetHLSStream",JSON.stringify({identifier:"LiveProjector",playerIndex:q.toString(),streamUrl:J})),K.log("useHLSStream: Sending with most direct approach possible"),R("LiveProjector","SetStreamUrl",J),R("HLSStreamClient","SetStreamUrl",JSON.stringify({Index:q.toString(),Url:J}))}catch(ce){K.error("useHLSStream: Error with direct message:",ce)}else K.warn("useHLSStream: Unity not loaded, could not send direct message")},[v,R,N]);O.useEffect(()=>{C&&L(C)},[C]);const L=async J=>{try{if(!J){K.warn("useHLSStream: Cannot load stream from Firebase - no spaceID");return}o(!0),K.log(`useHLSStream: Loading stream from Firebase for space ${J}`);const q=await dae(J);if(q&&q.streamUrl)if(K.log(`useHLSStream: Loaded stream data from Firebase for space ${J}`,q),u(q),N)K.log("useHLSStream: Unity is loaded, sending stream URL to Unity after delay"),setTimeout(()=>{M(q.streamUrl,q.playerIndex||"0")},500),setTimeout(()=>{K.log("useHLSStream: Sending backup stream URL to Unity after longer delay"),M(q.streamUrl,q.playerIndex||"0")},2e3);else{K.warn("useHLSStream: Unity is not loaded yet, will try again later");const re=setInterval(()=>{N&&(K.log("useHLSStream: Unity is now loaded, sending stream URL to Unity"),M(q.streamUrl,q.playerIndex||"0"),clearInterval(re))},1e3);setTimeout(()=>{clearInterval(re)},3e4)}else K.log(`useHLSStream: No saved stream found for space ${J}`),u(null)}catch(q){K.error(`useHLSStream: Error loading stream from Firebase for space ${J}`,q)}finally{o(!1)}},U=O.useCallback(async()=>{C&&(K.log(`useHLSStream: Forcing reload of stream data for space ${C}`),y(J=>J+1),await L(C))},[C]),z=O.useCallback(async(J,q=0,re={})=>{try{if(!J||!J.trim()){K.error("useHLSStream: Invalid stream URL");return}o(!0),K.log(`useHLSStream: Setting HLS stream URL for LiveProjector[${q}]`,J);const{enabled:ce=!0,rtmpUrl:ae="",streamKey:pe="",skipSendToUnity:H=!1}=re;if(H||M(J,q),C)try{const X={streamUrl:J,playerIndex:q.toString(),enabled:ce,rtmpUrl:ae,streamKey:pe,updatedAt:new Date().toISOString()};K.log(`useHLSStream: Saving stream URL to Firebase for space ${C}`,X),await jF(C,X),u(X)}catch(X){throw K.error(`useHLSStream: Error saving stream URL to Firebase for space ${C}`,X),X}else K.warn("useHLSStream: No spaceID available, stream URL not saved to Firebase")}finally{o(!1)}},[M,C]);return O.useEffect(()=>{const q=w("SetHLSStream",re=>{if(re)try{K.log("useHLSStream: Received player status update",re);const{identifier:ce,playerIndex:ae,isReady:pe,isPlaying:H}=re,X=`${ce}_${ae}`;e(Q=>({...Q,[X]:{identifier:ce,playerIndex:ae,isReady:pe,isPlaying:H}}))}catch(ce){K.error("useHLSStream: Error handling player status update",ce)}});return()=>{q()}},[w]),O.useEffect(()=>{if(l&&l.streamUrl){K.log("useHLSStream: Resending saved stream URL to Unity");const J=setTimeout(()=>{M(l.streamUrl,l.playerIndex||"0")},1e3);return()=>clearTimeout(J)}},[l,n,M,p]),O.useEffect(()=>{const J=q=>{if(q.detail){if(K.log("useHLSStream: Received stream update event",q.detail),C===q.detail.spaceId)K.log(`useHLSStream: Stream update is for our space ${C}, loading stream data`),L(C);else if(q.detail.streamUrl){K.log(`useHLSStream: Using stream URL directly from event: ${q.detail.streamUrl}`);const re=q.detail.playerIndex||"0";M(q.detail.streamUrl,re),u(q.detail)}}};return window.addEventListener("SpaceHLSStreamUpdated",J),window.addEventListener("SpaceStreamUpdated",J),()=>{window.removeEventListener("SpaceHLSStreamUpdated",J),window.removeEventListener("SpaceStreamUpdated",J)}},[C,M]),{setHLSStreamUrl:z,playerStatus:n,isLoading:i,savedStreamData:l,reloadStreamData:U}},pWe=()=>{const[n,e]=O.useState(!1),i=Dc();return O.useEffect(()=>{const l=i("FirstSceneLoaded",()=>{K.log("FirstSceneLoaded unity message received."),e(!0)});return()=>{l()}},[i]),n},fWe=()=>{const[n,e]=O.useState(null),i=Dc();return console.log(" Nameplate click hook initialized"),O.useEffect(()=>{console.log(" Setting up nameplate click listener...");const u=i("OpenNameplateModal",p=>{if(console.log(" Nameplate click detected!",p),!p){console.warn(" Received empty data in nameplate click handler");return}try{const y=typeof p=="string"?JSON.parse(p):p;e({playerName:y.playerName,playerId:y.playerId,uid:y.uid,isLocalPlayer:y.isLocalPlayer}),console.log(" Processed nameplate data:",y)}catch(y){console.error(" Error processing nameplate data:",y)}});return()=>{console.log(" Cleaning up nameplate click listener"),typeof u=="function"&&u()}},[i]),[n,()=>{console.log(" Resetting nameplate data"),e(null)}]},mWe=()=>{const n=Dc(),{sendUserToUnity:e}=O.useContext(Zi);return O.useEffect(()=>{const o=n("RequestUserForUnity",()=>{K.log("React: Request from Unity to send user data"),e()});return()=>{o()}},[n,e]),!0},lZ=async(n,e,i,o={})=>{try{const{mediaType:l="image",displayAsVideo:u=!1,directUrl:p=null}=o;if(!n||!e)throw new Error("Missing required parameters: spaceId and mediaScreenId");let y=null;if(i){if(!i.type.startsWith("image/"))throw new Error("File must be an image");const v=gE(),w=Date.now(),C=i.name.split(".").pop(),R=`${e}_${w}.${C}`,N=mE(v,`spaces/${n}/mediaScreens/${R}`);K.log(`Uploading image for media screen ${e} in space ${n}`);const M=await j3(N,i);y=await ZN(M.ref);const L=wr(Yn,`spaces/${n}/mediaScreens`,e);await Hg(L,{imageUrl:y,gsUrl:`gs://${M.ref.bucket}/${M.ref.fullPath}`,fileName:R,mediaType:l,displayAsVideo:u,uploadedAt:new Date().toISOString(),updatedAt:new Date().toISOString()},{merge:!0})}else if(p){y=p;const v=wr(Yn,`spaces/${n}/mediaScreens`,e);await Hg(v,{videoUrl:p,mediaType:l,displayAsVideo:u,uploadedAt:new Date().toISOString(),updatedAt:new Date().toISOString()},{merge:!0})}else throw new Error("Either imageFile or directUrl must be provided");return K.log(`Successfully uploaded ${l} for media screen ${e} (display as video: ${u})`),y}catch(l){throw K.error(`Error uploading media screen ${(o==null?void 0:o.mediaType)||"image"}:`,l),l}},X3=async n=>{K.log(`Getting media screen images for space: ${n}`);try{const e=El(Yn,`spaces/${n}/mediaScreens`),i=await id(e),o=[];return i.forEach(l=>{o.push({id:l.id,...l.data()})}),o}catch(e){throw K.error("Error fetching media screen images from Firestore:",e),e}},aE=async(n,e)=>{try{const i=wr(Yn,`spaces/${n}/mediaScreens`,e),o=await Bo(i);return o.exists()?{id:o.id,...o.data()}:(K.warn(`No media screen found with ID: ${e}`),null)}catch(i){throw K.error("Error fetching media screen image:",i),i}},gWe=async(n,e)=>{try{const i=await aE(n,e);if(!i)return K.warn(`No media screen found with ID: ${e} to delete`),!1;if(i.gsUrl){const l=gE(),u=mE(l,i.gsUrl);try{await B3(u),K.log(`Deleted file from storage: ${i.gsUrl}`)}catch(p){K.warn(`Could not delete file from storage: ${p.message}`)}}const o=wr(Yn,`spaces/${n}/mediaScreens`,e);return i.mediaType==="video"?(await lo(o,{videoUrl:null,mediaType:null,displayAsVideo:!1,deletedAt:new Date().toISOString(),updatedAt:new Date().toISOString()}),K.log(`Successfully removed video for media screen ${e}`)):(await lo(o,{imageUrl:null,gsUrl:null,fileName:null,mediaType:null,displayAsVideo:!1,deletedAt:new Date().toISOString(),updatedAt:new Date().toISOString()}),K.log(`Successfully removed image for media screen ${e}`)),!0}catch(i){throw K.error("Error deleting media screen image:",i),i}},_We=async(n,e,i)=>{try{if(!n||!e||typeof i!="boolean")throw new Error("Missing or invalid required parameters");const o=await aE(n,e);if(!o||!o.imageUrl&&!o.videoUrl)return K.warn(`No media screen content found with ID: ${e} to update`),!1;const l=wr(Yn,`spaces/${n}/mediaScreens`,e);return await lo(l,{displayAsVideo:i,updatedAt:new Date().toISOString()}),K.log(`Successfully updated display mode for media screen ${e} to ${i?"video":"image"}`),!0}catch(o){throw K.error("Error updating media screen display mode:",o),o}},yWe=n=>{if(!n)return null;try{if(n.includes("firebasestorage.googleapis.com")){const e=new URL(n),i=e.searchParams.get("alt"),o=e.searchParams.get("token");return e.search="",i&&e.searchParams.set("alt",i),o&&e.searchParams.set("token",o),console.log(`Cleaned Firebase URL from ${n} to ${e.toString()}`),e.toString()}return n}catch(e){return console.error("Error cleaning Firebase URL:",e),n}},Oae=()=>{const{spaceID:n}=So(),e=lc(),[i,o]=O.useState(!1);O.useEffect(()=>{if(window.isPlayerInstantiated){K.log("useUnityMediaScreenImages: Unity already ready (via window flag)"),o(!0);return}const l=()=>{K.log("useUnityMediaScreenImages: Unity is now ready (PlayerInstantiated event)"),o(!0)};return window.addEventListener("PlayerInstantiated",l),()=>{window.removeEventListener("PlayerInstantiated",l)}},[]),O.useEffect(()=>{if(!i){K.log("useUnityMediaScreenImages: Waiting for Unity to be ready before loading media screens");return}K.log("useUnityMediaScreenImages: Unity is ready, now loading media screens"),(async()=>{try{if(!n)throw new Error("spaceID is not defined.");const u=await X3(n);K.log("Fetched Media Screen Images",u),u.forEach(p=>{const{id:y,imageUrl:v,displayAsVideo:w,videoUrl:C}=p;let R=null;(!w||!C)&&(R=v?yWe(v):null),e("SetMediaScreenImage",{mediaScreenId:y,imageUrl:R,videoUrl:C||null,displayAsVideo:w||!1,timestamp:Date.now()}),K.log(`Sent media screen data for ${y} to Unity (displayAsVideo: ${w})`),w&&C&&(e("SetMediaScreenDisplayMode",{mediaScreenId:y,displayAsVideo:!0,videoUrl:C,timestamp:Date.now()}),K.log(`Set display mode to video for screen ${y}`))})}catch(u){K.error("Error fetching media screen images:",u)}})()},[e,n,i])},EWe=()=>{const{spaceID:n}=So(),e=lc(),[i,o]=O.useState(!1);O.useEffect(()=>{if(window.isPlayerInstantiated){K.log("useUnityThumbnails: Unity already ready (via window flag)"),o(!0);return}const l=()=>{K.log("useUnityThumbnails: Unity is now ready (PlayerInstantiated event)"),o(!0)};return window.addEventListener("PlayerInstantiated",l),()=>{window.removeEventListener("PlayerInstantiated",l)}},[]),O.useEffect(()=>{if(!i){K.log("useUnityThumbnails: Waiting for Unity to be ready before loading thumbnails");return}K.log("useUnityThumbnails: Unity is ready, now loading thumbnails"),(async()=>{try{if(!n)throw new Error("spaceID is not defined.");const u=await uae(n),p=async w=>{const C=`https://vimeo.com/api/oembed.json?url=${w}`,R=await fetch(C);if(!R.ok)throw new Error(`Failed to fetch thumbnail: ${R.statusText}`);const N=await R.json(),M=N.thumbnail_url.replace(/_\d+x\d+/,""),L=["640x360","295x166"];let U=null;for(let z of L){const J=`https://i.vimeocdn.com/filter/overlay?src0=${encodeURIComponent(`${M}_${z}`)}&src1=http://f.vimeocdn.com/p/images/crawler_play.png`;try{if((await fetch(J,{method:"HEAD"})).ok){U=J;break}}catch(q){console.warn(`Failed to validate thumbnail URL: ${J}`,q)}}return U||N.thumbnail_url},y=u.map(async w=>{const C=await p(w.url);return{gameObjectName:w.id,thumbnailUrl:C}}),v=await Promise.all(y);K.log("Fetched Thumbnails",v),v.forEach(({gameObjectName:w,thumbnailUrl:C})=>{e("SetThumbnail",{gameObjectName:w,thumbnailUrl:C})})}catch(u){K.error("Error fetching thumbnails:",u)}})()},[e,n,i])},Nae=()=>{const[n,e]=O.useState([]),i=Dc();return O.useEffect(()=>{let o=!0,l=null;const u=()=>{window.unityInstance&&(K.log("Requesting fresh player list"),window.unityInstance.SendMessage("NetworkManager","RequestPlayerList"))},p=M=>{if(o){K.log("UpdatePlayerList unity message received.");try{let L=[];if(typeof M=="object"&&M!==null?L=M.players||[]:L=JSON.parse(M).players||[],Array.isArray(L)){const U=Array.from(new Map(L.map(z=>[z.playerId,z])).values());e(U),l&&(clearTimeout(l),l=null)}}catch(L){K.error("Error handling player list data:",L),l||(l=setTimeout(u,1e3))}}},y=()=>{K.log("Player disconnected, requesting fresh player list"),u()},v=()=>{K.log("Player left, requesting fresh player list"),u()};u();const w=i("UpdatePlayerList",p),C=i("PlayerDisconnected",y),R=i("PlayerLeft",v),N=setInterval(u,5e3);return()=>{o=!1,l&&clearTimeout(l),typeof w=="function"&&w(),typeof C=="function"&&C(),typeof R=="function"&&R(),clearInterval(N)}},[i]),n},Dae=()=>{const n=lc(),e=O.useCallback((o,l,u,p,y,v)=>{const w=u||{x:0,y:1.5,z:0},C=p||{x:0,y:0,z:0},R=y||{x:1,y:1,z:1};try{const N={portalId:o,prefabName:l||"PortalObjectPrefab",position:w,rotation:C,scale:R,initialImageUrl:v};return K.log("Sending portal placement to Unity:",N),n("PlacePortalPrefab",N),!0}catch(N){return K.error("Error placing portal:",N),!1}},[n]),i=O.useCallback((o,l,u,p,y,v)=>{const w=u||{x:0,y:1.5,z:0},C=p||{x:0,y:0,z:0},R=y||{x:1,y:1,z:1};try{const N={portalId:o,prefabName:l||"PortalObjectPrefab",position:w,rotation:C,scale:R,initialImageUrl:v},M={eventName:"PlacePortalPrefab",data:JSON.stringify(N)};return K.log("Directly sending portal placement to Unity:",N),window.unityInstance.SendMessage("ReactIncomingEvent","HandleEvent",JSON.stringify(M)),!0}catch(N){return K.error("Error directly placing portal:",N),!1}},[]);return{placePortal:e,directPlacePortal:i,isUnityLoaded:!0}},xae=()=>{const n=lc(),e=O.useCallback((o,l,u,p,y)=>{const v=u||{x:0,y:0,z:0},w=p||{x:0,y:0,z:0},C=y||{x:1,y:1,z:1};try{const R={hotspotId:o,glbUrl:l,position:v,rotation:w,scale:C};return K.log("Sending seating hotspot placement to Unity:",R),n("SeatingHotspot",R),!0}catch(R){return K.error("Error placing seating hotspot:",R),!1}},[n]),i=O.useCallback((o,l,u,p,y)=>{const v=u||{x:0,y:0,z:0},w=p||{x:0,y:0,z:0},C=y||{x:1,y:1,z:1};try{const R={hotspotId:o,glbUrl:l,position:v,rotation:w,scale:C},N={eventName:"SeatingHotspot",data:JSON.stringify(R)};return K.log("Directly sending seating hotspot placement to Unity:",R),window.unityInstance.SendMessage("ReactIncomingEvent","HandleEvent",JSON.stringify(N)),!0}catch(R){return K.error("Error directly placing seating hotspot:",R),!1}},[]);return{placeCatalogueItem:e,directPlaceCatalogueItem:i,isUnityLoaded:!0}},vWe=O3(JN,"trackAnalytics"),SWe=O3(JN,"createAnalyticsSession"),bWe=O3(JN,"endAnalyticsSession"),wWe=async(n,e={})=>{try{K.log(`Creating secure analytics session for space ${n}`);const i=await SWe({spaceId:n,sessionData:{userAgent:typeof navigator<"u"?navigator.userAgent:"unknown",deviceType:typeof navigator<"u"&&/Mobile|Android|iPhone|iPad/.test(navigator.userAgent)?"mobile":"desktop",sessionType:"webgl",startUrl:typeof window<"u"?window.location.href:"unknown",referrer:typeof document<"u"?document.referrer:"unknown",...e}});return K.log(`Secure analytics session created: ${i.data.sessionId}`),i.data.sessionId}catch(i){throw K.error("Error creating secure analytics session:",i),i}},TWe=async(n,e,i,o={})=>{try{K.log(`Tracking secure analytics event: ${i} in space ${n}`);const l=await vWe({spaceId:n,sessionId:e,eventType:i,eventData:{...o,timestamp:new Date().toISOString(),clientSide:!0}});return K.log(`Secure analytics event tracked: ${i} (${l.data.eventId})`),l.data.eventId}catch(l){throw K.error("Error tracking secure analytics event:",l),l}},CWe=async(n,e)=>{try{if(K.log(`Ending secure analytics session: ${e} in space ${n}`),!n||!e)throw K.error("endAnalyticsSessionSecure: Missing required parameters",{spaceId:n,sessionId:e,spaceIdType:typeof n,sessionIdType:typeof e}),new Error(`Missing required parameters: spaceId=${n}, sessionId=${e}`);await bWe({spaceId:n,sessionId:e}),K.log(`Secure analytics session ended: ${e}`)}catch(i){throw K.error("Error ending secure analytics session:",i),i}},ro={UNITY:{VIDEO_PLAY:"unity_video_play",VIDEO_PAUSE:"unity_video_pause",VIDEO_COMPLETE:"unity_video_complete",PORTAL_CLICK:"unity_portal_click",PORTAL_NAVIGATE:"unity_portal_navigate",MEDIA_SCREEN_CLICK:"unity_media_screen_click",NAMEPLATE_CLICK:"unity_nameplate_click",OBJECT_INTERACT:"unity_object_interact",PLAYER_MOVE:"unity_player_move",PLAYER_SPAWN:"unity_player_spawn",SPACE_LOAD:"unity_space_load",SPACE_READY:"unity_space_ready"},REACT:{MODAL_OPEN:"react_modal_open",MODAL_CLOSE:"react_modal_close",UI_CLICK:"react_ui_click",USER_LOGIN:"react_user_login",USER_LOGOUT:"react_user_logout",SPACE_ENTER:"react_space_enter",SPACE_EXIT:"react_space_exit",CHAT_MESSAGE:"react_chat_message",UPLOAD_START:"react_upload_start",UPLOAD_COMPLETE:"react_upload_complete",SETTINGS_CHANGE:"react_settings_change",VIDEO_CLICK:"react_video_click",VIDEO_CLOSE:"react_video_close",BUTTON_CLICK:"react_button_click",FORM_SUBMIT:"react_form_submit",ERROR_OCCURRED:"react_error_occurred"}},io={NAVIGATION:"navigation",MEDIA_INTERACTION:"media_interaction",SOCIAL_INTERACTION:"social_interaction",UI_INTERACTION:"ui_interaction",SYSTEM_EVENT:"system_event",USER_BEHAVIOR:"user_behavior",CONTENT_INTERACTION:"content_interaction",PERFORMANCE:"performance"},RWe=async(n,e,i={})=>{try{return K.log(`Creating secure analytics session for user ${e} in space ${n}`),await wWe(n,i)}catch(o){throw K.error("Error creating analytics session:",o),o}},SC=async(n,e,i,o={})=>{try{return K.log(`Tracking secure analytics event: ${i} in space ${n}`),await TWe(n,e,i,o)}catch(l){throw K.error("Error tracking analytics event:",l),l}},uZ=async(n,e)=>{try{K.log(`Ending secure analytics session: ${e} in space ${n}`),await CWe(n,e)}catch(i){throw K.error("Error ending analytics session:",i),i}},IWe=async(n,e,i,o)=>SC(n,e,ro.UNITY.VIDEO_PLAY,{userId:i,category:io.MEDIA_INTERACTION,source:"unity",videoId:o.gameObjectName,videoUrl:o.videoUrl,spaceId:n,...o}),_E=(n,e={})=>{const{user:i}=O.useContext(Zi),o=O.useRef(null),[l,u]=O.useState(!1),[p,y]=O.useState(!1),v=O.useRef(!1),w=O.useRef(!1),C=O.useRef(!1),R=O.useRef(!1),{autoStart:N=!0,sessionMetadata:M={},enableDebugLogs:L=!1}=e;O.useEffect(()=>(i&&n&&N&&!o.current&&!C.current&&U(),()=>{o.current&&!R.current&&(L&&K.log("Component unmounting, ending analytics session"),z())}),[i,n,N,L]),O.useEffect(()=>{const H=()=>{document.hidden&&o.current&&!R.current&&(L&&K.log("Page hidden, ending analytics session"),z())},X=()=>{o.current&&!R.current&&(L&&K.log("Page unloading, ending analytics session"),z())};return document.addEventListener("visibilitychange",H),window.addEventListener("beforeunload",X),()=>{document.removeEventListener("visibilitychange",H),window.removeEventListener("beforeunload",X)}},[L]);const U=O.useCallback(async()=>{if(!i||!n||o.current||C.current){L&&K.log("Analytics session already initializing or initialized, skipping");return}try{C.current=!0,y(!0);const H=await RWe(n,i.uid,{unityVersion:window.unityVersion||"unknown",reactVersion:"18.x",startUrl:window.location.href,referrer:document.referrer,...M});o.current=H,u(!0),v.current?L&&K.log(" Analytics: Space entry already tracked for this session, skipping duplicate"):(await SC(n,H,ro.REACT.SPACE_ENTER,{userId:i.uid,category:io.NAVIGATION,source:"react",spaceId:n,timestamp:new Date().toISOString()}),v.current=!0,L&&K.log(` Analytics: Space entry tracked for session ${H}`)),L&&K.log(`Analytics session initialized: ${H} for space ${n}`)}catch(H){K.error("Failed to initialize analytics session:",H),y(!1)}finally{C.current=!1}},[i,n,M,L]),z=O.useCallback(async()=>{if(L&&K.log("endSession called with:",{sessionId:o.current,spaceId:n,sessionIdType:typeof o.current,spaceIdType:typeof n}),!o.current||!n){L&&K.log("endSession: Missing required parameters, skipping",{sessionId:o.current,spaceId:n});return}if(R.current){L&&K.log("endSession: Already ending session, skipping duplicate call");return}try{R.current=!0,w.current?L&&K.log(" Analytics: Space exit already tracked for this session, skipping duplicate"):(await SC(n,o.current,ro.REACT.SPACE_EXIT,{userId:i==null?void 0:i.uid,category:io.NAVIGATION,source:"react",spaceId:n,timestamp:new Date().toISOString()}),w.current=!0,L&&K.log(` Analytics: Space exit tracked for session ${o.current}`));const H=o.current;H&&n&&(await uZ(n,H),L&&K.log(`Analytics session ended: ${H}`)),o.current=null,u(!1),y(!1),v.current=!1,w.current=!1}catch(H){K.error("Failed to end analytics session:",H)}finally{R.current=!1}},[n,i==null?void 0:i.uid,L,SC,uZ]),J=O.useCallback(async(H,X={})=>{if(!o.current||!n||!p)return L&&K.warn("Cannot track event: No active analytics session"),null;try{const Q=await SC(n,o.current,H,{userId:i==null?void 0:i.uid,spaceId:n,timestamp:new Date().toISOString(),...X});return L&&K.log(`Analytics event tracked: ${H}`,X),Q}catch(Q){return K.error("Failed to track analytics event:",Q),null}},[n,i==null?void 0:i.uid,p,L]),q=O.useCallback(async H=>{if(!o.current||!n||!p)return L&&K.warn("Cannot track video play: No active analytics session"),null;try{const X=await IWe(n,o.current,i==null?void 0:i.uid,H);return L&&K.log("Video play event tracked:",H),X}catch(X){return K.error("Failed to track video play event:",X),null}},[n,i==null?void 0:i.uid,p,L]),re=O.useCallback(async(H,X={})=>J(H,{...X,source:"unity",category:X.category||io.USER_BEHAVIOR}),[J]),ce=O.useCallback(async(H,X={})=>J(H,{...X,source:"react",category:X.category||io.UI_INTERACTION}),[J]),ae=O.useCallback(async(H,X,Q={})=>{const ne=H==="open"?ro.REACT.MODAL_OPEN:ro.REACT.MODAL_CLOSE;return ce(ne,{modalName:X,action:H,category:io.UI_INTERACTION,...Q})},[ce]),pe=O.useCallback(async()=>{o.current&&await z(),await U()},[z,U]);return{isInitialized:l,isTracking:p,sessionId:o.current,track:J,trackVideoPlay:q,trackUnityEvent:re,trackReactEvent:ce,trackModal:ae,initializeSession:U,endSession:z,restartSession:pe,isReady:l&&p&&o.current!==null}},AWe=n=>{const[e,i]=O.useState(null),{user:o}=O.useContext(Zi),l=Dc(),{spaceID:u}=So(),{trackUnityEvent:p,isReady:y}=_E(u,{enableDebugLogs:!0});return O.useEffect(()=>{let w=!0;const R=l("PlayVideo",async N=>{try{const{gameObjectName:M}=N;if(!M){K.error("Game object name is missing in Unity event data.");return}const L=await uae(u);K.log("SPACES VIDEOS",L);const U=L.find(z=>z.id===M);U&&w?(i(U.url),K.log("Video URL set to:",U.url),y&&o&&(p(ro.UNITY.VIDEO_PLAY,{category:io.MEDIA_INTERACTION,videoId:M,videoUrl:U.url,videoTitle:U.title||U.name||M,isEditMode:!1,spaceId:u,timestamp:new Date().toISOString(),videoData:{gameObjectName:M,videoMetadata:U}}),K.log(" Analytics: Video play event tracked for:",M))):console.error("Video not found for game object:",M)}catch(M){console.error("Error fetching space videos:",M)}});return()=>{w=!1,R()}},[l,u,n]),[e,()=>{i(null)}]},PWe=()=>{const[n,e]=O.useState(null),[i,o]=O.useState(!1),[l,u]=O.useState(null),p=Dc(),y=lc();O.useEffect(()=>p("KickPlayerResult",R=>{K.log("KickPlayerResult event received:",R),R?(e(R),o(!1),R.success?u(null):u(R.errorMessage||"Failed to kick player")):(K.error("Invalid KickPlayerResult data from Unity"),u("Invalid result from Unity"),o(!1))}),[p]);const v=O.useCallback((C,R)=>{var N;try{if(!C){u("Player UID is required");return}o(!0),u(null),e(null);const M={uid:C,requestedBy:R||((N=window.currentUser)==null?void 0:N.uid)};K.log("Sending KickPlayer event to Unity:",M),y("KickPlayer",M)}catch(M){K.error("Error kicking player:",M),u(M.message||"Failed to send kick request"),o(!1)}},[y]),w=O.useCallback(()=>{e(null),u(null),o(!1)},[]);return{kickPlayer:v,isKicking:i,kickResult:n,error:l,resetKickState:w}},kWe=n=>{const{placePortal:e}=Dae();O.useEffect(()=>{const i=async()=>{try{const o=El(Yn,"spaces",n,"portals"),l=await id(o);if(l.empty){K.log("useSpacePortals: No portals found for space:",n);return}K.log(`useSpacePortals: Found ${l.size} portals for space ${n}`),l.forEach(u=>{const p=u.data();K.log(`useSpacePortals: Placing portal ${p.portalId} in Unity:`,p),e(p.portalId,p.prefabName,p.position,p.rotation,p.scale)})}catch(o){K.error("useSpacePortals: Error loading portals:",o)}};if(window.unityInstance)K.log("useSpacePortals: Unity is ready, loading portals"),i();else{const o=()=>{K.log("useSpacePortals: Unity ready event received, loading portals"),i()};return window.addEventListener("PlayerInstantiated",o),()=>{window.removeEventListener("PlayerInstantiated",o)}}},[n,e])},Lae=async(n,e)=>{console.log(" fetchPortalAnalyticsData called with:",{spaceId:n,portalId:e});let i=null,o=null;try{if(!n||!e)throw new Error(`Invalid parameters: spaceId=${n}, portalId=${e}`);const u=wr(Yn,"spaces",n,"portals",e);console.log(" Querying Firestore path:",`spaces/${n}/portals/${e}`);const p=await Bo(u);if(p.exists()){const y=p.data();i=y.targetSpaceId,o=y.targetSpaceName,console.log(" Portal data fetched from Firestore:",{targetSpaceId:i,targetSpaceName:o})}else{console.warn(" Portal document not found in Firestore for:",e);const y=e.split("_");y.length>=3&&(i=y[2],console.log(" Fallback: Parsed targetSpaceId from portalId:",i))}}catch(u){console.error(" Error fetching portal data from Firestore:",u);const p=e.split("_");p.length>=3&&(i=p[2],console.log(" Fallback: Parsed targetSpaceId from portalId:",i))}const l={targetSpaceId:i,targetSpaceName:o};return console.log(" fetchPortalAnalyticsData returning:",l),l},OWe=()=>{const[n,e]=O.useState(null),{user:i}=O.useContext(Zi),o=Dc(),{spaceID:l}=So(),{trackUnityEvent:u,isReady:p}=_E(l,{enableDebugLogs:!0});return O.useEffect(()=>{console.log("Setting up portal click listener...");const w=o("PortalClicked",async C=>{console.log("Portal click event received:",C);try{const R=typeof C=="string"?JSON.parse(C):C;if(console.log("Parsed portal data:",R),e(R),p&&i&&R&&R.portalId)try{const{targetSpaceId:N,targetSpaceName:M}=await Lae(l,R.portalId);await u(ro.UNITY.PORTAL_CLICK,{category:io.NAVIGATION,portalId:R.portalId,targetSpaceId:N,targetSpaceName:M,sourceSpaceId:l,isEditMode:!0,timestamp:new Date().toISOString()}),console.log(" Analytics: Portal click event tracked for:",R.portalId,"targeting:",M||N)}catch(N){console.error(" Analytics: Error tracking portal click:",N);try{await u(ro.UNITY.PORTAL_CLICK,{category:io.NAVIGATION,portalId:R.portalId,targetSpaceId:null,targetSpaceName:null,sourceSpaceId:l,isEditMode:!0,timestamp:new Date().toISOString()}),console.log(" Analytics: Portal click event tracked (fallback) for:",R.portalId)}catch(M){console.error(" Analytics: Failed to track portal click even with fallback:",M)}}}catch(R){console.error("Error parsing portal click data:",R,"Data:",C)}});return()=>{console.log("Cleaning up portal click listener"),typeof w=="function"&&w()}},[o,p,i,l,u]),{clickedPortal:n,clearClickedPortal:()=>{console.log("Clearing clicked portal state"),e(null)},isAnalyticsReady:p,trackPortalClick:u}},NWe=()=>{const{user:n}=O.useContext(Zi),e=Dc(),{spaceID:i}=So(),{trackUnityEvent:o,isReady:l}=_E(i,{enableDebugLogs:!0});O.useEffect(()=>{console.log("Setting up portal navigation listener...");const p=e("PortalNavigate",async y=>{console.log(" PORTAL CLICKED BY PLAYER (non-edit mode)");try{const v=typeof y=="string"?JSON.parse(y):y;if(console.log("Portal data:",v),!v.portalId){console.error("Portal ID is missing from portal data");return}let w=null,C=null;try{const R=await Lae(i,v.portalId);w=R.targetSpaceId,C=R.targetSpaceName}catch(R){console.error("Error fetching portal analytics data:",R);const N=v.portalId.split("_");N.length>=3&&(w=N[2])}if(w){if(console.log("Navigating to space:",w,`(${C||"Unknown space name"})`),l&&n&&v)try{await o(ro.UNITY.PORTAL_NAVIGATE,{category:io.NAVIGATION,portalId:v.portalId,targetSpaceId:w,targetSpaceName:C,sourceSpaceId:i,isEditMode:!1,navigationType:"direct",timestamp:new Date().toISOString()}),console.log(" Analytics: Portal navigation event tracked for:",v.portalId,"",C||w)}catch(R){console.error(" Analytics: Error tracking portal navigation:",R)}window.location.href=`/?spaceId=${w}`}else console.error("Could not determine target space ID from portal:",v.portalId)}catch(v){console.error("Error handling portal navigation:",v)}});return()=>{console.log("Cleaning up portal navigation listener"),typeof p=="function"&&p()}},[e,l,n,i,o])},DWe=n=>{const{placeCatalogueItem:e}=xae();O.useEffect(()=>{const i=async()=>{try{const o=El(Yn,"spaces",n,"catalogue"),l=await id(o);if(l.empty){K.log("useSpaceCatalogueItems: No catalogue items found for space:",n);return}K.log(`useSpaceCatalogueItems: Found ${l.size} items for space ${n}`),l.forEach(u=>{const p=u.data();K.log(`useSpaceCatalogueItems: Placing item ${p.itemId} in Unity:`,p),e(p.itemId,p.glbUrl,p.position,p.rotation,p.scale)})}catch(o){K.error("useSpaceCatalogueItems: Error loading catalogue items:",o)}};if(window.unityInstance)K.log("useSpaceCatalogueItems: Unity is ready, loading catalogue items"),i();else{const o=()=>{K.log("useSpaceCatalogueItems: Unity ready event received, loading catalogue items"),i()};return window.addEventListener("PlayerInstantiated",o),()=>{window.removeEventListener("PlayerInstantiated",o)}}},[n,e])},Mae=()=>{const[n,e]=O.useState(null),i=Dc();return O.useEffect(()=>{K.log("Setting up seating hotspot click listener...");const u=i("SeatingHotspotClicked",async p=>{K.log(" Seating hotspot click event received from Unity:",p);try{const y=typeof p=="string"?JSON.parse(p):p;K.log(" Parsed Unity click data:",y);const v=y.hotspotId.split("_");if(v.length>=3){const w=v.slice(1,-1).join("_");K.log(" Extracted spaceId:",w);const C=wr(Yn,"spaces",w,"catalogue",y.hotspotId);K.log(" Fetching from Firebase path:",`spaces/${w}/catalogue/${y.hotspotId}`);const R=await Bo(C);if(R.exists()){const N=R.data();K.log(" Fetched Firebase data:",N),K.log(" Firebase position:",N.position),K.log(" Unity position:",y.position);const M={...y,position:N.position||y.position,rotation:N.rotation||y.rotation,scale:N.scale||y.scale};K.log(" Combined data being set:",M),e(M)}else K.warn(" Item not found in Firebase:",y.hotspotId),e(y)}else K.error(" Invalid hotspot ID format:",y.hotspotId),e(y)}catch(y){K.error(" Error handling seating hotspot click:",y,"Data:",p)}});return()=>{K.log("Cleaning up seating hotspot click listener"),typeof u=="function"&&u()}},[i]),{clickedItem:n,clearClickedItem:()=>{K.log("Clearing clicked item state"),e(null)}}},xWe=n=>({opacity:1});function LWe(){const{loadingProgression:n,isLoaded:e,error:i}=So(),{user:o}=O.useContext(Zi),[l,u]=O.useState(!1),[p,y]=O.useState(!1),[v,w]=O.useState(!1),[C,R]=O.useState(!1),N=O.useRef(!1),M=O.useRef(!1),L=O.useRef(null),U=O.useRef(null),z=O.useRef(null),J=Dc(),q=O.useRef(null),re=O.useRef(null),ce=O.useRef(null);O.useRef(null),O.useEffect(()=>{u(!o&&n===0)},[o,n]),O.useEffect(()=>{const H=document.createElement("style");return H.textContent=`
      /* Set initial Unity canvas styles */
      #unity-canvas, #unity-container {
        opacity: 0 !important;
        transition: opacity 1s ease-in-out;
        z-index: 1 !important; /* Ensure Unity is below our loader */
      }
      
      /* Loader overlay styles */
      .loader-overlay {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(0, 0, 0, 0.5);
        z-index: 99999 !important; /* Extremely high z-index */
        display: flex;
        align-items: center;
        justify-content: center;
        transition: opacity 1.5s ease-in-out;
        pointer-events: auto !important;
        transform: translateZ(0); /* Create stacking context */
      }
      
      /* Loader content styles */
      .loader-content {
        background-color: rgba(0, 0, 0, 0.8);
        padding: 1rem;
        border-radius: 0.5rem;
        color: white;
        text-align: center;
        z-index: 100000 !important; /* Even higher z-index */
      }
    `,document.head.appendChild(H),q.current=H,()=>{q.current&&document.head.removeChild(q.current)}},[]),O.useEffect(()=>{const H=()=>{const X=document.getElementById("unity-canvas"),Q=document.getElementById("unity-container");X&&(L.current=X,X.style.zIndex="1"),Q&&(U.current=Q,Q.style.zIndex="1"),X&&Q&&ce.current&&(clearInterval(ce.current),ce.current=null)};return H(),ce.current=setInterval(H,100),()=>{ce.current&&(clearInterval(ce.current),ce.current=null)}},[]),O.useEffect(()=>{window.isFirstSceneLoaded&&(M.current=!0,R(!0));const X=J("FirstSceneLoaded",()=>{M.current=!0,R(!0),window.isFirstSceneLoaded=!0}),Q=setTimeout(()=>{M.current||(M.current=!0,R(!0),window.isFirstSceneLoaded=!0)},1e4);return()=>{X(),clearTimeout(Q)}},[J]),O.useEffect(()=>{window.isPlayerInstantiated&&(N.current=!0,w(!0),M.current||(M.current=!0,R(!0),window.isFirstSceneLoaded=!0));const H=()=>{N.current=!0,w(!0),M.current||(M.current=!0,R(!0),window.isFirstSceneLoaded=!0)};window.addEventListener("PlayerInstantiated",H);const X=J("PlayerInstantiated",H),Q=setTimeout(()=>{N.current||(N.current=!0,w(!0),M.current||(M.current=!0,R(!0),window.isFirstSceneLoaded=!0))},2e4);return()=>{window.removeEventListener("PlayerInstantiated",H),X(),clearTimeout(Q)}},[J]),O.useEffect(()=>(C&&v&&(console.log("LoaderProgress: Both conditions met, showing Unity canvas"),re.current&&clearTimeout(re.current),re.current=setTimeout(()=>{L.current&&(L.current.style.opacity="1",L.current.style.removeProperty("opacity")),U.current&&(U.current.style.opacity="1",U.current.style.removeProperty("opacity")),z.current&&(z.current.style.opacity="0",z.current.style.pointerEvents="none",setTimeout(()=>{z.current&&(z.current.style.display="none")},1500))},2e3)),()=>{re.current&&clearTimeout(re.current)}),[C,v]);const ae=()=>e?e&&!C&&!v?"Scene initializing":C&&!v?"Player initializing":"Ready":"World loading",pe=()=>e?e&&!C&&!v?85:C&&!v?95:100:n*80;return S.jsx(S.Fragment,{children:l?S.jsx(ct,{position:"absolute",zIndex:"99999",width:"100%",height:"100%",display:"flex",alignItems:"center",justifyContent:"center",style:{transform:"translateZ(0)"},children:S.jsxs(Ir,{spacing:4,padding:6,borderRadius:"md",backgroundColor:"rgba(0, 0, 0, 0.8)",color:"white",children:[S.jsx(Ye,{fontSize:"xl",fontWeight:"bold",children:"Sign In Required"}),S.jsx(Ye,{textAlign:"center",children:"Please sign in to enter The Disruptive Spaces"}),S.jsx(Nn,{colorScheme:"blue",size:"lg",width:"200px",onClick:()=>y(!0),children:"Sign In"})]})}):S.jsx(ct,{ref:z,className:"loader-overlay",style:{transform:"translateZ(0)",zIndex:99999},children:S.jsxs(Ur,{className:"loader-content",flexDirection:"column",alignItems:"center",width:"300px",style:{zIndex:1e5},children:[S.jsx(Ye,{fontWeight:"bold",children:"Entering The Spaces Metaverse"}),S.jsx(Ye,{fontSize:"sm",children:ae()}),S.jsx(qy,{value:pe(),size:"lg",width:"100%",marginY:2})]})})})}function MWe(){const{user:n}=O.useContext(Zi);return S.jsx("div",{children:n!==null?S.jsx("div",{children:S.jsx(q3,{})}):S.jsxs("div",{children:[S.jsx(iD,{}),S.jsx(sD,{})]})})}function UWe(){const{fullscreenRef:n}=fh(),[e,i]=O.useState(!1),o=()=>{i(!e)};return S.jsxs(S.Fragment,{children:[S.jsx(Uf,{label:"Help",hasArrow:!0,placement:"top",closeOnClick:!0,portalProps:{containerRef:n},children:S.jsx(Pc,{"aria-label":"Controller Help",icon:S.jsx(S8e,{}),onClick:o,variant:"iconButton"})}),S.jsxs(ls,{isOpen:e,onClose:o,size:"md",portalProps:{containerRef:n},children:[S.jsx(ds,{}),S.jsxs(us,{children:[S.jsx(co,{children:"Notes"}),S.jsx(Is,{}),S.jsx(gs,{children:S.jsx(Ye,{variant:"formIntro",children:"The help button is showing so we can see the blur and transparency styles on the button."})}),S.jsx(uh,{children:S.jsx(Nn,{variant:"primary",onClick:o,children:"Close"})})]})]})]})}var Uae={color:void 0,size:void 0,className:void 0,style:void 0,attr:void 0},dZ=bi.createContext&&bi.createContext(Uae),xg=function(){return xg=Object.assign||function(n){for(var e,i=1,o=arguments.length;i<o;i++){e=arguments[i];for(var l in e)Object.prototype.hasOwnProperty.call(e,l)&&(n[l]=e[l])}return n},xg.apply(this,arguments)},VWe=function(n,e){var i={};for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&e.indexOf(o)<0&&(i[o]=n[o]);if(n!=null&&typeof Object.getOwnPropertySymbols=="function")for(var l=0,o=Object.getOwnPropertySymbols(n);l<o.length;l++)e.indexOf(o[l])<0&&Object.prototype.propertyIsEnumerable.call(n,o[l])&&(i[o[l]]=n[o[l]]);return i};function Vae(n){return n&&n.map(function(e,i){return bi.createElement(e.tag,xg({key:i},e.attr),Vae(e.child))})}function Vr(n){return function(e){return bi.createElement(FWe,xg({attr:xg({},n.attr)},e),Vae(n.child))}}function FWe(n){var e=function(i){var o=n.attr,l=n.size,u=n.title,p=VWe(n,["attr","size","title"]),y=l||i.size||"1em",v;return i.className&&(v=i.className),n.className&&(v=(v?v+" ":"")+n.className),bi.createElement("svg",xg({stroke:"currentColor",fill:"currentColor",strokeWidth:"0"},i.attr,o,p,{className:v,style:xg(xg({color:n.color||i.color},i.style),n.style),height:y,width:y,xmlns:"http://www.w3.org/2000/svg"}),u&&bi.createElement("title",null,u),n.children)};return dZ!==void 0?bi.createElement(dZ.Consumer,null,function(i){return e(i)}):e(Uae)}function Fae(n){return Vr({attr:{viewBox:"0 0 448 512"},child:[{tag:"path",attr:{d:"M416 32H31.9C14.3 32 0 46.5 0 64.3v383.4C0 465.5 14.3 480 31.9 480H416c17.6 0 32-14.5 32-32.3V64.3c0-17.8-14.4-32.3-32-32.3zM135.4 416H69V202.2h66.5V416zm-33.2-243c-21.3 0-38.5-17.3-38.5-38.5S80.9 96 102.2 96c21.2 0 38.5 17.3 38.5 38.5 0 21.3-17.2 38.5-38.5 38.5zm282.1 243h-66.4V312c0-24.8-.5-56.7-34.5-56.7-34.6 0-39.9 27-39.9 54.9V416h-66.4V202.2h63.7v29.2h.9c8.9-16.8 30.6-34.5 62.9-34.5 67.2 0 79.7 44.3 79.7 101.9V416z"}}]})(n)}function jWe(n){return Vr({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M256 8C119.034 8 8 119.033 8 256s111.034 248 248 248 248-111.034 248-248S392.967 8 256 8zm130.108 117.892c65.448 65.448 70 165.481 20.677 235.637L150.47 105.216c70.204-49.356 170.226-44.735 235.638 20.676zM125.892 386.108c-65.448-65.448-70-165.481-20.677-235.637L361.53 406.784c-70.203 49.356-170.226 44.736-235.638-20.676z"}}]})(n)}function hZ(n){return Vr({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M173.898 439.404l-166.4-166.4c-9.997-9.997-9.997-26.206 0-36.204l36.203-36.204c9.997-9.998 26.207-9.998 36.204 0L192 312.69 432.095 72.596c9.997-9.997 26.207-9.997 36.204 0l36.203 36.204c9.997 9.997 9.997 26.206 0 36.204l-294.4 294.401c-9.998 9.997-26.207 9.997-36.204-.001z"}}]})(n)}function pZ(n){return Vr({attr:{viewBox:"0 0 448 512"},child:[{tag:"path",attr:{d:"M320 448v40c0 13.255-10.745 24-24 24H24c-13.255 0-24-10.745-24-24V120c0-13.255 10.745-24 24-24h72v296c0 30.879 25.121 56 56 56h168zm0-344V0H152c-13.255 0-24 10.745-24 24v368c0 13.255 10.745 24 24 24h272c13.255 0 24-10.745 24-24V128H344c-13.2 0-24-10.8-24-24zm120.971-31.029L375.029 7.029A24 24 0 0 0 358.059 0H352v96h96v-6.059a24 24 0 0 0-7.029-16.97z"}}]})(n)}function YF(n){return Vr({attr:{viewBox:"0 0 640 512"},child:[{tag:"path",attr:{d:"M528 448H112c-8.8 0-16 7.2-16 16v32c0 8.8 7.2 16 16 16h416c8.8 0 16-7.2 16-16v-32c0-8.8-7.2-16-16-16zm64-320c-26.5 0-48 21.5-48 48 0 7.1 1.6 13.7 4.4 19.8L476 239.2c-15.4 9.2-35.3 4-44.2-11.6L350.3 85C361 76.2 368 63 368 48c0-26.5-21.5-48-48-48s-48 21.5-48 48c0 15 7 28.2 17.7 37l-81.5 142.6c-8.9 15.6-28.9 20.8-44.2 11.6l-72.3-43.4c2.7-6 4.4-12.7 4.4-19.8 0-26.5-21.5-48-48-48S0 149.5 0 176s21.5 48 48 48c2.6 0 5.2-.4 7.7-.8L128 416h384l72.3-192.8c2.5.4 5.1.8 7.7.8 26.5 0 48-21.5 48-48s-21.5-48-48-48z"}}]})(n)}function BWe(n){return Vr({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M488.6 250.2L392 214V105.5c0-15-9.3-28.4-23.4-33.7l-100-37.5c-8.1-3.1-17.1-3.1-25.3 0l-100 37.5c-14.1 5.3-23.4 18.7-23.4 33.7V214l-96.6 36.2C9.3 255.5 0 268.9 0 283.9V394c0 13.6 7.7 26.1 19.9 32.2l100 50c10.1 5.1 22.1 5.1 32.2 0l103.9-52 103.9 52c10.1 5.1 22.1 5.1 32.2 0l100-50c12.2-6.1 19.9-18.6 19.9-32.2V283.9c0-15-9.3-28.4-23.4-33.7zM358 214.8l-85 31.9v-68.2l85-37v73.3zM154 104.1l102-38.2 102 38.2v.6l-102 41.4-102-41.4v-.6zm84 291.1l-85 42.5v-79.1l85-38.8v75.4zm0-112l-102 41.4-102-41.4v-.6l102-38.2 102 38.2v.6zm240 112l-85 42.5v-79.1l85-38.8v75.4zm0-112l-102 41.4-102-41.4v-.6l102-38.2 102 38.2v.6z"}}]})(n)}function zWe(n){return Vr({attr:{viewBox:"0 0 576 512"},child:[{tag:"path",attr:{d:"M402.6 83.2l90.2 90.2c3.8 3.8 3.8 10 0 13.8L274.4 405.6l-92.8 10.3c-12.4 1.4-22.9-9.1-21.5-21.5l10.3-92.8L388.8 83.2c3.8-3.8 10-3.8 13.8 0zm162-22.9l-48.8-48.8c-15.2-15.2-39.9-15.2-55.2 0l-35.4 35.4c-3.8 3.8-3.8 10 0 13.8l90.2 90.2c3.8 3.8 10 3.8 13.8 0l35.4-35.4c15.2-15.3 15.2-40 0-55.2zM384 346.2V448H64V128h229.8c3.2 0 6.2-1.3 8.5-3.5l40-40c7.6-7.6 2.2-20.5-8.5-20.5H48C21.5 64 0 85.5 0 112v352c0 26.5 21.5 48 48 48h352c26.5 0 48-21.5 48-48V306.2c0-10.7-12.9-16-20.5-8.5l-40 40c-2.2 2.3-3.5 5.3-3.5 8.5z"}}]})(n)}function WWe(n){return Vr({attr:{viewBox:"0 0 192 512"},child:[{tag:"path",attr:{d:"M96 184c39.8 0 72 32.2 72 72s-32.2 72-72 72-72-32.2-72-72 32.2-72 72-72zM24 80c0 39.8 32.2 72 72 72s72-32.2 72-72S135.8 8 96 8 24 40.2 24 80zm0 352c0 39.8 32.2 72 72 72s72-32.2 72-72-32.2-72-72-72-72 32.2-72 72z"}}]})(n)}function GWe(n){return Vr({attr:{viewBox:"0 0 640 512"},child:[{tag:"path",attr:{d:"M480.07 96H160a160 160 0 1 0 114.24 272h91.52A160 160 0 1 0 480.07 96zM248 268a12 12 0 0 1-12 12h-52v52a12 12 0 0 1-12 12h-24a12 12 0 0 1-12-12v-52H84a12 12 0 0 1-12-12v-24a12 12 0 0 1 12-12h52v-52a12 12 0 0 1 12-12h24a12 12 0 0 1 12 12v52h52a12 12 0 0 1 12 12zm216 76a40 40 0 1 1 40-40 40 40 0 0 1-40 40zm64-96a40 40 0 1 1 40-40 40 40 0 0 1-40 40z"}}]})(n)}function jae(n){return Vr({attr:{viewBox:"0 0 496 512"},child:[{tag:"path",attr:{d:"M336.5 160C322 70.7 287.8 8 248 8s-74 62.7-88.5 152h177zM152 256c0 22.2 1.2 43.5 3.3 64h185.3c2.1-20.5 3.3-41.8 3.3-64s-1.2-43.5-3.3-64H155.3c-2.1 20.5-3.3 41.8-3.3 64zm324.7-96c-28.6-67.9-86.5-120.4-158-141.6 24.4 33.8 41.2 84.7 50 141.6h108zM177.2 18.4C105.8 39.6 47.8 92.1 19.3 160h108c8.7-56.9 25.5-107.8 49.9-141.6zM487.4 192H372.7c2.1 21 3.3 42.5 3.3 64s-1.2 43-3.3 64h114.6c5.5-20.5 8.6-41.8 8.6-64s-3.1-43.5-8.5-64zM120 256c0-21.5 1.2-43 3.3-64H8.6C3.2 212.5 0 233.8 0 256s3.2 43.5 8.6 64h114.6c-2-21-3.2-42.5-3.2-64zm39.5 96c14.5 89.3 48.7 152 88.5 152s74-62.7 88.5-152h-177zm159.3 141.6c71.4-21.2 129.4-73.7 158-141.6h-108c-8.8 56.9-25.6 107.8-50 141.6zM19.3 352c28.6 67.9 86.5 120.4 158 141.6-24.4-33.8-41.2-84.7-50-141.6h-108z"}}]})(n)}function HWe(n){return Vr({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M256 8C119.043 8 8 119.083 8 256c0 136.997 111.043 248 248 248s248-111.003 248-248C504 119.083 392.957 8 256 8zm0 110c23.196 0 42 18.804 42 42s-18.804 42-42 42-42-18.804-42-42 18.804-42 42-42zm56 254c0 6.627-5.373 12-12 12h-88c-6.627 0-12-5.373-12-12v-24c0-6.627 5.373-12 12-12h12v-64h-12c-6.627 0-12-5.373-12-12v-24c0-6.627 5.373-12 12-12h64c6.627 0 12 5.373 12 12v100h12c6.627 0 12 5.373 12 12v24z"}}]})(n)}function $We(n){return Vr({attr:{viewBox:"0 0 576 512"},child:[{tag:"path",attr:{d:"M528 448H48c-26.51 0-48-21.49-48-48V112c0-26.51 21.49-48 48-48h480c26.51 0 48 21.49 48 48v288c0 26.51-21.49 48-48 48zM128 180v-40c0-6.627-5.373-12-12-12H76c-6.627 0-12 5.373-12 12v40c0 6.627 5.373 12 12 12h40c6.627 0 12-5.373 12-12zm96 0v-40c0-6.627-5.373-12-12-12h-40c-6.627 0-12 5.373-12 12v40c0 6.627 5.373 12 12 12h40c6.627 0 12-5.373 12-12zm96 0v-40c0-6.627-5.373-12-12-12h-40c-6.627 0-12 5.373-12 12v40c0 6.627 5.373 12 12 12h40c6.627 0 12-5.373 12-12zm96 0v-40c0-6.627-5.373-12-12-12h-40c-6.627 0-12 5.373-12 12v40c0 6.627 5.373 12 12 12h40c6.627 0 12-5.373 12-12zm96 0v-40c0-6.627-5.373-12-12-12h-40c-6.627 0-12 5.373-12 12v40c0 6.627 5.373 12 12 12h40c6.627 0 12-5.373 12-12zm-336 96v-40c0-6.627-5.373-12-12-12h-40c-6.627 0-12 5.373-12 12v40c0 6.627 5.373 12 12 12h40c6.627 0 12-5.373 12-12zm96 0v-40c0-6.627-5.373-12-12-12h-40c-6.627 0-12 5.373-12 12v40c0 6.627 5.373 12 12 12h40c6.627 0 12-5.373 12-12zm96 0v-40c0-6.627-5.373-12-12-12h-40c-6.627 0-12 5.373-12 12v40c0 6.627 5.373 12 12 12h40c6.627 0 12-5.373 12-12zm96 0v-40c0-6.627-5.373-12-12-12h-40c-6.627 0-12 5.373-12 12v40c0 6.627 5.373 12 12 12h40c6.627 0 12-5.373 12-12zm-336 96v-40c0-6.627-5.373-12-12-12H76c-6.627 0-12 5.373-12 12v40c0 6.627 5.373 12 12 12h40c6.627 0 12-5.373 12-12zm288 0v-40c0-6.627-5.373-12-12-12H172c-6.627 0-12 5.373-12 12v40c0 6.627 5.373 12 12 12h232c6.627 0 12-5.373 12-12zm96 0v-40c0-6.627-5.373-12-12-12h-40c-6.627 0-12 5.373-12 12v40c0 6.627 5.373 12 12 12h40c6.627 0 12-5.373 12-12z"}}]})(n)}function Bae(n){return Vr({attr:{viewBox:"0 0 640 512"},child:[{tag:"path",attr:{d:"M633.82 458.1l-157.8-121.96C488.61 312.13 496 285.01 496 256v-48c0-8.84-7.16-16-16-16h-16c-8.84 0-16 7.16-16 16v48c0 17.92-3.96 34.8-10.72 50.2l-26.55-20.52c3.1-9.4 5.28-19.22 5.28-29.67V96c0-53.02-42.98-96-96-96s-96 42.98-96 96v45.36L45.47 3.37C38.49-2.05 28.43-.8 23.01 6.18L3.37 31.45C-2.05 38.42-.8 48.47 6.18 53.9l588.36 454.73c6.98 5.43 17.03 4.17 22.46-2.81l19.64-25.27c5.41-6.97 4.16-17.02-2.82-22.45zM400 464h-56v-33.77c11.66-1.6 22.85-4.54 33.67-8.31l-50.11-38.73c-6.71.4-13.41.87-20.35.2-55.85-5.45-98.74-48.63-111.18-101.85L144 241.31v6.85c0 89.64 63.97 169.55 152 181.69V464h-56c-8.84 0-16 7.16-16 16v16c0 8.84 7.16 16 16 16h160c8.84 0 16-7.16 16-16v-16c0-8.84-7.16-16-16-16z"}}]})(n)}function zae(n){return Vr({attr:{viewBox:"0 0 352 512"},child:[{tag:"path",attr:{d:"M176 352c53.02 0 96-42.98 96-96V96c0-53.02-42.98-96-96-96S80 42.98 80 96v160c0 53.02 42.98 96 96 96zm160-160h-16c-8.84 0-16 7.16-16 16v48c0 74.8-64.49 134.82-140.79 127.38C96.71 376.89 48 317.11 48 250.3V208c0-8.84-7.16-16-16-16H16c-8.84 0-16 7.16-16 16v40.16c0 89.64 63.97 169.55 152 181.69V464H96c-8.84 0-16 7.16-16 16v16c0 8.84 7.16 16 16 16h160c8.84 0 16-7.16 16-16v-16c0-8.84-7.16-16-16-16h-56v-33.77C285.71 418.47 352 344.9 352 256v-48c0-8.84-7.16-16-16-16z"}}]})(n)}function KWe(n){return Vr({attr:{viewBox:"0 0 384 512"},child:[{tag:"path",attr:{d:"M0 352a160 160 0 0 0 160 160h64a160 160 0 0 0 160-160V224H0zM176 0h-16A160 160 0 0 0 0 160v32h176zm48 0h-16v192h176v-32A160 160 0 0 0 224 0z"}}]})(n)}function qWe(n){return Vr({attr:{viewBox:"0 0 448 512"},child:[{tag:"path",attr:{d:"M416 208H272V64c0-17.67-14.33-32-32-32h-32c-17.67 0-32 14.33-32 32v144H32c-17.67 0-32 14.33-32 32v32c0 17.67 14.33 32 32 32h144v144c0 17.67 14.33 32 32 32h32c17.67 0 32-14.33 32-32V304h144c17.67 0 32-14.33 32-32v-32c0-17.67-14.33-32-32-32z"}}]})(n)}function YWe(n){return Vr({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M466.5 83.7l-192-80a48.15 48.15 0 0 0-36.9 0l-192 80C27.7 91.1 16 108.6 16 128c0 198.5 114.5 335.7 221.5 380.3 11.8 4.9 25.1 4.9 36.9 0C360.1 472.6 496 349.3 496 128c0-19.4-11.7-36.9-29.5-44.3zM256.1 446.3l-.1-381 175.9 73.3c-3.3 151.4-82.1 261.1-175.8 307.7z"}}]})(n)}function XF(n){return Vr({attr:{viewBox:"0 0 576 512"},child:[{tag:"path",attr:{d:"M259.3 17.8L194 150.2 47.9 171.5c-26.2 3.8-36.7 36.1-17.7 54.6l105.7 103-25 145.5c-4.5 26.3 23.2 46 46.4 33.7L288 439.6l130.7 68.7c23.2 12.2 50.9-7.4 46.4-33.7l-25-145.5 105.7-103c19-18.5 8.5-50.8-17.7-54.6L382 150.2 316.7 17.8c-11.7-23.6-45.6-23.9-57.4 0z"}}]})(n)}function XWe(n){return Vr({attr:{viewBox:"0 0 640 512"},child:[{tag:"path",attr:{d:"M624 208H432c-8.8 0-16 7.2-16 16v32c0 8.8 7.2 16 16 16h192c8.8 0 16-7.2 16-16v-32c0-8.8-7.2-16-16-16zm-400 48c70.7 0 128-57.3 128-128S294.7 0 224 0 96 57.3 96 128s57.3 128 128 128zm89.6 32h-16.7c-22.2 10.2-46.9 16-72.9 16s-50.6-5.8-72.9-16h-16.7C60.2 288 0 348.2 0 422.4V464c0 26.5 21.5 48 48 48h352c26.5 0 48-21.5 48-48v-41.6c0-74.2-60.2-134.4-134.4-134.4z"}}]})(n)}function JWe(n){return Vr({attr:{viewBox:"0 0 640 512"},child:[{tag:"path",attr:{d:"M96 224c35.3 0 64-28.7 64-64s-28.7-64-64-64-64 28.7-64 64 28.7 64 64 64zm448 0c35.3 0 64-28.7 64-64s-28.7-64-64-64-64 28.7-64 64 28.7 64 64 64zm32 32h-64c-17.6 0-33.5 7.1-45.1 18.6 40.3 22.1 68.9 62 75.1 109.4h66c17.7 0 32-14.3 32-32v-32c0-35.3-28.7-64-64-64zm-256 0c61.9 0 112-50.1 112-112S381.9 32 320 32 208 82.1 208 144s50.1 112 112 112zm76.8 32h-8.3c-20.8 10-43.9 16-68.5 16s-47.6-6-68.5-16h-8.3C179.6 288 128 339.6 128 403.2V432c0 26.5 21.5 48 48 48h288c26.5 0 48-21.5 48-48v-28.8c0-63.6-51.6-115.2-115.2-115.2zm-223.7-13.4C161.5 263.1 145.6 256 128 256H64c-35.3 0-64 28.7-64 64v32c0 17.7 14.3 32 32 32h65.9c6.3-47.4 34.9-87.3 75.2-109.4z"}}]})(n)}function QWe(n){return Vr({attr:{viewBox:"0 0 640 512"},child:[{tag:"path",attr:{d:"M634.91 154.88C457.74-8.99 182.19-8.93 5.09 154.88c-6.66 6.16-6.79 16.59-.35 22.98l34.24 33.97c6.14 6.1 16.02 6.23 22.4.38 145.92-133.68 371.3-133.71 517.25 0 6.38 5.85 16.26 5.71 22.4-.38l34.24-33.97c6.43-6.39 6.3-16.82-.36-22.98zM320 352c-35.35 0-64 28.65-64 64s28.65 64 64 64 64-28.65 64-64-28.65-64-64-64zm202.67-83.59c-115.26-101.93-290.21-101.82-405.34 0-6.9 6.1-7.12 16.69-.57 23.15l34.44 33.99c6 5.92 15.66 6.32 22.05.8 83.95-72.57 209.74-72.41 293.49 0 6.39 5.52 16.05 5.13 22.05-.8l34.44-33.99c6.56-6.46 6.33-17.06-.56-23.15z"}}]})(n)}function Wae({open:n,onClose:e}){const i=O.useRef(null),o=lc(),{user:l}=O.useContext(Zi),u=v=>{i.current&&!i.current.contains(v.target)&&e()},p=async v=>{const w=y(v);if((w==null?void 0:w.source)==="readyplayerme"&&(w.eventName==="v1.frame.ready"&&i.current.contentWindow.postMessage(JSON.stringify({target:"readyplayerme",type:"subscribe",eventName:"v1.**"}),"*"),w.eventName==="v1.avatar.exported")){const C=w.data.url;if(console.log(`Avatar URL: ${C}`),o("AvatarUrlFromReact",{url:C}),l&&l.uid)try{await $oe(l.uid,C),e()}catch(R){console.error("Error updating RPM URL:",R)}else console.error("No authenticated user found to update rpmURL.")}},y=v=>{try{return JSON.parse(v.data)}catch{return null}};return O.useEffect(()=>(n&&(document.addEventListener("mousedown",u),window.addEventListener("message",p)),()=>{document.removeEventListener("mousedown",u),window.removeEventListener("message",p)}),[n]),n&&S.jsx(Nc,{children:S.jsx(ct,{position:"fixed",top:"0",left:"0",width:"100%",height:"100%",bg:"rgba(0, 0, 0, 0.8)",zIndex:1e4,display:"flex",justifyContent:"center",alignItems:"center",onClick:v=>v.stopPropagation(),children:S.jsx(ct,{position:"relative",maxWidth:"1080px",maxHeight:"800px",width:"90%",height:"90%",children:S.jsx("iframe",{ref:i,src:"https://spacesmetaverse.readyplayer.me/avatar?frameApi",title:"Ready Player Me",width:"100%",height:"100%",style:{border:"none",borderRadius:"8px"},allow:"camera *; microphone *; clipboard-write"})})})})}function ZWe({isOpen:n,onClose:e}){const[i,o]=O.useState(!1),[l,u]=O.useState(null),{user:p}=O.useContext(Zi),y=lc(),v=L=>{L.stopPropagation(),o(!0)},w=()=>{o(!1),e()},C=async L=>{if(u(L),p&&p.uid)try{await $oe(p.uid,L.url),y("AvatarUrlFromReact",{url:L.url}),e()}catch(U){console.error("Error updating RPM URL:",U)}else console.error("No authenticated user found to update rpmURL.")},R=Cg("gray.200","whiteAlpha.300"),N="rgba(0, 0, 0, 0.3)",M=[{id:1,url:"https://models.readyplayer.me/67c8408d38f7924e15a8bd0a.glb",name:"Default Avatar 1"},{id:2,url:"https://models.readyplayer.me/67c8576838e3cf57cc697c15.glb",name:"Default Avatar 2"},{id:3,url:"https://models.readyplayer.me/67c884144c4878c55e515ff5.glb",name:"Default Avatar 3"},{id:4,url:"https://models.readyplayer.me/67c885af25f4d62e75c0ff1e.glb",name:"Default Avatar 4"},{id:5,url:"https://models.readyplayer.me/67c8860f4c4878c55e5189b6.glb",name:"Default Avatar 5"},{id:6,url:"https://models.readyplayer.me/67c8869db6d0b438b7abd822.glb",name:"Default Avatar 6"},{id:7,url:"https://models.readyplayer.me/67c886ed28ee0e0bfac89688.glb",name:"Default Avatar 7"},{id:8,url:"https://models.readyplayer.me/67c88731795ea3e2e6ea84db.glb",name:"Default Avatar 8"},{id:9,url:"https://models.readyplayer.me/67c8878b0cdc0f22383f0f8f.glb",name:"Default Avatar 9"}];return S.jsxs(S.Fragment,{children:[S.jsx(Nc,{children:S.jsxs(ls,{isOpen:n,onClose:e,isCentered:!0,size:"xl",zIndex:9999,children:[S.jsx(ds,{bg:"rgba(0, 0, 0, 0.8)",backdropFilter:"blur(8px)"}),S.jsxs(us,{bg:"#1a1a1a",color:"white",borderRadius:"xl",border:"1px solid #333",maxW:"900px",children:[S.jsx(co,{fontSize:"md",fontWeight:"600",pb:1,pt:3,px:4,color:"white",children:"Customise Your Avatar"}),S.jsx(Is,{color:"white",bg:"rgba(255,255,255,0.1)",_hover:{color:"gray.400",bg:"transparent"},borderRadius:"full",size:"sm",top:2,right:3}),S.jsx(gs,{pb:4,children:S.jsxs(Ir,{spacing:4,align:"stretch",children:[S.jsx(Ye,{fontSize:"sm",children:"Choose from our collection or create your own unique avatar"}),S.jsxs(Ere,{columns:5,spacing:2,children:[S.jsx(ct,{position:"relative",cursor:"pointer",borderWidth:"2px",borderStyle:"dashed",borderColor:R,borderRadius:"lg",overflow:"hidden",onClick:v,_hover:{bg:N},transition:"all 0.2s",display:"flex",alignItems:"center",justifyContent:"center",aspectRatio:"1",children:S.jsxs(Ir,{spacing:1,children:[S.jsx(Sn,{as:qWe,boxSize:4}),S.jsx(Ye,{fontSize:"xs",children:"Create Custom Avatar"})]})}),M.map(L=>S.jsxs(ct,{position:"relative",cursor:"pointer",borderWidth:"2px",borderColor:(l==null?void 0:l.id)===L.id?"blue.400":R,borderRadius:"lg",overflow:"hidden",onClick:()=>C(L),_hover:{bg:N},transition:"all 0.2s",aspectRatio:"1",children:[S.jsx(yp,{src:L.url.replace(".glb",".png?scene=fullbody-portrait-closeupfront&w=640&q=75"),alt:L.name,width:"100%",height:"100%",objectFit:"cover"}),S.jsx(ct,{position:"absolute",bottom:"0",left:"0",right:"0",p:1,bg:"rgba(0, 0, 0, 0.7)",children:S.jsx(Ye,{fontSize:"xs",children:L.name})})]},L.id))]})]})})]})]})}),i&&S.jsx(Wae,{open:i,onClose:w})]})}function e9e(){const{fullscreenRef:n}=fh(),[e,i]=O.useState(!1),[o,l]=O.useState(!1),[u,p]=O.useState(!1),[y,v]=O.useState(!1),{user:w}=O.useContext(Zi),[C,R]=O.useState(null),[N,M]=O.useState(!0),L=(q,re)=>!q||!re?"?":`${q.charAt(0)}${re.charAt(0)}`.toUpperCase(),U=async()=>{if(w!=null&&w.uid){M(!0);try{const q=await su(w.uid);R({rpmURL:q.rpmURL?q.rpmURL.replace(".glb",".png?scene=fullbody-portrait-closeupfront&w=640&q=75"):null,firstName:q.firstName,lastName:q.lastName})}catch(q){console.error("Error fetching profile data:",q)}finally{M(!1)}}};O.useEffect(()=>{U()},[w==null?void 0:w.uid]),O.useEffect(()=>{const q=()=>{i(!0)};return window.addEventListener("PlayerInstantiated",q),()=>{window.removeEventListener("PlayerInstantiated",q)}},[]);const z=()=>l(!o),J=()=>{l(!1),U()};return e?S.jsxs(S.Fragment,{children:[S.jsx(Uf,{label:"Edit Avatar",hasArrow:!0,placement:"top",closeOnClick:!0,isOpen:y,portalProps:{containerRef:n},children:S.jsxs(ct,{position:"relative",onMouseEnter:()=>{p(!0),v(!0)},onMouseLeave:()=>{p(!1),v(!1)},cursor:"pointer",onClick:z,children:[S.jsx(ml,{src:N||C==null?void 0:C.rpmURL,size:"md",borderRadius:"full",bg:"white",name:N?L(C==null?void 0:C.firstName,C==null?void 0:C.lastName):" ",borderWidth:"1px",borderColor:"whiteAlpha.300"}),u&&S.jsx(ct,{position:"absolute",top:"0",left:"0",right:"0",bottom:"0",display:"flex",alignItems:"center",justifyContent:"center",bg:"rgba(0, 0, 0, 0.4)",borderRadius:"full",children:S.jsx(Ye,{fontSize:"xs",fontWeight:"bold",color:"white",children:"Edit"})})]})}),S.jsx(ZWe,{isOpen:o,onClose:J})]}):null}function t9e(n){return Vr({attr:{viewBox:"0 0 1024 1024"},child:[{tag:"path",attr:{d:"M391 240.9c-.8-6.6-8.9-9.4-13.6-4.7l-43.7 43.7L200 146.3a8.03 8.03 0 0 0-11.3 0l-42.4 42.3a8.03 8.03 0 0 0 0 11.3L280 333.6l-43.9 43.9a8.01 8.01 0 0 0 4.7 13.6L401 410c5.1.6 9.5-3.7 8.9-8.9L391 240.9zm10.1 373.2L240.8 633c-6.6.8-9.4 8.9-4.7 13.6l43.9 43.9L146.3 824a8.03 8.03 0 0 0 0 11.3l42.4 42.3c3.1 3.1 8.2 3.1 11.3 0L333.7 744l43.7 43.7A8.01 8.01 0 0 0 391 783l18.9-160.1c.6-5.1-3.7-9.4-8.8-8.8zm221.8-204.2L783.2 391c6.6-.8 9.4-8.9 4.7-13.6L744 333.6 877.7 200c3.1-3.1 3.1-8.2 0-11.3l-42.4-42.3a8.03 8.03 0 0 0-11.3 0L690.3 279.9l-43.7-43.7a8.01 8.01 0 0 0-13.6 4.7L614.1 401c-.6 5.2 3.7 9.5 8.8 8.9zM744 690.4l43.9-43.9a8.01 8.01 0 0 0-4.7-13.6L623 614c-5.1-.6-9.5 3.7-8.9 8.9L633 783.1c.8 6.6 8.9 9.4 13.6 4.7l43.7-43.7L824 877.7c3.1 3.1 8.2 3.1 11.3 0l42.4-42.3c3.1-3.1 3.1-8.2 0-11.3L744 690.4z"}}]})(n)}function n9e(n){return Vr({attr:{viewBox:"0 0 1024 1024"},child:[{tag:"path",attr:{d:"M290 236.4l43.9-43.9a8.01 8.01 0 0 0-4.7-13.6L169 160c-5.1-.6-9.5 3.7-8.9 8.9L179 329.1c.8 6.6 8.9 9.4 13.6 4.7l43.7-43.7L370 423.7c3.1 3.1 8.2 3.1 11.3 0l42.4-42.3c3.1-3.1 3.1-8.2 0-11.3L290 236.4zm352.7 187.3c3.1 3.1 8.2 3.1 11.3 0l133.7-133.6 43.7 43.7a8.01 8.01 0 0 0 13.6-4.7L863.9 169c.6-5.1-3.7-9.5-8.9-8.9L694.8 179c-6.6.8-9.4 8.9-4.7 13.6l43.9 43.9L600.3 370a8.03 8.03 0 0 0 0 11.3l42.4 42.4zM845 694.9c-.8-6.6-8.9-9.4-13.6-4.7l-43.7 43.7L654 600.3a8.03 8.03 0 0 0-11.3 0l-42.4 42.3a8.03 8.03 0 0 0 0 11.3L734 787.6l-43.9 43.9a8.01 8.01 0 0 0 4.7 13.6L855 864c5.1.6 9.5-3.7 8.9-8.9L845 694.9zm-463.7-94.6a8.03 8.03 0 0 0-11.3 0L236.3 733.9l-43.7-43.7a8.01 8.01 0 0 0-13.6 4.7L160.1 855c-.6 5.1 3.7 9.5 8.9 8.9L329.2 845c6.6-.8 9.4-8.9 4.7-13.6L290 787.6 423.7 654c3.1-3.1 3.1-8.2 0-11.3l-42.4-42.4z"}}]})(n)}function r9e(){const{isFullscreen:n,toggleFullscreen:e,fullscreenRef:i,isMobile:o}=fh(),l=Da();O.useEffect(()=>{const p=y=>{console.error("Fullscreen error:",y),l({title:"Fullscreen Error",description:"Could not enter fullscreen mode. Try tapping the button again or use the browser's fullscreen option.",status:"error",duration:5e3,isClosable:!0,position:"top"})};return document.addEventListener("fullscreenerror",p),document.addEventListener("webkitfullscreenerror",p),document.addEventListener("mozfullscreenerror",p),document.addEventListener("MSFullscreenError",p),()=>{document.removeEventListener("fullscreenerror",p),document.removeEventListener("webkitfullscreenerror",p),document.removeEventListener("mozfullscreenerror",p),document.removeEventListener("MSFullscreenError",p)}},[l]);const u=()=>{i.current?(o&&/iPhone|iPad|iPod/i.test(navigator.userAgent)&&!n&&l({title:"Mobile Fullscreen",description:"Tap the button again if fullscreen doesn't activate. For iOS, you may need to use the browser's share button and 'Add to Home Screen' for the best experience.",status:"info",duration:5e3,isClosable:!0,position:"top"}),e()):(console.error("Fullscreen target not set"),l({title:"Fullscreen Error",description:"Could not find fullscreen target element.",status:"error",duration:3e3,isClosable:!0,position:"top"}))};return S.jsx(Uf,{label:n?"Exit Fullscreen":"Enter Fullscreen",hasArrow:!0,placement:"bottom",closeOnClick:!0,portalProps:{containerRef:i},children:S.jsx(Pc,{"aria-label":n?"Exit Fullscreen":"Enter Fullscreen",icon:n?S.jsx(t9e,{}):S.jsx(n9e,{}),onClick:u,variant:"iconButton",size:o?"lg":"md"})})}const fZ={iframeContainer:{position:"relative",paddingBottom:"56.25%",height:0,overflow:"hidden",width:"100%"},iframe:{position:"absolute",top:0,left:0,width:"100%",height:"100%",border:"none"}};function i9e(){const{isOpen:n,onOpen:e,onClose:i}=od(),{fullscreenRef:o}=fh(),[l,u]=AWe(!1),{user:p}=O.useContext(Zi),{spaceID:y}=So(),{trackReactEvent:v,isReady:w}=_E(y,{enableDebugLogs:!0});O.useEffect(()=>{K.log("VideoPlayer: Current video URL:",l),l&&(K.log("VideoPlayer: Opening modal for video URL:",l),e(),w&&p&&(v(ro.REACT.VIDEO_CLICK,{category:io.MEDIA_INTERACTION,action:"video_player_open",videoUrl:l,context:"video_player_modal",spaceId:y,timestamp:new Date().toISOString()}),K.log(" Analytics: Video click event tracked for modal open:",l)))},[l,e,v,w,p,y]);const C=()=>{K.log("VideoPlayer: Closing modal"),w&&p&&l&&(v(ro.REACT.VIDEO_CLOSE,{category:io.MEDIA_INTERACTION,action:"video_player_close",videoUrl:l,context:"video_player_modal",spaceId:y,timestamp:new Date().toISOString()}),K.log(" Analytics: Video close event tracked for modal close:",l)),u(),i()};return S.jsx(Nc,{containerRef:o,children:S.jsxs(ls,{isOpen:n,onClose:C,size:"lg",isCentered:!0,portalProps:{containerRef:o},children:[S.jsx(ds,{bg:"rgba(0, 0, 0, 0.8)"}),S.jsxs(us,{bg:"gray.900",color:"white",borderRadius:"lg",overflow:"hidden",maxWidth:"80vw",maxHeight:"80vh",display:"flex",justifyContent:"center",alignItems:"center",position:"relative",zIndex:"modal",children:[S.jsx(Is,{size:"lg",bg:"gray.700",color:"white",borderRadius:"full",zIndex:"modal",_hover:{bg:"gray.600"},_focus:{boxShadow:"none"},position:"absolute",top:"10px",right:"10px"}),S.jsx(gs,{p:0,width:"100%",children:l&&S.jsx(ct,{style:fZ.iframeContainer,children:S.jsx("iframe",{src:l,style:fZ.iframe,allow:"autoplay; fullscreen",allowFullScreen:!0,title:"Video Player"})})})]})]})})}function s9e({isOpen:n,onClose:e,playerName:i,playerId:o,uid:l}){const[u,p]=O.useState(null),[y,v]=O.useState(!0),[w,C]=O.useState(null);return O.useEffect(()=>{n&&(async()=>{if(v(!0),C(null),!l){K.warn("NameplateModal: No UID provided for player:",i),C("No user ID available for this player"),v(!1);return}try{K.log("NameplateModal: Fetching profile for UID:",l);const N=await su(l);N?p({firstName:N.firstName,lastName:N.lastName,linkedinUrl:N.linkedinUrl,websiteUrl:N.websiteUrl,rpmURL:N.rpmURL?N.rpmURL.replace(".glb",".png?scene=fullbody-portrait-closeupfront&w=640&q=75"):null}):C("Could not find profile data for this player")}catch(N){K.error("Error fetching profile data:",N),C("Error loading profile data")}finally{v(!1)}})()},[l,n,i]),S.jsxs(ls,{isOpen:n,onClose:e,isCentered:!0,size:"md",children:[S.jsx(ds,{backdropFilter:"blur(10px)"}),S.jsxs(us,{bg:"gray.900",color:"white",borderRadius:"xl",children:[S.jsx(co,{children:"Player Info"}),S.jsx(Is,{}),S.jsx(gs,{pb:6,children:y?S.jsx(Vne,{py:8,children:S.jsx(ld,{size:"xl",color:"blue.400"})}):w?S.jsxs(Ig,{status:"warning",variant:"solid",borderRadius:"md",children:[S.jsx(Ag,{}),w]}):S.jsxs(Ir,{spacing:4,align:"center",children:[S.jsx(ml,{size:"2xl",src:u==null?void 0:u.rpmURL,bg:"whiteAlpha.300",name:i,borderWidth:"2px",borderColor:"whiteAlpha.300"}),S.jsxs(Ir,{spacing:1,children:[S.jsx(Ye,{fontSize:"2xl",fontWeight:"bold",children:i}),(u==null?void 0:u.firstName)&&S.jsxs(Ye,{fontSize:"md",color:"gray.400",children:[u.firstName," ",u.lastName]}),S.jsxs(Ye,{fontSize:"xs",color:"gray.500",mt:1,children:["ID: ",o]})]}),((u==null?void 0:u.linkedinUrl)||(u==null?void 0:u.websiteUrl))&&S.jsxs(S.Fragment,{children:[S.jsx(Ug,{borderColor:"whiteAlpha.300"}),S.jsxs(Qn,{spacing:4,pt:2,children:[(u==null?void 0:u.linkedinUrl)&&S.jsx(Zl,{href:u.linkedinUrl,isExternal:!0,children:S.jsx(Pc,{icon:S.jsx(Fae,{}),variant:"ghost",colorScheme:"linkedin",size:"lg","aria-label":"LinkedIn profile",_hover:{bg:"whiteAlpha.200"}})}),(u==null?void 0:u.websiteUrl)&&S.jsx(Zl,{href:u.websiteUrl,isExternal:!0,children:S.jsx(Pc,{icon:S.jsx(jae,{}),variant:"ghost",colorScheme:"blue",size:"lg","aria-label":"Personal website",_hover:{bg:"whiteAlpha.200"}})})]})]})]})})]})]})}const o9e=({isVisible:n,onToggleVisibility:e,spaceID:i})=>{const[o]=pLe("(max-width: 768px)"),[l,u]=O.useState(!1);O.useEffect(()=>{u(/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent||""))},[]);const p=o||l,y=Nae(),[v,w]=O.useState(!1),[C,R]=O.useState([]),[N,M]=O.useState(!1),[L,U]=O.useState({}),[z,J]=O.useState({}),[q,re]=O.useState(!1),ce=Da(),[ae,pe]=O.useState(null),[H,X]=O.useState(null),{isOpen:Q,onOpen:ne,onClose:he}=od(),[fe,de]=O.useState(null),{isOpen:ke,onOpen:De,onClose:je}=od(),[Te,we]=O.useState(null),Ie=window.currentUser||{},ve=i||window.spaceID||window.location.pathname.split("/").pop()||"fallback-space-id";O.useEffect(()=>{sd(ve).then(ut=>re(!!(ut!=null&&ut.voiceDisabled)))},[ve]),O.useEffect(()=>{const ut=()=>w(!0);return window.addEventListener("PlayerInstantiated",ut),window.isPlayerInstantiated&&w(!0),()=>window.removeEventListener("PlayerInstantiated",ut)},[]),O.useEffect(()=>{const ut={};y.forEach(Ft=>{var on;Ft.uid&&((on=window.agoraClient)!=null&&on.client)&&(ut[Ft.uid]=Ft.isLocalPlayer?window.agoraClient.client.uid:Ft.uid)}),J(ut)},[y]),O.useEffect(()=>{const ut=setInterval(()=>{var Ft;if(window.agoraClient){M(!!window.agoraClient.isVoiceEnabled);const on={};(Ft=window.agoraClient.client)==null||Ft.remoteUsers.forEach(Ht=>{on[Ht.uid]=!!Ht.audioTrack&&!Ht.audioTrack.muted}),U(on)}},500);return()=>clearInterval(ut)},[]),O.useEffect(()=>{(async()=>{const Ft=await Promise.all(y.map(async on=>{var Ht,Se;if(!on.uid)return on;try{const Ne=await su(on.uid),$e=`space_${ve}_owners`,Pt=`space_${ve}_hosts`,Ot=(Ht=Ne.groups)!=null&&Ht.includes($e)?"owner":(Se=Ne.groups)!=null&&Se.includes(Pt)?"host":null,Et=Ne.rpmURL?Ne.rpmURL.replace(".glb",".png?scene=fullbody-portrait-closeupfront&w=640&q=75"):void 0;return{...on,...Ne,rpmURL:Et,role:Ot}}catch{return on}}));R(Ft)})()},[y,ve]);const{kickPlayer:xe,isKicking:Ge,kickResult:Ze,error:lt,resetKickState:vt}=PWe();O.useEffect(()=>{Ze!=null&&Ze.success&&(ae||Te)&&(ae&&(ce({title:"Remove Successful",description:`${ae} has been removed.`,status:"success",duration:3e3,isClosable:!0}),pe(null)),Te&&(ce({title:"Ban Successful",description:`${Te} has been banned.`,status:"success",duration:3e3,isClosable:!0}),we(null)),vt()),lt&&(ce({title:"Error",description:lt,status:"error",duration:3e3,isClosable:!0}),pe(null),we(null),vt())},[Ze,lt,ae,Te,ce,vt]);const nt=ut=>ut.isLocalPlayer||ut.uid===Ie.uid,mt=ut=>nt(ut)?N:L[z[ut.uid]],et=({role:ut})=>ut==="owner"?S.jsx(Sn,{as:YF,color:"green.400",boxSize:3,ml:1}):ut==="host"?S.jsx(Sn,{as:XF,color:"purple.400",boxSize:3,ml:1}):null,St=({role:ut})=>ut==="owner"?S.jsxs(Qn,{spacing:1,bg:"green.800",px:3,py:1,borderRadius:"md",children:[S.jsx(Sn,{as:YF,color:"green.300"}),S.jsx(sh,{colorScheme:"green",variant:"solid",children:"Owner"})]}):ut==="host"?S.jsxs(Qn,{spacing:1,bg:"purple.800",px:3,py:1,borderRadius:"md",children:[S.jsx(Sn,{as:XF,color:"purple.300"}),S.jsx(sh,{colorScheme:"purple",variant:"solid",children:"Host"})]}):null,un=()=>{H&&(pe(H.playerName),xe(H.uid,Ie.uid),he())},ft=async()=>{fe&&(we(fe.playerName),await h8e(ve,{uid:fe.uid,playerName:fe.playerName,bannedAt:new Date().toISOString(),...Ie.uid&&{bannedBy:Ie.uid}}),xe(fe.uid,Ie.uid),je())},Ct=(ut,Ft)=>{var Ht;if(!(((Ht=C.find(Se=>Se.isLocalPlayer))==null?void 0:Ht.role)==="owner"))return ce({title:"Permission Denied",status:"error",duration:3e3,isClosable:!0});ut==="remove"?(X(Ft),ne()):ut==="ban"&&(de(Ft),De())};return S.jsxs(S.Fragment,{children:[S.jsxs(ct,{position:"absolute",top:"100px",right:"20px",zIndex:"1",bg:"rgba(0,0,0,0.4)",p:4,borderRadius:"md",color:"white",minWidth:"200px",maxHeight:"300px",visibility:v&&n&&!p?"visible":"hidden",role:"group",children:[S.jsx(ct,{position:"absolute",top:2,right:2,opacity:0,_groupHover:{opacity:1},transition:"opacity 0.2s",children:S.jsx(Pc,{icon:S.jsx(v8e,{boxSize:3}),size:"xs","aria-label":"Close list",variant:"unstyled",color:"white",onClick:e})}),S.jsxs(Ye,{fontWeight:"bold",mb:2,fontSize:"sm",children:["People Online: ",y.length]}),S.jsx(ct,{maxHeight:"200px",overflowY:"auto",css:{"&::-webkit-scrollbar":{width:"4px"},"&::-webkit-scrollbar-thumb":{background:"rgba(255,255,255,0.3)",borderRadius:"2px"}},children:S.jsx(Ir,{align:"stretch",spacing:1,width:"100%",children:C.sort((ut,Ft)=>ut.isLocalPlayer?-1:Ft.isLocalPlayer?1:0).map((ut,Ft)=>{var Ne;const on=nt(ut),Ht=((Ne=C.find($e=>$e.isLocalPlayer))==null?void 0:Ne.role)==="owner"&&!on&&ut.role!=="owner",Se=!q&&mt(ut);return S.jsx(ct,{children:S.jsxs(Xre,{placement:"left",trigger:"hover",children:[S.jsx(tie,{children:S.jsxs(Qn,{p:1,borderRadius:"md",_hover:{bg:"whiteAlpha.200"},children:[S.jsx(ml,{size:"xs",bg:"whiteAlpha.400",src:ut.rpmURL,name:" ",borderWidth:"1px",borderColor:"whiteAlpha.300"}),S.jsx(Ye,{fontSize:"xs",children:ut.playerName}),S.jsx(et,{role:ut.role}),S.jsx(dS,{}),!q&&(Se?S.jsx(ct,{color:"green.400",children:S.jsx(zae,{})}):S.jsx(ct,{color:"red.400",children:S.jsx(Bae,{})})),on?S.jsx(Ye,{fontSize:"xs",color:"gray.300",ml:1,children:"(you)"}):Ht?S.jsxs(VR,{children:[S.jsx(FR,{as:Pc,"aria-label":"Options",icon:S.jsx(WWe,{}),variant:"ghost",size:"xs",color:"gray.300",ml:1,minW:"16px",h:"16px",p:0}),S.jsxs(jR,{bg:"rgba(0,0,0,0.8)",borderColor:"whiteAlpha.300",minW:"120px",zIndex:10001,children:[S.jsx(mp,{icon:S.jsx(XWe,{}),onClick:()=>Ct("remove",ut),bg:"black",color:"white",_hover:{bg:"gray.800"},fontSize:"sm",children:"Remove"}),S.jsx(mp,{icon:S.jsx(jWe,{}),onClick:()=>Ct("ban",ut),bg:"black",color:"white",_hover:{bg:"gray.800"},fontSize:"sm",children:"Ban"})]})]}):null]})}),S.jsx(eie,{bg:"rgba(0,0,0,0.85)",color:"white",border:"none",p:4,minW:"220px",children:S.jsx(Qre,{children:S.jsxs(Ir,{align:"center",spacing:3,children:[S.jsx(ml,{size:"lg",src:ut.rpmURL}),S.jsx(Ye,{fontWeight:"bold",children:ut.playerName}),S.jsx(St,{role:ut.role}),ut.firstName&&S.jsxs(Ye,{fontSize:"sm",color:"gray.300",children:[ut.firstName," ",ut.lastName]}),S.jsxs(Qn,{spacing:4,pt:2,children:[ut.linkedInProfile&&S.jsx(Zl,{href:ut.linkedInProfile,isExternal:!0,children:S.jsx(Sn,{as:Fae})}),ut.websiteUrl&&S.jsx(Zl,{href:ut.websiteUrl,isExternal:!0,children:S.jsx(Sn,{as:jae})})]})]})})})]})},Ft)})})})]}),S.jsxs(ls,{isOpen:Q,onClose:he,isCentered:!0,children:[S.jsx(ds,{}),S.jsxs(us,{bg:"gray.800",color:"white",children:[S.jsx(co,{children:"Confirm Removal"}),S.jsx(Is,{}),S.jsx(gs,{children:S.jsxs(Ye,{children:["Remove ",H==null?void 0:H.playerName," from the room?"]})}),S.jsxs(uh,{children:[S.jsx(Nn,{colorScheme:"red",onClick:un,isLoading:Ge,mr:3,children:"Remove"}),S.jsx(Nn,{bg:"white",color:"gray.800",onClick:he,_hover:{bg:"gray.200"},children:"Cancel"})]})]})]}),S.jsxs(ls,{isOpen:ke,onClose:je,isCentered:!0,children:[S.jsx(ds,{}),S.jsxs(us,{bg:"gray.800",color:"white",children:[S.jsx(co,{children:"Confirm Ban"}),S.jsx(Is,{}),S.jsx(gs,{children:S.jsxs(Ye,{children:["Ban ",fe==null?void 0:fe.playerName," from the room? They will not be able to re-enter."]})}),S.jsxs(uh,{children:[S.jsx(Nn,{colorScheme:"red",onClick:ft,isLoading:Ge,mr:3,children:"Ban"}),S.jsx(Nn,{bg:"white",color:"gray.800",onClick:je,_hover:{bg:"gray.200"},children:"Cancel"})]})]})]})]})};var Jk={exports:{}},a9e=Jk.exports,mZ;function c9e(){return mZ||(mZ=1,function(n,e){(function(i,o){n.exports=o()})(a9e,function(){function i(t,r){return r.forEach(function(s){s&&typeof s!="string"&&!Array.isArray(s)&&Object.keys(s).forEach(function(a){if(a!=="default"&&!(a in t)){var c=Object.getOwnPropertyDescriptor(s,a);Object.defineProperty(t,a,c.get?c:{enumerable:!0,get:function(){return s[a]}})}})}),Object.freeze(t)}var o=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof Ny<"u"?Ny:typeof self<"u"?self:{};function l(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var u=function(t){try{return!!t()}catch{return!0}},p=!u(function(){var t=(function(){}).bind();return typeof t!="function"||t.hasOwnProperty("prototype")}),y=p,v=Function.prototype,w=v.call,C=y&&v.bind.bind(w,w),R=y?C:function(t){return function(){return w.apply(t,arguments)}},N=R({}.isPrototypeOf),M=function(t){return t&&t.Math===Math&&t},L=M(typeof globalThis=="object"&&globalThis)||M(typeof window=="object"&&window)||M(typeof self=="object"&&self)||M(typeof o=="object"&&o)||M(typeof o=="object"&&o)||function(){return this}()||Function("return this")(),U=p,z=Function.prototype,J=z.apply,q=z.call,re=typeof Reflect=="object"&&Reflect.apply||(U?q.bind(J):function(){return q.apply(J,arguments)}),ce=R,ae=ce({}.toString),pe=ce("".slice),H=function(t){return pe(ae(t),8,-1)},X=H,Q=R,ne=function(t){if(X(t)==="Function")return Q(t)},he=typeof document=="object"&&document.all,fe=he===void 0&&he!==void 0?function(t){return typeof t=="function"||t===he}:function(t){return typeof t=="function"},de={},ke=!u(function(){return Object.defineProperty({},1,{get:function(){return 7}})[1]!==7}),De=p,je=Function.prototype.call,Te=De?je.bind(je):function(){return je.apply(je,arguments)},we={},Ie={}.propertyIsEnumerable,Oe=Object.getOwnPropertyDescriptor,ve=Oe&&!Ie.call({1:2},1);we.f=ve?function(t){var r=Oe(this,t);return!!r&&r.enumerable}:Ie;var xe,Ge,Ze=function(t,r){return{enumerable:!(1&t),configurable:!(2&t),writable:!(4&t),value:r}},lt=u,vt=H,nt=Object,mt=R("".split),et=lt(function(){return!nt("z").propertyIsEnumerable(0)})?function(t){return vt(t)==="String"?mt(t,""):nt(t)}:nt,St=function(t){return t==null},un=St,ft=TypeError,Ct=function(t){if(un(t))throw new ft("Can't call method on "+t);return t},ut=et,Ft=Ct,on=function(t){return ut(Ft(t))},Ht=fe,Se=function(t){return typeof t=="object"?t!==null:Ht(t)},Ne={},$e=Ne,Pt=L,Ot=fe,Et=function(t){return Ot(t)?t:void 0},xt=function(t,r){return arguments.length<2?Et($e[t])||Et(Pt[t]):$e[t]&&$e[t][r]||Pt[t]&&Pt[t][r]},pn=L.navigator,Cn=pn&&pn.userAgent,En=Cn?String(Cn):"",It=L,cr=En,Lt=It.process,Yt=It.Deno,Or=Lt&&Lt.versions||Yt&&Yt.version,Oi=Or&&Or.v8;Oi&&(Ge=(xe=Oi.split("."))[0]>0&&xe[0]<4?1:+(xe[0]+xe[1])),!Ge&&cr&&(!(xe=cr.match(/Edge\/(\d+)/))||xe[1]>=74)&&(xe=cr.match(/Chrome\/(\d+)/))&&(Ge=+xe[1]);var ji=Ge,Fr=ji,Xn=u,oa=L.String,Ki=!!Object.getOwnPropertySymbols&&!Xn(function(){var t=Symbol("symbol detection");return!oa(t)||!(Object(t)instanceof Symbol)||!Symbol.sham&&Fr&&Fr<41}),xa=Ki&&!Symbol.sham&&typeof Symbol.iterator=="symbol",Sl=xt,Ps=fe,La=N,Wo=Object,uo=xa?function(t){return typeof t=="symbol"}:function(t){var r=Sl("Symbol");return Ps(r)&&La(r.prototype,Wo(t))},ud=String,Go=function(t){try{return ud(t)}catch{return"Object"}},dd=fe,uc=Go,bo=TypeError,Tr=function(t){if(dd(t))return t;throw new bo(uc(t)+" is not a function")},lu=Tr,aa=St,Ma=function(t,r){var s=t[r];return aa(s)?void 0:lu(s)},xc=Te,Ho=fe,gt=Se,_n=TypeError,jr={exports:{}},Ni=L,uu=Object.defineProperty,es=L,bl=function(t,r){try{uu(Ni,t,{value:r,configurable:!0,writable:!0})}catch{Ni[t]=r}return r},$o="__core-js_shared__",hd=jr.exports=es[$o]||bl($o,{});(hd.versions||(hd.versions=[])).push({version:"3.42.0",mode:"pure",copyright:" 2014-2025 Denis Pushkarev (zloirock.ru)",license:"https://github.com/zloirock/core-js/blob/v3.42.0/LICENSE",source:"https://github.com/zloirock/core-js"});var Lc=jr.exports,wl=Lc,ca=function(t,r){return wl[t]||(wl[t]=r||{})},dc=Ct,Ko=Object,ei=function(t){return Ko(dc(t))},In=ei,em=R({}.hasOwnProperty),ti=Object.hasOwn||function(t,r){return em(In(t),r)},Tl=R,Ua=0,Mp=Math.random(),tm=Tl(1 .toString),Mc=function(t){return"Symbol("+(t===void 0?"":t)+")_"+tm(++Ua+Mp,36)},la=ca,Up=ti,wo=Mc,Vp=Ki,nm=xa,Cl=L.Symbol,du=la("wks"),gh=nm?Cl.for||Cl:Cl&&Cl.withoutSetter||wo,Nr=function(t){return Up(du,t)||(du[t]=Vp&&Up(Cl,t)?Cl[t]:gh("Symbol."+t)),du[t]},pd=Te,fd=Se,Va=uo,ua=Ma,md=function(t,r){var s,a;if(Ho(s=t.toString)&&!gt(a=xc(s,t))||Ho(s=t.valueOf)&&!gt(a=xc(s,t)))return a;throw new _n("Can't convert object to primitive value")},Rl=TypeError,hu=Nr("toPrimitive"),ui=function(t,r){if(!fd(t)||Va(t))return t;var s,a=ua(t,hu);if(a){if(s=pd(a,t,r),!fd(s)||Va(s))return s;throw new Rl("Can't convert object to primitive value")}return md(t)},pu=uo,mr=function(t){var r=ui(t,"string");return pu(r)?r:r+""},Il=Se,_h=L.document,yh=Il(_h)&&Il(_h.createElement),fu=function(t){return yh?_h.createElement(t):{}},rm=fu,Fp=!ke&&!u(function(){return Object.defineProperty(rm("div"),"a",{get:function(){return 7}}).a!==7}),jp=ke,da=Te,_s=we,ha=Ze,pa=on,mu=mr,fa=ti,Fa=Fp,Bp=Object.getOwnPropertyDescriptor;de.f=jp?Bp:function(t,r){if(t=pa(t),r=mu(r),Fa)try{return Bp(t,r)}catch{}if(fa(t,r))return ha(!da(_s.f,t,r),t[r])};var Uc=u,ks=fe,Zg=/#|\.prototype\./,Al=function(t,r){var s=gu[Pl(t)];return s===hc||s!==im&&(ks(r)?Uc(r):!!r)},Pl=Al.normalize=function(t){return String(t).replace(Zg,".").toLowerCase()},gu=Al.data={},im=Al.NATIVE="N",hc=Al.POLYFILL="P",ma=Al,kl=Tr,be=p,Me=ne(ne.bind),ot=function(t,r){return kl(t),r===void 0?t:be?Me(t,r):function(){return t.apply(r,arguments)}},Kt={},sr=ke&&u(function(){return Object.defineProperty(function(){},"prototype",{value:42,writable:!1}).prototype!==42}),Br=Se,si=String,er=TypeError,tr=function(t){if(Br(t))return t;throw new er(si(t)+" is not an object")},Di=ke,Ws=Fp,Vc=sr,To=tr,_u=mr,Os=TypeError,pc=Object.defineProperty,sm=Object.getOwnPropertyDescriptor,Fc="enumerable",e_="configurable",Eh="writable";Kt.f=Di?Vc?function(t,r,s){if(To(t),r=_u(r),To(s),typeof t=="function"&&r==="prototype"&&"value"in s&&Eh in s&&!s[Eh]){var a=sm(t,r);a&&a[Eh]&&(t[r]=s.value,s={configurable:e_ in s?s[e_]:a[e_],enumerable:Fc in s?s[Fc]:a[Fc],writable:!1})}return pc(t,r,s)}:pc:function(t,r,s){if(To(t),r=_u(r),To(s),Ws)try{return pc(t,r,s)}catch{}if("get"in s||"set"in s)throw new Os("Accessors not supported");return"value"in s&&(t[r]=s.value),t};var gd=Kt,vh=Ze,fc=ke?function(t,r,s){return gd.f(t,r,vh(1,s))}:function(t,r,s){return t[r]=s,t},yu=L,t_=re,yE=ne,om=fe,am=de.f,EE=ma,ja=Ne,vE=ot,_d=fc,n_=ti,r_=function(t){var r=function(s,a,c){if(this instanceof r){switch(arguments.length){case 0:return new t;case 1:return new t(s);case 2:return new t(s,a)}return new t(s,a,c)}return t_(t,this,arguments)};return r.prototype=t.prototype,r},Gn=function(t,r){var s,a,c,d,h,m,g,E,b,I=t.target,A=t.global,k=t.stat,W=t.proto,j=A?yu:k?yu[I]:yu[I]&&yu[I].prototype,B=A?ja:ja[I]||_d(ja,I,{})[I],ee=B.prototype;for(d in r)a=!(s=EE(A?d:I+(k?".":"#")+d,t.forced))&&j&&n_(j,d),m=B[d],a&&(g=t.dontCallGetSet?(b=am(j,d))&&b.value:j[d]),h=a&&g?g:r[d],(s||W||typeof m!=typeof h)&&(E=t.bind&&a?vE(h,yu):t.wrap&&a?r_(h):W&&om(h)?yE(h):h,(t.sham||h&&h.sham||m&&m.sham)&&_d(E,"sham",!0),_d(B,d,E),W&&(n_(ja,c=I+"Prototype")||_d(ja,c,{}),_d(ja[c],d,h),t.real&&ee&&(s||!ee[d])&&_d(ee,d,h)))},ga=Math.ceil,SE=Math.floor,bE=Math.trunc||function(t){var r=+t;return(r>0?SE:ga)(r)},Eu=bE,P=function(t){var r=+t;return r!=r||r===0?0:Eu(r)},G=P,ie=Math.max,Ee=Math.min,Ke=function(t,r){var s=G(t);return s<0?ie(s+r,0):Ee(s,r)},dt=P,$t=Math.min,oi=function(t){var r=dt(t);return r>0?$t(r,9007199254740991):0},Gs=oi,hr=function(t){return Gs(t.length)},ho=on,Ns=Ke,jc=hr,Ba=function(t){return function(r,s,a){var c=ho(r),d=jc(c);if(d===0)return!t&&-1;var h,m=Ns(a,d);if(t&&s!=s){for(;d>m;)if((h=c[m++])!=h)return!0}else for(;d>m;m++)if((t||m in c)&&c[m]===s)return t||m||0;return!t&&-1}},yd={includes:Ba(!0),indexOf:Ba(!1)},cm=yd.includes;Gn({target:"Array",proto:!0,forced:u(function(){return!Array(1).includes()})},{includes:function(t){return cm(this,t,arguments.length>1?arguments[1]:void 0)}});var tI=L,nI=Ne,mc=function(t,r){var s=nI[t+"Prototype"],a=s&&s[r];if(a)return a;var c=tI[t],d=c&&c.prototype;return d&&d[r]},lm=mc("Array","includes"),aD=Se,cD=H,lD=Nr("match"),rb=function(t){var r;return aD(t)&&((r=t[lD])!==void 0?!!r:cD(t)==="RegExp")},rI=rb,i_=TypeError,um={};um[Nr("toStringTag")]="z";var ib=String(um)==="[object z]",wE=ib,uD=fe,s_=H,sb=Nr("toStringTag"),ob=Object,iI=s_(function(){return arguments}())==="Arguments",Ed=wE?s_:function(t){var r,s,a;return t===void 0?"Undefined":t===null?"Null":typeof(s=function(c,d){try{return c[d]}catch{}}(r=ob(t),sb))=="string"?s:iI?s_(r):(a=s_(r))==="Object"&&uD(r.callee)?"Arguments":a},sI=Ed,dD=String,za=function(t){if(sI(t)==="Symbol")throw new TypeError("Cannot convert a Symbol value to a string");return dD(t)},hD=Nr("match"),pD=Gn,fD=function(t){if(rI(t))throw new i_("The method doesn't accept regular expressions");return t},Ol=Ct,dm=za,oI=function(t){var r=/./;try{"/./"[t](r)}catch{try{return r[hD]=!1,"/./"[t](r)}catch{}}return!1},aI=R("".indexOf);pD({target:"String",proto:!0,forced:!oI("includes")},{includes:function(t){return!!~aI(dm(Ol(this)),dm(fD(t)),arguments.length>1?arguments[1]:void 0)}});var cI=mc("String","includes"),ab=N,cb=lm,mD=cI,lb=Array.prototype,Sh=String.prototype,ub=function(t){var r=t.includes;return t===lb||ab(lb,t)&&r===lb.includes?cb:typeof t=="string"||t===Sh||ab(Sh,t)&&r===Sh.includes?mD:r},rt=l(ub),db=Tr,lI=ei,TE=et,hm=hr,CE=TypeError,hb="Reduce of empty array with no initial value",RE=function(t){return function(r,s,a,c){var d=lI(r),h=TE(d),m=hm(d);if(db(s),m===0&&a<2)throw new CE(hb);var g=t?m-1:0,E=t?-1:1;if(a<2)for(;;){if(g in h){c=h[g],g+=E;break}if(g+=E,t?g<0:m<=g)throw new CE(hb)}for(;t?g>=0:m>g;g+=E)g in h&&(c=s(c,h[g],g,d));return c}},uI={left:RE(!1)},dI=u,o_=function(t,r){var s=[][t];return!!s&&dI(function(){s.call(null,r||function(){return 1},1)})},pm=L,hI=En,pI=H,Nl=function(t){return hI.slice(0,t.length)===t},a_=Nl("Bun/")?"BUN":Nl("Cloudflare-Workers")?"CLOUDFLARE":Nl("Deno/")?"DENO":Nl("Node.js/")?"NODE":pm.Bun&&typeof Bun.version=="string"?"BUN":pm.Deno&&typeof Deno.version=="object"?"DENO":pI(pm.process)==="process"?"NODE":pm.window&&pm.document?"BROWSER":"REST",fm=a_==="NODE",gD=uI.left;Gn({target:"Array",proto:!0,forced:!fm&&ji>79&&ji<83||!o_("reduce")},{reduce:function(t){var r=arguments.length;return gD(this,t,r,r>1?arguments[1]:void 0)}});var _D=mc("Array","reduce"),c_=N,yD=_D,IE=Array.prototype,fI=function(t){var r=t.reduce;return t===IE||c_(IE,t)&&r===IE.reduce?yD:r},xi=fI,Wa=l(xi),AE=H,vd=Array.isArray||function(t){return AE(t)==="Array"},mI=Gn,pb=vd,l_=R([].reverse),u_=[1,2];mI({target:"Array",proto:!0,forced:String(u_)===String(u_.reverse())},{reverse:function(){return pb(this)&&(this.length=this.length),l_(this)}});var mm=mc("Array","reverse"),gI=N,ED=mm,fb=Array.prototype,_I=function(t){var r=t.reverse;return t===fb||gI(fb,t)&&r===fb.reverse?ED:r},d_=_I,h_=l(d_),mb=Mc,PE=ca("keys"),gm=function(t){return PE[t]||(PE[t]=mb(t))},gb=!u(function(){function t(){}return t.prototype.constructor=null,Object.getPrototypeOf(new t)!==t.prototype}),vD=ti,yI=fe,SD=ei,bD=gb,kE=gm("IE_PROTO"),vu=Object,EI=vu.prototype,bh=bD?vu.getPrototypeOf:function(t){var r=SD(t);if(vD(r,kE))return r[kE];var s=r.constructor;return yI(s)&&r instanceof s?s.prototype:r instanceof vu?EI:null},Su=R,p_=Tr,Sd=Se,_b=function(t){return Sd(t)||t===null},wD=String,TD=TypeError,zp=function(t,r,s){try{return Su(p_(Object.getOwnPropertyDescriptor(t,r)[s]))}catch{}},f_=Se,_m=Ct,OE=function(t){if(_b(t))return t;throw new TD("Can't set "+wD(t)+" as a prototype")},yb=Object.setPrototypeOf||("__proto__"in{}?function(){var t,r=!1,s={};try{(t=zp(Object.prototype,"__proto__","set"))(s,[]),r=s instanceof Array}catch{}return function(a,c){return _m(a),OE(c),f_(a)&&(r?t(a,c):a.__proto__=c),a}}():void 0),bd={},Dl={},Ti=ti,Li=on,wh=yd.indexOf,qo=Dl,_a=R([].push),Th=function(t,r){var s,a=Li(t),c=0,d=[];for(s in a)!Ti(qo,s)&&Ti(a,s)&&_a(d,s);for(;r.length>c;)Ti(a,s=r[c++])&&(~wh(d,s)||_a(d,s));return d},Ch=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"],Ga=Th,NE=Ch.concat("length","prototype");bd.f=Object.getOwnPropertyNames||function(t){return Ga(t,NE)};var ym={};ym.f=Object.getOwnPropertySymbols;var vI=xt,DE=bd,SI=ym,wd=tr,xE=R([].concat),Eb=vI("Reflect","ownKeys")||function(t){var r=DE.f(wd(t)),s=SI.f;return s?xE(r,s(t)):r},vb=ti,CD=Eb,Rh=de,Em=Kt,Ih={},LE=Th,ME=Ch,ya=Object.keys||function(t){return LE(t,ME)},Bc=ke,Wp=sr,Td=Kt,Cd=tr,Gp=on,bI=ya;Ih.f=Bc&&!Wp?Object.defineProperties:function(t,r){Cd(t);for(var s,a=Gp(r),c=bI(r),d=c.length,h=0;d>h;)Td.f(t,s=c[h++],a[s]);return t};var vm,UE=xt("document","documentElement"),gc=tr,_c=Ih,Bi=Ch,xl=Dl,wI=UE,TI=fu,m_="prototype",g_="script",Sb=gm("IE_PROTO"),Sm=function(){},bb=function(t){return"<"+g_+">"+t+"</"+g_+">"},Hp=function(t){t.write(bb("")),t.close();var r=t.parentWindow.Object;return t=null,r},bm=function(){try{vm=new ActiveXObject("htmlfile")}catch{}var t,r,s;bm=typeof document<"u"?document.domain&&vm?Hp(vm):(r=TI("iframe"),s="java"+g_+":",r.style.display="none",wI.appendChild(r),r.src=String(s),(t=r.contentWindow.document).open(),t.write(bb("document.F=Object")),t.close(),t.F):Hp(vm);for(var a=Bi.length;a--;)delete bm[m_][Bi[a]];return bm()};xl[Sb]=!0;var __=Object.create||function(t,r){var s;return t!==null?(Sm[m_]=gc(t),s=new Sm,Sm[m_]=null,s[Sb]=t):s=bm(),r===void 0?s:_c.f(s,r)},y_=Se,VE=fc,wb=Error,CI=R("".replace),wm=String(new wb("zxcasd").stack),Tb=/\n\s*at [^:]*:[^\n]*/,FE=Tb.test(wm),jE=Ze,Tm=!u(function(){var t=new Error("a");return!("stack"in t)||(Object.defineProperty(t,"stack",jE(1,7)),t.stack!==7)}),Cb=fc,Rb=function(t,r){if(FE&&typeof t=="string"&&!wb.prepareStackTrace)for(;r--;)t=CI(t,Tb,"");return t},Ib=Tm,BE=Error.captureStackTrace,Ll={},zc=Ll,$p=Nr("iterator"),Ab=Array.prototype,Pb=function(t){return t!==void 0&&(zc.Array===t||Ab[$p]===t)},Rd=Ed,Id=Ma,kb=St,RI=Ll,Ad=Nr("iterator"),Ml=function(t){if(!kb(t))return Id(t,Ad)||Id(t,"@@iterator")||RI[Rd(t)]},zE=Te,II=Tr,WE=tr,AI=Go,E_=Ml,bu=TypeError,Kp=function(t,r){var s=arguments.length<2?E_(t):r;if(II(s))return WE(zE(s,t));throw new bu(AI(t)+" is not iterable")},v_=Te,Ah=tr,Ob=Ma,qp=function(t,r,s){var a,c;Ah(t);try{if(!(a=Ob(t,"return"))){if(r==="throw")throw s;return s}a=v_(a,t)}catch(d){c=!0,a=d}if(r==="throw")throw s;if(c)throw a;return Ah(a),s},PI=ot,Nb=Te,ts=tr,GE=Go,Db=Pb,xb=hr,S_=N,Lb=Kp,Yp=Ml,qi=qp,Hs=TypeError,ys=function(t,r){this.stopped=t,this.result=r},b_=ys.prototype,Pd=function(t,r,s){var a,c,d,h,m,g,E,b=s&&s.that,I=!(!s||!s.AS_ENTRIES),A=!(!s||!s.IS_RECORD),k=!(!s||!s.IS_ITERATOR),W=!(!s||!s.INTERRUPTED),j=PI(r,b),B=function(Z){return a&&qi(a,"normal",Z),new ys(!0,Z)},ee=function(Z){return I?(ts(Z),W?j(Z[0],Z[1],B):j(Z[0],Z[1])):W?j(Z,B):j(Z)};if(A)a=t.iterator;else if(k)a=t;else{if(!(c=Yp(t)))throw new Hs(GE(t)+" is not iterable");if(Db(c)){for(d=0,h=xb(t);h>d;d++)if((m=ee(t[d]))&&S_(b_,m))return m;return new ys(!1)}a=Lb(t,c)}for(g=A?t.next:a.next;!(E=Nb(g,a)).done;){try{m=ee(E.value)}catch(Z){qi(a,"throw",Z)}if(typeof m=="object"&&m&&S_(b_,m))return m}return new ys(!1)},w_=za,RD=Gn,Yo=N,Mb=bh,Cm=yb,Ub=function(t,r,s){for(var a=CD(r),c=Em.f,d=Rh.f,h=0;h<a.length;h++){var m=a[h];vb(t,m)||s&&vb(s,m)||c(t,m,d(r,m))}},Ul=__,Ha=fc,Xp=Ze,Vb=function(t,r){y_(r)&&"cause"in r&&VE(t,"cause",r.cause)},Fb=function(t,r,s,a){Ib&&(BE?BE(t,r):Cb(t,"stack",Rb(s,a)))},kI=Pd,OI=function(t,r){return t===void 0?arguments.length<2?"":r:w_(t)},NI=Nr("toStringTag"),T_=Error,DI=[].push,Jp=function(t,r){var s,a=Yo(HE,this);Cm?s=Cm(new T_,a?Mb(this):HE):(s=a?this:Ul(HE),Ha(s,NI,"Error")),r!==void 0&&Ha(s,"message",OI(r)),Fb(s,Jp,s.stack,1),arguments.length>2&&Vb(s,arguments[2]);var c=[];return kI(t,DI,{that:c}),Ha(s,"errors",c),s};Cm?Cm(Jp,T_):Ub(Jp,T_,{name:!0});var HE=Jp.prototype=Ul(T_.prototype,{constructor:Xp(1,Jp),message:Xp(1,""),name:Xp(1,"AggregateError")});RD({global:!0},{AggregateError:Jp});var C_,kd,R_,$E=fe,I_=L.WeakMap,xI=$E(I_)&&/native code/.test(String(I_)),KE=L,LI=Se,MI=fc,qE=ti,YE=Lc,jb=gm,UI=Dl,Bb="Object already initialized",XE=KE.TypeError,ID=KE.WeakMap;if(xI||YE.state){var Vl=YE.state||(YE.state=new ID);Vl.get=Vl.get,Vl.has=Vl.has,Vl.set=Vl.set,C_=function(t,r){if(Vl.has(t))throw new XE(Bb);return r.facade=t,Vl.set(t,r),r},kd=function(t){return Vl.get(t)||{}},R_=function(t){return Vl.has(t)}}else{var Rm=jb("state");UI[Rm]=!0,C_=function(t,r){if(qE(t,Rm))throw new XE(Bb);return r.facade=t,MI(t,Rm,r),r},kd=function(t){return qE(t,Rm)?t[Rm]:{}},R_=function(t){return qE(t,Rm)}}var Qp,zb,Wb,Ph={set:C_,get:kd,has:R_,enforce:function(t){return R_(t)?kd(t):C_(t,{})},getterFor:function(t){return function(r){var s;if(!LI(r)||(s=kd(r)).type!==t)throw new XE("Incompatible receiver, "+t+" required");return s}}},Im=ke,AD=ti,VI=Function.prototype,PD=Im&&Object.getOwnPropertyDescriptor,Wc=AD(VI,"name"),JE={PROPER:Wc&&(function(){}).name==="something",CONFIGURABLE:Wc&&(!Im||Im&&PD(VI,"name").configurable)},QE=fc,Od=function(t,r,s,a){return a&&a.enumerable?t[r]=s:QE(t,r,s),t},FI=u,jI=fe,Gb=Se,Am=__,ZE=bh,Hb=Od,$b=Nr("iterator"),Kb=!1;[].keys&&("next"in(Wb=[].keys())?(zb=ZE(ZE(Wb)))!==Object.prototype&&(Qp=zb):Kb=!0);var BI=!Gb(Qp)||FI(function(){var t={};return Qp[$b].call(t)!==t});jI((Qp=BI?{}:Am(Qp))[$b])||Hb(Qp,$b,function(){return this});var qb={IteratorPrototype:Qp,BUGGY_SAFARI_ITERATORS:Kb},zI=Ed,WI=ib?{}.toString:function(){return"[object "+zI(this)+"]"},kD=ib,$a=Kt.f,Ea=fc,GI=ti,HI=WI,Yb=Nr("toStringTag"),wu=function(t,r,s,a){var c=s?t:t&&t.prototype;c&&(GI(c,Yb)||$a(c,Yb,{configurable:!0,value:r}),a&&!kD&&Ea(c,"toString",HI))},$I=qb.IteratorPrototype,Xb=__,KI=Ze,Jb=wu,qI=Ll,YI=function(){return this},A_=function(t,r,s,a){var c=r+" Iterator";return t.prototype=Xb($I,{next:KI(+!a,s)}),Jb(t,c,!1,!0),qI[c]=YI,t},Qb=Gn,XI=Te,Zb=JE,ev=A_,OD=bh,JI=wu,tv=Od,ew=Ll,nv=qb,Nd=Zb.PROPER,rv=nv.BUGGY_SAFARI_ITERATORS,iv=Nr("iterator"),sv="keys",P_="values",tw="entries",k_=function(){return this},Co=function(t,r,s,a,c,d,h){ev(s,r,a);var m,g,E,b=function(ee){if(ee===c&&j)return j;if(!rv&&ee&&ee in k)return k[ee];switch(ee){case sv:case P_:case tw:return function(){return new s(this,ee)}}return function(){return new s(this)}},I=r+" Iterator",A=!1,k=t.prototype,W=k[iv]||k["@@iterator"]||c&&k[c],j=!rv&&W||b(c),B=r==="Array"&&k.entries||W;if(B&&(m=OD(B.call(new t)))!==Object.prototype&&m.next&&(JI(m,I,!0,!0),ew[I]=k_),Nd&&c===P_&&W&&W.name!==P_&&(A=!0,j=function(){return XI(W,this)}),c)if(g={values:b(P_),keys:d?j:b(sv),entries:b(tw)},h)for(E in g)(rv||A||!(E in k))&&tv(k,E,g[E]);else Qb({target:r,proto:!0,forced:rv||A},g);return h&&k[iv]!==j&&tv(k,iv,j,{}),ew[r]=j,g},ov=function(t,r){return{value:t,done:r}},ND=on,O_=Ll,Ro=Ph;Kt.f;var DD=Co,sn=ov,Zp="Array Iterator",nw=Ro.set,QI=Ro.getterFor(Zp);DD(Array,"Array",function(t,r){nw(this,{type:Zp,target:ND(t),index:0,kind:r})},function(){var t=QI(this),r=t.target,s=t.index++;if(!r||s>=r.length)return t.target=null,sn(void 0,!0);switch(t.kind){case"keys":return sn(s,!1);case"values":return sn(r[s],!1)}return sn([s,r[s]],!1)},"values"),O_.Arguments=O_.Array;var xD=Kt,kh=function(t,r,s){return xD.f(t,r,s)},av=xt,rw=kh,ZI=ke,iw=Nr("species"),eA=N,sw=TypeError,N_=function(t,r){if(eA(r,t))return t;throw new sw("Incorrect invocation")},Io=fe,yc=Lc,Oh=R(Function.toString);Io(yc.inspectSource)||(yc.inspectSource=function(t){return Oh(t)});var ow=yc.inspectSource,tA=R,Fl=u,aw=fe,Tu=Ed,LD=ow,cw=function(){},lw=xt("Reflect","construct"),cv=/^\s*(?:class|function)\b/,nA=tA(cv.exec),MD=!cv.test(cw),Nh=function(t){if(!aw(t))return!1;try{return lw(cw,[],t),!0}catch{return!1}},lv=function(t){if(!aw(t))return!1;switch(Tu(t)){case"AsyncFunction":case"GeneratorFunction":case"AsyncGeneratorFunction":return!1}try{return MD||!!nA(cv,LD(t))}catch{return!0}};lv.sham=!0;var Xo,Cr,$s,hs,Ds=!lw||Fl(function(){var t;return Nh(Nh.call)||!Nh(Object)||!Nh(function(){t=!0})||t})?lv:Nh,Ec=Ds,Pm=Go,Ks=TypeError,km=tr,ef=function(t){if(Ec(t))return t;throw new Ks(Pm(t)+" is not a constructor")},uv=St,uw=Nr("species"),tf=function(t,r){var s,a=km(t).constructor;return a===void 0||uv(s=km(a)[uw])?r:ef(s)},Es=R([].slice),dw=TypeError,Gc=function(t,r){if(t<r)throw new dw("Not enough arguments");return t},Cu=/(?:ipad|iphone|ipod).*applewebkit/i.test(En),Jo=L,hw=re,Dh=ot,D_=fe,xh=ti,x_=u,Om=UE,pw=Es,L_=fu,dv=Gc,va=Cu,Lh=fm,vc=Jo.setImmediate,Qo=Jo.clearImmediate,rA=Jo.process,M_=Jo.Dispatch,fw=Jo.Function,iA=Jo.MessageChannel,Mh=Jo.String,hv=0,nf={},Uh="onreadystatechange";x_(function(){Xo=Jo.location});var U_=function(t){if(xh(nf,t)){var r=nf[t];delete nf[t],r()}},Dd=function(t){return function(){U_(t)}},mw=function(t){U_(t.data)},gw=function(t){Jo.postMessage(Mh(t),Xo.protocol+"//"+Xo.host)};vc&&Qo||(vc=function(t){dv(arguments.length,1);var r=D_(t)?t:fw(t),s=pw(arguments,1);return nf[++hv]=function(){hw(r,void 0,s)},Cr(hv),hv},Qo=function(t){delete nf[t]},Lh?Cr=function(t){rA.nextTick(Dd(t))}:M_&&M_.now?Cr=function(t){M_.now(Dd(t))}:iA&&!va?(hs=($s=new iA).port2,$s.port1.onmessage=mw,Cr=Dh(hs.postMessage,hs)):Jo.addEventListener&&D_(Jo.postMessage)&&!Jo.importScripts&&Xo&&Xo.protocol!=="file:"&&!x_(gw)?(Cr=gw,Jo.addEventListener("message",mw,!1)):Cr=Uh in L_("script")?function(t){Om.appendChild(L_("script"))[Uh]=function(){Om.removeChild(this),U_(t)}}:function(t){setTimeout(Dd(t),0)});var Nm={set:vc,clear:Qo},V_=L,UD=ke,VD=Object.getOwnPropertyDescriptor,_w=function(t){if(!UD)return V_[t];var r=VD(V_,t);return r&&r.value},yw=function(){this.head=null,this.tail=null};yw.prototype={add:function(t){var r={item:t,next:null},s=this.tail;s?s.next=r:this.head=r,this.tail=r},get:function(){var t=this.head;if(t)return(this.head=t.next)===null&&(this.tail=null),t.item}};var Hc,Ew,Vh,pv,ns,sA=yw,oA=/ipad|iphone|ipod/i.test(En)&&typeof Pebble<"u",FD=/web0s(?!.*chrome)/i.test(En),Dm=L,aA=_w,vw=ot,Sw=Nm.set,$c=sA,bw=Cu,jD=oA,Fh=FD,xm=fm,jh=Dm.MutationObserver||Dm.WebKitMutationObserver,F_=Dm.document,fv=Dm.process,Lm=Dm.Promise,ww=aA("queueMicrotask");if(!ww){var Mm=new $c,mv=function(){var t,r;for(xm&&(t=fv.domain)&&t.exit();r=Mm.get();)try{r()}catch(s){throw Mm.head&&Hc(),s}t&&t.enter()};bw||xm||Fh||!jh||!F_?!jD&&Lm&&Lm.resolve?((pv=Lm.resolve(void 0)).constructor=Lm,ns=vw(pv.then,pv),Hc=function(){ns(mv)}):xm?Hc=function(){fv.nextTick(mv)}:(Sw=vw(Sw,Dm),Hc=function(){Sw(mv)}):(Ew=!0,Vh=F_.createTextNode(""),new jh(mv).observe(Vh,{characterData:!0}),Hc=function(){Vh.data=Ew=!Ew}),ww=function(t){Mm.head||Hc(),Mm.add(t)}}var Tw=ww,rf=function(t){try{return{error:!1,value:t()}}catch(r){return{error:!0,value:r}}},Ru=L.Promise,gv=L,Um=Ru,Cw=fe,BD=ma,cA=ow,Rw=Nr,j_=a_,B_=ji,z_=Um&&Um.prototype,lA=Rw("species"),uA=Cw(gv.PromiseRejectionEvent),_v=BD("Promise",function(){var t=cA(Um),r=t!==String(Um);if(!r&&B_===66||!z_.catch||!z_.finally)return!0;if(!B_||B_<51||!/native code/.test(t)){var s=new Um(function(c){c(1)}),a=function(c){c(function(){},function(){})};if((s.constructor={})[lA]=a,!(s.then(function(){})instanceof a))return!0}return!(r||j_!=="BROWSER"&&j_!=="DENO"||uA)}),W_={CONSTRUCTOR:_v,REJECTION_EVENT:uA},Ka={},dA=Tr,yv=TypeError,f=function(t){var r,s;this.promise=new t(function(a,c){if(r!==void 0||s!==void 0)throw new yv("Bad Promise constructor");r=a,s=c}),this.resolve=dA(r),this.reject=dA(s)};Ka.f=function(t){return new f(t)};var _,T,D=Gn,F=fm,$=L,me=Te,Ae=Od,Ve=wu,at=function(t){var r=av(t);ZI&&r&&!r[iw]&&rw(r,iw,{configurable:!0,get:function(){return this}})},Dt=Tr,Mt=fe,Nt=Se,nn=N_,dn=tf,fn=Nm.set,rs=Tw,Xe=function(t,r){try{arguments.length===1?console.error(t):console.error(t,r)}catch{}},Fe=rf,it=sA,jt=Ph,mn=Ru,kn=W_,On=Ka,Vn="Promise",qs=kn.CONSTRUCTOR,Xr=kn.REJECTION_EVENT,Iu=jt.getterFor(Vn),zD=jt.set,oce=mn&&mn.prototype,Iw=mn,WD=oce,Z3=$.TypeError,GD=$.document,HD=$.process,$D=On.f,ace=$D,cce=!!(GD&&GD.createEvent&&$.dispatchEvent),e4="unhandledrejection",t4=function(t){var r;return!(!Nt(t)||!Mt(r=t.then))&&r},n4=function(t,r){var s,a,c,d=r.value,h=r.state===1,m=h?t.ok:t.fail,g=t.resolve,E=t.reject,b=t.domain;try{m?(h||(r.rejection===2&&uce(r),r.rejection=1),m===!0?s=d:(b&&b.enter(),s=m(d),b&&(b.exit(),c=!0)),s===t.promise?E(new Z3("Promise-chain cycle")):(a=t4(s))?me(a,s,g,E):g(s)):E(d)}catch(I){b&&!c&&b.exit(),E(I)}},r4=function(t,r){t.notified||(t.notified=!0,rs(function(){for(var s,a=t.reactions;s=a.get();)n4(s,t);t.notified=!1,r&&!t.rejection&&lce(t)}))},i4=function(t,r,s){var a,c;cce?((a=GD.createEvent("Event")).promise=r,a.reason=s,a.initEvent(t,!1,!0),$.dispatchEvent(a)):a={promise:r,reason:s},!Xr&&(c=$["on"+t])?c(a):t===e4&&Xe("Unhandled promise rejection",s)},lce=function(t){me(fn,$,function(){var r,s=t.facade,a=t.value;if(s4(t)&&(r=Fe(function(){F?HD.emit("unhandledRejection",a,s):i4(e4,s,a)}),t.rejection=F||s4(t)?2:1,r.error))throw r.value})},s4=function(t){return t.rejection!==1&&!t.parent},uce=function(t){me(fn,$,function(){var r=t.facade;F?HD.emit("rejectionHandled",r):i4("rejectionhandled",r,t.value)})},Ev=function(t,r,s){return function(a){t(r,a,s)}},vv=function(t,r,s){t.done||(t.done=!0,s&&(t=s),t.value=r,t.state=2,r4(t,!0))},KD=function(t,r,s){if(!t.done){t.done=!0,s&&(t=s);try{if(t.facade===r)throw new Z3("Promise can't be resolved itself");var a=t4(r);a?rs(function(){var c={done:!1};try{me(a,r,Ev(KD,c,t),Ev(vv,c,t))}catch(d){vv(c,d,t)}}):(t.value=r,t.state=1,r4(t,!1))}catch(c){vv({done:!1},c,t)}}};qs&&(WD=(Iw=function(t){nn(this,WD),Dt(t),me(_,this);var r=Iu(this);try{t(Ev(KD,r),Ev(vv,r))}catch(s){vv(r,s)}}).prototype,(_=function(t){zD(this,{type:Vn,done:!1,notified:!1,parent:!1,reactions:new it,rejection:!1,state:0,value:null})}).prototype=Ae(WD,"then",function(t,r){var s=Iu(this),a=$D(dn(this,Iw));return s.parent=!0,a.ok=!Mt(t)||t,a.fail=Mt(r)&&r,a.domain=F?HD.domain:void 0,s.state===0?s.reactions.add(a):rs(function(){n4(a,s)}),a.promise}),T=function(){var t=new _,r=Iu(t);this.promise=t,this.resolve=Ev(KD,r),this.reject=Ev(vv,r)},On.f=$D=function(t){return t===Iw||t===void 0?new T(t):ace(t)}),D({global:!0,wrap:!0,forced:qs},{Promise:Iw}),Ve(Iw,Vn,!1,!0),at(Vn);var o4=Nr("iterator"),a4=!1;try{var dce=0,c4={next:function(){return{done:!!dce++}},return:function(){a4=!0}};c4[o4]=function(){return this},Array.from(c4,function(){throw 2})}catch{}var hce=Ru,pce=function(t,r){try{if(!r&&!a4)return!1}catch{return!1}var s=!1;try{var a={};a[o4]=function(){return{next:function(){return{done:s=!0}}}},t(a)}catch{}return s},hA=W_.CONSTRUCTOR||!pce(function(t){hce.all(t).then(void 0,function(){})}),fce=Te,mce=Tr,gce=Ka,_ce=rf,yce=Pd;Gn({target:"Promise",stat:!0,forced:hA},{all:function(t){var r=this,s=gce.f(r),a=s.resolve,c=s.reject,d=_ce(function(){var h=mce(r.resolve),m=[],g=0,E=1;yce(t,function(b){var I=g++,A=!1;E++,fce(h,r,b).then(function(k){A||(A=!0,m[I]=k,--E||a(m))},c)}),--E||a(m)});return d.error&&c(d.value),s.promise}});var Ece=Gn,vce=W_.CONSTRUCTOR;Ru&&Ru.prototype,Ece({target:"Promise",proto:!0,forced:vce,real:!0},{catch:function(t){return this.then(void 0,t)}});var Sce=Te,bce=Tr,wce=Ka,Tce=rf,Cce=Pd;Gn({target:"Promise",stat:!0,forced:hA},{race:function(t){var r=this,s=wce.f(r),a=s.reject,c=Tce(function(){var d=bce(r.resolve);Cce(t,function(h){Sce(d,r,h).then(s.resolve,a)})});return c.error&&a(c.value),s.promise}});var Rce=Ka;Gn({target:"Promise",stat:!0,forced:W_.CONSTRUCTOR},{reject:function(t){var r=Rce.f(this);return(0,r.reject)(t),r.promise}});var Ice=tr,Ace=Se,Pce=Ka,l4=function(t,r){if(Ice(t),Ace(r)&&r.constructor===t)return r;var s=Pce.f(t);return(0,s.resolve)(r),s.promise},kce=Gn,Oce=Ru,Nce=W_.CONSTRUCTOR,Dce=l4,xce=xt("Promise"),Lce=!Nce;kce({target:"Promise",stat:!0,forced:!0},{resolve:function(t){return Dce(Lce&&this===xce?Oce:this,t)}});var Mce=Te,Uce=Tr,Vce=Ka,Fce=rf,jce=Pd;Gn({target:"Promise",stat:!0,forced:hA},{allSettled:function(t){var r=this,s=Vce.f(r),a=s.resolve,c=s.reject,d=Fce(function(){var h=Uce(r.resolve),m=[],g=0,E=1;jce(t,function(b){var I=g++,A=!1;E++,Mce(h,r,b).then(function(k){A||(A=!0,m[I]={status:"fulfilled",value:k},--E||a(m))},function(k){A||(A=!0,m[I]={status:"rejected",reason:k},--E||a(m))})}),--E||a(m)});return d.error&&c(d.value),s.promise}});var Bce=Te,zce=Tr,Wce=xt,Gce=Ka,Hce=rf,$ce=Pd,u4="No one promise resolved";Gn({target:"Promise",stat:!0,forced:hA},{any:function(t){var r=this,s=Wce("AggregateError"),a=Gce.f(r),c=a.resolve,d=a.reject,h=Hce(function(){var m=zce(r.resolve),g=[],E=0,b=1,I=!1;$ce(t,function(A){var k=E++,W=!1;b++,Bce(m,r,A).then(function(j){W||I||(I=!0,c(j))},function(j){W||I||(W=!0,g[k]=j,--b||d(new s(g,u4)))})}),--b||d(new s(g,u4))});return h.error&&d(h.value),a.promise}});var Kce=Gn,qce=re,Yce=Es,Xce=Ka,Jce=Tr,d4=rf,qD=L.Promise,h4=!1;Kce({target:"Promise",stat:!0,forced:!qD||!qD.try||d4(function(){qD.try(function(t){h4=t===8},8)}).error||!h4},{try:function(t){var r=arguments.length>1?Yce(arguments,1):[],s=Xce.f(this),a=d4(function(){return qce(Jce(t),void 0,r)});return(a.error?s.reject:s.resolve)(a.value),s.promise}});var Qce=Ka;Gn({target:"Promise",stat:!0},{withResolvers:function(){var t=Qce.f(this);return{promise:t.promise,resolve:t.resolve,reject:t.reject}}});var Zce=Gn,YD=Ru,ele=u,tle=xt,nle=fe,rle=tf,p4=l4,ile=YD&&YD.prototype;Zce({target:"Promise",proto:!0,real:!0,forced:!!YD&&ele(function(){ile.finally.call({then:function(){}},function(){})})},{finally:function(t){var r=rle(this,tle("Promise")),s=nle(t);return this.then(s?function(a){return p4(r,t()).then(function(){return a})}:t,s?function(a){return p4(r,t()).then(function(){throw a})}:t)}});var XD=R,sle=P,ole=za,ale=Ct,cle=XD("".charAt),f4=XD("".charCodeAt),lle=XD("".slice),m4=function(t){return function(r,s){var a,c,d=ole(ale(r)),h=sle(s),m=d.length;return h<0||h>=m?t?"":void 0:(a=f4(d,h))<55296||a>56319||h+1===m||(c=f4(d,h+1))<56320||c>57343?t?cle(d,h):a:t?lle(d,h,h+2):c-56320+(a-55296<<10)+65536}},JD={codeAt:m4(!1),charAt:m4(!0)},ule=JD.charAt,dle=za,g4=Ph,hle=Co,_4=ov,y4="String Iterator",ple=g4.set,fle=g4.getterFor(y4);hle(String,"String",function(t){ple(this,{type:y4,string:dle(t),index:0})},function(){var t,r=fle(this),s=r.string,a=r.index;return a>=s.length?_4(void 0,!0):(t=ule(s,a),r.index+=t.length,_4(t,!1))});var mle=Ne.Promise,gle={CSSRuleList:0,CSSStyleDeclaration:0,CSSValueList:0,ClientRectList:0,DOMRectList:0,DOMStringList:0,DOMTokenList:1,DataTransferItemList:0,FileList:0,HTMLAllCollection:0,HTMLCollection:0,HTMLFormElement:0,HTMLSelectElement:0,MediaList:0,MimeTypeArray:0,NamedNodeMap:0,NodeList:1,PaintRequestList:0,Plugin:0,PluginArray:0,SVGLengthList:0,SVGNumberList:0,SVGPathSegList:0,SVGPointList:0,SVGStringList:0,SVGTransformList:0,SourceBufferList:0,StyleSheetList:0,TextTrackCueList:0,TextTrackList:0,TouchList:0},_le=L,yle=wu,E4=Ll;for(var QD in gle)yle(_le[QD],QD),E4[QD]=E4.Array;var v4=mle,pt=l(v4),Ele=mc("Array","values"),vle=Ed,Sle=ti,ble=N,wle=Ele,ZD=Array.prototype,Tle={DOMTokenList:!0,NodeList:!0},Cle=function(t){var r=t.values;return t===ZD||ble(ZD,t)&&r===ZD.values||Sle(Tle,vle(t))?wle:r},Sc=l(Cle),S4=Go,Rle=TypeError,b4=Es,Ile=Math.floor,ex=function(t,r){var s=t.length;if(s<8)for(var a,c,d=1;d<s;){for(c=d,a=t[d];c&&r(t[c-1],a)>0;)t[c]=t[--c];c!==d++&&(t[c]=a)}else for(var h=Ile(s/2),m=ex(b4(t,0,h),r),g=ex(b4(t,h),r),E=m.length,b=g.length,I=0,A=0;I<E||A<b;)t[I+A]=I<E&&A<b?r(m[I],g[A])<=0?m[I++]:g[A++]:I<E?m[I++]:g[A++];return t},w4=ex,T4=En.match(/firefox\/(\d+)/i),Ale=!!T4&&+T4[1],Ple=/MSIE|Trident/.test(En),C4=En.match(/AppleWebKit\/(\d+)\./),kle=!!C4&&+C4[1],Ole=Gn,R4=R,Nle=Tr,Dle=ei,I4=hr,xle=function(t,r){if(!delete t[r])throw new Rle("Cannot delete property "+S4(r)+" of "+S4(t))},A4=za,tx=u,Lle=w4,Mle=o_,P4=Ale,Ule=Ple,k4=ji,O4=kle,Vm=[],N4=R4(Vm.sort),Vle=R4(Vm.push),Fle=tx(function(){Vm.sort(void 0)}),jle=tx(function(){Vm.sort(null)}),Ble=Mle("sort"),D4=!tx(function(){if(k4)return k4<70;if(!(P4&&P4>3)){if(Ule)return!0;if(O4)return O4<603;var t,r,s,a,c="";for(t=65;t<76;t++){switch(r=String.fromCharCode(t),t){case 66:case 69:case 70:case 72:s=3;break;case 68:case 71:s=4;break;default:s=2}for(a=0;a<47;a++)Vm.push({k:r+a,v:s})}for(Vm.sort(function(d,h){return h.v-d.v}),a=0;a<Vm.length;a++)r=Vm[a].k.charAt(0),c.charAt(c.length-1)!==r&&(c+=r);return c!=="DGBEFHACIJK"}});Ole({target:"Array",proto:!0,forced:Fle||!jle||!Ble||!D4},{sort:function(t){t!==void 0&&Nle(t);var r=Dle(this);if(D4)return t===void 0?N4(r):N4(r,t);var s,a,c=[],d=I4(r);for(a=0;a<d;a++)a in r&&Vle(c,r[a]);for(Lle(c,function(h){return function(m,g){return g===void 0?-1:m===void 0?1:h!==void 0?+h(m,g)||0:A4(m)>A4(g)?1:-1}}(t)),s=I4(c),a=0;a<s;)r[a]=c[a++];for(;a<d;)xle(r,a++);return r}});var zle=mc("Array","sort"),Wle=N,Gle=zle,nx=Array.prototype,Hle=function(t){var r=t.sort;return t===nx||Wle(nx,t)&&r===nx.sort?Gle:r},G_=l(Hle),$le=Gn,Kle=R,qle=Ke,Yle=RangeError,x4=String.fromCharCode,L4=String.fromCodePoint,Xle=Kle([].join);$le({target:"String",stat:!0,forced:!!L4&&L4.length!==1},{fromCodePoint:function(t){for(var r,s=[],a=arguments.length,c=0;a>c;){if(r=+arguments[c++],qle(r,1114111)!==r)throw new Yle(r+" is not a valid code point");s[c]=r<65536?x4(r):x4(55296+((r-=65536)>>10),r%1024+56320)}return Xle(s,"")}});var Jle=u,Qle=Nr("iterator"),pA=!Jle(function(){var t=new URL("b?a=1&b=2&c=3","https://a"),r=t.searchParams,s=new URLSearchParams("a=1&a=2&b=3"),a="";return t.pathname="c%20d",r.forEach(function(c,d){r.delete("b"),a+=d+c}),s.delete("a",2),s.delete("b",void 0),!t.toJSON||!s.has("a",1)||s.has("a",2)||!s.has("a",void 0)||s.has("b")||!r.size&&!0||!r.sort||t.href!=="https://a/c%20d?a=1&c=3"||r.get("c")!=="3"||String(new URLSearchParams("?a=1"))!=="a=1"||!r[Qle]||new URL("https://a@b").username!=="a"||new URLSearchParams(new URLSearchParams("a=b")).get("a")!=="b"||new URL("https://").host!=="xn--e1aybc"||new URL("https://a#").hash!=="#%D0%B1"||a!=="a1c3"||new URL("https://x",void 0).host!=="x"}),Zle=Od,rx=Gn,M4=L,ix=_w,eue=xt,fA=Te,xd=R,Aw=ke,U4=pA,V4=Od,tue=kh,nue=function(t,r,s){for(var a in r)s&&s.unsafe&&t[a]?t[a]=r[a]:Zle(t,a,r[a],s);return t},rue=wu,iue=A_,sx=Ph,F4=N_,ox=fe,sue=ti,oue=ot,aue=Ed,cue=tr,j4=Se,bc=za,lue=__,B4=Ze,z4=Kp,uue=Ml,mA=ov,Sv=Gc,due=w4,hue=Nr("iterator"),bv="URLSearchParams",W4=bv+"Iterator",G4=sx.set,Au=sx.getterFor(bv),pue=sx.getterFor(W4),H4=ix("fetch"),gA=ix("Request"),Pw=ix("Headers"),ax=gA&&gA.prototype,$4=Pw&&Pw.prototype,fue=M4.TypeError,mue=M4.encodeURIComponent,gue=String.fromCharCode,_ue=eue("String","fromCodePoint"),yue=parseInt,_A=xd("".charAt),K4=xd([].join),Fm=xd([].push),q4=xd("".replace),Eue=xd([].shift),Y4=xd([].splice),X4=xd("".split),J4=xd("".slice),vue=xd(/./.exec),Sue=/\+/g,bue=/^[0-9a-f]+$/i,Q4=function(t,r){var s=J4(t,r,r+2);return vue(bue,s)?yue(s,16):NaN},wue=function(t){for(var r=0,s=128;s>0&&(t&s)!=0;s>>=1)r++;return r},Tue=function(t){var r=null;switch(t.length){case 1:r=t[0];break;case 2:r=(31&t[0])<<6|63&t[1];break;case 3:r=(15&t[0])<<12|(63&t[1])<<6|63&t[2];break;case 4:r=(7&t[0])<<18|(63&t[1])<<12|(63&t[2])<<6|63&t[3]}return r>1114111?null:r},Z4=function(t){for(var r=(t=q4(t,Sue," ")).length,s="",a=0;a<r;){var c=_A(t,a);if(c==="%"){if(_A(t,a+1)==="%"||a+3>r){s+="%",a++;continue}var d=Q4(t,a+1);if(d!=d){s+=c,a++;continue}a+=2;var h=wue(d);if(h===0)c=gue(d);else{if(h===1||h>4){s+="",a++;continue}for(var m=[d],g=1;g<h&&!(++a+3>r||_A(t,a)!=="%");){var E=Q4(t,a+1);if(E!=E){a+=3;break}if(E>191||E<128)break;Fm(m,E),a+=2,g++}if(m.length!==h){s+="";continue}var b=Tue(m);b===null?s+="":c=_ue(b)}}s+=c,a++}return s},Cue=/[!'()~]|%20/g,Rue={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+"},Iue=function(t){return Rue[t]},eB=function(t){return q4(mue(t),Cue,Iue)},cx=iue(function(t,r){G4(this,{type:W4,target:Au(t).entries,index:0,kind:r})},bv,function(){var t=pue(this),r=t.target,s=t.index++;if(!r||s>=r.length)return t.target=null,mA(void 0,!0);var a=r[s];switch(t.kind){case"keys":return mA(a.key,!1);case"values":return mA(a.value,!1)}return mA([a.key,a.value],!1)},!0),tB=function(t){this.entries=[],this.url=null,t!==void 0&&(j4(t)?this.parseObject(t):this.parseQuery(typeof t=="string"?_A(t,0)==="?"?J4(t,1):t:bc(t)))};tB.prototype={type:bv,bindURL:function(t){this.url=t,this.update()},parseObject:function(t){var r,s,a,c,d,h,m,g=this.entries,E=uue(t);if(E)for(s=(r=z4(t,E)).next;!(a=fA(s,r)).done;){if(d=(c=z4(cue(a.value))).next,(h=fA(d,c)).done||(m=fA(d,c)).done||!fA(d,c).done)throw new fue("Expected sequence with length 2");Fm(g,{key:bc(h.value),value:bc(m.value)})}else for(var b in t)sue(t,b)&&Fm(g,{key:b,value:bc(t[b])})},parseQuery:function(t){if(t)for(var r,s,a=this.entries,c=X4(t,"&"),d=0;d<c.length;)(r=c[d++]).length&&(s=X4(r,"="),Fm(a,{key:Z4(Eue(s)),value:Z4(K4(s,"="))}))},serialize:function(){for(var t,r=this.entries,s=[],a=0;a<r.length;)t=r[a++],Fm(s,eB(t.key)+"="+eB(t.value));return K4(s,"&")},update:function(){this.entries.length=0,this.parseQuery(this.url.query)},updateURL:function(){this.url&&this.url.update()}};var yA=function(){F4(this,wv);var t=G4(this,new tB(arguments.length>0?arguments[0]:void 0));Aw||(this.size=t.entries.length)},wv=yA.prototype;if(nue(wv,{append:function(t,r){var s=Au(this);Sv(arguments.length,2),Fm(s.entries,{key:bc(t),value:bc(r)}),Aw||this.length++,s.updateURL()},delete:function(t){for(var r=Au(this),s=Sv(arguments.length,1),a=r.entries,c=bc(t),d=s<2?void 0:arguments[1],h=d===void 0?d:bc(d),m=0;m<a.length;){var g=a[m];if(g.key!==c||h!==void 0&&g.value!==h)m++;else if(Y4(a,m,1),h!==void 0)break}Aw||(this.size=a.length),r.updateURL()},get:function(t){var r=Au(this).entries;Sv(arguments.length,1);for(var s=bc(t),a=0;a<r.length;a++)if(r[a].key===s)return r[a].value;return null},getAll:function(t){var r=Au(this).entries;Sv(arguments.length,1);for(var s=bc(t),a=[],c=0;c<r.length;c++)r[c].key===s&&Fm(a,r[c].value);return a},has:function(t){for(var r=Au(this).entries,s=Sv(arguments.length,1),a=bc(t),c=s<2?void 0:arguments[1],d=c===void 0?c:bc(c),h=0;h<r.length;){var m=r[h++];if(m.key===a&&(d===void 0||m.value===d))return!0}return!1},set:function(t,r){var s=Au(this);Sv(arguments.length,1);for(var a,c=s.entries,d=!1,h=bc(t),m=bc(r),g=0;g<c.length;g++)(a=c[g]).key===h&&(d?Y4(c,g--,1):(d=!0,a.value=m));d||Fm(c,{key:h,value:m}),Aw||(this.size=c.length),s.updateURL()},sort:function(){var t=Au(this);due(t.entries,function(r,s){return r.key>s.key?1:-1}),t.updateURL()},forEach:function(t){for(var r,s=Au(this).entries,a=oue(t,arguments.length>1?arguments[1]:void 0),c=0;c<s.length;)a((r=s[c++]).value,r.key,this)},keys:function(){return new cx(this,"keys")},values:function(){return new cx(this,"values")},entries:function(){return new cx(this,"entries")}},{enumerable:!0}),V4(wv,hue,wv.entries,{}),V4(wv,"toString",function(){return Au(this).serialize()},{enumerable:!0}),Aw&&tue(wv,"size",{get:function(){return Au(this).entries.length},configurable:!0,enumerable:!0}),rue(yA,bv),rx({global:!0,forced:!U4},{URLSearchParams:yA}),!U4&&ox(Pw)){var Aue=xd($4.has),Pue=xd($4.set),nB=function(t){if(j4(t)){var r,s=t.body;if(aue(s)===bv)return r=t.headers?new Pw(t.headers):new Pw,Aue(r,"content-type")||Pue(r,"content-type","application/x-www-form-urlencoded;charset=UTF-8"),lue(t,{body:B4(0,bc(s)),headers:B4(0,r)})}return t};if(ox(H4)&&rx({global:!0,dontCallGetSet:!0,forced:!0},{fetch:function(t){return H4(t,arguments.length>1?nB(arguments[1]):{})}}),ox(gA)){var lx=function(t){return F4(this,ax),new gA(t,arguments.length>1?nB(arguments[1]):{})};ax.constructor=lx,lx.prototype=ax,rx({global:!0,dontCallGetSet:!0,forced:!0},{Request:lx})}}var Pu,kue={URLSearchParams:yA,getState:Au},Oue=Ne.URLSearchParams,rB=ke,Nue=R,Due=Te,xue=u,ux=ya,Lue=ym,Mue=we,Uue=ei,Vue=et,Tv=Object.assign,iB=Object.defineProperty,Fue=Nue([].concat),jue=!Tv||xue(function(){if(rB&&Tv({b:1},Tv(iB({},"a",{enumerable:!0,get:function(){iB(this,"b",{value:3,enumerable:!1})}}),{b:2})).b!==1)return!0;var t={},r={},s=Symbol("assign detection"),a="abcdefghijklmnopqrst";return t[s]=7,a.split("").forEach(function(c){r[c]=c}),Tv({},t)[s]!==7||ux(Tv({},r)).join("")!==a})?function(t,r){for(var s=Uue(t),a=arguments.length,c=1,d=Lue.f,h=Mue.f;a>c;)for(var m,g=Vue(arguments[c++]),E=d?Fue(ux(g),d(g)):ux(g),b=E.length,I=0;b>I;)m=E[I++],rB&&!Due(h,g,m)||(s[m]=g[m]);return s}:Tv,Bue=tr,zue=qp,Wue=ke,Gue=Kt,Hue=Ze,dx=function(t,r,s){Wue?Gue.f(t,r,Hue(0,s)):t[r]=s},$ue=ot,Kue=Te,que=ei,Yue=function(t,r,s,a){try{return a?r(Bue(s)[0],s[1]):r(s)}catch(c){zue(t,"throw",c)}},Xue=Pb,Jue=Ds,Que=hr,sB=dx,Zue=Kp,ede=Ml,oB=Array,H_=R,hx=2147483647,tde=/[^\0-\u007E]/,aB=/[.\u3002\uFF0E\uFF61]/g,cB="Overflow: input needs wider integers to process",lB=RangeError,nde=H_(aB.exec),Cv=Math.floor,px=String.fromCharCode,uB=H_("".charCodeAt),dB=H_([].join),jm=H_([].push),rde=H_("".replace),ide=H_("".split),sde=H_("".toLowerCase),hB=function(t){return t+22+75*(t<26)},ode=function(t,r,s){var a=0;for(t=s?Cv(t/700):t>>1,t+=Cv(t/r);t>455;)t=Cv(t/35),a+=36;return Cv(a+36*t/(t+38))},ade=function(t){var r=[];t=function(ee){for(var Z=[],oe=0,ye=ee.length;oe<ye;){var _e=uB(ee,oe++);if(_e>=55296&&_e<=56319&&oe<ye){var ue=uB(ee,oe++);(64512&ue)==56320?jm(Z,((1023&_e)<<10)+(1023&ue)+65536):(jm(Z,_e),oe--)}else jm(Z,_e)}return Z}(t);var s,a,c=t.length,d=128,h=0,m=72;for(s=0;s<t.length;s++)(a=t[s])<128&&jm(r,px(a));var g=r.length,E=g;for(g&&jm(r,"-");E<c;){var b=hx;for(s=0;s<t.length;s++)(a=t[s])>=d&&a<b&&(b=a);var I=E+1;if(b-d>Cv((hx-h)/I))throw new lB(cB);for(h+=(b-d)*I,d=b,s=0;s<t.length;s++){if((a=t[s])<d&&++h>hx)throw new lB(cB);if(a===d){for(var A=h,k=36;;){var W=k<=m?1:k>=m+26?26:k-m;if(A<W)break;var j=A-W,B=36-W;jm(r,px(hB(W+j%B))),A=Cv(j/B),k+=36}jm(r,px(hB(A))),m=ode(h,I,E===g),h=0,E++}}h++,d++}return dB(r,"")},cde=Gn,fx=ke,lde=pA,mx=L,pB=ot,ku=R,EA=Od,Ou=kh,ude=N_,gx=ti,_x=jue,Rv=function(t){var r=que(t),s=Jue(this),a=arguments.length,c=a>1?arguments[1]:void 0,d=c!==void 0;d&&(c=$ue(c,a>2?arguments[2]:void 0));var h,m,g,E,b,I,A=ede(r),k=0;if(!A||this===oB&&Xue(A))for(h=Que(r),m=s?new this(h):oB(h);h>k;k++)I=d?c(r[k],k):r[k],sB(m,k,I);else for(m=s?new this:[],b=(E=Zue(r,A)).next;!(g=Kue(b,E)).done;k++)I=d?Yue(E,c,[g.value,k],!0):g.value,sB(m,k,I);return m.length=k,m},Ld=Es,dde=JD.codeAt,hde=function(t){var r,s,a=[],c=ide(rde(sde(t),aB,"."),".");for(r=0;r<c.length;r++)s=c[r],jm(a,nde(tde,s)?"xn--"+ade(s):s);return dB(a,".")},sf=za,pde=wu,fde=Gc,fB=kue,mB=Ph,mde=mB.set,vA=mB.getterFor("URL"),gde=fB.URLSearchParams,_de=fB.getState,kw=mx.URL,yx=mx.TypeError,SA=mx.parseInt,yde=Math.floor,gB=Math.pow,Nu=ku("".charAt),Md=ku(/./.exec),Ow=ku([].join),Ede=ku(1 .toString),vde=ku([].pop),Iv=ku([].push),Ex=ku("".replace),Sde=ku([].shift),bde=ku("".split),Nw=ku("".slice),bA=ku("".toLowerCase),wde=ku([].unshift),vx="Invalid scheme",$_="Invalid host",_B="Invalid port",yB=/[a-z]/i,Tde=/[\d+-.a-z]/i,Sx=/\d/,Cde=/^0x/i,Rde=/^[0-7]+$/,Ide=/^\d+$/,EB=/^[\da-f]+$/i,Ade=/[\0\t\n\r #%/:<>?@[\\\]^|]/,Pde=/[\0\t\n\r #/:<>?@[\\\]^|]/,kde=/^[\u0000-\u0020]+/,Ode=/(^|[^\u0000-\u0020])[\u0000-\u0020]+$/,Nde=/[\t\n\r]/g,Dw=function(t){var r,s,a,c;if(typeof t=="number"){for(r=[],s=0;s<4;s++)wde(r,t%256),t=yde(t/256);return Ow(r,".")}if(typeof t=="object"){for(r="",a=function(d){for(var h=null,m=1,g=null,E=0,b=0;b<8;b++)d[b]!==0?(E>m&&(h=g,m=E),g=null,E=0):(g===null&&(g=b),++E);return E>m?g:h}(t),s=0;s<8;s++)c&&t[s]===0||(c&&(c=!1),a===s?(r+=s?":":"::",c=!0):(r+=Ede(t[s],16),s<7&&(r+=":")));return"["+r+"]"}return t},wA={},vB=_x({},wA,{" ":1,'"':1,"<":1,">":1,"`":1}),SB=_x({},vB,{"#":1,"?":1,"{":1,"}":1}),bx=_x({},SB,{"/":1,":":1,";":1,"=":1,"@":1,"[":1,"\\":1,"]":1,"^":1,"|":1}),Bm=function(t,r){var s=dde(t,0);return s>32&&s<127&&!gx(r,t)?t:encodeURIComponent(t)},TA={ftp:21,file:null,http:80,https:443,ws:80,wss:443},xw=function(t,r){var s;return t.length===2&&Md(yB,Nu(t,0))&&((s=Nu(t,1))===":"||!r&&s==="|")},bB=function(t){var r;return t.length>1&&xw(Nw(t,0,2))&&(t.length===2||(r=Nu(t,2))==="/"||r==="\\"||r==="?"||r==="#")},Dde=function(t){return t==="."||bA(t)==="%2e"},wx={},wB={},Tx={},TB={},CB={},Cx={},RB={},IB={},CA={},RA={},Rx={},Ix={},Ax={},Px={},AB={},kx={},Av={},Bh={},PB={},K_={},of={},Ox=function(t,r,s){var a,c,d,h=sf(t);if(r){if(c=this.parse(h))throw new yx(c);this.searchParams=null}else{if(s!==void 0&&(a=new Ox(s,!0)),c=this.parse(h,null,a))throw new yx(c);(d=_de(new gde)).bindURL(this),this.searchParams=d}};Ox.prototype={type:"URL",parse:function(t,r,s){var a,c,d,h,m,g=this,E=r||wx,b=0,I="",A=!1,k=!1,W=!1;for(t=sf(t),r||(g.scheme="",g.username="",g.password="",g.host=null,g.port=null,g.path=[],g.query=null,g.fragment=null,g.cannotBeABaseURL=!1,t=Ex(t,kde,""),t=Ex(t,Ode,"$1")),t=Ex(t,Nde,""),a=Rv(t);b<=a.length;){switch(c=a[b],E){case wx:if(!c||!Md(yB,c)){if(r)return vx;E=Tx;continue}I+=bA(c),E=wB;break;case wB:if(c&&(Md(Tde,c)||c==="+"||c==="-"||c==="."))I+=bA(c);else{if(c!==":"){if(r)return vx;I="",E=Tx,b=0;continue}if(r&&(g.isSpecial()!==gx(TA,I)||I==="file"&&(g.includesCredentials()||g.port!==null)||g.scheme==="file"&&!g.host))return;if(g.scheme=I,r)return void(g.isSpecial()&&TA[g.scheme]===g.port&&(g.port=null));I="",g.scheme==="file"?E=Px:g.isSpecial()&&s&&s.scheme===g.scheme?E=TB:g.isSpecial()?E=IB:a[b+1]==="/"?(E=CB,b++):(g.cannotBeABaseURL=!0,Iv(g.path,""),E=PB)}break;case Tx:if(!s||s.cannotBeABaseURL&&c!=="#")return vx;if(s.cannotBeABaseURL&&c==="#"){g.scheme=s.scheme,g.path=Ld(s.path),g.query=s.query,g.fragment="",g.cannotBeABaseURL=!0,E=of;break}E=s.scheme==="file"?Px:Cx;continue;case TB:if(c!=="/"||a[b+1]!=="/"){E=Cx;continue}E=CA,b++;break;case CB:if(c==="/"){E=RA;break}E=Bh;continue;case Cx:if(g.scheme=s.scheme,c===Pu)g.username=s.username,g.password=s.password,g.host=s.host,g.port=s.port,g.path=Ld(s.path),g.query=s.query;else if(c==="/"||c==="\\"&&g.isSpecial())E=RB;else if(c==="?")g.username=s.username,g.password=s.password,g.host=s.host,g.port=s.port,g.path=Ld(s.path),g.query="",E=K_;else{if(c!=="#"){g.username=s.username,g.password=s.password,g.host=s.host,g.port=s.port,g.path=Ld(s.path),g.path.length--,E=Bh;continue}g.username=s.username,g.password=s.password,g.host=s.host,g.port=s.port,g.path=Ld(s.path),g.query=s.query,g.fragment="",E=of}break;case RB:if(!g.isSpecial()||c!=="/"&&c!=="\\"){if(c!=="/"){g.username=s.username,g.password=s.password,g.host=s.host,g.port=s.port,E=Bh;continue}E=RA}else E=CA;break;case IB:if(E=CA,c!=="/"||Nu(I,b+1)!=="/")continue;b++;break;case CA:if(c!=="/"&&c!=="\\"){E=RA;continue}break;case RA:if(c==="@"){A&&(I="%40"+I),A=!0,d=Rv(I);for(var j=0;j<d.length;j++){var B=d[j];if(B!==":"||W){var ee=Bm(B,bx);W?g.password+=ee:g.username+=ee}else W=!0}I=""}else if(c===Pu||c==="/"||c==="?"||c==="#"||c==="\\"&&g.isSpecial()){if(A&&I==="")return"Invalid authority";b-=Rv(I).length+1,I="",E=Rx}else I+=c;break;case Rx:case Ix:if(r&&g.scheme==="file"){E=kx;continue}if(c!==":"||k){if(c===Pu||c==="/"||c==="?"||c==="#"||c==="\\"&&g.isSpecial()){if(g.isSpecial()&&I==="")return $_;if(r&&I===""&&(g.includesCredentials()||g.port!==null))return;if(h=g.parseHost(I))return h;if(I="",E=Av,r)return;continue}c==="["?k=!0:c==="]"&&(k=!1),I+=c}else{if(I==="")return $_;if(h=g.parseHost(I))return h;if(I="",E=Ax,r===Ix)return}break;case Ax:if(!Md(Sx,c)){if(c===Pu||c==="/"||c==="?"||c==="#"||c==="\\"&&g.isSpecial()||r){if(I!==""){var Z=SA(I,10);if(Z>65535)return _B;g.port=g.isSpecial()&&Z===TA[g.scheme]?null:Z,I=""}if(r)return;E=Av;continue}return _B}I+=c;break;case Px:if(g.scheme="file",c==="/"||c==="\\")E=AB;else{if(!s||s.scheme!=="file"){E=Bh;continue}switch(c){case Pu:g.host=s.host,g.path=Ld(s.path),g.query=s.query;break;case"?":g.host=s.host,g.path=Ld(s.path),g.query="",E=K_;break;case"#":g.host=s.host,g.path=Ld(s.path),g.query=s.query,g.fragment="",E=of;break;default:bB(Ow(Ld(a,b),""))||(g.host=s.host,g.path=Ld(s.path),g.shortenPath()),E=Bh;continue}}break;case AB:if(c==="/"||c==="\\"){E=kx;break}s&&s.scheme==="file"&&!bB(Ow(Ld(a,b),""))&&(xw(s.path[0],!0)?Iv(g.path,s.path[0]):g.host=s.host),E=Bh;continue;case kx:if(c===Pu||c==="/"||c==="\\"||c==="?"||c==="#"){if(!r&&xw(I))E=Bh;else if(I===""){if(g.host="",r)return;E=Av}else{if(h=g.parseHost(I))return h;if(g.host==="localhost"&&(g.host=""),r)return;I="",E=Av}continue}I+=c;break;case Av:if(g.isSpecial()){if(E=Bh,c!=="/"&&c!=="\\")continue}else if(r||c!=="?")if(r||c!=="#"){if(c!==Pu&&(E=Bh,c!=="/"))continue}else g.fragment="",E=of;else g.query="",E=K_;break;case Bh:if(c===Pu||c==="/"||c==="\\"&&g.isSpecial()||!r&&(c==="?"||c==="#")){if((m=bA(m=I))===".."||m==="%2e."||m===".%2e"||m==="%2e%2e"?(g.shortenPath(),c==="/"||c==="\\"&&g.isSpecial()||Iv(g.path,"")):Dde(I)?c==="/"||c==="\\"&&g.isSpecial()||Iv(g.path,""):(g.scheme==="file"&&!g.path.length&&xw(I)&&(g.host&&(g.host=""),I=Nu(I,0)+":"),Iv(g.path,I)),I="",g.scheme==="file"&&(c===Pu||c==="?"||c==="#"))for(;g.path.length>1&&g.path[0]==="";)Sde(g.path);c==="?"?(g.query="",E=K_):c==="#"&&(g.fragment="",E=of)}else I+=Bm(c,SB);break;case PB:c==="?"?(g.query="",E=K_):c==="#"?(g.fragment="",E=of):c!==Pu&&(g.path[0]+=Bm(c,wA));break;case K_:r||c!=="#"?c!==Pu&&(c==="'"&&g.isSpecial()?g.query+="%27":g.query+=c==="#"?"%23":Bm(c,wA)):(g.fragment="",E=of);break;case of:c!==Pu&&(g.fragment+=Bm(c,vB))}b++}},parseHost:function(t){var r,s,a;if(Nu(t,0)==="["){if(Nu(t,t.length-1)!=="]"||(r=function(c){var d,h,m,g,E,b,I,A=[0,0,0,0,0,0,0,0],k=0,W=null,j=0,B=function(){return Nu(c,j)};if(B()===":"){if(Nu(c,1)!==":")return;j+=2,W=++k}for(;B();){if(k===8)return;if(B()!==":"){for(d=h=0;h<4&&Md(EB,B());)d=16*d+SA(B(),16),j++,h++;if(B()==="."){if(h===0||(j-=h,k>6))return;for(m=0;B();){if(g=null,m>0){if(!(B()==="."&&m<4))return;j++}if(!Md(Sx,B()))return;for(;Md(Sx,B());){if(E=SA(B(),10),g===null)g=E;else{if(g===0)return;g=10*g+E}if(g>255)return;j++}A[k]=256*A[k]+g,++m!=2&&m!==4||k++}if(m!==4)return;break}if(B()===":"){if(j++,!B())return}else if(B())return;A[k++]=d}else{if(W!==null)return;j++,W=++k}}if(W!==null)for(b=k-W,k=7;k!==0&&b>0;)I=A[k],A[k--]=A[W+b-1],A[W+--b]=I;else if(k!==8)return;return A}(Nw(t,1,-1)),!r))return $_;this.host=r}else if(this.isSpecial()){if(t=hde(t),Md(Ade,t)||(r=function(c){var d,h,m,g,E,b,I,A=bde(c,".");if(A.length&&A[A.length-1]===""&&A.length--,(d=A.length)>4)return c;for(h=[],m=0;m<d;m++){if((g=A[m])==="")return c;if(E=10,g.length>1&&Nu(g,0)==="0"&&(E=Md(Cde,g)?16:8,g=Nw(g,E===8?1:2)),g==="")b=0;else{if(!Md(E===10?Ide:E===8?Rde:EB,g))return c;b=SA(g,E)}Iv(h,b)}for(m=0;m<d;m++)if(b=h[m],m===d-1){if(b>=gB(256,5-d))return null}else if(b>255)return null;for(I=vde(h),m=0;m<h.length;m++)I+=h[m]*gB(256,3-m);return I}(t),r===null))return $_;this.host=r}else{if(Md(Pde,t))return $_;for(r="",s=Rv(t),a=0;a<s.length;a++)r+=Bm(s[a],wA);this.host=r}},cannotHaveUsernamePasswordPort:function(){return!this.host||this.cannotBeABaseURL||this.scheme==="file"},includesCredentials:function(){return this.username!==""||this.password!==""},isSpecial:function(){return gx(TA,this.scheme)},shortenPath:function(){var t=this.path,r=t.length;!r||this.scheme==="file"&&r===1&&xw(t[0],!0)||t.length--},serialize:function(){var t=this,r=t.scheme,s=t.username,a=t.password,c=t.host,d=t.port,h=t.path,m=t.query,g=t.fragment,E=r+":";return c!==null?(E+="//",t.includesCredentials()&&(E+=s+(a?":"+a:"")+"@"),E+=Dw(c),d!==null&&(E+=":"+d)):r==="file"&&(E+="//"),E+=t.cannotBeABaseURL?h[0]:h.length?"/"+Ow(h,"/"):"",m!==null&&(E+="?"+m),g!==null&&(E+="#"+g),E},setHref:function(t){var r=this.parse(t);if(r)throw new yx(r);this.searchParams.update()},getOrigin:function(){var t=this.scheme,r=this.port;if(t==="blob")try{return new Pv(t.path[0]).origin}catch{return"null"}return t!=="file"&&this.isSpecial()?t+"://"+Dw(this.host)+(r!==null?":"+r:""):"null"},getProtocol:function(){return this.scheme+":"},setProtocol:function(t){this.parse(sf(t)+":",wx)},getUsername:function(){return this.username},setUsername:function(t){var r=Rv(sf(t));if(!this.cannotHaveUsernamePasswordPort()){this.username="";for(var s=0;s<r.length;s++)this.username+=Bm(r[s],bx)}},getPassword:function(){return this.password},setPassword:function(t){var r=Rv(sf(t));if(!this.cannotHaveUsernamePasswordPort()){this.password="";for(var s=0;s<r.length;s++)this.password+=Bm(r[s],bx)}},getHost:function(){var t=this.host,r=this.port;return t===null?"":r===null?Dw(t):Dw(t)+":"+r},setHost:function(t){this.cannotBeABaseURL||this.parse(t,Rx)},getHostname:function(){var t=this.host;return t===null?"":Dw(t)},setHostname:function(t){this.cannotBeABaseURL||this.parse(t,Ix)},getPort:function(){var t=this.port;return t===null?"":sf(t)},setPort:function(t){this.cannotHaveUsernamePasswordPort()||((t=sf(t))===""?this.port=null:this.parse(t,Ax))},getPathname:function(){var t=this.path;return this.cannotBeABaseURL?t[0]:t.length?"/"+Ow(t,"/"):""},setPathname:function(t){this.cannotBeABaseURL||(this.path=[],this.parse(t,Av))},getSearch:function(){var t=this.query;return t?"?"+t:""},setSearch:function(t){(t=sf(t))===""?this.query=null:(Nu(t,0)==="?"&&(t=Nw(t,1)),this.query="",this.parse(t,K_)),this.searchParams.update()},getSearchParams:function(){return this.searchParams.facade},getHash:function(){var t=this.fragment;return t?"#"+t:""},setHash:function(t){(t=sf(t))!==""?(Nu(t,0)==="#"&&(t=Nw(t,1)),this.fragment="",this.parse(t,of)):this.fragment=null},update:function(){this.query=this.searchParams.serialize()||null}};var Pv=function(t){var r=ude(this,wc),s=fde(arguments.length,1)>1?arguments[1]:void 0,a=mde(r,new Ox(t,!1,s));fx||(r.href=a.serialize(),r.origin=a.getOrigin(),r.protocol=a.getProtocol(),r.username=a.getUsername(),r.password=a.getPassword(),r.host=a.getHost(),r.hostname=a.getHostname(),r.port=a.getPort(),r.pathname=a.getPathname(),r.search=a.getSearch(),r.searchParams=a.getSearchParams(),r.hash=a.getHash())},wc=Pv.prototype,Du=function(t,r){return{get:function(){return vA(this)[t]()},set:r&&function(s){return vA(this)[r](s)},configurable:!0,enumerable:!0}};if(fx&&(Ou(wc,"href",Du("serialize","setHref")),Ou(wc,"origin",Du("getOrigin")),Ou(wc,"protocol",Du("getProtocol","setProtocol")),Ou(wc,"username",Du("getUsername","setUsername")),Ou(wc,"password",Du("getPassword","setPassword")),Ou(wc,"host",Du("getHost","setHost")),Ou(wc,"hostname",Du("getHostname","setHostname")),Ou(wc,"port",Du("getPort","setPort")),Ou(wc,"pathname",Du("getPathname","setPathname")),Ou(wc,"search",Du("getSearch","setSearch")),Ou(wc,"searchParams",Du("getSearchParams")),Ou(wc,"hash",Du("getHash","setHash"))),EA(wc,"toJSON",function(){return vA(this).serialize()},{enumerable:!0}),EA(wc,"toString",function(){return vA(this).serialize()},{enumerable:!0}),kw){var kB=kw.createObjectURL,OB=kw.revokeObjectURL;kB&&EA(Pv,"createObjectURL",pB(kB,kw)),OB&&EA(Pv,"revokeObjectURL",pB(OB,kw))}pde(Pv,"URL"),cde({global:!0,forced:!lde,sham:!fx},{URL:Pv});var xde=Gn,NB=u,Lde=Gc,DB=za,Mde=pA,Nx=xt("URL"),Ude=Mde&&NB(function(){Nx.canParse()}),Vde=NB(function(){return Nx.canParse.length!==1});xde({target:"URL",stat:!0,forced:!Ude||Vde},{canParse:function(t){var r=Lde(arguments.length,1),s=DB(t),a=r<2||arguments[1]===void 0?void 0:DB(arguments[1]);try{return!!new Nx(s,a)}catch{return!1}}});var Fde=Gn,jde=Gc,xB=za,Bde=pA,zde=xt("URL");Fde({target:"URL",stat:!0,forced:!Bde},{parse:function(t){var r=jde(arguments.length,1),s=xB(t),a=r<2||arguments[1]===void 0?void 0:xB(arguments[1]);try{return new zde(s,a)}catch{return null}}});var IA=l(Ne.URL);let LB=!0,MB=!0;function AA(t,r,s){const a=t.match(r);return a&&a.length>=s&&parseInt(a[s],10)}function q_(t,r,s){if(!t.RTCPeerConnection)return;const a=t.RTCPeerConnection.prototype,c=a.addEventListener;a.addEventListener=function(h,m){if(h!==r)return c.apply(this,arguments);const g=E=>{const b=s(E);b&&(m.handleEvent?m.handleEvent(b):m(b))};return this._eventMap=this._eventMap||{},this._eventMap[r]||(this._eventMap[r]=new Map),this._eventMap[r].set(m,g),c.apply(this,[h,g])};const d=a.removeEventListener;a.removeEventListener=function(h,m){if(h!==r||!this._eventMap||!this._eventMap[r])return d.apply(this,arguments);if(!this._eventMap[r].has(m))return d.apply(this,arguments);const g=this._eventMap[r].get(m);return this._eventMap[r].delete(m),this._eventMap[r].size===0&&delete this._eventMap[r],Object.keys(this._eventMap).length===0&&delete this._eventMap,d.apply(this,[h,g])},Object.defineProperty(a,"on"+r,{get(){return this["_on"+r]},set(h){this["_on"+r]&&(this.removeEventListener(r,this["_on"+r]),delete this["_on"+r]),h&&this.addEventListener(r,this["_on"+r]=h)},enumerable:!0,configurable:!0})}function Wde(t){return typeof t!="boolean"?new Error("Argument type: "+typeof t+". Please use a boolean."):(LB=t,t?"adapter.js logging disabled":"adapter.js logging enabled")}function Gde(t){return typeof t!="boolean"?new Error("Argument type: "+typeof t+". Please use a boolean."):(MB=!t,"adapter.js deprecation warnings "+(t?"disabled":"enabled"))}function UB(){if(typeof window=="object"){if(LB)return;typeof console<"u"&&typeof console.log=="function"&&console.log.apply(console,arguments)}}function Dx(t,r){MB&&console.warn(t+" is deprecated, please use "+r+" instead.")}function VB(t){return Object.prototype.toString.call(t)==="[object Object]"}function FB(t){var r;return VB(t)?Wa(r=Object.keys(t)).call(r,function(s,a){const c=VB(t[a]),d=c?FB(t[a]):t[a],h=c&&!Object.keys(d).length;return d===void 0||h?s:Object.assign(s,{[a]:d})},{}):t}function xx(t,r,s){r&&!s.has(r.id)&&(s.set(r.id,r),Object.keys(r).forEach(a=>{a.endsWith("Id")?xx(t,t.get(r[a]),s):a.endsWith("Ids")&&r[a].forEach(c=>{xx(t,t.get(c),s)})}))}function jB(t,r,s){const a=s?"outbound-rtp":"inbound-rtp",c=new Map;if(r===null)return c;const d=[];return t.forEach(h=>{h.type==="track"&&h.trackIdentifier===r.id&&d.push(h)}),d.forEach(h=>{t.forEach(m=>{m.type===a&&m.trackId===h.id&&xx(t,m,c)})}),c}const BB=UB;function zB(t,r){const s=t&&t.navigator;if(!s.mediaDevices)return;const a=function(h){if(typeof h!="object"||h.mandatory||h.optional)return h;const m={};return Object.keys(h).forEach(g=>{if(g==="require"||g==="advanced"||g==="mediaSource")return;const E=typeof h[g]=="object"?h[g]:{ideal:h[g]};E.exact!==void 0&&typeof E.exact=="number"&&(E.min=E.max=E.exact);const b=function(I,A){return I?I+A.charAt(0).toUpperCase()+A.slice(1):A==="deviceId"?"sourceId":A};if(E.ideal!==void 0){m.optional=m.optional||[];let I={};typeof E.ideal=="number"?(I[b("min",g)]=E.ideal,m.optional.push(I),I={},I[b("max",g)]=E.ideal,m.optional.push(I)):(I[b("",g)]=E.ideal,m.optional.push(I))}E.exact!==void 0&&typeof E.exact!="number"?(m.mandatory=m.mandatory||{},m.mandatory[b("",g)]=E.exact):["min","max"].forEach(I=>{E[I]!==void 0&&(m.mandatory=m.mandatory||{},m.mandatory[b(I,g)]=E[I])})}),h.advanced&&(m.optional=(m.optional||[]).concat(h.advanced)),m},c=function(h,m){if(r.version>=61)return m(h);if((h=JSON.parse(JSON.stringify(h)))&&typeof h.audio=="object"){const g=function(E,b,I){b in E&&!(I in E)&&(E[I]=E[b],delete E[b])};g((h=JSON.parse(JSON.stringify(h))).audio,"autoGainControl","googAutoGainControl"),g(h.audio,"noiseSuppression","googNoiseSuppression"),h.audio=a(h.audio)}if(h&&typeof h.video=="object"){let g=h.video.facingMode;g=g&&(typeof g=="object"?g:{ideal:g});const E=r.version<66;if(g&&(g.exact==="user"||g.exact==="environment"||g.ideal==="user"||g.ideal==="environment")&&(!s.mediaDevices.getSupportedConstraints||!s.mediaDevices.getSupportedConstraints().facingMode||E)){let b;if(delete h.video.facingMode,g.exact==="environment"||g.ideal==="environment"?b=["back","rear"]:g.exact!=="user"&&g.ideal!=="user"||(b=["front"]),b)return s.mediaDevices.enumerateDevices().then(I=>{I=I.filter(k=>k.kind==="videoinput");let A=I.find(k=>b.some(W=>{var j;return rt(j=k.label.toLowerCase()).call(j,W)}));return!A&&I.length&&rt(b).call(b,"back")&&(A=I[I.length-1]),A&&(h.video.deviceId=g.exact?{exact:A.deviceId}:{ideal:A.deviceId}),h.video=a(h.video),BB("chrome: "+JSON.stringify(h)),m(h)})}h.video=a(h.video)}return BB("chrome: "+JSON.stringify(h)),m(h)},d=function(h){return r.version>=64?h:{name:{PermissionDeniedError:"NotAllowedError",PermissionDismissedError:"NotAllowedError",InvalidStateError:"NotAllowedError",DevicesNotFoundError:"NotFoundError",ConstraintNotSatisfiedError:"OverconstrainedError",TrackStartError:"NotReadableError",MediaDeviceFailedDueToShutdown:"NotAllowedError",MediaDeviceKillSwitchOn:"NotAllowedError",TabCaptureError:"AbortError",ScreenCaptureError:"AbortError",DeviceCaptureError:"AbortError"}[h.name]||h.name,message:h.message,constraint:h.constraint||h.constraintName,toString(){return this.name+(this.message&&": ")+this.message}}};if(s.getUserMedia=(function(h,m,g){c(h,E=>{s.webkitGetUserMedia(E,m,b=>{g&&g(d(b))})})}).bind(s),s.mediaDevices.getUserMedia){const h=s.mediaDevices.getUserMedia.bind(s.mediaDevices);s.mediaDevices.getUserMedia=function(m){return c(m,g=>h(g).then(E=>{if(g.audio&&!E.getAudioTracks().length||g.video&&!E.getVideoTracks().length)throw E.getTracks().forEach(b=>{b.stop()}),new DOMException("","NotFoundError");return E},E=>pt.reject(d(E))))}}}function WB(t){t.MediaStream=t.MediaStream||t.webkitMediaStream}function GB(t){if(typeof t=="object"&&t.RTCPeerConnection&&!("ontrack"in t.RTCPeerConnection.prototype)){Object.defineProperty(t.RTCPeerConnection.prototype,"ontrack",{get(){return this._ontrack},set(s){this._ontrack&&this.removeEventListener("track",this._ontrack),this.addEventListener("track",this._ontrack=s)},enumerable:!0,configurable:!0});const r=t.RTCPeerConnection.prototype.setRemoteDescription;t.RTCPeerConnection.prototype.setRemoteDescription=function(){return this._ontrackpoly||(this._ontrackpoly=s=>{s.stream.addEventListener("addtrack",a=>{let c;c=t.RTCPeerConnection.prototype.getReceivers?this.getReceivers().find(h=>h.track&&h.track.id===a.track.id):{track:a.track};const d=new Event("track");d.track=a.track,d.receiver=c,d.transceiver={receiver:c},d.streams=[s.stream],this.dispatchEvent(d)}),s.stream.getTracks().forEach(a=>{let c;c=t.RTCPeerConnection.prototype.getReceivers?this.getReceivers().find(h=>h.track&&h.track.id===a.id):{track:a};const d=new Event("track");d.track=a,d.receiver=c,d.transceiver={receiver:c},d.streams=[s.stream],this.dispatchEvent(d)})},this.addEventListener("addstream",this._ontrackpoly)),r.apply(this,arguments)}}else q_(t,"track",r=>(r.transceiver||Object.defineProperty(r,"transceiver",{value:{receiver:r.receiver}}),r))}function HB(t){if(typeof t=="object"&&t.RTCPeerConnection&&!("getSenders"in t.RTCPeerConnection.prototype)&&"createDTMFSender"in t.RTCPeerConnection.prototype){const r=function(c,d){return{track:d,get dtmf(){return this._dtmf===void 0&&(d.kind==="audio"?this._dtmf=c.createDTMFSender(d):this._dtmf=null),this._dtmf},_pc:c}};if(!t.RTCPeerConnection.prototype.getSenders){t.RTCPeerConnection.prototype.getSenders=function(){return this._senders=this._senders||[],this._senders.slice()};const c=t.RTCPeerConnection.prototype.addTrack;t.RTCPeerConnection.prototype.addTrack=function(h,m){let g=c.apply(this,arguments);return g||(g=r(this,h),this._senders.push(g)),g};const d=t.RTCPeerConnection.prototype.removeTrack;t.RTCPeerConnection.prototype.removeTrack=function(h){d.apply(this,arguments);const m=this._senders.indexOf(h);m!==-1&&this._senders.splice(m,1)}}const s=t.RTCPeerConnection.prototype.addStream;t.RTCPeerConnection.prototype.addStream=function(c){this._senders=this._senders||[],s.apply(this,[c]),c.getTracks().forEach(d=>{this._senders.push(r(this,d))})};const a=t.RTCPeerConnection.prototype.removeStream;t.RTCPeerConnection.prototype.removeStream=function(c){this._senders=this._senders||[],a.apply(this,[c]),c.getTracks().forEach(d=>{const h=this._senders.find(m=>m.track===d);h&&this._senders.splice(this._senders.indexOf(h),1)})}}else if(typeof t=="object"&&t.RTCPeerConnection&&"getSenders"in t.RTCPeerConnection.prototype&&"createDTMFSender"in t.RTCPeerConnection.prototype&&t.RTCRtpSender&&!("dtmf"in t.RTCRtpSender.prototype)){const r=t.RTCPeerConnection.prototype.getSenders;t.RTCPeerConnection.prototype.getSenders=function(){const s=r.apply(this,[]);return s.forEach(a=>a._pc=this),s},Object.defineProperty(t.RTCRtpSender.prototype,"dtmf",{get(){return this._dtmf===void 0&&(this.track.kind==="audio"?this._dtmf=this._pc.createDTMFSender(this.track):this._dtmf=null),this._dtmf}})}}function $B(t){if(!t.RTCPeerConnection)return;const r=t.RTCPeerConnection.prototype.getStats;t.RTCPeerConnection.prototype.getStats=function(){const[s,a,c]=arguments;if(arguments.length>0&&typeof s=="function")return r.apply(this,arguments);if(r.length===0&&(arguments.length===0||typeof s!="function"))return r.apply(this,[]);const d=function(m){const g={};return m.result().forEach(E=>{const b={id:E.id,timestamp:E.timestamp,type:{localcandidate:"local-candidate",remotecandidate:"remote-candidate"}[E.type]||E.type};E.names().forEach(I=>{b[I]=E.stat(I)}),g[b.id]=b}),g},h=function(m){return new Map(Object.keys(m).map(g=>[g,m[g]]))};if(arguments.length>=2){const m=function(g){a(h(d(g)))};return r.apply(this,[m,s])}return new pt((m,g)=>{r.apply(this,[function(E){m(h(d(E)))},g])}).then(a,c)}}function KB(t){if(!(typeof t=="object"&&t.RTCPeerConnection&&t.RTCRtpSender&&t.RTCRtpReceiver))return;if(!("getStats"in t.RTCRtpSender.prototype)){const s=t.RTCPeerConnection.prototype.getSenders;s&&(t.RTCPeerConnection.prototype.getSenders=function(){const c=s.apply(this,[]);return c.forEach(d=>d._pc=this),c});const a=t.RTCPeerConnection.prototype.addTrack;a&&(t.RTCPeerConnection.prototype.addTrack=function(){const c=a.apply(this,arguments);return c._pc=this,c}),t.RTCRtpSender.prototype.getStats=function(){const c=this;return this._pc.getStats().then(d=>jB(d,c.track,!0))}}if(!("getStats"in t.RTCRtpReceiver.prototype)){const s=t.RTCPeerConnection.prototype.getReceivers;s&&(t.RTCPeerConnection.prototype.getReceivers=function(){const a=s.apply(this,[]);return a.forEach(c=>c._pc=this),a}),q_(t,"track",a=>(a.receiver._pc=a.srcElement,a)),t.RTCRtpReceiver.prototype.getStats=function(){const a=this;return this._pc.getStats().then(c=>jB(c,a.track,!1))}}if(!("getStats"in t.RTCRtpSender.prototype)||!("getStats"in t.RTCRtpReceiver.prototype))return;const r=t.RTCPeerConnection.prototype.getStats;t.RTCPeerConnection.prototype.getStats=function(){if(arguments.length>0&&arguments[0]instanceof t.MediaStreamTrack){const s=arguments[0];let a,c,d;return this.getSenders().forEach(h=>{h.track===s&&(a?d=!0:a=h)}),this.getReceivers().forEach(h=>(h.track===s&&(c?d=!0:c=h),h.track===s)),d||a&&c?pt.reject(new DOMException("There are more than one sender or receiver for the track.","InvalidAccessError")):a?a.getStats():c?c.getStats():pt.reject(new DOMException("There is no sender or receiver for the track.","InvalidAccessError"))}return r.apply(this,arguments)}}function qB(t){t.RTCPeerConnection.prototype.getLocalStreams=function(){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},Object.keys(this._shimmedLocalStreams).map(d=>this._shimmedLocalStreams[d][0])};const r=t.RTCPeerConnection.prototype.addTrack;t.RTCPeerConnection.prototype.addTrack=function(d,h){if(!h)return r.apply(this,arguments);this._shimmedLocalStreams=this._shimmedLocalStreams||{};const m=r.apply(this,arguments);return this._shimmedLocalStreams[h.id]?this._shimmedLocalStreams[h.id].indexOf(m)===-1&&this._shimmedLocalStreams[h.id].push(m):this._shimmedLocalStreams[h.id]=[h,m],m};const s=t.RTCPeerConnection.prototype.addStream;t.RTCPeerConnection.prototype.addStream=function(d){this._shimmedLocalStreams=this._shimmedLocalStreams||{},d.getTracks().forEach(g=>{if(this.getSenders().find(b=>b.track===g))throw new DOMException("Track already exists.","InvalidAccessError")});const h=this.getSenders();s.apply(this,arguments);const m=this.getSenders().filter(g=>h.indexOf(g)===-1);this._shimmedLocalStreams[d.id]=[d].concat(m)};const a=t.RTCPeerConnection.prototype.removeStream;t.RTCPeerConnection.prototype.removeStream=function(d){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},delete this._shimmedLocalStreams[d.id],a.apply(this,arguments)};const c=t.RTCPeerConnection.prototype.removeTrack;t.RTCPeerConnection.prototype.removeTrack=function(d){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},d&&Object.keys(this._shimmedLocalStreams).forEach(h=>{const m=this._shimmedLocalStreams[h].indexOf(d);m!==-1&&this._shimmedLocalStreams[h].splice(m,1),this._shimmedLocalStreams[h].length===1&&delete this._shimmedLocalStreams[h]}),c.apply(this,arguments)}}function YB(t,r){if(!t.RTCPeerConnection)return;if(t.RTCPeerConnection.prototype.addTrack&&r.version>=65)return qB(t);const s=t.RTCPeerConnection.prototype.getLocalStreams;t.RTCPeerConnection.prototype.getLocalStreams=function(){const g=s.apply(this);return this._reverseStreams=this._reverseStreams||{},g.map(E=>this._reverseStreams[E.id])};const a=t.RTCPeerConnection.prototype.addStream;t.RTCPeerConnection.prototype.addStream=function(g){if(this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},g.getTracks().forEach(E=>{if(this.getSenders().find(I=>I.track===E))throw new DOMException("Track already exists.","InvalidAccessError")}),!this._reverseStreams[g.id]){const E=new t.MediaStream(g.getTracks());this._streams[g.id]=E,this._reverseStreams[E.id]=g,g=E}a.apply(this,[g])};const c=t.RTCPeerConnection.prototype.removeStream;function d(g,E){let b=E.sdp;return Object.keys(g._reverseStreams||[]).forEach(I=>{const A=g._reverseStreams[I],k=g._streams[A.id];b=b.replace(new RegExp(k.id,"g"),A.id)}),new RTCSessionDescription({type:E.type,sdp:b})}t.RTCPeerConnection.prototype.removeStream=function(g){this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},c.apply(this,[this._streams[g.id]||g]),delete this._reverseStreams[this._streams[g.id]?this._streams[g.id].id:g.id],delete this._streams[g.id]},t.RTCPeerConnection.prototype.addTrack=function(g,E){if(this.signalingState==="closed")throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");const b=[].slice.call(arguments,1);if(b.length!==1||!b[0].getTracks().find(k=>k===g))throw new DOMException("The adapter.js addTrack polyfill only supports a single  stream which is associated with the specified track.","NotSupportedError");if(this.getSenders().find(k=>k.track===g))throw new DOMException("Track already exists.","InvalidAccessError");this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{};const A=this._streams[E.id];if(A)A.addTrack(g),pt.resolve().then(()=>{this.dispatchEvent(new Event("negotiationneeded"))});else{const k=new t.MediaStream([g]);this._streams[E.id]=k,this._reverseStreams[k.id]=E,this.addStream(k)}return this.getSenders().find(k=>k.track===g)},["createOffer","createAnswer"].forEach(function(g){const E=t.RTCPeerConnection.prototype[g],b={[g](){const I=arguments;return arguments.length&&typeof arguments[0]=="function"?E.apply(this,[A=>{const k=d(this,A);I[0].apply(null,[k])},A=>{I[1]&&I[1].apply(null,A)},arguments[2]]):E.apply(this,arguments).then(A=>d(this,A))}};t.RTCPeerConnection.prototype[g]=b[g]});const h=t.RTCPeerConnection.prototype.setLocalDescription;t.RTCPeerConnection.prototype.setLocalDescription=function(){return arguments.length&&arguments[0].type?(arguments[0]=function(g,E){let b=E.sdp;return Object.keys(g._reverseStreams||[]).forEach(I=>{const A=g._reverseStreams[I],k=g._streams[A.id];b=b.replace(new RegExp(A.id,"g"),k.id)}),new RTCSessionDescription({type:E.type,sdp:b})}(this,arguments[0]),h.apply(this,arguments)):h.apply(this,arguments)};const m=Object.getOwnPropertyDescriptor(t.RTCPeerConnection.prototype,"localDescription");Object.defineProperty(t.RTCPeerConnection.prototype,"localDescription",{get(){const g=m.get.apply(this);return g.type===""?g:d(this,g)}}),t.RTCPeerConnection.prototype.removeTrack=function(g){if(this.signalingState==="closed")throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");if(!g._pc)throw new DOMException("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.","TypeError");if(g._pc!==this)throw new DOMException("Sender was not created by this connection.","InvalidAccessError");let E;this._streams=this._streams||{},Object.keys(this._streams).forEach(b=>{this._streams[b].getTracks().find(I=>g.track===I)&&(E=this._streams[b])}),E&&(E.getTracks().length===1?this.removeStream(this._reverseStreams[E.id]):E.removeTrack(g.track),this.dispatchEvent(new Event("negotiationneeded")))}}function Lx(t,r){!t.RTCPeerConnection&&t.webkitRTCPeerConnection&&(t.RTCPeerConnection=t.webkitRTCPeerConnection),t.RTCPeerConnection&&r.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(s){const a=t.RTCPeerConnection.prototype[s],c={[s](){return arguments[0]=new(s==="addIceCandidate"?t.RTCIceCandidate:t.RTCSessionDescription)(arguments[0]),a.apply(this,arguments)}};t.RTCPeerConnection.prototype[s]=c[s]})}function XB(t,r){q_(t,"negotiationneeded",s=>{const a=s.target;if(!(r.version<72||a.getConfiguration&&a.getConfiguration().sdpSemantics==="plan-b")||a.signalingState==="stable")return s})}var JB=Object.freeze({__proto__:null,fixNegotiationNeeded:XB,shimAddTrackRemoveTrack:YB,shimAddTrackRemoveTrackWithNative:qB,shimGetDisplayMedia:function(t,r){t.navigator.mediaDevices&&"getDisplayMedia"in t.navigator.mediaDevices||t.navigator.mediaDevices&&(typeof r=="function"?t.navigator.mediaDevices.getDisplayMedia=function(s){return r(s).then(a=>{const c=s.video&&s.video.width,d=s.video&&s.video.height,h=s.video&&s.video.frameRate;return s.video={mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:a,maxFrameRate:h||3}},c&&(s.video.mandatory.maxWidth=c),d&&(s.video.mandatory.maxHeight=d),t.navigator.mediaDevices.getUserMedia(s)})}:console.error("shimGetDisplayMedia: getSourceId argument is not a function"))},shimGetSendersWithDtmf:HB,shimGetStats:$B,shimGetUserMedia:zB,shimMediaStream:WB,shimOnTrack:GB,shimPeerConnection:Lx,shimSenderReceiverGetStats:KB});function QB(t,r){const s=t&&t.navigator,a=t&&t.MediaStreamTrack;if(s.getUserMedia=function(c,d,h){Dx("navigator.getUserMedia","navigator.mediaDevices.getUserMedia"),s.mediaDevices.getUserMedia(c).then(d,h)},!(r.version>55&&"autoGainControl"in s.mediaDevices.getSupportedConstraints())){const c=function(h,m,g){m in h&&!(g in h)&&(h[g]=h[m],delete h[m])},d=s.mediaDevices.getUserMedia.bind(s.mediaDevices);if(s.mediaDevices.getUserMedia=function(h){return typeof h=="object"&&typeof h.audio=="object"&&(h=JSON.parse(JSON.stringify(h)),c(h.audio,"autoGainControl","mozAutoGainControl"),c(h.audio,"noiseSuppression","mozNoiseSuppression")),d(h)},a&&a.prototype.getSettings){const h=a.prototype.getSettings;a.prototype.getSettings=function(){const m=h.apply(this,arguments);return c(m,"mozAutoGainControl","autoGainControl"),c(m,"mozNoiseSuppression","noiseSuppression"),m}}if(a&&a.prototype.applyConstraints){const h=a.prototype.applyConstraints;a.prototype.applyConstraints=function(m){return this.kind==="audio"&&typeof m=="object"&&(m=JSON.parse(JSON.stringify(m)),c(m,"autoGainControl","mozAutoGainControl"),c(m,"noiseSuppression","mozNoiseSuppression")),h.apply(this,[m])}}}}function ZB(t){typeof t=="object"&&t.RTCTrackEvent&&"receiver"in t.RTCTrackEvent.prototype&&!("transceiver"in t.RTCTrackEvent.prototype)&&Object.defineProperty(t.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function Mx(t,r){if(typeof t!="object"||!t.RTCPeerConnection&&!t.mozRTCPeerConnection)return;!t.RTCPeerConnection&&t.mozRTCPeerConnection&&(t.RTCPeerConnection=t.mozRTCPeerConnection),r.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(c){const d=t.RTCPeerConnection.prototype[c],h={[c](){return arguments[0]=new(c==="addIceCandidate"?t.RTCIceCandidate:t.RTCSessionDescription)(arguments[0]),d.apply(this,arguments)}};t.RTCPeerConnection.prototype[c]=h[c]});const s={inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"},a=t.RTCPeerConnection.prototype.getStats;t.RTCPeerConnection.prototype.getStats=function(){const[c,d,h]=arguments;return a.apply(this,[c||null]).then(m=>{if(r.version<53&&!d)try{m.forEach(g=>{g.type=s[g.type]||g.type})}catch(g){if(g.name!=="TypeError")throw g;m.forEach((E,b)=>{m.set(b,Object.assign({},E,{type:s[E.type]||E.type}))})}return m}).then(d,h)}}function e6(t){if(typeof t!="object"||!t.RTCPeerConnection||!t.RTCRtpSender||t.RTCRtpSender&&"getStats"in t.RTCRtpSender.prototype)return;const r=t.RTCPeerConnection.prototype.getSenders;r&&(t.RTCPeerConnection.prototype.getSenders=function(){const a=r.apply(this,[]);return a.forEach(c=>c._pc=this),a});const s=t.RTCPeerConnection.prototype.addTrack;s&&(t.RTCPeerConnection.prototype.addTrack=function(){const a=s.apply(this,arguments);return a._pc=this,a}),t.RTCRtpSender.prototype.getStats=function(){return this.track?this._pc.getStats(this.track):pt.resolve(new Map)}}function t6(t){if(typeof t!="object"||!t.RTCPeerConnection||!t.RTCRtpSender||t.RTCRtpSender&&"getStats"in t.RTCRtpReceiver.prototype)return;const r=t.RTCPeerConnection.prototype.getReceivers;r&&(t.RTCPeerConnection.prototype.getReceivers=function(){const s=r.apply(this,[]);return s.forEach(a=>a._pc=this),s}),q_(t,"track",s=>(s.receiver._pc=s.srcElement,s)),t.RTCRtpReceiver.prototype.getStats=function(){return this._pc.getStats(this.track)}}function n6(t){t.RTCPeerConnection&&!("removeStream"in t.RTCPeerConnection.prototype)&&(t.RTCPeerConnection.prototype.removeStream=function(r){Dx("removeStream","removeTrack"),this.getSenders().forEach(s=>{var a;s.track&&rt(a=r.getTracks()).call(a,s.track)&&this.removeTrack(s)})})}function r6(t){t.DataChannel&&!t.RTCDataChannel&&(t.RTCDataChannel=t.DataChannel)}function i6(t){if(typeof t!="object"||!t.RTCPeerConnection)return;const r=t.RTCPeerConnection.prototype.addTransceiver;r&&(t.RTCPeerConnection.prototype.addTransceiver=function(){this.setParametersPromises=[];let s=arguments[1]&&arguments[1].sendEncodings;s===void 0&&(s=[]),s=[...s];const a=s.length>0;a&&s.forEach(d=>{if("rid"in d&&!/^[a-z0-9]{0,16}$/i.test(d.rid))throw new TypeError("Invalid RID value provided.");if("scaleResolutionDownBy"in d&&!(parseFloat(d.scaleResolutionDownBy)>=1))throw new RangeError("scale_resolution_down_by must be >= 1.0");if("maxFramerate"in d&&!(parseFloat(d.maxFramerate)>=0))throw new RangeError("max_framerate must be >= 0.0")});const c=r.apply(this,arguments);if(a){const{sender:d}=c,h=d.getParameters();(!("encodings"in h)||h.encodings.length===1&&Object.keys(h.encodings[0]).length===0)&&(h.encodings=s,d.sendEncodings=s,this.setParametersPromises.push(d.setParameters(h).then(()=>{delete d.sendEncodings}).catch(()=>{delete d.sendEncodings})))}return c})}function s6(t){if(typeof t!="object"||!t.RTCRtpSender)return;const r=t.RTCRtpSender.prototype.getParameters;r&&(t.RTCRtpSender.prototype.getParameters=function(){const s=r.apply(this,arguments);return"encodings"in s||(s.encodings=[].concat(this.sendEncodings||[{}])),s})}function o6(t){if(typeof t!="object"||!t.RTCPeerConnection)return;const r=t.RTCPeerConnection.prototype.createOffer;t.RTCPeerConnection.prototype.createOffer=function(){return this.setParametersPromises&&this.setParametersPromises.length?pt.all(this.setParametersPromises).then(()=>r.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):r.apply(this,arguments)}}function a6(t){if(typeof t!="object"||!t.RTCPeerConnection)return;const r=t.RTCPeerConnection.prototype.createAnswer;t.RTCPeerConnection.prototype.createAnswer=function(){return this.setParametersPromises&&this.setParametersPromises.length?pt.all(this.setParametersPromises).then(()=>r.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):r.apply(this,arguments)}}var c6=Object.freeze({__proto__:null,shimAddTransceiver:i6,shimCreateAnswer:a6,shimCreateOffer:o6,shimGetDisplayMedia:function(t,r){t.navigator.mediaDevices&&"getDisplayMedia"in t.navigator.mediaDevices||t.navigator.mediaDevices&&(t.navigator.mediaDevices.getDisplayMedia=function(s){if(!s||!s.video){const a=new DOMException("getDisplayMedia without video constraints is undefined");return a.name="NotFoundError",a.code=8,pt.reject(a)}return s.video===!0?s.video={mediaSource:r}:s.video.mediaSource=r,t.navigator.mediaDevices.getUserMedia(s)})},shimGetParameters:s6,shimGetUserMedia:QB,shimOnTrack:ZB,shimPeerConnection:Mx,shimRTCDataChannel:r6,shimReceiverGetStats:t6,shimRemoveStream:n6,shimSenderGetStats:e6});function l6(t){if(typeof t=="object"&&t.RTCPeerConnection){if("getLocalStreams"in t.RTCPeerConnection.prototype||(t.RTCPeerConnection.prototype.getLocalStreams=function(){return this._localStreams||(this._localStreams=[]),this._localStreams}),!("addStream"in t.RTCPeerConnection.prototype)){const r=t.RTCPeerConnection.prototype.addTrack;t.RTCPeerConnection.prototype.addStream=function(s){var a;this._localStreams||(this._localStreams=[]),rt(a=this._localStreams).call(a,s)||this._localStreams.push(s),s.getAudioTracks().forEach(c=>r.call(this,c,s)),s.getVideoTracks().forEach(c=>r.call(this,c,s))},t.RTCPeerConnection.prototype.addTrack=function(s){for(var a=arguments.length,c=new Array(a>1?a-1:0),d=1;d<a;d++)c[d-1]=arguments[d];return c&&c.forEach(h=>{var m;this._localStreams?rt(m=this._localStreams).call(m,h)||this._localStreams.push(h):this._localStreams=[h]}),r.apply(this,arguments)}}"removeStream"in t.RTCPeerConnection.prototype||(t.RTCPeerConnection.prototype.removeStream=function(r){this._localStreams||(this._localStreams=[]);const s=this._localStreams.indexOf(r);if(s===-1)return;this._localStreams.splice(s,1);const a=r.getTracks();this.getSenders().forEach(c=>{rt(a).call(a,c.track)&&this.removeTrack(c)})})}}function u6(t){if(typeof t=="object"&&t.RTCPeerConnection&&("getRemoteStreams"in t.RTCPeerConnection.prototype||(t.RTCPeerConnection.prototype.getRemoteStreams=function(){return this._remoteStreams?this._remoteStreams:[]}),!("onaddstream"in t.RTCPeerConnection.prototype))){Object.defineProperty(t.RTCPeerConnection.prototype,"onaddstream",{get(){return this._onaddstream},set(s){this._onaddstream&&(this.removeEventListener("addstream",this._onaddstream),this.removeEventListener("track",this._onaddstreampoly)),this.addEventListener("addstream",this._onaddstream=s),this.addEventListener("track",this._onaddstreampoly=a=>{a.streams.forEach(c=>{var d;if(this._remoteStreams||(this._remoteStreams=[]),rt(d=this._remoteStreams).call(d,c))return;this._remoteStreams.push(c);const h=new Event("addstream");h.stream=c,this.dispatchEvent(h)})})}});const r=t.RTCPeerConnection.prototype.setRemoteDescription;t.RTCPeerConnection.prototype.setRemoteDescription=function(){const s=this;return this._onaddstreampoly||this.addEventListener("track",this._onaddstreampoly=function(a){a.streams.forEach(c=>{if(s._remoteStreams||(s._remoteStreams=[]),s._remoteStreams.indexOf(c)>=0)return;s._remoteStreams.push(c);const d=new Event("addstream");d.stream=c,s.dispatchEvent(d)})}),r.apply(s,arguments)}}}function d6(t){if(typeof t!="object"||!t.RTCPeerConnection)return;const r=t.RTCPeerConnection.prototype,s=r.createOffer,a=r.createAnswer,c=r.setLocalDescription,d=r.setRemoteDescription,h=r.addIceCandidate;r.createOffer=function(g,E){const b=arguments.length>=2?arguments[2]:arguments[0],I=s.apply(this,[b]);return E?(I.then(g,E),pt.resolve()):I},r.createAnswer=function(g,E){const b=arguments.length>=2?arguments[2]:arguments[0],I=a.apply(this,[b]);return E?(I.then(g,E),pt.resolve()):I};let m=function(g,E,b){const I=c.apply(this,[g]);return b?(I.then(E,b),pt.resolve()):I};r.setLocalDescription=m,m=function(g,E,b){const I=d.apply(this,[g]);return b?(I.then(E,b),pt.resolve()):I},r.setRemoteDescription=m,m=function(g,E,b){const I=h.apply(this,[g]);return b?(I.then(E,b),pt.resolve()):I},r.addIceCandidate=m}function h6(t){const r=t&&t.navigator;if(r.mediaDevices&&r.mediaDevices.getUserMedia){const s=r.mediaDevices,a=s.getUserMedia.bind(s);r.mediaDevices.getUserMedia=c=>a(p6(c))}!r.getUserMedia&&r.mediaDevices&&r.mediaDevices.getUserMedia&&(r.getUserMedia=(function(s,a,c){r.mediaDevices.getUserMedia(s).then(a,c)}).bind(r))}function p6(t){return t&&t.video!==void 0?Object.assign({},t,{video:FB(t.video)}):t}function f6(t){if(!t.RTCPeerConnection)return;const r=t.RTCPeerConnection;t.RTCPeerConnection=function(s,a){if(s&&s.iceServers){const c=[];for(let d=0;d<s.iceServers.length;d++){let h=s.iceServers[d];!h.hasOwnProperty("urls")&&h.hasOwnProperty("url")?(Dx("RTCIceServer.url","RTCIceServer.urls"),h=JSON.parse(JSON.stringify(h)),h.urls=h.url,delete h.url,c.push(h)):c.push(s.iceServers[d])}s.iceServers=c}return new r(s,a)},t.RTCPeerConnection.prototype=r.prototype,"generateCertificate"in r&&Object.defineProperty(t.RTCPeerConnection,"generateCertificate",{get:()=>r.generateCertificate})}function m6(t){typeof t=="object"&&t.RTCTrackEvent&&"receiver"in t.RTCTrackEvent.prototype&&!("transceiver"in t.RTCTrackEvent.prototype)&&Object.defineProperty(t.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function g6(t){const r=t.RTCPeerConnection.prototype.createOffer;t.RTCPeerConnection.prototype.createOffer=function(s){if(s){s.offerToReceiveAudio!==void 0&&(s.offerToReceiveAudio=!!s.offerToReceiveAudio);const a=this.getTransceivers().find(d=>d.receiver.track.kind==="audio");s.offerToReceiveAudio===!1&&a?a.direction==="sendrecv"?a.setDirection?a.setDirection("sendonly"):a.direction="sendonly":a.direction==="recvonly"&&(a.setDirection?a.setDirection("inactive"):a.direction="inactive"):s.offerToReceiveAudio!==!0||a||this.addTransceiver("audio",{direction:"recvonly"}),s.offerToReceiveVideo!==void 0&&(s.offerToReceiveVideo=!!s.offerToReceiveVideo);const c=this.getTransceivers().find(d=>d.receiver.track.kind==="video");s.offerToReceiveVideo===!1&&c?c.direction==="sendrecv"?c.setDirection?c.setDirection("sendonly"):c.direction="sendonly":c.direction==="recvonly"&&(c.setDirection?c.setDirection("inactive"):c.direction="inactive"):s.offerToReceiveVideo!==!0||c||this.addTransceiver("video",{direction:"recvonly"})}return r.apply(this,arguments)}}function _6(t){typeof t!="object"||t.AudioContext||(t.AudioContext=t.webkitAudioContext)}var y6=Object.freeze({__proto__:null,shimAudioContext:_6,shimCallbacksAPI:d6,shimConstraints:p6,shimCreateOfferLegacy:g6,shimGetUserMedia:h6,shimLocalStreamsAPI:l6,shimRTCIceServerUrls:f6,shimRemoteStreamsAPI:u6,shimTrackEventTransceiver:m6}),E6=`	
\v\f\r \u2028\u2029\uFEFF`,Hde=Ct,$de=za,Ux=E6,v6=R("".replace),Kde=RegExp("^["+Ux+"]+"),qde=RegExp("(^|[^"+Ux+"])["+Ux+"]+$"),Yde=function(t){return function(r){var s=$de(Hde(r));return 1&t&&(s=v6(s,Kde,"")),2&t&&(s=v6(s,qde,"$1")),s}},Xde={trim:Yde(3)},Jde=JE.PROPER,Qde=u,S6=E6,Zde=Xde.trim;Gn({target:"String",proto:!0,forced:function(t){return Qde(function(){return!!S6[t]()||""[t]()!==""||Jde&&S6[t].name!==t})}("trim")},{trim:function(){return Zde(this)}});var ehe=mc("String","trim"),the=N,nhe=ehe,Vx=String.prototype,rhe=function(t){var r=t.trim;return typeof t=="string"||t===Vx||the(Vx,t)&&r===Vx.trim?nhe:r},Ao=l(rhe),b6={exports:{}};(function(t){const r={generateIdentifier:function(){return Math.random().toString(36).substring(2,12)}};r.localCName=r.generateIdentifier(),r.splitLines=function(s){return s.trim().split(`
`).map(a=>a.trim())},r.splitSections=function(s){return s.split(`
m=`).map((a,c)=>(c>0?"m="+a:a).trim()+`\r
`)},r.getDescription=function(s){const a=r.splitSections(s);return a&&a[0]},r.getMediaSections=function(s){const a=r.splitSections(s);return a.shift(),a},r.matchPrefix=function(s,a){return r.splitLines(s).filter(c=>c.indexOf(a)===0)},r.parseCandidate=function(s){let a;a=s.indexOf("a=candidate:")===0?s.substring(12).split(" "):s.substring(10).split(" ");const c={foundation:a[0],component:{1:"rtp",2:"rtcp"}[a[1]]||a[1],protocol:a[2].toLowerCase(),priority:parseInt(a[3],10),ip:a[4],address:a[4],port:parseInt(a[5],10),type:a[7]};for(let d=8;d<a.length;d+=2)switch(a[d]){case"raddr":c.relatedAddress=a[d+1];break;case"rport":c.relatedPort=parseInt(a[d+1],10);break;case"tcptype":c.tcpType=a[d+1];break;case"ufrag":c.ufrag=a[d+1],c.usernameFragment=a[d+1];break;default:c[a[d]]===void 0&&(c[a[d]]=a[d+1])}return c},r.writeCandidate=function(s){const a=[];a.push(s.foundation);const c=s.component;c==="rtp"?a.push(1):c==="rtcp"?a.push(2):a.push(c),a.push(s.protocol.toUpperCase()),a.push(s.priority),a.push(s.address||s.ip),a.push(s.port);const d=s.type;return a.push("typ"),a.push(d),d!=="host"&&s.relatedAddress&&s.relatedPort&&(a.push("raddr"),a.push(s.relatedAddress),a.push("rport"),a.push(s.relatedPort)),s.tcpType&&s.protocol.toLowerCase()==="tcp"&&(a.push("tcptype"),a.push(s.tcpType)),(s.usernameFragment||s.ufrag)&&(a.push("ufrag"),a.push(s.usernameFragment||s.ufrag)),"candidate:"+a.join(" ")},r.parseIceOptions=function(s){return s.substring(14).split(" ")},r.parseRtpMap=function(s){let a=s.substring(9).split(" ");const c={payloadType:parseInt(a.shift(),10)};return a=a[0].split("/"),c.name=a[0],c.clockRate=parseInt(a[1],10),c.channels=a.length===3?parseInt(a[2],10):1,c.numChannels=c.channels,c},r.writeRtpMap=function(s){let a=s.payloadType;s.preferredPayloadType!==void 0&&(a=s.preferredPayloadType);const c=s.channels||s.numChannels||1;return"a=rtpmap:"+a+" "+s.name+"/"+s.clockRate+(c!==1?"/"+c:"")+`\r
`},r.parseExtmap=function(s){const a=s.substring(9).split(" ");return{id:parseInt(a[0],10),direction:a[0].indexOf("/")>0?a[0].split("/")[1]:"sendrecv",uri:a[1],attributes:a.slice(2).join(" ")}},r.writeExtmap=function(s){return"a=extmap:"+(s.id||s.preferredId)+(s.direction&&s.direction!=="sendrecv"?"/"+s.direction:"")+" "+s.uri+(s.attributes?" "+s.attributes:"")+`\r
`},r.parseFmtp=function(s){const a={};let c;const d=s.substring(s.indexOf(" ")+1).split(";");for(let h=0;h<d.length;h++)c=d[h].trim().split("="),a[c[0].trim()]=c[1];return a},r.writeFmtp=function(s){let a="",c=s.payloadType;if(s.preferredPayloadType!==void 0&&(c=s.preferredPayloadType),s.parameters&&Object.keys(s.parameters).length){const d=[];Object.keys(s.parameters).forEach(h=>{s.parameters[h]!==void 0?d.push(h+"="+s.parameters[h]):d.push(h)}),a+="a=fmtp:"+c+" "+d.join(";")+`\r
`}return a},r.parseRtcpFb=function(s){const a=s.substring(s.indexOf(" ")+1).split(" ");return{type:a.shift(),parameter:a.join(" ")}},r.writeRtcpFb=function(s){let a="",c=s.payloadType;return s.preferredPayloadType!==void 0&&(c=s.preferredPayloadType),s.rtcpFeedback&&s.rtcpFeedback.length&&s.rtcpFeedback.forEach(d=>{a+="a=rtcp-fb:"+c+" "+d.type+(d.parameter&&d.parameter.length?" "+d.parameter:"")+`\r
`}),a},r.parseSsrcMedia=function(s){const a=s.indexOf(" "),c={ssrc:parseInt(s.substring(7,a),10)},d=s.indexOf(":",a);return d>-1?(c.attribute=s.substring(a+1,d),c.value=s.substring(d+1)):c.attribute=s.substring(a+1),c},r.parseSsrcGroup=function(s){const a=s.substring(13).split(" ");return{semantics:a.shift(),ssrcs:a.map(c=>parseInt(c,10))}},r.getMid=function(s){const a=r.matchPrefix(s,"a=mid:")[0];if(a)return a.substring(6)},r.parseFingerprint=function(s){const a=s.substring(14).split(" ");return{algorithm:a[0].toLowerCase(),value:a[1].toUpperCase()}},r.getDtlsParameters=function(s,a){return{role:"auto",fingerprints:r.matchPrefix(s+a,"a=fingerprint:").map(r.parseFingerprint)}},r.writeDtlsParameters=function(s,a){let c="a=setup:"+a+`\r
`;return s.fingerprints.forEach(d=>{c+="a=fingerprint:"+d.algorithm+" "+d.value+`\r
`}),c},r.parseCryptoLine=function(s){const a=s.substring(9).split(" ");return{tag:parseInt(a[0],10),cryptoSuite:a[1],keyParams:a[2],sessionParams:a.slice(3)}},r.writeCryptoLine=function(s){return"a=crypto:"+s.tag+" "+s.cryptoSuite+" "+(typeof s.keyParams=="object"?r.writeCryptoKeyParams(s.keyParams):s.keyParams)+(s.sessionParams?" "+s.sessionParams.join(" "):"")+`\r
`},r.parseCryptoKeyParams=function(s){if(s.indexOf("inline:")!==0)return null;const a=s.substring(7).split("|");return{keyMethod:"inline",keySalt:a[0],lifeTime:a[1],mkiValue:a[2]?a[2].split(":")[0]:void 0,mkiLength:a[2]?a[2].split(":")[1]:void 0}},r.writeCryptoKeyParams=function(s){return s.keyMethod+":"+s.keySalt+(s.lifeTime?"|"+s.lifeTime:"")+(s.mkiValue&&s.mkiLength?"|"+s.mkiValue+":"+s.mkiLength:"")},r.getCryptoParameters=function(s,a){return r.matchPrefix(s+a,"a=crypto:").map(r.parseCryptoLine)},r.getIceParameters=function(s,a){const c=r.matchPrefix(s+a,"a=ice-ufrag:")[0],d=r.matchPrefix(s+a,"a=ice-pwd:")[0];return c&&d?{usernameFragment:c.substring(12),password:d.substring(10)}:null},r.writeIceParameters=function(s){let a="a=ice-ufrag:"+s.usernameFragment+`\r
a=ice-pwd:`+s.password+`\r
`;return s.iceLite&&(a+=`a=ice-lite\r
`),a},r.parseRtpParameters=function(s){const a={codecs:[],headerExtensions:[],fecMechanisms:[],rtcp:[]},c=r.splitLines(s)[0].split(" ");a.profile=c[2];for(let h=3;h<c.length;h++){const m=c[h],g=r.matchPrefix(s,"a=rtpmap:"+m+" ")[0];if(g){const E=r.parseRtpMap(g),b=r.matchPrefix(s,"a=fmtp:"+m+" ");switch(E.parameters=b.length?r.parseFmtp(b[0]):{},E.rtcpFeedback=r.matchPrefix(s,"a=rtcp-fb:"+m+" ").map(r.parseRtcpFb),a.codecs.push(E),E.name.toUpperCase()){case"RED":case"ULPFEC":a.fecMechanisms.push(E.name.toUpperCase())}}}r.matchPrefix(s,"a=extmap:").forEach(h=>{a.headerExtensions.push(r.parseExtmap(h))});const d=r.matchPrefix(s,"a=rtcp-fb:* ").map(r.parseRtcpFb);return a.codecs.forEach(h=>{d.forEach(m=>{h.rtcpFeedback.find(g=>g.type===m.type&&g.parameter===m.parameter)||h.rtcpFeedback.push(m)})}),a},r.writeRtpDescription=function(s,a){let c="";c+="m="+s+" ",c+=a.codecs.length>0?"9":"0",c+=" "+(a.profile||"UDP/TLS/RTP/SAVPF")+" ",c+=a.codecs.map(h=>h.preferredPayloadType!==void 0?h.preferredPayloadType:h.payloadType).join(" ")+`\r
`,c+=`c=IN IP4 0.0.0.0\r
`,c+=`a=rtcp:9 IN IP4 0.0.0.0\r
`,a.codecs.forEach(h=>{c+=r.writeRtpMap(h),c+=r.writeFmtp(h),c+=r.writeRtcpFb(h)});let d=0;return a.codecs.forEach(h=>{h.maxptime>d&&(d=h.maxptime)}),d>0&&(c+="a=maxptime:"+d+`\r
`),a.headerExtensions&&a.headerExtensions.forEach(h=>{c+=r.writeExtmap(h)}),c},r.parseRtpEncodingParameters=function(s){const a=[],c=r.parseRtpParameters(s),d=c.fecMechanisms.indexOf("RED")!==-1,h=c.fecMechanisms.indexOf("ULPFEC")!==-1,m=r.matchPrefix(s,"a=ssrc:").map(A=>r.parseSsrcMedia(A)).filter(A=>A.attribute==="cname"),g=m.length>0&&m[0].ssrc;let E;const b=r.matchPrefix(s,"a=ssrc-group:FID").map(A=>A.substring(17).split(" ").map(k=>parseInt(k,10)));b.length>0&&b[0].length>1&&b[0][0]===g&&(E=b[0][1]),c.codecs.forEach(A=>{if(A.name.toUpperCase()==="RTX"&&A.parameters.apt){let k={ssrc:g,codecPayloadType:parseInt(A.parameters.apt,10)};g&&E&&(k.rtx={ssrc:E}),a.push(k),d&&(k=JSON.parse(JSON.stringify(k)),k.fec={ssrc:g,mechanism:h?"red+ulpfec":"red"},a.push(k))}}),a.length===0&&g&&a.push({ssrc:g});let I=r.matchPrefix(s,"b=");return I.length&&(I=I[0].indexOf("b=TIAS:")===0?parseInt(I[0].substring(7),10):I[0].indexOf("b=AS:")===0?1e3*parseInt(I[0].substring(5),10)*.95-16e3:void 0,a.forEach(A=>{A.maxBitrate=I})),a},r.parseRtcpParameters=function(s){const a={},c=r.matchPrefix(s,"a=ssrc:").map(m=>r.parseSsrcMedia(m)).filter(m=>m.attribute==="cname")[0];c&&(a.cname=c.value,a.ssrc=c.ssrc);const d=r.matchPrefix(s,"a=rtcp-rsize");a.reducedSize=d.length>0,a.compound=d.length===0;const h=r.matchPrefix(s,"a=rtcp-mux");return a.mux=h.length>0,a},r.writeRtcpParameters=function(s){let a="";return s.reducedSize&&(a+=`a=rtcp-rsize\r
`),s.mux&&(a+=`a=rtcp-mux\r
`),s.ssrc!==void 0&&s.cname&&(a+="a=ssrc:"+s.ssrc+" cname:"+s.cname+`\r
`),a},r.parseMsid=function(s){let a;const c=r.matchPrefix(s,"a=msid:");if(c.length===1)return a=c[0].substring(7).split(" "),{stream:a[0],track:a[1]};const d=r.matchPrefix(s,"a=ssrc:").map(h=>r.parseSsrcMedia(h)).filter(h=>h.attribute==="msid");return d.length>0?(a=d[0].value.split(" "),{stream:a[0],track:a[1]}):void 0},r.parseSctpDescription=function(s){const a=r.parseMLine(s),c=r.matchPrefix(s,"a=max-message-size:");let d;c.length>0&&(d=parseInt(c[0].substring(19),10)),isNaN(d)&&(d=65536);const h=r.matchPrefix(s,"a=sctp-port:");if(h.length>0)return{port:parseInt(h[0].substring(12),10),protocol:a.fmt,maxMessageSize:d};const m=r.matchPrefix(s,"a=sctpmap:");if(m.length>0){const g=m[0].substring(10).split(" ");return{port:parseInt(g[0],10),protocol:g[1],maxMessageSize:d}}},r.writeSctpDescription=function(s,a){let c=[];return c=s.protocol!=="DTLS/SCTP"?["m="+s.kind+" 9 "+s.protocol+" "+a.protocol+`\r
`,`c=IN IP4 0.0.0.0\r
`,"a=sctp-port:"+a.port+`\r
`]:["m="+s.kind+" 9 "+s.protocol+" "+a.port+`\r
`,`c=IN IP4 0.0.0.0\r
`,"a=sctpmap:"+a.port+" "+a.protocol+` 65535\r
`],a.maxMessageSize!==void 0&&c.push("a=max-message-size:"+a.maxMessageSize+`\r
`),c.join("")},r.generateSessionId=function(){return Math.random().toString().substr(2,22)},r.writeSessionBoilerplate=function(s,a,c){let d;const h=a!==void 0?a:2;return d=s||r.generateSessionId(),`v=0\r
o=`+(c||"thisisadapterortc")+" "+d+" "+h+` IN IP4 127.0.0.1\r
s=-\r
t=0 0\r
`},r.getDirection=function(s,a){const c=r.splitLines(s);for(let d=0;d<c.length;d++)switch(c[d]){case"a=sendrecv":case"a=sendonly":case"a=recvonly":case"a=inactive":return c[d].substring(2)}return a?r.getDirection(a):"sendrecv"},r.getKind=function(s){return r.splitLines(s)[0].split(" ")[0].substring(2)},r.isRejected=function(s){return s.split(" ",2)[1]==="0"},r.parseMLine=function(s){const a=r.splitLines(s)[0].substring(2).split(" ");return{kind:a[0],port:parseInt(a[1],10),protocol:a[2],fmt:a.slice(3).join(" ")}},r.parseOLine=function(s){const a=r.matchPrefix(s,"o=")[0].substring(2).split(" ");return{username:a[0],sessionId:a[1],sessionVersion:parseInt(a[2],10),netType:a[3],addressType:a[4],address:a[5]}},r.isValidSDP=function(s){if(typeof s!="string"||s.length===0)return!1;const a=r.splitLines(s);for(let c=0;c<a.length;c++)if(a[c].length<2||a[c].charAt(1)!=="=")return!1;return!0},t.exports=r})(b6);var w6=b6.exports,kv=l(w6),ihe=i({__proto__:null,default:kv},[w6]);function PA(t){if(!t.RTCIceCandidate||t.RTCIceCandidate&&"foundation"in t.RTCIceCandidate.prototype)return;const r=t.RTCIceCandidate;t.RTCIceCandidate=function(s){if(typeof s=="object"&&s.candidate&&s.candidate.indexOf("a=")===0&&((s=JSON.parse(JSON.stringify(s))).candidate=s.candidate.substr(2)),s.candidate&&s.candidate.length){const a=new r(s),c=kv.parseCandidate(s.candidate),d=Object.assign(a,c);return d.toJSON=function(){return{candidate:d.candidate,sdpMid:d.sdpMid,sdpMLineIndex:d.sdpMLineIndex,usernameFragment:d.usernameFragment}},d}return new r(s)},t.RTCIceCandidate.prototype=r.prototype,q_(t,"icecandidate",s=>(s.candidate&&Object.defineProperty(s,"candidate",{value:new t.RTCIceCandidate(s.candidate),writable:"false"}),s))}function Fx(t){!t.RTCIceCandidate||t.RTCIceCandidate&&"relayProtocol"in t.RTCIceCandidate.prototype||q_(t,"icecandidate",r=>{if(r.candidate){const s=kv.parseCandidate(r.candidate.candidate);s.type==="relay"&&(r.candidate.relayProtocol={0:"tls",1:"tcp",2:"udp"}[s.priority>>24])}return r})}function kA(t,r){if(!t.RTCPeerConnection)return;"sctp"in t.RTCPeerConnection.prototype||Object.defineProperty(t.RTCPeerConnection.prototype,"sctp",{get(){return this._sctp===void 0?null:this._sctp}});const s=function(m){if(!m||!m.sdp)return!1;const g=kv.splitSections(m.sdp);return g.shift(),g.some(E=>{const b=kv.parseMLine(E);return b&&b.kind==="application"&&b.protocol.indexOf("SCTP")!==-1})},a=function(m){const g=m.sdp.match(/mozilla...THIS_IS_SDPARTA-(\d+)/);if(g===null||g.length<2)return-1;const E=parseInt(g[1],10);return E!=E?-1:E},c=function(m){let g=65536;return r.browser==="firefox"&&(g=r.version<57?m===-1?16384:2147483637:r.version<60?r.version===57?65535:65536:2147483637),g},d=function(m,g){let E=65536;r.browser==="firefox"&&r.version===57&&(E=65535);const b=kv.matchPrefix(m.sdp,"a=max-message-size:");return b.length>0?E=parseInt(b[0].substr(19),10):r.browser==="firefox"&&g!==-1&&(E=2147483637),E},h=t.RTCPeerConnection.prototype.setRemoteDescription;t.RTCPeerConnection.prototype.setRemoteDescription=function(){if(this._sctp=null,r.browser==="chrome"&&r.version>=76){const{sdpSemantics:m}=this.getConfiguration();m==="plan-b"&&Object.defineProperty(this,"sctp",{get(){return this._sctp===void 0?null:this._sctp},enumerable:!0,configurable:!0})}if(s(arguments[0])){const m=a(arguments[0]),g=c(m),E=d(arguments[0],m);let b;b=g===0&&E===0?Number.POSITIVE_INFINITY:g===0||E===0?Math.max(g,E):Math.min(g,E);const I={};Object.defineProperty(I,"maxMessageSize",{get:()=>b}),this._sctp=I}return h.apply(this,arguments)}}function OA(t){if(!t.RTCPeerConnection||!("createDataChannel"in t.RTCPeerConnection.prototype))return;function r(a,c){const d=a.send;a.send=function(){const h=arguments[0],m=h.length||h.size||h.byteLength;if(a.readyState==="open"&&c.sctp&&m>c.sctp.maxMessageSize)throw new TypeError("Message too large (can send a maximum of "+c.sctp.maxMessageSize+" bytes)");return d.apply(a,arguments)}}const s=t.RTCPeerConnection.prototype.createDataChannel;t.RTCPeerConnection.prototype.createDataChannel=function(){const a=s.apply(this,arguments);return r(a,this),a},q_(t,"datachannel",a=>(r(a.channel,a.target),a))}function jx(t){if(!t.RTCPeerConnection||"connectionState"in t.RTCPeerConnection.prototype)return;const r=t.RTCPeerConnection.prototype;Object.defineProperty(r,"connectionState",{get(){return{completed:"connected",checking:"connecting"}[this.iceConnectionState]||this.iceConnectionState},enumerable:!0,configurable:!0}),Object.defineProperty(r,"onconnectionstatechange",{get(){return this._onconnectionstatechange||null},set(s){this._onconnectionstatechange&&(this.removeEventListener("connectionstatechange",this._onconnectionstatechange),delete this._onconnectionstatechange),s&&this.addEventListener("connectionstatechange",this._onconnectionstatechange=s)},enumerable:!0,configurable:!0}),["setLocalDescription","setRemoteDescription"].forEach(s=>{const a=r[s];r[s]=function(){return this._connectionstatechangepoly||(this._connectionstatechangepoly=c=>{const d=c.target;if(d._lastConnectionState!==d.connectionState){d._lastConnectionState=d.connectionState;const h=new Event("connectionstatechange",c);d.dispatchEvent(h)}return c},this.addEventListener("iceconnectionstatechange",this._connectionstatechangepoly)),a.apply(this,arguments)}})}function Bx(t,r){if(!t.RTCPeerConnection||r.browser==="chrome"&&r.version>=71||r.browser==="safari"&&r.version>=605)return;const s=t.RTCPeerConnection.prototype.setRemoteDescription;t.RTCPeerConnection.prototype.setRemoteDescription=function(a){if(a&&a.sdp&&a.sdp.indexOf(`
a=extmap-allow-mixed`)!==-1){const c=a.sdp.split(`
`).filter(d=>Ao(d).call(d)!=="a=extmap-allow-mixed").join(`
`);t.RTCSessionDescription&&a instanceof t.RTCSessionDescription?arguments[0]=new t.RTCSessionDescription({type:a.type,sdp:c}):a.sdp=c}return s.apply(this,arguments)}}function NA(t,r){if(!t.RTCPeerConnection||!t.RTCPeerConnection.prototype)return;const s=t.RTCPeerConnection.prototype.addIceCandidate;s&&s.length!==0&&(t.RTCPeerConnection.prototype.addIceCandidate=function(){return arguments[0]?(r.browser==="chrome"&&r.version<78||r.browser==="firefox"&&r.version<68||r.browser==="safari")&&arguments[0]&&arguments[0].candidate===""?pt.resolve():s.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),pt.resolve())})}function DA(t,r){if(!t.RTCPeerConnection||!t.RTCPeerConnection.prototype)return;const s=t.RTCPeerConnection.prototype.setLocalDescription;s&&s.length!==0&&(t.RTCPeerConnection.prototype.setLocalDescription=function(){let a=arguments[0]||{};if(typeof a!="object"||a.type&&a.sdp)return s.apply(this,arguments);if(a={type:a.type,sdp:a.sdp},!a.type)switch(this.signalingState){case"stable":case"have-local-offer":case"have-remote-pranswer":a.type="offer";break;default:a.type="answer"}return a.sdp||a.type!=="offer"&&a.type!=="answer"?s.apply(this,[a]):(a.type==="offer"?this.createOffer:this.createAnswer).apply(this).then(c=>s.apply(this,[c]))})}var she=Object.freeze({__proto__:null,removeExtmapAllowMixed:Bx,shimAddIceCandidateNullOrEmpty:NA,shimConnectionState:jx,shimMaxMessageSize:kA,shimParameterlessSetLocalDescription:DA,shimRTCIceCandidate:PA,shimRTCIceCandidateRelayProtocol:Fx,shimSendThrowTypeError:OA});(function(){let{window:t}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{shimChrome:!0,shimFirefox:!0,shimSafari:!0};const s=UB,a=function(d){const h={browser:null,version:null};if(d===void 0||!d.navigator)return h.browser="Not a browser.",h;const{navigator:m}=d;if(m.mozGetUserMedia)h.browser="firefox",h.version=AA(m.userAgent,/Firefox\/(\d+)\./,1);else if(m.webkitGetUserMedia||d.isSecureContext===!1&&d.webkitRTCPeerConnection)h.browser="chrome",h.version=AA(m.userAgent,/Chrom(e|ium)\/(\d+)\./,2);else{if(!d.RTCPeerConnection||!m.userAgent.match(/AppleWebKit\/(\d+)\./))return h.browser="Not a supported browser.",h;h.browser="safari",h.version=AA(m.userAgent,/AppleWebKit\/(\d+)\./,1),h.supportsUnifiedPlan=d.RTCRtpTransceiver&&"currentDirection"in d.RTCRtpTransceiver.prototype}return h}(t),c={browserDetails:a,commonShim:she,extractVersion:AA,disableLog:Wde,disableWarnings:Gde,sdp:ihe};switch(a.browser){case"chrome":if(!JB||!Lx||!r.shimChrome)return s("Chrome shim is not included in this adapter release."),c;if(a.version===null)return s("Chrome shim can not determine version, not shimming."),c;s("adapter.js shimming chrome."),c.browserShim=JB,NA(t,a),DA(t),zB(t,a),WB(t),Lx(t,a),GB(t),YB(t,a),HB(t),$B(t),KB(t),XB(t,a),PA(t),Fx(t),jx(t),kA(t,a),OA(t),Bx(t,a);break;case"firefox":if(!c6||!Mx||!r.shimFirefox)return s("Firefox shim is not included in this adapter release."),c;s("adapter.js shimming firefox."),c.browserShim=c6,NA(t,a),DA(t),QB(t,a),Mx(t,a),ZB(t),n6(t),e6(t),t6(t),r6(t),i6(t),s6(t),o6(t),a6(t),PA(t),jx(t),kA(t,a),OA(t);break;case"safari":if(!y6||!r.shimSafari)return s("Safari shim is not included in this adapter release."),c;s("adapter.js shimming safari."),c.browserShim=y6,NA(t,a),DA(t),f6(t),g6(t),d6(t),l6(t),u6(t),m6(t),h6(t),_6(t),PA(t),Fx(t),kA(t,a),OA(t),Bx(t,a);break;default:s("Unsupported browser!")}})({window:typeof window>"u"?void 0:window});var zx=L;Gn({global:!0,forced:zx.globalThis!==zx},{globalThis:zx});var T6=l(L),Wx={exports:{}};(function(t,r){(function(s,a){var c="function",d="undefined",h="object",m="string",g="major",E="model",b="name",I="type",A="vendor",k="version",W="architecture",j="console",B="mobile",ee="tablet",Z="smarttv",oe="wearable",ye="embedded",_e="Amazon",ue="Apple",Ce="ASUS",Ue="BlackBerry",ze="Browser",Je="Chrome",hn="Firefox",vn="Google",Xt="Huawei",nr="LG",Kn="Microsoft",eo="Motorola",Be="Opera",st="Samsung",bt="Sharp",He="Sony",V="Xiaomi",le="Zebra",ge="Facebook",tt="Chromium OS",rn="Mac OS",Rr=" Browser",Gi=function(Vi){for(var Hi={},Lr=0;Lr<Vi.length;Lr++)Hi[Vi[Lr].toUpperCase()]=Vi[Lr];return Hi},Xl=function(Vi,Hi){return typeof Vi===m&&Ku(Hi).indexOf(Ku(Vi))!==-1},Ku=function(Vi){return Vi.toLowerCase()},VT=function(Vi,Hi){if(typeof Vi===m)return Vi=Vi.replace(/^\s\s*/,""),typeof Hi===d?Vi:Vi.substring(0,500)},by=function(Vi,Hi){for(var Lr,ec,Qd,vi,vf,Mn,Zd=0;Zd<Hi.length&&!vf;){var wy=Hi[Zd],ip=Hi[Zd+1];for(Lr=ec=0;Lr<wy.length&&!vf&&wy[Lr];)if(vf=wy[Lr++].exec(Vi))for(Qd=0;Qd<ip.length;Qd++)Mn=vf[++ec],typeof(vi=ip[Qd])===h&&vi.length>0?vi.length===2?typeof vi[1]==c?this[vi[0]]=vi[1].call(this,Mn):this[vi[0]]=vi[1]:vi.length===3?typeof vi[1]!==c||vi[1].exec&&vi[1].test?this[vi[0]]=Mn?Mn.replace(vi[1],vi[2]):a:this[vi[0]]=Mn?vi[1].call(this,Mn,vi[2]):a:vi.length===4&&(this[vi[0]]=Mn?vi[3].call(this,Mn.replace(vi[1],vi[2])):a):this[vi]=Mn||a;Zd+=2}},w0=function(Vi,Hi){for(var Lr in Hi)if(typeof Hi[Lr]===h&&Hi[Lr].length>0){for(var ec=0;ec<Hi[Lr].length;ec++)if(Xl(Hi[Lr][ec],Vi))return Lr==="?"?a:Lr}else if(Xl(Hi[Lr],Vi))return Lr==="?"?a:Lr;return Hi.hasOwnProperty("*")?Hi["*"]:Vi},D1={ME:"4.90","NT 3.11":"NT3.51","NT 4.0":"NT4.0",2e3:"NT 5.0",XP:["NT 5.1","NT 5.2"],Vista:"NT 6.0",7:"NT 6.1",8:"NT 6.2",8.1:"NT 6.3",10:["NT 6.4","NT 10.0"],RT:"ARM"},x1={browser:[[/\b(?:crmo|crios)\/([\w\.]+)/i],[k,[b,"Chrome"]],[/edg(?:e|ios|a)?\/([\w\.]+)/i],[k,[b,"Edge"]],[/(opera mini)\/([-\w\.]+)/i,/(opera [mobiletab]{3,6})\b.+version\/([-\w\.]+)/i,/(opera)(?:.+version\/|[\/ ]+)([\w\.]+)/i],[b,k],[/opios[\/ ]+([\w\.]+)/i],[k,[b,Be+" Mini"]],[/\bop(?:rg)?x\/([\w\.]+)/i],[k,[b,Be+" GX"]],[/\bopr\/([\w\.]+)/i],[k,[b,Be]],[/\bb[ai]*d(?:uhd|[ub]*[aekoprswx]{5,6})[\/ ]?([\w\.]+)/i],[k,[b,"Baidu"]],[/\b(?:mxbrowser|mxios|myie2)\/?([-\w\.]*)\b/i],[k,[b,"Maxthon"]],[/(kindle)\/([\w\.]+)/i,/(lunascape|maxthon|netfront|jasmine|blazer|sleipnir)[\/ ]?([\w\.]*)/i,/(avant|iemobile|slim(?:browser|boat|jet))[\/ ]?([\d\.]*)/i,/(?:ms|\()(ie) ([\w\.]+)/i,/(flock|rockmelt|midori|epiphany|silk|skyfire|ovibrowser|bolt|iron|vivaldi|iridium|phantomjs|bowser|qupzilla|falkon|rekonq|puffin|brave|whale(?!.+naver)|qqbrowserlite|duckduckgo|klar|helio|(?=comodo_)?dragon)\/([-\w\.]+)/i,/(heytap|ovi|115)browser\/([\d\.]+)/i,/(weibo)__([\d\.]+)/i],[b,k],[/quark(?:pc)?\/([-\w\.]+)/i],[k,[b,"Quark"]],[/\bddg\/([\w\.]+)/i],[k,[b,"DuckDuckGo"]],[/(?:\buc? ?browser|(?:juc.+)ucweb)[\/ ]?([\w\.]+)/i],[k,[b,"UC"+ze]],[/microm.+\bqbcore\/([\w\.]+)/i,/\bqbcore\/([\w\.]+).+microm/i,/micromessenger\/([\w\.]+)/i],[k,[b,"WeChat"]],[/konqueror\/([\w\.]+)/i],[k,[b,"Konqueror"]],[/trident.+rv[: ]([\w\.]{1,9})\b.+like gecko/i],[k,[b,"IE"]],[/ya(?:search)?browser\/([\w\.]+)/i],[k,[b,"Yandex"]],[/slbrowser\/([\w\.]+)/i],[k,[b,"Smart Lenovo "+ze]],[/(avast|avg)\/([\w\.]+)/i],[[b,/(.+)/,"$1 Secure "+ze],k],[/\bfocus\/([\w\.]+)/i],[k,[b,hn+" Focus"]],[/\bopt\/([\w\.]+)/i],[k,[b,Be+" Touch"]],[/coc_coc\w+\/([\w\.]+)/i],[k,[b,"Coc Coc"]],[/dolfin\/([\w\.]+)/i],[k,[b,"Dolphin"]],[/coast\/([\w\.]+)/i],[k,[b,Be+" Coast"]],[/miuibrowser\/([\w\.]+)/i],[k,[b,"MIUI"+Rr]],[/fxios\/([\w\.-]+)/i],[k,[b,hn]],[/\bqihoobrowser\/?([\w\.]*)/i],[k,[b,"360"]],[/\b(qq)\/([\w\.]+)/i],[[b,/(.+)/,"$1Browser"],k],[/(oculus|sailfish|huawei|vivo|pico)browser\/([\w\.]+)/i],[[b,/(.+)/,"$1"+Rr],k],[/samsungbrowser\/([\w\.]+)/i],[k,[b,st+" Internet"]],[/metasr[\/ ]?([\d\.]+)/i],[k,[b,"Sogou Explorer"]],[/(sogou)mo\w+\/([\d\.]+)/i],[[b,"Sogou Mobile"],k],[/(electron)\/([\w\.]+) safari/i,/(tesla)(?: qtcarbrowser|\/(20\d\d\.[-\w\.]+))/i,/m?(qqbrowser|2345(?=browser|chrome|explorer))\w*[\/ ]?v?([\w\.]+)/i],[b,k],[/(lbbrowser|rekonq)/i,/\[(linkedin)app\]/i],[b],[/ome\/([\w\.]+) \w* ?(iron) saf/i,/ome\/([\w\.]+).+qihu (360)[es]e/i],[k,b],[/((?:fban\/fbios|fb_iab\/fb4a)(?!.+fbav)|;fbav\/([\w\.]+);)/i],[[b,ge],k],[/(Klarna)\/([\w\.]+)/i,/(kakao(?:talk|story))[\/ ]([\w\.]+)/i,/(naver)\(.*?(\d+\.[\w\.]+).*\)/i,/safari (line)\/([\w\.]+)/i,/\b(line)\/([\w\.]+)\/iab/i,/(alipay)client\/([\w\.]+)/i,/(twitter)(?:and| f.+e\/([\w\.]+))/i,/(chromium|instagram|snapchat)[\/ ]([-\w\.]+)/i],[b,k],[/\bgsa\/([\w\.]+) .*safari\//i],[k,[b,"GSA"]],[/musical_ly(?:.+app_?version\/|_)([\w\.]+)/i],[k,[b,"TikTok"]],[/headlesschrome(?:\/([\w\.]+)| )/i],[k,[b,Je+" Headless"]],[/ wv\).+(chrome)\/([\w\.]+)/i],[[b,Je+" WebView"],k],[/droid.+ version\/([\w\.]+)\b.+(?:mobile safari|safari)/i],[k,[b,"Android "+ze]],[/(chrome|omniweb|arora|[tizenoka]{5} ?browser)\/v?([\w\.]+)/i],[b,k],[/version\/([\w\.\,]+) .*mobile\/\w+ (safari)/i],[k,[b,"Mobile Safari"]],[/version\/([\w(\.|\,)]+) .*(mobile ?safari|safari)/i],[k,b],[/webkit.+?(mobile ?safari|safari)(\/[\w\.]+)/i],[b,[k,w0,{"1.0":"/8",1.2:"/1",1.3:"/3","2.0":"/412","2.0.2":"/416","2.0.3":"/417","2.0.4":"/419","?":"/"}]],[/(webkit|khtml)\/([\w\.]+)/i],[b,k],[/(navigator|netscape\d?)\/([-\w\.]+)/i],[[b,"Netscape"],k],[/(wolvic|librewolf)\/([\w\.]+)/i],[b,k],[/mobile vr; rv:([\w\.]+)\).+firefox/i],[k,[b,hn+" Reality"]],[/ekiohf.+(flow)\/([\w\.]+)/i,/(swiftfox)/i,/(icedragon|iceweasel|camino|chimera|fennec|maemo browser|minimo|conkeror)[\/ ]?([\w\.\+]+)/i,/(seamonkey|k-meleon|icecat|iceape|firebird|phoenix|palemoon|basilisk|waterfox)\/([-\w\.]+)$/i,/(firefox)\/([\w\.]+)/i,/(mozilla)\/([\w\.]+) .+rv\:.+gecko\/\d+/i,/(polaris|lynx|dillo|icab|doris|amaya|w3m|netsurf|obigo|mosaic|(?:go|ice|up)[\. ]?browser)[-\/ ]?v?([\w\.]+)/i,/(links) \(([\w\.]+)/i],[b,[k,/_/g,"."]],[/(cobalt)\/([\w\.]+)/i],[b,[k,/master.|lts./,""]]],cpu:[[/(?:(amd|x(?:(?:86|64)[-_])?|wow|win)64)[;\)]/i],[[W,"amd64"]],[/(ia32(?=;))/i],[[W,Ku]],[/((?:i[346]|x)86)[;\)]/i],[[W,"ia32"]],[/\b(aarch64|arm(v?8e?l?|_?64))\b/i],[[W,"arm64"]],[/\b(arm(?:v[67])?ht?n?[fl]p?)\b/i],[[W,"armhf"]],[/windows (ce|mobile); ppc;/i],[[W,"arm"]],[/((?:ppc|powerpc)(?:64)?)(?: mac|;|\))/i],[[W,/ower/,"",Ku]],[/(sun4\w)[;\)]/i],[[W,"sparc"]],[/((?:avr32|ia64(?=;))|68k(?=\))|\barm(?=v(?:[1-7]|[5-7]1)l?|;|eabi)|(?=atmel )avr|(?:irix|mips|sparc)(?:64)?\b|pa-risc)/i],[[W,Ku]]],device:[[/\b(sch-i[89]0\d|shw-m380s|sm-[ptx]\w{2,4}|gt-[pn]\d{2,4}|sgh-t8[56]9|nexus 10)/i],[E,[A,st],[I,ee]],[/\b((?:s[cgp]h|gt|sm)-(?![lr])\w+|sc[g-]?[\d]+a?|galaxy nexus)/i,/samsung[- ]((?!sm-[lr])[-\w]+)/i,/sec-(sgh\w+)/i],[E,[A,st],[I,B]],[/(?:\/|\()(ip(?:hone|od)[\w, ]*)(?:\/|;)/i],[E,[A,ue],[I,B]],[/\((ipad);[-\w\),; ]+apple/i,/applecoremedia\/[\w\.]+ \((ipad)/i,/\b(ipad)\d\d?,\d\d?[;\]].+ios/i],[E,[A,ue],[I,ee]],[/(macintosh);/i],[E,[A,ue]],[/\b(sh-?[altvz]?\d\d[a-ekm]?)/i],[E,[A,bt],[I,B]],[/(?:honor)([-\w ]+)[;\)]/i],[E,[A,"Honor"],[I,B]],[/\b((?:ag[rs][23]?|bah2?|sht?|btv)-a?[lw]\d{2})\b(?!.+d\/s)/i],[E,[A,Xt],[I,ee]],[/(?:huawei)([-\w ]+)[;\)]/i,/\b(nexus 6p|\w{2,4}e?-[atu]?[ln][\dx][012359c][adn]?)\b(?!.+d\/s)/i],[E,[A,Xt],[I,B]],[/\b(poco[\w ]+|m2\d{3}j\d\d[a-z]{2})(?: bui|\))/i,/\b; (\w+) build\/hm\1/i,/\b(hm[-_ ]?note?[_ ]?(?:\d\w)?) bui/i,/\b(redmi[\-_ ]?(?:note|k)?[\w_ ]+)(?: bui|\))/i,/oid[^\)]+; (m?[12][0-389][01]\w{3,6}[c-y])( bui|; wv|\))/i,/\b(mi[-_ ]?(?:a\d|one|one[_ ]plus|note lte|max|cc)?[_ ]?(?:\d?\w?)[_ ]?(?:plus|se|lite|pro)?)(?: bui|\))/i],[[E,/_/g," "],[A,V],[I,B]],[/oid[^\)]+; (2\d{4}(283|rpbf)[cgl])( bui|\))/i,/\b(mi[-_ ]?(?:pad)(?:[\w_ ]+))(?: bui|\))/i],[[E,/_/g," "],[A,V],[I,ee]],[/; (\w+) bui.+ oppo/i,/\b(cph[12]\d{3}|p(?:af|c[al]|d\w|e[ar])[mt]\d0|x9007|a101op)\b/i],[E,[A,"OPPO"],[I,B]],[/\b(opd2\d{3}a?) bui/i],[E,[A,"OPPO"],[I,ee]],[/vivo (\w+)(?: bui|\))/i,/\b(v[12]\d{3}\w?[at])(?: bui|;)/i],[E,[A,"Vivo"],[I,B]],[/\b(rmx[1-3]\d{3})(?: bui|;|\))/i],[E,[A,"Realme"],[I,B]],[/\b(milestone|droid(?:[2-4x]| (?:bionic|x2|pro|razr))?:?( 4g)?)\b[\w ]+build\//i,/\bmot(?:orola)?[- ](\w*)/i,/((?:moto[\w\(\) ]+|xt\d{3,4}|nexus 6)(?= bui|\)))/i],[E,[A,eo],[I,B]],[/\b(mz60\d|xoom[2 ]{0,2}) build\//i],[E,[A,eo],[I,ee]],[/((?=lg)?[vl]k\-?\d{3}) bui| 3\.[-\w; ]{10}lg?-([06cv9]{3,4})/i],[E,[A,nr],[I,ee]],[/(lm(?:-?f100[nv]?|-[\w\.]+)(?= bui|\))|nexus [45])/i,/\blg[-e;\/ ]+((?!browser|netcast|android tv)\w+)/i,/\blg-?([\d\w]+) bui/i],[E,[A,nr],[I,B]],[/(ideatab[-\w ]+)/i,/lenovo ?(s[56]000[-\w]+|tab(?:[\w ]+)|yt[-\d\w]{6}|tb[-\d\w]{6})/i],[E,[A,"Lenovo"],[I,ee]],[/(?:maemo|nokia).*(n900|lumia \d+)/i,/nokia[-_ ]?([-\w\.]*)/i],[[E,/_/g," "],[A,"Nokia"],[I,B]],[/(pixel c)\b/i],[E,[A,vn],[I,ee]],[/droid.+; (pixel[\daxl ]{0,6})(?: bui|\))/i],[E,[A,vn],[I,B]],[/droid.+; (a?\d[0-2]{2}so|[c-g]\d{4}|so[-gl]\w+|xq-a\w[4-7][12])(?= bui|\).+chrome\/(?![1-6]{0,1}\d\.))/i],[E,[A,He],[I,B]],[/sony tablet [ps]/i,/\b(?:sony)?sgp\w+(?: bui|\))/i],[[E,"Xperia Tablet"],[A,He],[I,ee]],[/ (kb2005|in20[12]5|be20[12][59])\b/i,/(?:one)?(?:plus)? (a\d0\d\d)(?: b|\))/i],[E,[A,"OnePlus"],[I,B]],[/(alexa)webm/i,/(kf[a-z]{2}wi|aeo(?!bc)\w\w)( bui|\))/i,/(kf[a-z]+)( bui|\)).+silk\//i],[E,[A,_e],[I,ee]],[/((?:sd|kf)[0349hijorstuw]+)( bui|\)).+silk\//i],[[E,/(.+)/g,"Fire Phone $1"],[A,_e],[I,B]],[/(playbook);[-\w\),; ]+(rim)/i],[E,A,[I,ee]],[/\b((?:bb[a-f]|st[hv])100-\d)/i,/\(bb10; (\w+)/i],[E,[A,Ue],[I,B]],[/(?:\b|asus_)(transfo[prime ]{4,10} \w+|eeepc|slider \w+|nexus 7|padfone|p00[cj])/i],[E,[A,Ce],[I,ee]],[/ (z[bes]6[027][012][km][ls]|zenfone \d\w?)\b/i],[E,[A,Ce],[I,B]],[/(nexus 9)/i],[E,[A,"HTC"],[I,ee]],[/(htc)[-;_ ]{1,2}([\w ]+(?=\)| bui)|\w+)/i,/(zte)[- ]([\w ]+?)(?: bui|\/|\))/i,/(alcatel|geeksphone|nexian|panasonic(?!(?:;|\.))|sony(?!-bra))[-_ ]?([-\w]*)/i],[A,[E,/_/g," "],[I,B]],[/droid [\w\.]+; ((?:8[14]9[16]|9(?:0(?:48|60|8[01])|1(?:3[27]|66)|2(?:6[69]|9[56])|466))[gqswx])\w*(\)| bui)/i],[E,[A,"TCL"],[I,ee]],[/(itel) ((\w+))/i],[[A,Ku],E,[I,w0,{tablet:["p10001l","w7001"],"*":"mobile"}]],[/droid.+; ([ab][1-7]-?[0178a]\d\d?)/i],[E,[A,"Acer"],[I,ee]],[/droid.+; (m[1-5] note) bui/i,/\bmz-([-\w]{2,})/i],[E,[A,"Meizu"],[I,B]],[/; ((?:power )?armor(?:[\w ]{0,8}))(?: bui|\))/i],[E,[A,"Ulefone"],[I,B]],[/; (energy ?\w+)(?: bui|\))/i,/; energizer ([\w ]+)(?: bui|\))/i],[E,[A,"Energizer"],[I,B]],[/; cat (b35);/i,/; (b15q?|s22 flip|s48c|s62 pro)(?: bui|\))/i],[E,[A,"Cat"],[I,B]],[/((?:new )?andromax[\w- ]+)(?: bui|\))/i],[E,[A,"Smartfren"],[I,B]],[/droid.+; (a(?:015|06[35]|142p?))/i],[E,[A,"Nothing"],[I,B]],[/(blackberry|benq|palm(?=\-)|sonyericsson|acer|asus|dell|meizu|motorola|polytron|infinix|tecno|micromax|advan)[-_ ]?([-\w]*)/i,/; (imo) ((?!tab)[\w ]+?)(?: bui|\))/i,/(hp) ([\w ]+\w)/i,/(asus)-?(\w+)/i,/(microsoft); (lumia[\w ]+)/i,/(lenovo)[-_ ]?([-\w]+)/i,/(jolla)/i,/(oppo) ?([\w ]+) bui/i],[A,E,[I,B]],[/(imo) (tab \w+)/i,/(kobo)\s(ereader|touch)/i,/(archos) (gamepad2?)/i,/(hp).+(touchpad(?!.+tablet)|tablet)/i,/(kindle)\/([\w\.]+)/i,/(nook)[\w ]+build\/(\w+)/i,/(dell) (strea[kpr\d ]*[\dko])/i,/(le[- ]+pan)[- ]+(\w{1,9}) bui/i,/(trinity)[- ]*(t\d{3}) bui/i,/(gigaset)[- ]+(q\w{1,9}) bui/i,/(vodafone) ([\w ]+)(?:\)| bui)/i],[A,E,[I,ee]],[/(surface duo)/i],[E,[A,Kn],[I,ee]],[/droid [\d\.]+; (fp\du?)(?: b|\))/i],[E,[A,"Fairphone"],[I,B]],[/(u304aa)/i],[E,[A,"AT&T"],[I,B]],[/\bsie-(\w*)/i],[E,[A,"Siemens"],[I,B]],[/\b(rct\w+) b/i],[E,[A,"RCA"],[I,ee]],[/\b(venue[\d ]{2,7}) b/i],[E,[A,"Dell"],[I,ee]],[/\b(q(?:mv|ta)\w+) b/i],[E,[A,"Verizon"],[I,ee]],[/\b(?:barnes[& ]+noble |bn[rt])([\w\+ ]*) b/i],[E,[A,"Barnes & Noble"],[I,ee]],[/\b(tm\d{3}\w+) b/i],[E,[A,"NuVision"],[I,ee]],[/\b(k88) b/i],[E,[A,"ZTE"],[I,ee]],[/\b(nx\d{3}j) b/i],[E,[A,"ZTE"],[I,B]],[/\b(gen\d{3}) b.+49h/i],[E,[A,"Swiss"],[I,B]],[/\b(zur\d{3}) b/i],[E,[A,"Swiss"],[I,ee]],[/\b((zeki)?tb.*\b) b/i],[E,[A,"Zeki"],[I,ee]],[/\b([yr]\d{2}) b/i,/\b(dragon[- ]+touch |dt)(\w{5}) b/i],[[A,"Dragon Touch"],E,[I,ee]],[/\b(ns-?\w{0,9}) b/i],[E,[A,"Insignia"],[I,ee]],[/\b((nxa|next)-?\w{0,9}) b/i],[E,[A,"NextBook"],[I,ee]],[/\b(xtreme\_)?(v(1[045]|2[015]|[3469]0|7[05])) b/i],[[A,"Voice"],E,[I,B]],[/\b(lvtel\-)?(v1[12]) b/i],[[A,"LvTel"],E,[I,B]],[/\b(ph-1) /i],[E,[A,"Essential"],[I,B]],[/\b(v(100md|700na|7011|917g).*\b) b/i],[E,[A,"Envizen"],[I,ee]],[/\b(trio[-\w\. ]+) b/i],[E,[A,"MachSpeed"],[I,ee]],[/\btu_(1491) b/i],[E,[A,"Rotor"],[I,ee]],[/(shield[\w ]+) b/i],[E,[A,"Nvidia"],[I,ee]],[/(sprint) (\w+)/i],[A,E,[I,B]],[/(kin\.[onetw]{3})/i],[[E,/\./g," "],[A,Kn],[I,B]],[/droid.+; (cc6666?|et5[16]|mc[239][23]x?|vc8[03]x?)\)/i],[E,[A,le],[I,ee]],[/droid.+; (ec30|ps20|tc[2-8]\d[kx])\)/i],[E,[A,le],[I,B]],[/smart-tv.+(samsung)/i],[A,[I,Z]],[/hbbtv.+maple;(\d+)/i],[[E,/^/,"SmartTV"],[A,st],[I,Z]],[/(nux; netcast.+smarttv|lg (netcast\.tv-201\d|android tv))/i],[[A,nr],[I,Z]],[/(apple) ?tv/i],[A,[E,ue+" TV"],[I,Z]],[/crkey/i],[[E,Je+"cast"],[A,vn],[I,Z]],[/droid.+aft(\w+)( bui|\))/i],[E,[A,_e],[I,Z]],[/\(dtv[\);].+(aquos)/i,/(aquos-tv[\w ]+)\)/i],[E,[A,bt],[I,Z]],[/(bravia[\w ]+)( bui|\))/i],[E,[A,He],[I,Z]],[/(mitv-\w{5}) bui/i],[E,[A,V],[I,Z]],[/Hbbtv.*(technisat) (.*);/i],[A,E,[I,Z]],[/\b(roku)[\dx]*[\)\/]((?:dvp-)?[\d\.]*)/i,/hbbtv\/\d+\.\d+\.\d+ +\([\w\+ ]*; *([\w\d][^;]*);([^;]*)/i],[[A,VT],[E,VT],[I,Z]],[/\b(android tv|smart[- ]?tv|opera tv|tv; rv:)\b/i],[[I,Z]],[/(ouya)/i,/(nintendo) ([wids3utch]+)/i],[A,E,[I,j]],[/droid.+; (shield) bui/i],[E,[A,"Nvidia"],[I,j]],[/(playstation [345portablevi]+)/i],[E,[A,He],[I,j]],[/\b(xbox(?: one)?(?!; xbox))[\); ]/i],[E,[A,Kn],[I,j]],[/\b(sm-[lr]\d\d[05][fnuw]?s?)\b/i],[E,[A,st],[I,oe]],[/((pebble))app/i],[A,E,[I,oe]],[/(watch)(?: ?os[,\/]|\d,\d\/)[\d\.]+/i],[E,[A,ue],[I,oe]],[/droid.+; (glass) \d/i],[E,[A,vn],[I,oe]],[/droid.+; (wt63?0{2,3})\)/i],[E,[A,le],[I,oe]],[/droid.+; (glass) \d/i],[E,[A,vn],[I,oe]],[/(pico) (4|neo3(?: link|pro)?)/i],[A,E,[I,oe]],[/; (quest( \d| pro)?)/i],[E,[A,ge],[I,oe]],[/(tesla)(?: qtcarbrowser|\/[-\w\.]+)/i],[A,[I,ye]],[/(aeobc)\b/i],[E,[A,_e],[I,ye]],[/droid .+?; ([^;]+?)(?: bui|; wv\)|\) applew).+? mobile safari/i],[E,[I,B]],[/droid .+?; ([^;]+?)(?: bui|\) applew).+?(?! mobile) safari/i],[E,[I,ee]],[/\b((tablet|tab)[;\/]|focus\/\d(?!.+mobile))/i],[[I,ee]],[/(phone|mobile(?:[;\/]| [ \w\/\.]*safari)|pda(?=.+windows ce))/i],[[I,B]],[/(android[-\w\. ]{0,9});.+buil/i],[E,[A,"Generic"]]],engine:[[/windows.+ edge\/([\w\.]+)/i],[k,[b,"EdgeHTML"]],[/(arkweb)\/([\w\.]+)/i],[b,k],[/webkit\/537\.36.+chrome\/(?!27)([\w\.]+)/i],[k,[b,"Blink"]],[/(presto)\/([\w\.]+)/i,/(webkit|trident|netfront|netsurf|amaya|lynx|w3m|goanna|servo)\/([\w\.]+)/i,/ekioh(flow)\/([\w\.]+)/i,/(khtml|tasman|links)[\/ ]\(?([\w\.]+)/i,/(icab)[\/ ]([23]\.[\d\.]+)/i,/\b(libweb)/i],[b,k],[/rv\:([\w\.]{1,9})\b.+(gecko)/i],[k,b]],os:[[/microsoft (windows) (vista|xp)/i],[b,k],[/(windows (?:phone(?: os)?|mobile))[\/ ]?([\d\.\w ]*)/i],[b,[k,w0,D1]],[/windows nt 6\.2; (arm)/i,/windows[\/ ]?([ntce\d\. ]+\w)(?!.+xbox)/i,/(?:win(?=3|9|n)|win 9x )([nt\d\.]+)/i],[[k,w0,D1],[b,"Windows"]],[/ip[honead]{2,4}\b(?:.*os ([\w]+) like mac|; opera)/i,/(?:ios;fbsv\/|iphone.+ios[\/ ])([\d\.]+)/i,/cfnetwork\/.+darwin/i],[[k,/_/g,"."],[b,"iOS"]],[/(mac os x) ?([\w\. ]*)/i,/(macintosh|mac_powerpc\b)(?!.+haiku)/i],[[b,rn],[k,/_/g,"."]],[/droid ([\w\.]+)\b.+(android[- ]x86|harmonyos)/i],[k,b],[/(android|webos|qnx|bada|rim tablet os|maemo|meego|sailfish|openharmony)[-\/ ]?([\w\.]*)/i,/(blackberry)\w*\/([\w\.]*)/i,/(tizen|kaios)[\/ ]([\w\.]+)/i,/\((series40);/i],[b,k],[/\(bb(10);/i],[k,[b,Ue]],[/(?:symbian ?os|symbos|s60(?=;)|series60)[-\/ ]?([\w\.]*)/i],[k,[b,"Symbian"]],[/mozilla\/[\d\.]+ \((?:mobile|tablet|tv|mobile; [\w ]+); rv:.+ gecko\/([\w\.]+)/i],[k,[b,hn+" OS"]],[/web0s;.+rt(tv)/i,/\b(?:hp)?wos(?:browser)?\/([\w\.]+)/i],[k,[b,"webOS"]],[/watch(?: ?os[,\/]|\d,\d\/)([\d\.]+)/i],[k,[b,"watchOS"]],[/crkey\/([\d\.]+)/i],[k,[b,Je+"cast"]],[/(cros) [\w]+(?:\)| ([\w\.]+)\b)/i],[[b,tt],k],[/panasonic;(viera)/i,/(netrange)mmh/i,/(nettv)\/(\d+\.[\w\.]+)/i,/(nintendo|playstation) ([wids345portablevuch]+)/i,/(xbox); +xbox ([^\);]+)/i,/\b(joli|palm)\b ?(?:os)?\/?([\w\.]*)/i,/(mint)[\/\(\) ]?(\w*)/i,/(mageia|vectorlinux)[; ]/i,/([kxln]?ubuntu|debian|suse|opensuse|gentoo|arch(?= linux)|slackware|fedora|mandriva|centos|pclinuxos|red ?hat|zenwalk|linpus|raspbian|plan 9|minix|risc os|contiki|deepin|manjaro|elementary os|sabayon|linspire)(?: gnu\/linux)?(?: enterprise)?(?:[- ]linux)?(?:-gnu)?[-\/ ]?(?!chrom|package)([-\w\.]*)/i,/(hurd|linux) ?([\w\.]*)/i,/(gnu) ?([\w\.]*)/i,/\b([-frentopcghs]{0,5}bsd|dragonfly)[\/ ]?(?!amd|[ix346]{1,2}86)([\w\.]*)/i,/(haiku) (\w+)/i],[b,k],[/(sunos) ?([\w\.\d]*)/i],[[b,"Solaris"],k],[/((?:open)?solaris)[-\/ ]?([\w\.]*)/i,/(aix) ((\d)(?=\.|\)| )[\w\.])*/i,/\b(beos|os\/2|amigaos|morphos|openvms|fuchsia|hp-ux|serenityos)/i,/(unix) ?([\w\.]*)/i],[b,k]]},Jl=function(Vi,Hi){if(typeof Vi===h&&(Hi=Vi,Vi=a),!(this instanceof Jl))return new Jl(Vi,Hi).getResult();var Lr=typeof s!==d&&s.navigator?s.navigator:a,ec=Vi||(Lr&&Lr.userAgent?Lr.userAgent:""),Qd=Lr&&Lr.userAgentData?Lr.userAgentData:a,vi=Hi?function(Mn,Zd){var wy={};for(var ip in Mn)Zd[ip]&&Zd[ip].length%2==0?wy[ip]=Zd[ip].concat(Mn[ip]):wy[ip]=Mn[ip];return wy}(x1,Hi):x1,vf=Lr&&Lr.userAgent==ec;return this.getBrowser=function(){var Mn={};return Mn[b]=a,Mn[k]=a,by.call(Mn,ec,vi.browser),Mn[g]=function(Zd){return typeof Zd===m?Zd.replace(/[^\d\.]/g,"").split(".")[0]:a}(Mn[k]),vf&&Lr&&Lr.brave&&typeof Lr.brave.isBrave==c&&(Mn[b]="Brave"),Mn},this.getCPU=function(){var Mn={};return Mn[W]=a,by.call(Mn,ec,vi.cpu),Mn},this.getDevice=function(){var Mn={};return Mn[A]=a,Mn[E]=a,Mn[I]=a,by.call(Mn,ec,vi.device),vf&&!Mn[I]&&Qd&&Qd.mobile&&(Mn[I]=B),vf&&Mn[E]=="Macintosh"&&Lr&&typeof Lr.standalone!==d&&Lr.maxTouchPoints&&Lr.maxTouchPoints>2&&(Mn[E]="iPad",Mn[I]=ee),Mn},this.getEngine=function(){var Mn={};return Mn[b]=a,Mn[k]=a,by.call(Mn,ec,vi.engine),Mn},this.getOS=function(){var Mn={};return Mn[b]=a,Mn[k]=a,by.call(Mn,ec,vi.os),vf&&!Mn[b]&&Qd&&Qd.platform&&Qd.platform!="Unknown"&&(Mn[b]=Qd.platform.replace(/chrome os/i,tt).replace(/macos/i,rn)),Mn},this.getResult=function(){return{ua:this.getUA(),browser:this.getBrowser(),engine:this.getEngine(),os:this.getOS(),device:this.getDevice(),cpu:this.getCPU()}},this.getUA=function(){return ec},this.setUA=function(Mn){return ec=typeof Mn===m&&Mn.length>500?VT(Mn,500):Mn,this},this.setUA(ec),this};Jl.VERSION="0.7.40",Jl.BROWSER=Gi([b,k,g]),Jl.CPU=Gi([W]),Jl.DEVICE=Gi([E,A,I,j,B,Z,ee,oe,ye]),Jl.ENGINE=Jl.OS=Gi([b,k]),t.exports&&(r=t.exports=Jl),r.UAParser=Jl;var Ef=typeof s!==d&&(s.jQuery||s.Zepto);if(Ef&&!Ef.ua){var L1=new Jl;Ef.ua=L1.getResult(),Ef.ua.get=function(){return L1.getUA()},Ef.ua.set=function(Vi){L1.setUA(Vi);var Hi=L1.getResult();for(var Lr in Hi)Ef.ua[Lr]=Hi[Lr]}}})(typeof window=="object"?window:o)})(Wx,Wx.exports);var ohe=l(Wx.exports),C6=Nm.clear;Gn({global:!0,bind:!0,forced:L.clearImmediate!==C6},{clearImmediate:C6});var R6=L,ahe=re,che=fe,lhe=a_,uhe=En,dhe=Es,hhe=Gc,phe=R6.Function,fhe=/MSIE .\./.test(uhe)||lhe==="BUN"&&function(){var t=R6.Bun.version.split(".");return t.length<3||t[0]==="0"&&(t[1]<3||t[1]==="3"&&t[2]==="0")}(),mhe=Gn,I6=L,A6=Nm.set,ghe=function(t,r){var s=1;return fhe?function(a,c){var d=hhe(arguments.length,1)>s,h=che(a)?a:phe(a),m=d?dhe(arguments,s):[],g=d?function(){ahe(h,this,m)}:h;return t(g)}:t},P6=I6.setImmediate?ghe(A6):A6;mhe({global:!0,bind:!0,forced:I6.setImmediate!==P6},{setImmediate:P6});var k6=l(Ne.setImmediate),_he=L,yhe=Tw,Ehe=Tr,vhe=Gc,She=ke;Gn({global:!0,dontCallGetSet:!0,forced:u(function(){return She&&Object.getOwnPropertyDescriptor(_he,"queueMicrotask").value.length!==1})},{queueMicrotask:function(t){vhe(arguments.length,1),yhe(Ehe(t))}});var O6=l(Ne.queueMicrotask);function N6(t,r){return function(){return t.apply(r,arguments)}}const{toString:bhe}=Object.prototype,{getPrototypeOf:Gx}=Object,{iterator:xA,toStringTag:D6}=Symbol,LA=(Hx=Object.create(null),t=>{const r=bhe.call(t);return Hx[r]||(Hx[r]=r.slice(8,-1).toLowerCase())});var Hx;const Ud=t=>(t=t.toLowerCase(),r=>LA(r)===t),MA=t=>r=>typeof r===t,{isArray:Ov}=Array,Lw=MA("undefined"),x6=Ud("ArrayBuffer"),whe=MA("string"),Kc=MA("function"),L6=MA("number"),UA=t=>t!==null&&typeof t=="object",VA=t=>{if(LA(t)!=="object")return!1;const r=Gx(t);return!(r!==null&&r!==Object.prototype&&Object.getPrototypeOf(r)!==null||D6 in t||xA in t)},The=Ud("Date"),Che=Ud("File"),Rhe=Ud("Blob"),Ihe=Ud("FileList"),Ahe=Ud("URLSearchParams"),[Phe,khe,Ohe,Nhe]=["ReadableStream","Request","Response","Headers"].map(Ud);function Mw(t,r){let s,a,{allOwnKeys:c=!1}=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};if(t!=null)if(typeof t!="object"&&(t=[t]),Ov(t))for(s=0,a=t.length;s<a;s++)r.call(null,t[s],s,t);else{const d=c?Object.getOwnPropertyNames(t):Object.keys(t),h=d.length;let m;for(s=0;s<h;s++)m=d[s],r.call(null,t[m],m,t)}}function M6(t,r){r=r.toLowerCase();const s=Object.keys(t);let a,c=s.length;for(;c-- >0;)if(a=s[c],r===a.toLowerCase())return a;return null}const Y_=T6!==void 0?T6:typeof self<"u"?self:typeof window<"u"?window:Ny,U6=t=>!Lw(t)&&t!==Y_,Dhe=($x=typeof Uint8Array<"u"&&Gx(Uint8Array),t=>$x&&t instanceof $x);var $x;const xhe=Ud("HTMLFormElement"),V6=(t=>{let{hasOwnProperty:r}=t;return(s,a)=>r.call(s,a)})(Object.prototype),Lhe=Ud("RegExp"),F6=(t,r)=>{const s=Object.getOwnPropertyDescriptors(t),a={};Mw(s,(c,d)=>{let h;(h=r(c,d,t))!==!1&&(a[d]=h||c)}),Object.defineProperties(t,a)},Mhe=Ud("AsyncFunction"),j6=(B6=typeof k6=="function",z6=Kc(Y_.postMessage),B6?k6:z6?(Kx="axios@".concat(Math.random()),FA=[],Y_.addEventListener("message",t=>{let{source:r,data:s}=t;r===Y_&&s===Kx&&FA.length&&FA.shift()()},!1),t=>{FA.push(t),Y_.postMessage(Kx,"*")}):t=>setTimeout(t));var B6,z6,Kx,FA;const Uhe=O6!==void 0?O6.bind(Y_):typeof process<"u"&&process.nextTick||j6;var ht={isArray:Ov,isArrayBuffer:x6,isBuffer:function(t){return t!==null&&!Lw(t)&&t.constructor!==null&&!Lw(t.constructor)&&Kc(t.constructor.isBuffer)&&t.constructor.isBuffer(t)},isFormData:t=>{let r;return t&&(typeof FormData=="function"&&t instanceof FormData||Kc(t.append)&&((r=LA(t))==="formdata"||r==="object"&&Kc(t.toString)&&t.toString()==="[object FormData]"))},isArrayBufferView:function(t){let r;return r=typeof ArrayBuffer<"u"&&ArrayBuffer.isView?ArrayBuffer.isView(t):t&&t.buffer&&x6(t.buffer),r},isString:whe,isNumber:L6,isBoolean:t=>t===!0||t===!1,isObject:UA,isPlainObject:VA,isReadableStream:Phe,isRequest:khe,isResponse:Ohe,isHeaders:Nhe,isUndefined:Lw,isDate:The,isFile:Che,isBlob:Rhe,isRegExp:Lhe,isFunction:Kc,isStream:t=>UA(t)&&Kc(t.pipe),isURLSearchParams:Ahe,isTypedArray:Dhe,isFileList:Ihe,forEach:Mw,merge:function t(){const{caseless:r}=U6(this)&&this||{},s={},a=(c,d)=>{const h=r&&M6(s,d)||d;VA(s[h])&&VA(c)?s[h]=t(s[h],c):VA(c)?s[h]=t({},c):Ov(c)?s[h]=c.slice():s[h]=c};for(let c=0,d=arguments.length;c<d;c++)arguments[c]&&Mw(arguments[c],a);return s},extend:function(t,r,s){let{allOwnKeys:a}=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{};return Mw(r,(c,d)=>{s&&Kc(c)?t[d]=N6(c,s):t[d]=c},{allOwnKeys:a}),t},trim:t=>Ao(t)?Ao(t).call(t):t.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,""),stripBOM:t=>(t.charCodeAt(0)===65279&&(t=t.slice(1)),t),inherits:(t,r,s,a)=>{t.prototype=Object.create(r.prototype,a),t.prototype.constructor=t,Object.defineProperty(t,"super",{value:r.prototype}),s&&Object.assign(t.prototype,s)},toFlatObject:(t,r,s,a)=>{let c,d,h;const m={};if(r=r||{},t==null)return r;do{for(c=Object.getOwnPropertyNames(t),d=c.length;d-- >0;)h=c[d],a&&!a(h,t,r)||m[h]||(r[h]=t[h],m[h]=!0);t=s!==!1&&Gx(t)}while(t&&(!s||s(t,r))&&t!==Object.prototype);return r},kindOf:LA,kindOfTest:Ud,endsWith:(t,r,s)=>{t=String(t),(s===void 0||s>t.length)&&(s=t.length),s-=r.length;const a=t.indexOf(r,s);return a!==-1&&a===s},toArray:t=>{if(!t)return null;if(Ov(t))return t;let r=t.length;if(!L6(r))return null;const s=new Array(r);for(;r-- >0;)s[r]=t[r];return s},forEachEntry:(t,r)=>{const s=(t&&t[xA]).call(t);let a;for(;(a=s.next())&&!a.done;){const c=a.value;r.call(t,c[0],c[1])}},matchAll:(t,r)=>{let s;const a=[];for(;(s=t.exec(r))!==null;)a.push(s);return a},isHTMLForm:xhe,hasOwnProperty:V6,hasOwnProp:V6,reduceDescriptors:F6,freezeMethods:t=>{F6(t,(r,s)=>{if(Kc(t)&&["arguments","caller","callee"].indexOf(s)!==-1)return!1;const a=t[s];Kc(a)&&(r.enumerable=!1,"writable"in r?r.writable=!1:r.set||(r.set=()=>{throw Error("Can not rewrite read-only method '"+s+"'")}))})},toObjectSet:(t,r)=>{const s={},a=c=>{c.forEach(d=>{s[d]=!0})};return Ov(t)?a(t):a(String(t).split(r)),s},toCamelCase:t=>t.toLowerCase().replace(/[-_\s]([a-z\d])(\w*)/g,function(r,s,a){return s.toUpperCase()+a}),noop:()=>{},toFiniteNumber:(t,r)=>t!=null&&Number.isFinite(t=+t)?t:r,findKey:M6,global:Y_,isContextDefined:U6,isSpecCompliantForm:function(t){return!!(t&&Kc(t.append)&&t[D6]==="FormData"&&t[xA])},toJSONObject:t=>{const r=new Array(10),s=(a,c)=>{if(UA(a)){if(r.indexOf(a)>=0)return;if(!("toJSON"in a)){r[c]=a;const d=Ov(a)?[]:{};return Mw(a,(h,m)=>{const g=s(h,c+1);!Lw(g)&&(d[m]=g)}),r[c]=void 0,d}}return a};return s(t,0)},isAsyncFn:Mhe,isThenable:t=>t&&(UA(t)||Kc(t))&&Kc(t.then)&&Kc(t.catch),setImmediate:j6,asap:Uhe,isIterable:t=>t!=null&&Kc(t[xA])};function gr(t,r,s,a,c){Error.call(this),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=new Error().stack,this.message=t,this.name="AxiosError",r&&(this.code=r),s&&(this.config=s),a&&(this.request=a),c&&(this.response=c,this.status=c.status?c.status:null)}ht.inherits(gr,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:ht.toJSONObject(this.config),code:this.code,status:this.status}}});const W6=gr.prototype,G6={};["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED","ERR_NOT_SUPPORT","ERR_INVALID_URL"].forEach(t=>{G6[t]={value:t}}),Object.defineProperties(gr,G6),Object.defineProperty(W6,"isAxiosError",{value:!0}),gr.from=(t,r,s,a,c,d)=>{const h=Object.create(W6);return ht.toFlatObject(t,h,function(m){return m!==Error.prototype},m=>m!=="isAxiosError"),gr.call(h,t.message,r,s,a,c),h.cause=t,h.name=t.name,d&&Object.assign(h,d),h};function qx(t){return ht.isPlainObject(t)||ht.isArray(t)}function H6(t){return ht.endsWith(t,"[]")?t.slice(0,-2):t}function $6(t,r,s){return t?t.concat(r).map(function(a,c){return a=H6(a),!s&&c?"["+a+"]":a}).join(s?".":""):r}const Vhe=ht.toFlatObject(ht,{},null,function(t){return/^is[A-Z]/.test(t)});function jA(t,r,s){if(!ht.isObject(t))throw new TypeError("target must be an object");r=r||new FormData;const a=(s=ht.toFlatObject(s,{metaTokens:!0,dots:!1,indexes:!1},!1,function(A,k){return!ht.isUndefined(k[A])})).metaTokens,c=s.visitor||E,d=s.dots,h=s.indexes,m=(s.Blob||typeof Blob<"u"&&Blob)&&ht.isSpecCompliantForm(r);if(!ht.isFunction(c))throw new TypeError("visitor must be a function");function g(A){if(A===null)return"";if(ht.isDate(A))return A.toISOString();if(!m&&ht.isBlob(A))throw new gr("Blob is not supported. Use a Buffer instead.");return ht.isArrayBuffer(A)||ht.isTypedArray(A)?m&&typeof Blob=="function"?new Blob([A]):Buffer.from(A):A}function E(A,k,W){let j=A;if(A&&!W&&typeof A=="object"){if(ht.endsWith(k,"{}"))k=a?k:k.slice(0,-2),A=JSON.stringify(A);else if(ht.isArray(A)&&function(B){return ht.isArray(B)&&!B.some(qx)}(A)||(ht.isFileList(A)||ht.endsWith(k,"[]"))&&(j=ht.toArray(A)))return k=H6(k),j.forEach(function(B,ee){!ht.isUndefined(B)&&B!==null&&r.append(h===!0?$6([k],ee,d):h===null?k:k+"[]",g(B))}),!1}return!!qx(A)||(r.append($6(W,k,d),g(A)),!1)}const b=[],I=Object.assign(Vhe,{defaultVisitor:E,convertValue:g,isVisitable:qx});if(!ht.isObject(t))throw new TypeError("data must be an object");return function A(k,W){if(!ht.isUndefined(k)){if(b.indexOf(k)!==-1)throw Error("Circular reference detected in "+W.join("."));b.push(k),ht.forEach(k,function(j,B){(!(ht.isUndefined(j)||j===null)&&c.call(r,j,ht.isString(B)?Ao(B).call(B):B,W,I))===!0&&A(j,W?W.concat(B):[B])}),b.pop()}}(t),r}function K6(t){const r={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+","%00":"\0"};return encodeURIComponent(t).replace(/[!'()~]|%20|%00/g,function(s){return r[s]})}function Yx(t,r){this._pairs=[],t&&jA(t,this,r)}const q6=Yx.prototype;function Fhe(t){return encodeURIComponent(t).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}function Y6(t,r,s){if(!r)return t;const a=s&&s.encode||Fhe;ht.isFunction(s)&&(s={serialize:s});const c=s&&s.serialize;let d;if(d=c?c(r,s):ht.isURLSearchParams(r)?r.toString():new Yx(r,s).toString(a),d){const h=t.indexOf("#");h!==-1&&(t=t.slice(0,h)),t+=(t.indexOf("?")===-1?"?":"&")+d}return t}q6.append=function(t,r){this._pairs.push([t,r])},q6.toString=function(t){const r=t?function(s){return t.call(this,s,K6)}:K6;return this._pairs.map(function(s){return r(s[0])+"="+r(s[1])},"").join("&")};var X6=class{constructor(){this.handlers=[]}use(t,r,s){return this.handlers.push({fulfilled:t,rejected:r,synchronous:!!s&&s.synchronous,runWhen:s?s.runWhen:null}),this.handlers.length-1}eject(t){this.handlers[t]&&(this.handlers[t]=null)}clear(){this.handlers&&(this.handlers=[])}forEach(t){ht.forEach(this.handlers,function(r){r!==null&&t(r)})}},J6={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},Q6={exports:{}},jhe=Gn,Bhe=ke,Z6=Kt.f;jhe({target:"Object",stat:!0,forced:Object.defineProperty!==Z6,sham:!Bhe},{defineProperty:Z6});var ez=Ne.Object,zhe=Q6.exports=function(t,r,s){return ez.defineProperty(t,r,s)};ez.defineProperty.sham&&(zhe.sham=!0);var tz=l(Q6.exports),Whe=TypeError,nz=vd,Ghe=Ds,Hhe=Se,$he=Nr("species"),rz=Array,Khe=function(t){var r;return nz(t)&&(r=t.constructor,(Ghe(r)&&(r===rz||nz(r.prototype))||Hhe(r)&&(r=r[$he])===null)&&(r=void 0)),r===void 0?rz:r},iz=function(t,r){return new(Khe(t))(r===0?0:r)},qhe=u,Yhe=ji,Xhe=Nr("species"),sz=function(t){return Yhe>=51||!qhe(function(){var r=[];return(r.constructor={})[Xhe]=function(){return{foo:1}},r[t](Boolean).foo!==1})},Jhe=Gn,Qhe=u,Zhe=vd,epe=Se,tpe=ei,npe=hr,oz=function(t){if(t>9007199254740991)throw Whe("Maximum allowed index exceeded");return t},az=dx,rpe=iz,ipe=sz,spe=ji,cz=Nr("isConcatSpreadable"),ope=spe>=51||!Qhe(function(){var t=[];return t[cz]=!1,t.concat()[0]!==t}),ape=function(t){if(!epe(t))return!1;var r=t[cz];return r!==void 0?!!r:Zhe(t)};Jhe({target:"Array",proto:!0,forced:!ope||!ipe("concat")},{concat:function(t){var r,s,a,c,d,h=tpe(this),m=rpe(h,0),g=0;for(r=-1,a=arguments.length;r<a;r++)if(ape(d=r===-1?h:arguments[r]))for(c=npe(d),oz(g+c),s=0;s<c;s++,g++)s in d&&az(m,g,d[s]);else oz(g+1),az(m,g++,d);return m.length=g,m}});var lz={},cpe=H,lpe=on,uz=bd.f,upe=Es,dz=typeof window=="object"&&window&&Object.getOwnPropertyNames?Object.getOwnPropertyNames(window):[];lz.f=function(t){return dz&&cpe(t)==="Window"?function(r){try{return uz(r)}catch{return upe(dz)}}(t):uz(lpe(t))};var Nv={},dpe=Nr;Nv.f=dpe;var hz=Ne,hpe=ti,ppe=Nv,fpe=Kt.f,vs=function(t){var r=hz.Symbol||(hz.Symbol={});hpe(r,t)||fpe(r,t,{value:ppe.f(t)})},mpe=Te,gpe=xt,_pe=Nr,ype=Od,pz=function(){var t=gpe("Symbol"),r=t&&t.prototype,s=r&&r.valueOf,a=_pe("toPrimitive");r&&!r[a]&&ype(r,a,function(c){return mpe(s,this)},{})},Epe=ot,vpe=et,Spe=ei,bpe=hr,wpe=iz,fz=R([].push),Tpe=function(t){var r=t===1,s=t===2,a=t===3,c=t===4,d=t===6,h=t===7,m=t===5||d;return function(g,E,b,I){for(var A,k,W=Spe(g),j=vpe(W),B=bpe(j),ee=Epe(E,b),Z=0,oe=I||wpe,ye=r?oe(g,B):s||h?oe(g,0):void 0;B>Z;Z++)if((m||Z in j)&&(k=ee(A=j[Z],Z,W),t))if(r)ye[Z]=k;else if(k)switch(t){case 3:return!0;case 5:return A;case 6:return Z;case 2:fz(ye,A)}else switch(t){case 4:return!1;case 7:fz(ye,A)}return d?-1:a||c?c:ye}},mz={forEach:Tpe(0)},BA=Gn,Uw=L,Xx=Te,Cpe=R,Dv=ke,xv=Ki,Rpe=u,Zo=ti,Ipe=N,Jx=tr,zA=on,Qx=mr,Ape=za,Zx=Ze,Lv=__,gz=ya,Ppe=bd,_z=lz,kpe=ym,yz=de,Ez=Kt,Ope=Ih,vz=we,Sz=Od,Npe=kh,eL=ca,bz=Dl,wz=Mc,Dpe=Nr,xpe=Nv,Lpe=vs,Mpe=pz,Upe=wu,Tz=Ph,WA=mz.forEach,qc=gm("hidden"),GA="Symbol",Vw="prototype",Vpe=Tz.set,Cz=Tz.getterFor(GA),Vd=Object[Vw],X_=Uw.Symbol,HA=X_&&X_[Vw],Fpe=Uw.RangeError,jpe=Uw.TypeError,tL=Uw.QObject,Rz=yz.f,J_=Ez.f,Iz=_z.f,Bpe=vz.f,Az=Cpe([].push),af=eL("symbols"),Fw=eL("op-symbols"),zpe=eL("wks"),nL=!tL||!tL[Vw]||!tL[Vw].findChild,Pz=function(t,r,s){var a=Rz(Vd,r);a&&delete Vd[r],J_(t,r,s),a&&t!==Vd&&J_(Vd,r,a)},rL=Dv&&Rpe(function(){return Lv(J_({},"a",{get:function(){return J_(this,"a",{value:7}).a}})).a!==7})?Pz:J_,iL=function(t,r){var s=af[t]=Lv(HA);return Vpe(s,{type:GA,tag:t,description:r}),Dv||(s.description=r),s},$A=function(t,r,s){t===Vd&&$A(Fw,r,s),Jx(t);var a=Qx(r);return Jx(s),Zo(af,a)?(s.enumerable?(Zo(t,qc)&&t[qc][a]&&(t[qc][a]=!1),s=Lv(s,{enumerable:Zx(0,!1)})):(Zo(t,qc)||J_(t,qc,Zx(1,Lv(null))),t[qc][a]=!0),rL(t,a,s)):J_(t,a,s)},sL=function(t,r){Jx(t);var s=zA(r),a=gz(s).concat(Dz(s));return WA(a,function(c){Dv&&!Xx(kz,s,c)||$A(t,c,s[c])}),t},kz=function(t){var r=Qx(t),s=Xx(Bpe,this,r);return!(this===Vd&&Zo(af,r)&&!Zo(Fw,r))&&(!(s||!Zo(this,r)||!Zo(af,r)||Zo(this,qc)&&this[qc][r])||s)},Oz=function(t,r){var s=zA(t),a=Qx(r);if(s!==Vd||!Zo(af,a)||Zo(Fw,a)){var c=Rz(s,a);return!c||!Zo(af,a)||Zo(s,qc)&&s[qc][a]||(c.enumerable=!0),c}},Nz=function(t){var r=Iz(zA(t)),s=[];return WA(r,function(a){Zo(af,a)||Zo(bz,a)||Az(s,a)}),s},Dz=function(t){var r=t===Vd,s=Iz(r?Fw:zA(t)),a=[];return WA(s,function(c){!Zo(af,c)||r&&!Zo(Vd,c)||Az(a,af[c])}),a};xv||(X_=function(){if(Ipe(HA,this))throw new jpe("Symbol is not a constructor");var t=arguments.length&&arguments[0]!==void 0?Ape(arguments[0]):void 0,r=wz(t),s=function(a){var c=this===void 0?Uw:this;c===Vd&&Xx(s,Fw,a),Zo(c,qc)&&Zo(c[qc],r)&&(c[qc][r]=!1);var d=Zx(1,a);try{rL(c,r,d)}catch(h){if(!(h instanceof Fpe))throw h;Pz(c,r,d)}};return Dv&&nL&&rL(Vd,r,{configurable:!0,set:s}),iL(r,t)},Sz(HA=X_[Vw],"toString",function(){return Cz(this).tag}),Sz(X_,"withoutSetter",function(t){return iL(wz(t),t)}),vz.f=kz,Ez.f=$A,Ope.f=sL,yz.f=Oz,Ppe.f=_z.f=Nz,kpe.f=Dz,xpe.f=function(t){return iL(Dpe(t),t)},Dv&&Npe(HA,"description",{configurable:!0,get:function(){return Cz(this).description}})),BA({global:!0,wrap:!0,forced:!xv,sham:!xv},{Symbol:X_}),WA(gz(zpe),function(t){Lpe(t)}),BA({target:GA,stat:!0,forced:!xv},{useSetter:function(){nL=!0},useSimple:function(){nL=!1}}),BA({target:"Object",stat:!0,forced:!xv,sham:!Dv},{create:function(t,r){return r===void 0?Lv(t):sL(Lv(t),r)},defineProperty:$A,defineProperties:sL,getOwnPropertyDescriptor:Oz}),BA({target:"Object",stat:!0,forced:!xv},{getOwnPropertyNames:Nz}),Mpe(),Upe(X_,GA),bz[qc]=!0;var xz=Ki&&!!Symbol.for&&!!Symbol.keyFor,Wpe=Gn,Gpe=xt,Hpe=ti,$pe=za,Lz=ca,Kpe=xz,oL=Lz("string-to-symbol-registry"),qpe=Lz("symbol-to-string-registry");Wpe({target:"Symbol",stat:!0,forced:!Kpe},{for:function(t){var r=$pe(t);if(Hpe(oL,r))return oL[r];var s=Gpe("Symbol")(r);return oL[r]=s,qpe[s]=r,s}});var Ype=Gn,Xpe=ti,Jpe=uo,Qpe=Go,Zpe=xz,Mz=ca("symbol-to-string-registry");Ype({target:"Symbol",stat:!0,forced:!Zpe},{keyFor:function(t){if(!Jpe(t))throw new TypeError(Qpe(t)+" is not a symbol");if(Xpe(Mz,t))return Mz[t]}});var Uz=vd,efe=fe,Vz=H,tfe=za,Fz=R([].push),nfe=Gn,jz=xt,Bz=re,rfe=Te,jw=R,zz=u,Wz=fe,Gz=uo,Hz=Es,ife=function(t){if(efe(t))return t;if(Uz(t)){for(var r=t.length,s=[],a=0;a<r;a++){var c=t[a];typeof c=="string"?Fz(s,c):typeof c!="number"&&Vz(c)!=="Number"&&Vz(c)!=="String"||Fz(s,tfe(c))}var d=s.length,h=!0;return function(m,g){if(h)return h=!1,g;if(Uz(this))return g;for(var E=0;E<d;E++)if(s[E]===m)return g}}},sfe=Ki,ofe=String,zm=jz("JSON","stringify"),KA=jw(/./.exec),$z=jw("".charAt),afe=jw("".charCodeAt),cfe=jw("".replace),lfe=jw(1 .toString),ufe=/[\uD800-\uDFFF]/g,Kz=/^[\uD800-\uDBFF]$/,qz=/^[\uDC00-\uDFFF]$/,Yz=!sfe||zz(function(){var t=jz("Symbol")("stringify detection");return zm([t])!=="[null]"||zm({a:t})!=="{}"||zm(Object(t))!=="{}"}),Xz=zz(function(){return zm("\uDF06\uD834")!=='"\\udf06\\ud834"'||zm("\uDEAD")!=='"\\udead"'}),dfe=function(t,r){var s=Hz(arguments),a=ife(r);if(Wz(a)||t!==void 0&&!Gz(t))return s[1]=function(c,d){if(Wz(a)&&(d=rfe(a,this,ofe(c),d)),!Gz(d))return d},Bz(zm,null,s)},hfe=function(t,r,s){var a=$z(s,r-1),c=$z(s,r+1);return KA(Kz,t)&&!KA(qz,c)||KA(qz,t)&&!KA(Kz,a)?"\\u"+lfe(afe(t,0),16):t};zm&&nfe({target:"JSON",stat:!0,forced:Yz||Xz},{stringify:function(t,r,s){var a=Hz(arguments),c=Bz(Yz?dfe:zm,null,a);return Xz&&typeof c=="string"?cfe(c,ufe,hfe):c}});var Jz=ym,pfe=ei;Gn({target:"Object",stat:!0,forced:!Ki||u(function(){Jz.f(1)})},{getOwnPropertySymbols:function(t){var r=Jz.f;return r?r(pfe(t)):[]}}),vs("asyncIterator"),vs("hasInstance"),vs("isConcatSpreadable"),vs("iterator"),vs("match"),vs("matchAll"),vs("replace"),vs("search"),vs("species"),vs("split");var ffe=pz;vs("toPrimitive"),ffe();var mfe=xt,gfe=wu;vs("toStringTag"),gfe(mfe("Symbol"),"Symbol"),vs("unscopables"),wu(L.JSON,"JSON",!0);var _fe=Ne.Symbol,yfe=Nr,Efe=Kt.f,Qz=yfe("metadata"),Zz=Function.prototype;Zz[Qz]===void 0&&Efe(Zz,Qz,{value:null}),vs("asyncDispose"),vs("dispose"),vs("metadata");var vfe=_fe,Sfe=R,aL=xt("Symbol"),bfe=aL.keyFor,wfe=Sfe(aL.prototype.valueOf),e8=aL.isRegisteredSymbol||function(t){try{return bfe(wfe(t))!==void 0}catch{return!1}};Gn({target:"Symbol",stat:!0},{isRegisteredSymbol:e8});for(var Tfe=ca,t8=xt,Cfe=R,Rfe=uo,Ife=Nr,qA=t8("Symbol"),n8=qA.isWellKnownSymbol,r8=t8("Object","getOwnPropertyNames"),Afe=Cfe(qA.prototype.valueOf),i8=Tfe("wks"),cL=0,s8=r8(qA),Pfe=s8.length;cL<Pfe;cL++)try{var o8=s8[cL];Rfe(qA[o8])&&Ife(o8)}catch{}var a8=function(t){if(n8&&n8(t))return!0;try{for(var r=Afe(t),s=0,a=r8(i8),c=a.length;s<c;s++)if(i8[a[s]]==r)return!0}catch{}return!1};Gn({target:"Symbol",stat:!0,forced:!0},{isWellKnownSymbol:a8}),vs("customMatcher"),vs("observable"),Gn({target:"Symbol",stat:!0},{isRegistered:e8}),Gn({target:"Symbol",stat:!0,forced:!0},{isWellKnown:a8}),vs("matcher"),vs("metadataKey"),vs("patternMatch"),vs("replaceAll");var Mv=l(vfe),c8=l(Nv.f("iterator"));function Bw(t){return Bw=typeof Mv=="function"&&typeof c8=="symbol"?function(r){return typeof r}:function(r){return r&&typeof Mv=="function"&&r.constructor===Mv&&r!==Mv.prototype?"symbol":typeof r},Bw(t)}var kfe=l(Nv.f("toPrimitive"));function Ofe(t){var r=function(s,a){if(Bw(s)!="object"||!s)return s;var c=s[kfe];if(c!==void 0){var d=c.call(s,a);if(Bw(d)!="object")return d;throw new TypeError("@@toPrimitive must return a primitive value.")}return(a==="string"?String:Number)(s)}(t,"string");return Bw(r)=="symbol"?r:r+""}function Y(t,r,s){return(r=Ofe(r))in t?tz(t,r,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[r]=s,t}var l8=l(Oue),Nfe={isBrowser:!0,classes:{URLSearchParams:l8!==void 0?l8:Yx,FormData:typeof FormData<"u"?FormData:null,Blob:typeof Blob<"u"?Blob:null},protocols:["http","https","file","blob","url","data"]};const lL=typeof window<"u"&&typeof document<"u",uL=typeof navigator=="object"&&navigator||void 0,Dfe=lL&&(!uL||["ReactNative","NativeScript","NS"].indexOf(uL.product)<0),xfe=typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope&&typeof self.importScripts=="function",Lfe=lL&&window.location.href||"http://localhost";function u8(t,r){var s=Object.keys(t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);r&&(a=a.filter(function(c){return Object.getOwnPropertyDescriptor(t,c).enumerable})),s.push.apply(s,a)}return s}function d8(t){for(var r=1;r<arguments.length;r++){var s=arguments[r]!=null?arguments[r]:{};r%2?u8(Object(s),!0).forEach(function(a){Y(t,a,s[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(s)):u8(Object(s)).forEach(function(a){Object.defineProperty(t,a,Object.getOwnPropertyDescriptor(s,a))})}return t}var qa=d8(d8({},Object.freeze({__proto__:null,hasBrowserEnv:lL,hasStandardBrowserEnv:Dfe,hasStandardBrowserWebWorkerEnv:xfe,navigator:uL,origin:Lfe})),Nfe),Mfe=tr,Ufe=Te,Vfe=ti,Ffe=N,jfe=function(){var t=Mfe(this),r="";return t.hasIndices&&(r+="d"),t.global&&(r+="g"),t.ignoreCase&&(r+="i"),t.multiline&&(r+="m"),t.dotAll&&(r+="s"),t.unicode&&(r+="u"),t.unicodeSets&&(r+="v"),t.sticky&&(r+="y"),r},h8=RegExp.prototype,p8=function(t){var r=t.flags;return r!==void 0||"flags"in h8||Vfe(t,"flags")||!Ffe(h8,t)?r:Ufe(jfe,t)},Bfe=JD.charAt,f8=Te,zfe=tr,Wfe=fe,Gfe=H,Hfe=/./.exec,$fe=TypeError,Kfe=Gn,m8=Te,g8=ne,qfe=A_,YA=ov,_8=Ct,y8=oi,zw=za,Yfe=tr,Xfe=Se,Jfe=H,Qfe=rb,E8=p8,Zfe=Ma,eme=u,tme=tf,nme=function(t,r,s){return r+(s?Bfe(t,r).length:1)},rme=function(t,r){var s=t.exec;if(Wfe(s)){var a=f8(s,t,r);return a!==null&&zfe(a),a}if(Gfe(t)==="RegExp")return f8(Hfe,t,r);throw new $fe("RegExp#exec called on incompatible receiver")},v8=Ph,ime=Nr("matchAll"),S8="RegExp String",b8=S8+" Iterator",sme=v8.set,ome=v8.getterFor(b8),ame=TypeError,dL=g8("".indexOf),XA=g8("".matchAll),hL=!!XA&&!eme(function(){XA("a",/./)}),cme=qfe(function(t,r,s,a){sme(this,{type:b8,regexp:t,string:r,global:s,unicode:a,done:!1})},S8,function(){var t=ome(this);if(t.done)return YA(void 0,!0);var r=t.regexp,s=t.string,a=rme(r,s);return a===null?(t.done=!0,YA(void 0,!0)):t.global?(zw(a[0])===""&&(r.lastIndex=nme(s,y8(r.lastIndex),t.unicode)),YA(a,!1)):(t.done=!0,YA(a,!1))}),w8=function(t){var r,s,a,c=Yfe(this),d=zw(t),h=tme(c,RegExp),m=zw(E8(c));return r=new h(h===RegExp?c.source:c,m),s=!!~dL(m,"g"),a=!!~dL(m,"u"),r.lastIndex=y8(c.lastIndex),new cme(r,d,s,a)};Kfe({target:"String",proto:!0,forced:hL},{matchAll:function(t){var r,s,a,c,d=_8(this);if(Xfe(t)){if(Qfe(t)&&(r=zw(_8(E8(t))),!~dL(r,"g")))throw new ame("`.matchAll` does not allow non-global regexes");if(hL)return XA(d,t);if((a=Zfe(t,ime))===void 0&&Jfe(t)==="RegExp"&&(a=w8),a)return m8(a,t,d)}else if(hL)return XA(d,t);return s=zw(d),c=new RegExp(t,"g"),m8(w8,c,s)}});var lme=mc("String","matchAll"),ume=N,dme=lme,pL=String.prototype,hme=function(t){var r=t.matchAll;return typeof t=="string"||t===pL||ume(pL,t)&&r===pL.matchAll?dme:r},pme=l(hme);function T8(t){function r(s,a,c,d){let h=s[d++];if(h==="__proto__")return!0;const m=Number.isFinite(+h),g=d>=s.length;return h=!h&&ht.isArray(c)?c.length:h,g?(ht.hasOwnProp(c,h)?c[h]=[c[h],a]:c[h]=a,!m):(c[h]&&ht.isObject(c[h])||(c[h]=[]),r(s,a,c[h],d)&&ht.isArray(c[h])&&(c[h]=function(E){const b={},I=Object.keys(E);let A;const k=I.length;let W;for(A=0;A<k;A++)W=I[A],b[W]=E[W];return b}(c[h])),!m)}if(ht.isFormData(t)&&ht.isFunction(t.entries)){const s={};return ht.forEachEntry(t,(a,c)=>{r(function(d){return pme(ht).call(ht,/\w+|\[(\w*)]/g,d).map(h=>h[0]==="[]"?"":h[1]||h[0])}(a),c,s,0)}),s}return null}const fL={transitional:J6,adapter:["xhr","http","fetch"],transformRequest:[function(t,r){const s=r.getContentType()||"",a=s.indexOf("application/json")>-1,c=ht.isObject(t);if(c&&ht.isHTMLForm(t)&&(t=new FormData(t)),ht.isFormData(t))return a?JSON.stringify(T8(t)):t;if(ht.isArrayBuffer(t)||ht.isBuffer(t)||ht.isStream(t)||ht.isFile(t)||ht.isBlob(t)||ht.isReadableStream(t))return t;if(ht.isArrayBufferView(t))return t.buffer;if(ht.isURLSearchParams(t))return r.setContentType("application/x-www-form-urlencoded;charset=utf-8",!1),t.toString();let d;if(c){if(s.indexOf("application/x-www-form-urlencoded")>-1)return function(h,m){return jA(h,new qa.classes.URLSearchParams,Object.assign({visitor:function(g,E,b,I){return qa.isNode&&ht.isBuffer(g)?(this.append(E,g.toString("base64")),!1):I.defaultVisitor.apply(this,arguments)}},m))}(t,this.formSerializer).toString();if((d=ht.isFileList(t))||s.indexOf("multipart/form-data")>-1){const h=this.env&&this.env.FormData;return jA(d?{"files[]":t}:t,h&&new h,this.formSerializer)}}return c||a?(r.setContentType("application/json",!1),function(h,m,g){if(ht.isString(h))try{return(m||JSON.parse)(h),Ao(ht).call(ht,h)}catch(E){if(E.name!=="SyntaxError")throw E}return(g||JSON.stringify)(h)}(t)):t}],transformResponse:[function(t){const r=this.transitional||fL.transitional,s=r&&r.forcedJSONParsing,a=this.responseType==="json";if(ht.isResponse(t)||ht.isReadableStream(t))return t;if(t&&ht.isString(t)&&(s&&!this.responseType||a)){const c=!(r&&r.silentJSONParsing)&&a;try{return JSON.parse(t)}catch(d){if(c)throw d.name==="SyntaxError"?gr.from(d,gr.ERR_BAD_RESPONSE,this,null,this.response):d}}return t}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:qa.classes.FormData,Blob:qa.classes.Blob},validateStatus:function(t){return t>=200&&t<300},headers:{common:{Accept:"application/json, text/plain, */*","Content-Type":void 0}}};ht.forEach(["delete","get","head","post","put","patch"],t=>{fL.headers[t]={}});var mL=fL;const fme=ht.toObjectSet(["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"]),C8=Symbol("internals");function Ww(t){var r;return t&&Ao(r=String(t)).call(r).toLowerCase()}function JA(t){return t===!1||t==null?t:ht.isArray(t)?t.map(JA):String(t)}function gL(t,r,s,a,c){return ht.isFunction(a)?a.call(this,r,s):(c&&(r=s),ht.isString(r)?ht.isString(a)?r.indexOf(a)!==-1:ht.isRegExp(a)?a.test(r):void 0:void 0)}class QA{constructor(r){r&&this.set(r)}set(r,s,a){const c=this;function d(g,E,b){const I=Ww(E);if(!I)throw new Error("header name must be a non-empty string");const A=ht.findKey(c,I);(!A||c[A]===void 0||b===!0||b===void 0&&c[A]!==!1)&&(c[A||E]=JA(g))}const h=(g,E)=>ht.forEach(g,(b,I)=>d(b,I,E));if(ht.isPlainObject(r)||r instanceof this.constructor)h(r,s);else if(ht.isString(r)&&(r=Ao(r).call(r))&&!/^[-_a-zA-Z0-9^`|~,!#$%&'*+.]+$/.test(Ao(m=r).call(m)))h((g=>{const E={};let b,I,A;return g&&g.split(`
`).forEach(function(k){var W,j;A=k.indexOf(":"),b=Ao(W=k.substring(0,A)).call(W).toLowerCase(),I=Ao(j=k.substring(A+1)).call(j),!b||E[b]&&fme[b]||(b==="set-cookie"?E[b]?E[b].push(I):E[b]=[I]:E[b]=E[b]?E[b]+", "+I:I)}),E})(r),s);else if(ht.isObject(r)&&ht.isIterable(r)){let g,E,b={};for(const I of r){if(!ht.isArray(I))throw TypeError("Object iterator must return a key-value pair");b[E=I[0]]=(g=b[E])?ht.isArray(g)?[...g,I[1]]:[g,I[1]]:I[1]}h(b,s)}else r!=null&&d(s,r,a);var m;return this}get(r,s){if(r=Ww(r)){const a=ht.findKey(this,r);if(a){const c=this[a];if(!s)return c;if(s===!0)return function(d){const h=Object.create(null),m=/([^\s,;=]+)\s*(?:=\s*([^,;]+))?/g;let g;for(;g=m.exec(d);)h[g[1]]=g[2];return h}(c);if(ht.isFunction(s))return s.call(this,c,a);if(ht.isRegExp(s))return s.exec(c);throw new TypeError("parser must be boolean|regexp|function")}}}has(r,s){if(r=Ww(r)){const a=ht.findKey(this,r);return!(!a||this[a]===void 0||s&&!gL(0,this[a],a,s))}return!1}delete(r,s){const a=this;let c=!1;function d(h){if(h=Ww(h)){const m=ht.findKey(a,h);!m||s&&!gL(0,a[m],m,s)||(delete a[m],c=!0)}}return ht.isArray(r)?r.forEach(d):d(r),c}clear(r){const s=Object.keys(this);let a=s.length,c=!1;for(;a--;){const d=s[a];r&&!gL(0,this[d],d,r,!0)||(delete this[d],c=!0)}return c}normalize(r){const s=this,a={};return ht.forEach(this,(c,d)=>{var h;const m=ht.findKey(a,d);if(m)return s[m]=JA(c),void delete s[d];const g=r?function(E){return Ao(E).call(E).toLowerCase().replace(/([a-z\d])(\w*)/g,(b,I,A)=>I.toUpperCase()+A)}(d):Ao(h=String(d)).call(h);g!==d&&delete s[d],s[g]=JA(c),a[g]=!0}),this}concat(){for(var r=arguments.length,s=new Array(r),a=0;a<r;a++)s[a]=arguments[a];return this.constructor.concat(this,...s)}toJSON(r){const s=Object.create(null);return ht.forEach(this,(a,c)=>{a!=null&&a!==!1&&(s[c]=r&&ht.isArray(a)?a.join(", "):a)}),s}[Symbol.iterator](){return Object.entries(this.toJSON())[Symbol.iterator]()}toString(){return Object.entries(this.toJSON()).map(r=>{let[s,a]=r;return s+": "+a}).join(`
`)}getSetCookie(){return this.get("set-cookie")||[]}get[Symbol.toStringTag](){return"AxiosHeaders"}static from(r){return r instanceof this?r:new this(r)}static concat(r){const s=new this(r);for(var a=arguments.length,c=new Array(a>1?a-1:0),d=1;d<a;d++)c[d-1]=arguments[d];return c.forEach(h=>s.set(h)),s}static accessor(r){const s=(this[C8]=this[C8]={accessors:{}}).accessors,a=this.prototype;function c(d){const h=Ww(d);s[h]||(function(m,g){const E=ht.toCamelCase(" "+g);["get","set","has"].forEach(b=>{Object.defineProperty(m,b+E,{value:function(I,A,k){return this[b].call(this,g,I,A,k)},configurable:!0})})}(a,d),s[h]=!0)}return ht.isArray(r)?r.forEach(c):c(r),this}}QA.accessor(["Content-Type","Content-Length","Accept","Accept-Encoding","User-Agent","Authorization"]),ht.reduceDescriptors(QA.prototype,(t,r)=>{let{value:s}=t,a=r[0].toUpperCase()+r.slice(1);return{get:()=>s,set(c){this[a]=c}}}),ht.freezeMethods(QA);var Fd=QA;function _L(t,r){const s=this||mL,a=r||s,c=Fd.from(a.headers);let d=a.data;return ht.forEach(t,function(h){d=h.call(s,d,c.normalize(),r?r.status:void 0)}),c.normalize(),d}function R8(t){return!(!t||!t.__CANCEL__)}function Uv(t,r,s){gr.call(this,t??"canceled",gr.ERR_CANCELED,r,s),this.name="CanceledError"}function I8(t,r,s){const a=s.config.validateStatus;s.status&&a&&!a(s.status)?r(new gr("Request failed with status code "+s.status,[gr.ERR_BAD_REQUEST,gr.ERR_BAD_RESPONSE][Math.floor(s.status/100)-4],s.config,s.request,s)):t(s)}ht.inherits(Uv,gr,{__CANCEL__:!0});const ZA=function(t,r){let s=arguments.length>2&&arguments[2]!==void 0?arguments[2]:3,a=0;const c=function(d,h){d=d||10;const m=new Array(d),g=new Array(d);let E,b=0,I=0;return h=h!==void 0?h:1e3,function(A){const k=Date.now(),W=g[I];E||(E=k),m[b]=A,g[b]=k;let j=I,B=0;for(;j!==b;)B+=m[j++],j%=d;if(b=(b+1)%d,b===I&&(I=(I+1)%d),k-E<h)return;const ee=W&&k-W;return ee?Math.round(1e3*B/ee):void 0}}(50,250);return function(d,h){let m,g,E=0,b=1e3/h;const I=function(A){E=arguments.length>1&&arguments[1]!==void 0?arguments[1]:Date.now(),m=null,g&&(clearTimeout(g),g=null),d.apply(null,A)};return[function(){const A=Date.now(),k=A-E;for(var W=arguments.length,j=new Array(W),B=0;B<W;B++)j[B]=arguments[B];k>=b?I(j,A):(m=j,g||(g=setTimeout(()=>{g=null,I(m)},b-k)))},()=>m&&I(m)]}(d=>{const h=d.loaded,m=d.lengthComputable?d.total:void 0,g=h-a,E=c(g);a=h,t({loaded:h,total:m,progress:m?h/m:void 0,bytes:g,rate:E||void 0,estimated:E&&m&&h<=m?(m-h)/E:void 0,event:d,lengthComputable:m!=null,[r?"download":"upload"]:!0})},s)},A8=(t,r)=>{const s=t!=null;return[a=>r[0]({lengthComputable:s,total:t,loaded:a}),r[1]]},P8=t=>function(){for(var r=arguments.length,s=new Array(r),a=0;a<r;a++)s[a]=arguments[a];return ht.asap(()=>t(...s))};var mme=qa.hasStandardBrowserEnv?((t,r)=>s=>(s=new IA(s,qa.origin),t.protocol===s.protocol&&t.host===s.host&&(r||t.port===s.port)))(new IA(qa.origin),qa.navigator&&/(msie|trident)/i.test(qa.navigator.userAgent)):()=>!0,gme=qa.hasStandardBrowserEnv?{write(t,r,s,a,c,d){const h=[t+"="+encodeURIComponent(r)];ht.isNumber(s)&&h.push("expires="+new Date(s).toGMTString()),ht.isString(a)&&h.push("path="+a),ht.isString(c)&&h.push("domain="+c),d===!0&&h.push("secure"),document.cookie=h.join("; ")},read(t){const r=document.cookie.match(new RegExp("(^|;\\s*)("+t+")=([^;]*)"));return r?decodeURIComponent(r[3]):null},remove(t){this.write(t,"",Date.now()-864e5)}}:{write(){},read:()=>null,remove(){}};function k8(t,r,s){let a=!function(c){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(c)}(r);return t&&(a||s==0)?function(c,d){return d?c.replace(/\/?\/$/,"")+"/"+d.replace(/^\/+/,""):c}(t,r):r}function O8(t,r){var s=Object.keys(t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);r&&(a=a.filter(function(c){return Object.getOwnPropertyDescriptor(t,c).enumerable})),s.push.apply(s,a)}return s}const N8=t=>t instanceof Fd?function(r){for(var s=1;s<arguments.length;s++){var a=arguments[s]!=null?arguments[s]:{};s%2?O8(Object(a),!0).forEach(function(c){Y(r,c,a[c])}):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(a)):O8(Object(a)).forEach(function(c){Object.defineProperty(r,c,Object.getOwnPropertyDescriptor(a,c))})}return r}({},t):t;function Q_(t,r){r=r||{};const s={};function a(E,b,I,A){return ht.isPlainObject(E)&&ht.isPlainObject(b)?ht.merge.call({caseless:A},E,b):ht.isPlainObject(b)?ht.merge({},b):ht.isArray(b)?b.slice():b}function c(E,b,I,A){return ht.isUndefined(b)?ht.isUndefined(E)?void 0:a(void 0,E,0,A):a(E,b,0,A)}function d(E,b){if(!ht.isUndefined(b))return a(void 0,b)}function h(E,b){return ht.isUndefined(b)?ht.isUndefined(E)?void 0:a(void 0,E):a(void 0,b)}function m(E,b,I){return I in r?a(E,b):I in t?a(void 0,E):void 0}const g={url:d,method:d,data:d,baseURL:h,transformRequest:h,transformResponse:h,paramsSerializer:h,timeout:h,timeoutMessage:h,withCredentials:h,withXSRFToken:h,adapter:h,responseType:h,xsrfCookieName:h,xsrfHeaderName:h,onUploadProgress:h,onDownloadProgress:h,decompress:h,maxContentLength:h,maxBodyLength:h,beforeRedirect:h,transport:h,httpAgent:h,httpsAgent:h,cancelToken:h,socketPath:h,responseEncoding:h,validateStatus:m,headers:(E,b,I)=>c(N8(E),N8(b),0,!0)};return ht.forEach(Object.keys(Object.assign({},t,r)),function(E){const b=g[E]||c,I=b(t[E],r[E],E);ht.isUndefined(I)&&b!==m||(s[E]=I)}),s}var D8=t=>{const r=Q_({},t);let s,{data:a,withXSRFToken:c,xsrfHeaderName:d,xsrfCookieName:h,headers:m,auth:g}=r;if(r.headers=m=Fd.from(m),r.url=Y6(k8(r.baseURL,r.url,r.allowAbsoluteUrls),t.params,t.paramsSerializer),g&&m.set("Authorization","Basic "+btoa((g.username||"")+":"+(g.password?unescape(encodeURIComponent(g.password)):""))),ht.isFormData(a)){if(qa.hasStandardBrowserEnv||qa.hasStandardBrowserWebWorkerEnv)m.setContentType(void 0);else if((s=m.getContentType())!==!1){const[E,...b]=s?s.split(";").map(I=>Ao(I).call(I)).filter(Boolean):[];m.setContentType([E||"multipart/form-data",...b].join("; "))}}if(qa.hasStandardBrowserEnv&&(c&&ht.isFunction(c)&&(c=c(r)),c||c!==!1&&mme(r.url))){const E=d&&h&&gme.read(h);E&&m.set(d,E)}return r},_me=typeof XMLHttpRequest<"u"&&function(t){return new pt(function(r,s){const a=D8(t);let c=a.data;const d=Fd.from(a.headers).normalize();let h,m,g,E,b,{responseType:I,onUploadProgress:A,onDownloadProgress:k}=a;function W(){E&&E(),b&&b(),a.cancelToken&&a.cancelToken.unsubscribe(h),a.signal&&a.signal.removeEventListener("abort",h)}let j=new XMLHttpRequest;function B(){if(!j)return;const Z=Fd.from("getAllResponseHeaders"in j&&j.getAllResponseHeaders());I8(function(oe){r(oe),W()},function(oe){s(oe),W()},{data:I&&I!=="text"&&I!=="json"?j.response:j.responseText,status:j.status,statusText:j.statusText,headers:Z,config:t,request:j}),j=null}j.open(a.method.toUpperCase(),a.url,!0),j.timeout=a.timeout,"onloadend"in j?j.onloadend=B:j.onreadystatechange=function(){j&&j.readyState===4&&(j.status!==0||j.responseURL&&j.responseURL.indexOf("file:")===0)&&setTimeout(B)},j.onabort=function(){j&&(s(new gr("Request aborted",gr.ECONNABORTED,t,j)),j=null)},j.onerror=function(){s(new gr("Network Error",gr.ERR_NETWORK,t,j)),j=null},j.ontimeout=function(){let Z=a.timeout?"timeout of "+a.timeout+"ms exceeded":"timeout exceeded";const oe=a.transitional||J6;a.timeoutErrorMessage&&(Z=a.timeoutErrorMessage),s(new gr(Z,oe.clarifyTimeoutError?gr.ETIMEDOUT:gr.ECONNABORTED,t,j)),j=null},c===void 0&&d.setContentType(null),"setRequestHeader"in j&&ht.forEach(d.toJSON(),function(Z,oe){j.setRequestHeader(oe,Z)}),ht.isUndefined(a.withCredentials)||(j.withCredentials=!!a.withCredentials),I&&I!=="json"&&(j.responseType=a.responseType),k&&([g,b]=ZA(k,!0),j.addEventListener("progress",g)),A&&j.upload&&([m,E]=ZA(A),j.upload.addEventListener("progress",m),j.upload.addEventListener("loadend",E)),(a.cancelToken||a.signal)&&(h=Z=>{j&&(s(!Z||Z.type?new Uv(null,t,j):Z),j.abort(),j=null)},a.cancelToken&&a.cancelToken.subscribe(h),a.signal&&(a.signal.aborted?h():a.signal.addEventListener("abort",h)));const ee=function(Z){const oe=/^([-+\w]{1,25})(:?\/\/|:)/.exec(Z);return oe&&oe[1]||""}(a.url);ee&&qa.protocols.indexOf(ee)===-1?s(new gr("Unsupported protocol "+ee+":",gr.ERR_BAD_REQUEST,t)):j.send(c||null)})},yme=(t,r)=>{const{length:s}=t=t?t.filter(Boolean):[];if(r||s){let a,c=new AbortController;const d=function(E){if(!a){a=!0,m();const b=E instanceof Error?E:this.reason;c.abort(b instanceof gr?b:new Uv(b instanceof Error?b.message:b))}};let h=r&&setTimeout(()=>{h=null,d(new gr("timeout ".concat(r," of ms exceeded"),gr.ETIMEDOUT))},r);const m=()=>{t&&(h&&clearTimeout(h),h=null,t.forEach(E=>{E.unsubscribe?E.unsubscribe(d):E.removeEventListener("abort",d)}),t=null)};t.forEach(E=>E.addEventListener("abort",d));const{signal:g}=c;return g.unsubscribe=()=>ht.asap(m),g}},yL=l(v4),x8=Nv.f("asyncIterator"),Eme=l(x8);function EL(t,r){this.v=t,this.k=r}function jl(t){return function(){return new Gw(t.apply(this,arguments))}}function Gw(t){var r,s;function a(d,h){try{var m=t[d](h),g=m.value,E=g instanceof EL;yL.resolve(E?g.v:g).then(function(b){if(E){var I=d==="return"?"return":"next";if(!g.k||b.done)return a(I,b);b=t[I](b).value}c(m.done?"return":"normal",b)},function(b){a("throw",b)})}catch(b){c("throw",b)}}function c(d,h){switch(d){case"return":r.resolve({value:h,done:!0});break;case"throw":r.reject(h);break;default:r.resolve({value:h,done:!1})}(r=r.next)?a(r.key,r.arg):s=null}this._invoke=function(d,h){return new yL(function(m,g){var E={key:d,arg:h,resolve:m,reject:g,next:null};s?s=s.next=E:(r=s=E,a(d,h))})},typeof t.return!="function"&&(this.return=void 0)}function Fn(t){return new EL(t,0)}function eP(t){var r={},s=!1;function a(c,d){return s=!0,d=new yL(function(h){h(t[c](d))}),{done:!1,value:new EL(d,1)}}return r[Mv!==void 0&&c8||"@@iterator"]=function(){return this},r.next=function(c){return s?(s=!1,c):a("next",c)},typeof t.throw=="function"&&(r.throw=function(c){if(s)throw s=!1,c;return a("throw",c)}),typeof t.return=="function"&&(r.return=function(c){return s?(s=!1,c):a("return",c)}),r}Gw.prototype[typeof Mv=="function"&&Eme||"@@asyncIterator"]=function(){return this},Gw.prototype.next=function(t){return this._invoke("next",t)},Gw.prototype.throw=function(t){return this._invoke("throw",t)},Gw.prototype.return=function(t){return this._invoke("return",t)};var vL=l(x8);function SL(t){var r,s,a,c=2;for(typeof Symbol<"u"&&(s=vL,a=Symbol.iterator);c--;){if(s&&(r=t[s])!=null)return r.call(t);if(a&&(r=t[a])!=null)return new tP(r.call(t));s="@@asyncIterator",a="@@iterator"}throw new TypeError("Object is not async iterable")}function tP(t){function r(s){if(Object(s)!==s)return pt.reject(new TypeError(s+" is not an object."));var a=s.done;return pt.resolve(s.value).then(function(c){return{value:c,done:a}})}return tP=function(s){this.s=s,this.n=s.next},tP.prototype={s:null,n:null,next:function(){return r(this.n.apply(this.s,arguments))},return:function(s){var a=this.s.return;return a===void 0?pt.resolve({value:s,done:!0}):r(a.apply(this.s,arguments))},throw:function(s){var a=this.s.return;return a===void 0?pt.reject(s):r(a.apply(this.s,arguments))}},new tP(t)}const vme=function*(t,r){let s=t.byteLength;if(!r||s<r)return void(yield t);let a,c=0;for(;c<s;)a=c+r,yield t.slice(c,a),c=a},Sme=function(){var t=jl(function*(r,s){var a,c=!1,d=!1;try{for(var h,m=SL(bme(r));c=!(h=yield Fn(m.next())).done;c=!1){const g=h.value;yield*eP(SL(vme(g,s)))}}catch(g){d=!0,a=g}finally{try{c&&m.return!=null&&(yield Fn(m.return()))}finally{if(d)throw a}}});return function(r,s){return t.apply(this,arguments)}}(),bme=function(){var t=jl(function*(r){if(r[vL])return void(yield*eP(SL(r)));const s=r.getReader();try{for(;;){const{done:a,value:c}=yield Fn(s.read());if(a)break;yield c}}finally{yield Fn(s.cancel())}});return function(r){return t.apply(this,arguments)}}(),L8=(t,r,s,a)=>{const c=Sme(t,r);let d,h=0,m=g=>{d||(d=!0,a&&a(g))};return new ReadableStream({async pull(g){try{const{done:E,value:b}=await c.next();if(E)return m(),void g.close();let I=b.byteLength;if(s){let A=h+=I;s(A)}g.enqueue(new Uint8Array(b))}catch(E){throw m(E),E}},cancel:g=>(m(g),c.return())},{highWaterMark:2})};function M8(t,r){var s=Object.keys(t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);r&&(a=a.filter(function(c){return Object.getOwnPropertyDescriptor(t,c).enumerable})),s.push.apply(s,a)}return s}function U8(t){for(var r=1;r<arguments.length;r++){var s=arguments[r]!=null?arguments[r]:{};r%2?M8(Object(s),!0).forEach(function(a){Y(t,a,s[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(s)):M8(Object(s)).forEach(function(a){Object.defineProperty(t,a,Object.getOwnPropertyDescriptor(s,a))})}return t}const nP=typeof fetch=="function"&&typeof Request=="function"&&typeof Response=="function",V8=nP&&typeof ReadableStream=="function",wme=nP&&(typeof TextEncoder=="function"?(F8=new TextEncoder,t=>F8.encode(t)):async t=>new Uint8Array(await new Response(t).arrayBuffer()));var F8;const j8=function(t){try{for(var r=arguments.length,s=new Array(r>1?r-1:0),a=1;a<r;a++)s[a-1]=arguments[a];return!!t(...s)}catch{return!1}},Tme=V8&&j8(()=>{let t=!1;const r=new Request(qa.origin,{body:new ReadableStream,method:"POST",get duplex(){return t=!0,"half"}}).headers.has("Content-Type");return t&&!r}),bL=V8&&j8(()=>ht.isReadableStream(new Response("").body)),rP={stream:bL&&(t=>t.body)};var B8;nP&&(B8=new Response,["text","arrayBuffer","blob","formData","stream"].forEach(t=>{!rP[t]&&(rP[t]=ht.isFunction(B8[t])?r=>r[t]():(r,s)=>{throw new gr("Response type '".concat(t,"' is not supported"),gr.ERR_NOT_SUPPORT,s)})}));const Cme=async(t,r)=>{const s=ht.toFiniteNumber(t.getContentLength());return s??(async a=>a==null?0:ht.isBlob(a)?a.size:ht.isSpecCompliantForm(a)?(await new Request(qa.origin,{method:"POST",body:a}).arrayBuffer()).byteLength:ht.isArrayBufferView(a)||ht.isArrayBuffer(a)?a.byteLength:(ht.isURLSearchParams(a)&&(a+=""),ht.isString(a)?(await wme(a)).byteLength:void 0))(r)};var Rme=nP&&(async t=>{let{url:r,method:s,data:a,signal:c,cancelToken:d,timeout:h,onDownloadProgress:m,onUploadProgress:g,responseType:E,headers:b,withCredentials:I="same-origin",fetchOptions:A}=D8(t);E=E?(E+"").toLowerCase():"text";let k,W=yme([c,d&&d.toAbortSignal()],h);const j=W&&W.unsubscribe&&(()=>{W.unsubscribe()});let B;try{if(g&&Tme&&s!=="get"&&s!=="head"&&(B=await Cme(b,a))!==0){let _e,ue=new Request(r,{method:"POST",body:a,duplex:"half"});if(ht.isFormData(a)&&(_e=ue.headers.get("content-type"))&&b.setContentType(_e),ue.body){const[Ce,Ue]=A8(B,ZA(P8(g)));a=L8(ue.body,65536,Ce,Ue)}}ht.isString(I)||(I=I?"include":"omit");const ee="credentials"in Request.prototype;k=new Request(r,U8(U8({},A),{},{signal:W,method:s.toUpperCase(),headers:b.normalize().toJSON(),body:a,duplex:"half",credentials:ee?I:void 0}));let Z=await fetch(k);const oe=bL&&(E==="stream"||E==="response");if(bL&&(m||oe&&j)){const _e={};["status","statusText","headers"].forEach(ze=>{_e[ze]=Z[ze]});const ue=ht.toFiniteNumber(Z.headers.get("content-length")),[Ce,Ue]=m&&A8(ue,ZA(P8(m),!0))||[];Z=new Response(L8(Z.body,65536,Ce,()=>{Ue&&Ue(),j&&j()}),_e)}E=E||"text";let ye=await rP[ht.findKey(rP,E)||"text"](Z,t);return!oe&&j&&j(),await new pt((_e,ue)=>{I8(_e,ue,{data:ye,headers:Fd.from(Z.headers),status:Z.status,statusText:Z.statusText,config:t,request:k})})}catch(ee){throw j&&j(),ee&&ee.name==="TypeError"&&/Load failed|fetch/i.test(ee.message)?Object.assign(new gr("Network Error",gr.ERR_NETWORK,t,k),{cause:ee.cause||ee}):gr.from(ee,ee&&ee.code,t,k)}});const wL={http:null,xhr:_me,fetch:Rme};ht.forEach(wL,(t,r)=>{if(t){try{Object.defineProperty(t,"name",{value:r})}catch{}Object.defineProperty(t,"adapterName",{value:r})}});const z8=t=>"- ".concat(t),Ime=t=>ht.isFunction(t)||t===null||t===!1;var W8={getAdapter:t=>{t=ht.isArray(t)?t:[t];const{length:r}=t;let s,a;const c={};for(let d=0;d<r;d++){let h;if(s=t[d],a=s,!Ime(s)&&(a=wL[(h=String(s)).toLowerCase()],a===void 0))throw new gr("Unknown adapter '".concat(h,"'"));if(a)break;c[h||"#"+d]=a}if(!a){const d=Object.entries(c).map(h=>{let[m,g]=h;return"adapter ".concat(m," ")+(g===!1?"is not supported by the environment":"is not available in the build")});throw new gr("There is no suitable adapter to dispatch the request "+(r?d.length>1?`since :
`+d.map(z8).join(`
`):" "+z8(d[0]):"as no adapter specified"),"ERR_NOT_SUPPORT")}return a},adapters:wL};function TL(t){if(t.cancelToken&&t.cancelToken.throwIfRequested(),t.signal&&t.signal.aborted)throw new Uv(null,t)}function G8(t){return TL(t),t.headers=Fd.from(t.headers),t.data=_L.call(t,t.transformRequest),["post","put","patch"].indexOf(t.method)!==-1&&t.headers.setContentType("application/x-www-form-urlencoded",!1),W8.getAdapter(t.adapter||mL.adapter)(t).then(function(r){return TL(t),r.data=_L.call(t,t.transformResponse,r),r.headers=Fd.from(r.headers),r},function(r){return R8(r)||(TL(t),r&&r.response&&(r.response.data=_L.call(t,t.transformResponse,r.response),r.response.headers=Fd.from(r.response.headers))),pt.reject(r)})}const H8="1.9.0",iP={};["object","boolean","number","function","string","symbol"].forEach((t,r)=>{iP[t]=function(s){return typeof s===t||"a"+(r<1?"n ":" ")+t}});const $8={};iP.transitional=function(t,r,s){function a(c,d){return"[Axios v"+H8+"] Transitional option '"+c+"'"+d+(s?". "+s:"")}return(c,d,h)=>{if(t===!1)throw new gr(a(d," has been removed"+(r?" in "+r:"")),gr.ERR_DEPRECATED);return r&&!$8[d]&&($8[d]=!0,console.warn(a(d," has been deprecated since v"+r+" and will be removed in the near future"))),!t||t(c,d,h)}},iP.spelling=function(t){return(r,s)=>(console.warn("".concat(s," is likely a misspelling of ").concat(t)),!0)};var sP={assertOptions:function(t,r,s){if(typeof t!="object")throw new gr("options must be an object",gr.ERR_BAD_OPTION_VALUE);const a=Object.keys(t);let c=a.length;for(;c-- >0;){const d=a[c],h=r[d];if(h){const m=t[d],g=m===void 0||h(m,d,t);if(g!==!0)throw new gr("option "+d+" must be "+g,gr.ERR_BAD_OPTION_VALUE)}else if(s!==!0)throw new gr("Unknown option "+d,gr.ERR_BAD_OPTION)}},validators:iP};const zh=sP.validators;let oP=class{constructor(t){this.defaults=t||{},this.interceptors={request:new X6,response:new X6}}async request(t,r){try{return await this._request(t,r)}catch(s){if(s instanceof Error){let a={};Error.captureStackTrace?Error.captureStackTrace(a):a=new Error;const c=a.stack?a.stack.replace(/^.+\n/,""):"";try{s.stack?c&&!String(s.stack).endsWith(c.replace(/^.+\n.+\n/,""))&&(s.stack+=`
`+c):s.stack=c}catch{}}throw s}}_request(t,r){typeof t=="string"?(r=r||{}).url=t:r=t||{},r=Q_(this.defaults,r);const{transitional:s,paramsSerializer:a,headers:c}=r;s!==void 0&&sP.assertOptions(s,{silentJSONParsing:zh.transitional(zh.boolean),forcedJSONParsing:zh.transitional(zh.boolean),clarifyTimeoutError:zh.transitional(zh.boolean)},!1),a!=null&&(ht.isFunction(a)?r.paramsSerializer={serialize:a}:sP.assertOptions(a,{encode:zh.function,serialize:zh.function},!0)),r.allowAbsoluteUrls!==void 0||(this.defaults.allowAbsoluteUrls!==void 0?r.allowAbsoluteUrls=this.defaults.allowAbsoluteUrls:r.allowAbsoluteUrls=!0),sP.assertOptions(r,{baseUrl:zh.spelling("baseURL"),withXsrfToken:zh.spelling("withXSRFToken")},!0),r.method=(r.method||this.defaults.method||"get").toLowerCase();let d=c&&ht.merge(c.common,c[r.method]);c&&ht.forEach(["delete","get","head","post","put","patch","common"],k=>{delete c[k]}),r.headers=Fd.concat(d,c);const h=[];let m=!0;this.interceptors.request.forEach(function(k){typeof k.runWhen=="function"&&k.runWhen(r)===!1||(m=m&&k.synchronous,h.unshift(k.fulfilled,k.rejected))});const g=[];let E;this.interceptors.response.forEach(function(k){g.push(k.fulfilled,k.rejected)});let b,I=0;if(!m){const k=[G8.bind(this),void 0];for(k.unshift.apply(k,h),k.push.apply(k,g),b=k.length,E=pt.resolve(r);I<b;)E=E.then(k[I++],k[I++]);return E}b=h.length;let A=r;for(I=0;I<b;){const k=h[I++],W=h[I++];try{A=k(A)}catch(j){W.call(this,j);break}}try{E=G8.call(this,A)}catch(k){return pt.reject(k)}for(I=0,b=g.length;I<b;)E=E.then(g[I++],g[I++]);return E}getUri(t){return Y6(k8((t=Q_(this.defaults,t)).baseURL,t.url,t.allowAbsoluteUrls),t.params,t.paramsSerializer)}};ht.forEach(["delete","get","head","options"],function(t){oP.prototype[t]=function(r,s){return this.request(Q_(s||{},{method:t,url:r,data:(s||{}).data}))}}),ht.forEach(["post","put","patch"],function(t){function r(s){return function(a,c,d){return this.request(Q_(d||{},{method:t,headers:s?{"Content-Type":"multipart/form-data"}:{},url:a,data:c}))}}oP.prototype[t]=r(),oP.prototype[t+"Form"]=r(!0)});var aP=oP;class CL{constructor(r){if(typeof r!="function")throw new TypeError("executor must be a function.");let s;this.promise=new pt(function(c){s=c});const a=this;this.promise.then(c=>{if(!a._listeners)return;let d=a._listeners.length;for(;d-- >0;)a._listeners[d](c);a._listeners=null}),this.promise.then=c=>{let d;const h=new pt(m=>{a.subscribe(m),d=m}).then(c);return h.cancel=function(){a.unsubscribe(d)},h},r(function(c,d,h){a.reason||(a.reason=new Uv(c,d,h),s(a.reason))})}throwIfRequested(){if(this.reason)throw this.reason}subscribe(r){this.reason?r(this.reason):this._listeners?this._listeners.push(r):this._listeners=[r]}unsubscribe(r){if(!this._listeners)return;const s=this._listeners.indexOf(r);s!==-1&&this._listeners.splice(s,1)}toAbortSignal(){const r=new AbortController,s=a=>{r.abort(a)};return this.subscribe(s),r.signal.unsubscribe=()=>this.unsubscribe(s),r.signal}static source(){let r;return{token:new CL(function(a){r=a}),cancel:r}}}var Ame=CL;const RL={Continue:100,SwitchingProtocols:101,Processing:102,EarlyHints:103,Ok:200,Created:201,Accepted:202,NonAuthoritativeInformation:203,NoContent:204,ResetContent:205,PartialContent:206,MultiStatus:207,AlreadyReported:208,ImUsed:226,MultipleChoices:300,MovedPermanently:301,Found:302,SeeOther:303,NotModified:304,UseProxy:305,Unused:306,TemporaryRedirect:307,PermanentRedirect:308,BadRequest:400,Unauthorized:401,PaymentRequired:402,Forbidden:403,NotFound:404,MethodNotAllowed:405,NotAcceptable:406,ProxyAuthenticationRequired:407,RequestTimeout:408,Conflict:409,Gone:410,LengthRequired:411,PreconditionFailed:412,PayloadTooLarge:413,UriTooLong:414,UnsupportedMediaType:415,RangeNotSatisfiable:416,ExpectationFailed:417,ImATeapot:418,MisdirectedRequest:421,UnprocessableEntity:422,Locked:423,FailedDependency:424,TooEarly:425,UpgradeRequired:426,PreconditionRequired:428,TooManyRequests:429,RequestHeaderFieldsTooLarge:431,UnavailableForLegalReasons:451,InternalServerError:500,NotImplemented:501,BadGateway:502,ServiceUnavailable:503,GatewayTimeout:504,HttpVersionNotSupported:505,VariantAlsoNegotiates:506,InsufficientStorage:507,LoopDetected:508,NotExtended:510,NetworkAuthenticationRequired:511};Object.entries(RL).forEach(t=>{let[r,s]=t;RL[s]=r});var Pme=RL;const po=function t(r){const s=new aP(r),a=N6(aP.prototype.request,s);return ht.extend(a,aP.prototype,s,{allOwnKeys:!0}),ht.extend(a,s,null,{allOwnKeys:!0}),a.create=function(c){return t(Q_(r,c))},a}(mL);po.Axios=aP,po.CanceledError=Uv,po.CancelToken=Ame,po.isCancel=R8,po.VERSION=H8,po.toFormData=jA,po.AxiosError=gr,po.Cancel=po.CanceledError,po.all=function(t){return pt.all(t)},po.spread=function(t){return function(r){return t.apply(null,r)}},po.isAxiosError=function(t){return ht.isObject(t)&&t.isAxiosError===!0},po.mergeConfig=Q_,po.AxiosHeaders=Fd,po.formToJSON=t=>T8(ht.isHTMLForm(t)?new FormData(t):t),po.getAdapter=W8.getAdapter,po.HttpStatusCode=Pme,po.default=po;var Sa=po;const kme=()=>{};function Hw(){const t={promise:void 0,isResolved:!1,isRejected:!1,isFinished:!1,resolve:void 0,reject:void 0,cancel:kme};return t.promise=new pt((r,s)=>{t.resolve=a=>{t.isFinished||(t.isResolved=!0,t.isFinished=!0,r(a),t.value=a)},t.reject=a=>{t.isFinished||(t.isRejected=!0,t.isFinished=!0,s(a))}}),t}const cP=new Map,lP=new Map,Wh=new Map;let is=function(t){return t.WIN_10="Windows 10",t.WIN_81="Windows 8.1",t.WIN_8="Windows 8",t.WIN_7="Windows 7",t.WIN_VISTA="Windows Vista",t.WIN_SERVER_2003="Windows Server 2003",t.WIN_XP="Windows XP",t.WIN_2000="Windows 2000",t.ANDROID="Android",t.HARMONY_OS="HarmonyOS",t.OPEN_BSD="Open BSD",t.SUN_OS="Sun OS",t.LINUX="Linux",t.IOS="iOS",t.MAC_OS="Mac OS",t.CHROMIUM_OS="Chromium OS",t.QNX="QNX",t.UNIX="UNIX",t.BEOS="BeOS",t.OS_2="OS/2",t.SEARCH_BOT="Search Bot",t}({}),Hn=function(t){return t.CHROME="Chrome",t.SAFARI="Safari",t.EDGE="Edge",t.FIREFOX="Firefox",t.OPERA="OPR",t.QQ="QQBrowser",t.WECHAT="MicroMessenger",t}({});const K8=new ohe;let jd=K8.getResult(),IL=null;function xn(t){if(!IL){jd=K8.getResult();const r=function(m){if(m.engine.name==="Blink"&&m.browser.name!=="WeChat")return Hn.CHROME;switch(m.browser.name){case"Chrome Headless":case"Chrome":case"Chromium":return Hn.CHROME;case"Safari":case"Mobile Safari":return Hn.SAFARI;case"Edge":return Hn.EDGE;case"Firefox":return Hn.FIREFOX;case"QQ":case"QQBrowser":return Hn.QQ;case"Opera":return Hn.OPERA;case"WeChat":return Hn.WECHAT;default:return m.browser.name||""}}(jd),s=q8(jd),a=function(m){return m.os.name==="Windows"?m.os.version?m.os.name+" "+m.os.version:m.os.name:m.os.name||""}(jd),c=jd.os.version,d=q8(jd,!1),h=jd.device.type;if(!(r&&s&&a&&c))return{name:r,version:s,os:a,osVersion:c,browserVersion:d,deviceType:h};IL={name:r,version:s,os:a,osVersion:c,browserVersion:d,deviceType:h}}return IL}function q8(t){let r,s=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1];return r=t.engine.name==="Blink"?t.engine.version||"":t.browser.version||"",s?r.split(".")[0]:r}function uP(){return xn().os}function Y8(){const t=xn();return"".concat(t.os," ").concat(t.osVersion)}function dP(){const t=xn();return!!(jd.engine.name==="WebKit"&&t.os===is.MAC_OS&&navigator.maxTouchPoints&&navigator.maxTouchPoints>0&&t.name!==Hn.SAFARI||fo()&&t.name!==Hn.SAFARI)}function cf(){return xn().name===Hn.CHROME}function xs(){return xn().name===Hn.SAFARI}function X8(){const t=xn();if(t.name!==Hn.SAFARI||!t.browserVersion)return!1;const r=t.browserVersion.split(".");return Number(r[0])>15||Number(r[0])===15&&Number(r[1])>=4}function J8(){return xn().name===Hn.EDGE}function ni(){return xn().name===Hn.FIREFOX}function fo(){return xn().os===is.IOS}function Vv(t){const r=xn();return!(r.name!==Hn.CHROME||!r.osVersion)&&Number(r.version)>=t}function Q8(t){const r=xn();return!(r.name!==Hn.CHROME||!r.osVersion)&&Number(r.version)<t}function AL(t,r,s){const a=xn();return!(a.name!==t||!a.osVersion)&&(s?Number(a.version)>=r&&Number(a.version)<=s:Number(a.version)===r)}function PL(t){const r=xn();return!(r.name!==Hn.EDGE||!r.osVersion)&&Number(r.version)>=t}function kL(t){const r=xn();return!(r.name!==Hn.FIREFOX||!r.osVersion)&&Number(r.version)>=t}function Z8(t){const r=xn();return!(r.name!==Hn.SAFARI||!r.osVersion)&&Number(r.version)>=t}function eW(t,r,s){const a=xn();if(a.os!==is.IOS||!a.osVersion)return!1;const c=a.osVersion.split(".");return s?r&&Number(c[0])===t&&Number(c[1])>r||Number(c[0])>t:r?Number(c[0])===t&&Number(c[1])>=r||Number(c[0])>t:Number(c[0])>=t}function tW(t,r,s){const a=xn();if(a.os!==is.IOS||!a.osVersion)return!1;const c=a.osVersion.split(".");return r&&Number(c[0])===t&&Number(c[1])<r||Number(c[0])<t}function OL(t,r,s){const a=xn();if(a.name!==Hn.SAFARI||!a.osVersion||!a.browserVersion)return!1;const c=a.browserVersion.split(".");return s?r&&Number(c[0])===t&&Number(c[1])<r||Number(c[0])<t:r?Number(c[0])===t&&Number(c[1])<=r||Number(c[0])<t:Number(c[0])<=t}function NL(t){const r=xn();return!(r.name!==Hn.OPERA||!r.osVersion)&&Number(r.version)>=t}function nW(){const t=xn();if(t.os!==is.IOS||!t.osVersion)return!1;const r=t.osVersion.split(".");return Number(r[0])<14||Number(r[0])===14&&Number(r[1])<=6}function Fv(){const t=xn();if(t.os!==is.IOS||!t.osVersion)return!1;const r=t.osVersion.split(".");return Number(r[0])===15}function DL(){const t=xn();if(t.os!==is.IOS||!t.osVersion)return!1;const r=t.osVersion.split(".");return Number(r[0])===16}function rW(){const t=xn();if(t.os!==is.IOS||!t.osVersion)return!1;const r=t.osVersion.split(".");return Number(r[0])===15&&Number(r[1])>=1}function xu(){return xs()&&navigator.maxTouchPoints>0}function iW(){return xn().name===Hn.WECHAT}function sW(){return window.navigator.appVersion&&window.navigator.appVersion.match(/Chrome\/([\w\W]*?)\./)!==null&&window.navigator.appVersion.match(/Chrome\/([\w\W]*?)\./)[1]<=35}function xL(){const t=uP();return function(){const{deviceType:r}=xn();return r==="mobile"||r==="tablet"}()||t===is.ANDROID||t===is.IOS||t===is.HARMONY_OS}function lf(){const t=xn();return t.name!==Hn.EDGE&&t.name!==Hn.SAFARI&&!!navigator.userAgent.toLocaleLowerCase().match(/chrome\/[\d]./i)}function hP(){return uP()===is.ANDROID}function $w(){const t=xn();return hP()&&(t.name===Hn.CHROME||t.name===Hn.WECHAT||/chrome|chromium/i.test(navigator.userAgent))}function Qt(t,r,s){return(r=function(a){var c=function(d,h){if(typeof d!="object"||!d)return d;var m=d[Symbol.toPrimitive];if(m!==void 0){var g=m.call(d,"string");if(typeof g!="object")return g;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(d)}(a);return typeof c=="symbol"?c:c+""}(r))in t?Object.defineProperty(t,r,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[r]=s,t}function oW(t,r){var s=Object.keys(t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);r&&(a=a.filter(function(c){return Object.getOwnPropertyDescriptor(t,c).enumerable})),s.push.apply(s,a)}return s}function Qe(t){for(var r=1;r<arguments.length;r++){var s=arguments[r]!=null?arguments[r]:{};r%2?oW(Object(s),!0).forEach(function(a){Qt(t,a,s[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(s)):oW(Object(s)).forEach(function(a){Object.defineProperty(t,a,Object.getOwnPropertyDescriptor(s,a))})}return t}let te=function(t){return t.UNEXPECTED_ERROR="UNEXPECTED_ERROR",t.UNEXPECTED_RESPONSE="UNEXPECTED_RESPONSE",t.TIMEOUT="TIMEOUT",t.INVALID_PARAMS="INVALID_PARAMS",t.NOT_READABLE="NOT_READABLE",t.NOT_SUPPORTED="NOT_SUPPORTED",t.INVALID_OPERATION="INVALID_OPERATION",t.OPERATION_ABORTED="OPERATION_ABORTED",t.WEB_SECURITY_RESTRICT="WEB_SECURITY_RESTRICT",t.EXCHANGE_SDP_FAILED="EXCHANGE_SDP_FAILED",t.ADD_CANDIDATE_FAILED="ADD_CANDIDATE_FAILED",t.DATACHANNEL_FAILED="DATACHANNEL_FAILED",t.NETWORK_ERROR="NETWORK_ERROR",t.NETWORK_TIMEOUT="NETWORK_TIMEOUT",t.NETWORK_RESPONSE_ERROR="NETWORK_RESPONSE_ERROR",t.API_INVOKE_TIMEOUT="API_INVOKE_TIMEOUT",t.ENUMERATE_DEVICES_FAILED="ENUMERATE_DEVICES_FAILED",t.DEVICE_NOT_FOUND="DEVICE_NOT_FOUND",t.ELECTRON_IS_NULL="ELECTRON_IS_NULL",t.ELECTRON_DESKTOP_CAPTURER_GET_SOURCES_ERROR="ELECTRON_DESKTOP_CAPTURER_GET_SOURCES_ERROR",t.CHROME_PLUGIN_NO_RESPONSE="CHROME_PLUGIN_NO_RESPONSE",t.CHROME_PLUGIN_NOT_INSTALL="CHROME_PLUGIN_NOT_INSTALL",t.MEDIA_OPTION_INVALID="MEDIA_OPTION_INVALID",t.PERMISSION_DENIED="PERMISSION_DENIED",t.CONSTRAINT_NOT_SATISFIED="CONSTRAINT_NOT_SATISFIED",t.TRACK_IS_DISABLED="TRACK_IS_DISABLED",t.GET_VIDEO_ELEMENT_VISIBLE_ERROR="GET_VIDEO_ELEMENT_VISIBLE_ERROR",t.SHARE_AUDIO_NOT_ALLOWED="SHARE_AUDIO_NOT_ALLOWED",t.LOW_STREAM_ENCODING_ERROR="LOW_STREAM_ENCODING_ERROR",t.SET_ENCODING_PARAMETER_ERROR="SET_ENCODING_PARAMETER_ERROR",t.TRACK_STATE_UNREACHABLE="TRACK_STATE_UNREACHABLE",t.INVALID_UINT_UID_FROM_STRING_UID="INVALID_UINT_UID_FROM_STRING_UID",t.CAN_NOT_GET_PROXY_SERVER="CAN_NOT_GET_PROXY_SERVER",t.CAN_NOT_GET_GATEWAY_SERVER="CAN_NOT_GET_GATEWAY_SERVER",t.VOID_GATEWAY_ADDRESS="VOID_GATEWAY_ADDRESS",t.UID_CONFLICT="UID_CONFLICT",t.MULTI_UNILBS_RESPONSE_ERROR="MULTI_UNILBS_RESPONSE_ERROR",t.UPDATE_TICKET_FAILED="UPDATE_TICKET_FAILED",t.TOKEN_EXPIRE="TOKEN_EXPIRE",t.INVALID_LOCAL_TRACK="INVALID_LOCAL_TRACK",t.INVALID_TRACK="INVALID_TRACK",t.SENDER_NOT_FOUND="SENDER_NOT_FOUND",t.CREATE_OFFER_FAILED="CREATE_OFFER_FAILED",t.SET_ANSWER_FAILED="SET_ANSWER_FAILED",t.ICE_FAILED="ICE_FAILED",t.PC_CLOSED="PC_CLOSED",t.SENDER_REPLACE_FAILED="SENDER_REPLACE_FAILED",t.GET_LOCAL_CAPABILITIES_FAILED="GET_LOCAL_CAPABILITIES_FAILED",t.GET_LOCAL_CONNECTION_PARAMS_FAILED="GET_LOCAL_CONNECTION_PARAMS_FAILED",t.SUBSCRIBE_FAILED="SUBSCRIBE_FAILED",t.UNSUBSCRIBE_FAILED="UNSUBSCRIBE_FAILED",t.GATEWAY_P2P_LOST="GATEWAY_P2P_LOST",t.NO_ICE_CANDIDATE="NO_ICE_CANDIDATE",t.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS="CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS",t.EXIST_DISABLED_VIDEO_TRACK="EXIST_DISABLED_VIDEO_TRACK",t.INVALID_REMOTE_USER="INVALID_REMOTE_USER",t.REMOTE_USER_IS_NOT_PUBLISHED="REMOTE_USER_IS_NOT_PUBLISHED",t.CUSTOM_REPORT_SEND_FAILED="CUSTOM_REPORT_SEND_FAILED",t.CUSTOM_REPORT_FREQUENCY_TOO_HIGH="CUSTOM_REPORT_FREQUENCY_TOO_HIGH",t.FETCH_AUDIO_FILE_FAILED="FETCH_AUDIO_FILE_FAILED",t.READ_LOCAL_AUDIO_FILE_ERROR="READ_LOCAL_AUDIO_FILE_ERROR",t.DECODE_AUDIO_FILE_FAILED="DECODE_AUDIO_FILE_FAILED",t.WS_ABORT="WS_ABORT",t.WS_DISCONNECT="WS_DISCONNECT",t.WS_ERR="WS_ERR",t.EXTERNAL_SIGNAL_ABORT="EXTERNAL_SIGNAL_ABORT",t.LIVE_STREAMING_TASK_CONFLICT="LIVE_STREAMING_TASK_CONFLICT",t.LIVE_STREAMING_INVALID_ARGUMENT="LIVE_STREAMING_INVALID_ARGUMENT",t.LIVE_STREAMING_INTERNAL_SERVER_ERROR="LIVE_STREAMING_INTERNAL_SERVER_ERROR",t.LIVE_STREAMING_PUBLISH_STREAM_NOT_AUTHORIZED="LIVE_STREAMING_PUBLISH_STREAM_NOT_AUTHORIZED",t.LIVE_STREAMING_TRANSCODING_NOT_SUPPORTED="LIVE_STREAMING_TRANSCODING_NOT_SUPPORTED",t.LIVE_STREAMING_CDN_ERROR="LIVE_STREAMING_CDN_ERROR",t.LIVE_STREAMING_INVALID_RAW_STREAM="LIVE_STREAMING_INVALID_RAW_STREAM",t.LIVE_STREAMING_WARN_STREAM_NUM_REACH_LIMIT="LIVE_STREAMING_WARN_STREAM_NUM_REACH_LIMIT",t.LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE="LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE",t.LIVE_STREAMING_WARN_FREQUENT_REQUEST="LIVE_STREAMING_WARN_FREQUENT_REQUEST",t.WEBGL_INTERNAL_ERROR="WEBGL_INTERNAL_ERROR",t.BEAUTY_PROCESSOR_INTERNAL_ERROR="BEAUTY_PROCESSOR_INTERNAL_ERROR",t.CROSS_CHANNEL_WAIT_STATUS_ERROR="CROSS_CHANNEL_WAIT_STATUS_ERROR",t.CROSS_CHANNEL_FAILED_JOIN_SRC="CROSS_CHANNEL_FAILED_JOIN_SEC",t.CROSS_CHANNEL_FAILED_JOIN_DEST="CROSS_CHANNEL_FAILED_JOIN_DEST",t.CROSS_CHANNEL_FAILED_PACKET_SENT_TO_DEST="CROSS_CHANNEL_FAILED_PACKET_SENT_TO_DEST",t.CROSS_CHANNEL_SERVER_ERROR_RESPONSE="CROSS_CHANNEL_SERVER_ERROR_RESPONSE",t.METADATA_OUT_OF_RANGE="METADATA_OUT_OF_RANGE",t.LOCAL_AEC_ERROR="LOCAL_AEC_ERROR",t.INVALID_PLUGIN="INVALID_PLUGIN",t.DISCONNECT_P2P="DISCONNECT_P2P",t.CONVERTING_IMAGEDATA_TO_BLOB_FAILED="CONVERTING_IMAGEDATA_TO_BLOB_FAILED",t.CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED="CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED",t.INIT_DATACHANNEL_TIMEOUT="INIT_DATACHANNEL_TIMEOUT",t.CREATE_DATACHANNEL_ERROR="CREATE_DATACHANNEL_ERROR",t.DATACHANNEL_CONNECTION_TIMEOUT="DATACHANNEL_CONNECTION_TIMEOUT",t.PROHIBITED_OPERATION="PROHIBITED_OPERATION",t.IMAGE_MODERATION_UPLOAD_FAILED="IMAGE_MODERATION_UPLOAD_FAILED",t.P2P_MESSAGE_FAILED="P2P_MESSAGE_FAILED",t}({}),Le=class extends Error{constructor(t){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"",s=arguments.length>2?arguments[2]:void 0;super(r),Qt(this,"code",void 0),Qt(this,"message",void 0),Qt(this,"data",void 0),Qt(this,"name","AgoraRTCException"),this.code=t,this.message="AgoraRTCError ".concat(this.code,": ").concat(r),this.data=s}toString(){return this.data?"".concat(this.message,`
data: `).concat(JSON.stringify(this.data)):this.message}print(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"error",r=arguments.length>1?arguments[1]:void 0;return t==="error"&&(r||console).error(this.toString()),t==="warning"&&(r||console).warn(this.toString()),this}throw(t){throw this.print("error",t),this}};function Bd(t,r){if(typeof t!="boolean")throw new Le(te.INVALID_PARAMS,"Invalid ".concat(r,": The value is of the boolean type."))}function Yi(t,r,s){if(!rt(s).call(s,t))throw new Le(te.INVALID_PARAMS,"".concat(r," can only be set as ").concat(JSON.stringify(s)))}function _r(t,r){let s=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1,a=arguments.length>3&&arguments[3]!==void 0?arguments[3]:1e4;if(t<s||t>a||(!(arguments.length>4&&arguments[4]!==void 0)||arguments[4])&&!function(c){return typeof c=="number"&&c%1==0}(t))throw new Le(te.INVALID_PARAMS,"invalid ".concat(r,": the value range is [").concat(s,", ").concat(a,"]. integer only"))}function LL(t,r){if(typeof t!="number"){if(!(t.min||t.max||t.ideal||t.exact))throw new Le(te.INVALID_PARAMS,"".concat(r," is not a valid ConstrainLong"));t.min!==void 0&&_r(t.min,"".concat(r,".min"),0,1/0),t.max!==void 0&&_r(t.max,"".concat(r,".max"),1,1/0),t.exact!==void 0&&_r(t.exact,"".concat(r,".exact"),1,1/0),t.ideal!==void 0&&_r(t.ideal,"".concat(r,".ideal"),1,1/0)}else _r(t,r,1,1/0)}function Ss(t,r){let s=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1,a=arguments.length>3&&arguments[3]!==void 0?arguments[3]:255,c=!(arguments.length>4&&arguments[4]!==void 0)||arguments[4];if(t==null)throw new Le(te.INVALID_PARAMS,"".concat(r||"param"," cannot be empty"));if(!aW(t,s,a,c))throw new Le(te.INVALID_PARAMS,"Invalid ".concat(r||"string param",": Length of the string: [").concat(s,",").concat(a,"].").concat(c?" ASCII characters only.":""))}function uf(t,r){if(!Array.isArray(t))throw new Le(te.INVALID_PARAMS,"".concat(r," should be an array"))}function ri(t){return t==null}function aW(t){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1,s=arguments.length>2&&arguments[2]!==void 0?arguments[2]:255,a=!(arguments.length>3&&arguments[3]!==void 0)||arguments[3];return typeof t=="string"&&t.length<=s&&t.length>=r&&(!a||function(c){if(typeof c!="string")return!1;for(let d=0;d<c.length;d+=1){const h=c.charCodeAt(d);if(h<0||h>255)return!1}return!0}(t))}var Kw=function(t){return t.COVERED="COVERED",t.POSITION="POSITION",t.SIZE="SIZE",t.STYLE="STYLE",t}(Kw||{}),ML=function(t){return t.UNMOUNTED="UNMOUNTED",t.INVALID_HTML_ELEMENT="INVALID_HTML_ELEMENT",t}(ML||{});const cW=new class{constructor(){Qt(this,"_clientSize",null),Qt(this,"getClientWidth",()=>document.documentElement?document.documentElement.clientWidth:document.body.clientWidth),Qt(this,"getClientHeight",()=>document.documentElement?document.documentElement.clientHeight:document.body.clientHeight),Qt(this,"getStyle",t=>window.getComputedStyle(t,null)),Qt(this,"checkCssVisibleProperty",t=>{var r;let s=!0;const a=this.getStyle(t),{display:c,visibility:d,opacity:h,filter:m}=a;return(c==="none"||rt(r=["hidden","collapse"]).call(r,d)||Number(h)<.1)&&(s=!1),!!s&&(m&&m.split(" ").filter(g=>{var E;const b=g.split("(")[0];return rt(E=["brightness","blur","opacity"]).call(E,b)}).map(g=>{const[E,b]=g.split(/\(|\)/);return[E,Number(b.match(/^[0-9\.]+/))]}).forEach(g=>{const[E,b]=g;switch(E){case"brightness":(b<.1||b>3)&&(s=!1);break;case"blur":b>3&&(s=!1);break;case"opacity":b<.1&&(s=!1)}}),s)}),Qt(this,"checkPropertyUpToAllParentNodes",(t,r)=>{let s=!0,a=!0;const c=h=>r(h);let d=t;for(;d&&a;)c(d)||(s=!1,a=!1),d=d.parentElement,d||(a=!1);return s}),Qt(this,"checkActualCssVisibleIncludeInherit",t=>this.checkPropertyUpToAllParentNodes(t,this.checkCssVisibleProperty)),Qt(this,"getSizeAboutClient",t=>{const{width:r,height:s,left:a,right:c,top:d,bottom:h}=t.getBoundingClientRect(),m=this.getClientWidth(),g=this.getClientHeight();return{width:r,height:s,left:a,right:c,top:d,bottom:h,clientWidth:m,clientHeight:g,clientMin:Math.min(m,g)}}),Qt(this,"checkActualSize",()=>{const{width:t,height:r,clientMin:s}=this._clientSize;return this.checkSizeIsVisible(t,r,s)}),Qt(this,"elementFromPoint",(t,r)=>document.elementFromPoint?document.elementFromPoint(t,r):null),Qt(this,"checkCoverForAPoint",(t,r,s)=>{const a=this.elementFromPoint(t,r);return a!==null&&a!==s}),Qt(this,"getPointPositionList",()=>{const{width:t,height:r,left:s,top:a}=this._clientSize,c=t/6,d=r/6,h=[],m=10**6;for(let g=0;g<5;g++)for(let E=0;E<5;E++){const b=(s*m+(g===0?.1:g===4?(c*g*m-1e5)/m:c*g)*m)/m,I=(a*m+(E===0?.1:E===4?(d*E*m-1e5)/m:d*E)*m)/m;h.push({x:b,y:I})}return[...h]}),Qt(this,"checkElementCover",t=>this.getPointPositionList().map(r=>this.checkCoverForAPoint(r.x,r.y,t)).filter(r=>!!r).length>6),Qt(this,"checkSizeIsVisible",(t,r,s)=>(t>50||s/t<=10)&&(r>50||s/r<=10)),Qt(this,"checkSizeOfPartInClient",()=>{const{left:t,right:r,top:s,bottom:a,clientHeight:c,clientWidth:d,clientMin:h}=this._clientSize;let m,g,E,b;if(t<0)m=0;else{if(!(t<d))return!1;m=t}if(r<0)return!1;if(g=r<d?r:d,s<0)E=0;else{if(!(s<c))return!1;E=s}if(a<0)return!1;b=a<c?a:c;const I=g-m,A=b-E;return this.checkSizeIsVisible(I,A,h)}),Qt(this,"returnHiddenResult",t=>(this._clientSize=null,{visible:!1,reason:t})),Qt(this,"checkOneElementVisible",t=>{if(t instanceof HTMLElement){if(this.checkElementIsMountedOnDom(t)){if(this.checkActualCssVisibleIncludeInherit(t)){if(this._clientSize=this.getSizeAboutClient(t),this.checkElementCover(t))return this.returnHiddenResult(Kw.COVERED);{const r=this.checkActualSize(),s=this.checkSizeOfPartInClient();return r&&!s?this.returnHiddenResult(Kw.POSITION):r?(this._clientSize=null,{visible:!0}):this.returnHiddenResult(Kw.SIZE)}}return this.returnHiddenResult(Kw.STYLE)}return this.returnHiddenResult(ML.UNMOUNTED)}return this.returnHiddenResult(ML.INVALID_HTML_ELEMENT)}),Qt(this,"checkElementIsMountedOnDom",t=>this.checkPropertyUpToAllParentNodes(t,r=>r.nodeName.toUpperCase()!=="HTML"?r.parentElement!==null:!!document.documentElement))}};function UL(t){return new TextEncoder().encode(t)}const lW=function(t,r){const s=new Uint8Array(t.byteLength+r.byteLength);return s.set(new Uint8Array(t),0),s.set(new Uint8Array(r),t.byteLength),s},VL=async t=>function(r,s){let a="";return new Uint8Array(r).forEach(c=>{a+=c.toString(s).padStart(2,"0")}),a}(await crypto.subtle.digest("SHA-256",UL(t)),16);class Jr{constructor(){Qt(this,"_events",{}),Qt(this,"addListener",this.on)}getListeners(r){return this._events[r]?this._events[r].map(s=>s.listener):[]}on(r,s){this._events[r]||(this._events[r]=[]);const a=this._events[r];this._indexOfListener(a,s)===-1&&a.push({listener:s,once:!1})}once(r,s){this._events[r]||(this._events[r]=[]);const a=this._events[r];this._indexOfListener(a,s)===-1&&a.push({listener:s,once:!0})}off(r,s){if(!this._events[r])return;const a=this._events[r],c=this._indexOfListener(a,s);c!==-1&&a.splice(c,1),this._events[r].length===0&&delete this._events[r]}removeAllListeners(r){r?delete this._events[r]:this._events={}}emit(r){this._events[r]||(this._events[r]=[]);const s=this._events[r].map(h=>h);for(var a=arguments.length,c=new Array(a>1?a-1:0),d=1;d<a;d++)c[d-1]=arguments[d];for(let h=0;h<s.length;h+=1){const m=s[h];m.once&&this.off(r,m.listener),m.listener.apply(this,c||[])}}safeEmit(r){for(var s=arguments.length,a=new Array(s>1?s-1:0),c=1;c<s;c++)a[c-1]=arguments[c];[...this._events[r]||[]].forEach(d=>{d.once&&this.off(r,d.listener);try{d.listener.apply(this,a)}catch(h){console.error("safeEmit event:".concat(r," error ").concat(h==null?void 0:h.toString()))}})}_indexOfListener(r,s){let a=r.length;for(;a--;)if(r[a].listener===s)return a;return-1}}let qw=null;function uW(){if(qw)return qw;if(window.electron)return qw=window.electron;if(!window.require)return null;try{return qw=window.require("electron"),qw}catch{return null}}let di=function(t){return t.CREATE_CLIENT="createClient",t.CHECK_SYSTEM_REQUIREMENTS="checkSystemRequirements",t.SET_AREA="setArea",t.PRELOAD="PRELOAD",t.CHECK_VIDEO_TRACK_IS_ACTIVE="checkVideoTrackIsActive",t.CHECK_AUDIO_TRACK_IS_ACTIVE="checkAudioTrackIsActive",t.CREATE_MIC_AUDIO_TRACK="createMicrophoneAudioTrack",t.CREATE_CUSTOM_AUDIO_TRACK="createCustomAudioTrack",t.CREATE_BUFFER_AUDIO_TRACK="createBufferSourceAudioTrack",t.CREATE_CAM_VIDEO_TRACK="createCameraVideoTrack",t.CREATE_CUSTOM_VIDEO_TRACK="createCustomVideoTrack",t.CREATE_MIC_AND_CAM_TRACKS="createMicrophoneAndCameraTracks",t.CREATE_SCREEN_VIDEO_TRACK="createScreenVideoTrack",t.SET_ENCRYPTION_CONFIG="Client.setEncryptionConfig",t.START_PROXY_SERVER="Client.startProxyServer",t.STOP_PROXY_SERVER="Client.stopProxyServer",t.SET_PROXY_SERVER="Client.setProxyServer",t.SET_TURN_SERVER="Client.setTurnServer",t.SET_CLIENT_ROLE="Client.setClientRole",t.SET_LOW_STREAM_PARAMETER="Client.setLowStreamParameter",t.ENABLE_DUAL_STREAM="Client.enableDualStream",t.DISABLE_DUAL_STREAM="Client.disableDualStream",t.JOIN="Client.join",t.LEAVE="Client.leave",t.PUBLISH="Client.publish",t.UNPUBLISH="Client.unpublish",t.SUBSCRIBE="Client.subscribe",t.MASS_SUBSCRIBE="Client.massSubscribe",t.MASS_UNSUBSCRIBE="Client.massUnsubscribe",t.UNSUBSCRIBE="Client.unsubscribe",t.RENEW_TOKEN="Client.renewToken",t.SET_REMOTE_VIDEO_STREAM_TYPE="Client.setRemoteVideoStreamType",t.SET_STREAM_FALLBACK_OPTION="Client.setStreamFallbackOption",t.ENABLE_AUDIO_VOLUME_INDICATOR="Client.enableAudioVolumeIndicator",t.SEND_CUSTOM_REPORT_MESSAGE="Client.sendCustomReportMessage",t.INSPECT_VIDEO_CONTENT="Client.inspectVideoContent",t.STOP_INSPECT_VIDEO_CONTENT="Client.stopInspectVideoContent",t.JOIN_FALLBACK_TO_PROXY="Client._joinFallbackToProxy",t.ON_LIVE_STREAM_WARNING="Client.onLiveStreamWarning",t.ON_LIVE_STREAM_ERROR="Client.onLiveStreamingError",t.START_LIVE_STREAMING="Client.startLiveStreaming",t.SET_LIVE_TRANSCODING="Client.setLiveTranscoding",t.STOP_LIVE_STREAMING="Client.stopLiveStreaming",t.START_CHANNEL_MEDIA_RELAY="Client.startChannelMediaRelay",t.UPDATE_CHANNEL_MEDIA_RELAY="Client.updateChannelMediaRelay",t.STOP_CHANNEL_MEDIA_RELAY="Client.stopChannelMediaRelay",t.REQUEST_CONFIG_DISTRIBUTE="_config-distribute-request",t.SET_CONFIG_DISTRIBUTE="_configDistribute",t.LOCAL_TRACK_SET_MUTED="LocalTrack.setMute",t.LOCAL_AUDIO_TRACK_PLAY="LocalAudioTrack.play",t.LOCAL_AUDIO_TRACK_PLAY_IN_ELEMENT="LocalAudioTrack.playInElement",t.LOCAL_AUDIO_TRACK_STOP="LocalAudioTrack.stop",t.LOCAL_AUDIO_TRACK_SET_VOLUME="LocalAudioTrack.setVolume",t.MIC_AUDIO_TRACK_SET_DEVICE="MicrophoneAudioTrack.setDevice",t.BUFFER_AUDIO_TRACK_START="BufferSourceAudioTrack.startProcessAudioBuffer",t.BUFFER_AUDIO_TRACK_STOP="BufferSourceAudioTrack.stopProcessAudioBuffer",t.BUFFER_AUDIO_TRACK_PAUSE="BufferSourceAudioTrack.pauseProcessAudioBuffer",t.BUFFER_AUDIO_TRACK_RESUME="BufferSourceAudioTrack.resumeProcessAudioBuffer",t.BUFFER_AUDIO_TRACK_SEEK="BufferSourceAudioTrack.seekAudioBuffer",t.LOCAL_VIDEO_TRACK_PLAY="LocalVideoTrack.play",t.LOCAL_VIDEO_TRACK_STOP="LocalVideoTrack.stop",t.LOCAL_VIDEO_TRACK_GET_VIDEO_VISIBLE="LocalVideoTrack.getVideoElementVisibleStatus",t.LOCAL_VIDEO_TRACK_BEAUTY="LocalVideoTrack.setBeautyEffect",t.LOCAL_VIDEO_SEND_SEI_DATA="LocalVideoTrack.sendSeiData",t.CAM_VIDEO_TRACK_SET_DEVICE="CameraVideoTrack.setDevice",t.CAM_VIDEO_TRACK_SET_ENCODER_CONFIG="CameraVideoTrack.setEncoderConfiguration",t.REMOTE_VIDEO_TRACK_PLAY="RemoteVideoTrack.play",t.REMOTE_VIDEO_TRACK_STOP="RemoteVideoTrack.stop",t.REMOTE_VIDEO_TRACK_GET_VIDEO_VISIBLE="RemoteVideoTrack.getVideoElementVisibleStatus",t.REMOTE_AUDIO_TRACK_PLAY="RemoteAudioTrack.play",t.REMOTE_AUDIO_TRACK_STOP="RemoteAudioTrack.stop",t.REMOTE_AUDIO_SET_VOLUME="RemoteAudioTrack.setVolume",t.REMOTE_AUDIO_SET_OUTPUT_DEVICE="RemoteAudioTrack.setOutputDevice",t.GET_MEDIA_STREAM_TRACK="Track.getMediaStreamTrack",t.STREAM_TYPE_CHANGE="streamTypeChange",t.CONNECTION_STATE_CHANGE="connectionStateChange",t.LOAD_CONFIG_FROM_LOCALSTORAGE="loadConfigFromLocalStorage",t.IMAGE_MODERATION_UPLOAD="imageModerationUpload",t.REPUB_AFTER_PC_CONNECTED="repubAfterPCConnected",t.PRELOAD_MEDIA_FAILED="preloadMediaFailed",t.MISMATCH_DTLS_PARAMETERS="mismatchDtlsParameters",t}({}),$r=function(t){return t.TRACER="tracer",t}({});function dW(t){return _r(t.timeout,"config.timeout",0,1e5),_r(t.timeoutFactor,"config.timeoutFactor",0,100,!1),_r(t.maxRetryCount,"config.maxRetryConfig",0,1/0),_r(t.maxRetryTimeout,"config.maxRetryTimeout",0,1/0),!0}let Ome=function(t){return t[t.AUDIENCE_LEVEL_LOW_LATENCY=1]="AUDIENCE_LEVEL_LOW_LATENCY",t[t.AUDIENCE_LEVEL_ULTRA_LOW_LATENCY=2]="AUDIENCE_LEVEL_ULTRA_LOW_LATENCY",t[t.AUDIENCE_LEVEL_SYNC_LATENCY=3]="AUDIENCE_LEVEL_SYNC_LATENCY",t}({}),rr=function(t){return t.LEAVE="LEAVE",t.NETWORK_ERROR="NETWORK_ERROR",t.SERVER_ERROR="SERVER_ERROR",t.UID_BANNED="UID_BANNED",t.FALLBACK="FALLBACK",t.IP_BANNED="IP_BANNED",t.CHANNEL_BANNED="CHANNEL_BANNED",t.LICENSE_MISSING="LICENSE_MISSING",t.LICENSE_EXPIRED="LICENSE_EXPIRED",t.LICENSE_MINUTES_EXCEEDED="LICENSE_MINUTES_EXCEEDED",t.LICENSE_PERIOD_INVALID="LICENSE_PERIOD_INVALID",t.LICENSE_MULTIPLE_SDK_SERVICE="LICENSE_MULTIPLE_SDK_SERVICE",t.LICENSE_ILLEGAL="LICENSE_ILLEGAL",t.TOKEN_EXPIRE="TOKEN_EXPIRE",t}({});function Yw(t){if(!Array.isArray(t)||t.length<1)return!1;try{t.forEach(r=>{if(!r.urls)throw Error()})}catch{return!1}return!0}function hW(t){return Ss(t.turnServerURL,"turnServerURL"),Ss(t.username,"username"),Ss(t.password,"password"),t.udpport&&_r(t.udpport,"udpport",1,99999,!0),t.forceturn&&Bd(t.forceturn,"forceturn"),t.security&&Bd(t.security,"security"),t.tcpport&&_r(t.tcpport,"tcpport",1,99999,!0),!0}function FL(t){return t.level!==void 0&&Yi(t.level,"level",[1,2,3]),t.delay!==void 0&&_r(t.delay,"delay",0,3e3,!0),!0}let Rn=function(t){return t.PEERCONNECTION_STATE_CHANGE="peerconnection-state-change",t.AUDIO_METADATA="audio-metadata",t.AUDIO_PTS="audio-pts",t.CONNECTION_STATE_CHANGE="connection-state-change",t.MEDIA_RECONNECT_START="media-reconnect-start",t.MEDIA_RECONNECT_END="media-reconnect-end",t.IS_USING_CLOUD_PROXY="is-using-cloud-proxy",t.USER_JOINED="user-joined",t.USER_LEAVED="user-left",t.USER_PUBLISHED="user-published",t.USER_UNPUBLISHED="user-unpublished",t.USER_INFO_UPDATED="user-info-updated",t.CLIENT_BANNED="client-banned",t.CHANNEL_MEDIA_RELAY_STATE="channel-media-relay-state",t.CHANNEL_MEDIA_RELAY_EVENT="channel-media-relay-event",t.VOLUME_INDICATOR="volume-indicator",t.CRYPT_ERROR="crypt-error",t.ON_TOKEN_PRIVILEGE_WILL_EXPIRE="token-privilege-will-expire",t.ON_TOKEN_PRIVILEGE_DID_EXPIRE="token-privilege-did-expire",t.NETWORK_QUALITY="network-quality",t.STREAM_TYPE_CHANGED="stream-type-changed",t.STREAM_FALLBACK="stream-fallback",t.RECEIVE_METADATA="receive-metadata",t.STREAM_MESSAGE="stream-message",t.LIVE_STREAMING_ERROR="live-streaming-error",t.LIVE_STREAMING_WARNING="live-streaming-warning",t.EXCEPTION="exception",t.ERROR="error",t.P2P_LOST="p2p_lost",t.JOIN_FALLBACK_TO_PROXY="join-fallback-to-proxy",t.CHANNEL_FALLBACK_TO_WEBSOCKET="channel-fallback-to-websocket",t.MEDIA_CONNECTION_TYPE_CHANGE="media-connection-type-change",t.PUBLISHED_USER_LIST="published-user-list",t.CONTENT_INSPECT_CONNECTION_STATE_CHANGE="content-inspect-connection-state-change",t.CONTENT_INSPECT_ERROR="content-inspect-error",t.CONTENT_INSPECT_RESULT="content-inspect-result",t.IMAGE_MODERATION_CONNECTION_STATE_CHANGE="image-moderation-connection-state-change",t}({}),Ls=function(t){return t.NETWORK_ERROR="NETWORK_ERROR",t.SERVER_ERROR="SERVER_ERROR",t.MULTI_IP="MULTI_IP",t.TIMEOUT="TIMEOUT",t.OFFLINE="OFFLINE",t.LEAVE="LEAVE",t.P2P_FAILED="P2P_FAILED",t.FALLBACK="FALLBACK",t.REGIONAL_DISTRIBUTION="REGIONAL_DISTRIBUTION",t}({}),Tc=function(t){return t.ONLINE="ONLINE",t.OFFLINE="OFFLINE",t}({}),jv=function(t){return t.NETWORK_STATE_CHANGE="NETWORK_STATE_CHANGE",t.ONLINE="ONLINE",t.OFFLINE="OFFLINE",t}({});function Ms(t,r){for(var s=arguments.length,a=new Array(s>2?s-2:0),c=2;c<s;c++)a[c-2]=arguments[c];return t.getListeners(r).length===0?pt.reject(new Le(te.UNEXPECTED_ERROR,"can not emit promise")):new pt((d,h)=>{t.emit(r,...a,d,h)})}function Er(t,r){if(t.getListeners(r).length===0)return pt.resolve();for(var s=arguments.length,a=new Array(s>2?s-2:0),c=2;c<s;c++)a[c-2]=arguments[c];return Ms(t,r,...a)}function Yc(t,r){if(t.getListeners(r).length===0)return null;for(var s=arguments.length,a=new Array(s>2?s-2:0),c=2;c<s;c++)a[c-2]=arguments[c];return Xw(t,r,...a)}function Xw(t,r){let s=null,a=null;for(var c=arguments.length,d=new Array(c>2?c-2:0),h=2;h<c;h++)d[h-2]=arguments[h];if(t.emit(r,...d,m=>{s=m},m=>{a=m}),a!==null)throw a;if(s===null)throw new Le(te.UNEXPECTED_ERROR,"handler is not sync");return s}const Ci=new class extends Jr{set networkState(t){this.emit(jv.NETWORK_STATE_CHANGE,t,this._networkState),t===Tc.ONLINE?this.emit(jv.ONLINE):t===Tc.OFFLINE&&(this.onlineWaiter=new pt(r=>{this.once(jv.ONLINE,()=>{this.onlineWaiter=void 0,r(Tc.ONLINE)})}),this.emit(jv.OFFLINE)),this._networkState=t}get networkState(){return this._networkState}get isOnline(){return this._networkState===Tc.ONLINE}constructor(){super(),Qt(this,"_moduleName","network-indicator"),Qt(this,"_networkState",Tc.ONLINE),Qt(this,"onlineWaiter",void 0),window.addEventListener("online",()=>{this.networkState=Tc.ONLINE}),window.addEventListener("offline",()=>{this.networkState=Tc.OFFLINE})}};function pP(t,r){const s=t.indexOf(r);s!==-1&&t.splice(s,1)}function Bv(t){const r=[];return t.forEach(s=>{r.indexOf(s)===-1&&r.push(s)}),r}function fP(t){pt!==void 0?pt.resolve().then(t):setTimeout(t,0)}function Kr(t){return JSON.parse(JSON.stringify(t))}function Z_(t){try{return Kr(t)}catch{return t}}const pW={};function Wm(t,r){pW[r]||(pW[r]=!0,t())}function ey(t){const r=window.atob(t),s=new Uint8Array(new ArrayBuffer(r.length));for(let a=0;a<r.length;a+=1)s[a]=r.charCodeAt(a);return s}function Gm(t){let r="";for(let s=0;s<t.length;s+=1)r+=String.fromCharCode(t[s]);return window.btoa(r)}function fW(t){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:16,s=new TextEncoder().encode(t);if(s.length>r)s=s.slice(0,r);else if(s.length<r){const a=new Uint8Array(r);a.set(s),s=a}return s}function mW(){for(var t=arguments.length,r=new Array(t),s=0;s<t;s++)r[s]=arguments[s];const a=Wa(r).call(r,(h,m)=>h+m.length,0),c=new Uint8Array(new ArrayBuffer(a));let d=0;return r.forEach(h=>{c.set(h,d),d+=h.length}),c}function Gh(t){return window.TextEncoder?new TextEncoder().encode(t).length:t.length}function gW(t){let r=0;return(/DingTalk/i.test(navigator.userAgent)||/AliApp/i.test(navigator.userAgent))&&t.realFormData&&(t=t.realFormData),t.forEach(s=>{r+=typeof s=="string"?Gh(s):s.size}),r+138}function Nme(t){const r=new Le(te.TIMEOUT,"timeout");return new pt((s,a)=>{window.setTimeout(()=>a(r),t)})}function bs(t){return new pt(r=>{window.setTimeout(r,t)})}function vr(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:7,r=arguments.length>1?arguments[1]:void 0;const s=Math.random().toString(16).substr(2,t).toLowerCase();return s.length===t?"".concat(r).concat(s):"".concat(r).concat(s)+vr(t-s.length,"")}function ty(){return vr(32,"").toUpperCase()}const mP=()=>{},_W=new class{constructor(){Qt(this,"fnMap",new Map)}throttleByKey(t,r,s,a){for(var c=arguments.length,d=new Array(c>4?c-4:0),h=4;h<c;h++)d[h-4]=arguments[h];if(this.fnMap.has(r)){const m=this.fnMap.get(r);if(m.threshold!==s){m.fn(...m.args),clearTimeout(m.timer);const g=window.setTimeout(()=>{const E=this.fnMap.get(r);E&&E.fn(...E.args),this.fnMap.delete(r)},s);this.fnMap.set(r,{fn:t,threshold:s,timer:g,args:d,skipFn:a})}else m.skipFn&&m.skipFn(...m.args),this.fnMap.set(r,Qe(Qe({},m),{},{fn:t,args:d,skipFn:a}))}else{const m=window.setTimeout(()=>{const g=this.fnMap.get(r);g&&g.fn(...g.args),this.fnMap.delete(r)},s);this.fnMap.set(r,{fn:t,threshold:s,timer:m,args:d,skipFn:a})}}},yW=_W.throttleByKey.bind(_W);function EW(t){return typeof t=="object"&&t!==null&&!(t instanceof RegExp)}function jL(t,r){if(!EW(t)||!EW(r)||Array.isArray(t)&&!Array.isArray(r)||!Array.isArray(t)&&Array.isArray(r))return r;if(Array.isArray(r)&&Array.isArray(t)){const s=[...t];for(let a=0;a<r.length;a++)s[a]=jL(t[a],r[a]);return s}{const s=Qe({},t);for(const a in r)Object.prototype.hasOwnProperty.call(r,a)&&(Object.prototype.hasOwnProperty.call(t,a)?s[a]=jL(t[a],r[a]):s[a]=r[a]);return s}}function vW(t,r){let s=[0];if(s=new Array(r).fill(0),t===0)return s;let a=0;for(;t>0&&(s[a]=255&t,t>>=8,a++,a!==r););return s}function zv(t){return typeof t=="number"?t:t.exact||t.ideal||t.max||t.min||0}function BL(t){return Wa(t).call(t,(r,s)=>r+s,0)}function SW(t){const r="0123456789abcdef";function s(oe){let ye,_e="";for(ye=0;ye<=3;ye++)_e+=r.charAt(oe>>8*ye+4&15)+r.charAt(oe>>8*ye&15);return _e}function a(oe,ye){const _e=(65535&oe)+(65535&ye);return(oe>>16)+(ye>>16)+(_e>>16)<<16|65535&_e}function c(oe,ye,_e,ue,Ce,Ue){return a(function(ze,Je){return ze<<Je|ze>>>32-Je}(a(a(ye,oe),a(ue,Ue)),Ce),_e)}function d(oe,ye,_e,ue,Ce,Ue,ze){return c(ye&_e|~ye&ue,oe,ye,Ce,Ue,ze)}function h(oe,ye,_e,ue,Ce,Ue,ze){return c(ye&ue|_e&~ue,oe,ye,Ce,Ue,ze)}function m(oe,ye,_e,ue,Ce,Ue,ze){return c(ye^_e^ue,oe,ye,Ce,Ue,ze)}function g(oe,ye,_e,ue,Ce,Ue,ze){return c(_e^(ye|~ue),oe,ye,Ce,Ue,ze)}const E=function(oe){let ye;const _e=1+(oe.length+8>>6),ue=new Array(16*_e);for(ye=0;ye<16*_e;ye++)ue[ye]=0;for(ye=0;ye<oe.length;ye++)ue[ye>>2]|=oe.charCodeAt(ye)<<ye%4*8;return ue[ye>>2]|=128<<ye%4*8,ue[16*_e-2]=8*oe.length,ue}(t);let b,I,A,k,W,j=1732584193,B=-271733879,ee=-1732584194,Z=271733878;for(b=0;b<E.length;b+=16)I=j,A=B,k=ee,W=Z,j=d(j,B,ee,Z,E[b+0],7,-680876936),Z=d(Z,j,B,ee,E[b+1],12,-389564586),ee=d(ee,Z,j,B,E[b+2],17,606105819),B=d(B,ee,Z,j,E[b+3],22,-1044525330),j=d(j,B,ee,Z,E[b+4],7,-176418897),Z=d(Z,j,B,ee,E[b+5],12,1200080426),ee=d(ee,Z,j,B,E[b+6],17,-1473231341),B=d(B,ee,Z,j,E[b+7],22,-45705983),j=d(j,B,ee,Z,E[b+8],7,1770035416),Z=d(Z,j,B,ee,E[b+9],12,-1958414417),ee=d(ee,Z,j,B,E[b+10],17,-42063),B=d(B,ee,Z,j,E[b+11],22,-1990404162),j=d(j,B,ee,Z,E[b+12],7,1804603682),Z=d(Z,j,B,ee,E[b+13],12,-40341101),ee=d(ee,Z,j,B,E[b+14],17,-1502002290),B=d(B,ee,Z,j,E[b+15],22,1236535329),j=h(j,B,ee,Z,E[b+1],5,-165796510),Z=h(Z,j,B,ee,E[b+6],9,-1069501632),ee=h(ee,Z,j,B,E[b+11],14,643717713),B=h(B,ee,Z,j,E[b+0],20,-373897302),j=h(j,B,ee,Z,E[b+5],5,-701558691),Z=h(Z,j,B,ee,E[b+10],9,38016083),ee=h(ee,Z,j,B,E[b+15],14,-660478335),B=h(B,ee,Z,j,E[b+4],20,-405537848),j=h(j,B,ee,Z,E[b+9],5,568446438),Z=h(Z,j,B,ee,E[b+14],9,-1019803690),ee=h(ee,Z,j,B,E[b+3],14,-187363961),B=h(B,ee,Z,j,E[b+8],20,1163531501),j=h(j,B,ee,Z,E[b+13],5,-1444681467),Z=h(Z,j,B,ee,E[b+2],9,-51403784),ee=h(ee,Z,j,B,E[b+7],14,1735328473),B=h(B,ee,Z,j,E[b+12],20,-1926607734),j=m(j,B,ee,Z,E[b+5],4,-378558),Z=m(Z,j,B,ee,E[b+8],11,-2022574463),ee=m(ee,Z,j,B,E[b+11],16,1839030562),B=m(B,ee,Z,j,E[b+14],23,-35309556),j=m(j,B,ee,Z,E[b+1],4,-1530992060),Z=m(Z,j,B,ee,E[b+4],11,1272893353),ee=m(ee,Z,j,B,E[b+7],16,-155497632),B=m(B,ee,Z,j,E[b+10],23,-1094730640),j=m(j,B,ee,Z,E[b+13],4,681279174),Z=m(Z,j,B,ee,E[b+0],11,-358537222),ee=m(ee,Z,j,B,E[b+3],16,-722521979),B=m(B,ee,Z,j,E[b+6],23,76029189),j=m(j,B,ee,Z,E[b+9],4,-640364487),Z=m(Z,j,B,ee,E[b+12],11,-421815835),ee=m(ee,Z,j,B,E[b+15],16,530742520),B=m(B,ee,Z,j,E[b+2],23,-995338651),j=g(j,B,ee,Z,E[b+0],6,-198630844),Z=g(Z,j,B,ee,E[b+7],10,1126891415),ee=g(ee,Z,j,B,E[b+14],15,-1416354905),B=g(B,ee,Z,j,E[b+5],21,-57434055),j=g(j,B,ee,Z,E[b+12],6,1700485571),Z=g(Z,j,B,ee,E[b+3],10,-1894986606),ee=g(ee,Z,j,B,E[b+10],15,-1051523),B=g(B,ee,Z,j,E[b+1],21,-2054922799),j=g(j,B,ee,Z,E[b+8],6,1873313359),Z=g(Z,j,B,ee,E[b+15],10,-30611744),ee=g(ee,Z,j,B,E[b+6],15,-1560198380),B=g(B,ee,Z,j,E[b+13],21,1309151649),j=g(j,B,ee,Z,E[b+4],6,-145523070),Z=g(Z,j,B,ee,E[b+11],10,-1120210379),ee=g(ee,Z,j,B,E[b+2],15,718787259),B=g(B,ee,Z,j,E[b+9],21,-343485551),j=a(j,I),B=a(B,A),ee=a(ee,k),Z=a(Z,W);return s(j)+s(B)+s(ee)+s(Z)}let Dme=1,bW=console,Ys=class{static setLogger(t){bW=t}constructor(t,r){Qt(this,"id",void 0),Qt(this,"lockingPromise",pt.resolve()),Qt(this,"locks",0),Qt(this,"name",""),Qt(this,"lockId",void 0),this.lockId=Dme++,t&&(this.name=t),r&&(this.id=r),this.logger("created")}logger(t,r){const s=(this.id?"[".concat(this.id,"]"):"")+"[lock-".concat(this.name,"-").concat(this.lockId,"]"),a=t==="created"?"is ".concat(t,"."):"is ".concat(t,", current queue ").concat(this.locks,". ").concat(r??"");bW.debug("".concat(s," ").concat(a))}setId(t){this.id=t}get isLocked(){return this.locks>0}lock(t){let r;this.locks+=1,this.logger("locked",t);const s=new pt(c=>{r=()=>{this.locks-=1,this.logger("unlocked",t),c()}}),a=this.lockingPromise.then(()=>r);return this.lockingPromise=this.lockingPromise.then(()=>s),a}};function Wv(t,r){return function(s,a,c){const d=c.value;if(typeof d!="function")throw new Error("Cannot use mutex on object property.");return c.value=async function(){const h=this[r];if(!h)throw new Error("mutex property key ".concat(r," doesn't exist on ").concat(t));const m=await h.lock("From ".concat(t,".").concat(a));try{for(var g=arguments.length,E=new Array(g),b=0;b<g;b++)E[b]=arguments[b];return await d.apply(this,E)}finally{m()}},c}}const Mi={timeout:500,timeoutFactor:1.5,maxRetryCount:1/0,maxRetryTimeout:1e4};function zL(t,r){const s=Math.floor(r.timeout*Math.pow(r.timeoutFactor,t));return Math.min(r.maxRetryTimeout,s)}function zd(t,r,s,a){const c=Object.assign({},Mi,a);let d=c.timeout;const h=async()=>{await function(E){return new pt(b=>{window.setTimeout(b,E)})}(d),d*=c.timeoutFactor,d=Math.min(c.maxRetryTimeout,d)};let m=!1;const g=new pt(async(E,b)=>{r=r||(()=>!1),s=s||(()=>!0);for(let I=0;I<c.maxRetryCount;I+=1){if(m)return b(new Le(te.OPERATION_ABORTED));try{const A=await t();if(!r(A,I)||I+1===c.maxRetryCount)return E(A);await h()}catch(A){if(!s(A,I)||I+1===c.maxRetryCount)return b(A);await h()}}});return g.cancel=()=>m=!0,g}let gP,wW=class{constructor(t){Qt(this,"input",[]),Qt(this,"size",void 0),this.size=t}add(t){this.input.push(t),this.input.length>this.size&&this.input.splice(0,1)}mean(){var t;return this.input.length===0?0:Wa(t=this.input).call(t,(r,s)=>r+s)/this.input.length}},_P=0,WL=0;function GL(t,r,s,a){return new pt((c,d)=>{r.responseType=r.responseType||"json",r.data&&!s?(r.data=JSON.stringify(r.data),_P+=Gh(r.data)):s&&(r.data.size?_P+=r.data.size:r.data instanceof FormData?_P+=gW(r.data):_P+=Gh(JSON.stringify(r.data))),r.headers=r.headers||{},r.headers["Content-Type"]=r.headers["Content-Type"]||"application/json",r.method="POST",r.url=t,Sa.request(r).then(h=>{typeof h.data=="string"?WL+=Gh(h.data):h.data instanceof ArrayBuffer||h.data instanceof Uint8Array?WL+=h.data.byteLength:WL+=Gh(JSON.stringify(h.data)),c(h.data)}).catch(h=>{Sa.isCancel(h)?d(new Le(te.OPERATION_ABORTED,"cancel token canceled")):h.code==="ECONNABORTED"?d(new Le(te.NETWORK_TIMEOUT,h.message)):h.response?d(new Le(te.NETWORK_RESPONSE_ERROR,h.response.status)):d(new Le(te.NETWORK_ERROR,h.message))})})}async function xme(t,r){const s=new Blob([r.data],{type:"buffer"});return await GL(t,Qe(Qe({},r),{},{data:s,headers:{"Content-Type":"application/octet-stream"}}),!0)}const TW=()=>window.isSecureContext!==void 0;function Lu(t){if(Array.isArray(t))return t.map(s=>s);if(!CW(t))return t;const r={};for(const s in t){const a=t[s];CW(a)||Array.isArray(a)?r[s]=Lu(a):r[s]=a}return r}function CW(t){return!(typeof t!="object"||Array.isArray(t)||!t)}let HL=class{constructor(t){Qt(this,"input",[]),Qt(this,"size",void 0),this.size=t}add(t){this.input.push(t),this.input.length>this.size&&this.input.splice(0,1)}diffMean(){return this.input.length===0?0:(this.input[this.input.length-1]-this.input[0])/this.input.length}};const Hh={address:"unknown",candidateType:"unknown",id:"unknown",port:0,priority:0,protocol:"unknown",type:"unknown"},Jw={timestamp:0,bitrate:{actualEncoded:0,transmit:0},sendPacketLossRate:0,recvPacketLossRate:0,videoRecv:[],videoSend:[],audioRecv:[],audioSend:[],selectedCandidatePair:{id:"unknown",localCandidate:Hh,remoteCandidate:Hh},updateInterval:0},RW={firsCount:0,nacksCount:0,plisCount:0,framesDecodeCount:0,framesDecodeInterval:0,framesDecodeFreezeTime:0,decodeFrameRate:0,bytes:0,packetsLost:0,packetLostRate:0,packets:0,ssrc:0,qpSumPerFrame:0,framesDroppedCount:0,outputFrameRate:0,packetsDiscarded:0,framesAssembledFromMultiplePackets:0,totalProcessingDelay:0,avgDecodeMs:0,avgFramesAssembledFromMultiplePacketsMs:0,avgProcessingDelayMs:0,avgInterFrameDelayMs:0,totalAssemblyTime:0},IW={firsCount:0,nacksCount:0,plisCount:0,frameCount:0,bytes:0,packets:0,packetsLost:0,packetLostRate:0,ssrc:0,rttMs:0,jitterMs:0,qpSumPerFrame:0},AW={bytes:0,packets:0,packetsLost:0,packetLostRate:0,ssrc:0,rttMs:0,jitterMs:0},PW={jitterBufferMs:0,jitterMs:0,bytes:0,packetsLost:0,packetLostRate:0,packetsDiscarded:0,packets:0,ssrc:0,receivedFrames:0,droppedFrames:0,concealedSamples:0,totalSamplesReceived:0,silentConcealedSamples:0,concealmentEvents:0,freezeMs80:0,freezeMs200:0,freezeSamples80:0,freezeSamples200:0};let $L=class{constructor(t,r){Qt(this,"onFirstVideoReceived",void 0),Qt(this,"onFirstVideoDecoded",void 0),Qt(this,"onFirstAudioReceived",void 0),Qt(this,"onFirstVideoDecodedTimeout",void 0),Qt(this,"onFirstAudioDecoded",void 0),Qt(this,"onSelectedLocalCandidateChanged",void 0),Qt(this,"onSelectedRemoteCandidateChanged",void 0),Qt(this,"videoIsReady",!1),Qt(this,"videoIsReady2",{}),Qt(this,"pc",void 0),Qt(this,"options",void 0),Qt(this,"intervalTimer",void 0),Qt(this,"stats",Lu(Jw)),Qt(this,"isFirstVideoReceived",{}),Qt(this,"isFirstVideoDecoded",{}),Qt(this,"isFirstAudioReceived",{}),Qt(this,"isFirstAudioDecoded",{}),Qt(this,"isFirstVideoDecodedTimeout",{}),Qt(this,"lossRateWindowStats",[]),this.pc=t,this.options=r,this.intervalTimer=window.setInterval(async()=>{this.updateStats()},this.options.updateInterval)}getStats(){return this.stats}getSelectedCandidatePair(){return new pt(t=>{t({local:Qe({},Hh),remote:Qe({},Hh)})})}setVideoIsReady(t){this.videoIsReady=t}setVideoIsReady2(t,r){this.videoIsReady2[t]=r}getVideoIsReady(t){return this.videoIsReady2[t]||!1}setIsFirstAudioDecoded(t){}destroy(){window.clearInterval(this.intervalTimer),this.pc=void 0}calcLossRate(t){this.lossRateWindowStats.push(t),this.lossRateWindowStats.length>this.options.lossRateInterval&&this.lossRateWindowStats.splice(0,1);const r=this.lossRateWindowStats.length,s=["videoSend","audioSend","videoRecv","audioRecv"];let a=0,c=0,d=0,h=0;for(const m of s)t[m].forEach((g,E)=>{if(!this.lossRateWindowStats[r-1][m][E]||!this.lossRateWindowStats[0][m][E])return;const b=this.lossRateWindowStats[r-1][m][E].packets-this.lossRateWindowStats[0][m][E].packets,I=this.lossRateWindowStats[r-1][m][E].packetsLost-this.lossRateWindowStats[0][m][E].packetsLost;m==="videoSend"||m==="audioSend"?(a+=b,d+=I):(c+=b,h+=I),Number.isNaN(b)||Number.isNaN(b)?g.packetLostRate=0:g.packetLostRate=b<=0||I<=0?0:I/(b+I)});t.sendPacketLossRate=a<=0||d<=0?0:d/(a+d),t.recvPacketLossRate=c<=0||h<=0?0:h/(c+h)}},Lme=class extends $L{constructor(){super(...arguments),Qt(this,"_stats",Jw),Qt(this,"lastDecodeVideoReceiverStats",new Map)}async updateStats(){const t=await this._getStats(),r=this.statsResponsesToObjects(t);this._stats=Lu(Jw);const s=r.filter(c=>c.type==="ssrc");this.processSSRCStats(s);const a=r.find(c=>c.type==="VideoBwe");a&&this.processBandwidthStats(a),this._stats.timestamp=Date.now(),this.calcLossRate(this._stats),this.stats=this._stats}processBandwidthStats(t){this._stats.bitrate={actualEncoded:Number(t.googActualEncBitrate),targetEncoded:Number(t.googTargetEncBitrate),retransmit:Number(t.googRetransmitBitrate),transmit:Number(t.googTransmitBitrate)},this._stats.sendBandwidth=Number(t.googAvailableSendBandwidth)}processSSRCStats(t){t.forEach(r=>{var s;const a=rt(s=r.id).call(s,"send");switch("".concat(r.mediaType,"_").concat(a?"send":"recv")){case"video_send":{const c=Lu(IW);c.codec=r.googCodecName,c.adaptionChangeReason="none",r.googCpuLimitedResolution&&(c.adaptionChangeReason="cpu"),r.googBandwidthLimitedResolution&&(c.adaptionChangeReason="bandwidth"),c.avgEncodeMs=Number(r.googAvgEncodeMs),c.inputFrame={width:Number(r.googFrameWidthInput)||Number(r.googFrameWidthSent),height:Number(r.googFrameHeightInput)||Number(r.googFrameHeightSent),frameRate:Number(r.googFrameRateInput)},c.sentFrame={width:Number(r.googFrameWidthSent),height:Number(r.googFrameHeightSent),frameRate:Number(r.googFrameRateInput)},c.firsCount=Number(r.googFirReceived),c.nacksCount=Number(r.googNacksReceived),c.plisCount=Number(r.googPlisReceived),c.frameCount=Number(r.framesEncoded),c.bytes=Number(r.bytesSent),c.packets=Number(r.packetsSent),c.packetsLost=Number(r.packetsLost),c.ssrc=Number(r.ssrc),c.rttMs=Number(r.googRtt||0),this._stats.videoSend.push(c),this._stats.rtt=c.rttMs;break}case"video_recv":{const c=Lu(RW),d=this.lastDecodeVideoReceiverStats.get(Number(r.ssrc));if(c.codec=r.googCodecName,c.targetDelayMs=Number(r.googTargetDelayMs),c.renderDelayMs=Number(r.googRenderDelayMs),c.currentDelayMs=Number(r.googCurrentDelayMs),c.minPlayoutDelayMs=Number(r.googMinPlayoutDelayMs),c.decodeMs=Number(r.googDecodeMs),c.maxDecodeMs=Number(r.googMaxDecodeMs),c.receivedFrame={width:Number(r.googFrameWidthReceived),height:Number(r.googFrameHeightReceived),frameRate:Number(r.googFrameRateReceived)},c.decodedFrame={width:Number(r.googFrameWidthReceived),height:Number(r.googFrameHeightReceived),frameRate:Number(r.googFrameRateDecoded)},c.decodeFrameRate=Number(r.googFrameRateDecoded),c.outputFrame={width:Number(r.googFrameWidthReceived),height:Number(r.googFrameHeightReceived),frameRate:Number(r.googFrameRateOutput)},c.jitterBufferMs=Number(r.googJitterBufferMs),c.firsCount=Number(r.googFirsSent),c.nacksCount=Number(r.googNacksSent),c.plisCount=Number(r.googPlisSent),c.framesDecodeCount=Number(r.framesDecoded),c.bytes=Number(r.bytesReceived),c.packets=Number(r.packetsReceived),c.packetsLost=Number(r.packetsLost),c.ssrc=Number(r.ssrc),c.packets>0&&!this.isFirstVideoReceived[c.ssrc]&&(this.onFirstVideoReceived&&this.onFirstVideoReceived(c.ssrc),this.isFirstVideoReceived[c.ssrc]=!0),c.framesDecodeCount>0&&!this.isFirstVideoDecoded[c.ssrc]&&(this.onFirstVideoDecoded&&this.onFirstVideoDecoded(c.ssrc,c.decodedFrame.width,c.decodedFrame.height),this.isFirstVideoDecoded[c.ssrc]=!0),d){const h=d.stats,m=Date.now()-d.lts;c.framesDecodeFreezeTime=h.framesDecodeFreezeTime,c.framesDecodeInterval=h.framesDecodeInterval,c.framesDecodeCount>h.framesDecodeCount&&this.isFirstVideoDecoded[c.ssrc]?(d.lts=Date.now(),c.framesDecodeInterval=m,c.framesDecodeInterval>=this.options.freezeRateLimit&&(this.getVideoIsReady(parseInt(r.ssrc,10))?c.framesDecodeFreezeTime+=c.framesDecodeInterval:this.setVideoIsReady2(parseInt(r.ssrc,10),!0))):c.framesDecodeCount<d.stats.framesDecodeCount&&(c.framesDecodeInterval=0)}this.lastDecodeVideoReceiverStats.set(c.ssrc,{stats:Qe({},c),lts:Date.now()}),this._stats.videoRecv.push(c);break}case"audio_recv":{const c=Lu(PW);c.codec=r.googCodecName,c.outputLevel=Math.abs(Number(r.audioOutputLevel))/32767,c.decodingCNG=Number(r.googDecodingCNG),c.decodingCTN=Number(r.googDecodingCTN),c.decodingCTSG=Number(r.googDecodingCTSG),c.decodingNormal=Number(r.googDecodingNormal),c.decodingPLC=Number(r.googDecodingPLC),c.decodingPLCCNG=Number(r.googDecodingPLCCNG),c.expandRate=Number(r.googExpandRate),c.accelerateRate=Number(r.googAccelerateRate),c.preemptiveExpandRate=Number(r.googPreemptiveExpandRate),c.secondaryDecodedRate=Number(r.googSecondaryDecodedRate),c.speechExpandRate=Number(r.googSpeechExpandRate),c.preferredJitterBufferMs=Number(r.googPreferredJitterBufferMs),c.jitterBufferMs=Number(r.googJitterBufferMs),c.jitterMs=Number(r.googJitterReceived),c.bytes=Number(r.bytesReceived),c.packets=Number(r.packetsReceived),c.packetsLost=Number(r.packetsLost),c.ssrc=Number(r.ssrc),c.receivedFrames=Number(r.googDecodingCTN)||Number(r.packetsReceived),c.droppedFrames=Number(r.googDecodingPLC)+Number(r.googDecodingPLCCNG)||Number(r.packetsLost),c.receivedFrames>0&&!this.isFirstAudioReceived[c.ssrc]&&(this.onFirstAudioReceived&&this.onFirstAudioReceived(c.ssrc),this.isFirstAudioReceived[c.ssrc]=!0),c.decodingNormal>0&&!this.isFirstAudioDecoded[c.ssrc]&&(this.onFirstAudioDecoded&&this.onFirstAudioDecoded(c.ssrc),this.isFirstAudioDecoded[c.ssrc]=!0),this._stats.audioRecv.push(c);break}case"audio_send":{const c=Lu(AW);c.codec=r.googCodecName,c.inputLevel=Math.abs(Number(r.audioInputLevel))/32767,c.aecReturnLoss=Number(r.googEchoCancellationReturnLoss||0),c.aecReturnLossEnhancement=Number(r.googEchoCancellationReturnLossEnhancement||0),c.residualEchoLikelihood=Number(r.googResidualEchoLikelihood||0),c.residualEchoLikelihoodRecentMax=Number(r.googResidualEchoLikelihoodRecentMax||0),c.bytes=Number(r.bytesSent),c.packets=Number(r.packetsSent),c.packetsLost=Number(r.packetsLost),c.ssrc=Number(r.ssrc),c.rttMs=Number(r.googRtt||0),this._stats.rtt=c.rttMs,this._stats.audioSend.push(c);break}}})}_getStats(){return new pt((t,r)=>{this.pc.getStats(t,r)})}statsResponsesToObjects(t){const r=[];return t.result().forEach(s=>{const a={id:s.id,timestamp:s.timestamp.valueOf().toString(),type:s.type};s.names().forEach(c=>{a[c]=s.stat(c)}),r.push(a)}),r}},Qw=function(t){return t.BANDWIDTH="bandwidth",t.CPU="cpu",t.NONE="none",t.OTHER="other",t}({}),yP=function(t){return t.L1T1="L1T1",t.L1T2="L1T2",t.L1T3="L1T3",t.L1T3_KEY="L1T3_KEY",t.L2T1_KEY="L2T1_KEY",t.L2T2_KEY="L2T2_KEY",t.L2T3_KEY="L2T3_KEY",t.L3T1_KEY="L3T1_KEY",t.L3T2_KEY="L3T2_KEY",t.L3T3_KEY="L3T3_KEY",t}({}),KL=function(t){return t[t.new=0]="new",t[t.connecting=1]="connecting",t[t.connected=2]="connected",t[t.disconnected=3]="disconnected",t[t.failed=4]="failed",t[t.closed=5]="closed",t}({}),Xc=function(t){return t.CERTIFICATE="certificate",t.CODEC="codec",t.CANDIDATE_PAIR="candidate-pair",t.LOCAL_CANDIDATE="local-candidate",t.REMOTE_CANDIDATE="remote-candidate",t.INBOUND="inbound-rtp",t.TRACK="track",t.OUTBOUND="outbound-rtp",t.PC="peer-connection",t.REMOTE_INBOUND="remote-inbound-rtp",t.REMOTE_OUTBOUND="remote-outbound-rtp",t.TRANSPORT="transport",t.CSRC="csrc",t.DATA_CHANNEL="data-channel",t.STREAM="stream",t.SENDER="sender",t.RECEIVER="receiver",t}({});var Gv=function(t){return t[t.kNone=1]="kNone",t[t.kMillisecondsFromSeconds=1e3]="kMillisecondsFromSeconds",t[t.kBytesToBits=8]="kBytesToBits",t}(Gv||{});function Zw(t,r,s,a){let c=arguments.length>4&&arguments[4]!==void 0?arguments[4]:Gv.kNone;if(!r)return;const d=Number(r[s]);if(typeof d!="number")return;const h=Number(r[a]);if(typeof h!="number")return;if(!t)return h?d/h*c:void 0;const m=Number(t[s]);if(typeof m!="number")return;const g=Number(t[a]);if(typeof g!="number")return;const E=h-g;return E?(d-m)/E*c:void 0}let kW=class extends $L{constructor(){super(...arguments),Qt(this,"_stats",Jw),Qt(this,"report",void 0),Qt(this,"lastDecodeVideoReceiverStats",new Map),Qt(this,"lastVideoFramesRecv",new Map),Qt(this,"lastVideoFramesSent",new Map),Qt(this,"lastVideoFramesDecode",new Map),Qt(this,"lastVideoFramesOutput",new Map),Qt(this,"lastVideoJBDelay",new Map),Qt(this,"lastAudioJBDelay",new Map),Qt(this,"mediaBytesSent",new Map),Qt(this,"mediaBytesRetransmit",new Map),Qt(this,"mediaBytesTargetEncode",new Map),Qt(this,"lastDecodeAudioReceiverStats",new Map),Qt(this,"lastAudioConcealment",new Map),Qt(this,"lastEncoderMs",new Map)}async updateStats(){this.report=await this.pc.getStats(),this._stats=Lu(Jw),this.report.forEach(t=>{switch(t.type){case Xc.OUTBOUND:case Xc.INBOUND:{const r=t.mediaType||t.kind,s=!r&&"frameWidth"in t,a=!r&&!("frameWidth"in t);t.type===Xc.OUTBOUND?r==="audio"||a?this.processAudioOutboundStats(t):(r==="video"||s)&&this.processVideoOutboundStats(t):t.type===Xc.INBOUND&&(r==="audio"||a?this.processAudioInboundStats(t):(r==="video"||s)&&this.processVideoInboundStats(t));break}case Xc.TRANSPORT:{const r=this.report.get(t.selectedCandidatePairId);r&&this.processCandidatePairStats(r);break}case Xc.CANDIDATE_PAIR:t.selected&&this.processCandidatePairStats(t)}}),this.updateSendBitrate(),this._stats.updateInterval=Date.now()-this.stats.timestamp,this._stats.timestamp=Date.now(),this.calcLossRate(this._stats),this.stats=this._stats}async getSelectedCandidatePair(){const t=await this.pc.getStats(),r={local:Qe({},Hh),remote:Qe({},Hh)};return t.forEach(s=>{let a;if(s.type===Xc.TRANSPORT&&(a=t.get(s.selectedCandidatePairId)),s.type===Xc.CANDIDATE_PAIR&&s.selected&&(a=s),a){const c=(d,h)=>{d.type=h.type,d.id=h.id,h.address&&(d.address=h.address),h.candidateType&&(d.candidateType=h.candidateType),h.port&&(d.port=h.port),h.priority&&(d.priority=h.priority),h.protocol&&(d.protocol=h.protocol),h.relayProtocol&&(d.relayProtocol=h.relayProtocol)};if(a.localCandidateId){const d=t.get(a.localCandidateId);d&&c(r.local,d)}if(a.remoteCandidateId){const d=t.get(a.remoteCandidateId);d&&c(r.remote,d)}}}),r}processCandidatePairStats(t){if(this._stats.sendBandwidth=t.availableOutgoingBitrate||0,t.currentRoundTripTime&&(this._stats.rtt=1e3*t.currentRoundTripTime),this._stats.videoSend.forEach(r=>{t.currentRoundTripTime&&(r.rttMs=1e3*t.currentRoundTripTime)}),this._stats.audioSend.forEach(r=>{t.currentRoundTripTime&&(r.rttMs=1e3*t.currentRoundTripTime)}),this._stats.selectedCandidatePair.id=t.id,t.localCandidateId){const r=this.report.get(t.localCandidateId);r&&this.processCandidateStats(r)}if(t.remoteCandidateId){const r=this.report.get(t.remoteCandidateId);r&&this.processCandidateStats(r)}}processCandidateStats(t){let r;t.type===Xc.LOCAL_CANDIDATE&&(r=this._stats.selectedCandidatePair.localCandidate),t.type===Xc.REMOTE_CANDIDATE&&(r=this._stats.selectedCandidatePair.remoteCandidate),r&&(r.type=t.type,r.id=t.id,t.address&&(r.address=t.address),t.candidateType&&(r.candidateType=t.candidateType),t.port&&(r.port=t.port),t.priority&&(r.priority=t.priority),t.protocol&&(r.protocol=t.protocol),t.relayProtocol&&(r.relayProtocol=t.relayProtocol),t.type===Xc.LOCAL_CANDIDATE&&this.stats.selectedCandidatePair.localCandidate.id!==r.id&&this.onSelectedLocalCandidateChanged&&this.onSelectedLocalCandidateChanged(Qe({},r),Qe({},this.stats.selectedCandidatePair.localCandidate)),t.type===Xc.REMOTE_CANDIDATE&&this.stats.selectedCandidatePair.remoteCandidate.id!==r.id&&this.onSelectedRemoteCandidateChanged&&this.onSelectedRemoteCandidateChanged(Qe({},r),Qe({},this.stats.selectedCandidatePair.remoteCandidate)))}processAudioInboundStats(t){let r=this._stats.audioRecv.find(a=>a.ssrc===t.ssrc);r||(r=Lu(PW),this._stats.audioRecv.push(r)),r.ssrc=t.ssrc,r.packets=t.packetsReceived,r.packetsLost=t.packetsLost,r.packetsDiscarded=t.packetsDiscarded,r.bytes=t.bytesReceived,r.jitterMs=1e3*t.jitter,r.retransmittedBytesReceived=t.retransmittedBytesReceived,r.retransmittedPacketsReceived=t.retransmittedPacketsReceived,r.totalProcessingDelay=t.totalProcessingDelay,r.jitterBufferEmittedCount=t.jitterBufferEmittedCount;const s=this.lastDecodeAudioReceiverStats.get(r.ssrc);r.avgProcessingDelayMs=Zw(s,r,"totalProcessingDelay","jitterBufferEmittedCount",Gv.kMillisecondsFromSeconds),this.processAudioTrackReceiverStats(t,t.trackId,r),this.calculateAudioFreeze(r,s,t),t.codecId&&(r.codec=this.getCodecFromCodecStats(t.codecId)),r.receivedFrames||(r.receivedFrames=t.packetsReceived),r.droppedFrames||(r.droppedFrames=t.packetsLost),r.receivedFrames>0&&!this.isFirstAudioReceived[r.ssrc]&&(this.onFirstAudioReceived&&this.onFirstAudioReceived(r.ssrc),this.isFirstAudioReceived[r.ssrc]=!0),r.outputLevel&&r.outputLevel>0&&!this.isFirstAudioDecoded[r.ssrc]&&(this.onFirstAudioDecoded&&this.onFirstAudioDecoded(r.ssrc),this.isFirstAudioDecoded[r.ssrc]=!0),typeof t.concealedSamples=="number"&&(r.concealedSamples=t.concealedSamples),this.lastDecodeAudioReceiverStats.set(r.ssrc,Qe({},r))}calculateAudioFreeze(t,r,s){const a=this.lastAudioConcealment.get(t.ssrc);if(r!=null&&a!=null){const c=a.lts,d=s.timestamp,h=d-c;if(h<=0)return;const m=t.concealedSamples-r.concealedSamples-0,g=a.nonSilent+m,E=t.totalSamplesReceived-r.totalSamplesReceived;if(E<=0)return;const b=80*E/h,I=200*E/h,A=h/E;let k=0;t.freezeSamples80=r.freezeSamples80,t.freezeMs80=r.freezeMs80,g>b&&(a.plc80>0?(t.freezeSamples80+=m,t.freezeMs80+=Math.round(m*A)):(t.freezeSamples80+=g,t.freezeMs80+=Math.round(g*A)),k=a.plc80+1);let W=0;t.freezeSamples200=r.freezeSamples200,t.freezeMs200=r.freezeMs200,g>I&&(a.plc200>0?(t.freezeSamples200+=m,t.freezeMs200+=Math.round(m*A)):(t.freezeSamples200+=g,t.freezeMs200+=Math.round(g*A)),W=a.plc200+1),this.lastAudioConcealment.set(t.ssrc,{nonSilent:m,lts:d,plc80:k,plc200:W})}else t.freezeSamples80=0,t.freezeSamples200=0,t.freezeMs80=0,t.freezeMs200=0,this.lastAudioConcealment.set(t.ssrc,{nonSilent:0,lts:s.timestamp,plc80:0,plc200:0})}processVideoInboundStats(t){let r=this._stats.videoRecv.find(h=>h.ssrc===t.ssrc);r||(r=Lu(RW),this._stats.videoRecv.push(r)),r.ssrc=t.ssrc,r.packets=t.packetsReceived,r.packetsLost=t.packetsLost,r.bytes=t.bytesReceived,r.firsCount=t.firCount,r.nacksCount=t.nackCount,r.plisCount=t.pliCount,r.framesDecodeCount=t.framesDecoded,r.framesDroppedCount=t.framesDropped,r.totalInterFrameDelay=t.totalInterFrameDelay,r.totalSquaredInterFrameDelay=t.totalSquaredInterFrameDelay,r.totalFreezesDuration=t.totalFreezesDuration,r.totalProcessingDelay=t.totalProcessingDelay,r.packetsDiscarded=t.packetsDiscarded,r.framesAssembledFromMultiplePackets=t.framesAssembledFromMultiplePackets,r.totalAssemblyTime=t.totalAssemblyTime,r.keyFramesDecoded=t.keyFramesDecoded,r.retransmittedBytesReceived=t.retransmittedBytesReceived,r.retransmittedPacketsReceived=t.retransmittedPacketsReceived;const s=this.lastDecodeVideoReceiverStats.get(r.ssrc),a=this.lastVideoFramesDecode.get(r.ssrc),c=this.lastVideoFramesOutput.get(r.ssrc),d=Date.now();if(r.framesDecodeCount>0&&!this.isFirstVideoDecoded[r.ssrc]){const h=r.decodedFrame?r.decodedFrame.width:0,m=r.decodedFrame?r.decodedFrame.height:0;this.onFirstVideoDecoded&&this.onFirstVideoDecoded(r.ssrc,h,m),this.isFirstVideoDecoded[r.ssrc]=!0}if(s){const h=s.stats,m=d-s.lts;r.framesDecodeFreezeTime=h.framesDecodeFreezeTime,r.framesDecodeInterval=h.framesDecodeInterval,!this.isFirstVideoDecoded[r.ssrc]&&m>this.options.firstVideoDecodedTimeout&&!this.isFirstVideoDecodedTimeout[r.ssrc]&&(this.onFirstVideoDecodedTimeout&&this.onFirstVideoDecodedTimeout(r.ssrc),this.isFirstVideoDecodedTimeout[r.ssrc]=!0),r.framesDecodeCount>h.framesDecodeCount&&this.isFirstVideoDecoded[r.ssrc]?(s.lts=Date.now(),r.framesDecodeInterval=m,r.framesDecodeInterval>=this.options.freezeRateLimit&&(this.getVideoIsReady(parseInt(t.ssrc))?r.framesDecodeFreezeTime+=r.framesDecodeInterval:this.setVideoIsReady2(parseInt(t.ssrc,10),!0))):r.framesDecodeCount<h.framesDecodeCount&&(r.framesDecodeInterval=0),t.framesDecoded&&t.qpSum&&(s.stats.framesDecodeCount>t.framesDecoded?r.qpSumPerFrame=t.qpSum/t.framesDecoded:r.qpSumPerFrame=(t.qpSum-s.qpSum)/(t.framesDecoded-s.stats.framesDecodeCount))}t.totalDecodeTime&&(r.decodeMs=1e3*t.totalDecodeTime,r.avgDecodeMs=Zw(s==null?void 0:s.stats,r,"decodeMs","framesDecodeCount")),r.avgProcessingDelayMs=Zw(s==null?void 0:s.stats,r,"totalProcessingDelay","framesDecodeCount",Gv.kMillisecondsFromSeconds),r.avgFramesAssembledFromMultiplePacketsMs=Zw(s==null?void 0:s.stats,r,"totalAssemblyTime","framesAssembledFromMultiplePackets",Gv.kMillisecondsFromSeconds),r.avgInterFrameDelayMs=Zw(s==null?void 0:s.stats,r,"totalInterFrameDelay","framesDecodeCount",Gv.kMillisecondsFromSeconds),a&&d-a.lts>=800?(r.decodeFrameRate=Math.round((r.framesDecodeCount-a.count)/((d-a.lts)/1e3)),this.lastVideoFramesDecode.set(r.ssrc,{count:r.framesDecodeCount,lts:d,rate:r.decodeFrameRate})):a?r.decodeFrameRate=a.rate:this.lastVideoFramesDecode.set(r.ssrc,{count:r.framesDecodeCount,lts:d,rate:0}),r.framesDroppedCount&&t.framesReceived&&(c&&d-c.lts>=800?(r.outputFrameRate=Math.round((t.framesReceived-r.framesDroppedCount-c.count)/((d-c.lts)/1e3)),this.lastVideoFramesOutput.set(r.ssrc,{count:t.framesReceived-r.framesDroppedCount,lts:d,rate:Math.max(r.outputFrameRate,0)})):c?r.outputFrameRate=c.rate:this.lastVideoFramesOutput.set(r.ssrc,{count:t.framesReceived-r.framesDroppedCount,lts:d,rate:0})),this.processVideoTrackReceiverStats(t,t.trackId,r),t.codecId&&(r.codec=this.getCodecFromCodecStats(t.codecId)),t.framerateMean&&(r.framesRateFirefox=t.framerateMean),r.packets>0&&!this.isFirstVideoReceived[r.ssrc]&&(this.onFirstVideoReceived&&this.onFirstVideoReceived(r.ssrc),this.isFirstVideoReceived[r.ssrc]=!0),this.lastDecodeVideoReceiverStats.set(r.ssrc,{stats:Qe({},r),lts:s?s.lts:Date.now(),qpSum:t.qpSum})}processVideoOutboundStats(t){let r=this._stats.videoSend.find(a=>a.ssrc===t.ssrc);r||(r=Lu(IW),this._stats.videoSend.push(r));const s=this.mediaBytesSent.get(t.ssrc);if(s)s.add(t.bytesSent);else{const a=new HL(10);a.add(t.bytesSent),this.mediaBytesSent.set(t.ssrc,a)}if(t.retransmittedBytesSent!==void 0){const a=this.mediaBytesRetransmit.get(t.ssrc);if(a)a.add(t.retransmittedBytesSent);else{const c=new HL(10);c.add(t.retransmittedBytesSent),this.mediaBytesRetransmit.set(t.ssrc,c)}}if(t.totalEncodedBytesTarget){const a=this.mediaBytesTargetEncode.get(t.ssrc);if(a)a.add(t.totalEncodedBytesTarget);else{const c=new HL(10);c.add(t.totalEncodedBytesTarget),this.mediaBytesTargetEncode.set(t.ssrc,c)}}if(r.ssrc=t.ssrc,r.bytes=t.bytesSent,r.packets=t.packetsSent,r.firsCount=t.firCount,r.nacksCount=t.nackCount,r.plisCount=t.pliCount,r.frameCount=t.framesEncoded,r.adaptionChangeReason=t.qualityLimitationReason,r.scalabilityMode=t.scalabilityMode,r.retransmittedBytesSent=t.retransmittedBytesSent,r.retransmittedPacketsSent=t.retransmittedPacketsSent,r.hugeFramesSent=t.hugeFramesSent,r.keyFramesEncoded=t.keyFramesEncoded,r.targetBitrate=t.targetBitrate,t.totalEncodeTime&&t.framesEncoded){const a=this.lastEncoderMs.get(t.ssrc);if(!a||a.lastFrameCount>t.framesEncoded)r.avgEncodeMs=1e3*t.totalEncodeTime/t.framesEncoded;else{const c=t.framesEncoded-a.lastFrameCount,d=t.totalEncodeTime-a.lastEncoderTime;r.avgEncodeMs=1e3*d/c}}if(t.framesEncoded&&t.qpSum){const a=this.lastEncoderMs.get(t.ssrc);!a||a.lastFrameCount>t.framesEncoded?r.qpSumPerFrame=t.qpSum/t.framesEncoded:r.qpSumPerFrame=(t.qpSum-a.lastQpSum)/(t.framesEncoded-a.lastFrameCount)}if(this.lastEncoderMs.set(t.ssrc,{lastFrameCount:t.framesEncoded,lastEncoderTime:t.totalEncodeTime,lastQpSum:t.qpSum,lts:Date.now()}),t.codecId&&(r.codec=this.getCodecFromCodecStats(t.codecId)),t.mediaSourceId&&this.processVideoMediaSource(t.mediaSourceId,r),this.processVideoTrackSenderStats(t,t.trackId,r),t.remoteId)this.processRemoteInboundStats(t.remoteId,r);else{const a=this.findRemoteStatsId(t.ssrc,Xc.REMOTE_INBOUND);a&&this.processRemoteInboundStats(a,r)}}processAudioOutboundStats(t){let r=this._stats.audioSend.find(s=>s.ssrc===t.ssrc);if(r||(r=Lu(AW),this._stats.audioSend.push(r)),r.ssrc=t.ssrc,r.packets=t.packetsSent,r.bytes=t.bytesSent,r.retransmittedBytesSent=t.retransmittedBytesSent,r.retransmittedPacketsSent=t.retransmittedPacketsSent,t.mediaSourceId&&this.processAudioMediaSource(t.mediaSourceId,r),t.codecId&&(r.codec=this.getCodecFromCodecStats(t.codecId)),this.processAudioTrackSenderStats(t,t.trackId,r),t.remoteId)this.processRemoteInboundStats(t.remoteId,r);else{const s=this.findRemoteStatsId(t.ssrc,Xc.REMOTE_INBOUND);s&&this.processRemoteInboundStats(s,r)}}findRemoteStatsId(t,r){var s;const a=Array.from(Sc(s=this.report).call(s)).find(c=>c.type===r&&c.ssrc===t);return a?a.id:null}processVideoMediaSource(t,r){const s=this.report.get(t);s&&s.width&&s.height&&s.framesPerSecond&&(r.inputFrame={width:s.width,height:s.height,frameRate:s.framesPerSecond})}processAudioMediaSource(t,r){const s=this.report.get(t);s&&(r.inputLevel=s.audioLevel)}processVideoTrackSenderStats(t,r,s){var a,c,d,h;const m=r?this.report.get(r):void 0,g=(a=m==null?void 0:m.framesSent)!==null&&a!==void 0?a:t.framesSent;if(typeof g!="number")return;let E=(c=m==null?void 0:m.frameWidth)!==null&&c!==void 0?c:t.frameWidth,b=(d=m==null?void 0:m.frameHeight)!==null&&d!==void 0?d:t.frameHeight,I=(h=m==null?void 0:m.framesPerSecond)!==null&&h!==void 0?h:t.framesPerSecond;if(typeof E=="number"&&typeof b=="number"||(E=0,b=0),I==null){const A=Date.now(),k=this.lastVideoFramesSent.get(s.ssrc);k&&A-k.lts>=800?(I=Math.round((g-k.count)/((A-k.lts)/1e3)),this.lastVideoFramesSent.set(s.ssrc,{count:g,lts:A,rate:I})):k?I=k.rate:this.lastVideoFramesSent.set(s.ssrc,{count:g,lts:A,rate:0})}s.sentFrame={width:E,height:b,frameRate:Math.max(0,I)}}processVideoTrackReceiverStats(t,r,s){var a,c,d,h,m;const g=r?this.report.get(r):void 0,E=(a=g==null?void 0:g.framesReceived)!==null&&a!==void 0?a:t.framesReceived,b=(c=g==null?void 0:g.frameWidth)!==null&&c!==void 0?c:t.frameWidth,I=(d=g==null?void 0:g.frameHeight)!==null&&d!==void 0?d:t.frameHeight,A=(h=g==null?void 0:g.jitterBufferDelay)!==null&&h!==void 0?h:t.jitterBufferDelay,k=(m=g==null?void 0:g.jitterBufferEmittedCount)!==null&&m!==void 0?m:t.jitterBufferEmittedCount;if(typeof E=="number"){const W=this.lastVideoFramesRecv.get(s.ssrc),j=Date.now();s.framesReceivedCount=E;let B=0;W&&j-W.lts>=800?(B=Math.round((E-W.count)/((j-W.lts)/1e3)),this.lastVideoFramesRecv.set(s.ssrc,{count:E,lts:j,rate:B})):W?B=W.rate:this.lastVideoFramesRecv.set(s.ssrc,{count:E,lts:j,rate:0}),s.receivedFrame={width:b||0,height:I||0,frameRate:B||0},s.decodedFrame={width:b||0,height:I||0,frameRate:s.decodeFrameRate||0},s.outputFrame={width:b||0,height:I||0,frameRate:s.outputFrameRate||s.decodeFrameRate||0}}if(A&&k){const W=this.lastVideoJBDelay.get(s.ssrc)||{jitterBufferDelay:0,jitterBufferEmittedCount:0,jitterBufferMs:0};let j=W.jitterBufferMs;const B=k-W.jitterBufferEmittedCount;B>0&&(j=1e3*(A-W.jitterBufferDelay)/B),s.jitterBufferMs=j,s.currentDelayMs=Math.round(j),this.lastVideoJBDelay.set(s.ssrc,{jitterBufferDelay:A,jitterBufferEmittedCount:k,jitterBufferMs:s.currentDelayMs})}}processAudioTrackSenderStats(t,r,s){var a,c,d,h;const m=r?this.report.get(r):void 0,g=(a=(c=m==null?void 0:m.echoReturnLoss)!==null&&c!==void 0?c:t.echoReturnLoss)!==null&&a!==void 0?a:0,E=(d=(h=m==null?void 0:m.echoReturnLossEnhancement)!==null&&h!==void 0?h:t.echoReturnLossEnhancement)!==null&&d!==void 0?d:0;s.aecReturnLoss=g,s.aecReturnLossEnhancement=E}processAudioTrackReceiverStats(t,r,s){var a,c,d,h,m,g,E,b,I;const A=r?this.report.get(r):void 0,k=(a=A==null?void 0:A.removedSamplesForAcceleration)!==null&&a!==void 0?a:t.removedSamplesForAcceleration,W=(c=A==null?void 0:A.totalSamplesReceived)!==null&&c!==void 0?c:t.totalSamplesReceived,j=(d=A==null?void 0:A.jitterBufferDelay)!==null&&d!==void 0?d:t.jitterBufferDelay,B=(h=A==null?void 0:A.jitterBufferEmittedCount)!==null&&h!==void 0?h:t.jitterBufferEmittedCount,ee=(m=A==null?void 0:A.audioLevel)!==null&&m!==void 0?m:t==null?void 0:t.audioLevel,Z=(g=A==null?void 0:A.totalSamplesDuration)!==null&&g!==void 0?g:t==null?void 0:t.totalSamplesDuration,oe=(E=A==null?void 0:A.concealedSamples)!==null&&E!==void 0?E:t.concealedSamples,ye=(b=A==null?void 0:A.silentConcealedSamples)!==null&&b!==void 0?b:t.silentConcealedSamples,_e=(I=A==null?void 0:A.concealmentEvents)!==null&&I!==void 0?I:t.concealmentEvents;if(typeof W=="number"&&(s.totalSamplesReceived=W),typeof ye=="number"&&(s.silentConcealedSamples=ye),typeof _e=="number"&&(s.concealmentEvents=_e),typeof oe=="number"&&(s.concealedSamples=oe),k&&W&&(s.accelerateRate=k/W),j&&B){const Ce=this.lastAudioJBDelay.get(s.ssrc)||{jitterBufferDelay:0,jitterBufferEmittedCount:0,jitterBufferMs:0};let Ue=Ce.jitterBufferMs;const ze=B-Ce.jitterBufferEmittedCount;ze>0&&(Ue=1e3*(j-Ce.jitterBufferDelay)/ze),s.jitterBufferMs=Math.round(Ue),this.lastAudioJBDelay.set(s.ssrc,{jitterBufferDelay:j,jitterBufferEmittedCount:B,jitterBufferMs:s.jitterBufferMs})}s.outputLevel=ee;let ue=1920;Z&&W&&(ue=W/Z/50,s.receivedFrames=Math.round(W/ue)),oe&&(s.droppedFrames=Math.round(oe/ue))}processRemoteInboundStats(t,r){const s=this.report.get(t);s&&(r.packetsLost=s.packetsLost,s.roundTripTime&&(r.rttMs=1e3*s.roundTripTime),s.jitter&&(r.jitterMs=1e3*s.jitter),s.timestamp&&(r.timestamp=s.timestamp))}getCodecFromCodecStats(t){const r=this.report.get(t);if(!r)return"";const s=r.mimeType.match(/\/(.*)$/);return s&&s[1]?s[1]:""}updateSendBitrate(){let t=0,r=null,s=null;this.mediaBytesSent.forEach(c=>{t+=c.diffMean()}),this.mediaBytesRetransmit.forEach(c=>{r=r===null?c.diffMean():r+c.diffMean()}),this.mediaBytesTargetEncode.forEach(c=>{s=s===null?c.diffMean():s+c.diffMean()});const a=r!==null?t-r:t;this._stats.bitrate={actualEncoded:8*a/(this.options.updateInterval/1e3),transmit:8*t/(this.options.updateInterval/1e3)},r!==null&&(this._stats.bitrate.retransmit=8*r/(this.options.updateInterval/1e3)),s!==null&&(this._stats.bitrate.targetEncoded=8*s/(this.options.updateInterval/1e3))}},Mme=class extends $L{updateStats(){return pt.resolve()}};function qL(t){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:250,s=arguments.length>2&&arguments[2]!==void 0?arguments[2]:8,a=arguments.length>3&&arguments[3]!==void 0?arguments[3]:500,c=arguments.length>4&&arguments[4]!==void 0?arguments[4]:1e4;const d=function(){const h=navigator.userAgent.toLocaleLowerCase().match(/chrome\/[\d]*/i);return h&&h[0]?Number(h[0].split("/")[1]):null}();return d?d<76?new Lme(t,{updateInterval:r,lossRateInterval:s,freezeRateLimit:a,firstVideoDecodedTimeout:c}):new kW(t,{updateInterval:r,lossRateInterval:s,freezeRateLimit:a,firstVideoDecodedTimeout:c}):function(h){if(!window.RTCStatsReport)return!1;const m=h.getStats();return!!(m instanceof pt||function(g){return!!g&&(typeof g=="object"||typeof g=="function")&&typeof g.then=="function"}(m))}(t)?new kW(t,{updateInterval:r,lossRateInterval:s,freezeRateLimit:a,firstVideoDecodedTimeout:c}):new Mme(t,{updateInterval:r,lossRateInterval:s,freezeRateLimit:a,firstVideoDecodedTimeout:c})}const OW="websdk_ng_install_id";function YL(){try{if(se("INSTALL_ID"))return se("INSTALL_ID");let t=window.localStorage.getItem(OW);return t||(t=ty(),window.localStorage.setItem(OW,t)),pr("INSTALL_ID",t),t}catch{return}}const Bl=function(t){if(t.match(/[0-9]+\.[0-9]+\.[0-9]+$/))return t;const r=t.match(/([0-9]+\.[0-9]+\.[0-9]+)\-([0-9]+)/);if(r&&r[1]&&r[2]){const s=r[1],a=r[2];return"".concat(s,".").concat(a)}return"4.0.0.999"}("4.24.0"),XL=function(){try{return JSON.parse("true")===!0}catch{return!0}}();let ny=function(t){return t.Default="default",t.Auto="auto",t.Relay="relay",t.SdRtn="sd-rtn",t}({});const Us=function(){const t="us".concat("erna","me"),r="pa".concat("sswo","rd"),s=["t","s","t"];s.splice(1,0,"e");const a=s.join(""),c=[];for(let m=0;m<6;m++)c.push("1");const d=c.join(""),h={};return h[t]=a,h[r]=d,Object.assign(h,{turnServerURL:"",tcpport:3433,udpport:3478,forceturn:!1})}();window.DEFAULT_TURN_CONFIG=Us;const EP={ENABLE_PUBLISHED_USER_LIST:!0,MAX_SUBSCRIPTION:50,SUBSCRIBE_AUDIO_FILTER_TOPN:void 0,ENABLE_PUBLISH_AUDIO_FILTER:void 0,ENABLE_USER_LICENSE_CHECK:!0,DISABLE_FEC:void 0,ENABLE_NTP_REPORT:!1,ENABLE_INSTANT_VIDEO:!1,ENABLE_USER_AUTO_REBALANCE_CHECK:!0,ENABLE_LOSSBASED_BWE:!0,ENABLE_AUT_CC:!0,FORCE_ENABLE_AUT_CC:!1,ENABLE_CC_FALLBACK:void 0,SUBSCRIBE_TWCC:!0,PUBLISH_TWCC:!1,ENABLE_SVC_DEFAULT_CODECS:["H264","VP8","VP9","AV1"],SVC:[],ENABLE_FULL_LINK_AV_SYNC:!1,SVC_MODE:null,PRE_SUB_NUM:1,ENABLE_AUT_FEEDBACK:!0,SVC_EXTENDED:["VP9"]},JL={MIN_FRAME_RATE:1,MAX_FRAME_RATE:30,MAX_THRESHOLD_FRAMERATE:30,BITRATE_MIN_THRESHOLD:100,BITRATE_MAX_THRESHOLD:100,MAX_SCALE:5,BWE_SCALE_UP_THRESHOLD:.6,BWE_SCALE_DOWN_THRESHOLD:.6,PERF_SCALE_UP_THRESHOLD:.7,PERF_SCALE_DOWN_THRESHOLD:.6,MOTION_RESOLUTION_FACTOR:.8,MOTION_BITRATE_FACTOR:.6,DETAIL_FRAMERATE_FACTOR:.8,DETAIL_BITRATE_FACTOR:.6,BALANCE_RESOLUTION_FACTOR:.9,BALANCE_FRAMERATE_FACTOR:.9,BALANCE_BITRATE_FACTOR:.6,OVERUSE_TIMES_THRESHOLD:10,UNDERUSE_TIMES_THRESHOLD:40},QL="v4.24.0-0-gf2267710-dirty(7/31/2025, 7:00:42 PM)",ZL={ENABLE_EVENT_REPORT:!0,UPLOAD_LOG:!1,ENABLE_AG_ADAPTATION:!0,FORCE_AG_HIGH_FRAMERATE:!1,FORCE_SUPPORT_AG_ADAPTATION:!1,ENCODER_CONFIG_LIMIT:{},CAMERA_CAPTURE_CONFIG:void 0,ENABLE_PRELOAD:!0,NEW_ICE_RESTART:!0,ICE_RESTART_INTERVAL:1e4,RESTART_SEQUENCE:["udp_tcp_relay","relay"],FIRST_TCP_CANDIDATE:!1,FIRST_TCP_CANDIDATE_INTERVAL:1e3,TURN_DOMAIN:"edge.agora.io",USE_TURN_IP:!0,NEW_TURN_MODE:4,NEW_FORCE_TURN:!1,USE_NEW_RENDER_FREEZE_TIME:!1,ENCODE_EXCEPTION_TIMES:5,ENABLE_ENCODE_EXCEPTION:!0,ENCODE_EXCEPTION_VALIDATE_CODEC:["h264"],VIDEO_ENCODER_CONFIG_LIST:[{width:240,height:180},{width:320,height:240},{width:400,height:300},{width:480,height:360},{width:560,height:420},{width:640,height:480}],DELETE_NEQ_AFTER_USER_LEAVE:!0},zr=Qe(Qe(Qe(Qe({},ZL),{},{PROCESS_ID:"",ENCRYPT_AES:!0,AREAS:["CHINA","GLOBAL"],WEBCS_DOMAIN:["webrtc2-ap-web-1.agora.io","webrtc2-2.ap.sd-rtn.com"],WEBCS_DOMAIN_BACKUP_LIST:["webrtc2-ap-web-3.agora.io","webrtc2-4.ap.sd-rtn.com"],PROXY_CS:["ap-proxy-1.agora.io","ap-proxy-2.agora.io"],CDS_AP:["cds-ap-web-1.agora.io","cds-web-2.ap.sd-rtn.com","cds-ap-web-3.agora.io","cds-web-4.ap.sd-rtn.com"],ACCOUNT_REGISTER:["sua-ap-web-1.agora.io","sua-web-2.ap.sd-rtn.com","sua-ap-web-3.agora.io","sua-web-4.ap.sd-rtn.com"],UAP_AP:["uap-ap-web-1.agora.io","uap-web-2.ap.sd-rtn.com","uap-ap-web-3.agora.io","uap-web-4.ap.sd-rtn.com"],LOG_UPLOAD_SERVER:"logservice.agora.io",EVENT_REPORT_DOMAIN:"statscollector-1.agora.io",EVENT_REPORT_BACKUP_DOMAIN:"web-2.statscollector.sd-rtn.com",GATEWAY_ADDRESS:[],GATEWAY_WSS_ADDRESS:"",LIVE_STREAMING_ADDRESS:"",HTTP_CONNECT_TIMEOUT:5e3,SIGNAL_REQUEST_TIMEOUT:1e4,REPORT_STATS:!0,NOT_REPORT_EVENT:[],PING_PONG_TIME_OUT:10,WEBSOCKET_TIMEOUT_MIN:1e4,EVENT_REPORT_SEND_INTERVAL:3e3,CONFIG_DISTRIBUTE_INTERVAL:3e5,ENABLE_CONFIG_DISTRIBUTE:!0,CANDIDATE_TIMEOUT:5e3,SHOW_REPORT_INVOKER_LOG:!1,SHOW_REPORT_USER_INVOKER_LOG:!0,JOIN_EXTEND:"",PUB_EXTEND:"",SUB_EXTEND:"",FORCE_TURN:!1,TURN_ENABLE_TCP:!0,TURN_ENABLE_UDP:!0,MAX_UPLOAD_CACHE:50,UPLOAD_CACHE_INTERVAL:2e3,AJAX_REQUEST_CONCURRENT:3,REPORT_APP_SCENARIO:void 0,GATEWAY_DOMAINS:["edge.agora.io","edge.sd-rtn.com"],CONNECT_GATEWAY_WITHOUT_DOMAIN:!1,WORKER_DOMAIN:"edge.agora.io",EVENT_REPORT_RETRY:!0,CHROME_FORCE_PLAN_B:!1,AUDIO_SOURCE_VOLUME_UPDATE_INTERVAL:400,AUDIO_SOURCE_AVG_VOLUME_DURATION:3e3,AUDIO_VOLUME_INDICATION_INTERVAL:2e3,VOLUME_VOICE_WEIGHT:10,GET_VOLUME_OF_MUTED_AUDIO_TRACK:!1,STATS_UPDATE_INTERVAL:250,NORMAL_EVENT_QUEUE_CAPACITY:100,CUSTOM_REPORT:!0,CUSTOM_REPORT_LIMIT:20,PROXY_SERVER_TYPE2:"webnginx-proxy.agora.io",PROXY_SERVER_TYPE3:["webrtc-cloud-proxy.sd-rtn.com","webrtc-cloud-proxy.agora.io"],CUSTOM_PUB_ANSWER_MODIFIER:null,CUSTOM_SUB_ANSWER_MODIFIER:null,CUSTOM_PUB_OFFER_MODIFIER:null,CUSTOM_SUB_OFFER_MODIFIER:null,DSCP_TYPE:"high",REMOVE_NEW_CODECS:!0,FRAGEMENT_LENGTH:3,WEBSOCKET_COMPRESS:!1,SIMULCAST:!1,CHECK_VIDEO_VISIBLE_INTERVAL:3e4,CHECK_LOCAL_STATS_INTERVAL:250,PROFILE_SWITCH_INTERVAL:2e3,UNSUPPORTED_VIDEO_CODEC:[],ENUMERATE_DEVICES_INTERVAL:!1,ENUMERATE_DEVICES_INTERVAL_TIME:1e4,USE_NEW_TOKEN:!1,CLOSE_AFB_FOR_LOCAL_AP:!0,JOIN_MAX_CONCURRENCY:6,JOIN_WITH_FALLBACK_SIGNAL_PROXY:!0,JOIN_WITH_FALLBACK_MEDIA_PROXY:!0,JOIN_WITH_FALLBACK_MEDIA_PROXY_FORCE:!1,JOIN_GATEWAY_TRY_443PORT_DURATION:2e3,JOIN_GATEWAY_USE_443PORT_ONLY:!1,JOIN_GATEWAY_USE_DUAL_DOMAIN:!0,JOIN_GATEWAY_FALLBACK_PORT:443,USE_TURN_SERVER_OF_GATEWAY:!1,H264_PROFILE_LEVEL_ID:"",USE_NEW_LOG:!1,LOG_VERSION:3,MEDIA_DEVICE_CONSTRAINTS:null,ENCRYPT_PROXY_USERNAME_AND_PSW:!0,SDP_LOGGING:!1,CSP_DETECTED_HOSTNAME_LIST:["agora.io","sd-rtn.com"],REMOTE_AUDIO_TRACK_USES_WEB_AUDIO:!1,LOCAL_AUDIO_TRACK_USES_WEB_AUDIO:!1,BITRATE_ADAPTER_TYPE:"STANDARD_BITRATE",AI_DENOISER_PARAMETERS:{excludedLinks:[]},ADJUST_3A_FROM_PLUGINS:!0,RAISE_H264_BASELINE_PRIORITY:!0,FILTER_SEND_H264_BASELINE:!1,FIRST_H264_PROFILE_LEVEL_ID:"42001f",FIRST_PACKETIZATION_MODE:"",X_GOOGLE_START_BITRATE:void 0,NEW_REPORT_SERVER:!1,NEW_REPORT_SERVER_DOMAINS:["data-reporting.agora.io","data-reporting.agora.io"],VIDEO_INSPECT_WORKER_MESSAGE_LENGTH_LIMIT:3e5,VIDEO_INSPECT_INTERVAL_MINIMUM:1e3,VIDEO_INSPECT_QUALITY_RATIO:.9,VIDEO_INSPECT_WORKER_MANAGER_HOST:"edge.agora.io",VIDEO_INSPECT_WORKER_MANAGER_PORT:"",VIDEO_INSPECT_WORKER_PORT:"",SHOW_VIDEO_INSPECT_WORKER_MESSAGE:!1,STATS_COLLECTOR_PORT:443,FORCE_TURN_TCP:!1,WEBAUDIO_INIT_OPTIONS:void 0,FILTER_VIDEO_FEC:!0,FILTER_AUDIO_FEC:!1,CHROME_DUAL_STREAM_USE_ENCODING:!0,DISABLE_DUAL_STREAM_USE_ENCODING:!1,EXTENSION_USAGE_UPLOAD_INTERVAL:1e4,ICE_RESTART:!0,FINGERPRINT:null,ENABLE_VIDEO_FRAME_CALLBACK:!0,VIDEO_FREEZE_DURATION:500,SPATIALIZER_PARAMETERS:{},UPLOAD_LOG_INTERVAL:3e3,UPLOAD_LOG_REQUEST_RETRY_INTERVAL:2e3,UPLOAD_LOG_REQUEST_MAX_RETRY_INTERVAL:2e4,UPLOAD_LOG_TRY_INTERVAL_WHILE_OFF:5e3,UPLOAD_LOG_RETRY_INTERVAL_V1:1e4,UPLOAD_LOG_TWICE_RETRY_INTERVAL_V1:200,UPLOAD_LOG_LENGTH_EACH_TIME:10,APP_TYPE:0,DISABLE_WEBAUDIO:!1,CHANNEL_MEDIA_RELAY_SERVERS:void 0,KEEP_LAST_FRAME:!0,FORWARD_P2P_CREATION:!0,SYNC_GROUP:!0,BLOCK_LOCAL_CLIENT:!1,ENABLE_AUDIO_TOPN:!1,ENABLE_AUDIO_METADATA:!1,ENABLE_AUDIO_PTS:!1,TOPN_SMOOTH_LEVEL:void 0,TOPN_NEW_SPEAKER_DELAY:void 0,TOPN_SWITCH_HOLD_MS:void 0,TOPN_AUDIO_GAIN:void 0,TOPN_SILENCE_THRESHOLD:250,AP_AREA:!0,ENABLE_ENCODED_TRANSFORM:!1,ENABLE_VIDEO_SEI:!1,IMAGE_MODERATION_WORKER_HOST:"edge.agora.io",IMAGE_MODERATION_WORKER_MESSAGE_LENGTH_LIMIT:3e5,IMAGE_MODERATION_INTERVAL_MINIMUM:1e3,SHOW_IMAGE_MODERATION_WORKER_MESSAGE:!1,IMAGE_MODERATION_QUALITY_RATIO:.9,IMAGE_MODERATION_UPLOAD_REPORT_INTERVAL:5e3,SHOW_GLOBAL_CLIENT_LIST:!1,DATASTREAM_MAX_RETRANSMITS:10,TCP_CANDIDATE_ONLY:!1,EXTERNAL_SIGNAL_REQUEST_TIMEOUT:3e3,SHOW_P2P_LOG:!1,MAX_P2P_TIMEOUT:3e4,P2P_TOKEN_INTERVAL:1e3,SHOW_DATASTREAM2_LOG:!1,RESTRICTION_SET_PLAYBACK_DEVICE:!0,USE_PURE_ENCRYPTION_MASTER_KEY:!1,ENABLE_AUDIO_RED:!1,OPUS_PTIME:void 0,AUDIO_DUPLICATE_NUM:void 0,ENABLE_ABSSENDTIME_AS_SENTTS:!0,ACCOUNT_REGISTER_RETRY_TIMEOUT:1,ACCOUNT_REGISTER_RETRY_RATIO:2,ACCOUNT_REGISTER_RETRY_TIMEOUT_MAX:6e4,ACCOUNT_REGISTER_RETRY_COUNT_MAX:1e5,AUDIO_CONTEXT:null,WEBCS_BACKUP_CONNECT_TIMEOUT:6e3,PLAYER_STATE_DEFER:2e3,SIGNAL_REQUEST_WATCH_INTERVAL:1e3,FILEPATH_LENMAX:255,DUALSTREAM_OPERATION_CHECK:!0,MEDIA_ELEMENT_EXISTS_DEPTH:3,SHIM_CANDIDATE:!1,LEAVE_MSG_TIMEOUT:2e3,STATS_FILTER:{transportId:!0,googTrackId:!0},FILTER_VIDEO_CODEC:[],UNSUPPORTED_VIDEO_UPLINK_CODEC:[],UNSUPPORTED_VIDEO_DOWNLINK_CODEC:[],USE_NEW_NETWORK_CONFIG:!1,AUTO_RESET_AUDIO_ROUTE:!1,PLUGIN_INFO:[],OVERUSE_DETECTOR_PARAMS:JL,CUSTOM_ADAPTATION_DEFAULT_MODE:"",HIDE_NO_POSTER:!1,AP_CACHE_NUM:10,AP_UPDATE_INTERVAL:12e4,AP_CACHE_LIFETIME:12e4,MAX_PRELOAD_ASYNC_LENGTH:3,DISABLE_SCREEN_SHARE_REMB:!1},EP),{},{USE_CANDIDATE_FROM_AP_DETAIL:!1,AP_REQUEST_DETAIL:void 0,ENABLE_ROLE_SELECT_EDGE:!1,CLIENT_ROLE_OPTIONS:void 0,COMPATIBLE_SDP_EXTENSION:["gdpr_forbidden"],LIMIT_BITRATE:void 0,EXPERIMENTS:{},USE_PUB_RTX:!0,USE_SUB_RTX:!0,ENABLE_DATASTREAM_2:!1,USE_XR:!0,ENABLE_PREALLOC_PC:!1,ENABLE_PRE_SUB:!1,ENABLE_SVC:!1,ENABLE_PRE_RENDER:!1,FORCE_DISABLE_AUTO_SUB:!1,ENABLE_PRE_SUB_WITH_PRE_PC:!1,PRE_USE_LOCAL_CODECS:!0},{INSTALL_ID:""}),{},{K_MIN_RENDER_DELAY:66,USE_STANDARD_BITRATE_DEFAULT:!1,VIDEO_NEW_BITRATE_RATIO:void 0,VIDEO_STANDARD_BITRATE_VERSION:2,BASELINE_MORE_H264_BITRATE_RATIO:1.1});function pr(t,r,s){var a,c,d;rt(a=Object.keys(zr)).call(a,t)&&(!s&&rt(c=Object.keys(Wd)).call(c,t)||(zr[t]=r,t!=="ENABLE_VIDEO_SEI"&&t!=="ENABLE_AUDIO_TOPN"&&t!=="ENABLE_AUDIO_METADATA"&&t!=="ENABLE_AUDIO_PTS"||r!==!0||(zr.ENABLE_ENCODED_TRANSFORM=!0),t==="USE_NEW_NETWORK_CONFIG"&&r&&(d=!!r,zr.USE_NEW_NETWORK_CONFIG=d,d&&(zr.WEBCS_DOMAIN=["webrtc2-2.ap.sd-rtn.com"],zr.WEBCS_DOMAIN_BACKUP_LIST=["webrtc2-4.ap.sd-rtn.com"],zr.CDS_AP=["cds-web-2.ap.sd-rtn.com","cds-web-4.ap.sd-rtn.com"],zr.ACCOUNT_REGISTER=["sua-web-2.ap.sd-rtn.com","sua-web-4.ap.sd-rtn.com"],zr.EVENT_REPORT_DOMAIN="web-2.statscollector.sd-rtn.com",zr.EVENT_REPORT_BACKUP_DOMAIN="statscollector-1.agora.io",zr.GATEWAY_DOMAINS=["edge.sd-rtn.com"])),t==="ENABLE_PRE_SUB"&&r&&(zr.ENABLE_INSTANT_VIDEO=!0,zr.ENABLE_PREALLOC_PC=!0),t==="ENABLE_SVC"&&r&&(zr.ENABLE_AUT_CC=!0),t==="NEW_FORCE_TURN"&&r&&(zr.NEW_TURN_MODE||(zr.NEW_TURN_MODE=4))))}function se(t){return zr[t]}XL||(zr.WEBCS_DOMAIN=["ap-web-1-oversea.agora.io","ap-web-1-north-america.agora.io"],zr.WEBCS_DOMAIN_BACKUP_LIST=["ap-web-2-oversea.agora.io","ap-web-2-north-america.agora.io"],zr.PROXY_CS=["proxy-ap-web-oversea.agora.io","proxy-ap-web-america.agora.io"],zr.CDS_AP=["cds-ap-web-oversea.agora.io","cds-ap-web-america.agora.io","cds-ap-web-america2.agora.io"],zr.ACCOUNT_REGISTER=["sua-ap-web-oversea.agora.io","sua-ap-web-america.agora.io","sua-ap-web-america2.agora.io"],zr.UAP_AP=["uap-ap-web-oversea.agora.io","uap-ap-web-america.agora.io","uap-ap-web-america2.agora.io"],zr.LOG_UPLOAD_SERVER="logservice-oversea.agora.io",zr.EVENT_REPORT_DOMAIN="statscollector-1-oversea.agora.io",zr.EVENT_REPORT_BACKUP_DOMAIN="statscollector-2-oversea.agora.io",zr.PROXY_SERVER_TYPE3="webrtc-cloud-proxy.agora.io",zr.AREAS=["NORTH_AMERICA","OVERSEA"]);let NW=function(t){return t[t.REALTIME=1]="REALTIME",t}({});const Wd={};var en=function(t){return t.SET_SESSION_ID="SET_SESSION_ID",t.SET_P2P_ID="SET_P2P_id",t.SET_DC_ID="SET_DC_id",t.SET_UID="SET_UID",t.SET_INT_UID="SET_INT_UID",t.SET_PUB_ID="SET_PUB_ID",t.SET_CLOUD_PROXY_SERVER_MODE="SET_CLOUD_PROXY_SERVER_MODE",t.KEY_METRIC_CLIENT_CREATED="KEY_METRIC_CLIENT_CREATED",t.KEY_METRIC_JOIN_START="KEY_METRIC_JOIN_START",t.KEY_METRIC_PRELOAD_START="KEY_METRIC_PRELOAD_START",t.KEY_METRIC_PRELOAD_END="KEY_METRIC_PRELOAD_END",t.KEY_METRIC_JOIN_END="KEY_METRIC_JOIN_END",t.KEY_METRIC_REQUEST_AP_START="KEY_METRIC_REQUEST_AP_START",t.KEY_METRIC_REQUEST_AP_END="KEY_METRIC_REQUEST_AP_END",t.KEY_METRIC_REQUEST_SUA_END="KEY_METRIC_REQUEST_SUA_END",t.KEY_METRIC_BEFORE_CONNECT="KEY_METRIC_BEFORE_CONNECT",t.KEY_METRIC_PEER_RECEIVER="KEY_METRIC_PEER_RECEIVER",t.KEY_METRIC_SIGNAL_CONNECTED="KEY_METRIC_SIGNAL_CONNECTED",t.KEY_METRIC_JOIN_REQ="KEY_METRIC_JOIN_REQ",t.KEY_METRIC_JOIN_REP="KEY_METRIC_JOIN_REP",t.KEY_METRIC_JOIN_GATEWAY_START="KEY_METRIC_JOIN_GATEWAY_START",t.KEY_METRIC_JOIN_GATEWAY_END="KEY_METRIC_JOIN_GATEWAY_END",t.KEY_METRIC_PEER_CONNECTION_START="KEY_METRIC_PEER_CONNECTION_START",t.KEY_METRIC_PEER_CONNECTION_END="KEY_METRIC_PEER_CONNECTION_END",t.KEY_METRIC_FIRST_VIDEO_FRAME_DECODED="KEY_METRIC_FIRST_VIDEO_FRAME_DECODED",t.KEY_METRIC_DESCRIPTION_START="KEY_METRIC_DESCRIPTION_START",t.KEY_METRIC_ICE_CONNECTION_END="KEY_METRIC_ICE_CONNECTION_END",t.KEY_METRIC_SIGNAL_CHANNEL_OPEN="KEY_METRIC_SIGNAL_CHANNEL_OPEN",t.KEY_METRIC_PUBLISH="KEY_METRIC_PUBLISH",t.KEY_METRIC_SUBSCRIBE="KEY_METRIC_SUBSCRIBE",t.RECORD_JOIN_CHANNEL_SERVICE="RECORD_JOIN_CHANNEL_SERVICE",t.RESET_JOIN_CHANNEL_SERVICE_RECORDS="RESET_JOIN_CHANNEL_SERVICE_RECORDS",t.RESET_KEY_METRICS="RESET_KEY_METRICS",t.RESET_FIRST_VIDEO_FRAME_DECODED="RESET_FIRST_VIDEO_FRAME_DECODED",t.SET_USE_P2P="SET_USE_P2P",t.SET_TRANSPORT_TYPE="SET_TRANSPORT_TYPE",t}(en||{});let eT=function(t){return t.h264="h264",t.h265="h265",t.vp8="vp8",t.vp9="vp9",t.av1="av1",t}({});(function(t){t.opus="opus",t.pcma="pcma",t.pcmu="pcmu",t.g722="g722"})({});const DW=128,Ume=96,xW=1e3,Hv=10;let Vme=0;var LW=(()=>{var t={8:(a,c,d)=>{d.r(c),d.d(c,{Parser:()=>ze,Printer:()=>nr,parse:()=>st,print:()=>bt});const h=`
`,m="".concat("\r").concat(h),g=" ";let E;function b(He){return He>="0"&&He<="9"}function I(He){return He>="!"&&He<="~"}function A(He){return I(He)||He>=""&&He<=""}function k(He){return He==="!"||He>="#"&&He<="'"||He>="*"&&He<="+"||He>="-"&&He<="."||He>="0"&&He<="9"||He>="A"&&He<="Z"||He>="^"&&He<="~"}function W(He){return He>="1"&&He<="9"}function j(He){return He>="A"&&He<="Z"||He>="a"&&He<="z"}function B(He){return He==="d"||He==="h"||He==="m"||He==="s"}function ee(He){return He>""&&He<"	"||He>"\v"&&He<"\f"||He>""&&He<""}function Z(He){return j(He)||b(He)||He==="+"||He==="/"}function oe(He){return b(He)||j(He)||He==="+"||He==="/"||He==="-"||He==="_"}function ye(He){return j(He)||b(He)||He==="+"||He==="/"}function _e(He,V){var le=Object.keys(He);if(Object.getOwnPropertySymbols){var ge=Object.getOwnPropertySymbols(He);V&&(ge=ge.filter(function(tt){return Object.getOwnPropertyDescriptor(He,tt).enumerable})),le.push.apply(le,ge)}return le}function ue(He){for(var V=1;V<arguments.length;V++){var le=arguments[V]!=null?arguments[V]:{};V%2?_e(Object(le),!0).forEach(function(ge){Ce(He,ge,le[ge])}):Object.getOwnPropertyDescriptors?Object.defineProperties(He,Object.getOwnPropertyDescriptors(le)):_e(Object(le)).forEach(function(ge){Object.defineProperty(He,ge,Object.getOwnPropertyDescriptor(le,ge))})}return He}function Ce(He,V,le){return V in He?Object.defineProperty(He,V,{value:le,enumerable:!0,configurable:!0,writable:!0}):He[V]=le,He}(function(He){He.VERSION="v",He.ORIGIN="o",He.SESSION_NAME="s",He.INFORMATION="i",He.URI="u",He.EMAIL="e",He.PHONE="p",He.CONNECTION="c",He.BANDWIDTH="b",He.TIME="t",He.REPEAT="r",He.ZONE_ADJUSTMENTS="z",He.KEY="k",He.ATTRIBUTE="a",He.MEDIA="m"})(E||(E={}));class Ue{consumeText(V,le){let ge=le;for(;ge<V.length;){const tt=V[ge];if(tt==="\0"||tt==="\r"||tt===h)break;ge+=1}if(ge-le==0)throw new Error("Invalid text, at ".concat(V));return ge}consumeUnicastAddress(V,le,ge){return this.consumeTill(V,le,g)}consumeOneOrMore(V,le,ge){let tt=le;for(;ge(V[tt]);)tt++;if(tt-le==0)throw new Error("Invalid rule at ".concat(le,"."));return tt}consumeSpace(V,le){if(V[le]===g)return le+1;throw new Error("Invalid space at ".concat(le,"."))}consumeIP4Address(V,le){let ge=le;for(let tt=0;tt<4;tt++)if(ge=this.consumeDecimalUChar(V,ge),tt!==3){if(V[ge]!==".")throw new Error("Invalid IP4 address.");ge++}return ge}consumeDecimalUChar(V,le){let ge=le;for(let rn=0;rn<3&&b(V[ge]);rn++,ge++);if(ge-le==0)throw new Error("Invalid decimal uchar.");const tt=parseInt(V.slice(le,ge));if(tt>=0&&tt<=255)return ge;throw new Error("Invalid decimal uchar")}consumeIP6Address(V,le){let ge=this.consumeHexpart(V,le);return V[ge]===":"&&(ge+=1,ge=this.consumeIP4Address(V,ge)),ge}consumeHexpart(V,le){let ge=le;if(V[ge]===":"&&V[ge+1]===":"){ge+=2;try{ge=this.consumeHexseq(V,ge)}catch{}return ge}if(ge=this.consumeHexseq(V,ge),V[ge]===":"&&V[ge+1]===":"){ge+=2;try{ge=this.consumeHexseq(V,ge)}catch{}return ge}return ge}consumeHexseq(V,le){let ge=le;for(;ge=this.consumeHex4(V,ge),V[ge]===":"&&V[ge+1]!==":";)ge+=1;return ge}consumeHex4(V,le){let ge=0;for(;ge<4;ge++)if(!((tt=V[le+ge])>="0"&&tt<="9"||tt>="a"&&tt<="f"||tt>="A"&&tt<="F")){if(ge===0)throw new Error("Invalid hex 4");break}var tt;return le+ge}consumeFQDN(V,le){let ge=le;for(;b(V[ge])||j(V[ge])||V[ge]==="-"||V[ge]===".";)ge+=1;if(ge-le<4)throw new Error("Invalid FQDN");return ge}consumeExtnAddr(V,le){return this.consumeOneOrMore(V,le,A)}consumeMulticastAddress(V,le,ge){switch(ge){case"IP4":case"ip4":return this.consumeIP4MulticastAddress(V,le);case"IP6":case"ip6":return this.consumeIP6MulticastAddress(V,le);default:try{return this.consumeFQDN(V,le)}catch{return this.consumeExtnAddr(V,le)}}}consumeIP6MulticastAddress(V,le){const ge=this.consumeHexpart(V,le);return V[ge]==="/"?this.consumeInteger(V,ge+1):ge}consumeIP4MulticastAddress(V,le){let ge=le+3;const tt=V.slice(le,ge),rn=parseInt(tt);if(rn<224||rn>239)throw new Error("Invalid IP4 multicast address, IPv4 multicast addresses may be in the range 224.0.0.0 to 239.255.255.255.");for(let Rr=0;Rr<3;Rr++){if(V[ge]!==".")throw new Error("Invalid IP4 multicast address.");ge+=1,ge=this.consumeDecimalUChar(V,ge)}return V[ge]==="/"&&(ge+=1),ge=this.consumeTTL(V,ge),V[ge]==="/"&&(ge=this.consumeInteger(V,ge)),ge}consumeInteger(V,le){if(!W(V[le]))throw new Error("Invalid integer.");for(le+=1;b(V[le]);)le+=1;return le}consumeTTL(V,le){if(V[le]==="0")return le+1;if(!W(V[le]))throw new Error("Invalid TTL.");le+=1;for(let ge=0;ge<2&&b(V[le]);ge++)le+=1;return le}consumeToken(V,le){return this.consumeOneOrMore(V,le,k)}consumeTime(V,le){let ge=le;if(V[ge]==="0")return ge+1;for(W(V[ge])&&(ge+=1);b(V[ge]);)ge++;if(ge-le<10)throw new Error("Invalid time");return ge}consumeAddress(V,le){return this.consumeTill(V,le,g)}consumeTypedTime(V,le){let ge=le;return ge=this.consumeOneOrMore(V,ge,b),B(V[ge])?ge+1:ge}consumeRepeatInterval(V,le){if(!W(V[le]))throw new Error("Invalid repeat interval");for(le+=1;b(V[le]);)le+=1;return B(V[le])&&(le+=1),le}consumePort(V,le){return this.consumeOneOrMore(V,le,b)}consume(V,le,ge){for(let tt=0;tt<ge.length;tt++){if(le+tt>=V.length)throw new Error("consume exceeding value length");if(V[le+tt]!==ge[tt])throw new Error("consume ".concat(ge," failed at ").concat(tt))}return le+ge.length}consumeTill(V,le,ge){let tt=le;for(;tt<V.length&&(typeof ge!="string"||V[tt]!==ge)&&(typeof ge!="function"||!ge(V[tt]));)tt++;return tt}}class ze extends Ue{constructor(){super(),Ce(this,"records",[]),Ce(this,"currentLine",0)}parse(V){const le=this.probeEOL(V);this.records=V.split(le).filter(Ef=>!!Ao(Ef).call(Ef)).map(this.parseLine),this.currentLine=0;const ge=this.parseVersion(),tt=this.parseOrigin(),rn=this.parseSessionName(),Rr=this.parseInformation(),Gi=this.parseUri(),Xl=this.parseEmail(),Ku=this.parsePhone(),VT=this.parseConnection(),by=this.parseBandWidth(),w0=this.parseTimeFields(),D1=this.parseKey(),x1=this.parseSessionAttribute(),Jl=this.parseMediaDescription();if(this.currentLine!==this.records.length)throw new Error("parsing failed, non exhaustive sdp lines.");return{version:ge,origin:tt,sessionName:rn,information:Rr,uri:Gi,emails:Xl,phones:Ku,connection:VT,bandwidths:by,timeFields:w0,key:D1,attributes:x1,mediaDescriptions:Jl}}getCurrentRecord(){const V=this.records[this.currentLine];if(!V)throw new Error("Record doesn't exit.");return V}probeEOL(V){for(let le=0;le<V.length;le++)if(V[le]===h)return V[le-1]==="\r"?m:h;throw new Error("Invalid newline character.")}parseLine(V,le){if(V.length<2)throw new Error("Invalid sdp line, sdp line should be of form <type>=<value>.");const ge=V[0];if(V[1]!=="=")throw new Error('Invalid sdp line, <type> should be a single character followed by an "=" sign.');return{type:ge,value:V.slice(2),line:le,cur:0}}parseSessionAttribute(){const V=new hn;for(;this.currentLine<this.records.length;){const le=this.getCurrentRecord();if(le.type!==E.ATTRIBUTE)break;const ge={attField:this.extractOneOrMore(le,tt=>k(tt)&&tt!==":"),_cur:0};le.value[le.cur]===":"&&(le.cur+=1,ge.attValue=this.extractOneOrMore(le,ee)),V.parse(ge),this.currentLine++}return V.digest()}parseMediaAttributes(V){const le=new vn(V);for(;this.currentLine<this.records.length;){const ge=this.getCurrentRecord();if(ge.type!==E.ATTRIBUTE)break;const tt={attField:this.extractOneOrMore(ge,rn=>k(rn)&&rn!==":"),_cur:0};ge.value[ge.cur]===":"&&(ge.cur+=1,tt.attValue=this.extractOneOrMore(ge,ee)),le.parse(tt),this.currentLine++}return le.digest()}parseKey(){const V=this.getCurrentRecord();if(V.type===E.KEY){if(V.value==="prompt"||V.value==="clear:"||V.value==="base64:"||V.value==="uri:")return V.value;throw this.currentLine++,new Error("Invalid key.")}}parseZone(){const V=this.getCurrentRecord();if(V.type===E.ZONE_ADJUSTMENTS){const le=[];for(;;)try{const ge=this.extract(V,this.consumeTime);this.consumeSpaceForRecord(V);let tt=!1;V.value[V.cur]==="-"&&(tt=!0,V.cur+=1);const rn=this.extract(V,this.consumeTypedTime);le.push({time:ge,typedTime:rn,back:tt})}catch{break}if(le.length===0)throw new Error("Invalid zone adjustments");return this.currentLine++,le}return[]}parseRepeat(){const V=[];for(;;){const le=this.getCurrentRecord();if(le.type!==E.REPEAT)break;{const ge=this.extract(le,this.consumeRepeatInterval),tt=this.parseTypedTime(le);V.push({repeatInterval:ge,typedTimes:tt}),this.currentLine++}}return V}parseTypedTime(V){const le=[];for(;;)try{this.consumeSpaceForRecord(V),le.push(this.extract(V,this.consumeTypedTime))}catch{break}if(le.length===0)throw new Error("Invalid typed time.");return le}parseTime(){const V=this.getCurrentRecord(),le=this.extract(V,this.consumeTime);this.consumeSpaceForRecord(V);const ge=this.extract(V,this.consumeTime);return this.currentLine++,{startTime:le,stopTime:ge}}parseBandWidth(){const V=[];for(;this.currentLine<this.records.length;){const le=this.getCurrentRecord();if(le.type!==E.BANDWIDTH)break;{const ge=this.extractOneOrMore(le,k);if(le.value[le.cur]!==":")throw new Error("Invalid bandwidth field.");le.cur++;const tt=this.extractOneOrMore(le,b);V.push({bwtype:ge,bandwidth:tt}),this.currentLine++}}return V}parseVersion(){const V=this.getCurrentRecord();if(V.type!==E.VERSION)throw new Error("first sdp record must be version");const le=V.value.slice(0,this.consumeOneOrMore(V.value,0,b));if(le.length!==V.value.length)throw new Error('invalid proto version, "v='.concat(V.value,'"'));return this.currentLine++,le}parseOrigin(){const V=this.getCurrentRecord();if(V.type!==E.ORIGIN)throw new Error("second line of sdp must be origin");const le=this.extractOneOrMore(V,A);this.consumeSpaceForRecord(V);const ge=this.extractOneOrMore(V,b);this.consumeSpaceForRecord(V);const tt=this.extractOneOrMore(V,b);this.consumeSpaceForRecord(V);const rn=this.extractOneOrMore(V,k);this.consumeSpaceForRecord(V);const Rr=this.extractOneOrMore(V,k);this.consumeSpaceForRecord(V);const Gi=this.extract(V,this.consumeUnicastAddress);return this.currentLine++,{username:le,sessId:ge,sessVersion:tt,nettype:rn,addrtype:Rr,unicastAddress:Gi}}parseSessionName(){const V=this.getCurrentRecord();if(V.type===E.SESSION_NAME){const le=this.extract(V,this.consumeText);return this.currentLine++,le}}parseInformation(){const V=this.getCurrentRecord();if(V.type!==E.INFORMATION)return;const le=this.extract(V,this.consumeText);return this.currentLine++,le}parseUri(){const V=this.getCurrentRecord();if(V.type===E.URI)return this.currentLine++,V.value}parseEmail(){const V=[];for(;;){const le=this.getCurrentRecord();if(le.type!==E.EMAIL)break;V.push(le.value),this.currentLine++}return V}parsePhone(){const V=[];for(;;){const le=this.getCurrentRecord();if(le.type!==E.PHONE)break;V.push(le.value),this.currentLine++}return V}parseConnection(){const V=this.getCurrentRecord();if(V.type===E.CONNECTION){const le=this.extractOneOrMore(V,k);this.consumeSpaceForRecord(V);const ge=this.extractOneOrMore(V,k);this.consumeSpaceForRecord(V);const tt=this.extract(V,this.consumeAddress);return this.currentLine++,{nettype:le,addrtype:ge,address:tt}}}parseMedia(){const V=this.getCurrentRecord(),le=this.extract(V,this.consumeToken);this.consumeSpaceForRecord(V);let ge=this.extract(V,this.consumePort);V.value[V.cur]==="/"&&(V.cur+=1,ge+=this.extract(V,this.consumeInteger)),this.consumeSpaceForRecord(V);const tt=[];for(tt.push(this.extract(V,this.consumeToken));V.value[V.cur]==="/";)V.cur+=1,tt.push(this.extract(V,this.consumeToken));if(tt.length===0)throw new Error("Invalid proto");const rn=this.parseFmt(V);return this.currentLine++,{mediaType:le,port:ge,protos:tt,fmts:rn}}parseTimeFields(){const V=[];for(;this.getCurrentRecord().type===E.TIME;){const le=this.parseTime(),ge=this.parseRepeat(),tt=this.parseZone();V.push({time:le,repeats:ge,zones:tt})}return V}parseMediaDescription(){const V=[];for(;this.currentLine<this.records.length&&this.getCurrentRecord().type===E.MEDIA;){const le=this.parseMedia(),ge=this.parseInformation(),tt=this.parseConnections(),rn=this.parseBandWidth(),Rr=this.parseKey(),Gi=this.parseMediaAttributes(le);V.push({media:le,information:ge,connections:tt,bandwidths:rn,key:Rr,attributes:Gi})}return V}parseConnections(){const V=[];for(;this.currentLine<this.records.length&&this.getCurrentRecord().type===E.CONNECTION;)V.push(this.parseConnection());return V}parseFmt(V){const le=[];for(;;)try{this.consumeSpaceForRecord(V),le.push(this.extract(V,this.consumeToken))}catch{break}if(le.length===0)throw new Error("Invalid fmts");return le}extract(V,le){for(var ge=arguments.length,tt=new Array(ge>2?ge-2:0),rn=2;rn<ge;rn++)tt[rn-2]=arguments[rn];const Rr=le.call(this,V.value,V.cur,...tt),Gi=V.value.slice(V.cur,Rr);return V.cur=Rr,Gi}extractOneOrMore(V,le){const ge=this.consumeOneOrMore(V.value,V.cur,le),tt=V.value.slice(V.cur,ge);return V.cur=ge,tt}consumeSpaceForRecord(V){if(V.value[V.cur]!==g)throw new Error("Invalid space at ".concat(V.cur,"."));V.cur+=1}}class Je extends Ue{constructor(){super(...arguments),Ce(this,"attributes",void 0),Ce(this,"digested",!1)}extractOneOrMore(V,le,ge){const tt=this.consumeOneOrMore(V.attValue,V._cur,le),rn=V.attValue.slice(V._cur,tt),[Rr,Gi]=ge||[];if(typeof Rr=="number"&&rn.length<Rr)throw new Error("error in length, should be more or equal than ".concat(Rr," characters."));if(typeof Gi=="number"&&rn.length>Gi)throw new Error("error in length, should be less or equal than ".concat(Gi," characters."));return V._cur=tt,rn}consumeAttributeSpace(V){if(V.attValue[V._cur]!==g)throw new Error("Invalid space at ".concat(V._cur,"."));V._cur+=1}extract(V,le){if(!V.attValue)throw new Error("Nothing to extract from attValue.");for(var ge=arguments.length,tt=new Array(ge>2?ge-2:0),rn=2;rn<ge;rn++)tt[rn-2]=arguments[rn];const Rr=le.call(this,V.attValue,V._cur,...tt),Gi=V.attValue.slice(V._cur,Rr);return V._cur=Rr,Gi}atEnd(V){if(!V.attValue)throw new Error;return V._cur>=V.attValue.length}peekChar(V){if(!V.attValue)throw new Error;return V.attValue[V._cur]}peek(V,le){if(!V.attValue)throw new Error;for(let ge=0;ge<le.length;ge++)if(le[ge]!==V.attValue[V._cur+ge])return!1;return!0}parseIceUfrag(V){if(this.attributes.iceUfrag)throw new Error("Invalid ice-ufrag, should be only a single line if 'a=ice-ufrag'");this.attributes.iceUfrag=this.extractOneOrMore(V,Z,[4,256])}parseIcePwd(V){if(this.attributes.icePwd)throw new Error("Invalid ice-pwd, should be only a single line if 'a=ice-pwd'");this.attributes.icePwd=this.extractOneOrMore(V,Z,[22,256])}parseIceOptions(V){if(this.attributes.iceOptions)throw new Error("Invalid ice-options, should be only one 'ice-options' line");const le=[];for(;!this.atEnd(V);){le.push(this.extractOneOrMore(V,Z));try{this.consumeAttributeSpace(V)}catch(ge){if(this.atEnd(V))break;throw ge}}this.attributes.iceOptions=le}parseFingerprint(V){const le=this.extract(V,this.consumeToken);this.consumeAttributeSpace(V);const ge=this.extract(V,this.consumeTill);this.attributes.fingerprints.push({hashFunction:le,fingerprint:ge})}parseExtmap(V){const le=this.extractOneOrMore(V,b);let ge;this.peekChar(V)==="/"&&(this.extract(V,this.consume,"/"),ge=this.extract(V,this.consumeToken)),this.consumeAttributeSpace(V);const tt=this.extract(V,this.consumeTill,g),rn=ue(ue({entry:parseInt(le,10)},ge&&{direction:ge}),{},{extensionName:tt});this.peekChar(V)===g&&(this.consumeAttributeSpace(V),rn.extensionAttributes=this.extract(V,this.consumeTill)),this.attributes.extmaps.push(rn)}parseSetup(V){if(this.attributes.setup)throw new Error("must only be one single 'a=setup' line.");const le=this.extract(V,this.consumeTill);if(le!=="active"&&le!=="passive"&&le!=="actpass"&&le!=="holdconn")throw new Error("role must be one of 'active', 'passive', 'actpass', 'holdconn'.");this.attributes.setup=le}}class hn extends Je{constructor(){super(...arguments),Ce(this,"attributes",{unrecognized:[],groups:[],extmaps:[],fingerprints:[],identities:[]})}parse(V){if(this.digested)throw new Error("already digested");try{switch(V.attField){case"group":this.parseGroup(V);break;case"ice-lite":this.parseIceLite();break;case"ice-ufrag":this.parseIceUfrag(V);break;case"ice-pwd":this.parseIcePwd(V);break;case"ice-options":this.parseIceOptions(V);break;case"fingerprint":this.parseFingerprint(V);break;case"setup":this.parseSetup(V);break;case"tls-id":this.parseTlsId(V);break;case"identity":this.parseIdentity(V);break;case"extmap":this.parseExtmap(V);break;case"msid-semantic":this.parseMsidSemantic(V);break;default:V.ignored=!0,this.attributes.unrecognized.push(V)}}catch(le){throw console.error("parsing session attribute ".concat(V.attField,' error, "a=').concat(V.attField,":").concat(V.attValue,'"')),le}if(!V.ignored&&V.attValue&&!this.atEnd(V))throw new Error("attribute parsing error")}digest(){return this.digested=!0,this.attributes}parseGroup(V){const le=this.extract(V,this.consumeToken),ge=[];for(;!this.atEnd(V)&&this.peekChar(V)===g;)this.consumeAttributeSpace(V),ge.push(this.extract(V,this.consumeToken));this.attributes.groups.push({semantic:le,identificationTag:ge})}parseIceLite(){if(this.attributes.iceLite)throw new Error("Invalid ice-lite, should be only a single line of 'a=ice-lite'");this.attributes.iceLite=!0}parseTlsId(V){if(this.attributes.tlsId)throw new Error("must be only one tld-id line");this.attributes.tlsId=this.extractOneOrMore(V,oe)}parseIdentity(V){const le=this.extractOneOrMore(V,ye),ge=[];for(;!this.atEnd(V)&&this.peekChar(V)===g;){this.consumeAttributeSpace(V);const tt=this.extract(V,this.consumeToken);this.extract(V,this.consume,"=");const rn=this.extractOneOrMore(V,Rr=>Rr!==g&&ee(Rr));ge.push({name:tt,value:rn})}this.attributes.identities.push({assertionValue:le,extensions:ge})}parseMsidSemantic(V){this.peekChar(V)===g&&this.consumeAttributeSpace(V);const le={semantic:this.extract(V,this.consumeToken),identifierList:[]};for(;;){try{this.consumeAttributeSpace(V)}catch{break}if(this.peekChar(V)==="*"){this.extract(V,this.consume,"*"),le.applyForAll=!0;break}{const ge=this.extract(V,this.consumeTill,g);le.identifierList.push(ge)}}this.attributes.msidSemantic=le}}class vn extends Je{constructor(V){super(),Ce(this,"attributes",void 0),V.protos.indexOf("RTP")!==-1||V.protos.indexOf("rtp"),this.attributes={unrecognized:[],candidates:[],extmaps:[],fingerprints:[],imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:[],ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:[]}}parse(V){if(this.digested)throw new Error("already digested");try{switch(V.attField){case"extmap":this.parseExtmap(V);break;case"setup":this.parseSetup(V);break;case"ice-ufrag":this.parseIceUfrag(V);break;case"ice-pwd":this.parseIcePwd(V);break;case"ice-options":this.parseIceOptions(V);break;case"candidate":this.parseCandidate(V);break;case"remote-candidate":this.parseRemoteCandidate(V);break;case"end-of-candidates":this.parseEndOfCandidates();break;case"fingerprint":this.parseFingerprint(V);break;case"rtpmap":this.parseRtpmap(V);break;case"ptime":this.parsePtime(V);break;case"maxptime":this.parseMaxPtime(V);break;case"sendrecv":case"recvonly":case"sendonly":case"inactive":this.parseDirection(V);break;case"ssrc":this.parseSSRC(V);break;case"fmtp":this.parseFmtp(V);break;case"rtcp-fb":this.parseRtcpFb(V);break;case"rtcp-mux":this.parseRTCPMux();break;case"rtcp-mux-only":this.parseRTCPMuxOnly();break;case"rtcp-rsize":this.parseRTCPRsize();break;case"rtcp":this.parseRTCP(V);break;case"mid":this.parseMid(V);break;case"msid":this.parseMsid(V);break;case"imageattr":this.parseImageAttr(V);break;case"rid":this.parseRid(V);break;case"simulcast":this.parseSimulcast(V);break;case"sctp-port":this.parseSctpPort(V);break;case"max-message-size":this.parseMaxMessageSize(V);break;case"ssrc-group":this.parseSSRCGroup(V);break;default:V.ignored=!0,this.attributes.unrecognized.push(V)}}catch(le){throw console.error("parsing media attribute ".concat(V.attField,' error, "a=').concat(V.attField,":").concat(V.attValue,'"')),le}if(!V.ignored&&V.attValue&&!this.atEnd(V))throw new Error("attribute parsing error")}parseCandidate(V){const le=this.extractOneOrMore(V,Z,[1,32]);this.consumeAttributeSpace(V);const ge=this.extractOneOrMore(V,b,[1,5]);this.consumeAttributeSpace(V);const tt=this.extract(V,this.consumeToken);this.consumeAttributeSpace(V);const rn=this.extractOneOrMore(V,b,[1,10]);this.consumeAttributeSpace(V);const Rr=this.extract(V,this.consumeAddress);this.consumeAttributeSpace(V);const Gi=this.extract(V,this.consumePort);this.consumeAttributeSpace(V),this.extract(V,this.consume,"typ"),this.consumeAttributeSpace(V);const Xl={foundation:le,componentId:ge,transport:tt,priority:rn,connectionAddress:Rr,port:Gi,type:this.extract(V,this.consumeToken),extension:{}};for(this.peek(V," raddr")&&(this.extract(V,this.consume," raddr"),this.consumeAttributeSpace(V),Xl.relAddr=this.extract(V,this.consumeAddress)),this.peek(V," rport")&&(this.extract(V,this.consume," rport"),this.consumeAttributeSpace(V),Xl.relPort=this.extract(V,this.consumePort));this.peekChar(V)===g;){this.consumeAttributeSpace(V);const Ku=this.extract(V,this.consumeToken);this.consumeAttributeSpace(V),Xl.extension[Ku]=this.extractOneOrMore(V,I)}this.attributes.candidates.push(Xl)}parseRemoteCandidate(V){const le=[];for(;;){const ge=this.extractOneOrMore(V,b,[1,5]);this.consumeAttributeSpace(V);const tt=this.extract(V,this.consumeAddress);this.consumeAttributeSpace(V);const rn=this.extract(V,this.consumePort);le.push({componentId:ge,connectionAddress:tt,port:rn});try{this.consumeAttributeSpace(V)}catch{break}}this.attributes.remoteCandidatesList.push(le)}parseEndOfCandidates(){if(this.attributes.endOfCandidates)throw new Error("must be only one line of end-of-candidates");this.attributes.endOfCandidates=!0}parseRtpmap(V){const le=this.extract(V,this.consumeToken);this.consumeAttributeSpace(V);const ge=this.extract(V,this.consumeTill,"/");this.extract(V,this.consume,"/");const tt={encodingName:ge,clockRate:this.extractOneOrMore(V,b)};this.atEnd(V)||this.peekChar(V)!=="/"||(this.extract(V,this.consume,"/"),tt.encodingParameters=parseInt(this.extract(V,this.consumeTill),10));const rn=this.attributes.payloads.find(Rr=>Rr.payloadType===parseInt(le,10));rn?rn.rtpMap=tt:this.attributes.payloads.push({payloadType:parseInt(le,10),rtpMap:tt,rtcpFeedbacks:[]})}parsePtime(V){if(this.attributes.ptime)throw new Error("must be only one line of ptime");this.attributes.ptime=this.extract(V,this.consumeTill)}parseMaxPtime(V){if(this.attributes.maxPtime)throw new Error("must be only one line of ptime");this.attributes.maxPtime=this.extract(V,this.consumeTill)}parseDirection(V){if(this.attributes.direction)throw new Error("must be only one line of direction info");this.attributes.direction=V.attField}parseSSRC(V){const le=this.extractOneOrMore(V,b);this.consumeAttributeSpace(V);const ge=this.extract(V,this.consumeTill,":");let tt;this.peekChar(V)===":"&&(this.extract(V,this.consume,":"),tt=this.extract(V,this.consumeTill));const rn=this.attributes.ssrcs.find(Rr=>Rr.ssrcId===parseInt(le,10));rn?rn.attributes[ge]=tt:this.attributes.ssrcs.push({ssrcId:parseInt(le,10),attributes:{[ge]:tt}})}parseFmtp(V){const le=this.extract(V,this.consumeTill,g);this.consumeAttributeSpace(V);const ge=this.extract(V,this.consumeTill),tt={};ge.split(";").forEach(Rr=>{let[Gi,Xl]=Rr.split("=");Gi=Ao(Gi).call(Gi);const Ku=typeof Xl=="string"?Ao(Xl).call(Xl):null;typeof Gi=="string"&&Gi.length>0&&(tt[Gi]=Ku)});const rn=this.attributes.payloads.find(Rr=>Rr.payloadType===parseInt(le,10));rn?rn.fmtp={parameters:tt}:this.attributes.payloads.push({payloadType:parseInt(le,10),rtcpFeedbacks:[],fmtp:{parameters:tt}})}parseFmtParameters(V){const le={},ge=this.extract(V,this.consumeTill,"=");V._cur++;const tt=this.extract(V,this.consumeTill,";");for(le[ge]=tt;V.attValue[V._cur]===";";){const rn=this.extract(V,this.consumeTill,"=");V._cur++;const Rr=this.extract(V,this.consumeTill,";");le[rn]=Rr}return le}parseRtcpFb(V){let le="";le=this.peekChar(V)==="*"?this.extract(V,this.consume,"*"):this.extract(V,this.consumeTill,g),this.consumeAttributeSpace(V);const ge=this.extract(V,this.consumeTill,g);let tt;if(ge==="trr-int")tt={type:ge,interval:this.extract(V,this.consumeTill)};else{const rn={type:ge};this.peekChar(V)===g&&(this.consumeAttributeSpace(V),rn.parameter=this.extract(V,this.consumeToken),this.peekChar(V)===g&&(rn.additional=this.extract(V,this.consumeTill))),tt=rn}if(le==="*")this.attributes.rtcpFeedbackWildcards.push(tt);else{const rn=this.attributes.payloads.find(Rr=>Rr.payloadType===parseInt(le,10));rn?rn.rtcpFeedbacks.push(tt):this.attributes.payloads.push({payloadType:parseInt(le,10),rtcpFeedbacks:[tt]})}}parseRTCPMux(){if(this.attributes.rtcpMux)throw new Error("must be single line of rtcp-mux");this.attributes.rtcpMux=!0}parseRTCPMuxOnly(){if(this.attributes.rtcpMuxOnly)throw new Error("must be single line of rtcp-only");this.attributes.rtcpMuxOnly=!0}parseRTCPRsize(){if(this.attributes.rtcpRsize)throw new Error("must be single line of rtcp-rsize");this.attributes.rtcpRsize=!0}parseRTCP(V){if(this.attributes.rtcp)throw new Error("must be single line of rtcp");const le={port:this.extract(V,this.consumePort)};this.peekChar(V)===g&&(this.consumeAttributeSpace(V),le.netType=this.extractOneOrMore(V,k),this.consumeAttributeSpace(V),le.addressType=this.extractOneOrMore(V,k),this.consumeAttributeSpace(V),le.address=this.extract(V,this.consumeAddress)),this.attributes.rtcp=le}parseMsid(V){const le={id:this.extractOneOrMore(V,k,[1,64])};this.peekChar(V)===g&&(this.consumeAttributeSpace(V),le.appdata=this.extractOneOrMore(V,k,[1,64])),this.attributes.msids.push(le)}parseImageAttr(V){this.attributes.imageattr.push(V.attValue)}parseRid(V){const le=this.extractOneOrMore(V,tt=>j(tt)||b(tt)||tt==="_"||tt==="-");this.consumeAttributeSpace(V);const ge={id:le,direction:this.extract(V,this.consumeToken),params:[]};if(this.peekChar(V)===g){if(this.consumeAttributeSpace(V),this.peek(V,"pt=")){this.extract(V,this.consume,"pt=");const tt=[];for(;;){const rn=this.extract(V,this.consumeToken);tt.push(rn);try{this.extract(V,this.consume,",")}catch{break}}ge.payloads=tt,this.peekChar(V)===g&&this.extract(V,this.consume,g)}for(;;){const tt=this.extract(V,this.consumeToken);switch(tt){case"depend":{const rn={type:tt,rids:this.extract(V,this.consume,"=").split(",")};ge.params.push(rn);break}default:{const rn={type:tt};this.peekChar(V)==="="&&(this.extract(V,this.consume,"="),rn.val=this.extract(V,this.consumeTill,";")),ge.params.push(rn)}}try{this.extract(V,this.consume,";")}catch{break}}}this.attributes.rids.push(ge)}parseSimulcast(V){if(this.attributes.simulcast)throw new Error("must be single line of simulcast");this.attributes.simulcast=V.attValue,this.extract(V,this.consumeTill)}parseSctpPort(V){this.attributes.sctpPort=this.extractOneOrMore(V,b,[1,5])}parseMaxMessageSize(V){this.attributes.maxMessageSize=this.extractOneOrMore(V,b,[1,void 0])}digest(){return this.digested=!0,this.attributes}parseMid(V){this.attributes.mid=this.extract(V,this.consumeToken)}parseSSRCGroup(V){const le=this.extract(V,this.consumeToken),ge=[];for(;;)try{this.consumeAttributeSpace(V);const tt=this.extract(V,this.consumeInteger);ge.push(parseInt(tt,10))}catch{break}this.attributes.ssrcGroups.push({semantic:le,ssrcIds:ge})}}function Xt(He,V,le){return V in He?Object.defineProperty(He,V,{value:le,enumerable:!0,configurable:!0,writable:!0}):He[V]=le,He}class nr{constructor(){Xt(this,"eol",m)}print(V,le){let ge="";return le&&(this.eol=le),ge+=this.printVersion(V.version),ge+=this.printOrigin(V.origin),ge+=this.printSessionName(V.sessionName),ge+=this.printInformation(V.information),ge+=this.printUri(V.uri),ge+=this.printEmail(V.emails),ge+=this.printPhone(V.phones),ge+=this.printConnection(V.connection),ge+=this.printBandwidth(V.bandwidths),ge+=this.printTimeFields(V.timeFields),ge+=this.printKey(V.key),ge+=this.printSessionAttributes(V.attributes),ge+=this.printMediaDescription(V.mediaDescriptions),ge}printVersion(V){return"v=".concat(V).concat(this.eol)}printOrigin(V){return"o=".concat(V.username," ").concat(V.sessId," ").concat(V.sessVersion," ").concat(V.nettype," ").concat(V.addrtype," ").concat(V.unicastAddress).concat(this.eol)}printSessionName(V){return V?"s=".concat(V).concat(this.eol):""}printInformation(V){return V?"i=".concat(V).concat(this.eol):""}printUri(V){return V?"u=".concat(V).concat(this.eol):""}printEmail(V){let le="";for(const ge of V)le+="e=".concat(ge).concat(this.eol);return le}printPhone(V){let le="";for(const ge of V)le+="e=".concat(ge).concat(this.eol);return le}printConnection(V){return V?"c=".concat(V.nettype," ").concat(V.addrtype," ").concat(V.address).concat(this.eol):""}printBandwidth(V){let le="";for(const ge of V)le+="b=".concat(ge.bwtype,":").concat(ge.bandwidth).concat(this.eol);return le}printTimeFields(V){let le="";for(const ge of V){le+="t=".concat(ge.time.startTime," ").concat(ge.time.startTime).concat(this.eol);for(const tt of ge.repeats)le+="r=".concat(tt.repeatInterval," ").concat(tt.typedTimes.join(" ")).concat(this.eol);ge.zoneAdjustments&&(le+="z=",le+="z=".concat(ge.zoneAdjustments.map(tt=>"".concat(tt.time," ").concat(tt.back?"-":""," ").concat(tt.typedTime)).join(" ")).concat(this.eol),le+=this.eol)}return le}printKey(V){return V?"k=".concat(V).concat(this.eol):""}printAttributes(V){let le="";for(const ge of V)le+="a=".concat(ge.attField).concat(ge.attValue?":".concat(ge.attValue):"").concat(this.eol);return le}printMediaDescription(V){let le="";for(const ge of V)le+=this.printMedia(ge.media),le+=this.printInformation(ge.information),le+=this.printConnections(ge.connections),le+=this.printBandwidth(ge.bandwidths),le+=this.printKey(ge.key),le+=this.printMediaAttributes(ge);return le}printConnections(V){let le="";for(const ge of V)le+=this.printConnection(ge);return le}printMedia(V){return"m=".concat(V.mediaType," ").concat(V.port," ").concat(V.protos.join("/")," ").concat(V.fmts.join(" ")).concat(this.eol)}printSessionAttributes(V){return new eo(this.eol).print(V)}printMediaAttributes(V){return new Be(this.eol).print(V)}}class Kn{constructor(V){Xt(this,"eol",void 0),this.eol=V}printIceUfrag(V){return V===void 0?"":"a=ice-ufrag:".concat(V).concat(this.eol)}printIcePwd(V){return V===void 0?"":"a=ice-pwd:".concat(V).concat(this.eol)}printIceOptions(V){return V===void 0?"":"a=ice-options:".concat(V.join(g)).concat(this.eol)}printFingerprints(V){return V.length>0?V.map(le=>"a=fingerprint:".concat(le.hashFunction).concat(g).concat(le.fingerprint)).join(this.eol)+this.eol:""}printExtmap(V){return V.map(le=>"a=extmap:".concat(le.entry).concat(le.direction?"/".concat(le.direction):"").concat(g).concat(le.extensionName).concat(le.extensionAttributes?"".concat(g).concat(le.extensionAttributes):"").concat(this.eol)).join("")}printSetup(V){return V===void 0?"":"a=setup:".concat(V).concat(this.eol)}printUnrecognized(V){return V.map(le=>"a=".concat(le.attField).concat(le.attValue?":".concat(le.attValue):"").concat(this.eol)).join("")}}class eo extends Kn{print(V){let le="";return le+=this.printGroups(V.groups),le+=this.printMsidSemantic(V.msidSemantic),le+=this.printIceLite(V.iceLite),le+=this.printIceUfrag(V.iceUfrag),le+=this.printIcePwd(V.icePwd),le+=this.printIceOptions(V.iceOptions),le+=this.printFingerprints(V.fingerprints),le+=this.printSetup(V.setup),le+=this.printTlsId(V.tlsId),le+=this.printIdentity(V.identities),le+=this.printExtmap(V.extmaps),le+=this.printUnrecognized(V.unrecognized),le}printGroups(V){let le="";return V.length>0&&(le+=V.map(ge=>"a=group:".concat(ge.semantic).concat(ge.identificationTag.map(tt=>"".concat(g).concat(tt)).join("")).concat(this.eol)).join("")),le}printIceLite(V){return V===void 0?"":"a=ice-lite"+this.eol}printTlsId(V){return V?"a=tls-id:".concat(V).concat(this.eol):""}printIdentity(V){return V.length===0?"":V.map(le=>"a=identity:".concat(le.assertionValue).concat(le.extensions.map(ge=>"".concat(g).concat(ge.name).concat(ge.value?"=".concat(ge.value):"")))).join(this.eol)+this.eol}printMsidSemantic(V){if(!V)return"";let le="a=msid-semantic:".concat(V.semantic);return V.applyForAll?le+="".concat(g,"*"):V.identifierList.length>0&&(le+=V.identifierList.map(ge=>"".concat(g).concat(ge))),le+this.eol}}class Be extends Kn{print(V){const le=V.attributes;let ge="";return ge+=this.printRTCP(le.rtcp),ge+=this.printIceUfrag(le.iceUfrag),ge+=this.printIcePwd(le.icePwd),ge+=this.printIceOptions(le.iceOptions),ge+=this.printCandidates(le.candidates),ge+=this.printRemoteCandidatesList(le.remoteCandidatesList),ge+=this.printEndOfCandidates(le.endOfCandidates),ge+=this.printFingerprints(le.fingerprints),ge+=this.printSetup(le.setup),ge+=this.printMid(le.mid),ge+=this.printExtmap(le.extmaps),ge+=this.printRTPRelated(le),ge+=this.printPtime(le.ptime),ge+=this.printMaxPtime(le.maxPtime),ge+=this.printDirection(le.direction),ge+=this.printSSRCGroups(le.ssrcGroups),ge+=this.printSSRC(le.ssrcs),ge+=this.printRTCPMux(le.rtcpMux),ge+=this.printRTCPMuxOnly(le.rtcpMuxOnly),ge+=this.printRTCPRsize(le.rtcpRsize),ge+=this.printMSId(le.msids),ge+=this.printImageattr(le.imageattr),ge+=this.printRid(le.rids),ge+=this.printSimulcast(le.simulcast),ge+=this.printSCTPPort(le.sctpPort),ge+=this.printMaxMessageSize(le.maxMessageSize),ge+=this.printUnrecognized(le.unrecognized),ge}printCandidates(V){return V.map(le=>"a=candidate:".concat(le.foundation).concat(g).concat(le.componentId).concat(g).concat(le.transport).concat(g).concat(le.priority).concat(g).concat(le.connectionAddress).concat(g).concat(le.port).concat(g,"typ").concat(g).concat(le.type).concat(le.relAddr?"".concat(g,"raddr").concat(g).concat(le.relAddr):"").concat(le.relPort?"".concat(g,"rport").concat(g).concat(le.relPort):"").concat(Object.keys(le.extension).map(ge=>"".concat(g).concat(ge).concat(g).concat(le.extension[ge])).join("")).concat(this.eol)).join("")}printRemoteCandidatesList(V){return V.map(le=>"a=remote-candidates:".concat(le.join(g)).concat(this.eol)).join("")}printEndOfCandidates(V){return V===void 0?"":"a=end-of-candidates"+this.eol}printRTPRelated(V){if(!V.payloads)return"";const le=V.payloads;let ge="";ge+=V.rtcpFeedbackWildcards.map(tt=>this.printRTCPFeedback("*",tt)).join("");for(const tt of le)ge+=this.printRtpMap(tt.payloadType,tt.rtpMap),ge+=this.printFmtp(tt.payloadType,tt.fmtp),ge+=tt.rtcpFeedbacks.map(rn=>this.printRTCPFeedback(tt.payloadType,rn)).join("");return ge}printFmtp(V,le){if(!le)return"";const ge=Object.keys(le.parameters);return ge.length===1&&le.parameters[ge[0]]===null?"a=fmtp:".concat(V).concat(g).concat(ge[0]).concat(this.eol):"a=fmtp:".concat(V).concat(g).concat(Object.keys(le.parameters).map(tt=>"".concat(tt,"=").concat(le.parameters[tt])).join(";")).concat(this.eol)}printRtpMap(V,le){return le?"a=rtpmap:".concat(V).concat(g).concat(le.encodingName,"/").concat(le.clockRate).concat(le.encodingParameters?"/".concat(le.encodingParameters):"").concat(this.eol):""}printRTCPFeedback(V,le){let ge="a=rtcp-fb:".concat(V).concat(g),tt=le;return tt.type==="trr-int"?ge+="ttr-int".concat(g).concat(tt.interval):(ge+="".concat(tt.type),tt.parameter&&(ge+="".concat(g).concat(tt.parameter),tt.additional&&(ge+="".concat(g).concat(tt.additional)))),ge+this.eol}printPtime(V){return V===void 0?"":"a=ptime:".concat(V).concat(this.eol)}printMaxPtime(V){return V===void 0?"":"a=maxptime:".concat(V).concat(this.eol)}printDirection(V){return V===void 0?"":"a=".concat(V).concat(this.eol)}printSSRC(V){return V.map(le=>Object.keys(le.attributes).map(ge=>"a=ssrc:".concat(le.ssrcId.toString(10)).concat(g).concat(ge).concat(le.attributes[ge]?":".concat(le.attributes[ge]):"").concat(this.eol)).join("")).join("")}printRTCPMux(V){return V===void 0?"":"a=rtcp-mux".concat(this.eol)}printRTCPMuxOnly(V){return V===void 0?"":"a=rtcp-mux-only".concat(this.eol)}printRTCPRsize(V){return V===void 0?"":"a=rtcp-rsize".concat(this.eol)}printRTCP(V){if(V===void 0)return"";let le="a=rtcp:".concat(V.port);return V.netType&&(le+="".concat(g).concat(V.netType)),V.addressType&&(le+="".concat(g).concat(V.addressType)),V.address&&(le+="".concat(g).concat(V.address)),le+this.eol}printMSId(V){return V.map(le=>"a=msid:".concat(le.id).concat(le.appdata?"".concat(g).concat(le.appdata):"").concat(this.eol)).join("")}printImageattr(V){return V.map(le=>"a=imageattr:".concat(le).concat(this.eol)).join("")}printRid(V){return V.map(le=>{let ge="a=rid:".concat(le.id).concat(g).concat(le.direction);return le.payloads&&(ge+="".concat(g,"pt=").concat(le.payloads.join(","))),le.params.length>0&&(ge+="".concat(g).concat(le.params.map(tt=>tt.type==="depend"?"depend=".concat(tt.rids.join(",")):"".concat(tt.type,"=").concat(tt.val)).join(";"))),ge+this.eol}).join("")}printSimulcast(V){return V===void 0?"":"a=simulcast:".concat(V).concat(this.eol)}printSCTPPort(V){return V===void 0?"":"a=sctp-port:".concat(V).concat(this.eol)}printMaxMessageSize(V){return V===void 0?"":"a=max-message-size:".concat(V).concat(this.eol)}printMid(V){return V===void 0?"":"a=mid:".concat(V).concat(this.eol)}printSSRCGroups(V){return V.map(le=>"a=ssrc-group:".concat(le.semantic).concat(le.ssrcIds.map(ge=>"".concat(g).concat(ge.toString(10))).join("")).concat(this.eol)).join("")}}function st(He){return new ze().parse(He)}function bt(He,V){return new nr().print(He,V)}}},r={};function s(a){if(r[a])return r[a].exports;var c=r[a]={exports:{}};return t[a](c,c.exports,s),c.exports}return s.d=(a,c)=>{for(var d in c)s.o(c,d)&&!s.o(a,d)&&Object.defineProperty(a,d,{enumerable:!0,get:c[d]})},s.o=(a,c)=>Object.prototype.hasOwnProperty.call(a,c),s.r=a=>{typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(a,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(a,"__esModule",{value:!0})},s(8)})();function Ya(t){return LW.parse(t)}function Hm(t,r){return LW.print(t,r)}var Fme=mc("Array","keys"),jme=Ed,Bme=ti,zme=N,Wme=Fme,e2=Array.prototype,Gme={DOMTokenList:!0,NodeList:!0},Hme=function(t){var r=t.keys;return t===e2||zme(e2,t)&&r===e2.keys||Bme(Gme,jme(t))?Wme:r},Xa=l(Hme);function ii(t,r,s){return(r=function(a){var c=function(d,h){if(typeof d!="object"||!d)return d;var m=d[Symbol.toPrimitive];if(m!==void 0){var g=m.call(d,"string");if(typeof g!="object")return g;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(d)}(a);return typeof c=="symbol"?c:c+""}(r))in t?Object.defineProperty(t,r,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[r]=s,t}function MW(t,r){var s=Object.keys(t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);r&&(a=a.filter(function(c){return Object.getOwnPropertyDescriptor(t,c).enumerable})),s.push.apply(s,a)}return s}function cn(t){for(var r=1;r<arguments.length;r++){var s=arguments[r]!=null?arguments[r]:{};r%2?MW(Object(s),!0).forEach(function(a){ii(t,a,s[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(s)):MW(Object(s)).forEach(function(a){Object.defineProperty(t,a,Object.getOwnPropertyDescriptor(s,a))})}return t}const UW=new class extends Jr{constructor(){super(...arguments),ii(this,"currentUploadLogID",0)}reportLogUploadError(t){const{errorRange:r}=t;r[r.length-1]&&r[r.length-1]>this.currentUploadLogID&&(this.currentUploadLogID=r[r.length-1],this.emit("REPORT_LOG_UPLOAD",t))}};class $me{constructor(r){ii(this,"logger",void 0),ii(this,"prefixLists",[]),this.logger=r}debug(){for(var r=arguments.length,s=new Array(r),a=0;a<r;a++)s[a]=arguments[a];this.logger.debug(...this.prefixLists,...s)}info(){for(var r=arguments.length,s=new Array(r),a=0;a<r;a++)s[a]=arguments[a];this.logger.info(...this.prefixLists,...s)}warning(){for(var r=arguments.length,s=new Array(r),a=0;a<r;a++)s[a]=arguments[a];this.logger.warning(...this.prefixLists,...s)}error(){for(var r=arguments.length,s=new Array(r),a=0;a<r;a++)s[a]=arguments[a];this.logger.error(...this.prefixLists,...s)}prefix(r){return this.prefixLists.push(r),this}popPrefix(){return this.prefixLists.pop(),this}}function t2(){const t=new Date;return t.toTimeString().split(" ")[0]+":"+t.getMilliseconds()}function VW(){const t=new Date,r=/((\d+:){2}\d+)/.exec(new Date().toUTCString());return r?(r==null?void 0:r[0])+":"+t.getUTCMilliseconds():t.toTimeString().split(" ")[0]+":"+t.getMilliseconds()}const zl={DEBUG:0,INFO:1,WARNING:2,ERROR:3,NONE:4},vP=Date.now(),tT=t=>{for(const r in zl)if(Object.prototype.hasOwnProperty.call(zl,r)&&zl[r]===t)return r;return"DEFAULT"},x=new class{constructor(){ii(this,"proxyServerURL",void 0),ii(this,"logLevel",zl.DEBUG),ii(this,"uploadState","collecting"),ii(this,"uploadLogWaitingList",[]),ii(this,"uploadLogUploadingList",[]),ii(this,"uploadErrorCount",0),ii(this,"currentLogID",0),ii(this,"url",void 0),ii(this,"extLog",(t,r)=>{this.appendLogToWaitingList(t,...r)})}debug(){for(var t=arguments.length,r=new Array(t),s=0;s<t;s++)r[s]=arguments[s];const a=[zl.DEBUG].concat(r);this.log.apply(this,a)}info(){for(var t=arguments.length,r=new Array(t),s=0;s<t;s++)r[s]=arguments[s];const a=[zl.INFO].concat(r);this.log.apply(this,a)}warning(){for(var t=arguments.length,r=new Array(t),s=0;s<t;s++)r[s]=arguments[s];const a=[zl.WARNING].concat(r);this.log.apply(this,a)}warn(){this.warning(...arguments)}error(){for(var t=arguments.length,r=new Array(t),s=0;s<t;s++)r[s]=arguments[s];const a=[zl.ERROR].concat(r);this.log.apply(this,a)}upload(){for(var t=arguments.length,r=new Array(t),s=0;s<t;s++)r[s]=arguments[s];const a=[zl.DEBUG].concat(r);this.uploadLog.apply(this,a)}setLogLevel(t){t=Math.min(Math.max(0,t),4),this.logLevel=t}enableLogUpload(){pr("UPLOAD_LOG",!0)}disableLogUpload(){pr("UPLOAD_LOG",!1),this.uploadLogUploadingList=[],this.uploadLogWaitingList=[]}setProxyServer(t){this.proxyServerURL=t}prefix(t){return new $me(this).prefix(t)}log(){for(var t=arguments.length,r=new Array(t),s=0;s<t;s++)r[s]=arguments[s];if(Date.now()-vP<100)return void setTimeout(()=>{this.log(...r)},Date.now()-vP);const a=Math.max(0,Math.min(4,r[0]));if(r[0]=t2()+" Agora-SDK [".concat(tT(a),"]:"),this.appendLogToWaitingList(a,...r),a<this.logLevel)return;const c=t2()+" %cAgora-SDK [".concat(tT(a),"]:");let d=[];if(!se("USE_NEW_LOG"))switch(a){case zl.DEBUG:d=[c,"color: #64B5F6;"].concat(r.slice(1)),console.log.apply(console,d);break;case zl.INFO:d=[c,"color: #1E88E5; font-weight: bold;"].concat(r.slice(1)),console.log.apply(console,d);break;case zl.WARNING:d=[c,"color: #FB8C00; font-weight: bold;"].concat(r.slice(1)),console.warn.apply(console,d);break;case zl.ERROR:d=[c,"color: #B00020; font-weight: bold;"].concat(r.slice(1)),console.error.apply(console,d)}}uploadLog(){for(var t=arguments.length,r=new Array(t),s=0;s<t;s++)r[s]=arguments[s];if(Date.now()-vP<100)return void setTimeout(()=>{this.uploadLog(...r)},Date.now()-vP);const a=Math.max(0,Math.min(4,r[0]));r[0]=t2()+" Agora-SDK [".concat(tT(a),"]:"),this.appendLogToWaitingList(a,...r)}appendLogToWaitingList(t){if(!se("UPLOAD_LOG"))return;for(var r=arguments.length,s=new Array(r>1?r-1:0),a=1;a<r;a++)s[a-1]=arguments[a];Array.isArray(s[0])?s[0][0]=VW()+" Agora-SDK [".concat(tT(t),"]:"):s[0]=VW()+" Agora-SDK [".concat(tT(t),"]:");let c="";s.forEach(d=>{typeof d=="object"&&(d=JSON.stringify(d)),c+="".concat(d," ")}),this.uploadLogWaitingList.push({payload_str:c,log_level:t,log_item_id:this.currentLogID++}),this.uploadState==="uploading"&&this.uploadLogUploadingList.length===0&&this.uploadLogInterval()}startUpload(){this.uploadState="uploading",this.uploadLogUploadingList.length===0&&this.uploadLogInterval()}async uploadLogs(){const t=this.uploadLogUploadingList,r={sdk_version:Bl,process_id:se("PROCESS_ID"),payload:JSON.stringify(t)};return zd(async()=>{const s=await Sa.post(this.url||(this.proxyServerURL?"https://".concat(this.proxyServerURL,"/ls/?h=").concat(se("LOG_UPLOAD_SERVER"),"&p=443&d=upload/v1"):"https://".concat(se("LOG_UPLOAD_SERVER"),"/upload/v1")),r,{responseType:"text"});if(s.data!=="OK"){const a=new Error("unexpected upload log response");throw a.response=s,a}},()=>(this.uploadLogUploadingList=[],!1),s=>{const a={status:-1,message:s.message,errorRange:t.map(c=>c.log_item_id)};return s.response?(a.status=s.response.status,a.data=s.response.data,a.headers=s.response.headers):s.request&&(a.status=s.request.status),UW.reportLogUploadError(a),!0},{timeout:se("UPLOAD_LOG_REQUEST_RETRY_INTERVAL"),maxRetryTimeout:se("UPLOAD_LOG_REQUEST_MAX_RETRY_INTERVAL")})}uploadLogInterval(){this.uploadLogUploadingList.length===0&&this.uploadLogWaitingList.length===0||(this.uploadLogUploadingList.length===0&&(this.uploadLogUploadingList=this.uploadLogWaitingList.splice(0,se("UPLOAD_LOG_LENGTH_EACH_TIME"))),this.uploadLogs().then(()=>{this.uploadErrorCount=0,this.uploadLogWaitingList.length>0&&window.setTimeout(()=>this.uploadLogInterval(),se("UPLOAD_LOG_INTERVAL"))}).catch(t=>{this.uploadErrorCount+=1,this.uploadErrorCount<2?window.setTimeout(()=>this.uploadLogInterval(),se("UPLOAD_LOG_TWICE_RETRY_INTERVAL_V1")):window.setTimeout(()=>this.uploadLogInterval(),se("UPLOAD_LOG_RETRY_INTERVAL_V1"))}))}};var FW;function Kme(t){return Ss(t.reportId,"params.reportId",0,100,!1),Ss(t.category,"params.category",0,100,!1),Ss(t.event,"params.event",0,100,!1),Ss(t.label,"params.label",0,100,!1),_r(t.value,"params.value",Number.MIN_SAFE_INTEGER,Number.MAX_SAFE_INTEGER,!1),!0}(FW={}).FREE="free",FW.UPLOADING="uploading",function(t){t[t.MISC=0]="MISC",t[t.INTERNAL_EVENT=1]="INTERNAL_EVENT",t[t.PUBLIC_EVENT=2]="PUBLIC_EVENT",t[t.WEB_EVENT=3]="WEB_EVENT",t[t.INTERNAL_API=4]="INTERNAL_API",t[t.WEB_API=5]="WEB_API",t[t.PUBLIC_API=6]="PUBLIC_API"}({});const qme={sid:"",lts:0,success:null,cname:null,uid:null,peer:null,cid:null,elapse:null,extend:null,vid:0};let Xi=function(t){return t.PUBLISH="publish",t.SUBSCRIBE="subscribe",t.WS_COMPRESSOR_INIT="ws_compressor_init",t.SESSION_INIT="session_init",t.JOIN_CHOOSE_SERVER="join_choose_server",t.REQ_USER_ACCOUNT="req_user_account",t.JOIN_GATEWAY="join_gateway",t.REJOIN_GATEWAY="rejoin_gateway",t.STREAM_SWITCH="stream_switch",t.REQUEST_PROXY_WORKER_MANAGER="request_proxy_worker_manager",t.REQUEST_PROXY_APPCENTER="request_proxy_appcenter",t.FIRST_VIDEO_RECEIVED="first_video_received",t.FIRST_AUDIO_RECEIVED="first_audio_received",t.FIRST_VIDEO_DECODE="first_video_decode",t.FIRST_AUDIO_DECODE="first_audio_decode",t.XLA_PEER_FIRST_VIDEO_FRAME="xla_peer_first_video_frame",t.ON_ADD_AUDIO_STREAM="on_add_audio_stream",t.ON_ADD_VIDEO_STREAM="on_add_video_stream",t.ON_UPDATE_STREAM="on_update_stream",t.ON_REMOVE_STREAM="on_remove_stream",t.USER_ANALYTICS="req_user_analytics",t.PC_STATS="pc_stats",t.UPDATE_REMOTE_RTPCAPABILITIES="update_remote_rtpCapabilities",t.AB_TEST="ab_test",t}({}),Wr=function(t){return t.SESSION="io.agora.pb.Wrtc.Session",t.JOIN_CHOOSE_SERVER="io.agora.pb.Wrtc.JoinChooseServer",t.REQ_USER_ACCOUNT="io.agora.pb.Wrtc.ReqUserAccount",t.JOIN_GATEWAY="io.agora.pb.Wrtc.JoinGateway",t.RE_JOIN_GATEWAY="io.agora.pb.Wrtc.ReJoinGateway",t.PUBLISH="io.agora.pb.Wrtc.Publish",t.SUBSCRIBE="io.agora.pb.Wrtc.Subscribe",t.WS_COMPRESSOR_INIT="io.agora.pb.Wrtc.WsCompressorInit",t.STREAM_SWITCH="io.agora.pb.Wrtc.StreamSwitch",t.AUDIO_SENDING_STOPPED="io.agora.pb.Wrtc.AudioSendingStopped",t.VIDEO_SENDING_STOPPED="io.agora.pb.Wrtc.VideoSendingStopped",t.REQUEST_PROXY_APPCENTER="io.agora.pb.Wrtc.RequestProxyAppCenter",t.REQUEST_PROXY_WORKER_MANAGER="io.agora.pb.Wrtc.RequestProxyWorkerManager",t.API_INVOKE="io.agora.pb.Wrtc.ApiInvoke",t.FIRST_VIDEO_RECEIVED="io.agora.pb.Wrtc.FirstVideoReceived",t.FIRST_AUDIO_RECEIVED="io.agora.pb.Wrtc.FirstAudioReceived",t.FIRST_VIDEO_DECODE="io.agora.pb.Wrtc.FirstVideoDecode",t.FIRST_AUDIO_DECODE="io.agora.pb.Wrtc.FirstAudioDecode",t.XLA_PEER_FIRST_VIDEO_FRAME="io.agora.pb.Wrtc.XLAPeerFirstVideoFrame",t.ON_ADD_AUDIO_STREAM="io.agora.pb.Wrtc.OnAddAudioStream",t.ON_ADD_VIDEO_STREAM="io.agora.pb.Wrtc.OnAddVideoStream",t.ON_UPDATE_STREAM="io.agora.pb.Wrtc.OnUpdateStream",t.ON_REMOVE_STREAM="io.agora.pb.Wrtc.OnRemoveStream",t.JOIN_CHANNEL_TIMEOUT="io.agora.pb.Wrtc.JoinChannelTimeout",t.PEER_PUBLISH_STATUS="io.agora.pb.Wrtc.PeerPublishStatus",t.WORKER_EVENT="io.agora.pb.Wrtc.WorkerEvent",t.AP_WORKER_EVENT="io.agora.pb.Wrtc.APWorkerEvent",t.JOIN_WEB_PROXY_AP="io.agora.pb.Wrtc.JoinWebProxyAP",t.WEBSOCKET_QUIT="io.agora.pb.Wrtc.WebSocketQuit",t.USER_ANALYTICS="io.agora.pb.Wrtc.UserAnalytics",t.AUTOPLAY_FAILED="io.agora.pb.Wrtc.AutoplayFailed",t.PC_STATS="io.agora.pb.Wrtc.PCStats",t.UPDATE_REMOTE_RTPCAPABILITIES="io.agora.pb.Wrtc.UpdateRemoteRTPCapabilities",t.AB_TEST="io.agora.pb.Wrtc.ABTest",t}({});(function(t){t[t.WORKER_EVENT=156]="WORKER_EVENT",t[t.AP_WORKER_EVENT=160]="AP_WORKER_EVENT"})({});let Yme=function(t){return t[t.SESSION=26]="SESSION",t[t.JOIN_CHOOSE_SERVER=27]="JOIN_CHOOSE_SERVER",t[t.REQ_USER_ACCOUNT=196]="REQ_USER_ACCOUNT",t[t.JOIN_GATEWAY=28]="JOIN_GATEWAY",t[t.PUBLISH=30]="PUBLISH",t[t.SUBSCRIBE=29]="SUBSCRIBE",t[t.WS_COMPRESSOR_INIT=9430]="WS_COMPRESSOR_INIT",t[t.STREAM_SWITCH=32]="STREAM_SWITCH",t[t.AUDIO_SENDING_STOPPED=33]="AUDIO_SENDING_STOPPED",t[t.VIDEO_SENDING_STOPPED=34]="VIDEO_SENDING_STOPPED",t[t.REQUEST_PROXY_APPCENTER=35]="REQUEST_PROXY_APPCENTER",t[t.REQUEST_PROXY_WORKER_MANAGER=36]="REQUEST_PROXY_WORKER_MANAGER",t[t.API_INVOKE=41]="API_INVOKE",t[t.FIRST_VIDEO_RECEIVED=348]="FIRST_VIDEO_RECEIVED",t[t.FIRST_AUDIO_RECEIVED=349]="FIRST_AUDIO_RECEIVED",t[t.FIRST_VIDEO_DECODE=350]="FIRST_VIDEO_DECODE",t[t.FIRST_AUDIO_DECODE=351]="FIRST_AUDIO_DECODE",t[t.ON_ADD_AUDIO_STREAM=352]="ON_ADD_AUDIO_STREAM",t[t.ON_ADD_VIDEO_STREAM=353]="ON_ADD_VIDEO_STREAM",t[t.ON_UPDATE_STREAM=356]="ON_UPDATE_STREAM",t[t.ON_REMOVE_STREAM=355]="ON_REMOVE_STREAM",t[t.JOIN_CHANNEL_TIMEOUT=407]="JOIN_CHANNEL_TIMEOUT",t[t.PEER_PUBLISH_STATUS=408]="PEER_PUBLISH_STATUS",t[t.WORKER_EVENT=156]="WORKER_EVENT",t[t.AP_WORKER_EVENT=160]="AP_WORKER_EVENT",t[t.JOIN_WEB_PROXY_AP=700]="JOIN_WEB_PROXY_AP",t[t.WEBSOCKET_QUIT=671]="WEBSOCKET_QUIT",t[t.USER_ANALYTICS=1e4]="USER_ANALYTICS",t[t.AUTOPLAY_FAILED=9178]="AUTOPLAY_FAILED",t}({});function Gt(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return function(r,s,a){const c=a.value;if(typeof c=="function"){const d=t.className||r.__className__||(r.constructor.name==="AgoraRTCClient"?"Client":r.constructor.name);a.value=function(){for(var h,m=arguments.length,g=new Array(m),E=0;E<m;E++)g[E]=arguments[E];let b=g;if(t.argsMap)try{b=t.argsMap(this,...g)}catch(A){x.warning(A),b=[]}try{JSON.stringify(b)}catch{x.warning("arguments for method ".concat(d,".").concat(String(s)," not serializable for apiInvoke.")),b=[]}const I=(t.report||At).reportApiInvoke(this._sessionId||null,{id:this._clientId||((h=this.store)===null||h===void 0?void 0:h.clientId)||this._ID,name:"".concat(d,".").concat(String(s)),options:b,tag:$r.TRACER,reportResult:t.reportResult},t.throttleTime);try{const A=c.apply(this,g);return A instanceof pt?A.then(k=>(I.onSuccess(t.reportResult&&k),k)).catch(k=>{throw I.onError(k),k}):(I.onSuccess(t.reportResult&&A),A)}catch(A){throw I.onError(A),A}}}return a}}const At=new class{constructor(){ii(this,"baseInfoMap",new Map),ii(this,"proxyServer",void 0),ii(this,"eventUploadTimer",void 0),ii(this,"setSessionIdTimer",void 0),ii(this,"url",void 0),ii(this,"sids",new Set),ii(this,"backupUrl",void 0),ii(this,"_appId",void 0),ii(this,"_aid",0),ii(this,"keyEventUploadPendingItems",[]),ii(this,"normalEventUploadPendingItems",[]),ii(this,"apiInvokeUploadPendingItems",[]),ii(this,"apiInvokeCount",0),ii(this,"apiInvokeLoggedCount",0),ii(this,"ltsList",[]),ii(this,"lastSendNormalEventTime",Date.now()),ii(this,"customReportCounterTimer",void 0),ii(this,"customReportCount",0),ii(this,"extApiInvoke",async t=>{for(const r of t){const s=cn(cn({},r),{},{sid:null,invokeId:++this.apiInvokeCount,tag:$r.TRACER});this.sendApiInvoke(s)}}),this.eventUploadTimer=window.setInterval(this.doSend.bind(this),se("EVENT_REPORT_SEND_INTERVAL")),this.setSessionIdTimer=window.setInterval(this.appendSessionId.bind(this),se("EVENT_REPORT_SEND_INTERVAL"))}getBaseInfoBySessionId(t){return this.baseInfoMap.get(t)}setAppId(t){this._appId=t,this._aid=parseInt(t.replace(/[a-fA-F0-9]{8}/g,r=>{let[s,a]=r;return s+a}),16)||0}reportApiInvoke(t,r,s){r.timeout=r.timeout||6e4,r.reportResult=r.reportResult===void 0||r.reportResult;const a=Date.now();this.apiInvokeCount+=1;const c=this.apiInvokeCount,d=!!se("SHOW_REPORT_INVOKER_LOG"),h=!!se("SHOW_REPORT_USER_INVOKER_LOG"),m=d||h&&r.id;m&&(this.apiInvokeLoggedCount+=1);const g=this.apiInvokeLoggedCount;function E(k,W){if(m){let j="[apiInvoke-".concat(g,"]");if(r.id&&(j+="[".concat(r.id,"]")),r.name&&(j+="[".concat(r.name,"]"),r.name===di.JOIN))return x.info("".concat(j," ").concat(k));x.info("".concat(j," ").concat(k),k==="start"?r.options:W||"")}}const b=()=>({tag:r.tag,invokeId:c,sid:t,name:r.name,apiInvokeTime:a,options:r.options,states:r.states||null});E("start");let I=!1;bs(r.timeout).then(()=>{I||(this.sendApiInvoke(cn(cn({},b()),{},{error:te.API_INVOKE_TIMEOUT,success:!1})),E("timeout"))});const A=new Le(te.UNEXPECTED_ERROR,"".concat(r.name,": this api invoke is end"));return{onSuccess:k=>{const W=()=>{if(I)throw A;return I=!0,this.sendApiInvoke(cn(cn({},b()),{},{success:!0},r.reportResult&&{result:k})),E("onSuccess"),k};return s?yW(W,r.name+"Success",s,()=>I=!0):W()},onError:k=>{const W=()=>{if(I)throw k;I=!0,this.sendApiInvoke(cn(cn({},b()),{},{success:!1,error:k})),E("onFailure",k.toString())};return s?yW(W,r.name+"Error",s,()=>I=!0):W()}}}sessionInit(t,r){if(this.baseInfoMap.has(t))return;const s=Date.now(),a=this.createBaseInfo(t,s);a.cname=r.cname;const c=Object.assign({},{willUploadConsoleLog:se("UPLOAD_LOG"),maxTouchPoints:navigator.maxTouchPoints,areaVersion:XL?"global":"oversea",areas:se("AREAS")&&se("AREAS").join(",")},r.extend),{stringUid:d,channelProfile:h,channelMode:m,isABTestSuccess:g,lsid:E,clientRole:b}=r,I=Date.now(),A=cn(cn({},a),{},{eventType:Xi.SESSION_INIT,appid:r.appid,browser:navigator.userAgent,buildFormat:r.buildFormat,build:QL,lts:I,elapse:I-s,extend:JSON.stringify(c),mode:r.mode,process:se("PROCESS_ID"),appType:se("APP_TYPE"),success:!0,version:Bl,stringUid:d,channelProfile:h,channelMode:m,isABTestSuccess:g,lsid:E,clientType:rt(k=window.navigator.userAgent).call(k,"AgoraWebView")?42:20,clientRole:b,serviceId:se("PROCESS_ID"),extensionID:se("PLUGIN_INFO").join(",")||""});var k;this.send({type:Wr.SESSION,data:A},!0)}joinChooseServer(t,r){const s=this.baseInfoMap.get(t);if(!s)return;const a=s.info,c=Date.now(),d=cn(cn({},a),{},{role:r.role,eventType:Xi.JOIN_CHOOSE_SERVER,lts:c,eventElapse:r.elapse||c-r.lts,chooseServerAddr:r.csAddr,errorCode:r.ec,elapse:c-s.startTime,success:r.succ,chooseServerAddrList:JSON.stringify(r.serverList),uid:r.uid?parseInt(r.uid):null,cid:r.cid?parseInt(r.cid):null,chooseServerIp:r.csIp||"",opid:r.opid,unilbsServerIds:r.unilbsServerIds,extend:r.extend||void 0,isHttp3:r.isHttp3,corssRegionTagReq:r.corssRegionTagReq||void 0,corssRegionTagRes:r.corssRegionTagRes||void 0,resourceTimingInfo:r.resourceTimingInfo||void 0});this.send({type:Wr.JOIN_CHOOSE_SERVER,data:d},!0)}reqUserAccount(t,r){const s=this.baseInfoMap.get(t);if(!s)return;const a=s.info,c=Date.now(),d=cn(cn({},a),{},{eventType:Xi.REQ_USER_ACCOUNT,lts:c,success:r.success,serverAddress:r.serverAddr,stringUid:r.stringUid,uid:r.uid,errorCode:r.errorCode,elapse:r.elapse||c-s.startTime,eventElapse:c-r.lts,extend:JSON.stringify(r.extend)});this.send({type:Wr.REQ_USER_ACCOUNT,data:d},!0)}joinGateway(t,r){const s=this.baseInfoMap.get(t);if(!s)return;const a=s.info;r.vid&&(a.vid=r.vid),a.uid=r.uid,a.cid=r.cid;const c=Date.now(),{firstSuccess:d,addr:h,isProxy:m}=r,g=c-s.startTime,E=cn(cn({},a),{},{eventType:Xi.JOIN_GATEWAY,lts:c,gatewayAddr:r.addr,success:r.succ,errorCode:r.ec,errorMsg:r.errorMsg||"",elapse:g,eventElapse:c-r.lts,firstSuccess:d,signalChannel:r.signalChannel,preload:r.preload?1:0,installId:YL(),isABTestSuccess:r.isABTestSuccess?1:0}),b=E.success?1:0;if(r.succ&&(s.lastJoinSuccessTime=c),d)this.send({type:Wr.JOIN_GATEWAY,data:E},!0);else{let I;if(h)if(m){const k=h.match(/h=(\d{1,3}-){3}\d{1,3}/g),W=h.match(/p=[0-9]{1,6}/g);I={isSuccess:b,gatewayIp:k&&k.length?k[0].split("=")[1].replace(/-/g,"."):"",port:W&&W.length?W[0].split("=")[1]:"",isProxy:m?1:0}}else{const k=h.match(/wss:\/\/(\d{1,3}-){3}\d{1,3}/g),W=h.match(/(:|p=)[0-9]{1,6}/g);I={isSuccess:b,gatewayIp:k&&k.length?k[0].split("//")[1].replace(/-/g,"."):"",port:W&&W.length?W[0].split(/:|p=/g)[1]:"",isProxy:m?1:0}}else I={isSuccess:b,gatewayIp:"",port:"",isProxy:m?1:0};delete E.success,delete E.eventType,delete E.firstSuccess,E.vid=Number(E.vid);const A=Object.assign({},E,I,{eventType:Xi.REJOIN_GATEWAY});this.send({type:Wr.RE_JOIN_GATEWAY,data:A},!0)}}joinChannelTimeout(t,r){const s=this.baseInfoMap.get(t);if(!s)return;const a=Date.now(),c=cn(cn({},s.info),{},{lts:a,timeout:r,elapse:a-s.startTime});this.send({type:Wr.JOIN_CHANNEL_TIMEOUT,data:c},!0)}publish(t,r){const s=this.baseInfoMap.get(t);if(!s)return;const a=s.info,c=Date.now(),d=cn(cn({},a),{},{eventType:Xi.PUBLISH,lts:c,eventElapse:r.eventElapse,elapse:c-s.startTime,success:r.succ,errorCode:r.ec,videoName:r.videoName,audioName:r.audioName,screenName:r.screenName,screenshare:r.screenshare,audio:r.audio,video:r.video,p2pid:r.p2pid,publishRequestid:r.publishRequestid});this.send({type:Wr.PUBLISH,data:d},!0)}subscribe(t,r,s){const a=this.baseInfoMap.get(t);if(!a)return;const c=a.info,d=Date.now(),h=cn(cn({},c),{},{eventType:Xi.SUBSCRIBE,lts:d,eventElapse:r.eventElapse,elapse:d-a.startTime,success:r.succ,errorCode:r.ec,video:r.video,audio:r.audio,subscribeRequestid:r.subscribeRequestid,p2pid:r.p2pid,preSsrc:r.preSsrc?1:0},s&&{extend:JSON.stringify({isMassSubscribe:!0})});typeof r.peerid=="string"?h.peerSuid=r.peerid:h.peer=r.peerid,this.send({type:Wr.SUBSCRIBE,data:h},!0)}wsCompressorInit(t){var r;const s=[...Xa(r=this.baseInfoMap).call(r)],a=s.length?s[0]:"UnableToGetSid",c=this.baseInfoMap.get(a);if(!c)return;const d=c.info,h=Date.now(),m=cn(cn({},d),{},{eventType:Xi.WS_COMPRESSOR_INIT,lts:h,eventElapse:t.eventElapse,elapse:h-c.startTime,status:t.status?1:2});this.send({type:Wr.WS_COMPRESSOR_INIT,data:m},!0)}firstXLAPeerFirstVideoFrame(t,r){const s=this.baseInfoMap.get(t);if(!s)return;const a=s.info,c=Date.now(),d=r.peerPubStatusMs-(s.lastJoinSuccessTime||c),h=cn(cn({},a),{},{elapse:c-s.startTime,eventType:Xi.XLA_PEER_FIRST_VIDEO_FRAME,lts:c,peer:r.peer,width:r.width,height:r.height,ssrc:r.ssrc,p2pid:r.p2pid,peerPublishDuration:r.peerPublishDuration,joinChannelSuccessElapse:d,peerPubStatusMs:r.peerPubStatusMs-r.joinChannelStart,availablePublish:r.peerPublishDuration>d?1:0,preloadStart:Math.max(r.preloadStart-r.joinChannelStart,0),preloadEnd:Math.max(r.preloadEnd-r.joinChannelStart,0),encrypt:Math.max(r.apStart-r.joinChannelStart,0),ap:Math.max(r.apEnd-r.joinChannelStart,0),sua:Math.max(r.suaEnd-r.joinChannelStart,0),beforeConnect:Math.max(r.beforeConnect-r.joinChannelStart,0),peerRecevier:Math.max(r.peerReceiver-r.joinChannelStart,0),ice:Math.max(r.ice-r.joinChannelStart,0),pc:Math.max(r.pc-r.joinChannelStart,0),signalConnected:Math.max(r.signalConnected-r.joinChannelStart,0),joinReq:Math.max(r.joinReq-r.joinChannelStart,0),joinRes:Math.max(r.joinRes-r.joinChannelStart,0),userJoinNotify:Math.max(r.userJoinNotify-r.joinChannelStart,0),videoSsrcNotify:Math.max(r.videoAddNotify-r.joinChannelStart,0),subscribeDelayMs:Math.max(r.subscribeStart-r.videoAddNotify,0),subscribeStart:Math.max(r.subscribeStart-r.joinChannelStart,0),subscribeEnd:Math.max(r.subscribeEnd-r.joinChannelStart,0),firstReceived:Math.max(r.firstReceived-r.joinChannelStart,0),firstDecoded:Math.max(r.firstDecoded-r.joinChannelStart,0),firstPreRender:Math.max(r.firstPreRender-r.joinChannelStart,0),firstRender:Math.max(r.firstRender-r.joinChannelStart,0),playDelayMs:Math.max(r.playStart-r.subscribeEnd,0),playStart:Math.max(r.playStart-r.joinChannelStart,0),playEnd:Math.max(r.playEnd-r.joinChannelStart,0),isPreSub:r.isPreSub?1:0,isPrePc:r.isPrePc?1:0,isPreInstantVideo:r.isPreInstantVideo?1:0});this.send({type:Wr.XLA_PEER_FIRST_VIDEO_FRAME,data:h},!0)}firstRemoteVideoDecode(t,r,s,a){const c=this.baseInfoMap.get(t);if(!c)return;const d=c.info,h=Date.now(),m=cn(cn(cn({},d),a),{},{elapse:h-c.startTime,eventType:r,lts:h,firstDecodeFrame:Math.max((a.firstFrame||h)-c.startTime,0),apEnd:Math.max(a.apEnd-c.startTime,0),apStart:Math.max(a.apStart-c.startTime,0),joinGwEnd:Math.max(a.joinGwEnd-c.startTime,0),joinGwStart:Math.max(a.joinGwStart-c.startTime,0),pcEnd:Math.max(a.pcEnd-c.startTime,0),pcStart:Math.max(a.pcStart-c.startTime,0),subscriberEnd:Math.max(a.subscriberEnd-c.startTime,0),subscriberStart:Math.max(a.subscriberStart-c.startTime,0),videoAddNotify:Math.max(a.videoAddNotify-c.startTime,0)});this.send({type:s,data:m},!0)}firstRemoteFrame(t,r,s,a){const c=this.baseInfoMap.get(t);if(!c)return;const d=c.info,h=Date.now(),m=cn(cn(cn({},d),a),{},{elapse:h-c.startTime,eventType:r,lts:h});this.send({type:s,data:m},!0)}abTest(t,r){const s=this.baseInfoMap.get(t);if(!s)return;const a=s.info,c=Date.now(),d=cn(cn(cn({},a),r),{},{vid:a.vid===void 0?0:Number(a.vid),elapse:c-s.startTime,eventType:Xi.AB_TEST,lts:c});this.send({type:Wr.AB_TEST,data:d},!0)}pcStats(t,r){const s=this.baseInfoMap.get(t);if(!s)return;const a=s.info,c=Date.now(),d=cn(cn(cn({},a),r),{},{vid:a.vid===void 0?0:Number(a.vid),elapse:c-s.startTime,eventType:Xi.PC_STATS,lts:c,preallocation:r.preallocation?1:0});this.send({type:Wr.PC_STATS,data:d},!0)}updateRemoteRTPCapabilities(t,r){if(t){const s=this.baseInfoMap.get(t);if(!s)return;const a=s.info,c=Date.now(),d=cn(cn(cn({},a),r),{},{vid:a.vid===void 0?0:Number(a.vid),eventType:Xi.UPDATE_REMOTE_RTPCAPABILITIES,lts:c});this.send({type:Wr.UPDATE_REMOTE_RTPCAPABILITIES,data:d},!0)}}onGatewayStream(t,r,s,a){const c=this.baseInfoMap.get(t);if(!c)return;const d=c.info,h=Date.now(),m=cn(cn(cn({},d),a),{},{eventType:r,lts:h});this.send({type:s,data:m},!0)}streamSwitch(t,r){const s=this.baseInfoMap.get(t);if(!s)return;const a=s.info,c=Date.now(),d=cn(cn({},a),{},{eventType:Xi.STREAM_SWITCH,lts:c,isDual:r.isdual,elapse:c-s.startTime,success:r.succ});this.send({type:Wr.STREAM_SWITCH,data:d},!0)}requestProxyAppCenter(t,r){const s=this.baseInfoMap.get(t);if(!s)return;const a=s.info,c=Date.now(),d=cn(cn({},a),{},{eventType:Xi.REQUEST_PROXY_APPCENTER,lts:c,eventElapse:c-r.lts,elapse:c-s.startTime,APAddr:r.APAddr,workerManagerList:r.workerManagerList,response:r.response,errorCode:r.ec,success:r.succ});this.send({type:Wr.REQUEST_PROXY_APPCENTER,data:d},!0)}requestProxyWorkerManager(t,r){const s=this.baseInfoMap.get(t);if(!s)return;const a=s.info,c=Date.now(),d=cn(cn({},a),{},{eventType:Xi.REQUEST_PROXY_WORKER_MANAGER,lts:c,eventElapse:c-r.lts,elapse:c-s.startTime,workerManagerAddr:r.workerManagerAddr,response:r.response,errorCode:r.ec,success:r.succ});this.send({type:Wr.REQUEST_PROXY_WORKER_MANAGER,data:d},!0)}setProxyServer(t){this.proxyServer=t,t?x.debug("reportProxyServerurl: ".concat(t)):x.debug("disable reportProxyServerurl: ".concat(t))}peerPublishStatus(t,r){const s=this.baseInfoMap.get(t);if(!s)return;const a=s.info,c=Date.now(),d=cn(cn({},a),{},{subscribeElapse:r.subscribeElapse,peer:r.peer,peerPublishDuration:Math.max(r.audioPublishDuration,r.videoPublishDuration),audiotag:r.audioPublishDuration>0?1:-1,videotag:r.videoPublishDuration>0?1:-1,lts:c,elapse:c-s.startTime,joinChannelSuccessElapse:c-(s.lastJoinSuccessTime||c),peerPublishDurationVideo:r.videoPublishDuration,peerPublishDurationAudio:r.audioPublishDuration});this.send({type:Wr.PEER_PUBLISH_STATUS,data:d},!0)}workerEvent(t,r){const s=this.baseInfoMap.get(t);if(!s)return;const a=s.info,c=Date.now();(function(d,h,m){const g=d[h];if(!g||typeof g!="string")return[d];d[h]="";const E=Gh(JSON.stringify(d));let b=0;const I=[];let A=0;for(let k=0;k<g.length;k++)A+=g.charCodeAt(k)<=127?1:3,A<=m-E||(I[I.length]=Qe(Qe({},d),{},{[h]:g.substring(b,k)}),b=k,A=g.charCodeAt(k)<=127?1:3);return b!==g.length-1&&(I[I.length]=Qe(Qe({},d),{},{[h]:g.substring(b)})),I})(cn(cn(cn({},a),r),{},{elapse:c-s.startTime,lts:c,productType:"WebRTC"}),"payload",1300).forEach(d=>this.send({type:Wr.WORKER_EVENT,data:d},!0))}apworkerEvent(t,r){const s=this.baseInfoMap.get(t);if(!s)return;const a=s.info,c=Date.now(),d=cn(cn(cn({},a),r),{},{elapse:c-s.startTime,lts:c});this.send({type:Wr.AP_WORKER_EVENT,data:d},!0)}joinWebProxyAP(t,r){const s=this.baseInfoMap.get(t);if(!s)return;const a=s.info,c=Date.now(),d=cn(cn(cn({},a),r),{},{elapse:c-s.startTime,lts:c,extend:r.extend||void 0});this.send({type:Wr.JOIN_WEB_PROXY_AP,data:d},!0)}WebSocketQuit(t,r){const s=this.baseInfoMap.get(t);if(!s)return;const a=s.info,c=Date.now(),d=cn(cn(cn({},a),r),{},{elapse:c-s.startTime,lts:c});this.send({type:Wr.WEBSOCKET_QUIT,data:d},!0)}async sendCustomReportMessage(t,r){if(this.customReportCount+=r.length,this.customReportCount>se("CUSTOM_REPORT_LIMIT"))throw new Le(te.CUSTOM_REPORT_FREQUENCY_TOO_HIGH);this.customReportCounterTimer||(this.customReportCounterTimer=window.setInterval(()=>{this.customReportCount=0},5e3));const s=Date.now(),a=r.map(c=>({type:Wr.USER_ANALYTICS,data:cn(cn({sid:t},c),{},{lts:s})}));try{se("NEW_REPORT_SERVER")?await this.postDataToStatsCollector2(a):await this.postDataToStatsCollector(a)}catch(c){throw x.error("send custom report message failed",c.toString()),new Le(te.CUSTOM_REPORT_SEND_FAILED,c.message)}}sendApiInvoke(t){const r=se("NOT_REPORT_EVENT");if(t.tag&&rt(r)&&rt(r).call(r,t.tag))return!1;if(t.sid===null)return this.apiInvokeUploadPendingItems.push(t),!1;const s=this.baseInfoMap.get(t.sid);if(!s)return this.apiInvokeUploadPendingItems.push(t),!1;const{cname:a,uid:c,cid:d}=s.info;let h;if(t.lts=t.lts||Date.now(),t.error)if(t.error instanceof Le){const{code:g,message:E}=t.error;h=g||E||t.error.toString()}else h=t.error.toString();const m={invokeId:t.invokeId,sid:t.sid,cname:a,cid:d,uid:c,lts:t.lts,success:t.success,elapse:t.lts-s.startTime,execElapse:t.lts-t.apiInvokeTime,apiName:t.name,options:t.options?JSON.stringify(t.options):void 0,execStates:t.states?JSON.stringify(t.states):void 0,execResult:t.result?JSON.stringify(t.result):void 0,errorCode:t.error?h:void 0,errorMsg:t.error?JSON.stringify(t.error):void 0};return this.send({type:Wr.API_INVOKE,data:m},!1),!0}addSid(t){this.sids.add(t)}removeSid(t){this.sids.delete(t)}appendSessionId(){const t=this.apiInvokeUploadPendingItems;if(t.length===0)return;const r=Array.from(this.sids).find(s=>s!==null);r&&t.forEach(s=>{s&&(s.sid=r,this.sendApiInvoke(Object.assign({},s)))}),t.length=0}send(t,r){if(r)return this.keyEventUploadPendingItems.push(t),void this.sendItems(this.keyEventUploadPendingItems,!0);this.normalEventUploadPendingItems.push(t),this.normalEventUploadPendingItems.length>se("NORMAL_EVENT_QUEUE_CAPACITY")&&this.normalEventUploadPendingItems.splice(0,1),this.normalEventUploadPendingItems.length>=10&&this.sendItems(this.normalEventUploadPendingItems,!1)}doSend(){this.keyEventUploadPendingItems.length>0&&this.sendItems(this.keyEventUploadPendingItems,!0),this.normalEventUploadPendingItems.length>0&&Date.now()-this.lastSendNormalEventTime>=5e3&&this.sendItems(this.normalEventUploadPendingItems,!1)}sendItems(t,r){const s=[],a=[];for(;t.length;){const d=t.shift();s.length<20?s.push(d):a.push(d)}t.push(...a);for(const d of[...s]){var c;this.ltsList.indexOf(d.data.lts)!==-1?(d.data.lts=this.ltsList[this.ltsList.length-1]+1,this.ltsList.push(d.data.lts)):(this.ltsList.push(d.data.lts),G_(c=this.ltsList).call(c,(h,m)=>h-m))}return r||(this.lastSendNormalEventTime=Date.now()),se("ENABLE_EVENT_REPORT")&&s.length&&(se("NEW_REPORT_SERVER")?this.postDataToStatsCollector2(s):this.postDataToStatsCollector(s)).catch((d=>h=>{se("EVENT_REPORT_RETRY")&&(r?this.keyEventUploadPendingItems=this.keyEventUploadPendingItems.concat(d):(this.normalEventUploadPendingItems=this.normalEventUploadPendingItems.concat(d),this.normalEventUploadPendingItems.length>se("NORMAL_EVENT_QUEUE_CAPACITY")&&(this.normalEventUploadPendingItems.splice(0,this.normalEventUploadPendingItems.length-se("NORMAL_EVENT_QUEUE_CAPACITY")),x.warning("report: drop normal events"))))})(s)),t}async postDataToStatsCollector2(t){Ci.networkState===Tc.OFFLINE&&await pt.race([Ci.onlineWaiter,bs(2*Mi.maxRetryTimeout)]);const r=c=>{let d=new Uint8Array;return c.forEach(h=>{const m=UL(JSON.stringify(h.data)),g=new ArrayBuffer(5),E=(I=>{let A=0;return Object.entries(Wr).forEach(k=>{let[W,j]=k;j===I.type&&(A=Yme[W])}),A})(h),b=new DataView(g);b.setUint16(0,m.byteLength,!0),b.setUint8(2,255&E),b.setUint8(3,E>>>8&255),b.setUint8(4,E>>>16&255),d=lW(d,new Uint8Array(g)),d=lW(d,m)}),d},s="event";let a=this.proxyServer?"https://".concat(this.proxyServer,"/rs/?h=").concat(se("NEW_REPORT_SERVER_DOMAINS")[0],"&p=443&d=").concat(s):"https://".concat(se("NEW_REPORT_SERVER_DOMAINS")[0],"/").concat(s);for(let c=0;c<2;c+=1){c===1&&(a=this.proxyServer?"https://".concat(this.proxyServer,"/rs/?h=").concat(se("NEW_REPORT_SERVER_DOMAINS")[1],"&p=443&d=").concat(s):"https://".concat(se("NEW_REPORT_SERVER_DOMAINS")[1],"/").concat(s));try{await GL(a,{timeout:1e4,data:r(t),headers:cn(cn({biz:"webrtc",sendts:Math.round(Date.now()/1e3),debug:"false"},this._appId&&{appid:this._appId}),{},{"Content-Type":"application/octet-stream"})},!0)}catch(d){if(c===1)throw d;continue}return}}async postDataToStatsCollector(t){let r=arguments.length>1&&arguments[1]!==void 0&&arguments[1];const s=(m=>{const g=m&&m.data.sid&&this.baseInfoMap.get(m.data.sid);return g&&g.info.vid&&+g.info.vid||0})(t[0]),a=s?void 0:this._aid,c={msgType:"EventMessages",sentTs:Math.round(Date.now()/1e3),payloads:t.map(m=>JSON.stringify(m)),vid:s,aid:a};Ci.networkState===Tc.OFFLINE&&await pt.race([Ci.onlineWaiter,bs(2*Mi.maxRetryTimeout)]);const d=r?"/events/proto-raws":"/events/messages";let h=this.url||(this.proxyServer?"https://".concat(this.proxyServer,"/rs/?h=").concat(se("EVENT_REPORT_DOMAIN"),"&p=").concat(se("STATS_COLLECTOR_PORT"),"&d=").concat(d):"https://".concat(se("EVENT_REPORT_DOMAIN"),":").concat(se("STATS_COLLECTOR_PORT")).concat(d));for(let m=0;m<2;m+=1){m===1&&(h=this.backupUrl||(this.proxyServer?"https://".concat(this.proxyServer,"/rs/?h=").concat(se("EVENT_REPORT_BACKUP_DOMAIN"),"&p=").concat(se("STATS_COLLECTOR_PORT"),"&d=").concat(d):"https://".concat(se("EVENT_REPORT_BACKUP_DOMAIN"),":").concat(se("STATS_COLLECTOR_PORT")).concat(d)));try{r?await xme(h,{timeout:1e4,data:c}):await GL(h,{timeout:1e4,data:c})}catch(g){if(m===1)throw g;continue}return}}createBaseInfo(t,r){const s=Object.assign({},qme);return s.sid=t,this.baseInfoMap.set(t,{info:s,startTime:r}),s}reportResourceTiming(t,r){const s=performance.getEntriesByName(t),a=s[s.length-1];a&&this.reportApiInvoke(r,{name:"Client.resourceTiming",options:a,tag:$r.TRACER}).onSuccess()}};UW.on("REPORT_LOG_UPLOAD",t=>{t.networkState=Ci.networkState,At.reportApiInvoke(null,{name:"logUploadError",options:t,tag:$r.TRACER}).onSuccess("logUploadError")});class Pe extends Le{constructor(r){super(r,arguments.length>1&&arguments[1]!==void 0?arguments[1]:"",arguments.length>2?arguments[2]:void 0),ii(this,"name","AgoraRTCException")}print(){let r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"error";return super.print(r,x)}throw(){super.throw(x)}}const ws={getDisplayMedia:!1,getStreamFromExtension:!1,supportUnifiedPlan:!1,supportMinBitrate:!1,supportSetRtpSenderParameters:!1,supportDualStream:!0,webAudioMediaStreamDest:!1,supportReplaceTrack:!1,supportWebGL:!1,webAudioWithAEC:!1,supportRequestFrame:!1,supportShareAudio:!1,supportDualStreamEncoding:!1,supportDataChannel:!1,supportPCSetConfiguration:!1,supportWebRTCEncodedTransform:!1,supportWebRTCInsertableStream:!1,supportRequestVideoFrameCallback:!1,supportWebCrypto:!1};function jn(){return ws}function jW(){return"setSinkId"in HTMLAudioElement.prototype&&(!se("RESTRICTION_SET_PLAYBACK_DEVICE")||(cf()||J8())&&!xL())}function SP(){return!ws.supportUnifiedPlan||se("CHROME_FORCE_PLAN_B")&&lf()}function n2(t){return!(ni()||Q8(87)||SP()||!se("ENABLE_PRE_SUB")&&(t==null||!t.autoSubscribe||se("FORCE_DISABLE_AUTO_SUB")))}function BW(t){return!!se("ENABLE_INSTANT_VIDEO")||!(t==null||!t.autoSubscribe||se("FORCE_DISABLE_AUTO_SUB"))}let Ts=function(t){return t.IOS_15_16_INTERRUPTION_START="ios15_16-interruption-start",t.IOS_15_16_INTERRUPTION_END="ios15_16-interruption-end",t.IOS_INTERRUPTION_START="ios-interruption-start",t.IOS_INTERRUPTION_END="ios-interruption-end",t.STATE_CHANGE="state-change",t}({});function $v(t,r,s){return{sampleRate:t,stereo:r,bitrate:s}}function Bn(t,r,s,a,c){return{width:t,height:r,frameRate:s,bitrateMin:a,bitrateMax:c}}function Mu(t,r,s,a,c){return{width:{max:t},height:{max:r},frameRate:s,bitrateMin:a,bitrateMax:c}}function r2(t,r){return{numSpatialLayers:t,numTemporalLayers:r}}const Xme={"90p":Bn(160,90),"90p_1":Bn(160,90),"120p":Bn(160,120,15,30,65),"120p_1":Bn(160,120,15,30,65),"120p_3":Bn(120,120,15,30,50),"120p_4":Bn(212,120),"180p":Bn(320,180,15,30,140),"180p_1":Bn(320,180,15,30,140),"180p_3":Bn(180,180,15,30,100),"180p_4":Bn(240,180,15,30,120),"240p":Bn(320,240,15,40,200),"240p_1":Bn(320,240,15,40,200),"240p_3":Bn(240,240,15,40,140),"240p_4":Bn(424,240,15,40,220),"360p":Bn(640,360,15,80,400),"360p_1":Bn(640,360,15,80,400),"360p_3":Bn(360,360,15,80,260),"360p_4":Bn(640,360,30,80,600),"360p_6":Bn(360,360,30,80,400),"360p_7":Bn(480,360,15,80,320),"360p_8":Bn(480,360,30,80,490),"360p_9":Bn(640,360,15,80,800),"360p_10":Bn(640,360,24,80,800),"360p_11":Bn(640,360,24,80,1e3),"480p":Bn(640,480,15,100,500),"480p_1":Bn(640,480,15,100,500),"480p_2":Bn(640,480,30,100,1e3),"480p_3":Bn(480,480,15,100,400),"480p_4":Bn(640,480,30,100,750),"480p_6":Bn(480,480,30,100,600),"480p_8":Bn(848,480,15,100,610),"480p_9":Bn(848,480,30,100,930),"480p_10":Bn(640,480,10,100,400),"720p":Bn(1280,720,15,120,1130),"720p_auto":Bn(1280,720,30,900,3e3),"720p_1":Bn(1280,720,15,120,1130),"720p_2":Bn(1280,720,30,120,2e3),"720p_3":Bn(1280,720,30,120,1710),"720p_5":Bn(960,720,15,120,910),"720p_6":Bn(960,720,30,120,1380),"1080p":Bn(1920,1080,15,120,2080),"1080p_1":Bn(1920,1080,15,120,2080),"1080p_2":Bn(1920,1080,30,120,3e3),"1080p_3":Bn(1920,1080,30,120,3150),"1080p_5":Bn(1920,1080,60,120,4780),"1440p":Bn(2560,1440,30,120,4850),"1440p_1":Bn(2560,1440,30,120,4850),"1440p_2":Bn(2560,1440,60,120,7350),"4k":Bn(3840,2160,30,120,8910),"4k_1":Bn(3840,2160,30,120,8910),"4k_3":Bn(3840,2160,60,120,13500)},Jme={"480p":Mu(640,480,5),"480p_1":Mu(640,480,5),"480p_2":Mu(640,480,30),"480p_3":Mu(640,480,15),"720p":Mu(1280,720,5),"720p_auto":Bn(1280,720,30,900,3e3),"720p_1":Mu(1280,720,5),"720p_2":Mu(1280,720,30),"720p_3":Mu(1280,720,15),"1080p":Mu(1920,1080,5),"1080p_1":Mu(1920,1080,5),"1080p_2":Mu(1920,1080,30),"1080p_3":Mu(1920,1080,15)},Qme={"1SL1TL":r2(1,1),"3SL3TL":r2(3,3),"2SL3TL":r2(2,3)};function Uu(t){return t||(t="480p_1"),typeof t=="string"?Object.assign({},Xme[t]):t}function i2(t){return typeof t=="string"?Object.assign({},Jme[t]):t}function bP(t){return typeof t=="string"?Object.assign({},Qme[t]):t}const Zme={speech_low_quality:$v(16e3,!1),speech_standard:$v(32e3,!1,18),music_standard:$v(48e3,!1),standard_stereo:$v(48e3,!0,56),high_quality:$v(48e3,!1,128),high_quality_stereo:$v(48e3,!0,192)};function wP(t){return typeof t=="string"?Object.assign({},Zme[t]):t}const Kv=[];function zW(t){return Yi(t,"mediaSource",["screen","window","application"]),!0}let Tt=function(t){return t.NEED_RENEGOTIATE="@need_renegotiate",t.NEED_REPLACE_TRACK="@need_replace_track",t.NEED_REPLACE_MIXING_TRACK="@need_replace_mixing_track",t.NEED_CLOSE="@need_close",t.NEED_ENABLE_TRACK="@need_enable_track",t.NEED_DISABLE_TRACK="@need_disable_track",t.NEED_SESSION_ID="@need_sid",t.SET_OPTIMIZATION_MODE="@set_optimization_mode",t.GET_STATS="@get_stats",t.GET_RTC_STATS="@get_rtc_stats",t.GET_LOW_VIDEO_TRACK="@get_low_video_track",t.NEED_RESET_REMOTE_SDP="@need_reset_remote_sdp",t.NEED_UPDATE_VIDEO_ENCODER="@need_update_video_encoder",t.NEED_UPDATE_VIDEO_SEND_PARAMETERS="@need_update_video_send_parameters",t.NEED_MUTE_TRACK="@need_mute_track",t.NEED_UNMUTE_TRACK="@need_unmute_track",t}({}),yr=function(t){return t.SCREEN_TRACK="screen_track",t.CUSTOM_TRACK="custome_track",t.LOW_STREAM="low_stream",t.SCREEN_LOW_TRACK="screen_low_track",t}({}),qv=function(t){return t[t.HIGH_STREAM=0]="HIGH_STREAM",t[t.LOW_STREAM=1]="LOW_STREAM",t}({}),ege=function(t){return t[t.HIGH_STREAM=0]="HIGH_STREAM",t[t.LOW_STREAM=1]="LOW_STREAM",t[t.HIGH_STREAM_LAYER1=4]="HIGH_STREAM_LAYER1",t[t.HIGH_STREAM_LAYER2=5]="HIGH_STREAM_LAYER2",t[t.HIGH_STREAM_LAYER3=6]="HIGH_STREAM_LAYER3",t[t.HIGH_STREAM_LAYER4=7]="HIGH_STREAM_LAYER4",t[t.HIGH_STREAM_LAYER5=8]="HIGH_STREAM_LAYER5",t[t.HIGH_STREAM_LAYER6=9]="HIGH_STREAM_LAYER6",t}({}),tge=function(t){return t[t.DISABLE=0]="DISABLE",t[t.LOW_STREAM=1]="LOW_STREAM",t[t.AUDIO_ONLY=2]="AUDIO_ONLY",t[t.HIGH_STREAM_LAYER1=3]="HIGH_STREAM_LAYER1",t[t.HIGH_STREAM_LAYER2=4]="HIGH_STREAM_LAYER2",t[t.HIGH_STREAM_LAYER3=5]="HIGH_STREAM_LAYER3",t[t.HIGH_STREAM_LAYER4=6]="HIGH_STREAM_LAYER4",t[t.HIGH_STREAM_LAYER5=7]="HIGH_STREAM_LAYER5",t[t.HIGH_STREAM_LAYER6=8]="HIGH_STREAM_LAYER6",t}({}),ry=function(t){return t.TRANSCEIVER_UPDATED="transceiver-updated",t.SEI_TO_SEND="sei-to-send",t.SEI_RECEIVED="sei-received",t.TRACK_UPDATED="track-updated",t}({}),Yv=function(t){return t.SOURCE_STATE_CHANGE="source-state-change",t.TRACK_ENDED="track-ended",t.BEAUTY_EFFECT_OVERLOAD="beauty-effect-overload",t.VIDEO_ELEMENT_VISIBLE_STATUS="video-element-visible-status",t.CLOSED="closed",t}({}),Wl=function(t){return t.FIRST_FRAME_DECODED="first-frame-decoded",t.VIDEO_ELEMENT_VISIBLE_STATUS="video-element-visible-status",t.VIDEO_STATE_CHANGED="video-state-changed",t.PLAY_START="play-start",t.PLAY_END="play-end",t.FIRST_FRAME_RENDER="first-frame-render",t}({}),Xv=function(t){return t.AUDIO="audio",t.VIDEO="video",t.DATA="data",t}({}),Jc=function(t){return t.AUDIO_SOURCE_STATE_CHANGE="audio_source_state_change",t.RECEIVE_TRACK_BUFFER="receive_track_buffer",t.ON_AUDIO_BUFFER="on_audio_buffer",t.UPDATE_SOURCE="update_source",t}({});(function(t){t.UPDATE_TRACK_SOURCE="update-track-source"})({});const s2={sendVolumeLevel:0,sendBitrate:0,sendBytes:0,sendPackets:0,sendPacketsLost:0,sendJitterMs:0,sendRttMs:0,currentPacketLossRate:0},o2={sendBytes:0,sendBitrate:0,sendPackets:0,sendPacketsLost:0,sendJitterMs:0,sendRttMs:0,sendResolutionHeight:0,sendResolutionWidth:0,captureResolutionHeight:0,captureResolutionWidth:0,targetSendBitrate:0,totalDuration:0,totalFreezeTime:0,currentPacketLossRate:0},WW={transportDelay:0,end2EndDelay:0,receiveBitrate:0,receiveLevel:0,receiveBytes:0,receiveDelay:0,receivePackets:0,receivePacketsLost:0,receivePacketsDiscarded:0,totalDuration:0,totalFreezeTime:0,freezeRate:0,packetLossRate:0,currentPacketLossRate:0,publishDuration:-1},nge={uplinkNetworkQuality:0,downlinkNetworkQuality:0},GW={transportDelay:0,end2EndDelay:0,receiveBitrate:0,receiveBytes:0,receiveDelay:0,receivePackets:0,receivePacketsLost:0,receiveResolutionHeight:0,receiveResolutionWidth:0,totalDuration:0,totalFreezeTime:0,freezeRate:0,packetLossRate:0,currentPacketLossRate:0,publishDuration:-1};let ea=function(t){return t.ON_TRACK="on_track",t.ON_NODE="on_node",t}({}),Qc=function(t){return t.REQUEST_UPDATE_CONSTRAINTS="request_update_constraints",t.REQUEST_CONSTRAINTS="request_constraints",t}({}),nT=function(t){return t.IDLE="IDLE",t.INITING="INITING",t.INITEND="INITEND",t}({}),iy=function(t){return t.STATE_CHANGE="state_change",t.RECORDING_DEVICE_CHANGED="recordingDeviceChanged",t.PLAYOUT_DEVICE_CHANGED="playoutDeviceChanged",t.CAMERA_DEVICE_CHANGED="cameraDeviceChanged",t}({}),Xs=function(t){return t.NONE="none",t.INIT="init",t.CANPLAY="canplay",t.PLAYING="playing",t.PAUSED="paused",t.SUSPEND="suspend",t.STALLED="stalled",t.WAITING="waiting",t.ERROR="error",t.DESTROYED="destroyed",t.ABORT="abort",t.ENDED="ended",t.EMPTIED="emptied",t.LOADEDDATA="loadeddata",t}({}),$h=function(t){return t[t.VideoStateStopped=0]="VideoStateStopped",t[t.VideoStateStarting=1]="VideoStateStarting",t[t.VideoStateDecoding=2]="VideoStateDecoding",t[t.VideoStateFrozen=3]="VideoStateFrozen",t}({});const a2={uninit:100,none:110,init:120,loadeddata:130,canplay:200,playing:210,paused:220,suspend:300,stalled:310,waiting:320,error:330,destroyed:340,abort:350,ended:360,emptied:370};let TP=function(t){return t.OPEN="open",t.MESSAGE="message",t.CLOSE="close",t.CLOSING="closing",t.ERROR="error",t}({});function Dn(t,r,s,a,c){var d,h,m={};return Object.keys(a).forEach(function(g){m[g]=a[g]}),m.enumerable=!!m.enumerable,m.configurable=!!m.configurable,("value"in m||m.initializer)&&(m.writable=!0),m=Wa(d=h_(h=s.slice()).call(h)).call(d,function(g,E){return E(t,r,g)||g},m),c&&m.initializer!==void 0&&(m.value=m.initializer?m.initializer.call(c):void 0,m.initializer=void 0),m.initializer===void 0?(Object.defineProperty(t,r,m),null):m}function Re(t,r,s){return(r=function(a){var c=function(d,h){if(typeof d!="object"||!d)return d;var m=d[Symbol.toPrimitive];if(m!==void 0){var g=m.call(d,"string");if(typeof g!="object")return g;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(d)}(a);return typeof c=="symbol"?c:c+""}(r))in t?Object.defineProperty(t,r,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[r]=s,t}function HW(t,r){var s=Object.keys(t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);r&&(a=a.filter(function(c){return Object.getOwnPropertyDescriptor(t,c).enumerable})),s.push.apply(s,a)}return s}function Ar(t){for(var r=1;r<arguments.length;r++){var s=arguments[r]!=null?arguments[r]:{};r%2?HW(Object(s),!0).forEach(function(a){Re(t,a,s[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(s)):HW(Object(s)).forEach(function(a){Object.defineProperty(t,a,Object.getOwnPropertyDescriptor(s,a))})}return t}class $W extends Jr{set _mediaStreamTrack(r){r!==this.mediaStreamTrack&&(this.safeEmit(ry.TRACK_UPDATED,r),this.mediaStreamTrack=r)}get _mediaStreamTrack(){return this.mediaStreamTrack}constructor(r,s){super(),Re(this,"trackMediaType",void 0),Re(this,"_ID",void 0),Re(this,"_rtpTransceiver",void 0),Re(this,"_lowRtpTransceiver",void 0),Re(this,"_hints",[]),Re(this,"_isClosed",!1),Re(this,"_originMediaStreamTrack",void 0),Re(this,"mediaStreamTrack",void 0),Re(this,"_external",{}),this._ID=s||vr(8,"track-"),this._originMediaStreamTrack=r,this.mediaStreamTrack=r,function(a){rt(Kv).call(Kv,a)||Kv.push(a)}(this)}toString(){return this._ID}getTrackId(){return this._ID}getMediaStreamTrack(r){return r||Wm(()=>{var s;At.reportApiInvoke(null,{name:di.GET_MEDIA_STREAM_TRACK,options:[],tag:$r.TRACER}).onSuccess(((s=this._mediaStreamTrack)===null||s===void 0?void 0:s.label)||"")},this.mediaStreamTrack.id||this.getTrackId()),this._mediaStreamTrack}getRTCRtpTransceiver(r){return r===qv.LOW_STREAM?this._lowRtpTransceiver:this._rtpTransceiver}getMediaStreamTrackSettings(){return this.getMediaStreamTrack(!0).getSettings()}close(){this._isClosed=!0,this._lowRtpTransceiver=void 0,this._rtpTransceiver=void 0,function(r){const s=Kv.indexOf(r);s!==-1&&Kv.splice(s,1)}(this),this.emit(Yv.CLOSED),this.removeAllListeners(ry.SEI_RECEIVED)}_updateRtpTransceiver(r,s){if(s===qv.LOW_STREAM){if(this._lowRtpTransceiver===r)return;this._lowRtpTransceiver=r}else{if(this._rtpTransceiver===r)return;this._rtpTransceiver=r}this.emit(ry.TRANSCEIVER_UPDATED,r,s)}}class Jv extends $W{get isExternalTrack(){return this._isExternalTrack}get muted(){return this._muted}get enabled(){return this._enabled}get processorContext(){return this._processorContext}constructor(r,s){super(r,s),Re(this,"_enabled",!0),Re(this,"_muted",!1),Re(this,"_isExternalTrack",!1),Re(this,"_isClosed",!1),Re(this,"_enabledMutex",void 0),Re(this,"processor",void 0),Re(this,"_processorContext",void 0),Re(this,"_handleTrackEnded",()=>{this.onTrackEnded()}),this._enabledMutex=new Ys("".concat(this.getTrackId())),r.addEventListener("ended",this._handleTrackEnded)}getTrackLabel(){var r,s;return(r=(s=this._originMediaStreamTrack)===null||s===void 0?void 0:s.label)!==null&&r!==void 0?r:""}close(){this._isClosed||(this.stop(),this._originMediaStreamTrack.stop(),this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack.stop(),this._mediaStreamTrack=null),this._originMediaStreamTrack=null,this._enabledMutex=null,x.debug("[".concat(this.getTrackId(),"] close")),this.emit(Tt.NEED_CLOSE),super.close())}async _updateOriginMediaStreamTrack(r,s){let a=arguments.length>2&&arguments[2]!==void 0&&arguments[2];this._isExternalTrack=a,r!==this._originMediaStreamTrack&&(this._originMediaStreamTrack&&(this._originMediaStreamTrack.removeEventListener("ended",this._handleTrackEnded),s&&this._originMediaStreamTrack.stop()),r.addEventListener("ended",this._handleTrackEnded),this._originMediaStreamTrack=r,this._muted&&(this._originMediaStreamTrack.enabled=!1),this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource(),await Er(this,Tt.NEED_REPLACE_TRACK,this),this.processor&&this._processorContext&&this.processor.updateInput({track:this._originMediaStreamTrack,context:this._processorContext}))}_getDefaultPlayerConfig(){return{}}onTrackEnded(){x.debug("[".concat(this.getTrackId(),"] track ended")),this.safeEmit(Yv.TRACK_ENDED)}stateCheck(r,s){if(x.debug("check track state, [muted: ".concat(this._muted,", enabled: ").concat(this._enabled,"] to [").concat(r,": ").concat(s,"]")),Bd(s,r),this._enabled&&this._muted&&r==="enabled"&&s===!1)throw new Le(te.TRACK_STATE_UNREACHABLE,"cannot set enabled while the track is muted").print("error",x);if(!this._enabled&&!this._muted&&r==="muted"&&s===!0)throw new Le(te.TRACK_STATE_UNREACHABLE,"cannot set muted while the track is disabled").print("error",x)}getProcessorStats(){return this._processorContext&&this._processorContext.gatherStats()||[]}getProcessorUsage(){return this._processorContext?this._processorContext.gatherUsage():pt.resolve([])}}const KW=window.AudioContext||window.webkitAudioContext;let Zc=null;const fr=new class extends Jr{constructor(){super(...arguments),Re(this,"prevState",void 0),Re(this,"curState",void 0),Re(this,"currentTime",void 0),Re(this,"currentTimeStuckAt",void 0),Re(this,"interruptDetectorTrack",void 0),Re(this,"onLocalAudioTrackMute",()=>{x.info("ios15-interruption-start"),this.emit(Ts.IOS_15_16_INTERRUPTION_START)}),Re(this,"onLocalAudioTrackUnmute",async()=>{x.info("ios15-interruption-end"),this.curState!=="running"||this.duringInterruption?x.info("ios15-interruption-end-canceled"):(Zc&&await Zc.suspend(),this.emit(Ts.IOS_15_16_INTERRUPTION_END))})}get duringInterruption(){return this.prevState==="running"&&this.curState==="interrupted"}bindInterruptDetectorTrack(t){x.debug("webaudio bindInterruptDetectorTrack ".concat(t.getTrackId())),this.interruptDetectorTrack||(this.interruptDetectorTrack=t,this.interruptDetectorTrack._mediaStreamTrack.onmute=this.onLocalAudioTrackMute,this.interruptDetectorTrack._mediaStreamTrack.onunmute=this.onLocalAudioTrackUnmute)}unbindInterruptDetectorTrack(t){x.debug("webaudio unbindInterruptDetectorTrack ".concat(t.getTrackId())),this.interruptDetectorTrack&&this.interruptDetectorTrack===t&&(this.interruptDetectorTrack._mediaStreamTrack&&(this.interruptDetectorTrack._mediaStreamTrack.onmute=null,this.interruptDetectorTrack._mediaStreamTrack.onunmute=null),this.interruptDetectorTrack=void 0)}};function Qv(){if(!Zc){if(function(){if(!KW)return void x.error("your browser is not support web audio");x.info("create audio context");const t=Ar({},se("WEBAUDIO_INIT_OPTIONS"));x.debug("audio context init option:",JSON.stringify(t)),Zc=new KW(t),fr.curState=Zc.state,Zc.onstatechange=()=>{fr.prevState=fr.curState,fr.curState=Zc?Zc.state:void 0;const{prevState:r,curState:s}=fr,a=s==="running",c=s==="interrupted",d=r==="running",h=r==="suspended",m=r==="interrupted",g=xn().osVersion;(fo()||xu())&&d&&c&&(x.info("ios".concat(g,"-interruption-start")),fr.emit(Ts.IOS_INTERRUPTION_START)),(fo()||xu())&&(h||m)&&a&&(x.info("ios".concat(g,"-interruption-end")),fr.emit(Ts.IOS_INTERRUPTION_END)),r!==s&&fr.emit(Ts.STATE_CHANGE,s,r)},setInterval(()=>{var r;const s=(r=Zc)===null||r===void 0?void 0:r.currentTime;fr.currentTime!==s?(fr.currentTimeStuckAt&&(x.debug("AudioContext current time resume at ".concat(s)),fr.currentTimeStuckAt=void 0),fr.currentTime=s):(s!==fr.currentTimeStuckAt&&(At.reportApiInvoke(null,{name:"WEB_AUDIO_CURRENT_TIME_STUCK",options:{currentTime:s},tag:$r.TRACER}).onSuccess(),x.warning("AudioContext current time stuck at ".concat(s))),fr.currentTimeStuckAt=s)},5e3),async function(r){const s=["click","contextmenu","auxclick","dblclick","mousedown","mouseup","touchend","keydown","keyup"];let a,c=!1,d=!1,h=!1;function m(j){r.state==="running"?g(!1):fo()||xu()?r.state==="suspended"&&(g(!0),j&&r.resume().then(E,E)):r.state!=="closed"&&(g(!0),j&&r.resume().then(E,E))}function g(j){if(c!==j){c=j;for(let B=0,ee=s;B<ee.length;B+=1){const Z=ee[B];j?window.addEventListener(Z,b,{capture:!0,passive:!0}):window.removeEventListener(Z,b,{capture:!0,passive:!0})}}}function E(){m(!1)}function b(){m(!0)}function I(j){if(!h)if(a.paused)if(j){let B;A(!1),h=!0;try{B=a.play(),B?B.then(k,k):(a.addEventListener("playing",k),a.addEventListener("abort",k),a.addEventListener("error",k))}catch{k()}}else A(!0);else A(!1)}function A(j){if(d!==j){d=j;for(let B=0,ee=s;B<ee.length;B++){const Z=ee[B];j?window.addEventListener(Z,W,{capture:!0,passive:!0}):window.removeEventListener(Z,W,{capture:!0,passive:!0})}}}function k(){a.removeEventListener("playing",k),a.removeEventListener("abort",k),a.removeEventListener("error",k),h=!1,I(!1)}function W(){I(!0)}if(fo()){const j=r.createMediaStreamDestination(),B=document.createElement("div");B.innerHTML="<audio x-webkit-airplay='deny'></audio>",a=B.children.item(0),a.controls=!1,a.disableRemotePlayback=!0,a.preload="auto",a.srcObject=j.stream,I(!0)}fr.on(Ts.STATE_CHANGE,function(){m(!0)}),m(!1)}(Zc)}(),!Zc)throw new Le(te.NOT_SUPPORTED,"can not create audio context");return Zc}return Zc}function sy(t){if(function(){if(c2!==null)return c2;const a=Qv(),c=a.createBufferSource(),d=a.createGain(),h=a.createGain();c.connect(d),c.connect(h),c.disconnect(d);let m=!1;try{c.disconnect(d)}catch{m=!0}return c.disconnect(),c2=m,m}())return;const r=t.connect,s=t.disconnect;t.connect=(a,c,d)=>{var h;return t._inputNodes||(t._inputNodes=[]),rt(h=t._inputNodes).call(h,a)||(a instanceof AudioNode?(t._inputNodes.push(a),r.call(t,a,c,d)):r.call(t,a,c)),t},t.disconnect=(a,c,d)=>{s.call(t),a?pP(t._inputNodes,a):t._inputNodes=[];for(const h of t._inputNodes)r.call(t,h)}}let c2=null;function l2(t,r){let s=!1;const a=1/r;if(se("DISABLE_WEBAUDIO")){const c=window.setInterval(()=>{s?window.clearInterval(c):t(performance.now()/1e3)},1e3*a)}else{const c=Qv();let d=c.createGain();d.gain.value=0,d.connect(c.destination);const h=()=>{if(s)return void(d=null);const m=c.createOscillator();m.onended=h,m.connect(d),m.start(0),m.stop(c.currentTime+a),t(c.currentTime)};h()}return()=>{s=!0}}class qW{constructor(){Re(this,"context",void 0),Re(this,"analyserNode",void 0),Re(this,"sourceNode",void 0),this.context=Qv(),this.analyserNode=this.context.createAnalyser(),this.analyserNode.fftSize=2048,this.analyserNode.smoothingTimeConstant=.4}updateSource(r){if(r!==this.sourceNode){if(this.sourceNode)try{this.sourceNode.disconnect(this.analyserNode)}catch{}this.sourceNode=r,r==null||r.connect(this.analyserNode)}}getVolumeLevel(){if(!this.sourceNode||(!this.context||fo()||xu()||this.context.state!=="running"&&this.context.resume(),!this.analyserNode))return 0;const r=new Float32Array(this.analyserNode.fftSize);if(this.analyserNode.getFloatTimeDomainData)this.analyserNode.getFloatTimeDomainData(r);else{const a=new Uint8Array(this.analyserNode.fftSize);this.analyserNode.getByteTimeDomainData(a);for(let c=0;c<r.length;++c)r[c]=a[c]/128-1}const s=Wa(r).call(r,(a,c)=>a+c*c,0)/r.length;return Math.max(10*Math.log10(s)+100,0)/100}getAnalyserNode(){return this.analyserNode}rebuildAnalyser(){try{var r,s;(r=this.sourceNode)===null||r===void 0||r.disconnect(this.analyserNode),this.analyserNode=this.context.createAnalyser(),this.analyserNode.fftSize=2048,this.analyserNode.smoothingTimeConstant=.4,(s=this.sourceNode)===null||s===void 0||s.connect(this.analyserNode)}catch{x.warning("rebuild analyser node failed.")}}destroy(){this.updateSource(void 0)}}class YW extends Jr{get processSourceNode(){return this.sourceNode}set processedNode(r){var s;if(!this.isDestroyed&&this._processedNode!==r){try{var a;(a=this.sourceNode)===null||a===void 0||a.disconnect(this.outputNode)}catch{}(s=this._processedNode)===null||s===void 0||s.disconnect(),this._processedNode=r,this.connect()}}get processedNode(){return this._processedNode}constructor(){super(),Re(this,"outputNode",void 0),Re(this,"outputTrack",void 0),Re(this,"isPlayed",!1),Re(this,"sourceNode",void 0),Re(this,"context",void 0),Re(this,"audioBufferNode",void 0),Re(this,"destNode",void 0),Re(this,"audioOutputLevel",0),Re(this,"volumeLevelAnalyser",void 0),Re(this,"_processedNode",void 0),Re(this,"playNode",void 0),Re(this,"isDestroyed",!1),Re(this,"onNoAudioInput",void 0),Re(this,"isNoAudioInput",!1),Re(this,"_noAudioInputCount",0),this.context=Qv(),this.playNode=this.context.destination,this.outputNode=this.context.createGain(),sy(this.outputNode),this.volumeLevelAnalyser=new qW}startGetAudioBuffer(r){this.audioBufferNode||(this.audioBufferNode=this.context.createScriptProcessor(r),this.outputNode.connect(this.audioBufferNode),this.audioBufferNode.connect(this.context.destination),this.audioBufferNode.onaudioprocess=s=>{this.emit(Jc.ON_AUDIO_BUFFER,function(a){for(let c=0;c<a.outputBuffer.numberOfChannels;c+=1){const d=a.outputBuffer.getChannelData(c);for(let h=0;h<d.length;h+=1)d[h]=0}return a.inputBuffer}(s))})}stopGetAudioBuffer(){this.audioBufferNode&&(this.audioBufferNode.onaudioprocess=null,this.outputNode.disconnect(this.audioBufferNode),this.audioBufferNode=void 0)}createOutputTrack(){if(!jn().webAudioMediaStreamDest)throw new Le(te.NOT_SUPPORTED,"your browser is not support audio processor");return this.destNode&&this.outputTrack||(this.destNode=this.context.createMediaStreamDestination(),this.outputNode.connect(this.destNode),this.outputTrack=this.destNode.stream.getAudioTracks()[0]),this.outputTrack}play(r){this.context.state!=="running"&&fP(()=>{fr.emit("autoplay-failed")}),this.isPlayed=!0,this.playNode=r||this.context.destination,this.outputNode.connect(this.playNode)}stop(){if(this.isPlayed)try{this.outputNode.disconnect(this.playNode)}catch{}this.isPlayed=!1}getAccurateVolumeLevel(){return this.volumeLevelAnalyser.getVolumeLevel()}async checkHasAudioInput(){let r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;if(r>5)return this.isNoAudioInput=!0,this.onNoAudioInput&&this.onNoAudioInput(),!1;fo()||xu()?this.context.state==="suspended"&&this.context.resume():this.context.state!=="running"&&this.context.resume();const s=this.volumeLevelAnalyser.getAnalyserNode();let a;s.getFloatTimeDomainData?(a=new Float32Array(s.fftSize),s.getFloatTimeDomainData(a)):(a=new Uint8Array(s.fftSize),s.getByteTimeDomainData(a));let c=!1;for(let d=0;d<a.length;d++)a[d]!==0&&(c=!0);return c?(this.isNoAudioInput=!1,!0):(await bs(200),await this.checkHasAudioInput(r?r+1:1)&&c)}getAudioVolume(){return this.outputNode.gain.value}setVolume(r){this.outputNode.gain.setValueAtTime(r,this.context.currentTime)}destroy(){this.disconnect(),this.stop(),this.isDestroyed=!0,this.onNoAudioInput=void 0}disconnect(){var r,s;(r=this.processedNode)===null||r===void 0||r.disconnect(),(s=this.sourceNode)===null||s===void 0||s.disconnect(),this.outputNode&&this.outputNode.disconnect()}connect(){var r;this.processedNode?(r=this.processedNode)===null||r===void 0||r.connect(this.outputNode):this.sourceNode&&this.sourceNode.connect(this.outputNode),this.volumeLevelAnalyser.updateSource(this.outputNode)}}class XW extends YW{get isFreeze(){return!1}constructor(r,s,a){var c;if(super(),Re(this,"sourceNode",void 0),Re(this,"track",void 0),Re(this,"clonedTrack",void 0),Re(this,"audioElement",void 0),Re(this,"isCurrentTrackCloned",!1),Re(this,"isRemoteTrack",!1),Re(this,"originVolumeLevelAnalyser",void 0),Re(this,"rebuildWebAudio",async()=>{if(x.debug("ready to rebuild web audio, state:",this.context.state),this.isNoAudioInput&&await this.checkHasAudioInput(),!this.isNoAudioInput||this.isDestroyed)return document.body.removeEventListener("click",this.rebuildWebAudio,!0),void x.debug("rebuild web audio success, current volume status",this.getAccurateVolumeLevel());this.context.resume().then(()=>x.info("resume success")),x.debug("rebuild web audio because of ios 12 bugs"),this.disconnect();const m=this.track;this.track=this.track.clone(),this.isCurrentTrackCloned?m.stop():this.isCurrentTrackCloned=!0;const g=new MediaStream([this.track]);this.sourceNode=this.context.createMediaStreamSource(g),sy(this.sourceNode),this.volumeLevelAnalyser.rebuildAnalyser();const E=this.outputNode.gain.value;this.outputNode=this.context.createGain(),this.outputNode.gain.setValueAtTime(E,this.context.currentTime),sy(this.outputNode),this.emit(Jc.UPDATE_SOURCE),this.connect(),this.audioElement.srcObject=g,this.isPlayed&&this.play(this.playNode),this.checkHasAudioInput()}),r.kind!=="audio")throw new Le(te.UNEXPECTED_ERROR);this.track=r;const d=new MediaStream([this.track]);if(this.isRemoteTrack=!!s,this.sourceNode=this.context.createMediaStreamSource(d),sy(this.sourceNode),a){const m=a.clone();m.enabled=!0,this.clonedTrack=m,x.debug("create an unmuted track ".concat(m.id," from the original track ").concat(a.id," to get the volume"));const g=this.context.createMediaStreamSource(new MediaStream([m]));sy(g),this.originVolumeLevelAnalyser=new qW,this.originVolumeLevelAnalyser.updateSource(g)}this.connect(),this.audioElement=document.createElement("audio"),this.audioElement.srcObject=d;const h=xn();s&&h.os===is.IOS&&Number((c=h.osVersion)===null||c===void 0?void 0:c.split(".")[0])<15&&(fr.on(Ts.STATE_CHANGE,()=>{this.context.state==="suspended"?document.body.addEventListener("click",this.rebuildWebAudio,!0):this.context.state==="running"&&this.rebuildWebAudio()}),this.checkHasAudioInput().then(m=>{m||document.body.addEventListener("click",this.rebuildWebAudio,!0)}))}updateTrack(r){this.sourceNode.disconnect(),this.track=r,this.isCurrentTrackCloned=!1;const s=new MediaStream([r]);this.sourceNode=this.context.createMediaStreamSource(s),sy(this.sourceNode),this.processedNode||this.sourceNode.connect(this.outputNode),this.emit(Jc.UPDATE_SOURCE),this.audioElement.srcObject=s}destroy(){var r;this.audioElement.srcObject=null,this.audioElement.remove(),fr.off("state-change",this.rebuildWebAudio),(r=this.originVolumeLevelAnalyser)===null||r===void 0||r.destroy(),this.clonedTrack=void 0,super.destroy()}createMediaStreamSourceNode(r){return this.context.createMediaStreamSource(new MediaStream([r]))}updateOriginTrack(r){const s=r.clone();s.enabled=!0,this.clonedTrack&&(this.clonedTrack.stop(),this.clonedTrack=s),x.debug("create an unmuted track ".concat(s.id," from the original track ").concat(r.id," to get the volume"));const a=this.context.createMediaStreamSource(new MediaStream([s]));sy(a),this.originVolumeLevelAnalyser&&this.originVolumeLevelAnalyser.updateSource(a)}getOriginVolumeLevel(){return this.originVolumeLevelAnalyser?this.originVolumeLevelAnalyser.getVolumeLevel():this.getAccurateVolumeLevel()}}async function JW(t,r,s){const a=(d,h)=>d?typeof d!="number"?d.max||d.exact||d.ideal||d.min||h:d:h,c={audio:!!s&&{mandatory:{chromeMediaSource:"desktop"}},video:{mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:t,maxHeight:a(r.height,1080),maxWidth:a(r.width,1920)}}};return r.frameRate&&typeof r.frameRate!="number"?(c.video.mandatory.maxFrameRate=r.frameRate.max,c.video.mandatory.minFrameRate=r.frameRate.min):typeof r.frameRate=="number"&&(c.video.mandatory.maxFrameRate=r.frameRate),await navigator.mediaDevices.getUserMedia(c)}async function rge(t,r){const s=await QW(t.mediaSource),{sourceId:a,audio:c}=await function(d){let h=arguments.length>1&&arguments[1]!==void 0&&arguments[1];return new pt((m,g)=>{const E=document.createElement("div");E.innerText="share screen",E.setAttribute("style","text-align: center; height: 25px; line-height: 25px; border-radius: 4px 4px 0 0; background: #D4D2D4; border-bottom:  solid 1px #B9B8B9;");const b=document.createElement("div");b.setAttribute("style","width: 100%; height: 500px; padding: 15px 25px ; box-sizing: border-box;");const I=document.createElement("div");I.innerText="Agora Web Screensharing wants to share the contents of your screen with webdemo.agorabeckon.com. Choose what you'd like to share.",I.setAttribute("style","height: 12%;");const A=document.createElement("div");A.setAttribute("style","width: 100%; height: 80%; background: #FFF; border:  solid 1px #CBCBCB; display: flex; flex-wrap: wrap; justify-content: space-around; overflow-y: scroll; padding: 0 15px; box-sizing: border-box;");const k=document.createElement("div");k.setAttribute("style","display: flex; justify-content: space-between; padding: 16px 0;");const W=document.createElement("button");W.innerHTML="cancel",W.setAttribute("style","width: 85px;"),W.onclick=()=>{document.body.removeChild(ee);const Z=new Error("NotAllowedError");Z.name="NotAllowedError",g(Z)};let j=h;const B=document.createElement("div");if(h){const Z=document.createElement("input");Z.setAttribute("type","checkbox");const oe=document.createElement("span");Z.setAttribute("style","margin-right: 6px;"),oe.innerText="Share audio",Z.checked=j,Z.onchange=()=>{j=Z.checked},B.appendChild(Z),B.appendChild(oe)}k.appendChild(B),k.appendChild(W),b.appendChild(I),b.appendChild(A),b.appendChild(k);const ee=document.createElement("div");ee.setAttribute("style","position: fixed; z-index: 99999999; top: 50%; left: 50%; width: 620px; height: 525px; background: #ECECEC; border-radius: 4px; -webkit-transform: translate(-50%,-50%); transform: translate(-50%,-50%);"),ee.appendChild(E),ee.appendChild(b),document.body.appendChild(ee),d.map(Z=>{if(Z.id){const oe=document.createElement("div");oe.setAttribute("style","width: 30%; height: 160px; padding: 20px 0; text-align: center;box-sizing: content-box;");let ye=Z.thumbnail;try{const{width:_e}=ye.getSize();_e>1920&&(ye=ye.resize({width:1920}))}catch(_e){throw _e&&_e.message.startsWith("Illegal invocation")&&console.error("Operate thumbnail error, please try to set contextIsolation: false. (https://github.com/electron/electron/issues/34953)"),_e}oe.innerHTML='<div style="height: 120px; display: table-cell; vertical-align: middle;"><img style="width: 100%; background: #333333; box-shadow: 1px 1px 1px 1px rgba(0, 0, 0, 0.2);" src='+ye.toDataURL()+' /></div><span style="	height: 40px; line-height: 40px; display: inline-block; width: 70%; word-break: keep-all; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;">'+Z.name.replace(/[\u00A0-\u9999<>\&]/g,function(_e){return"&#"+_e.charCodeAt(0)+";"})+"</span>",oe.onclick=()=>{document.body.removeChild(ee),m({sourceId:Z.id,audio:j})},A.appendChild(oe)}})})}(s,r);return await JW(a,t,c)}async function QW(t){let r=["window","screen"];t!=="application"&&t!=="window"||(r=["window"]),t==="screen"&&(r=["screen"]);const s=uW();if(!s)throw console.error("failed to fetch electron, please mount it to window"),new Le(te.ELECTRON_IS_NULL);let a=null;try{var c;a=((c=s.desktopCapturer)===null||c===void 0?void 0:c.getSources({types:r}))||s.ipcRenderer.invoke("DESKTOP_CAPTURER_GET_SOURCES",{types:r})}catch{a=null}a&&a.then||(a=new pt((d,h)=>{s.desktopCapturer.getSources({types:r},(m,g)=>{m?h(m):d(g)})}));try{return await a}catch(d){throw new Le(te.ELECTRON_DESKTOP_CAPTURER_GET_SOURCES_ERROR,d.toString())}}const u2=new Ys("safari");let ZW=!1,e9=!1;async function el(t,r){let s=0,a=null;for(;s<2;)try{a=await ige(t,r,s>0);break}catch(c){if(c instanceof Le)throw x.error("[".concat(r,"] ").concat(c.toString())),c;const d=CP(c.name||c.code||c,c.message);if(d.code===te.MEDIA_OPTION_INVALID){x.debug("[".concat(r,"] detect media option invalid, retry")),s+=1,await bs(500);continue}throw x.error("[".concat(r,"] ").concat(d.toString())),d}if(!a)throw new Le(te.UNEXPECTED_ERROR,"can not find stream after getUserMedia");return a}async function ige(t,r,s){if(!navigator.mediaDevices||!navigator.mediaDevices.getUserMedia)throw new Le(te.NOT_SUPPORTED,"can not find getUserMedia");s&&(t.video&&(delete t.video.width,delete t.video.height),t.screen&&(delete t.screen.width,delete t.screen.height));const a=jn(),c=new MediaStream;if(t.audioSource&&c.addTrack(t.audioSource),t.videoSource&&c.addTrack(t.videoSource),!t.audio&&!t.video&&!t.screen)return x.debug("Using Video Source/ Audio Source"),c;if(t.screen)if(uW())t.screen.sourceId?Zv(c,await JW(t.screen.sourceId,t.screen,!!t.screenAudio)):Zv(c,await rge(t.screen,!!t.screenAudio));else if(cf()&&t.screen.extensionId&&t.screen.mandatory){if(!a.getStreamFromExtension)throw new Le(te.NOT_SUPPORTED,"This browser does not support screen sharing");x.debug("[".concat(r,'] Screen access on chrome stable, looking for extension"'));const A=await(h=t.screen.extensionId,m=r,new pt((k,W)=>{try{chrome.runtime.sendMessage(h,{getStream:!0},j=>{if(!j||!j.streamId)return x.error("[".concat(m,"] No response from Chrome Plugin. Plugin not installed properly"),j),void W(new Le(te.CHROME_PLUGIN_NO_RESPONSE,"No response from Chrome Plugin. Plugin not installed properly"));k(j.streamId)})}catch(j){x.error("[".concat(m,"] AgoraRTC screensharing plugin is not accessible(").concat(h,")"),j.toString()),W(new Le(te.CHROME_PLUGIN_NOT_INSTALL))}}));t.screen.mandatory.chromeMediaSourceId=A,Zv(c,await navigator.mediaDevices.getUserMedia({video:{mandatory:t.screen.mandatory}}))}else if(a.getDisplayMedia){var d;t.screen.mediaSource&&zW(t.screen.mediaSource);const A={width:t.screen.width,height:t.screen.height,frameRate:t.screen.frameRate,displaySurface:(d=t.screen.displaySurface)!==null&&d!==void 0?d:t.screen.mediaSource==="screen"?"monitor":t.screen.mediaSource},{selfBrowserSurface:k,surfaceSwitching:W,systemAudio:j,preferCurrentTab:B}=t.screen,ee={selfBrowserSurface:k,surfaceSwitching:W,systemAudio:j,preferCurrentTab:B};!k&&delete ee.selfBrowserSurface,!W&&delete ee.surfaceSwitching,!j&&delete ee.systemAudio,!B&&delete ee.preferCurrentTab,x.debug("[".concat(r,"] getDisplayMedia:"),JSON.stringify({video:A,audio:t.screenAudio,controls:ee})),Zv(c,await navigator.mediaDevices.getDisplayMedia(Ar({video:A,audio:t.screenAudio},ee)))}else{if(!ni())throw x.error("[".concat(r,"] This browser does not support screenSharing")),new Le(te.NOT_SUPPORTED,"This browser does not support screen sharing");{t.screen.mediaSource&&zW(t.screen.mediaSource);const A={video:{mediaSource:t.screen.mediaSource,width:t.screen.width,height:t.screen.height,frameRate:t.screen.frameRate}};x.debug("[".concat(r,"] getUserMedia: ").concat(JSON.stringify(A))),Zv(c,await navigator.mediaDevices.getUserMedia(A))}}var h,m;if(!t.video&&!t.audio)return c;let g={video:t.video,audio:t.audio},E=se("MEDIA_DEVICE_CONSTRAINTS");if(E)try{typeof E=="string"&&(E=JSON.parse(E)),g=jL(g,E)}catch{}x.debug("[".concat(r,"] GetUserMedia"),JSON.stringify(g)),xn();let b,I=null;(xs()||fo()||dP())&&(I=await u2.lock());try{b=await navigator.mediaDevices.getUserMedia(g)}catch(A){throw I&&I(),A}return g.audio&&(ZW=!0),g.video&&(e9=!0),Zv(c,b),I&&I(),c}function CP(t,r){switch(t){case"Starting video failed":case"OverconstrainedError":case"TrackStartError":return new Le(te.MEDIA_OPTION_INVALID,"".concat(t,": ").concat(r));case"NotFoundError":case"DevicesNotFoundError":return new Le(te.DEVICE_NOT_FOUND,"".concat(t,": ").concat(r));case"NotSupportedError":return new Le(te.NOT_SUPPORTED,"".concat(t,": ").concat(r));case"NotReadableError":return new Le(te.NOT_READABLE,"".concat(t,": ").concat(r));case"InvalidStateError":case"NotAllowedError":case"PERMISSION_DENIED":case"PermissionDeniedError":return new Le(te.PERMISSION_DENIED,"".concat(t,": ").concat(r));case"ConstraintNotSatisfiedError":return new Le(te.CONSTRAINT_NOT_SATISFIED,"".concat(t,": ").concat(r));default:return x.error("getUserMedia unexpected error",t),new Le(te.UNEXPECTED_ERROR,"".concat(t,": ").concat(r))}}function Zv(t,r){const s=t.getVideoTracks()[0],a=t.getAudioTracks()[0],c=r.getVideoTracks()[0],d=r.getAudioTracks()[0];d&&(a&&t.removeTrack(a),t.addTrack(d)),c&&(s&&t.removeTrack(s),t.addTrack(c))}const tl=new class extends Jr{get state(){return this._state}set state(t){t!==this._state&&(this.emit(iy.STATE_CHANGE,t),this._state=t)}constructor(){super(),Re(this,"_state",nT.IDLE),Re(this,"isAccessMicrophonePermission",!1),Re(this,"isAccessCameraPermission",!1),Re(this,"lastAccessMicrophonePermission",!1),Re(this,"lastAccessCameraPermission",!1),Re(this,"checkdeviceMatched",!1),Re(this,"deviceInfoMap",new Map),this.init().then(()=>{navigator.mediaDevices.addEventListener&&navigator.mediaDevices.addEventListener("devicechange",this.updateDevicesInfo.bind(this)),window.setInterval(()=>{(se("ENUMERATE_DEVICES_INTERVAL")||(hP()||uP()===is.HARMONY_OS)&&lf())&&this.updateDevicesInfo()},se("ENUMERATE_DEVICES_INTERVAL_TIME"))}).catch(t=>x.error(t.toString()))}async enumerateDevices(t,r){let s=arguments.length>2&&arguments[2]!==void 0&&arguments[2];if(!navigator.mediaDevices||!navigator.mediaDevices.enumerateDevices)return new Le(te.NOT_SUPPORTED,"enumerateDevices() not supported.").throw();const a=await navigator.mediaDevices.enumerateDevices(),c=this.checkMediaDeviceInfoIsOk(a);let d=!this.isAccessMicrophonePermission&&t,h=!this.isAccessCameraPermission&&r;c.audio&&(d=!1),c.video&&(h=!1);let m=null,g=null,E=null;if(!s&&(d||h)){if(u2.isLocked&&(x.debug("[device manager] wait GUM lock"),(await u2.lock())(),x.debug("[device manager] GUM unlock")),ZW&&(d=!1,this.isAccessMicrophonePermission=!0),e9&&(h=!1,this.isAccessCameraPermission=!0),x.debug("[device manager] check media device permissions",t,r,d,h),d&&h){try{E=await navigator.mediaDevices.getUserMedia({audio:!0,video:!0})}catch(b){const I=CP(b.name||b.code||b,b.message);if(I.code===te.PERMISSION_DENIED)throw I;x.warning("getUserMedia failed in getDevices",I)}this.isAccessCameraPermission=!0,this.isAccessMicrophonePermission=!0}else if(d){try{m=await navigator.mediaDevices.getUserMedia({audio:t})}catch(b){const I=CP(b.name||b.code||b,b.message);if(I.code===te.PERMISSION_DENIED)throw I;x.warning("getUserMedia failed in getDevices",I)}this.isAccessMicrophonePermission=!0}else if(h){try{g=await navigator.mediaDevices.getUserMedia({video:r})}catch(b){const I=CP(b.name||b.code||b,b.message);if(I.code===te.PERMISSION_DENIED)throw I;x.warning("getUserMedia failed in getDevices",I)}this.isAccessCameraPermission=!0}x.debug("[device manager] mic permission",t,"cam permission",r)}try{const b=await navigator.mediaDevices.enumerateDevices();return m&&m.getTracks().forEach(I=>I.stop()),g&&g.getTracks().forEach(I=>I.stop()),E&&E.getTracks().forEach(I=>I.stop()),m=null,g=null,E=null,b}catch(b){return m&&m.getTracks().forEach(I=>I.stop()),g&&g.getTracks().forEach(I=>I.stop()),E&&E.getTracks().forEach(I=>I.stop()),m=null,g=null,E=null,new Le(te.ENUMERATE_DEVICES_FAILED,b.toString()).throw()}}async getRecordingDevices(){let t=arguments.length>0&&arguments[0]!==void 0&&arguments[0];return(await this.enumerateDevices(!0,!1,t)).filter(r=>r.kind==="audioinput")}async getCamerasDevices(){let t=arguments.length>0&&arguments[0]!==void 0&&arguments[0];return(await this.enumerateDevices(!1,!0,t)).filter(r=>r.kind==="videoinput")}async getSpeakers(){let t=arguments.length>0&&arguments[0]!==void 0&&arguments[0];return(await this.enumerateDevices(!0,!1,t)).filter(r=>r.kind==="audiooutput")}searchDeviceIdByName(t){let r=null;return this.deviceInfoMap.forEach(s=>{s.device.label===t&&(r=s.device.deviceId)}),r}async getDeviceById(t){const r=(await this.enumerateDevices(!0,!0,!0)).find(s=>s.deviceId===t);if(!r)throw new Le(te.DEVICE_NOT_FOUND,"deviceId: ".concat(t));return r}async init(){this.state=nT.INITING;try{await this.updateDevicesInfo(),this.state=nT.INITEND}catch(t){throw x.warning("Device Detection functionality cannot start properly.",t.toString()),this.state=nT.IDLE,(typeof isSecureContext=="boolean"?isSecureContext:location.protocol==="https:"||location.protocol==="file:"||location.hostname==="localhost"||location.hostname==="127.0.0.1"||location.hostname==="::1")||new Le(te.WEB_SECURITY_RESTRICT,"Your context is limited by web security, please try using https protocol or localhost.").throw(),t}}async updateDevicesInfo(){const t=await this.enumerateDevices(!0,!0,!0),r=Date.now(),s=[];if(t[0]&&t[0].label&&this.checkdeviceMatched===!1){this.checkdeviceMatched=!0;const c=t.find(h=>h.kind==="audioinput"&&h.deviceId==="default"),d=t.find(h=>h.kind==="audiooutput"&&h.deviceId==="default");c&&d?d.groupId===c.groupId?x.debug("[device-check] default input ".concat(c.label," and output ").concat(d.label," is the same group")):x.debug("[device-check] default input ".concat(c.label," and output ").concat(d.label," is not the same group")):x.debug("[device-check] default input or output not found")}const a=this.checkMediaDeviceInfoIsOk(t);if(t.forEach(c=>{if(!c.deviceId)return;const d=this.deviceInfoMap.get("".concat(c.kind,"_").concat(c.deviceId));if((d?d.state:"INACTIVE")!=="ACTIVE"){const h={initAt:r,updateAt:r,device:c,state:"ACTIVE"};this.deviceInfoMap.set("".concat(c.kind,"_").concat(c.deviceId),h),s.push(h)}d&&(d.updateAt=r)}),this.deviceInfoMap.forEach((c,d)=>{c.state==="ACTIVE"&&c.updateAt!==r&&(c.state="INACTIVE",s.push(c))}),this.state!==nT.INITEND)return a.audio&&(this.lastAccessMicrophonePermission=!0,this.isAccessMicrophonePermission=!0),void(a.video&&(this.lastAccessCameraPermission=!0,this.isAccessCameraPermission=!0));s.forEach(c=>{switch(c.device.kind){case"audioinput":this.lastAccessMicrophonePermission&&this.isAccessMicrophonePermission&&this.emit(iy.RECORDING_DEVICE_CHANGED,c);break;case"videoinput":this.lastAccessCameraPermission&&this.isAccessCameraPermission&&this.emit(iy.CAMERA_DEVICE_CHANGED,c);break;case"audiooutput":this.lastAccessMicrophonePermission&&this.isAccessMicrophonePermission&&this.emit(iy.PLAYOUT_DEVICE_CHANGED,c)}}),a.audio&&(this.lastAccessMicrophonePermission=!0,this.isAccessMicrophonePermission=!0),a.video&&(this.lastAccessCameraPermission=!0,this.isAccessCameraPermission=!0)}checkMediaDeviceInfoIsOk(t){const r=t.filter(c=>c.kind==="audioinput"),s=t.filter(c=>c.kind==="videoinput"),a={audio:!1,video:!1};for(const c of r)if(c.label&&c.deviceId){a.audio=!0;break}for(const c of s)if(c.label&&c.deviceId){a.video=!0;break}return a}};let d2=!1;const nl=new class extends Jr{constructor(){super(...arguments),Re(this,"onAutoplayFailed",void 0),Re(this,"onAudioAutoplayFailed",void 0)}};function t9(){if(xn(),!d2){const t=r=>{r.preventDefault(),d2=!1,$w()?document.body.removeEventListener("click",t,!0):(document.body.removeEventListener("touchstart",t,!0),document.body.removeEventListener("mousedown",t,!0))};d2=!0,$w()?document.body.addEventListener("click",t,!0):(document.body.addEventListener("touchstart",t,!0),document.body.addEventListener("mousedown",t,!0)),x.info("detect media autoplay failed, document: https://docs.agora.io/cn/Voice/autoplay_policy_web_ng?platform=Web"),nl.onAutoplayFailed?nl.onAutoplayFailed():nl.onAudioAutoplayFailed?x.warning(`AgoraRTC.onAudioAutoplayFailed has been deprecated in favor of AgoraRTC.onAutoplayFailed.

  Please refer to the Agora document to migrate the newer API, https://docs.agora.io/en/Voice/autoplay_policy_web_ng?platform=Web .`):x.warning(`We have detected a media autoplay failed event, and found out that you haven't implemented AgoraRTC.onAutoplayFailed callback yet.

  It will cause audio/video element not playing automatically on some browsers without user interaction, possibly hurting user experiences.

  Please refer to the Agora document to properly handle autoplay failed event, https://docs.agora.io/en/Voice/autoplay_policy_web_ng?platform=Web .`),nl.emit("autoplay-failed")}}function n9(t,r,s,a){if(!t)return;const c=At.getBaseInfoBySessionId(t);if(!c)return;const d=c.info,h=Date.now(),m=Ar(Ar({},d),{},{vid:d.vid===void 0?0:Number(d.vid),lts:h,elapse:h-c.startTime,cbRegistered:nl.onAutoplayFailed||nl.onAudioAutoplayFailed?1:-1,errorMsg:s,mediaType:r,trackId:a,extend:void 0});At.send({type:Wr.AUTOPLAY_FAILED,data:m},!0)}const sge=["play","playing","loadeddata","canplay","pause","stalled","suspend","waiting","abort","emptied","ended","error"],ba=new class{constructor(){Re(this,"onAutoplayFailed",void 0),Re(this,"elementMap",new Map),Re(this,"elementStateMap",new Map),Re(this,"elementsNeedToResume",[]),Re(this,"sinkIdMap",new Map),Re(this,"autoResumeAfterInterruption",t=>{Array.from(this.elementMap.entries()).forEach(r=>{let[s,a]=r;const c=this.elementStateMap.get(s),d=a.srcObject.getAudioTracks()[0],h=d&&d.readyState;if(x.debug("resume after interrupted, ele: ".concat(c," audio: ").concat(h," ").concat(t)),h==="live"){if(t)return a.pause(),void a.play();if(fr.curState==="running")return Fv()?(a.pause(),void a.play()):void(c&&c==="paused"&&a.play())}})}),Re(this,"autoResumeAfterInterruptionOnIOS15_16",()=>{Array.from(this.elementMap.entries()).forEach(t=>{let[r,s]=t;const a=s.srcObject.getAudioTracks()[0];a&&a.readyState==="live"&&(x.debug("auto resume after interruption inside autoResumeAfterInterruptionOnIOS15"),s.pause(),s.play())})}),this.autoResumeAudioElement(),fr.on(Ts.IOS_INTERRUPTION_END,this.autoResumeAfterInterruption),fr.on(Ts.IOS_15_16_INTERRUPTION_END,this.autoResumeAfterInterruptionOnIOS15_16),fr.on(Ts.STATE_CHANGE,()=>{fo()&&fr.prevState==="suspended"&&fr.curState==="running"&&this.autoResumeAfterInterruption()})}async setSinkID(t,r){const s=this.elementMap.get(t);if(this.sinkIdMap.set(t,r),s)try{await s.setSinkId(r)}catch(a){throw new Le(te.PERMISSION_DENIED,"can not set sink id: "+a.toString())}}play(t,r,s,a){if(this.elementMap.has(r))return;const c=document.createElement("audio");c.autoplay=!0,c.srcObject=new MediaStream([t]),this.bindAudioElementEvents(r,c),this.elementMap.set(r,c),this.elementStateMap.set(r,Xs.INIT),this.setVolume(r,s);const d=this.sinkIdMap.get(r);if(d)try{c.setSinkId(d).catch(m=>{x.warning("[".concat(r,"] set sink id failed"),m.toString())})}catch(m){x.warning("[".concat(r,"] set sink id failed"),m.toString())}const h=c.play();h&&h.then&&h.catch(m=>{a&&n9(a,"audio",m.message,r),x.warning("audio element play warning",m.toString()),this.elementMap.has(r)&&m.name==="NotAllowedError"&&(x.warning("detected audio element autoplay failed"),this.elementsNeedToResume.push(c),fP(()=>{this.onAutoplayFailed&&this.onAutoplayFailed(),t9()}))})}updateTrack(t,r){const s=this.elementMap.get(t);s&&(s.srcObject=new MediaStream([r]))}isPlaying(t){return this.elementMap.has(t)&&this.elementStateMap.get(t)==="playing"}setVolume(t,r){const s=this.elementMap.get(t);s&&(r=Math.max(0,Math.min(100,r)),s.volume=r/100)}stop(t){const r=this.elementMap.get(t);if(this.sinkIdMap.delete(t),!r)return;const s=this.elementsNeedToResume.indexOf(r);this.elementsNeedToResume.splice(s,1),r.srcObject=null,r.remove(),this.elementMap.delete(t),this.elementStateMap.delete(t)}bindAudioElementEvents(t,r){sge.forEach(s=>{r.addEventListener(s,a=>{const c=this.elementStateMap.get(t),d=a.type==="pause"?"paused":a.type;if(x.debug("[".concat(t,"] audio-element-status change ").concat(c," => ").concat(d)),a.type==="error"){const h=r==null?void 0:r.error;h&&x.error("[".concat(t,"] media error, code: ").concat(h.code,", message: ").concat(h.message))}this.elementStateMap.set(t,d)})})}getPlayerState(t){return this.elementStateMap.get(t)||"uninit"}autoResumeAudioElement(){const t=()=>{this.elementsNeedToResume.forEach(r=>{r.play().then(s=>{x.debug("Auto resume audio element success")}).catch(s=>{x.warning("Auto resume audio element failed!",s)})}),this.elementsNeedToResume=[]};new pt(r=>{document.body?r():window.addEventListener("load",()=>r())}).then(()=>{$w()?document.body.addEventListener("click",t,!0):(document.body.addEventListener("touchstart",t,!0),document.body.addEventListener("mousedown",t,!0))})}};function ai(){return function(t,r,s){const a=s.value;return typeof a=="function"&&(s.value=function(){this._isClosed&&new Le(te.INVALID_OPERATION,"[".concat(this.getTrackId(),"] cannot operate a closed track")).print("warning",x);for(var c=arguments.length,d=new Array(c),h=0;h<c;h++)d[h]=arguments[h];const m=a.apply(this,d);return m instanceof pt?new pt((g,E)=>{m.then(g).catch(E)}):m}),s}}class r9 extends Jr{constructor(r){super(),Re(this,"name","VideoProcessorDestination"),Re(this,"ID","0"),Re(this,"_source",void 0),Re(this,"videoContext",void 0),Re(this,"inputTrack",void 0),this.videoContext=r}get kind(){return"video"}get enabled(){return!0}pipe(){throw new Le(te.NOT_SUPPORTED,"VideoProcessor cannot pipe to any other Processor")}unpipe(){throw new Le(te.NOT_SUPPORTED,"VideoProcessor cannot unpipe to any other Processor")}enable(){}disable(){}updateInput(r){if(r.context!==this.videoContext)throw new Error(`ProcessorContext passed to VideoTrack.processorDestination doesn't match it's belonging VideoTrack's context.
Probably you are making pipeline like this:
videoTrack1.pipe(processor).pipe(videoTrack2.processorDestination).`);r.track&&r.track!==this.inputTrack&&(this.videoContext.chained=!0,this.inputTrack=r.track,this.emit(ea.ON_TRACK,r.track))}reset(){this.inputTrack=void 0,this.videoContext.chained=!1,this.emit(ea.ON_TRACK,void 0)}}class i9 extends Jr{set chained(r){this._chained=r}get chained(){return this._chained}constructor(r,s){super(),Re(this,"constraintsMap",new Map),Re(this,"statsRegistry",[]),Re(this,"usageRegistry",[]),Re(this,"trackId",void 0),Re(this,"direction",void 0),Re(this,"_chained",!1),this.trackId=r,this.direction=s}async getConstraints(){return await Ms(this,Qc.REQUEST_CONSTRAINTS)}async requestApplyConstraints(r,s){var a;return x.info("processor ".concat(s.name," requestApplyConstraints for ").concat(this.trackId)),r&&this.constraintsMap.set(s,r),Er(this,Qc.REQUEST_UPDATE_CONSTRAINTS,Array.from(Sc(a=this.constraintsMap).call(a)))}async requestRevertConstraints(r){var s;if(this.constraintsMap.has(r))return x.info("processor ".concat(r.name," requestRevertConstraints for ").concat(this.trackId)),this.constraintsMap.delete(r),Er(this,Qc.REQUEST_UPDATE_CONSTRAINTS,Array.from(Sc(s=this.constraintsMap).call(s)))}registerStats(r,s,a){this.statsRegistry.find(c=>c.processorID===r.ID&&c.processorName===r.name&&c.type===s)||this.statsRegistry.push({processorName:r.name,processorID:r.ID,type:s,cb:a})}unregisterStats(r,s){const a=this.statsRegistry.findIndex(c=>c.processorID===r.ID&&c.processorName===r.name&&c.type===s);a!==-1&&this.statsRegistry.splice(a,1)}gatherStats(){const r=[];for(const{processorID:s,processorName:a,type:c,cb:d}of this.statsRegistry)try{const h=d();r.push({processorID:s,processorName:a,type:c,stats:h})}catch(h){x.error(new Le(te.UNEXPECTED_ERROR,h.message))}return r}registerUsage(r,s){this.usageRegistry.find(a=>a.processorID===r.ID&&a.processorName===r.name)||this.usageRegistry.push({processorID:r.ID,processorName:r.name,cb:s})}unregisterUsage(r){const s=this.usageRegistry.findIndex(a=>a.processorID===r.ID&&a.processorName===r.name);s!==-1&&this.usageRegistry.splice(s,1)}async gatherUsage(){const r=[];if(!this.chained)return[];for(const{cb:s}of this.usageRegistry)try{let a=s();a instanceof pt&&(a=await a),r.push(Ar(Ar({},a),{},{direction:this.direction}))}catch(a){x.error("gather extension usage error",a)}return r}getDirection(){return this.direction}}class s9 extends Jr{constructor(r){super(),Re(this,"name","AudioProcessorDestination"),Re(this,"ID","0"),Re(this,"inputTrack",void 0),Re(this,"inputNode",void 0),Re(this,"audioProcessorContext",void 0),Re(this,"_source",void 0),this.audioProcessorContext=r}get kind(){return"audio"}get enabled(){return!0}pipe(){throw new Le(te.NOT_SUPPORTED,"AudioProcessorDestination cannot pipe to any other Processor")}unpipe(){throw new Le(te.NOT_SUPPORTED,"AudioProcessor cannot unpipe to any other Processor")}enable(){}disable(){}reset(){this.inputTrack=void 0,this.inputNode=void 0,this.audioProcessorContext.chained=!1,this.emit(ea.ON_TRACK,void 0),this.emit(ea.ON_NODE,void 0)}updateInput(r){if(r.context!==this.audioProcessorContext)throw new Error(`ProcessorContext passed to AudioTrack.processorDestination doesn't match it's belonging AudioTrack's context.
        Probably you are making pipeline like this: audioTrack1.pipe(processor).pipe(audioTrack2.processorDestination).`);r.track&&this.inputTrack!==r.track&&(this.audioProcessorContext.chained=!0,this.inputTrack=r.track,this.emit(ea.ON_TRACK,this.inputTrack)),r.node&&this.inputNode!==r.node&&(this.audioProcessorContext.chained=!0,this.inputNode=r.node,this.emit(ea.ON_NODE,this.inputNode))}}class o9 extends Jr{set chained(r){this._chained=r}get chained(){return this._chained}constructor(r,s,a){super(),Re(this,"constraintsMap",new Map),Re(this,"statsRegistry",[]),Re(this,"audioContext",void 0),Re(this,"trackId",void 0),Re(this,"direction",void 0),Re(this,"usageRegistry",[]),Re(this,"_chained",!1),this.audioContext=r,this.trackId=s,this.direction=a}async getConstraints(){return Ms(this,Qc.REQUEST_CONSTRAINTS)}getAudioContext(){return this.audioContext}async requestApplyConstraints(r,s){var a;return x.info("processor ".concat(s.name," requestApplyConstraints for ").concat(this.trackId)),r&&this.constraintsMap.set(s,r),Er(this,Qc.REQUEST_UPDATE_CONSTRAINTS,Array.from(Sc(a=this.constraintsMap).call(a)))}async requestRevertConstraints(r){var s;if(this.constraintsMap.has(r))return this.constraintsMap.delete(r),Er(this,Qc.REQUEST_UPDATE_CONSTRAINTS,Array.from(Sc(s=this.constraintsMap).call(s)))}registerStats(r,s,a){this.statsRegistry.find(c=>c.processorID===r.ID&&c.processorName===r.name&&c.type===s)||this.statsRegistry.push({processorName:r.name,processorID:r.ID,type:s,cb:a})}unregisterStats(r,s){const a=this.statsRegistry.findIndex(c=>c.processorID===r.ID&&c.processorName===r.name&&c.type===s);a!==-1&&this.statsRegistry.splice(a,1)}gatherStats(){const r=[];for(const{processorID:s,processorName:a,type:c,cb:d}of this.statsRegistry)try{const h=d();r.push({processorID:s,processorName:a,type:c,stats:h})}catch(h){x.error(new Le(te.UNEXPECTED_ERROR,h.message))}return r}registerUsage(r,s){this.usageRegistry.find(a=>a.processorID===r.ID&&a.processorName===r.name)||this.usageRegistry.push({processorID:r.ID,processorName:r.name,cb:s})}unregisterUsage(r){const s=this.usageRegistry.findIndex(a=>a.processorID===r.ID&&a.processorName===r.name);s!==-1&&this.usageRegistry.splice(s,1)}async gatherUsage(){const r=[];if(!this.chained)return[];for(const{cb:s}of this.usageRegistry)try{let a=s();a instanceof pt&&(a=await a),r.push(Ar(Ar({},a),{},{direction:this.direction}))}catch(a){x.error("gather extension usage error",a)}return r}getDirection(){return this.direction}}class h2 extends Jr{get isPlayed(){return!0}get isFreeze(){return!1}constructor(){super(),Re(this,"context",void 0),Re(this,"processSourceNode",void 0),Re(this,"outputTrack",void 0),Re(this,"processedNode",void 0),Re(this,"clonedTrack",void 0),Re(this,"outputNode",void 0),this.outputNode=new oge}setVolume(){}createOutputTrack(){throw new Le(te.NOT_SUPPORTED,"can not create output MediaStreamTrack when WebAudio disabled")}getOriginVolumeLevel(){return 0}getAccurateVolumeLevel(){return 0}stopGetAudioBuffer(){}startGetAudioBuffer(){}play(){}stop(){}destroy(){}updateTrack(){}updateOriginTrack(){}createMediaStreamSourceNode(){}}class oge{disconnect(){}connect(){}}function a9(t){return new pt((r,s)=>{let a=!1;const c=document.createElement("video");c.setAttribute("autoplay",""),c.setAttribute("muted",""),c.muted=!0,c.autoplay=!0,c.setAttribute("playsinline",""),c.setAttribute("style","position: fixed; top: 0; left: 0; width: 1px; height: 1px"),document.body.appendChild(c);const d=fo()?"canplay":"playing";c.addEventListener(d,()=>{const h=c.videoWidth,m=c.videoHeight;!h&&ni()||(a=!0,c.srcObject=null,c.remove(),r([h,m]))}),c.srcObject=new MediaStream([t]),c.play().catch(mP),setTimeout(()=>{a||(c.srcObject=null,c.remove(),r([c.videoWidth,c.videoHeight]))},4e3)})}function RP(t){const r={};t.facingMode&&(r.facingMode=t.facingMode),t.cameraId&&(r.deviceId={exact:t.cameraId});const s=Uu(t.encoderConfig);return s.width!=null&&(r.width=s.width),s.height!=null&&(r.height=s.height),!sW()&&s.frameRate&&(r.frameRate=s.frameRate),J8()&&typeof r.frameRate=="object"&&(r.frameRate.max=60),ni()&&(r.frameRate={ideal:30,max:30}),r}function c9(t){const r={};return sW()||(t.AGC!==void 0&&(r.autoGainControl=t.AGC),t.AEC!==void 0&&(r.echoCancellation=t.AEC),t.ANS!==void 0&&(r.noiseSuppression=t.ANS,cf()&&t.ANS&&(r.googHighpassFilter=t.ANS))),r}function l9(t){const r=c9(t);if(t.encoderConfig){const s=wP(t.encoderConfig);r.channelCount=s.stereo?2:1,r.sampleRate=s.sampleRate,r.sampleSize=s.sampleSize}return t.microphoneId&&(r.deviceId={exact:t.microphoneId}),hP()&&(r.sampleRate=void 0),r}const age=t=>{const r=t._encoderConfig;if(!r)return;const{frameRate:s,width:a,height:c}=t.getMediaStreamTrackSettings();let{frameRate:d=s,width:h=a,height:m=c}=r;if(!d||!h||!m)return;h=zv(h),m=zv(m),d=zv(d);const{max:g,min:E}=function(k,W,j){const B=200*Math.pow(j/15,.6)*Math.pow(k*W/640/360,.75);return{min:Math.floor(B),max:Math.floor(4*B)}}(h,m,d),{bitrateMax:b,bitrateMin:I}=r||{};b||x.debug("calculate bitrate: [w: ".concat(h,", h: ").concat(m,", fps: ").concat(d,"] => [brMax: ").concat(b,", brMin: ").concat(I,"]"));const{maxFramerate:A}=se("ENCODER_CONFIG_LIMIT");return A&&typeof A=="number"&&(d=Math.min(d,A)),{frameRate:d,bitrateMax:b||g,bitrateMin:I||E,scaleResolutionDownBy:1,scale:0}},u9=async(t,r,s)=>await(async(a,c,d)=>{const h=function(E){const b=[];for(let I=0;I<E.length;I+=2)b.push(parseInt(E.slice(I,I+2),16));return Uint8Array.from(b)}(SW(""+c+d)).slice(0,16),m=h.slice(0,12),g=await window.crypto.subtle.importKey("raw",h,"AES-GCM",!0,["encrypt"]);return new Uint8Array(await window.crypto.subtle.encrypt({name:"AES-GCM",iv:m},g,a))})(t.buffer,r,s),p2=t=>{const r=document.createElement("canvas");return r.width=2,r.height=2,new pt((s,a)=>{r.toBlob(async c=>{if(r.remove(),c){const d=await d9(c);s({buffer:d,width:r.width,height:r.height})}else a(new Le(te.CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED))},t,1)})},d9=async t=>{const r=await t.arrayBuffer();return new Uint8Array(r)};var h9,p9,f9,m9,g9,_9,y9,E9,v9,S9,b9,w9,T9,C9,R9,I9,A9,P9,Qr,k9,O9,N9,D9,x9,L9,Kh,M9,U9,V9,F9,j9,B9,z9,W9,G9,H9,$9,K9,q9,Vs;let ci=(h9=Gt({argsMap:(t,r)=>[t.getTrackId(),r],throttleTime:300}),p9=Gt({argsMap:(t,r)=>[t.getTrackId(),r]}),f9=ai(),m9=Wv("LocalAudioTrack","_enabledMutex"),g9=Gt({argsMap:(t,r)=>[t.getTrackId(),r]}),_9=ai(),y9=Wv("LocalAudioTrack","_enabledMutex"),E9=Gt({argsMap:(t,r)=>[t.getTrackId(),r]}),v9=ai(),S9=ai(),b9=ai(),w9=Gt({argsMap:t=>[t.getTrackId()]}),T9=ai(),C9=Gt({argsMap:t=>[t.getTrackId()]}),R9=ai(),I9=Gt({argsMap:t=>[t.getTrackId()]}),A9=Gt({argsMap:(t,r)=>[t.getTrackId(),r.name]}),P9=Gt({argsMap:t=>[t.getTrackId()]}),Dn((Qr=class extends Jv{get _source(){return this.initWebAudio()}set _source(t){this._trackSource=t}get processorContext(){return this._processorContext||(this._processorContext=this.initProcessor().processorContext),this._processorContext}get processorDestination(){return this._processorDestination||(this._processorDestination=this.initProcessor().processorDestination),this._processorDestination}get isPlaying(){return this._useAudioElement?ba.isPlaying(this.getTrackId()):this._source.isPlayed}get __className__(){return"LocalAudioTrack"}constructor(t,r,s,a){super(t,s),Re(this,"trackMediaType",Xv.AUDIO),Re(this,"_encoderConfig",void 0),Re(this,"_trackSource",void 0),Re(this,"metadata",[]),Re(this,"_enabled",!0),Re(this,"_volume",100),Re(this,"_useAudioElement",!0),Re(this,"_bypassWebAudio",!1),Re(this,"processor",void 0),Re(this,"_processorContext",void 0),Re(this,"_processorDestination",void 0),Re(this,"_getOriginVolumeLevel",void 0),this._encoderConfig=r,this._getOriginVolumeLevel=!!a,this._trackSource=new h2,se("DISABLE_WEBAUDIO")&&(this._bypassWebAudio=!0),se("LOCAL_AUDIO_TRACK_USES_WEB_AUDIO")&&(this._useAudioElement=!1),xs()&&!Zc?setTimeout(()=>this.initWebAudio()):this.initWebAudio()}setVolume(t){_r(t,"volume",0,1e3),this._volume=t,this._source.setVolume(t/100),this._useAudioElement&&ba.setVolume(this.getTrackId(),t);try{if(this._bypassWebAudio)return void x.debug("[".concat(this.getTrackId(),"] setVolume returned because no pass through WebAudio."));const r=this._source.createOutputTrack();this._mediaStreamTrack!==r&&(this._mediaStreamTrack=r,Er(this,Tt.NEED_REPLACE_TRACK,this).then(()=>{x.debug("[".concat(this.getTrackId(),"] replace web audio track success"))}).catch(s=>{x.warning("[".concat(this.getTrackId(),"] replace web audio track failed"),s)}))}catch{}}getVolumeLevel(){return this._muted&&this.enabled&&this._getOriginVolumeLevel?this._source.getOriginVolumeLevel():this._source.getAccurateVolumeLevel()}async setPlaybackDevice(t){if(!this._useAudioElement||!jW())throw new Le(te.NOT_SUPPORTED,"your browser does not support setting the audio output device");await ba.setSinkID(this.getTrackId(),t)}async setEnabled(t,r,s){return this._setEnabled(t,r,s)}async _setEnabled(t,r,s){if(!s){if(t===this._enabled)return;this.stateCheck("enabled",t)}if(x.info("[".concat(this.getTrackId(),"] start setEnabled"),t),t){this._originMediaStreamTrack.enabled=!0;try{s||(this._enabled=!0),await Er(this,Tt.NEED_ENABLE_TRACK,this),x.info("[".concat(this.getTrackId(),"] setEnabled to ").concat(t," success"))}catch(a){throw s||(this._enabled=!1),x.error("[".concat(this.getTrackId(),"] setEnabled to true error"),a.toString()),a}}else{this._originMediaStreamTrack.enabled=!1,s||(this._enabled=!1);try{await Er(this,Tt.NEED_DISABLE_TRACK,this)}catch(a){throw s||(this._enabled=!0),x.error("[".concat(this.getTrackId(),"] setEnabled to false error"),a.toString()),a}}}async setMuted(t){t!==this._muted&&(this.stateCheck("muted",t),this._muted=t,this._originMediaStreamTrack.enabled=!t,x.debug("[".concat(this.getTrackId(),"] start set muted: ").concat(t)),t?await Er(this,Tt.NEED_MUTE_TRACK,this):await Er(this,Tt.NEED_UNMUTE_TRACK,this))}getStats(){return Wm(()=>{x.warning("[deprecated] LocalAudioTrack.getStats will be removed in the future, use AgoraRTCClient.getLocalAudioStats instead")},"localAudioTrackGetStatsWarning"),Yc(this,Tt.GET_STATS)||Ar({},s2)}setAudioFrameCallback(t){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:4096;if(!t)return this._source.removeAllListeners(Jc.ON_AUDIO_BUFFER),void this._source.stopGetAudioBuffer();this._source.startGetAudioBuffer(r),this._source.removeAllListeners(Jc.ON_AUDIO_BUFFER),this._source.on(Jc.ON_AUDIO_BUFFER,s=>t(s))}play(){x.debug("[".concat(this.getTrackId(),"] start audio playback")),this._useAudioElement?(x.debug("[".concat(this.getTrackId(),"] start audio playback in element")),ba.play(this._mediaStreamTrack,this.getTrackId(),this._volume)):this._source.play()}stop(){x.debug("[".concat(this.getTrackId(),"] stop audio playback")),this._useAudioElement?ba.stop(this.getTrackId()):this._source.stop()}close(){super.close(),this._processorDestination&&this.unbindProcessorDestinationEvents(this._processorDestination),this._processorContext&&this.unbindProcessorContextEvents(this._processorContext),this.unpipe(),this._processorDestination&&this._processorDestination._source&&this._processorDestination._source.unpipe(),this._source.destroy()}_updatePlayerSource(){let t=!(arguments.length>0&&arguments[0]!==void 0)||arguments[0];x.debug("[".concat(this.getTrackId(),"] update player source track")),t&&this._source.updateTrack(this._mediaStreamTrack),this._useAudioElement&&ba.updateTrack(this.getTrackId(),this._mediaStreamTrack)}async _updateOriginMediaStreamTrack(t,r){this._originMediaStreamTrack!==t&&(this._originMediaStreamTrack&&(this._originMediaStreamTrack.removeEventListener("ended",this._handleTrackEnded),r&&this._originMediaStreamTrack.stop()),t.addEventListener("ended",this._handleTrackEnded),this._originMediaStreamTrack=t,this._muted&&(this._originMediaStreamTrack.enabled=!1),this.processor&&this._processorContext&&this.processor.updateInput({track:t,context:this._processorContext}),this._mediaStreamTrack!==this._source.outputTrack?(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource(),await Er(this,Tt.NEED_REPLACE_TRACK,this)):this._source.updateTrack(this._originMediaStreamTrack),this._getOriginVolumeLevel&&this._source.updateOriginTrack(t))}renewMediaStreamTrack(t){return pt.resolve(void 0)}pipe(t){if(this._bypassWebAudio)throw new Le(te.INVALID_OPERATION,"Can not process AudioTrack when bypassWebAudio set to true.");if(this.processor===t)return t;if(t._source)throw new Le(te.INVALID_OPERATION,"Processor ".concat(t.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=t,this.processor._source=this,t.updateInput({track:this._originMediaStreamTrack,node:this._source.processSourceNode,context:this.processorContext}),t}unpipe(){var t;if(!this.processor)return;const r=this.processor;(t=this._source.processSourceNode)===null||t===void 0||t.disconnect(),this.processor._source=!1,this.processor=void 0,r.reset()}bindProcessorDestinationEvents(t){t.on(ea.ON_TRACK,async r=>{r?r!==this._mediaStreamTrack&&(this._mediaStreamTrack=r,this._updatePlayerSource(!1),this._source.processedNode=this._source.createMediaStreamSourceNode(r),await Er(this,Tt.NEED_REPLACE_TRACK,this)):this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource(),await Er(this,Tt.NEED_REPLACE_TRACK,this))}),t.on(ea.ON_NODE,r=>{this._source.processedNode=r})}unbindProcessorDestinationEvents(t){t.removeAllListeners(ea.ON_TRACK),t.removeAllListeners(ea.ON_NODE)}bindProcessorContextEvents(t){t.on(Qc.REQUEST_CONSTRAINTS,async r=>{r(this._originMediaStreamTrack.getSettings())})}unbindProcessorContextEvents(t){t.removeAllListeners(Qc.REQUEST_CONSTRAINTS)}initWebAudio(){return this._trackSource instanceof h2&&(this._trackSource=new XW(this._mediaStreamTrack,!1,this._getOriginVolumeLevel?this._mediaStreamTrack:void 0)),this._trackSource}initProcessor(){const t=new o9(this._source.context,this.getTrackId(),"local"),r=new s9(t);return this._processorContext=t,this._processorDestination=r,this.bindProcessorContextEvents(t),this.bindProcessorDestinationEvents(r),this._source.on(Jc.UPDATE_SOURCE,()=>{this.processor&&this.processor.updateInput({node:this._source.processSourceNode,context:t})}),this._useAudioElement&&(this._useAudioElement=!1,this.isPlaying&&(ba.stop(this.getTrackId()),this._source.play()),Er(this,Tt.NEED_REPLACE_MIXING_TRACK,this).then(()=>{x.debug("[".concat(this.getTrackId(),"] replace from origin track to web audio track success"))}).catch(s=>{x.warning("[".concat(this.getTrackId(),"] replace from origin track to web audio track failed"),s)})),{processorContext:t,processorDestination:r}}}).prototype,"setVolume",[h9],Object.getOwnPropertyDescriptor(Qr.prototype,"setVolume"),Qr.prototype),Dn(Qr.prototype,"setPlaybackDevice",[p9,f9],Object.getOwnPropertyDescriptor(Qr.prototype,"setPlaybackDevice"),Qr.prototype),Dn(Qr.prototype,"setEnabled",[m9,g9,_9],Object.getOwnPropertyDescriptor(Qr.prototype,"setEnabled"),Qr.prototype),Dn(Qr.prototype,"setMuted",[y9,E9,v9],Object.getOwnPropertyDescriptor(Qr.prototype,"setMuted"),Qr.prototype),Dn(Qr.prototype,"getStats",[S9],Object.getOwnPropertyDescriptor(Qr.prototype,"getStats"),Qr.prototype),Dn(Qr.prototype,"setAudioFrameCallback",[b9],Object.getOwnPropertyDescriptor(Qr.prototype,"setAudioFrameCallback"),Qr.prototype),Dn(Qr.prototype,"play",[w9,T9],Object.getOwnPropertyDescriptor(Qr.prototype,"play"),Qr.prototype),Dn(Qr.prototype,"stop",[C9,R9],Object.getOwnPropertyDescriptor(Qr.prototype,"stop"),Qr.prototype),Dn(Qr.prototype,"close",[I9],Object.getOwnPropertyDescriptor(Qr.prototype,"close"),Qr.prototype),Dn(Qr.prototype,"pipe",[A9],Object.getOwnPropertyDescriptor(Qr.prototype,"pipe"),Qr.prototype),Dn(Qr.prototype,"unpipe",[P9],Object.getOwnPropertyDescriptor(Qr.prototype,"unpipe"),Qr.prototype),Qr),rT=(k9=Gt({argsMap:(t,r)=>[t.getTrackId(),r]}),O9=ai(),N9=Wv("MicrophoneAudioTrack","_enabledMutex"),D9=Gt({argsMap:(t,r,s)=>[t.getTrackId(),r,s]}),x9=ai(),L9=Gt({argsMap:t=>[t.getTrackId()]}),Dn((Kh=class extends ci{get __className__(){return"MicrophoneAudioTrack"}constructor(t,r,s,a){super(t,r.encoderConfig?wP(r.encoderConfig):{},a,se("GET_VOLUME_OF_MUTED_AUDIO_TRACK")),Re(this,"_config",void 0),Re(this,"_deviceName","default"),Re(this,"_constraints",void 0),Re(this,"_originalConstraints",void 0),Re(this,"_enabled",!0),this._config=r,this._constraints=s,this._originalConstraints=s,this._deviceName=t.label,typeof r.bypassWebAudio=="boolean"&&(this._bypassWebAudio=r.bypassWebAudio),(Fv()||DL())&&fr.bindInterruptDetectorTrack(this)}async setDevice(t){if(x.info("[".concat(this.getTrackId(),"] start set device to ").concat(t)),this._enabled)try{const r=await tl.getDeviceById(t),s={};s.audio=Ar({},this._constraints),s.audio.deviceId={exact:t},this._originMediaStreamTrack.stop();let a=null;try{a=await el(s,this.getTrackId())}catch(c){throw x.error("[".concat(this.getTrackId(),"] setDevice failed"),c.toString()),a=await el({audio:this._constraints},this.getTrackId()),await this._updateOriginMediaStreamTrack(a.getAudioTracks()[0],!1),c}await this._updateOriginMediaStreamTrack(a.getAudioTracks()[0],!1),this._deviceName=r.label,this._config.microphoneId=t,this._constraints.deviceId={exact:t}}catch(r){throw x.error("[".concat(this.getTrackId(),"] setDevice error"),r.toString()),r}else try{const r=await tl.getDeviceById(t);this._deviceName=r.label,this._config.microphoneId=t,this._constraints.deviceId={exact:t}}catch(r){throw x.error("[".concat(this.getTrackId(),"] setDevice error"),r.toString()),r}x.info("[".concat(this.getTrackId(),"] set device to ").concat(t," success"))}async setEnabled(t,r,s){if(r)return x.debug("[".concat(this.getTrackId(),"] setEnabled false (do not close microphone)")),await super._setEnabled(t);if(!s){if(t===this._enabled)return;this.stateCheck("enabled",t)}if(x.info("[".concat(this.getTrackId(),"] start setEnabled"),t),se("AUTO_RESET_AUDIO_ROUTE")&&(fo()||xu())){const h=navigator.audioSession;h&&(t||(h.type="playback"),h.type="auto")}if(!t){var a;this._originMediaStreamTrack.onended=null,this._originMediaStreamTrack.stop(),(a=this._source.clonedTrack)===null||a===void 0||a.stop(),s||(this._enabled=!1);try{await Er(this,Tt.NEED_DISABLE_TRACK,this)}catch(h){throw x.error("[".concat(this.getTrackId(),"] setEnabled false failed"),h.toString()),h}return}const c=Ar({},this._constraints),d=tl.searchDeviceIdByName(this._deviceName);d&&!c.deviceId&&(c.deviceId=d);try{s||(this._enabled=!0);const h=await el({audio:this._constraints},this.getTrackId());await this._updateOriginMediaStreamTrack(h.getAudioTracks()[0],!1),await Er(this,Tt.NEED_ENABLE_TRACK,this)}catch(h){throw s||(this._enabled=!1),x.error("[".concat(this.getTrackId(),"] setEnabled true failed"),h.toString()),h}x.info("[".concat(this.getTrackId(),"] setEnabled success"))}close(){super.close(),(Fv()||DL())&&fr.unbindInterruptDetectorTrack(this)}onTrackEnded(){if((fo()||xu())&&this._enabled&&!this._isClosed&&fr.duringInterruption){const t=async()=>{fr.off(Ts.IOS_INTERRUPTION_END,t),this._enabled&&!this._isClosed&&(x.debug("[".concat(this.getTrackId(),"] try capture microphone media device for interrupted iOS device.")),await this.setEnabled(!1),await this.setEnabled(!0))};fr.on(Ts.IOS_INTERRUPTION_END,t)}else x.debug("[".concat(this.getTrackId(),"] track ended")),this.safeEmit(Yv.TRACK_ENDED)}async renewMediaStreamTrack(t){const r=t||this._constraints,s=tl.searchDeviceIdByName(this._deviceName);if(s&&!r.deviceId&&(r.deviceId=s),this._constraints=r,this._enabled){this._originMediaStreamTrack.stop();const a=await el({audio:this._constraints},this.getTrackId());await this._updateOriginMediaStreamTrack(a.getAudioTracks()[0],!0)}}bindProcessorContextEvents(t){super.bindProcessorContextEvents(t),t.on(Qc.REQUEST_UPDATE_CONSTRAINTS,async(r,s,a)=>{try{const c=Object.assign({},this._originalConstraints,...r);await this.renewMediaStreamTrack(c),s()}catch(c){a(c)}})}unbindProcessorContextEvents(t){super.unbindProcessorContextEvents(t),t.removeAllListeners(Qc.REQUEST_UPDATE_CONSTRAINTS)}}).prototype,"setDevice",[k9,O9],Object.getOwnPropertyDescriptor(Kh.prototype,"setDevice"),Kh.prototype),Dn(Kh.prototype,"setEnabled",[N9,D9,x9],Object.getOwnPropertyDescriptor(Kh.prototype,"setEnabled"),Kh.prototype),Dn(Kh.prototype,"close",[L9],Object.getOwnPropertyDescriptor(Kh.prototype,"close"),Kh.prototype),Kh),cge=(M9=Gt({argsMap:(t,r)=>[t.getTrackId(),r,t.duration]}),U9=ai(),V9=Gt({argsMap:t=>[t.getTrackId()]}),F9=ai(),j9=Gt({argsMap:t=>[t.getTrackId()]}),B9=ai(),z9=Gt({argsMap:t=>[t.getTrackId()]}),W9=ai(),G9=Gt({argsMap:t=>[t.getTrackId()]}),H9=ai(),$9=Gt({argsMap:t=>[t.getTrackId()]}),K9=Gt({argsMap:t=>[t.getTrackId()]}),q9=ai(),Dn((Vs=class extends ci{get __className__(){return"BufferSourceAudioTrack"}constructor(t,r,s,a){super(r.createOutputTrack(),s,a),Re(this,"source",void 0),Re(this,"_bufferSource",void 0),this._useAudioElement=!1,this.source=t,this._bufferSource=r,this._bufferSource.on(Jc.AUDIO_SOURCE_STATE_CHANGE,c=>{this.safeEmit(Yv.SOURCE_STATE_CHANGE,c)});try{this._mediaStreamTrack=this._source.createOutputTrack()}catch{}}get currentState(){return this._bufferSource.currentState}get duration(){return this._bufferSource.duration}get playbackSpeed(){return this._bufferSource.playbackSpeed}getCurrentTime(){return this._bufferSource.currentTime}startProcessAudioBuffer(t){t&&this._bufferSource.updateOptions(t),this._bufferSource.startProcessAudioBuffer()}pauseProcessAudioBuffer(){this._bufferSource.pauseProcessAudioBuffer()}seekAudioBuffer(t){this._bufferSource.seekAudioBuffer(t)}resumeProcessAudioBuffer(){this._bufferSource.resumeProcessAudioBuffer()}stopProcessAudioBuffer(){this._bufferSource.stopProcessAudioBuffer()}close(){this.source=null,this._bufferSource.destroy(),super.close()}setAudioBufferPlaybackSpeed(t){_r(t,"speed",0),this._bufferSource.setAudioBufferPlaybackSpeed(t)}}).prototype,"startProcessAudioBuffer",[M9,U9],Object.getOwnPropertyDescriptor(Vs.prototype,"startProcessAudioBuffer"),Vs.prototype),Dn(Vs.prototype,"pauseProcessAudioBuffer",[V9,F9],Object.getOwnPropertyDescriptor(Vs.prototype,"pauseProcessAudioBuffer"),Vs.prototype),Dn(Vs.prototype,"seekAudioBuffer",[j9,B9],Object.getOwnPropertyDescriptor(Vs.prototype,"seekAudioBuffer"),Vs.prototype),Dn(Vs.prototype,"resumeProcessAudioBuffer",[z9,W9],Object.getOwnPropertyDescriptor(Vs.prototype,"resumeProcessAudioBuffer"),Vs.prototype),Dn(Vs.prototype,"stopProcessAudioBuffer",[G9,H9],Object.getOwnPropertyDescriptor(Vs.prototype,"stopProcessAudioBuffer"),Vs.prototype),Dn(Vs.prototype,"close",[$9],Object.getOwnPropertyDescriptor(Vs.prototype,"close"),Vs.prototype),Dn(Vs.prototype,"setAudioBufferPlaybackSpeed",[K9,q9],Object.getOwnPropertyDescriptor(Vs.prototype,"setAudioBufferPlaybackSpeed"),Vs.prototype),Vs);class zi extends ci{get __className__(){return"MixingAudioTrack"}get isActive(){for(const r of this.trackList)if(r._enabled&&!r._isClosed&&!r.muted)return!0;return!1}constructor(){const r=Qv().createMediaStreamDestination();super(r.stream.getAudioTracks()[0],void 0,vr(8,"track-mix-")),Re(this,"trackList",void 0),Re(this,"destNode",void 0),this._useAudioElement=!1;try{this._mediaStreamTrack=this._source.createOutputTrack()}catch{}this.destNode=r,this.trackList=[]}hasAudioTrack(r){return this.trackList.indexOf(r)!==-1}addAudioTrack(r){this.trackList.indexOf(r)===-1?(x.debug("add ".concat(r.getTrackId()," to mixing track")),r._source.outputNode.connect(this.destNode),this.trackList.push(r),this.updateEncoderConfig()):x.debug("track ".concat(r.getTrackId()," is already added"))}removeAudioTrack(r){if(this.trackList.indexOf(r)!==-1){x.debug("remove ".concat(r.getTrackId()," from mixing track"));try{r._source.outputNode.disconnect(this.destNode)}catch{}pP(this.trackList,r),this.updateEncoderConfig()}}updateEncoderConfig(){const r={};this.trackList.forEach(s=>{s._encoderConfig&&((s._encoderConfig.bitrate||0)>(r.bitrate||0)&&(r.bitrate=s._encoderConfig.bitrate),(s._encoderConfig.sampleRate||0)>(r.sampleRate||0)&&(r.sampleRate=s._encoderConfig.sampleRate),(s._encoderConfig.sampleSize||0)>(r.sampleSize||0)&&(r.sampleSize=s._encoderConfig.sampleSize),s._encoderConfig.stereo&&(r.stereo=!0))}),this._encoderConfig=r}_updateRtpTransceiver(r){this._rtpTransceiver!==r&&(this._rtpTransceiver=r,this.trackList.forEach(s=>{s instanceof zi?s.emit(ry.TRANSCEIVER_UPDATED,r):s._updateRtpTransceiver(r)}))}}class lge extends YW{set currentState(r){r!==this._currentState&&(this._currentState=r,this.safeEmit(Jc.AUDIO_SOURCE_STATE_CHANGE,this._currentState))}get currentState(){return this._currentState}constructor(r){let s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};super(),Re(this,"audioBuffer",void 0),Re(this,"sourceNode",void 0),Re(this,"startPlayTime",0),Re(this,"startPlayOffset",0),Re(this,"pausePlayTime",0),Re(this,"options",void 0),Re(this,"currentLoopCount",0),Re(this,"currentPlaybackSpeed",100),Re(this,"_currentState","stopped"),this.audioBuffer=r,this.options=s,this.startPlayOffset=this.options.startPlayTime||0}createWebAudioDiagram(){return this.context.createGain()}get duration(){return this.audioBuffer?this.audioBuffer.duration:0}get playbackSpeed(){return this.currentPlaybackSpeed}get currentTime(){return this.audioBuffer?this.currentState==="stopped"?0:this.currentState==="paused"?this.pausePlayTime:((this.context.currentTime-this.startPlayTime)*(this.playbackSpeed/100)+this.startPlayOffset)%this.audioBuffer.duration:0}updateOptions(r){this.currentState==="stopped"?(this.options=r,this.startPlayOffset=this.options.startPlayTime||0):x.warning("can not set audio source options")}startProcessAudioBuffer(){this.sourceNode&&this.stopProcessAudioBuffer(),this.sourceNode=this.createSourceNode(),this.startSourceNode(),this.currentState="playing"}pauseProcessAudioBuffer(){this.sourceNode&&this.currentState==="playing"&&(this.pausePlayTime=this.currentTime,this.sourceNode.onended=null,this.sourceNode.stop(),this.sourceNode.buffer=null,this.sourceNode=this.createSourceNode(),this.currentState="paused")}seekAudioBuffer(r){this.sourceNode&&(this.sourceNode.onended=null,this.currentState==="playing"&&this.sourceNode.stop(),this.sourceNode=this.createSourceNode(),this.currentState==="playing"?(this.startPlayOffset=r,this.startSourceNode()):this.currentState==="paused"&&(this.pausePlayTime=r))}resumeProcessAudioBuffer(){this.currentState==="paused"&&this.sourceNode&&(this.startPlayOffset=this.pausePlayTime,this.pausePlayTime=0,this.startSourceNode(),this.currentState="playing")}stopProcessAudioBuffer(){if(this.sourceNode){this.sourceNode.onended=null;try{this.sourceNode.stop()}catch{}this.reset()}}destroy(){this.audioBuffer=null,super.destroy()}setAudioBufferPlaybackSpeed(r){this.sourceNode&&(this.currentState==="playing"&&(this.startPlayOffset=this.currentTime,this.startPlayTime=this.context.currentTime),this.sourceNode.playbackRate.value=r/100),this.currentPlaybackSpeed=r}startSourceNode(){this.sourceNode&&this.sourceNode.buffer&&(this.sourceNode.start(0,this.startPlayOffset),this.startPlayTime=this.context.currentTime,this.sourceNode.onended=this.handleSourceNodeEnded.bind(this))}createSourceNode(){const r=this.context.createBufferSource();return r.buffer=this.audioBuffer,r.loop=!!this.options.loop,r.connect(this.outputNode),r.playbackRate.value=this.currentPlaybackSpeed/100,r}handleSourceNodeEnded(){if(this.currentLoopCount+=1,this.options.cycle&&this.options.cycle>this.currentLoopCount)return this.startPlayOffset=0,this.sourceNode=void 0,void this.startProcessAudioBuffer();this.reset()}reset(){this.startPlayOffset=this.options.startPlayTime||0,this.currentState="stopped",this.sourceNode&&(this.sourceNode.disconnect(),this.sourceNode=void 0),this.currentLoopCount=0}}const Y9=new Map;function X9(t,r){if(t.length===0||r.length===0)return 1/0;const s=BL(t),a=BL(r);return Math.floor(a/s)}class f2{get rendFrameRate(){const r=Math.max(1,X9(this._render_interframe_delays_sizes,this._render_interframe_delays));return Math.floor(1e3/r)}get videoElementStatus(){return this._isInPage?this._videoElementStatus:Xs.DESTROYED}set videoElementStatus(r){r!==this._videoElementStatus&&(x.debug("[".concat(this.trackId,"] video-element-status change ").concat(this._videoElementStatus," => ").concat(r)),this._videoElementStatus=r)}get videoState(){return this._videoState}set videoState(r){var s;r!==this._videoState&&(this._videoState=r,(s=this.onVideoStateChanged)===null||s===void 0||s.call(this,this.videoState))}constructor(r){Re(this,"trackId",void 0),Re(this,"config",void 0),Re(this,"onFirstVideoFrameDecoded",void 0),Re(this,"onFirstVideoFrameRender",void 0),Re(this,"onVideoStateChanged",void 0),Re(this,"freezeTimeCounterList",[]),Re(this,"renderFreezeAccTime",0),Re(this,"renderFreezeAccTime2",0),Re(this,"isKeepLastFrame",!1),Re(this,"isDestroyed",!1),Re(this,"timeUpdatedCount",0),Re(this,"freezeTime",0),Re(this,"playbackTime",0),Re(this,"lastTimeUpdatedTime",0),Re(this,"autoplayFailed",!1),Re(this,"videoTrack",void 0),Re(this,"videoElement",void 0),Re(this,"cacheVideoElement",void 0),Re(this,"internal",!1),Re(this,"_render_interframe_delays",[]),Re(this,"_render_interframe_delays_sizes",[]),Re(this,"_videoState",$h.VideoStateStopped),Re(this,"videoElementCheckInterval",void 0),Re(this,"videoElementFreezeTimeout",void 0),Re(this,"_videoElementStatus",Xs.NONE),Re(this,"_isInPage",!0),Re(this,"isGettingVideoDimensions",!1),Re(this,"startGetVideoDimensions",()=>{const s=()=>{if(this.isGettingVideoDimensions=!0,this.videoElement.videoWidth*this.videoElement.videoHeight>4)return x.debug("[".concat(this.trackId,"] current video dimensions:"),this.videoElement.videoWidth,this.videoElement.videoHeight),void(this.isGettingVideoDimensions=!1);setTimeout(s,500)};!this.isGettingVideoDimensions&&s()}),Re(this,"autoResumeAfterInterruption",()=>{this.videoTrack&&this.videoTrack.readyState==="live"&&fr.curState==="running"&&(x.debug("[track-".concat(this.trackId,"] video element paused, auto resume for ").concat(Y8())),rW()?(this.videoElement.srcObject=null,this.videoElement.srcObject=new MediaStream([this.videoTrack]),this.videoElement.play()):(this.videoElement.pause(),this.videoElement.play()))}),Re(this,"handleVideoEvents",s=>{switch(s.type){case"play":case"playing":s.type==="play"&&x.debug("[".concat(this.trackId,"] video element status: play")),this.startGetVideoDimensions(),this.videoElementStatus=Xs.PLAYING;break;case"loadeddata":if(this.videoState=$h.VideoStateStarting,this.onFirstVideoFrameRender&&this.onFirstVideoFrameRender(),this.onFirstVideoFrameDecoded&&this.onFirstVideoFrameDecoded(),this.cacheVideoElement){try{this.cacheVideoElement.srcObject=null,this.cacheVideoElement.remove()}catch{}this.cacheVideoElement=void 0}break;case"canplay":this.videoElementStatus=Xs.CANPLAY;break;case"stalled":this.videoElementStatus=Xs.STALLED;break;case"suspend":this.videoElementStatus=Xs.SUSPEND;break;case"pause":this.videoElementStatus=Xs.PAUSED,fo()||xu()||xs()&&this.autoplayFailed||!this.videoTrack||this.videoTrack.readyState!=="live"||(x.debug("[track-".concat(this.trackId,"] video element paused, auto resume")),this.videoElement.play());break;case"waiting":this.videoElementStatus=Xs.WAITING;break;case"abort":this.videoElementStatus=Xs.ABORT;break;case"ended":this.videoElementStatus=Xs.ENDED;break;case"emptied":this.videoElementStatus=Xs.EMPTIED;break;case"error":{const a=this.videoElement.error;a&&(this.videoElementStatus=Xs.ERROR,x.error("[".concat(this.trackId,"] media error: ").concat(a.message," (").concat(a.code,")")));break}case"timeupdate":{const a=performance.now();if(this.timeUpdatedCount+=1,this.timeUpdatedCount<10)return void(this.lastTimeUpdatedTime=a);const c=a-this.lastTimeUpdatedTime,d=this.lastTimeUpdatedTime;if(this.lastTimeUpdatedTime=a,qh.lastVisibleTime<qh.lastHiddenTime||d<qh.lastHiddenTime||d<qh.lastVisibleTime||this.isSkipCalcRenderFreezeTime())return;for(c>se("VIDEO_FREEZE_DURATION")&&(this.freezeTime+=c),this.playbackTime+=c;this.playbackTime>=6e3;){this.playbackTime-=6e3;const h=Math.min(6e3,this.freezeTime);this.freezeTimeCounterList.push(h),this.freezeTime=Math.max(0,this.freezeTime-6e3)}break}}}),Re(this,"autoResumeAfterInterruptionOnIOS15_16",()=>{this.videoTrack&&this.videoTrack.readyState==="live"&&(x.debug("[track-".concat(this.trackId,"] video element paused, auto resume for ").concat(Y8())),rW()?(this.videoElement.srcObject=null,this.videoElement.srcObject=new MediaStream([this.videoTrack]),this.videoElement.play()):(this.videoElement.pause(),this.videoElement.play()))}),this.trackId=r.trackId,this.config=r,r.element instanceof HTMLVideoElement?this.videoElement=r.element:this.videoElement=document.createElement("video"),fr.on(Ts.IOS_INTERRUPTION_END,this.autoResumeAfterInterruption),fr.on(Ts.IOS_15_16_INTERRUPTION_END,this.autoResumeAfterInterruptionOnIOS15_16)}getVideoElement(){return this.videoElement}getContainerElement(){var r;return(r=this.videoElement.parentElement)!==null&&r!==void 0?r:void 0}updateConfig(r){this.config=r,this.trackId=r.trackId,r.element!==this.videoElement&&(this.destroy(),this.videoElement=r.element),this.videoTrack&&this.initVideoElement()}updateVideoTrack(r){this.videoTrack!==r&&(this.videoTrack=r,this.initVideoElement())}play(r){const s=this.videoElement.play();s&&s.catch&&s.catch(c=>{r&&n9(r,"video",c.message,this.trackId),c.name==="NotAllowedError"?(x.warning("detected video element autoplay failed",c),this.autoplayFailed=!0,this.handleAutoPlayFailed()):x.warning("[".concat(this.trackId,"] play warning: "),c)});const a=xn();if((a.name==="Safari"&&Number(a.version)===15||Fv())&&s&&s.then){const c=()=>{this.config.mirror&&(this.videoElement.style.transform="rotateY(180deg)")};s.then(c).catch(c)}}getCurrentFrame(){const r=document.createElement("canvas");r.width=this.videoElement.videoWidth,r.height=this.videoElement.videoHeight;const s=r.getContext("2d");if(!s)return x.error("create canvas context failed!"),new ImageData(2,2);s.drawImage(this.videoElement,0,0,r.width,r.height);const a=s.getImageData(0,0,r.width,r.height);return r.remove(),a}async getCurrentFrameToUint8Array(r){let s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1;const a=document.createElement("canvas");a.width=this.videoElement.videoWidth,a.height=this.videoElement.videoHeight;const c=a.getContext("2d");return c?(c.drawImage(this.videoElement,0,0,a.width,a.height),new pt((d,h)=>{a.toBlob(async m=>{if(a.remove(),m){const g=await d9(m);d({buffer:g,width:a.width,height:a.height})}else h(new Le(te.CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED))},r,s<0?.1:s>1?1:s)})):await p2(r)}destroy(){this.isDestroyed=!0,fr.off(Ts.IOS_INTERRUPTION_END,this.autoResumeAfterInterruption),fr.off(Ts.IOS_15_16_INTERRUPTION_END,this.autoResumeAfterInterruptionOnIOS15_16),this.videoElement.srcObject=null,this.resetVideoElement(),this.freezeTimeCounterList=[],this.videoState=$h.VideoStateStopped}initVideoElement(){if(this.videoElementStatus=Xs.INIT,!this.videoElementCheckInterval&&(J9.forEach(d=>{this.videoElement.addEventListener(d,this.handleVideoEvents)}),this.videoElementCheckInterval=window.setInterval(()=>{this._isInPage=function(d){return d!==document.body&&document.body.contains(d)}(this.videoElement)},1e3),se("ENABLE_VIDEO_FRAME_CALLBACK"))){var r,s;let d;const h=()=>{document.visibilityState==="visible"&&(document.removeEventListener("visibilitychange",h),this.videoElementFreezeTimeout=window.setTimeout(m,se("VIDEO_FREEZE_DURATION")))},m=()=>{this.videoElementFreezeTimeout=void 0,this.videoState===$h.VideoStateDecoding&&(document.visibilityState==="visible"?this.videoState=$h.VideoStateFrozen:document.addEventListener("visibilitychange",h))},g=(E,b)=>{if(this.videoElementStatus===Xs.PLAYING){if(d){const k=b.presentationTime-d.presentationTime,W=b.presentedFrames-d.presentedFrames;this._render_interframe_delays_sizes.push(W),this._render_interframe_delays.push(k);const j=BL(this._render_interframe_delays_sizes),B=j-this._render_interframe_delays_sizes[0];if(j>30&&B>5&&(this._render_interframe_delays_sizes.shift(),this._render_interframe_delays.shift()),this.videoState===$h.VideoStateStarting&&(this.videoState=$h.VideoStateDecoding),this.videoState===$h.VideoStateDecoding&&this.onVideoStateChanged&&(this.videoElementFreezeTimeout&&window.clearTimeout(this.videoElementFreezeTimeout),this.videoElementFreezeTimeout=window.setTimeout(m,se("VIDEO_FREEZE_DURATION"))),k<se("VIDEO_FREEZE_DURATION")&&this.videoState===$h.VideoStateFrozen&&(this.videoState=$h.VideoStateDecoding),k>se("VIDEO_FREEZE_DURATION")&&qh.lastVisibleTime>=qh.lastHiddenTime&&d.timestamp>qh.lastVisibleTime&&d.timestamp>qh.lastHiddenTime){const ee=Math.min(66,X9(this._render_interframe_delays_sizes,this._render_interframe_delays)),Z=Math.max(0,k-(W-1)*ee);this.renderFreezeAccTime2+=Z>ee?Z:0,this.renderFreezeAccTime+=k}}d=Ar(Ar({},b),{},{timestamp:E})}else this.isSkipCalcRenderFreezeTime()&&(d=Ar(Ar({},b),{},{timestamp:E}));var I,A;se("ENABLE_VIDEO_FRAME_CALLBACK")&&((I=(A=this.videoElement).requestVideoFrameCallback)===null||I===void 0||I.call(A,g))};(r=(s=this.videoElement).requestVideoFrameCallback)===null||r===void 0||r.call(s,g)}this.videoElement.controls=!1,this.videoElement.setAttribute("playsinline",""),hP()&&!se("HIDE_NO_POSTER")&&(this.videoElement.poster="noposter");const a=xn();a.name==="Safari"&&Number(a.version)===15||Fv()||!this.config.mirror||(this.videoElement.style.transform="rotateY(180deg)"),this.config.fit?this.videoElement.style.objectFit=this.config.fit:this.videoElement.style.objectFit="cover",this.videoElement.setAttribute("muted",""),this.videoElement.muted=!0,this.videoElement.srcObject&&this.videoElement.srcObject instanceof MediaStream?this.videoElement.srcObject.getVideoTracks()[0]!==this.videoTrack&&(this.videoElement.srcObject=this.videoTrack?new MediaStream([this.videoTrack]):null,ni()&&this.videoElement.load()):(this.videoElement.srcObject=this.videoTrack?new MediaStream([this.videoTrack]):null,ni()&&this.videoElement.load());const c=this.videoElement.play();c!==void 0&&c.catch(d=>{x.debug("[".concat(this.trackId,"] playback interrupted"),d.toString())})}resetVideoElement(){J9.forEach(r=>{this.videoElement&&this.videoElement.removeEventListener(r,this.handleVideoEvents)}),this.videoElementCheckInterval&&(window.clearInterval(this.videoElementCheckInterval),this.videoElementCheckInterval=void 0),this.videoElementStatus=Xs.NONE}isSkipCalcRenderFreezeTime(){return this.videoElementStatus===Xs.DESTROYED||this.internal}handleAutoPlayFailed(){const r=s=>{s.preventDefault(),this.videoElement.play().then(()=>{x.debug("[".concat(this.trackId,"] Video element for trackId:").concat(this.trackId," autoplay resumed."))}).catch(a=>{x.error(a)}),this.autoplayFailed=!1,$w()?document.body.removeEventListener("click",r,!0):(document.body.removeEventListener("touchstart",r,!0),document.body.removeEventListener("mousedown",r,!0))};$w()?document.body.addEventListener("click",r,!0):(document.body.addEventListener("touchstart",r,!0),document.body.addEventListener("mousedown",r,!0)),t9()}}const J9=["play","playing","loadeddata","canplay","pause","stalled","suspend","waiting","abort","emptied","ended","timeupdate","error"];class m2 extends f2{constructor(r){let s=arguments.length>1&&arguments[1]!==void 0&&arguments[1];super(r),Re(this,"container",void 0),Re(this,"slot",void 0),this.slot=r.element,this.internal=s,this.updateConfig(r)}updateConfig(r){this.config=r,this.trackId=r.trackId;const s=r.element;var a;!this.internal||this.slot?(s!==this.slot&&(this.destroy(),this.slot=s),this.createElements()):(this.slot=s,s&&this.container?(this.internal=!1,this.container.id="agora-video-player-".concat(this.trackId),this.videoElement.id="video_".concat(this.trackId),this.config.fit?this.videoElement.style.objectFit=this.config.fit:this.videoElement.style.objectFit="cover",(a=this.slot)===null||a===void 0||a.appendChild(this.container)):this.createElements())}updateVideoTrack(r){this.videoTrack!==r&&(this.videoTrack=r,this.createElements())}play(r){var s;(s=this.container)!==null&&s!==void 0&&s.contains(this.videoElement)&&super.play(r)}getCurrentFrame(){var r;return(r=this.container)!==null&&r!==void 0&&r.contains(this.videoElement)?super.getCurrentFrame():new ImageData(2,2)}async getCurrentFrameToUint8Array(r){var s;let a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1;return(s=this.container)!==null&&s!==void 0&&s.contains(this.videoElement)?await super.getCurrentFrameToUint8Array(r,a):await p2(r)}destroy(){if(super.destroy(),this.videoElement.remove(),this.videoElement=document.createElement("video"),this.container){try{var r;this.container.remove(),(r=this.slot)===null||r===void 0||r.removeChild(this.container)}catch{}this.container=void 0}}createElements(){var r;this.container||(this.container=document.createElement("div")),this.container.id="agora-video-player-".concat(this.trackId),this.container.style.width="100%",this.container.style.height="100%",this.container.style.position="relative",this.container.style.overflow="hidden",this.videoTrack?(this.container.style.backgroundColor="black",se("KEEP_LAST_FRAME")&&this.isKeepLastFrame&&this.videoElement.paused&&this.resetVideoElement(),this.mountedVideoElement()):this.unmountedVideoElement(),(r=this.slot)===null||r===void 0||r.appendChild(this.container)}mountedVideoElement(){var r;!this.container||(r=this.container)!==null&&r!==void 0&&r.contains(this.videoElement)||this.container.appendChild(this.videoElement),super.initVideoElement(),this.videoElement.id="video_".concat(this.trackId),this.videoElement.className="agora_video_player",this.videoElement.style.width="100%",this.videoElement.style.height="100%",this.videoElement.style.position="absolute",this.videoElement.style.left="0",this.videoElement.style.top="0"}unmountedVideoElement(){var r;if((r=this.container)!==null&&r!==void 0&&r.contains(this.videoElement)){super.resetVideoElement();try{this.container&&this.container.removeChild(this.videoElement)}catch{}this.videoElement=document.createElement("video")}}resetVideoElement(){var r;(r=this.container)!==null&&r!==void 0&&r.contains(this.videoElement)&&(super.resetVideoElement(),this.cacheVideoElement=this.videoElement,this.videoElement=document.createElement("video"))}getContainerElement(){return this.container}}var Q9,Z9,eG,tG,nG,rG,iG,sG,oG,aG,cG,lG,uG,dG,hG,pG,fG,mG,gG,_G,yG,EG,vG,SG,bG,wG,TG,CG,bn,RG,IG,AG,PG,kG,OG,NG,DG,rl;let Dr=(Q9=Gt({argsMap:(t,r,s)=>[t.getTrackId(),typeof r=="string"?r:r instanceof HTMLVideoElement?"HTMLVideoElement":"HTMLElement",s]}),Z9=ai(),eG=Gt({argsMap:t=>[t.getTrackId()]}),tG=Wv("LocalVideoTrack","_enabledMutex"),nG=Gt({argsMap:(t,r)=>[t.getTrackId(),r]}),rG=ai(),iG=Wv("LocalVideoTrack","_enabledMutex"),sG=Gt({argsMap:(t,r)=>[t.getTrackId(),r]}),oG=ai(),aG=Gt({argsMap:(t,r)=>[t.getTrackId(),r,t._saveEncodeBitrateRatio]}),cG=ai(),lG=Gt({argsMap:(t,r)=>[t.getTrackId(),r]}),uG=ai(),dG=ai(),hG=Gt({argsMap:(t,r,s)=>[t.getTrackId(),r,s]}),pG=ai(),fG=ai(),mG=ai(),gG=Gt({argsMap:t=>[t.getTrackId()]}),_G=ai(),yG=ai(),EG=ai(),vG=ai(),SG=ai(),bG=Gt({argsMap:(t,r)=>[t.getTrackId(),r.name]}),wG=Gt({argsMap:t=>[t.getTrackId()]}),TG=Gt({argsMap:t=>[t.getTrackId()]}),CG=Gt({argsMap:(t,r,s)=>[t.getTrackId(),r.label,s]}),bn=class Gae extends Jv{get videoHeight(){if(xs()){const{height:r}=this._mediaStreamTrack.getSettings();return this._videoHeight=r,this._videoHeight}return this._videoHeight}get videoWidth(){if(xs()){const{width:r}=this._mediaStreamTrack.getSettings();return this._videoWidth=r,this._videoWidth}return this._videoWidth}get isPlaying(){return!(!this._player||this._player.videoElementStatus!==Xs.PLAYING)}get processorDestination(){return this._processorDestination}get processorContext(){return this._processorContext}set processorContext(r){this._processorContext=r}get __className__(){return"LocalVideoTrack"}constructor(r,s,a,c,d,h){if(super(r,d),Re(this,"trackMediaType",Xv.VIDEO),Re(this,"_player",void 0),Re(this,"isUseScaleResolutionDownBy",!1),Re(this,"_videoVisibleTimer",null),Re(this,"_previousVideoVisibleStatus",void 0),Re(this,"_clearPreviousVideoVisibleStatus",()=>this._previousVideoVisibleStatus=void 0),Re(this,"_encoderConfig",void 0),Re(this,"_scalabilityMode",{numSpatialLayers:1,numTemporalLayers:1}),Re(this,"_optimizationMode",void 0),Re(this,"_saveEncodeBitrateRatio",1),Re(this,"_videoHeight",void 0),Re(this,"_videoWidth",void 0),Re(this,"_forceBitrateLimit",void 0),Re(this,"_enabled",!0),Re(this,"_processorDestination",void 0),Re(this,"_processorContext",void 0),xs()){const{width:m,height:g}=r.getSettings();this._videoWidth=m,this._videoHeight=g}else this.updateMediaStreamTrackResolution();if(this._scalabilityMode=a,this._optimizationMode=c,this._hints=h||[],s&&this._hints.indexOf(yr.CUSTOM_TRACK)!==-1?this._encoderConfig=Kr(s):this._encoderConfig=s,this._hints.indexOf(yr.SCREEN_TRACK)===-1)this.updateBitrateFromProfile();else if(AL(Hn.CHROME,115)&&uP().indexOf("Windows")!==-1){const m=function(g,E){if("VideoFrame"in window&&"TransformStream"in window&&jn().supportWebRTCInsertableStream){const b=new MediaStreamTrackProcessor(g),I=new MediaStreamTrackGenerator({kind:"video"});let A,k,W=Date.now();const j=()=>{B&&(clearInterval(B),B=void 0),A&&(A.close(),A=void 0),g.stop(),k=void 0,I.removeEventListener("ended",j)};let B=window.setInterval(()=>{if(k&&A&&Date.now()-W>1e3)try{I.readyState==="live"?k.enqueue(A.clone()):j()}catch{j()}},1e3);const ee=new TransformStream({transform:(Z,oe)=>{I.readyState==="live"?(k=oe,W=Date.now(),A===void 0?(A=Z,oe.enqueue(Z.clone())):(oe.enqueue(A),A=Z)):Z.close()}});return I.addEventListener("ended",j),b.readable.pipeThrough(ee).pipeTo(I.writable),I}}(r);m&&(x.info("local screen video track begin to inject frame"),this._mediaStreamTrack=m)}s&&this._hints.indexOf(yr.CUSTOM_TRACK)!==-1&&this.setEncoderConfiguration(s),this._processorContext=new i9(this.getTrackId(),"local"),this._processorDestination=new r9(this.processorContext),this.bindProcessorDestinationEvents()}play(r){let s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(typeof r=="string"){const c=document.getElementById(r);c?r=c:(x.warning("[".concat(this.getTrackId(),'] can not find "#').concat(r,'" element, use document.body')),r=document.body)}x.debug("[".concat(this.getTrackId(),"] start video playback in ").concat(r instanceof HTMLVideoElement?"HTMLVideoElement":"HTMLElement"),JSON.stringify(s));const a=Ar(Ar(Ar({},this._getDefaultPlayerConfig()),s),{},{trackId:this.getTrackId(),element:r});this._player?this._player.updateConfig(a):(r instanceof HTMLVideoElement?this._player=new f2(a):this._player=new m2(a),this._player.updateVideoTrack(this._mediaStreamTrack)),this._player.play(),this._videoVisibleTimer&&window.clearInterval(this._videoVisibleTimer),this._clearPreviousVideoVisibleStatus(),this._videoVisibleTimer=window.setInterval(()=>{try{const c=this.getVideoElementVisibleStatus();this.safeEmit(Yv.VIDEO_ELEMENT_VISIBLE_STATUS,c)}catch{}},se("CHECK_VIDEO_VISIBLE_INTERVAL"))}stop(){this._player&&(this._videoVisibleTimer&&(window.clearInterval(this._videoVisibleTimer),this._videoVisibleTimer=null),this._clearPreviousVideoVisibleStatus(),this._player.destroy(),this._player=void 0,x.debug("[".concat(this.getTrackId(),"] stop video playback")))}async setEnabled(r,s){if(!s){if(r===this._enabled)return;this.stateCheck("enabled",r)}if(x.info("[".concat(this.getTrackId(),"] start setEnabled"),r),!r){this._originMediaStreamTrack.enabled=!1;try{await Er(this,Tt.NEED_DISABLE_TRACK,this)}catch(a){throw x.error("[".concat(this.getTrackId(),"] setEnabled to false error"),a.toString()),a}return s||(this._enabled=!1),void x.info("[".concat(this.getTrackId(),"] setEnabled to false success"))}this._originMediaStreamTrack.enabled=!0;try{await Er(this,Tt.NEED_ENABLE_TRACK,this)}catch(a){throw x.error("[".concat(this.getTrackId(),"] setEnabled to true error"),a.toString()),a}x.info("[".concat(this.getTrackId(),"] setEnabled to true success")),s||(this._enabled=!0)}async setMuted(r){r!==this._muted&&(this.stateCheck("muted",r),this._muted=r,this._originMediaStreamTrack.enabled=!r,x.debug("[".concat(this.getTrackId(),"] start set muted: ").concat(r)),r?await Er(this,Tt.NEED_MUTE_TRACK,this):await Er(this,Tt.NEED_UNMUTE_TRACK,this))}async setSaveEncodeBitrateRatio(){let r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this._saveEncodeBitrateRatio;if(this._saveEncodeBitrateRatio!==1&&this._encoderConfig&&this._encoderConfig.bitrateMax&&this._encoderConfig.bitrateMin){this._encoderConfig.bitrateMin=Math.floor(this._encoderConfig.bitrateMin*r),this._encoderConfig.bitrateMax=Math.floor(this._encoderConfig.bitrateMax*r),x.debug("[".concat(this.getTrackId(),"] set save encode bitrate ratio, ").concat(r)),this._saveEncodeBitrateRatio=1;try{await Er(this,Tt.NEED_UPDATE_VIDEO_ENCODER,this)}catch(s){return s.throw(x)}}}async setEncoderConfiguration(r,s){if(!this._enabled)throw new Le(te.TRACK_IS_DISABLED,"can not set encoder configuration when track is disabled");if(r=Uu(r),se("USE_STANDARD_BITRATE_DEFAULT")&&(delete r.bitrateMax,delete r.bitrateMin),this._forceBitrateLimit&&(r.bitrateMax=this._forceBitrateLimit.max_bitrate?this._forceBitrateLimit.max_bitrate:r.bitrateMax,r.bitrateMin=this._forceBitrateLimit.min_bitrate?this._forceBitrateLimit.min_bitrate:r.bitrateMin),r.width||r.height||r.frameRate){const a=RP({encoderConfig:r});(xs()||fo()||xu())&&(a.deviceId=void 0),x.debug("[".concat(this.getTrackId(),"] setEncoderConfiguration applyConstraints"),JSON.stringify(r),JSON.stringify(a));try{await this._originMediaStreamTrack.applyConstraints(a),this.updateMediaStreamTrackResolution()}catch(c){const d=new Le(te.UNEXPECTED_ERROR,c.toString());throw x.error("[".concat(this.getTrackId(),"] applyConstraints error"),d.toString()),d}}this._encoderConfig=r,this._hints.indexOf(yr.SCREEN_TRACK)===-1&&this.updateBitrateFromProfile();try{await Er(this,Tt.NEED_UPDATE_VIDEO_ENCODER,this)}catch(a){return a.throw(x)}}getStats(){return Wm(()=>{x.warning("[deprecated] LocalVideoTrack.getStats will be removed in the future, use AgoraRTCClient.getLocalVideoStats instead")},"localVideoTrackGetStatsWarning"),Yc(this,Tt.GET_STATS)||Ar({},o2)}async setBeautyEffect(r){x.error("LocalVideoTrack.setBeautyEffect was deprecated, please migrate to agora-extension-beauty-effect")}getCurrentFrameData(){return this._player?this._player.getCurrentFrame():new ImageData(2,2)}async getCurrentFrameImage(r){let s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1;return this._player?this._player.getCurrentFrameToUint8Array(r,s):await p2(r)}async findClosestProfile(){const{width:r,height:s,frameRate:a}=this.getMediaStreamTrackSettings(),{width:c,height:d,frameRate:h}=this._encoderConfig||{},m=zv(this._videoWidth||r||c||0),g=zv(this._videoHeight||s||d||0),E=function(b,I,A){if(!Array.isArray(se("VIDEO_ENCODER_CONFIG_LIST"))||se("VIDEO_ENCODER_CONFIG_LIST").length===0)return!1;const k=Math.min(b,I);return!(k>=480)&&Ar(Ar({},se("VIDEO_ENCODER_CONFIG_LIST").find(W=>W.height>k)),{},{frameRate:A})}(m,g,zv(a||h||15));if(E)return x.debug("[".concat(this.getTrackId(),"] find closest profile, ").concat(m,"x").concat(g," => ").concat(JSON.stringify(E))),this.setEncoderConfiguration(E)}async setBitrateLimit(r){x.debug("[".concat(this.getTrackId(),"] set bitrate limit, ").concat(JSON.stringify(r))),r&&(this._forceBitrateLimit=r,this._encoderConfig&&(this._encoderConfig.bitrateMax?this._encoderConfig.bitrateMax=this._encoderConfig.bitrateMax<r.max_bitrate?this._encoderConfig.bitrateMax:r.max_bitrate:this._encoderConfig.bitrateMax=r.max_bitrate,this._encoderConfig.bitrateMin,this._encoderConfig.bitrateMin=r.min_bitrate))}async setOptimizationMode(r){if(r!=="motion"&&r!=="detail"&&r!=="balanced")return void x.error(te.INVALID_PARAMS,"optimization mode must be motion, detail or balanced");const s=this._optimizationMode;try{this._optimizationMode=r,await Er(this,Tt.NEED_UPDATE_VIDEO_SEND_PARAMETERS,this)}catch(a){throw this._optimizationMode=s,x.error("[".concat(this.getTrackId(),"] set optimization mode failed"),a.toString()),a}x.info("[".concat(this.getTrackId(),"] set optimization mode success (").concat(r,")"))}setScalabiltyMode(r){if(r.numSpatialLayers===1&&r.numTemporalLayers!==1)return x.error(te.INVALID_PARAMS,"scalability mode currently not supported, no SVC."),void(this._scalabilityMode={numSpatialLayers:1,numTemporalLayers:1});this._scalabilityMode=r,x.info("[".concat(this.getTrackId(),"] set scalability mode success (").concat(r,")"))}updateMediaStreamTrackResolution(){a9(this._originMediaStreamTrack).then(r=>{let[s,a]=r;this._videoHeight=a,this._videoWidth=s}).catch(mP)}_updatePlayerSource(){this._player&&this._player.updateVideoTrack(this._mediaStreamTrack)}_getDefaultPlayerConfig(){return{fit:"contain"}}async setSenderConfiguration(r){if(!this._enabled)throw new Le(te.TRACK_IS_DISABLED,"can not set encoder configuration when track is disabled");x.debug("[".concat(this.getTrackId(),"] setSenderConfiguration applyConstraints"),JSON.stringify(r)),r=Uu(r),this._forceBitrateLimit&&(r.bitrateMax=this._forceBitrateLimit.max_bitrate?this._forceBitrateLimit.max_bitrate:r.bitrateMax,r.bitrateMin=this._forceBitrateLimit.min_bitrate?this._forceBitrateLimit.min_bitrate:r.bitrateMin),this._encoderConfig=r,this._hints.indexOf(yr.SCREEN_TRACK)===-1&&this.updateBitrateFromProfile();try{await Er(this,Tt.NEED_UPDATE_VIDEO_ENCODER,this)}catch(s){return s.throw(x)}}updateBitrateFromProfile(){if(!this._encoderConfig)return;const{width:r,height:s,frameRate:a}=this.getMediaStreamTrackSettings();if(!r||!s||!a)return;const{bitrateMax:c,bitrateMin:d}=this._encoderConfig;if(d==null||c==null){const{max:h,min:m}=function(g,E,b,I,A){const k=se("BITRATE_ADAPTER_TYPE");if(k==="DEFAULT_BITRATE")return{min:I,max:A};if(A===void 0){const W=Math.floor(200*Math.pow(b/15,.6)*Math.pow(g*E/640/360,.75));A=k==="STANDARD_BITRATE"?4*W:2*W,I=I??W}else I=I??Math.floor(A/10);return{min:I,max:A}}(r,s,a,d,c);if(this._encoderConfig.bitrateMin=m,this._encoderConfig.bitrateMax=h,se("VIDEO_STANDARD_BITRATE_VERSION")&&d==null&&c==null){const[g,E]=function(b,I,A){const k=4*Math.floor(2e5*Math.pow(A/15,.6)*Math.pow(b*I/230400,.75)),W=b*I,j=new Map([[19200,.9],[230400,.85],[518400,.75],[921600,.7],[2073600,.6],[3686400,.5]]),B=new Map([[230400,.95],[518400,.9],[921600,.85],[2073600,.8]]);let ee=Sc(j).call(j).next().value,Z=1;if(j.has(W))ee=j.get(W);else{var oe;const Je=G_(oe=Array.from(j.entries())).call(oe,(vn,Xt)=>{let[nr]=vn,[Kn]=Xt;return nr-Kn}),hn=Je.find(vn=>{let[Xt]=vn;return Xt>W});if(hn){const vn=Je.indexOf(hn);if(vn>0){const Xt=Je[vn-1],nr=(W-Xt[0])/(hn[0]-Xt[0]);ee=Xt[1]+nr*(hn[1]-Xt[1])}else ee=hn[1]}else ee=Je[Je.length-1][1]}if(B.has(W))Z=B.get(W);else{var ye;const Je=G_(ye=Array.from(B.entries())).call(ye,(vn,Xt)=>{let[nr]=vn,[Kn]=Xt;return nr-Kn}),hn=Je.find(vn=>{let[Xt]=vn;return Xt>W});if(hn){const vn=Je.indexOf(hn);if(vn>0){const Xt=Je[vn-1],nr=(W-Xt[0])/(hn[0]-Xt[0]);Z=Xt[1]+nr*(hn[1]-Xt[1])}else Z=hn[1]}else Z=Je[Je.length-1][1]}const _e=se("VIDEO_NEW_BITRATE_RATIO");_e&&_e>0&&(ee=_e/100);const ue=Math.floor(k*ee),Ce=Math.floor(65e4*Math.pow(b*I/230400,.5)*Math.pow(A/15,.69));let Ue=ue;const ze=se("VIDEO_STANDARD_BITRATE_VERSION");return ze&&ze>0&&(ze===1?Ue=k:ze===2?Ue=ue:ze===3&&(Ue=Ce)),[Math.floor(Ue/1e3),Z]}(r,s,a);this._encoderConfig.bitrateMax=g,this._encoderConfig.bitrateMin=m?Math.min(m,g):g,this._saveEncodeBitrateRatio=E,x.debug("[".concat(this.getTrackId(),"] update new bitrate from profile, [w: ").concat(r,", h: ").concat(s,", fps: ").concat(a,"] => [brMax: ").concat(this._encoderConfig.bitrateMax,", brMin: ").concat(this._encoderConfig.bitrateMin,", save_bitrate_ratio: ").concat(this._saveEncodeBitrateRatio,"]"))}else x.debug("[".concat(this.getTrackId(),"] update bitrate from profile, [w: ").concat(r,", h: ").concat(s,", fps: ").concat(a,"] => [brMax: ").concat(h,", brMin: ").concat(m,"]")),this._saveEncodeBitrateRatio=1}}getVideoElementVisibleStatus(){try{var r,s;const a=this==null||(r=this._player)===null||r===void 0?void 0:r.getContainerElement(),c={track:this,element:this==null||(s=this._player)===null||s===void 0?void 0:s.getVideoElement(),slot:a==null?void 0:a.parentElement},{element:d,slot:h}=c;if(this.isPlaying&&d instanceof HTMLVideoElement&&h instanceof HTMLElement){const m=cW.checkOneElementVisible(d),g=Object.assign({},m);if(g.visible!==this._previousVideoVisibleStatus){this._previousVideoVisibleStatus=g.visible;const E=At.reportApiInvoke(null,{tag:$r.TRACER,name:di.LOCAL_VIDEO_TRACK_GET_VIDEO_VISIBLE,options:[this.getTrackId()]});g.visible?E.onSuccess("Video is visible"):E.onSuccess("Invisible because of ".concat(g.reason))}return g}return}catch(a){throw new Le(te.GET_VIDEO_ELEMENT_VISIBLE_ERROR,a.message)}}async renewMediaStreamTrack(r){}pipe(r){if(this.processor===r)return r;if(r._source)throw new Le(te.INVALID_OPERATION,"Processor ".concat(r.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=r,this.processor._source=this,r.updateInput({track:this._originMediaStreamTrack,context:this.processorContext}),r}unpipe(){if(!this.processor)return;const r=this.processor;this.processor._source=void 0,this.processor=void 0,r.reset()}close(){super.close(),this.unbindProcessorDestinationEvents(),this.unbindProcessorContextEvents(),this.unpipe(),this.processorDestination._source&&this.processorDestination._source.unpipe()}clone(r){let s=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1],a=this._encoderConfig;r&&(a=Ar(Ar({},a),Uu(r))),a=Z_(a);const c=vr(8,"track-video-cloned-"),d=new Gae(s?this._mediaStreamTrack.clone():this._mediaStreamTrack,a,Z_(this._scalabilityMode),this._optimizationMode,c,Z_(this._hints));return r&&a&&d.setEncoderConfiguration(a),x.debug("clone video track from ".concat(this.getTrackId()," to ").concat(c,", clone ").concat(s)),d}async replaceTrack(r,s){if(!(r instanceof MediaStreamTrack))throw new Le(te.INVALID_PARAMS,"track should be an instance of MediaStreamTrack");if(r.kind!=="video")throw new Le(te.INVALID_PARAMS,"track should be a video MediaStreamTrack");await this._updateOriginMediaStreamTrack(r,s,!0),this.updateMediaStreamTrackResolution()}sendSeiData(r){if(Wm(()=>{At.reportApiInvoke(null,{name:di.LOCAL_VIDEO_SEND_SEI_DATA,options:[],tag:$r.TRACER}).onSuccess("")},this._mediaStreamTrack.id||this.getTrackId()),!se("ENABLE_VIDEO_SEI")||!se("ENABLE_ENCODED_TRANSFORM"))return void x.warning('To send/receive SEI, please call AgoraRTC.setParameter("ENABLE_VIDEO_SEI", true) before instantiate IAgoraRtcClient');if(r instanceof Uint8Array==0)return new Le(te.INVALID_PARAMS,"Invalid argument type, ILocalVideoTrack.sendSeiData() only accept Uint8Array argument.").throw();const s=this.getRTCRtpTransceiver();if(!s)return void x.warning("Video track is not published, SEI can not be send");const a=s.sender.getParameters();if(a.codecs.length===0)return;const c=a.codecs[0].mimeType.toLocaleLowerCase();c==="video/h264"||c==="video/h265"?this.safeEmit("sei-to-send",r):x.warning("SEI is not supported by ".concat(c))}bindProcessorDestinationEvents(){this.processorDestination.on(ea.ON_TRACK,async r=>{r?r!==this._mediaStreamTrack&&(this._mediaStreamTrack=r,this._updatePlayerSource(),await Er(this,Tt.NEED_REPLACE_TRACK,this)):this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource(),await Er(this,Tt.NEED_REPLACE_TRACK,this))})}unbindProcessorDestinationEvents(){this.processorDestination.removeAllListeners(ea.ON_TRACK)}unbindProcessorContextEvents(){this.processorContext.removeAllListeners(Qc.REQUEST_UPDATE_CONSTRAINTS),this.processorContext.removeAllListeners(Qc.REQUEST_CONSTRAINTS)}},Dn(bn.prototype,"play",[Q9,Z9],Object.getOwnPropertyDescriptor(bn.prototype,"play"),bn.prototype),Dn(bn.prototype,"stop",[eG],Object.getOwnPropertyDescriptor(bn.prototype,"stop"),bn.prototype),Dn(bn.prototype,"setEnabled",[tG,nG,rG],Object.getOwnPropertyDescriptor(bn.prototype,"setEnabled"),bn.prototype),Dn(bn.prototype,"setMuted",[iG,sG,oG],Object.getOwnPropertyDescriptor(bn.prototype,"setMuted"),bn.prototype),Dn(bn.prototype,"setSaveEncodeBitrateRatio",[aG,cG],Object.getOwnPropertyDescriptor(bn.prototype,"setSaveEncodeBitrateRatio"),bn.prototype),Dn(bn.prototype,"setEncoderConfiguration",[lG,uG],Object.getOwnPropertyDescriptor(bn.prototype,"setEncoderConfiguration"),bn.prototype),Dn(bn.prototype,"getStats",[dG],Object.getOwnPropertyDescriptor(bn.prototype,"getStats"),bn.prototype),Dn(bn.prototype,"setBeautyEffect",[hG,pG],Object.getOwnPropertyDescriptor(bn.prototype,"setBeautyEffect"),bn.prototype),Dn(bn.prototype,"getCurrentFrameData",[fG],Object.getOwnPropertyDescriptor(bn.prototype,"getCurrentFrameData"),bn.prototype),Dn(bn.prototype,"getCurrentFrameImage",[mG],Object.getOwnPropertyDescriptor(bn.prototype,"getCurrentFrameImage"),bn.prototype),Dn(bn.prototype,"findClosestProfile",[gG,_G],Object.getOwnPropertyDescriptor(bn.prototype,"findClosestProfile"),bn.prototype),Dn(bn.prototype,"setBitrateLimit",[yG],Object.getOwnPropertyDescriptor(bn.prototype,"setBitrateLimit"),bn.prototype),Dn(bn.prototype,"setOptimizationMode",[EG],Object.getOwnPropertyDescriptor(bn.prototype,"setOptimizationMode"),bn.prototype),Dn(bn.prototype,"setScalabiltyMode",[vG],Object.getOwnPropertyDescriptor(bn.prototype,"setScalabiltyMode"),bn.prototype),Dn(bn.prototype,"updateMediaStreamTrackResolution",[SG],Object.getOwnPropertyDescriptor(bn.prototype,"updateMediaStreamTrackResolution"),bn.prototype),Dn(bn.prototype,"pipe",[bG],Object.getOwnPropertyDescriptor(bn.prototype,"pipe"),bn.prototype),Dn(bn.prototype,"unpipe",[wG],Object.getOwnPropertyDescriptor(bn.prototype,"unpipe"),bn.prototype),Dn(bn.prototype,"close",[TG],Object.getOwnPropertyDescriptor(bn.prototype,"close"),bn.prototype),Dn(bn.prototype,"replaceTrack",[CG],Object.getOwnPropertyDescriptor(bn.prototype,"replaceTrack"),bn.prototype),bn),IP=(RG=Gt({argsMap:(t,r)=>[t.getTrackId(),r]}),IG=ai(),AG=Wv("CameraVideoTrack","_enabledMutex"),PG=Gt({argsMap:(t,r)=>[t.getTrackId(),r]}),kG=ai(),OG=Gt({argsMap:(t,r)=>[t.getTrackId(),r]}),NG=ai(),DG=Gt({argsMap:t=>[t.getTrackId()]}),rl=class Hae extends Dr{get __className__(){return"CameraVideoTrack"}constructor(r,s,a,c,d,h){super(r,Uu(s.encoderConfig),c,d,h),Re(this,"_config",void 0),Re(this,"_originalConstraints",void 0),Re(this,"_constraints",void 0),Re(this,"_enabled",!0),Re(this,"_deviceName","default"),Re(this,"tryResumeVideoForIOS15_16WeChat",async()=>{(Fv()||DL())&&!function(){const m=xn();if(m.os!==is.IOS||!m.osVersion)return!1;const g=m.osVersion.split(".");return Number(g[0])===15&&Number(g[1])>=2}()&&iW()&&this._enabled&&!this._isClosed&&(x.debug("[".concat(this.getTrackId(),"] try capture camera media device for interrupted iOS 15 device on WeChat.")),await this.renewMediaStreamTrack())}),this._config=s,this._originalConstraints=a,this._constraints=a,this._deviceName=r.label,this._encoderConfig=Uu(this._config.encoderConfig),fr.on(Ts.IOS_15_16_INTERRUPTION_END,this.tryResumeVideoForIOS15_16WeChat),fr.on(Ts.IOS_INTERRUPTION_END,this.tryResumeVideoForIOS15_16WeChat),this.bindProcessorContextEvents()}async setDevice(r){return typeof r=="string"?this._setDeviceById(r):r.deviceId?this._setDeviceById(r.deviceId):r.facingMode?this._setDeviceByFacingModel(r.facingMode):void 0}async _setDeviceById(r){if(x.info("[".concat(this.getTrackId(),"] set device to ").concat(r)),this._enabled)try{const s=await tl.getDeviceById(r),a={};a.video=Ar({},this._constraints),a.video.deviceId={exact:r},a.video.facingMode=void 0,this._originMediaStreamTrack.stop();let c=null;try{c=await el(a,this.getTrackId())}catch(d){throw x.error("[".concat(this.getTrackId(),"] setDevice failed"),d.toString()),c=await el({video:this._constraints},this.getTrackId()),await this._updateOriginMediaStreamTrack(c.getVideoTracks()[0],!1),d}await this._updateOriginMediaStreamTrack(c.getVideoTracks()[0],!1),this.updateMediaStreamTrackResolution(),this._deviceName=s.label,this._config.cameraId=r,this._constraints.deviceId={exact:r}}catch(s){throw x.error("[".concat(this.getTrackId(),"] setDevice error"),s.toString()),s}else try{const s=await tl.getDeviceById(r);this._deviceName=s.label,this._config.cameraId=r,this._constraints.deviceId={exact:r}}catch(s){throw x.error("[".concat(this.getTrackId(),"] setDevice error"),s.toString()),s}x.info("[".concat(this.getTrackId(),"] setDevice success"))}async _setDeviceByFacingModel(r){x.info("[".concat(this.getTrackId(),"] set facingMode ").concat(r));const s={video:Ar(Ar({},this._constraints),{},{deviceId:void 0,facingMode:{exact:r}})};if(this._enabled){this._originMediaStreamTrack.stop();let a=null;try{a=await el(s,this.getTrackId())}catch(c){throw x.error("[".concat(this.getTrackId(),"] setDeviceByFacingModel failed"),c.toString()),a=await el({video:this._constraints},this.getTrackId()),await this._updateOriginMediaStreamTrack(a.getVideoTracks()[0],!1),c}await this._updateOriginMediaStreamTrack(a.getVideoTracks()[0],!1),this.updateMediaStreamTrackResolution()}this._deviceName="",this._config.facingMode=r,this._config.cameraId=void 0,this._constraints=Ar({},s.video),x.info("[".concat(this.getTrackId(),"] setDeviceByFacingModel success"))}async setEnabled(r,s){if(!s){if(r===this._enabled)return;this.stateCheck("enabled",r)}if(x.info("[".concat(this.getTrackId(),"] start setEnabled"),r),r){try{if(this.isExternalTrack)this._originMediaStreamTrack.enabled=!0;else{const a=await el({video:this._constraints},this.getTrackId());await this._updateOriginMediaStreamTrack(a.getVideoTracks()[0],!1)}await Er(this,Tt.NEED_ENABLE_TRACK,this)}catch(a){throw x.error("[".concat(this.getTrackId(),"] setEnabled true error"),a.toString()),a}this.updateMediaStreamTrackResolution(),x.info("[".concat(this.getTrackId(),"] setEnabled to true success")),s||(this._enabled=!0)}else{this.isExternalTrack?this._originMediaStreamTrack.enabled=!1:(this._originMediaStreamTrack.onended=null,this._originMediaStreamTrack.stop()),s||(this._enabled=!1);try{await Er(this,Tt.NEED_DISABLE_TRACK,this)}catch(a){throw x.error("[".concat(this.getTrackId(),"] setEnabled to false error"),a.toString()),a}x.info("[".concat(this.getTrackId(),"] setEnabled to false success"))}}async setEncoderConfiguration(r,s){if(!this._enabled)throw new Le(te.TRACK_IS_DISABLED,"can not set encoder configuration when track is disabled");r=Uu(r),se("USE_STANDARD_BITRATE_DEFAULT")&&(delete r.bitrateMax,delete r.bitrateMin),this._forceBitrateLimit&&(r.bitrateMax=this._forceBitrateLimit.max_bitrate||r.bitrateMax,r.bitrateMin=this._forceBitrateLimit.min_bitrate||r.bitrateMin);const a=Kr(this._config);a.encoderConfig=r;const c=RP(a);(xs()||fo()||xu())&&(c.deviceId=void 0),x.debug("[".concat(this.getTrackId(),"] setEncoderConfiguration applyConstraints"),JSON.stringify(r),JSON.stringify(c));try{await this._originMediaStreamTrack.applyConstraints(c),this.updateMediaStreamTrackResolution()}catch(d){const h=new Le(te.UNEXPECTED_ERROR,d.toString());throw x.error("[".concat(this.getTrackId(),"] applyConstraints error"),h.toString()),h}this._config=a,this._constraints=c,this._originalConstraints=c,this._encoderConfig=r,this._hints.indexOf(yr.SCREEN_TRACK)===-1&&this.updateBitrateFromProfile();try{await Er(this,Tt.NEED_UPDATE_VIDEO_ENCODER,this)}catch(d){return d.throw(x)}}_getDefaultPlayerConfig(){return{mirror:!0,fit:"cover"}}onTrackEnded(){if((fo()||xu())&&this._enabled&&!this._isClosed&&fr.duringInterruption){const r=async()=>{fr.off(Ts.IOS_INTERRUPTION_END,r),this._enabled&&!this._isClosed&&(x.debug("[".concat(this.getTrackId(),"] try capture camera media device for interrupted iOS device.")),await this.setEnabled(!1),await this.setEnabled(!0))};fr.on(Ts.IOS_INTERRUPTION_END,r)}else x.debug("[".concat(this.getTrackId(),"] track ended")),this.safeEmit(Yv.TRACK_ENDED)}async renewMediaStreamTrack(r){const s=r||this._constraints,a=tl.searchDeviceIdByName(this._deviceName);if(a&&!s.deviceId&&(s.deviceId={exact:a}),this._enabled){const c=await el({video:s},this.getTrackId());this._constraints=s,await this._updateOriginMediaStreamTrack(c.getVideoTracks()[0],!0),this.updateMediaStreamTrackResolution()}}close(){super.close(),fr.off(Ts.IOS_15_16_INTERRUPTION_END,this.tryResumeVideoForIOS15_16WeChat),fr.off(Ts.IOS_INTERRUPTION_END,this.tryResumeVideoForIOS15_16WeChat)}clone(r){let s=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1],a=this._encoderConfig;r&&(a=Ar(Ar({},a),Uu(r))),a=Z_(a);const c=vr(8,"track-cam-cloned-"),d=new Hae(s?this._mediaStreamTrack.clone():this._mediaStreamTrack,Z_(Ar(Ar({},this._config),{},{encoderConfig:a})),Z_(this._constraints),Z_(this._scalabilityMode),this._optimizationMode,c);return r&&a&&d.setEncoderConfiguration(a),x.debug("clone track from ".concat(this.getTrackId()," to ").concat(c,", clone ").concat(s)),d}bindProcessorContextEvents(){this.processorContext.on(Qc.REQUEST_UPDATE_CONSTRAINTS,async(r,s,a)=>{try{const c=Object.assign({},this._originalConstraints,...r);await this.renewMediaStreamTrack(c),s()}catch(c){a(c)}}),this.processorContext.on(Qc.REQUEST_CONSTRAINTS,async r=>{r(this._originMediaStreamTrack.getSettings())})}},Dn(rl.prototype,"setDevice",[RG,IG],Object.getOwnPropertyDescriptor(rl.prototype,"setDevice"),rl.prototype),Dn(rl.prototype,"setEnabled",[AG,PG,kG],Object.getOwnPropertyDescriptor(rl.prototype,"setEnabled"),rl.prototype),Dn(rl.prototype,"setEncoderConfiguration",[OG,NG],Object.getOwnPropertyDescriptor(rl.prototype,"setEncoderConfiguration"),rl.prototype),Dn(rl.prototype,"close",[DG],Object.getOwnPropertyDescriptor(rl.prototype,"close"),rl.prototype),rl);function g2(t,r,s,a){s.optimizationMode&&(a&&a.width&&a.height?(s.encoderConfig=Ar(Ar({},a),{},{bitrateMin:a.bitrateMin,bitrateMax:a.bitrateMax}),s.optimizationMode!=="motion"&&s.optimizationMode!=="detail"||(r.contentHint=s.optimizationMode,r.contentHint===s.optimizationMode?x.debug("[".concat(t,"] set content hint to"),s.optimizationMode):x.debug("[".concat(t,"] set content hint failed")))):x.warning("[".concat(t,"] can not apply optimization mode bitrate config, no encoderConfig")))}var xG,LG,MG,UG,Gl,VG,FG,jG,BG,zG,WG,Po;class GG extends $W{getUserId(){return this._userId}constructor(r,s,a,c){super(r,"track-".concat(r.kind,"-").concat(s,"-").concat(c.clientId,"_").concat(vr(5,""))),Re(this,"_userId",void 0),Re(this,"_uintId",void 0),Re(this,"_isDestroyed",!1),Re(this,"store",void 0),Re(this,"processor",void 0),Re(this,"processorContext",void 0),this._userId=s,this._uintId=a,this.store=c}_updateOriginMediaStreamTrack(r){this._originMediaStreamTrack=r,this._mediaStreamTrack=r,this._updatePlayerSource(),this.processor&&this.processor.updateInput({track:this._originMediaStreamTrack,context:this.processorContext})}_destroy(){this._isDestroyed=!0,x.info("[".concat(this.getTrackId(),"] is destroyed")),this.stop(),super.close()}getProcessorStats(){return this.processorContext.gatherStats()}getProcessorUsage(){return this.processorContext.gatherUsage()}}let e0=(xG=Gt({argsMap:(t,r,s)=>[t.getTrackId(),typeof r=="string"?r:r instanceof HTMLVideoElement?"HTMLVideoElement":"HTMLElement",s]}),LG=Gt({argsMap:t=>[t.getTrackId()]}),MG=Gt({argsMap:(t,r)=>[t.getTrackId(),r.name]}),UG=Gt({argsMap:t=>[t.getTrackId()]}),Dn((Gl=class extends GG{get isPlaying(){return!(!this._player||this._player.videoElementStatus!==Xs.PLAYING)}get __className__(){return"RemoteVideoTrack"}constructor(t,r,s,a,c){super(t,r,s,a),Re(this,"_videoVisibleTimer",null),Re(this,"_previousVideoVisibleStatus",void 0),Re(this,"_clearPreviousVideoVisibleStatus",()=>this._previousVideoVisibleStatus=void 0),Re(this,"trackMediaType",Xv.VIDEO),Re(this,"_videoWidth",void 0),Re(this,"_videoHeight",void 0),Re(this,"_player",void 0),Re(this,"_prePlayer",void 0),Re(this,"processorDestination",void 0),Re(this,"processorContext",void 0),this._prePlayer=c,this.updateMediaStreamTrackResolution(),this.processorContext=new i9(this.getTrackId(),"remote"),this.processorDestination=new r9(this.processorContext),this.bindProcessorDestinationEvents()}getStats(){return Wm(()=>{x.warning("[deprecated] RemoteVideoTrack.getStats will be removed in the future, use AgoraRTCClient.getRemoteVideoStats instead")},"remoteVideoTrackGetStatsWarning"),Yc(this,Tt.GET_STATS)||Ar({},GW)}play(t){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(this.safeEmit(Wl.PLAY_START),typeof t=="string"){const a=document.getElementById(t);a?t=a:(x.warning("[".concat(this.getTrackId(),'] can not find "#').concat(t,'" element, use document.body')),t=document.body)}x.debug("[".concat(this.getTrackId(),"] start video playback in ").concat(t instanceof HTMLVideoElement?"HTMLVideoElement":"HTMLElement"),JSON.stringify(r));const s=Ar(Ar({fit:"cover"},r),{},{trackId:this.getTrackId(),element:t});if(this._player)this._player.updateConfig(s);else{let a=!1,c=!1;t instanceof HTMLVideoElement?(this._player=new f2(s),this._prePlayer&&(this._prePlayer.destroy(),this._prePlayer=void 0,c=!0)):this._prePlayer&&!this._prePlayer.isDestroyed?(this._player=this._prePlayer,this._prePlayer=void 0,a=this._player.videoState>0,this._player.updateConfig(s)):this._player=new m2(s),this._player.updateVideoTrack(this._mediaStreamTrack),this._player.onFirstVideoFrameDecoded=()=>{this.store.subscribe(this.getUserId(),"video",void 0,void 0,Date.now()),this.safeEmit(Wl.FIRST_FRAME_DECODED),c&&this.safeEmit(Wl.FIRST_FRAME_RENDER)},this._player.onVideoStateChanged=d=>{this.safeEmit(Wl.VIDEO_STATE_CHANGED,d)},a&&(this._player.onFirstVideoFrameDecoded(),this._player.onVideoStateChanged(this._player.videoState))}this._player.play(this.store.sessionId||void 0),this._videoVisibleTimer&&window.clearInterval(this._videoVisibleTimer),this._clearPreviousVideoVisibleStatus(),this._videoVisibleTimer=window.setInterval(()=>{try{const a=this.getVideoElementVisibleStatus();this.safeEmit(Wl.VIDEO_ELEMENT_VISIBLE_STATUS,a)}catch{}},se("CHECK_VIDEO_VISIBLE_INTERVAL")),this.safeEmit(Wl.PLAY_END)}stop(){this._player&&(this._videoVisibleTimer&&(window.clearInterval(this._videoVisibleTimer),this._videoVisibleTimer=null),this._clearPreviousVideoVisibleStatus(),this._player.destroy(),this._player=void 0,x.debug("[".concat(this.getTrackId(),"] stop video playback")))}getCurrentFrameData(){return this._player?this._player.getCurrentFrame():new ImageData(2,2)}updateMediaStreamTrackResolution(){a9(this._originMediaStreamTrack).then(t=>{let[r,s]=t;this._videoHeight=s,this._videoWidth=r}).catch(mP)}_updatePlayerSource(){x.debug("[".concat(this.getTrackId(),"] update player source track")),this._player&&this._player.updateVideoTrack(this._mediaStreamTrack)}getVideoElementVisibleStatus(){try{var t,r;const s=this==null||(t=this._player)===null||t===void 0?void 0:t.getContainerElement(),a={track:this,element:this==null||(r=this._player)===null||r===void 0?void 0:r.getVideoElement(),slot:s==null?void 0:s.parentElement},{element:c,slot:d}=a;if(this.isPlaying&&c instanceof HTMLVideoElement&&d instanceof HTMLElement){const h=cW.checkOneElementVisible(c),m=Object.assign({},h);if(m.visible!==this._previousVideoVisibleStatus){this._previousVideoVisibleStatus=m.visible;const g=At.reportApiInvoke(null,{tag:$r.TRACER,name:di.REMOTE_VIDEO_TRACK_GET_VIDEO_VISIBLE,options:[this.getTrackId()]});m.visible?g.onSuccess("Video is visible"):g.onSuccess("Invisible because of ".concat(m.reason))}return m}return}catch(s){throw new Le(te.GET_VIDEO_ELEMENT_VISIBLE_ERROR,s.message)}}pipe(t){if(this.processor===t)return t;if(t._source)throw new Le(te.INVALID_OPERATION,"Processor ".concat(t.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=t,this.processor._source=this,t.updateInput({track:this._originMediaStreamTrack,context:this.processorContext}),t}unpipe(){if(!this.processor)return;const t=this.processor;this.processor._source=void 0,this.processor=void 0,t.reset()}bindProcessorDestinationEvents(){this.processorDestination.on(ea.ON_TRACK,async t=>{t?t!==this._mediaStreamTrack&&(this._mediaStreamTrack=t,this._updatePlayerSource()):this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource())})}unbindProcessorDestinationEvents(){this.processorDestination.removeAllListeners(ea.ON_TRACK)}_destroy(){this._prePlayer&&(this._prePlayer.destroy(),this._prePlayer=void 0),super._destroy(),this.unbindProcessorDestinationEvents()}_onSei(t){this.emit(ry.SEI_RECEIVED,t)}}).prototype,"play",[xG],Object.getOwnPropertyDescriptor(Gl.prototype,"play"),Gl.prototype),Dn(Gl.prototype,"stop",[LG],Object.getOwnPropertyDescriptor(Gl.prototype,"stop"),Gl.prototype),Dn(Gl.prototype,"pipe",[MG],Object.getOwnPropertyDescriptor(Gl.prototype,"pipe"),Gl.prototype),Dn(Gl.prototype,"unpipe",[UG],Object.getOwnPropertyDescriptor(Gl.prototype,"unpipe"),Gl.prototype),Gl),t0=(VG=Gt({argsMap:(t,r)=>[t.getTrackId(),r],throttleTime:300}),FG=Gt({argsMap:(t,r)=>[t.getTrackId(),r]}),jG=Gt({argsMap:t=>[t.getTrackId()]}),BG=Gt({argsMap:t=>[t.getTrackId()]}),zG=Gt({argsMap:(t,r)=>[t.getTrackId(),r.name]}),WG=Gt({argsMap:t=>[t.getTrackId()]}),Dn((Po=class extends GG{get isPlaying(){return this._useAudioElement?ba.isPlaying(this.getTrackId()):this._source.isPlayed}get __className__(){return"RemoteAudioTrack"}constructor(t,r,s,a){super(t,r,s,a),Re(this,"trackMediaType",Xv.AUDIO),Re(this,"_source",void 0),Re(this,"_useAudioElement",!0),Re(this,"_volume",100),Re(this,"processorContext",void 0),Re(this,"processorDestination",void 0),Re(this,"_played",!1),Re(this,"_bypassWebAudio",!1),se("DISABLE_WEBAUDIO")?(this._source=new h2,this._bypassWebAudio=!0,this._useAudioElement=!0):(this._source=new XW(t,!0),se("REMOTE_AUDIO_TRACK_USES_WEB_AUDIO")&&(this._useAudioElement=!1)),this._source.once(Jc.RECEIVE_TRACK_BUFFER,()=>{this.safeEmit(Wl.FIRST_FRAME_DECODED)}),this.processorContext=new o9(this._source.context,this.getTrackId(),"remote"),this.processorDestination=new s9(this.processorContext),this.bindProcessorDestinationEvents(),this._source.on(Jc.UPDATE_SOURCE,()=>{this.processor&&this.processor.updateInput({node:this._source.processSourceNode,context:this.processorContext})})}setAudioFrameCallback(t){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:4096;if(!t)return this._source.removeAllListeners(Jc.ON_AUDIO_BUFFER),void this._source.stopGetAudioBuffer();this._source.startGetAudioBuffer(r),this._source.removeAllListeners(Jc.ON_AUDIO_BUFFER),this._source.on(Jc.ON_AUDIO_BUFFER,s=>t(s))}setVolume(t){this._volume=t,this._useAudioElement?ba.setVolume(this.getTrackId(),t):this._source.setVolume(t/100)}async setPlaybackDevice(t){if(!this._useAudioElement||!jW())throw new Le(te.NOT_SUPPORTED,"your browser does not support setting the audio output device");await ba.setSinkID(this.getTrackId(),t)}getVolumeLevel(){return this._source.getAccurateVolumeLevel()}getStats(){return Wm(()=>{x.warning("[deprecated] RemoteAudioTrack.getStats will be removed in the future, use AgoraRTCClient.getRemoteAudioStats instead")},"remoteAudioTrackGetStatsWarning"),Yc(this,Tt.GET_STATS)||Ar({},WW)}play(){x.debug("[".concat(this.getTrackId(),"] start audio playback")),this._played=!0,this._useAudioElement?(x.debug("[".concat(this.getTrackId(),"] use audio element to play")),ba.play(this._mediaStreamTrack,this.getTrackId(),this._volume,this.store.sessionId||void 0)):this._source.play()}stop(){x.debug("[".concat(this.getTrackId(),"] stop audio playback")),this._played=!1,this._useAudioElement?ba.stop(this.getTrackId()):this._source.stop()}_destroy(){super._destroy(),this._played=!1,this.unbindProcessorDestinationEvents(),this._source.destroy()}_isFreeze(){return this._source.isFreeze}_updatePlayerSource(){let t=!(arguments.length>0&&arguments[0]!==void 0)||arguments[0];x.debug("[".concat(this.getTrackId(),"] update player source track")),t&&this._source.updateTrack(this._mediaStreamTrack),this._useAudioElement&&ba.updateTrack(this.getTrackId(),this._mediaStreamTrack)}pipe(t){if(this._bypassWebAudio)throw new Le(te.NOT_SUPPORTED,"can not pipe extension when WebAudio disabled");if(this.processor===t)return t;if(t._source)throw new Le(te.INVALID_OPERATION,"Processor ".concat(t.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=t,this.processor._source=this,t.updateInput({track:this._originMediaStreamTrack,node:this._source.processSourceNode,context:this.processorContext}),t}unpipe(){var t;if(this._bypassWebAudio)throw new Le(te.NOT_SUPPORTED,"can not unpipe extension when WebAudio disabled");if(!this.processor)return;const r=this.processor;(t=this._source.processSourceNode)===null||t===void 0||t.disconnect(),this.processor._source=!1,this.processor=void 0,r.reset()}bindProcessorDestinationEvents(){this.processorDestination.on(ea.ON_TRACK,async t=>{t?t!==this._mediaStreamTrack&&(this._mediaStreamTrack=t,this._updatePlayerSource(!1),this._source.processedNode=this._source.createMediaStreamSourceNode(t)):this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource())}),this.processorDestination.on(ea.ON_NODE,t=>{this._source.processedNode=t;const r=!t;this._useAudioElement!==r&&(this._played?(this.stop(),this._useAudioElement=r,this.play()):this._useAudioElement=r)})}unbindProcessorDestinationEvents(){this.processorDestination.removeAllListeners(ea.ON_TRACK),this.processorDestination.removeAllListeners(ea.ON_NODE)}}).prototype,"setVolume",[VG],Object.getOwnPropertyDescriptor(Po.prototype,"setVolume"),Po.prototype),Dn(Po.prototype,"setPlaybackDevice",[FG],Object.getOwnPropertyDescriptor(Po.prototype,"setPlaybackDevice"),Po.prototype),Dn(Po.prototype,"play",[jG],Object.getOwnPropertyDescriptor(Po.prototype,"play"),Po.prototype),Dn(Po.prototype,"stop",[BG],Object.getOwnPropertyDescriptor(Po.prototype,"stop"),Po.prototype),Dn(Po.prototype,"pipe",[zG],Object.getOwnPropertyDescriptor(Po.prototype,"pipe"),Po.prototype),Dn(Po.prototype,"unpipe",[WG],Object.getOwnPropertyDescriptor(Po.prototype,"unpipe"),Po.prototype),Po);const qh=new class extends Jr{get visibility(){return document.visibilityState}get lastHiddenTime(){return this._lastHiddenTime}get lastVisibleTime(){return this._lastVisibleTime}constructor(){super(),Re(this,"_lastHiddenTime",0),Re(this,"_lastVisibleTime",0),document.addEventListener("visibilitychange",()=>{document.visibilityState==="hidden"?this._lastHiddenTime=performance.now():this._lastVisibleTime=performance.now(),x.debug("current web page is ".concat(document.visibilityState)),this.emit("VISIBILITY_CHANGE",document.visibilityState)})}};class HG extends Jr{constructor(r,s){super(),Re(this,"trackMediaType",Xv.DATA),Re(this,"_version",1),Re(this,"_type",3),Re(this,"_config",void 0),Re(this,"_originDataChannel",void 0),Re(this,"_dataStreamPacketHeader",new ArrayBuffer(4)),Re(this,"_dataStreamPacketHandler",{serialize:a=>a,deserialize:a=>a}),Re(this,"_datachannelEventMap",new Map),this._config=r,s&&(this._originDataChannel=s,this._bandDataChannelEvents(s)),this._initPacketHeader()}useDataStream(r){this._dataStreamPacketHandler=r}get id(){return this._config.id}get ordered(){return this._config.ordered}get maxRetransmits(){return se("DATASTREAM_MAX_RETRANSMITS")}get metadata(){return this._config.metadata}get readyState(){var r,s;return(r=(s=this._originDataChannel)===null||s===void 0?void 0:s.readyState)!==null&&r!==void 0?r:"connecting"}get _originDataChannelId(){var r,s;return(r=(s=this._originDataChannel)===null||s===void 0?void 0:s.id)!==null&&r!==void 0?r:null}getChannelId(){return this.id}getConfig(){return this._config}_close(){this._originDataChannel&&(this._unbindDataChannelEvents(this._originDataChannel),this._originDataChannel=void 0)}async _waitTillOpen(){return new pt((r,s)=>{if(this._originDataChannel){this._originDataChannel.readyState==="open"&&r();const a=setTimeout(()=>{var c;s(new Le(te.DATACHANNEL_CONNECTION_TIMEOUT,"Cannot create datachannel, id: ".concat((c=this._originDataChannel)===null||c===void 0?void 0:c.id)))},1e4);this._originDataChannel.onopen=()=>{clearTimeout(a),this._originDataChannel&&this._bandDataChannelEvents(this._originDataChannel),r()},this._originDataChannel.onerror=()=>{throw clearTimeout(a),new Le(te.DATACHANNEL_CONNECTION_TIMEOUT)}}else s(new Le(te.DATACHANNEL_CONNECTION_TIMEOUT,"cannot find dataChannel"))})}_updateOriginDataChannel(r){this._originDataChannel=r,this._bandDataChannelEvents(r)}_initPacketHeader(){const r=new DataView(this._dataStreamPacketHeader);r.setUint16(0,this._version),r.setUint8(2,this._type),r.setUint8(3,this._config.id)}_bandDataChannelEvents(r){this._unbindDataChannelEvents(r),[TP.OPEN,TP.CLOSE,TP.ERROR].forEach(s=>{const a=()=>{this.emit(s)};this._datachannelEventMap.set(s,a),r.addEventListener(s,a)})}_unbindDataChannelEvents(r){Array.from(this._datachannelEventMap.entries()).forEach(s=>{let[a,c]=s;r.removeEventListener(a,c)}),this._datachannelEventMap.clear()}}class uge extends HG{constructor(r){super(r),Re(this,"_messageListener",void 0),this._messageListener=s=>{if(s.data.byteLength<this._dataStreamPacketHeader.byteLength)throw Error("invalid byteLength: the byte length must exceed "+this._dataStreamPacketHeader.byteLength);const a=s.data.slice(0,this._dataStreamPacketHeader.byteLength),c=new DataView(a).getUint8(3);if(c!==this.id)return void(se("SHOW_DATASTREAM2_LOG")&&x.debug("invalid datachannel id: ".concat(c," !== ").concat(this.id)));let d=s.data.slice(this._dataStreamPacketHeader.byteLength);d=this._dataStreamPacketHandler.deserialize(d),this.emit(TP.MESSAGE,d)}}_updateOriginDataChannel(r){super._updateOriginDataChannel(r),this._bandRemoteDataChannelEvents()}_close(){this._originDataChannel&&(this._originDataChannel.removeEventListener("message",this._messageListener),super._close())}_bandRemoteDataChannelEvents(){this._originDataChannel&&this._originDataChannel.addEventListener("message",this._messageListener)}}class dge extends HG{send(r){if(this._originDataChannel){let s=r;s=this._dataStreamPacketHandler.serialize(r);const a=new Uint8Array(this._dataStreamPacketHeader.byteLength+s.byteLength);a.set(new Uint8Array(this._dataStreamPacketHeader),0),a.set(new Uint8Array(s),this._dataStreamPacketHeader.byteLength),this._originDataChannel.send(a.buffer)}}}function AP(){const t=new Blob([atob("Y29uc3QgdD0idmlkZW8vaDI2NCIsZT0idmlkZW8vaDI2NSI7ZnVuY3Rpb24gbih0LGUsbil7bGV0IGE9bmV3IFVpbnQ4QXJyYXkodCxlLG4pLHI9W10sbz0wO2Zvcig7ci5sZW5ndGg8bjspbyszPG4mJjA9PT1hW29dJiYwPT09YVtvKzFdJiYzPT09YVtvKzJdJiYoMD09PWFbbyszXXx8MT09PWFbbyszXXx8Mj09PWFbbyszXXx8Mz09PWFbbyszXSk/KHIucHVzaChhW29dLGFbbysxXSxhW28rM10pLG8rPTQpOihyLnB1c2goYVtvXSksbysrKTtyZXR1cm4gbmV3IFVpbnQ4QXJyYXkocil9ZnVuY3Rpb24gYShhLHIpe3N3aXRjaChyKXtjYXNlIHQ6cmV0dXJuIGZ1bmN0aW9uKHQpe2NvbnN0IGU9bmV3IERhdGFWaWV3KHQuZGF0YSk7bGV0IGE9MDtmb3IoO2ErNDx0LmRhdGEuYnl0ZUxlbmd0aDspe2lmKDA9PT1lLmdldFVpbnQ4KGErMCkmJjA9PT1lLmdldFVpbnQ4KGErMSkmJjA9PT1lLmdldFVpbnQ4KGErMikmJjE9PT1lLmdldFVpbnQ4KGErMykmJjY9PT1lLmdldFVpbnQ4KGErNCkpe2xldCByPWErNixvPTAsaT0wO2Zvcig7MjU1PT09KGk9ZS5nZXRVaW50OChyKyspKTspbys9MjU1O28rPWk7Y29uc3Qgcz1uKHQuZGF0YSxyLG8pO3JldHVybiBuZXcgVWludDhBcnJheShzKX1hKyt9cmV0dXJuIG51bGx9KGEpO2Nhc2UgZTpyZXR1cm4gZnVuY3Rpb24odCl7Y29uc3QgZT1uZXcgRGF0YVZpZXcodC5kYXRhKTtsZXQgYT0wO2Zvcig7YSs1PHQuZGF0YS5ieXRlTGVuZ3RoOyl7aWYoMD09PWUuZ2V0VWludDgoYSswKSYmMD09PWUuZ2V0VWludDgoYSsxKSYmMD09PWUuZ2V0VWludDgoYSsyKSYmMT09PWUuZ2V0VWludDgoYSszKSYmNzg9PT1lLmdldFVpbnQ4KGErNCkmJjE9PT1lLmdldFVpbnQ4KGErNSkmJjEwMT09PWUuZ2V0VWludDgoYSs2KSl7bGV0IHI9YSs3LG89MCxpPTA7Zm9yKDsyNTU9PT0oaT1lLmdldFVpbnQ4KHIrKykpOylvKz0yNTU7bys9aTtjb25zdCBzPW4odC5kYXRhLHIsbyk7cmV0dXJuIG5ldyBVaW50OEFycmF5KHMpfWErK31yZXR1cm4gbnVsbH0oYSk7ZGVmYXVsdDpyZXR1cm4gbnVsbH19ZnVuY3Rpb24gcih0KXtjb25zdCBlPXQubGVuZ3RoO2xldCBuPVtdLGE9MDtmb3IoO2E8ZTspYSsyPGUmJjA9PT10W2FdJiYwPT09dFthKzFdJiYoMD09PXRbYSsyXXx8MT09PXRbYSsyXXx8Mj09PXRbYSsyXXx8Mz09PXRbYSsyXSk/KG4ucHVzaCh0W2FdLHRbYSsxXSwzLHRbYSsyXSksYSs9Myk6KG4ucHVzaCh0W2FdKSxhKyspO3JldHVybiBuZXcgVWludDhBcnJheShuKX1mdW5jdGlvbiBvKG4sYSxvKXtzd2l0Y2gobyl7Y2FzZSB0OnJldHVybiBmdW5jdGlvbih0LGUpe2NvbnN0IG49cihlKSxhPW4ubGVuZ3RoLG89TWF0aC5mbG9vcihhLzI1NSksaT1hJTI1NSxzPW5ldyBVaW50OEFycmF5KDYrbysxK2ErdC5ieXRlTGVuZ3RoKTtzWzBdPTAsc1sxXT0wLHNbMl09MCxzWzNdPTEsc1s0XT02LHNbNV09MTAxO2xldCBmPTA7Zm9yKDtmPG87KXNbNitmXT0yNTUsZisrO3JldHVybiBzWzYrZl09aSxmKysscy5zZXQobiw2K2YpLHMuc2V0KG5ldyBVaW50OEFycmF5KHQpLDYrZithKSxzLmJ1ZmZlcn0obixhKTtjYXNlIGU6cmV0dXJuIGZ1bmN0aW9uKHQsZSl7Y29uc3Qgbj1yKGUpLGE9bi5sZW5ndGgsbz1NYXRoLmZsb29yKGEvMjU1KSxpPWElMjU1LHM9bmV3IFVpbnQ4QXJyYXkoNytvKzErYSsxK3QuYnl0ZUxlbmd0aCk7c1swXT0wLHNbMV09MCxzWzJdPTAsc1szXT0xLHNbNF09Nzgsc1s1XT0xLHNbNl09MTAxO2xldCBmPTA7Zm9yKDtmPG87KXNbNytmXT0yNTUsZisrO3JldHVybiBzWzcrZl09aSxmKysscy5zZXQobiw3K2YpLGYrPWEsc1s3K2ZdPTEyOCxmKysscy5zZXQobmV3IFVpbnQ4QXJyYXkodCksNytmKSxzLmJ1ZmZlcn0obixhKTtkZWZhdWx0OnJldHVybiBudWxsfX1mdW5jdGlvbiBpKG4pe2lmKG4ubGVuZ3RoPDUpcmV0dXJuIiI7bGV0IGE9LTE7Zm9yKGxldCB0PTA7dDxuLmxlbmd0aC0zO3QrKyl7aWYoMD09PW5bdF0mJjA9PT1uW3QrMV0mJjE9PT1uW3QrMl0pe2E9dDticmVha31pZih0PG4ubGVuZ3RoLTQmJjA9PT1uW3RdJiYwPT09blt0KzFdJiYwPT09blt0KzJdJiYxPT09blt0KzNdKXthPXQ7YnJlYWt9fWlmKC0xPT09YSlyZXR1cm4iIjtjb25zdCByPWErKDA9PT1uW2ErMl0/NDozKTtpZihyPj1uLmxlbmd0aClyZXR1cm4iIjtjb25zdCBvPW5bcl07aWYoMTI4Jm8pcmV0dXJuIiI7aWYoKG8+PjEmNjMpPj0zMilyZXR1cm4gZTtpZihyKzE8bi5sZW5ndGgpe2lmKDA9PSgyNDgmbltyKzFdKSlyZXR1cm4gZX1yZXR1cm4oMzEmbyk8PTMxP3Q6IiJ9Y29uc3Qgcz03MSxmPTEsbD0yLHU9MSxnPTI7dmFyIGM7ZnVuY3Rpb24gZCh0LGU9ITEpe2NvbnN0IG49dC5nZXRVaW50OCgwKTtpZihuIT09cylyZXR1cm47Y29uc3QgYT10LmdldFVpbnQxNigxKSxyPWYrbCthLG89bmV3IFVpbnQ4QXJyYXkodC5ieXRlTGVuZ3RoLXIpO28uc2V0KG5ldyBVaW50OEFycmF5KHQuYnVmZmVyLHIsdC5ieXRlTGVuZ3RoLXIpKTtjb25zdCBpPXttOm4sdGx2TGVuOmEsdGx2OltdLGZyYW1lOm99O2xldCBkPWYrbDtmb3IoO2Q8cjspe2NvbnN0IG49dC5nZXRVaW50OChkKSxhPXQuZ2V0VWludDE2KGQrdSkscj11K2c7aWYobj09PWMuQVVESU9fTEVWRUwpe2xldCBvPXQuZ2V0VWludDgoZCtyKTtmb3IobGV0IGU9MTtlPGE7ZSsrKW89bzw8OHx0LmdldFVpbnQ4KGQrcitlKTtpLnRsdi5wdXNoKHt0YWc6bixsZW5ndGg6YSx2YWx1ZTplPzEyN15vPj4xOjEyNyZvfSl9ZWxzZSBpZihuPT09Yy5NRVRBREFUQXx8bj09PWMuQVVESU9fNjRfQklUX1BUUyl7Y29uc3QgZT1uZXcgVWludDhBcnJheShhKTtmb3IobGV0IG49MDtuPGE7bisrKWVbbl09dC5nZXRVaW50OChkK3Irbik7aS50bHYucHVzaCh7dGFnOm4sbGVuZ3RoOmEsdmFsdWU6ZX0pfWQrPXIrYX1yZXR1cm4gaX0hZnVuY3Rpb24odCl7dFt0LkFVRElPX0xFVkVMPTFdPSJBVURJT19MRVZFTCIsdFt0Lk1FVEFEQVRBPTJdPSJNRVRBREFUQSIsdFt0LkFVRElPXzY0X0JJVF9QVFM9M109IkFVRElPXzY0X0JJVF9QVFMifShjfHwoYz17fSkpLHNlbGYub25ydGN0cmFuc2Zvcm09dD0+e2NvbnN0IGU9dC50cmFuc2Zvcm1lcjtsZXQgbj1bXSxyPVtdO2Uub3B0aW9ucy5wb3J0Lm9ubWVzc2FnZT10PT57dC5kYXRhLnNlaSYmbi5wdXNoKHQuZGF0YS5zZWkpLHQuZGF0YS5tZXRhZGF0YSYmci5wdXNoKHQuZGF0YS5tZXRhZGF0YSl9LHNlbGYucG9zdE1lc3NhZ2UoInN0YXJ0ZWQiKTtjb25zdCBoPWUucmVhZGFibGUuZ2V0UmVhZGVyKCksVT1lLndyaXRhYmxlLmdldFdyaXRlcigpOyJzZWktcngiPT09ZS5vcHRpb25zLm5hbWU/ZnVuY3Rpb24gdChlKXtoLnJlYWQoKS50aGVuKChuPT57aWYoIW4uZG9uZSl7aWYobi52YWx1ZSBpbnN0YW5jZW9mIFJUQ0VuY29kZWRWaWRlb0ZyYW1lKXtjb25zdCB0PWkobmV3IFVpbnQ4QXJyYXkobi52YWx1ZS5kYXRhKSkscj1hKG4udmFsdWUsdCk7ciYmZS5vcHRpb25zLnBvcnQucG9zdE1lc3NhZ2Uoe3NlaTpyfSl9VS53cml0ZShuLnZhbHVlKSxlLm9wdGlvbnMucG9ydC5wb3N0TWVzc2FnZSh7dHJhbnNmb3JtZWQ6ITB9KSx0KGUpfX0pKX0oZSk6InNlaS10eCI9PT1lLm9wdGlvbnMubmFtZT9mdW5jdGlvbiB0KGUpe2gucmVhZCgpLnRoZW4oKGE9PntpZighYS5kb25lKXtpZihhLnZhbHVlIGluc3RhbmNlb2YgUlRDRW5jb2RlZFZpZGVvRnJhbWUpe2NvbnN0IHQ9aShuZXcgVWludDhBcnJheShhLnZhbHVlLmRhdGEpKSxlPW4uc2hpZnQoKTtpZihlKXtjb25zdCBuPW8oYS52YWx1ZS5kYXRhLGUsdCk7biYmKGEudmFsdWUuZGF0YT1uKX19VS53cml0ZShhLnZhbHVlKSxlLm9wdGlvbnMucG9ydC5wb3N0TWVzc2FnZSh7dHJhbnNmb3JtZWQ6ITB9KSx0KGUpfX0pKX0oZSk6ImF1ZGlvLW1ldGFkYXRhLXJ4Ij09PWUub3B0aW9ucy5uYW1lP2Z1bmN0aW9uIHQoZSl7aC5yZWFkKCkudGhlbigobj0+e2lmKCFuLmRvbmUpe2lmKG4udmFsdWUgaW5zdGFuY2VvZiBSVENFbmNvZGVkQXVkaW9GcmFtZSl7Y29uc3QgdD1uZXcgRGF0YVZpZXcobi52YWx1ZS5kYXRhKSxhPXQuZ2V0VWludDgoMCk7bGV0IHI7aWYoMCE9KDEyOCZhKSYmNzEhPT1hKXtsZXQgZT1mdW5jdGlvbih0KXtpZih0LmJ5dGVMZW5ndGg8PTApcmV0dXJuW107Y29uc3QgZT1bXTtsZXQgbj0wO2Zvcig7bjx0LmJ5dGVMZW5ndGg7KXtjb25zdCBhPSgxMjgmdC5nZXRVaW50OChuKSk+Pjcscj0xMjcmdC5nZXRVaW50OChuKTtpZighKGEmJm4rNDw9dC5ieXRlTGVuZ3RoKSl7bisrO2JyZWFrfXtjb25zdCBhPXQuZ2V0VWludDMyKG4sITEpLG89KDE2Nzc2MTkyJmEpPj4xMCxpPTEwMjMmYTtlLnB1c2goe3B0OnIsdHNfb2Zmc2V0Om8sbGVuZ3RoOmksZGF0YTpuZXcgVWludDhBcnJheX0pLG4rPTR9fWxldCBhPXQuYnl0ZUxlbmd0aC1uO2Zvcihjb25zdCByIG9mIGUpe2lmKHIubGVuZ3RoPmEpcmV0dXJuIGNvbnNvbGUud2FybigiQnJva2VuIHJlZCBwYXlsb2FkIiksW107ci5sZW5ndGg+MCYmKHIuZGF0YT1uZXcgVWludDhBcnJheSh0LmJ1ZmZlcix0LmJ5dGVPZmZzZXQrbixyLmxlbmd0aCksbis9ci5sZW5ndGgsYS09ci5sZW5ndGgpfWlmKGE+MCl7Y29uc3Qgcj17cHQ6ZS5sZW5ndGg+MD9lW2UubGVuZ3RoLTFdLnB0OjAsdHNfb2Zmc2V0OjAsbGVuZ3RoOmEsZGF0YTpuZXcgVWludDhBcnJheSh0LmJ1ZmZlcix0LmJ5dGVPZmZzZXQrbixhKX07ZS5wdXNoKHIpfXJldHVybiBlfSh0KTtpZihlLmxlbmd0aD4wKXtjb25zdCB0PWZ1bmN0aW9uKHQpe2xldCBlPTA7Zm9yKGxldCBuPTA7bjx0Lmxlbmd0aDtuKyspZSs9bjx0Lmxlbmd0aC0xPzQ6MSxlKz10W25dLmxlbmd0aDtjb25zdCBuPW5ldyBVaW50OEFycmF5KGUpO2xldCBhPTA7Zm9yKGxldCBlPTA7ZTx0Lmxlbmd0aDtlKyspaWYoZTx0Lmxlbmd0aC0xKXtjb25zdCByPSgyMTQ3NDgzNjQ4fCgxMjcmdFtlXS5wdCk8PDI0fCgyNjIxNDMmdFtlXS50c19vZmZzZXQpPDwxMHwxMDIzJnRbZV0ubGVuZ3RoKT4+PjA7blthKytdPXI+PjI0JjI1NSxuW2ErK109cj4+MTYmMjU1LG5bYSsrXT1yPj44JjI1NSxuW2ErK109MjU1JnJ9ZWxzZSBuW2ErK109MTI3JnRbZV0ucHQ7Zm9yKGNvbnN0IGUgb2YgdCluLnNldChlLmRhdGEsYSksYSs9ZS5sZW5ndGg7cmV0dXJuIG59KGUubWFwKCh0PT57bGV0IGU9bmV3IFVpbnQ4QXJyYXkodC5sZW5ndGgpO2Uuc2V0KHQuZGF0YSk7Y29uc3Qgbj1kKG5ldyBEYXRhVmlldyhlLmJ1ZmZlcikpO3JldHVybiBuPy5mcmFtZSYmKHQuZGF0YT1uPy5mcmFtZSkscj1uLHR9KSkpO24udmFsdWUuZGF0YT10LmJ1ZmZlcn19ZWxzZSByPWQodCksciYmKG4udmFsdWUuZGF0YT1yLmZyYW1lLmJ1ZmZlcik7aWYocil7bGV0IHQ9ci50bHYuZmluZCgodD0+dC50YWc9PT1jLk1FVEFEQVRBKSk7aWYodCYmdC52YWx1ZSBpbnN0YW5jZW9mIFVpbnQ4QXJyYXkmJmUub3B0aW9ucy5wb3J0LnBvc3RNZXNzYWdlKHttZXRhZGF0YTp0LnZhbHVlfSksdD1yLnRsdi5maW5kKCh0PT50LnRhZz09PWMuQVVESU9fNjRfQklUX1BUUykpLHQmJnQudmFsdWUgaW5zdGFuY2VvZiBVaW50OEFycmF5JiY4PT10LnZhbHVlLmxlbmd0aCl7Y29uc3Qgbj1uZXcgRGF0YVZpZXcodC52YWx1ZS5idWZmZXIpLmdldEJpZ1VpbnQ2NCgwLCEwKTt0JiZ0LnZhbHVlIGluc3RhbmNlb2YgVWludDhBcnJheSYmZS5vcHRpb25zLnBvcnQucG9zdE1lc3NhZ2Uoe3B0czpufSl9fX1VLndyaXRlKG4udmFsdWUpLGUub3B0aW9ucy5wb3J0LnBvc3RNZXNzYWdlKHt0cmFuc2Zvcm1lZDohMH0pLHQoZSl9fSkpfShlKToiYXVkaW8tbWV0YWRhdGEtdHgiPT09ZS5vcHRpb25zLm5hbWUmJmZ1bmN0aW9uIHQoZSl7aC5yZWFkKCkudGhlbigobj0+e2lmKCFuLmRvbmUpe2lmKGUub3B0aW9ucy5wb3J0LnBvc3RNZXNzYWdlKHtnZXRNZXRhZGF0YTohMH0pLG4udmFsdWUgaW5zdGFuY2VvZiBSVENFbmNvZGVkQXVkaW9GcmFtZSl7Y29uc3QgdD1yLnNoaWZ0KCk7dCYmKG4udmFsdWUuZGF0YT1mdW5jdGlvbih0LGUsbil7Y29uc3QgYT1uLmJ5dGVMZW5ndGgscj1hK3UrZyxvPWYrbCtyLGk9bmV3IEFycmF5QnVmZmVyKHQuYnl0ZUxlbmd0aCtvKSxjPW5ldyBEYXRhVmlldyhpKTtjLnNldFVpbnQ4KDAscyksYy5zZXRVaW50MTYoMSxyKSxjLnNldFVpbnQ4KDMsZSksYy5zZXRVaW50MTYoNCxhKTtmb3IobGV0IHQ9MDt0PGE7dCsrKWMuc2V0VWludDgoNit0LG5bdF0pO2NvbnN0IGQ9bmV3IFVpbnQ4QXJyYXkoYy5idWZmZXIpO3JldHVybiBkLnNldChuZXcgVWludDhBcnJheSh0KSxvKSxkLmJ1ZmZlcn0obi52YWx1ZS5kYXRhLGMuQVVESU9fNjRfQklUX1BUUyx0KSl9VS53cml0ZShuLnZhbHVlKSxlLm9wdGlvbnMucG9ydC5wb3N0TWVzc2FnZSh7dHJhbnNmb3JtZWQ6ITB9KSx0KGUpfX0pKX0oZSl9LHNlbGYucG9zdE1lc3NhZ2UoInJlZ2lzdGVyZWQiKTsK")],{type:"text/javascript"});return setTimeout(()=>IA.revokeObjectURL(t),0),new Worker(IA.createObjectURL(t))}const $G=71,_2=1,y2=2,E2=1,KG=2;var $m=function(t){return t[t.AUDIO_LEVEL=1]="AUDIO_LEVEL",t[t.METADATA=2]="METADATA",t[t.AUDIO_64_BIT_PTS=3]="AUDIO_64_BIT_PTS",t}($m||{});function v2(t){let r=arguments.length>1&&arguments[1]!==void 0&&arguments[1];const s=t.getUint8(0);if(s!==$G)return;const a=t.getUint16(1),c=_2+y2+a,d=new Uint8Array(t.byteLength-c);d.set(new Uint8Array(t.buffer,c,t.byteLength-c));const h={m:s,tlvLen:a,tlv:[],frame:d};let m=_2+y2;for(;m<c;){const g=t.getUint8(m),E=t.getUint16(m+E2),b=E2+KG;if(g===$m.AUDIO_LEVEL){let I=t.getUint8(m+b);for(let A=1;A<E;A++)I=I<<8|t.getUint8(m+b+A);h.tlv.push({tag:g,length:E,value:r?127^I>>1:127&I})}else if(g===$m.METADATA||g===$m.AUDIO_64_BIT_PTS){const I=new Uint8Array(E);for(let A=0;A<E;A++)I[A]=t.getUint8(m+b+A);h.tlv.push({tag:g,length:E,value:I})}m+=b+E}return h}const PP=new Map,kP=127,oy=1e-10,S2=139/13,OP=new Map;function b2(t,r,s){const a="".concat(t,"-").concat(r,"-").concat(s);let c=0;return OP.has(a)?c=OP.get(a):(c=Math.log(function(h,m){const g=h-m;m<g&&(m=g);let E=1;for(let b=h,I=1;b>m;b--,I++)E=E*b/I;return E}(r,t))+t*Math.log(.5)+(r-t)*Math.log(1-.5)-Math.log(s)+s*t,OP.set(a,c)),c<oy&&(c=oy),c}function qG(t,r,s){const a=r.length,c=t.length/a;let d=!1;for(let h=0,m=0;h<a;h++){let g=0;for(let E=m+c;m<E;m++)t[m]>s&&g++;r[h]!==g&&(r[h]=g,d=!0)}return d}window.cache=OP;let hge=0;class YG{constructor(r){Re(this,"id",void 0),Re(this,"immediates",[]),Re(this,"lastNonSilence",-1),Re(this,"immediateSpeechActivityScore",oy),Re(this,"lastLevelChangedTime",Date.now()),Re(this,"levels",[]),Re(this,"longs",[]),Re(this,"longSpeechActivityScore",oy),Re(this,"mediums",[]),Re(this,"mediumSpeechActivityScore",oy),Re(this,"minLevel",0),Re(this,"nextMinLevel",0),Re(this,"nextMinLevelWindowLength",0),Re(this,"energyScore",0),this.id=r||"".concat(hge++),this.immediates.length=50,this.mediums.length=10,this.longs.length=1,this.levels.length=this.immediates.length}computeImmediates(){const r=this.immediates,s=this.levels,a=this.minLevel+S2;let c=!1;for(let d=0;d<r.length;++d){let h=s[d];h<a&&(h=0);const m=Math.floor(h/S2);r[d]!==m&&(r[d]=m,c=!0)}return c}computeLongs(){return qG(this.mediums,this.longs,4)}computeMediums(){return qG(this.immediates,this.mediums,7)}evaluateImmediateSpeechActivityScore(){this.immediateSpeechActivityScore=b2(this.immediates[0],13,.78)}evaluateLongSpeechActivityScore(r){this.longSpeechActivityScore=b2(this.longs[0],10,47),this.longSpeechActivityScore>oy&&(this.lastNonSilence=r)}evaluateMediumSpeechActivityScore(){this.mediumSpeechActivityScore=b2(this.mediums[0],5,24)}evaluateSpeechActivityScores(r){this.computeImmediates()&&(this.evaluateImmediateSpeechActivityScore(),this.computeMediums()&&(this.evaluateMediumSpeechActivityScore(),this.computeLongs()&&this.evaluateLongSpeechActivityScore(r)))}getLastLevelChangedTime(){return this.lastLevelChangedTime}getLevels(){var r;return"[".concat(h_(r=[...this.levels]).call(r).join(),"]")}getSpeechActivityScore(r){switch(r){case 0:return this.immediateSpeechActivityScore;case 1:return this.mediumSpeechActivityScore;case 2:return this.longSpeechActivityScore;default:throw new Error("interval "+r)}}levelChanged(r,s){if(this.lastLevelChangedTime<=s){this.lastLevelChangedTime=s;let a=r;return r<0&&(a=0),r>kP&&(a=kP),this.levels.unshift(a),this.levels.length>this.immediates.length&&this.levels.pop(),this.updateMinLevel(a),a>=this.minLevel+S2?a:a/2}return-1}levelTimedOut(){this.levelChanged(0,this.lastLevelChangedTime)}updateMinLevel(r){if(r!==0){if(this.minLevel===0||this.minLevel>r)return this.minLevel=r,this.nextMinLevel=0,void(this.nextMinLevelWindowLength=0);if(this.nextMinLevel===0)return this.nextMinLevel=r,void(this.nextMinLevelWindowLength=1);if(this.nextMinLevel>r&&(this.nextMinLevel=r),this.nextMinLevelWindowLength++,this.nextMinLevelWindowLength>=750){let s=Math.sqrt(this.minLevel*this.nextMinLevel);s<0?s=0:s>kP&&(s=kP),this.minLevel=s,this.nextMinLevel=0,this.nextMinLevelWindowLength=0}}}}class pge{constructor(r){Re(this,"algorithm",void 0),this.algorithm=r}execute(){let r=!this.algorithm;if(!r)try{const s=this.algorithm.runInDecisionMaker(this);s<=0?r=!0:setTimeout(this.execute.bind(this),s)}catch{r=!0}r&&this.algorithm&&this.algorithm.decisionMakerExited(this)}}class w2{constructor(r,s,a){Re(this,"isDominant",void 0),Re(this,"energyRanking",void 0),Re(this,"energyScore",void 0),this.isDominant=r,this.energyRanking=s,this.energyScore=a}}class fge extends Jr{constructor(r){super(),Re(this,"dominantId",null),Re(this,"lastDecisionTime",0),Re(this,"lastLevelChangedTime",0),Re(this,"lastLevelIdleTime",0),Re(this,"relativeSpeechActivities",[]),Re(this,"speakers",new Map),Re(this,"enableSilence",!1),Re(this,"timeoutToSilenceInterval",0),Re(this,"decisionMaker",null),Re(this,"loudest",[]),Re(this,"numLoudestToTrack",3),Re(this,"energyExpireTimeMs",250),Re(this,"energyAlphaPct",50),this.timeoutToSilenceInterval=r,this.enableSilence=r>0,this.relativeSpeechActivities.length=3}setLoudestConfig(){let r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:3,s=arguments.length>1?arguments[1]:void 0,a=arguments.length>2?arguments[2]:void 0;this.numLoudestToTrack=r,s!=null&&(this.energyExpireTimeMs=s),a!=null&&(this.energyAlphaPct=a),this.loudest.length>r&&this.loudest.splice(r)}getDominantSpeaker(){return this.dominantId}isAmongLoudest(r){return this.loudest.some(s=>s.id===r)}levelChanged(r,s){const a=Date.now(),c=this.getOrCreateSpeaker(r);this.lastLevelChangedTime<a&&(this.lastLevelChangedTime=a,this.maybeStartDecisionMaker());const d=c.levelChanged(s,a);return this.updateLoudestList(c,d,a)}runInDecisionMaker(r){return this.decisionMaker!==r||this.lastDecisionTime>0&&this.lastDecisionTime-this.lastLevelChangedTime>=15e3?-1:this._runInDecisionMaker()}decisionMakerExited(r){this.decisionMaker===r&&(this.decisionMaker=null)}destroy(){this.decisionMaker=null,this.loudest.length=0,this.speakers.clear(),this.removeAllListeners()}addSpeakers(r){r.forEach(s=>{this.speakers.has(s.id)||this.speakers.set(s.id,s)})}removeSpeakers(r){r.forEach(s=>{this.speakers.delete(s.id)})}getOrCreateSpeaker(r){let s=this.speakers.get(r);return s||(s=new YG(r),this.speakers.set(r,s),this.maybeStartDecisionMaker()),s}updateLoudestList(r,s,a){const c=r.id===this.dominantId;if(s<0){let g=0;for(;g<this.loudest.length&&this.loudest[g]!==r;)++g;return new w2(c,g,r.energyScore)}if(r.energyScore=Math.floor((this.energyAlphaPct*s+(100-this.energyAlphaPct)*r.energyScore+50)/100),this.numLoudestToTrack===0)return new w2(c,0,r.energyScore);const d=a-this.energyExpireTimeMs;let h=0;for(;h<this.loudest.length;){const g=this.loudest[h];if(g.getLastLevelChangedTime()<d&&this.loudest.length>=this.numLoudestToTrack)this.loudest.splice(h,1);else if(g.id!==r.id)++h;else if(this.loudest.splice(h,1),this.loudest.length<this.numLoudestToTrack)break}let m=0;for(;m<this.loudest.length&&!(this.loudest[m].energyScore<r.energyScore);)++m;return m<this.numLoudestToTrack&&(this.loudest.splice(m,0,r),this.loudest.length>this.numLoudestToTrack&&this.loudest.splice(this.numLoudestToTrack,1)),new w2(c,m,r.energyScore)}maybeStartDecisionMaker(){!this.decisionMaker&&this.speakers.size>0&&(this.decisionMaker=new pge(this),this.decisionMaker.execute())}makeDecision(r){let s=null,a=null;const c=this.speakers.size;let d=null;if(c===0)d=null;else if(c===1){var h;const m=Sc(h=this.speakers).call(h).next().value;this.enableSilence&&m&&(d=m.id,m.evaluateSpeechActivityScores(r),r-m.lastNonSilence>this.timeoutToSilenceInterval&&(d=null))}else{let m=this.dominantId==null?null:this.speakers.get(this.dominantId);if(m==null){const b=this.speakers.entries().next();b.value&&(d=b.value[0],m=b.value[1])}else d=m.id;m!=null&&m.evaluateSpeechActivityScores(r);const g=this.relativeSpeechActivities;let E=2;for(const b of this.speakers.entries()){const[I,A]=b;if(A===m)continue;A.evaluateSpeechActivityScores(r);for(let B=0;B<g.length;++B){const ee=m==null?oy:m.getSpeechActivityScore(B);g[B]=Math.log(A.getSpeechActivityScore(B)/ee)}const k=g[0],W=g[1],j=g[2];k>3&&W>2&&j>0&&W>E&&(E=W,d=I)}this.enableSilence&&m!=null&&d===m.id&&r-m.lastNonSilence>this.timeoutToSilenceInterval&&(d=null)}d==null&&!this.enableSilence||d===this.dominantId||(s=this.dominantId,this.dominantId=d,a=this.dominantId),a==null&&!this.enableSilence||a===s||this.emit("ActiveSpeakerChanged",a)}_runInDecisionMaker(){const r=Date.now(),s=300-(r-this.lastLevelIdleTime);let a=0;s<=0?(this.lastLevelIdleTime!==0&&this.timeoutIdleLevels(r),this.lastLevelIdleTime=r):a=s;let c=300-(r-this.lastDecisionTime);return c<=0&&(this.lastDecisionTime=r,this.makeDecision(r),c=300-(Date.now()-r)),c>0&&a>c&&(a=c),a}timeoutIdleLevels(r){const s=[];for(const c of Sc(a=this.speakers).call(a)){var a;const d=r-c.getLastLevelChangedTime();36e5<d&&(this.dominantId==null||c.id!==this.dominantId)?s.push(c.id):300<d&&c.levelTimedOut()}s.forEach(c=>this.speakers.delete(c))}}const n0=new Map;let Gd=null,NP=null;const XG=3;let ay=[];const Hd=new Map,DP=new Map;class mge{get samples(){return this.actives+this.inactives}get activeRate(){return this.actives/this.samples}constructor(r,s){Re(this,"id",void 0),Re(this,"track",void 0),Re(this,"score",0),Re(this,"active",!0),Re(this,"muted",!1),Re(this,"timer",0),Re(this,"actives",0),Re(this,"inactives",0),this.id=r,this.track=s,this.setActive(Hd.size<3)}autoCheckActive(){this.autoSetActive(),this.autoAdjustActive(),this.resetTimer(),this.actives=0,this.inactives=0}autoSetActive(){const r=this.active;this.active=this.activeRate>=.8;const{actives:s,inactives:a}=function(){const c=[],d=[];return Array.from(Sc(Hd).call(Hd)).forEach(h=>{h.active?c.push(h):d.push(h)}),{actives:c,inactives:d}}();if(s.length>3){let c;s.forEach(d=>{(!c||c.score>d.score)&&(c=d)}),c&&c.setActive(!1)}if(s.length<3&&a.length>0){let c;a.forEach(d=>{(!c||c.score<d.score)&&d.id!==this.id&&(c=d)}),c&&r&&!this.active&&(c.samples>40&&c.activeRate-this.activeRate>.4?c.setActive(!0):this.active=!0)}this.setMuted(!this.active)}setActive(r){this.active=r,this.resetTimer(),this.setMuted(!r)}autoAdjustActive(){this.active?this.autoSwitchToInactive():this.autoSwitchToActive()}autoSwitchToActive(){const r=function(s){let a;return Array.from(Sc(Hd).call(Hd)).forEach(c=>{!c.active||c.id===s||c.samples<40||(!a||c.score<a.score)&&(a=c)}),a}(this.id);r&&this.activeRate-r.activeRate>.4&&(r.setActive(!1),this.setActive(!0))}autoSwitchToInactive(){const r=function(s){let a;return Array.from(Sc(Hd).call(Hd)).forEach(c=>{c.active||c.id===s||c.samples<40||(!a||c.score>a.score)&&(a=c)}),a}(this.id);r&&r.activeRate-this.activeRate>.4&&(r.setActive(!0),this.setActive(!1))}addSample(r){r?this.actives+=1:this.inactives+=1,this.samples>66.66666666666667&&this.autoCheckActive()}setMuted(r){this.track&&(this.track.enabled=!r,this.muted=r)}resetTimer(){this.clearTimer(),this.timer=window.setTimeout(()=>{if(this.samples!==0)return this.samples<50?this.resetTimer():void this.autoCheckActive()},1e3)}clearTimer(){this.timer&&(clearTimeout(this.timer),this.timer=0)}}let xP;function JG(t){const r=Hd.get(t);r&&(Hd.delete(t),r.clearTimer())}const LP=new Map,gge=new Map,T2="video/h264",C2="video/h265";function QG(t,r,s){let a=new Uint8Array(t,r,s),c=[],d=0;for(;c.length<s;)d+3<s&&a[d]===0&&a[d+1]===0&&a[d+2]===3&&(a[d+3]===0||a[d+3]===1||a[d+3]===2||a[d+3]===3)?(c.push(a[d],a[d+1],a[d+3]),d+=4):(c.push(a[d]),d++);return new Uint8Array(c)}function ZG(t){const r=t.length;let s=[],a=0;for(;a<r;)a+2<r&&t[a]===0&&t[a+1]===0&&(t[a+2]===0||t[a+2]===1||t[a+2]===2||t[a+2]===3)?(s.push(t[a],t[a+1],3,t[a+2]),a+=3):(s.push(t[a]),a++);return new Uint8Array(s)}function eH(t){if(t.length<5)return"";let r=-1;for(let c=0;c<t.length-3;c++){if(t[c]===0&&t[c+1]===0&&t[c+2]===1){r=c;break}if(c<t.length-4&&t[c]===0&&t[c+1]===0&&t[c+2]===0&&t[c+3]===1){r=c;break}}if(r===-1)return"";const s=r+(t[r+2]===0?4:3);if(s>=t.length)return"";const a=t[s];return 128&a?"":(a>>1&63)>=32||s+1<t.length&&(248&t[s+1])==0?C2:(31&a)<=31?T2:""}const MP=new Map,iT=new Map;(function(){const t=xn();ws.getDisplayMedia=!(!navigator.mediaDevices||!navigator.mediaDevices.getDisplayMedia),ws.getStreamFromExtension=t.name===Hn.CHROME&&Number(t.version)>34,ws.supportUnifiedPlan=function(){if(!window.RTCRtpTransceiver||!("currentDirection"in RTCRtpTransceiver.prototype))return!1;const r=new RTCPeerConnection;let s=!1;try{r.addTransceiver("audio"),s=!0}catch{}return r.close(),s}(),ws.supportMinBitrate=t.name===Hn.CHROME||t.name===Hn.EDGE,ws.supportSetRtpSenderParameters=function(){const r=xn();return!!(window.RTCRtpSender&&window.RTCRtpSender.prototype.setParameters&&window.RTCRtpSender.prototype.getParameters)&&(!!lf()||!(!xs()&&!dP())||r.name===Hn.FIREFOX&&Number(r.version)>=64)}(),t.name===Hn.SAFARI&&(Number(t.version)>=14?ws.supportDualStream=!0:ws.supportDualStream=!1),ws.webAudioMediaStreamDest=function(){const r=xn();return!(r.name===Hn.SAFARI&&Number(r.version)<12)}(),ws.supportReplaceTrack=!!window.RTCRtpSender&&typeof RTCRtpSender.prototype.replaceTrack=="function",ws.supportWebGL=typeof WebGLRenderingContext<"u",ws.supportRequestFrame=!!window.CanvasCaptureMediaStreamTrack,lf()||(ws.webAudioWithAEC=!0),ws.supportShareAudio=function(){const r=xn();return(r.os===is.WIN_10||r.os===is.WIN_81||r.os===is.WIN_7||r.os===is.LINUX||r.os===is.MAC_OS||r.os===is.CHROMIUM_OS)&&r.name===Hn.CHROME&&Number(r.version)>=74}(),ws.supportDataChannel=!!(Vv(76)||kL(68)||Z8(14)),ws.supportPCSetConfiguration=function(){const r=window.RTCPeerConnection;return!ni()&&!!r&&r.prototype.setConfiguration instanceof Function}(),ws.supportWebRTCEncodedTransform=Vv(87)||X8()||kL(117),ws.supportWebRTCInsertableStream=function(){const r=xn();return(r.name===Hn.CHROME||r.name===Hn.EDGE)&&Number(r.version)>=94&&"MediaStreamTrackGenerator"in window&&"MediaStreamTrackProcessor"in window}(),ws.supportRequestVideoFrameCallback="requestVideoFrameCallback"in HTMLVideoElement.prototype,ws.supportWebCrypto=typeof window<"u"&&window.crypto!==void 0&&window.crypto.subtle!==void 0,fP(()=>{ws.supportDualStreamEncoding=function(){const r=xn();return!!se("DISABLE_WEBAUDIO")||r.name==="Safari"&&Number(r.version)>=14||!!(r.name==="Chrome"&&/Windows/i.test(r.os||"")&&Number(r.version)>=100&&se("CHROME_DUAL_STREAM_USE_ENCODING"))}(),x.debug("browser ua: ",navigator.userAgent),x.info("browser info: ",t),x.info("browser compatibility: ",ws)})})();const _ge=["CHINA","GLOBAL"],tH=[[0,1,2,3,4,5,5],[0,2,2,3,4,5,5],[0,3,3,3,4,5,5],[0,4,4,4,4,5,5],[0,5,5,5,5,5,5]],cy=[],r0=[];function ly(t,r){return!!r&&cy.some(s=>s.uid===t&&s.channelName===r)}function R2(){return r0.length>0}var yge=mz.forEach,nH=o_("forEach")?[].forEach:function(t){return yge(this,t,arguments.length>1?arguments[1]:void 0)};Gn({target:"Array",proto:!0,forced:[].forEach!==nH},{forEach:nH});var Ege=mc("Array","forEach"),vge=Ed,Sge=ti,bge=N,wge=Ege,I2=Array.prototype,Tge={DOMTokenList:!0,NodeList:!0},Cge=function(t){var r=t.forEach;return t===I2||bge(I2,t)&&r===I2.forEach||Sge(Tge,vge(t))?wge:r},Rge=l(Cge),Ige=ei,rH=ya;Gn({target:"Object",stat:!0,forced:u(function(){rH(1)})},{keys:function(t){return rH(Ige(t))}});var Age=l(Ne.Object.keys),Pge=l(xi),kge=l(d_),Oge=Gn,iH=vd,Nge=Ds,Dge=Se,sH=Ke,xge=hr,Lge=on,Mge=dx,Uge=Nr,Vge=Es,Fge=sz("slice"),jge=Uge("species"),A2=Array,Bge=Math.max;Oge({target:"Array",proto:!0,forced:!Fge},{slice:function(t,r){var s,a,c,d=Lge(this),h=xge(d),m=sH(t,h),g=sH(r===void 0?h:r,h);if(iH(d)&&(s=d.constructor,(Nge(s)&&(s===A2||iH(s.prototype))||Dge(s)&&(s=s[jge])===null)&&(s=void 0),s===A2||s===void 0))return Vge(d,m,g);for(a=new(s===void 0?A2:s)(Bge(g-m,0)),c=0;m<g;m++,c++)m in d&&Mge(a,c,d[m]);return a.length=c,a}});var zge=mc("Array","slice"),Wge=N,Gge=zge,P2=Array.prototype,Hge=function(t){var r=t.slice;return t===P2||Wge(P2,t)&&r===P2.slice?Gge:r},$ge=l(Hge);function Rt(t,r,s,a,c){var d,h,m,g={};return Rge(d=Age(a)).call(d,function(E){g[E]=a[E]}),g.enumerable=!!g.enumerable,g.configurable=!!g.configurable,("value"in g||g.initializer)&&(g.writable=!0),g=Pge(h=kge(m=$ge(s).call(s)).call(m)).call(h,function(E,b){return b(t,r,E)||E},g),c&&g.initializer!==void 0&&(g.value=g.initializer?g.initializer.call(c):void 0,g.initializer=void 0),g.initializer===void 0?(tz(t,r,g),null):g}let UP=function(t){return t[t.ACCESS_POINT=101]="ACCESS_POINT",t[t.UNILBS=201]="UNILBS",t[t.STRING_UID_ALLOCATOR=901]="STRING_UID_ALLOCATOR",t}({}),k2=function(t){return t[t.IIIEGAL_APPID=1]="IIIEGAL_APPID",t[t.IIIEGAL_UID=2]="IIIEGAL_UID",t[t.INTERNAL_ERROR=3]="INTERNAL_ERROR",t}({}),Vu=function(t){return t[t.INVALID_VENDOR_KEY=5]="INVALID_VENDOR_KEY",t[t.INVALID_CHANNEL_NAME=7]="INVALID_CHANNEL_NAME",t[t.INTERNAL_ERROR=8]="INTERNAL_ERROR",t[t.NO_AUTHORIZED=9]="NO_AUTHORIZED",t[t.DYNAMIC_KEY_TIMEOUT=10]="DYNAMIC_KEY_TIMEOUT",t[t.NO_ACTIVE_STATUS=11]="NO_ACTIVE_STATUS",t[t.DYNAMIC_KEY_EXPIRED=13]="DYNAMIC_KEY_EXPIRED",t[t.STATIC_USE_DYNAMIC_KEY=14]="STATIC_USE_DYNAMIC_KEY",t[t.DYNAMIC_USE_STATIC_KEY=15]="DYNAMIC_USE_STATIC_KEY",t[t.USER_OVERLOAD=16]="USER_OVERLOAD",t[t.FORBIDDEN_REGION=18]="FORBIDDEN_REGION",t[t.CANNOT_MEET_AREA_DEMAND=19]="CANNOT_MEET_AREA_DEMAND",t}({}),ta=function(t){return t[t.NO_FLAG_SET=100]="NO_FLAG_SET",t[t.FLAG_SET_BUT_EMPTY=101]="FLAG_SET_BUT_EMPTY",t[t.INVALID_FALG_SET=102]="INVALID_FALG_SET",t[t.FLAG_SET_BUT_NO_RE=103]="FLAG_SET_BUT_NO_RE",t[t.INVALID_SERVICE_ID=104]="INVALID_SERVICE_ID",t[t.NO_SERVICE_AVAILABLE=200]="NO_SERVICE_AVAILABLE",t[t.NO_SERVICE_AVAILABLE_P2P=201]="NO_SERVICE_AVAILABLE_P2P",t[t.NO_SERVICE_AVAILABLE_VOICE=202]="NO_SERVICE_AVAILABLE_VOICE",t[t.NO_SERVICE_AVAILABLE_WEBRTC=203]="NO_SERVICE_AVAILABLE_WEBRTC",t[t.NO_SERVICE_AVAILABLE_CDS=204]="NO_SERVICE_AVAILABLE_CDS",t[t.NO_SERVICE_AVAILABLE_CDN=205]="NO_SERVICE_AVAILABLE_CDN",t[t.NO_SERVICE_AVAILABLE_TDS=206]="NO_SERVICE_AVAILABLE_TDS",t[t.NO_SERVICE_AVAILABLE_REPORT=207]="NO_SERVICE_AVAILABLE_REPORT",t[t.NO_SERVICE_AVAILABLE_APP_CENTER=208]="NO_SERVICE_AVAILABLE_APP_CENTER",t[t.NO_SERVICE_AVAILABLE_ENV0=209]="NO_SERVICE_AVAILABLE_ENV0",t[t.NO_SERVICE_AVAILABLE_VOET=210]="NO_SERVICE_AVAILABLE_VOET",t[t.NO_SERVICE_AVAILABLE_STRING_UID=211]="NO_SERVICE_AVAILABLE_STRING_UID",t[t.NO_SERVICE_AVAILABLE_WEBRTC_UNILBS=212]="NO_SERVICE_AVAILABLE_WEBRTC_UNILBS",t[t.NO_SERVICE_AVAILABLE_UNILBS_FLV=213]="NO_SERVICE_AVAILABLE_UNILBS_FLV",t}({}),zt=function(t){return t[t.K_TIMESTAMP_EXPIRED=2]="K_TIMESTAMP_EXPIRED",t[t.K_CHANNEL_PERMISSION_INVALID=3]="K_CHANNEL_PERMISSION_INVALID",t[t.K_CERTIFICATE_INVALID=4]="K_CERTIFICATE_INVALID",t[t.K_CHANNEL_NAME_EMPTY=5]="K_CHANNEL_NAME_EMPTY",t[t.K_CHANNEL_NOT_FOUND=6]="K_CHANNEL_NOT_FOUND",t[t.K_TICKET_INVALID=7]="K_TICKET_INVALID",t[t.K_CHANNEL_CONFLICTED=8]="K_CHANNEL_CONFLICTED",t[t.K_SERVICE_NOT_READY=9]="K_SERVICE_NOT_READY",t[t.K_SERVICE_TOO_HEAVY=10]="K_SERVICE_TOO_HEAVY",t[t.K_UID_BANNED=14]="K_UID_BANNED",t[t.K_IP_BANNED=15]="K_IP_BANNED",t[t.K_CHANNEL_BANNED=16]="K_CHANNEL_BANNED",t[t.DATASTREAM2_NOT_AVAILABLE=27]="DATASTREAM2_NOT_AVAILABLE",t[t.K_AUTO_REBALANCE=28]="K_AUTO_REBALANCE",t[t.WARN_NO_AVAILABLE_CHANNEL=103]="WARN_NO_AVAILABLE_CHANNEL",t[t.WARN_LOOKUP_CHANNEL_TIMEOUT=104]="WARN_LOOKUP_CHANNEL_TIMEOUT",t[t.WARN_LOOKUP_CHANNEL_REJECTED=105]="WARN_LOOKUP_CHANNEL_REJECTED",t[t.WARN_OPEN_CHANNEL_TIMEOUT=106]="WARN_OPEN_CHANNEL_TIMEOUT",t[t.WARN_OPEN_CHANNEL_REJECTED=107]="WARN_OPEN_CHANNEL_REJECTED",t[t.WARN_REQUEST_DEFERRED=108]="WARN_REQUEST_DEFERRED",t[t.ERR_DYNAMIC_KEY_TIMEOUT=109]="ERR_DYNAMIC_KEY_TIMEOUT",t[t.ERR_NO_AUTHORIZED=110]="ERR_NO_AUTHORIZED",t[t.ERR_VOM_SERVICE_UNAVAILABLE=111]="ERR_VOM_SERVICE_UNAVAILABLE",t[t.ERR_NO_CHANNEL_AVAILABLE_CODE=112]="ERR_NO_CHANNEL_AVAILABLE_CODE",t[t.ERR_MASTER_VOCS_UNAVAILABLE=114]="ERR_MASTER_VOCS_UNAVAILABLE",t[t.ERR_INTERNAL_ERROR=115]="ERR_INTERNAL_ERROR",t[t.ERR_NO_ACTIVE_STATUS=116]="ERR_NO_ACTIVE_STATUS",t[t.ERR_INVALID_UID=117]="ERR_INVALID_UID",t[t.ERR_DYNAMIC_KEY_EXPIRED=118]="ERR_DYNAMIC_KEY_EXPIRED",t[t.ERR_STATIC_USE_DYANMIC_KE=119]="ERR_STATIC_USE_DYANMIC_KE",t[t.ERR_DYNAMIC_USE_STATIC_KE=120]="ERR_DYNAMIC_USE_STATIC_KE",t[t.ERR_NO_VOCS_AVAILABLE=2e3]="ERR_NO_VOCS_AVAILABLE",t[t.ERR_NO_VOS_AVAILABLE=2001]="ERR_NO_VOS_AVAILABLE",t[t.ERR_JOIN_CHANNEL_TIMEOUT=2002]="ERR_JOIN_CHANNEL_TIMEOUT",t[t.ERR_REPEAT_JOIN_CHANNEL=2003]="ERR_REPEAT_JOIN_CHANNEL",t[t.ERR_JOIN_BY_MULTI_IP=2004]="ERR_JOIN_BY_MULTI_IP",t[t.ERR_NOT_JOINED=2011]="ERR_NOT_JOINED",t[t.ERR_REPEAT_JOIN_REQUEST=2012]="ERR_REPEAT_JOIN_REQUEST",t[t.ERR_INVALID_VENDOR_KEY=2013]="ERR_INVALID_VENDOR_KEY",t[t.ERR_INVALID_CHANNEL_NAME=2014]="ERR_INVALID_CHANNEL_NAME",t[t.ERR_INVALID_STRINGUID=2015]="ERR_INVALID_STRINGUID",t[t.ERR_TOO_MANY_USERS=2016]="ERR_TOO_MANY_USERS",t[t.ERR_SET_CLIENT_ROLE_TIMEOUT=2017]="ERR_SET_CLIENT_ROLE_TIMEOUT",t[t.ERR_SET_CLIENT_ROLE_NO_PERMISSION=2018]="ERR_SET_CLIENT_ROLE_NO_PERMISSION",t[t.ERR_SET_CLIENT_ROLE_ALREADY_IN_USE=2019]="ERR_SET_CLIENT_ROLE_ALREADY_IN_USE",t[t.ERR_PUBLISH_REQUEST_INVALID=2020]="ERR_PUBLISH_REQUEST_INVALID",t[t.ERR_SUBSCRIBE_REQUEST_INVALID=2021]="ERR_SUBSCRIBE_REQUEST_INVALID",t[t.ERR_NOT_SUPPORTED_MESSAGE=2022]="ERR_NOT_SUPPORTED_MESSAGE",t[t.ERR_ILLEAGAL_PLUGIN=2023]="ERR_ILLEAGAL_PLUGIN",t[t.ERR_REJOIN_TOKEN_INVALID=2024]="ERR_REJOIN_TOKEN_INVALID",t[t.ERR_REJOIN_USER_NOT_JOINED=2025]="ERR_REJOIN_USER_NOT_JOINED",t[t.ERR_INVALID_OPTIONAL_INFO=2027]="ERR_INVALID_OPTIONAL_INFO",t[t.ILLEGAL_AES_PASSWORD=2028]="ILLEGAL_AES_PASSWORD",t[t.ILLEGAL_CLIENT_ROLE_LEVEL=2029]="ILLEGAL_CLIENT_ROLE_LEVEL",t[t.ERR_TOO_MANY_BROADCASTERS=2031]="ERR_TOO_MANY_BROADCASTERS",t[t.ERR_TOO_MANY_SUBSCRIBERS=2032]="ERR_TOO_MANY_SUBSCRIBERS",t[t.ERR_LICENSE_MISSING=32769]="ERR_LICENSE_MISSING",t[t.ERR_LICENSE_EXPIRED=32771]="ERR_LICENSE_EXPIRED",t[t.ERR_LICENSE_MINUTES_EXCEEDED=32773]="ERR_LICENSE_MINUTES_EXCEEDED",t[t.ERR_LICENSE_PERIOD_INVALID=32774]="ERR_LICENSE_PERIOD_INVALID",t[t.ERR_LICENSE_MULTIPLE_SDK_SERVICE=32778]="ERR_LICENSE_MULTIPLE_SDK_SERVICE",t[t.ERR_LICENSE_ILLEGAL=32783]="ERR_LICENSE_ILLEGAL",t[t.ERR_TEST_RECOVER=9e3]="ERR_TEST_RECOVER",t[t.ERR_TEST_TRYNEXT=9001]="ERR_TEST_TRYNEXT",t[t.ERR_TEST_RETRY=9002]="ERR_TEST_RETRY",t}({}),Pr=function(t){return t.CONNECTING="connecting",t.CONNECTED="connected",t.RECONNECTING="reconnecting",t.CLOSED="closed",t}({}),Jt=function(t){return t.WS_CONNECTED="ws_connected",t.WS_RECONNECTING="ws_reconnecting",t.WS_CLOSED="ws_closed",t.WS_RECONNECT_CREATE_CONNECTION="ws_reconnect_create_connection",t.ON_BINARY_DATA="on_binary_data",t.REQUEST_RECOVER="request_recover",t.REQUEST_JOIN_INFO="request_join_info",t.REQUEST_REJOIN_INFO="req_rejoin_info",t.IS_P2P_DISCONNECTED="is_p2p_dis",t.DISCONNECT_P2P="dis_p2p",t.ABORT_P2P_EXECUTION="abort_p2p_execution",t.NEED_RENEW_SESSION="need-sid",t.REPORT_JOIN_GATEWAY="report_join_gateway",t.REQUEST_TIMEOUT="request_timeout",t.REQUEST_SUCCESS="request_success",t.JOIN_RESPONSE="join_response",t.PRE_CONNECT_PC="pre_connect_pc",t.P2P_CONNECTION="p2p_connection",t.P2P_REMOTE_CANDIDATE_UPDATE="p2p_remote_candidate_update",t.P2P_SUBSCRIBE="p2p_subscribe",t.P2P_UNSUBSCRIBE="p2p_unsubscribe",t.P2P_EXCHANGE_SDP="p2p_exchange_sdp",t.P2P_ON_ADD_VIDEO_STREAM="p2p_on_add_video_stream",t.P2P_ON_ADD_AUDIO_STREAM="p2p_on_add_audio_stream",t.RECOVER_NOTIFICATION="recover_notification",t}({}),qt=function(t){return t.PING="ping",t.PING_BACK="ping_back",t.JOIN="join_v3",t.REJOIN="rejoin_v3",t.LEAVE="leave",t.SET_CLIENT_ROLE="set_client_role",t.PUBLISH="publish",t.PUBLISH_DATASTREAM="publish_datastream",t.UNPUBLISH="unpublish",t.UNPUBLISH_DATASTREAM="unpublish_datastream",t.SUBSCRIBE="subscribe",t.PRE_SUBSCRIBE="pre_subscribe",t.SUBSCRIBE_DATASTREAM="subscribe_datastream",t.SUBSCRIBE_STREAMS="subscribe_streams",t.UNSUBSCRIBE="unsubscribe",t.UNSUBSCRIBE_DATASTREAM="unsubscribe_datastream",t.UNSUBSCRIBE_STREAMS="unsubscribe_streams",t.SUBSCRIBE_CHANGE="subscribe_change",t.TRAFFIC_STATS="traffic_stats",t.RENEW_TOKEN="renew_token",t.SWITCH_VIDEO_STREAM="switch_video_stream",t.DEFAULT_VIDEO_STREAM="default_video_stream",t.SET_FALLBACK_OPTION="set_fallback_option",t.GATEWAY_INFO="gateway_info",t.CONTROL="control",t.SEND_METADATA="send_metadata",t.DATA_STREAM="data_stream",t.PICK_SVC_LAYER="pick_svc_layer",t.RESTART_ICE="restart_ice",t.CONNECT_PC="connect_pc",t.SET_VIDEO_PROFILE="set_video_profile",t.SET_PARAMETER="set_parameter",t.SET_RTM2_FLAG="set_rtm2_flag",t.DOWNGRADE_CODEC="downgrade_codec",t}({}),sT=function(t){return t.WRTC_STATS="wrtc_stats",t.WS_INFLATE_DATA_LENGTH="ws_inflate_data_length",t.DENOISER_STATS="denoiser_stats",t.EXTENSION_USAGE_STATS="extension_usage_stats",t}({}),An=function(t){return t.ON_USER_ONLINE="on_user_online",t.ON_USER_OFFLINE="on_user_offline",t.ON_STREAM_FALLBACK_UPDATE="on_stream_fallback_update",t.ON_PUBLISH_STREAM="on_publish_stream",t.ON_UPLINK_STATS="on_uplink_stats",t.ON_P2P_LOST="on_p2p_lost",t.ON_REMOVE_STREAM="on_remove_stream",t.ON_ADD_AUDIO_STREAM="on_add_audio_stream",t.ON_ADD_VIDEO_STREAM="on_add_video_stream",t.ON_TOKEN_PRIVILEGE_WILL_EXPIRE="on_token_privilege_will_expire",t.ON_TOKEN_PRIVILEGE_DID_EXPIRE="on_token_privilege_did_expire",t.ON_USER_BANNED="on_user_banned",t.ON_USER_LICENSE_BANNED="on_user_license_banned",t.ON_NOTIFICATION="on_notification",t.ON_CRYPT_ERROR="on_crypt_error",t.MUTE_AUDIO="mute_audio",t.MUTE_VIDEO="mute_video",t.UNMUTE_AUDIO="unmute_audio",t.UNMUTE_VIDEO="unmute_video",t.ON_P2P_OK="on_p2p_ok",t.RECEIVE_METADATA="receive_metadata",t.ON_DATA_STREAM="on_data_stream",t.ON_RTP_CAPABILITY_CHANGE="on_rtp_capability_change",t.ON_REMOTE_DATASTREAM_UPDATE="on_remote_datastream_update",t.ON_REMOTE_FULL_DATASTREAM_INFO="on_remote_full_datastream_info",t.ENABLE_LOCAL_VIDEO="enable_local_video",t.DISABLE_LOCAL_VIDEO="disable_local_video",t.ENABLE_LOCAL_AUDIO="enable_local_audio",t.DISABLE_LOCAL_AUDIO="disable_local_audio",t.ON_PUBLISHED_USER_LIST="on_published_user_list",t}({}),na=function(t){return t.SEND_ONLY="SEND_ONLY",t.RECEIVE_ONLY="RECEIVE_ONLY",t}({}),an=function(t){return t.CONNECTED="websocket:connected",t.RECONNECTING="websocket:reconnecting",t.WILL_RECONNECT="websocket:will_reconnect",t.CLOSED="websocket:closed",t.FAILED="websocket:failed",t.ON_MESSAGE="websocket:on_message",t.REQUEST_NEW_URLS="websocket:request_new_urls",t.RECONNECT_CREATE_CONNECTION="websocket:reconnect_create_connection",t.ON_TOKEN_PRIVILEGE_DID_EXPIRE="websocket:on_token_privilege_did_expire",t}({});function VP(t){if(typeof t!="string"||!/^[a-zA-Z0-9 \!\#\$\%\&\(\)\+\-\:\;\<\=\.\>\?\@\[\]\^\_\{\}\|\~\,]{1,64}$/.test(t))throw x.error("Invalid Channel Name ".concat(t)),new Pe(te.INVALID_PARAMS,"The length must be within 64 bytes. The supported characters: a-z,A-Z,0-9,space,!, #, $, %, &, (, ), +, -, :, ;, <, =, ., >, ?, @, [, ], ^, _,  {, }, |, ~, ,")}function FP(t){if(r=t,!(typeof r=="number"&&Math.floor(r)===r&&0<=r&&r<=4294967295||aW(t,1,255)))throw new Pe(te.INVALID_PARAMS,"[String uid] Length of the string: [1,255]. ASCII characters only. [Number uid] The value range is [0,10000]");var r;typeof t=="string"&&x.warn("You input a string as the user ID, to ensure better end-user experience, Agora highly suggests not using a string as the user ID.")}let df=function(t){return t.TRANSCODE="mix_streaming",t.RAW="raw_streaming",t}({});const Kge={alpha:1,height:640,width:360,x:0,y:0,zOrder:0,audioChannel:0},O2={x:0,y:0,width:160,height:160,zOrder:255,alpha:1};function N2(t,r){Ss(t.url,"".concat(r,".url"),1,1e3,!1),ri(t.x)||_r(t.x,"".concat(r,".x"),0,1e4),ri(t.y)||_r(t.y,"".concat(r,".y"),0,1e4),ri(t.width)||_r(t.width,"".concat(r,".width"),0,1e4),ri(t.height)||_r(t.height,"".concat(r,".height"),0,1e4),ri(t.zOrder)||_r(t.zOrder,"".concat(r,".zOrder"),0,255),ri(t.alpha)||_r(t.alpha,"".concat(r,".alpha"),0,1,!1)}const qge={audioBitrate:48,audioChannels:1,audioSampleRate:48e3,backgroundColor:0,height:360,lowLatency:!1,videoBitrate:400,videoCodecProfile:100,videoCodecType:1,videoFrameRate:15,videoGop:30,width:640,images:[],userConfigs:[],userConfigExtraInfo:""};let Km=function(t){return t.WARNING="@live_uap-warning",t.ERROR="@line_uap-error",t.PUBLISH_STREAM_STATUS="@live_uap-publish-status",t.WORKER_STATUS="@live_uap-worker-status",t.REQUEST_NEW_ADDRESS="@live_uap-request-address",t}({}),D2=function(t){return t.REQUEST_WORKER_MANAGER_LIST="@live_req_worker_manager",t}({}),Wi=function(t){return t[t.LIVE_STREAM_RESPONSE_SUCCEED=200]="LIVE_STREAM_RESPONSE_SUCCEED",t[t.LIVE_STREAM_RESPONSE_ALREADY_EXISTS_STREAM=454]="LIVE_STREAM_RESPONSE_ALREADY_EXISTS_STREAM",t[t.LIVE_STREAM_RESPONSE_TRANSCODING_PARAMETER_ERROR=450]="LIVE_STREAM_RESPONSE_TRANSCODING_PARAMETER_ERROR",t[t.LIVE_STREAM_RESPONSE_BAD_STREAM=451]="LIVE_STREAM_RESPONSE_BAD_STREAM",t[t.LIVE_STREAM_RESPONSE_WM_PARAMETER_ERROR=400]="LIVE_STREAM_RESPONSE_WM_PARAMETER_ERROR",t[t.LIVE_STREAM_RESPONSE_WM_WORKER_NOT_EXIST=404]="LIVE_STREAM_RESPONSE_WM_WORKER_NOT_EXIST",t[t.LIVE_STREAM_RESPONSE_NOT_AUTHORIZED=456]="LIVE_STREAM_RESPONSE_NOT_AUTHORIZED",t[t.LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE=457]="LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE",t[t.LIVE_STREAM_RESPONSE_REQUEST_TOO_OFTEN=429]="LIVE_STREAM_RESPONSE_REQUEST_TOO_OFTEN",t[t.LIVE_STREAM_RESPONSE_NOT_FOUND_PUBLISH=452]="LIVE_STREAM_RESPONSE_NOT_FOUND_PUBLISH",t[t.LIVE_STREAM_RESPONSE_NOT_SUPPORTED=453]="LIVE_STREAM_RESPONSE_NOT_SUPPORTED",t[t.LIVE_STREAM_RESPONSE_MAX_STREAM_NUM=455]="LIVE_STREAM_RESPONSE_MAX_STREAM_NUM",t[t.LIVE_STREAM_RESPONSE_INTERNAL_SERVER_ERROR=500]="LIVE_STREAM_RESPONSE_INTERNAL_SERVER_ERROR",t[t.LIVE_STREAM_RESPONSE_WORKER_LOST=501]="LIVE_STREAM_RESPONSE_WORKER_LOST",t[t.LIVE_STREAM_RESPONSE_RESOURCE_LIMIT=502]="LIVE_STREAM_RESPONSE_RESOURCE_LIMIT",t[t.LIVE_STREAM_RESPONSE_WORKER_QUIT=503]="LIVE_STREAM_RESPONSE_WORKER_QUIT",t[t.ERROR_FAIL_SEND_MESSAGE=504]="ERROR_FAIL_SEND_MESSAGE",t[t.PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE=30]="PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE",t[t.PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT=31]="PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT",t[t.PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH=32]="PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH",t[t.PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN=33]="PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN",t}({});function oH(t){if(!t.channelName)throw new Pe(te.INVALID_PARAMS,"invalid channelName in info");if(typeof t.uid!="number")throw new Pe(te.INVALID_PARAMS,"invalid uid in info, uid must be a number");return t.token&&Ss(t.token,"info.token",1,2047),FP(t.uid),VP(t.channelName),!0}let ra=function(t){return t[t.SetSdkProfile=0]="SetSdkProfile",t[t.SetSourceChannel=1]="SetSourceChannel",t[t.SetSourceUserId=2]="SetSourceUserId",t[t.SetDestChannel=3]="SetDestChannel",t[t.StartPacketTransfer=4]="StartPacketTransfer",t[t.StopPacketTransfer=5]="StopPacketTransfer",t[t.UpdateDestChannel=6]="UpdateDestChannel",t[t.Reconnect=7]="Reconnect",t[t.SetVideoProfile=8]="SetVideoProfile",t}({}),hf=function(t){return t.NETWORK_DISCONNECTED="NETWORK_DISCONNECTED",t.NETWORK_CONNECTED="NETWORK_CONNECTED",t.PACKET_JOINED_SRC_CHANNEL="PACKET_JOINED_SRC_CHANNEL",t.PACKET_JOINED_DEST_CHANNEL="PACKET_JOINED_DEST_CHANNEL",t.PACKET_SENT_TO_DEST_CHANNEL="PACKET_SENT_TO_DEST_CHANNEL",t.PACKET_RECEIVED_VIDEO_FROM_SRC="PACKET_RECEIVED_VIDEO_FROM_SRC",t.PACKET_RECEIVED_AUDIO_FROM_SRC="PACKET_RECEIVED_AUDIO_FROM_SRC",t.PACKET_UPDATE_DEST_CHANNEL="PACKET_UPDATE_DEST_CHANNEL",t.PACKET_UPDATE_DEST_CHANNEL_REFUSED="PACKET_UPDATE_DEST_CHANNEL_REFUSED",t.PACKET_UPDATE_DEST_CHANNEL_NOT_CHANGE="PACKET_UPDATE_DEST_CHANNEL_NOT_CHANGE",t}({}),Ja=function(t){return t.RELAY_STATE_IDLE="RELAY_STATE_IDLE",t.RELAY_STATE_CONNECTING="RELAY_STATE_CONNECTING",t.RELAY_STATE_RUNNING="RELAY_STATE_RUNNING",t.RELAY_STATE_FAILURE="RELAY_STATE_FAILURE",t}({}),i0=function(t){return t.RELAY_OK="RELAY_OK",t.SERVER_CONNECTION_LOST="SERVER_CONNECTION_LOST",t.SRC_TOKEN_EXPIRED="SRC_TOKEN_EXPIRED",t.DEST_TOKEN_EXPIRED="DEST_TOKEN_EXPIRED",t}({}),or=function(t){return t.High="high",t.Low="low",t.Audio="audio",t.Screen="screen",t.ScreenLow="screen_low",t}({}),ps=function(t){return t.DISCONNECT="disconnect",t.CONNECTION_STATE_CHANGE="connection-state-change",t.NETWORK_QUALITY="network-quality",t.STREAM_TYPE_CHANGE="stream-type-change",t.IS_P2P_DISCONNECTED="is-p2p-dis",t.DISCONNECT_P2P="dis-p2p",t.REQUEST_NEW_GATEWAY_LIST="req-gate-url",t.NEED_RENEW_SESSION="need-sid",t.REQUEST_P2P_CONNECTION_PARAMS="request-p2p-connection-params",t.JOIN_RESPONSE="join-response",t.RESET_CONNECTION_EVENTS="reset-connection-events",t.PRE_CONNECT_PC="pre-connect_pc",t.UPDATE_GATEWAY_CONFIG="update-gateway-config",t}({}),jP=function(t){return t.P2P_DISCONNECTED="P2P_DISCONNECTED",t.A_ROUND_WS_FAILED="A_ROUND_WS_FAILED",t.TIMEOUT="TIMEOUT",t.UNKNOWN_REASON="UNKNOWN_REASON",t}({}),ss=function(t){return t[t.Nothing=0]="Nothing",t[t.Audio=1]="Audio",t[t.LwoVideo=2]="LwoVideo",t[t.Video=4]="Video",t[t.Data=8]="Data",t[t.DataStream0=256]="DataStream0",t[t.DataStream1=512]="DataStream1",t[t.DataStream2=1024]="DataStream2",t[t.DataStream3=2048]="DataStream3",t[t.DataStream4=4096]="DataStream4",t[t.DataStream5=8192]="DataStream5",t[t.DataStream6=16384]="DataStream6",t[t.DataStream7=32768]="DataStream7",t}({}),Jn=function(t){return t.CHINA="CHINA",t.ASIA="ASIA",t.NORTH_AMERICA="NORTH_AMERICA",t.EUROPE="EUROPE",t.JAPAN="JAPAN",t.INDIA="INDIA",t.KOREA="KOREA",t.HKMC="HKMC",t.US="US",t.OCEANIA="OCEANIA",t.SOUTH_AMERICA="SOUTH_AMERICA",t.AFRICA="AFRICA",t.OVERSEA="OVERSEA",t.GLOBAL="GLOBAL",t.EXTENSIONS="EXTENSIONS",t}({});const aH=[Jn.AFRICA,Jn.ASIA,Jn.CHINA,Jn.EUROPE,Jn.GLOBAL,Jn.INDIA,Jn.JAPAN,Jn.NORTH_AMERICA,Jn.OCEANIA,Jn.OVERSEA,Jn.SOUTH_AMERICA];let Js=function(t){return t.CHINA="CN",t.ASIA="AS",t.NORTH_AMERICA="NA",t.EUROPE="EU",t.JAPAN="JP",t.INDIA="IN",t.KOREA="KR",t.HKMC="HK",t.US="US",t.OCEANIA="OC",t.SOUTH_AMERICA="SA",t.AFRICA="AF",t.OVERSEA="OVERSEA",t.GLOBAL="GLOBAL",t.EXTENSIONS="GLOBAL",t}({});const BP={CHINA:{},ASIA:{CODE:Js.ASIA,WEBCS_DOMAIN:["ap-web-1-asia.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-asia.agora.io"],PROXY_CS:["proxy-ap-web-asia.agora.io"],CDS_AP:["cds-ap-web-asia.agora.io","cds-ap-web-asia2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-asia.agora.io","sua-ap-web-asia2.agora.io"],UAP_AP:["uap-ap-web-asia.agora.io","uap-ap-web-asia2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-asia.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-asia.agora.io"],LOG_UPLOAD_SERVER:["logservice-asia.agora.io"],PROXY_SERVER_TYPE3:["southeast-asia.webrtc-cloud-proxy.sd-rtn.com"]},NORTH_AMERICA:{CODE:Js.NORTH_AMERICA,WEBCS_DOMAIN:["ap-web-1-north-america.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-north-america.agora.io"],PROXY_CS:["proxy-ap-web-america.agora.io"],CDS_AP:["cds-ap-web-america.agora.io","cds-ap-web-america2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-america.agora.io","sua-ap-web-america2.agora.io"],UAP_AP:["uap-ap-web-america.agora.io","uap-ap-web-america2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-north-america.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-north-america.agora.io"],LOG_UPLOAD_SERVER:["logservice-north-america.agora.io"],PROXY_SERVER_TYPE3:["east-usa.webrtc-cloud-proxy.sd-rtn.com"]},EUROPE:{CODE:Js.EUROPE,WEBCS_DOMAIN:["ap-web-1-europe.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-europe.agora.io"],PROXY_CS:["proxy-ap-web-europe.agora.io"],CDS_AP:["cds-ap-web-europe.agora.io","cds-ap-web-europe2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-europe.agora.io","sua-ap-web-europe.agora.io"],UAP_AP:["uap-ap-web-europe.agora.io","uap-ap-web-europe2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-europe.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-europe.agora.io"],LOG_UPLOAD_SERVER:["logservice-europe.agora.io"],PROXY_SERVER_TYPE3:["europe.webrtc-cloud-proxy.sd-rtn.com"]},JAPAN:{CODE:Js.JAPAN,WEBCS_DOMAIN:["ap-web-1-japan.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-japan.agora.io"],PROXY_CS:["proxy-ap-web-japan.agora.io"],CDS_AP:["cds-ap-web-japan.agora.io","cds-ap-web-japan2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-japan.agora.io","sua-ap-web-japan2.agora.io"],UAP_AP:["uap-ap-web-japan.agora.io","uap-ap-web-japan2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-japan.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-japan.agora.io"],LOG_UPLOAD_SERVER:["logservice-japan.agora.io"],PROXY_SERVER_TYPE3:["japan.webrtc-cloud-proxy.sd-rtn.com"]},INDIA:{CODE:Js.INDIA,WEBCS_DOMAIN:["ap-web-1-india.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-india.agora.io"],PROXY_CS:["proxy-ap-web-india.agora.io"],CDS_AP:["cds-ap-web-india.agora.io","cds-ap-web-india2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-india.agora.io","sua-ap-web-india2.agora.io"],UAP_AP:["uap-ap-web-india.agora.io","uap-ap-web-india2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-india.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-india.agora.io"],LOG_UPLOAD_SERVER:["logservice-india.agora.io"],PROXY_SERVER_TYPE3:["india.webrtc-cloud-proxy.sd-rtn.com"]},KOREA:{CODE:Js.KOREA,WEBCS_DOMAIN:["ap-web-1-korea.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-korea.agora.io"],PROXY_CS:["proxy-ap-web-korea.agora.io"],CDS_AP:["cds-ap-web-korea.agora.io","cds-ap-web-korea2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-korea.agora.io","sua-ap-web-korea2.agora.io"],UAP_AP:["uap-ap-web-korea.agora.io","uap-ap-web-korea2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-korea.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-korea.agora.io"],LOG_UPLOAD_SERVER:["logservice-korea.agora.io"],PROXY_SERVER_TYPE3:["korea.webrtc-cloud-proxy.sd-rtn.com"]},HKMC:{CODE:Js.HKMC,WEBCS_DOMAIN:["ap-web-1-hkmc.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-hkmc.agora.io"],PROXY_CS:["proxy-ap-web-hkmc.agora.io"],CDS_AP:["cds-ap-web-hkmc.agora.io","cds-ap-web-hkmc2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-hkmc.agora.io","sua-ap-web-hkmc2.agora.io"],UAP_AP:["uap-ap-web-hkmc.agora.io","uap-ap-web-hkmc2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-hkmc.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-hkmc.agora.io"],LOG_UPLOAD_SERVER:["logservice-hkmc.agora.io"],PROXY_SERVER_TYPE3:["hkmc.webrtc-cloud-proxy.sd-rtn.com"]},US:{CODE:Js.US,WEBCS_DOMAIN:["ap-web-1-us.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-us.agora.io"],PROXY_CS:["proxy-ap-web-us.agora.io"],CDS_AP:["cds-ap-web-us.agora.io","cds-ap-web-us2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-us.agora.io","sua-ap-web-us2.agora.io"],UAP_AP:["uap-ap-web-us.agora.io","uap-ap-web-us2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-us.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-us.agora.io"],LOG_UPLOAD_SERVER:["logservice-us.agora.io"],PROXY_SERVER_TYPE3:["us.webrtc-cloud-proxy.sd-rtn.com"]},OVERSEA:{CODE:Js.OVERSEA,WEBCS_DOMAIN:["ap-web-1-oversea.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-oversea.agora.io"],PROXY_CS:["proxy-ap-web-oversea.agora.io"],CDS_AP:["cds-ap-web-oversea.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-oversea.agora.io"],UAP_AP:["uap-ap-web-oversea.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-oversea.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-oversea.agora.io"],LOG_UPLOAD_SERVER:["logservice-oversea.agora.io"],PROXY_SERVER_TYPE3:["webrtc-cloud-proxy.agora.io"]},GLOBAL:{CODE:Js.GLOBAL,WEBCS_DOMAIN:["webrtc2-ap-web-1.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["webrtc2-ap-web-3.agora.io"],PROXY_CS:["ap-proxy-1.agora.io","ap-proxy-2.agora.io"],CDS_AP:["cds-ap-web-1.agora.io","cds-ap-web-3.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-1.agora.io","sua-ap-web-3.agora.io"],UAP_AP:["uap-ap-web-1.agora.io","uap-ap-web-3.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2.agora.io"],LOG_UPLOAD_SERVER:["logservice.agora.io"],PROXY_SERVER_TYPE3:["webrtc-cloud-proxy.sd-rtn.com"]},OCEANIA:{CODE:Js.OCEANIA,WEBCS_DOMAIN:["ap-web-1-oceania.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-oceania.agora.io"],PROXY_CS:["proxy-ap-web-oceania.agora.io"],CDS_AP:["cds-ap-web-oceania.agora.io","cds-ap-web-oceania2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-oceania.agora.io","sua-ap-web-oceania2.agora.io"],UAP_AP:["uap-ap-web-oceania.agora.io","uap-ap-web-oceania2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-oceania.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-oceania.agora.io"],LOG_UPLOAD_SERVER:["logservice-oceania.agora.io"],PROXY_SERVER_TYPE3:["oceania.webrtc-cloud-proxy.sd-rtn.com"]},SOUTH_AMERICA:{CODE:Js.SOUTH_AMERICA,WEBCS_DOMAIN:["ap-web-1-south-america.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-south-america.agora.io"],PROXY_CS:["proxy-ap-web-south-america.agora.io"],CDS_AP:["cds-ap-web-south-america.agora.io","cds-ap-web-south-america2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-south-america.agora.io","sua-ap-web-south-america2.agora.io"],UAP_AP:["uap-ap-web-south-america.agora.io","uap-ap-web-south-america2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-south-america.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-south-america.agora.io"],LOG_UPLOAD_SERVER:["logservice-south-america.agora.io"],PROXY_SERVER_TYPE3:["south-america.webrtc-cloud-proxy.sd-rtn.com"]},AFRICA:{CODE:Js.AFRICA,WEBCS_DOMAIN:["ap-web-1-africa.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-africa.agora.io"],PROXY_CS:["proxy-ap-web-africa.agora.io"],CDS_AP:["cds-ap-web-africa.agora.io","cds-ap-web-africa2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-africa.agora.io","sua-ap-web-africa2.agora.io"],UAP_AP:["uap-ap-web-africa.agora.io","uap-ap-web-africa2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-africa.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-africa.agora.io"],LOG_UPLOAD_SERVER:["logservice-south-africa.agora.io"],PROXY_SERVER_TYPE3:["africa.webrtc-cloud-proxy.sd-rtn.com"]},EXTENSIONS:{}};XL&&(BP.CHINA={CODE:Js.CHINA,WEBCS_DOMAIN:["webrtc2-2.ap.sd-rtn.com"],WEBCS_DOMAIN_BACKUP_LIST:["webrtc2-4.ap.sd-rtn.com"],PROXY_CS:["proxy-web.ap.sd-rtn.com"],CDS_AP:["cds-web-2.ap.sd-rtn.com","cds-web-4.ap.sd-rtn.com"],ACCOUNT_REGISTER:["sua-web-2.ap.sd-rtn.com","sua-web-4.ap.sd-rtn.com"],UAP_AP:["uap-web-2.ap.sd-rtn.com","uap-web-4.ap.sd-rtn.com"],EVENT_REPORT_DOMAIN:["web-3.statscollector.sd-rtn.com"],EVENT_REPORT_BACKUP_DOMAIN:["web-4.statscollector.sd-rtn.com"],LOG_UPLOAD_SERVER:["logservice-china.agora.io"],PROXY_SERVER_TYPE3:["east-cn.webrtc-cloud-proxy.sd-rtn.com"]});let oT=function(t){return t.UPDATE_BITRATE_LIMIT="update_bitrate_limit",t.UPDATE_CLIENT_ROLE_OPTIONS="update_client_role_options",t}({});function cH(t){return!!t&&!(!t.uplink||!t.id)&&t.uplink.max_bitrate!==void 0&&t.uplink.min_bitrate!==void 0}class lH extends Jr{constructor(r,s){super(),Y(this,"onICEConnectionStateChange",void 0),Y(this,"onConnectionStateChange",void 0),Y(this,"onDTLSTransportStateChange",void 0),Y(this,"onDTLSTransportError",void 0),Y(this,"onICETransportStateChange",void 0),Y(this,"onFirstAudioReceived",void 0),Y(this,"onFirstVideoReceived",void 0),Y(this,"onFirstAudioDecoded",void 0),Y(this,"onFirstVideoDecoded",void 0),Y(this,"onFirstVideoRender",void 0),Y(this,"onFirstVideoDecodedTimeout",void 0),Y(this,"onSelectedLocalCandidateChanged",void 0),Y(this,"onSelectedRemoteCandidateChanged",void 0),Y(this,"onICECandidateError",void 0),Y(this,"getLocalVideoStats",void 0)}}class uH extends lH{constructor(r,s){super(r,s),Y(this,"establishPromise",void 0)}}let yt=function(t){return t.VIDEO="video",t.AUDIO="audio",t}({}),Qs=function(t){return t.UDP_RELAY="udp_relay",t.UDP_TCP_RELAY="udp_tcp_relay",t.TCP_RELAY="tcp_relay",t.RELAY="relay",t}({}),pf=function(t){return t[t.FIRST_CONNECTION=0]="FIRST_CONNECTION",t[t.UDP_TCP_RESTART=1]="UDP_TCP_RESTART",t[t.RELAY_RESTART=2]="RELAY_RESTART",t[t.TCP_RESTART=3]="TCP_RESTART",t[t.OLD_FIRST_CONNECTION=10]="OLD_FIRST_CONNECTION",t[t.OLD_RESTART=11]="OLD_RESTART",t[t.DISCONNECTED_OR_FAILED=20]="DISCONNECTED_OR_FAILED",t}({});const dH=["disconnected","failed"];let qe=function(t){return t.LocalVideoTrack="videoTrack",t.LocalAudioTrack="audioTrack",t.LocalVideoLowTrack="videoLowTrack",t}({}),ir=function(t){return t.New="new",t.Connected="connected",t.Reconnecting="reconnecting",t.Disconnected="disconnected",t}({}),Vt=function(t){return t.AudioMetadata="audioMetadata",t.AudioPts="audioPts",t.StateChange="stateChange",t.IceConnectionStateChange="iceConnectionStateChange",t.RequestMuteLocal="requestMuteLocal",t.RequestUnmuteLocal="requestUnmuteLocal",t.RequestRePublish="requestRePublish",t.RequestRePublishDataChannel="requestRePublishDataChannel",t.RequestReSubscribe="requestReSubscribe",t.RequestUploadStats="requestUploadStats",t.RequestUpload="requestUpload",t.MediaReconnectStart="MediaReconnectStart",t.MediaReconnectEnd="MediaReconnectEnd",t.NeedSignalRTT="NeedSignalRTT",t.RequestRestartICE="RequestRestartIce",t.PeerConnectionStateChange="PeerConnectionStateChange",t.RequestReconnect="RequestReconnect",t.RequestReconnectPC="RequestReconnectPC",t.RequestUnpublishForReconnectPC="RequestUnpublishForReconnectPC",t.P2PLost="P2PLost",t.UpdateVideoEncoder="UpdateVideoEncoder",t.ConnectionTypeChange="ConnectionTypeChange",t.RequestLowStreamParameter="RequestLowStreamParameter",t.QueryClientConnectionState="QueryClientConnectionState",t.LocalCandidate="LocalCandidate",t.RequestP2PMuteLocal="requestP2PMuteLocal",t.RequestP2PUnPublish="RequestP2PUnPublish",t.RequestP2PUnmuteRemote="RequestP2PUnmuteRemote",t.RequestP2PMuteRemote="RequestP2PMuteRemote",t.RequestP2PRestartICE="RequestP2PRestartICE",t}({}),Fu=function(t){return t.CONNECTING="CONNECTING",t.RECONNECTING="RECONNECTING",t.CONNECTED="CONNECTED",t.CLOSED="CLOSED",t}({}),ju=function(t){return t[t.CONNECT_AP=0]="CONNECT_AP",t[t.AP_CONNECTED=1]="AP_CONNECTED",t[t.CONNECT_WORKER_MANAGER=2]="CONNECT_WORKER_MANAGER",t[t.WORKER_MANAGER_CONNECTED=3]="WORKER_MANAGER_CONNECTED",t[t.GET_WORKER_MANAGER_RESPONSE=4]="GET_WORKER_MANAGER_RESPONSE",t[t.CONNECT_WORKER=5]="CONNECT_WORKER",t[t.WORKER_CONNECTED=6]="WORKER_CONNECTED",t[t.CLOSED=7]="CLOSED",t}({}),fs=function(t){return t.CONNECTION_STATE_CHANGE="connection-state-change",t.STATE_CHANGE="state-change",t.INSPECT_RESULT="inspect-result",t.CLIENT_LOCAL_VIDEO_TRACK="client-local-video-track",t.REQUEST_NEW_WORKER_URL="request-new-worker-url",t}({}),hH=function(t){return t.CONNECTED="transmitter:connected",t.RECONNECTING="transmitter:reconnecting",t.WILL_RECONNECT="transmitter:will_reconnect",t.CLOSED="transmitter:closed",t.FAILED="transmitter:failed",t.ON_MESSAGE="transmitter:on_message",t.REQUEST_NEW_URLS="transmitter:request_new_urls",t.RECONNECT_CREATE_CONNECTION="transmitter:reconnect_create_connection",t.ON_TOKEN_PRIVILEGE_DID_EXPIRE="transmitter:on_token_privilege_did_expire",t.TO_CONNECT_DATACHANNEL="transmitter:to_connect_datachannel",t.FAILBACK="transmitter:failback",t.PRE_CONNECT_PC="transmitter:pre_connect_pc",t}({}),Yh=function(t){return t.CAMERA_CHANGED="camera-changed",t.MICROPHONE_CHANGED="microphone-changed",t.PLAYBACK_DEVICE_CHANGED="playback-device-changed",t.AUDIO_AUTOPLAY_FAILED="audio-autoplay-failed",t.AUTOPLAY_FAILED="autoplay-failed",t.AUDIO_CONTEXT_STATE_CHANGED="audio-context-state-changed",t.SECURITY_POLICY_VIOLATION="security-policy-violation",t}({}),Hl=function(t){return t.CONNECTING="CONNECTING",t.RECONNECTING="RECONNECTING",t.CONNECTED="CONNECTED",t.CLOSED="CLOSED",t}({}),$d=function(t){return t.CONNECTION_STATE_CHANGE="connection-state-change",t.STATE_CHANGE="state-change",t.INSPECT_RESULT="inspect-result",t.CLIENT_LOCAL_VIDEO_TRACK="client-local-video-track",t.REQUEST_NEW_WORKER_URL="request-new-worker-url",t}({}),s0=function(t){return t[t.CONNECT_AP=0]="CONNECT_AP",t[t.AP_CONNECTED=1]="AP_CONNECTED",t[t.CONNECT_WORKER_MANAGER=2]="CONNECT_WORKER_MANAGER",t[t.WORKER_MANAGER_CONNECTED=3]="WORKER_MANAGER_CONNECTED",t[t.GET_WORKER_MANAGER_RESPONSE=4]="GET_WORKER_MANAGER_RESPONSE",t[t.CONNECT_WORKER=5]="CONNECT_WORKER",t[t.WORKER_CONNECTED=6]="WORKER_CONNECTED",t[t.CLOSED=7]="CLOSED",t}({}),Ei=function(t){return t.CALL="call",t.CANDIDATE="candidate",t.PUBLISH="publish",t.UNPUBLISH="unpublish",t.CONTROL="control",t.RESTART_ICE="restart_ice",t.ACK="ack",t.RESPONSE="response",t.JOIN="join",t.CHECK="check",t}({}),o0=function(t){return t.ABORT="abort",t}({}),qm=function(t){return t.MUTE_LOCAL_AUDIO="mute_local_audio",t.MUTE_LOCAL_VIDEO="mute_local_video",t.UNMUTE_LOCAL_AUDIO="unmute_local_audio",t.UNMUTE_LOCAL_VIDEO="unmute_local_video",t}({}),Yge=function(t){return t.P2P_TOKEN_TIMEOUT="p2p_token_timeout",t.P2P_TOKEN_CHANGED="p2p_token_changed",t}({});const Xge={[UP.ACCESS_POINT]:{[ta.NO_FLAG_SET]:{desc:"flag is zero",retry:!1},[ta.FLAG_SET_BUT_EMPTY]:{desc:"flag is empty",retry:!1},[ta.INVALID_FALG_SET]:{desc:"invalid flag",retry:!1},[ta.FLAG_SET_BUT_NO_RE]:{desc:"flag set unilbs but no request",retry:!1},[ta.INVALID_SERVICE_ID]:{desc:"invalid service id",retry:!1},[ta.NO_SERVICE_AVAILABLE]:{desc:"no service available",retry:!0},[ta.NO_SERVICE_AVAILABLE_P2P]:{desc:"no unilbs p2p service available",retry:!0},[ta.NO_SERVICE_AVAILABLE_VOICE]:{desc:"no unilbs voice service available",retry:!0},[ta.NO_SERVICE_AVAILABLE_WEBRTC]:{desc:"no unilbs webrtc service available",retry:!0},[ta.NO_SERVICE_AVAILABLE_CDS]:{desc:"no cds service available",retry:!0},[ta.NO_SERVICE_AVAILABLE_CDN]:{desc:"no cdn dispatcher service available",retry:!0},[ta.NO_SERVICE_AVAILABLE_TDS]:{desc:"no tds service available",retry:!0},[ta.NO_SERVICE_AVAILABLE_REPORT]:{desc:"no unilbs report service available",retry:!0},[ta.NO_SERVICE_AVAILABLE_APP_CENTER]:{desc:"no app center service available",retry:!0},[ta.NO_SERVICE_AVAILABLE_ENV0]:{desc:"no unilbs sig env0 service available",retry:!0},[ta.NO_SERVICE_AVAILABLE_VOET]:{desc:"no unilbs voet service available",retry:!0},[ta.NO_SERVICE_AVAILABLE_STRING_UID]:{desc:"no string uid service available",retry:!0},[ta.NO_SERVICE_AVAILABLE_WEBRTC_UNILBS]:{desc:"no webrtc unilbs service available",retry:!0}},[UP.UNILBS]:{[Vu.INVALID_VENDOR_KEY]:{desc:"invalid vendor key, can not find appid",retry:!1},[Vu.INVALID_CHANNEL_NAME]:{desc:"invalid channel name",retry:!1},[Vu.INTERNAL_ERROR]:{desc:"unilbs internal error",retry:!1},[Vu.NO_AUTHORIZED]:{desc:"invalid token, authorized failed",retry:!1},[Vu.DYNAMIC_KEY_TIMEOUT]:{desc:"dynamic key or token timeout",retry:!1},[Vu.NO_ACTIVE_STATUS]:{desc:"no active status",retry:!1},[Vu.DYNAMIC_KEY_EXPIRED]:{desc:"dynamic key expired",retry:!1},[Vu.STATIC_USE_DYNAMIC_KEY]:{desc:"static use dynamic key",retry:!1},[Vu.DYNAMIC_USE_STATIC_KEY]:{desc:"dynamic use static key",retry:!1},[Vu.USER_OVERLOAD]:{desc:"amount of users over load",retry:!1},[Vu.FORBIDDEN_REGION]:{desc:"the request is forbidden in this area",retry:!1},[Vu.CANNOT_MEET_AREA_DEMAND]:{desc:"unable to allocate services in this area",retry:!1}},[UP.STRING_UID_ALLOCATOR]:{[k2.IIIEGAL_APPID]:{desc:"invalid appid",retry:!1},[k2.IIIEGAL_UID]:{desc:"invalid string uid",retry:!1},[k2.INTERNAL_ERROR]:{desc:"string uid allocator internal error",retry:!0}}};function a0(t){const r=Xge[Math.floor(t/1e4)];if(!r)return{desc:"unknown error",retry:!1};const s=r[t%1e4];if(!s){if(Math.floor(t/1e4)===UP.ACCESS_POINT){const a=t%1e4;if(a.toString()[0]==="1")return{desc:t.toString(),retry:!1};if(a.toString()[0]==="2")return{desc:t.toString(),retry:!0}}return{desc:"unknown error",retry:!1}}return s}const Jge={[zt.K_TIMESTAMP_EXPIRED]:{desc:"K_TIMESTAMP_EXPIRED",action:"failed"},[zt.K_CHANNEL_PERMISSION_INVALID]:{desc:"K_CHANNEL_PERMISSION_INVALID",action:"failed"},[zt.K_CERTIFICATE_INVALID]:{desc:"K_CERTIFICATE_INVALID",action:"failed"},[zt.K_CHANNEL_NAME_EMPTY]:{desc:"K_CHANNEL_NAME_EMPTY",action:"failed"},[zt.K_CHANNEL_NOT_FOUND]:{desc:"K_CHANNEL_NOT_FOUND",action:"failed"},[zt.K_TICKET_INVALID]:{desc:"K_TICKET_INVALID",action:"failed"},[zt.K_CHANNEL_CONFLICTED]:{desc:"K_CHANNEL_CONFLICTED",action:"failed"},[zt.K_SERVICE_NOT_READY]:{desc:"K_SERVICE_NOT_READY",action:"tryNext"},[zt.K_SERVICE_TOO_HEAVY]:{desc:"K_SERVICE_TOO_HEAVY",action:"tryNext"},[zt.K_UID_BANNED]:{desc:"K_UID_BANNED",action:"failed"},[zt.K_IP_BANNED]:{desc:"K_IP_BANNED",action:"failed"},[zt.DATASTREAM2_NOT_AVAILABLE]:{desc:"DATASTREAM2_NOT_AVAILABLE",action:"quit"},[zt.K_AUTO_REBALANCE]:{desc:"k_AUTO_REBALANCE",action:"recover"},[zt.ERR_INVALID_VENDOR_KEY]:{desc:"ERR_INVALID_VENDOR_KEY",action:"failed"},[zt.ERR_INVALID_CHANNEL_NAME]:{desc:"ERR_INVALID_CHANNEL_NAME",action:"failed"},[zt.WARN_NO_AVAILABLE_CHANNEL]:{desc:"WARN_NO_AVAILABLE_CHANNEL",action:"failed"},[zt.WARN_LOOKUP_CHANNEL_TIMEOUT]:{desc:"WARN_LOOKUP_CHANNEL_TIMEOUT",action:"tryNext"},[zt.WARN_LOOKUP_CHANNEL_REJECTED]:{desc:"WARN_LOOKUP_CHANNEL_REJECTED",action:"failed"},[zt.WARN_OPEN_CHANNEL_TIMEOUT]:{desc:"WARN_OPEN_CHANNEL_TIMEOUT",action:"tryNext"},[zt.WARN_OPEN_CHANNEL_REJECTED]:{desc:"WARN_OPEN_CHANNEL_REJECTED",action:"failed"},[zt.WARN_REQUEST_DEFERRED]:{desc:"WARN_REQUEST_DEFERRED",action:"failed"},[zt.ERR_DYNAMIC_KEY_TIMEOUT]:{desc:"ERR_DYNAMIC_KEY_TIMEOUT",action:"failed"},[zt.ERR_NO_AUTHORIZED]:{desc:"ERR_NO_AUTHORIZED",action:"failed"},[zt.ERR_VOM_SERVICE_UNAVAILABLE]:{desc:"ERR_VOM_SERVICE_UNAVAILABLE",action:"tryNext"},[zt.ERR_NO_CHANNEL_AVAILABLE_CODE]:{desc:"ERR_NO_CHANNEL_AVAILABLE_CODE",action:"failed"},[zt.ERR_MASTER_VOCS_UNAVAILABLE]:{desc:"ERR_MASTER_VOCS_UNAVAILABLE",action:"tryNext"},[zt.ERR_INTERNAL_ERROR]:{desc:"ERR_INTERNAL_ERROR",action:"tryNext"},[zt.ERR_NO_ACTIVE_STATUS]:{desc:"ERR_NO_ACTIVE_STATUS",action:"failed"},[zt.ERR_INVALID_UID]:{desc:"ERR_INVALID_UID",action:"failed"},[zt.ERR_DYNAMIC_KEY_EXPIRED]:{desc:"ERR_DYNAMIC_KEY_EXPIRED",action:"failed"},[zt.ERR_STATIC_USE_DYANMIC_KE]:{desc:"ERR_STATIC_USE_DYANMIC_KE",action:"failed"},[zt.ERR_DYNAMIC_USE_STATIC_KE]:{desc:"ERR_DYNAMIC_USE_STATIC_KE",action:"failed"},[zt.ERR_NO_VOCS_AVAILABLE]:{desc:"ERR_NO_VOCS_AVAILABLE",action:"tryNext"},[zt.ERR_NO_VOS_AVAILABLE]:{desc:"ERR_NO_VOS_AVAILABLE",action:"tryNext"},[zt.ERR_JOIN_CHANNEL_TIMEOUT]:{desc:"ERR_JOIN_CHANNEL_TIMEOUT",action:"tryNext"},[zt.ERR_JOIN_BY_MULTI_IP]:{desc:"ERR_JOIN_BY_MULTI_IP",action:"recover"},[zt.ERR_NOT_JOINED]:{desc:"ERR_NOT_JOINED",action:"failed"},[zt.ERR_REPEAT_JOIN_REQUEST]:{desc:"ERR_REPEAT_JOIN_REQUEST",action:"quit"},[zt.ERR_REPEAT_JOIN_CHANNEL]:{desc:"ERR_REPEAT_JOIN_CHANNEL",action:"quit"},[zt.ERR_INVALID_STRINGUID]:{desc:"ERR_INVALID_STRINGUID",action:"failed"},[zt.ERR_TOO_MANY_USERS]:{desc:"ERR_TOO_MANY_USERS",action:"tryNext"},[zt.ERR_SET_CLIENT_ROLE_TIMEOUT]:{desc:"ERR_SET_CLIENT_ROLE_TIMEOUT",action:"failed"},[zt.ERR_SET_CLIENT_ROLE_NO_PERMISSION]:{desc:"ERR_SET_CLIENT_ROLE_TIMEOUT",action:"failed"},[zt.ERR_SET_CLIENT_ROLE_ALREADY_IN_USE]:{desc:"ERR_SET_CLIENT_ROLE_ALREADY_IN_USE",action:"success"},[zt.ERR_PUBLISH_REQUEST_INVALID]:{desc:"ERR_PUBLISH_REQUEST_INVALID",action:"failed"},[zt.ERR_SUBSCRIBE_REQUEST_INVALID]:{desc:"ERR_SUBSCRIBE_REQUEST_INVALID",action:"failed"},[zt.ERR_NOT_SUPPORTED_MESSAGE]:{desc:"ERR_NOT_SUPPORTED_MESSAGE",action:"failed"},[zt.ERR_ILLEAGAL_PLUGIN]:{desc:"ERR_ILLEAGAL_PLUGIN",action:"failed"},[zt.ILLEGAL_CLIENT_ROLE_LEVEL]:{desc:"ILLEGAL_CLIENT_ROLE_LEVEL",action:"failed"},[zt.ERR_REJOIN_TOKEN_INVALID]:{desc:"ERR_REJOIN_TOKEN_INVALID",action:"failed"},[zt.ERR_REJOIN_USER_NOT_JOINED]:{desc:"ERR_REJOIN_NOT_JOINED",action:"failed"},[zt.ERR_INVALID_OPTIONAL_INFO]:{desc:"ERR_INVALID_OPTIONAL_INFO",action:"quit"},[zt.ERR_TEST_RECOVER]:{desc:"ERR_TEST_RECOVER",action:"recover"},[zt.ERR_TEST_TRYNEXT]:{desc:"ERR_TEST_TRYNEXT",action:"recover"},[zt.ERR_TEST_RETRY]:{desc:"ERR_TEST_RETRY",action:"recover"},[zt.ILLEGAL_AES_PASSWORD]:{desc:"ERR_TEST_RETRY",action:"failed"},[zt.ERR_TOO_MANY_BROADCASTERS]:{desc:"ERR_TOO_MANY_BROADCASTERS",action:"failed"},[zt.ERR_TOO_MANY_SUBSCRIBERS]:{desc:"ERR_TOO_MANY_SUBSCRIBERS",action:"failed"},[zt.ERR_LICENSE_ILLEGAL]:{desc:"ERR_LICENSE_ILLEGAL",action:"quit"},[zt.ERR_LICENSE_MISSING]:{desc:"ERR_LICENSE_MISSING",action:"quit"},[zt.ERR_LICENSE_EXPIRED]:{desc:"ERR_LICENSE_EXPIRED",action:"quit"},[zt.ERR_LICENSE_MINUTES_EXCEEDED]:{desc:"ERR_LICENSE_MINUTES_EXCEEDED",action:"quit"},[zt.ERR_LICENSE_PERIOD_INVALID]:{desc:"ERR_LICENSE_PERIOD_INVALID",action:"quit"},[zt.ERR_LICENSE_MULTIPLE_SDK_SERVICE]:{desc:"ERR_LICENSE_MULTIPLE_SDK_SERVICE",action:"quit"}};function aT(t){return Jge[t]||{desc:"UNKNOWN_ERROR_".concat(t),action:"failed"}}function pH(t,r){var s=Object.keys(t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);r&&(a=a.filter(function(c){return Object.getOwnPropertyDescriptor(t,c).enumerable})),s.push.apply(s,a)}return s}function x2(t){for(var r=1;r<arguments.length;r++){var s=arguments[r]!=null?arguments[r]:{};r%2?pH(Object(s),!0).forEach(function(a){Y(t,a,s[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(s)):pH(Object(s)).forEach(function(a){Object.defineProperty(t,a,Object.getOwnPropertyDescriptor(s,a))})}return t}function L2(t,r){if(typeof t=="string")return t;const{proxy:s,host:a,port:c}=t;if(r){const d=se("JOIN_GATEWAY_FALLBACK_PORT")||443;return d===443?"wss://".concat(a,"/ws/?p=").concat(Number(c)+150):"wss://".concat(a,":").concat(d,"/ws/?p=").concat(Number(c)+150)}return s?"wss://".concat(s,"/ws/?h=").concat(a,"&p=").concat(c):"wss://".concat(a,":").concat(c)}const Qge=/wss:\/\/(.+)\/ws\/\?h=(.+)&p=([0-9]+)\/?/,Zge=/wss:\/\/(.+)\/ws\/\?p=([0-9]+)\/?/,e_e=/wss:\/\/(.+):([0-9]+)\/?/,t_e=/wss:\/\/(.[^\/]+)\/?/;let n_e=0;class r_e{constructor(r,s){Y(this,"id",0),Y(this,"store",void 0),Y(this,"recordIndex",void 0),Y(this,"websockets",[]),Y(this,"try443PortDuration",2e3),Y(this,"forceCloseWSDuration",5e3),Y(this,"try443PortTimeout",null),Y(this,"forceCloseTimeout",null),Y(this,"isTry443PortFailed",!1),Y(this,"isNormalPortFailed",!1),Y(this,"useDoubleDomain",!1),Y(this,"useProxy",!1),Y(this,"startTime",Date.now()),this.id=++n_e,this.try443PortDuration=se("JOIN_GATEWAY_TRY_443PORT_DURATION")||2e3,this.forceCloseWSDuration=r||5e3,this.store=s}closeAllWebsockets(){this.websockets.forEach(r=>{r.onopen=null,r.onclose=null,r.onmessage=null,r.close()}),this.websockets.length=0}clearTimeout(){this.forceCloseTimeout&&clearTimeout(this.forceCloseTimeout),this.try443PortTimeout&&clearTimeout(this.try443PortTimeout),this.forceCloseTimeout=null,this.try443PortTimeout=null}logger(){var r;const s=Date.now()-this.startTime;for(var a=arguments.length,c=new Array(a),d=0;d<a;d++)c[d]=arguments[d];x.debug("[choose-best-ws ".concat((r=this.store)===null||r===void 0?void 0:r.clientId," ").concat(this.id,"] ").concat(s,"ms:"),...c)}createWebSocket(r,s,a){this.logger("createWebSocket:",r,{isTry443Port:s,hasTimeoutDetection:a});const c=se("GATEWAY_DOMAINS"),d=Date.now(),h=[],m=c.find(A=>{var k;return rt(k=r.host).call(k,A)});m||(this.useDoubleDomain=!1);const g=[];if(this.useDoubleDomain)c.forEach(A=>{g.push(L2(x2(x2({},r),{},{host:r.host.replace(m,A)}),s))});else{const A=x2({},r);if(s&&m){const k=c.find(W=>W!==m);k&&(A.host=A.host.replace(m,k))}g.push(L2(A,s))}try{g.forEach(A=>{const k=new WebSocket(A);k.binaryType="arraybuffer",h.push(k),this.logger("ws is connecting:",k.url)})}catch(A){if(this.logger("ws create failed"),h.forEach(k=>k.close()),h.length=0,this.useDoubleDomain)return this.useDoubleDomain=!1,this.createWebSocket(r,s,a);if(!s&&Number(r.port)!==443)return this.createWebSocket(r,!0,a);throw new Pe(te.WS_ERR,"init websocket failed! Error: ".concat(A.toString()))}const E=Hw();this.store&&this.store.recordJoinChannelService({urls:h.map(A=>A.url),service:"gateway"},this.recordIndex),h.forEach(A=>{A.onopen=()=>{this.logger("onopen: ws ".concat(A.url," open cost ").concat(Date.now()-d,"ms")),this.websockets.forEach(k=>{k!==A&&(k.onopen=null,k.onclose=null,k.onmessage=null,k.close(),this.logger("close backup websocket: ".concat(k.url)))}),this.websockets.length=0,E.resolve(A)},A.onclose=k=>{this.logger("onclose: ws ".concat(A.url," closed cost ").concat(Date.now()-d,"ms state: ").concat(A.readyState));const W=h.every(j=>j.readyState===WebSocket.CLOSED||j.readyState===WebSocket.CLOSING);this.logger("".concat(s?"443":"47xx"," websocket closed, all failed: ").concat(W)),W&&(s||this.isTry443PortFailed||this.useProxy)?(this.logger("onclose: all websocket is closed, ".concat(k.reason)),E.reject({code:k.code,reason:jP.A_ROUND_WS_FAILED})):!s&&W&&!this.isNormalPortFailed&&this.try443PortTimeout&&(this.logger("all 47xx websocket is closed, try 443 port"),this.clearTimeout(),I()),s?this.isTry443PortFailed=W:this.isNormalPortFailed=W},A.onmessage=k=>this.logger("".concat(A.url," onmessage: ").concat(k.data))}),this.websockets.push(...h);const b=()=>{this.websockets.forEach(A=>A.readyState!==WebSocket.OPEN&&A.close())},I=()=>{if(E.isResolved)return b();xn().os===is.MAC_OS&&ni()&&b(),this.createWebSocket(r,!0,!0).then(A=>{E.resolve(A)}).catch(A=>{this.isNormalPortFailed&&E.reject(A),this.logger("try 443 port to create ws failed")}),this.forceCloseTimeout=window.setTimeout(()=>{this.logger("5s timeout close un-opens, isWebsocket created: ",E.isResolved),this.forceCloseTimeout=null,b()},this.forceCloseWSDuration)};return a||(()=>{if(s||this.useProxy)return this.logger("add 5s timeout at ".concat(s?"try-443":"proxy"," condition")),this.forceCloseTimeout=window.setTimeout(()=>{this.forceCloseTimeout=null,b()},this.forceCloseWSDuration);this.try443PortTimeout=window.setTimeout(()=>{this.logger("2s timeout, isWebsocket created: ",E.isResolved),this.try443PortTimeout=null,I()},this.try443PortDuration)})(),E.promise}chooseBestWebsocket(r,s,a,c){return this.useDoubleDomain=!!s,typeof r=="string"&&(r=function(d){let h,m,g;return[,h,m,g]=d.match(Qge)||[],h||([,m,g]=d.match(Zge)||[]),m&&g||([,m,g]=d.match(e_e)||[]),m&&g||([,m]=d.match(t_e)||[]),m||x.warning("un-destructible url: ",d),{proxy:h,host:m,port:g||"443"}}(r)),this.recordIndex=c,this.useProxy=!!r.proxy,a&&this.useProxy&&(x.warn("cannot use 443 only when use proxy"),a=!1),this.createWebSocket(r,!!a,!1).finally(()=>this.clearTimeout())}}function fH(t,r){var s=Object.keys(t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);r&&(a=a.filter(function(c){return Object.getOwnPropertyDescriptor(t,c).enumerable})),s.push.apply(s,a)}return s}class mH extends Jr{get url(){return this.websocket&&this.websocket.url||this._websocketUrl}get reconnectMode(){return this._reconnectMode}set reconnectMode(r){var s;rt(s=["tryNext","recover"]).call(s,r)&&this.resetReconnectCount(r),this._reconnectMode=r}get state(){return this._state}set state(r){r!==this._state&&(this._state=r,this._state==="reconnecting"?this.emit(an.RECONNECTING,this.reconnectReason):this._state==="connected"?this.emit(an.CONNECTED):this._state==="closed"?this.emit(an.CLOSED):this._state==="failed"&&this.emit(an.FAILED))}resetReconnectCount(r){x.debug("websocket reset reconnect count, reason: "+r),this.reconnectCount=0}constructor(r,s){let a=arguments.length>2&&arguments[2]!==void 0&&arguments[2],c=arguments.length>3&&arguments[3]!==void 0&&arguments[3],d=arguments.length>4&&arguments[4]!==void 0&&arguments[4],h=arguments.length>5?arguments[5]:void 0;super(),Y(this,"_websocketUrl",null),Y(this,"connectionID",0),Y(this,"currentURLIndex",0),Y(this,"urls",[]),Y(this,"_reconnectMode","tryNext"),Y(this,"reconnectReason",void 0),Y(this,"_initMutex",void 0),Y(this,"name",void 0),Y(this,"_state","closed"),Y(this,"reconnectInterrupter",void 0),Y(this,"websocket",void 0),Y(this,"retryConfig",void 0),Y(this,"reconnectCount",0),Y(this,"forceCloseTimeout",5e3),Y(this,"onlineReconnectListener",void 0),Y(this,"useCompress",void 0),Y(this,"tryDoubleDomain",!1),Y(this,"use443PortOnly",!1),Y(this,"wsInflateLength",0),Y(this,"wsDeflateLength",0),Y(this,"closeEstablishingWs",()=>{}),Y(this,"store",void 0),Y(this,"joinGatewayRecordIndex",void 0),this.store=h,this.name=r,this.retryConfig=function(I){for(var A=1;A<arguments.length;A++){var k=arguments[A]!=null?arguments[A]:{};A%2?fH(Object(k),!0).forEach(function(W){Y(I,W,k[W])}):Object.getOwnPropertyDescriptors?Object.defineProperties(I,Object.getOwnPropertyDescriptors(k)):fH(Object(k)).forEach(function(W){Object.defineProperty(I,W,Object.getOwnPropertyDescriptor(k,W))})}return I}({},s),this.useCompress=a,this.tryDoubleDomain=c,this.use443PortOnly=d,this._initMutex=new Ys("websocket",h?h.clientId:void 0);const{timeout:m,timeoutFactor:g}=s,E=Math.max(300,Math.floor(3*m/5)),b=Math.max(1.2,Math.floor(8*g)/10);Tc.ONLINE&&(this.retryConfig.timeout=E,this.retryConfig.timeoutFactor=b),Ci.on(jv.NETWORK_STATE_CHANGE,(I,A)=>{I!==A&&(this.resetReconnectCount("network state change: ".concat(A," -> ").concat(I)),I===Tc.ONLINE?(this.retryConfig.timeout=E,this.retryConfig.timeoutFactor=b):(this.retryConfig.timeout=m,this.retryConfig.timeoutFactor=g))})}getConnection(){return this.websocket||void 0}async init(r){let s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:5e3;const a=await this._initMutex.lock();this._reconnectMode="tryNext",this.forceCloseTimeout=s,this.urls=r,this.state="connecting";try{var c;const d=Hw(),h=this.urls[this.currentURLIndex];(c=this.store)===null||c===void 0||c.beforeConnect(),function(m){return!(SP()||se("USE_NEW_TOKEN")||!se("ENABLE_PREALLOC_PC")&&(m==null||!m.autoSubscribe||se("FORCE_DISABLE_AUTO_SUB")))}(this.store)&&this.emit(hH.PRE_CONNECT_PC),this.createWebSocketConnection(h).then(d.resolve).catch(d.reject),this.once(an.CLOSED,()=>{d.reject(new Le(te.WS_DISCONNECT))}),this.once(an.CONNECTED,d.resolve),await d.promise}catch{}finally{a()}}close(r,s){if(this.currentURLIndex=0,this.resetReconnectCount("close"),this.reconnectInterrupter&&this.reconnectInterrupter(),this.websocket){this.websocket.onclose=null,this.websocket.onopen=null,this.websocket.onmessage=null;const a=this.websocket;s?setTimeout(()=>a.close(),500):a.close(),this.websocket=void 0,this._websocketUrl=null}this.state=r?"failed":"closed",this.closeEstablishingWs&&this.closeEstablishingWs()}reconnect(r,s){if(!this.websocket)return void x.warning("[".concat(this.name,"] can not reconnect, no websocket"));r!==void 0&&(this.reconnectMode=r),x.debug("[".concat(this.name,"] reconnect is triggered initiative")),typeof this.joinGatewayRecordIndex=="number"&&this.store&&this.store.recordJoinChannelService({status:"error",errors:[new Error(s)]},this.joinGatewayRecordIndex);const a=this.websocket.onclose;this.websocket.onclose=null,this.websocket.close(),a&&a.bind(this.websocket)({code:9999,reason:s})}sendMessage(r){let s=arguments.length>2&&arguments[2]!==void 0&&arguments[2];if(!this.websocket||this.websocket.readyState!==WebSocket.OPEN)throw new Le(te.WS_ABORT,"websocket is not ready");try{s||(r=JSON.stringify(r)),this.websocket.send(r)}catch(a){throw new Le(te.WS_ERR,"send websocket message error"+a.toString())}}setWsInflateData(r){this.wsDeflateLength=this.wsDeflateLength+r.originLength,this.wsInflateLength=this.wsInflateLength+r.compressedLength}getWsInflateData(){const r=this.wsInflateLength,s=this.wsDeflateLength;return this.clearWsInflateData(),{wsInflateLength:r,wsDeflateLength:s}}clearWsInflateData(){this.wsInflateLength=0,this.wsDeflateLength=0}async createWebSocketConnection(r){var s;const a=Hw();this.connectionID+=1,this.joinGatewayRecordIndex=void 0;const c=b=>{var I;(I=this.store)===null||I===void 0||I.signalChannelOpen(),x.debug("[".concat(this.name,"] websocket opened:"),b),this.reconnectMode="retry",this.state="connected",this.resetReconnectCount("opened"),a.resolve()},d=async b=>{var I;if(x.debug("[".concat(this.name,"] websocket close ").concat((I=this.websocket)===null||I===void 0?void 0:I.url,", code: ").concat(b.code,", reason: ").concat(b.reason,", current mode: ").concat(this.reconnectMode)),this.reconnectCount>=this.retryConfig.maxRetryCount)a.reject(new Le(te.WS_DISCONNECT,"websocket close: ".concat(b.code))),this.close();else{this.state==="connected"&&(this.reconnectReason=b.reason,this.state="reconnecting");const A=Yc(this,an.WILL_RECONNECT,this.reconnectMode,b.reason)||this.reconnectMode,k=await this.reconnectWithAction(A);if(this.state==="closed")return void x.debug("[".concat(this.connectionID,"] ws is closed, no need to reconnect"));if(!k)return a.reject(new Le(te.WS_DISCONNECT,"websocket reconnect failed: ".concat(b.code))),this.close(!0);a.resolve()}},h=b=>{this.emit(an.ON_MESSAGE,b)},m=b=>{x.warn("[".concat(this.connectionID,"] ws open error ").concat(b))};this.websocket&&(this.websocket.onclose=null,this.websocket.close()),se("GATEWAY_WSS_ADDRESS")&&this.name.startsWith("gateway")&&(r=se("GATEWAY_WSS_ADDRESS")),x.debug("[".concat(this.name,"] start connect, url:"),r);const g=(s=this.store)===null||s===void 0?void 0:s.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"gateway"});try{var E;this._websocketUrl=L2(r);const b=await this.chooseBestWebsocketConnection(r);this.websocket=b,c&&c(this.websocket.url),this.websocket.onclose=d,this.websocket.onmessage=h,this.websocket.onerror=m,(E=this.store)===null||E===void 0||E.recordJoinChannelService({endTs:Date.now(),status:"success"},g),this.joinGatewayRecordIndex=g}catch(b){const I=this.state==="closed",A=b instanceof Le,k=A&&b.code===te.WS_ABORT,W=A&&b.code===te.WS_ERR,j=A?b.message:b&&(b.reason||b.toString());x.warning("[choose-best-ws] chooseBestWebsocket error: ".concat(j)),this.store&&this.store.recordJoinChannelService({endTs:Date.now(),status:k?"aborted":"error",errors:[b]},g),I||W?(a.reject(I?new Le(te.WS_DISCONNECT,"websocket is closed: ".concat(j)):new Le(te.WS_ERR,"init websocket failed: ".concat(j))),W&&x.error("[".concat(this.name,"] init websocket failed: ").concat(j))):d&&d(b)}return a.promise}async reconnectWithAction(r){let s=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1];if(this.reconnectCount>=this.retryConfig.maxRetryCount||this.urls.length===0||this.state==="closed")return!1;x.warning("[choose-best-ws] action: =>",r),this.onlineReconnectListener||Ci.isOnline||!Ci.onlineWaiter||(this.onlineReconnectListener=Ci.onlineWaiter.then(()=>{this.onlineReconnectListener=void 0}));let a=!0;if(this.reconnectInterrupter=()=>a=!1,s){const h=zL(this.reconnectCount,this.retryConfig);x.debug("[".concat(this.name,"] wait ").concat(h,"ms to reconnect websocket, mode: ").concat(r)),await pt.race([bs(h),this.onlineReconnectListener||new pt(()=>{})])}if(this._state==="closed"||!a)return!1;this.reconnectCount+=1;const c=async(h,m)=>{this.emit(an.RECONNECT_CREATE_CONNECTION,m),await this.createWebSocketConnection(h)};try{if(r==="retry")await c(this.urls[this.currentURLIndex],r);else if(r==="tryNext"){if(this.currentURLIndex+=1,this.currentURLIndex>=this.urls.length)return this.reconnectWithAction("recover",!1);x.debug("[".concat(this.name,"] websocket url length: ").concat(this.urls.length," current index: ").concat(this.currentURLIndex)),await c(this.urls[this.currentURLIndex],r)}else r==="recover"&&(x.debug("[".concat(this.name,"] request new urls")),this.resetReconnectCount("recover mode"),this.urls=await Ms(this,an.REQUEST_NEW_URLS),this.currentURLIndex=0,await c(this.urls[this.currentURLIndex],r))}catch(h){var d;x.error("[".concat(this.name,"] reconnect failed ").concat(h&&h.toString()));const m=h==null||(d=h.data)===null||d===void 0?void 0:d.desc;return Array.isArray(m)&&rt(m).call(m,"dynamic key expired")?(this.emit(an.ON_TOKEN_PRIVILEGE_DID_EXPIRE),!1):this.reconnectWithAction(r,s)}return!0}}class M2 extends mH{constructor(r,s){super(r,s,arguments.length>2&&arguments[2]!==void 0&&arguments[2],arguments.length>3&&arguments[3]!==void 0&&arguments[3],arguments.length>4&&arguments[4]!==void 0&&arguments[4],arguments.length>5?arguments[5]:void 0)}async chooseBestWebsocketConnection(r,s){const a=Hw(),c=function(h,m){return new r_e(h,m)}(this.forceCloseTimeout,this.store);this.closeEstablishingWs=()=>{x.debug("[choose-best-ws] close establishing websockets"),c.closeAllWebsockets(),a.reject(new Le(te.WS_ABORT,"choose best websocket aborted"))};const d=se("GATEWAY_DOMAINS");return x.debug("[choose-best-ws] currentDomain: ",r,", domains: ",d,"total: ".concat(this.urls.length),"current: ".concat(this.currentURLIndex+1)),c.chooseBestWebsocket(r,this.tryDoubleDomain,this.use443PortOnly,s).then(a.resolve).catch(a.reject),a.promise.finally(()=>{this.closeEstablishingWs=void 0})}}class cT extends mH{constructor(r,s){super(r,s,arguments.length>2&&arguments[2]!==void 0&&arguments[2],arguments.length>3&&arguments[3]!==void 0&&arguments[3],arguments.length>4&&arguments[4]!==void 0&&arguments[4],arguments.length>5?arguments[5]:void 0)}async chooseBestWebsocketConnection(r,s){return new pt((a,c)=>{let d=!1;const h=[];this.closeEstablishingWs=()=>{x.debug("[choose-best-ws] close establishing websockets"),h.forEach(W=>{W.onclose=null,W.onopen=null,W.onmessage=null,W.close()}),c(new Le(te.WS_ABORT,"choose best websocket aborted"))};const m=se("GATEWAY_DOMAINS");let g;const E=r.indexOf("?h="),b=m.find(W=>E!==-1?rt(r).call(r,W,E):rt(r).call(r,W));x.debug("[choose-best-ws] currentDomain: ",b,", domains: ",m);let I=!this.tryDoubleDomain||!b;if(!I&&b){var A;const W=Date.now();try{m.forEach(j=>{const B=E===-1?r.replace(b,j):r.substr(0,E)+r.substr(E).replace(b,j),ee=new WebSocket(B);ee.binaryType="arraybuffer",h.push(ee),x.debug("[choose-best-ws] ws is connecting:",ee.url)})}catch{for(x.debug("[choose-best-ws] ws create failed, fallback to single url"),h.forEach(B=>B.close());h.length;)h.pop();I=!0}(A=this.store)===null||A===void 0||A.recordJoinChannelService({urls:h.map(j=>j.url),service:"gateway"},s),h.forEach(j=>{j.onopen=()=>{if(d)return;const B=Date.now()-W;x.debug("[choose-best-ws] ws open cost ".concat(B,"ms")),h.filter(ee=>ee!==j).forEach(ee=>{x.debug("[choose-best-ws]close backup websocket: ".concat(ee.url)),ee.close()}),d=!0,a(j)},j.onclose=B=>{g=B,!d&&(h.find(ee=>!(ee.readyState===WebSocket.CLOSED||ee.readyState===WebSocket.CLOSING))||(x.debug("[choose-best-ws] all websocket is closed"),d=!0,c(g)))},j.onmessage=B=>{x.debug("[choose-best-ws]".concat(j.url," onmessage: ").concat(B.data))}}),bs(this.forceCloseTimeout).then(()=>{h.forEach(j=>{j.readyState!==WebSocket.OPEN&&j.close()})})}if(I){var k;let W;x.debug("[choose-best-ws] use single url: ",r),(k=this.store)===null||k===void 0||k.recordJoinChannelService({urls:[r],service:"gateway"},s);try{W=new WebSocket(r),h.push(W),W.binaryType="arraybuffer"}catch(j){const B=new Le(te.WS_ERR,"init websocket failed! Error: ".concat(j.toString()));return x.error("[".concat(this.name,"]").concat(B)),void c(B)}W.onopen=()=>{a(W)},W.onclose=j=>{c(j)},W.onmessage=j=>{x.debug("[choose-best-ws]".concat(W.url," onmessage: ").concat(j.data))},bs(this.forceCloseTimeout).then(()=>{W&&W.readyState!==WebSocket.OPEN&&W.close()})}}).then(a=>(this.closeEstablishingWs=void 0,a)).catch(a=>{throw this.closeEstablishingWs=void 0,a})}}class i_e extends Jr{get connectionState(){return this._connectionState}set connectionState(r){r!==this._connectionState&&(this._connectionState=r,r===Pr.CONNECTED?this.emit(Jt.WS_CONNECTED):r===Pr.RECONNECTING?this.emit(Jt.WS_RECONNECTING,this._websocketReconnectReason):r===Pr.CLOSED&&this.emit(Jt.WS_CLOSED,this._disconnectedReason))}get currentURLIndex(){return this.websocket.currentURLIndex}get url(){return this.websocket&&this.websocket.url||null}get rtt(){return this.rttRolling.mean()}constructor(r,s){super(),Y(this,"_disconnectedReason",void 0),Y(this,"_websocketReconnectReason",void 0),Y(this,"_connectionState",Pr.CLOSED),Y(this,"reconnectToken",void 0),Y(this,"websocket",void 0),Y(this,"openConnectionTime",void 0),Y(this,"clientId",void 0),Y(this,"lastMsgTime",Date.now()),Y(this,"uploadCache",[]),Y(this,"uploadCacheInterval",void 0),Y(this,"rttRolling",new wW(5)),Y(this,"pingpongTimer",void 0),Y(this,"wsInflateDataTimer",void 0),Y(this,"pingpongTimeoutCount",0),Y(this,"ortc",void 0),Y(this,"joinResponse",void 0),Y(this,"multiIpOption",void 0),Y(this,"initError",void 0),Y(this,"spec",void 0),Y(this,"store",void 0),Y(this,"onWebsocketMessage",a=>{if(a.data instanceof ArrayBuffer)return void this.emit(Jt.ON_BINARY_DATA,a.data);const c=JSON.parse(a.data);if(this.lastMsgTime=Date.now(),Object.prototype.hasOwnProperty.call(c,"_id")){const d="res-@".concat(c._id);this.emit(d,c._result,c._message)}else if(Object.prototype.hasOwnProperty.call(c,"_type")){if(this.emit(c._type,c._message),c._type===An.ON_NOTIFICATION&&this.handleNotification(c._message),c._type===An.ON_USER_BANNED)switch(c._message.error_code){case 14:this.close(rr.UID_BANNED);break;case 15:this.close(rr.IP_BANNED);break;case 16:this.close(rr.CHANNEL_BANNED)}if(c._type===An.ON_USER_LICENSE_BANNED)switch(c._message.error_code){case zt.ERR_LICENSE_MISSING:this.close(rr.LICENSE_MISSING);break;case zt.ERR_LICENSE_EXPIRED:this.close(rr.LICENSE_EXPIRED);break;case zt.ERR_LICENSE_MINUTES_EXCEEDED:this.close(rr.LICENSE_MINUTES_EXCEEDED);break;case zt.ERR_LICENSE_PERIOD_INVALID:this.close(rr.LICENSE_PERIOD_INVALID);break;case zt.ERR_LICENSE_MULTIPLE_SDK_SERVICE:this.close(rr.LICENSE_MULTIPLE_SDK_SERVICE);break;case zt.ERR_LICENSE_ILLEGAL:this.close(rr.LICENSE_ILLEGAL);break;default:this.close()}}}),this.clientId=r.clientId,this.spec=r,this.store=s,this.websocket=new M2("gateway-".concat(this.clientId),this.spec.retryConfig,!0,se("JOIN_GATEWAY_USE_DUAL_DOMAIN"),se("JOIN_GATEWAY_USE_443PORT_ONLY"),s),this.handleWebsocketEvents(),window.addEventListener("offline",()=>{this.connectionState===Pr.CONNECTED&&this.reconnect("retry",Ls.OFFLINE)})}async request(r,s,a,c){const d=vr(6,""),h={_id:d,_type:r,_message:s},m=this.websocket.connectionID,g=()=>new pt((W,j)=>{if(this.connectionState===Pr.CONNECTED)return W();const B=()=>{this.off(Jt.WS_CLOSED,ee),W()},ee=()=>{this.off(Jt.WS_CONNECTED,B),j(new Pe(te.WS_ABORT))};this.once(Jt.WS_CONNECTED,B),this.once(Jt.WS_CLOSED,ee),r!==qt.PUBLISH&&r!==qt.PUBLISH_DATASTREAM&&r!==qt.SUBSCRIBE&&r!==qt.SUBSCRIBE_DATASTREAM&&r!==qt.UNSUBSCRIBE&&r!==qt.UNSUBSCRIBE_DATASTREAM&&r!==qt.UNPUBLISH&&r!==qt.UNPUBLISH_DATASTREAM&&r!==qt.CONTROL&&r!==qt.RESTART_ICE||this.once(Jt.DISCONNECT_P2P,()=>{j(new Pe(te.DISCONNECT_P2P))}),r!==qt.PUBLISH&&r!==qt.RESTART_ICE||this.once(Jt.ABORT_P2P_EXECUTION,()=>{j(new Pe(te.DISCONNECT_P2P))})});if(this.connectionState!==Pr.CONNECTING&&this.connectionState!==Pr.RECONNECTING||r===qt.JOIN||r===qt.REJOIN||await g(),this.websocket.sendMessage(h,!0),c)return;const E=new pt((W,j)=>{let B=!1;const ee=(oe,ye)=>{B=!0,W({isSuccess:oe==="success",message:ye||{}}),this.off(Jt.WS_CLOSED,Z),this.off(Jt.WS_RECONNECTING,Z),this.emit(Jt.REQUEST_SUCCESS,r,s)};this.once("res-@".concat(d),ee);const Z=()=>{j(new Pe(te.WS_ABORT,"type: ".concat(r))),this.off(Jt.WS_CLOSED,Z),this.off(Jt.WS_RECONNECTING,Z),this.off("res-@".concat(d),ee)};this.once(Jt.WS_CLOSED,Z),this.once(Jt.WS_RECONNECTING,Z),bs(se("SIGNAL_REQUEST_TIMEOUT")).then(()=>{this.websocket.connectionID!==m||B||(x.warning("[".concat(this.clientId,"] ws request timeout, type: ").concat(r)),this.emit(Jt.REQUEST_TIMEOUT,r,s))})});let b=null;try{b=await E}catch(W){if(this.connectionState===Pr.CLOSED||r===qt.LEAVE)throw new Pe(te.WS_ABORT);return!this.spec.forceWaitGatewayResponse||a?W.throw():r===qt.JOIN||r===qt.REJOIN?null:(await g(),await this.request(r,s))}if(b.isSuccess)return b.message;const I=Number(b.message.error_code||b.message.code),A=aT(I),k=new Pe(te.UNEXPECTED_RESPONSE,"".concat(A.desc,": ").concat(b.message.error_str),{code:I,data:b.message,desc:A.desc});return A.action==="success"?b.message:(x.warning("[".concat(this.clientId,"] [").concat(this.websocket.connectionID,"] unexpected response from type ").concat(r,", error_code: ").concat(I,", message: ").concat(A.desc,", action: ").concat(A.action)),I===zt.ERR_TOO_MANY_BROADCASTERS?((r===qt.JOIN||r===qt.REJOIN)&&(this.initError=k,this.close()),k.throw()):A.action==="failed"?k.throw():A.action==="quit"?(this.initError=k,this.close(),k.throw()):(I===zt.ERR_JOIN_BY_MULTI_IP?(this.multiIpOption=b.message.option,x.warning("[".concat(this.clientId,"] detect multi ip, recover")),this.reconnect("recover",Ls.MULTI_IP)):this.reconnect(A.action,Ls.SERVER_ERROR),r===qt.JOIN||r===qt.REJOIN?null:await this.request(r,s)))}waitMessage(r,s){return new pt(a=>{const c=d=>{(!s||s(d))&&(this.off(r,c),a(d))};this.on(r,c)})}uploadWRTCStats(r){if(!this.store.sessionId)return void x.warn("[".concat(this.clientId,"] no session id when upload wrtc stats"));const s={lts:Date.now(),sid:this.store.sessionId,uid:this.store.intUid,stats:r};this.upload(sT.WRTC_STATS,s)}upload(r,s){const a={_type:r,_message:s};try{this.websocket.sendMessage(a)}catch{const d=se("MAX_UPLOAD_CACHE")||50;this.uploadCache.push(a),this.uploadCache.length>d&&this.uploadCache.splice(0,1),this.uploadCache.length>0&&!this.uploadCacheInterval&&(this.uploadCacheInterval=window.setInterval(()=>{if(this.connectionState!==Pr.CONNECTED)return;const h=this.uploadCache.splice(0,1)[0];this.uploadCache.length===0&&(window.clearInterval(this.uploadCacheInterval),this.uploadCacheInterval=void 0),this.upload(h._type,h._message)},se("UPLOAD_CACHE_INTERVAL")||2e3))}}send(r,s){const a={_type:r,_message:s};this.websocket.sendMessage(a)}init(r){return this.initError=void 0,this.multiIpOption=void 0,this.joinResponse=void 0,this.reconnectToken=void 0,this.openConnectionTime=void 0,new pt((s,a)=>{this.once(Jt.WS_CONNECTED,()=>s(this.joinResponse)),this.once(Jt.WS_CLOSED,c=>a(this.initError||new Pe(te.WS_ABORT,c))),this.connectionState=Pr.CONNECTING,this.websocket.init(r).catch(a),this.wsInflateDataTimer&&window.clearInterval(this.wsInflateDataTimer),this.wsInflateDataTimer=window.setInterval(()=>{this.handleWsInflateData()},2e4)})}close(r){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.wsInflateDataTimer&&(this.handleWsInflateData(),window.clearInterval(this.wsInflateDataTimer),this.wsInflateDataTimer=void 0),this.reconnectToken=void 0,this.joinResponse=void 0,this._disconnectedReason=r||rr.LEAVE,this.connectionState=Pr.CLOSED,x.debug("[".concat(this.clientId,"] ")+"will close websocket in signal"),this.websocket.close()}async join(){if(!this.joinResponse){this.emit(Jt.ABORT_P2P_EXECUTION),this.store.signalConnected();const r=await Ms(this,Jt.REQUEST_JOIN_INFO);this.store.joinReq();const s=await this.request(qt.JOIN,r);if(this.ortc=r==null?void 0:r.ortc,this.store.joinRep(),!s)return this.emit(Jt.REPORT_JOIN_GATEWAY,jP.TIMEOUT,this.url||""),!1;this.joinResponse=s,this.emit(Jt.JOIN_RESPONSE,this.joinResponse),this.reconnectToken=this.joinResponse.rejoin_token}return this.connectionState=Pr.CONNECTED,this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(this.handlePingPong.bind(this),3e3),!0}async rejoin(){if(!this.reconnectToken)throw new Pe(te.UNEXPECTED_ERROR,"can not rejoin, no rejoin token");const r=Xw(this,Jt.REQUEST_REJOIN_INFO);r.token=this.reconnectToken;const s=await this.request(qt.REJOIN,r);return!!s&&(this.connectionState=Pr.CONNECTED,this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(this.handlePingPong.bind(this),3e3),s.peers&&s.peers.forEach(a=>{this.emit(An.ON_USER_ONLINE,{uid:a.uid}),a.audio&&this.emit(An.ON_ADD_AUDIO_STREAM,{uid:a.uid,uint_id:a.uint_id,audio:!0,ssrcId:a.audio_ssrc}),a.video&&this.emit(An.ON_ADD_VIDEO_STREAM,{uid:a.uid,uint_id:a.uint_id,video:!0,ssrcId:a.video_ssrc}),a.audio_mute?this.emit(An.MUTE_AUDIO,{uid:a.uid}):this.emit(An.UNMUTE_AUDIO,{uid:a.uid}),a.video_mute?this.emit(An.MUTE_VIDEO,{uid:a.uid}):this.emit(An.UNMUTE_VIDEO,{uid:a.uid}),a.audio_enable_local?this.emit(An.ENABLE_LOCAL_AUDIO,{uid:a.uid}):this.emit(An.DISABLE_LOCAL_AUDIO,{uid:a.uid}),a.video_enable_local?this.emit(An.ENABLE_LOCAL_VIDEO,{uid:a.uid}):this.emit(An.DISABLE_LOCAL_VIDEO,{uid:a.uid}),a.audio||a.video||this.emit(An.ON_REMOVE_STREAM,{uid:a.uid,uint_id:a.uint_id})}),!0)}reconnect(r,s){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.websocket.reconnect(r,s)}async downgradeCodec(r){if(!this.ortc)return!1;const s={downgrade_codec:r,ortc:this.ortc};return!!await this.request(qt.DOWNGRADE_CODEC,s)}handleNotification(r){x.debug("[".concat(this.clientId,"] receive notification: "),r);const s=aT(r.code);if(r.code===28&&"detail"in r&&(x.info("[".concat(this.clientId,"] receive recover notification: "),r.detail),this.emit(Jt.RECOVER_NOTIFICATION,r.detail)),s.action!=="success"){if(s.action!=="failed")return s.action==="quit"?(s.desc==="ERR_REPEAT_JOIN_CHANNEL"&&this.close(rr.UID_BANNED),void this.close()):void this.reconnect(s.action,Ls.SERVER_ERROR);x.error("[".concat(this.clientId,"] ignore error: "),s.desc)}}handlePingPong(){if(!this.websocket||this.websocket.state!=="connected")return;this.pingpongTimeoutCount>0&&this.rttRolling.add(3e3),this.pingpongTimeoutCount+=1;const r=se("PING_PONG_TIME_OUT"),s=Date.now();this.pingpongTimeoutCount>=r&&(x.warning("[".concat(this.clientId,"] PING-PONG Timeout. Last Socket Message: ").concat(s-this.lastMsgTime,"ms")),s-this.lastMsgTime>se("WEBSOCKET_TIMEOUT_MIN"))?this.reconnect("retry",Ls.TIMEOUT):this.request(qt.PING,void 0,!0).then(()=>{this.pingpongTimeoutCount=0;const a=Date.now()-s;this.rttRolling.add(a),se("REPORT_STATS")&&this.send(qt.PING_BACK,{pingpongElapse:a})}).catch(a=>{})}handleWsInflateData(){const{wsInflateLength:r,wsDeflateLength:s}=this.websocket.getWsInflateData();r!==0&&s!==0&&this.upload(sT.WS_INFLATE_DATA_LENGTH,{ws_deflate_length:s,ws_inflate_length:r})}handleWebsocketEvents(){this.websocket.on(an.RECONNECT_CREATE_CONNECTION,r=>{this.emit(Jt.WS_RECONNECT_CREATE_CONNECTION,r)}),this.websocket.on(an.ON_MESSAGE,this.onWebsocketMessage),this.websocket.on(an.CLOSED,()=>{this.connectionState=Pr.CLOSED}),this.websocket.on(an.FAILED,()=>{this._disconnectedReason=rr.NETWORK_ERROR,this.connectionState=Pr.CLOSED}),this.websocket.on(an.RECONNECTING,r=>{this._websocketReconnectReason=r,this.joinResponse=void 0,this.connectionState===Pr.CONNECTED?this.connectionState=Pr.RECONNECTING:this.connectionState=Pr.CONNECTING}),this.websocket.on(an.WILL_RECONNECT,(r,s,a)=>{const c=Xw(this,Jt.IS_P2P_DISCONNECTED),d=c||r!=="retry";c&&r==="retry"&&(x.debug("".concat(this.clientId," reconnect mode is retry, but p2p lost, change to tryNext")),r="tryNext",s=jP.P2P_DISCONNECTED),d&&(x.debug("".concat(this.clientId," will renewSession, reconnect mode: ").concat(r)),this.emit(Jt.REPORT_JOIN_GATEWAY,s||jP.UNKNOWN_REASON,this.url||""),this.reconnectToken=void 0,this.emit(Jt.DISCONNECT_P2P)),a(r)}),this.websocket.on(an.CONNECTED,()=>{this.openConnectionTime=Date.now(),this.reconnectToken?this.rejoin().catch(r=>{x.warning("[".concat(this.clientId,"] rejoin failed ").concat(r)),this.reconnect("tryNext",Ls.SERVER_ERROR)}):this.join().catch(r=>{if(this.emit(Jt.REPORT_JOIN_GATEWAY,r,this.url||""),r instanceof Pe){if(r.code===te.UNEXPECTED_RESPONSE&&r.data.code===zt.ERR_NO_AUTHORIZED)return this.initError=new Pe(te.TOKEN_EXPIRE,"dynamic key expired"),void this.close(rr.TOKEN_EXPIRE);x.error("[".concat(this.clientId,"] join gateway request failed"),r.toString()),this.spec.forceWaitGatewayResponse?this.reconnect("tryNext",Ls.SERVER_ERROR):(this.initError=r,this.close())}})}),this.websocket.on(an.REQUEST_NEW_URLS,(r,s)=>{Ms(this,Jt.REQUEST_RECOVER,this.multiIpOption).then(r).catch(s)}),this.websocket.on(an.ON_TOKEN_PRIVILEGE_DID_EXPIRE,()=>{this.emit(An.ON_TOKEN_PRIVILEGE_DID_EXPIRE)}),this.websocket.on(hH.PRE_CONNECT_PC,()=>{this.emit(Jt.PRE_CONNECT_PC)})}}let s_e=function(t){return t.NATIVE_RTC="native_rtc",t.NATIVE_RTM="native_rtm",t.WEB_RTC="web_rtc",t.WEB_RTM="web_rtm",t}({}),Ri=function(t){return t[t.CHOOSE_SERVER=11]="CHOOSE_SERVER",t[t.CLOUD_PROXY=18]="CLOUD_PROXY",t[t.CLOUD_PROXY_5=20]="CLOUD_PROXY_5",t[t.CLOUD_PROXY_FALLBACK=26]="CLOUD_PROXY_FALLBACK",t}({});function gH(t,r){var s=Object.keys(t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);r&&(a=a.filter(function(c){return Object.getOwnPropertyDescriptor(t,c).enumerable})),s.push.apply(s,a)}return s}function zP(t){for(var r=1;r<arguments.length;r++){var s=arguments[r]!=null?arguments[r]:{};r%2?gH(Object(s),!0).forEach(function(a){Y(t,a,s[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(s)):gH(Object(s)).forEach(function(a){Object.defineProperty(t,a,Object.getOwnPropertyDescriptor(s,a))})}return t}function Ym(t){return t.match(/^[\.\:\d]+$/)?"".concat(t.replace(/[^\d]/g,"-"),".").concat(se("TURN_DOMAIN")):(x.debug("Cannot recognized as ip address: ".concat(t,", use as host2")),t)}function WP(t){try{const r=se("GATEWAY_DOMAINS").concat(se("TURN_DOMAIN")).find(s=>rt(t).call(t,s));return r?t.split(".".concat(r))[0].replace(/-/g,"."):t}catch{return x.debug("serverUrlToIp error, fallback to url",t),t}}function U2(t,r){t.addresses||(t.addresses=[]);const s=function(m,g){if(se("CONNECT_GATEWAY_WITHOUT_DOMAIN"))return m.map(I=>{let{ip:A,port:k}=I;return{address:"".concat(A,":").concat(k)}});const E=se("GATEWAY_DOMAINS");let b=E[1]&&rt(g).call(g,E[1])?1:0;return m.map(I=>{let{domain_prefix:A,port:k,ip:W}=I;if(A)return{address:"".concat(A,".").concat(E[b++%E.length],":").concat(k)};const j=/^[\.\:\d]+$/.test(W),B=j?"".concat(W.replace(/[^\d]/g,"-"),".").concat(E[b++%E.length],":").concat(k):"".concat(W,":").concat(k);return j||x.debug("Cannot recognized as ip address: ".concat(W,", use as host3")),{ip:W,port:k,address:B}})}(t.addresses,r),a=Array.isArray(t.detail)&&t.detail[18];if(a&&typeof a=="string"){const m=a.split(";");for(let g=0;g<m.length;g++){var c;const E=Ao(c=m[g]).call(c);s[g]&&E&&(s[g].ip6=E)}}const d=t.detail&&t.detail.candidate;let h;if(d){const[m,g]=d.split(":");m&&g&&(h={port:Number(g),ip:m,address:"".concat(m,":").concat(g)})}return{gatewayAddrs:s,apGatewayAddress:h,uid:t.uid,cid:t.cid,cert:t.cert,vid:t.detail&&t.detail[8],uni_lbs_ip:t.detail&&t.detail[1],res:t,csIp:t.detail&&t.detail[502]}}function Cc(t){return typeof t=="number"?t:t.exact||t.ideal||t.max||t.min||0}function _H(t){const r=t._encoderConfig;if(!r)return{};const s={resolution:r.width&&r.height?"".concat(Cc(r.width),"x").concat(Cc(r.height)):void 0,maxVideoBW:r.bitrateMax,minVideoBW:r.bitrateMin};return typeof r.frameRate=="number"?(s.maxFrameRate=r.frameRate,s.minFrameRate=r.frameRate):r.frameRate&&(s.maxFrameRate=r.frameRate.max||r.frameRate.ideal||r.frameRate.exact||r.frameRate.min,s.minFrameRate=r.frameRate.min||r.frameRate.ideal||r.frameRate.exact||r.frameRate.max),s}function yH(t){return t>=0&&t<.17?1:t>=.17&&t<.36?2:t>=.36&&t<.59?3:t>=.59&&t<=1?4:t>1?5:0}function lT(t,r){let s,a,c;switch(r){case Ri.CHOOSE_SERVER:a=4096,c="choose server";break;case Ri.CLOUD_PROXY:a=1048576,c="proxy";break;case Ri.CLOUD_PROXY_5:a=4194304,c="proxy5";break;case Ri.CLOUD_PROXY_FALLBACK:a=4194310,c="proxy fallback";break;default:throw new Pe(te.UNEXPECTED_ERROR,"multi unlibs response transformer get unknown service id",{csIp:t.detail&&t.detail[502],retry:!1})}if(t.response_body.forEach(d=>{d.buffer&&d.buffer.flag===a&&(s={code:d.buffer.code,addresses:(d.buffer.edges_services||[]).map(h=>zP(zP({},h),{},{ticket:d.buffer.cert})),server_ts:t.enter_ts,uid:d.buffer.uid,cid:d.buffer.cid,cname:d.buffer.cname,detail:zP(zP({},d.buffer.detail),t.detail),flag:d.buffer.flag,opid:t.opid,cert:d.buffer.cert})}),!s)throw new Pe(te.MULTI_UNILBS_RESPONSE_ERROR,"cannot parse response ".concat(c," from multi unilbs response"),{csIp:t.detail&&t.detail[502]});return s}async function EH(t,r){return await pt.all(t.addresses.map(async s=>({address:Ym(s.ip),tcpport:s.port,udpport:s.port,username:r&&se("ENCRYPT_PROXY_USERNAME_AND_PSW")&&window.isSecureContext?r.toString():Us.username,password:r&&se("ENCRYPT_PROXY_USERNAME_AND_PSW")&&window.isSecureContext?await VL(r.toString()):Us.password})))}function V2(t,r){const s=r.getMediaStreamTrack(!0).getSettings(),a=r.videoHeight||s.height,c=r.videoWidth||s.width;return a&&c?Math.max(Math.min(a,c)/Math.min(Cc(t.height),Cc(t.width)),1):(x.warning("can't get ori-track's height, default scale down 4 times for low stream"),4)}function Xm(t){let{candidateType:r,relayProtocol:s,type:a,address:c,port:d,protocol:h}=t;const m={candidateType:r,relayProtocol:s,protocol:h};if(a!=="local-candidate"){const g=c.split(".");g.length>=4&&(g[1]="*",g[2]="*"),m.address=g.join("."),m.port=d}return m}function uy(t){const r=t.split(":"),s=t.split(/[-.]/),a=rt(t).call(t,"-")?"-":".";let c=t;return r.length>1?s.length>1?(s[1]="**",c=s[0]+a+"**:"+r[r.length-1]):c=r.length>2?r[0]+a+"**:"+r[r.length-1]:"**:"+r[r.length-1]:s.length>1&&(c=s[0]+a+"**"),c}function GP(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:se("SVC_MODE");if(se("ENABLE_SVC"))return function(r){return r in yP}(t)?t:yP.L1T3}const vH={[yt.VIDEO]:[{key:"abs-send-time",extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time"},{key:"video-orientation",extensionName:"urn:3gpp:video-orientation"},{key:"draft-holmer-rmcat-transport-wide-cc-extensions-01",extensionName:"http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01"},{key:"playout-delay",extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/playout-delay"},{key:"video-content-type",extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/video-content-type"},{key:"color-space",extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/color-space"},{key:"video-timing",extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/video-timing"}],[yt.AUDIO]:[{key:"ssrc-audio-level",extensionName:"urn:ietf:params:rtp-hdrext:ssrc-audio-level"},{key:"draft-holmer-rmcat-transport-wide-cc-extensions-01",extensionName:"http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01"},{key:"abs-send-time",extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time"}]};function HP(t,r,s){r.forEach(a=>{var c;const d=vH[t].find(m=>{var g;let{key:E}=m;return rt(g=a.extensionName).call(g,E)});if(!d)return;const h=s.find(m=>{let{extensionName:g}=m;return rt(g).call(g,d.key)});h&&rt(c=h.extensionName).call(c,"gdpr_forbidden")&&(a.extensionName=h.extensionName)})}function c0(t,r){r.forEach(s=>{var a;const c=vH[t].find(d=>{var h;let{key:m}=d;return rt(h=s.extensionName).call(h,m)});rt(a=s.extensionName).call(a,"gdpr_forbidden")&&c&&(s.extensionName=c.extensionName)})}function SH(t){return t==="http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time"||rt(t).call(t,"abs-send-time")}function $P(t){return t==="http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01"||rt(t).call(t,"draft-holmer-rmcat-transport-wide-cc-extensions-01")}function bH(t,r){var s=Object.keys(t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);r&&(a=a.filter(function(c){return Object.getOwnPropertyDescriptor(t,c).enumerable})),s.push.apply(s,a)}return s}function wH(t){for(var r=1;r<arguments.length;r++){var s=arguments[r]!=null?arguments[r]:{};r%2?bH(Object(s),!0).forEach(function(a){Y(t,a,s[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(s)):bH(Object(s)).forEach(function(a){Object.defineProperty(t,a,Object.getOwnPropertyDescriptor(s,a))})}return t}function uT(t){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},s=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},a=arguments.length>3?arguments[3]:void 0;const{filterRTX:c,filterVideoFec:d,filterAudioFec:h,filterAudioCodec:m,filterVideoCodec:g,unsupportedVideoUplinkCodec:E,unsupportedVideoDownlinkCodec:b}=r,{useXR:I}=s;let A=[],k=[],W=[],j=[],B=!1,ee=!1;if(Ya(t).mediaDescriptions.forEach(oe=>{a&&a!==oe.attributes.direction||(oe.media.mediaType!=="video"||B||(k=oe.attributes.payloads,j=oe.attributes.extmaps,B=!0),oe.media.mediaType!=="audio"||ee||(A=oe.attributes.payloads,W=oe.attributes.extmaps,ee=!0))}),!j||k.length===0)throw new Error("Cannot get video capabilities from SDP.");if(!W||A.length===0)throw new Error("Cannot get audio capabilities from SDP.");if(k.forEach(oe=>{var ye;(ye=oe.rtpMap)!==null&&ye!==void 0&&ye.clockRate&&(oe.rtpMap.clockRate=parseInt(oe.rtpMap.clockRate)),I&&oe.rtcpFeedbacks.push({type:"rrtr"})}),A.forEach(oe=>{var ye;(ye=oe.rtpMap)!==null&&ye!==void 0&&ye.clockRate&&(oe.rtpMap.clockRate=parseInt(oe.rtpMap.clockRate)),I&&oe.rtcpFeedbacks.push({type:"rrtr"})}),c&&(A=A.filter(oe=>{var ye;return((ye=oe.rtpMap)===null||ye===void 0?void 0:ye.encodingName.toLowerCase())!=="rtx"}),k=k.filter(oe=>{var ye;return((ye=oe.rtpMap)===null||ye===void 0?void 0:ye.encodingName.toLowerCase())!=="rtx"})),d){const oe=k.filter(ue=>{var Ce;return/(red)|(ulpfec)|(flexfec)/i.test(((Ce=ue.rtpMap)===null||Ce===void 0?void 0:Ce.encodingName)||"")}),ye=Qm(oe,k).map(ue=>ue.payloadType),_e=[...oe.map(ue=>ue.payloadType),...ye];k=k.filter(ue=>!rt(_e).call(_e,ue.payloadType))}if(h&&(A=A.filter(oe=>{var ye;return!/(red)|(ulpfec)|(flexfec)/i.test(((ye=oe.rtpMap)===null||ye===void 0?void 0:ye.encodingName)||"")})),m&&(m==null?void 0:m.length)>0&&(A=A.filter(oe=>{var ye;return rt(m).call(m,((ye=oe.rtpMap)===null||ye===void 0?void 0:ye.encodingName.toLowerCase())||"")})),g&&(g==null?void 0:g.length)>0){const oe=k.filter(ye=>{var _e;return rt(g).call(g,((_e=ye.rtpMap)===null||_e===void 0?void 0:_e.encodingName.toLowerCase())||"")});k=oe.concat(c?[]:Qm(oe,k))}const Z=se("UNSUPPORTED_VIDEO_CODEC");if(Z&&Z.length>0){const oe=k.filter(ue=>ue.rtpMap&&rt(Z).call(Z,ue.rtpMap.encodingName.toLowerCase())),ye=Qm(oe,k),_e=oe.concat(ye).map(ue=>ue.payloadType);k=k.filter(ue=>!rt(_e).call(_e,ue.payloadType)),x.debug("unsupportedVideoCodec: ".concat(Z,", toBeRemoved: ").concat(_e))}if(E&&E.length>0&&a==="sendonly"){const oe=k.filter(ue=>ue.rtpMap&&rt(E).call(E,ue.rtpMap.encodingName.toLowerCase())),ye=Qm(oe,k),_e=oe.concat(ye).map(ue=>ue.payloadType);k=k.filter(ue=>!rt(_e).call(_e,ue.payloadType)),x.debug("unsupportedVideoUplinkCodec: ".concat(E,", toBeRemoved: ").concat(_e))}if(b&&b.length>0&&a==="recvonly"){const oe=k.filter(ue=>ue.rtpMap&&rt(b).call(b,ue.rtpMap.encodingName.toLowerCase())),ye=Qm(oe,k),_e=oe.concat(ye).map(ue=>ue.payloadType);k=k.filter(ue=>!rt(_e).call(_e,ue.payloadType)),x.debug("unsupportedVideoDownlinkCodec: ".concat(b,", toBeRemoved: ").concat(_e))}return{audioCodecs:A,videoCodecs:k,audioExtensions:W,videoExtensions:j}}function Jm(t){const r=Ya(t);let s,a;for(const c of r.mediaDescriptions){if(!s){const d=c.attributes.iceUfrag,h=c.attributes.icePwd;if(!d||!h)throw new Error("Cannot get iceUfrag or icePwd from SDP.");s={iceUfrag:d,icePwd:h}}if(!a){const d=c.attributes.fingerprints;d.length>0&&(a={fingerprints:d})}}if(!a&&r.attributes.fingerprints.length>0&&(a={fingerprints:r.attributes.fingerprints}),!a||!s)throw new Error("Cannot get iceParameters or dtlsParameters from SDP.");return{iceParameters:s,dtlsParameters:a}}function TH(t,r){const s=[],a=t.attributes.ssrcGroups.filter(h=>h.semantic==="FID"),c=t.attributes.ssrcGroups.find(h=>h.semantic==="SIM"),d=t.attributes.ssrcs;if(c)c.ssrcIds.forEach(h=>{var m;const g=(m=a.find(E=>E.ssrcIds[0]===h))===null||m===void 0?void 0:m.ssrcIds[1];s.push({ssrcId:h,rtx:r?g:void 0})});else if(a.length>0){const h=a[0].ssrcIds[0],m=a[0].ssrcIds[1];s.push({ssrcId:h,rtx:r?m:void 0})}else{if(d.length===0)throw new Error("No ssrcs found on local media description.");s.push({ssrcId:d[0].ssrcId})}return s}function CH(t,r,s){const{cname:a}=t;let c=[];r&&(c=RH(r)),c.length===0&&(c=t.iceParameters.candidates.map(b=>({foundation:b.foundation,componentId:"1",transport:b.protocol,priority:b.priority.toString(),connectionAddress:b.ip,port:b.port.toString(),type:b.type,extension:{}})),x.debug("Using candidates from gateway."));const d={fingerprints:t.dtlsParameters.fingerprints.map(b=>({hashFunction:b.algorithm,fingerprint:b.fingerprint}))},h={iceUfrag:t.iceParameters.iceUfrag,icePwd:t.iceParameters.icePwd};let m;switch(t.dtlsParameters.role){case"server":m="passive";break;case"client":m="active";break;case"auto":m="actpass"}const g=qP(t.rtpCapabilities),E=[];return Array.isArray(s)&&s.length>0&&s.forEach(b=>{E.push({kind:yt.VIDEO,ssrcMsg:[{ssrcId:b.v,rtx:b.v_rtx}],mslabel:"".concat(b.v,"_").concat(b.a)},{kind:yt.AUDIO,ssrcMsg:[{ssrcId:b.a}],mslabel:"".concat(b.v,"_").concat(b.a)})}),{dtlsParameters:d,iceParameters:h,candidates:c,rtpCapabilities:g,setup:m,cname:a,preSSRCs:E}}function RH(t){let r=[];return t.ip&&typeof t.port=="number"&&(r=[{foundation:"udpcandidate",componentId:"1",transport:"udp",priority:"2103266323",connectionAddress:t.ip,port:t.port.toString(),type:"host",extension:{}}],x.debug("Using remote candidate from AP ".concat(uy(t.ip),":").concat(t.port)),t.ip6&&(r.push({foundation:"udpcandidate",componentId:"1",transport:"udp",priority:"2103266323",connectionAddress:t.ip6,port:t.port.toString(),type:"host",extension:{}}),x.debug("Using IPV6 remote candidate from AP ".concat(uy(t.ip6),":").concat(t.port)))),r}function dT(t,r,s){const a=[],c=[];return t.forEach(d=>{let{ssrcId:h,rtx:m}=d;const g=vr(8,"track-"),E={ssrcId:h,attributes:wH({label:g,mslabel:s=s||vr(10,""),msid:"".concat(s," ").concat(g)},r&&{cname:r})};if(a.push(E),m!==void 0){const b={ssrcId:m,attributes:wH({label:g,mslabel:s,msid:"".concat(s," ").concat(g)},r&&{cname:r})};a.push(b),c.push({semantic:"FID",ssrcIds:[h,m]})}}),t.length>1&&c.push({semantic:"SIM",ssrcIds:t.map(d=>{let{ssrcId:h}=d;return h})}),{ssrcs:a,ssrcGroups:c}}function l0(t,r){r instanceof ci&&t.attributes.payloads.forEach(s=>{var a;const c=(a=s.rtpMap)===null||a===void 0?void 0:a.encodingName.toLowerCase();if(!c||["opus","pcmu","pcma","g722"].indexOf(c)===-1)return;s.fmtp||(s.fmtp={parameters:{}}),c==="opus"&&typeof se("OPUS_PTIME")=="number"?s.fmtp.parameters.ptime=se("OPUS_PTIME"):s.fmtp.parameters.minptime="10",s.fmtp.parameters.useinbandfec="1";const d=r._encoderConfig;d&&(c!=="pcmu"&&c!=="pcma"&&c!=="g722"&&(d.bitrate&&!ni()&&(s.fmtp.parameters.maxaveragebitrate="".concat(Math.floor(1e3*d.bitrate))),d.sampleRate&&(s.fmtp.parameters.maxplaybackrate="".concat(d.sampleRate),s.fmtp.parameters["sprop-maxcapturerate"]="".concat(d.sampleRate)),d.stereo&&(s.fmtp.parameters.stereo="1",s.fmtp.parameters["sprop-stereo"]="1")),r instanceof rT&&c==="opus"&&r._config.DTX&&(s.fmtp.parameters.usedtx="1"))})}function F2(t){const r=t.attributes.unrecognized.findIndex(s=>s.attField==="x-google-flag"&&s.attValue==="conference");r!==-1&&t.attributes.unrecognized.splice(r,1)}function j2(t,r){var s;if(!(r instanceof Dr&&r._encoderConfig&&r._hints.indexOf(yr.SCREEN_TRACK)===-1))return;const a=r._encoderConfig;jn().supportMinBitrate&&a.bitrateMin&&t.attributes.payloads.forEach(c=>{var d,h;rt(d=["h264","h265","vp8","vp9","av1"]).call(d,((h=c.rtpMap)===null||h===void 0?void 0:h.encodingName.toLowerCase())||"")&&(c.fmtp||(c.fmtp={parameters:{}}),c.fmtp.parameters["x-google-min-bitrate"]="".concat(a.bitrateMin))}),jn().supportMinBitrate&&!rt(s=r._hints).call(s,yr.LOW_STREAM)&&a.bitrateMax&&t.attributes.payloads.forEach(c=>{var d,h;rt(d=["h264","h265","vp8","vp9","av1"]).call(d,((h=c.rtpMap)===null||h===void 0?void 0:h.encodingName.toLowerCase())||"")&&(c.fmtp||(c.fmtp={parameters:{}}),c.fmtp.parameters["x-google-start-bitrate"]="".concat(se("X_GOOGLE_START_BITRATE")||Math.floor(a.bitrateMax)))})}function IH(t){if(t.media.mediaType!=="video")return;const r=xn();if(r.name!==Hn.SAFARI&&r.os!==is.IOS)return;const s=t.attributes.extmaps.findIndex(a=>/video-orientation/g.test(a.extensionName));s!==-1&&t.attributes.extmaps.splice(s,1)}function KP(t,r,s){if(!r)return;let a,c;if(t.media.mediaType==="video"?(a=s.videoExtensions,c=s.videoCodecs):(a=s.audioExtensions,c=s.audioCodecs),r.twcc===!0){const d=a.find(h=>$P(h.extensionName));if(d){const h=d.extensionName;t.attributes.extmaps.find(g=>$P(g.extensionName))||t.attributes.extmaps.push({entry:d.entry,extensionName:h}),function(g,E){return E.filter(b=>!!g.find(I=>I.payloadType===b.payloadType&&!!I.rtcpFeedbacks.find(A=>A.type==="transport-cc")))}(c,t.attributes.payloads).forEach(g=>{g.rtcpFeedbacks.find(E=>E.type==="transport-cc")||g.rtcpFeedbacks.push({type:"transport-cc"})})}}else if(r.twcc===!1){const d=t.attributes.extmaps.findIndex(h=>$P(h.extensionName));d!==-1&&t.attributes.extmaps.splice(d,1),t.attributes.payloads.forEach(h=>{const m=h.rtcpFeedbacks.findIndex(g=>g.type==="transport-cc");m!==-1&&h.rtcpFeedbacks.splice(m,1)})}if(r.remb===!0){const d=a.find(h=>SH(h.extensionName));if(d){const h=d.extensionName;t.attributes.extmaps.find(g=>g.extensionName===h)||t.attributes.extmaps.push({entry:d.entry,extensionName:h}),function(g,E){return E.filter(b=>!!g.find(I=>I.payloadType===b.payloadType&&!!I.rtcpFeedbacks.find(A=>A.type==="goog-remb")))}(c,t.attributes.payloads).forEach(g=>{g.rtcpFeedbacks.find(E=>E.type==="goog-remb")||g.rtcpFeedbacks.push({type:"goog-remb"})})}}else if(r.remb===!1){const d=t.attributes.extmaps.findIndex(h=>SH(h.extensionName));d!==-1&&t.attributes.extmaps.splice(d,1),t.attributes.payloads.forEach(h=>{const m=h.rtcpFeedbacks.findIndex(g=>g.type==="goog-remb");m!==-1&&h.rtcpFeedbacks.splice(m,1)})}}function AH(t,r,s){if(ni()||t.media.mediaType!=="video"||!(r instanceof Dr)||s!=="vp9"&&s!=="vp8"||s==="vp8"&&!se("SIMULCAST")||s==="vp9"&&se("ENABLE_SVC")||r._scalabilityMode===void 0||r._scalabilityMode.numSpatialLayers<=1)return;const a=s==="vp8"?2:r._scalabilityMode.numSpatialLayers,c=t.attributes.ssrcs[0],d=t.attributes.ssrcGroups.find(m=>m.semantic==="FID"&&m.ssrcIds[0]===c.ssrcId),h={semantic:"SIM",ssrcIds:[c.ssrcId]};for(let m=1;m<a;m++)t.attributes.ssrcs.push({ssrcId:c.ssrcId+m,attributes:Kr(c.attributes)}),h.ssrcIds.push(c.ssrcId+m),d&&(t.attributes.ssrcs.push({ssrcId:d.ssrcIds[1]+m,attributes:Kr(c.attributes)}),t.attributes.ssrcGroups.push({semantic:"FID",ssrcIds:[c.ssrcId+m,d.ssrcIds[1]+m]}));t.attributes.ssrcGroups.unshift(h)}async function PH(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const s=new RTCPeerConnection;s.addTransceiver("video",{direction:"sendonly"}),s.addTransceiver("audio",{direction:"sendonly"}),s.addTransceiver("video",{direction:"recvonly"}),s.addTransceiver("audio",{direction:"recvonly"});const a=(await s.createOffer()).sdp,{send:c,recv:d,sendrecv:h}=function(){let m=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},g=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},E=arguments.length>2?arguments[2]:void 0;const b=uT(E,m,g,"sendonly"),I=uT(E,m,g,"recvonly"),A={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},k={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},W={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]};if(Bu(b,I,"videoExtensions",A,k,W),Bu(b,I,"videoCodecs",A,k,W),Bu(b,I,"audioExtensions",A,k,W),Bu(b,I,"audioCodecs",A,k,W),se("RAISE_H264_BASELINE_PRIORITY")){const j=[],B=[];if(W.videoCodecs.forEach((ee,Z)=>{var oe;if(((oe=ee.rtpMap)===null||oe===void 0?void 0:oe.encodingName.toLocaleLowerCase())==="h264"){var ye,_e;const ue=W.videoCodecs[Z+1],Ce=ue&&xH(ee,ue),Ue=(ye=ee.fmtp)===null||ye===void 0?void 0:ye.parameters["profile-level-id"],ze=(_e=ee.fmtp)===null||_e===void 0?void 0:_e.parameters["packetization-mode"];!Ue||Ue!==se("FIRST_H264_PROFILE_LEVEL_ID")||se("FIRST_PACKETIZATION_MODE")&&ze!==se("FIRST_PACKETIZATION_MODE")?Ce?B.push([ee,ue]):B.push([ee]):Ce?j.push([ee,ue]):j.push([ee])}}),j.length>0&&B.length>0){x.debug("raising H264 baseline profile priority"),W.videoCodecs.forEach((Z,oe)=>{var ye;if(((ye=Z.rtpMap)===null||ye===void 0?void 0:ye.encodingName.toLocaleLowerCase())==="h264"){const _e=xH(Z,W.videoCodecs[oe+1]),ue=j.shift()||B.shift()||[];ue.length>0&&(_e?W.videoCodecs.splice(oe,2,...ue):W.videoCodecs.splice(oe,1,...ue))}});const ee=k.videoCodecs.filter(Z=>{var oe,ye;return((oe=Z.rtpMap)===null||oe===void 0?void 0:oe.encodingName.toLocaleLowerCase())==="h264"&&((ye=Z.fmtp)===null||ye===void 0?void 0:ye.parameters["profile-level-id"])!==se("FIRST_H264_PROFILE_LEVEL_ID")});if(ee.length>0){const Z=Qm(ee,k.videoCodecs).map(ye=>ye.payloadType),oe=[...ee.map(ye=>ye.payloadType),...Z];k.videoCodecs=k.videoCodecs.filter(ye=>!rt(oe).call(oe,ye.payloadType))}se("FILTER_SEND_H264_BASELINE")&&(A.videoCodecs=A.videoCodecs.filter(Z=>{var oe,ye;return!(((oe=Z.rtpMap)===null||oe===void 0?void 0:oe.encodingName.toLocaleLowerCase())==="h264"&&((ye=Z.fmtp)===null||ye===void 0?void 0:ye.parameters["profile-level-id"])!==se("FIRST_H264_PROFILE_LEVEL_ID"))}))}return{send:A,recv:k,sendrecv:W}}return{send:A,recv:k,sendrecv:W}}(t,r,a);try{s.close()}catch{}return{send:c,recv:d,sendrecv:h}}function kH(){const t={audioCodecs:[],videoCodecs:[],audioExtensions:[],videoExtensions:[]},r=uT(arguments.length>2?arguments[2]:void 0,arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},"recvonly"),s={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},a={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},c={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]};if(Bu(t,r,"videoExtensions",s,a,c),Bu(t,r,"videoCodecs",s,a,c),Bu(t,r,"audioExtensions",s,a,c),Bu(t,r,"audioCodecs",s,a,c),se("RAISE_H264_BASELINE_PRIORITY")){const d=c.videoCodecs.findIndex(h=>h.rtpMap&&h.rtpMap.encodingName.toLocaleLowerCase()==="h264"&&h.fmtp&&h.fmtp.parameters["profile-level-id"]==="42001f");if(d!==-1){const h=c.videoCodecs.findIndex(m=>m.rtpMap&&m.rtpMap.encodingName.toLocaleLowerCase()==="h264");if(h<d){x.debug("raising H264 baseline profile priority");const m=c.videoCodecs[d];c.videoCodecs.splice(d,1),c.videoCodecs.splice(h,0,m)}h!==-1&&(a.videoCodecs=a.videoCodecs.filter(m=>!(m.rtpMap&&m.rtpMap.encodingName.toLocaleLowerCase()==="h264"&&m.fmtp&&m.fmtp.parameters["profile-level-id"]!=="42001f")))}}return{send:s,recv:a,sendrecv:c}}function Bu(t,r,s,a,c,d){if(s==="videoExtensions"||s==="audioExtensions"){const h=[];return t[s].forEach(m=>{r[s].some((g,E)=>{if(m.entry===g.entry&&m.extensionName===g.extensionName)return h.push(E),!0})?d[s].push(m):a[s].push(m)}),void r[s].forEach((m,g)=>{h.indexOf(g)===-1&&c[s].push(m)})}if(s==="videoCodecs"||s==="audioCodecs"){const h=[];return t[s].forEach(m=>{r[s].some((g,E)=>{if(m.payloadType===g.payloadType&&JSON.stringify(m)===JSON.stringify(g))return h.push(E),!0})?d[s].push(m):a[s].push(m)}),void r[s].forEach((m,g)=>{h.indexOf(g)===-1&&c[s].push(m)})}}function qP(t){const{send:r,recv:s,sendrecv:a}=t;if(!a){if(!r||!s)throw new Error("cannot merge rtp capabilities because one of send or recv is empty!");return{send:r,recv:s}}let c,d;return r?(c={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},c.audioCodecs=[...r.audioCodecs,...a.audioCodecs],c.videoCodecs=[...r.videoCodecs,...a.videoCodecs],c.audioExtensions=[...r.audioExtensions,...a.audioExtensions],c.videoExtensions=[...r.videoExtensions,...a.videoExtensions]):c=a,s?(d={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},d.audioCodecs=[...s.audioCodecs,...a.audioCodecs],d.videoCodecs=[...s.videoCodecs,...a.videoCodecs],d.audioExtensions=[...s.audioExtensions,...a.audioExtensions],d.videoExtensions=[...s.videoExtensions,...a.videoExtensions]):d=a,{send:c,recv:d}}function u0(t){t.media.mediaType==="audio"&&t.attributes.payloads.filter(r=>{var s;return((s=r.rtpMap)===null||s===void 0?void 0:s.encodingName.toLowerCase())==="opus"}).forEach(r=>{r.fmtp||(r.fmtp={parameters:{}}),r.fmtp.parameters.stereo="1",r.fmtp.parameters["sprop-stereo"]="1"})}function hT(t,r,s,a){let c=[];if(t===yt.VIDEO){if(se("H264_PROFILE_LEVEL_ID")&&a==="h264"&&(c=r.videoCodecs.filter(d=>{var h;return rt(h=d.rtpMap&&d.rtpMap.encodingName.toLowerCase()||"").call(h,a)&&d&&d.fmtp&&d.fmtp.parameters["profile-level-id"]===se("H264_PROFILE_LEVEL_ID")})),!Array.isArray(c)||c.length===0){let d=[];const h=[],m=[],g=[];if(s.videoCodecs.forEach(E=>{const b=E.rtpMap&&E.rtpMap.encodingName.toLowerCase()||"";rt(b).call(b,a)?d.push(E):rt(b).call(b,"vp9")?h.push(E):rt(b).call(b,"vp8")?m.push(E):rt(b).call(b,"h264")&&g.push(E)}),d.length===0){let E="";h.length!==0?(d=h,E="vp9"):m.length!==0?(d=m,E="vp8"):g.length!==0&&(d=g,E="h264"),x.warning("codec ".concat(a," not included in rtpCapabilities, fallback to default payloads: ").concat(E))}d.length!==0&&(c=r.videoCodecs.filter(E=>d.some(b=>b.payloadType===E.payloadType)))}if(c.length===0&&(x.warning("codec ".concat(a," not included in rtpCapabilities, fallback to default payloads: ").concat(r.videoCodecs[0].rtpMap&&r.videoCodecs[0].rtpMap.encodingName)),c=r.videoCodecs),se("USE_PUB_RTX")||se("USE_SUB_RTX")){const d=Qm(c,r.videoCodecs);c=[...c,...d]}}else{c=r.audioCodecs.filter(h=>{var m;return rt(m=h.rtpMap&&h.rtpMap.encodingName.toLowerCase()||"").call(m,a)});const d=r.audioCodecs.filter(h=>{var m;return rt(m=h.rtpMap&&h.rtpMap.encodingName.toLowerCase()||"").call(m,"red")});c.length===0&&(x.warning("codec ".concat(a," not included in rtpCapabilities, fallback to opus")),c=r.audioCodecs.filter(h=>{var m;return rt(m=h.rtpMap&&h.rtpMap.encodingName.toLowerCase()||"").call(m,"opus")})),se("ENABLE_AUDIO_RED")&&d.length!==0&&(c=[...d,...c])}return c}function Qm(t,r){const s=t.map(a=>a.payloadType.toString());return r.filter(a=>a.rtpMap&&a.rtpMap.encodingName==="rtx"&&a.fmtp&&a.fmtp.parameters.apt&&rt(s).call(s,a.fmtp&&a.fmtp.parameters.apt))}async function Zm(t,r,s){const a=r.toString(),c=NH(a,"offer","remote","exchangeSDP");await t.setRemoteDescription({type:"offer",sdp:a});const d=await t.createAnswer();if(!d.sdp)throw new Error("cannot get answer sdp");let h=d.sdp;h=OH(h,s||{}),c==null||c(h||""),await t.setLocalDescription({type:"answer",sdp:h})}function OH(t,r,s){const a=Ya(t),{useXR:c}=r;return a.mediaDescriptions.forEach(d=>{var h;d.attributes.mid&&(Array.isArray(s)&&!rt(s).call(s,d.attributes.mid)||(d.media.mediaType==="audio"&&u0(d),c&&rt(h=["audio","video"]).call(h,d.media.mediaType)&&d.attributes.payloads.forEach(m=>{m.rtcpFeedbacks.findIndex(g=>g.type==="rrtr")===-1&&m.rtcpFeedbacks.push({type:"rrtr"})})))}),Hm(a)}function NH(t,r,s,a){if(se("SDP_LOGGING"))return x.upload("exchanging ".concat(s," ").concat(r," SDP during P2PConnection.").concat(a,`
`),t),r==="offer"?c=>{NH(c,"answer",s==="local"?"remote":"local",a)}:void 0}function DH(t){const r=se("COMPATIBLE_SDP_EXTENSION");return!!(Array.isArray(r)&&r.length>0)&&r.some(s=>rt(t).call(t,s))}function xH(t,r){try{var s;return((s=t.fmtp)===null||s===void 0?void 0:s.parameters.apt)===r.payloadType.toString()}catch{return!1}}function LH(t,r){var s=Object.keys(t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);r&&(a=a.filter(function(c){return Object.getOwnPropertyDescriptor(t,c).enumerable})),s.push.apply(s,a)}return s}function il(t,r){return typeof se(t)===r?se(t):void 0}function o_e(){try{const t=se("EXPERIMENTS")||{};return typeof t=="string"||Array.isArray(t)?{}:function(r){for(var s=1;s<arguments.length;s++){var a=arguments[s]!=null?arguments[s]:{};s%2?LH(Object(a),!0).forEach(function(c){Y(r,c,a[c])}):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(a)):LH(Object(a)).forEach(function(c){Object.defineProperty(r,c,Object.getOwnPropertyDescriptor(a,c))})}return r}({},t)}catch(t){return x.debug("handle gateway attributes failed: ",t),{}}}const MH={};function eg(t){(!(arguments.length>1&&arguments[1]!==void 0)||arguments[1])&&x.debug("install service ".concat(t.name)),MH[t.name]=t}function ff(t){const r=MH[t];if(!r)throw new Le(te.INVALID_OPERATION,"".concat(t," not found, please use AgoraRTC.use(").concat(t,"Service) to load it first"));return r}function UH(t,r){return ff("DataStream").create(t,r)}function YP(){return ff("InterceptFrame").create()}function VH(t,r){var s=Object.keys(t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);r&&(a=a.filter(function(c){return Object.getOwnPropertyDescriptor(t,c).enumerable})),s.push.apply(s,a)}return s}function mo(t){for(var r=1;r<arguments.length;r++){var s=arguments[r]!=null?arguments[r]:{};r%2?VH(Object(s),!0).forEach(function(a){Y(t,a,s[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(s)):VH(Object(s)).forEach(function(a){Object.defineProperty(t,a,Object.getOwnPropertyDescriptor(s,a))})}return t}const B2=new Map;class a_e extends Jr{get state(){return this._state}set state(r){if(r===this._state)return;const s=this._state;this._state=r,r==="DISCONNECTED"&&this._disconnectedReason?this.emit(ps.CONNECTION_STATE_CHANGE,r,s,this._disconnectedReason):this.emit(ps.CONNECTION_STATE_CHANGE,r,s)}get joinGatewayStartTime(){return this._joinGatewayStartTime}set joinGatewayStartTime(r){x.debug("[".concat(this.store.clientId,"] set joinGatewayStartTime at ").concat(r)),this._joinGatewayStartTime=r}constructor(r,s){var a,c,d;super(),Y(this,"store",void 0),Y(this,"joinInfo",void 0),Y(this,"key",void 0),Y(this,"ntpOffset",0),Y(this,"signal",void 0),Y(this,"role",void 0),Y(this,"isPreallocation",void 0),Y(this,"isPreSub",void 0),Y(this,"inChannelInfo",{joinAt:null,duration:0}),Y(this,"spec",void 0),Y(this,"_state","DISCONNECTED"),Y(this,"_statsCollector",void 0),Y(this,"_disconnectedReason",void 0),Y(this,"isSignalRecover",!1),Y(this,"hasChangeBGPAddress",!1),Y(this,"trafficStatsInterval",void 0),Y(this,"networkQualityInterval",void 0),Y(this,"_joinGatewayStartTime",0),Y(this,"_signalTimeout",!1),Y(this,"_clientRoleOptions",void 0),Y(this,"_isProactiveJoin",!1),this.store=r,this.spec=s,this.signal=this.store.useP2P?(a={spec:mo(mo({},s),{},{retryConfig:s.websocketRetryConfig}),store:r},(c=(d=ff("P2PChannel")).createSubmodule)===null||c===void 0?void 0:c.call(d,a)):new i_e(mo(mo({},s),{},{retryConfig:s.websocketRetryConfig}),r),this._statsCollector=s.statsCollector,this.role=s.role||"audience",this._clientRoleOptions=s.clientRoleOptions,this.handleSignalEvents()}async join(r,s,a){this.store.joinGatewayStart(),r.cloudProxyServer!=="disabled"&&(this.hasChangeBGPAddress=!0);const c=Date.now();let d=B2.get(r.cname);if(d||(d=new Map,B2.set(r.cname,d)),this._isProactiveJoin=!0,d.has(r.uid)){const E=new Pe(te.UID_CONFLICT);throw At.joinGateway(r.sid,{lts:c,succ:!1,ec:E.code,addr:null,uid:r.uid,cid:r.cid,firstSuccess:this._isProactiveJoin,isProxy:!!r.proxyServer,signalChannel:"0",preload:r.preload}),E}d.set(r.uid,!0),this.joinInfo=r,this.key=s;let h=0;this.joinGatewayStartTime=c;const m=r.proxyServer;try{x.debug("[".concat(this.store.clientId,"] use websocket join uid ").concat(h));const E=r.gatewayAddrs.map(b=>{let{address:I}=b;const[A,k]=I.split(":"),W={host:A,port:k};return r.proxyServer&&(W.proxy=r.proxyServer),W});h=(await this.signal.init(E)).uid,x.debug("[".concat(this.store.clientId,"] websocket join uid ").concat(h," cost ").concat(Date.now()-this.joinGatewayStartTime))}catch(E){var g;throw x.error("[".concat(this.store.clientId,"] User join failed"),E.toString()),At.joinGateway(r.sid,{lts:c,succ:!1,ec:((g=E.data)===null||g===void 0?void 0:g.desc)||E.code,errorMsg:E.message,addr:this.signal.url,uid:r.uid,cid:r.cid,firstSuccess:this._isProactiveJoin,isProxy:!!m,signalChannel:"0",preload:r.preload}),d.delete(r.uid),this.signal.close(),E}return this.state="CONNECTED",this.inChannelInfo.joinAt=Date.now(),x.debug("[".concat(this.store.clientId,"] Connected to gateway server")),this.trafficStatsInterval=window.setInterval(()=>{this.updateTrafficStats().catch(E=>{x.warning("[".concat(this.store.clientId,"] get traffic stats error"),E.toString())})},3e3),this.networkQualityInterval=window.setInterval(()=>{navigator&&navigator.onLine!==void 0&&!navigator.onLine?this.emit(ps.NETWORK_QUALITY,{downlinkNetworkQuality:6,uplinkNetworkQuality:6}):this._signalTimeout?this.emit(ps.NETWORK_QUALITY,{downlinkNetworkQuality:5,uplinkNetworkQuality:5}):this.state==="CONNECTED"&&this._statsCollector.trafficStats?this.emit(ps.NETWORK_QUALITY,{uplinkNetworkQuality:yH(this._statsCollector.trafficStats.B_unq),downlinkNetworkQuality:yH(this._statsCollector.trafficStats.B_dnq)}):this.emit(ps.NETWORK_QUALITY,{uplinkNetworkQuality:0,downlinkNetworkQuality:0})},2e3),this.store.joinGatewayEnd(),h}async leave(){let r=arguments.length>0&&arguments[0]!==void 0&&arguments[0],s=arguments.length>1?arguments[1]:void 0;if(this.state!=="DISCONNECTED"){s!==rr.FALLBACK&&(this.state="DISCONNECTING");try{r||this.signal.connectionState!==Pr.CONNECTED||await function(a,c){return c===1/0?a:pt.race([a,Nme(c)])}(this.signal.request(qt.LEAVE,void 0,!0),3e3)}catch(a){x.warning("[".concat(this.store.clientId,"] leave request failed, ignore"),a)}this.signal.close(s),s!==rr.FALLBACK&&(this.state="DISCONNECTED"),this.reset()}}async publish(r,s,a){if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new Pe(te.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));const c={state:"offer",p2p_id:this.store.p2pId,ortc:s,mode:this.spec.mode,extend:se("PUB_EXTEND"),twcc:!!se("PUBLISH_TWCC"),rtx:!!se("USE_PUB_RTX")};try{return(await this.signal.request(qt.PUBLISH,c,!0))._message}catch(d){if(a&&d.data&&d.data.code===zt.ERR_PUBLISH_REQUEST_INVALID)return x.warning("[".concat(this.store.clientId,"] receive publish error code, retry"),d.toString()),await this.tryUnpubBeforeRepub(r,s),this.publish(r,s,!1);throw d}}async publishDataChannel(r,s,a){var c;if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new Pe(te.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));const d={stream_id:s.streamId,ordered:s.ordered?1:0,max_retrans_times:(c=s.maxRetransmits)!==null&&c!==void 0?c:10,channel_id:s.channelId,metadata:s.metadata};try{await this.signal.request(qt.PUBLISH_DATASTREAM,d,!0)}catch(h){if(a&&h.data&&h.data.code===zt.ERR_PUBLISH_REQUEST_INVALID)return x.warning("[".concat(this.store.clientId,"] receive publish datachannels error code, retry"),h.toString()),await this.tryUnpubDataChannelBeforeRepub(r,s),this.publishDataChannel(r,s,!1);throw h}}async unpublish(r,s){try{if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new Pe(te.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));await this.signal.request(qt.UNPUBLISH,{stream_id:s,ortc:r},!0)}catch(a){x.warning("[".concat(this.store.clientId,"] unpublish warning: "),a)}}async unpublishDataChannel(r){try{if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new Pe(te.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));await pt.all(r.map(s=>this.signal.request(qt.UNPUBLISH_DATASTREAM,{channel_id:s},!0)))}catch(s){x.warning("unpublish datachannels warning: ",s)}}async presubscribe(r,s,a){if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new Pe(te.INVALID_OPERATION,"can not presubscribe when connection state is ".concat(this.state));const c={stream_id:r,stream_type:s,mode:this.spec.mode,codec:this.spec.codec,p2p_id:this.store.p2pId,twcc:!!se("SUBSCRIBE_TWCC"),rtx:!!se("USE_SUB_RTX")||void 0,extend:se("SUB_EXTEND"),svc:Array.isArray(se("SVC"))&&se("SVC").length!==0?se("SVC"):void 0};try{return await this.signal.request(qt.PRE_SUBSCRIBE,c,!0)}catch(d){if(a&&d.data&&d.data.code===zt.ERR_SUBSCRIBE_REQUEST_INVALID)return x.warning("[".concat(this.store.clientId,"] pre-subscribe error, retry"),d.toString()),this.presubscribe(r,s,!1);throw d}}async subscribe(r,s,a){if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new Pe(te.INVALID_OPERATION,"can not subscribe when connection state is ".concat(this.state));const c={stream_id:r,stream_type:s.stream_type,mode:this.spec.mode,codec:this.spec.codec,p2p_id:this.store.p2pId,twcc:!!se("SUBSCRIBE_TWCC"),rtx:!!se("USE_SUB_RTX"),extend:se("SUB_EXTEND"),ssrcId:s.ssrcId,svc:Array.isArray(se("SVC"))&&se("SVC").length!==0?se("SVC"):void 0};try{return(await this.signal.request(qt.SUBSCRIBE,c,!0))._message}catch(d){if(a&&d.data&&d.data.code===zt.ERR_SUBSCRIBE_REQUEST_INVALID)return x.warning("[".concat(this.store.clientId,"] receiver subscribe error code, retry"),d.toString()),await this.tryUnsubBeforeResub(r,s),await this.subscribe(r,s,!1);throw d}}async subscribeDataChannel(r,s,a){if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new Pe(te.INVALID_OPERATION,"can not subscribe datachannel when connection state is ".concat(this.state));const c={uid:r,stream_id:s.id,channel_id:s.datachannelId};try{return void await this.signal.request(qt.SUBSCRIBE_DATASTREAM,c,!0)}catch(d){if(a&&d.data&&d.data.code===zt.ERR_SUBSCRIBE_REQUEST_INVALID)return x.warning("[".concat(this.store.clientId,"] receiver subscribe datachannel error code, retry"),d.toString()),await this.tryUnsubDataChannelBeforeResub(r,s),await this.subscribeDataChannel(r,s,!1);throw d}}async subscribeAll(r,s){if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new Pe(te.INVALID_OPERATION,"can not massSubscribe when connection state is ".concat(this.state));const a={p2p_id:this.store.p2pId,users:r,dtx:!1,rtx:!!se("USE_SUB_RTX"),twcc:!!se("SUBSCRIBE_TWCC"),svc:Array.isArray(se("SVC"))&&se("SVC").length!==0?se("SVC"):void 0};try{return await this.signal.request(qt.SUBSCRIBE_STREAMS,a,!0)}catch(c){if(s&&c.data&&c.data.code===zt.ERR_SUBSCRIBE_REQUEST_INVALID)return x.warning("[".concat(this.store.clientId,"] receiver massSubscribe error code, retry"),c.toString()),await this.tryMassUnsubBeforeResub(r),await this.subscribeAll(r,!1);throw c}}async setVideoProfile(r){const s=function(a){if(!(a.bitrateMax&&a.bitrateMin&&a.frameRate&&a.height&&a.width))return;let c=a.frameRate,d=a.width,h=a.height,m=!0;return typeof c!="number"&&(c=c.exact||c.ideal||c.max||c.min||0,c||(m=!1)),typeof d!="number"&&(d=d.exact||d.ideal||d.max||d.min||0,d||(m=!1)),typeof h!="number"&&(h=h.exact||h.ideal||h.max||h.min||0,c||(m=!1)),m?{stream_type:0,width:d,height:h,fps:c,start_bps:1e3*a.bitrateMax,min_bps:1e3*a.bitrateMin,target_bps:1e3*a.bitrateMax}:void 0}(r);if(s)return this.signal.request(qt.SET_VIDEO_PROFILE,s);x.debug("[".concat(this.store.clientId,"] encoder config is not complete, do not report to gateway"))}async unsubscribe(r,s){try{await this.signal.request(qt.UNSUBSCRIBE,{p2p_id:this.store.p2pId,ortc:r,stream_id:s},!0)}catch(a){x.warning("[".concat(this.store.clientId,"] unsubscribe warning: "),a)}}async unsubscribeDataChannel(r,s){try{if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new Pe(te.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));await pt.all(r.map(a=>this.signal.request(qt.UNSUBSCRIBE_DATASTREAM,{stream_id:a,uid:s},!0)))}catch(a){x.warning("unsubscribeDataChannel warning: ",a)}}async massUnsubscribe(r){try{await this.signal.request(qt.UNSUBSCRIBE_STREAMS,r,!0)}catch(s){x.warning("[".concat(this.store.clientId,"] massUnsubscribeAll warning: "),s)}}async reconnectPC(r){const{iceParameters:s,dtlsParameters:a,rtpCapabilities:c}=r;return{gatewayEstablishParams:await this.signal.request(qt.CONNECT_PC,{p2p_id:this.store.p2pId,stream_id:this.store.uid,ortc:{iceParameters:s,dtlsParameters:a,rtpCapabilities:c}},!0),gatewayAddress:this.getCurrentGatewayAddress()}}getGatewayInfo(){return this.signal.request(qt.GATEWAY_INFO)}async renewToken(r){await this.signal.request(qt.RENEW_TOKEN,r),this.key=r.token}updateClientRole(r,s){s&&(this._clientRoleOptions=Object.assign({},s)),se("CLIENT_ROLE_OPTIONS")&&(x.debug("[".concat(this.store.clientId,"] Set roleOptions for ").concat(JSON.stringify(se("CLIENT_ROLE_OPTIONS"))," instead of ").concat(JSON.stringify(this._clientRoleOptions)," ")),this._clientRoleOptions=Object.assign({},se("CLIENT_ROLE_OPTIONS"))),this.role=r}async setClientRole(r,s){if(s&&(this._clientRoleOptions=Object.assign({},s)),se("CLIENT_ROLE_OPTIONS")&&(this._clientRoleOptions=Object.assign({},se("CLIENT_ROLE_OPTIONS")),x.debug("[".concat(this.store.clientId,"] Set roleOptions for ").concat(JSON.stringify(se("CLIENT_ROLE_OPTIONS"))," instead of ").concat(JSON.stringify(this._clientRoleOptions)," "))),this.state!=="CONNECTED")return void(this.role=r);let a,c=0;r==="audience"?this._clientRoleOptions&&this._clientRoleOptions.delay?(a=this._clientRoleOptions.delay,c=1):c=this._clientRoleOptions&&this._clientRoleOptions.level?this._clientRoleOptions.level:2:c=0;const d=Object.assign({},s);delete d.delay,delete d.level,await this.signal.request(qt.SET_CLIENT_ROLE,mo(mo({role:r,level:c,delay:a},d),{},{client_ts:Date.now()})),this.role=r}async setRemoteVideoStreamType(r,s){await this.signal.request(qt.SWITCH_VIDEO_STREAM,{stream_id:r,stream_type:s})}async setDefaultRemoteVideoStreamType(r){await this.signal.request(qt.DEFAULT_VIDEO_STREAM,{stream_type:r})}async setStreamFallbackOption(r,s){await this.signal.request(qt.SET_FALLBACK_OPTION,{stream_id:r,fallback_type:s})}async pickSVCLayer(r,s){await this.signal.request(qt.PICK_SVC_LAYER,{stream_id:r,spatial_layer:s.spatialLayer,temporal_layer:s.temporalLayer})}async setRTM2Flag(r){await this.signal.request(qt.SET_RTM2_FLAG,{rtm2_flag:r})}async sendExtensionMessage(r,s,a){if(this.store.useP2P)return this.signal.sendExtensionMessage(r,s,a)}getInChannelInfo(){return this.inChannelInfo.joinAt&&(this.inChannelInfo.duration=Date.now()-this.inChannelInfo.joinAt),mo({},this.inChannelInfo)}async getGatewayVersion(){return(await this.signal.request(qt.GATEWAY_INFO)).version}reset(){if(this.inChannelInfo.joinAt&&(this.inChannelInfo.duration=Date.now()-this.inChannelInfo.joinAt,this.inChannelInfo.joinAt=null),this.trafficStatsInterval&&(window.clearInterval(this.trafficStatsInterval),this.trafficStatsInterval=void 0),this.joinInfo){const r=B2.get(this.joinInfo.cname);r&&r.delete(this.joinInfo.uid)}this.joinInfo=void 0,this.key=void 0,this.networkQualityInterval&&(window.clearInterval(this.networkQualityInterval),this.networkQualityInterval=void 0)}updateTurnConfigFromSignal(){if(!this.joinInfo)return;const r=function(s){let a;return a=s.startsWith("dc")?s.match(/(dc\:\/\/)?([^:]+):(\d+)/):s.match(/(wss\:\/\/)?([^:]+):(\d+)/),a?{username:Us.username,password:Us.password,turnServerURL:a[2],tcpport:parseInt(a[3])+30,udpport:parseInt(a[3])+30,forceturn:!1}:null}((this.joinInfo.cloudProxyServer==="disabled"?this.signal.url:this.joinInfo.gatewayAddrs[this.signal.currentURLIndex].address)||"");this.joinInfo.turnServer.serversFromGateway=[],r&&this.joinInfo.turnServer.mode!=="off"&&this.joinInfo.cloudProxyServer==="disabled"&&this.joinInfo.turnServer.serversFromGateway.push(mo(mo({},Us),{},{turnServerURL:r.turnServerURL,tcpport:r.tcpport,udpport:r.udpport,username:this.joinInfo.uid.toString(),password:this.joinInfo.token}))}async updateTrafficStats(){if(this.state!=="CONNECTED")return;const r=await this.signal.request(qt.TRAFFIC_STATS,void 0,!0);r.timestamp=Date.now(),r.ntp_offset!=null&&(this.ntpOffset=r.ntp_offset),r.peer_delay.forEach(s=>{const a=this._statsCollector.trafficStats&&this._statsCollector.trafficStats.peer_delay.find(c=>c.peer_uid===s.peer_uid);a&&a.B_st!==s.B_st&&fP(()=>{this.emit(ps.STREAM_TYPE_CHANGE,s.peer_uid,s.B_st)})}),this._statsCollector.updateTrafficStats(r)}getJoinMessage(r){var s,a;if(!this.joinInfo||!this.key)throw new Pe(te.UNEXPECTED_ERROR,"can not generate join message, no join info");const c=Object.assign({},this.joinInfo.apResponse);let d=se("REPORT_APP_SCENARIO");if(typeof d!="string")try{d=JSON.stringify(d)}catch{d=void 0}var h;d&&d.length>128&&(d=void 0),this.store.hasStartJoinChannel=!0,this.store.isABTestSuccess||this.emit(ps.UPDATE_GATEWAY_CONFIG),h=this.store.clientId,rt(r0).call(r0,h)||r0.push(h);const m=n2(this.store),g=!((s=this.isPreallocation)===null||s===void 0||!s.call(this)),E=BW(this.store),b=o_e(),I=Vv(87)||X8()||kL(117),A=(function(){const W=xn();if(W.name!==Hn.SAFARI||!W.browserVersion)return!1;const j=W.browserVersion.split(".");return Number(j[0])>18||Number(j[0])===18&&Number(j[1])>=4}()||eW(18,4,!1))&&OL(18,6,!0)&&this.spec.codec==="h264"&&se("ENABLE_ABSSENDTIME_AS_SENTTS"),k=mo({license:this.joinInfo.license,p2p_id:this.store.p2pId,session_id:this.joinInfo.sid,app_id:this.joinInfo.appId,channel_key:this.key,channel_name:this.joinInfo.cname,sdk_version:Bl,browser:navigator.userAgent,process_id:se("PROCESS_ID"),mode:this.store.useP2P?"p2p":this.spec.mode,codec:this.spec.codec,role:this.role,has_changed_gateway:this.hasChangeBGPAddress,ap_response:c,extend:se("JOIN_EXTEND"),details:{6:this.joinInfo.stringUid,cservice_map:this.joinInfo.cloudProxyServer==="proxy3"?"1":this.joinInfo.cloudProxyServer==="proxy5"?"2":void 0},features:{rejoin:!0},optionalInfo:this.joinInfo.optionalInfo,appScenario:d,attributes:{userAttributes:mo(mo({enableEncodedTransform:(!!se("ENABLE_AUDIO_METADATA")||!!se("ENABLE_AUDIO_PTS"))&&I||!!se("ENABLE_AUDIO_TOPN")&&AL(Hn.CHROME,87,116)||void 0,enableAudioMetadata:!!se("ENABLE_AUDIO_METADATA")&&I,enableAudioPts:!!se("ENABLE_AUDIO_PTS")&&I,topnSmoothLevel:se("TOPN_SMOOTH_LEVEL"),topnNewSpeakerDelay:se("TOPN_NEW_SPEAKER_DELAY"),topnSwitchHoldMs:se("TOPN_SWITCH_HOLD_MS"),topnAudioGain:se("TOPN_AUDIO_GAIN"),enablePublishedUserList:se("ENABLE_PUBLISHED_USER_LIST"),maxSubscription:se("MAX_SUBSCRIPTION"),subscribeAudioFilterTopN:il("SUBSCRIBE_AUDIO_FILTER_TOPN","number"),enablePublishAudioFilter:il("ENABLE_PUBLISH_AUDIO_FILTER","boolean"),enableUserLicenseCheck:il("ENABLE_USER_LICENSE_CHECK","boolean"),enableRTX:se("USE_PUB_RTX")===!0||se("USE_SUB_RTX")===!0||void 0,disableFEC:se("DISABLE_FEC"),enableNTPReport:!!se("ENABLE_NTP_REPORT")||void 0,enableInstantVideo:E,enableFulllinkAvSync:!!se("ENABLE_FULL_LINK_AV_SYNC")||void 0,enableDataStream2:il("ENABLE_DATASTREAM_2","boolean"),enableAutFeedback:!!se("FORCE_ENABLE_AUT_CC")||!SP()&&(!!se("ENABLE_AUT_FEEDBACK")||void 0),rtm2Flag:typeof this.joinInfo.rtmFlag=="number"?this.joinInfo.rtmFlag:void 0,enableUserAutoRebalanceCheck:!!se("ENABLE_USER_AUTO_REBALANCE_CHECK"),enableXR:il("USE_XR","boolean"),enableLossbasedBwe:il("ENABLE_LOSSBASED_BWE","boolean"),enableAutCC:!!se("FORCE_ENABLE_AUT_CC")||!SP()&&(!!se("ENABLE_AUT_CC")||void 0),enableCCFallback:il("ENABLE_CC_FALLBACK","boolean"),enablePreallocPC:g,preSubNum:m?il("PRE_SUB_NUM","number"):void 0,enablePubTWCC:il("PUBLISH_TWCC","boolean"),enableSubTWCC:il("SUBSCRIBE_TWCC","boolean"),enablePubRTX:il("USE_PUB_RTX","boolean"),enableSubRTX:il("USE_SUB_RTX","boolean"),enableSubSVC:se("ENABLE_SVC")?se("ENABLE_SVC_DEFAULT_CODECS"):Array.isArray(se("SVC"))&&se("SVC").length!==0?se("SVC"):void 0,enableSvcExtended:se("ENABLE_SVC")&&Array.isArray(se("SVC_EXTENDED"))&&se("SVC_EXTENDED").length!==0?se("SVC_EXTENDED"):void 0},b),{},{audioDuplicate:il("ENABLE_AUDIO_RED","boolean")?(a=il("AUDIO_DUPLICATE_NUM","number"))!==null&&a!==void 0?a:2:void 0,senttsUsesAbsSendTime:!!A||void 0})},join_ts:this.joinGatewayStartTime},r);return this.joinInfo.stringUid&&(k.string_uid=this.joinInfo.stringUid),this.joinInfo.aesmode&&this.joinInfo.aespassword&&(k.aes_mode=this.joinInfo.aesmode,se("ENCRYPT_AES")?(k.aes_secret=this.joinInfo.aespassword,k.aes_encrypt=!0):k.aes_secret=this.joinInfo.aespassword,this.joinInfo.aessalt&&(k.aes_salt=this.joinInfo.aessalt)),c.addresses[this.signal.websocket.currentURLIndex]&&(k.ap_response.ticket=c.addresses[this.signal.websocket.currentURLIndex].ticket,delete c.addresses),this.joinInfo.defaultVideoStream!==void 0&&(k.default_video_stream=this.joinInfo.defaultVideoStream),k}getRejoinMessage(){if(!this.joinInfo)throw new Pe(te.UNEXPECTED_ERROR,"can not generate rejoin message, no join info");return{session_id:this.joinInfo.sid,channel_name:this.joinInfo.cname,cid:this.joinInfo.cid,uid:this.joinInfo.uid,vid:Number(this.joinInfo.vid)}}handleSignalEvents(){this.signal.on(Jt.WS_RECONNECT_CREATE_CONNECTION,r=>{this.joinGatewayStartTime=Date.now()}),this.signal.on(Jt.WS_RECONNECTING,r=>{this.joinInfo&&At.WebSocketQuit(this.joinInfo.sid,{lts:Date.now(),succ:-1,cname:this.joinInfo.cname,uid:this.joinInfo.uid,cid:this.joinInfo.cid,errorCode:r||Ls.NETWORK_ERROR}),this.joinInfo&&(this.state="RECONNECTING",At.sessionInit(this.joinInfo.sid,{lts:new Date().getTime(),extend:this.isSignalRecover?{recover:!0}:{rejoin:!0},cname:this.joinInfo.cname,appid:this.joinInfo.appId,mode:this.spec.mode,stringUid:this.joinInfo.stringUid,channelProfile:this.spec.mode==="live"?1:0,channelMode:0,lsid:this.joinInfo.sid,clientRole:this.role==="audience"?2:1,buildFormat:1}),this.isSignalRecover=!1,this.joinGatewayStartTime=Date.now())}),this.signal.on(Jt.WS_CLOSED,r=>{let s;switch(r){case rr.LEAVE:s=Ls.LEAVE;break;case rr.UID_BANNED:case rr.IP_BANNED:case rr.CHANNEL_BANNED:case rr.SERVER_ERROR:s=Ls.SERVER_ERROR;break;case rr.FALLBACK:s=Ls.FALLBACK;break;case rr.LICENSE_MISSING:case rr.LICENSE_EXPIRED:case rr.LICENSE_MINUTES_EXCEEDED:case rr.LICENSE_PERIOD_INVALID:case rr.LICENSE_MULTIPLE_SDK_SERVICE:case rr.LICENSE_ILLEGAL:case rr.TOKEN_EXPIRE:s=r;break;default:s=Ls.NETWORK_ERROR}x.debug("[".concat(this.store.clientId,"] [signal] websocket closed, reason: ").concat(s||"undefined -> "+Ls.NETWORK_ERROR)),this.joinInfo&&At.WebSocketQuit(this.joinInfo.sid,{lts:Date.now(),succ:r===rr.LEAVE?1:-1,cname:this.joinInfo.cname,uid:this.joinInfo.uid,cid:this.joinInfo.cid,errorCode:s}),this._disconnectedReason=r,r!==rr.FALLBACK&&(this.state="DISCONNECTED"),this.reset()}),this.signal.on(Jt.WS_CONNECTED,()=>{if(this.updateTurnConfigFromSignal(),this.state="CONNECTED",this.joinInfo){if(this.role==="audience"){const r=se("CLIENT_ROLE_OPTIONS")||this._clientRoleOptions;r&&(r.level||r.delay)&&(x.debug("[".concat(this.store.clientId,"] patch to send set client role, role: ").concat(this.role,", mode: ").concat(this.spec.mode,", level: ").concat(r.level,", delay: ").concat(r.delay)),this.setClientRole(this.role,r))}if(At.joinGateway(this.joinInfo.sid,{lts:this.joinGatewayStartTime,succ:!0,ec:null,vid:this.joinInfo.vid,addr:this.signal.url,uid:this.joinInfo.uid,cid:this.joinInfo.cid,firstSuccess:this._isProactiveJoin,isProxy:!!this.joinInfo.proxyServer,signalChannel:"0",preload:this.joinInfo.preload,isABTestSuccess:this.store.isABTestSuccess}),this._isProactiveJoin=!1,this.joinInfo.useLocalAccessPoint&&this.joinInfo.setLocalAPVersion===1){const r=this.signal.url&&this.signal.url.match(/wss\:\/\/([^:]+):(\d+)/);if(!r)return void x.error("[".concat(this.store.clientId,"] set local access point after joined failed: ").concat(r));pr("EVENT_REPORT_DOMAIN",r[1]),pr("EVENT_REPORT_BACKUP_DOMAIN",r[1]),pr("LOG_UPLOAD_SERVER","".concat(r[1],":6444"))}}}),this.signal.on(An.ON_UPLINK_STATS,r=>{this._statsCollector.updateUplinkStats(r)}),this.signal.on(Jt.REQUEST_RECOVER,(r,s,a)=>{if(!this.joinInfo)return a(new Pe(te.UNEXPECTED_ERROR,"gateway: can not recover, no join info"));r&&(this.joinInfo.multiIP=r,this.hasChangeBGPAddress=!0),this.isSignalRecover=!0,Ms(this,ps.REQUEST_NEW_GATEWAY_LIST).then(s).catch(a)}),this.signal.on(Jt.REQUEST_JOIN_INFO,async(r,s,a)=>{var c,d,h;if(this.updateTurnConfigFromSignal(),this.store.useP2P)return void r(this.getJoinMessage({ortc:{}}));const m=Kr((c=this.joinInfo)===null||c===void 0?void 0:c.turnServer);if(se("NEW_TURN_MODE")&&m&&((d=this.joinInfo)===null||d===void 0?void 0:d.cloudProxyServer)==="disabled"){var g;let A=m.servers.map(j=>"turnServerURL"in j&&se("USE_TURN_IP")?mo(mo({},j),{},{turnServerURL:WP(j.turnServerURL)}):j),k=(g=m.serversFromGateway)===null||g===void 0?void 0:g.map(j=>se("USE_TURN_IP")?mo(mo({},j),{},{turnServerURL:WP(j.turnServerURL)}):j);const W=this.signal.currentURLIndex;A.length>0&&(A=[A[W%A.length]],m.servers=A),Array.isArray(k)&&k.length>0&&(k=[k[0]],m.serversFromGateway=k),x.debug("[".concat(this.store.clientId,"] use single turn, use turn server index: ").concat(W))}const{iceParameters:E,dtlsParameters:b,rtpCapabilities:I}=await Ms(this,ps.REQUEST_P2P_CONNECTION_PARAMS,{turnServer:m,cloudProxyServer:(h=this.joinInfo)===null||h===void 0?void 0:h.cloudProxyServer});try{r(this.getJoinMessage({ortc:{iceParameters:E,dtlsParameters:b,rtpCapabilities:I,version:"2"}}))}catch(A){s(A)}}),this.signal.on(Jt.REQUEST_REJOIN_INFO,r=>{r(this.getRejoinMessage())}),this.signal.on(Jt.REPORT_JOIN_GATEWAY,(r,s)=>{if(!this.joinInfo)return;let a,c="";var d;r instanceof Pe?(a=((d=r.data)===null||d===void 0?void 0:d.desc)||r.code,c=r.message):a=r,At.joinGateway(this.joinInfo.sid,{lts:this.joinGatewayStartTime,succ:!1,ec:a,errorMsg:c,addr:s,uid:this.joinInfo.uid,cid:this.joinInfo.cid,firstSuccess:this._isProactiveJoin,isProxy:!!this.joinInfo.proxyServer,signalChannel:"0",preload:this.joinInfo.preload})}),this.signal.on(Jt.IS_P2P_DISCONNECTED,r=>{r(Xw(this,ps.IS_P2P_DISCONNECTED))}),this.signal.on(Jt.DISCONNECT_P2P,()=>{this.emit(ps.DISCONNECT_P2P)}),this.signal.on(Jt.REQUEST_SUCCESS,()=>{this._signalTimeout=!1}),this.signal.on(Jt.REQUEST_TIMEOUT,()=>{this._signalTimeout=!0}),this.signal.on(Jt.JOIN_RESPONSE,r=>{const s=this.getCurrentGatewayAddress();this.emit(ps.JOIN_RESPONSE,r,s)}),this.signal.on(Jt.PRE_CONNECT_PC,async()=>{if(this.joinInfo){var r,s;this.updateTurnConfigFromSignal();const c=this.getCurrentGatewayAddress(),d=Kr((r=this.joinInfo)===null||r===void 0?void 0:r.turnServer);if(se("NEW_TURN_MODE")&&d&&((s=this.joinInfo)===null||s===void 0?void 0:s.cloudProxyServer)==="disabled"){var a;let m=d.servers.map(b=>"turnServerURL"in b&&se("USE_TURN_IP")?mo(mo({},b),{},{turnServerURL:WP(b.turnServerURL)}):b),g=(a=d.serversFromGateway)===null||a===void 0?void 0:a.map(b=>se("USE_TURN_IP")?mo(mo({},b),{},{turnServerURL:WP(b.turnServerURL)}):b);const E=this.signal.currentURLIndex;m.length>0&&(m=[m[E%m.length]],d.servers=m),Array.isArray(g)&&g.length>0&&(g=[g[0]],d.serversFromGateway=g),x.debug("[".concat(this.store.clientId,"] use single turn, use turn server index: ").concat(E,",in pre pc"))}const h=se("FINGERPRINT")||this.joinInfo.apResponse.addresses[this.signal.currentURLIndex].fingerprint;if(c&&h){const m=RH(c);this.emit(ps.PRE_CONNECT_PC,{candidates:m,fingerprint:h,turnServer:d})}}}),this.signal.on(Jt.RECOVER_NOTIFICATION,r=>{this.joinInfo&&typeof se("AP_REQUEST_DETAIL")=="string"&&(this.joinInfo.apRequestDetail="".concat(se("AP_REQUEST_DETAIL"),";").concat(r))})}async tryUnsubBeforeResub(r,s){try{await this.signal.request(qt.UNSUBSCRIBE,{p2p_id:this.store.p2pId,stream_id:r,ortc:[s]},!0)}catch(a){throw x.warning("[".concat(this.store.clientId,"] tryUnsubBeforeResub warning"),a),a}}async tryUnsubDataChannelBeforeResub(r,s){try{await this.signal.request(qt.UNSUBSCRIBE,{stream_id:s.id},!0)}catch(a){throw x.warning("unsubscribe datachannel warning",a),a}}async tryUnpubBeforeRepub(r,s){try{await this.signal.request(qt.UNPUBLISH,{stream_id:r,ortc:s},!0)}catch(a){throw x.warning("[".concat(this.store.clientId,"] tryUnpubBeforeRepub warning: "),a),a}}async tryUnpubDataChannelBeforeRepub(r,s){try{await this.signal.request(qt.UNPUBLISH_DATASTREAM,{channnel_id:s.channelId},!0)}catch(a){throw x.warning("unpublish datastream warning: ",a),a}}async tryMassUnsubBeforeResub(r){const s={users:r.map(a=>({stream_id:a.stream_id,stream_type:a.stream_type}))};try{await this.signal.request(qt.UNSUBSCRIBE_STREAMS,s,!0)}catch(a){throw x.warning("[".concat(this.store.clientId,"] tryMassUnsubBeforeResub warning"),a),a}}async muteLocal(r,s){const a={action:r.find(c=>c.stream_type===or.Audio)?"mute_local_audio":"mute_local_video",p2p_id:this.store.p2pId,ortc:r,stream_id:s};try{await this.signal.request(qt.CONTROL,a,!0,!0)}catch(c){throw x.warning("[".concat(this.store.clientId,"] gateway muteLocal warning: "),c),c}}async unmuteLocal(r,s){const a={action:r.find(c=>c.stream_type===or.Audio)?"unmute_local_audio":"unmute_local_video",p2p_id:this.store.p2pId,ortc:r,stream_id:s};try{await this.signal.request(qt.CONTROL,a,!0,!0)}catch(c){throw x.warning("[".concat(this.store.clientId,"] gateway unmuteLocal warning: "),c),c}}async muteRemote(r,s){const a={action:r===yt.AUDIO?"mute_remote_audio":"mute_remote_video",p2p_id:this.store.p2pId,stream_id:s};try{await this.signal.request(qt.CONTROL,a,!0,!0)}catch(c){throw x.warning("[".concat(this.store.clientId,"] gateway muteRemote warning: "),c),c}}async unmuteRemote(r,s){const a={action:r===yt.AUDIO?"unmute_remote_audio":"unmute_remote_video",p2p_id:this.store.p2pId,stream_id:s};try{await this.signal.request(qt.CONTROL,a,!0,!0)}catch(c){throw x.warning("[".concat(this.store.clientId,"] gateway unmuteRemote warning: "),c),c}}uploadWRTCStats(r){this.signal.uploadWRTCStats(r)}upload(r,s){this.signal.upload(r,s)}getSignalRTT(){return this.signal.rtt}async restartICE(r){const s={p2p_id:this.store.p2pId,stream_id:this.store.uid,ortc:r};try{return await this.signal.request(qt.RESTART_ICE,s,!0)}catch(a){throw x.warning("[".concat(this.store.clientId,"] P2PChannel.restartICE warning: "),a),a}}reconnect(r,s){this.state==="CONNECTED"&&this.signal.reconnect(r||void 0,s||Ls.P2P_FAILED)}getCurrentGatewayAddress(){var r,s;if(!se("GATEWAY_WSS_ADDRESS"))return se("USE_CANDIDATE_FROM_AP_DETAIL")&&(r=this.joinInfo)!==null&&r!==void 0&&r.apGatewayAddress?(x.debug("[".concat(this.store.clientId,"] use candidate from ap detail, ").concat(JSON.stringify(this.joinInfo.apGatewayAddress))),this.joinInfo.apGatewayAddress):(s=this.joinInfo)!==null&&s!==void 0&&s.gatewayAddrs?this.joinInfo.gatewayAddrs[this.signal.currentURLIndex]:void 0}async setPublishAudioFilterEnabled(r){await this.signal.request(qt.SET_PARAMETER,{enablePublishAudioFilter:r})}downgradeCodec(r){this.signal.downgradeCodec(r)}}let XP=0,z2=0;function Kd(t,r,s,a){return new pt((c,d)=>{r.timeout=r.timeout||se("HTTP_CONNECT_TIMEOUT"),r.responseType=r.responseType||"json",r.data&&!s?(r.data=JSON.stringify(r.data),XP+=Gh(r.data)):s&&(r.data.size?XP+=r.data.size:r.data instanceof FormData?XP+=gW(r.data):XP+=Gh(JSON.stringify(r.data))),r.headers=r.headers||{},r.headers["Content-Type"]=r.headers["Content-Type"]||"application/json",r.method="POST",r.url=t,Sa.request(r).then(h=>{typeof h.data=="string"?z2+=Gh(h.data):h.data instanceof ArrayBuffer||h.data instanceof Uint8Array?z2+=h.data.byteLength:z2+=Gh(JSON.stringify(h.data)),a&&c({data:h.data,headers:h.headers}),c(h.data)}).catch(h=>{Sa.isCancel(h)?d(new Pe(te.OPERATION_ABORTED,"cancel token canceled")):h.code==="ECONNABORTED"?d(new Pe(te.NETWORK_TIMEOUT,h.message)):h.response?d(new Pe(te.NETWORK_RESPONSE_ERROR,h.response.status)):d(new Pe(te.NETWORK_ERROR,h.message))})})}/*! formdata-polyfill. MIT License. Jimmy W?rting <https://jimmy.warting.se/opensource> */(function(){var t;function r(Be){var st=0;return function(){return st<Be.length?{done:!1,value:Be[st++]}:{done:!0}}}var s=typeof Object.defineProperties=="function"?Object.defineProperty:function(Be,st,bt){return Be==Array.prototype||Be==Object.prototype||(Be[st]=bt.value),Be},a,c=function(Be){Be=[typeof globalThis=="object"&&globalThis,Be,typeof window=="object"&&window,typeof self=="object"&&self,typeof o=="object"&&o];for(var st=0;st<Be.length;++st){var bt=Be[st];if(bt&&bt.Math==Math)return bt}throw Error("Cannot find global object")}(this);function d(Be,st){if(st)e:{var bt=c;Be=Be.split(".");for(var He=0;He<Be.length-1;He++){var V=Be[He];if(!(V in bt))break e;bt=bt[V]}(st=st(He=bt[Be=Be[Be.length-1]]))!=He&&st!=null&&s(bt,Be,{configurable:!0,writable:!0,value:st})}}function h(Be){return(Be={next:Be})[Symbol.iterator]=function(){return this},Be}function m(Be){var st=typeof Symbol<"u"&&Symbol.iterator&&Be[Symbol.iterator];return st?st.call(Be):{next:r(Be)}}if(d("Symbol",function(Be){function st(V,le){this.A=V,s(this,"description",{configurable:!0,writable:!0,value:le})}if(Be)return Be;st.prototype.toString=function(){return this.A};var bt="jscomp_symbol_"+(1e9*Math.random()>>>0)+"_",He=0;return function V(le){if(this instanceof V)throw new TypeError("Symbol is not a constructor");return new st(bt+(le||"")+"_"+He++,le)}}),d("Symbol.iterator",function(Be){if(Be)return Be;Be=Symbol("Symbol.iterator");for(var st="Array Int8Array Uint8Array Uint8ClampedArray Int16Array Uint16Array Int32Array Uint32Array Float32Array Float64Array".split(" "),bt=0;bt<st.length;bt++){var He=c[st[bt]];typeof He=="function"&&typeof He.prototype[Be]!="function"&&s(He.prototype,Be,{configurable:!0,writable:!0,value:function(){return h(r(this))}})}return Be}),typeof Object.setPrototypeOf=="function")a=Object.setPrototypeOf;else{var g;e:{var E={};try{E.__proto__={a:!0},g=E.a;break e}catch{}g=!1}a=g?function(Be,st){if(Be.__proto__=st,Be.__proto__!==st)throw new TypeError(Be+" is not extensible");return Be}:null}var b=a;function I(){this.m=!1,this.j=null,this.v=void 0,this.h=1,this.u=this.C=0,this.l=null}function A(Be){if(Be.m)throw new TypeError("Generator is already running");Be.m=!0}function k(Be,st){return Be.h=3,{value:st}}function W(Be){this.g=new I,this.G=Be}function j(Be,st,bt,He){try{var V=st.call(Be.g.j,bt);if(!(V instanceof Object))throw new TypeError("Iterator result "+V+" is not an object");if(!V.done)return Be.g.m=!1,V;var le=V.value}catch(ge){return Be.g.j=null,Be.g.s(ge),B(Be)}return Be.g.j=null,He.call(Be.g,le),B(Be)}function B(Be){for(;Be.g.h;)try{var st=Be.G(Be.g);if(st)return Be.g.m=!1,{value:st.value,done:!1}}catch(bt){Be.g.v=void 0,Be.g.s(bt)}if(Be.g.m=!1,Be.g.l){if(st=Be.g.l,Be.g.l=null,st.F)throw st.D;return{value:st.return,done:!0}}return{value:void 0,done:!0}}function ee(Be){this.next=function(st){return Be.o(st)},this.throw=function(st){return Be.s(st)},this.return=function(st){return function(bt,He){A(bt.g);var V=bt.g.j;return V?j(bt,"return"in V?V.return:function(le){return{value:le,done:!0}},He,bt.g.return):(bt.g.return(He),B(bt))}(Be,st)},this[Symbol.iterator]=function(){return this}}function Z(Be,st){return st=new ee(new W(st)),b&&Be.prototype&&b(st,Be.prototype),st}if(I.prototype.o=function(Be){this.v=Be},I.prototype.s=function(Be){this.l={D:Be,F:!0},this.h=this.C||this.u},I.prototype.return=function(Be){this.l={return:Be},this.h=this.u},W.prototype.o=function(Be){return A(this.g),this.g.j?j(this,this.g.j.next,Be,this.g.o):(this.g.o(Be),B(this))},W.prototype.s=function(Be){return A(this.g),this.g.j?j(this,this.g.j.throw,Be,this.g.o):(this.g.s(Be),B(this))},d("Array.prototype.entries",function(Be){return Be||function(){return function(st,bt){st instanceof String&&(st+="");var He=0,V=!1,le={next:function(){if(!V&&He<st.length){var ge=He++;return{value:bt(ge,st[ge]),done:!1}}return V=!0,{done:!0,value:void 0}}};return le[Symbol.iterator]=function(){return le},le}(this,function(st,bt){return[st,bt]})}}),typeof Blob<"u"&&(typeof FormData>"u"||!FormData.prototype.keys)){var oe=function(Be,st){for(var bt=0;bt<Be.length;bt++)st(Be[bt])},ye=function(Be){return Be.replace(/\r?\n|\r/g,`\r
`)},_e=function(Be,st,bt){return st instanceof Blob?(bt=bt!==void 0?bt+"":typeof st.name=="string"?st.name:"blob",st.name===bt&&Object.prototype.toString.call(st)!=="[object Blob]"||(st=new File([st],bt)),[String(Be),st]):[String(Be),String(st)]},ue=function(Be,st){if(Be.length<st)throw new TypeError(st+" argument required, but only "+Be.length+" present.")},Ce=typeof globalThis=="object"?globalThis:typeof window=="object"?window:typeof self=="object"?self:this,Ue=Ce.FormData,ze=Ce.XMLHttpRequest&&Ce.XMLHttpRequest.prototype.send,Je=Ce.Request&&Ce.fetch,hn=Ce.navigator&&Ce.navigator.sendBeacon,vn=Ce.Element&&Ce.Element.prototype,Xt=Ce.Symbol&&Symbol.toStringTag;Xt&&(Blob.prototype[Xt]||(Blob.prototype[Xt]="Blob"),"File"in Ce&&!File.prototype[Xt]&&(File.prototype[Xt]="File"));try{new File([],"")}catch{Ce.File=function(st,bt,He){return st=new Blob(st,He||{}),Object.defineProperties(st,{name:{value:bt},lastModified:{value:+(He&&He.lastModified!==void 0?new Date(He.lastModified):new Date)},toString:{value:function(){return"[object File]"}}}),Xt&&Object.defineProperty(st,Xt,{value:"File"}),st}}var nr=function(Be){return Be.replace(/\n/g,"%0A").replace(/\r/g,"%0D").replace(/"/g,"%22")},Kn=function(Be){this.i=[];var st=this;Be&&oe(Be.elements,function(bt){if(bt.name&&!bt.disabled&&bt.type!=="submit"&&bt.type!=="button"&&!bt.matches("form fieldset[disabled] *"))if(bt.type==="file"){var He=bt.files&&bt.files.length?bt.files:[new File([],"",{type:"application/octet-stream"})];oe(He,function(V){st.append(bt.name,V)})}else bt.type==="select-multiple"||bt.type==="select-one"?oe(bt.options,function(V){!V.disabled&&V.selected&&st.append(bt.name,V.value)}):bt.type==="checkbox"||bt.type==="radio"?bt.checked&&st.append(bt.name,bt.value):(He=bt.type==="textarea"?ye(bt.value):bt.value,st.append(bt.name,He))})};if((t=Kn.prototype).append=function(Be,st,bt){ue(arguments,2),this.i.push(_e(Be,st,bt))},t.delete=function(Be){ue(arguments,1);var st=[];Be=String(Be),oe(this.i,function(bt){bt[0]!==Be&&st.push(bt)}),this.i=st},t.entries=function Be(){var st,bt=this;return Z(Be,function(He){if(He.h==1&&(st=0),He.h!=3)return st<bt.i.length?He=k(He,bt.i[st]):(He.h=0,He=void 0),He;st++,He.h=2})},t.forEach=function(Be,st){ue(arguments,1);for(var bt=m(this),He=bt.next();!He.done;He=bt.next()){var V=m(He.value);He=V.next().value,V=V.next().value,Be.call(st,V,He,this)}},t.get=function(Be){ue(arguments,1);var st=this.i;Be=String(Be);for(var bt=0;bt<st.length;bt++)if(st[bt][0]===Be)return st[bt][1];return null},t.getAll=function(Be){ue(arguments,1);var st=[];return Be=String(Be),oe(this.i,function(bt){bt[0]===Be&&st.push(bt[1])}),st},t.has=function(Be){ue(arguments,1),Be=String(Be);for(var st=0;st<this.i.length;st++)if(this.i[st][0]===Be)return!0;return!1},t.keys=function Be(){var st,bt,He,V,le=this;return Z(Be,function(ge){if(ge.h==1&&(st=m(le),bt=st.next()),ge.h!=3)return bt.done?void(ge.h=0):(He=bt.value,V=m(He),k(ge,V.next().value));bt=st.next(),ge.h=2})},t.set=function(Be,st,bt){ue(arguments,2),Be=String(Be);var He=[],V=_e(Be,st,bt),le=!0;oe(this.i,function(ge){ge[0]===Be?le&&(le=!He.push(V)):He.push(ge)}),le&&He.push(V),this.i=He},t.values=function Be(){var st,bt,He,V,le=this;return Z(Be,function(ge){if(ge.h==1&&(st=m(le),bt=st.next()),ge.h!=3)return bt.done?void(ge.h=0):(He=bt.value,(V=m(He)).next(),k(ge,V.next().value));bt=st.next(),ge.h=2})},Kn.prototype._asNative=function(){for(var Be=new Ue,st=m(this),bt=st.next();!bt.done;bt=st.next()){var He=m(bt.value);bt=He.next().value,He=He.next().value,Be.append(bt,He)}return Be},Kn.prototype._blob=function(){var Be="----formdata-polyfill-"+Math.random(),st=[],bt="--"+Be+`\r
Content-Disposition: form-data; name="`;return this.forEach(function(He,V){return typeof He=="string"?st.push(bt+nr(ye(V))+`"\r
\r
`+ye(He)+`\r
`):st.push(bt+nr(ye(V))+'"; filename="'+nr(He.name)+`"\r
Content-Type: `+(He.type||"application/octet-stream")+`\r
\r
`,He,`\r
`)}),st.push("--"+Be+"--"),new Blob(st,{type:"multipart/form-data; boundary="+Be})},Kn.prototype[Symbol.iterator]=function(){return this.entries()},Kn.prototype.toString=function(){return"[object FormData]"},vn&&!vn.matches&&(vn.matches=vn.matchesSelector||vn.mozMatchesSelector||vn.msMatchesSelector||vn.oMatchesSelector||vn.webkitMatchesSelector||function(Be){for(var st=(Be=(this.document||this.ownerDocument).querySelectorAll(Be)).length;0<=--st&&Be.item(st)!==this;);return-1<st}),Xt&&(Kn.prototype[Xt]="FormData"),ze){var eo=Ce.XMLHttpRequest.prototype.setRequestHeader;Ce.XMLHttpRequest.prototype.setRequestHeader=function(Be,st){eo.call(this,Be,st),Be.toLowerCase()==="content-type"&&(this.B=!0)},Ce.XMLHttpRequest.prototype.send=function(Be){Be instanceof Kn?(Be=Be._blob(),this.B||this.setRequestHeader("Content-Type",Be.type),ze.call(this,Be)):ze.call(this,Be)}}Je&&(Ce.fetch=function(Be,st){return st&&st.body&&st.body instanceof Kn&&(st.body=st.body._blob()),Je.call(this,Be,st)}),hn&&(Ce.navigator.sendBeacon=function(Be,st){return st instanceof Kn&&(st=st._asNative()),hn.call(this,Be,st)}),Ce.FormData=Kn}})();const pT=()=>{const t=se("AREAS");return t.length===0&&t.push(Jn.GLOBAL),Wa(t).call(t,(r,s,a)=>{const c=FH(s);return c?a===0?c:"".concat(r,",").concat(c):r},"")},FH=t=>t===Jn.OVERSEA?"".concat(Js.ASIA,",").concat(Js.EUROPE,",").concat(Js.AFRICA,",").concat(Js.NORTH_AMERICA,",").concat(Js.SOUTH_AMERICA,",").concat(Js.OCEANIA):Js[t],c_e=t=>{const r={CODE:"",WEBCS_DOMAIN:[],WEBCS_DOMAIN_BACKUP_LIST:[],PROXY_CS:[],CDS_AP:[],ACCOUNT_REGISTER:[],UAP_AP:[],EVENT_REPORT_DOMAIN:[],EVENT_REPORT_BACKUP_DOMAIN:[],LOG_UPLOAD_SERVER:[],PROXY_SERVER_TYPE3:[]};return t.map(s=>{const a=BP[s],c=Object.keys(a);c&&c.map(d=>{d!=="CODE"&&(r[d]=r[d].concat(a[d]))})}),r},JP={GLOBAL:{ASIA:[Jn.CHINA,Jn.JAPAN,Jn.INDIA,Jn.KOREA,Jn.HKMC],EUROPE:[],NORTH_AMERICA:[Jn.US],SOUTH_AMERICA:[],OCEANIA:[],AFRICA:[]}},QP=Object.keys(JP[Jn.GLOBAL]),W2=[Jn.CHINA,Jn.NORTH_AMERICA,Jn.EUROPE,Jn.ASIA,Jn.JAPAN,Jn.INDIA,Jn.OCEANIA,Jn.SOUTH_AMERICA,Jn.AFRICA,Jn.KOREA,Jn.HKMC,Jn.US],l_e=function(t,r){let s=[];if(rt(t).call(t,Jn.GLOBAL)){const d=[Jn.GLOBAL,Jn.OVERSEA],h=Object.keys(BP);if(r===Jn.GLOBAL)throw new Pe(te.INVALID_PARAMS,"GLOBAL is an invalid excludedArea value");if(r===Jn.CHINA)s=[Jn.OVERSEA];else if(c=r,rt(QP).call(QP,c)){const m=(a=r,JP[Jn.GLOBAL][a]||[]),g=[...d,r,...m];s=h.filter(E=>!rt(g).call(g,E))}else if(function(m){let g=!1;return QP.forEach(E=>{var b;rt(b=JP[Jn.GLOBAL][E]).call(b,m)&&(g=!0)}),g}(r)){const m=function(E){let b;return QP.forEach(I=>{var A;rt(A=JP[Jn.GLOBAL][I]).call(A,E)&&(b=I)}),b}(r),g=[...d,m,r];s=h.filter(E=>!rt(g).call(g,E))}else s=t;s=function(m){const g=[];return W2.forEach(E=>{rt(m).call(m,E)&&g.push(E)}),g.concat(m.filter(E=>!rt(W2).call(W2,E)))}(s)}else s=t;var a,c;return s};function jH(t){var r,s;if(!t&&rt(r=se("AREAS")).call(r,Jn.EXTENSIONS))return x.debug("update area from ap : reset"),void G2(_ge,!0);if(!rt(s=se("AREAS")).call(s,Jn.GLOBAL)||!t)return;let a=BP.EXTENSIONS;a&&(a={CODE:FH(Jn.EXTENSIONS),WEBCS_DOMAIN:["ap-web-1-".concat(t,".agora.io")],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-".concat(t,".ap.sd-rtn.com")],PROXY_CS:["proxy-ap-web-".concat(t,".agora.io")],CDS_AP:["cds-ap-web-1-".concat(t,".agora.io"),"cds-ap-web-2-".concat(t,".ap.sd-rtn.com")],ACCOUNT_REGISTER:["sua-ap-web-1-".concat(t,".agora.io"),"sua-ap-web-2-".concat(t,".ap.sd-rtn.com")],UAP_AP:["uap-ap-web-1-".concat(t,".agora.io"),"uap-ap-web-2-".concat(t,".ap.sd-rtn.com")],EVENT_REPORT_DOMAIN:["statscollector-1-".concat(t,".agora.io")],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-".concat(t,".agora.io")],LOG_UPLOAD_SERVER:["logservice-".concat(t,".agora.io")],PROXY_SERVER_TYPE3:["webrtc-cloud-proxy-".concat(t,".agora.io")]},x.debug("update area from ap success: ".concat(t,",config is "),a),pr("AREAS",[Jn.EXTENSIONS],!0),Object.keys(a).map(c=>{c==="LOG_UPLOAD_SERVER"||c==="EVENT_REPORT_DOMAIN"||c==="EVENT_REPORT_BACKUP_DOMAIN"||c==="PROXY_SERVER_TYPE3"?pr(c,a[c][0]):pr(c,a[c])}))}function G2(t){let r=arguments.length>1&&arguments[1]!==void 0&&arguments[1];const s=At.reportApiInvoke(null,{name:di.SET_AREA,options:t,tag:$r.TRACER});try{let a=[];if(typeof t=="string"&&(a=[t]),Array.isArray(t)&&(t.forEach(d=>{if(!rt(aH).call(aH,d))throw new Pe(te.INVALID_PARAMS,"invalid area code")}),a=t),Object.prototype.toString.call(t)==="[object Object]"){const{areaCode:d,excludedArea:h}=t;if(!d)throw new Pe(te.INVALID_PARAMS,"area code is needed");let m=d;typeof d=="string"&&(m=[d]),a=h?l_e(m,h):m}if(!r){if(Wd.AREAS){const d=new Pe(te.PROHIBITED_OPERATION,"setArea is prohibited because of config-distribute");return s.onError(d),void x.warning("setArea is prohibited because of config-distribute")}if(rt(a).call(a,Jn.GLOBAL)&&se("AREAS")===Jn.EXTENSIONS){const d=new Pe(te.PROHIBITED_OPERATION,"setArea is prohibited because of ap extensions");return s.onError(d),void x.warning("setArea is prohibited because of ap extensions")}}pr("AREAS",a,r);const c=c_e(a);Object.keys(c).map(d=>{d==="LOG_UPLOAD_SERVER"||d==="EVENT_REPORT_DOMAIN"||d==="EVENT_REPORT_BACKUP_DOMAIN"||d==="PROXY_SERVER_TYPE3"?pr(d,c[d][0]):pr(d,c[d])}),x.debug("set area success:",a.join(","))}catch(a){throw s.onError(a),a}s.onSuccess()}function BH(t,r){var s=Object.keys(t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);r&&(a=a.filter(function(c){return Object.getOwnPropertyDescriptor(t,c).enumerable})),s.push.apply(s,a)}return s}function Xh(t){for(var r=1;r<arguments.length;r++){var s=arguments[r]!=null?arguments[r]:{};r%2?BH(Object(s),!0).forEach(function(a){Y(t,a,s[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(s)):BH(Object(s)).forEach(function(a){Object.defineProperty(t,a,Object.getOwnPropertyDescriptor(s,a))})}return t}let H2=1;function u_e(t,r,s,a,c){H2+=1;const d={sid:s.sid,command:"convergeAllocateEdge",uid:"666",appId:s.appId,ts:Math.floor(Date.now()/1e3),seq:H2,requestId:H2,version:Bl,cname:s.cname},h={service_name:r,json_body:JSON.stringify(d)};let m,g,E=t[0];return zd(async()=>{m=Date.now();const b=await Kd(E,{data:h,cancelToken:a,headers:{"X-Packet-Service-Type":"0","X-Packet-URI":"61"}});if(g=Date.now()-m,b.code!==0){const k=new Pe(te.UNEXPECTED_RESPONSE,"live streaming ap error, code"+b.code,{retry:!0,responseTime:g});throw x.error(k.toString()),k}const I=JSON.parse(b.json_body);if(I.code!==200){const k=new Pe(te.UNEXPECTED_RESPONSE,"live streaming app center error, code: ".concat(I.code,", reason: ").concat(I.reason),{code:I.code,responseTime:g});throw x.error(k.toString()),k}if(!I.servers||I.servers.length===0){const k=new Pe(te.UNEXPECTED_RESPONSE,"live streaming app center empty server",{code:I.code,responseTime:g});throw x.error(k.toString()),k}const A=function(k,W){return{addressList:k.servers.map(j=>"wss://".concat(j.address.replace(/\./g,"-"),".").concat(se("WORKER_DOMAIN"),":").concat(j.wss,"?serviceName=").concat(encodeURIComponent(W))),workerToken:k.workerToken,vid:k.vid}}(I,r);return se("LIVE_STREAMING_ADDRESS")&&(A.addressList=se("LIVE_STREAMING_ADDRESS")instanceof Array?se("LIVE_STREAMING_ADDRESS"):[se("LIVE_STREAMING_ADDRESS")]),Xh(Xh({},A),{},{responseTime:g})},(b,I)=>(At.apworkerEvent(s.sid,{success:!0,sc:200,serviceName:r,responseDetail:JSON.stringify(b.addressList),firstSuccess:I===0,responseTime:g,serverIp:t[I%t.length]}),!1),(b,I)=>(At.apworkerEvent(s.sid,{success:!1,sc:b.data&&b.data.code||200,serviceName:r,responseTime:g,serverIp:t[I%t.length]}),!!(b.code!==te.OPERATION_ABORTED&&b.code!==te.UNEXPECTED_RESPONSE||b.data&&b.data.retry)&&(E=t[(I+1)%t.length],!0)),c)}let $2=1;function zH(t,r,s,a){let{url:c,areaCode:d}=t;const{clientId:h,sid:m}=r,g=Date.now();let E;const b=r.role,[I,A]=q2(r,d,[Ri.CHOOSE_SERVER]);let k=Ci.networkState;return zd(async()=>{k&&Ci.networkState===Tc.OFFLINE&&Ci.onlineWaiter&&await pt.race([Ci.onlineWaiter,bs(a&&a.maxRetryTimeout||Mi.maxRetryTimeout)]),k=Ci.networkState;const{data:W,headers:j}=await Kd(c,{data:I,cancelToken:s,headers:{"Content-Type":"multipart/form-data;"}},!0,!0);E=j.http3==="1"?1:-1,At.reportResourceTiming(c,m),GH(W,c,r,g,[Ri.CHOOSE_SERVER],E);const B=lT(W,Ri.CHOOSE_SERVER);return K2(B),U2(B,c)},W=>(W&&At.joinChooseServer(m,{role:b,lts:g,succ:!0,csAddr:c,opid:A,serverList:W.gatewayAddrs.map(j=>j.address),ec:null,cid:W.cid.toString(),uid:W.uid.toString(),csIp:W.csIp,unilbsServerIds:[Ri.CHOOSE_SERVER].toString(),isHttp3:E,corssRegionTagReq:r.apRequestDetail,corssRegionTagRes:W.res.detail&&W.res.detail[38]}),!1),W=>W.code!==te.OPERATION_ABORTED&&(W.code===te.CAN_NOT_GET_GATEWAY_SERVER?W.data.retry:(At.joinChooseServer(m,{role:b,lts:g,succ:!1,csAddr:c,serverList:null,opid:A,ec:W.code,csIp:W.data&&W.data.csIp,unilbsServerIds:[Ri.CHOOSE_SERVER].toString(),extend:JSON.stringify({networkState:k}),isHttp3:E,corssRegionTagReq:r.apRequestDetail}),x.warning("[".concat(h||"sid-".concat(m.slice(0,6)),"] Choose server network error, retry"),W),!0)),a)}function WH(t,r,s,a){let c,{url:d,areaCode:h,serviceIds:m}=t;const g=Date.now(),E=r.role,[b,I]=q2(r,h,m);let A;return zd(async()=>{A&&Ci.networkState===Tc.OFFLINE&&Ci.onlineWaiter&&await pt.race([Ci.onlineWaiter,bs(a&&a.maxRetryTimeout||Mi.maxRetryTimeout)]),A=Ci.networkState;const{data:k,headers:W}=await Kd(d,{data:b,cancelToken:s,headers:{"Content-Type":"multipart/form-data;"}},!0,!0);c=W.http3==="1"?1:-1,At.reportResourceTiming(d,r.sid),GH(k,d,r,g,m,c);const j=lT(k,Ri.CHOOSE_SERVER),B=lT(k,r.cloudProxyServer==="proxy5"?Ri.CLOUD_PROXY_5:r.cloudProxyServer==="proxy3"||r.cloudProxyServer==="proxy4"?Ri.CLOUD_PROXY:Ri.CLOUD_PROXY_FALLBACK),ee=performance.getEntriesByName(d),Z=ee[ee.length-1];let oe;return Z&&(oe={name:Z.name,protocol:"nextHopProtocol"in Z?Z.nextHopProtocol:"",dnscost:"domainLookupEnd"in Z&&"domainLookupStart"in Z&&typeof Z.domainLookupEnd=="number"&&typeof Z.domainLookupStart=="number"?Z.domainLookupEnd-Z.domainLookupStart:-1,tcpTlsCost:"connectEnd"in Z&&"connectStart"in Z&&typeof Z.connectEnd=="number"&&typeof Z.connectStart=="number"?Z.connectEnd-Z.connectStart:-1,reqCost:"requestStart"in Z&&typeof Z.requestStart=="number"&&"responseEnd"in Z&&typeof Z.responseEnd=="number"?Z.responseEnd-Z.requestStart:-1,handleCost:"leave_ts"in k&&"enter_ts"in k&&typeof k.leave_ts=="number"&&typeof k.enter_ts=="number"?k.leave_ts-k.enter_ts:-1}),K2(j),{gatewayInfo:U2(j,d),proxyInfo:B,url:d,resourceTimingInfo:oe}},k=>(k.gatewayInfo&&At.joinChooseServer(r.sid,{role:E,lts:g,succ:!0,csAddr:d,serverList:k.gatewayInfo.gatewayAddrs.map(W=>W.address),ec:null,opid:I,cid:k.gatewayInfo.cid.toString(),uid:k.gatewayInfo.uid.toString(),csIp:k.gatewayInfo.csIp,unilbsServerIds:m.toString(),isHttp3:c,corssRegionTagReq:r.apRequestDetail,corssRegionTagRes:k.gatewayInfo.res.detail&&k.gatewayInfo.res.detail[38],resourceTimingInfo:k.resourceTimingInfo?JSON.stringify(k.resourceTimingInfo):void 0}),k.proxyInfo&&At.joinWebProxyAP(r.sid,{lts:g,sucess:1,apServerAddr:d,turnServerAddrList:k.proxyInfo.addresses.map(W=>W.ip).join(","),errorCode:null,eventType:r.cloudProxyServer,unilbsServerIds:m.toString()}),!1),k=>k.code!==te.OPERATION_ABORTED&&(k.code===te.CAN_NOT_GET_GATEWAY_SERVER?k.data.retry:(At.joinWebProxyAP(r.sid,{lts:g,sucess:0,apServerAddr:d,turnServerAddrList:null,errorCode:k.code,eventType:r.cloudProxyServer,unilbsServerIds:m.toString(),extend:JSON.stringify({networkState:A})}),x.warning("[".concat(r.clientId,"] multi unilbs network error, retry"),k),!0)),a)}const GH=(t,r,s,a,c,d)=>{const{sid:h,clientId:m,cloudProxyServer:g}=s,E=[],b=I=>{I.flag===4096?At.joinChooseServer(h,{role:s.role,lts:a,succ:!1,csAddr:r,opid:t.opid,serverList:null,ec:I.error.message,csIp:I.error.data&&I.error.data.csIp,unilbsServerIds:c.toString(),isHttp3:d,corssRegionTagReq:s.apRequestDetail}):I.flag!==1048576&&I.flag!==4194304&&I.flag!==4194310||At.joinWebProxyAP(h,{lts:a,sucess:0,apServerAddr:r,turnServerAddrList:null,errorCode:I.error.code,eventType:g,unilbsServerIds:c.toString()})};if(t.response_body.forEach(I=>{const A=I.buffer.code;if(I.uri===23&&A===0&&!I.buffer.edges_services)if(I.buffer.flag===4194310)x.warning("no edge services in ap response of proxy fallback, will not set proxy in iceServers"),I.buffer.edges_services=[];else{const k={error:new Pe(te.CAN_NOT_GET_GATEWAY_SERVER,"no edge services in ap response",{retry:!0,csIp:t.detail[502]}),flag:I.buffer.flag};E.push(k),b(k)}if(A!==0){const k=a0(A),W={error:new Pe(te.CAN_NOT_GET_GATEWAY_SERVER,k.desc,{desc:k.desc,retry:k.retry,csIp:t.detail[502]}),flag:I.buffer.flag};I.buffer.flag===4194310?x.warning(W.error.toString()):E.push(W),b(W)}}),E.length)throw x.warning("[".concat(m||"sid-".concat(h.slice(0,6)),"] multi unilbs ").concat(r," failed, ").concat(E.map(I=>"flag: ".concat(I.flag,", message: ").concat(I.error.message,", retry: ").concat(I.error.data.retry)).join(" | "))),new Pe(te.CAN_NOT_GET_GATEWAY_SERVER,E.map(I=>"flag: ".concat(I.flag,", message: ").concat(I.error.message)).join(" | "),{retry:!!E.find(I=>I.error.data.retry),csIp:t.detail[502],desc:[...new Set(E.map(I=>{var A;return I==null||(A=I.error)===null||A===void 0||(A=A.data)===null||A===void 0?void 0:A.desc}).filter(I=>!!I))]})},K2=t=>{var r,s,a,c;if(t.addresses&&t.addresses.length===0&&t.code===0)throw new Pe(te.CAN_NOT_GET_GATEWAY_SERVER,"void gateway address",{retry:!0,csIp:t.detail&&t.detail[502]});if(se("AP_AREA")&&((a=t.detail)!==null&&a!==void 0&&a[23]&&typeof((c=t.detail)===null||c===void 0?void 0:c[23])=="string"?jH(t.detail[23].toLowerCase()):jH()),(r=t.detail)!==null&&r!==void 0&&r[19]&&typeof((s=t.detail)===null||s===void 0?void 0:s[19])=="string"){const h=t.detail[19],m=h==null?void 0:h.split(";");for(let g=0;g<m.length;g++){var d;const E=Ao(d=m[g]).call(d);t.addresses[g]&&m&&(t.addresses[g].fingerprint=E)}}if(se("GATEWAY_ADDRESS")&&se("GATEWAY_ADDRESS").length>0){x.debug("assign gateway address to",se("GATEWAY_ADDRESS"));const h=se("GATEWAY_ADDRESS").map(m=>{var g,E;const b=(g=(E=t.addresses.find(I=>I.ip===m.ip&&I.port===m.port))===null||E===void 0?void 0:E.fingerprint)!==null&&g!==void 0?g:"";return{ip:m.ip,port:m.port,ticket:t.addresses[0]&&t.addresses[0].ticket,fingerprint:b}});t.addresses=h}},d_e=(t,r)=>{if(t.response_body&&t.response_body.length){const s=t.response_body[0];if(s.buffer.code!==0){const a=a0(s.buffer.code);throw new Pe(te.UPDATE_TICKET_FAILED,"[".concat(s.buffer.code,"]: ").concat(a.desc),{retry:a.retry})}return s.buffer.ticket}throw x.debug("update ticket request received ap response without response body:",r),new Pe(te.UPDATE_TICKET_FAILED,"cannot find response body from ap response",{retry:!1})},q2=(t,r,s)=>{const a=Math.floor(Math.random()*1e12),c=t.role==="host"?"1":t.role==="audience"?"2":void 0,d={appid:t.appId,client_ts:Date.now(),opid:a,sid:t.sid,request_bodies:[{uri:22,buffer:{cname:t.cname,detail:Xh(Xh(Xh({6:t.stringUid,11:r,12:se("USE_NEW_TOKEN")?"1":void 0},c?{17:c}:{}),{},{22:r},t.apRequestDetail?{33:t.apRequestDetail}:{}),t.apRTM?{26:"RTM2"}:{}),key:t.token,service_ids:s,uid:t.uid||0}}]};d.request_bodies.forEach(m=>{t.multiIP&&t.multiIP.gateway_ip&&(m.buffer.detail[5]=JSON.stringify({vocs_ip:[t.multiIP.uni_lbs_ip],vos_ip:[t.multiIP.gateway_ip]}))});const h=new FormData;return h.append("request",JSON.stringify(d)),[h,a]},h_e=(t,r)=>{const s=Math.floor(Math.random()*1e12),a={appid:t.appId,client_ts:Date.now(),opid:s,sid:t.sid,request_bodies:[{uri:28,buffer:{cname:t.cname,detail:{1:"",6:t.stringUid,12:"1"},token:t.token,service_ids:r,uid:t.uid||0,edges_services:t.apResponse.addresses.map(d=>({ip:d.ip,port:d.port}))}}]},c=new FormData;return c.append("request",JSON.stringify(a)),[c,s]};let d0=0;function h0(t){return pt.all(t.map(r=>r.then(s=>{throw s},s=>s))).then(r=>{throw r},r=>r)}const fT=async t=>{let{fragementLength:r,referenceList:s,asyncMapHandler:a,allFailedhandler:c,promisesCollector:d}=t,h=0;const m=r;let g,E=0;const b=async()=>{const I=(()=>{const A=h*m,k=A+m;return s.slice(A,k).map(a)})();d&&d.push(...I);try{g=await h0(I)}catch(A){if(E+=m,h++,!(E>=s.length))return void await b();c(A)}I.forEach(A=>A.cancel())};return await b(),g},HH=async t=>{let{referenceList:r,asyncMapHandler:s,closeFn:a}=t;const c=r.length;let d=0;const h=async()=>{const m=s(r.shift());try{return await m}catch(g){if(d++,d>=c||a!=null&&a(g))throw g;return h()}};return h()};async function p_e(){if(typeof VideoDecoder>"u")return!0;let t;const r=[18,0,10,13,0,0,0,3,180,253,144,6,136,8,8,8,32,50,85,16,66,128,2,8,32,132,0,8,0,180,90,204,169,166,242,109,241,190,143,149,160,133,4,144,43,122,168,159,120,159,205,39,82,131,57,52,87,187,68,23,248,134,204,226,97,17,49,183,55,236,219,249,221,98,208,215,190,59,179,167,213,47,1,246,150,14,194,245,159,83,35,64,103,218,38,21,82,3,135,21,185,84,248,134],s=[18,0,10,13,0,0,0,3,180,253,144,6,136,8,8,8,32,50,87,16,66,128,2,8,32,132,0,8,0,180,90,204,169,166,242,109,241,190,143,148,62,134,140,92,172,141,77,35,94,181,164,65,169,65,156,154,43,221,162,11,252,67,102,113,48,136,137,219,62,43,113,239,23,126,250,186,252,10,138,218,25,193,244,74,68,194,209,107,23,52,206,199,78,72,98,103,151,71,96,62,51,210,158,72,231,158],a=[18,0,10,13,0,0,0,3,180,253,144,6,136,8,8,8,32,50,87,16,66,128,2,8,32,132,0,8,0,180,90,204,169,166,242,109,241,190,143,143,233,163,51,196,98,95,151,224,22,134,33,240,150,248,67,18,34,196,142,81,238,173,140,80,205,232,132,144,67,12,131,157,4,171,243,86,122,35,6,166,184,243,85,126,13,206,103,152,62,168,160,187,2,241,138,52,211,72,121,128,151,63,147,128,19,42],c=[18,0,50,138,1,48,192,64,253,248,65,17,67,192,32,0,16,0,0,0,0,0,0,0,195,12,48,144,64,32,0,209,75,61,9,204,25,115,79,226,115,63,63,208,70,210,220,153,126,241,237,37,107,195,153,1,99,112,230,189,209,169,130,10,11,22,167,215,159,205,197,7,183,162,26,48,254,141,134,103,32,16,235,45,1,15,18,119,169,110,206,251,51,115,202,60,148,1,46,39,109,25,28,86,168,15,77,211,239,2,58,43,146,26,230,184,81,48,140,226,226,250,222,146,171,133,164,13,188,180,64,122,142,146,32,208,238,170,193,35,53,44,225],d=[18,0,50,107,48,0,133,125,248,65,26,195,64,62,32,31,16,0,0,0,0,0,1,4,16,64,144,64,32,0,204,24,122,65,56,165,18,52,206,218,4,187,51,97,9,29,191,90,253,106,185,31,197,155,52,205,245,185,203,131,20,226,25,124,95,113,220,113,141,15,15,104,211,144,152,237,150,157,127,51,143,24,231,218,171,255,176,241,128,229,149,150,148,66,245,228,91,27,182,228,136,61,182,237,133,45,220,24,103,214,152],h=[18,0,50,122,48,1,9,253,248,65,26,67,64,62,32,31,16,0,0,0,0,0,1,4,16,64,144,64,32,0,198,182,231,242,220,235,163,140,12,36,36,166,46,132,210,4,71,23,218,132,27,30,17,45,244,79,31,243,195,136,100,169,76,88,142,85,204,217,121,168,29,163,198,17,251,223,73,12,212,244,139,123,151,179,75,216,96,208,136,40,229,42,59,149,10,116,228,85,99,93,221,108,255,140,248,20,30,167,122,109,206,164,108,197,110,251,23,243,133,160,63,13,207,177,12,128];return await new pt((g,E)=>{let b;(async function(){t&&t.state!=="closed"||await async function(){t=new VideoDecoder({output:A=>{A.close(),clearTimeout(b),g(!0)},error:A=>{clearTimeout(b),g(!1)}}),await t.configure({codec:"av01.0.05M.08",width:160,height:90})}();const I=[r,s,a,c,d,h];for(let A=0;A<I.length;A++){const k=new EncodedVideoChunk({type:A==0?"key":"delta",timestamp:33333*A,duration:33333,data:new Uint8Array(I[A])});try{await t.decode(k)}catch{return void g(!1)}}})(),b=setTimeout(()=>{g(!1)},5e3)})}async function Y2(t,r,s,a){return{gatewayInfo:await async function(d,h,m,g){let E=null;const b=[],I=async()=>{const k=se("WEBCS_DOMAIN").slice(0,se("AJAX_REQUEST_CONCURRENT")).map(B=>({url:d.proxyServer?"https://".concat(d.proxyServer,"/ap/?url=").concat(B+"/api/v2/transpond/webrtc?v=2"):"https://".concat(B,"/api/v2/transpond/webrtc?v=2"),areaCode:pT()})),W=g.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"chooseServer",urls:k.map(B=>B.url)}),j=await fT({fragementLength:se("FRAGEMENT_LENGTH"),referenceList:k,asyncMapHandler:B=>(x.debug("[".concat(d.clientId,"] Connect to choose_server:"),B.url),zH(B,d,h,m)),allFailedhandler:B=>{throw g.recordJoinChannelService({endTs:Date.now(),status:"error",errors:B},W),B[0]},promisesCollector:b});return g.recordJoinChannelService({endTs:Date.now(),status:"success"},W),j},A=async()=>{if(await bs(1e3),E!==null)return E;const k=se("WEBCS_DOMAIN_BACKUP_LIST").map(B=>({url:d.proxyServer?"https://".concat(d.proxyServer,"/ap/?url=").concat(B+"/api/v2/transpond/webrtc?v=2"):"https://".concat(B,"/api/v2/transpond/webrtc?v=2"),areaCode:pT()})),W=g.recordJoinChannelService({endTs:void 0,startTs:Date.now(),status:"pending",service:"chooseServer",urls:k.map(B=>B.url)}),j=await fT({fragementLength:se("FRAGEMENT_LENGTH"),referenceList:k,asyncMapHandler:B=>(x.debug("[".concat(d.clientId,"] Connect to backup choose_server:"),B.url),zH(B,d,h,m)),allFailedhandler:B=>{throw g.recordJoinChannelService({endTs:Date.now(),status:"error",errors:B},W),B[0]},promisesCollector:b});return g.recordJoinChannelService({endTs:Date.now(),status:"success"},W),j};try{return E=await h0([I(),A()]),b.length&&b.forEach(k=>k.cancel&&typeof k.cancel=="function"&&k.cancel()),E}catch(k){throw k[0]}}(t,r,s,a)}}async function $H(t,r,s,a,c){const d=t.cloudProxyServer;if(d==="disabled"){if(t.useLocalAccessPoint)return await Y2(t,r,s,c);if(se("JOIN_WITH_FALLBACK_MEDIA_PROXY")){const{gatewayInfo:A,proxyInfo:k}=await YH(t,r,s,c);if(t.turnServer&&t.turnServer.mode!=="auto")return{gatewayInfo:A};const W=k.map(j=>({turnServerURL:j.address,tcpport:j.tcpport||Us.tcpport,udpport:j.udpport||Us.udpport,username:j.username||Us.username,password:j.password||Us.password,forceturn:!1,security:!0}));if(c.useP2P){var h;const j=(h=t.uid)!==null&&h!==void 0?h:A.uid,B="glb:".concat(j.toString()),ee=await VL(B),Z=k.map(oe=>({turnServerURL:oe.address,tcpport:oe.tcpport||Us.tcpport,udpport:oe.udpport||Us.udpport,username:B,password:ee,forceturn:!1,security:!0}));W.push(...Z)}return t.turnServer={mode:"manual",servers:W},{gatewayInfo:A}}return await Y2(t,r,s,c)}const{proxyInfo:m,gatewayInfo:g}=await YH(t,r,s,c),E={gatewayInfo:g},b=m.map(A=>({turnServerURL:A.address,tcpport:d==="proxy3"?void 0:A.tcpport?A.tcpport:Us.tcpport,udpport:d==="proxy4"?void 0:A.udpport?A.udpport:Us.udpport,username:A.username||Us.username,password:A.password||Us.password,forceturn:d!=="proxy4",security:d==="proxy5"}));if(c.useP2P){var I;const A=(I=t.uid)!==null&&I!==void 0?I:g.uid,k="glb:".concat(A.toString()),W=await VL(k),j=m.map(B=>({turnServerURL:B.address,tcpport:d==="proxy3"?void 0:B.tcpport||Us.tcpport,udpport:d==="proxy4"?void 0:B.udpport||Us.udpport,username:k,password:W,forceturn:d!=="proxy4",security:d==="proxy5"}));b.push(...j)}return t.turnServer={mode:"manual",servers:b},x.debug("[".concat(t.clientId,"] set proxy server: ").concat(t.proxyServer,", mode: ").concat(d)),E}async function KH(t,r,s,a,c){const d=se("ACCOUNT_REGISTER").slice(0,se("AJAX_REQUEST_CONCURRENT"));let h=[];h=r.proxyServer?d.map(g=>"https://".concat(r.proxyServer,"/ap/?url=").concat(g+"/api/v1")):d.map(g=>"https://".concat(g,"/api/v1"));const m=c==null?void 0:c.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"stringUID",urls:h});try{const g=await async function(E,b,I,A,k){const W=Date.now(),j={sid:I.sid,opid:10,appid:I.appId,string_uid:b};let B=E[0];const ee=await zd(()=>Kd(B+"".concat(B.indexOf("?")===-1?"?":"&","action=stringuid"),{data:j,cancelToken:A,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":72}}),(Z,oe)=>{if(Z.code===0){if(Z.uid<=0||Z.uid>=Math.pow(2,32))throw x.error("Invalid Uint Uid ".concat(b," => ").concat(Z.uid),Z),At.reqUserAccount(j.sid,{lts:W,success:!1,serverAddr:B,stringUid:j.string_uid,uid:Z.uid,errorCode:te.INVALID_UINT_UID_FROM_STRING_UID,extend:j}),new Pe(te.INVALID_UINT_UID_FROM_STRING_UID);return At.reqUserAccount(j.sid,{lts:W,success:!0,serverAddr:B,stringUid:j.string_uid,uid:Z.uid,errorCode:null,extend:j}),!1}const ye=a0(Z.code);return ye.retry&&(B=E[(oe+1)%E.length]),At.reqUserAccount(j.sid,{lts:W,success:!1,serverAddr:B,stringUid:j.string_uid,uid:Z.uid,errorCode:ye.desc,extend:j}),ye.retry},(Z,oe)=>Z.code!==te.OPERATION_ABORTED&&(At.reqUserAccount(j.sid,{lts:W,success:!1,serverAddr:B,stringUid:j.string_uid,uid:null,errorCode:Z.code,extend:j}),B=E[(oe+1)%E.length],!0),k);if(ee.code!==0){const Z=a0(ee.code);throw new Pe(te.UNEXPECTED_RESPONSE,Z.desc)}return ee}(h,t,r,s,a);return c==null||c.recordJoinChannelService({status:"success",endTs:Date.now()},m),g.uid}catch(g){throw c==null||c.recordJoinChannelService({status:"error",endTs:Date.now(),errors:[g]},m),g}}async function f_e(t,r,s){const a=se("ACCOUNT_REGISTER");let c=[];c=r.proxyServer?a.map(d=>"https://".concat(r.proxyServer,"/ap/?url=").concat(d+"/api/v1")):a.map(d=>"https://".concat(d,"/api/v1"));try{return await HH({referenceList:c,asyncMapHandler:h=>async function(m,g,E,b){const I=Date.now(),A={sid:E.sid,opid:10,appid:E.appId,string_uid:g};try{const k=await Kd(m+"".concat(m.indexOf("?")===-1?"?":"&","action=stringuid"),{data:A,cancelToken:b,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":72}});if(k.code!==0){const W=a0(k.code);throw new Pe(te.UNEXPECTED_RESPONSE,"preload sua error:".concat(W.desc),W)}if(k.uid<=0||k.uid>=Math.pow(2,32))throw new Pe(te.INVALID_UINT_UID_FROM_STRING_UID);return{requestTime:I,url:m,req:A,uid:k.uid,elapse:Date.now()-I}}catch(k){throw k}}(h,t,r,s),closeFn:h=>h.code===te.OPERATION_ABORTED||h.code===te.UNEXPECTED_RESPONSE&&!h.data.retry})}catch(d){throw d}}async function m_e(t,r,s){const a=se("CDS_AP").slice(0,se("AJAX_REQUEST_CONCURRENT")).map(g=>t.proxyServer?"https://".concat(t.proxyServer,"/ap/?url=").concat(g+"/api/v1"):"https://".concat(g,"/api/v1?action=config")),c=a.map(g=>function(E,b,I,A){const k=xn(),W={flag:64,cipher_method:0,features:Xh(Xh(Xh(Xh(Xh({install_id:YL(),device:k.name,system:k.os,system_general:navigator.userAgent,vendor:b.appId,version:Bl,cname:b.cname,session_id:b.sid,proxyServer:b.proxyServer,sdk_type:s_e.WEB_RTC,browser_name:k.name,browser_version:k.version,user_agent:navigator.userAgent,channel_name:b.cname},b.stringUid&&{string_uid:b.stringUid}),b.uid&&{uid:b.uid+""}),k.os&&{os_name:k.os}),k.osVersion&&{os_version:k.osVersion}),{},{detail:""})};return zd(()=>Kd(E,{data:W,timeout:1e3,cancelToken:I,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":54}}),void 0,j=>j.code!==te.OPERATION_ABORTED,A)}(g,t,r,s));let d=null,h=null,m={};try{d=await h0(c)}catch(g){if(g.code===te.OPERATION_ABORTED)throw g;h=g}if(c.forEach(g=>g.cancel()),At.reportApiInvoke(t.sid,{name:di.REQUEST_CONFIG_DISTRIBUTE,options:{error:h,res:d}}).onSuccess(),d&&d.test_tags)try{m=function(g){if(!g.test_tags)return{};const E=g.test_tags,b=Object.keys(E),I={};return b.forEach(A=>{var k;const W=Ao(k=A.slice(4)).call(k),j=JSON.parse(E[A]),B=j[1];I[W]={tag:j[0]||"",value:B}}),I}(d)}catch{}return m}async function qH(t,r){const s=se("WEBCS_DOMAIN").concat(se("WEBCS_DOMAIN_BACKUP_LIST")).map(a=>({url:"https://".concat(a,"/api/v2/transpond/webrtc?v=2"),areaCode:pT(),serviceIds:[Ri.CHOOSE_SERVER,Ri.CLOUD_PROXY_FALLBACK]}));try{return await HH({referenceList:s,asyncMapHandler:c=>async function(d,h,m){let g,{url:E,areaCode:b,serviceIds:I}=d;const A=Date.now(),[k,W]=q2(h,b,I);let j=Ci.networkState;try{j&&Ci.networkState===Tc.OFFLINE&&Ci.onlineWaiter&&await pt.race([Ci.onlineWaiter,bs(Mi.maxRetryTimeout)]),j=Ci.networkState;const{data:B,headers:ee}=await Kd(E,{data:k,cancelToken:m,headers:{"Content-Type":"multipart/form-data;"}},!0,!0);g=ee.http3==="1"?1:-1,(_e=>{const ue=[];if(_e.response_body.forEach(Ce=>{const Ue=Ce.buffer.code;if(Ce.uri===23&&Ue===0&&!Ce.buffer.edges_services)if(Ce.buffer.flag===4194310)Ce.buffer.edges_services=[];else{const ze={error:new Pe(te.CAN_NOT_GET_GATEWAY_SERVER,"no edge services in ap response",{retry:!0,csIp:_e.detail[502]}),flag:Ce.buffer.flag};ue.push(ze)}if(Ue!==0){const ze=a0(Ue),Je={error:new Pe(te.CAN_NOT_GET_GATEWAY_SERVER,ze.desc,{desc:ze.desc,retry:ze.retry,csIp:_e.detail[502]}),flag:Ce.buffer.flag};Ce.buffer.flag===4194310?x.warning(Je.error.toString()):ue.push(Je)}}),ue.length)throw new Pe(te.CAN_NOT_GET_GATEWAY_SERVER,ue.map(Ce=>"flag: ".concat(Ce.flag,", message: ").concat(Ce.error.message)).join(" | "),{retry:!!ue.find(Ce=>Ce.error.data.retry),csIp:_e.detail[502],desc:[...new Set(ue.map(Ce=>{var Ue;return Ce==null||(Ue=Ce.error)===null||Ue===void 0||(Ue=Ue.data)===null||Ue===void 0?void 0:Ue.desc}).filter(Ce=>!!Ce))]})})(B);const oe=lT(B,Ri.CHOOSE_SERVER),ye=lT(B,Ri.CLOUD_PROXY_FALLBACK);return K2(oe),{gatewayInfo:U2(oe,E),proxyInfo:ye,opid:W,requestTime:A,url:E,isHttp3:g,elapse:Date.now()-A}}catch(B){throw B}}(c,t,r),closeFn:c=>c.code===te.OPERATION_ABORTED||c.code===te.CAN_NOT_GET_GATEWAY_SERVER&&!c.data.retry})}catch(a){throw a}}async function YH(t,r,s,a){const c=se("PROXY_SERVER_TYPE3"),d=(k,W,j)=>{let B=j||c;return Array.isArray(B)&&(B=W%2==0&&c[1]||c[0]),"https://".concat(B,"/ap/?url=").concat(k)};let h=null;const m=[],g=async()=>{const k=se("WEBCS_DOMAIN").slice(0,se("AJAX_REQUEST_CONCURRENT")).map((B,ee)=>{let Z;return Z=t.cloudProxyServer==="disabled"&&t.proxyServer?d("".concat(B,"/api/v2/transpond/webrtc?v=2"),ee,t.proxyServer):t.cloudProxyServer==="disabled"||t.cloudProxyServer==="fallback"?"https://".concat(B,"/api/v2/transpond/webrtc?v=2"):d("".concat(B,"/api/v2/transpond/webrtc?v=2"),ee),{url:Z,areaCode:pT(),serviceIds:[Ri.CHOOSE_SERVER,t.cloudProxyServer==="proxy5"?Ri.CLOUD_PROXY_5:t.cloudProxyServer==="proxy3"||t.cloudProxyServer==="proxy4"?Ri.CLOUD_PROXY:Ri.CLOUD_PROXY_FALLBACK]}}),W=a.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"chooseServer",urls:k.map(B=>B.url)}),j=await fT({fragementLength:se("FRAGEMENT_LENGTH"),referenceList:k,asyncMapHandler:B=>(x.debug("[".concat(t.clientId,"] Connect to choose_server:"),B.url),WH(B,t,r,s)),allFailedhandler:B=>{throw a.recordJoinChannelService({endTs:Date.now(),status:"error",errors:B},W),B[0]},promisesCollector:m});return a.recordJoinChannelService({endTs:Date.now(),status:"success"},W),j},E=async()=>{if(await bs(1e3),h!==null)return h;const k=se("WEBCS_DOMAIN_BACKUP_LIST").map((B,ee)=>{let Z;return Z=t.cloudProxyServer==="disabled"&&t.proxyServer?d("".concat(B,"/api/v2/transpond/webrtc?v=2"),ee,t.proxyServer):t.cloudProxyServer==="disabled"||t.cloudProxyServer==="fallback"?"https://".concat(B,"/api/v2/transpond/webrtc?v=2"):d("".concat(B,"/api/v2/transpond/webrtc?v=2"),ee),{url:Z,areaCode:pT(),serviceIds:[Ri.CHOOSE_SERVER,t.cloudProxyServer==="proxy5"?Ri.CLOUD_PROXY_5:t.cloudProxyServer==="proxy3"||t.cloudProxyServer==="proxy4"?Ri.CLOUD_PROXY:Ri.CLOUD_PROXY_FALLBACK]}}),W=a.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"chooseServer",urls:k.map(B=>B.url)}),j=await fT({fragementLength:se("FRAGEMENT_LENGTH"),referenceList:k,asyncMapHandler:B=>(x.debug("[".concat(t.clientId,"] Connect to backup choose_server:"),B.url),WH(B,t,r,s)),allFailedhandler:B=>{throw a.recordJoinChannelService({endTs:Date.now(),status:"error",errors:B},W),B[0]},promisesCollector:m});return a.recordJoinChannelService({endTs:Date.now(),status:"success"},W),j};let b,I,A;try{({gatewayInfo:b,proxyInfo:I,url:A}=await h0([g(),E()]))}catch(k){throw k[0]}if(m.length&&m.forEach(k=>k.cancel&&typeof k.cancel=="function"&&k.cancel()),!b||!I)throw new Pe(te.UNEXPECTED_ERROR,"missing gateway or proxy response").print();if(t.apUrl=A,t.cloudProxyServer!=="disabled"&&Array.isArray(c)&&A){const k=/^https?:\/\/(.+?)(\/.*)?$/.exec(A)[1];rt(c).call(c,k)&&(t.proxyServer=k,x.setProxyServer(k),At.setProxyServer(k))}return h={gatewayInfo:b,proxyInfo:await EH(I,b.uid)},h}async function g_e(t,r,s){const a=se("UAP_AP").slice(0,se("AJAX_REQUEST_CONCURRENT")).map(d=>t.proxyServer?"https://".concat(t.proxyServer,"/ap/?url=").concat(d+"/api/v1?action=uap"):"https://".concat(d,"/api/v1?action=uap")),c=a.map(d=>function(h,m,g,E){const b={command:"convergeAllocateEdge",sid:m.sid,appId:m.appId,token:m.token,ts:Date.now(),version:Bl,cname:m.cname,uid:m.uid.toString(),requestId:$2,seq:$2};$2+=1;const I={service_name:"tele_channel",json_body:JSON.stringify(b)};return zd(async()=>{const A=await Kd(h,{data:I,cancelToken:g,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":61}});if(A.code!==0){const W=new Pe(te.UNEXPECTED_RESPONSE,"cross channel ap error, code"+A.code,{retry:!0});throw x.error(W.toString()),W}const k=JSON.parse(A.json_body);if(k.code!==200){const W=new Pe(te.UNEXPECTED_RESPONSE,"cross channel app center error, code: ".concat(k.code,", reason: ").concat(k.reason));throw x.error(W.toString()),W}if(!k.servers||k.servers.length===0){const W=new Pe(te.UNEXPECTED_RESPONSE,"cross channel app center empty server");throw x.error(W.toString()),W}return{vid:k.vid,workerToken:k.workerToken,addressList:(se("CHANNEL_MEDIA_RELAY_SERVERS")||k.servers).map(W=>"wss://".concat(W.address.replace(/\./g,"-"),".").concat(se("WORKER_DOMAIN"),":").concat(W.wss))}},void 0,A=>!!(A.code!==te.OPERATION_ABORTED&&A.code!==te.UNEXPECTED_RESPONSE||A.data&&A.data.retry),E)}(d,t,r,s));try{const d=await h0(c);return c.forEach(h=>h.cancel()),d}catch(d){throw d[0]}}async function __e(t,r,s){let a=null;const c=[],d=async h=>{const m=se(h?"WEBCS_DOMAIN_BACKUP_LIST":"WEBCS_DOMAIN").map(g=>t.proxyServer?"https://".concat(t.proxyServer,"/ap/?url=").concat(g+"/api/v2/transpond/webrtc?v=2"):"https://".concat(g,"/api/v2/transpond/webrtc?v=2"));return h&&(await bs(1e3),a!==null)?a:await fT({fragementLength:se("FRAGEMENT_LENGTH"),referenceList:m,asyncMapHandler:g=>(x.debug("[".concat(t.clientId,"] update ticket, Connect to ").concat(h?"backup":""," choose_server:"),g),function(E,b,I,A){const[k]=h_e(b,[Ri.CHOOSE_SERVER]);let W=Ci.networkState;return zd(async()=>{W&&Ci.networkState===Tc.OFFLINE&&Ci.onlineWaiter&&await pt.race([Ci.onlineWaiter,bs(A&&A.maxRetryTimeout||Mi.maxRetryTimeout)]),W=Ci.networkState;const j=await Kd(E,{data:k,cancelToken:I,headers:{"Content-Type":"multipart/form-data;"}},!0);return d_e(j,E)},()=>!1,j=>j.code!==te.OPERATION_ABORTED&&(j.code===te.UPDATE_TICKET_FAILED?j.data.retry:(x.warning("[".concat(b.clientId,"] update ticket network error, retry"),j),!0)),A)}(g,t,r,s)),allFailedhandler:g=>{throw g[0]},promisesCollector:c})};try{return a=await h0([d(!1),d(!0)]),c.length&&c.forEach(h=>h.cancel&&typeof h.cancel=="function"&&h.cancel()),a}catch(h){throw h[0]}}function XH(t,r){var s=Object.keys(t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);r&&(a=a.filter(function(c){return Object.getOwnPropertyDescriptor(t,c).enumerable})),s.push.apply(s,a)}return s}function X2(t){for(var r=1;r<arguments.length;r++){var s=arguments[r]!=null?arguments[r]:{};r%2?XH(Object(s),!0).forEach(function(a){Y(t,a,s[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(s)):XH(Object(s)).forEach(function(a){Object.defineProperty(t,a,Object.getOwnPropertyDescriptor(s,a))})}return t}class y_e extends Jr{get isSuccess(){return!!this.configs}constructor(r,s){super(),Y(this,"configs",void 0),Y(this,"store",void 0),Y(this,"joinInfo",void 0),Y(this,"cancelToken",void 0),Y(this,"retryConfig",{timeout:3e3,timeoutFactor:1.5,maxRetryCount:1,maxRetryTimeout:1e4}),Y(this,"interval",void 0),Y(this,"mutex",void 0),Y(this,"mutableParamsRead",!1),Y(this,"configCache",{}),Y(this,"limit_bitrate",void 0),this.mutex=new Ys("config-distribute",r),this.store=s}startGetConfigDistribute(r,s){this.joinInfo=r,this.cancelToken=s,this.interval&&this.stopGetConfigDistribute(),se("ENABLE_CONFIG_DISTRIBUTE")&&(this.updateConfigDistribute(),this.interval=window.setInterval(()=>{this.updateConfigDistribute()},se("CONFIG_DISTRIBUTE_INTERVAL")))}stopGetConfigDistribute(){this.interval&&clearInterval(this.interval),this.interval=void 0,this.joinInfo=void 0,this.cancelToken=void 0,this.configs=void 0,this.limit_bitrate=void 0}async awaitConfigDistributeComplete(){this.mutex.isLocked&&(await this.mutex.lock())()}async updateConfigDistribute(){if(this.mutableParamsRead||(this.mutableParamsRead=!0,At.reportApiInvoke(null,{options:void 0,name:di.LOAD_CONFIG_FROM_LOCALSTORAGE,tag:$r.TRACER}).onSuccess(JSON.stringify(Wd))),!this.joinInfo||!this.cancelToken||!this.retryConfig)return void x.debug("[config-distribute] get config distribute interrupted have no joininfo");let r;const s=await this.mutex.lock();try{r=await m_e(this.joinInfo,this.cancelToken,this.retryConfig),x.debug("[config-distribute] get config distribute",JSON.stringify(r));const a=function(c){var d;const h=G_(d=Object.keys(c).filter(E=>/^webrtc_ng_global_parameter/.test(E))).call(d);for(let E=0;E<h.length;E++)for(let b=h.length-1;b>E;b--){const I=h[b],A=c[I].value;if(typeof A.__priority=="number"){const k=A.__priority,W=h[b-1],j=c[W].value;if(typeof j.__priority=="number"){if(!(k>j.__priority))continue;{const B=I;h[b]=h[b-1],h[b-1]=B}}else{const B=I;h[b]=h[b-1],h[b-1]=B}}}const m=Date.now();let g={};return h.forEach(E=>{const b=c[E].value.__expires;b&&b<=m||(g[E]=c[E])}),g}(r);this.cacheGlobalParameterConfig(a),this.store.hasStartJoinChannel||(this.store.isABTestSuccess=!0),this.configs=a}catch(a){const c=new Pe(te.NETWORK_RESPONSE_ERROR,a);x.warning("[config-distribute] ".concat(c.toString()))}finally{s()}}getBitrateLimit(){return this.limit_bitrate||void 0}handleBitrateLimit(r){cH(r)&&(this.limit_bitrate?this.limit_bitrate&&this.limit_bitrate.id!==r.id&&this.emit(oT.UPDATE_BITRATE_LIMIT,r):this.emit(oT.UPDATE_BITRATE_LIMIT,r))}getLowStreamConfigDistribute(){return this.limit_bitrate&&X2({},this.limit_bitrate.low_stream_uplink)}handleABTestConfigDistribute(r){try{const s={},a=Object.keys(r),c=[];a.forEach(d=>{const h=r[d].value;s[d]=h;const m=h.__id;if(m&&this.configCache[d]&&this.configCache[d].__id===m)return;const g=h.__type,E=r[d].value,b=r[d].tag;let I=0;g?g===NW.REALTIME&&(I=1):Object.keys(E).some(A=>Object.prototype.hasOwnProperty.call(ZL,A)||!R2()&&Object.prototype.hasOwnProperty.call(EP,A)?(I=1,!0):void 0),c.push({tag:b,isApplied:I,feature:d,params:JSON.stringify(h)})}),c.forEach(d=>{let{tag:h,feature:m,params:g,isApplied:E}=d;this.store.sessionId&&At.abTest(this.store.sessionId,{intSucc:1,isApplied:E,tag:h,feature:m,params:g,cid:this.store.cid,uid:this.store.intUid})}),this.configCache=s}catch(s){x.debug("handleABTestConfigDistribute error",s)}}cacheGlobalParameterConfig(r){const s=function(c){const d={};return Object.keys(c).forEach(h=>{const m=c[h].value,g=m.__expires,E=m.__type;Object.keys(m).forEach(b=>{b==="__id"||b==="__type"||b==="__priority"||b==="__expires"||Object.prototype.hasOwnProperty.call(d,b)||(d[b]=X2(X2({value:m[b]},g&&{expires:g}),E&&{type:E}))})}),d}(r);try{var a;const c=(a=s.LIMIT_BITRATE)===null||a===void 0?void 0:a.value;delete s.LIMIT_BITRATE,c&&cH(c)&&this.handleBitrateLimit(c),this.limit_bitrate=c,this.handleGlobalParameterConfig(s),this.handleABTestConfigDistribute(r),function(m){try{const g=Date.now();Object.keys(m).forEach(E=>{const{value:b,type:I,expires:A}=m[E];A&&A<=g||((I===NW.REALTIME||Object.prototype.hasOwnProperty.call(ZL,E))&&(Wd[E]=b,zr[E]=b,x.debug("Update realtime parameters from config distribute",E,b)),I||R2()||!Object.prototype.hasOwnProperty.call(EP,E)||(Wd[E]=b,zr[E]=b,x.debug("Update gateway parameters from config distribute",E,b)))})}catch(g){x.error("Error update config immediately: ".concat(m),g.message)}}(s);const d=JSON.stringify(s),h=window.btoa(d);window.localStorage.setItem("websdk_ng_global_parameter",h),x.debug("Caching global parameters ".concat(d))}catch(c){x.error("Error caching global parameters:",c.message)}}handleGlobalParameterConfig(r){try{const s=Date.now();Object.keys(r).forEach(a=>{if(a==="CLIENT_ROLE_OPTIONS"&&Object.prototype.hasOwnProperty.call(zr,a)){const{value:c,expires:d}=r[a];if(d&&d<=s)return;(function(h,m){try{return typeof h=="object"&&typeof m=="object"&&JSON.stringify(h)===JSON.stringify(m)}catch{return!1}})(zr[a],c)||(Wd[a]=c,zr[a]=c,this.emit(oT.UPDATE_CLIENT_ROLE_OPTIONS,c),x.debug("Updating client role options: ".concat(JSON.stringify(c))))}})}catch(s){x.error("Error handling global parameter config:",s.message)}}}class E_e extends Jr{constructor(){super(...arguments),Y(this,"resultStorage",new Map)}setLocalAudioStats(r,s,a){this.record("AUDIO_INPUT_LEVEL_TOO_LOW",r,this.checkAudioInputLevel(a,s)),this.record("SEND_AUDIO_BITRATE_TOO_LOW",r,this.checkSendAudioBitrate(a,s))}setLocalVideoStats(r,s,a){this.record("SEND_VIDEO_BITRATE_TOO_LOW",r,this.checkSendVideoBitrate(a,s)),this.record("FRAMERATE_INPUT_TOO_LOW",r,this.checkFramerateInput(a,s)),this.record("FRAMERATE_SENT_TOO_LOW",r,this.checkFramerateSent(a)),!s.muted&&this.record("VIDEO_ENCODE_FAILED",r,this.checResolutionSent(a))}setRemoteAudioStats(r,s){const a=r.getUserId();this.record("AUDIO_OUTPUT_LEVEL_TOO_LOW",a,this.checkAudioOutputLevel(s))}setRemoteVideoStats(r,s){const a=r.getUserId();this.record("RECV_VIDEO_DECODE_FAILED",a,this.checkVideoDecode(s))}record(r,s,a){if(se("STATS_UPDATE_INTERVAL")>500)return;this.resultStorage.has(r)||this.resultStorage.set(r,{result:[],isPrevNormal:!0});const c=this.resultStorage.get(r);if(!c)return;c.result.push(a);const d=r==="VIDEO_ENCODE_FAILED"?se("ENCODE_EXCEPTION_TIMES"):5;if(c.result.length>=d){var h;const m=rt(h=c.result).call(h,!0);c.isPrevNormal&&!m&&this.emit("exception",J2[r],r,s),!c.isPrevNormal&&m&&this.emit("exception",J2[r]+2e3,r+"_RECOVER",s),c.isPrevNormal=m,c.result=[]}}checkAudioOutputLevel(r){return!(r.receiveBitrate>0&&r.receiveLevel===0)}checkAudioInputLevel(r,s){return s instanceof zi&&!s.isActive||!!s.muted||r.sendVolumeLevel!==0}checkFramerateInput(r,s){let a=null;s._encoderConfig&&s._encoderConfig.frameRate&&(a=Cc(s._encoderConfig.frameRate));const c=r.captureFrameRate;return!a||!c||!(a>10&&c<5||a<10&&a>=5&&c<=1)}checkFramerateSent(r){return!(r.captureFrameRate&&r.sendFrameRate&&r.captureFrameRate>5&&r.sendFrameRate<=1)}checResolutionSent(r){var s;return!(!r.codecType||rt(s=se("ENCODE_EXCEPTION_VALIDATE_CODEC")).call(s,r.codecType.toLocaleLowerCase()))||!r.captureFrameRate||r.sendFrameRate!==0||r.sendResolutionWidth!==0||r.sendResolutionHeight!==0}checkSendVideoBitrate(r,s){return!!s.muted||r.sendBitrate!==0}checkSendAudioBitrate(r,s){return s instanceof zi&&!s.isActive||!!s.muted||r.sendBitrate!==0}checkVideoDecode(r){return r.receiveBitrate===0||r.decodeFrameRate!==0}}const J2={FRAMERATE_INPUT_TOO_LOW:1001,FRAMERATE_SENT_TOO_LOW:1002,SEND_VIDEO_BITRATE_TOO_LOW:1003,RECV_VIDEO_DECODE_FAILED:1005,AUDIO_INPUT_LEVEL_TOO_LOW:2001,AUDIO_OUTPUT_LEVEL_TOO_LOW:2002,SEND_AUDIO_BITRATE_TOO_LOW:2003,VIDEO_ENCODE_FAILED:2004},Zs=new class{markSubscribeStart(t,r){performance.mark("agora-web-sdk/".concat(t,"/subscribe-").concat(r))}markPublishStart(t,r){performance.mark("agora-web-sdk/".concat(t,"/publish-").concat(r))}measureFromSubscribeStart(t,r){const s=performance.getEntriesByName("agora-web-sdk/".concat(t,"/subscribe-").concat(r));if(s.length>0){const a=s[s.length-1];return Math.round(performance.now()-a.startTime)}return 0}measureFromPublishStart(t,r){const s=performance.getEntriesByName("agora-web-sdk/".concat(t,"/publish-").concat(r));if(s.length>0){const a=s[s.length-1];return Math.round(performance.now()-a.startTime)}return 0}};function JH(t,r){var s=Object.keys(t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);r&&(a=a.filter(function(c){return Object.getOwnPropertyDescriptor(t,c).enumerable})),s.push.apply(s,a)}return s}function dy(t){for(var r=1;r<arguments.length;r++){var s=arguments[r]!=null?arguments[r]:{};r%2?JH(Object(s),!0).forEach(function(a){Y(t,a,s[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(s)):JH(Object(s)).forEach(function(a){Object.defineProperty(t,a,Object.getOwnPropertyDescriptor(s,a))})}return t}class mT{constructor(r){Y(this,"store",void 0),Y(this,"onStatsException",void 0),Y(this,"onUploadPublishDuration",void 0),Y(this,"onStatsChanged",void 0),Y(this,"onVideoCodecChanged",void 0),Y(this,"localStats",new Map),Y(this,"remoteStats",new Map),Y(this,"updateStatsInterval",void 0),Y(this,"trafficStats",void 0),Y(this,"trafficStatsPeerList",[]),Y(this,"uplinkStats",void 0),Y(this,"exceptionMonitor",void 0),Y(this,"p2pChannel",void 0),Y(this,"scalabilityMode",yP.L1T1),Y(this,"updateStats",()=>{this.p2pChannel&&(this.updateRemoteStats(this.p2pChannel),this.updateLocalStats(this.p2pChannel))}),this.store=r,this.exceptionMonitor=new E_e,this.exceptionMonitor.on("exception",(s,a,c)=>{this.onStatsException&&this.onStatsException(s,a,c)})}startUpdateStats(){this.updateStatsInterval||(this.updateStatsInterval=window.setInterval(this.updateStats,1e3))}stopUpdateStats(){this.updateStatsInterval&&(window.clearInterval(this.updateStatsInterval),this.updateStatsInterval=void 0)}reset(){this.localStats=new Map,this.remoteStats=new Map,this.trafficStats=void 0,this.trafficStatsPeerList=[],this.uplinkStats=void 0}getLocalAudioTrackStats(){return this.localStats.get(qe.LocalAudioTrack)||dy({},s2)}getLocalVideoTrackStats(){return this.localStats.get(qe.LocalVideoTrack)||dy({},o2)}getRemoteAudioTrackStats(r){const s=(d,h)=>{if(!this.trafficStats)return h;const m=this.trafficStats.peer_delay.find(g=>g.peer_uid===d);return m&&(h.publishDuration=m.B_ppad+(Date.now()-this.trafficStats.timestamp)),h},a={};if(r){var c;const d=(c=this.remoteStats.get(r))===null||c===void 0?void 0:c.audioStats;d&&(a[r]=s(r,d))}else Array.from(this.remoteStats.entries()).forEach(d=>{let[h,{audioStats:m}]=d;m&&(a[h]=s(h,m))});return a}getRemoteNetworkQualityStats(r){const s={};if(r){var a;const c=(a=this.remoteStats.get(r))===null||a===void 0?void 0:a.networkStats;c&&(s[r]=c)}else Array.from(this.remoteStats.entries()).forEach(c=>{let[d,{networkStats:h}]=c;h&&(s[d]=h)});return s}getRemoteVideoTrackStats(r){const s=(d,h)=>{if(!this.trafficStats)return h;const m=this.trafficStats.peer_delay.find(g=>g.peer_uid===d);return m&&(h.publishDuration=m.B_ppvd+(Date.now()-this.trafficStats.timestamp)),h},a={};if(r){var c;const d=(c=this.remoteStats.get(r))===null||c===void 0?void 0:c.videoStats;d&&(a[r]=s(r,d))}else Array.from(this.remoteStats.entries()).forEach(d=>{let[h,{videoStats:m}]=d;m&&(a[h]=s(h,m))});return a}getRTCStats(){let r=0,s=0,a=0,c=0;const d=this.localStats.get(qe.LocalAudioTrack);d&&(r+=d.sendBytes,s+=d.sendBitrate);const h=this.localStats.get(qe.LocalVideoTrack);h&&(r+=h.sendBytes,s+=h.sendBitrate);const m=this.localStats.get(qe.LocalVideoLowTrack);m&&(r+=m.sendBytes,s+=m.sendBitrate),this.remoteStats.forEach(E=>{let{audioStats:b,videoStats:I}=E;b&&(a+=b.receiveBytes,c+=b.receiveBitrate),I&&(a+=I.receiveBytes,c+=I.receiveBitrate)});let g=1;return this.trafficStats&&(g+=this.trafficStats.peer_delay.length),{Duration:0,UserCount:g,SendBitrate:s,SendBytes:r,RecvBytes:a,RecvBitrate:c,OutgoingAvailableBandwidth:this.uplinkStats?this.uplinkStats.B_uab/1e3:0,RTT:this.trafficStats?2*this.trafficStats.B_acd:0}}addLocalStats(r){this.localStats.set(r,void 0)}removeLocalStats(r){r?this.localStats.delete(r):this.localStats.clear()}addRemoteStats(r){this.remoteStats.set(r,{})}removeRemoteStats(r){r?this.remoteStats.delete(r):this.remoteStats.clear()}addP2PChannel(r){this.p2pChannel=r}updateTrafficStats(r){r.peer_delay=r.peer_delay.filter(s=>s.B_ppad!==void 0||s.B_ppvd!==void 0),r.peer_delay.filter(s=>this.trafficStatsPeerList.indexOf(s.peer_uid)===-1).forEach(s=>{var a;const c=(a=this.p2pChannel)===null||a===void 0?void 0:a.getRemoteMedia(s.peer_uid),d=c!=null&&c.videoSSRC?Zs.measureFromSubscribeStart(this.store.clientId,c.videoSSRC):0,h=c!=null&&c.audioSSRC?Zs.measureFromSubscribeStart(this.store.clientId,c.audioSSRC):0;s.B_ppad!==void 0&&s.B_ppvd!==void 0&&(this.onUploadPublishDuration&&this.onUploadPublishDuration(s.peer_uid,s.B_ppad,s.B_ppvd,d>h?d:h),this.trafficStatsPeerList.push(s.peer_uid))}),this.trafficStats=r}updateUplinkStats(r){this.uplinkStats&&this.uplinkStats.B_fir!==r.B_fir&&x.debug("[".concat(this.store.clientId,"]: Period fir changes to ").concat(r.B_fir)),this.uplinkStats=r}static isRemoteVideoFreeze(r,s,a){if(!r)return!1;const c=!!a&&s.framesDecodeFreezeTime>a.framesDecodeFreezeTime,d=!a||s.framesDecodeCount>a.framesDecodeCount;return c||!d}static isRemoteAudioFreeze(r){return!!r&&r._isFreeze()}isLocalVideoFreeze(r){return!(!r.inputFrame||!r.sentFrame)&&r.inputFrame.frameRate>5&&r.sentFrame.frameRate<3}updateLocalStats(r){Array.from(this.localStats.entries()).forEach(s=>{let[a,c]=s;switch(a){case qe.LocalVideoTrack:case qe.LocalVideoLowTrack:{const m=c,g=dy({},o2),E=r.getStats(),b=r.getLocalMedia(a);if(E){const I=E.videoSend.find(A=>A.ssrc===(b==null?void 0:b.ssrcs[0].ssrcId));if(I){const A=r.getLocalVideoSize(),k=r.getEncoderConfig(qe.LocalVideoTrack);var d;(I.codec==="H264"||I.codec==="H265"||I.codec==="VP8"||I.codec==="VP9"||I.codec==="AV1X"||I.codec==="AV1")&&(g.codecType=I.codec,(m==null?void 0:m.codecType)!==I.codec&&((d=this.onVideoCodecChanged)===null||d===void 0||d.call(this,I.codec.toLocaleLowerCase()))),g.sendBytes=I.bytes,g.sendBitrate=m?8*Math.max(0,g.sendBytes-m.sendBytes):0,I.inputFrame?(g.captureFrameRate=I.inputFrame.frameRate,g.captureResolutionHeight=I.inputFrame.height,g.captureResolutionWidth=I.inputFrame.width):A&&(g.captureResolutionWidth=A.width,g.captureResolutionHeight=A.height),I.sentFrame?(g.sendFrameRate=I.sentFrame.frameRate,g.sendResolutionHeight=I.sentFrame.height,g.sendResolutionWidth=I.sentFrame.width):A&&(g.sendResolutionWidth=A.width,g.sendResolutionHeight=A.height),I.avgEncodeMs&&(g.encodeDelay=I.avgEncodeMs),k&&k.bitrateMax?g.targetSendBitrate=1e3*k.bitrateMax:I.targetBitrate&&(g.targetSendBitrate=I.targetBitrate),g.sendPackets=I.packets,g.sendPacketsLost=I.packetsLost,g.sendJitterMs=I.jitterMs,g.sendRttMs=I.rttMs,g.totalDuration=m?m.totalDuration+1:1,g.totalFreezeTime=m?m.totalFreezeTime:0,this.isLocalVideoFreeze(I)&&(g.totalFreezeTime+=1),I.scalabilityMode&&this.scalabilityMode!==I.scalabilityMode&&(x.debug("[".concat(this.store.clientId,"]: The scalabilityMode of the video sending stream is ").concat(I.scalabilityMode)),this.scalabilityMode=I.scalabilityMode)}this.trafficStats&&(g.currentPacketLossRate=(this.trafficStats.B_pvlr4||0)/100)}var h;this.localStats.set(a,g),((m==null?void 0:m.sendResolutionWidth)!==g.sendResolutionWidth||(m==null?void 0:m.sendResolutionHeight)!==g.sendResolutionHeight)&&((h=this.onStatsChanged)===null||h===void 0||h.call(this,"resolution",{width:g.sendResolutionWidth,height:g.sendResolutionHeight})),g&&b&&this.exceptionMonitor.setLocalVideoStats(this.store.uid,b.track,g);break}case qe.LocalAudioTrack:{const m=c,g=dy({},s2),E=r.getStats(),b=r.getLocalMedia(a);if(E){const I=E.audioSend.find(A=>A.ssrc===(b==null?void 0:b.ssrcs[0].ssrcId));if(I){if(I.codec!=="opus"&&I.codec!=="aac"&&I.codec!=="PCMU"&&I.codec!=="PCMA"&&I.codec!=="G722"||(g.codecType=I.codec),I.inputLevel)g.sendVolumeLevel=Math.round(32767*I.inputLevel);else{const A=r.getLocalAudioVolume();A&&(g.sendVolumeLevel=Math.round(32767*A))}g.sendBytes=I.bytes,g.sendPackets=I.packets,g.sendPacketsLost=I.packetsLost,g.sendJitterMs=I.jitterMs,g.sendRttMs=I.rttMs,g.sendBitrate=m?8*Math.max(0,g.sendBytes-m.sendBytes):0}}this.trafficStats&&(g.currentPacketLossRate=(this.trafficStats.B_palr4||0)/100),this.localStats.set(qe.LocalAudioTrack,g),g&&b&&this.exceptionMonitor.setLocalAudioStats(this.store.uid,b.track,g);break}}})}updateRemoteStats(r){Array.from(this.remoteStats.entries()).forEach(s=>{var a,c;let[d,{videoStats:h,audioStats:m,videoPcStats:g}]=s;const E=m,b=h,I=g,A=dy({},WW),k=dy({},GW),W=dy({},nge),{audioTrack:j,videoTrack:B,audioSSRC:ee,videoSSRC:Z}=r.getRemoteMedia(d);let oe;oe=this.store.useP2P?r.getStats(!0):r.getStats();const ye=(a=oe)===null||a===void 0?void 0:a.audioRecv.find(Ue=>Ue.ssrc===ee),_e=(c=oe)===null||c===void 0?void 0:c.videoRecv.find(Ue=>Ue.ssrc===Z),ue=this.trafficStats&&this.trafficStats.peer_delay.find(Ue=>Ue.peer_uid===d);if(ye&&(ye.codec!=="opus"&&ye.codec!=="aac"&&ye.codec!=="PCMU"&&ye.codec!=="PCMA"&&ye.codec!=="G722"||(A.codecType=ye.codec),ye.outputLevel?A.receiveLevel=Math.round(32767*ye.outputLevel):j&&(A.receiveLevel=Math.round(32767*j.getVolumeLevel())),A.receiveBytes=ye.bytes,A.receivePackets=ye.packets,A.receivePacketsLost=ye.packetsLost,A.receivePacketsDiscarded=ye.packetsDiscarded,A.packetLossRate=A.receivePacketsLost/(A.receivePackets+A.receivePacketsLost),A.receiveBitrate=E?8*Math.max(0,A.receiveBytes-E.receiveBytes):0,A.totalDuration=E?E.totalDuration+1:1,A.totalFreezeTime=E?E.totalFreezeTime:0,A.freezeRate=A.totalFreezeTime/A.totalDuration,A.receiveDelay=ye.jitterBufferMs,A.totalDuration>10&&mT.isRemoteAudioFreeze(j)&&(A.totalFreezeTime+=1)),_e){var Ce;_e.codec!=="H264"&&_e.codec!=="H265"&&_e.codec!=="VP8"&&_e.codec!=="VP9"&&_e.codec!=="AV1X"&&_e.codec!=="AV1"||(k.codecType=_e.codec),k.receiveBytes=_e.bytes,k.receiveBitrate=b?8*Math.max(0,k.receiveBytes-b.receiveBytes):0,k.decodeFrameRate=_e.decodeFrameRate<0?0:_e.decodeFrameRate,k.renderFrameRate=_e.decodeFrameRate<0?0:_e.decodeFrameRate,_e.outputFrame&&(k.renderFrameRate=_e.outputFrame.frameRate),_e.receivedFrame?(k.receiveFrameRate=_e.receivedFrame.frameRate,k.receiveResolutionHeight=_e.receivedFrame.height,k.receiveResolutionWidth=_e.receivedFrame.width):B&&(k.receiveResolutionHeight=B._videoHeight||0,k.receiveResolutionWidth=B._videoWidth||0),_e.framesRateFirefox!==void 0&&(k.receiveFrameRate=Math.round(_e.framesRateFirefox)),k.receivePackets=_e.packets,k.receivePacketsLost=_e.packetsLost,k.packetLossRate=k.receivePacketsLost/(k.receivePackets+k.receivePacketsLost);const Ue=b?b.totalFreezeTime:0,ze=b?b.totalDuration:0;k.totalDuration=b?b.totalDuration+1:1,k.totalFreezeTime=(Ce=_e.totalFreezesDuration)!==null&&Ce!==void 0?Ce:Ue||0,k.receiveDelay=_e.jitterBufferMs||0;const Je=!!Z&&r.getRemoteVideoIsReady(Z);_e.totalFreezesDuration===void 0&&B&&Je&&mT.isRemoteVideoFreeze(B,_e,I)&&(k.totalFreezeTime+=1),k.freezeRate=Math.max(0,Math.min((k.totalFreezeTime-Ue)/(k.totalDuration-ze),1))}ue&&(A.end2EndDelay=ue.B_ad,k.end2EndDelay=ue.B_vd,A.transportDelay=ue.B_ed,k.transportDelay=ue.B_ed,A.currentPacketLossRate=ue.B_ealr4/100,k.currentPacketLossRate=ue.B_evlr4/100,W.uplinkNetworkQuality=ue.B_punq?ue.B_punq:0,W.downlinkNetworkQuality=ue.B_pdnq?ue.B_pdnq:0),this.remoteStats.set(d,{audioStats:A,videoStats:k,videoPcStats:_e,networkStats:W}),j&&this.exceptionMonitor.setRemoteAudioStats(j,A),B&&this.exceptionMonitor.setRemoteVideoStats(B,k)})}}class QH{constructor(){Y(this,"destChannelMediaInfos",new Map),Y(this,"srcChannelMediaInfo",void 0)}setSrcChannelInfo(r){oH(r),this.srcChannelMediaInfo=r}addDestChannelInfo(r){oH(r),this.destChannelMediaInfos.set(r.channelName,r)}removeDestChannelInfo(r){VP(r),this.destChannelMediaInfos.delete(r)}getSrcChannelMediaInfo(){return this.srcChannelMediaInfo}getDestChannelMediaInfo(){return this.destChannelMediaInfos}}function ZH(t){if(!(t instanceof QH))return new Pe(te.INVALID_PARAMS,"Config should be instance of [ChannelMediaRelayConfiguration]").throw();const r=t.getSrcChannelMediaInfo(),s=t.getDestChannelMediaInfo();if(!r)return new Pe(te.INVALID_PARAMS,"srcChannelMediaInfo should not be empty").throw();if(s.size===0)return new Pe(te.INVALID_PARAMS,"destChannelMediaInfo should not be empty").throw()}class tg{get hasVideo(){return this._video_enabled_&&!this._video_muted_&&this._video_added_}get hasAudio(){return this._audio_enabled_&&!this._audio_muted_&&this._audio_added_}get audioTrack(){if(this.hasAudio||this._audio_pre_subscribed)return this._audioTrack}get videoTrack(){if(this.hasVideo||this._video_pre_subscribed)return this._videoTrack}get dataChannels(){return this._dataChannels}constructor(r,s){Y(this,"uid",void 0),Y(this,"_uintid",void 0),Y(this,"_trust_in_room_",!0),Y(this,"_trust_audio_enabled_state_",!0),Y(this,"_trust_video_enabled_state_",!0),Y(this,"_trust_audio_mute_state_",!0),Y(this,"_trust_video_mute_state_",!0),Y(this,"_audio_muted_",!1),Y(this,"_video_muted_",!1),Y(this,"_audio_enabled_",!0),Y(this,"_video_enabled_",!0),Y(this,"_audio_added_",!1),Y(this,"_video_added_",!1),Y(this,"_is_pre_created",!1),Y(this,"_video_pre_subscribed",!1),Y(this,"_audio_pre_subscribed",!1),Y(this,"_trust_video_stream_added_state_",!0),Y(this,"_trust_audio_stream_added_state_",!0),Y(this,"_audioTrack",void 0),Y(this,"_videoTrack",void 0),Y(this,"_dataChannels",[]),Y(this,"_audioSSRC",void 0),Y(this,"_videoSSRC",void 0),Y(this,"_audioOrtc",void 0),Y(this,"_videoOrtc",void 0),Y(this,"_cname",void 0),Y(this,"_rtxSsrcId",void 0),Y(this,"_videoMid",void 0),Y(this,"_audioMid",void 0),this.uid=r,this._uintid=s}}function e7(t,r){var s=Object.keys(t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);r&&(a=a.filter(function(c){return Object.getOwnPropertyDescriptor(t,c).enumerable})),s.push.apply(s,a)}return s}function Q2(t){for(var r=1;r<arguments.length;r++){var s=arguments[r]!=null?arguments[r]:{};r%2?e7(Object(s),!0).forEach(function(a){Y(t,a,s[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(s)):e7(Object(s)).forEach(function(a){Object.defineProperty(t,a,Object.getOwnPropertyDescriptor(s,a))})}return t}const ZP="9",Z2=2e4,e1=4e4;function t7(t,r){var s=Object.keys(t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);r&&(a=a.filter(function(c){return Object.getOwnPropertyDescriptor(t,c).enumerable})),s.push.apply(s,a)}return s}function mf(t){for(var r=1;r<arguments.length;r++){var s=arguments[r]!=null?arguments[r]:{};r%2?t7(Object(s),!0).forEach(function(a){Y(t,a,s[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(s)):t7(Object(s)).forEach(function(a){Object.defineProperty(t,a,Object.getOwnPropertyDescriptor(s,a))})}return t}var p0=function(t){return t[t.DOWN=0]="DOWN",t[t.UP=1]="UP",t}(p0||{});const t1=new Map;function n7(t,r,s,a){let{scale:c}=t;if(c===0&&a===p0.UP||c>=r.length-1&&a===p0.DOWN)return t;let d=mf(mf({},t),{},{scale:a===p0.DOWN?++c:--c});switch(s){case"maintain-framerate":d=mf(mf({},d),r[c].motion);break;case"maintain-resolution":d=mf(mf({},d),r[c].detail);break;case"balanced":d=mf(mf({},d),r[c].balanced)}return d}function r7(t,r){if(r){const s={overUse:0,underUse:0,adaptationList:i7(r)};t1.set(t,s)}else t1.delete(t)}function i7(t){const r=mf({},t),{bitrateMax:s,frameRate:a,scaleResolutionDownBy:c,bitrateMin:d}=r,{MIN_FRAME_RATE:h,MAX_THRESHOLD_FRAMERATE:m,MAX_SCALE:g,BITRATE_MIN_THRESHOLD:E,BITRATE_MAX_THRESHOLD:b,BWE_SCALE_UP_THRESHOLD:I,BWE_SCALE_DOWN_THRESHOLD:A,PERF_SCALE_DOWN_THRESHOLD:k,PERF_SCALE_UP_THRESHOLD:W,BALANCE_BITRATE_FACTOR:j,BALANCE_FRAMERATE_FACTOR:B,BALANCE_RESOLUTION_FACTOR:ee,MOTION_RESOLUTION_FACTOR:Z,MOTION_BITRATE_FACTOR:oe,DETAIL_FRAMERATE_FACTOR:ye,DETAIL_BITRATE_FACTOR:_e}=JL,ue=Math.min(r.frameRate,m),Ce=[{scale:0,threshold:{bwe_down:Math.round(Math.pow(A,1)*s),bwe_up:s,fps_down:Math.round(Math.pow(k,1)*ue),fps_up:a},balanced:{scaleResolutionDownBy:1,frameRate:a,bitrateMax:s,bitrateMin:d},motion:{scaleResolutionDownBy:1,frameRate:a,bitrateMax:s,bitrateMin:d},detail:{scaleResolutionDownBy:1,frameRate:a,bitrateMax:s,bitrateMin:d}}];for(let Ue=1;Ue<=g;Ue++){const ze={bwe_up:Math.round(Math.pow(I,Ue)*s),bwe_down:Math.round(Math.pow(A,Ue+1)*s),fps_up:Math.round(Math.pow(W,Ue)*ue),fps_down:Math.round(Math.pow(k,Ue+1)*ue)},Je={scaleResolutionDownBy:c/Math.pow(ee,Ue),frameRate:Math.max(Math.round(Math.pow(B,Ue)*a),h),bitrateMax:Math.max(Math.round(Math.pow(j,Ue)*s),b),bitrateMin:Math.max(Math.round(Math.pow(j,Ue)*d),E)},hn={scaleResolutionDownBy:c/Math.pow(Z,Ue),frameRate:a,bitrateMax:Math.max(Math.round(Math.pow(oe,Ue)*s),b),bitrateMin:Math.max(Math.round(Math.pow(oe,Ue)*d),E)},vn={scaleResolutionDownBy:1,frameRate:Math.max(Math.round(Math.pow(ye,Ue)*a),h),bitrateMax:Math.max(Math.round(Math.pow(_e,Ue)*s),b),bitrateMin:Math.max(Math.round(Math.pow(_e,Ue)*d),E)};Ce.push({scale:Ue,threshold:ze,balanced:Je,motion:hn,detail:vn})}return Ce}function v_e(t,r,s,a,c,d){const h=t1.get(t)||{overUse:0,underUse:0,adaptationList:i7(c)},{adaptationList:m}=h;t1.set(t,h);const{OVERUSE_TIMES_THRESHOLD:g,UNDERUSE_TIMES_THRESHOLD:E}=JL,{scale:b}=a;let I,A;return typeof r=="number"&&r>0&&function(k,W,j,B){if(W>=j.length)return!1;let{threshold:{fps_down:ee}}=j[W];return se("FORCE_AG_HIGH_FRAMERATE")&&B==="maintain-framerate"&&(ee=j[0].threshold.fps_down),k<ee}(r,b,m,d)&&(h.overUse++,A=Qw.CPU,h.overUse>g)||typeof s=="number"&&s>0&&function(k,W,j){if(W>=j.length)return!1;const{threshold:{bwe_down:B}}=j[W];return k<B}(s,b,m)&&(h.overUse++,A=Qw.BANDWIDTH,h.overUse>g)?(h.overUse=0,h.underUse=0,I=n7(a,m,d,p0.DOWN),[I,A]):(typeof r=="number"&&r>0&&typeof s=="number"&&s>0&&function(k,W,j,B){if(W===0)return;let{threshold:{fps_up:ee}}=j[W];return se("FORCE_AG_HIGH_FRAMERATE")&&B==="maintain-framerate"&&(ee=j[1].threshold.fps_up),k>ee}(r,b,m,d)&&function(k,W,j){if(W===0)return;const{threshold:{bwe_up:B}}=j[W];return k>B}(s,b,m)&&(h.underUse++,h.underUse>E&&(h.overUse=0,h.underUse=0,I=n7(a,m,d,p0.UP),I.scale===0&&(A=Qw.NONE))),[I,A])}function s7(t,r){var s=Object.keys(t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);r&&(a=a.filter(function(c){return Object.getOwnPropertyDescriptor(t,c).enumerable})),s.push.apply(s,a)}return s}function eM(t){for(var r=1;r<arguments.length;r++){var s=arguments[r]!=null?arguments[r]:{};r%2?s7(Object(s),!0).forEach(function(a){Y(t,a,s[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(s)):s7(Object(s)).forEach(function(a){Object.defineProperty(t,a,Object.getOwnPropertyDescriptor(s,a))})}return t}const n1=new Map;function r1(t,r){const s=n1.get(t);if(s){const{timer:a}=s;window.clearTimeout(a),n1.delete(t)}r.qualityLimitationReason=Qw.NONE,r7(t)}function S_e(t,r){var s;let a;switch(r){case qe.LocalAudioTrack:a=or.Audio;break;case qe.LocalVideoTrack:a=rt(s=t._hints).call(s,yr.SCREEN_TRACK)?or.Screen:or.High;break;case qe.LocalVideoLowTrack:a=or.Low}return a}function tM(t){const r=jn();if(t.some(s=>s._bypassWebAudio))throw new Le(te.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio");if(!r.webAudioMediaStreamDest)throw new Le(te.NOT_SUPPORTED,"cannot publish multiple tracks because your browser does not support audio mixing")}function nM(t,r){tM(t);const s=new zi;return t.forEach(a=>s.addAudioTrack(a)),s}const b_e=!jn().supportUnifiedPlan||se("CHROME_FORCE_PLAN_B")&&lf();function i1(t){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};var s;return b_e?(s={spec:r,store:t},ff("PlanBConnection").create(s)):new $l(r,t)}function rM(t){return t&&(t.iceConnectionState==="disconnected"||t.iceConnectionState==="checking"||t.iceConnectionState==="failed")}function o7(t){try{if(t.iceServers)return!1;if(t.turnServer&&t.turnServer.mode!=="off"){if(Yw(t.turnServer.servers))return!1;if(se("FORCE_TURN_TCP")||t.turnServer.servers.concat(t.turnServer.serversFromGateway||[]).some(r=>r.forceturn))return!0}return!1}catch{return!1}}var Ln;function a7(t,r){var s=Object.keys(t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);r&&(a=a.filter(function(c){return Object.getOwnPropertyDescriptor(t,c).enumerable})),s.push.apply(s,a)}return s}function qd(t){for(var r=1;r<arguments.length;r++){var s=arguments[r]!=null?arguments[r]:{};r%2?a7(Object(s),!0).forEach(function(a){Y(t,a,s[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(s)):a7(Object(s)).forEach(function(a){Object.defineProperty(t,a,Object.getOwnPropertyDescriptor(s,a))})}return t}let $l=(Ln=class Py extends uH{get currentLocalDescription(){return this.peerConnection.currentLocalDescription}get currentRemoteDescription(){return this.peerConnection.currentRemoteDescription}get peerConnectionState(){return this.peerConnection.connectionState}get iceConnectionState(){return this.peerConnection.iceConnectionState}get dtlsTransportState(){var r,s;return(r=(s=this.peerConnection.getReceivers()[0])===null||s===void 0||(s=s.transport)===null||s===void 0?void 0:s.state)!==null&&r!==void 0?r:null}get localCodecs(){return[...new Set(this.localCapabilities&&this.localCapabilities.send.videoCodecs.map(r=>r.rtpMap&&r.rtpMap.encodingName.toLowerCase()||"").filter(r=>{var s;return rt(s=Object.keys(eT)).call(s,r)}))]}constructor(r,s){super(r,s),Y(this,"id",vr(5,"connection-")),Y(this,"store",void 0),Y(this,"peerConnection",void 0),Y(this,"forceTurn",!1),Y(this,"remoteSDP",void 0),Y(this,"initialOffer",void 0),Y(this,"transportEventReceiver",void 0),Y(this,"statsFilter",void 0),Y(this,"extension",{useXR:se("USE_XR")}),Y(this,"localCapabilities",void 0),Y(this,"remoteCodecs",void 0),Y(this,"localCandidateCount",0),Y(this,"allCandidatesReceived",!1),Y(this,"isPreallocation",!1),Y(this,"preMediaMap",new Map),Y(this,"dataStreamChannelMap",new Map),Y(this,"establishPromise",void 0),Y(this,"recoveredDataChannelIds",[]),Y(this,"currentDataChannelId",1),Y(this,"supportAV1RtpSpec",!1),Y(this,"mutex",void 0),Y(this,"qualityLimitationReason",Qw.NONE),Y(this,"isFirstConnected",!1),this.store=s,this.forceTurn=o7(r),this.mutex=new Ys("P2PConnection-mutex",s.clientId),this.peerConnection=new RTCPeerConnection(Py.resolvePCConfiguration(r),{optional:[{googDscp:!0}]}),this.isFirstConnected=!1,this.statsFilter=qL(this.peerConnection,se("STATS_UPDATE_INTERVAL"),void 0,ni()?1200:void 0),this.bindPCEvents(),this.bindStatsEvents(),this.store.p2pId=this.store.p2pId+1,r.isPreallocation&&(this.isPreallocation=!0),this.establishPromise=this.establish()}getPreMedia(r){return this.preMediaMap.get(r)}isPreSub(){return this.preMediaMap.size>0}async updateRemoteRTPCapabilities(r,s){if(this.remoteCodecs=s,!this.remoteSDP)return void x.debug("[P2PConnection] cannot updateRemoteRTPCapabilities before remote SDP created, local codecs: ".concat(this.localCodecs,", codecs: ").concat(s));if(this.remoteSDP.updateRemoteCodec(r,s,this.store.codec)){const a=await this.peerConnection.createOffer(),c=this.logSDPExchange(a.sdp||"","offer","local","muteLocal");await this.peerConnection.setLocalDescription(a);const d=this.remoteSDP.toString();c==null||c(d),await this.peerConnection.setRemoteDescription({type:"answer",sdp:d})}else x.debug("[P2PConnection] updateRemoteRTPCapabilities no need to exchange SDP.")}async establish(){try{this.peerConnection.addTransceiver("video",{direction:"recvonly"}),this.peerConnection.addTransceiver("audio",{direction:"recvonly"});const a=await this.peerConnection.createOffer();if(!a.sdp)throw new Error("Cannot get initialOffer.sdp when trying to establish PeerConnection.");const c=Jm(a.sdp),d=await PH({filterRTX:!se("USE_PUB_RTX")&&!se("USE_SUB_RTX"),filterVideoFec:se("FILTER_VIDEO_FEC"),filterAudioFec:se("FILTER_AUDIO_FEC"),filterVideoCodec:se("FILTER_VIDEO_CODEC"),unsupportedVideoUplinkCodec:se("UNSUPPORTED_VIDEO_UPLINK_CODEC"),unsupportedVideoDownlinkCodec:se("UNSUPPORTED_VIDEO_DOWNLINK_CODEC")},this.extension);if(this.localCapabilities=qP(d),this.initialOffer=a,se("ENABLE_SVC")&&this.store.codec=="av1"){const m=await async function(){try{const g=new RTCPeerConnection;g.addTransceiver("video",{direction:"sendonly",sendEncodings:[{scalabilityMode:yP.L1T3}]});const E=await g.createOffer();if(!E.sdp)return void g.close();const b=Ya(E.sdp).mediaDescriptions[0];if(!b)return;const I=b.attributes.extmaps.find(A=>A.extensionName==="https://aomediacodec.github.io/av1-rtp-spec/#dependency-descriptor-rtp-header-extension");return g.close(),I}catch{return}}();var r;m&&(this.supportAV1RtpSpec=!0,(r=d.send)===null||r===void 0||r.videoExtensions.push(m))}let h;return a.sdp&&DH(a.sdp)&&(h=Kr(d),(s=h).send&&(c0(yt.VIDEO,s.send.videoExtensions),c0(yt.AUDIO,s.send.audioExtensions)),s.recv&&(c0(yt.VIDEO,s.recv.videoExtensions),c0(yt.AUDIO,s.recv.audioExtensions)),s.sendrecv&&(c0(yt.VIDEO,s.sendrecv.videoExtensions),c0(yt.AUDIO,s.sendrecv.audioExtensions))),qd(qd({},c),{},{rtpCapabilities:h||d,offerSDP:a.sdp})}catch(a){throw new Le(te.GET_LOCAL_CONNECTION_PARAMS_FAILED,a.toString())}var s}async connect(r){try{if(!this.initialOffer)throw new Error("Cannot establish P2PConnection without initial offer.");this.initialOffer.sdp&&DH(this.initialOffer.sdp)&&(s=r.rtpCapabilities,a=this.localCapabilities,s.send&&(HP(yt.VIDEO,s.send.videoExtensions,a.send.videoExtensions),HP(yt.AUDIO,s.send.audioExtensions,a.send.audioExtensions)),s.recv&&(HP(yt.VIDEO,s.recv.videoExtensions,a.recv.videoExtensions),HP(yt.AUDIO,s.recv.audioExtensions,a.recv.audioExtensions))),this.remoteSDP=new class{get localCapabilities(){return Kr(this._localCapabilities)}get rtpCapabilities(){return Kr(this._rtpCapabilities)}get candidates(){return Kr(this._candidates)}get iceParameters(){return Kr(this._iceParameters)}get dtlsParameters(){return Kr(this._dtlsParameters)}constructor(g){let E=arguments.length>1&&arguments[1]!==void 0&&arguments[1],b=arguments.length>2&&arguments[2]!==void 0&&arguments[2];Y(this,"sessionDesc",void 0),Y(this,"_localCapabilities",void 0),Y(this,"_rtpCapabilities",void 0),Y(this,"_candidates",void 0),Y(this,"_originCandidates",void 0),Y(this,"_iceParameters",void 0),Y(this,"_isUseExtmapAllowMixed",void 0),Y(this,"_isUseLocalCodecs",void 0),Y(this,"_dtlsParameters",void 0),Y(this,"setup",void 0),Y(this,"currentMidIndex",void 0),Y(this,"cname",void 0),Y(this,"useLocalCodecsMids",[]),Y(this,"preloadSsrcs",[]),Y(this,"firefoxSsrcMidMap",new Map),this._isUseExtmapAllowMixed=E,this._isUseLocalCodecs=b,g=Kr(g);const{iceParameters:I,dtlsParameters:A,candidates:k,rtpCapabilities:W,setup:j,localCapabilities:B,cname:ee}=g;this._rtpCapabilities=W,this._candidates=k,this._originCandidates=Kr(k),this._iceParameters=I,this._dtlsParameters=A,this._localCapabilities=B,this.setup=j,this.cname=ee,[this.sessionDesc]=this.updateRemoteRTPCapabilities(W),this.currentMidIndex=this.sessionDesc.mediaDescriptions.length-1}checkPreloadSsrcs(g){return g.length===this.preloadSsrcs.length&&g.every(E=>{var b;return rt(b=this.preloadSsrcs).call(b,E)})}preloadRemoteMedia(g){let E=0;const b=[],I=[];for(;g>0;){const A=[Q2({ssrcId:e1+E},se("USE_SUB_RTX")?{rtx:e1+E+1}:{})],k="".concat(e1+E,"_").concat(Z2+E),{ssrcs:W,ssrcGroups:j}=dT(A,this.cname,se("SYNC_GROUP")?k:void 0),B=this.preCreateOrRecycleSendMedia("video",W,j,void 0),ee=[{ssrcId:Z2+E}],Z="".concat(e1+E,"_").concat(Z2+E),{ssrcs:oe,ssrcGroups:ye}=dT(ee,this.cname,se("SYNC_GROUP")?Z:void 0),_e=this.preCreateOrRecycleSendMedia("audio",oe,ye,void 0);g--,E+=2,b.push(B,_e),I.push(W[0].ssrcId,oe[0].ssrcId)}return this.useLocalCodecsMids.push(...b),this.preloadSsrcs=I,{mids:b,preSSRCs:I,isAvailable:!0}}preCreateOrRecycleSendMedia(g,E,b,I){const A=this.rtpCapabilities.send.videoCodecs,k=this._isUseLocalCodecs||A.length===0?this.localCapabilities.recv:this.rtpCapabilities.send;x.debug("create or recycle send media without remote rtp capabilities, ssrcs ",E[0].ssrcId);const W=g===yt.VIDEO?k.videoCodecs:k.audioCodecs,j=g===yt.VIDEO?k.videoExtensions:k.audioExtensions;this.currentMidIndex+=1;const B="".concat(this.currentMidIndex);let ee={media:{mediaType:g,port:ZP,protos:["UDP","TLS","RTP","SAVPF"],fmts:W.map(Z=>Z.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:this.candidates,extmaps:j,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:E,ssrcGroups:b,rtcpFeedbackWildcards:[],payloads:W,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:"sendonly",rtcpMux:!0,rtcpRsize:!0,mid:"".concat(B)}};return ee=this.mungSendMediaDesc(ee,I),this.sessionDesc.mediaDescriptions.push(ee),this.updateBundleMids(),B}toString(){return Hm(this.sessionDesc)}send(g,E,b,I){const{ssrcs:A,ssrcGroups:k}=dT(E,this.cname,se("SYNC_GROUP")?b:void 0),W=this.findPreloadMediaDesc(A);if(W){if(ni()&&this.firefoxSsrcMidMap.set(A[0].ssrcId,W.attributes.mid),I&&(I.twcc||I.remb)){const j=this.sessionDesc.mediaDescriptions.indexOf(W);return this.sessionDesc.mediaDescriptions[j]=this.mungSendMediaDesc(W,I),{mid:W.attributes.mid,needExchangeSDP:!0}}return{mid:W.attributes.mid,needExchangeSDP:!1}}{const j=this.findAvailableMediaIndex(g,A);let B;return j===-1||j===1&&(xs()||function(){const ee=xn();return!(ee.name!==Hn.CHROME||!ee.osVersion)&&Number(ee.version)<=90}()||se("ENABLE_ENCODED_TRANSFORM")&&cf())||j===0&&!function(ee){const Z=xn();return!(Z.name!==Hn.FIREFOX||!Z.osVersion)&&Number(Z.version)===ee}(138)&&se("USE_SUB_RTX")||nW()?(B=this.createOrRecycleSendMedia(g,A,k,"sendonly",I),this.updateBundleMids()):(B=Kr(this.sessionDesc.mediaDescriptions[j]),B.attributes.direction="sendonly",B.attributes.ssrcs=A,B.attributes.ssrcGroups=k,this.sessionDesc.mediaDescriptions[j]=this.mungSendMediaDesc(B,I)),ni()&&this.firefoxSsrcMidMap.set(A[0].ssrcId,B.attributes.mid),{mid:B.attributes.mid,needExchangeSDP:!0}}}sendDataChannel(){const{mediaDesc:g,needExchangeSDP:E}=this.createOrRecycleDataChannel();return this.updateBundleMids(),{mid:g.attributes.mid,needExchangeSDP:E}}batchSend(g){const E=g.map(A=>{let{kind:k,ssrcMsg:W,mslabel:j}=A;return this.send(k,W,j)}),b=[];let I=!1;return E.forEach(A=>{let{mid:k,needExchangeSDP:W}=A;W&&(I=!0),b.push(k)}),{mids:b,needExchangeSDP:I}}stopSending(g){const E=this.sessionDesc.mediaDescriptions.filter(b=>b.attributes.mid&&g.indexOf(b.attributes.mid)!==-1);if(E.length!==g.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.stopSending.");E.forEach(b=>{b.attributes.mid==="0"||ni()||nW()?b.attributes.ssrcs=[]:(b.attributes.ssrcs=[],b.attributes.direction="inactive",b.media.port="0")}),this.updateBundleMids()}mute(g){const E=this.sessionDesc.mediaDescriptions.find(b=>b.attributes.mid===g);if(!E)throw new Error("mediaDescription not found with ".concat(g," in remote SDP when calling RemoteSDP.mute."));E.attributes.direction="inactive"}unmute(g){const E=this.sessionDesc.mediaDescriptions.find(b=>b.attributes.mid===g);if(!E)throw new Error("mediaDescription not found with ".concat(g," in remote SDP when calling RemoteSDP.unmute."));E.attributes.direction="sendonly"}muteRemote(g){const E=this.sessionDesc.mediaDescriptions.filter(b=>rt(g).call(g,b.attributes.mid||""));if(E.length!==g.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");E.forEach(b=>{b.attributes.direction="inactive"})}unmuteRemote(g){const E=this.sessionDesc.mediaDescriptions.filter(b=>rt(g).call(g,b.attributes.mid||""));if(E.length!==g.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");E.forEach(b=>{b.attributes.direction="recvonly"})}receive(g,E,b,I){g.forEach((A,k)=>{this.createOrRecycleRecvMedia(A,[],"recvonly",E,b,I[k])}),this.updateBundleMids()}stopReceiving(g){const E=this.sessionDesc.mediaDescriptions.filter(b=>g.indexOf(b.attributes.mid)!==-1);if(E.length!==g.length)throw new Error("MediaDescriptions' length doesn't match mids's length when calling RemoteSDP.receive.");E.forEach(b=>{b.media.port="0",b.attributes.direction="inactive"}),this.updateBundleMids()}updateRemoteRTPCapabilities(g){const E=this.sessionDesc||Ya((b=this._isUseExtmapAllowMixed,`v=0
o=- 0 0 IN IP4 127.0.0.1
s=AgoraGateway
t=0 0
a=group:BUNDLE 0 1
a=msid-semantic: WMS
a=ice-lite`.concat(b?`
a=extmap-allow-mixed`:"",`
m=video 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendonly
a=rtcp-mux
a=rtcp-rsize
a=mid:0
m=audio 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendonly
a=rtcp-mux
a=rtcp-rsize
a=mid:1
`)));var b;this._rtpCapabilities=g;let I=!1;const A=this.rtpCapabilities.send,k=this.localCapabilities.send,W=this.localCapabilities.recv,j=W.videoCodecs,B=W.audioCodecs,ee=W.videoExtensions,Z=W.audioExtensions;for(const ue of E.mediaDescriptions){var oe;if(ue.attributes.direction!=="sendonly"||typeof ue.attributes.mid!="string"||!rt(oe=this.useLocalCodecsMids).call(oe,ue.attributes.mid)){if(I=!0,ue.attributes.iceUfrag=this._iceParameters.iceUfrag,ue.attributes.icePwd=this._iceParameters.icePwd,ue.attributes.fingerprints=this._dtlsParameters.fingerprints,ue.attributes.candidates=this._candidates,ue.attributes.setup=this.setup,ue.media.mediaType==="application"&&(ue.attributes.sctpPort="5000"),ue.media.mediaType==="video")if(this._isUseLocalCodecs&&ue.attributes.direction==="sendonly"){var ye;ue.media.fmts=j.map(Ue=>Ue.payloadType.toString(10)),ue.attributes.payloads=j,ue.attributes.extmaps=ee;const Ce=ue.attributes.mid;typeof Ce!="string"||rt(ye=this.useLocalCodecsMids).call(ye,Ce)||this.useLocalCodecsMids.push(Ce)}else if(A.videoCodecs.length===0){const Ce=k.videoCodecs.filter(Ue=>{var ze,Je;return(ze=Ue.rtpMap)===null||ze===void 0?void 0:rt(Je=ze.encodingName.toLowerCase()).call(Je,"vp8")})||[k.videoCodecs[0]];ue.media.fmts=Ce.map(Ue=>Ue.payloadType.toString(10)),ue.attributes.payloads=Ce,ue.attributes.extmaps=[]}else ue.media.fmts=A.videoCodecs.map(Ce=>Ce.payloadType.toString(10)),ue.attributes.payloads=A.videoCodecs,ue.attributes.extmaps=A.videoExtensions;if(ue.media.mediaType==="audio")if(this._isUseLocalCodecs&&ue.attributes.direction==="sendonly"){var _e;ue.media.fmts=B.map(Ue=>Ue.payloadType.toString(10)),ue.attributes.payloads=B,ue.attributes.extmaps=Z;const Ce=ue.attributes.mid;typeof Ce!="string"||rt(_e=this.useLocalCodecsMids).call(_e,Ce)||this.useLocalCodecsMids.push(Ce)}else if(A.audioCodecs.length===0){const Ce=k.audioCodecs.filter(Ue=>{var ze,Je;return(ze=Ue.rtpMap)===null||ze===void 0?void 0:rt(Je=ze.encodingName.toLowerCase()).call(Je,"opus")})||[k.audioCodecs[0]];ue.media.fmts=Ce.map(Ue=>Ue.payloadType.toString(10)),ue.attributes.payloads=Ce,ue.attributes.extmaps=[]}else ue.media.fmts=A.audioCodecs.map(Ce=>Ce.payloadType.toString(10)),ue.attributes.payloads=A.audioCodecs,ue.attributes.extmaps=A.audioExtensions,u0(ue)}}return this.sessionDesc=E,this.currentMidIndex=E.mediaDescriptions.length-1,[this.sessionDesc,I]}updateCandidates(g){const E=this._originCandidates.filter(I=>I.transport==="udp"),b=[];if(E.forEach(I=>{b.push(Q2(Q2({},I),{},{foundation:"tcpcandidate",priority:Number(I.priority)-1+"",transport:"tcp",port:Number(I.port)+90+""}))}),E.length!==0){switch(g){case Qs.TCP_RELAY:this._candidates=b;break;case Qs.UDP_TCP_RELAY:case Qs.RELAY:this._candidates=[...E,...b];break;default:this._candidates=E}for(const I of this.sessionDesc.mediaDescriptions)I.attributes.candidates=this.candidates}}restartICE(g){g=Kr(g),this._iceParameters=g,this.sessionDesc.mediaDescriptions.forEach(E=>{E.attributes.iceUfrag=g.iceUfrag,E.attributes.icePwd=g.icePwd})}predictReceivingMids(g){const E=[];for(let b=0;b<g;b++)E.push((this.currentMidIndex+b+1).toString(10));return E}findAvailableMediaIndex(g,E){return this.sessionDesc.mediaDescriptions.findIndex(b=>{const I=b.media.mediaType===g&&b.media.port!=="0"&&(b.attributes.direction==="sendonly"||b.attributes.direction==="sendrecv")&&b.attributes.ssrcs.length===0;if(ni()){if(I){const A=this.firefoxSsrcMidMap.get(E[0].ssrcId);return!(A||b.attributes.mid!=="0"&&b.attributes.mid!=="1")||!(!A||A!==b.attributes.mid)}return!1}return I})}createOrRecycleDataChannel(){for(const b of this.sessionDesc.mediaDescriptions)if(b.media.mediaType==="application")return{mediaDesc:b,needExchangeSDP:!1};this.currentMidIndex+=1;const g="".concat(this.currentMidIndex),E={media:{mediaType:"application",port:ZP,protos:["UDP","DTLS","SCTP"],fmts:["webrtc-datachannel"]},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:this.candidates,extmaps:[],fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:[],ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:[],rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,mid:"".concat(g),sctpPort:"5000"}};return this.sessionDesc.mediaDescriptions.push(E),{mediaDesc:E,needExchangeSDP:!0}}createOrRecycleRecvMedia(g,E,b,I,A,k){const W=g._mediaStreamTrack.kind,j=this.rtpCapabilities.recv,B=hT(W,j,this.localCapabilities.send,W===yt.VIDEO?I:A),ee=W===yt.VIDEO?j.videoExtensions:j.audioExtensions;this.currentMidIndex+=1;const Z="".concat(this.currentMidIndex);let oe={media:{mediaType:W,port:ZP,protos:["UDP","TLS","RTP","SAVPF"],fmts:B.map(_e=>_e.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:this.candidates,extmaps:ee,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:E,ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:B,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:b,rtcpMux:!0,rtcpRsize:!0,mid:"".concat(Z)}};oe=this.mungRecvMediaDsec(oe,g,k);const ye=this.findFirstClosedMedia(W);if(ye){const _e=this.sessionDesc.mediaDescriptions.indexOf(ye);this.sessionDesc.mediaDescriptions[_e]=oe}else this.sessionDesc.mediaDescriptions.push(oe);return oe}updateRemoteDtlsParameters(g){const E=new Set(this._dtlsParameters.fingerprints.map(A=>A.fingerprint)),b=new Set(g.map(A=>A.fingerprint));let I=!1;E.size!==b.size&&(I=!0);for(const A of E)b.has(A)||(I=!0);return I}updateRemoteCodec(g,E,b){const I=[...new Set(this._rtpCapabilities.recv.videoCodecs.map(oe=>oe.rtpMap&&oe.rtpMap.encodingName.toLowerCase()||"").filter(oe=>{var ye;return rt(ye=Object.keys(eT)).call(ye,oe)}))],A=new Set(E);if(I.every(oe=>A.has(oe)))return x.debug("codecs has not changed, no need to updateRemoteCodec, codecs: ".concat(E)),!1;const k=this._rtpCapabilities.recv.videoCodecs.filter(oe=>E.some(ye=>{var _e;return rt(_e=oe.rtpMap&&oe.rtpMap.encodingName.toLowerCase()||"").call(_e,ye)}));if(k.length===0)return x.debug("updateRemoteCodec failed, because cannot find matched codec, remoteCapabilities codecs: ".concat(I," codecs: ").concat(E)),!1;const W=[...new Set(k.map(oe=>oe.rtpMap&&oe.rtpMap.encodingName.toLowerCase()||""))];let j;if(x.debug("updateRemoteCodec, from ".concat(I," to ").concat(W)),g.length===0)j=this.sessionDesc.mediaDescriptions.filter(oe=>oe.media.mediaType==="video"&&oe.attributes.direction==="recvonly");else if(j=this.sessionDesc.mediaDescriptions.filter(oe=>oe.attributes.mid&&oe.media.mediaType==="video"&&rt(g).call(g,oe.attributes.mid)&&oe.attributes.direction==="recvonly"),j.length!==g.length)return x.debug("updateRemoteCodec failed, because cannot find mids, mids: ".concat(g,", codecs: ").concat(E)),!1;if(se("USE_PUB_RTX")||se("USE_SUB_RTX")){const oe=Qm(k,this.rtpCapabilities.recv.videoCodecs);k.push(...oe)}this._rtpCapabilities.recv.videoCodecs=k;const B=this.localCapabilities.send,ee=this.rtpCapabilities.recv,Z=hT(yt.VIDEO,ee,B,b);return j.forEach(oe=>{const ye=Z.map(_e=>_e.payloadType.toString(10));x.debug("updateRemoteCodec mid: ".concat(oe.attributes.mid,", from"),oe.attributes.payloads,"to",Z),oe.attributes.payloads=Z,oe.media.fmts=ye}),!0}createOrRecycleSendMedia(g,E,b,I,A){const k=this.rtpCapabilities.send.videoCodecs,W=this._isUseLocalCodecs||k.length===0?this.localCapabilities.recv:this.rtpCapabilities.send,j=g===yt.VIDEO?W.videoCodecs:W.audioCodecs,B=g===yt.VIDEO?W.videoExtensions:W.audioExtensions;this.currentMidIndex+=1;const ee="".concat(this.currentMidIndex);let Z={media:{mediaType:g,port:ZP,protos:["UDP","TLS","RTP","SAVPF"],fmts:j.map(ye=>ye.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:this.candidates,extmaps:B,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:E,ssrcGroups:b,rtcpFeedbackWildcards:[],payloads:j,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:I,rtcpMux:!0,rtcpRsize:!0,mid:"".concat(ee)}};Z=this.mungSendMediaDesc(Z,A);const oe=this.findFirstClosedMedia(g);if(oe){const ye=this.sessionDesc.mediaDescriptions.indexOf(oe);this.sessionDesc.mediaDescriptions[ye]=Z}else this.sessionDesc.mediaDescriptions.push(Z);return Z}updateBundleMids(){this.sessionDesc.attributes.groups[0].identificationTag=this.sessionDesc.mediaDescriptions.filter(g=>g.media.port!=="0").map(g=>g.attributes.mid)}mungRecvMediaDsec(g,E,b){const I=Kr(g);return F2(I),l0(I,E),j2(I,E),IH(I),KP(I,b,this.localCapabilities.send),I}mungSendMediaDesc(g,E){const b=Kr(g);return KP(b,E,this.localCapabilities.recv),u0(b),b}updateRecvMedia(g,E){const b=this.sessionDesc.mediaDescriptions.findIndex(I=>I.attributes.mid===g);if(b!==-1){const I=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[b],E);this.sessionDesc.mediaDescriptions[b]=I}}bumpMid(g){this.currentMidIndex+=g}findFirstClosedMedia(g){return this.sessionDesc.mediaDescriptions.find(E=>ni()?E.media.port==="0"&&E.media.mediaType===g:E.media.port==="0")}findPreloadMediaDesc(g){return this.sessionDesc.mediaDescriptions.find(E=>{var b;return((b=E.attributes)===null||b===void 0||(b=b.ssrcs[0])===null||b===void 0?void 0:b.ssrcId)===g[0].ssrcId})}getSSRC(g){var E;return(E=this.sessionDesc.mediaDescriptions.find(b=>b.attributes.mid===g))===null||E===void 0?void 0:E.attributes.ssrcs}}(qd(qd({},r),{},{localCapabilities:this.localCapabilities}),this.supportAV1RtpSpec,!(!se("ENABLE_PRE_SUB_WITH_PRE_PC")||!se("PRE_USE_LOCAL_CODECS"))&&n2(this.store)),r.preallocation&&(this.isPreallocation=!0),Array.isArray(this.remoteCodecs)&&this.remoteCodecs.length>0&&this.remoteSDP.updateRemoteCodec([],this.remoteCodecs,this.store.codec);const c=this.remoteSDP.toString(),d=OH(this.initialOffer.sdp,this.extension),h=this.logSDPExchange(d||"","offer","local","connect");this.store.descriptionStart(),await this.peerConnection.setLocalDescription({type:"offer",sdp:d}),h==null||h(c),await this.peerConnection.setRemoteDescription({type:"answer",sdp:c});const m=this.peerConnection.getTransceivers()[0];if(m!=null&&m.receiver&&this.tryBindTransportEvents(m.receiver),n2(this.store))if(r.preallocation&&se("ENABLE_PRE_SUB_WITH_PRE_PC")){const g=se("PRE_SUB_NUM"),{mids:E,preSSRCs:b}=this.remoteSDP.preloadRemoteMedia(g);await Zm(this.peerConnection,this.remoteSDP,this.extension),x.debug("[".concat(this.store.clientId,"] [P2PConnection] preload media, in pre pc,add preload ssrcs ").concat(b)),this.presetMedia(E,b)}else{const{preSSRCs:g=[]}=r,E=g.map(I=>I.ssrcMsg[0].ssrcId);if(g.length===0)return;const{mids:b}=this.remoteSDP.batchSend(g.map(I=>Object.assign({},I)));await Zm(this.peerConnection,this.remoteSDP,this.extension),x.debug("[P2PConnection.connect] preload media, after join, add preload ssrcs ".concat(E)),this.presetMedia(b,E)}}catch(c){throw new Le(te.EXCHANGE_SDP_FAILED,"P2PConnection.connect failed; ".concat(c.toString()))}var s,a}presetMedia(r,s){r.forEach((a,c)=>{this.peerConnection.getTransceivers().forEach(d=>{if(d.mid!=null&&a===d.mid&&d.receiver.track){const h=d.receiver.track;let m;h.kind==="video"&&se("ENABLE_PRE_RENDER")&&(m=new m2({trackId:"track-".concat(h.kind,"-unknown-").concat(this.store.clientId,"_").concat(vr(5,""))},!0),m.updateVideoTrack(h),m.onFirstVideoFrameRender=()=>{var g;const E=this.preMediaMap.get(s[c]);E&&(E.firstVideoRender=Date.now()),(g=this.onFirstVideoRender)===null||g===void 0||g.call(this,s[c])},m.play(this.store.sessionId||void 0)),this.preMediaMap.set(s[c],{mid:a,track:h,player:m,transceiver:d})}}),this.store.peerReceiver()})}checkDtlsParameters(r){return!!this.remoteSDP&&r.length>0&&this.remoteSDP.updateRemoteDtlsParameters(r)}async updateRemoteConnect(r){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.updateRemoteConnect before remote SDP created");let s=!1;const{rtpCapabilities:a}=r;if([,s]=this.remoteSDP.updateRemoteRTPCapabilities(a),Array.isArray(this.remoteCodecs)&&this.remoteCodecs.length>0){const h=this.remoteSDP.updateRemoteCodec([],this.remoteCodecs,this.store.codec);s=s||h}const{preSSRCs:c=[]}=r,d=c.map(h=>h.ssrcMsg[0].ssrcId);if(!this.remoteSDP.checkPreloadSsrcs(d)){const h=[],m=[];if(Array.from(this.preMediaMap.entries()).every(g=>{let[E,{mid:b,player:I,track:A}]=g;return h.push(b),m.push(E),this.preMediaMap.delete(E),I&&I.destroy(),!0}),h.length>0&&(this.remoteSDP.stopSending(h),await Zm(this.peerConnection,this.remoteSDP,this.extension),x.warn("[P2PConnection.updateRemoteConnect] preload media, failed, del preload ssrcs ".concat(m)),At.reportApiInvoke(this.store.sessionId,{name:di.PRELOAD_MEDIA_FAILED,options:[c,m],tag:$r.TRACER}).onSuccess()),c.length>0){const{mids:g}=this.remoteSDP.batchSend(c.map(E=>Object.assign({},E)));await Zm(this.peerConnection,this.remoteSDP,this.extension),x.debug("[P2PConnection.updateRemoteConnect] preload media, after join, add preload ssrcs ".concat(d)),this.presetMedia(g,d)}}s?(await Zm(this.peerConnection,this.remoteSDP,this.extension),x.debug("[P2PConnection] updateRemoteConnect by exchanging SDP.")):x.debug("[P2PConnection] updateRemoteConnect no need to exchange SDP, because no need to update remote codecs (use local codecs)")}catch(s){throw new Le(te.EXCHANGE_SDP_FAILED,"P2PConnection.updateRemoteConnect failed; ".concat(s.toString()))}}send(r,s,a){var c=this;return jl(function*(){const d=yield Fn(c.mutex.lock("From P2PConnection.send"));try{if(!c.remoteSDP)throw new Error("Cannot call P2PConnection.send before remote SDP created");const h=[],m=GP();r.forEach(B=>{const ee=c.peerConnection.addTransceiver(B._mediaStreamTrack,qd({direction:"sendonly"},B.trackMediaType==="video"&&c.supportAV1RtpSpec&&m?{sendEncodings:[{scalabilityMode:m}]}:{}));h.push(ee),B._updateRtpTransceiver(ee)}),ni()&&se("SIMULCAST")===!0&&(yield Fn(c.applySimulcastForFirefox(h,r)));const g=yield Fn(c.peerConnection.createOffer()),E=c.remoteSDP.predictReceivingMids(r.length),b=c.mungSendOfferSDP(g.sdp,r,E),I=Ya(b),A=E.map(B=>{const ee=I.mediaDescriptions.find(Z=>Z.attributes.mid===B);if(!ee)throw new Error("Cannot extract ssrc from mediaDescription.");return TH(ee,se("USE_PUB_RTX"))});let k;try{k=yield A}catch(B){k=[],c.remoteSDP.receive(r,s,a,k);const ee=c.remoteSDP.toString();throw yield Fn(c.peerConnection.setLocalDescription({type:"offer",sdp:b})),yield Fn(c.peerConnection.setRemoteDescription({type:"answer",sdp:ee})),yield Fn(c.stopSending(E,!0)),B}c.remoteSDP.receive(r,s,a,k);const W=c.remoteSDP.toString(),j=c.logSDPExchange(b,"offer","local","send");return yield Fn(c.peerConnection.setLocalDescription({type:"offer",sdp:b})),yield Fn(c.applySimulcastEncodings(h,r)),yield Fn(c.applySendEncodings(h,r)),j==null||j(W),yield Fn(c.peerConnection.setRemoteDescription({type:"answer",sdp:W})),h.map((B,ee)=>{const Z=E[ee];return{localSSRC:A[ee],id:Z,transceiver:B}})}catch(h){throw h instanceof Le?h:new Le(te.EXCHANGE_SDP_FAILED,"P2PConnection.send failed; ".concat(h.toString()))}finally{d()}})()}async createDataChannels(r,s){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.createDataChannels before remote SDP created");let a=this.dataStreamChannelMap.get(r);if(a&&a.readyState==="open")x.debug("[P2PConnection] Channels are already available and can be reused directly.");else{const d=this.currentDataChannelId<1023?this.currentDataChannelId++:this.recoveredDataChannelIds.shift();if(typeof d!="number")throw new Error("create DataChannel error, because cannot get dc id");a=this.peerConnection.createDataChannel("datastream-channel",{id:d,negotiated:!0,ordered:!1,maxRetransmits:se("DATASTREAM_MAX_RETRANSMITS")}),a.binaryType="arraybuffer",this.dataStreamChannelMap.set(r,a)}s.forEach(d=>{d._updateOriginDataChannel(a)});const{needExchangeSDP:c}=this.remoteSDP.sendDataChannel();if(c){const d=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:d});const h=await this.peerConnection.createAnswer();await this.peerConnection.setLocalDescription(h),x.debug("[P2PConnection] createDataChannels by exchanging SDP.")}else x.debug("[P2PConnection] createDataChannels no need to exchange SDP.");return}catch(a){throw a instanceof Le?a:new Le(te.EXCHANGE_SDP_FAILED,"P2PConnection.createDataChannels failed; ".concat(a.toString()))}}async stopDataChannels(r){try{const s=this.dataStreamChannelMap.get(r);return s&&(s.id&&this.recoveredDataChannelIds.push(s.id),s.close()),void this.dataStreamChannelMap.delete(r)}catch(s){throw s instanceof Le?s:new Le(te.DATACHANNEL_FAILED,"P2PConnection.stopDataChannels failed; ".concat(s.toString()))}}async stopSending(r,s){const a=s?void 0:await this.mutex.lock("From P2PConnection.stopSending");try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopSending before remote SDP created");const c=this.peerConnection.getTransceivers().filter(g=>r.indexOf(g.mid)!==-1);if(c.length!==r.length)throw new Error("Transceivers' length doesn't match mids' length when trying to call P2PConnection.stopSending.");c.map(g=>{var E;r1(this.id+g.mid,this),g.direction="inactive",(E=g.stop)===null||E===void 0||E.call(g)});const d=await this.peerConnection.createOffer(),h=this.logSDPExchange(d.sdp||"","offer","local","stopSending");await this.peerConnection.setLocalDescription(d),this.remoteSDP.stopReceiving(r);const m=this.remoteSDP.toString();h==null||h(m),await this.peerConnection.setRemoteDescription({type:"answer",sdp:m})}catch(c){throw new Le(te.EXCHANGE_SDP_FAILED,"P2PConnection.stopSending failed; ".concat(c.toString()))}finally{a&&a()}}async receive(r,s,a,c){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.receive ".concat(r," before remoteSDP created."));const{mid:d,needExchangeSDP:h}=this.remoteSDP.send(r,s,a,c);h&&(await Zm(this.peerConnection,this.remoteSDP,this.extension),x.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(r," by exchanging SDP.")));const m=this.peerConnection.getTransceivers().find(g=>g.mid===d);if(!m)throw new Error("Cannot get transceiver after setLocalDescription.");return{track:m.receiver.track,id:d,transceiver:m}}catch(d){throw new Le(te.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(d.toString()))}}async batchReceive(r){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.batchReceive before remoteSDP created.");const{mids:s,needExchangeSDP:a}=this.remoteSDP.batchSend(r);return a&&(await Zm(this.peerConnection,this.remoteSDP,this.extension),x.debug("[".concat(this.store.clientId,"] [P2PConnection] batchReceive by exchanging SDP."))),s.map(c=>{const d=this.peerConnection.getTransceivers().find(h=>h.mid===c);if(!d)throw new Error("Cannot get transceiver after setLocalDescription.");return{track:d.receiver.track,id:c,transceiver:d}})}catch(s){throw new Le(te.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(s.toString()))}}async stopReceiving(r){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopReceiving before remote SDP created.");r.forEach(d=>{Array.from(this.preMediaMap.entries()).some(h=>{let[m,{mid:g,player:E}]=h;if(g===d)return this.preMediaMap.delete(m),E&&E.destroy(),!0})}),this.remoteSDP.stopSending(r);const s=this.remoteSDP.toString(),a=this.logSDPExchange(s,"offer","remote","stopReceiving");await this.peerConnection.setRemoteDescription({type:"offer",sdp:s});const c=await this.peerConnection.createAnswer();a==null||a(c.sdp||""),await this.peerConnection.setLocalDescription(c)}catch(s){throw new Le(te.EXCHANGE_SDP_FAILED,"P2PConnection stopReceiving failed; ".concat(s.toString()))}}async muteRemote(r){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.muteRemote mid=".concat(r," before remote SDP created."));this.remoteSDP.mute(r);const s=this.remoteSDP.toString(),a=this.logSDPExchange(s,"offer","remote","muteRemote");await this.peerConnection.setRemoteDescription({type:"offer",sdp:s});const c=await this.peerConnection.createAnswer();a==null||a(c.sdp||""),await this.peerConnection.setLocalDescription(c)}catch(s){throw new Le(te.EXCHANGE_SDP_FAILED,"P2PConnection.muteRemote failed; ".concat(s.toString()))}}async unmuteRemote(r){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.unmuteRemote mid=".concat(r," before remote SDP created."));this.remoteSDP.unmute(r);const s=this.remoteSDP.toString(),a=this.logSDPExchange(s,"offer","remote","unmuteRemote");await this.peerConnection.setRemoteDescription({type:"offer",sdp:s});const c=await this.peerConnection.createAnswer();a==null||a(c.sdp||""),await this.peerConnection.setLocalDescription(c)}catch(s){throw new Le(te.EXCHANGE_SDP_FAILED,"P2PConnection.unmuteRemote failed; ".concat(s.toString()))}}async muteLocal(r){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.muteLocal before remote SDP created.");const s=this.peerConnection.getTransceivers().filter(h=>h.mid&&r.indexOf(h.mid)!==-1);if(s.length!==r.length)throw new Error("Transceivers' length doesn't match mids' length.");s.map(h=>{h.direction="inactive"});const a=await this.peerConnection.createOffer(),c=this.logSDPExchange(a.sdp||"","offer","local","muteLocal");await this.peerConnection.setLocalDescription(a),this.remoteSDP.muteRemote(r);const d=this.remoteSDP.toString();c==null||c(d),await this.peerConnection.setRemoteDescription({type:"answer",sdp:d})}catch(s){throw new Le(te.EXCHANGE_SDP_FAILED,"P2PConnection.muteLocal failed; ".concat(s.toString()))}}async unmuteLocal(r){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.unmuteLocal before remote SDP created.");const s=this.peerConnection.getTransceivers().filter(h=>h.mid&&r.indexOf(h.mid)!==-1);if(s.length!==r.length)throw new Error("Transceivers' length doesn't match mids' length.");s.map(async(h,m)=>{h.direction="sendonly"});const a=await this.peerConnection.createOffer(),c=this.logSDPExchange(a.sdp||"","offer","local","unmuteLocal");await this.peerConnection.setLocalDescription(a),this.remoteSDP.unmuteRemote(r),Array.isArray(this.remoteCodecs)&&this.remoteCodecs.length>0&&this.remoteSDP.updateRemoteCodec(r,this.remoteCodecs,this.store.codec);const d=this.remoteSDP.toString();c==null||c(d),await this.peerConnection.setRemoteDescription({type:"answer",sdp:d})}catch(s){throw new Le(te.EXCHANGE_SDP_FAILED,"P2PConnection.unmuteLocal failed; ".concat(s.toString()))}}restartICE(r){var s=this;return jl(function*(){const a=yield Fn(s.mutex.lock("From P2PConnection.restartICE"));try{if(!s.remoteSDP)throw new Error("Cannot restartICE before remoteSDP created.");const c=jn().supportPCSetConfiguration,d=se("FORCE_TURN_TCP")||s.forceTurn;if(r===Qs.RELAY&&!c)return;if(c&&!d){const I=r===Qs.RELAY?"relay":"all",A=s.peerConnection.getConfiguration();A.iceTransportPolicy!==I&&(x.debug("[".concat(s.store.clientId,"] restartICE change iceTransportPolicy from [").concat(A.iceTransportPolicy,"] to [").concat(I,"]")),A.iceTransportPolicy=I,s.peerConnection.setConfiguration(A))}s.remoteSDP.updateCandidates(r);const h=yield Fn(s.peerConnection.createOffer({iceRestart:!0}));if(!h.sdp)throw new Error("Cannot restartICE because restart offer SDP does not exist.");const m=Jm(h.sdp),{remoteIceParameters:g}=yield m.iceParameters;s.remoteSDP.restartICE(g);const E=s.remoteSDP.toString(),b=s.logSDPExchange(h.sdp||"","offer","local","restartICE");s.store.descriptionStart(),yield Fn(s.peerConnection.setLocalDescription(h)),b==null||b(E),yield Fn(s.peerConnection.setRemoteDescription({type:"answer",sdp:E}))}catch(c){x.warning("[".concat(s.store.clientId,"] restart ICE failed, abort operation"),c)}finally{a()}})()}async extendCandidate(){if(!this.remoteSDP||this.isFirstConnected)return;const r=await this.mutex.lock("From P2PConnection.extendCandidate");try{this.remoteSDP.updateCandidates(Qs.TCP_RELAY),await Zm(this.peerConnection,this.remoteSDP,this.extension)}catch(s){x.warning("[".concat(this.store.clientId,"] extend candidate failed, abort operation"),s)}finally{r()}}close(){var r;this.peerConnection.getTransceivers().forEach(s=>{r1(this.id+s.mid,this)}),this.preMediaMap.forEach(s=>{let{player:a}=s;a&&a.destroy()}),this.preMediaMap.clear(),this.peerConnection.close(),(r=this.onConnectionStateChange)===null||r===void 0||r.call(this,"closed"),this.tryUnbindTransportEvents(),this.unbindPCEvents(),this.unbindStatsEvents(),this.removeAllListeners(),this.transportEventReceiver=void 0,this.statsFilter.destroy(),this.dataStreamChannelMap.clear(),this.recoveredDataChannelIds=[],this.currentDataChannelId=1}getStats(){return qd(qd({},this.statsFilter.getStats()),{},{qualityLimitationReason:this.qualityLimitationReason})}getRemoteVideoIsReady(r){return this.statsFilter.getVideoIsReady(r)}async updateEncoderConfig(r,s){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.updateEncoderConfig before remote SDP created.");const a=await this.peerConnection.createOffer(),c=this.mungSendOfferSDP(a.sdp,[s],[r]);this.remoteSDP.updateRecvMedia(r,s);const d=this.remoteSDP.toString(),h=this.logSDPExchange(c,"offer","local","updateEncoderConfig");await this.peerConnection.setLocalDescription({type:"offer",sdp:c}),h==null||h(d),await this.peerConnection.setRemoteDescription({type:"answer",sdp:d})}catch(a){throw new Le(te.EXCHANGE_SDP_FAILED,a.toString())}}async updateSendParameters(r,s){const a=this.peerConnection.getTransceivers().filter(c=>c.mid===r);a.length===1&&(this.isVP8Simulcast(s)?ni()||await this.applySimulcastEncodings(a,[s]):await this.applySendEncodings(a,[s]))}setStatsRemoteVideoIsReady(r,s){this.statsFilter.setVideoIsReady2(r,s)}async replaceTrack(r,s){const a=this.peerConnection.getTransceivers().find(c=>c.mid===s);a&&await a.sender.replaceTrack(r._mediaStreamTrack)}async getSelectedCandidatePair(){const r=this.peerConnection.getReceivers();if(r.length>0&&r[0].transport&&r[0].transport.iceTransport&&r[0].transport.iceTransport.getSelectedCandidatePair&&r[0].transport.iceTransport.getSelectedCandidatePair()){const s=r[0].transport.iceTransport,{local:a,remote:c}=s.getSelectedCandidatePair();return{local:qd(qd({},Hh),{},{candidateType:a.type,protocol:a.protocol,address:a.address,port:a.port}),remote:qd(qd({},Hh),{},{candidateType:c.type,protocol:c.protocol,address:c.address,port:c.port})}}return this.statsFilter.getSelectedCandidatePair()}bindPCEvents(){this.peerConnection.oniceconnectionstatechange=()=>{var r;(r=this.onICEConnectionStateChange)===null||r===void 0||r.call(this,this.peerConnection.iceConnectionState)},this.peerConnection.onconnectionstatechange=()=>{var r;this.peerConnection.connectionState==="connected"&&(this.isFirstConnected=!0),(r=this.onConnectionStateChange)===null||r===void 0||r.call(this,this.peerConnection.connectionState)},this.peerConnection.onicecandidateerror=r=>{if(r&&(r.errorCode||r.errorText)){var s;const a="code: ".concat(r.errorCode,", message: ").concat(r.errorText),c=r.port?"local: ".concat(r.port):"",d=uy(r.url||"");x.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICECandidateError(").concat(a,"), url: ").concat(d||"",", host_candidate:").concat(c)),(s=this.onICECandidateError)===null||s===void 0||s.call(this,a)}},this.peerConnection.onicegatheringstatechange=r=>{r&&r.target&&"iceGatheringState"in r.target&&x.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] RTCPeerConnection.onicegatheringstatechange(").concat(r.target.iceGatheringState,")"))},this.peerConnection.onicecandidate=r=>{r.candidate?this.localCandidateCount+=1:(this.peerConnection.onicecandidate=null,this.allCandidatesReceived=!0,x.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] local candidate count"),this.localCandidateCount))},setTimeout(()=>{this.allCandidatesReceived||(this.allCandidatesReceived=!0,x.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] onicecandidate timeout, local candidate count"),this.localCandidateCount))},se("CANDIDATE_TIMEOUT"))}unbindPCEvents(){this.peerConnection.oniceconnectionstatechange=null,this.peerConnection.onconnectionstatechange=null,this.peerConnection.onsignalingstatechange=null,this.peerConnection.onicecandidateerror=null,this.peerConnection.onicecandidate=null,this.peerConnection.ontrack=null}static resolvePCConfiguration(r){const s={iceServers:[]},a=r.cloudProxyServer||"disabled";return r.iceServers?s.iceServers=r.iceServers:r.turnServer&&(Yw(r.turnServer.servers)?s.iceServers=r.turnServer.servers:se("NEW_TURN_MODE")&&s.iceServers&&a==="disabled"?(se("USE_TURN_SERVER_OF_GATEWAY")?r.turnServer.serversFromGateway&&s.iceServers.push(...Py.newTurnServerConfigToIceServers(r.turnServer.serversFromGateway)):s.iceServers.push(...Py.newTurnServerConfigToIceServers(r.turnServer.servers)),se("NEW_FORCE_TURN")&&(s.iceTransportPolicy="relay")):r.turnServer.mode!=="off"&&(s.iceServers&&s.iceServers.push(...Py.turnServerConfigToIceServers(r.turnServer.servers)),se("USE_TURN_SERVER_OF_GATEWAY")&&s.iceServers&&r.turnServer.serversFromGateway&&s.iceServers.push(...Py.turnServerConfigToIceServers(r.turnServer.serversFromGateway)),se("FORCE_TURN_TCP")?s.iceTransportPolicy="relay":r.turnServer.servers.concat(r.turnServer.serversFromGateway||[]).forEach(c=>{c.forceturn&&(s.iceTransportPolicy="relay")}))),se("ENABLE_ENCODED_TRANSFORM")&&jn().supportWebRTCEncodedTransform&&(s.encodedInsertableStreams=!0),s}static turnServerConfigToIceServers(r){const s=[];return r.forEach(a=>{a.security?a.tcpport&&s.push({username:a.username,credential:a.password,credentialType:"password",urls:"turns:".concat(Ym(a.turnServerURL),":").concat(a.tcpport,"?transport=tcp")}):(a.udpport&&!se("FORCE_TURN_TCP")&&s.push({username:a.username,credential:a.password,credentialType:"password",urls:"turn:".concat(a.turnServerURL,":").concat(a.udpport,"?transport=udp")}),a.tcpport&&s.push({username:a.username,credential:a.password,credentialType:"password",urls:"turn:".concat(a.turnServerURL,":").concat(a.tcpport,"?transport=tcp")}))}),s}static newTurnServerConfigToIceServers(r){const s=[];return r.forEach(a=>{const c=se("NEW_TURN_MODE");c===1?s.push({username:a.username,credential:a.password,credentialType:"password",urls:"turn:".concat(a.turnServerURL,":3478?transport=udp")}):c===2?s.push({username:a.username,credential:a.password,credentialType:"password",urls:"turn:".concat(a.turnServerURL,":3478?transport=tcp")}):c===3?s.push({username:a.username,credential:a.password,credentialType:"password",urls:"turns:".concat(Ym(a.turnServerURL),":443?transport=tcp")}):c===4&&(s.push({username:a.username,credential:a.password,credentialType:"password",urls:"turn:".concat(a.turnServerURL,":3478?transport=udp")}),s.push({username:a.username,credential:a.password,credentialType:"password",urls:"turn:".concat(a.turnServerURL,":3478?transport=tcp")}),s.push({username:a.username,credential:a.password,credentialType:"password",urls:"turns:".concat(Ym(a.turnServerURL),":443?transport=tcp")}))}),s}tryBindTransportEvents(r){const s=r.transport;if(s){this.transportEventReceiver=r,s.onstatechange=()=>{var c;s!=null&&s.state&&((c=this.onDTLSTransportStateChange)===null||c===void 0||c.call(this,s.state))},s.onerror=c=>{var d;(d=this.onDTLSTransportError)===null||d===void 0||d.call(this,"error"in c?c.error:c)};const a=s.iceTransport;a&&(a.onstatechange=()=>{const c=s==null?void 0:s.iceTransport.state;var d;c&&((d=this.onICETransportStateChange)===null||d===void 0||d.call(this,c))},a.getSelectedCandidatePair&&(a.onselectedcandidatepairchange=()=>{if(a.getSelectedCandidatePair()){const{local:c,remote:d}=a.getSelectedCandidatePair()||{};if(c&&d){const h=c.address+":"+c.port,m=d.address+":"+d.port;x.info("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] selectedcandidatepairchange: local ").concat(JSON.stringify(uy(h)),", remote ").concat(JSON.stringify(uy(m))))}}}))}}tryUnbindTransportEvents(){this.transportEventReceiver&&this.transportEventReceiver.transport&&(this.transportEventReceiver.transport.onstatechange=null,this.transportEventReceiver.transport.onerror=null,this.transportEventReceiver.transport.iceTransport&&(this.transportEventReceiver.transport.iceTransport.onstatechange=null))}async updateRtpSenderEncodings(r,s){var a,c;if(s||(s=this.peerConnection.getSenders().find(B=>B.track===r._mediaStreamTrack)),!s)return x.warn("[".concat(r.getTrackId(),"] no rtpSender found}"));if(this.isVP8Simulcast(r))return x.warn("[updateRtpSenderEncodings] Track is VP8 simulcast, please apply simulcast encodings");if(!jn().supportSetRtpSenderParameters)return x.warn("[updateRtpSenderEncodings] Browser not support set rtp-sender parameters");const d={},h={};switch(r._optimizationMode){case"motion":d.degradationPreference="maintain-framerate";break;case"detail":d.degradationPreference="maintain-resolution";break;case"balanced":d.degradationPreference="balanced"}const m=function(j,B){return j.getTransceivers().find(ee=>ee.sender.track===B||ee.receiver.track===B)}(this.peerConnection,r._mediaStreamTrack),g=age(r);if(function(j){var B;return!(!se("ENABLE_AG_ADAPTATION")||!(j instanceof IP||rt(B=j._hints).call(B,yr.CUSTOM_TRACK))||!se("FORCE_SUPPORT_AG_ADAPTATION")&&!(eW(14,0,!1)&&tW(17,4)||Z8(14)&&OL(17,4,!0)))}(r)&&m&&s&&g&&this.getLocalVideoStats&&rt(a=["vp8","vp9"]).call(a,this.store.codec)){var E;const j=d.degradationPreference||(rt(E=r._hints).call(E,yr.CUSTOM_TRACK)?se("CUSTOM_ADAPTATION_DEFAULT_MODE"):"maintain-framerate");(function(B,ee,Z,oe,ye,_e){if(r1(B,Z),ye(ee),oe!=="balanced"&&oe!=="maintain-framerate"&&oe!=="maintain-resolution")return;let ue=-1;r7(B,ee);const Ce=window.setInterval(()=>{const ze=n1.get(B);if(!se("ENABLE_AG_ADAPTATION")||!ze)return r1(B,Z),void ye(ee);const Je=_e();if(Je.sendPackets>0&&Je.OutgoingAvailableBandwidth>0){if(ue===-1)return void(ue=Date.now());if(Date.now()-ue<1e3)return;const hn=Je.sendFrameRate,vn=Je.OutgoingAvailableBandwidth,[Xt,nr]=v_e(B,hn,vn,ze.adaptationConfig,ee,oe);nr&&(Z.qualityLimitationReason=nr),Xt&&ze.adaptationConfig.scale!==Xt.scale&&(x.debug("[".concat(B,"] applyAdaptation: ").concat(Z.qualityLimitationReason,`
           sendFps `).concat(hn,", bwe ").concat(vn,", switch from ").concat(ze.adaptationConfig.scale," to ").concat(Xt.scale," ")),ze.adaptationConfig=eM(eM({},ze.adaptationConfig),Xt),ye(Xt))}},se("CHECK_LOCAL_STATS_INTERVAL")),Ue=eM({},ee);n1.set(B,{timer:Ce,adaptationConfig:Ue,originConfig:ee,adaptationFunc:ye}),x.debug("[".concat(B,"] start adaptation, originConfig: ").concat(JSON.stringify(ee),", degradationPreference: ").concat(oe))})(this.id+m.mid,g,this,j,B=>{s&&this.updateAdaptation(s,B)},this.getLocalVideoStats.bind(this))}if(r._encoderConfig){var b;const{bitrateMax:j,frameRate:B,scaleResolutionDownBy:ee}=r._encoderConfig;j&&(h.maxBitrate=1e3*j),(rt(b=r._hints).call(b,yr.LOW_STREAM)||r.isUseScaleResolutionDownBy)&&(B&&(h.maxFramerate=Cc(B)),ee&&ee>=1&&(h.scaleResolutionDownBy=ee))}const{maxFramerate:I}=se("ENCODER_CONFIG_LIMIT");if(I&&typeof I=="number"&&(h.maxFramerate=h.maxFramerate?Math.min(h.maxFramerate,I):I),se("DSCP_TYPE")&&lf()){var A;const j=se("DSCP_TYPE");rt(A=["very-low","low","medium","high"]).call(A,j)&&(h.networkPriority=j)}const k=s.getParameters(),W=(c=k.encodings)===null||c===void 0?void 0:c[0];ni()&&!W&&(d.encodings=[h]),W&&Object.assign(W,h),Object.assign(k,d),x.debug("[".concat(r.getTrackId(),"] updateRtpSenderEncodings: ").concat(JSON.stringify(k.encodings))),await s.setParameters(k),await async function(j,B,ee){try{var Z;if(!jn().supportSetRtpSenderParameters||!function(Ce){return Ce==="vp9"||Ce==="av1"}(j)||!se("ENABLE_SVC"))return;const oe={},ye={},_e=B.getParameters(),ue=(Z=_e.encodings)===null||Z===void 0?void 0:Z[0];ye.scalabilityMode=GP(ee),ue&&Object.assign(ue,ye),Object.assign(_e,oe),await B.setParameters(_e),x.debug("[updateAdaptation] updateRtpSenderEncodings scalabilityMode success: ".concat(JSON.stringify(_e.encodings)))}catch(oe){x.debug("[updateAdaptation] updateRtpSenderEncodings scalabilityMode failed",oe)}}(this.store.codec,s,se("SVC_MODE"))}async updateAdaptation(r,s){var a,c;if(!r)return x.debug("[updateAdaptation] no rtpSender found");if(!jn().supportSetRtpSenderParameters)return x.debug("[updateAdaptation] Browser not support set rtp-sender parameters");const d={},{bitrateMax:h,frameRate:m,scaleResolutionDownBy:g}=s;h&&(d.maxBitrate=1e3*h),m&&(d.maxFramerate=Cc(m)),g&&g>=1&&rt(a=["vp8","vp9"]).call(a,this.store.codec)&&(d.scaleResolutionDownBy=g);const E=r.getParameters(),b=(c=E.encodings)===null||c===void 0?void 0:c[0];b&&Object.assign(b,d),Object.assign(E,{});try{await r.setParameters(E),x.debug("[updateAdaptation] updateRtpSenderEncodings: ".concat(JSON.stringify(E.encodings)))}catch(I){!("transport"in r)||r.transport&&r.transport.state==="connected"?this.peerConnectionState!=="connected"?x.debug("[updateAdaptation] peerConnection not connected}"):x.debug("[updateAdaptation] updateRtpSenderEncodings failed",I):x.debug("[updateAdaptation] rtpSender transport not connected}")}}async applySendEncodings(r,s){try{if(!jn().supportSetRtpSenderParameters||r.length!==s.length)return;for(let a=0;a<r.length;a++){const c=r[a],d=s[a];d instanceof Dr&&!this.isVP8Simulcast(d)&&await this.updateRtpSenderEncodings(d,c.sender)}}catch{x.debug("[".concat(this.store.clientId,"] Apply RTPSendEncodings failed."))}}mungSendOfferSDP(r,s,a){const c=Ya(r);return s.forEach((d,h)=>{const m=a[h],g=c.mediaDescriptions.find(E=>E.attributes.mid===m);g&&(l0(g,d),AH(g,d,this.store.codec))}),Hm(c)}bindStatsEvents(){this.statsFilter.onFirstAudioReceived=r=>{var s;(s=this.onFirstAudioReceived)===null||s===void 0||s.call(this,r)},this.statsFilter.onFirstVideoReceived=r=>{var s;(s=this.onFirstVideoReceived)===null||s===void 0||s.call(this,r)},this.statsFilter.onFirstAudioDecoded=r=>{var s;(s=this.onFirstAudioDecoded)===null||s===void 0||s.call(this,r)},this.statsFilter.onFirstVideoDecoded=(r,s,a)=>{var c;(c=this.onFirstVideoDecoded)===null||c===void 0||c.call(this,r,s,a)},this.statsFilter.onSelectedLocalCandidateChanged=(r,s)=>{var a;(a=this.onSelectedLocalCandidateChanged)===null||a===void 0||a.call(this,r,s)},this.statsFilter.onSelectedRemoteCandidateChanged=(r,s)=>{var a;(a=this.onSelectedRemoteCandidateChanged)===null||a===void 0||a.call(this,r,s)},this.statsFilter.onFirstVideoDecodedTimeout=r=>{var s;(s=this.onFirstVideoDecodedTimeout)===null||s===void 0||s.call(this,r)}}unbindStatsEvents(){this.statsFilter.onFirstAudioReceived=void 0,this.statsFilter.onFirstVideoReceived=void 0,this.statsFilter.onFirstAudioDecoded=void 0,this.statsFilter.onFirstVideoDecoded=void 0,this.statsFilter.onSelectedLocalCandidateChanged=void 0,this.statsFilter.onSelectedRemoteCandidateChanged=void 0,this.statsFilter.onFirstVideoDecodedTimeout=void 0}async applySimulcastForFirefox(r,s){if(r.length===s.length)for(let g=0;g<r.length;g++){var a,c,d,h,m;const E=r[g],b=s[g];if(b instanceof Dr&&!rt(a=b._hints).call(a,yr.LOW_STREAM)&&(c=b._encoderConfig)!==null&&c!==void 0&&c.bitrateMax&&((d=b._encoderConfig)===null||d===void 0?void 0:d.bitrateMax)>200&&(h=b._scalabilityMode)!==null&&h!==void 0&&h.numSpatialLayers&&((m=b._scalabilityMode)===null||m===void 0?void 0:m.numSpatialLayers)>1&&this.store.codec==="vp8"){const I={},A={high:1e3*(b._encoderConfig.bitrateMax-50),medium:5e4};I.encodings=[{rid:"m",active:!0,maxBitrate:A.medium,scaleResolutionDownBy:4},{rid:"h",active:!0,maxBitrate:A.high}];const k=E.sender.getParameters();await E.sender.setParameters(Object.assign(k,I))}}}async applySimulcastEncodings(r,s){if(!ni()&&r.length===s.length)for(let a=0;a<r.length;a++){const c=s[a];if(c instanceof Dr&&this.isVP8Simulcast(c)){const d=r[a],h={},m={high:1e3*(c._encoderConfig.bitrateMax-50),medium:5e4};h.encodings=[{active:!0,adaptivePtime:!1,networkPriority:"high",priority:"high",maxBitrate:m.high},{active:!0,adaptivePtime:!1,networkPriority:"low",priority:"low",maxBitrate:m.medium,scaleResolutionDownBy:4}];const g=d.sender.getParameters();await d.sender.setParameters(Object.assign(g,h))}}}isVP8Simulcast(r){var s,a,c,d,h;return!!(r instanceof Dr&&se("SIMULCAST")&&this.store.codec==="vp8"&&!rt(s=r._hints).call(s,yr.LOW_STREAM)&&(a=r._encoderConfig)!==null&&a!==void 0&&a.bitrateMax&&((c=r._encoderConfig)===null||c===void 0?void 0:c.bitrateMax)>200&&(d=r._scalabilityMode)!==null&&d!==void 0&&d.numSpatialLayers&&((h=r._scalabilityMode)===null||h===void 0?void 0:h.numSpatialLayers)>1)}logSDPExchange(r,s,a,c){if(se("SDP_LOGGING"))return x.upload("[".concat(this.store.clientId,"] exchanging ").concat(a," ").concat(s," SDP during P2PConnection.").concat(c,`
`),r),s==="offer"?d=>{this.logSDPExchange(d,"answer",a==="local"?"remote":"local",c)}:void 0}async getRemoteSSRC(r){if(!this.remoteSDP)return;const s=this.remoteSDP.getSSRC(r);return s&&s.length!==0?s[0].ssrcId:void 0}setConfiguration(r){if(jn().supportPCSetConfiguration){const s=Py.resolvePCConfiguration(r);this.peerConnection.setConfiguration(s)}r.isPreallocation&&(this.isPreallocation=!0)}},Rt(Ln.prototype,"updateRemoteRTPCapabilities",[wa],Object.getOwnPropertyDescriptor(Ln.prototype,"updateRemoteRTPCapabilities"),Ln.prototype),Rt(Ln.prototype,"connect",[wa],Object.getOwnPropertyDescriptor(Ln.prototype,"connect"),Ln.prototype),Rt(Ln.prototype,"updateRemoteConnect",[wa],Object.getOwnPropertyDescriptor(Ln.prototype,"updateRemoteConnect"),Ln.prototype),Rt(Ln.prototype,"createDataChannels",[wa],Object.getOwnPropertyDescriptor(Ln.prototype,"createDataChannels"),Ln.prototype),Rt(Ln.prototype,"receive",[wa],Object.getOwnPropertyDescriptor(Ln.prototype,"receive"),Ln.prototype),Rt(Ln.prototype,"batchReceive",[wa],Object.getOwnPropertyDescriptor(Ln.prototype,"batchReceive"),Ln.prototype),Rt(Ln.prototype,"stopReceiving",[wa],Object.getOwnPropertyDescriptor(Ln.prototype,"stopReceiving"),Ln.prototype),Rt(Ln.prototype,"muteRemote",[wa],Object.getOwnPropertyDescriptor(Ln.prototype,"muteRemote"),Ln.prototype),Rt(Ln.prototype,"unmuteRemote",[wa],Object.getOwnPropertyDescriptor(Ln.prototype,"unmuteRemote"),Ln.prototype),Rt(Ln.prototype,"muteLocal",[wa],Object.getOwnPropertyDescriptor(Ln.prototype,"muteLocal"),Ln.prototype),Rt(Ln.prototype,"unmuteLocal",[wa],Object.getOwnPropertyDescriptor(Ln.prototype,"unmuteLocal"),Ln.prototype),Rt(Ln.prototype,"close",[wa],Object.getOwnPropertyDescriptor(Ln.prototype,"close"),Ln.prototype),Rt(Ln.prototype,"updateEncoderConfig",[wa],Object.getOwnPropertyDescriptor(Ln.prototype,"updateEncoderConfig"),Ln.prototype),Rt(Ln.prototype,"updateSendParameters",[wa],Object.getOwnPropertyDescriptor(Ln.prototype,"updateSendParameters"),Ln.prototype),Rt(Ln.prototype,"replaceTrack",[wa],Object.getOwnPropertyDescriptor(Ln.prototype,"replaceTrack"),Ln.prototype),Rt(Ln.prototype,"updateAdaptation",[wa],Object.getOwnPropertyDescriptor(Ln.prototype,"updateAdaptation"),Ln.prototype),Rt(Ln.prototype,"getRemoteSSRC",[wa],Object.getOwnPropertyDescriptor(Ln.prototype,"getRemoteSSRC"),Ln.prototype),Ln);function wa(t,r,s){const a=t[r];if(typeof a!="function")throw new Error("Cannot use mutex on object property.");return s.value=async function(){const c=this.mutex,d=await c.lock("From P2PConnection.".concat(r));try{for(var h=arguments.length,m=new Array(h),g=0;g<h;g++)m[g]=arguments[g];return await a.apply(this,m)}finally{d()}},s}function iM(t,r){let s=document.createElement("video"),a=document.createElement("canvas");s.setAttribute("style","display:none"),a.setAttribute("style","display:none"),s.setAttribute("muted",""),s.muted=!0,s.setAttribute("autoplay",""),s.autoplay=!0,s.setAttribute("playsinline",""),a.width=Cc(r.width),a.height=Cc(r.height);const c=Cc(r.framerate||15);document.body.append(s),document.body.append(a);let d=t._mediaStreamTrack;s.srcObject=new MediaStream([d]),s.play();const h=a.getContext("2d");if(!h)throw new Pe(te.UNEXPECTED_ERROR,"can not get canvas context");const m=jn(),g=a.captureStream(m.supportRequestFrame?0:c).getVideoTracks()[0];g.canvas||(g.canvas=a),a.startCapture=()=>{if(!s)return a.stopCapture&&a.stopCapture();if(s.paused&&s.play(),s.videoHeight>2&&s.videoWidth>2){const b=s.videoWidth,I=s.videoHeight/b,A=a.width*I;Math.abs(A-a.height)>=2&&(x.debug("adjust low stream resolution","".concat(a.width,"x").concat(a.height," -> ").concat(a.width,"x").concat(A)),a.height=A)}h.drawImage(s,0,0,a.width,a.height),g.requestFrame&&g.requestFrame(),d!==t._mediaStreamTrack&&(d=t._mediaStreamTrack,s.srcObject=new MediaStream([d]))},a.stopCapture=l2(()=>a.startCapture&&a.startCapture(),c);const E=g.stop;return g.stop=()=>{E.call(g),s&&(s.remove(),s.srcObject=null,s=null),a&&(a.width=0,a.remove(),a.stopCapture&&a.stopCapture(),a.startCapture=void 0,a.stopCapture=void 0,a=null),x.debug("clean low stream renderer")},g}var c7=function(t){return t[t.Video_Send_Type=190]="Video_Send_Type",t}(c7||{}),Yd=function(t){return t[t.Video_Send_Qp_Sum=2143]="Video_Send_Qp_Sum",t[t.Video_Send_Freeze=2082]="Video_Send_Freeze",t[t.Video_Recv_Qp_Sum=2144]="Video_Recv_Qp_Sum",t[t.Video_Recv_Freeze=2084]="Video_Recv_Freeze",t[t.Video_Render_Freeze_Time=2109]="Video_Render_Freeze_Time",t[t.Video_Render_Freeze_Time_Render=2147]="Video_Render_Freeze_Time_Render",t[t.Video_Render_Freeze_Time_Render2=2223]="Video_Render_Freeze_Time_Render2",t[t.Audio_Recv_Freeze=2083]="Audio_Recv_Freeze",t}(Yd||{}),tn=function(t){return t[t.Video_Send_Retransmit=2062]="Video_Send_Retransmit",t[t.Video_Send_Target_Encoded=2064]="Video_Send_Target_Encoded",t[t.Video_Send_Actual_Encoded=2060]="Video_Send_Actual_Encoded",t[t.Video_Send_Transmit=2066]="Video_Send_Transmit",t[t.Video_Send_Bandwidth=2061]="Video_Send_Bandwidth",t[t.Video_Capture_Height=2033]="Video_Capture_Height",t[t.Video_Capture_Width=2035]="Video_Capture_Width",t[t.Video_Capture_Frame_Rate=2034]="Video_Capture_Frame_Rate",t[t.Video_Send_Low_Height=2073]="Video_Send_Low_Height",t[t.Video_Send_Low_Frame_Rate=2075]="Video_Send_Low_Frame_Rate",t[t.Video_Send_Low_Width=2077]="Video_Send_Low_Width",t[t.Video_Send_Low_Bitrate=2069]="Video_Send_Low_Bitrate",t[t.Video_Send_Low_Package_Lost=2070]="Video_Send_Low_Package_Lost",t[t.Video_Send_Low_Package_Rate=2071]="Video_Send_Low_Package_Rate",t[t.Video_Send_Frame_Rate=2002]="Video_Send_Frame_Rate",t[t.Video_Send_Width=2003]="Video_Send_Width",t[t.Video_Send_Height=2004]="Video_Send_Height",t[t.Video_Send_Disabled=2095]="Video_Send_Disabled",t[t.Video_Send_Adaptation=2032]="Video_Send_Adaptation",t[t.Video_Send_Player_Status=2128]="Video_Send_Player_Status",t[t.Video_Send_Nacks=2009]="Video_Send_Nacks",t[t.Video_Send_Plis=2010]="Video_Send_Plis",t[t.Video_Send_Firs=2011]="Video_Send_Firs",t[t.Video_Send_Avg_Encode=2007]="Video_Send_Avg_Encode",t[t.Video_Send_Huge_Frame_Sent=2174]="Video_Send_Huge_Frame_Sent",t[t.Video_Send_Bytes_Retransmit=2173]="Video_Send_Bytes_Retransmit",t[t.Video_Send_Packages_Retransmit=2172]="Video_Send_Packages_Retransmit",t[t.Video_Send_Key_Frames_Encoded=2207]="Video_Send_Key_Frames_Encoded",t[t.Video_Send_Bitrate=2012]="Video_Send_Bitrate",t[t.Video_Send_Package_Rate=2031]="Video_Send_Package_Rate",t[t.Video_Send_Package_Lost=2005]="Video_Send_Package_Lost",t[t.Audio_Capture_PCM_Level=2104]="Audio_Capture_PCM_Level",t[t.Audio_Send_Level=2038]="Audio_Send_Level",t[t.Audio_Send_Bitrate=2039]="Audio_Send_Bitrate",t[t.Audio_Send_Package_Rate=2040]="Audio_Send_Package_Rate",t[t.Audio_Send_AEC_Return_Loss=2041]="Audio_Send_AEC_Return_Loss",t[t.Audio_Send_AEC_Return_Loss_Enhancement=2042]="Audio_Send_AEC_Return_Loss_Enhancement",t[t.Audio_Send_Freeze=2081]="Audio_Send_Freeze",t[t.Audio_Send_Disabled=2096]="Audio_Send_Disabled",t[t.Audio_Send_Bytes_Retransmit=2179]="Audio_Send_Bytes_Retransmit",t[t.Audio_Send_Packages_Retransmit=2180]="Audio_Send_Packages_Retransmit",t[t.Video_Recv_Height=2019]="Video_Recv_Height",t[t.Video_Recv_Width=2018]="Video_Recv_Width",t[t.Video_Recv_Frame_Rate_Output=2155]="Video_Recv_Frame_Rate_Output",t[t.Video_Recv_Jitter_Buffer=2023]="Video_Recv_Jitter_Buffer",t[t.Video_Recv_Current_Delay=2024]="Video_Recv_Current_Delay",t[t.Video_Recv_Nacks=2026]="Video_Recv_Nacks",t[t.Video_Recv_Plis=2027]="Video_Recv_Plis",t[t.Video_Recv_Firs=2028]="Video_Recv_Firs",t[t.Video_Recv_Disabled=2101]="Video_Recv_Disabled",t[t.Video_Recv_Player_Status=2129]="Video_Recv_Player_Status",t[t.Video_Recv_I_Frame_Delay=2149]="Video_Recv_I_Frame_Delay",t[t.Video_Render_Frame_Rate_Render=2022]="Video_Render_Frame_Rate_Render",t[t.Video_Render_Freeze_Duration=2156]="Video_Render_Freeze_Duration",t[t.Audio_Render_Level=2043]="Audio_Render_Level",t[t.Audio_Render_Freeze_Time_80ms=2226]="Audio_Render_Freeze_Time_80ms",t[t.Audio_Render_Freeze_Time_200ms=2227]="Audio_Render_Freeze_Time_200ms",t[t.Audio_Render_Freeze_Samples_80ms=2228]="Audio_Render_Freeze_Samples_80ms",t[t.Audio_Render_Freeze_Samples_200ms=2229]="Audio_Render_Freeze_Samples_200ms",t[t.Audio_Recv_PCM_Level=2105]="Audio_Recv_PCM_Level",t[t.Audio_Recv_Disabled=2102]="Audio_Recv_Disabled",t[t.Audio_Recv_Jitter_Buffer=2054]="Audio_Recv_Jitter_Buffer",t[t.Audio_Recv_Current_Delay=2047]="Audio_Recv_Current_Delay",t[t.Audio_Recv_Player_Status=2130]="Audio_Recv_Player_Status",t[t.Audio_Recv_Bitrate=2044]="Audio_Recv_Bitrate",t[t.Audio_Recv_Concealed_Samples=2148]="Audio_Recv_Concealed_Samples",t[t.Audio_Recv_Total_Samples_Received=2224]="Audio_Recv_Total_Samples_Received",t}(tn||{}),Cs=function(t){return t[t.Video_Render_Frame_Rate_Decode=2021]="Video_Render_Frame_Rate_Decode",t[t.Video_Recv_Frame_Rate=2020]="Video_Recv_Frame_Rate",t[t.Video_Recv_Frame_Dropped=2181]="Video_Recv_Frame_Dropped",t[t.Video_Recv_Bytes_Retransmit=2175]="Video_Recv_Bytes_Retransmit",t[t.Video_Recv_Packages_Retransmit=2176]="Video_Recv_Packages_Retransmit",t[t.Video_Recv_Packages_Discarded=2198]="Video_Recv_Packages_Discarded",t[t.Video_Recv_Avg_Decode=2200]="Video_Recv_Avg_Decode",t[t.Video_Recv_Avg_Processing_Delay=2202]="Video_Recv_Avg_Processing_Delay",t[t.Video_Recv_Avg_Assembly_Time=2203]="Video_Recv_Avg_Assembly_Time",t[t.Video_Recv_Avg_Inter_Frame_Delay=2204]="Video_Recv_Avg_Inter_Frame_Delay",t[t.Video_Recv_Key_Frames_Decoded=2206]="Video_Recv_Key_Frames_Decoded",t[t.Video_Recv_Package_Lost=2014]="Video_Recv_Package_Lost",t[t.Video_Recv_Bitrate=2029]="Video_Recv_Bitrate",t[t.Video_Recv_Package_Rate=2078]="Video_Recv_Package_Rate",t[t.Audio_Recv_Jitter=2055]="Audio_Recv_Jitter",t[t.Audio_Recv_Bytes_Retransmit=2178]="Audio_Recv_Bytes_Retransmit",t[t.Audio_Recv_Packages_Retransmit=2177]="Audio_Recv_Packages_Retransmit",t[t.Audio_Recv_Packages_Discarded=2199]="Audio_Recv_Packages_Discarded",t[t.Audio_Recv_Avg_Processing_Delay=2201]="Audio_Recv_Avg_Processing_Delay",t[t.Audio_Recv_Package_Rate=2046]="Audio_Recv_Package_Rate",t[t.Audio_Recv_Package_Lost=2045]="Audio_Recv_Package_Lost",t}(Cs||{}),Ta=function(t){return t[t.RTT=2006]="RTT",t[t.CONN_TYPE=801]="CONN_TYPE",t[t.STATS_UPDATE_INTERVAL=2205]="STATS_UPDATE_INTERVAL",t}(Ta||{}),s1=function(t){return t[t.RTC_PEER_CONNECTION_STATE=2219]="RTC_PEER_CONNECTION_STATE",t}(s1||{});const hy=1e3,o1=6,gT=3,w_e=Math.max(o1,gT,60);function Wt(t,r,s){s!=null&&Number.isFinite(s)&&(t[r]=Math.round(Math.max(0,s)))}function l7(t){const r={[Ta.CONN_TYPE]:0,[Ta.RTT]:t.rtt,[Ta.STATS_UPDATE_INTERVAL]:t.updateInterval?Math.round(Math.max(0,t.updateInterval)):void 0};switch(t.selectedCandidatePair.localCandidate.candidateType){case"relay":{const s=t.selectedCandidatePair.localCandidate.relayProtocol;s==="udp"&&(r[Ta.CONN_TYPE]=1),s==="tcp"&&(r[Ta.CONN_TYPE]=3),s==="tls"&&(r[Ta.CONN_TYPE]=4);break}case"srflx":r[Ta.CONN_TYPE]=2;break;case"unknown":r[Ta.CONN_TYPE]=5;break;default:r[Ta.CONN_TYPE]=0}return r}function u7(t){let r=0;switch(t){case"none":r=0;break;case"cpu":r=1;break;case"bandwidth":r=2;break;case"other":r=3}return r}class d7 extends Jr{constructor(r){super(),Y(this,"store",void 0),Y(this,"uploadWRTCStatsTimer",void 0),Y(this,"uploadOutboundDenoiserStatsTimer",void 0),Y(this,"uploadExtStatsTimer",void 0),Y(this,"uploadExtUsageStatsTimer",void 0),Y(this,"uploadInboundExtStatsTimer",void 0),Y(this,"requestStats",void 0),Y(this,"requestTransportStats",void 0),Y(this,"requestLocalMedia",void 0),Y(this,"requestRemoteMedia",void 0),Y(this,"requestAllTracks",void 0),Y(this,"requestVideoIsReady",void 0),Y(this,"requestUploadStats",void 0),Y(this,"requestUpload",void 0),Y(this,"uploadOutboundStarted",!1),Y(this,"uploadInboundStarted",!1),Y(this,"uploadTransportStarted",!1),Y(this,"uploadBaseStatsStarted",!1),Y(this,"uploadExtensionUsageStarted",!1),Y(this,"lastRecvStats",void 0),Y(this,"lastSendStats",void 0),Y(this,"lastRefRecvStats",void 0),Y(this,"lastRefSendStats",void 0),Y(this,"lastNormalRecvStats",void 0),Y(this,"lastNormalSendStats",void 0),Y(this,"lastExtendStats",{}),Y(this,"needUploadStats",{}),Y(this,"needUploadRenderFreezeTime",!0),Y(this,"lastUploadCompensateTime",-1),Y(this,"uploadCompensateDeltaTime",0),this.store=r}uploadWRTCStats(r){if(!this.requestStats||!this.requestUploadStats)return;const s=r%gT==0,a=r%o1==0,c=r%60==0;let d,h;if(this.uploadTransportStarted&&(d=this.requestStats(),this.store.useP2P&&(h=this.requestStats(!0))),!d&&this.uploadOutboundStarted&&(d=this.requestStats()),!h&&this.uploadInboundStarted&&(h=this.requestStats(!0)),d||h){var m;const g={};if(this.uploadTransportStarted&&d){const b=this.getTransportStats(d,h,s);b&&(g.misc=[b])}if(this.uploadOutboundStarted&&d){const b=this.getOutboundStats(d,a?this.lastNormalSendStats:void 0,s?this.lastRefSendStats:void 0,this.lastSendStats,c);b&&(g.outbound=[b])}if(this.uploadInboundStarted&&h){this.uploadCompensateStats(r);const b=this.getInboundStats(h,a?this.lastNormalRecvStats:void 0,s?this.lastRefRecvStats:void 0,this.lastRecvStats);b&&(g.inbound=b)}const E=(m=this.requestTransportStats)===null||m===void 0?void 0:m.call(this).connectState;E&&(Array.isArray(g.misc)?g.misc[0]&&g.misc[0].addition&&(g.misc[0].addition[s1.RTC_PEER_CONNECTION_STATE]=KL[E]):g.misc=[{addition:{[s1.RTC_PEER_CONNECTION_STATE]:KL[E]}}]),this.needUploadStats.sendType&&(Array.isArray(g.outbound)&&g.outbound[0]&&g.outbound[0].high&&(g.outbound[0].high[c7.Video_Send_Type]=this.needUploadStats.sendType),this.needUploadStats.sendType=void 0),this.requestUploadStats(g)}this.lastRecvStats=h,this.lastSendStats=d,a&&(this.lastNormalRecvStats=h,this.lastNormalSendStats=d),s&&(this.lastRefRecvStats=h,this.lastRefSendStats=d)}startUploadWRTCStats(){if(this.uploadWRTCStatsTimer)return;this.uploadBaseStatsStarted=!0;let r=1;this.uploadWRTCStatsTimer=window.setInterval(()=>{if(!this.uploadTransportStarted&&!this.uploadInboundStarted&&!this.uploadOutboundStarted){if(this.uploadBaseStatsStarted){var s,a;const c=(s=this.requestTransportStats)===null||s===void 0?void 0:s.call(this);return void(c&&((a=this.requestUploadStats)===null||a===void 0||a.call(this,{misc:[{addition:{[s1.RTC_PEER_CONNECTION_STATE]:KL[c.connectState]}}]})))}return this.stopUploadWRTCStats()}this.uploadWRTCStats(r),++r===w_e+1&&(r=1)},hy)}uploadCompensateStats(r){if(!this.requestStats||!this.requestUploadStats||!this.requestRemoteMedia)return;const s=r%gT==0&&this.needUploadRenderFreezeTime;if(!this.uploadInboundStarted||!s)return;if(this.lastUploadCompensateTime===-1)return void(this.lastUploadCompensateTime=Date.now());const a=Math.max(-6e3,Date.now()-this.lastUploadCompensateTime-6e3);if(this.uploadCompensateDeltaTime+=a,this.lastUploadCompensateTime=Date.now(),this.uploadCompensateDeltaTime<6e3)return;const c=Math.min(Math.floor(this.uploadCompensateDeltaTime/6e3),10);this.uploadCompensateDeltaTime-=6e3*c;const d=this.requestStats(!0);new Array(c).fill(0).forEach(()=>{if(!this.requestStats||!this.requestUploadStats||!this.requestRemoteMedia)return;const h={};if(this.uploadInboundStarted&&d){const m=this.requestRemoteMedia()||[],g=[];m.forEach(E=>{let[b,I]=E;const A={peer:b.uid};if(b._videoSSRC&&this.requestVideoIsReady&&this.requestVideoIsReady(b._videoSSRC)&&I.has(yt.VIDEO)&&b.videoTrack){const k=function(W,j,B){if(!j.videoRecv.find(Z=>Z.ssrc===W))return;const ee={};if(B&&B._player){const Z=B._player,{renderFreezeAccTime2:oe,videoElementStatus:ye}=Z;if(qh.visibility==="visible"&&ye===Xs.PLAYING&&jn().supportRequestVideoFrameCallback){const _e=Math.min(6e3,oe);Z.renderFreezeAccTime2=Math.max(0,oe-_e),Wt(ee,Yd.Video_Render_Freeze_Time_Render2,_e),se("USE_NEW_RENDER_FREEZE_TIME")&&Wt(ee,Yd.Video_Render_Freeze_Time_Render,_e)}}return ee}(b._videoSSRC,d,b.videoTrack);k&&(A.video=k)}A.video&&g.push(A)}),g.length>0&&(h.inbound=g,this.requestUploadStats(h))}})}stopUploadWRTCStats(){window.clearInterval(this.uploadWRTCStatsTimer),this.uploadWRTCStatsTimer=void 0,this.lastSendStats&&(this.lastSendStats.videoSend=[],this.lastSendStats.audioSend=[],this.lastSendStats=void 0),this.lastRecvStats&&(this.lastRecvStats.videoRecv=[],this.lastRecvStats.audioRecv=[],this.lastRecvStats=void 0),this.lastRefSendStats&&(this.lastRefSendStats.videoSend=[],this.lastRefSendStats.audioSend=[],this.lastRefSendStats=void 0),this.lastRefRecvStats&&(this.lastRefRecvStats.videoRecv=[],this.lastRefRecvStats.audioRecv=[],this.lastRefRecvStats=void 0),this.lastNormalSendStats&&(this.lastNormalSendStats.videoSend=[],this.lastNormalSendStats.audioSend=[],this.lastNormalSendStats=void 0),this.lastNormalRecvStats&&(this.lastNormalRecvStats.videoRecv=[],this.lastNormalRecvStats.audioRecv=[],this.lastNormalRecvStats=void 0),this.lastExtendStats={},this.needUploadStats={},this.lastUploadCompensateTime=-1,this.uploadCompensateDeltaTime=0,this.needUploadRenderFreezeTime=!0}getTransportStats(r,s,a){if(!this.requestStats)return;if(!a)return r.rtt==null?void 0:{addition:{[Ta.RTT]:r.rtt,[Ta.CONN_TYPE]:void 0,[Ta.STATS_UPDATE_INTERVAL]:r.updateInterval||void 0}};const c=l7(r);if(this.store.useP2P){if(s){const d=l7(s);c[Ta.CONN_TYPE]+=d[Ta.CONN_TYPE]<<3}c[Ta.CONN_TYPE]+=110}else c[Ta.CONN_TYPE]+=100;return{addition:c}}getOutboundStats(r,s,a,c,d){if(!this.requestUploadStats||!this.requestLocalMedia)return;const h=this.requestLocalMedia();if(!h||h.length===0)return;let m,g,E;return h.forEach(b=>{let[I,{track:A,ssrcs:k}]=b;switch(I){case qe.LocalVideoLowTrack:case qe.LocalVideoTrack:if(I===qe.LocalVideoTrack){var W;const j=function(oe,ye,_e,ue,Ce,Ue){const ze=ye.videoSend.find(Xt=>Xt.ssrc===oe);if(!ze)return;const Je={},{sentFrame:hn,inputFrame:vn}=ze;if(ue&&(Wt(Je,Yd.Video_Send_Qp_Sum,ze.qpSumPerFrame),vn&&hn)){const Xt=vn.frameRate,nr=hn.frameRate;Je[Yd.Video_Send_Freeze]=function(Kn,eo){let Be=!0;return Be=!(Kn<=5)&&(Kn<=10?eo<3:Kn<=20?eo<4:eo<5),Be}(Xt,nr)?1:0}if(Ce){switch(hn&&(Wt(Je,tn.Video_Send_Height,hn.height),Wt(Je,tn.Video_Send_Width,hn.width),Wt(Je,tn.Video_Send_Frame_Rate,hn.frameRate)),Je[tn.Video_Send_Disabled]=_e._originMediaStreamTrack&&!_e._originMediaStreamTrack.enabled||_e._mediaStreamTrack&&!_e._mediaStreamTrack.enabled?1:0,ze.adaptionChangeReason){case"none":Je[tn.Video_Send_Adaptation]=0;break;case"cpu":Je[tn.Video_Send_Adaptation]=1;break;case"bandwidth":Je[tn.Video_Send_Adaptation]=2;break;case"other":Je[tn.Video_Send_Adaptation]=3}let Xt=0;ze.adaptionChangeReason&&(Xt+=u7(ze.adaptionChangeReason)),ye.qualityLimitationReason&&(Xt+=u7(ye.qualityLimitationReason)<<3),Je[tn.Video_Send_Adaptation]=Xt,Je[tn.Video_Send_Player_Status]=a2[_e._player?_e._player.videoElementStatus:"uninit"],Wt(Je,tn.Video_Send_Nacks,ze.nacksCount),Wt(Je,tn.Video_Send_Plis,ze.plisCount),Wt(Je,tn.Video_Send_Firs,ze.firsCount),Wt(Je,tn.Video_Send_Avg_Encode,ze.avgEncodeMs),Wt(Je,tn.Video_Send_Huge_Frame_Sent,ze.hugeFramesSent),Wt(Je,tn.Video_Send_Bytes_Retransmit,ze.retransmittedBytesSent),Wt(Je,tn.Video_Send_Packages_Retransmit,ze.retransmittedPacketsSent),Wt(Je,tn.Video_Send_Key_Frames_Encoded,ze.keyFramesEncoded);const nr=Ce.videoSend.find(Kn=>Kn.ssrc===oe);if(nr){let Kn=hy*gT;nr.timestamp&&ze.timestamp&&(Kn=ze.timestamp-nr.timestamp),nr.packets!=null&&ze.packets!=null&&Wt(Je,tn.Video_Send_Package_Rate,1e3*(ze.packets-nr.packets)/Kn),ze.packetsLost!=null&&nr.packetsLost!=null&&Wt(Je,tn.Video_Send_Package_Lost,ze.packetsLost-nr.packetsLost),nr.bytes!=null&&ze.bytes!=null&&Wt(Je,tn.Video_Send_Bitrate,8*(ze.bytes-nr.bytes)/Kn)}}return Je}(k[0].ssrcId,r,A,s,a),B=A.__className__==="CameraVideoTrack"?3:rt(W=A._hints).call(W,yr.SCREEN_TRACK)?7:10;(this.lastExtendStats.sendType!==B||d)&&(this.needUploadStats={sendType:B},this.lastExtendStats.sendType=B);const ee=A&&function(oe,ye,_e,ue){const Ce=ye.videoSend.find(ze=>ze.ssrc===oe);if(!Ce)return null;const Ue={};if(ue){const ze=Ce.inputFrame,Je=ze&&ze.height||_e.videoHeight||0,hn=ze&&ze.width||_e.videoWidth||0,vn=ze&&ze.frameRate||0;Wt(Ue,tn.Video_Capture_Height,Je),Wt(Ue,tn.Video_Capture_Width,hn),Wt(Ue,tn.Video_Capture_Frame_Rate,vn)}return Ue}(k[0].ssrcId,r,A,!!a),Z=function(oe,ye){const _e={};return ye&&(Wt(_e,tn.Video_Send_Retransmit,oe.bitrate.retransmit),Wt(_e,tn.Video_Send_Target_Encoded,oe.bitrate.targetEncoded),Wt(_e,tn.Video_Send_Actual_Encoded,oe.bitrate.actualEncoded),Wt(_e,tn.Video_Send_Transmit,oe.bitrate.transmit),Wt(_e,tn.Video_Send_Bandwidth,oe.sendBandwidth)),_e}(r,!!a);g=Object.assign({},j,ee,Z)}else E=function(j,B,ee,Z,oe){const ye=B.videoSend.find(ue=>ue.ssrc===j);if(!ye)return;const _e={};if(Z){const ue=ye.sentFrame;ue&&(Wt(_e,tn.Video_Send_Low_Height,ue.height),Wt(_e,tn.Video_Send_Low_Width,ue.width),Wt(_e,tn.Video_Send_Low_Frame_Rate,ue.frameRate));const Ce=Z.videoSend.find(Ue=>Ue.ssrc===j);if(Ce){let Ue=hy*o1;Ce.timestamp&&ye.timestamp&&(Ue=ye.timestamp-Ce.timestamp),Ce.packets!=null&&ye.packets!=null&&Wt(_e,tn.Video_Send_Low_Package_Rate,1e3*(ye.packets-Ce.packets)/Ue),ye.packetsLost!=null&&Ce.packetsLost!=null&&Wt(_e,tn.Video_Send_Low_Package_Lost,ye.packetsLost-Ce.packetsLost),Ce.bytes!=null&&ye.bytes!=null&&Wt(_e,tn.Video_Send_Low_Bitrate,8*(ye.bytes-Ce.bytes)/Ue)}}return _e}(k[0].ssrcId,r,0,a);break;case qe.LocalAudioTrack:m=A&&function(j,B,ee,Z,oe,ye){const _e=B.audioSend.find(Ce=>Ce.ssrc===j);if(!_e)return;const ue={};if(oe){ue[tn.Audio_Send_Disabled]=ee._originMediaStreamTrack&&!ee._originMediaStreamTrack.enabled||ee._mediaStreamTrack&&!ee._mediaStreamTrack.enabled?1:0;const Ce=100*ee._source.getAccurateVolumeLevel(),Ue=_e.inputLevel;if(Ue!=null){const Je=Math.ceil(50*Math.log10(100*Ue+1));Wt(ue,tn.Audio_Send_Level,Je)}Wt(ue,tn.Audio_Capture_PCM_Level,Ce),Wt(ue,tn.Audio_Send_AEC_Return_Loss,_e.aecReturnLoss),Wt(ue,tn.Audio_Send_AEC_Return_Loss_Enhancement,_e.aecReturnLossEnhancement),Wt(ue,tn.Audio_Send_Bytes_Retransmit,_e.retransmittedBytesSent),Wt(ue,tn.Audio_Send_Packages_Retransmit,_e.retransmittedPacketsSent),ue[tn.Audio_Send_Freeze]=0;const ze=oe.audioSend.find(Je=>Je.ssrc===j);if(ze){let Je=hy*o1;ze.timestamp&&_e.timestamp&&(Je=_e.timestamp-ze.timestamp),ze.bytes!=null&&_e.bytes!=null&&Wt(ue,tn.Audio_Send_Bitrate,8*(_e.bytes-ze.bytes)/Je),ze.packets!=null&&_e.packets!=null&&Wt(ue,tn.Audio_Send_Package_Rate,1e3*(_e.packets-ze.packets)/Je)}}return ue}(k[0].ssrcId,r,A,0,a)}}),{high:g,low:E,audio:m}}getInboundStats(r,s,a,c){if(!this.requestRemoteMedia)return;const d=this.requestRemoteMedia()||[],h=[];return d.forEach(m=>{let[g,E]=m;const b={peer:g.uid};if(E.has(yt.VIDEO)&&g.videoTrack){const I=g._videoSSRC&&this.requestVideoIsReady&&this.requestVideoIsReady(g._videoSSRC)||!1,A=g.videoTrack?function(k,W,j,B,ee,Z,oe,ye){const _e=W.videoRecv.find(Xt=>Xt.ssrc===k);if(!_e)return;const ue={},{receivedFrame:Ce,outputFrame:Ue,decodeFrameRate:ze}=_e;Wt(ue,Cs.Video_Render_Frame_Rate_Decode,ze),_e.framesRateFirefox&&Wt(ue,Cs.Video_Recv_Frame_Rate,_e.framesRateFirefox),Ce&&Wt(ue,Cs.Video_Recv_Frame_Rate,Ce.frameRate),Wt(ue,Cs.Video_Recv_Frame_Dropped,_e.framesDroppedCount),Wt(ue,Cs.Video_Recv_Bytes_Retransmit,_e.retransmittedBytesReceived),Wt(ue,Cs.Video_Recv_Packages_Retransmit,_e.retransmittedPacketsReceived),Wt(ue,Cs.Video_Recv_Packages_Discarded,_e.packetsDiscarded),Wt(ue,Cs.Video_Recv_Avg_Decode,_e.avgDecodeMs),Wt(ue,Cs.Video_Recv_Avg_Processing_Delay,_e.avgProcessingDelayMs),Wt(ue,Cs.Video_Recv_Avg_Assembly_Time,_e.avgFramesAssembledFromMultiplePacketsMs),Wt(ue,Cs.Video_Recv_Avg_Inter_Frame_Delay,_e.avgInterFrameDelayMs),Wt(ue,Cs.Video_Recv_Key_Frames_Decoded,_e.keyFramesDecoded);const Je=ye&&ye.videoRecv.find(Xt=>Xt.ssrc===k);if(Je){const Xt=W.timestamp-ye.timestamp||hy;_e.packetsLost!=null&&Je.packetsLost!=null&&Wt(ue,Cs.Video_Recv_Package_Lost,_e.packetsLost-Je.packetsLost),Je.bytes!=null&&_e.bytes!=null&&Wt(ue,Cs.Video_Recv_Bitrate,8*(_e.bytes-Je.bytes)/Xt),Je.packets!=null&&_e.packets!=null&&Wt(ue,Cs.Video_Recv_Package_Rate,1e3*(_e.packets-Je.packets)/Xt)}const hn=Z&&Z.videoRecv.find(Xt=>Xt.ssrc===k);if(hn&&(Wt(ue,Yd.Video_Recv_Qp_Sum,_e.qpSumPerFrame),ue[Yd.Video_Recv_Freeze]=B&&mT.isRemoteVideoFreeze(j,_e,hn)?1:0),oe){var vn;const Xt=oe.videoRecv.find(Kn=>Kn.ssrc===k);Ce?(Wt(ue,tn.Video_Recv_Height,Ce.height),Wt(ue,tn.Video_Recv_Width,Ce.width)):j&&(Wt(ue,tn.Video_Recv_Height,j._videoHeight||0),Wt(ue,tn.Video_Recv_Width,j._videoWidth||0)),Ue&&Wt(ue,tn.Video_Recv_Frame_Rate_Output,Ue.frameRate);const nr=(vn=j._player)===null||vn===void 0?void 0:vn.rendFrameRate.toFixed(0);if(nr&&Wt(ue,tn.Video_Render_Frame_Rate_Render,+nr),Wt(ue,tn.Video_Recv_Jitter_Buffer,_e.jitterBufferMs),Wt(ue,tn.Video_Recv_Current_Delay,_e.currentDelayMs),Wt(ue,tn.Video_Recv_Firs,_e.firsCount),Wt(ue,tn.Video_Recv_Nacks,_e.nacksCount),Wt(ue,tn.Video_Recv_Plis,_e.plisCount),j){ue[tn.Video_Recv_Disabled]=j._originMediaStreamTrack.enabled&&j._mediaStreamTrack.enabled?0:1;const Kn=j._player;if(Kn){const{freezeTimeCounterList:eo,renderFreezeAccTime:Be,renderFreezeAccTime2:st,videoElementStatus:bt}=Kn;if(eo&&eo.length>0&&Wt(ue,Yd.Video_Render_Freeze_Time,eo.splice(0,1)[0]),ee&&qh.visibility==="visible"&&bt===Xs.PLAYING&&jn().supportRequestVideoFrameCallback){const He=Math.min(6e3,st);Kn.renderFreezeAccTime2=Math.max(0,st-He),Wt(ue,Yd.Video_Render_Freeze_Time_Render2,He);const V=Math.min(6e3,Be);Kn.renderFreezeAccTime=Math.max(0,Be-V),Wt(ue,Yd.Video_Render_Freeze_Time_Render,se("USE_NEW_RENDER_FREEZE_TIME")?He:V)}if(typeof _e.totalFreezesDuration=="number"){const He=Xt&&Xt.totalFreezesDuration?_e.totalFreezesDuration-Xt.totalFreezesDuration:_e.totalFreezesDuration;Wt(ue,tn.Video_Render_Freeze_Duration,1e3*He)}}}if(ue[tn.Video_Recv_Player_Status]=a2[j._player?j._player.videoElementStatus:"uninit"],Xt&&_e.totalInterFrameDelay!==void 0&&_e.totalSquaredInterFrameDelay!==void 0&&Xt.totalInterFrameDelay!==void 0&&Xt.totalSquaredInterFrameDelay!==void 0){const Kn=_e.totalInterFrameDelay-Xt.totalInterFrameDelay,eo=_e.totalSquaredInterFrameDelay-Xt.totalSquaredInterFrameDelay,Be=_e.framesDecodeCount-Xt.framesDecodeCount,st=Kn/Be*1e3,bt=Math.round(1e3*Math.sqrt((eo-Math.pow(Kn,2)/Be)/Be));!isNaN(bt)&&st+bt>Math.max(3*st,st+150)&&(ue[tn.Video_Recv_I_Frame_Delay]=bt)}}return ue}(g._videoSSRC,r,g.videoTrack,I===!0,this.needUploadRenderFreezeTime,s,a,c):void 0;A&&(b.video=A)}if(E.has(yt.AUDIO)&&g.audioTrack){const I=g.audioTrack?function(A,k,W,j,B,ee){const Z=k.audioRecv.find(ue=>ue.ssrc===A);if(!Z)return;const oe={};Wt(oe,Cs.Audio_Recv_Jitter,Z.jitterMs),Wt(oe,Cs.Audio_Recv_Bytes_Retransmit,Z.retransmittedBytesReceived),Wt(oe,Cs.Audio_Recv_Packages_Retransmit,Z.retransmittedPacketsReceived),Wt(oe,Cs.Audio_Recv_Packages_Discarded,Z.packetsDiscarded),Wt(oe,Cs.Audio_Recv_Avg_Processing_Delay,Z.avgProcessingDelayMs);const ye=ee&&ee.audioRecv.find(ue=>ue.ssrc===A);if(ye){const ue=hy;Z.packets!=null&&ye.packets!=null&&Wt(oe,Cs.Audio_Recv_Package_Rate,1e3*(Z.packets-ye.packets)/ue),Z.packetsLost!=null&&ye.packetsLost!=null&&Wt(oe,Cs.Audio_Recv_Package_Lost,Z.packetsLost-ye.packetsLost)}if(j){const{receivedFrames:ue,droppedFrames:Ce}=Z;ue!=null&&Ce!=null&&(oe[Yd.Audio_Recv_Freeze]=(_e=ue)===0||100*Ce/_e>20?1:0)}var _e;if(B){const ue=100*W._source.getAccurateVolumeLevel(),Ce=Z.outputLevel;if(Ce!=null){const ze=Math.ceil(50*Math.log10(100*Ce+1));Wt(oe,tn.Audio_Render_Level,ze)}Wt(oe,tn.Audio_Recv_PCM_Level,ue),W&&(oe[tn.Audio_Recv_Disabled]=W._originMediaStreamTrack.enabled&&W._mediaStreamTrack.enabled?0:1),Wt(oe,tn.Audio_Recv_Jitter_Buffer,Z.jitterBufferMs),Wt(oe,tn.Audio_Recv_Current_Delay,Z.jitterBufferMs),oe[tn.Audio_Recv_Player_Status]=a2[ba.getPlayerState(W.getTrackId())];const Ue=B.audioRecv.find(ze=>ze.ssrc===A);if(Ue){Ue.bytes!=null&&Z.bytes!=null&&Wt(oe,tn.Audio_Recv_Bitrate,8*(Z.bytes-Ue.bytes)/(hy*gT));const ze=Z.concealedSamples-Ue.concealedSamples;ze>0&&Wt(oe,tn.Audio_Recv_Concealed_Samples,ze);const Je=Z.totalSamplesReceived-Ue.totalSamplesReceived;Je>0&&Wt(oe,tn.Audio_Recv_Total_Samples_Received,Je);const hn=Z.freezeSamples80-Ue.freezeSamples80;hn>0&&Wt(oe,tn.Audio_Render_Freeze_Samples_80ms,hn);const vn=Z.freezeSamples200-Ue.freezeSamples200;vn>0&&Wt(oe,tn.Audio_Render_Freeze_Samples_200ms,vn);const Xt=Z.freezeMs80-Ue.freezeMs80;Wt(oe,tn.Audio_Render_Freeze_Time_80ms,Xt<0?0:Xt);const nr=Z.freezeMs200-Ue.freezeMs200;Wt(oe,tn.Audio_Render_Freeze_Time_200ms,nr<0?0:nr)}}return oe}(g._audioSSRC,r,g.audioTrack,s,a,c):void 0;I&&(b.audio=I)}(b.video||b.audio)&&h.push(b)}),this.needUploadRenderFreezeTime=!this.needUploadRenderFreezeTime,h}startUploadTransportStats(){this.uploadTransportStarted=!0,this.uploadWRTCStatsTimer||this.startUploadWRTCStats()}stopUploadTransportStats(){this.uploadTransportStarted=!1}startUploadOutboundStats(){this.uploadOutboundStarted||(this.uploadOutboundStarted=!0,this.uploadWRTCStatsTimer||this.startUploadWRTCStats(),this.uploadOutboundDenoiserStatsTimer&&window.clearInterval(this.uploadOutboundDenoiserStatsTimer),this.uploadOutboundDenoiserStatsTimer=window.setInterval(()=>{if(!this.requestAllTracks||!this.requestUpload)return;const r=(this.requestAllTracks()||[]).find(s=>s instanceof rT);if(r&&r._external.getDenoiserStats){const s=r._external.getDenoiserStats();s&&this.requestUpload(sT.DENOISER_STATS,s)}},2e3),this.uploadExtStatsTimer&&window.clearInterval(this.uploadExtStatsTimer),this.uploadExtStatsTimer=window.setInterval(()=>{!this.requestAllTracks||!this.requestUpload||this.requestAllTracks().forEach(r=>{r.getProcessorStats().forEach(s=>{this.requestUpload&&this.requestUpload(s.type,s.stats)})})},2e3))}stopUploadOutboundStats(){this.uploadOutboundStarted&&(this.uploadOutboundStarted=!1,this.lastSendStats&&(this.lastSendStats.videoSend=[],this.lastSendStats.audioSend=[],this.lastSendStats=void 0),this.lastRefSendStats&&(this.lastRefSendStats.videoSend=[],this.lastRefSendStats.audioSend=[],this.lastRefSendStats=void 0),this.lastNormalSendStats&&(this.lastNormalSendStats.videoSend=[],this.lastNormalSendStats.audioSend=[],this.lastNormalSendStats=void 0),this.lastExtendStats={},this.needUploadStats={},this.uploadOutboundDenoiserStatsTimer&&window.clearInterval(this.uploadOutboundDenoiserStatsTimer),this.uploadOutboundDenoiserStatsTimer=void 0,this.uploadExtStatsTimer&&window.clearInterval(this.uploadExtStatsTimer),this.uploadExtStatsTimer=void 0)}startUploadInboundStats(){this.uploadInboundStarted||(this.uploadInboundStarted=!0,this.uploadWRTCStatsTimer||this.startUploadWRTCStats(),this.uploadInboundExtStatsTimer&&window.clearInterval(this.uploadInboundExtStatsTimer),this.uploadInboundExtStatsTimer=window.setInterval(()=>{!this.requestUpload||!this.requestRemoteMedia||(this.requestRemoteMedia()||[]).forEach(r=>{let[s,a]=r;a.has(yt.VIDEO)&&s.videoTrack&&s.videoTrack.getProcessorStats().forEach(c=>{this.requestUpload&&this.requestUpload(c.type,c.stats)}),a.has(yt.AUDIO)&&s.audioTrack&&s.audioTrack.getProcessorStats().forEach(c=>{this.requestUpload&&this.requestUpload(c.type,c.stats)})})},2e3))}stopUploadInboundStats(){this.uploadInboundStarted&&(this.uploadInboundStarted=!1,this.lastRecvStats&&(this.lastRecvStats.videoRecv=[],this.lastRecvStats.audioRecv=[],this.lastRecvStats=void 0),this.lastRefRecvStats&&(this.lastRefRecvStats.videoRecv=[],this.lastRefRecvStats.audioRecv=[],this.lastRefRecvStats=void 0),this.lastNormalRecvStats&&(this.lastNormalRecvStats.videoRecv=[],this.lastNormalRecvStats.audioRecv=[],this.lastNormalRecvStats=void 0),this.lastUploadCompensateTime=-1,this.uploadCompensateDeltaTime=0,this.needUploadRenderFreezeTime=!0,this.uploadInboundExtStatsTimer&&window.clearInterval(this.uploadInboundExtStatsTimer),this.uploadInboundExtStatsTimer=void 0)}startUploadExtensionUsageStats(){if(this.uploadExtensionUsageStarted)return;this.uploadExtensionUsageStarted=!0,this.uploadExtUsageStatsTimer&&window.clearInterval(this.uploadExtUsageStatsTimer);const r=new Map;this.uploadExtUsageStatsTimer=window.setInterval(async()=>{const s=Date.now(),a={connectionInterval:se("EXTENSION_USAGE_UPLOAD_INTERVAL")/1e3,details:[],lts:s};let c=[];const d=this.requestAllTracks&&this.requestAllTracks()||[];for(const E of d)!E.muted&&E.enabled&&(c=c.concat(await E.getProcessorUsage()));const h=this.requestRemoteMedia&&this.requestRemoteMedia()||[];for(const[E,b]of h)b.has(yt.VIDEO)&&E.videoTrack&&(c=c.concat(await E.videoTrack.getProcessorUsage())),b.has(yt.AUDIO)&&E.audioTrack&&(c=c.concat(await E.audioTrack.getProcessorUsage()));if(c.length===0)return;a.details=function(E,b){const I={};for(const{id:j,value:B,level:ee,direction:Z}of E){var A;const oe=(A=b.get(j))!==null&&A!==void 0?A:0,ye=B===2?oe+se("EXTENSION_USAGE_UPLOAD_INTERVAL")/1e3:oe;var k,W;b.set(j,ye),I[j]?(B===2&&(I[j].value=B),ee>I[j].level&&(I[j].level=ee),Z==="remote"&&(I[j].remoteUidCount+=1),I[j].totalTs=(k=b.get(j))!==null&&k!==void 0?k:0):I[j]={value:B,level:ee,remoteUidCount:Z==="local"?0:1,totalTs:(W=b.get(j))!==null&&W!==void 0?W:0}}return Object.keys(I).map(j=>{const{level:B,value:ee,totalTs:Z}=I[j];return{id:j,level:B,value:ee,totalTs:Z}})}(c,r);const m=Date.now(),g=m>s?m:s+1;this.requestUpload&&this.requestUpload(sT.EXTENSION_USAGE_STATS,{usageStats:a,sendTs:g})},se("EXTENSION_USAGE_UPLOAD_INTERVAL"))}stopUploadExtensionUsageStats(){this.uploadExtensionUsageStarted&&(this.uploadExtensionUsageStarted=!1,this.uploadExtUsageStatsTimer&&window.clearInterval(this.uploadExtUsageStatsTimer),this.uploadExtUsageStatsTimer=void 0)}stopUploadBaseStats(){this.uploadBaseStatsStarted=!1}}const T_e=se("ICE_RESTART_INTERVAL");let a1=new Map,f0=new Map,ng=[Qs.UDP_TCP_RELAY,Qs.TCP_RELAY,Qs.RELAY],sM=se("JOIN_WITH_FALLBACK_MEDIA_PROXY_FORCE")&&jn().supportPCSetConfiguration;function h7(t){let r=arguments.length>1&&arguments[1]!==void 0&&arguments[1];const s=a1.get(t.id);s&&(window.clearTimeout(s),a1.delete(t.id));const a=f0.get(t.id);r&&a&&a.index===ng.length-1&&(x.debug("[".concat(t.id,"] reset ICE restart policy")),f0.delete(t.id))}function p7(t,r,s){if(a1.size===0&&f0.size===0&&(Array.isArray(se("RESTART_SEQUENCE"))&&se("RESTART_SEQUENCE").length>0&&!function(m,g){if(m.length!==g.length)return!1;for(let E=0;E<m.length;E+=1){const b=m[E];if(m.filter(I=>I===b).length!==g.filter(I=>I===b).length)return!1}return!0}(ng,se("RESTART_SEQUENCE"))&&(ng=se("RESTART_SEQUENCE").filter(m=>{var g;if(rt(g=Object.values(Qs)).call(g,m))return!0}),x.debug("use reconnection policy from config distribution, queues: ".concat(ng.join(" => ")))),sM=se("JOIN_WITH_FALLBACK_MEDIA_PROXY_FORCE")&&jn().supportPCSetConfiguration),ng.length===0)return void s();let a,{index:c=0,type:d}=f0.get(t.id)||{};if(sM&&d===Qs.RELAY)return void s();let h=d&&c>=ng.length-1;if(sM)d=Qs.RELAY;else{if(h)return void s();d?(c++,d=ng[c]):(d=ng[0],c=0)}x.debug("[".concat(t.id,"] choose ICE restart policy: ").concat(d,", index: ").concat(c)),r(d),f0.set(t.id,{index:c,type:d}),a=window.setTimeout(()=>p7(t,r,s),T_e),a1.set(t.id,a)}var wn;function f7(t,r){var s=Object.keys(t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);r&&(a=a.filter(function(c){return Object.getOwnPropertyDescriptor(t,c).enumerable})),s.push.apply(s,a)}return s}function Jh(t){for(var r=1;r<arguments.length;r++){var s=arguments[r]!=null?arguments[r]:{};r%2?f7(Object(s),!0).forEach(function(a){Y(t,a,s[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(s)):f7(Object(s)).forEach(function(a){Object.defineProperty(t,a,Object.getOwnPropertyDescriptor(s,a))})}return t}function m7(t){var r,s,a,c=2;for(typeof Symbol<"u"&&(s=vL,a=Symbol.iterator);c--;){if(s&&(r=t[s])!=null)return r.call(t);if(a&&(r=t[a])!=null)return new c1(r.call(t));s="@@asyncIterator",a="@@iterator"}throw new TypeError("Object is not async iterable")}function c1(t){function r(s){if(Object(s)!==s)return pt.reject(new TypeError(s+" is not an object."));var a=s.done;return pt.resolve(s.value).then(function(c){return{value:c,done:a}})}return c1=function(s){this.s=s,this.n=s.next},c1.prototype={s:null,n:null,next:function(){return r(this.n.apply(this.s,arguments))},return:function(s){var a=this.s.return;return a===void 0?pt.resolve({value:s,done:!0}):r(a.apply(this.s,arguments))},throw:function(s){var a=this.s.return;return a===void 0?pt.reject(s):r(a.apply(this.s,arguments))}},new c1(t)}let _T=(wn=class extends Jr{get state(){return this._state}set state(t){const r=this._state;this._state=t,this.emit(Vt.StateChange,r,this._state)}constructor(t,r){super(),Y(this,"isPlanB",void 0),Y(this,"store",void 0),Y(this,"statsUploader",void 0),Y(this,"connection",void 0),Y(this,"localTrackMap",new Map),Y(this,"remoteUserMap",new Map),Y(this,"localDataChannels",[]),Y(this,"remoteDataChannelMap",new Map),Y(this,"pendingLocalTracks",[]),Y(this,"pendingRemoteTracks",[]),Y(this,"pendingLocalDataChannels",[]),Y(this,"pendingRemoteDataChannels",[]),Y(this,"statsCollector",void 0),Y(this,"shouldForwardP2PCreation",void 0),Y(this,"iceFailedCount",0),Y(this,"dtlsFailedCount",0),Y(this,"mutex",void 0),Y(this,"_state",ir.Disconnected),Y(this,"_pcStatsUploadType",se("NEW_ICE_RESTART")?pf.FIRST_CONNECTION:pf.OLD_FIRST_CONNECTION),Y(this,"_isStartRestartIce",!1),Y(this,"_restartTimer",void 0),Y(this,"_isTryConnecting",!1),Y(this,"_iceError",null),Y(this,"_forceTurn",!1),Y(this,"_isWaitPcToRePub",!1),Y(this,"handleMuteLocalTrack",async(s,a,c)=>{const d=await this.mutex.lock("Locking from P2PChannel.handleMuteLocalTrack");try{if(!this.connection||this.state!==ir.Connected)return void c(new Le(te.INVALID_OPERATION,"Cannot call P2PChannel.handleMuteLocalTrack before connection established."));const h=this.filterTobeMutedTracks(s);if(h.length===0)return void a();const m=h.find(E=>E[0]==="videoLowTrack");if(m){const E=m[1];this.store.enableInstantMuteRestore?(E.track._originMediaStreamTrack.enabled=!1,x.info("[".concat(this.store.clientId,"] P2PChannel muteLocalLowTrack without close sender because enableInstantMuteRestore is true"))):E.track._originMediaStreamTrack.stop()}this.store.enableInstantMuteRestore?x.info("[".concat(this.store.clientId,"] P2PChannel muteLocalTrack without close sender because enableInstantMuteRestore is true")):await this.connection.muteLocal(h.map(E=>{let[,{id:b}]=E;return b}));const g=this.createMuteMessage(h);await Er(this,Vt.RequestMuteLocal,g),a()}catch(h){c(h)}finally{d()}}),Y(this,"handleUnmuteLocalTrack",async(s,a,c)=>{const d=await this.mutex.lock("Locking from P2PChannel.handleUnmuteLocalTrack");try{if(!this.connection||this.state!==ir.Connected)return void c(new Le(te.INVALID_OPERATION,"Cannot call P2PChannel.handleUnmuteLocalTrack before connection established."));const h=this.filterTobeUnmutedTracks(s);if(h.length===0)return void a();const m=h.find(E=>E[0]==="videoLowTrack");if(m){const E=m[1];if(this.store.enableInstantMuteRestore)E.track._originMediaStreamTrack.enabled=!0,x.info("[".concat(this.store.clientId,"] P2PChannel unmuteLocalLowTrack without close sender because enableInstantMuteRestore is true"));else{if(E.track._originMediaStreamTrack.stop(),!se("DISABLE_DUAL_STREAM_USE_ENCODING")&&jn().supportDualStreamEncoding){const b=s._mediaStreamTrack.clone();E.track._mediaStreamTrack=b,E.track._originMediaStreamTrack=b}else{const b=iM(s,Xw(this,Vt.RequestLowStreamParameter));E.track._mediaStreamTrack=b,E.track._originMediaStreamTrack=b}await new pt((b,I)=>{this.handleReplaceTrack(E.track,b,I,!0)})}}this.store.enableInstantMuteRestore?x.info("[".concat(this.store.clientId,"] P2PChannel unmuteLocalTrack without close sender because enableInstantMuteRestore is true")):await this.connection.unmuteLocal(h.map(E=>{let[,{id:b}]=E;return b}));const g=this.createUnmuteMessage(h);await Er(this,Vt.RequestUnmuteLocal,g),a()}catch(h){c(h)}finally{d()}}),Y(this,"handleUpdateVideoEncoder",async(s,a,c,d)=>{let h;d||(h=await this.mutex.lock("Locking from P2PChannel.handleUpdateVideoEncoder"));try{const g=this.localTrackMap.get(qe.LocalVideoTrack);if(!this.connection||!g||g.track!==s||this.state!==ir.Connected)return void a();const{id:E,track:b}=g;await this.connection.updateSendParameters(E,b),await this.connection.updateEncoderConfig(E,b),this.emit(Vt.UpdateVideoEncoder,b),a()}catch(g){c(g)}finally{var m;(m=h)===null||m===void 0||m()}}),Y(this,"handleUpdateVideoSendParameters",async(s,a,c)=>{const d=await this.mutex.lock("Locking from P2PChannel.handleUpdateVideoSendParameters");try{const h=this.localTrackMap.get(qe.LocalVideoTrack);if(!this.connection||!h||h.track!==s||this.state!==ir.Connected)return void a();const{id:m,track:g}=h;await this.connection.updateSendParameters(m,g),a()}catch(h){c(h)}finally{d()}}),Y(this,"handleReplaceMixingTrack",async(s,a,c,d)=>{if(!this.connection||this.state!==ir.Connected)return void a();const h=nM([s]);let m;x.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection will replace audioTrack [").concat(h.getTrackId(),"]")),typeof d=="boolean"&&d||(m=await this.mutex.lock("From P2PChannel.handleReplaceMixingTrack"));try{await this.replaceTrack(s,h),a()}catch(E){c(E)}finally{var g;(g=m)===null||g===void 0||g()}}),Y(this,"handleReplaceTrack",async(s,a,c,d)=>{let h;x.debug("[".concat(this.store.clientId,"] P2PChannel handleReplaceTrack for [track-id-").concat(s.getTrackId(),"]")),typeof d=="boolean"&&d||(h=await this.mutex.lock("From P2PChannel.handleReplaceTrack"));try{var m;const E=Array.from(this.localTrackMap.entries()).find(b=>{let[,{track:I}]=b;return s===I});if(!this.connection||!E||this.state!==ir.Connected)return void a();if(await((m=this.connection)===null||m===void 0?void 0:m.replaceTrack(s,E[1].id)),this.isPlanB){const b=E[1];b.id=s._mediaStreamTrack.id,this.localTrackMap.set(E[0],b)}if(E[0]===qe.LocalVideoTrack&&!se("DISABLE_DUAL_STREAM_USE_ENCODING")&&jn().supportDualStreamEncoding){const b=this.localTrackMap.get(qe.LocalVideoLowTrack);if(b){const I=s._mediaStreamTrack.clone();b.track._originMediaStreamTrack.stop(),b.track._mediaStreamTrack=I,b.track._originMediaStreamTrack=I,await new pt((A,k)=>{this.handleReplaceTrack(b.track,A,k,!0)})}}a()}catch(E){c(E)}finally{var g;(g=h)===null||g===void 0||g()}}),Y(this,"handleGetRTCStats",s=>{s(this.statsCollector.getRTCStats())}),Y(this,"handleGetLocalVideoStats",s=>{s(this.statsCollector.getLocalVideoTrackStats())}),Y(this,"handleGetLocalAudioStats",s=>{s(this.statsCollector.getLocalAudioTrackStats())}),Y(this,"handleGetRemoteVideoStats",s=>this.statsCollector.getRemoteVideoTrackStats(s.uid)[s.uid]),Y(this,"handleGetRemoteAudioStats",s=>this.statsCollector.getRemoteAudioTrackStats(s.uid)[s.uid]),this.store=t,this.statsCollector=r,this.statsCollector.addP2PChannel(this),this.statsUploader=new d7(this.store),this.bindStatsUploaderEvents(),this.mutex=new Ys("P2PChannel-mutex",this.store.clientId),this.isPlanB=!jn().supportUnifiedPlan||se("CHROME_FORCE_PLAN_B")&&lf(),this.shouldForwardP2PCreation=se("FORWARD_P2P_CREATION")&&jn().supportPCSetConfiguration&&xL(),this.shouldForwardP2PCreation&&(this.connection=i1(this.store),this.emit(Vt.PeerConnectionStateChange,this.connection.peerConnectionState),this.bindConnectionEvents(this.connection))}async startP2PConnection(t,r){var s;this.state=ir.New,this._forceTurn=o7(t),x.debug("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] forceTurn: ").concat(this._forceTurn));const a=this.shouldForwardP2PCreation&&((s=this.connection)===null||s===void 0?void 0:s.peerConnectionState)==="closed";if((!this.shouldForwardP2PCreation||a||r)&&((a||r)&&this.connection&&(x.warning("[".concat(this.store.clientId,"] P2PChannel.startP2PConnection ForwardP2P closed.")),this.resetConnection(this.connection)),this.connection=i1(this.store,t),this.emit(Vt.PeerConnectionStateChange,this.connection.peerConnectionState),this.bindConnectionEvents(this.connection)),!this.connection)throw new Le(te.UNEXPECTED_ERROR,"Cannot P2PChannel.startConnection before P2PConnection initialization .");return this._pcStatsUploadType=se("NEW_ICE_RESTART")?pf.FIRST_CONNECTION:pf.OLD_FIRST_CONNECTION,this._isTryConnecting=!0,this._isStartRestartIce=!1,this._iceError=null,this.connection.setConfiguration(t),this.connection.establishPromise}async connect(t){if(!this.connection)throw new Le(te.UNEXPECTED_ERROR,"Cannot P2PChannel.connect before P2PChannel.startP2PConnection .");if(this.isPreallocation()&&this.state===ir.Connected){if(this.connection instanceof $l&&this.connection.checkDtlsParameters(t.dtlsParameters.fingerprints))return x.debug("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] dtls parameters mismatch, try next.")),At.reportApiInvoke(this.store.sessionId,{name:di.MISMATCH_DTLS_PARAMETERS,options:[t.dtlsParameters.fingerprints],tag:$r.TRACER}).onSuccess(),void setTimeout(()=>{this.emit(Vt.RequestReconnect)});await this.connection.updateRemoteConnect(t)}else this.store.peerConnectionStart(),await this.connection.connect(t),this.statsUploader.startUploadTransportStats(),this.statsUploader.startUploadExtensionUsageStats(),this.state=ir.Connected}updateRemoteRTPCapabilities(t){const r=Array.from(this.localTrackMap.entries()).filter(c=>{var d;let[h]=c;return rt(d=[qe.LocalVideoLowTrack,qe.LocalVideoTrack]).call(d,h)}),s=r.map(c=>{let[,{id:d}]=c;return d}),a=r.map(c=>{let[d]=c;return d});if(this.connection instanceof $l){if(At.updateRemoteRTPCapabilities(this.store.sessionId,{trackTypes:JSON.stringify(a),localCodecs:JSON.stringify(this.connection.localCodecs),remoteCodecs:JSON.stringify(t)}),!rt(t).call(t,this.store.codec)){const c=["vp9","vp8","h264"].find(d=>rt(t).call(t,d));c&&(this.store.codec=c,x.debug("[".concat(this.store.clientId,"] [").concat(this.store.p2pId," updateRemoteRTPCapabilities] default codec is not available, hence the fallback to ").concat(c,".")))}this.connection.updateRemoteRTPCapabilities(s,t)}}async getEstablishParams(){var t;if(this.connection instanceof $l&&this.connection.peerConnectionState!=="closed"&&rt(t=[ir.New,ir.Connected]).call(t,this.state))return this.connection.establishPromise}async publishDataChannel(t){if(!this.connection||this.state!==ir.Connected){if(this.state===ir.Disconnected)throw new Le(te.UNEXPECTED_ERROR,"PeerConnection already disconnected.");return t.forEach(s=>{var a;rt(a=this.pendingLocalDataChannels).call(a,s)||this.pendingLocalDataChannels.push(s)}),[]}const r=this.filterTobePublishedDataChannels(t);return r.length===0?[]:(r.forEach(s=>{const a=Date.now();this.store.publish(s.id.toString(),"datachannel",a)}),await this.connection.createDataChannels(this.store.uid,r),r.forEach(s=>{this.localDataChannels.push(s);const a=Date.now();this.store.publish(s.id+"","datachannel",void 0,a)}),t.map(s=>({streamId:s.id,ordered:s.ordered,maxRetransmits:s.maxRetransmits,metadata:s.metadata,channelId:s._originDataChannelId})))}publish(t,r,s){var a=this;return jl(function*(){const c=yield Fn(a.mutex.lock("From P2PChannel.publish"));try{var d;const h=a.connection&&rt(d=["disconnected","failed"]).call(d,a.connection.peerConnectionState);if(!a.connection||a.state!==ir.Connected||h){if(a.state===ir.Disconnected)throw new Le(te.UNEXPECTED_ERROR,"PeerConnection already disconnected.");a.throwIfTrackTypeNotMatch(t);const g=t.filter(E=>a.pendingLocalTracks.indexOf(E)===-1);return a.pendingLocalTracks=a.pendingLocalTracks.concat(g),void(h&&(a._isWaitPcToRePub=!0))}a.store.pubId=a.store.pubId+1,Zs.markPublishStart(a.store.clientId,a.store.pubId);const m=a.filterTobePublishedTracks(t,r,s);if(m.length===0)return void(yield Fn(a.tryToUnmuteAudio(t)));yield*eP(m7(a.doPublish(a.connection,m)))}finally{c()}})()}doPublish(t,r){var s=this;return jl(function*(){r.forEach(A=>{let{track:k,type:W}=A;const j=Date.now();s.store.publish(k.getTrackId(),W===qe.LocalAudioTrack?"audio":"video",j)}),s.bindLocalTrackEvents(r);const a=r.map(A=>{let{track:k}=A;return k}),c=yield Fn(t.send(a,s.store.codec,s.store.audioCodec)),d=(yield Fn(c.next())).value,h=s.createGatewayPublishMessage(r,d);let m;try{m=yield h}catch(A){throw c.throw(A),(A==null?void 0:A.code)===te.WS_ABORT&&r.forEach(k=>{let{track:W}=k;s.pendingLocalTracks.indexOf(W)===-1&&s.pendingLocalTracks.push(W)}),s.unbindLocalTrackEvents(r),A}const g=s.mapPubResToRemoteConfig(h,m,a),E=(yield Fn(c.next(g))).value;if(s.state===ir.Disconnected)throw new Le(te.UNEXPECTED_ERROR,"PeerConnection already disconnected.");se("ENABLE_VIDEO_SEI");const b=se("ENABLE_ENCODED_TRANSFORM"),I=se("ENABLE_AUDIO_METADATA");a.forEach(async A=>{const k=A.getRTCRtpTransceiver();if(!k||!b)return;const{interceptLocalVideoFrame:W,interceptLocalAudioFrame:j}=YP();A.trackMediaType===yt.VIDEO?await W(k.sender,A):A.trackMediaType===yt.AUDIO&&await j(k.sender,{metadata:I?()=>{const B=A.metadata.shift();return B&&B.value}:void 0})}),r.forEach(A=>{let{type:k}=A;s.statsCollector.addLocalStats(k)}),s.assignLocalTracks(r,E),s.statsUploader.startUploadOutboundStats(),r.forEach(A=>{let{track:k,type:W}=A;const j=Date.now();s.store.publish(k.getTrackId(),W===qe.LocalAudioTrack?"audio":"video",void 0,j)})})()}async updateVideoStreamParameter(t,r){const s=this.localTrackMap.get(r);if(!s||!this.connection)return;if(!(s.track instanceof Dr))return x.warn("[updateVideoStreamParameter]: track is not an instance of LocalVideoTrack");const{track:a}=s,c=function(d,h){const m={};return d.height&&d.width&&(m.scaleResolutionDownBy=V2(d,h)),m.maxFramerate=d.framerate?Cc(d.framerate):void 0,m.maxBitrate=d.bitrate?1e3*d.bitrate:void 0,m}(t,a);if(a._encoderConfig||(a._encoderConfig={}),r!==qe.LocalVideoLowTrack||!se("DISABLE_DUAL_STREAM_USE_ENCODING")&&jn().supportDualStreamEncoding)c.scaleResolutionDownBy!=null&&(a._encoderConfig.scaleResolutionDownBy=c.scaleResolutionDownBy);else{const d=a._originMediaStreamTrack;if(!d.canvas)return x.warn("[".concat(a.getTrackId(),"] no canvas on track"));(function(h,m){const g=h.canvas;m.width&&(g.width=Cc(m.width)),m.height&&(g.height=Cc(m.height)),m.framerate&&(g.stopCapture&&g.stopCapture(),g.stopCapture=l2(()=>{!g.startCapture&&g.stopCapture&&g.stopCapture(),g.startCapture&&g.startCapture()},Cc(m.framerate)))})(d,t)}c.maxBitrate!=null&&(a._encoderConfig.bitrateMax=c.maxBitrate/1e3),c.maxFramerate!=null&&(a._encoderConfig.frameRate&&typeof a._encoderConfig.frameRate=="object"?a._encoderConfig.frameRate.max=c.maxFramerate:a._encoderConfig.frameRate={max:c.maxFramerate}),x.debug("[".concat(a.getTrackId(),"] LowStreamEncoderConfig: , ").concat(JSON.stringify(a._encoderConfig))),await this.connection.updateRtpSenderEncodings(a)}publishLowStream(t){var r=this;return jl(function*(){if(!r.connection||r.state!==ir.Connected)return;const s=yield Fn(r.mutex.lock("Locking from P2PChannel.publishLowStream"));try{const c=r.localTrackMap.get(qe.LocalVideoTrack);if(!c)throw new Le(te.UNEXPECTED_ERROR,"Could not find high stream");if(r.localTrackMap.has(qe.LocalVideoLowTrack))throw new Le(te.UNEXPECTED_ERROR,"[".concat(r.store.clientId,"] Can't publish low stream when stream already publish"));const d=[{track:r.getLowVideoTrack(c.track,t),type:qe.LocalVideoLowTrack}];if(yield*eP(m7(r.doPublish(r.connection,d))),c.track.muted||!c.track.enabled){var a;const h=(a=r.localTrackMap.get(qe.LocalVideoLowTrack))===null||a===void 0?void 0:a.id;h!==void 0&&(yield Fn(r.connection.muteLocal([h])))}}finally{s()}})()}async republish(){this.pendingLocalTracks.length>0&&(x.debug("[".concat(this.store.clientId,"] Emit P2PChannelEvents.RequestRePublish to republish tracks.")),await Ms(this,Vt.RequestRePublish,this.pendingLocalTracks),this.emit(Vt.MediaReconnectEnd,this.store.uid),this.pendingLocalTracks=[]),this.pendingLocalDataChannels.length>0&&(x.debug("Emit P2PChannelEvents.RequestRePublishDataChannel to republish datachannels."),await Ms(this,Vt.RequestRePublishDataChannel,this.pendingLocalDataChannels),this.pendingLocalDataChannels=[]),this._isWaitPcToRePub=!1}async reSubscribe(t){for(let r=this.pendingRemoteTracks.length-1;r>=0;r--){const{user:s,kind:a}=this.pendingRemoteTracks[r];(a!==yt.AUDIO||s._audio_added_&&s._audioSSRC)&&(a!==yt.VIDEO||s._video_added_&&s._videoSSRC)||this.pendingRemoteTracks.splice(r,1)}if(t)await Ms(this,Vt.RequestReSubscribe,this.pendingRemoteTracks);else for(const{user:r,kind:s}of this.pendingRemoteTracks)await this.subscribe(r,s,s===yt.VIDEO?r._videoSSRC:r._audioSSRC);this.pendingRemoteTracks.forEach(r=>{let{user:s}=r;this.emit(Vt.MediaReconnectEnd,s.uid)}),this.pendingRemoteTracks=[]}async unpublish(t){if(!this.connection||this.state!==ir.Connected)return void t.forEach(a=>{const c=this.pendingLocalTracks.indexOf(a);c!==-1&&this.pendingLocalTracks.splice(c,1)});const r=this.filterTobeUnpublishedTracks(t);if(r.length===0)return;const s=r.find(a=>a[0]==="videoLowTrack");return s&&s[1].track.close(),this.doUnpublish(this.connection,r)}async unpublishDataChannel(t){if(!this.connection||this.state!==ir.Connected)return void t.forEach(s=>{const a=this.pendingLocalDataChannels.indexOf(s);a!==-1&&this.pendingLocalDataChannels.splice(a,1)});const r=this.filterTobeUnpublishedDataChannels(t);return r.length!==0?(r.forEach(s=>{const a=this.localDataChannels.indexOf(s);a!==-1&&this.localDataChannels.splice(a,1)}),this.localDataChannels.length===0&&await this.connection.stopDataChannels(this.store.uid),r.map(s=>s.id)):void 0}async unpublishLowStream(){if(!this.connection||this.state!==ir.Connected)return;const t=this.localTrackMap.get(qe.LocalVideoLowTrack);if(!t)return;t.track.close();const r=[[qe.LocalVideoLowTrack,t]];return this.doUnpublish(this.connection,r)}async doUnpublish(t,r){const s=this.createGatewayUnpublishMessage(r);return await t.stopSending(r.map(a=>{let[,{id:c}]=a;return c})),this.withdrawLocalTracks(r),this.unbindLocalTrackEvents(r.map(a=>{let[c,{track:d}]=a;return{type:c,track:d}})),r.forEach(a=>{let[c]=a;this.statsCollector.removeLocalStats(c)}),this.localTrackMap.size===0&&this.statsUploader.stopUploadOutboundStats(),s}async subscribeDataChannel(t,r){if(!this.connection||this.state!==ir.Connected)throw new Le(te.INVALID_OPERATION,"Cannot subscribe remote user when peerConnection disconnected.");const s=r.filter(a=>{var c;return!((c=this.remoteDataChannelMap.get(t))!==null&&c!==void 0&&c.get(a.id))});if(s.length!==0)return await this.connection.createDataChannels(t.uid,s),s.forEach(a=>{var c;this.remoteDataChannelMap.has(t)?(c=this.remoteDataChannelMap.get(t))===null||c===void 0||c.set(a.id,a):this.remoteDataChannelMap.set(t,new Map([[a.id,a]]));const d=this.pendingRemoteDataChannels.findIndex(h=>{let{user:m,id:g}=h;return m.uid===t.uid&&g===a.id});d!==-1&&this.pendingRemoteDataChannels.splice(d,1)}),s.map(a=>a.id)}async subscribe(t,r,s,a,c){var d;if(!this.connection||this.state!==ir.Connected)throw new Le(te.INVALID_OPERATION,"Cannot subscribe remote user when peerConnection disconnected.");if((d=this.remoteUserMap.get(t))!==null&&d!==void 0&&d.has(r))return;let h,m,g,E;const b=this.connection.getPreMedia(s);if(b)x.debug("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] preSSRCMap has ssrcId: ").concat(s,", no need to send sub to gateway.")),g=b.transceiver,h=b.track,m=b.mid,E=b.player,b.firstVideoRender&&this.store.firstVideoFrameDecoded(t.uid,{firstPreRender:b.firstVideoRender});else if(c){const k=c.find(j=>{let{stream_type:B}=j;return B===r});if(!k)throw new Le(te.UNEXPECTED_ERROR,"Cannot subscribe to remote ".concat(r," for user: ").concat(t.uid," because subscribe answer from gateway does not contain stream_type: ").concat(r,"."));const W=await this.connection.receive(r,k.ssrcs,String(t._uintid),k.attributes);this.connection instanceof $l&&(g=W.transceiver),h=W.track,m=W.id}else{const k=await this.connection.receive(r,[{ssrcId:s,rtx:a}],String(t._uintid),void 0);this.connection instanceof $l&&(g=k.transceiver),h=k.track,m=k.id}if(r===yt.AUDIO?(t._audioTrack?t._audioTrack._updateOriginMediaStreamTrack(h):(t._audioTrack=new t0(h,t.uid,t._uintid,this.store),x.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote audio track: ").concat(t._audioTrack.getTrackId()))),g&&t._audioTrack._updateRtpTransceiver(g),this.bindRemoteTrackEvents(t,t._audioTrack)):(t._videoTrack?t._videoTrack._updateOriginMediaStreamTrack(h):(t._videoTrack=new e0(h,t.uid,t._uintid,this.store,E),x.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote video track: ").concat(t._videoTrack.getTrackId())),t._videoTrack.once(Wl.PLAY_START,()=>{this.store.firstVideoFrameDecoded(t.uid,{playStart:Date.now()})}),t._videoTrack.once(Wl.PLAY_END,()=>{this.store.firstVideoFrameDecoded(t.uid,{playEnd:Date.now()}),this.reportVideoFirstFrameRender(t)}),E?t._videoTrack.once(Wl.FIRST_FRAME_RENDER,()=>{this.store.firstVideoFrameDecoded(t.uid,{firstRender:Date.now()}),this.reportVideoFirstFrameRender(t)}):t._videoTrack.once(Wl.FIRST_FRAME_DECODED,()=>{this.store.firstVideoFrameDecoded(t.uid,{firstRender:Date.now()}),this.reportVideoFirstFrameRender(t)})),g&&t._videoTrack._updateRtpTransceiver(g),this.bindRemoteTrackEvents(t,t._videoTrack)),g&&se("ENABLE_ENCODED_TRANSFORM")){const{interceptRemoteVideoFrame:k,interceptRemoteAudioFrame:W}=YP();r==yt.VIDEO?await k(g.receiver,{onSei:se("ENABLE_VIDEO_SEI")&&(j=>{var B;return(B=t._videoTrack)===null||B===void 0?void 0:B._onSei(j)})}):r==yt.AUDIO&&await W(g.receiver,{enableTopn:!!se("ENABLE_AUDIO_TOPN"),enableMetadata:!!se("ENABLE_AUDIO_METADATA"),enablePts:!!se("ENABLE_AUDIO_PTS"),onMetadata:j=>{this.safeEmit(Vt.AudioMetadata,j)},onPts:j=>{this.safeEmit(Vt.AudioPts,j)}})}const I=this.remoteUserMap.get(t);I?I.set(r,m):this.remoteUserMap.set(t,new Map([[r,m]])),this.statsCollector.addRemoteStats(t.uid),this.statsUploader.startUploadInboundStats();const A=this.pendingRemoteTracks.findIndex(k=>{let{user:W,kind:j}=k;return W.uid===t.uid&&r===j});A!==-1&&(this.pendingRemoteTracks.splice(A,1),this.emit(Vt.MediaReconnectEnd,t.uid))}async massSubscribe(t){return this.massSubscribeNoLock(t)}async massSubscribeNoLock(t){if(!this.connection||this.state!==ir.Connected)throw new Le(te.INVALID_OPERATION,"Cannot subscribeAll remote users when peerConnection disconnected.");t=t.filter(c=>{var d;let{user:h,mediaType:m}=c;return!((d=this.remoteUserMap.get(h))!==null&&d!==void 0&&d.has(m))});const r=[],s=new Map;t.forEach(c=>{if(!this.connection)return;const d=this.connection.getPreMedia(c.ssrcId);if(d){const{track:h,mid:m,transceiver:g,player:E}=d;s.set(c.ssrcId,{track:h,id:m,transceiver:g,player:E})}else r.push(c)});const a=await this.connection.batchReceive(r.map(c=>{let{user:d,mediaType:h,ssrcId:m,rtxSsrcId:g}=c;return{kind:h,ssrcMsg:[{ssrcId:m,rtx:g}],mslabel:String(d._uintid)}}));r.forEach((c,d)=>{s.set(c.ssrcId,a[d])});for(const{user:c,mediaType:d,ssrcId:h}of t){const m=s.get(h);if(!m)return void x.debug("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] cannot find ").concat(c.uid," subscribe data,").concat(d,", ").concat(h));const{track:g,id:E,transceiver:b,player:I}=m;if(b&&se("ENABLE_ENCODED_TRANSFORM")){const{interceptRemoteVideoFrame:W,interceptRemoteAudioFrame:j}=YP();d==yt.VIDEO?await W(b.receiver,{onSei:se("ENABLE_VIDEO_SEI")&&(B=>{var ee;return(ee=c._videoTrack)===null||ee===void 0?void 0:ee._onSei(B)})}):d==yt.AUDIO&&await j(b.receiver,{enableTopn:!!se("ENABLE_AUDIO_TOPN"),enableMetadata:!!se("ENABLE_AUDIO_METADATA"),enablePts:!!se("ENABLE_AUDIO_PTS"),onMetadata:B=>{this.safeEmit(Vt.AudioMetadata,B)},onPts:B=>{this.safeEmit(Vt.AudioPts,B)}})}if(d===yt.AUDIO?(c._audioTrack?c._audioTrack._updateOriginMediaStreamTrack(g):(c._audioTrack=new t0(g,c.uid,c._uintid,this.store),x.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote audio track: ").concat(c._audioTrack.getTrackId()))),b&&c._audioTrack._updateRtpTransceiver(b),this.bindRemoteTrackEvents(c,c._audioTrack)):(c._videoTrack?c._videoTrack._updateOriginMediaStreamTrack(g):(c._videoTrack=new e0(g,c.uid,c._uintid,this.store,I),x.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote video track: ").concat(c._videoTrack.getTrackId()))),b&&c._videoTrack._updateRtpTransceiver(b),this.bindRemoteTrackEvents(c,c._videoTrack)),se("ENABLE_VIDEO_SEI")&&b){const{interceptRemoteVideoFrame:W,interceptRemoteAudioFrame:j}=YP();d==yt.VIDEO?await W(b.receiver,{onSei:B=>{var ee;(ee=c._videoTrack)===null||ee===void 0||ee._onSei(B)}}):d==yt.AUDIO&&await j(b.receiver)}const A=this.remoteUserMap.get(c);A?A.set(d,E):this.remoteUserMap.set(c,new Map([[d,E]])),this.statsCollector.addRemoteStats(c.uid),this.statsUploader.startUploadInboundStats();const k=this.pendingRemoteTracks.findIndex(W=>{let{user:j,kind:B}=W;return j.uid===c.uid&&d===B});k!==-1&&(this.pendingRemoteTracks.splice(k,1),this.emit(Vt.MediaReconnectEnd,c.uid))}}async unsubscribe(t,r,s){const a=this.pendingRemoteTracks.filter(h=>{let{user:m,kind:g}=h;return r!==void 0?m.uid===t.uid&&r===g:m.uid===t.uid});if(a.forEach(h=>{const m=this.pendingRemoteTracks.indexOf(h);this.pendingRemoteTracks.splice(m,1)}),this.connection&&this.state===ir.Connected||s||a.forEach(h=>{let{kind:m}=h;var g;if(m===yt.AUDIO)(g=t._audioTrack)===null||g===void 0||g._destroy(),t._audioTrack=void 0;else if(m===yt.VIDEO){var E;(E=t._videoTrack)===null||E===void 0||E._destroy(),t._videoTrack=void 0}}),!this.connection||this.state!==ir.Connected)return;const c=this.filterTobeUnSubscribedTracks(t,r);if(c.length===0)return;await this.connection.stopReceiving(c.map(h=>{let[,{id:m}]=h;return m}));const d=this.createUnsubscribeMessage(c);return this.withdrawRemoteTracks(c),this.remoteUserMap.size===0&&this.statsUploader.stopUploadInboundStats(),c.forEach(h=>{let[m,{kind:g}]=h;var E,b;if(g===yt.VIDEO&&m._videoSSRC&&((E=this.connection)===null||E===void 0||E.setStatsRemoteVideoIsReady(m._videoSSRC,!1)),g===yt.VIDEO)this.unbindRemoteTrackEvents(m._videoTrack),s||((b=m._videoTrack)===null||b===void 0||b._destroy(),m._videoTrack=void 0);else if(g===yt.AUDIO){var I;this.unbindRemoteTrackEvents(m._audioTrack),!s&&((I=m._audioTrack)===null||I===void 0||I._destroy(),m._audioTrack=void 0)}}),d}async unsubscribeDataChannel(t,r){if(r.forEach(c=>{const d=this.pendingRemoteDataChannels.findIndex(h=>h.id===c.id);d!==-1&&this.pendingRemoteDataChannels.splice(d,1)}),!this.connection)return;const s=this.filterTobeUnSubscribedDataChannels(t,r);if(s.length===0)return;r.forEach(c=>{c._close()});const a=this.remoteDataChannelMap.get(t);return s.forEach(c=>{a&&a.delete(c.id)}),a&&a.size===0&&(this.remoteDataChannelMap.delete(t),await this.connection.stopDataChannels(t.uid)),s.map(c=>c.id)}async massUnsubscribe(t){return this.massUnsubscribeNoLock(t)}async massUnsubscribeNoLock(t){let r=[];for(const{user:c,mediaType:d}of t){const h=this.pendingRemoteTracks.filter(m=>{let{user:g,kind:E}=m;return d!==void 0?g.uid===c.uid&&d===E:g.uid===c.uid});h.forEach(m=>{const g=this.pendingRemoteTracks.indexOf(m);this.pendingRemoteTracks.splice(g,1)}),r=r.concat(h)}if(!this.connection||this.state!==ir.Connected)return void r.forEach(c=>{let{user:d,kind:h}=c;var m;if(h===yt.AUDIO)(m=d._audioTrack)===null||m===void 0||m._destroy(),d._audioTrack=void 0;else if(h===yt.VIDEO){var g;(g=d._videoTrack)===null||g===void 0||g._destroy(),d._videoTrack=void 0}});const s=Wa(t).call(t,(c,d)=>{let{user:h,mediaType:m}=d;const g=this.filterTobeUnSubscribedTracks(h,m);return c.concat(g)},[]);if(s.length===0)return;await this.connection.stopReceiving(s.map(c=>{let[,{id:d}]=c;return d}));const a=this.createUnsubscribeAllMessage(s);return this.withdrawRemoteTracks(s),this.remoteUserMap.size===0&&this.statsUploader.stopUploadInboundStats(),s.forEach(c=>{let[d,{kind:h}]=c;var m,g;if(h===yt.VIDEO&&d._videoSSRC&&((m=this.connection)===null||m===void 0||m.setStatsRemoteVideoIsReady(d._videoSSRC,!1)),h===yt.VIDEO)this.unbindRemoteTrackEvents(d._videoTrack),(g=d._videoTrack)===null||g===void 0||g._destroy(),d._videoTrack=void 0;else if(h===yt.AUDIO){var E;this.unbindRemoteTrackEvents(d._audioTrack),(E=d._audioTrack)===null||E===void 0||E._destroy(),d._audioTrack=void 0}}),a}isPreSubScribe(t){return!this.connection||this.state!==ir.Connected?!1:!!this.connection.getPreMedia(t)}async muteRemote(t,r){if(!this.connection)return;const s=this.remoteUserMap.get(t);if(!s)return void x.warning("[".concat(this.store.clientId,"] P2PChannel.muteRemote has no remote user ").concat(t.uid,"."));if(!s.get(r))return void x.warning("[".concat(this.store.clientId,"] P2PChannel.muteRemote has no remote user ").concat(t.uid," media type ").concat(r,"."));const a=r===yt.VIDEO?t._videoSSRC:t._audioSSRC;a!==void 0&&this.connection.setStatsRemoteVideoIsReady(a,!1)}async unmuteRemote(t,r){return this.unmuteRemoteNoLock(t,r)}async unmuteRemoteNoLock(t,r){if(!this.connection)return;const s=this.remoteUserMap.get(t);if(!s)return void x.warning("[".concat(this.store.clientId,"] P2PChannel.unmuteRemote has no remote user ").concat(t.uid,"."));s.get(r)||x.warning("[".concat(this.store.clientId,"] P2PChannel.unmuteRemote has no remote user ").concat(t.uid," media type ").concat(r,"."))}addAudioMetadata(t){const r=this.localTrackMap.get(qe.LocalAudioTrack),s=r&&r.track;s&&s.metadata.push(t)}getAllTracks(t){const r=this.localTrackMap.get(qe.LocalAudioTrack);if((r==null?void 0:r.track)instanceof zi){const s=r.track;return Array.from(this.localTrackMap.entries()).filter(a=>{let[c]=a;return c!==qe.LocalAudioTrack}).filter(a=>{let[c]=a;return!(t&&c===qe.LocalVideoLowTrack)}).map(a=>{let[,{track:c}]=a;return c}).concat(s.trackList)}return Array.from(this.localTrackMap.entries()).filter(s=>{let[a]=s;return!(t&&a===qe.LocalVideoLowTrack)}).map(s=>{let[,{track:a}]=s;return a})}getAllDataChannels(){return this.localDataChannels}reportPublishEvent(t,r,s,a,c){if(t){const h=this.localTrackMap.get(qe.LocalAudioTrack),m=a?this.localTrackMap.get(qe.LocalVideoLowTrack):this.localTrackMap.get(qe.LocalVideoTrack);At.publish(this.store.sessionId,{eventElapse:Zs.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:t,ec:r,audioName:h==null?void 0:h.track.getTrackLabel(),videoName:m==null?void 0:m.track.getTrackLabel(),screenshare:(m==null?void 0:m.track._hints.indexOf(yr.SCREEN_TRACK))!==-1,audio:!!h,video:!!m,p2pid:this.store.p2pId,publishRequestid:this.store.pubId,extend:c})}else{var d;s||(s=[]);const h=s.find(g=>g instanceof ci),m=a?(d=this.localTrackMap.get(qe.LocalVideoTrack))===null||d===void 0?void 0:d.track:s.find(g=>g instanceof Dr);At.publish(this.store.sessionId,{eventElapse:Zs.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:t,ec:r,audioName:h==null?void 0:h.getTrackLabel(),videoName:m==null?void 0:m.getTrackLabel(),screenshare:(m==null?void 0:m._hints.indexOf(yr.SCREEN_TRACK))!==-1,audio:!!h,video:!!m,p2pid:this.store.p2pId,publishRequestid:this.store.pubId,extend:c})}}reportSubscribeEvent(t,r,s,a){const c=a===yt.VIDEO?s._videoSSRC:s._audioSSRC;c&&At.subscribe(this.store.sessionId,{succ:t,ec:r,video:a===yt.VIDEO,audio:a===yt.AUDIO,peerid:s.uid,subscribeRequestid:c,p2pid:this.store.p2pId,eventElapse:Zs.measureFromSubscribeStart(this.store.clientId,c),preSsrc:this.isPreSubScribe(c)})}reset(){x.debug("[".concat(this.store.clientId,"] P2PChannel.reset")),this.mutex=new Ys("P2PChannel-mutex",this.store.clientId),this.connection&&(this.resetConnection(this.connection),this.connection=void 0),this.shouldForwardP2PCreation&&(this.connection=i1(this.store),this.emit(Vt.PeerConnectionStateChange,this.connection.peerConnectionState),this.bindConnectionEvents(this.connection)),this.statsUploader.stopUploadOutboundStats(),this.statsUploader.stopUploadInboundStats(),this.statsUploader.stopUploadTransportStats(),this.statsUploader.stopUploadExtensionUsageStats(),this.statsUploader.stopUploadBaseStats(),this.unbindLocalTrackEvents(),this.unbindAllRemoteTrackEvents(),this.unbindRtpTransceiver();const t=this.localTrackMap.get(qe.LocalAudioTrack);if((t==null?void 0:t.track)instanceof zi){if(t.track.trackList.length>0){const r=t.track;t.track.trackList.forEach(s=>{r.removeAudioTrack(s)})}t.track.close()}this.localTrackMap.clear(),this.remoteUserMap.clear(),this.statsCollector.removeRemoteStats(),this.statsCollector.removeLocalStats(),this.iceFailedCount=0,this.dtlsFailedCount=0,this.pendingLocalTracks=[],this.pendingRemoteTracks=[],this.localDataChannels=[],this.remoteDataChannelMap.clear(),this.pendingLocalDataChannels=[],this.pendingRemoteDataChannels=[],this.state=ir.Disconnected}getStats(){var t;return(t=this.connection)===null||t===void 0?void 0:t.getStats()}getRemoteVideoIsReady(t){var r;return((r=this.connection)===null||r===void 0?void 0:r.getRemoteVideoIsReady(t))||!1}getLocalAudioVolume(){const t=this.localTrackMap.get(qe.LocalAudioTrack);if(t)return t.track.getVolumeLevel()}getLocalVideoSize(){const t=this.localTrackMap.get(qe.LocalVideoTrack);if(t)return{width:t.track.videoWidth||0,height:t.track.videoHeight||0}}getEncoderConfig(t){const r=this.localTrackMap.get(t);return r&&r.track instanceof Dr||r&&r.track instanceof ci?r.track._encoderConfig:void 0}getLocalMedia(t){return this.localTrackMap.get(t)}hasLocalMedia(){return this.localTrackMap.size>0}hasRemoteMedia(t,r){if(!t)return this.remoteUserMap.size>0;const s=this.remoteUserMap.get(t);return!!s&&(!r||s.has(r))}async hasRemoteMediaWithLock(t,r){if(!t)return this.remoteUserMap.size>0;const s=this.remoteUserMap.get(t);return!!s&&(!r||s.has(r))}getRemoteMedia(t){var r;const s=Array.from(Xa(r=this.remoteUserMap).call(r)).find(a=>a.uid===t);return s?{audioTrack:s.audioTrack,audioSSRC:s._audioSSRC,videoTrack:s.videoTrack,videoSSRC:s._videoSSRC}:{}}getAudioLevels(){let t=Array.from(this.remoteUserMap.entries()).map(s=>{let[a]=s;return{uid:a.uid,level:a.audioTrack?100*a.audioTrack._source.getAccurateVolumeLevel():0}});const r=this.localTrackMap.get(qe.LocalAudioTrack);return r&&t.push({level:100*r.track._source.getAccurateVolumeLevel(),uid:this.store.uid}),t=G_(t).call(t,(s,a)=>s.level-a.level),t}async disconnectForReconnect(){this.connection&&(x.debug("[".concat(this.store.clientId,"] P2PChannel.disconnectForReconnect closing P2PConnection")),this.state=ir.Reconnecting,se("KEEP_LAST_FRAME")&&this.remoteUserMap.size!==0&&Array.from(this.remoteUserMap.entries()).forEach(t=>{let[r]=t;var s;r._videoTrack&&r._videoTrack._player&&((s=r._videoTrack._player.getVideoElement())===null||s===void 0||s.pause(),r._videoTrack._player.isKeepLastFrame=!0,r._videoTrack._originMediaStreamTrack.stop())}),this.resetConnection(this.connection),this.connection=void 0,this.shouldForwardP2PCreation&&(this.connection=i1(this.store),this.emit(Vt.PeerConnectionStateChange,this.connection.peerConnectionState),this.bindConnectionEvents(this.connection)),this.localTrackMap.size!==0&&(Array.from(this.localTrackMap.entries()).forEach(t=>{var r;let[s,{track:a}]=t;switch(s){case qe.LocalVideoTrack:rt(r=a._hints).call(r,yr.LOW_STREAM)?a.close():this.pendingLocalTracks.push(a);break;case qe.LocalAudioTrack:a instanceof zi?this.pendingLocalTracks=this.pendingLocalTracks.concat(a.trackList):this.pendingLocalTracks.push(a);case qe.LocalVideoLowTrack:}}),this.emit(Vt.MediaReconnectStart,this.store.uid)),this.unbindLocalTrackEvents(),this.localTrackMap.clear(),this.remoteUserMap.size!==0&&Array.from(this.remoteUserMap.entries()).forEach(t=>{let[r,s]=t;Array.from(Xa(s).call(s)).forEach(a=>{this.setPendingRemoteMedia(r,a)}),this.emit(Vt.MediaReconnectStart,r.uid)}),this.unbindAllRemoteTrackEvents(),this.remoteUserMap.clear(),this.localDataChannels.length!==0&&(this.localDataChannels.forEach(t=>{this.pendingLocalDataChannels.push(t)}),this.localDataChannels.length=0),this.remoteDataChannelMap.size!==0&&(Array.from(this.remoteDataChannelMap.entries()).forEach(t=>{let[r,s]=t;Array.from(Xa(s).call(s)).forEach(a=>{this.setPendingRemoteDataChannel(r,a)})}),this.remoteDataChannelMap.clear()),this.statsUploader.stopUploadOutboundStats(),this.statsUploader.stopUploadInboundStats(),this.statsUploader.stopUploadTransportStats(),x.debug("[".concat(this.store.clientId,"] P2PChannel disconnected, waiting to reconnect.")))}hasPendingRemoteDataChannel(t,r){for(const s of this.pendingRemoteDataChannels){const{user:a,id:c}=s;if((t instanceof tg?t.uid:t)===a.uid&&c===r)return!0}return!1}setPendingRemoteDataChannel(t,r){this.hasPendingRemoteDataChannel(t,r)||this.pendingRemoteDataChannels.push({user:t,id:r})}hasPendingRemoteMedia(t,r){for(const s of this.pendingRemoteTracks){const{user:a,kind:c}=s;if((t instanceof tg?t.uid:t)===a.uid&&r===c)return!0}return!1}setPendingRemoteMedia(t,r){this.hasPendingRemoteMedia(t,r)||this.pendingRemoteTracks.push({user:t,kind:r})}restartICE(t){var r=this;return jl(function*(){if(!r.connection||r.state!==ir.Connected)return;const s=yield Fn(r.mutex.lock("From P2PChannel.restartICE"));let a;try{a=yield Fn(r.connection.restartICE(t));const d=yield Fn(a.next());if(d.done)return;const h=d.value,m=yield h;switch(rM(r.connection)&&r.reportPCStats(Date.now(),!1,r._pcStatsUploadType),t){case Qs.UDP_TCP_RELAY:r._pcStatsUploadType=pf.UDP_TCP_RESTART;break;case Qs.TCP_RELAY:r._pcStatsUploadType=pf.TCP_RESTART;break;case Qs.RELAY:r._pcStatsUploadType=pf.RELAY_RESTART;break;default:r._pcStatsUploadType=pf.OLD_RESTART}r._isTryConnecting=!0,a.next(m)}catch(d){var c;(c=a)===null||c===void 0||c.throw(d)}finally{s()}})()}getUplinkNetworkQuality(){if(!this.connection)return 0;const t=this.connection.getStats(),r=this.localTrackMap.get(qe.LocalVideoTrack),s=this.localTrackMap.get(qe.LocalAudioTrack),a=t.videoSend.find(k=>k.ssrc===(r==null?void 0:r.ssrcs[0].ssrcId)),c=t.audioSend.find(k=>k.ssrc===(s==null?void 0:s.ssrcs[0].ssrcId));if(!a||!c)return 1;const d=Yc(this,Vt.NeedSignalRTT),h=a?a.rttMs:void 0,m=c?c.rttMs:void 0,g=h&&m?(h+m)/2:h||m,E=(g&&d?(g+d)/2:g||d)||0,b=100*t.sendPacketLossRate*.7/50+.3*E/1500,I=b<.17?1:b<.36?2:b<.59?3:b<.1?4:5,A=r==null?void 0:r.track;if(A&&A._encoderConfig&&A._hints.indexOf(yr.SCREEN_TRACK)===-1){const k=A._encoderConfig.bitrateMax,W=t.bitrate.actualEncoded;if(k&&W){const j=(1e3*k-W)/(1e3*k);return tH[j<.15?0:j<.3?1:j<.45?2:j<.6?3:4][I]}}return I}getDownlinkNetworkQuality(){if(!this.connection)return 0;const t=this.connection.getStats();let r=0;return Array.from(this.remoteUserMap.entries()).forEach(s=>{let[a]=s;const c=a._audioSSRC,d=a._videoSSRC,h=t.audioRecv.find(W=>W.ssrc===c),m=t.videoRecv.find(W=>W.ssrc===d);if(!h&&!m)return void(r+=1);const g=Yc(this,Vt.NeedSignalRTT),E=t.rtt,b=(E&&g?(E+g)/2:E||g)||0,I=h?h.jitterMs:void 0,A=t.recvPacketLossRate;let k=.7*A*100/50+.3*b/1500;I&&(k=.6*A*100/50+.2*b/1500+.2*I/400),r+=k<.1?1:k<.17?2:k<.36?3:k<.59?4:5}),this.remoteUserMap.size>0?Math.round(r/this.remoteUserMap.size):r}async muteLocalTrack(t){return new pt((r,s)=>{this.handleMuteLocalTrack(t,r,s)})}async replaceTrack(t,r){var s;if(x.debug("[".concat(this.store.clientId,"] P2PChannel replaceTrack from [").concat(t.getTrackId(),"] to [").concat(r.getTrackId(),"]")),!this.connection||this.state!==ir.Connected)return;const a=Array.from(this.localTrackMap.entries()).find(d=>{let[,{track:h}]=d;return t===h});if(!a)return;const c=a[0];if(t!==r&&(this.unbindLocalTrackEvents([{track:t,type:c}]),this.bindLocalTrackEvents([{track:r,type:c}]),a[1].track=r),await((s=this.connection)===null||s===void 0?void 0:s.replaceTrack(r,a[1].id)),this.isPlanB){const d=a[1];d.id=r._mediaStreamTrack.id,this.localTrackMap.set(c,d)}if(c===qe.LocalVideoTrack&&!se("DISABLE_DUAL_STREAM_USE_ENCODING")&&jn().supportDualStreamEncoding){const d=this.localTrackMap.get(qe.LocalVideoLowTrack);if(d){const h=t._mediaStreamTrack.clone();d.track._originMediaStreamTrack.stop(),d.track._mediaStreamTrack=h,d.track._originMediaStreamTrack=h,await new pt((m,g)=>{this.handleReplaceTrack(d.track,m,g,!0)})}}}filterTobePublishedTracks(t,r,s){const a=[],c=this.getAllTracks();t=Bv(t=t.filter(g=>c.indexOf(g)===-1));let d,h=!1;const m=this.localTrackMap.get(qe.LocalAudioTrack);for(const g of t){if(g instanceof Dr&&(this.localTrackMap.has(qe.LocalVideoTrack)||h?new Le(te.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS).throw():(a.push({track:g,type:qe.LocalVideoTrack}),h=!0),r)){const E=this.getLowVideoTrack(g,s);a.push({track:E,type:qe.LocalVideoLowTrack})}if(g instanceof ci)if(m){const E=m.track;if(E instanceof zi)tM([g]),E.addAudioTrack(g),this.bindLocalAudioTrackEvents(g,!0);else{const b=nM([E,g]);x.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection will replace audioTrack [").concat(b.getTrackId(),"]")),this.replaceTrack(E,b)}}else d instanceof zi?(tM([g]),d.addAudioTrack(g)):d||!g._useAudioElement&&jn().webAudioMediaStreamDest&&!g._bypassWebAudio?d=nM(d?[g,d]:[g]):d=g}return d&&(x.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection will send audioTrack [").concat(d.getTrackId(),"]")),a.push({track:d,type:qe.LocalAudioTrack})),a}filterTobeUnpublishedTracks(t){const r=[],s=this.getAllTracks();t=Bv(t=t.filter(a=>s.indexOf(a)!==-1));for(const a of t){if(a instanceof ci){const c=this.localTrackMap.get(qe.LocalAudioTrack);if(!c)continue;c.track instanceof zi?(c.track.removeAudioTrack(a),this.unbindLocalAudioTrackEvents(a),c.track.trackList.length===0&&(r.push([qe.LocalAudioTrack,c]),c.track.close())):r.push([qe.LocalAudioTrack,c])}if(a instanceof Dr){const c=this.localTrackMap.get(qe.LocalVideoTrack);if(!c)continue;r.push([qe.LocalVideoTrack,c]);const d=this.localTrackMap.get(qe.LocalVideoLowTrack);d&&r.push([qe.LocalVideoLowTrack,d])}}return r}filterTobePublishedDataChannels(t){return t=(t=Bv(t)).filter(r=>this.localDataChannels.findIndex(s=>s.id===r.id)===-1)}filterTobeUnpublishedDataChannels(t){return t=(t=(t=Bv(t)).filter(r=>this.localDataChannels.indexOf(r)!==-1)).filter(r=>r._originDataChannel)}bindLocalTrackEvents(t){t.forEach(r=>{let{track:s,type:a}=r;switch(a){case qe.LocalVideoTrack:s.addListener(Tt.GET_STATS,this.handleGetLocalVideoStats),s.addListener(Tt.GET_RTC_STATS,this.handleGetRTCStats),s.addListener(Tt.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),s.addListener(Tt.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),s.addListener(Tt.NEED_UPDATE_VIDEO_ENCODER,this.handleUpdateVideoEncoder),s.addListener(Tt.NEED_UPDATE_VIDEO_SEND_PARAMETERS,this.handleUpdateVideoSendParameters),s.addListener(Tt.NEED_REPLACE_TRACK,this.handleReplaceTrack),s.addListener(Tt.NEED_MUTE_TRACK,this.handleMuteLocalTrack),s.addListener(Tt.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack);break;case qe.LocalAudioTrack:this.bindLocalAudioTrackEvents(s);case qe.LocalVideoLowTrack:}})}bindLocalAudioTrackEvents(t,r){t instanceof zi?t.trackList.forEach(s=>{s.addListener(Tt.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),s.addListener(Tt.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),s.addListener(Tt.GET_STATS,this.handleGetLocalAudioStats),s.addListener(Tt.NEED_MUTE_TRACK,this.handleMuteLocalTrack),s.addListener(Tt.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack)}):(t.addListener(Tt.GET_STATS,this.handleGetLocalAudioStats),t.addListener(Tt.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),t.addListener(Tt.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),t.addListener(Tt.NEED_MUTE_TRACK,this.handleMuteLocalTrack),t.addListener(Tt.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack),r||(t.addListener(Tt.NEED_REPLACE_TRACK,this.handleReplaceTrack),t.addListener(Tt.NEED_REPLACE_MIXING_TRACK,this.handleReplaceMixingTrack)))}unbindLocalTrackEvents(t){t||(t=Array.from(this.localTrackMap.entries()).map(r=>{let[s,{track:a}]=r;return{track:a,type:s}})),t.forEach(r=>{let{track:s,type:a}=r;switch(a){case qe.LocalVideoTrack:s.off(Tt.GET_STATS,this.handleGetLocalVideoStats),s.off(Tt.GET_RTC_STATS,this.handleGetRTCStats),s.off(Tt.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),s.off(Tt.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),s.off(Tt.NEED_UPDATE_VIDEO_ENCODER,this.handleUpdateVideoEncoder),s.off(Tt.NEED_UPDATE_VIDEO_SEND_PARAMETERS,this.handleUpdateVideoSendParameters),s.off(Tt.NEED_REPLACE_TRACK,this.handleReplaceTrack),s.off(Tt.NEED_MUTE_TRACK,this.handleMuteLocalTrack),s.off(Tt.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack);break;case qe.LocalAudioTrack:this.unbindLocalAudioTrackEvents(s);case qe.LocalVideoLowTrack:}})}unbindLocalAudioTrackEvents(t){t instanceof zi?t.trackList.forEach(r=>{r.off(Tt.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),r.off(Tt.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),r.off(Tt.GET_STATS,this.handleGetLocalAudioStats),r.off(Tt.NEED_MUTE_TRACK,this.handleMuteLocalTrack),r.off(Tt.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack)}):(t.off(Tt.GET_STATS,this.handleGetLocalAudioStats),t.off(Tt.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),t.off(Tt.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),t.off(Tt.NEED_REPLACE_TRACK,this.handleReplaceTrack),t.off(Tt.NEED_REPLACE_MIXING_TRACK,this.handleReplaceMixingTrack),t.off(Tt.NEED_MUTE_TRACK,this.handleMuteLocalTrack),t.off(Tt.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack))}bindRemoteTrackEvents(t,r){r instanceof e0&&r.addListener(Tt.GET_STATS,s=>{s(this.handleGetRemoteVideoStats(t))}),r instanceof t0&&r.addListener(Tt.GET_STATS,s=>{s(this.handleGetRemoteAudioStats(t))})}unbindRemoteTrackEvents(t){t&&t.removeAllListeners(Tt.GET_STATS)}unbindAllRemoteTrackEvents(){Array.from(this.remoteUserMap.entries()).forEach(t=>{let[r,s]=t;s.has(yt.AUDIO)&&this.unbindRemoteTrackEvents(r._audioTrack),s.has(yt.VIDEO)&&this.unbindRemoteTrackEvents(r._videoTrack)})}createGatewayPublishMessage(t,r){return t.map((s,a)=>{var c;let d,h,{track:m,type:g}=s;switch(g){case qe.LocalAudioTrack:d=or.Audio,h={dtx:m instanceof rT&&m._config.DTX,hq:!1,lq:!1,stereo:!1,speech:!1};break;case qe.LocalVideoTrack:d=rt(c=m._hints).call(c,yr.SCREEN_TRACK)?or.Screen:or.High,h=Jh(Jh({},_H(m)),{},{codec:this.store.codec,svc_mode:GP()});break;case qe.LocalVideoLowTrack:d=or.Low,h=Jh(Jh({},_H(m)),{},{codec:this.store.codec,svc_mode:GP()})}return{stream_type:d,attributes:h,ssrcs:r[a]}})}createGatewayUnpublishMessage(t){return t.map(r=>{var s;let a,[c,{track:d,ssrcs:h,id:m}]=r;switch(c){case qe.LocalVideoTrack:a=rt(s=d._hints).call(s,yr.SCREEN_TRACK)?or.Screen:or.High;break;case qe.LocalAudioTrack:a=or.Audio;break;case qe.LocalVideoLowTrack:a=or.Low}return{stream_type:a,ssrcs:h,mid:m}})}assignLocalTracks(t,r){t.forEach((s,a)=>{let{track:c,type:d}=s;this.localTrackMap.set(d,{track:c,id:r[a].id,ssrcs:r[a].localSSRC})})}withdrawLocalTracks(t){t.forEach(r=>{let[s]=r;this.localTrackMap.delete(s)})}bindConnectionEvents(t){t.onConnectionStateChange=async r=>{if(x.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onConnectionStateChange(").concat(r,")")),this.emit(Vt.PeerConnectionStateChange,r),r==="connecting"&&t instanceof $l&&!ni()&&se("FIRST_TCP_CANDIDATE")&&window.setTimeout(()=>{r==="connecting"&&t.extendCandidate()},se("FIRST_TCP_CANDIDATE_INTERVAL")),r!=="connected"||this.store.keyMetrics.peerConnectionEnd||this.store.peerConnectionEnd(),r==="connected"&&(this._restartTimer&&(window.clearTimeout(this._restartTimer),this._restartTimer=void 0),t instanceof $l&&h7(t,!0),this._isTryConnecting&&this.reportPCStats(Date.now(),!0,this._pcStatsUploadType),this._isTryConnecting=!1,this._isStartRestartIce=!1,this._pcStatsUploadType=pf.DISCONNECTED_OR_FAILED,Yc(this,Vt.QueryClientConnectionState)==="CONNECTED"&&this._isWaitPcToRePub)){const s=this.pendingLocalTracks.map(c=>c.getTrackId()),a=this.pendingLocalDataChannels.map(c=>"dc_".concat(c.id));At.reportApiInvoke(this.store.sessionId,{name:di.REPUB_AFTER_PC_CONNECTED,options:s.concat(a),tag:$r.TRACER}).onSuccess(),this.republish()}if(se("NEW_ICE_RESTART")&&t instanceof $l&&!ni()&&!this._forceTurn){if(rt(dH).call(dH,r)){if(this._isStartRestartIce)return;this._isStartRestartIce=!0;const s=c=>{rM(t)&&(x.debug("[".concat(this.store.clientId,"] [P2PChannel] try to restartICE, type is ").concat(c)),Yc(this,Vt.QueryClientConnectionState)==="CONNECTED"&&this.emit(Vt.RequestRestartICE,c))},a=()=>{rM(t)&&(this.reportPCStats(Date.now(),!1,this._pcStatsUploadType),x.debug("[".concat(this.store.clientId,"] P2PConnection disconnected timeout, force reconnect")),setTimeout(()=>this.emit(Vt.P2PLost),0),this.iceFailedCount+=1,this.requestReconnect())};return void(this._restartTimer=window.setTimeout(()=>{p7(t,s,a)},800))}}else{if(r==="disconnected"&&t.iceConnectionState==="disconnected")return setTimeout(()=>{t.iceConnectionState==="disconnected"&&se("ICE_RESTART")&&Yc(this,Vt.QueryClientConnectionState)==="CONNECTED"&&this.emit(Vt.RequestRestartICE)},800),void setTimeout(()=>{t.peerConnectionState==="disconnected"&&(x.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection disconnected timeout 4000ms, force reconnect")),this.reportPCStats(Date.now(),!1,this._pcStatsUploadType),this._isTryConnecting=!1,setTimeout(()=>this.emit(Vt.P2PLost),0),this.iceFailedCount+=1,this.requestReconnect())},4e3);r==="failed"&&(x.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection state failed, force reconnect")),this.reportPCStats(Date.now(),!1,this._pcStatsUploadType),setTimeout(()=>this.emit(Vt.P2PLost),0),this.iceFailedCount+=1,await this.requestReconnect())}},t.onICEConnectionStateChange=r=>{r!=="connected"||this.store.keyMetrics.iceConnectionEnd||this.store.iceConnectionEnd(),x.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICEConnectionStateChange(").concat(r,")")),At.reportApiInvoke(this.store.sessionId,{name:"ICEConnectionStateChange",options:r,tag:$r.TRACER}).onSuccess(),this.emit(Vt.IceConnectionStateChange,r)},t.onICETransportStateChange=r=>{x.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICETransportStateChange(").concat(r,")"))},t.onDTLSTransportStateChange=r=>{x.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onDTLSTransportStateChange(").concat(r,")"))},t.onDTLSTransportError=r=>{x.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onDTLSTransportError(").concat(r,")"))},t.onFirstAudioDecoded=r=>{var s;const a=Array.from(Xa(s=this.remoteUserMap).call(s)).find(d=>d._audioSSRC===r);var c;a&&(this.store.subscribe(a.uid,"audio",void 0,void 0,void 0,Date.now()),(c=a.audioTrack)===null||c===void 0||c.emit(Wl.FIRST_FRAME_DECODED),At.firstRemoteFrame(this.store.sessionId,Xi.FIRST_AUDIO_DECODE,Wr.FIRST_AUDIO_DECODE,{peer:a._uintid,subscribeElapse:Zs.measureFromSubscribeStart(this.store.clientId,r),subscribeRequestid:r,p2pid:this.store.p2pId}))},t.onFirstAudioReceived=r=>{var s;const a=Array.from(Xa(s=this.remoteUserMap).call(s)).find(c=>c._audioSSRC===r);a&&At.firstRemoteFrame(this.store.sessionId,Xi.FIRST_AUDIO_RECEIVED,Wr.FIRST_AUDIO_RECEIVED,{peer:a._uintid,subscribeElapse:Zs.measureFromSubscribeStart(this.store.clientId,r),subscribeRequestid:r,p2pid:this.store.p2pId})},t.onFirstVideoDecoded=(r,s,a)=>{var c;const d=Array.from(Xa(c=this.remoteUserMap).call(c)).find(h=>h._videoSSRC===r);d&&this.store.firstVideoFrameDecoded(d.uid,{firstDecoded:Date.now()}),this.reportVideoFirstFrameDecoded(r,s,a)},t.onFirstVideoRender=r=>{var s;const a=Array.from(Xa(s=this.remoteUserMap).call(s)).find(c=>c._videoSSRC===r);a&&(this.store.firstVideoFrameDecoded(a.uid,{firstPreRender:Date.now()}),this.reportVideoFirstFrameRender(a))},t.onFirstVideoReceived=r=>{var s;const a=Array.from(Xa(s=this.remoteUserMap).call(s)).find(c=>c._videoSSRC===r);a&&(this.store.firstVideoFrameDecoded(a.uid,{firstReceived:Date.now()}),At.firstRemoteFrame(this.store.sessionId,Xi.FIRST_VIDEO_RECEIVED,Wr.FIRST_VIDEO_RECEIVED,{peer:a._uintid,subscribeElapse:Zs.measureFromSubscribeStart(this.store.clientId,r),subscribeRequestid:r,p2pid:this.store.p2pId}))},t.onSelectedLocalCandidateChanged=(r,s)=>{const a=r.candidateType==="relay",c=s.candidateType==="relay";s.candidateType!=="unknown"&&a===c||this.emit(Vt.ConnectionTypeChange,a),x.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.SelectedLocalCandidateChanged(").concat(JSON.stringify(Xm(s))," -> ").concat(JSON.stringify(Xm(r)),")"))},t.onSelectedRemoteCandidateChanged=(r,s)=>{x.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.SelectedRemoteCandidateChanged(").concat(JSON.stringify(Xm(s))," -> ").concat(JSON.stringify(Xm(r)),")"))},t.onFirstVideoDecodedTimeout=r=>{this.reportVideoFirstFrameDecoded(r,void 0,void 0,!0)},t.getLocalVideoStats=()=>{const r=this.statsCollector.getLocalVideoTrackStats(),s=this.statsCollector.getRTCStats();return Jh(Jh({},r),s)},t.onICECandidateError=r=>{this._iceError=r}}resetConnection(t){t instanceof $l&&function(r){f0.delete(r.id),h7(r)}(t),t.close(),this.emit(Vt.PeerConnectionStateChange,"closed"),function(r){r.onConnectionStateChange=void 0,r.onICEConnectionStateChange=void 0,r.onICETransportStateChange=void 0,r.onDTLSTransportStateChange=void 0,r.onDTLSTransportError=void 0,r.onFirstAudioDecoded=void 0,r.onFirstAudioReceived=void 0,r.onFirstVideoDecoded=void 0,r.onFirstVideoReceived=void 0,r.onSelectedLocalCandidateChanged=void 0,r.onSelectedRemoteCandidateChanged=void 0,r.onFirstVideoDecodedTimeout=void 0,r.getLocalVideoStats=void 0}(t),this._isWaitPcToRePub=!1}filterTobeMutedTracks(t){const r=[];if(this.getAllTracks().indexOf(t)===-1)return r;const s=this.localTrackMap.get(qe.LocalAudioTrack);if(t instanceof ci&&(s==null?void 0:s.track)instanceof zi)return s.track.isActive||r.push([qe.LocalAudioTrack,s]),r;const a=Array.from(this.localTrackMap.entries()).find(c=>{let[,{track:d}]=c;return t===d});if(a&&(r.push(a),a[0]===qe.LocalVideoTrack)){const c=this.localTrackMap.get(qe.LocalVideoLowTrack);c&&r.push([qe.LocalVideoLowTrack,c])}return r}filterTobeUnmutedTracks(t){const r=[],s=this.localTrackMap.get(qe.LocalAudioTrack);if(t instanceof ci&&(s==null?void 0:s.track)instanceof zi)return s.track.isActive&&r.push([qe.LocalAudioTrack,s]),r;const a=Array.from(this.localTrackMap.entries()).find(c=>{let[,{track:d}]=c;return t===d});if(a)if(a[0]===qe.LocalVideoTrack){r.push(a);const c=this.localTrackMap.get(qe.LocalVideoLowTrack);c&&r.push([qe.LocalVideoLowTrack,c])}else r.push(a);return r}createMuteMessage(t){return t.map(r=>{var s;let a,[c,{track:d,ssrcs:h,id:m}]=r;switch(c){case qe.LocalAudioTrack:a=or.Audio;break;case qe.LocalVideoTrack:a=rt(s=d._hints).call(s,yr.SCREEN_TRACK)?or.Screen:or.High;break;case qe.LocalVideoLowTrack:a=or.Low}return{stream_type:a,ssrcs:h,mid:m}})}createUnmuteMessage(t){return t.map(r=>{var s;let a,[c,{track:d,ssrcs:h,id:m}]=r;switch(c){case qe.LocalAudioTrack:a=or.Audio;break;case qe.LocalVideoTrack:a=rt(s=d._hints).call(s,yr.SCREEN_TRACK)?or.Screen:or.High;break;case qe.LocalVideoLowTrack:a=or.Low}return{stream_type:a,ssrcs:h,mid:m}})}filterTobeUnSubscribedTracks(t,r){const s=[],a=this.remoteUserMap.get(t);if(!a)return s;if(r){const c=a.get(r);if(!c)return s;s.push([t,{kind:r,id:c}])}else Array.from(a.entries()).forEach(c=>{let[d,h]=c;s.push([t,{kind:d,id:h}])});return s}filterTobeUnSubscribedDataChannels(t,r){const s=[];return r.forEach(a=>{var c;(c=this.remoteDataChannelMap.get(t))!==null&&c!==void 0&&c.has(a.id)&&s.push(a)}),s}createUnsubscribeMessage(t){const r=[];return t.forEach(s=>{let[a,{kind:c,id:d}]=s;switch(c){case yt.VIDEO:return void(a._videoSSRC&&r.push({stream_type:yt.VIDEO,ssrcId:a._videoSSRC}));case yt.AUDIO:return void(a._audioSSRC&&r.push({stream_type:yt.AUDIO,ssrcId:a._audioSSRC}))}}),r}createUnsubscribeAllMessage(t){const r=new Map;return t.forEach(s=>{let[a,{kind:c}]=s;if(r.has(a)){let d=r.get(a);c===yt.VIDEO?d|=ss.Video:d|=ss.Audio,r.set(a,d)}else c===yt.VIDEO?r.set(a,ss.Video):r.set(a,ss.Audio)}),{users:Array.from(r.entries()).map(s=>{let[a,c]=s;return{stream_id:a.uid,stream_type:c}})}}withdrawRemoteTracks(t){t.forEach(r=>{let[s,{kind:a}]=r;const c=this.remoteUserMap.get(s);c&&(c.delete(a),Array.from(c.entries()).length===0&&this.remoteUserMap.delete(s))})}async updateBitrateLimit(t){const r=this.localTrackMap.get(qe.LocalVideoTrack),s=this.localTrackMap.get(qe.LocalVideoLowTrack);r&&(await r.track.setBitrateLimit(t.uplink),await new pt((a,c)=>{this.handleUpdateVideoEncoder(r.track,a,c,!0)})),s&&t.low_stream_uplink&&(await s.track.setBitrateLimit({max_bitrate:t.low_stream_uplink.bitrate,min_bitrate:t.low_stream_uplink.bitrate||0}),await new pt((a,c)=>{this.handleUpdateVideoEncoder(s.track,a,c,!0)}))}isP2PDisconnected(){return this.connection?this.connection.peerConnectionState!=="connected":!0}isPreallocation(){return this.connection instanceof $l&&this.connection.isPreallocation}isPreSub(){return this.connection instanceof $l&&this.connection.isPreSub()}mapPubResToRemoteConfig(t,r,s){return t.map((a,c)=>{var d;let{stream_type:h}=a;const m=(d=r.find(g=>{let{stream_type:E}=g;return h===E}))===null||d===void 0?void 0:d.attributes;if(m&&se("DISABLE_SCREEN_SHARE_REMB")){const g=s[c]._hints;(rt(g).call(g,yr.SCREEN_TRACK)||rt(g).call(g,yr.SCREEN_LOW_TRACK))&&(m.remb=!1,x.debug("disable remb for screen share, hints:",g))}return m})}async tryToUnmuteAudio(t){for(let s=0;s<t.length;s++)if(t[s]instanceof ci){var r;const a=this.filterTobeUnmutedTracks(t[s]);if(a.length===0)continue;await((r=this.connection)===null||r===void 0?void 0:r.unmuteLocal(a.map(d=>{let[,{id:h}]=d;return h})));const c=this.createUnmuteMessage(a);return void await Er(this,Vt.RequestUnmuteLocal,c)}}bindStatsUploaderEvents(){this.statsUploader.requestStats=()=>this.getStats(),this.statsUploader.requestLocalMedia=()=>Array.from(this.localTrackMap.entries()),this.statsUploader.requestRemoteMedia=()=>Array.from(this.remoteUserMap.entries()),this.statsUploader.requestVideoIsReady=t=>{var r;return!((r=this.connection)===null||r===void 0||!r.getRemoteVideoIsReady(t))},this.statsUploader.requestUpload=(t,r)=>this.emit(Vt.RequestUpload,t,r),this.statsUploader.requestUploadStats=t=>this.emit(Vt.RequestUploadStats,t),this.statsUploader.requestAllTracks=()=>this.getAllTracks(),this.statsUploader.requestTransportStats=()=>{var t;return{connectState:((t=this.connection)===null||t===void 0?void 0:t.peerConnectionState)||"closed"}}}unbindStatsUploaderEvents(){this.statsUploader.requestStats=void 0,this.statsUploader.requestLocalMedia=void 0,this.statsUploader.requestRemoteMedia=void 0,this.statsUploader.requestVideoIsReady=void 0}async requestReconnect(){this.dtlsFailedCount+=1,await bs(zL(this.dtlsFailedCount,Mi)),this.emit(Vt.RequestReconnect)}async reconnectP2P(){const t=Array.from(this.localTrackMap.entries()),r=this.createGatewayUnpublishMessage(t);Array.from(this.remoteUserMap.entries()),r.length>0&&await Ms(this,Vt.RequestUnpublishForReconnectPC,r),this.disconnectForReconnect(),this.emit(Vt.RequestReconnectPC)}canPublishLowStream(){return this.localTrackMap.has(qe.LocalVideoTrack)||this.pendingLocalTracks.some(t=>t instanceof Dr)}throwIfTrackTypeNotMatch(t){if(t.filter(r=>r instanceof Dr).length>1)throw new Le(te.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS);if(t.filter(r=>r instanceof ci).length>1&&(t.some(r=>r instanceof ci&&r._bypassWebAudio)||!jn().webAudioMediaStreamDest))throw new Le(te.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser doesn't support MediaStreamDestNode");for(const r of t){if(r instanceof Dr&&this.pendingLocalTracks.some(s=>s instanceof Dr))throw new Le(te.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS);if(r instanceof ci&&this.pendingLocalTracks.some(s=>s instanceof ci)&&(!jn().webAudioMediaStreamDest||r._bypassWebAudio||this.pendingLocalTracks.some(s=>s instanceof ci&&s._bypassWebAudio)))throw new Le(te.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser doesn't support MediaStreamDestNode")}}getLowVideoTrack(t,r){var s;const a=!se("DISABLE_DUAL_STREAM_USE_ENCODING")&&jn().supportDualStreamEncoding,c=Jh(Jh({},{width:160,height:120,framerate:15,bitrate:50}),r);let d;d=a?t._mediaStreamTrack.clone():iM(t,c);const h=vr(8,"track-low-"),m=new Dr(d,Jh(Jh({},a&&{scaleResolutionDownBy:V2(c,t)}),{},{frameRate:c.framerate,bitrateMax:c.bitrate,bitrateMin:c.bitrate}),void 0,void 0,h);return m.on(ry.TRANSCEIVER_UPDATED,g=>{t._updateRtpTransceiver(g,qv.LOW_STREAM)}),m._hints.push(yr.LOW_STREAM),rt(s=t._hints).call(s,yr.SCREEN_TRACK)&&m._hints.push(yr.SCREEN_LOW_TRACK),t.on("sei-to-send",g=>{m.emit("sei-to-send",g)}),t.addListener(Tt.NEED_CLOSE,()=>{m.close()}),m}async globalLock(){return this.mutex.lock("From P2PChannel.globalLock")}async reportPCStats(t,r,s){let a=arguments.length>3&&arguments[3]!==void 0?arguments[3]:null;if(this.connection&&this.connection instanceof $l){var c,d,h,m;const g=this.store.keyMetrics.descriptionStart||0,{iceConnectionState:E,dtlsTransportState:b,peerConnectionState:I}=this.connection,{local:A,remote:k}=await this.connection.getSelectedCandidatePair();At.pcStats(this.store.sessionId,{startTime:g,eventElapse:t-g||0,iceconnectionsate:E,dtlsstate:b,connectionstate:I,intSucc:r?1:2,error:this._iceError||a||"",selectedLocalCandidateProtocol:(c=A==null?void 0:A.protocol)!==null&&c!==void 0?c:"",selectedLocalCandidateType:(d=A.candidateType)!==null&&d!==void 0?d:"",selectedLocalCandidateAddress:"".concat(A.address,":").concat(A.port),selectedRemoteCandidateProtocol:(h=k.protocol)!==null&&h!==void 0?h:"",selectedRemoteCandidateType:(m=k.candidateType)!==null&&m!==void 0?m:"",selectedRemoteCandidateAddress:"".concat(k.address,":").concat(k.port),restartCnt:s,preallocation:this.connection.isPreallocation}),this._iceError=null}}reportVideoFirstFrameRender(t){const r=this.store.keyMetrics,s=r.firstVideoFrameDecoded.find(b=>b.userId===t.uid);if(!s)return;const{isInternalUpload:a,isExternalUpload:c}=s;if(a&&c)return;const{subscribeEnd:d,firstPreRender:h,peerPublishDuration:m,peerPubStatusMs:g}=s;let{firstRender:E=0}=s;if(d&&(E||h)&&m&&g){s.isInternalUpload=!0;const{playEnd:b}=s;b&&(s.isExternalUpload=!0);const{firstPreRender:I=0}=s;E=I||E;const A=t.videoTrack,k={peer:t._uintid,width:(A==null?void 0:A._videoWidth)||0,height:(A==null?void 0:A._videoHeight)||0,ssrc:t._videoSSRC||0,p2pid:this.store.p2pId,peerPublishDuration:m,peerPubStatusMs:g,joinChannelStart:r.joinStart||0,preloadStart:r.preloadStart||0,preloadEnd:r.preloadEnd||0,apStart:r.requestAPStart||0,apEnd:r.requestAPEnd||0,suaEnd:r.requestSUAEnd||0,beforeConnect:r.beforeConnect||0,peerReceiver:r.peerReceiver||0,ice:r.iceConnectionEnd||0,pc:r.peerConnectionEnd||0,signalConnected:r.signalConnected||0,joinReq:r.joinReq||0,joinRes:r.joinRep||0,userJoinNotify:s.userJoinNotify||0,videoAddNotify:s.videoAddNotify||0,subscribeStart:s.subscribeStart||0,subscribeEnd:s.subscribeEnd||0,firstReceived:s.firstReceived||0,firstDecoded:s.firstDecoded||0,firstPreRender:I||0,firstRender:b?Math.max(E,b):Math.max(E,d),playStart:s.playStart||0,playEnd:s.playEnd||0,isPreSub:!(!t._videoSSRC||!this.isPreSubScribe(t._videoSSRC)),isPrePc:this.isPreallocation(),isPreInstantVideo:BW(this.store)};At.firstXLAPeerFirstVideoFrame(this.store.sessionId,k)}}reportVideoFirstFrameDecoded(t,r,s,a){var c;const d=Array.from(Xa(c=this.remoteUserMap).call(c)).find(h=>h._videoSSRC===t);if(d){a||this.store.subscribe(d.uid,"video",void 0,void 0,void 0,void 0,Date.now());const h=this.store.keyMetrics,m=h.subscribe.find(g=>g.userId===d.uid&&g.type==="video");At.firstRemoteVideoDecode(this.store.sessionId,Xi.FIRST_VIDEO_DECODE,Wr.FIRST_VIDEO_DECODE,{peer:d._uintid,videowidth:r,videoheight:s,subscribeElapse:Zs.measureFromSubscribeStart(this.store.clientId,t),subscribeRequestid:t,p2pid:this.store.p2pId,apEnd:h.requestAPEnd||0,apStart:h.requestAPStart||0,joinGwEnd:h.joinGatewayEnd||0,joinGwStart:h.joinGatewayStart||0,pcEnd:h.peerConnectionEnd||0,pcStart:h.peerConnectionStart||0,subscriberEnd:(m==null?void 0:m.subscribeEnd)||0,subscriberStart:(m==null?void 0:m.subscribeStart)||0,videoAddNotify:(m==null?void 0:m.streamAdded)||0,state:a?1:0,firstFrame:(m==null?void 0:m.firstFrame)||0})}}async remoteMediaSsrcChanged(t,r,s){if(!this.connection)return!1;const a=this.remoteUserMap.get(t);if(!a)return!1;const c=a.get(r);if(!c)return!1;const d=await this.connection.getRemoteSSRC(c);return d!==void 0&&d!==s}unbindRtpTransceiver(){this.localTrackMap.size!==0&&Array.from(this.localTrackMap.entries()).forEach(t=>{let[r,{track:s}]=t;r===qe.LocalVideoLowTrack?s._updateRtpTransceiver(void 0,qv.LOW_STREAM):s._updateRtpTransceiver(void 0)})}},Rt(wn.prototype,"startP2PConnection",[ko],Object.getOwnPropertyDescriptor(wn.prototype,"startP2PConnection"),wn.prototype),Rt(wn.prototype,"connect",[ko],Object.getOwnPropertyDescriptor(wn.prototype,"connect"),wn.prototype),Rt(wn.prototype,"updateRemoteRTPCapabilities",[ko],Object.getOwnPropertyDescriptor(wn.prototype,"updateRemoteRTPCapabilities"),wn.prototype),Rt(wn.prototype,"publishDataChannel",[ko],Object.getOwnPropertyDescriptor(wn.prototype,"publishDataChannel"),wn.prototype),Rt(wn.prototype,"unpublish",[ko],Object.getOwnPropertyDescriptor(wn.prototype,"unpublish"),wn.prototype),Rt(wn.prototype,"unpublishDataChannel",[ko],Object.getOwnPropertyDescriptor(wn.prototype,"unpublishDataChannel"),wn.prototype),Rt(wn.prototype,"unpublishLowStream",[ko],Object.getOwnPropertyDescriptor(wn.prototype,"unpublishLowStream"),wn.prototype),Rt(wn.prototype,"subscribeDataChannel",[ko],Object.getOwnPropertyDescriptor(wn.prototype,"subscribeDataChannel"),wn.prototype),Rt(wn.prototype,"subscribe",[ko],Object.getOwnPropertyDescriptor(wn.prototype,"subscribe"),wn.prototype),Rt(wn.prototype,"massSubscribe",[ko],Object.getOwnPropertyDescriptor(wn.prototype,"massSubscribe"),wn.prototype),Rt(wn.prototype,"unsubscribe",[ko],Object.getOwnPropertyDescriptor(wn.prototype,"unsubscribe"),wn.prototype),Rt(wn.prototype,"unsubscribeDataChannel",[ko],Object.getOwnPropertyDescriptor(wn.prototype,"unsubscribeDataChannel"),wn.prototype),Rt(wn.prototype,"massUnsubscribe",[ko],Object.getOwnPropertyDescriptor(wn.prototype,"massUnsubscribe"),wn.prototype),Rt(wn.prototype,"muteRemote",[ko],Object.getOwnPropertyDescriptor(wn.prototype,"muteRemote"),wn.prototype),Rt(wn.prototype,"unmuteRemote",[ko],Object.getOwnPropertyDescriptor(wn.prototype,"unmuteRemote"),wn.prototype),Rt(wn.prototype,"hasRemoteMediaWithLock",[ko],Object.getOwnPropertyDescriptor(wn.prototype,"hasRemoteMediaWithLock"),wn.prototype),Rt(wn.prototype,"disconnectForReconnect",[ko],Object.getOwnPropertyDescriptor(wn.prototype,"disconnectForReconnect"),wn.prototype),Rt(wn.prototype,"updateBitrateLimit",[ko],Object.getOwnPropertyDescriptor(wn.prototype,"updateBitrateLimit"),wn.prototype),Rt(wn.prototype,"remoteMediaSsrcChanged",[ko],Object.getOwnPropertyDescriptor(wn.prototype,"remoteMediaSsrcChanged"),wn.prototype),wn);function ko(t,r,s){const a=t[r];if(typeof a!="function")throw new Error("Cannot use mutex on object property.");return s.value=async function(){const c=this.mutex,d=await c.lock("From P2PChannel.".concat(r));try{for(var h=arguments.length,m=new Array(h),g=0;g<h;g++)m[g]=arguments[g];return await a.apply(this,m)}finally{d()}},s}function g7(t,r){var s=Object.keys(t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);r&&(a=a.filter(function(c){return Object.getOwnPropertyDescriptor(t,c).enumerable})),s.push.apply(s,a)}return s}function _7(t){for(var r=1;r<arguments.length;r++){var s=arguments[r]!=null?arguments[r]:{};r%2?g7(Object(s),!0).forEach(function(a){Y(t,a,s[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(s)):g7(Object(s)).forEach(function(a){Object.defineProperty(t,a,Object.getOwnPropertyDescriptor(s,a))})}return t}const C_e=Date.now(),R_e=20,oM=new Map,l1=new Map;async function y7(t){const r=oM.get(t),s=Array.isArray(r)&&r[r.length-1],a=l1.get(t);if(!s)return void(a.isSyncing=!1);const c={uid:s.uid,payload:s.payload};a.firstRecvTs===0&&(a.firstRecvTs=s.recvTs,a.firstSendTs=s.sendTs);const d=s.sendTs-a.firstSendTs,h=d-(Date.now()-a.firstRecvTs);h>0&&(a.firstRecvTs=Date.now()-d);let m=s.mediaDelay+h;m<=0?(r.pop(),E7(s.context,c),m=0):m=Math.min(m,R_e),setTimeout(()=>r.length&&y7(t),m)}function E7(t,r){t.safeEmit(Rn.STREAM_MESSAGE,r.uid,r.payload),t.onStreamMessage&&t.onStreamMessage(r)}function I_e(t){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,s=arguments.length>2?arguments[2]:void 0;if(!t.syncWithAudio)return E7(s,{uid:t.uid,payload:t.payload});const a="".concat(s.id,"-").concat(t.uid),c=oM.get(a)||[],d=c.findIndex(E=>t.sendTs>=E.sendTs),h=_7(_7({},t),{},{context:s,mediaDelay:r,recvTs:Date.now()});d===-1?c.push(h):c.splice(d,0,h),oM.set(a,c);let m=!1;var g;l1.has(a)?m=!((g=l1.get(a))===null||g===void 0||!g.isSyncing):l1.set(a,{isSyncing:m,firstRecvTs:0,firstSendTs:0}),m||y7(a)}const A_e=xn().name;function v7(t,r){var s=Object.keys(t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);r&&(a=a.filter(function(c){return Object.getOwnPropertyDescriptor(t,c).enumerable})),s.push.apply(s,a)}return s}function S7(t){for(var r=1;r<arguments.length;r++){var s=arguments[r]!=null?arguments[r]:{};r%2?v7(Object(s),!0).forEach(function(a){Y(t,a,s[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(s)):v7(Object(s)).forEach(function(a){Object.defineProperty(t,a,Object.getOwnPropertyDescriptor(s,a))})}return t}const m0="websdk_ng_cache_parameter",P_e=se("MAX_PRELOAD_ASYNC_LENGTH"),k_e=1e4,py=new Map,fy=[];let aM=null,cM=0,lM=0;const u1=new Map,O_e=function(t,r){const s=[];let a=0;const c=async()=>{const d=s.shift();d&&await d(),s.length>0&&a<r?c():a--};return async function(){for(var d=arguments.length,h=new Array(d),m=0;m<d;m++)h[m]=arguments[m];return new pt(async(g,E)=>{s.push(async()=>{try{const b=await t(...h);g(b)}catch(b){E(b)}}),a<r&&(a++,c())})}}(b7,P_e),uM=Sa.CancelToken.source();async function b7(t,r,s,a,c,d){try{if(!se("ENABLE_PRELOAD"))return;if(!jn().supportWebCrypto)return void Wm(()=>{x.warn("Your browser does not support preloading, this feature  be run in a secure environment")},"preload_webcrypto_not_supported");if(!s&&s!==null)throw new Le(te.INVALID_PARAMS,"Invalid token: ".concat(s,". If you don not use token, set it to null"));s&&Ss(s,"token",1,2047),Ss(t,"appid",1,2047),VP(r),a&&FP(a);const h=ty();x.debug("preload channel ".concat(r,", uid is ").concat(a));const m={appId:t,cname:r,token:s||t,uid:typeof a!="string"?a:null,sid:h,proxyServer:c};let g,E;typeof a=="string"?(m.stringUid=a,[E,g]=await pt.all([f_e(a,{sid:h,appId:t},uM.token),qH(S7(S7({},m),{},{token:s||t,uid:0}),uM.token)]),m.uid=E.uid,g.gatewayInfo.uid=m.uid,g.gatewayInfo.res.uid=m.uid):(d&&(m.stringUid=d),g=await qH(m,uM.token));const b={sid:h,appId:t,cname:r,token:s||t,uid:m.stringUid||a,intUid:m.uid||g.gatewayInfo.uid,stringUid:m.stringUid,ts:Date.now(),sua:E,ap:g};await async function(I){let A;try{I.uid&&T7({appId:I.appId,cname:I.cname,token:I.token,uid:I.uid,stringUid:I.stringUid});const k=A7(I),W=await async function(B,ee){try{const Z=await window.crypto.subtle.importKey("raw",fW(ee),"AES-GCM",!1,["encrypt"]),oe=await window.crypto.subtle.encrypt({name:"AES-GCM",iv:new Uint8Array(1)},Z,ey(window.btoa(JSON.stringify(B))));return Gm(new Uint8Array(oe))}catch{return}}(I,I.token||I.appId);if(!W)return;A=I7(m0);const j=A?JSON.parse(A):[];j.push({[k]:W}),j.length>se("AP_CACHE_NUM")&&j.shift(),d1(m0,JSON.stringify(j))}catch(k){x.warn("Error caching server parameters:",k.message),d1(m0,"")}}(b),cM++}catch(h){throw lM++,function(m){aM||(aM=window.setTimeout(()=>{let E="";u1.forEach((b,I)=>{E+="".concat(I,": ").concat(b," ;")}),At.reportApiInvoke(null,{name:di.PRELOAD,options:{success:cM,failed:lM,err:E}}).onError(m),cM=0,lM=0,u1.clear(),aM=null},k_e));const g=u1.get(m.code)||0;u1.set(m.code,g+1)}(h),h}}async function w7(t){try{if(se("AP_REQUEST_DETAIL")||se("ENABLE_ROLE_SELECT_EDGE"))return;const r=T7(t);if(!r||t.cloudProxyServer!=="disabled")return;const s=await async function(a,c){try{const d=await window.crypto.subtle.importKey("raw",fW(c),"AES-GCM",!1,["decrypt"]),h=await window.crypto.subtle.decrypt({name:"AES-GCM",iv:new Uint8Array(1)},d,ey(a));return JSON.parse(window.atob(Gm(new Uint8Array(h))))}catch{return}}(r,t.token||t.appId);if(!s||!function(a,c){return a.cname===c.cname&&a.appId===c.appId&&a.token===c.token?c.stringUid?a.stringUid===c.stringUid:typeof c.uid=="number"?a.uid===c.uid:a.uid==c.uid:!1}(s,t))return;if(s&&Date.now()-s.ts<se("AP_CACHE_LIFETIME"))return s}catch(r){x.warn("Error get preloadInfo",r.message)}}function T7(t){let r;try{if(r=I7(m0),!r)return;const s=JSON.parse(r),a=A7(t),c=function(h,m){for(let g=h.length-1;g>=0;g--)if(m(h[g]))return g;return-1}(s,h=>a in h);if(c===-1)return;const d=s.splice(c,1)[0];return d1(m0,JSON.stringify(s)),d[a]}catch(s){x.warn("Error delete preload info: ".concat(r),s.message),d1(m0,"")}}function dM(t){if(t){let r=py.get(t);r&&(window.clearTimeout(r),r=null,py.delete(t)),rt(fy).call(fy,t)||t.cloudProxyServer!=="disabled"||fy.push(t)}if(py.size<se("AP_CACHE_NUM")&&fy.length>0){const r=fy.shift();py.set(r,window.setTimeout(async()=>{const{appId:s,cname:a,token:c,stringUid:d,uid:h,proxyServer:m}=r;try{await O_e(s,a,c,h,m,d),py.has(r)&&dM(r)}catch(g){x.warn("update preload failed",g.message),C7(r)}},se("AP_UPDATE_INTERVAL")))}}function C7(t){const r=fy.indexOf(t);r!==-1&&fy.splice(r,1);let s=py.get(t);s&&(window.clearTimeout(s),s=null,py.delete(t),dM())}function R7(t,r){const s=t.sua,a=t.ap;r&&s&&At.reqUserAccount(t.sid,{lts:s.requestTime,elapse:s.elapse,success:!0,serverAddr:s.url,stringUid:r,uid:t.intUid,errorCode:null,extend:s.req}),At.reportResourceTiming(t.ap.url,t.sid),At.joinWebProxyAP(t.sid,{lts:a.requestTime,elapse:a.elapse,sucess:1,apServerAddr:a.url,turnServerAddrList:a.proxyInfo.addresses.map(c=>c.ip).join(","),eventType:"disabled",unilbsServerIds:[Ri.CHOOSE_SERVER,Ri.CLOUD_PROXY_FALLBACK].toString()}),At.joinChooseServer(t.sid,{lts:a.requestTime,elapse:a.elapse,succ:!0,csAddr:a.url,opid:a.opid,serverList:a.gatewayInfo.gatewayAddrs.map(c=>c.address),ec:null,cid:a.gatewayInfo.cid.toString(),uid:a.gatewayInfo.uid.toString(),csIp:a.gatewayInfo.csIp,unilbsServerIds:[Ri.CHOOSE_SERVER].toString(),isHttp3:a.isHttp3})}function I7(t){return window.atob(window.localStorage.getItem(t)||"")}function d1(t,r){window.localStorage.setItem(t,window.btoa(r))}function A7(t){let r="".concat(t.appId,"_").concat(t.cname);return typeof t.uid=="string"&&(r+="_s_".concat(t.uid)),typeof t.uid=="number"&&(r+="_".concat(t.uid)),t.token&&(r+="_".concat(t.token)),SW(r)}function N_e(t){let r=function(){const s=L_e.pop();return s?(s.offset=s.limit=0,s):{bytes:new Uint8Array(64),offset:0,limit:0}}();return function(s,a){let c=s.appId;c!==void 0&&(Ii(a,10),rg(a,c));let d=s.cid;d!==void 0&&(Ii(a,16),Ii(a,d));let h=s.cname;h!==void 0&&(Ii(a,26),rg(a,h));let m=s.deviceId;m!==void 0&&(Ii(a,34),rg(a,m));let g=s.elapse;g!==void 0&&(Ii(a,40),ig(a,g));let E=s.fileSize;E!==void 0&&(Ii(a,48),ig(a,g0(E)));let b=s.height;b!==void 0&&(Ii(a,56),ig(a,g0(b)));let I=s.jpg;I!==void 0&&(Ii(a,66),Ii(a,I.length),k7(a,I));let A=s.networkType;A!==void 0&&(Ii(a,72),ig(a,g0(A)));let k=s.osType;k!==void 0&&(Ii(a,80),ig(a,g0(k)));let W=s.requestId;W!==void 0&&(Ii(a,90),rg(a,W));let j=s.sdkVersion;j!==void 0&&(Ii(a,98),rg(a,j));let B=s.sequence;B!==void 0&&(Ii(a,104),ig(a,g0(B)));let ee=s.sid;ee!==void 0&&(Ii(a,114),rg(a,ee));let Z=s.timestamp;Z!==void 0&&(Ii(a,120),ig(a,Z));let oe=s.uid;oe!==void 0&&(Ii(a,128),Ii(a,oe));let ye=s.vid;ye!==void 0&&(Ii(a,136),Ii(a,ye));let _e=s.width;_e!==void 0&&(Ii(a,144),ig(a,g0(_e)));let ue=s.service;ue!==void 0&&(Ii(a,152),Ii(a,ue));let Ce=s.callbackData;Ce!==void 0&&(Ii(a,162),Ii(a,Ce.length),k7(a,Ce));let Ue=s.ticket;Ue!==void 0&&(Ii(a,170),rg(a,Ue));let ze=s.vendorConfigs;ze!==void 0&&(Ii(a,178),rg(a,ze))}(t,r),function(s){let a=s.bytes,c=s.limit;return a.length===c?a:a.subarray(0,c)}(r)}function D_e(t){return function(s){let a={};e:for(;!M_e(s);){let c=yT(s);switch(c>>>3){case 0:break e;case 1:a.code=yT(s);break;case 2:a.msg=O7(s,yT(s));break;case 3:a.requestId=O7(s,yT(s));break;case 4:a.timestamp=U_e(s,!1);break;default:x_e(s,7&c)}}return a}({bytes:r=t,offset:0,limit:r.length});var r}function x_e(t,r){switch(r){case 0:for(;128&zu(t););break;case 2:hM(t,yT(t));break;case 5:hM(t,4);break;case 1:hM(t,8);break;default:throw new Error("Unimplemented type: "+r)}}function g0(t){return{low:t|=0,high:t>>31,unsigned:t>=0}}let L_e=[];function hM(t,r){if(t.offset+r>t.limit)throw new Error("Skip past limit");t.offset+=r}function M_e(t){return t.offset>=t.limit}function h1(t,r){let s=t.bytes,a=t.offset,c=t.limit,d=a+r;if(d>s.length){let h=new Uint8Array(2*d);h.set(s),t.bytes=h}return t.offset=d,d>c&&(t.limit=d),a}function P7(t,r){let s=t.offset;if(s+r>t.limit)throw new Error("Read past limit");return t.offset+=r,s}function k7(t,r){let s=h1(t,r.length);t.bytes.set(r,s)}function O7(t,r){let s=P7(t,r),a=String.fromCharCode,c=t.bytes,d="",h="";for(let m=0;m<r;m++){let g,E,b,I,A=c[m+s];(128&A)==0?h+=a(A):(224&A)==192?m+1>=r?h+=d:(g=c[m+s+1],(192&g)!=128?h+=d:(I=(31&A)<<6|63&g,I<128?h+=d:(h+=a(I),m++))):(240&A)==224?m+2>=r?h+=d:(g=c[m+s+1],E=c[m+s+2],(49344&(g|E<<8))!=32896?h+=d:(I=(15&A)<<12|(63&g)<<6|63&E,I<2048||I>=55296&&I<=57343?h+=d:(h+=a(I),m+=2))):(248&A)==240?m+3>=r?h+=d:(g=c[m+s+1],E=c[m+s+2],b=c[m+s+3],(12632256&(g|E<<8|b<<16))!=8421504?h+=d:(I=(7&A)<<18|(63&g)<<12|(63&E)<<6|63&b,I<65536||I>1114111?h+=d:(I-=65536,h+=a(55296+(I>>10),56320+(1023&I)),m+=3))):h+=d}return h}function rg(t,r){let s=r.length,a=0;for(let h=0;h<s;h++){let m=r.charCodeAt(h);m>=55296&&m<=56319&&h+1<s&&(m=(m<<10)+r.charCodeAt(++h)-56613888),a+=m<128?1:m<2048?2:m<65536?3:4}Ii(t,a);let c=h1(t,a),d=t.bytes;for(let h=0;h<s;h++){let m=r.charCodeAt(h);m>=55296&&m<=56319&&h+1<s&&(m=(m<<10)+r.charCodeAt(++h)-56613888),m<128?d[c++]=m:(m<2048?d[c++]=m>>6&31|192:(m<65536?d[c++]=m>>12&15|224:(d[c++]=m>>18&7|240,d[c++]=m>>12&63|128),d[c++]=m>>6&63|128),d[c++]=63&m|128)}}function zu(t){return t.bytes[P7(t,1)]}function N7(t,r){let s=h1(t,1);t.bytes[s]=r}function yT(t){let r,s=0,a=0;do r=zu(t),s<32&&(a|=(127&r)<<s),s+=7;while(128&r);return a}function Ii(t,r){for(r>>>=0;r>=128;)N7(t,127&r|128),r>>>=7;N7(t,r)}function U_e(t,r){let s,a=0,c=0,d=0;return s=zu(t),a=127&s,128&s&&(s=zu(t),a|=(127&s)<<7,128&s&&(s=zu(t),a|=(127&s)<<14,128&s&&(s=zu(t),a|=(127&s)<<21,128&s&&(s=zu(t),c=127&s,128&s&&(s=zu(t),c|=(127&s)<<7,128&s&&(s=zu(t),c|=(127&s)<<14,128&s&&(s=zu(t),c|=(127&s)<<21,128&s&&(s=zu(t),d=127&s,128&s&&(s=zu(t),d|=(127&s)<<7))))))))),{low:a|c<<28,high:c>>>4|d<<24,unsigned:r}}function ig(t,r){let s=r.low>>>0,a=(r.low>>>28|r.high<<4)>>>0,c=r.high>>>24,d=c===0?a===0?s<16384?s<128?1:2:s<1<<21?3:4:a<16384?a<128?5:6:a<1<<21?7:8:c<128?9:10,h=h1(t,d),m=t.bytes;switch(d){case 10:m[h+9]=c>>>7&1;case 9:m[h+8]=d!==9?128|c:127&c;case 8:m[h+7]=d!==8?a>>>21|128:a>>>21&127;case 7:m[h+6]=d!==7?a>>>14|128:a>>>14&127;case 6:m[h+5]=d!==6?a>>>7|128:a>>>7&127;case 5:m[h+4]=d!==5?128|a:127&a;case 4:m[h+3]=d!==4?s>>>21|128:s>>>21&127;case 3:m[h+2]=d!==3?s>>>14|128:s>>>14&127;case 2:m[h+1]=d!==2?s>>>7|128:s>>>7&127;case 1:m[h]=d!==1?128|s:127&s}}const D7={},x7={},p1=4294967296,V_e=p1*p1,F_e=V_e/2;M7(0,!0);const L7=M7(0),j_e=ET(0,-2147483648,!1),B_e=ET(-1,2147483647,!1);function M7(t,r){let s,a,c;return r?(c=0<=(t>>>=0)&&t<256)&&(a=x7[t],a)?a:(s=ET(t,0,!0),c&&(x7[t]=s),s):(c=-128<=(t|=0)&&t<128)&&(a=D7[t],a)?a:(s=ET(t,t<0?-1:0,!1),c&&(D7[t]=s),s)}function ET(t,r,s){return{low:0|t,high:0|r,unsigned:!!s}}function U7(t,r){if(isNaN(t))return L7;{if(t<=-9223372036854776e3)return j_e;if(t+1>=F_e)return B_e}return t<0?L7:ET(t%p1|0,t/p1|0,r)}function V7(t,r){var s=Object.keys(t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);r&&(a=a.filter(function(c){return Object.getOwnPropertyDescriptor(t,c).enumerable})),s.push.apply(s,a)}return s}class pM extends Jr{get connectionState(){return this._connectionState}set connectionState(r){if(this._connectionState===r)return;const s=this._connectionState;this._connectionState=r,this.emit($d.CONNECTION_STATE_CHANGE,r,s)}get quality(){return this._quality}set quality(r){this._quality=r>1?1:r<.1?.1:r,this._qualityTimer&&(window.clearTimeout(this._qualityTimer),this._qualityTimer=null),this._quality>=1||(this._qualityTimer=window.setTimeout(()=>{this.quality=this._quality/this._qualityRatio},6e4))}constructor(r){var s;super(),Y(this,"name","AgoraRTCImageModeration"),Y(this,"_connectionState",Hl.CONNECTING),Y(this,"_sequence",0),Y(this,"_moderationStartTime",void 0),Y(this,"_workerConnection",void 0),Y(this,"_workerMessageLengthLimit",void 0),Y(this,"_qualityRatio",void 0),Y(this,"_connectInfo",void 0),Y(this,"_cancelTokenSource",Sa.CancelToken.source()),Y(this,"_retryConfig",void 0),Y(this,"_moderationInterval",void 0),Y(this,"_moderationTimer",null),Y(this,"_moderationMode",1),Y(this,"_quality",1),Y(this,"_qualityTimer",null),Y(this,"_ticket",void 0),Y(this,"_moderationIntervalMinimum",void 0),Y(this,"_uploadFailedNum",0),Y(this,"_uploadNum",0),Y(this,"_uploadTimer",null),Y(this,"_extraInfo",void 0),Y(this,"_vendor",""),Y(this,"_encoder",new TextEncoder),Y(this,"_moderationId",void 0),Y(this,"inspectImage",()=>{if(this.connectionState!==Hl.CONNECTED)throw new Pe(te.OPERATION_ABORTED,"image moderation service connection status is ".concat(this.connectionState));this._moderationTimer&&(window.clearInterval(this._moderationTimer),this._moderationTimer=null),this._moderationTimer=window.setInterval(()=>{this.connectionState===Hl.CONNECTED?this.requestToInspectImage():x.debug("[".concat(this._moderationId,"] Moderation State is not connected , "),this.connectionState)},this._moderationInterval<this._moderationIntervalMinimum?this._moderationIntervalMinimum:this._moderationInterval),this.requestToInspectImage()}),this._moderationId=vr(5,"image-moderation-"),this._workerMessageLengthLimit=se("IMAGE_MODERATION_WORKER_MESSAGE_LENGTH_LIMIT"),this._moderationIntervalMinimum=se("IMAGE_MODERATION_INTERVAL_MINIMUM"),this._moderationInterval=(s=r.interval)!==null&&s!==void 0?s:1e3,r.extraInfo&&(this._extraInfo=this._encoder.encode(r.extraInfo)),r.vendor&&(this._vendor=r.vendor),this._qualityRatio=se("IMAGE_MODERATION_QUALITY_RATIO"),this._moderationStartTime=Number(Date.now()),this._workerConnection=new cT("worker-"+this._moderationId,Mi),this.on($d.STATE_CHANGE,(a,c)=>{x.debug("[".concat(this._moderationId,"] Moderation operation :").concat(s0[a]," ").concat(c||""))}),this.handleWorkerEvents()}async init(r,s){this.emit($d.STATE_CHANGE,s0.CONNECT_AP),this._connectInfo=r;const a=this._cancelTokenSource.token;return this._retryConfig=s,new pt((c,d)=>{this.on($d.CONNECTION_STATE_CHANGE,(h,m)=>{h===Hl.CONNECTED&&c()}),this.requestAP(r,a,s).then(h=>{this.connectWorker(h)}).catch(h=>{d(h)})})}updateConfig(r){var s;this._moderationInterval=(s=r.interval)!==null&&s!==void 0?s:1e3,r.extraInfo&&(this._extraInfo=this._encoder.encode(r.extraInfo)),r.vendor&&(this._vendor=r.vendor),x.debug("[".concat(this._moderationId,"] updateConfig: ").concat(JSON.stringify(r))),this.connectionState===Hl.CONNECTED&&this.inspectImage()}async requestAP(r,s,a){const c=se("WEBCS_DOMAIN").map(g=>"https://".concat(g,"/api/v1")),d=await function(g,E,b,I){let{appId:A,areaCode:k,cname:W,sid:j,token:B,uid:ee}=E;d0++;const Z="moderation_plugin",oe={service_name:Z,json_body:JSON.stringify({appId:A,areaCode:k,cname:W,command:"allocateEdge",requestId:d0,seq:d0,sid:j,appToken:B,ts:Date.now(),uid:ee+""})};let ye,_e,ue=g[0];return zd(async()=>{ye=Date.now();const Ce=await Kd(ue,{data:oe,cancelToken:b,headers:{"X-Packet-Service-Type":"0","X-Packet-URI":"61"},params:{action:"wrtc_gateway"}});if(_e=Date.now()-ye,Ce.code!==0){const Je=new Pe(te.UNEXPECTED_RESPONSE,"moderation plugin ap error, code"+Ce.code,{retry:!0,responseTime:_e});throw x.error(Je.toString()),Je}const Ue=JSON.parse(Ce.json_body);if(Ue.code!==200){const Je=new Pe(te.UNEXPECTED_RESPONSE,"moderation plugin ap error, code: ".concat(Ue.code,", reason: ").concat(Ue.reason),{code:Ue.code,responseTime:_e});throw x.error(Je.toString()),Je}if(!Ue.servers||!Array.isArray(Ue.servers)||Ue.servers.length===0){const Je=new Pe(te.UNEXPECTED_RESPONSE,"moderation plugin ap empty server",{code:Ue.code,responseTime:_e});throw x.error(Je.toString()),Je}if(!Ue.servers.some(Je=>!!Je.wss)){const Je=new Pe(te.UNEXPECTED_RESPONSE,"moderation plugin ap empty port",{code:Ue.code,responseTime:_e});throw x.error(Je.toString()),Je}const ze=se("IMAGE_MODERATION_WORKER_HOST");return{addressList:Ue.servers.map(Je=>{let{address:hn,wss:vn}=Je;if(hn&&vn)return"wss://".concat(hn.replace(/\./g,"-"),".").concat(ze,":").concat(vn,"/moderation")}).filter(Je=>!!Je),workerToken:Ue.workerToken,vid:Ue.vid,ticket:Ue.appTicket,responseTime:_e}},(Ce,Ue)=>(At.apworkerEvent(j,{success:!0,sc:200,serviceName:Z,responseDetail:JSON.stringify(Ce.addressList),firstSuccess:Ue===0,responseTime:_e,serverIp:g[Ue%g.length]}),!1),(Ce,Ue)=>(At.apworkerEvent(j,{success:!1,sc:Ce.data&&Ce.data.code||200,serviceName:Z,responseTime:_e,serverIp:g[Ue%g.length]}),!!(Ce.code!==te.OPERATION_ABORTED&&Ce.code!==te.UNEXPECTED_RESPONSE||Ce.data&&Ce.data.retry)&&(ue=g[(Ue+1)%g.length],!0)),I)}(c,r,s,a);this.emit($d.STATE_CHANGE,s0.AP_CONNECTED);const{addressList:h,ticket:m}=d;return this._ticket=m,h}async connectWorker(r){this.emit($d.STATE_CHANGE,s0.CONNECT_WORKER),await this._workerConnection.init(r,1e4)}handleWorkerEvents(){this._workerConnection.on(an.CONNECTED,async()=>{this.emit($d.STATE_CHANGE,s0.WORKER_CONNECTED,this._workerConnection.url),this.connectionState=Hl.CONNECTED}),this._workerConnection.on(an.CLOSED,()=>{this.connectionState=Hl.CLOSED}),this._workerConnection.on(an.FAILED,()=>{this.connectionState=Hl.CLOSED}),this._workerConnection.on(an.RECONNECTING,()=>{this.connectionState=this.connectionState===Hl.CONNECTED?Hl.RECONNECTING:Hl.CONNECTING}),this._workerConnection.on(an.ON_MESSAGE,async r=>{if(r.data instanceof ArrayBuffer){const s=D_e(new Uint8Array(r.data));se("SHOW_IMAGE_MODERATION_WORKER_MESSAGE")&&x.debug("[".concat(this._moderationId,"] Response message for worker of image moderation "),JSON.stringify(s)),this._uploadNum++,s.code===void 0||s.code===0||(this._uploadFailedNum++,x.error("[".concat(this._moderationId,"] Error response from worke, code is ").concat(s.code,", msg is ").concat(s.msg)),this._uploadTimer||(this._uploadTimer=window.setTimeout(()=>{At.reportApiInvoke(this._connectInfo.sid||null,{name:di.IMAGE_MODERATION_UPLOAD,options:[this._uploadFailedNum,this._uploadNum,s.code],tag:$r.TRACER}).onError(new Pe(te.IMAGE_MODERATION_UPLOAD_FAILED,s.msg)),this._uploadTimer=null},se("IMAGE_MODERATION_UPLOAD_REPORT_INTERVAL"))))}else x.error("[".concat(this._moderationId,"] Unexpected message type from worker"))}),this._workerConnection.on(an.WILL_RECONNECT,(r,s,a)=>{r==="recover"&&a(r),a("tryNext")}),this._workerConnection.on(an.REQUEST_NEW_URLS,(r,s)=>{this.requestAP(this._connectInfo,this._cancelTokenSource.token,this._retryConfig).then(r).catch(s)})}static intToLong(r){return{low:r|=0,high:r>>31,unsigned:r>=0}}async requestToInspectImage(){const r=Yc(this,$d.CLIENT_LOCAL_VIDEO_TRACK),s={appId:this._connectInfo.appId,cname:this._connectInfo.cname,cid:this._connectInfo.cid,sid:this._connectInfo.sid,uid:this._connectInfo.uid,vid:this._connectInfo.vid};if(r){if(!r.isPlaying)return void(se("SHOW_IMAGE_MODERATION_WORKER_MESSAGE")&&x.debug("Only the track being played can be inspected"));this._sequence++;const a=await this.generateRequestData(r,s);this._workerConnection.sendMessage(a,!0,!0)}else se("SHOW_IMAGE_MODERATION_WORKER_MESSAGE")&&x.debug("Only the track being published can be inspected")}async generateRequestData(r,s){let{appId:a,cname:c,cid:d,vid:h,sid:m,uid:g}=s;const E=Date.now(),b=await r.getCurrentFrameImage("image/jpeg",this.quality),I=await u9(b,a,c),A=this._sequence+"-"+d+"-"+g+"-"+E+"-"+vr(12,""),k={appId:a,cid:d,cname:c,deviceId:"",elapse:pM.intToLong(Number(E-this._moderationStartTime)),fileSize:b.buffer.byteLength,height:b.height,width:b.width,jpg:I,networkType:6,osType:7,requestId:A,sdkVersion:"4.24.0",sequence:this._sequence,sid:m,timestamp:U7(E),uid:g,vid:h,service:this._moderationMode,ticket:this._ticket,callbackData:this._extraInfo,vendorConfigs:this._vendor};this._extraInfo===void 0&&delete k.callbackData;const W=N_e(k);if(W.byteLength<this._workerMessageLengthLimit){if(se("SHOW_IMAGE_MODERATION_WORKER_MESSAGE")){const j=function(B){for(var ee=1;ee<arguments.length;ee++){var Z=arguments[ee]!=null?arguments[ee]:{};ee%2?V7(Object(Z),!0).forEach(function(oe){Y(B,oe,Z[oe])}):Object.getOwnPropertyDescriptors?Object.defineProperties(B,Object.getOwnPropertyDescriptors(Z)):V7(Object(Z)).forEach(function(oe){Object.defineProperty(B,oe,Object.getOwnPropertyDescriptor(Z,oe))})}return B}({},k);delete j.jpg,x.debug("[".concat(this._moderationId,"] Request message for worker of image moderation service: "),JSON.stringify(j))}return W}{const j=this.quality*this._qualityRatio;return this.quality=j,await this.generateRequestData(r,{appId:a,cname:c,cid:d,vid:h,sid:m,uid:g})}}close(){this._cancelTokenSource.cancel(),this._cancelTokenSource=Sa.CancelToken.source(),this._workerConnection&&this._workerConnection.close(),this._moderationTimer&&window.clearInterval(this._moderationTimer),this._moderationTimer=null,this._uploadTimer&&window.clearTimeout(this._uploadTimer),this._uploadTimer=null,this.connectionState=Hl.CLOSED,this.emit($d.STATE_CHANGE,s0.CLOSED)}}function F7(t){if(_r(t.interval,"interval",1e3,1/0),t&&t.extraInfo&&t.extraInfo.length>1024)throw new Pe(te.INVALID_PARAMS,"config.extraInfo length cannot exceed 1024 bytes");if(t&&t.vendor&&t.vendor.length>1024)throw new Pe(te.INVALID_PARAMS,"config.vendor length cannot exceed 1024 bytes")}const z_e={name:"ImageModeration",create:function(t){let{config:r}=t;return F7(r),new pM(r)}};var j7,B7,z7,W7,G7,H7,$7,K7,q7,Y7,X7,J7,Q7,Z7,e$,t$,n$,r$,i$,s$,o$,a$,c$,l$,u$,d$,h$,p$,f$,m$,g$,_$,y$,E$,v$,S$,b$,w$,T$,C$,R$,_t;function I$(t,r){var s=Object.keys(t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);r&&(a=a.filter(function(c){return Object.getOwnPropertyDescriptor(t,c).enumerable})),s.push.apply(s,a)}return s}function Wu(t){for(var r=1;r<arguments.length;r++){var s=arguments[r]!=null?arguments[r]:{};r%2?I$(Object(s),!0).forEach(function(a){Y(t,a,s[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(s)):I$(Object(s)).forEach(function(a){Object.defineProperty(t,a,Object.getOwnPropertyDescriptor(s,a))})}return t}Ys.setLogger(x);let W_e=(j7=Gt(),B7=Gt({argsMap:(t,r)=>{if(!Array.isArray(r)){if(!(r instanceof Jv))return[r];r=[r]}return r.map(s=>s?Object(s).toString():"null")}}),z7=Gt({argsMap:(t,r)=>(r||(r=[]),Array.isArray(r)||r.trackMediaType!==Xv.DATA?(Array.isArray(r)||(r=[r]),r.map(s=>s.getTrackId())):[r.getChannelId()])}),W7=Gt({argsMap:(t,r,s,a)=>[typeof r=="object"?r.uid:r,s,a]}),G7=Gt({argsMap:(t,r,s)=>[r,s]}),H7=Gt({argsMap:(t,r)=>r.map(s=>{let{user:a,mediaType:c}=s;return[a==null?void 0:a.uid,c]})}),$7=Gt({argsMap:(t,r,s,a)=>[typeof r=="object"?r.uid:r,s,a]}),K7=Gt({argsMap:(t,r)=>r.map(s=>{let{user:a,mediaType:c}=s;return{uid:a==null?void 0:a.uid,mediaType:c}})}),q7=Gt(),Y7=Gt(),X7=Gt(),J7=Gt(),Q7=Gt(),Z7=Gt(),e$=Gt(),t$=Gt(),n$=Gt(),r$=Gt(),i$=Gt(),s$=Gt(),o$=Gt(),a$=Gt(),c$=Gt(),l$=Gt({argsMap:(t,r)=>[r]}),u$=Gt(),d$=Gt(),h$=Gt(),p$=Gt(),f$=Gt(),m$=Gt(),g$=Gt(),_$=Gt(),y$=Gt({argsMap:(t,r)=>(Array.isArray(r)||(r=[r]),[JSON.stringify(r)])}),E$=Gt(),v$=Gt(),S$=Gt(),b$=Gt(),w$=Gt(),T$=Gt(),C$=Gt({reportResult:!0}),R$=Gt(),_t=class extends Jr{get connectionState(){return this._gateway.state}get remoteUsers(){return this._users}get localTracks(){return this._p2pChannel.getAllTracks(!0)}get uid(){return this._uid}get channelName(){return this._channelName}get localDataChannels(){return this._p2pChannel.getAllDataChannels()}get mode(){return this._config.mode}get role(){var t;return((t=this._config)===null||t===void 0?void 0:t.role)||"audience"}get codec(){return this._config.codec}get audioCodec(){return this._config.audioCodec||"opus"}get isStringUID(){return!!this._joinInfo&&!!this._joinInfo.stringUid}get __className__(){return"Client"}constructor(t,r){let s;if(super(),Y(this,"store",void 0),Y(this,"_uid",void 0),Y(this,"_channelName",void 0),Y(this,"_uintUid",void 0),Y(this,"_users",[]),Y(this,"_config",void 0),Y(this,"_clientId",void 0),Y(this,"_appId",void 0),Y(this,"_sessionId",null),Y(this,"_key",void 0),Y(this,"_rtmConfig",{}),Y(this,"_joinInfo",void 0),Y(this,"_gateway",void 0),Y(this,"_statsCollector",void 0),Y(this,"_configDistribute",void 0),Y(this,"_leaveMutex",void 0),Y(this,"_publishMutex",void 0),Y(this,"_renewTokenMutex",void 0),Y(this,"_subscribeMutex",void 0),Y(this,"_encryptionMode","none"),Y(this,"_encryptionSecret",null),Y(this,"_encryptionSalt",null),Y(this,"_encryptDataStream",!1),Y(this,"_encryptDataStreamKey",null),Y(this,"_encryptDataStreamIv",null),Y(this,"_proxyServer",void 0),Y(this,"_turnServer",{servers:[],mode:"auto"}),Y(this,"_cloudProxyServerMode","disabled"),Y(this,"_isDualStreamEnabled",!1),Y(this,"_defaultStreamFallbackType",void 0),Y(this,"_lowStreamParameter",void 0),Y(this,"_streamFallbackTypeCacheMap",new Map),Y(this,"_remoteStreamTypeCacheMap",new Map),Y(this,"_axiosCancelSource",Sa.CancelToken.source()),Y(this,"_audioVolumeIndicationInterval",void 0),Y(this,"_networkQualityInterval",void 0),Y(this,"_userOfflineTimeout",void 0),Y(this,"_streamRemovedTimeout",void 0),Y(this,"_liveTranscodeStreamingClient",void 0),Y(this,"_liveRawStreamingClient",void 0),Y(this,"_channelMediaRelayClient",void 0),Y(this,"_networkQualitySensitivity","normal"),Y(this,"_p2pChannel",void 0),Y(this,"_useLocalAccessPoint",!1),Y(this,"_setLocalAPVersion",void 0),Y(this,"_joinAndNotLeaveYet",!1),Y(this,"_numberOfJoinCount",0),Y(this,"_joinResponse",null),Y(this,"_remoteDefaultVideoStreamType",void 0),Y(this,"_inspect",void 0),Y(this,"_moderation",void 0),Y(this,"_license",void 0),Y(this,"_pendingPublishedUsers",[]),Y(this,"ntpAlignErrorCount",0),Y(this,"remoteInboundOffset",0),Y(this,"_peerConnectionState",void 0),Y(this,"_handleLocalTrackEnable",(c,d,h)=>{this.publish(c,!1).then(d).catch(h)}),Y(this,"_handleLocalTrackDisable",(c,d,h)=>{this.unpublish(c).then(d).catch(h)}),Y(this,"_handleUserOnline",c=>{if(se("BLOCK_LOCAL_CLIENT")&&ly(c.uid,this.channelName))return void x.debug("[".concat(c.uid,"] will be ignored in local"));this.isStringUID&&typeof c.uid!="string"&&x.error("[".concat(this._clientId,"] StringUID is Mixed with UintUID"));const d=this._users.find(h=>h.uid===c.uid);if(d)d._trust_in_room_=!0,d._is_pre_created&&(d._is_pre_created=!1,this.safeEmit(Rn.USER_JOINED,d));else{const h=new tg(c.uid,c.uint_id||c.uid);this._users.push(h),x.debug("[".concat(this._clientId,"] user online"),c.uid),this.store.firstVideoFrameDecoded(h.uid,{userJoinNotify:Date.now()}),this.safeEmit(Rn.USER_JOINED,h)}}),Y(this,"_handleUserOffline",c=>{if(se("BLOCK_LOCAL_CLIENT")&&ly(c.uid,this.channelName))return;const d=this._users.find(h=>h.uid===c.uid);d&&(this._handleRemoveStream(c),this._handleRemoveDataChannels(c),d._audio_pre_subscribed||d._video_pre_subscribed?d._is_pre_created=!0:pP(this._users,d),this._remoteStreamTypeCacheMap.delete(d.uid),this._streamFallbackTypeCacheMap.delete(d.uid),x.debug("[".concat(this._clientId,"] user offline"),c.uid,"reason:",c.reason),this.safeEmit(Rn.USER_LEAVED,d,c.reason))}),Y(this,"_handleAddAudioOrVideoStream",(c,d,h,m,g,E,b,I)=>{if(se("BLOCK_LOCAL_CLIENT")&&ly(d,this.channelName))return;const A=this._users.find(W=>W.uid===d);if(!A)return void x.error("[".concat(this._clientId,"] can not find target user!(on_add_stream)"));x.debug("[".concat(this._clientId,"] stream added with uid ").concat(d,", type ").concat(c)),this.store.subscribe(A.uid,c,void 0,void 0,void 0,Date.now()),c==="video"&&this.store.firstVideoFrameDecoded(A.uid,{videoAddNotify:Date.now()});const k=c==="audio"?A.hasAudio:A.hasVideo;if(A._uintid||(A._uintid=E||d),c==="audio"?A._trust_audio_stream_added_state_=!0:A._trust_video_stream_added_state_=!0,c==="audio"?(A._audio_added_=!0,h!==void 0&&(A._audioSSRC=h),m!==void 0&&(A._cname=m),b&&(A._audioOrtc=b)):(A._video_added_=!0,h!==void 0&&(A._videoSSRC=h),m!==void 0&&(A._cname=m),I!==void 0&&(A._rtxSsrcId=I),b&&(A._videoOrtc=b)),(c==="audio"?A.hasAudio:A.hasVideo)&&!k&&(x.info("[".concat(this._clientId,"] remote user ").concat(A.uid," published ").concat(c)),this.safeEmit(Rn.USER_PUBLISHED,A,c)),c==="video"?At.onGatewayStream(this._sessionId,Xi.ON_ADD_VIDEO_STREAM,Wr.ON_ADD_VIDEO_STREAM,{peer:E||d,ssrc:A._videoSSRC}):At.onGatewayStream(this._sessionId,Xi.ON_ADD_AUDIO_STREAM,Wr.ON_ADD_AUDIO_STREAM,{peer:E||d,ssrc:A._audioSSRC}),this._p2pChannel.remoteMediaSsrcChanged(A,c,h).then(W=>{if(W&&(x.debug("[".concat(this._clientId,"] resubscribe ").concat(c," for user ").concat(A.uid," after rejoin because SSRC id changed.")),this._p2pChannel instanceof _T))return this._p2pChannel.unsubscribe(A,c,!0).then(()=>this._subscribe(A,c,!0).catch(j=>{x.error("[".concat(this._clientId,"] resubscribe error"),j.toString())}))}),this._p2pChannel.hasPendingRemoteMedia(A,c)&&(x.debug("[".concat(this._clientId,"] resubscribe ").concat(c," for user ").concat(A.uid," after reconnect.")),this._subscribe(A,c,!0).catch(W=>{x.error("[".concat(this._clientId,"] resubscribe error"),W.toString())})),c==="video"&&!xs()&&!fo()){const W=this._getEncodingName(g);(W==null?void 0:W.toLocaleLowerCase())==eT.av1&&p_e().then(j=>{j||this._gateway.downgradeCodec(W)})}}),Y(this,"_handleRemoveStream",c=>{if(se("BLOCK_LOCAL_CLIENT")&&ly(c.uid,this.channelName))return;const d=this._users.find(m=>m.uid===c.uid);if(!d)return void x.warning("[".concat(this._clientId,"] can not find target user!(on_remove_stream)"));x.debug("[".concat(this._clientId,"] stream removed with uid ").concat(c.uid));let h=()=>{};d.hasAudio&&d.hasVideo?h=()=>{x.info("[".concat(this._clientId,"] remote user ").concat(d.uid," unpublished audio track")),this.safeEmit(Rn.USER_UNPUBLISHED,d,"audio"),x.info("[".concat(this._clientId,"] remote user ").concat(d.uid," unpublished video track")),this.safeEmit(Rn.USER_UNPUBLISHED,d,"video")}:d.hasVideo?h=()=>{x.info("[".concat(this._clientId,"] remote user ").concat(d.uid," unpublished video track")),this.safeEmit(Rn.USER_UNPUBLISHED,d,"video")}:d.hasAudio&&(h=()=>{x.info("[".concat(this._clientId,"] remote user ").concat(d.uid," unpublished audio track")),this.safeEmit(Rn.USER_UNPUBLISHED,d,"audio")}),d._video_pre_subscribed||d._audio_pre_subscribed||(d._trust_audio_stream_added_state_=!0,d._trust_video_stream_added_state_=!0,d._audio_added_=!1,d._video_added_=!1,this._p2pChannel instanceof _T&&this._p2pChannel.unsubscribe(d).then(m=>{if(m)return this._gateway.unsubscribe(m,d.uid)}),d._audioSSRC=void 0,d._videoSSRC=void 0,d._audioOrtc=void 0,d._videoOrtc=void 0,d._rtxSsrcId=void 0),At.onGatewayStream(this._sessionId,Xi.ON_REMOVE_STREAM,Wr.ON_REMOVE_STREAM,{peer:c.uint_id||c.uid}),h()}),Y(this,"_handleSetStreamLocalEnable",(c,d,h)=>{if(se("BLOCK_LOCAL_CLIENT")&&ly(d,this.channelName))return;const m=this._users.find(b=>b.uid===d);if(!m)return void x.error("[".concat(this._clientId,"] can not find target user!(disable_local)"));x.debug("[".concat(this._clientId,"] local ").concat(c," ").concat(h?"enabled":"disabled"," with uid ").concat(d));const g=c==="audio"?m.hasAudio:m.hasVideo;if(c==="audio"){m._trust_audio_enabled_state_=!0;const b=m._audio_enabled_;if(m._audio_enabled_=h,m._audio_enabled_===b)return;{const I=m._audio_enabled_?"enable-local-audio":"disable-local-audio";x.debug("[".concat(this._clientId,"] user-info-updated, uid: ").concat(d,", msg: ").concat(I)),this.safeEmit(Rn.USER_INFO_UPDATED,d,I)}}else{m._trust_video_enabled_state_=!0;const b=m._video_enabled_;if(m._video_enabled_=h,m._video_enabled_===b)return;{const I=m._video_enabled_?"enable-local-video":"disable-local-video";x.debug("[".concat(this._clientId,"] user-info-update, uid: ").concat(d,", msg: ").concat(I)),this.safeEmit(Rn.USER_INFO_UPDATED,d,I)}}const E=c==="audio"?m.hasAudio:m.hasVideo;return g!==E?!g&&E?(x.info("[".concat(this._clientId,"] remote user ").concat(d," published ").concat(c)),void this.safeEmit(Rn.USER_PUBLISHED,m,c)):(c==="video"&&m._videoTrack&&m._videoTrack._destroy(),c==="audio"&&m._audioTrack,this._p2pChannel.muteRemote(m,c),x.info("[".concat(this._clientId,"] remote user ").concat(d," unpublished ").concat(c)),void this.safeEmit(Rn.USER_UNPUBLISHED,m,c)):void 0}),Y(this,"_handleMuteStream",(c,d,h)=>{if(se("BLOCK_LOCAL_CLIENT")&&ly(c,this.channelName))return;x.debug("[".concat(this._clientId,"] receive mute message"),c,d,h);const m=this._users.find(b=>b.uid===c);if(!m)return void x.warning("[".concat(this._clientId,"] can not find remote user, ignore mute event, uid: ").concat(c));const g=d==="audio"?m.hasAudio:m.hasVideo;if(d==="audio"){m._trust_audio_mute_state_=!0;const b=m._audio_muted_;if(m._audio_muted_=h,m._audio_muted_===b)return;{const I=m._audio_muted_?"mute-audio":"unmute-audio";x.debug("[".concat(this._clientId,"] user-info-update, uid: ").concat(c,", msg: ").concat(I)),this.safeEmit(Rn.USER_INFO_UPDATED,c,I)}}else{m._trust_video_mute_state_=!0;const b=m._video_muted_;if(m._video_muted_=h,m._video_muted_===b)return;{const I=m._video_muted_?"mute-video":"unmute-video";x.debug("[".concat(this._clientId,"] user-info-update, uid: ").concat(c,", msg: ").concat(I)),this.safeEmit(Rn.USER_INFO_UPDATED,c,I)}}const E=d==="audio"?m.hasAudio:m.hasVideo;if(g!==E){if(!g&&E)return(d==="audio"?m._audioSSRC:m._videoSSRC)?(x.info("[".concat(this._clientId,"] remote user ").concat(c," published ").concat(d)),void this.safeEmit(Rn.USER_PUBLISHED,m,d)):void x.warning("[".concat(this._clientId,"] remote user ").concat(c," receive ").concat(d," unmute message  before add stream message, ").concat(d," SSRC doesn't exist yet."));d==="video"&&m._videoTrack&&!m._video_pre_subscribed&&m._videoTrack._destroy(),d==="audio"&&m._audioTrack,this._p2pChannel.muteRemote(m,d),x.info("[".concat(this._clientId,"] remote user ").concat(c," unpublished ").concat(d)),this.safeEmit(Rn.USER_UNPUBLISHED,m,d)}}),Y(this,"_handleP2PLost",async c=>{x.debug("[".concat(this._clientId,"] receive p2p lost"),c),parseInt(c.p2pid,10)===this.store.p2pId?await this._p2pChannel.requestReconnect():x.warning("[".concat(this._clientId,"] P2PLost stream not found"),c)}),Y(this,"_handleTokenWillExpire",()=>{x.debug("[".concat(this._clientId,"] received message onTokenPrivilegeWillExpire")),this.safeEmit(Rn.ON_TOKEN_PRIVILEGE_WILL_EXPIRE)}),Y(this,"_handleBeforeUnload",c=>{c.type==="beforeunload"&&c.returnValue!==void 0&&c.returnValue!==""||(this.leave(),x.info("[".concat(this._clientId,"] auto leave onbeforeunload or pagehide")))}),Y(this,"_handleUpdateNetworkQuality",()=>{if(this._networkQualitySensitivity==="normal")return;if(navigator&&navigator.onLine!==void 0&&!navigator.onLine)return void this.safeEmit(Rn.NETWORK_QUALITY,{downlinkNetworkQuality:6,uplinkNetworkQuality:6});const c={downlinkNetworkQuality:0,uplinkNetworkQuality:0};c.uplinkNetworkQuality=this._p2pChannel.getUplinkNetworkQuality(),c.downlinkNetworkQuality=this._p2pChannel.getDownlinkNetworkQuality(),this.safeEmit(Rn.NETWORK_QUALITY,c)}),Y(this,"_handleP2PAddAudioOrVideoStream",(c,d,h,m)=>{const g=this._users.find(b=>b.uid===d);if(!g)return void x.error("[".concat(this._clientId,"] can not find target user!(on_add_stream)"));x.debug("[".concat(this._clientId,"] stream added with uid ").concat(d,", type ").concat(c)),this.store.subscribe(g.uid,c,void 0,void 0,void 0,Date.now());const E=c==="audio"?g.hasAudio:g.hasVideo;c==="audio"?g._trust_audio_stream_added_state_=!0:g._trust_video_stream_added_state_=!0,c==="audio"?(g._audio_added_=!0,h!==void 0&&(g._audioSSRC=h),m!==void 0&&(g._audioMid=m)):(g._video_added_=!0,h!==void 0&&(g._videoSSRC=h),m!==void 0&&(g._videoMid=m)),(c==="audio"?g.hasAudio:g.hasVideo)&&!E&&(x.info("[".concat(this._clientId,"] remote user ").concat(g.uid," published ").concat(c)),this.safeEmit(Rn.USER_PUBLISHED,g,c)),this._p2pChannel.hasPendingRemoteMedia(g,c)&&(x.debug("[".concat(this._clientId,"] resubscribe ").concat(c," for user ").concat(g.uid," after reconnect.")),this._subscribe(g,c,!0).catch(b=>{x.error("[".concat(this._clientId,"] resubscribe error"),b.toString())}))}),this._config=t,this._clientId=r||vr(5,"client-"),this.store=new class{constructor(c,d,h,m){Qt(this,"state",void 0),this.state={codec:c,audioCodec:d,mode:h,clientId:m,sessionId:null,p2pId:0,dcId:0,pubId:0,subId:0,keyMetrics:{publish:[],subscribe:[],firstVideoFrameDecoded:[]},joinChannelServiceRecords:[],cloudProxyServerMode:"disabled",useP2P:!1,p2pTransport:ny.Default,hasStartJoinChannel:!1,isABTestSuccess:!1,autoSubscribe:!1,enableInstantMuteRestore:!1}}dispatch(c){this.state=function(d,h){switch(h.type){case en.SET_SESSION_ID:return Qe(Qe({},d),{},{sessionId:h.sessionId});case en.SET_P2P_ID:return Qe(Qe({},d),{},{p2pId:h.p2pId});case en.SET_UID:return Qe(Qe({},d),{},{uid:h.uid});case en.SET_INT_UID:return Qe(Qe({},d),{},{intUid:h.intUid});case en.SET_PUB_ID:return Qe(Qe({},d),{},{pubId:h.pubId});case en.KEY_METRIC_CLIENT_CREATED:return Qe(Qe({},d),{},{keyMetrics:Qe(Qe({},d.keyMetrics),{},{clientCreated:h.metric})});case en.KEY_METRIC_JOIN_START:return Qe(Qe({},d),{},{keyMetrics:Qe(Qe({},d.keyMetrics),{},{joinStart:h.metric})});case en.KEY_METRIC_PRELOAD_START:return Qe(Qe({},d),{},{keyMetrics:Qe(Qe({},d.keyMetrics),{},{preloadStart:h.metric})});case en.KEY_METRIC_PRELOAD_END:return Qe(Qe({},d),{},{keyMetrics:Qe(Qe({},d.keyMetrics),{},{preloadEnd:h.metric})});case en.KEY_METRIC_JOIN_END:return Qe(Qe({},d),{},{keyMetrics:Qe(Qe({},d.keyMetrics),{},{joinEnd:h.metric})});case en.KEY_METRIC_REQUEST_AP_START:return Qe(Qe({},d),{},{keyMetrics:Qe(Qe({},d.keyMetrics),{},{requestAPStart:h.metric})});case en.KEY_METRIC_REQUEST_AP_END:return Qe(Qe({},d),{},{keyMetrics:Qe(Qe({},d.keyMetrics),{},{requestAPEnd:h.metric})});case en.KEY_METRIC_REQUEST_SUA_END:return Qe(Qe({},d),{},{keyMetrics:Qe(Qe({},d.keyMetrics),{},{requestSUAEnd:h.metric})});case en.KEY_METRIC_BEFORE_CONNECT:return Qe(Qe({},d),{},{keyMetrics:Qe(Qe({},d.keyMetrics),{},{beforeConnect:h.metric})});case en.KEY_METRIC_PEER_RECEIVER:return Qe(Qe({},d),{},{keyMetrics:Qe(Qe({},d.keyMetrics),{},{peerReceiver:h.metric})});case en.KEY_METRIC_SIGNAL_CONNECTED:return Qe(Qe({},d),{},{keyMetrics:Qe(Qe({},d.keyMetrics),{},{signalConnected:h.metric})});case en.KEY_METRIC_JOIN_REQ:return Qe(Qe({},d),{},{keyMetrics:Qe(Qe({},d.keyMetrics),{},{joinReq:h.metric})});case en.KEY_METRIC_JOIN_REP:return Qe(Qe({},d),{},{keyMetrics:Qe(Qe({},d.keyMetrics),{},{joinRep:h.metric})});case en.KEY_METRIC_JOIN_GATEWAY_START:return Qe(Qe({},d),{},{keyMetrics:Qe(Qe({},d.keyMetrics),{},{joinGatewayStart:h.metric})});case en.KEY_METRIC_JOIN_GATEWAY_END:return Qe(Qe({},d),{},{keyMetrics:Qe(Qe({},d.keyMetrics),{},{joinGatewayEnd:h.metric})});case en.KEY_METRIC_PEER_CONNECTION_START:return Qe(Qe({},d),{},{keyMetrics:Qe(Qe({},d.keyMetrics),{},{peerConnectionStart:h.metric})});case en.KEY_METRIC_PEER_CONNECTION_END:return Qe(Qe({},d),{},{keyMetrics:Qe(Qe({},d.keyMetrics),{},{peerConnectionEnd:h.metric})});case en.KEY_METRIC_DESCRIPTION_START:return Qe(Qe({},d),{},{keyMetrics:Qe(Qe({},d.keyMetrics),{},{descriptionStart:h.metric})});case en.KEY_METRIC_SIGNAL_CHANNEL_OPEN:return Qe(Qe({},d),{},{keyMetrics:Qe(Qe({},d.keyMetrics),{},{signalChannelOpen:h.metric})});case en.KEY_METRIC_ICE_CONNECTION_END:return Qe(Qe({},d),{},{keyMetrics:Qe(Qe({},d.keyMetrics),{},{iceConnectionEnd:h.metric})});case en.KEY_METRIC_PUBLISH:{const m=d.keyMetrics.publish,g=m.findIndex(E=>E.trackId===h.metric.trackId);return g!==-1?(m[g]=Qe(Qe({},m[g]),h.metric),Qe(Qe({},d),{},{keyMetrics:Qe(Qe({},d.keyMetrics),{},{publish:[...m]})})):Qe(Qe({},d),{},{keyMetrics:Qe(Qe({},d.keyMetrics),{},{publish:[...d.keyMetrics.publish,h.metric]})})}case en.KEY_METRIC_SUBSCRIBE:{const m=d.keyMetrics.subscribe,g=m.findIndex(E=>E.userId===h.metric.userId&&E.type===h.metric.type);return g!==-1?(m[g]=Qe(Qe({},m[g]),h.metric),Qe(Qe({},d),{},{keyMetrics:Qe(Qe({},d.keyMetrics),{},{subscribe:[...m]})})):Qe(Qe({},d),{},{keyMetrics:Qe(Qe({},d.keyMetrics),{},{subscribe:[...d.keyMetrics.subscribe,h.metric]})})}case en.KEY_METRIC_FIRST_VIDEO_FRAME_DECODED:{const m=d.keyMetrics.firstVideoFrameDecoded,g=m.findIndex(E=>E.userId===h.metric.userId);return g!==-1?(m[g]=Qe(Qe({},m[g]),h.metric),Qe(Qe({},d),{},{keyMetrics:Qe(Qe({},d.keyMetrics),{},{firstVideoFrameDecoded:[...m]})})):Qe(Qe({},d),{},{keyMetrics:Qe(Qe({},d.keyMetrics),{},{firstVideoFrameDecoded:[...d.keyMetrics.firstVideoFrameDecoded,h.metric]})})}case en.RESET_FIRST_VIDEO_FRAME_DECODED:return d.keyMetrics.firstVideoFrameDecoded=[],d;case en.SET_CLOUD_PROXY_SERVER_MODE:return d.cloudProxyServerMode=h.mode,d;case en.RECORD_JOIN_CHANNEL_SERVICE:return typeof h.index!="number"?d.joinChannelServiceRecords=[...d.joinChannelServiceRecords,h.record]:(d.joinChannelServiceRecords[h.index]=Qe(Qe({},d.joinChannelServiceRecords[h.index]),h.record),d.joinChannelServiceRecords=[...d.joinChannelServiceRecords]),d;case en.RESET_JOIN_CHANNEL_SERVICE_RECORDS:return d.joinChannelServiceRecords=[],d;case en.RESET_KEY_METRICS:return d.keyMetrics={publish:[],subscribe:[],firstVideoFrameDecoded:[]},d;case en.SET_USE_P2P:return Qe(Qe({},d),{},{useP2P:h.val});case en.SET_TRANSPORT_TYPE:return Qe(Qe({},d),{},{p2pTransport:h.val});default:return d}}(this.state,c)}set autoSubscribe(c){this.state.autoSubscribe=c}get autoSubscribe(){return this.state.autoSubscribe}set enableInstantMuteRestore(c){this.state.enableInstantMuteRestore=c}get enableInstantMuteRestore(){return this.state.enableInstantMuteRestore}set sessionId(c){this.dispatch({type:en.SET_SESSION_ID,sessionId:c})}get sessionId(){return this.state.sessionId}set cid(c){this.state.cid=c}get cid(){return this.state.cid}set codec(c){this.state.codec=c}get codec(){return this.state.codec}get mode(){return this.state.mode}get audioCodec(){return this.state.audioCodec}get clientId(){return this.state.clientId}set p2pId(c){this.dispatch({type:en.SET_P2P_ID,p2pId:c})}get p2pId(){return this.state.p2pId}set dcId(c){this.dispatch({type:en.SET_DC_ID,dcId:c})}get dcId(){return this.state.dcId}set uid(c){this.dispatch({type:en.SET_UID,uid:c})}get uid(){return this.state.uid}set intUid(c){this.dispatch({type:en.SET_INT_UID,intUid:c})}get intUid(){return this.state.intUid}set pubId(c){this.dispatch({type:en.SET_PUB_ID,pubId:c})}get pubId(){return this.state.pubId}set cloudProxyServerMode(c){this.dispatch({type:en.SET_CLOUD_PROXY_SERVER_MODE,mode:c})}get cloudProxyServerMode(){return this.state.cloudProxyServerMode}set useP2P(c){this.dispatch({type:en.SET_USE_P2P,val:c})}get useP2P(){return this.state.useP2P}set p2pTransport(c){this.dispatch({type:en.SET_TRANSPORT_TYPE,val:c})}get p2pTransport(){return this.state.p2pTransport}set hasStartJoinChannel(c){this.state.hasStartJoinChannel=c}get hasStartJoinChannel(){return this.state.hasStartJoinChannel}set isABTestSuccess(c){this.state.isABTestSuccess=c}get isABTestSuccess(){return this.state.isABTestSuccess}clientCreated(){this.dispatch({type:en.KEY_METRIC_CLIENT_CREATED,metric:Date.now()})}joinStart(){this.dispatch({type:en.KEY_METRIC_JOIN_START,metric:Date.now()})}preloadStart(){this.dispatch({type:en.KEY_METRIC_PRELOAD_START,metric:Date.now()})}preloadEnd(){this.dispatch({type:en.KEY_METRIC_PRELOAD_END,metric:Date.now()})}joinEnd(){this.dispatch({type:en.KEY_METRIC_JOIN_END,metric:Date.now()})}requestAPStart(){this.dispatch({type:en.KEY_METRIC_REQUEST_AP_START,metric:Date.now()})}requestAPEnd(){this.dispatch({type:en.KEY_METRIC_REQUEST_AP_END,metric:Date.now()})}requestSUAEnd(){this.dispatch({type:en.KEY_METRIC_REQUEST_SUA_END,metric:Date.now()})}beforeConnect(){this.dispatch({type:en.KEY_METRIC_BEFORE_CONNECT,metric:Date.now()})}peerReceiver(){this.dispatch({type:en.KEY_METRIC_PEER_RECEIVER,metric:Date.now()})}signalConnected(){this.dispatch({type:en.KEY_METRIC_SIGNAL_CONNECTED,metric:Date.now()})}joinReq(){this.dispatch({type:en.KEY_METRIC_JOIN_REQ,metric:Date.now()})}joinRep(){this.dispatch({type:en.KEY_METRIC_JOIN_REP,metric:Date.now()})}joinGatewayStart(){this.dispatch({type:en.KEY_METRIC_JOIN_GATEWAY_START,metric:Date.now()})}joinGatewayEnd(){this.dispatch({type:en.KEY_METRIC_JOIN_GATEWAY_END,metric:Date.now()})}peerConnectionStart(){this.dispatch({type:en.KEY_METRIC_PEER_CONNECTION_START,metric:Date.now()})}peerConnectionEnd(){this.dispatch({type:en.KEY_METRIC_PEER_CONNECTION_END,metric:Date.now()})}firstVideoFrameDecoded(c,d){this.dispatch({type:en.KEY_METRIC_FIRST_VIDEO_FRAME_DECODED,metric:Qe({userId:c},d)})}descriptionStart(){this.dispatch({type:en.KEY_METRIC_DESCRIPTION_START,metric:Date.now()})}signalChannelOpen(){this.dispatch({type:en.KEY_METRIC_SIGNAL_CHANNEL_OPEN,metric:Date.now()})}iceConnectionEnd(){this.dispatch({type:en.KEY_METRIC_ICE_CONNECTION_END,metric:Date.now()})}publish(c,d,h,m){this.dispatch({type:en.KEY_METRIC_PUBLISH,metric:Qe(Qe({trackId:c,type:d},h&&{publishStart:h}),m&&{publishEnd:m})})}subscribe(c,d,h,m,g,E,b){this.dispatch({type:en.KEY_METRIC_SUBSCRIBE,metric:Qe(Qe(Qe(Qe(Qe({userId:c,type:d},h&&{subscribeStart:h}),m&&{subscribeEnd:m}),g&&{firstFrame:g}),E&&{streamAdded:E}),b&&{firstDecoded:b})})}massSubscribe(c,d,h,m){c.forEach(g=>{this.dispatch({type:en.KEY_METRIC_SUBSCRIBE,metric:Qe(Qe(Qe({userId:g.userId,type:g.type},d&&{subscribeStart:d}),h&&{subscribeEnd:h}),m&&{firstFrame:m})})})}get keyMetrics(){return this.state.keyMetrics}recordJoinChannelService(c,d){c.service==="gateway"&&Array.isArray(c.urls)&&(c.urls=c.urls.map(h=>h.replace(/(\d+)-\d+-\d+-(\d+)/,"$1-*-*-$2")));try{return typeof d!="number"?(this.dispatch({type:en.RECORD_JOIN_CHANNEL_SERVICE,record:Qe(Qe({},c),{},{sessionId:this.sessionId,cloudProxyMode:this.cloudProxyServerMode,uid:this.uid})}),this.state.joinChannelServiceRecords.length-1):(d<0||d>=this.state.joinChannelServiceRecords.length||this.dispatch({type:en.RECORD_JOIN_CHANNEL_SERVICE,record:c,index:d}),d)}catch{return 0}}resetJoinChannelServiceRecords(){this.dispatch({type:en.RESET_JOIN_CHANNEL_SERVICE_RECORDS})}resetKeyMetrics(){this.dispatch({type:en.RESET_KEY_METRICS})}resetFirstVideoFrameDecoded(){this.dispatch({type:en.RESET_FIRST_VIDEO_FRAME_DECODED})}get joinChannelServiceRecords(){try{return this.state.joinChannelServiceRecords}catch{return[]}}}(t.codec,t.audioCodec,t.mode,this._clientId),this._leaveMutex=new Ys("client-leave",this._clientId),this._publishMutex=new Ys("client-publish",this._clientId),this._renewTokenMutex=new Ys("client-renewtoken",this._clientId),this._subscribeMutex=new Ys("client-subscribe",this._clientId),this.store.clientCreated(),t.proxyServer&&this.setProxyServer(t.proxyServer,!0),t.turnServer&&this.setTurnServer(t.turnServer,!0),x.info("[".concat(this._clientId,"] Initializing AgoraRTC client v").concat(Bl," build: ").concat(QL,", mode: ").concat(this.mode,", codec: ").concat(this.codec)),t.clientRoleOptions)try{FL(t.clientRoleOptions),s=Object.assign({},t.clientRoleOptions)}catch(c){x.warning("[".concat(this._clientId,"] ").concat(c.toString()))}var a;this._statsCollector=new mT(this.store),this._statsCollector.onStatsException=(c,d,h)=>{x.warn("[".concat(this._clientId,"] receive exception msg, code: ").concat(c,", msg: ").concat(d,", uid: ").concat(h)),c===J2.VIDEO_ENCODE_FAILED&&this.localTracks.forEach(m=>{m instanceof IP&&se("ENABLE_ENCODE_EXCEPTION")&&m.findClosestProfile()}),this.safeEmit(Rn.EXCEPTION,{code:c,msg:d,uid:h})},this._statsCollector.onUploadPublishDuration=(c,d,h,m)=>{const g=this._users.find(E=>E.uid===c);g&&(this.store.keyMetrics&&(this.store.firstVideoFrameDecoded(g._uintid,{peerPublishDuration:h,peerPubStatusMs:Date.now()}),this._p2pChannel.reportVideoFirstFrameRender(g)),At.peerPublishStatus(this._sessionId,{subscribeElapse:m,audioPublishDuration:d,videoPublishDuration:h,peer:g._uintid}))},this._statsCollector.onVideoCodecChanged=c=>{if(se("VIDEO_STANDARD_BITRATE_VERSION")&&(c==="av1"||c==="h265"||c==="h264")){const d=this.localTracks.find(h=>h instanceof Dr);d&&d._saveEncodeBitrateRatio!==1&&d.setSaveEncodeBitrateRatio(c==="h264"?se("BASELINE_MORE_H264_BITRATE_RATIO"):void 0)}},this.store.useP2P=t.mode==="p2p",this._gateway=new a_e(this.store,{clientId:this._clientId,mode:this.mode,codec:this.codec,websocketRetryConfig:t.websocketRetryConfig||Mi,httpRetryConfig:t.httpRetryConfig||Mi,forceWaitGatewayResponse:t.forceWaitGatewayResponse===void 0||t.forceWaitGatewayResponse,statsCollector:this._statsCollector,role:t.role,clientRoleOptions:s}),this._configDistribute=new y_e(this._clientId,this.store),this.store.useP2P?(this._p2pChannel=(a={store:this.store,statsCollector:this._statsCollector},ff("P2PChannel").create(a)),this._handleP2PEvents()):this._p2pChannel=new _T(this.store,this._statsCollector),this._handleP2PChannelEvents(),this._handleGatewayEvents(),this._handleGatewaySignalEvents()}async joinMeta(t,r,s,a,c){let d=!(arguments.length>5&&arguments[5]!==void 0)||arguments[5],h=arguments.length>6&&arguments[6]!==void 0&&arguments[6];pr("JOIN_GATEWAY_USE_443PORT_ONLY",d),pr("JOIN_GATEWAY_USE_DUAL_DOMAIN",h);const m=this._gateway.signal.websocket;return m instanceof M2&&(m.use443PortOnly=d,m.tryDoubleDomain=h),async function(g,E,b){cP.get(g)||cP.set(g,[]),lP.get(g)||lP.set(g,E),Wh.get(g)||Wh.set(g,0);const I=cP.get(g),A=lP.get(g);if(!I||!A)throw new Error("concurrent: deferQueue or maxConcurrency is null");if(Wh.get(g)===A){const ee=Hw();I.push(ee),await ee.promise}Wh.set(g,Wh.get(g)+1);for(var k=arguments.length,W=new Array(k>3?k-3:0),j=3;j<k;j++)W[j-3]=arguments[j];const B=await b(...W);return Wh.set(g,Wh.get(g)-1),Wh.get(g)===A-1&&I.length>0&&(I[0].resolve(),I.shift()),Wh.get(g)===0&&(cP.set(g,[]),lP.set(g,0),Wh.set(g,0)),B}("client.join",se("JOIN_MAX_CONCURRENCY"),this.join.bind(this),t,r,s,a,c)}async join(t,r,s,a,c){const d=++this._numberOfJoinCount;this.store.joinStart(),a&&(this.store.uid=a);const h=(gP||gP||(gP=(window.location.protocol.split(":")[0]||"").toUpperCase(),gP))==="HTTPS",m=TW()?window.isSecureContext:"Browser Not Support";(!TW()&&!h||!window.isSecureContext)&&x.warning("The website must be running in a secure context (About secure context: https://developer.mozilla.org/en-US/docs/Web/Security/Secure_Contexts ), otherwise the media collection will be restricted by the browser");let g;At.setAppId(t);try{if(!s&&s!==null)throw new Pe(te.INVALID_PARAMS,"Invalid token: ".concat(s,". If you don not use token, set it to null"));if(s&&Ss(s,"token",1,2047),Ss(t,"appid",1,2047),VP(r),a&&FP(a),c)if(typeof c=="string")Ss(c,"optionalInfo",1,256),g=c;else{if(typeof c!="object")throw new Pe(te.INVALID_PARAMS,"Invalid options: options is not a string or object");{const{autoSubscribe:B,enableInstantMuteRestore:ee}=c;B&&(Bd(B,"autoSubscribe"),x.info("[".concat(this._clientId,"] join: autoSubscribe: ").concat(B)),this.store.autoSubscribe=B),ee&&(Bd(ee,"enableInstantMuteRestore"),x.info("[".concat(this._clientId,"] join: enableInstantMuteRestore: ").concat(ee)),this.store.enableInstantMuteRestore=ee)}}}catch(B){throw At.reportApiInvoke(ty(),{name:di.JOIN,options:[t,r,s,a],states:{isHttps:h,isSecureContext:m},tag:$r.TRACER}).onError(B),B}if(this._leaveMutex.isLocked&&(x.debug("[".concat(this._clientId,"] join: waiting leave operation")),(await this._leaveMutex.lock())(),x.debug("[".concat(this._clientId,"] join: continue"))),this._joinAndNotLeaveYet=!0,this.connectionState!=="DISCONNECTED"){const B=new Pe(te.INVALID_OPERATION,"[".concat(this._clientId,"] Client already in connecting/connected state"));throw At.reportApiInvoke(ty(),{name:di.JOIN,options:[t,r,s,a],states:{isHttps:h,isSecureContext:m},tag:$r.TRACER}).onError(B),B}this._gateway.state="CONNECTING",this.store.preloadStart();const E=await w7({appId:t,cname:r,uid:a,stringUid:typeof a=="string"?a:void 0,token:s||t,cloudProxyServer:this._cloudProxyServerMode});if(this.store.preloadEnd(),!this._joinAndNotLeaveYet)throw new Pe(te.INVALID_OPERATION,"[".concat(this._clientId,"] Client already left"));const b=(E==null?void 0:E.sid)||ty();x.info("[".concat(this._clientId,"] start join channel ").concat(r,", join number: ").concat(d)),this._sessionId||(this._sessionId=b,this.store.sessionId=this._sessionId);const I=At.reportApiInvoke(b,{id:this._clientId,name:di.JOIN,options:[t,r,s,a],states:{isHttps:h,isSecureContext:m},tag:$r.TRACER}),A=Wu(Wu(Wu({},this._rtmConfig),{},{role:this.role,clientId:this._clientId,appId:t,sid:this._sessionId,cname:r,uid:typeof a!="string"?a:null,turnServer:this._turnServer,proxyServer:this._proxyServer,token:s||t,cloudProxyServer:this._cloudProxyServerMode,optionalInfo:g,license:this._license,useLocalAccessPoint:this._useLocalAccessPoint,preload:!!E},this._remoteDefaultVideoStreamType!==void 0&&{defaultVideoStream:this._remoteDefaultVideoStreamType}),{},{apRequestDetail:se("AP_REQUEST_DETAIL")||void 0});if(this._useLocalAccessPoint&&(A.setLocalAPVersion=this._setLocalAPVersion),typeof a=="string"&&(A.stringUid=a,this._uintUid?(A.uid=this._uintUid,this._uintUid=void 0):A.uid=0),this._encryptionMode!=="none"&&this._encryptionSecret){if(A.aesmode=this._encryptionMode,A.aespassword=await(async B=>{const ee=function(_e){const ue=window.atob(`MIGfMA0GCSqGSIb3DQEBAQUAA4GNADCBiQKBgQDCMnXAHkKIGAM+x4N22gCI+Wyu
STM9ztkT3uYslTT2PuKmZfPzhH6kVdO7PTjGCOZnAsyb3oTtWat0KcxQ4jxvqQV+
HvYl3iI1Yd4vl2c3qRMJPLtRDfNxa2Mcxgq7e9aEUibzdd0st+OJAy3tOj/Y0aVy
xQiYDz3vqa6bP29adwIDAQAB`),Ce=new Uint8Array(new ArrayBuffer(ue.length));for(let Ue=0;Ue<ue.length;Ue+=1)Ce[Ue]=ue.charCodeAt(Ue);return Ce}(),Z=await window.crypto.subtle.importKey("spki",ee,{name:"RSA-OAEP",hash:"SHA-256"},!0,["encrypt"]),oe=UL(B),ye=await window.crypto.subtle.encrypt({name:"RSA-OAEP"},Z,oe);return function(_e){let ue="";for(let Ce=0;Ce<_e.length;Ce+=1)ue+=String.fromCharCode(_e[Ce]);return window.btoa(ue)}(new Uint8Array(ye))})(this._encryptionSecret),!this._joinAndNotLeaveYet)throw new Pe(te.INVALID_OPERATION,"[".concat(this._clientId,"] Client already left"));this._encryptionSalt&&(A.aessalt=this._encryptionSalt)}if(this._encryptDataStream&&(this._encryptionMode==="aes-128-gcm2"||this._encryptionMode==="aes-256-gcm2"))if(this._encryptionSalt&&this._encryptionSecret)if(window.crypto.subtle){const B=new TextEncoder,ee=se("USE_PURE_ENCRYPTION_MASTER_KEY")?B.encode(A.appId+this._encryptionSecret+this._encryptionSecret):B.encode(A.appId+A.cname+this._encryptionSecret);this._encryptDataStreamIv=await async function(Z,oe,ye){const _e=await window.crypto.subtle.importKey("raw",oe,"PBKDF2",!1,["deriveBits","deriveKey"]),ue=Z==="aes-128-gcm2"?128:256,Ce=await window.crypto.subtle.deriveBits({name:"PBKDF2",iterations:xW,hash:"SHA-256",salt:ye},_e,ue+Ume);return new Uint8Array(Ce).subarray(ue/8)}(this._encryptionMode,ee,ey(this._encryptionSalt)),this._encryptDataStreamKey=await async function(Z,oe,ye){const _e=await window.crypto.subtle.importKey("raw",oe,"PBKDF2",!1,["deriveBits","deriveKey"]),ue=Z==="aes-128-gcm2"?128:256;return await window.crypto.subtle.deriveKey({name:"PBKDF2",iterations:xW,hash:"SHA-256",salt:ye},_e,{name:"AES-GCM",length:ue},!0,["encrypt","decrypt"])}(this._encryptionMode,ee,ey(this._encryptionSalt))}else m?x.warning("[".concat(this._clientId,"] encrypt datastream must be running in a secure context, fallback to plain data stream")):x.warning("[".concat(this._clientId,"] current browser do not support WebCrypto ,fallback to plain data stream")),this._encryptDataStream=!1;else this._encryptDataStream=!1,x.debug("[".concat(this._clientId,"] no salt / secret, cannot support encrypt data stream, fallback to plain data stream"));this._startSession(this._sessionId,{channel:r,appId:t,stringUid:A.stringUid});const k=this._sessionId;setTimeout(()=>{this.connectionState==="CONNECTING"&&k===this._sessionId&&At.joinChannelTimeout(this._sessionId,5)},5e3);try{var W;let B;const ee=A.cloudProxyServer;if(rt(W=["proxy3","proxy4","proxy5"]).call(W,ee)){const ue=se("PROXY_SERVER_TYPE3");Array.isArray(ue)?A.proxyServer=ue[0]:A.proxyServer=ue}if(At.setProxyServer(A.proxyServer),x.setProxyServer(A.proxyServer),this.store.requestAPStart(),E){if(x.debug("[".concat(this._clientId,"] get serverInfo Success from Preload Cache ").concat(A.stringUid?", ".concat(A.stringUid," => ").concat(E.intUid):""," ")),A.stringUid&&!A.uid&&(A.uid=E.intUid),B={gatewayInfo:E.ap.gatewayInfo},se("JOIN_WITH_FALLBACK_MEDIA_PROXY")&&A.turnServer.mode==="auto")if(E.ap.proxyInfo.addresses.length===0)x.warning("no edge services in ap response of proxy fallback, will not set proxy in iceServers");else{const ue=(await EH(E.ap.proxyInfo,E.ap.gatewayInfo.uid)).map(Ce=>({turnServerURL:Ce.address,tcpport:Ce.tcpport||Us.tcpport,udpport:Ce.udpport||Us.udpport,username:Ce.username||Us.username,password:Ce.password||Us.password,forceturn:!1,security:!0}));A.turnServer={mode:"manual",servers:ue}}R7(E,A.stringUid)}else{if(A.stringUid&&!A.uid){let ue;[ue,B]=await pt.all([KH(A.stringUid,A,this._axiosCancelSource.token,this._config.httpRetryConfig||Mi,this.store).finally(()=>{this.store.requestSUAEnd()}),$H(A,this._axiosCancelSource.token,this._config.httpRetryConfig||Mi,!0,this.store).finally(()=>{this.store.requestAPEnd()})]),x.debug("[".concat(this._clientId,"] getUserAccount Success ").concat(A.stringUid," => ").concat(ue)),A.uid=ue,B.gatewayInfo.uid=ue,B.gatewayInfo.res.uid=ue}else B=await $H(A,this._axiosCancelSource.token,this._config.httpRetryConfig||Mi,!0,this.store);if(!this._joinAndNotLeaveYet)throw new Pe(te.INVALID_OPERATION,"[".concat(this._clientId,"] Client already left"))}this.store.requestAPEnd(),setTimeout(()=>{this._configDistribute.startGetConfigDistribute(A,this._axiosCancelSource.token),this._configDistribute.on(oT.UPDATE_BITRATE_LIMIT,ue=>{this._p2pChannel.updateBitrateLimit(ue)}),this._configDistribute.on(oT.UPDATE_CLIENT_ROLE_OPTIONS,ue=>{this._setClientRoleOptions(ue)})},0),this._key=s||t;const Z=B.gatewayInfo,oe=A.uid?A.uid:Z.uid;this._joinInfo=Wu(Wu({},A),{},{cid:Z.cid,uid:oe,vid:Z.vid,apResponse:Z.res,apGatewayAddress:Z.apGatewayAddress,uni_lbs_ip:Z.uni_lbs_ip,gatewayAddrs:Z.gatewayAddrs}),this.store.intUid=oe,this.store.cid=Z.cid;const ye=await this._joinGateway();if(!this._joinAndNotLeaveYet)throw new Pe(te.INVALID_OPERATION,"[".concat(this._clientId,"] Client already left"));I.onSuccess(ye),this._appId=t,this._channelName=A.cname,this._uid=ye,this.store.uid=ye,setTimeout(()=>{this._networkQualityInterval&&window.clearInterval(this._networkQualityInterval),this._networkQualityInterval=window.setInterval(this._handleUpdateNetworkQuality,2e3),window.addEventListener(xs()?"beforeunload":"pagehide",this._handleBeforeUnload),this._statsCollector.startUpdateStats()},0);const _e=A.stringUid?"string uid: ".concat(A.stringUid,",uid: ").concat(A.uid):"uid: ".concat(this._uid);return x.info("[".concat(this._clientId,"] Joining channel success: channel: ").concat(r,",").concat(_e)),setTimeout(()=>{x.startUpload()},5e3),this.store.joinEnd(),j=this,rt(cy).call(cy,j)||cy.push(j),this._cloudProxyServerMode==="disabled"&&jn().supportWebCrypto&&se("ENABLE_PRELOAD")&&dM(this._joinInfo),ye}catch(B){const ee=Array.isArray(B)?B[0]:B;throw ee&&ee.code===te.OPERATION_ABORTED?x.warning("[".concat(this._clientId,"] join number: ").concat(d,", Joining channel failed, rollback"),ee):x.error("[".concat(this._clientId,"] join number: ").concat(d,", Joining channel failed, rollback"),ee),ee.code!==te.OPERATION_ABORTED&&this._numberOfJoinCount===d&&(this._gateway.state="DISCONNECTED",this._reset()),I.onError(ee),ee}var j}_joinGateway(){if(!this._joinInfo||!this._key)throw new Pe(te.INVALID_OPERATION);return this._gateway.join(this._joinInfo,this._key,!(this._joinInfo.cloudProxyServer!=="disabled"||this._joinInfo.proxyServer||!se("JOIN_WITH_FALLBACK_SIGNAL_PROXY")))}async leave(){x.info("[".concat(this._clientId,"] Leaving channel")),window.removeEventListener(xs()?"beforeunload":"pagehide",this._handleBeforeUnload),this._reset(),function(r){const s=cy.indexOf(r);s!==-1&&cy.splice(s,1)}(this),this._statsCollector.stopUpdateStats();const t=await this._leaveMutex.lock();if(this.connectionState==="DISCONNECTED")return x.info("[".concat(this._clientId,"] Leaving channel repeated, success")),void t();await this._gateway.leave(this.connectionState!=="CONNECTED",rr.LEAVE),x.info("[".concat(this._clientId,"] Leaving channel success")),this._joinAndNotLeaveYet=!1,this.store.resetJoinChannelServiceRecords(),t()}async publish(t){let r=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1];if(!Array.isArray(t)){if(!(t instanceof Jv))return this._publishDataChannel(t);t=[t]}if(t.length===0)throw new Pe(te.INVALID_PARAMS,"param list is empty");const s=t;if(this._gateway.role==="audience")throw new Pe(te.INVALID_OPERATION,"audience can not publish stream");for(const c of s){if(!(c instanceof Jv))throw new Pe(te.INVALID_PARAMS,"parameter is not local track");if(!c._enabled&&r)throw new Pe(te.TRACK_IS_DISABLED,"can not publish a disabled track: ".concat(c.getTrackId()))}x.info("[".concat(this._clientId,"] Publishing tracks, id ").concat(s.map(c=>"".concat(c.getTrackId()," "))));const a=await this._publishMutex.lock();await this._configDistribute.awaitConfigDistributeComplete(),r&&s.forEach(c=>{const d=this._configDistribute.getBitrateLimit();c instanceof Dr&&d&&c.setBitrateLimit(d.uplink)});try{await this._publishHighStream(s),x.info("[".concat(this._clientId,"] Publish success, id ").concat(s.map(c=>"".concat(c.getTrackId()," "))))}catch(c){throw x.error("[".concat(this._clientId,"] publish error"),c.toString()),c}finally{a()}}async _publishDataChannel(t){if(t==null)throw new Pe(te.INVALID_PARAMS,"parameter is not local track or datachannel config, config is ".concat(JSON.stringify(t)));_r(t.id,"id",0,65535,!0),Bd(t.ordered,"ordered"),Ss(t.metadata,"metadata",0,512),x.info("[".concat(this._clientId,"] Publishing datachannels, id ").concat(t.id));const r=await this._publishMutex.lock();try{if(this._p2pChannel.getAllDataChannels().findIndex(c=>c.id===t.id)!==-1)throw new Pe(te.INVALID_PARAMS,"Invalid id: ".concat(t.id,". If you want to republish the datachannel, unpublish first"));if(!this._joinInfo||this._uid===void 0)throw new Pe(te.INVALID_OPERATION,"Can't publish datachannel, haven't joined yet!");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new Pe(te.INVALID_OPERATION,"can not publish datachannel in ".concat(this.connectionState," state"));if(this._turnServer.mode==="auto"&&se("FORCE_TURN")&&!se("TURN_ENABLE_TCP")&&!se("TURN_ENABLE_UDP"))throw new Pe(te.UNEXPECTED_ERROR,"force TURN With No TURN Configuration");const s=function(c){return UH(c,!1)}(t),a=await this._p2pChannel.publishDataChannel([s]);if(a.length>0){if(typeof s._originDataChannelId!="number")throw x.error("[".concat(this._clientId,"] can not publish with mediaType datachannel, cannot get RTCDatachannel id")),new Pe(te.CREATE_DATACHANNEL_ERROR);try{await pt.all(a.map(c=>this._uid&&this._gateway.publishDataChannel(this._uid,c,!0))),await s._waitTillOpen()}catch(c){if(c.code!==te.DISCONNECT_P2P)throw c}}return x.info("[".concat(this._clientId,"] Publish dataChannels success, id ").concat(s.id)),s}catch(s){throw x.error("[".concat(this._clientId,"] publish datachannels error"),s.toString()),s}finally{r()}}async unpublish(t){if(!this._joinInfo||this._uid===void 0)throw new Pe(te.INVALID_OPERATION,"Can't unpublish stream, haven't joined yet!");let r=[];if(t)if(Array.isArray(t))r=t;else{if(!(t instanceof Jv))return this._unpublishDataChannel([t]);r=[t]}else this.store.useP2P||await this._unpublishDataChannel(),r=this._p2pChannel.getAllTracks(!0);x.info("[".concat(this._clientId,"] Unpublish tracks, tracks ").concat(r.map(a=>"".concat(a.getTrackId()," "))," "));const s=await this._publishMutex.lock();try{if(this.store.useP2P){const a=await this._p2pChannel.unpublish(r);a&&await this._gateway.sendExtensionMessage(Ei.UNPUBLISH,{unpubMsg:a},!0)}else{const a=await this._p2pChannel.unpublish(r);a&&await this._gateway.unpublish(a,this._uid),x.info("[".concat(this._clientId,"] Unpublish success,tracks ").concat(r.map(c=>"".concat(c.getTrackId()))))}}catch(a){throw x.error("[".concat(this._clientId,"] unpublish error"),a.toString()),a}finally{s&&s()}}async _unpublishDataChannel(t){t!==void 0&&t.length!==0||(t=this._p2pChannel.getAllDataChannels()),x.info("[".concat(this._clientId,"] Unpublish datachannels, datachannels ").concat(t.map(s=>"".concat(s.id," "))," "));const r=await this._publishMutex.lock();try{const s=await this._p2pChannel.unpublishDataChannel(t);s&&await this._gateway.unpublishDataChannel(s),x.info("[".concat(this._clientId,"] Unpublish dataChannel success,dataChannel ").concat(t.map(a=>"".concat(a.id))))}catch(s){throw x.error("[".concat(this._clientId,"] unpublish dataChannel error"),s.toString()),s}finally{r&&r()}}async subscribe(t,r,s){if(!(t instanceof tg)){const a=this.remoteUsers.find(c=>c.uid===t);if(!a)throw new Pe(te.INVALID_REMOTE_USER,"user is not in the channel");t=a}return r==="datachannel"?this._subscribeDataChannel(t,s):this._subscribe(t,r)}async presubscribe(t,r){if(Yi(r,"mediaType",["audio","video"]),this.store.useP2P)throw new Pe(te.INVALID_OPERATION,"can't presub at p2p mode");if(!this._joinInfo)throw new Pe(te.INVALID_OPERATION,"can't presub when not join");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new Pe(te.INVALID_OPERATION,"can't presub in ".concat(this.connectionState," state"));const s=r===yt.AUDIO,a=r===yt.VIDEO,c=await this._subscribeMutex.lock();try{const{ssrcId:d,ortc:h,rtxSsrcId:m,cname:g,uint_id:E}=await this._gateway.presubscribe(t,r,!0);if(d==null)throw new Pe(te.UNEXPECTED_RESPONSE,"no ssrc id");let b=this._users.find(A=>A.uid===t);b||(b=new tg(t,E||t),b._is_pre_created=!0,this._users.push(b)),g&&(b._cname=g),b._uintid||(b._uintid=E||t),s&&(b._audioSSRC=d,b._audio_pre_subscribed=!0,h&&(b._audioOrtc=h)),a&&(b._videoSSRC=d,b._video_pre_subscribed=!0,h&&(b._videoOrtc=h),m!=null&&(b._rtxSsrcId=m)),x.info("[".concat(this._clientId,"] presub succeed ssrc: ").concat(d)),await this._p2pChannel.subscribe(b,r,d,m,h);const I=s?b._audioTrack:b._videoTrack;if(!I)throw new Pe(te.UNEXPECTED_ERROR,"can not find remote track in user");return s&&(b._trust_audio_stream_added_state_=!0,b._audio_added_=!0),a&&(b._trust_video_stream_added_state_=!0,b._video_added_=!0),I}catch(d){throw x.error("[".concat(this._clientId,"] presub user ").concat(t," error"),d),d}finally{c()}}async _subscribeDataChannel(t,r){var s;if(_r(r,"channelId",0,65535,!0),!this._joinInfo)throw new Pe(te.INVALID_OPERATION,"Can't subscribe datachannel, not joined");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new Pe(te.INVALID_OPERATION,"Can't subscribe datachannel in ".concat(this.connectionState," state"));if(!this._users.find(m=>m===t))throw x.error("[".concat(this._clientId,"] can not subscribe ").concat(t.uid,", this user is not in the channel")),new Pe(te.INVALID_REMOTE_USER,"user is not in the channel");if(!t.hasAudio&&!t.hasVideo&&t._dataChannels.length===0)throw x.error("[".concat(this._clientId,"] can not subscribe ").concat(t.uid,", user is not published")),new Pe(te.INVALID_REMOTE_USER,"user is not published");const c=(s=t._dataChannels)===null||s===void 0?void 0:s.find(m=>m.id===r);if(!c)throw x.error("[".concat(this._clientId,"] can not subscribe ").concat(t.uid," with mediaType datachannel, remote datachannel is not published")),new Pe(te.REMOTE_USER_IS_NOT_PUBLISHED);const d=await this._subscribeMutex.lock();x.info("[".concat(this._clientId,"] subscribe user ").concat(t.uid,", mediaType: datachannel"));try{const m=await this._p2pChannel.subscribeDataChannel(t,[c]);if(m&&rt(m).call(m,c.id))try{var h;if(typeof c._originDataChannelId!="number")throw x.error("[".concat(this._clientId,"] can not subscribe ").concat(t.uid," with mediaType datachannel, cannot get RTCDatachannel")),new Pe(te.CREATE_DATACHANNEL_ERROR);const g={id:c.id,datachannelId:c._originDataChannelId,ordered:c.ordered,maxRetransmits:c.maxRetransmits,metadata:(h=c.metadata)!==null&&h!==void 0?h:""};await this._gateway.subscribeDataChannel(t.uid,g,!0),await c._waitTillOpen()}catch(g){if((g==null?void 0:g.code)!==te.WS_ABORT)throw await this._p2pChannel.unsubscribeDataChannel(t,[c]),g;await this._p2pChannel.unsubscribeDataChannel(t,[c]),this._p2pChannel.setPendingRemoteDataChannel(t,c.id)}return x.info("[".concat(this._clientId,"] subscribe success user ").concat(t.uid,", mediaType: datachannel")),c}finally{d()}}async _p2pSubscribe(t,r,s){if(Yi(r,"mediaType",["audio","video"]),!this._joinInfo)throw new Pe(te.INVALID_OPERATION,"Can't subscribe stream, not joined");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new Pe(te.INVALID_OPERATION,"Can't subscribe stream in ".concat(this.connectionState," state"));if(!this._users.find(d=>d===t)){const d=new Pe(te.INVALID_REMOTE_USER,"user is not in the channel");throw x.error("[".concat(this._clientId,"] can not subscribe ").concat(t.uid,", this user is not in the channel")),d}if(!t.hasAudio&&!t.hasVideo){const d=new Pe(te.INVALID_REMOTE_USER,"user is not published");throw x.error("[".concat(this._clientId,"] can not subscribe ").concat(t.uid,", user is not published")),d}if(!s&&(r==="audio"&&!t.hasAudio||r==="video"&&!t.hasVideo)){const d=new Pe(te.REMOTE_USER_IS_NOT_PUBLISHED);throw x.error("[".concat(this._clientId,"] can not subscribe ").concat(t.uid," with mediaType ").concat(r,", remote track is not published")),d}const c=await this._subscribeMutex.lock();x.info("[".concat(this._clientId,"] subscribe user ").concat(t.uid,", mediaType: ").concat(r));try{if(await this._p2pChannel.hasRemoteMediaWithLock(t,r))await this._p2pChannel.unmuteRemote(t,r);else try{const h=r==="audio"?t._audioSSRC:t._videoSSRC,m=r==="audio"?t._audioMid:t._videoMid;this.store.subscribe(t.uid,r,Date.now()),this.store.useP2P&&await this._p2pChannel.subscribe(t,r,h,m)}catch(h){throw h}x.info("[".concat(this._clientId,"] subscribe success user ").concat(t.uid,", mediaType: ").concat(r)),this._defaultStreamFallbackType&&this.setStreamFallbackOption(t.uid,this._defaultStreamFallbackType).catch(h=>{x.warning("[".concat(this._clientId,"] auto set fallback failed"),h)});const d=r==="audio"?t._audioTrack:t._videoTrack;if(!d)throw new Pe(te.UNEXPECTED_ERROR,"can not find remote track in user object");return d}catch(d){throw x.error("[".concat(this._clientId,"] subscribe user ").concat(t.uid," error"),d),d}finally{c()}}async _subscribe(t,r,s){if(this.store.useP2P)return this._p2pSubscribe(t,r);if(Yi(r,"mediaType",["audio","video"]),!this._joinInfo)throw new Pe(te.INVALID_OPERATION,"Can't subscribe stream, not joined");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new Pe(te.INVALID_OPERATION,"Can't subscribe stream in ".concat(this.connectionState," state"));if(!this._users.find(E=>E===t)){const E=new Pe(te.INVALID_REMOTE_USER,"user is not in the channel");throw x.error("[".concat(this._clientId,"] can not subscribe ").concat(t.uid,", this user is not in the channel")),E}if(!t.hasAudio&&!t.hasVideo){const E=new Pe(te.INVALID_REMOTE_USER,"user is not published");throw x.error("[".concat(this._clientId,"] can not subscribe ").concat(t.uid,", user is not published")),E}if(!(s||(r!=="audio"||t.hasAudio&&t._audioSSRC!==void 0)&&(r!=="video"||t.hasVideo&&t._videoSSRC!==void 0))){const E=new Pe(te.REMOTE_USER_IS_NOT_PUBLISHED);throw x.error("[".concat(this._clientId,"] can not subscribe ").concat(t.uid," with mediaType ").concat(r,", remote track is not published")),E}let c=r==="audio"?t._audioSSRC:t._videoSSRC,d=r==="audio"?t._audioOrtc:t._videoOrtc,h=r==="video"?t._rtxSsrcId:void 0,m={stream_type:r==="audio"?yt.AUDIO:yt.VIDEO,ssrcId:c};r==="video"&&this.store.firstVideoFrameDecoded(t.uid,{subscribeStart:Date.now()});const g=await this._subscribeMutex.lock();x.info("[".concat(this._clientId,"] subscribe user ").concat(t.uid,", mediaType: ").concat(r));try{if(await this._p2pChannel.hasRemoteMediaWithLock(t,r))await this._p2pChannel.unmuteRemote(t,r);else try{const b=r==="audio"?t._audioSSRC:t._videoSSRC;b!==void 0&&b!==c&&(c=b,d=r==="audio"?t._audioOrtc:t._videoOrtc,h=r==="video"?t._rtxSsrcId:void 0,m={stream_type:r==="audio"?yt.AUDIO:yt.VIDEO,ssrcId:c}),Zs.markSubscribeStart(this.store.clientId,c),this.store.subscribe(t.uid,r,Date.now()),await this._p2pChannel.subscribe(t,r,c,h,d);try{this._p2pChannel.isPreSubScribe(c)||await this._gateway.subscribe(t.uid,m,!0)}catch(I){if((I==null?void 0:I.code)!==te.WS_ABORT)throw await this._p2pChannel.unsubscribe(t,r),I;await this._p2pChannel.unsubscribe(t,r,!0),this._p2pChannel.setPendingRemoteMedia(t,r)}this.store.subscribe(t.uid,r,void 0,Date.now()),this._p2pChannel.reportSubscribeEvent(!0,null,t,r)}catch(b){throw this._p2pChannel.reportSubscribeEvent(!1,b==null?void 0:b.code,t,r),b}x.info("[".concat(this._clientId,"] subscribe success user ").concat(t.uid,", mediaType: ").concat(r)),this._defaultStreamFallbackType&&this.setStreamFallbackOption(t.uid,this._defaultStreamFallbackType).catch(b=>{x.warning("[".concat(this._clientId,"] auto set fallback failed"),b)});const E=r==="audio"?t._audioTrack:t._videoTrack;if(!E)throw new Pe(te.UNEXPECTED_ERROR,"can not find remote track in user object");return r==="video"&&(this.store.firstVideoFrameDecoded(t.uid,{subscribeEnd:Date.now()}),this._p2pChannel.reportVideoFirstFrameRender(t)),E}catch(E){throw x.error("[".concat(this._clientId,"] subscribe user ").concat(t.uid," error"),E),E}finally{g()}}async massSubscribe(t){if(uf(t,"subscribeList"),!this._joinInfo)throw new Pe(te.INVALID_OPERATION,"Can't subscribe stream, not joined");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new Pe(te.INVALID_OPERATION,"Can't subscribe stream in ".concat(this.connectionState," state"));const r=Date.now(),s=new Map,a=await this._subscribeMutex.lock();x.info("[".concat(this._clientId,"]start massSubscribe user ").concat(t.map(m=>{let{user:g,mediaType:E}=m;return"user: ".concat(g==null?void 0:g.uid,", mediaType: ").concat(E)}).join("; ")));const c=(t=[...t]).map(m=>{let{user:g,mediaType:E}=m;return{user:g,mediaType:E}}),d=await this._p2pChannel.globalLock();try{var h;for(let g=t.length-1;g>=0;g--){const E=t[g],{user:b,mediaType:I}=E;if(Yi(I,"mediaType",["audio","video"]),!b){const j=new Pe(te.INVALID_PARAMS,"user property does not exist in subscribeList item");throw x.error("[".concat(this._clientId,"] user property does not exist in subscribeList item")),j}if(!this._users.find(j=>j===b)){const j=new Pe(te.INVALID_REMOTE_USER,"user is not in the channel");x.error("[".concat(this._clientId,"] can not massSubscribe ").concat(b.uid,", this user is not in the channel")),c[g].error=j,t.splice(g,1);continue}if(I==="audio"&&(!b.hasAudio||b._audioSSRC===void 0)||I==="video"&&(!b.hasVideo||b._videoSSRC===void 0)){const j=new Pe(te.REMOTE_USER_IS_NOT_PUBLISHED);x.error("[".concat(this._clientId,"] can not subscribe ").concat(b.uid," with mediaType ").concat(I,", remote user is not published")),c[g].error=j,t.splice(g,1);continue}const k=ss.Video|ss.LwoVideo,W=s.get(b);if(W){if(I==="video"?W&k:W&ss.Audio){t.splice(g,1),x.warning("[".concat(this._clientId,"] repeat massSubscribe user:").concat(b.uid,", mediaType:").concat(I," twice"));continue}s.set(b,W|(I==="video"?k:ss.Audio))}else s.set(b,I==="video"?k:ss.Audio)}for(let g=t.length-1;g>=0;g--){const E=t[g],{user:b,mediaType:I}=E,A=ss.Video|ss.LwoVideo;if(this._p2pChannel.hasRemoteMedia(b,I)){await this._p2pChannel.unmuteRemoteNoLock(b,I);const k=s.get(b);s.set(b,I==="video"?k^A:k^ss.Audio),t.splice(g,1)}}this.store.massSubscribe(t.map(g=>({userId:g.user.uid,type:g.mediaType})),r);let m=Wa(h=Array.from(s.entries())).call(h,(g,E)=>{let[b,I]=E;if(I===0)return g;const A={stream_id:b.uid,stream_type:I};return I&ss.Audio&&(A.audio_ssrc=b._audioSSRC),I&ss.Video&&(A.video_ssrc=b._videoSSRC),g.push(A),g},[]);try{t.length>0&&await this._p2pChannel.massSubscribeNoLock(t.map(E=>{let{user:b,mediaType:I}=E;return{user:b,mediaType:I,ssrcId:I===yt.VIDEO?b._videoSSRC:b._audioSSRC,rtxSsrcId:I===yt.VIDEO?b._rtxSsrcId:void 0}}));const g=new Map;if(m=m.filter(E=>E.video_ssrc&&!this._p2pChannel.isPreSubScribe(E.video_ssrc)||E.audio_ssrc&&!this._p2pChannel.isPreSubScribe(E.audio_ssrc)||!E.video_ssrc&&!E.audio_ssrc),m.length>0){const E=await this._gateway.subscribeAll(m,!0);((E==null?void 0:E.users)||[]).forEach(b=>{let{stream_id:I,video_error_code:A,audio_error_code:k,error_code:W}=b;(A||k||W)&&g.set(I,{video_error_code:A,audio_error_code:k,error_code:W})})}if(Array.from(g.entries()).length>0){const E=[];Array.from(g.entries()).forEach(b=>{let[I,A]=b;const k=this.remoteUsers.find(W=>W.uid===I);if(k){let W;A.error_code||A.video_error_code&&A.audio_error_code?W=void 0:A.video_error_code?W=yt.VIDEO:A.audio_error_code&&(W=yt.AUDIO),E.push({user:k,mediaType:W})}}),E.length>0&&await this._p2pChannel.massUnsubscribeNoLock(E)}for(const E of c){const b=g.get(E.user.uid);if(b){const I=b.error_code||E.mediaType==="audio"&&b.audio_error_code||E.mediaType==="video"&&b.video_error_code;if(I){const A=aT(I);x.error("user:".concat(E.user.uid," mediaType:").concat(E.mediaType," has massSubscribe error ").concat(A.desc)),E.error=new Pe(te.SUBSCRIBE_FAILED,"code ".concat(I,": ").concat(A.desc))}}E.error||(E.mediaType==="video"?E.track=E.user.videoTrack:E.track=E.user.audioTrack)}return this.store.massSubscribe(c.filter(E=>!E.error).map(E=>({userId:E.user.uid,type:E.mediaType})),void 0,Date.now()),c.forEach(E=>{var b;At.subscribe(this.store.sessionId,{succ:!!E.error,ec:((b=E.error)===null||b===void 0?void 0:b.code)||null,video:E.mediaType===yt.VIDEO,audio:E.mediaType===yt.AUDIO,peerid:E.user.uid,subscribeRequestid:E.mediaType===yt.VIDEO?E.user._videoSSRC:E.user._audioSSRC,p2pid:this.store.p2pId,eventElapse:Math.floor(performance.now()-r),preSsrc:this._p2pChannel.isPreSubScribe(E.user._videoSSRC)},!0)}),x.info("[".concat(this._clientId,"] massSubscribe success ").concat(t.map(E=>{let{user:b,mediaType:I}=E;return"user: ".concat(b==null?void 0:b.uid,", mediaType: ").concat(I)}).join("; "))),c}catch(g){throw await this._p2pChannel.massUnsubscribeNoLock(t),g}}finally{d(),a()}}async unsubscribe(t,r,s){if(!(t instanceof tg)){const d=this.remoteUsers.find(h=>h.uid===t);if(!d)throw new Pe(te.INVALID_REMOTE_USER,"user is not in the channel");t=d}if(r||this.store.useP2P){if(r==="datachannel")return this._unsubscribeDataChannel(t,s)}else await this._unsubscribeDataChannel(t,s);if(r&&Yi(r,"mediaType",["audio","video"]),!this._joinInfo)throw new Pe(te.INVALID_OPERATION,"Can't unsubscribe stream, haven't joined yet!");if(!this._users.find(d=>d===t)){const d=new Pe(te.INVALID_REMOTE_USER,"user is not in the channel");throw x.error("[".concat(this._clientId,"] can not unsubscribe ").concat(t.uid,", user is not in the channel")),d}x.info("[".concat(this._clientId,"] unsubscribe uid: ").concat(t.uid,", mediaType: ").concat(r));const c=await this._subscribeMutex.lock();try{if(this.store.useP2P)await this._p2pChannel.unsubscribe(t,r);else{const d=await this._p2pChannel.unsubscribe(t,r);d&&await this._gateway.unsubscribe(d,t.uid),r&&r!=="audio"||(t._audio_pre_subscribed=!1),r&&r!=="video"||(t._video_pre_subscribed=!1),t._is_pre_created&&pP(this._users,t),x.info("[".concat(this._clientId,"] unsubscribe success uid: ").concat(t.uid,", mediaType: ").concat(r))}}catch(d){if(d.code===te.DISCONNECT_P2P)return void x.warning("disconnecting p2p, abort unsubscribe request.");throw x.error("[".concat(this._clientId,"] unsubscribe user ").concat(t.uid," error"),d.toString()),d}finally{c()}}async _unsubscribeDataChannel(t,r){if(r&&_r(r,"id",0,65535,!0),!this._joinInfo)throw new Pe(te.INVALID_OPERATION,"Can't unsubscribe datachannel, haven't joined yet!");if(!this._users.find(c=>c===t)){const c=new Pe(te.INVALID_REMOTE_USER,"user is not in the channel");throw x.error("[".concat(this._clientId,"] can not unsubscribe ").concat(t.uid,", user is not in the channel")),c}let a;if(typeof r=="number"){const c=t._dataChannels.find(d=>d.id===r);c&&(a=[c])}else a=t._dataChannels;if(a===void 0){const c=new Pe(te.REMOTE_USER_IS_NOT_PUBLISHED);throw x.error("[".concat(this._clientId,"] can not unsubscribe ").concat(t.uid," with channelId ").concat(r,", remote datachannel is not published")),c}x.info("[".concat(this._clientId,"] unsubscribe uid: ").concat(t.uid,", mediaType: datachannel, ids: ").concat(a.map(c=>c.id)));try{const c=await this._p2pChannel.unsubscribeDataChannel(t,a);c&&await this._gateway.unsubscribeDataChannel(c,t.uid),x.info("[".concat(this._clientId,"] unsubscribe datachannel success uid: ").concat(t.uid,", mediaType: datachannel, ids: ").concat(c))}catch(c){if(c.code===te.DISCONNECT_P2P)return void x.warning("disconnecting p2p, abort unsubscribe request.");throw x.error("[".concat(this._clientId,"] unsubscribe user ").concat(t.uid," error"),c.toString()),c}}async massUnsubscribe(t){if(uf(t,"unsubscribeList"),!this._joinInfo)throw new Pe(te.INVALID_OPERATION,"Can't unsubscribeAll stream, haven't joined yet!");x.info("[".concat(this._clientId,"] start massUnsubscribe ").concat(t.map(s=>{let{user:a,mediaType:c}=s;return"user: ".concat(a==null?void 0:a.uid,", mediaType: ").concat(c,";")}).join())),t=[...t];const r=new Map;for(let s=t.length-1;s>=0;s--){const{user:a,mediaType:c}=t[s];if(!a){const m=new Pe(te.INVALID_PARAMS,"user property does not exist in unsubscribeList item");throw x.error("[".concat(this._clientId,"] user property does not exist in unsubscribeList item")),m}if(Yi(c,"mediaType",["video","audio",void 0]),!this._users.find(m=>m===a)){x.warning("[".concat(this._clientId,"] can not unsubscribe ").concat(a.uid,", user is not in the channel")),t.splice(s,1);continue}const h=ss.Video|ss.LwoVideo;if(r.has(a)){const m=r.get(a);let g;switch(c){case"video":g=m&h;break;case"audio":g=m&ss.Audio;break;default:g=m&(ss.Audio|h)}if(g){x.warning("[".concat(this._clientId,"] repeat massUnsubscribe user:").concat(a.uid,",mediaType:").concat(c," twice.")),t.splice(s,1);continue}c?c==="audio"?r.set(a,m|ss.Audio):c==="video"&&r.set(a,m|h):r.set(a,m|ss.Audio|h)}else c?c==="audio"?r.set(a,ss.Audio):c==="video"&&r.set(a,h):r.set(a,ss.Audio|h)}try{const s=await this._p2pChannel.massUnsubscribe(t);s&&await this._gateway.massUnsubscribe(s),x.info("[".concat(this._clientId,"] massUnsubscribe success ").concat(t.map(a=>{let{user:c,mediaType:d}=a;return"user: ".concat(c==null?void 0:c.uid,", mediaType: ").concat(d,";")}).join()))}catch(s){if(s.code===te.DISCONNECT_P2P)return void x.warning("[".concat(this._clientId,"] disconnecting p2p, abort unsubscribe request."));throw x.error("[".concat(this._clientId,"] massUnsubscribe error"),s.toString()),s}}async setLowStreamParameter(t){(function(s){if(!s)throw new Le(te.INVALID_PARAMS);ri(s.width)||LL(s.width,"streamParameter.width"),ri(s.height)||LL(s.height,"streamParameter.height"),ri(s.framerate)||LL(s.framerate,"streamParameter.framerate"),ri(s.bitrate)||_r(s.bitrate,"streamParameter.bitrate")})(t),(!t.width&&t.height||t.width&&!t.height)&&x.warning("[".concat(this._clientId,"] The width and height parameters take effect only when both are set")),x.info("[".concat(this._clientId,"] set low stream parameter to"),JSON.stringify(t));const r=this._configDistribute.getLowStreamConfigDistribute();if(r&&r.bitrate&&t.bitrate&&r.bitrate<t.bitrate&&(t.bitrate=r.bitrate),this._lowStreamParameter=t,this._isDualStreamEnabled)return this._p2pChannel.updateVideoStreamParameter(t,qe.LocalVideoLowTrack)}async enableDualStream(){if(!jn().supportDualStream)throw At.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!0,succ:!1}),new Pe(te.NOT_SUPPORTED,"Your browser is not support dual stream");if(this._isDualStreamEnabled)throw new Pe(te.INVALID_OPERATION,"Dual stream is already enabled");if(this._p2pChannel.canPublishLowStream())try{await this._publishLowStream()}catch(t){throw At.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!0,succ:!1}),t}this._isDualStreamEnabled=!0,At.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!0,succ:!0}),x.info("[".concat(this._clientId,"] enable dual stream"))}async disableDualStream(){if(this._isDualStreamEnabled){if(!this._joinInfo)throw new Pe(te.INVALID_OPERATION,"Can't publish stream, haven't joined yet!");if(this._p2pChannel.getLocalMedia(qe.LocalVideoLowTrack))try{const t=await this._p2pChannel.unpublishLowStream();t&&await this._gateway.unpublish(t,this._joinInfo.stringUid||this._joinInfo.uid)}catch(t){throw At.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!1,succ:!1}),t}this._isDualStreamEnabled=!1,At.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!1,succ:!0}),x.info("[".concat(this._clientId,"] disable dual stream"))}}async setClientRole(t,r){if(function(a){Yi(a,"role",["audience","host"])}(t),r&&FL(r),this.mode==="rtc"||this.mode==="p2p")throw x.warning("[".concat(this._clientId,"]").concat(this.mode," mode can not use setClientRole")),new Pe(te.INVALID_OPERATION,"".concat(this.mode," mode can not use setClientRole"));if(r&&r.level&&t==="host")throw new Pe(te.INVALID_OPERATION,"host mode can not set audience latency level");if(t==="audience"&&this._p2pChannel.hasLocalMedia())throw new Pe(te.INVALID_OPERATION,"can not set client role to audience when publishing stream");const s=this._config.role;this._joinInfo&&(this._joinInfo.role=t),t!==s&&se("ENABLE_ROLE_SELECT_EDGE")?(this._gateway.updateClientRole(t,r),this._config.role=t,this._gateway.reconnect("recover",Ls.REGIONAL_DISTRIBUTION)):(await this._gateway.setClientRole(t,r),this._config.role=t),x.info("[".concat(this._clientId,"] set client role to ").concat(t,", level: ").concat(r&&r.level))}async _setClientRoleOptions(t){if(this.mode==="rtc"||this.mode==="p2p"||this._config.role!=="audience"||this._p2pChannel.hasLocalMedia())return;let r=!1;try{t&&FL(t),await this._gateway.setClientRole(this._config.role,t),r=!0}catch{}finally{x.info("[".concat(this._clientId,"] set client role options ").concat(r?"succeed":"failed",", options is ").concat(t))}}getRemoteInboundOffset(){var t;const r=(t=this._p2pChannel.getStats())===null||t===void 0?void 0:t.audioSend[0];if(!r||!r.timestamp)return 0;const s=r.timestamp-Date.now();return Math.abs(s)>1e3+r.rttMs+100?this.ntpAlignErrorCount+=1:this.ntpAlignErrorCount=0,this.ntpAlignErrorCount>=3?s:0}getNtpWallTimeInMs(){return document.visibilityState==="visible"&&(this.remoteInboundOffset=this.getRemoteInboundOffset()),this.remoteInboundOffset+Date.now()+this._gateway.ntpOffset}setProxyServer(t,r){if(Ss(t,"proxyServer"),!r){if(this.connectionState!=="DISCONNECTED")throw new Pe(te.INVALID_OPERATION,"Set proxy server before join channel");if(this._cloudProxyServerMode!=="disabled"||this._useLocalAccessPoint)throw new Pe(te.INVALID_OPERATION,"You have already set the proxy")}this._proxyServer=t,At.setProxyServer(this._proxyServer),x.setProxyServer(this._proxyServer),x.info("[".concat(this._clientId,"] Set proxy server ").concat(r?"by initialize call":""," success."))}setTurnServer(t,r){if(Array.isArray(t)||(t=[t]),!r){if(this.connectionState!=="DISCONNECTED")throw new Pe(te.INVALID_OPERATION,"Set turn server before join channel");if(this._cloudProxyServerMode!=="disabled"||this._useLocalAccessPoint)throw new Pe(te.INVALID_OPERATION,"You have already set the proxy")}if(Yw(t))return this._turnServer={servers:t,mode:"original-manual"},void x.info("[".concat(this._clientId,"] Set original turnserver ").concat(r?"by initialize call":""," success: ").concat(t.map(s=>s.urls).join(","),"."));t.forEach(s=>hW(s)),this._turnServer={servers:t,mode:"manual"},x.info("[".concat(this._clientId,"] Set turnserver ").concat(r?"by initialize call":""," success."))}setLicense(t){if(this.connectionState!=="DISCONNECTED")throw new Pe(te.INVALID_OPERATION,"you should set license before join channel");if(Ss(t,"license",32,32),!/^[A-Za-z\d]+$/.test(t))throw new Pe(te.INVALID_PARAMS,"license should only contains characters from A-Z a-z 0-9");this._license=t,x.info("[".concat(this._clientId,"] set license success"),t)}startProxyServer(t){if(this.connectionState!=="DISCONNECTED")throw new Pe(te.INVALID_OPERATION,"Start proxy server before join channel");if(this._proxyServer||this._turnServer.mode==="manual"||this._useLocalAccessPoint)throw new Pe(te.INVALID_OPERATION,"You have already set the proxy");const r=[3,4,5];let s;switch(t===void 0&&(t=3),t){case 1:case 2:throw new Pe(te.NOT_SUPPORTED,"proxy mode 1/2 has been deprecated and not supported.");case 3:s="proxy3";break;case 4:s="proxy4";break;case 5:s="proxy5";break;default:throw new Pe(te.INVALID_PARAMS,"proxy server mode must be ".concat(r.join("|")))}this._cloudProxyServerMode=s,this.store.cloudProxyServerMode=s,x.info("[".concat(this._clientId,"] set cloud proxy server mode to"),this._cloudProxyServerMode)}stopProxyServer(){if(this.connectionState!=="DISCONNECTED")throw new Pe(te.INVALID_OPERATION,"Stop proxy server after leave channel");At.setProxyServer(),x.setProxyServer(),this._cloudProxyServerMode="disabled",this.store.cloudProxyServerMode="disabled",x.info("[".concat(this._clientId,"] set cloud proxy server mode to"),this._cloudProxyServerMode),this._proxyServer=void 0,this._turnServer={mode:"auto",servers:[]}}setLocalAccessPointsV2(t){if(!t.accessPoints)throw new Pe(te.INVALID_PARAMS,"accessPoints is required.");uf(t.accessPoints.serverList,"accessPoints.serverList"),Ss(t.accessPoints.domain,"accessPoints.domain");const r=(A,k)=>{_r(A,k,0,65535,!0)};let s=443;if(t.accessPoints.port&&(r(t.accessPoints.port,"accessPoints.port"),s=t.accessPoints.port),this._proxyServer||this._cloudProxyServerMode!=="disabled")throw new Pe(te.INVALID_OPERATION,"set local access point failed, You have already set the cloud proxy");se("CLOSE_AFB_FOR_LOCAL_AP")&&(pr("JOIN_WITH_FALLBACK_SIGNAL_PROXY",!1),pr("JOIN_WITH_FALLBACK_MEDIA_PROXY",!1));const a=/^((\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.){3}(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])$/,c=t.accessPoints.domain,d=t.accessPoints.serverList.map(A=>a.test(A)?"".concat(A.replace(/\./g,"-"),".").concat(c):A),h=d.map(A=>"".concat(A,":").concat(s));this._useLocalAccessPoint=!0,this._setLocalAPVersion=2,pr("WEBCS_DOMAIN",h),pr("WEBCS_DOMAIN_BACKUP_LIST",h),pr("GATEWAY_DOMAINS",[c]),t.report&&t.report.hostname&&Array.isArray(t.report.hostname)&&t.report.hostname.length?(uf(t.report.hostname,"report.hostname"),pr("EVENT_REPORT_DOMAIN",t.report.hostname[0]),pr("EVENT_REPORT_BACKUP_DOMAIN",t.report.hostname[1]||t.report.hostname[0])):(pr("EVENT_REPORT_DOMAIN",d[0]),pr("EVENT_REPORT_BACKUP_DOMAIN",d[1]||d[0]));let m=6443;t.report&&t.report.port&&(r(t.report.port,"report.port"),m=t.report.port),pr("STATS_COLLECTOR_PORT",m),t.report?pr("ENABLE_EVENT_REPORT",!0):pr("ENABLE_EVENT_REPORT",!1);let g="";t.log&&t.log.hostname&&Array.isArray(t.log.hostname)&&t.log.hostname.length?(uf(t.log.hostname,"log.hostname"),g=t.log.hostname[0]):g=d[0];let E=6444;t.log&&t.log.port&&(r(t.log.port,"log.port"),E=t.log.port),pr("LOG_UPLOAD_SERVER","".concat(g,":").concat(E));let b=[];t.cds&&t.cds.hostname&&Array.isArray(t.cds.hostname)&&t.cds.hostname.length?(uf(t.cds.hostname,"cds.hostname"),b=t.cds.hostname):b=d;let I=443;t.cds&&t.cds.port&&(r(t.cds.port,"cds.port"),I=t.cds.port),pr("CDS_AP",b.map(A=>"".concat(A,":").concat(I))),t.cds?pr("ENABLE_CONFIG_DISTRIBUTE",!0):pr("ENABLE_CONFIG_DISTRIBUTE",!1),x.info("set local access point v2 success")}setLocalAccessPoints(t,r){if(uf(t,"serverList"),Ss(r,"domain"),this._proxyServer||this._cloudProxyServerMode!=="disabled")throw new Pe(te.INVALID_OPERATION,"set local access point failed, You have already set the cloud proxy");const s=/^(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])$/;t=t.map(a=>s.test(a)?"".concat(a.replace(/\./g,"-"),".").concat(r):a),this._useLocalAccessPoint=!0,this._setLocalAPVersion=1,pr("WEBCS_DOMAIN",t),pr("WEBCS_DOMAIN_BACKUP_LIST",t),pr("GATEWAY_DOMAINS",[r]),pr("EVENT_REPORT_DOMAIN",t[0]),pr("EVENT_REPORT_BACKUP_DOMAIN",t[1]||t[0]),pr("LOG_UPLOAD_SERVER","".concat(t[0],":6444")),x.info("[".concat(this._clientId,"] set local access point success"))}async setRemoteDefaultVideoStreamType(t){if(Yi(t,"streamType",[0,1,4,5,6,7,8,9]),this._remoteDefaultVideoStreamType=t,this._joinInfo)try{await this._gateway.setDefaultRemoteVideoStreamType(t),this._joinInfo.defaultVideoStream=this._remoteDefaultVideoStreamType}catch(r){throw x.error("[".concat(this._clientId,"] set default remote video stream type error"),r.toString()),r}else x.debug("[".concat(this._clientId,"] haven't joined yet, cache remoteDefaultVideoStreamType ").concat(t))}async setRemoteVideoStreamType(t,r){Yi(r,"streamType",[0,1,4,5,6,7,8,9]);try{await this._gateway.setRemoteVideoStreamType(t,r),setTimeout(()=>{const s=this._users.find(a=>a.uid===t);s&&s.videoTrack&&s.videoTrack.updateMediaStreamTrackResolution()},2e3)}catch(s){throw x.error("[".concat(this._clientId,"] set remote video stream type error"),s.toString()),s}x.info("[".concat(this._clientId,"] set remote ").concat(t," video stream type to ").concat(r)),this._remoteStreamTypeCacheMap.set(t,r)}async setStreamFallbackOption(t,r){Yi(r,"fallbackType",[0,1,2,3,4,5,6,7,8]);try{await this._gateway.setStreamFallbackOption(t,r)}catch(s){throw x.error("[".concat(this._clientId,"] set stream fallback option"),s.toString()),s}x.info("[".concat(this._clientId,"] set remote ").concat(t," stream fallback type to ").concat(r)),this._streamFallbackTypeCacheMap.set(t,r)}setEncryptionConfig(t,r,s,a){(function(d){Yi(d,"encryptionMode",["aes-128-xts","aes-256-xts","aes-128-ecb","sm4-128-ecb","aes-128-gcm","aes-256-gcm","aes-128-gcm2","aes-256-gcm2","none"])})(t),Ss(r,"secret");const c=["aes-128-gcm2","aes-256-gcm2"];if(rt(c).call(c,t)){if(!s||!(s instanceof Uint8Array&&s.length===32))throw new Pe(te.INVALID_PARAMS,"salt must be an Uint8Array and exactly equal to 32 bytes")}else if(s)throw new Pe(te.INVALID_PARAMS,"current encrypt mode does not need salt");if(a){if(Bd(a,"encryptDataStream"),!rt(c).call(c,t))throw new Pe(te.INVALID_PARAMS,"current encrypt mode does not support data stream");this._encryptDataStream=!0}new RegExp(`^(?=.*[a-z])(?=.*[A-Z])(?=.*[0-9])(?=.*[!@#$%^&*,.<>?/:;'"|{}\\[\\]])(?=.{8,})`).test(r)||x.warning(`The secret is not strong:
      The secret must contain at least 1 lowercase alphabetical character,
      The secret must contain at least 1 uppercase alphabetical character,
      The secret must contain at least 1 numeric character,
      The secret must contain at least one special character,
      The secret must be eight characters or longer.
      `),this._encryptionMode=t,this._encryptionSecret=r,s&&(this._encryptionSalt=Gm(s))}async renewToken(t){if(Ss(t,"token",1,2047),!this._key||!this._joinInfo)throw new Pe(te.INVALID_OPERATION,"renewToken should not be called before user join");const r=this._key;this._key=t,this._joinInfo&&(this._joinInfo.token=t);const s=await this._renewTokenMutex.lock();try{if(se("USE_NEW_TOKEN")){x.debug("[".concat(this._clientId,"] start renew token with ticket from unilbs"));const a=await __e(this._joinInfo,this._axiosCancelSource.token,this._config.httpRetryConfig||Mi);x.debug("[".concat(this._clientId,"] get ticket from unilbs success")),await this._gateway.renewToken({token:t,ticket:a})}else x.debug("[".concat(this._clientId,"] start renew token without ticket")),await this._gateway.renewToken({token:t});x.debug("[".concat(this._clientId,"] renewToken success"))}catch(a){throw this._key=r,this._joinInfo.token=r,x.error("[".concat(this._clientId,"] renewToken failed"),a.toString()),a}finally{s()}}enableAudioVolumeIndicator(){this._audioVolumeIndicationInterval?x.warning("you have already enabled audio volume indicator!"):this._audioVolumeIndicationInterval=window.setInterval(()=>{const t=this._p2pChannel.getAudioLevels();this.safeEmit(Rn.VOLUME_INDICATOR,t)},se("AUDIO_VOLUME_INDICATION_INTERVAL")||2e3)}getRTCStats(){const t=this._statsCollector.getRTCStats(),r=this._gateway.getInChannelInfo();return t.Duration=Math.round(r.duration/1e3),t}async startLiveStreaming(t,r){if(!r){if(this.codec!=="h264")throw new Pe(te.LIVE_STREAMING_INVALID_RAW_STREAM,"raw streaming is only support h264");if(!this._p2pChannel.hasLocalMedia())throw new Pe(te.LIVE_STREAMING_INVALID_RAW_STREAM,"can not find stream to raw streaming")}if(this._liveRawStreamingClient&&this._liveRawStreamingClient.hasUrl(t)||this._liveTranscodeStreamingClient&&this._liveTranscodeStreamingClient.hasUrl(t))throw new Pe(te.LIVE_STREAMING_TASK_CONFLICT);const s=r?df.TRANSCODE:df.RAW;return this._createLiveStreamingClient(s).startLiveStreamingTask(t,s)}setLiveTranscoding(t){return this._createLiveStreamingClient(df.TRANSCODE).setTranscodingConfig(t)}async stopLiveStreaming(t){const r=[this._liveRawStreamingClient,this._liveTranscodeStreamingClient].filter(s=>s&&s.hasUrl(t));if(!r.length)throw new Pe(te.INVALID_PARAMS,"can not find live streaming url to stop");await pt.all(r.map(s=>s&&s.stopLiveStreamingTask(t)))}async startChannelMediaRelay(t){ZH(t),await this._createChannelMediaRelayClient().startChannelMediaRelay(t)}async updateChannelMediaRelay(t){ZH(t),await this._createChannelMediaRelayClient().updateChannelMediaRelay(t)}async stopChannelMediaRelay(){await this._createChannelMediaRelayClient().stopChannelMediaRelay(),this._statsCollector.onStatsChanged&&(this._statsCollector.onStatsChanged=void 0)}sendAudioMetadata(t){this._p2pChannel instanceof _T&&this._p2pChannel.addAudioMetadata(t)}async sendStreamMessage(t){var r;let s=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1];if(!this._joinInfo)throw new Pe(te.INVALID_OPERATION,"can not send data stream, not joined");if((typeof t=="string"||t instanceof Uint8Array)&&(t={payload:t}),typeof t.payload=="string"){const c=new TextEncoder;t.payload=c.encode(t.payload)}let a=!1;if(this._encryptDataStream&&this._encryptDataStreamIv&&this._encryptDataStreamKey&&window.crypto.subtle&&rt(r=["aes-128-gcm2","aes-256-gcm2"]).call(r,this._encryptionMode)&&(a=!0,t.payload=await async function(c,d,h){var m;const g=Wa(m=Array.from(h)).call(m,(j,B)=>j+B,0),E={serverTs:0,seq:Vme++,length:h.length,checkSum:g},b=new Uint8Array(vW(g,2)),I=new ArrayBuffer(Hv),A=new DataView(I);A.setUint32(0,E.serverTs),A.setUint16(4,E.seq),A.setUint16(6,E.length),A.setUint16(8,E.checkSum);const k=16-h.length%16;h=mW(h,new Uint8Array(k));const W=await window.crypto.subtle.encrypt({name:"AES-GCM",iv:c,tagLength:DW,additionalData:b},d,h);return mW(new Uint8Array(I),new Uint8Array(W))}(this._encryptDataStreamIv,this._encryptDataStreamKey,t.payload)),new Blob([t.payload]).size>1024)throw new Pe(te.INVALID_PARAMS,a?"encrypted stream message out of range.":"stream message out of range.");return this._gateway.signal.request(qt.DATA_STREAM,{payload:Gm(t.payload),syncWithAudio:t.syncWithAudio,sendTs:Date.now()-C_e},!s)}sendMetadata(t){if(!this._joinInfo)throw new Pe(te.INVALID_OPERATION,"can not send metadata, not joined");if(new Blob([t]).size>1024)throw new Pe(te.METADATA_OUT_OF_RANGE);return this._gateway.signal.request(qt.SEND_METADATA,{session_id:this._joinInfo.sid,metadata:Gm(t)})}async sendCustomReportMessage(t){if(Array.isArray(t)||(t=[t]),t.forEach(Kme),!this._joinInfo)throw new Pe(te.INVALID_OPERATION,"can not send custom report, not joined");await At.sendCustomReportMessage(this._joinInfo.sid,t)}getLocalAudioStats(){return this._statsCollector.getLocalAudioTrackStats()}getRemoteAudioStats(){return this._statsCollector.getRemoteAudioTrackStats()}getLocalVideoStats(){return this._statsCollector.getLocalVideoTrackStats()}getRemoteVideoStats(){return this._statsCollector.getRemoteVideoTrackStats()}getRemoteNetworkQuality(){const t=this._statsCollector.getRemoteNetworkQualityStats();if(se("DELETE_NEQ_AFTER_USER_LEAVE")){const r=this._users.map(s=>s.uid+"");Object.keys(t).forEach(s=>{rt(r).call(r,s)||delete t[s]})}return t}async pickSVCLayer(t,r){Yi(r.spatialLayer,"spatialLayer",[0,1,2,3]),Yi(r.temporalLayer,"temporalLayer",[0,1,2,3]);try{await this._gateway.pickSVCLayer(t,r)}catch(s){throw x.error("[".concat(this._clientId,"] pick SVC layer failed"),s.toString()),s}}async setRTMConfig(t){const{apRTM:r=!1,rtmFlag:s}=t;if(Bd(r,"apRTM"),_r(s,"rtmFlag",0),this._rtmConfig.apRTM=r,this._rtmConfig.rtmFlag=s,x.debug("[".concat(this._clientId,"] setRTMconfig ").concat(JSON.stringify(t)," in ").concat(this.connectionState," state")),(this.connectionState==="CONNECTED"||this.connectionState==="RECONNECTING")&&this._joinInfo)return this._joinInfo.apRTM=r,this._joinInfo.rtmFlag=s,this._gateway.setRTM2Flag(s)}_reset(){if(x.debug("[".concat(this._clientId,"] reset client")),function(t){const r=r0.indexOf(t);r!==-1&&r0.splice(r,1)}(this._clientId),this.store.hasStartJoinChannel=!1,this.store.isABTestSuccess=!1,this.store.autoSubscribe=!1,this._axiosCancelSource.cancel(),this._axiosCancelSource=Sa.CancelToken.source(),this._streamFallbackTypeCacheMap=new Map,this._remoteStreamTypeCacheMap=new Map,this._configDistribute.stopGetConfigDistribute(),this._joinInfo&&C7(this._joinInfo),this._joinInfo=void 0,this._proxyServer=void 0,this._defaultStreamFallbackType=void 0,this._sessionId&&At.removeSid(this._sessionId),this._sessionId=null,this.store.sessionId=null,this.store.resetFirstVideoFrameDecoded(),this._statsCollector.reset(),this._key=void 0,this._appId=void 0,this._uid=void 0,this.store.uid=void 0,this._channelName=void 0,this._encryptionMode="none",this._encryptionSecret=null,this._encryptionSalt=null,this._encryptDataStreamKey=null,this._encryptDataStreamIv=null,this._pendingPublishedUsers=[],this._users.forEach(t=>{t._audioTrack&&t._audioTrack._destroy(),t._videoTrack&&t._videoTrack._destroy(),t._dataChannels&&(t._dataChannels.forEach(r=>r._close()),t._dataChannels.length=0)}),this._users=[],this._audioVolumeIndicationInterval&&(window.clearInterval(this._audioVolumeIndicationInterval),this._audioVolumeIndicationInterval=void 0),this._cloudProxyServerMode==="fallback"&&(this._cloudProxyServerMode="disabled",this.store.cloudProxyServerMode="disabled"),this._p2pChannel.reset(),this._publishMutex=new Ys("client-publish",this._clientId),this._subscribeMutex=new Ys("client-subscribe",this._clientId),this._networkQualityInterval&&(window.clearInterval(this._networkQualityInterval),this._networkQualityInterval=void 0),this._liveRawStreamingClient&&(this._liveRawStreamingClient.terminate(),this._liveRawStreamingClient.removeAllListeners(),this._liveRawStreamingClient=void 0),this._liveTranscodeStreamingClient&&(this._liveTranscodeStreamingClient.terminate(),this._liveTranscodeStreamingClient.removeAllListeners(),this._liveTranscodeStreamingClient=void 0),this._channelMediaRelayClient&&(this._channelMediaRelayClient.dispose(),this._channelMediaRelayClient=void 0),this._inspect)try{this._inspect.close(),this._inspect=void 0}catch{}if(this._moderation)try{this.setImageModeration(!1)}catch{}}_startSession(t,r){var s;const a=t||ty();t?x.debug("[".concat(this._clientId,"] new Session ").concat(a)):x.debug("[".concat(this._clientId,"] renewSession ").concat(this._sessionId," => ").concat(a));const c=t?"":this._sessionId||"";this._sessionId=a,this.store.sessionId=a,At.addSid(a);const d={lts:new Date().getTime(),mode:this.mode,buildFormat:1,stringUid:(r==null?void 0:r.stringUid)||((s=this._joinInfo)===null||s===void 0?void 0:s.stringUid),channelProfile:this.mode==="live"?1:0,channelMode:0,isABTestSuccess:Number(this._configDistribute.isSuccess),lsid:c,clientRole:this.role==="audience"?2:1};At.sessionInit(this._sessionId,Wu({cname:r.channel,appid:r.appId},d)),this._joinInfo&&(this._joinInfo.sid=a),this._gateway.joinInfo&&(this._gateway.joinInfo.sid=a)}async _publishHighStream(t){if(!this._joinInfo||this._uid===void 0)throw new Pe(te.INVALID_OPERATION,"Can't publish stream, haven't joined yet!");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new Pe(te.INVALID_OPERATION,"can not publish stream in ".concat(this.connectionState," state"));if(this._turnServer.mode==="auto"&&se("FORCE_TURN")&&!se("TURN_ENABLE_TCP")&&!se("TURN_ENABLE_UDP"))throw new Pe(te.UNEXPECTED_ERROR,"force TURN With No TURN Configuration");x.debug("[".concat(this._clientId,"] publish high stream"));try{const s=await this._p2pChannel.publish(t,this._isDualStreamEnabled,this._lowStreamParameter);if(this.store.useP2P){const a=(await s.next()).value;if(a){try{await this._gateway.sendExtensionMessage(Ei.PUBLISH,a,!0)}catch(c){throw s.throw(c),c}await s.next()}this._p2pChannel.reportPublishEvent(!0,null)}else{const a=(await s.next()).value;if(a){var r;let c;try{c=await this._gateway.publish(this._uid,a,!0)}catch(d){if(d.code!==te.DISCONNECT_P2P)throw s.throw(d),d}await s.next(((r=c)===null||r===void 0?void 0:r.ortc)||[])}this._p2pChannel.reportPublishEvent(!0,null);for(const c of t)c instanceof Dr&&c._encoderConfig&&this._gateway.setVideoProfile(c._encoderConfig).catch(d=>{x.debug("[".concat(this._clientId,"] stop setVideoProfile, because websocket is closed"))}),!c.muted&&c.enabled||await this._p2pChannel.muteLocalTrack(c)}}catch(s){if(this._p2pChannel.reportPublishEvent(!1,s==null?void 0:s.code,t),(s==null?void 0:s.code)===te.WS_ABORT)return;throw s}}async _publishLowStream(){if(!this._joinInfo||this._uid===void 0)throw new Pe(te.INVALID_OPERATION,"Can't publish stream, haven't joined yet!");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new Pe(te.INVALID_OPERATION,"can not publish stream in ".concat(this.connectionState," state"));x.debug("[".concat(this._clientId,"] publish low stream"));const t=this._configDistribute.getLowStreamConfigDistribute();t&&t.bitrate&&(this._lowStreamParameter||(this._lowStreamParameter={width:160,height:120,framerate:15,bitrate:50}),this._lowStreamParameter&&this._lowStreamParameter.bitrate&&t.bitrate<this._lowStreamParameter.bitrate&&(this._lowStreamParameter.bitrate=t.bitrate));try{const s=await this._p2pChannel.publishLowStream(this._lowStreamParameter),a=(await s.next()).value;if(a){var r;let c;try{c=await this._gateway.publish(this._uid,a,!0)}catch(d){if(d.code!==te.DISCONNECT_P2P)throw s.throw(d),d}s.next(((r=c)===null||r===void 0?void 0:r.ortc)||[]),this._p2pChannel.reportPublishEvent(!0,null,void 0,!0)}}catch(s){if(this._p2pChannel.reportPublishEvent(!1,s==null?void 0:s.code,void 0,!0),(s==null?void 0:s.code)===te.WS_ABORT)return;throw s}}_createLiveStreamingClient(t){const r=()=>{if(!this._joinInfo||!this._appId)return new Pe(te.INVALID_OPERATION,"can not create live streaming client, please join channel first").throw();const s=(a={joinInfo:this._joinInfo,appId:this._appId,websocketRetryConfig:this._config.websocketRetryConfig,httpRetryConfig:this._config.httpRetryConfig},ff("LiveStreaming").create(a));var a;return s.onLiveStreamError=(c,d)=>{At.reportApiInvoke(this._sessionId,{name:di.ON_LIVE_STREAM_ERROR,options:[c,d],tag:$r.TRACER}).onSuccess(),this.safeEmit(Rn.LIVE_STREAMING_ERROR,c,d)},s.onLiveStreamWarning=(c,d)=>{At.reportApiInvoke(this._sessionId,{name:di.ON_LIVE_STREAM_WARNING,options:[c,d],tag:$r.TRACER}).onSuccess(),this.safeEmit(Rn.LIVE_STREAMING_WARNING,c,d)},s.on(D2.REQUEST_WORKER_MANAGER_LIST,(c,d,h)=>{if(!this._joinInfo)return h(new Pe(te.INVALID_OPERATION,"can not find join info to get worker manager"));(async function(m,g,E,b){const I=se("UAP_AP").slice(0,se("AJAX_REQUEST_CONCURRENT")).map(A=>g.proxyServer?"https://".concat(g.proxyServer,"/ap/?url=").concat(A+"/api/v1?action=uap"):"https://".concat(A,"/api/v1?action=uap"));return await u_e(I,m,g,E,b)})(c,this._joinInfo,this._axiosCancelSource.token,Mi).then(d).catch(h)}),s};return t===df.RAW?(this._liveRawStreamingClient=this._liveRawStreamingClient||r(),this._liveRawStreamingClient):(this._liveTranscodeStreamingClient=this._liveTranscodeStreamingClient||r(),this._liveTranscodeStreamingClient)}_createChannelMediaRelayClient(){if(!this._joinInfo)return new Pe(te.INVALID_OPERATION,"can not create channel media relay client, please join channel first").throw();if(!this._channelMediaRelayClient){const{sendResolutionWidth:r,sendResolutionHeight:s}=this.getLocalVideoStats(),a=(t={joinInfo:this._joinInfo,clientId:this._clientId,websocketRetryConfig:this._config.websocketRetryConfig,httpRetryConfig:this._config.httpRetryConfig,resolution:{width:r,height:s}},ff("ChannelMediaRelay").create(t));a.on("state",c=>{c===Ja.RELAY_STATE_FAILURE&&a&&a.dispose(),this.safeEmit(Rn.CHANNEL_MEDIA_RELAY_STATE,c)}),a.on("event",c=>{this.safeEmit(Rn.CHANNEL_MEDIA_RELAY_EVENT,c)}),this._channelMediaRelayClient=a,this._statsCollector.onStatsChanged=(c,d)=>{var h;c==="resolution"&&((h=this._channelMediaRelayClient)===null||h===void 0||h.setVideoProfile(d))}}var t;return this._channelMediaRelayClient}_handleUpdateDataChannel(t,r){const{added:s,deleted:a}=t,c=[];if(r){const d=[];this._users.forEach(h=>{h._dataChannels.forEach(m=>{s.every(g=>g.uid!==h._uintid||g.stream_id!==m.id)&&d.push({uid:h._uintid,stream_id:m.id,ordered:m.ordered,max_retrans_times:m.maxRetransmits,metadata:m.metadata})})}),d.length>0&&this._handleUpdateDataChannel({added:[],deleted:d})}Array.isArray(s)&&s.length>0&&s.forEach(d=>{const{uid:h,stream_id:m,ordered:g,max_retrans_times:E,metadata:b}=d,I=this._users.find(A=>A._uintid===h);if(!I)return void x.error("[".concat(this._clientId,"] can not find target user!(on_add_data_channel)"));if(x.debug("[".concat(this._clientId,"] data_channel added with uid ").concat(h)),rt(c).call(c,I)||c.push(I),I._uintid||(I._uintid=h),I._dataChannels.findIndex(A=>A.id===d.stream_id)===-1){const A={id:m,ordered:!!g,maxRetransmits:E,metadata:b},k=function(W){return UH(W,!0)}(A);I._dataChannels.push(k),x.info("[".concat(this._clientId,"] remote user ").concat(I.uid," published datachannel")),r||this.safeEmit(Rn.USER_PUBLISHED,I,"datachannel",A)}this._p2pChannel.hasPendingRemoteDataChannel(I,d.stream_id)&&(x.debug("[".concat(this._clientId,"] resubscribe datachannel for user ").concat(I.uid," after reconnect.")),this._subscribeDataChannel(I,d.stream_id).catch(A=>{x.error("[".concat(this._clientId,"] resubscribe datachannel error"),A.toString())}))}),r&&(this.safeEmit(Rn.PUBLISHED_USER_LIST,this._pendingPublishedUsers),this._pendingPublishedUsers=[]),Array.isArray(a)&&a.length>0&&a.forEach(d=>{const{uid:h,stream_id:m}=d,g=this._users.find(b=>b._uintid===h);if(!g)return void x.error("[".concat(this._clientId,"] can not find target user!(on_delete_data_channel)"));const E=g._dataChannels.find(b=>b.id===d.stream_id);E&&(x.debug("[".concat(this._clientId,"] data_stream delete with uid ").concat(h)),this._p2pChannel.unsubscribeDataChannel(g,[E]).then(b=>{if(g._dataChannels=g._dataChannels.filter(I=>I!==E),b)return this._gateway.unsubscribeDataChannel(b,g.uid)}),x.info("[".concat(this._clientId,"] remote user ").concat(h," unpublished datachannel ,id:").concat(E.id)),this.safeEmit(Rn.USER_UNPUBLISHED,g,"datachannel",E._config))})}_getEncodingName(t){var r;if(!this._joinResponse)return;const s=(r=this._joinResponse.ortc.rtpCapabilities.sendrecv)===null||r===void 0?void 0:r.videoCodecs;if(s)for(const c of s){var a;if(c.payloadType===t)return c==null||(a=c.rtpMap)===null||a===void 0?void 0:a.encodingName}}_handleRemoveDataChannels(t){const r=this._users.find(s=>s.uid===t.uid);if(r){if(r._dataChannels!==void 0&&r._dataChannels.length>0){x.debug("[".concat(this._clientId,"] datachannel removed with uid ").concat(t.uid));const s=()=>{x.info("[".concat(this._clientId,"] remote user ").concat(r.uid," unpublished datachannel")),r._dataChannels.forEach(a=>{this.safeEmit(Rn.USER_UNPUBLISHED,r,"datachannel",a._config)})};this._p2pChannel.unsubscribeDataChannel(r,r._dataChannels).then(a=>{if(a)return this._gateway.unsubscribeDataChannel(a,r.uid)}),s()}}else x.warning("[".concat(this._clientId,"] can not find target user!(on_remove_datachannel)"))}_handleGatewayEvents(){this._gateway.on(ps.UPDATE_GATEWAY_CONFIG,()=>{(function(){let t;try{t=window.localStorage.getItem("websdk_ng_global_parameter")}catch(r){return void x.error("Error loading sdk config",r.message)}if(t)try{const r=JSON.parse(window.atob(t)),s=Date.now();Object.keys(r).forEach(a=>{const{value:c,type:d,expires:h}=r[a];h&&h<=s||d||R2()||!Object.prototype.hasOwnProperty.call(EP,a)||(Wd[a]=c,zr[a]=c,x.debug("Update gateway parameters from config distribute",a,c))})}catch(r){x.error("Error update config from local cache",r.message)}})()}),this._gateway.on(ps.DISCONNECT_P2P,async()=>{await this._p2pChannel.disconnectForReconnect()}),this._gateway.on(ps.CONNECTION_STATE_CHANGE,(t,r,s)=>{var a;if(s===rr.FALLBACK)return;const c=()=>{this.safeEmit(Rn.CONNECTION_STATE_CHANGE,t,r,s)};if(At.reportApiInvoke(this._sessionId||((a=this._gateway.joinInfo)===null||a===void 0?void 0:a.sid)||null,{name:di.CONNECTION_STATE_CHANGE,options:[t,r,s],tag:$r.TRACER}).onSuccess(JSON.stringify({cur:t,prev:r,reason:s})),x.info("[".concat(this._clientId,"] signal connection state change: ").concat(r," -> ").concat(t)),t==="DISCONNECTED")return this._reset(),void c();if(t==="RECONNECTING")this._users.forEach(h=>{h._trust_in_room_=!1,h._trust_audio_enabled_state_=!1,h._trust_video_enabled_state_=!1,h._trust_audio_mute_state_=!1,h._trust_video_mute_state_=!1,h._trust_audio_stream_added_state_=!1,h._trust_video_stream_added_state_=!1,h._is_pre_created||(h._audio_pre_subscribed||(h._audioSSRC=void 0,h._audioOrtc=void 0),h._video_pre_subscribed||(h._videoSSRC=void 0,h._videoOrtc=void 0,h._rtxSsrcId=void 0),h._cname=void 0)}),this._userOfflineTimeout&&window.clearTimeout(this._userOfflineTimeout),this._streamRemovedTimeout&&window.clearTimeout(this._streamRemovedTimeout),this._userOfflineTimeout=void 0,this._streamRemovedTimeout=void 0;else if(t==="CONNECTED"){var d;this._streamFallbackTypeCacheMap.forEach((h,m)=>{this._gateway.setStreamFallbackOption(m,h).catch(g=>{x.warning("[".concat(this._clientId,"] auto set stream fallback option failed"),g)})}),this._remoteStreamTypeCacheMap.forEach((h,m)=>{this._gateway.setRemoteVideoStreamType(m,h).catch(g=>{x.warning("[".concat(this._clientId,"] auto set remote stream type failed"),g)})}),this._remoteDefaultVideoStreamType!==void 0&&((d=this._joinInfo)===null||d===void 0?void 0:d.defaultVideoStream)===void 0&&this.setRemoteDefaultVideoStreamType(this._remoteDefaultVideoStreamType).then(()=>{x.debug("[".concat(this._clientId,"] setRemoteDefaultVideoStreamType after gateway connected"))}).catch(h=>{x.error("[".concat(this._clientId,"] setRemoteDefaultVideoStreamType after gateway failed, ").concat(h))}),this.store.useP2P||(this._p2pChannel.republish(),this._userOfflineTimeout=window.setTimeout(()=>{this.connectionState==="CONNECTED"&&(this._userOfflineTimeout=void 0,this._users.filter(h=>!h._trust_in_room_).forEach(h=>{x.debug("[".concat(this._clientId,"] user offline timeout, emit user offline ").concat(h.uid)),this._handleUserOffline({uid:h.uid})}))},3e3),this._streamRemovedTimeout=window.setTimeout(()=>{this.connectionState==="CONNECTED"&&(this._streamRemovedTimeout=void 0,this._users.forEach(h=>{h._trust_audio_mute_state_||(x.debug("[".concat(this._clientId,"] auto dispatch audio unmute event ").concat(h.uid)),this._handleMuteStream(h.uid,yt.AUDIO,!1)),h._trust_video_mute_state_||(x.debug("[".concat(this._clientId,"] auto dispatch video unmute event ").concat(h.uid)),this._handleMuteStream(h.uid,yt.VIDEO,!1)),h._trust_audio_enabled_state_||(x.debug("[".concat(this._clientId,"] auto dispatch enable local audio ").concat(h.uid)),this._handleSetStreamLocalEnable("audio",h.uid,!0)),h._trust_video_enabled_state_||(x.debug("[".concat(this._clientId,"] auto dispatch enable local video ").concat(h.uid)),this._handleSetStreamLocalEnable("video",h.uid,!0)),h._trust_video_stream_added_state_||(x.debug("[".concat(this._clientId,"] auto dispatch reset video stream added ").concat(h.uid)),this._handleResetAddStream(h,"video")),h._trust_audio_stream_added_state_||(x.debug("[".concat(this._clientId,"] auto dispatch reset audio stream added ").concat(h.uid)),this._handleResetAddStream(h,"audio")),h._video_added_||h._audio_added_||(x.debug("[".concat(this._clientId,"] auto dispatch stream remove ").concat(h.uid)),this._handleRemoveStream({uid:h.uid,uint_id:h._uintid}))}))},1e3))}c()}),this._gateway.on(ps.REQUEST_NEW_GATEWAY_LIST,async(t,r)=>{if(!this._joinInfo)return r(new Pe(te.UNEXPECTED_ERROR,"can not recover, no join info"));try{let s;const a=await w7(Wu(Wu({},this._joinInfo),{},{uid:this._joinInfo.uid,stringUid:void 0}));a?(s=a.ap,R7(a),this._joinInfo.preload=!0):(s=await Y2(this._joinInfo,this._axiosCancelSource.token,this._config.httpRetryConfig||Mi,this.store),this._joinInfo.preload=!1),this._joinInfo&&(this._joinInfo.apResponse=s.gatewayInfo.res,this._joinInfo.gatewayAddrs=s.gatewayInfo.gatewayAddrs,this._joinInfo.uni_lbs_ip=s.gatewayInfo.uni_lbs_ip);const c=[];s.gatewayInfo.gatewayAddrs.forEach(d=>{let{address:h}=d;const[m,g]=h.split(":");this._joinInfo&&this._joinInfo.proxyServer?c.push({proxy:this._joinInfo.proxyServer,host:m,port:g}):c.push({host:m,port:g})}),t(c)}catch(s){r(s)}}),this._gateway.on(ps.NETWORK_QUALITY,t=>{this._networkQualitySensitivity==="normal"&&this.safeEmit(Rn.NETWORK_QUALITY,t)}),this._gateway.on(ps.STREAM_TYPE_CHANGE,(t,r)=>{this.safeEmit(Rn.STREAM_TYPE_CHANGED,t,r),At.reportApiInvoke(this._sessionId,{name:di.STREAM_TYPE_CHANGE,options:[t,r],tag:$r.TRACER}).onSuccess(JSON.stringify({uid:t,streamType:r}))}),this._gateway.isPreSub=()=>"isPreSub"in this._p2pChannel&&this._p2pChannel.isPreSub(),this._gateway.isPreallocation=()=>"isPreallocation"in this._p2pChannel&&this._p2pChannel.isPreallocation(),this._gateway.on(ps.IS_P2P_DISCONNECTED,t=>{this._p2pChannel.isP2PDisconnected()?t(!0):this._p2pChannel.hasLocalMedia()||this._p2pChannel.hasRemoteMedia()?t(!1):t(!0)}),this._gateway.on(ps.REQUEST_P2P_CONNECTION_PARAMS,async(t,r,s)=>{try{let a=await this._p2pChannel.getEstablishParams();a&&"isPreallocation"in this._p2pChannel&&this._p2pChannel.isPreallocation()||(a=await this._p2pChannel.startP2PConnection(t)),r(a)}catch(a){s(a)}}),this._gateway.on(ps.JOIN_RESPONSE,(t,r)=>{if(this.store.useP2P)return;let s;this._joinResponse=t,t.attributes?s=t.attributes.userAttributes.preSubSsrcs:x.debug("no attributes in joinResponse");const a=CH(t.ortc,r,s);this._p2pChannel.connect(a)}),this._gateway.on(ps.PRE_CONNECT_PC,async t=>{const{candidates:r,fingerprint:s,turnServer:a}=t;if(this._joinInfo&&r.length>0&&!this._p2pChannel.isPlanB){const{cert:d,cid:h}=this._joinInfo.apResponse,m="".concat(h,"_").concat(d);if(m.length<4||m.length>256)return;await this._p2pChannel.startP2PConnection({turnServer:a,cloudProxyServer:this._joinInfo.cloudProxyServer,isPreallocation:!0});try{var c;await this._p2pChannel.connect({iceParameters:{iceUfrag:"".concat(h,"_").concat(d),icePwd:"".concat(h,"_").concat(d)},dtlsParameters:{fingerprints:[{hashFunction:"sha-256",fingerprint:(c=se("FINGERPRINT"))!==null&&c!==void 0?c:s}]},candidates:r,rtpCapabilities:{send:{audioCodecs:[],videoCodecs:[],audioExtensions:[],videoExtensions:[]},recv:{audioCodecs:[],videoCodecs:[],audioExtensions:[],videoExtensions:[]}},setup:"active",cname:"o/i14u9pJrxRKAsu",preallocation:!0})}catch(g){g.code&&g.code===te.EXCHANGE_SDP_FAILED&&await this._p2pChannel.startP2PConnection({turnServer:a,cloudProxyServer:this._joinInfo.cloudProxyServer},!0)}}})}_handleGatewaySignalEvents(){this._gateway.signal.on(An.ON_USER_ONLINE,this._handleUserOnline),this._gateway.signal.on(An.ON_USER_OFFLINE,this._handleUserOffline),this._gateway.signal.on(An.ON_ADD_AUDIO_STREAM,t=>this._handleAddAudioOrVideoStream("audio",t.uid,t.ssrcId,t.cname,t.pt,t.uint_id,t.ortc)),this._gateway.signal.on(An.ON_ADD_VIDEO_STREAM,t=>this._handleAddAudioOrVideoStream("video",t.uid,t.ssrcId,t.cname,t.pt,t.uint_id,t.ortc,t.rtxSsrcId)),this._gateway.signal.on(An.ON_REMOTE_DATASTREAM_UPDATE,t=>{this._handleUpdateDataChannel(t)}),this._gateway.signal.on(An.ON_REMOTE_FULL_DATASTREAM_INFO,t=>{this._handleUpdateDataChannel({added:t.datastreams||[],deleted:[]},!0)}),this._gateway.signal.on(An.ON_REMOVE_STREAM,this._handleRemoveStream),this._gateway.signal.on(An.ON_P2P_LOST,this._handleP2PLost),this._gateway.signal.on(An.MUTE_AUDIO,t=>this._handleMuteStream(t.uid,yt.AUDIO,!0)),this._gateway.signal.on(An.UNMUTE_AUDIO,t=>this._handleMuteStream(t.uid,yt.AUDIO,!1)),this._gateway.signal.on(An.MUTE_VIDEO,t=>this._handleMuteStream(t.uid,yt.VIDEO,!0)),this._gateway.signal.on(An.UNMUTE_VIDEO,t=>this._handleMuteStream(t.uid,yt.VIDEO,!1)),this._gateway.signal.on(An.RECEIVE_METADATA,t=>{const r=ey(t.metadata);this.safeEmit(Rn.RECEIVE_METADATA,t.uid,r)}),this._gateway.signal.on(An.ON_DATA_STREAM,async t=>{var r;if(!t)return;let s=ey(t.payload);if(this._encryptDataStream&&this._encryptDataStreamIv&&this._encryptDataStreamKey&&window.crypto.subtle&&rt(r=["aes-128-gcm2","aes-256-gcm2"]).call(r,this._encryptionMode)){if(t.payload.length<Hv)throw new Pe(te.UNEXPECTED_RESPONSE,"payload length ".concat(t.payload.length," is less than header length ").concat(Hv));s=await async function(d,h,m){const g=m.subarray(0,Hv),E=g.slice(8,Hv),b=(E[0]<<8)+E[1],I=(g[6]<<8)+g[7],A=await window.crypto.subtle.decrypt({name:"AES-GCM",iv:d,tagLength:DW,additionalData:new Uint8Array(vW(b,2))},h,m.subarray(Hv));return new Uint8Array(A).subarray(0,I)}(this._encryptDataStreamIv,this._encryptDataStreamKey,s)}let a=0;if(t.ordered||t.syncWithAudio){const c=this._p2pChannel.getStats(),d=this.remoteUsers.find(m=>m.uid===t.uid),h=c==null?void 0:c.audioRecv.find(m=>m.ssrc===(d==null?void 0:d._audioSSRC));a=h==null?void 0:h.jitterBufferMs}(a==null||Number.isNaN(a))&&(a=0),I_e(Wu(Wu({},t),{},{payload:s}),a,{id:this._clientId,onStreamMessage:typeof this.onStreamMessage=="function"?this.onStreamMessage.bind(this):void 0,safeEmit:this.safeEmit.bind(this)})}),this._gateway.signal.on(An.ON_CRYPT_ERROR,()=>{Wm(()=>{x.warning("[".concat(this._clientId,"] on crypt error")),this.safeEmit(Rn.CRYPT_ERROR)},this._sessionId)}),this._gateway.signal.on(An.ON_TOKEN_PRIVILEGE_WILL_EXPIRE,this._handleTokenWillExpire),this._gateway.signal.on(An.ON_TOKEN_PRIVILEGE_DID_EXPIRE,()=>{x.warning("[".concat(this._clientId,"] received message onTokenPrivilegeDidExpire, please get new token and join again")),this._gateway.leave(!0,rr.TOKEN_EXPIRE),this.safeEmit(Rn.ON_TOKEN_PRIVILEGE_DID_EXPIRE),this._reset()}),this._gateway.signal.on(An.ON_STREAM_FALLBACK_UPDATE,t=>{x.debug("[".concat(this._clientId,"] stream fallback peerId: ").concat(t.stream_id,", attr: ").concat(t.stream_type)),this.safeEmit(Rn.STREAM_FALLBACK,t.stream_id,t.stream_type===1?"fallback":"recover")}),this._gateway.signal.on(An.ON_PUBLISH_STREAM,t=>{this.uid===this._uid&&(this._p2pChannel.reportPublishEvent(!0,null,void 0,!1,JSON.stringify({proxy:t.proxy})),x.info("[".concat(this._clientId,"] on publish stream, ").concat(JSON.stringify(t))))}),this._gateway.signal.on(An.ENABLE_LOCAL_VIDEO,t=>{this._handleSetStreamLocalEnable("video",t.uid,!0)}),this._gateway.signal.on(An.DISABLE_LOCAL_VIDEO,t=>{this._handleSetStreamLocalEnable("video",t.uid,!1)}),this._gateway.signal.on(Jt.REQUEST_TIMEOUT,(t,r)=>{if(this._joinInfo)switch(t){case qt.PUBLISH:{if(!r)return;const c=r.ortc;if(c){var s,a;const d=c.some(g=>{let{stream_type:E}=g;return E===or.Audio}),h=c.some(g=>{let{stream_type:E}=g;return E!==or.Audio}),m=c.some(g=>{let{stream_type:E}=g;return E===or.Screen||E===or.ScreenLow});r.state==="offer"&&At.publish(this._joinInfo.sid,{eventElapse:Zs.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:!1,ec:te.TIMEOUT,audio:d,video:h,p2pid:r.p2p_id,publishRequestid:this.store.pubId,screenshare:m,audioName:d?(s=c.find(g=>{let{stream_type:E}=g;return E===or.Audio}))===null||s===void 0||(s=s.ssrcs[0])===null||s===void 0?void 0:s.ssrcId.toString():void 0,videoName:h?(a=c.find(g=>{let{stream_type:E}=g;return E!==or.Audio}))===null||a===void 0||(a=a.ssrcs[0])===null||a===void 0?void 0:a.ssrcId.toString():void 0})}break}case qt.SUBSCRIBE:r&&At.subscribe(this._joinInfo.sid,{succ:!1,ec:te.TIMEOUT,audio:r.stream_type===yt.AUDIO,video:r.stream_type===yt.VIDEO,peerid:r.stream_id,subscribeRequestid:r.ssrcId,p2pid:this.store.p2pId,eventElapse:Zs.measureFromSubscribeStart(this.store.clientId,r.ssrcId),preSsrc:this._p2pChannel.isPreSubScribe(r.ssrcId)})}}),this._gateway.signal.on(An.ON_P2P_OK,t=>{this.uid,this._uid}),this._gateway.signal.on(An.ON_PUBLISHED_USER_LIST,t=>{if(t==null||!t.users)return;se("BLOCK_LOCAL_CLIENT")&&(t.users=t.users.filter(a=>!ly(a.string_id||a.stream_id,this.channelName)));const r=[],s=[];for(const a of t.users){let c=this._users.find(b=>b._uintid===a.stream_id);c?c._trust_in_room_=!0:(c=new tg(a.string_id||a.stream_id,a.stream_id),this._users.push(c),this.store.firstVideoFrameDecoded(c.uid,{userJoinNotify:Date.now()}),this.getListeners(Rn.PUBLISHED_USER_LIST).length===0&&(x.debug("[".concat(this._clientId,"] user online"),a.stream_id),this.safeEmit(Rn.USER_JOINED,c)));const d=ss.Audio&a.stream_type,h=(ss.Video|ss.LwoVideo)&a.stream_type,m=(65280&a.stream_type)!=0,g=d&&c.hasAudio,E=h&&c.hasVideo;h&&(c._trust_video_stream_added_state_=!0,c._video_added_=!0,c._videoSSRC=a.video_ssrc,c._rtxSsrcId=a.video_rtx),d&&(c._trust_audio_stream_added_state_=!0,c._audio_added_=!0,c._audioSSRC=a.audio_ssrc),d&&!g&&this.getListeners(Rn.PUBLISHED_USER_LIST).length===0&&(x.info("[".concat(this._clientId,"] remote user ").concat(c.uid," published audio")),this.safeEmit(Rn.USER_PUBLISHED,c,"audio")),h&&!E&&this.getListeners(Rn.PUBLISHED_USER_LIST).length===0&&(x.info("[".concat(this._clientId,"] remote user ").concat(c.uid," published video")),this.safeEmit(Rn.USER_PUBLISHED,c,"video")),(d&&!g||h&&!E||m)&&r.push(c),h&&this._p2pChannel.hasPendingRemoteMedia(c,"video")&&s.push({user:c,mediaType:"video"}),d&&this._p2pChannel.hasPendingRemoteMedia(c,"audio")&&s.push({user:c,mediaType:"audio"})}s.length>0&&(x.debug("[".concat(this._clientId,"] RE massSubscribe after reconnect ").concat(s.map(a=>"user: ".concat(a.user.uid,", mediaType: ").concat(a.mediaType)).join("; ")," ")),this.massSubscribe(s).catch(a=>{x.error("[".concat(this._clientId,"] mass resubscribe error"),a.toString())})),this.getListeners(Rn.PUBLISHED_USER_LIST).length>0?se("ENABLE_DATASTREAM_2")?this._pendingPublishedUsers=r:(x.info("[".concat(this._clientId,"] client emit user-list event, users: ").concat(r.map(a=>a.uid).join(", "))),this.safeEmit(Rn.PUBLISHED_USER_LIST,r)):x.info("[".concat(this._clientId,"] client not emit user-list event case there is no user-list listener, users: ").concat(r.map(a=>a.uid).join(", ")))}),this._gateway.signal.on(An.ON_RTP_CAPABILITY_CHANGE,t=>{const{video_codec:r}=t;this._p2pChannel instanceof _T&&this._p2pChannel.updateRemoteRTPCapabilities(r.map(s=>s.toLowerCase()).filter(s=>{var a;return rt(a=Object.keys(eT)).call(a,s)}))})}_handleP2PEvents(){this._gateway.signal.on(An.ON_USER_OFFLINE,()=>{this._p2pChannel.disconnectForReconnect()}),this._gateway.signal.on(Ei.PUBLISH,(t,r,s)=>{const{uid:a}=t;t.forEach(c=>{const{kind:d,ssrcs:h,mid:m,isMuted:g}=c;this._handleP2PAddAudioOrVideoStream(d,a,h[0].ssrcId,m);const E=this._users.find(b=>b.uid===a);return E&&this.store.useP2P?this._p2pChannel.mockSubscribe(E,d,h[0].ssrcId,m).then(()=>{r()}).catch(s):r(),this._handleMuteStream(a,d,!!g)})}),this._gateway.signal.on(Ei.CALL,async(t,r,s)=>{if(this.store.useP2P)try{var a;r(await this._p2pChannel.startP2P({turnServer:(a=this._joinInfo)===null||a===void 0?void 0:a.turnServer},t))}catch(c){s(c)}}),this._gateway.signal.on(Jt.P2P_CONNECTION,async t=>{this.store.useP2P&&(await this._p2pChannel).p2pConnect(t)}),this._gateway.signal.on(Ei.UNPUBLISH,async(t,r,s)=>{if(this.store.useP2P){const{unpubMsg:a,uid:c}=t,d=this._users.find(h=>h.uid===c);if(!d)return x.warning("[".concat(this._clientId,"] can not find remote user, ignore mute event, uid: ").concat(c)),void r();try{a.forEach(async h=>{let{stream_type:m}=h;const g=m===or.Audio?yt.AUDIO:yt.VIDEO;await this._p2pChannel.unsubscribe(d,g),this._handleMuteStream(c,g,!0)}),r()}catch(h){s(h)}}}),this._gateway.signal.on(Ei.CONTROL,async(t,r)=>{const{action:s}=t;switch(s){case qm.MUTE_LOCAL_VIDEO:this._handleMuteStream(r,yt.VIDEO,!0);break;case qm.MUTE_LOCAL_AUDIO:this._handleMuteStream(r,yt.AUDIO,!0);break;case qm.UNMUTE_LOCAL_VIDEO:this._handleP2PAddAudioOrVideoStream("video",r),this._handleMuteStream(r,yt.VIDEO,!1);break;case qm.UNMUTE_LOCAL_AUDIO:this._handleP2PAddAudioOrVideoStream("audio",r),this._handleMuteStream(r,yt.AUDIO,!1)}}),this._gateway.signal.on(Ei.RESTART_ICE,async(t,r,s)=>{if(this.store.useP2P)try{const{direction:a,iceParameter:c}=t;a!==na.SEND_ONLY||c?r(await this._p2pChannel.restartICE(a,c)):(this._p2pChannel.handleDisconnect(a),r())}catch(a){s(a)}}),this._gateway.signal.on(Ei.CANDIDATE,t=>{if(this.store.useP2P){const{candidate:r,direction:s}=t;this._p2pChannel.addRemoteCandidate(r,s)}}),this._p2pChannel.on(Vt.RequestP2PRestartICE,async(t,r,s)=>{try{const{direction:a}=t;r(await this._gateway.sendExtensionMessage(Ei.RESTART_ICE,t,a===na.SEND_ONLY))}catch(a){s(a)}}),this._p2pChannel.on(Vt.LocalCandidate,t=>{this._gateway.sendExtensionMessage(Ei.CANDIDATE,JSON.stringify(t),!0)}),this._p2pChannel.on(Vt.RequestP2PMuteLocal,async(t,r,s)=>{try{await this._gateway.sendExtensionMessage(Ei.CONTROL,t,!0),r()}catch(a){s(a)}}),this._p2pChannel.on(Vt.RequestP2PUnmuteRemote,async(t,r,s)=>{if(this._joinInfo)try{await this._gateway.unmuteRemote(t,this._joinInfo.stringUid||this._joinInfo.uid),r()}catch(a){a.code===te.DISCONNECT_P2P?r():s(a)}else r()}),this._p2pChannel.on(Vt.RequestP2PMuteRemote,async(t,r,s)=>{if(this._joinInfo)try{await this._gateway.muteRemote(t,this._joinInfo.stringUid||this._joinInfo.uid),r()}catch(a){a.code===te.DISCONNECT_P2P?r():s(a)}else r()}),this._p2pChannel.on(Vt.StateChange,(t,r)=>{r===ir.Connected&&this._p2pChannel.republish()})}_handleP2PChannelEvents(){this._p2pChannel.on(Vt.PeerConnectionStateChange,t=>{const r=this._peerConnectionState;t!==r&&(this.safeEmit(Rn.PEERCONNECTION_STATE_CHANGE,t,r),this._peerConnectionState=t)}),this._p2pChannel.on(Vt.RequestMuteLocal,async(t,r,s)=>{if(this._joinInfo)try{await this._gateway.muteLocal(t,this._joinInfo.stringUid||this._joinInfo.uid),r()}catch(a){a.code===te.DISCONNECT_P2P?r():s(a)}else r()}),this._p2pChannel.on(Vt.RequestUnmuteLocal,async(t,r,s)=>{if(this._joinInfo)try{await this._gateway.unmuteLocal(t,this._joinInfo.stringUid||this._joinInfo.uid),r()}catch(a){a.code===te.DISCONNECT_P2P?r():s(a)}else r()}),this._p2pChannel.on(Vt.RequestRePublish,(t,r,s)=>{this.publish(t,!1).then(r).catch(s)}),this._p2pChannel.on(Vt.RequestRePublishDataChannel,(t,r,s)=>{pt.all(t.map(async a=>{const c=await this._p2pChannel.publishDataChannel([a]);try{c.forEach(d=>{this._uid&&this._gateway.publishDataChannel(this._uid,d,!0)})}catch(d){if(d.code!==te.DISCONNECT_P2P)throw d}})).then(r).catch(s)}),this._p2pChannel.on(Vt.RequestReSubscribe,async(t,r,s)=>{try{for(const{user:a,kind:c}of t)c===yt.VIDEO?await this.subscribe(a,"video"):await this.subscribe(a,"audio");r()}catch(a){s(a)}}),this._p2pChannel.on(Vt.RequestUpload,(t,r)=>{this._gateway.upload(t,r)}),this._p2pChannel.on(Vt.RequestUploadStats,t=>{this._gateway.uploadWRTCStats(t)}),this._p2pChannel.on(Vt.MediaReconnectStart,t=>{this.safeEmit(Rn.MEDIA_RECONNECT_START,t)}),this._p2pChannel.on(Vt.MediaReconnectEnd,t=>{this.safeEmit(Rn.MEDIA_RECONNECT_END,t)}),this._p2pChannel.on(Vt.NeedSignalRTT,t=>{t(this._gateway.getSignalRTT())}),this._p2pChannel.on(Vt.RequestRestartICE,async t=>{if(this.store.useP2P)return;const r=await this._p2pChannel.restartICE(t),s=await r.next();if(s.done)return;const a=s.value;let c;try{c=await this._gateway.restartICE({iceParameters:a})}catch(h){return void r.throw(h)}const{iceParameters:d}=function(h){const m=h.iceParameters;return{iceParameters:{iceUfrag:m.iceUfrag,icePwd:m.icePwd}}}(c);await r.next({remoteIceParameters:d})}),this._p2pChannel.on(Vt.RequestReconnect,async()=>{this._gateway.reconnect()}),this._p2pChannel.on(Vt.RequestReconnectPC,async()=>{var t;const{iceParameters:r,dtlsParameters:s,rtpCapabilities:a}=await this._p2pChannel.startP2PConnection({turnServer:(t=this._joinInfo)===null||t===void 0?void 0:t.turnServer}),{gatewayEstablishParams:c,gatewayAddress:d}=await this._gateway.reconnectPC({iceParameters:r,dtlsParameters:s,rtpCapabilities:a}),h=CH(c,d);await this._p2pChannel.connect(h),await this._p2pChannel.republish(),await this._p2pChannel.reSubscribe()}),this._p2pChannel.on(Vt.RequestUnpublishForReconnectPC,async(t,r,s)=>{this._joinInfo&&this._uid!==void 0?(await this._gateway.unpublish(t,this._uid),r()):s()}),this._p2pChannel.on(Vt.P2PLost,()=>{this.safeEmit(Rn.P2P_LOST,this.store.uid)}),this._p2pChannel.on(Vt.UpdateVideoEncoder,t=>{t._encoderConfig&&this._gateway.setVideoProfile(t._encoderConfig)}),this._p2pChannel.on(Vt.ConnectionTypeChange,t=>{this.safeEmit(Rn.IS_USING_CLOUD_PROXY,t)}),this._p2pChannel.on(Vt.RequestLowStreamParameter,t=>{t(this._lowStreamParameter||{width:160,height:120,framerate:15,bitrate:50})}),this._p2pChannel.on(Vt.QueryClientConnectionState,t=>{t(this.connectionState)}),this._p2pChannel.on(Vt.AudioMetadata,t=>{this.safeEmit(Rn.AUDIO_METADATA,t)}),this._p2pChannel.on(Vt.AudioPts,t=>{this.safeEmit(Rn.AUDIO_PTS,Number(t))})}getKeyMetrics(){return this.store.keyMetrics}async enableContentInspect(t){if(!this._joinInfo||this.connectionState!=="CONNECTED")throw new Pe(te.INVALID_OPERATION,"[".concat(this._clientId,"] can not create content inspect, please join channel first"));if(this._inspect)throw new Pe(te.INVALID_OPERATION,"[".concat(this._clientId,"] Inspect content service already in connecting/connected state"));try{const s=(r={config:t},ff("ContentInspect").create(r));this._inspect=s,this.handleVideoInspectEvents(s);const{appId:a,cname:c,sid:d,token:h,uid:m,cid:g,vid:E}=this._joinInfo;await s.init({appId:a,areaCode:"",cname:c,sid:d,token:h,uid:m,cid:g,vid:E?Number(E):0},Mi)}catch(s){throw Array.isArray(s)?s[0]:s}var r}handleVideoInspectEvents(t){t.on(fs.CONNECTION_STATE_CHANGE,(r,s)=>{if(this.safeEmit(Rn.CONTENT_INSPECT_CONNECTION_STATE_CHANGE,r,s),s===Fu.CONNECTED){if(this.connectionState!=="CONNECTED")return void this.safeEmit(Rn.CONTENT_INSPECT_ERROR,new Pe(te.OPERATION_ABORTED,"Content inspect was cancelled because it left the channel"));t.inspectImage()}}),t.on(fs.INSPECT_RESULT,(r,s)=>{var a;if((s==null?void 0:s.code)===te.INVALID_OPERATION&&this.connectionState==="DISCONNECTED")return x.debug("Stop inspect content because that has left channel"),this==null||(a=this._inspect)===null||a===void 0||a.close(),void(this._inspect=void 0);this.safeEmit(Rn.CONTENT_INSPECT_RESULT,r,s)}),t.on(fs.CLIENT_LOCAL_VIDEO_TRACK,r=>{r(this.localTracks.filter(s=>s.trackMediaType==="video")[0])})}async disableContentInspect(){if(!this._inspect)throw new Pe(te.INVALID_OPERATION,"[".concat(this._clientId,"] inspectVideoContent not started"));try{this._inspect.close(),this._inspect=void 0}catch(t){throw Array.isArray(t)?t[0]:t}}async setImageModeration(t,r){if(Bd(t,"enabled"),t){if(!r)throw new Pe(te.INVALID_PARAMS,"config is required");if(F7(r),!this._joinInfo)throw new Pe(te.INVALID_OPERATION,"can not create image moderation, please join channel first");try{if(this._moderation)this._moderation.updateConfig(r);else{const a=(s={config:r},ff("ImageModeration").create(s));this._moderation=a,this.handleImageModerationEvents(a);const{appId:c,cname:d,sid:h,token:m,uid:g,cid:E,vid:b}=this._joinInfo;await a.init({appId:c,areaCode:"",cname:d,sid:h,token:m,uid:g,cid:E,vid:b?Number(b):0},Mi)}}catch(a){throw Array.isArray(a)?a[0]:a}}else{var s;if(!this._moderation)throw new Pe(te.INVALID_OPERATION,"[".concat(this._clientId,"] image moderation not started"));try{this._moderation.close(),this._moderation.removeAllListeners(),this._moderation=void 0}catch(a){throw Array.isArray(a)?a[0]:a}}}handleImageModerationEvents(t){t.on($d.CONNECTION_STATE_CHANGE,(r,s)=>{if(this.safeEmit(Rn.IMAGE_MODERATION_CONNECTION_STATE_CHANGE,r,s),r===Hl.CONNECTED){if(this.connectionState!=="CONNECTED")throw this.setImageModeration(!1),new Pe(te.OPERATION_ABORTED,"Image moderation was cancelled because it left the channel");t.inspectImage()}}),t.on($d.CLIENT_LOCAL_VIDEO_TRACK,r=>{r(this.localTracks.filter(s=>s.trackMediaType==="video")[0])})}setP2PTransport(t){if(function(r){Yi(r,"transport",["default","auto","relay","sd-rtn"])}(t),this.mode!=="p2p")throw new Pe(te.INVALID_OPERATION,"only p2p mode can set p2pTransport");this.store.p2pTransport=t,x.info("[".concat(this._clientId,"] set client p2pTransport to ").concat(t))}getJoinChannelServiceRecords(){return x.debug("getJoinChannelServiceRecords"),this.store.joinChannelServiceRecords}async setPublishAudioFilterEnabled(t){Bd(t,"enabled"),pr("ENABLE_PUBLISH_AUDIO_FILTER",t),this._joinInfo&&await this._gateway.setPublishAudioFilterEnabled(t)}_handleResetAddStream(t,r){switch(r){case"audio":t._audio_added_=!1,t._trust_audio_stream_added_state_=!0;break;case"video":t._video_added_=!1,t._trust_video_stream_added_state_=!0}}},Rt(_t.prototype,"leave",[j7],Object.getOwnPropertyDescriptor(_t.prototype,"leave"),_t.prototype),Rt(_t.prototype,"publish",[B7],Object.getOwnPropertyDescriptor(_t.prototype,"publish"),_t.prototype),Rt(_t.prototype,"unpublish",[z7],Object.getOwnPropertyDescriptor(_t.prototype,"unpublish"),_t.prototype),Rt(_t.prototype,"subscribe",[W7],Object.getOwnPropertyDescriptor(_t.prototype,"subscribe"),_t.prototype),Rt(_t.prototype,"presubscribe",[G7],Object.getOwnPropertyDescriptor(_t.prototype,"presubscribe"),_t.prototype),Rt(_t.prototype,"massSubscribe",[H7],Object.getOwnPropertyDescriptor(_t.prototype,"massSubscribe"),_t.prototype),Rt(_t.prototype,"unsubscribe",[$7],Object.getOwnPropertyDescriptor(_t.prototype,"unsubscribe"),_t.prototype),Rt(_t.prototype,"massUnsubscribe",[K7],Object.getOwnPropertyDescriptor(_t.prototype,"massUnsubscribe"),_t.prototype),Rt(_t.prototype,"setLowStreamParameter",[q7],Object.getOwnPropertyDescriptor(_t.prototype,"setLowStreamParameter"),_t.prototype),Rt(_t.prototype,"enableDualStream",[Y7],Object.getOwnPropertyDescriptor(_t.prototype,"enableDualStream"),_t.prototype),Rt(_t.prototype,"disableDualStream",[X7],Object.getOwnPropertyDescriptor(_t.prototype,"disableDualStream"),_t.prototype),Rt(_t.prototype,"setClientRole",[J7],Object.getOwnPropertyDescriptor(_t.prototype,"setClientRole"),_t.prototype),Rt(_t.prototype,"_setClientRoleOptions",[Q7],Object.getOwnPropertyDescriptor(_t.prototype,"_setClientRoleOptions"),_t.prototype),Rt(_t.prototype,"setProxyServer",[Z7],Object.getOwnPropertyDescriptor(_t.prototype,"setProxyServer"),_t.prototype),Rt(_t.prototype,"setTurnServer",[e$],Object.getOwnPropertyDescriptor(_t.prototype,"setTurnServer"),_t.prototype),Rt(_t.prototype,"setLicense",[t$],Object.getOwnPropertyDescriptor(_t.prototype,"setLicense"),_t.prototype),Rt(_t.prototype,"startProxyServer",[n$],Object.getOwnPropertyDescriptor(_t.prototype,"startProxyServer"),_t.prototype),Rt(_t.prototype,"stopProxyServer",[r$],Object.getOwnPropertyDescriptor(_t.prototype,"stopProxyServer"),_t.prototype),Rt(_t.prototype,"setLocalAccessPointsV2",[i$],Object.getOwnPropertyDescriptor(_t.prototype,"setLocalAccessPointsV2"),_t.prototype),Rt(_t.prototype,"setLocalAccessPoints",[s$],Object.getOwnPropertyDescriptor(_t.prototype,"setLocalAccessPoints"),_t.prototype),Rt(_t.prototype,"setRemoteDefaultVideoStreamType",[o$],Object.getOwnPropertyDescriptor(_t.prototype,"setRemoteDefaultVideoStreamType"),_t.prototype),Rt(_t.prototype,"setRemoteVideoStreamType",[a$],Object.getOwnPropertyDescriptor(_t.prototype,"setRemoteVideoStreamType"),_t.prototype),Rt(_t.prototype,"setStreamFallbackOption",[c$],Object.getOwnPropertyDescriptor(_t.prototype,"setStreamFallbackOption"),_t.prototype),Rt(_t.prototype,"setEncryptionConfig",[l$],Object.getOwnPropertyDescriptor(_t.prototype,"setEncryptionConfig"),_t.prototype),Rt(_t.prototype,"renewToken",[u$],Object.getOwnPropertyDescriptor(_t.prototype,"renewToken"),_t.prototype),Rt(_t.prototype,"enableAudioVolumeIndicator",[d$],Object.getOwnPropertyDescriptor(_t.prototype,"enableAudioVolumeIndicator"),_t.prototype),Rt(_t.prototype,"startLiveStreaming",[h$],Object.getOwnPropertyDescriptor(_t.prototype,"startLiveStreaming"),_t.prototype),Rt(_t.prototype,"setLiveTranscoding",[p$],Object.getOwnPropertyDescriptor(_t.prototype,"setLiveTranscoding"),_t.prototype),Rt(_t.prototype,"stopLiveStreaming",[f$],Object.getOwnPropertyDescriptor(_t.prototype,"stopLiveStreaming"),_t.prototype),Rt(_t.prototype,"startChannelMediaRelay",[m$],Object.getOwnPropertyDescriptor(_t.prototype,"startChannelMediaRelay"),_t.prototype),Rt(_t.prototype,"updateChannelMediaRelay",[g$],Object.getOwnPropertyDescriptor(_t.prototype,"updateChannelMediaRelay"),_t.prototype),Rt(_t.prototype,"stopChannelMediaRelay",[_$],Object.getOwnPropertyDescriptor(_t.prototype,"stopChannelMediaRelay"),_t.prototype),Rt(_t.prototype,"sendCustomReportMessage",[y$],Object.getOwnPropertyDescriptor(_t.prototype,"sendCustomReportMessage"),_t.prototype),Rt(_t.prototype,"pickSVCLayer",[E$],Object.getOwnPropertyDescriptor(_t.prototype,"pickSVCLayer"),_t.prototype),Rt(_t.prototype,"setRTMConfig",[v$],Object.getOwnPropertyDescriptor(_t.prototype,"setRTMConfig"),_t.prototype),Rt(_t.prototype,"enableContentInspect",[S$],Object.getOwnPropertyDescriptor(_t.prototype,"enableContentInspect"),_t.prototype),Rt(_t.prototype,"disableContentInspect",[b$],Object.getOwnPropertyDescriptor(_t.prototype,"disableContentInspect"),_t.prototype),Rt(_t.prototype,"setImageModeration",[w$],Object.getOwnPropertyDescriptor(_t.prototype,"setImageModeration"),_t.prototype),Rt(_t.prototype,"setP2PTransport",[T$],Object.getOwnPropertyDescriptor(_t.prototype,"setP2PTransport"),_t.prototype),Rt(_t.prototype,"getJoinChannelServiceRecords",[C$],Object.getOwnPropertyDescriptor(_t.prototype,"getJoinChannelServiceRecords"),_t.prototype),Rt(_t.prototype,"setPublishAudioFilterEnabled",[R$],Object.getOwnPropertyDescriptor(_t.prototype,"setPublishAudioFilterEnabled"),_t.prototype),_t);class vT{constructor(r,s){Y(this,"id",0),Y(this,"element",void 0),Y(this,"peerPair",void 0),Y(this,"context",void 0),Y(this,"audioPlayerElement",void 0),Y(this,"audioTrack",void 0),vT.count+=1,this.id=vT.count,this.element=r,this.context=s}initPeers(){this.peerPair=[new RTCPeerConnection,new RTCPeerConnection],this.peerPair[1].ontrack=r=>{const s=document.createElement("audio");s.srcObject=new MediaStream([r.track]),s.play(),this.audioPlayerElement=s}}async switchSdp(){if(!this.peerPair)return;const r=async(a,c)=>{const d=c==="offer"?await a.createOffer():await a.createAnswer();return await a.setLocalDescription(d),a.iceGatheringState==="complete"?a.localDescription:new pt(h=>{a.onicegatheringstatechange=()=>{a.iceGatheringState==="complete"&&h(a.localDescription)}})},s=async(a,c)=>await a.setRemoteDescription(c);try{const a=await r(this.peerPair[0],"offer");await s(this.peerPair[1],a);const c=await r(this.peerPair[1],"answer");await s(this.peerPair[0],c)}catch(a){throw new Pe(te.LOCAL_AEC_ERROR,a.toString()).print()}}async getTracksFromMediaElement(r){if(this.audioTrack)return this.audioTrack;let s;try{r instanceof HTMLVideoElement&&(r.captureStream?r.captureStream():r.mozCaptureStream()),s=this.context.createMediaStreamDestination(),this.context.createMediaElementSource(r).connect(s)}catch(c){throw new Pe(te.LOCAL_AEC_ERROR,c.toString()).print()}if(!s)throw new Pe(te.LOCAL_AEC_ERROR,"no dest node when local aec").print();const a=s.stream.getAudioTracks()[0];return this.audioTrack=a,a}getElement(){return this.element}async startEchoCancellation(){this.context.resume(),this.peerPair&&this.close(),this.initPeers();const r=this.element,s=await this.getTracksFromMediaElement(r);this.peerPair&&this.peerPair[0].addTrack(s),await this.switchSdp()}close(){x.debug("close echo cancellation unit, id is",this.id),this.audioPlayerElement&&this.audioPlayerElement.pause(),this.peerPair&&this.peerPair.forEach(r=>{r.close()}),this.peerPair=void 0,this.audioPlayerElement=void 0}}var A$,f1;Y(vT,"count",0);const G_e=window.AudioContext||window.webkitAudioContext,H_e=new(A$=Gt({report:At}),Rt((f1=class{constructor(){Y(this,"units",[]),Y(this,"context",void 0)}processExternalMediaAEC(t){if(!this._doesEnvironmentNeedAEC())return x.debug("the system does not need to process local aec"),-1;this.context||(this.context=new G_e);let r=this.units.find(s=>s&&s.getElement()===t);return r||(r=new vT(t,this.context),this.units.push(r)),r.startEchoCancellation(),x.debug("start processing local audio echo cancellation, id is",r.id),r.id}_doesEnvironmentNeedAEC(){return xn().name!==Hn.SAFARI}}).prototype,"processExternalMediaAEC",[A$],Object.getOwnPropertyDescriptor(f1.prototype,"processExternalMediaAEC"),f1.prototype),f1);function P$(t,r){var s=Object.keys(t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);r&&(a=a.filter(function(c){return Object.getOwnPropertyDescriptor(t,c).enumerable})),s.push.apply(s,a)}return s}function k$(t){for(var r=1;r<arguments.length;r++){var s=arguments[r]!=null?arguments[r]:{};r%2?P$(Object(s),!0).forEach(function(a){Y(t,a,s[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(s)):P$(Object(s)).forEach(function(a){Object.defineProperty(t,a,Object.getOwnPropertyDescriptor(s,a))})}return t}const fM=window||document;function O$(t){let r=arguments.length>1&&arguments[1]!==void 0&&arguments[1];if(!fM)return;const s=Ui._cspEventHandlerPointer;if(s&&r)return void console.error(s,r);const a=c=>{if(!(c&&c.blockedURI&&(Ui.onSecurityPolicyViolation||Ui.getListeners(Yh.SECURITY_POLICY_VIOLATION).length>0)))return;const d=c.blockedURI;se("CSP_DETECTED_HOSTNAME_LIST").some(h=>rt(d).call(d,h))&&(Ui.onSecurityPolicyViolation&&typeof Ui.onSecurityPolicyViolation=="function"&&Ui.onSecurityPolicyViolation(c),Ui.getListeners(Yh.SECURITY_POLICY_VIOLATION).length>0&&Ui.safeEmit(Yh.SECURITY_POLICY_VIOLATION,c))};s&&fM.removeEventListener("securitypolicyviolation",s),(r||t&&typeof t=="function"||Ui.getListeners(Yh.SECURITY_POLICY_VIOLATION).length>0)&&fM.addEventListener("securitypolicyviolation",a),Ui._cspEventHandlerPointer=a}var $_e=N,K_e=p8,N$=RegExp.prototype,q_e=function(t){return t===N$||$_e(N$,t)?K_e(t):t.flags},Oo=l(q_e);function _0(t){let r=t.length;for(;--r>=0;)t[r]=0}const mM=256,D$=286,ST=30,bT=15,gM=new Uint8Array([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0]),m1=new Uint8Array([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13]),Y_e=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7]),x$=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),gf=new Array(576);_0(gf);const wT=new Array(60);_0(wT);const TT=new Array(512);_0(TT);const CT=new Array(256);_0(CT);const _M=new Array(29);_0(_M);const g1=new Array(ST);function yM(t,r,s,a,c){this.static_tree=t,this.extra_bits=r,this.extra_base=s,this.elems=a,this.max_length=c,this.has_stree=t&&t.length}let L$,M$,U$;function EM(t,r){this.dyn_tree=t,this.max_code=0,this.stat_desc=r}_0(g1);const V$=t=>t<256?TT[t]:TT[256+(t>>>7)],RT=(t,r)=>{t.pending_buf[t.pending++]=255&r,t.pending_buf[t.pending++]=r>>>8&255},sl=(t,r,s)=>{t.bi_valid>16-s?(t.bi_buf|=r<<t.bi_valid&65535,RT(t,t.bi_buf),t.bi_buf=r>>16-t.bi_valid,t.bi_valid+=s-16):(t.bi_buf|=r<<t.bi_valid&65535,t.bi_valid+=s)},Qh=(t,r,s)=>{sl(t,s[2*r],s[2*r+1])},F$=(t,r)=>{let s=0;do s|=1&t,t>>>=1,s<<=1;while(--r>0);return s>>>1},j$=(t,r,s)=>{const a=new Array(16);let c,d,h=0;for(c=1;c<=bT;c++)h=h+s[c-1]<<1,a[c]=h;for(d=0;d<=r;d++){let m=t[2*d+1];m!==0&&(t[2*d]=F$(a[m]++,m))}},B$=t=>{let r;for(r=0;r<D$;r++)t.dyn_ltree[2*r]=0;for(r=0;r<ST;r++)t.dyn_dtree[2*r]=0;for(r=0;r<19;r++)t.bl_tree[2*r]=0;t.dyn_ltree[512]=1,t.opt_len=t.static_len=0,t.sym_next=t.matches=0},z$=t=>{t.bi_valid>8?RT(t,t.bi_buf):t.bi_valid>0&&(t.pending_buf[t.pending++]=t.bi_buf),t.bi_buf=0,t.bi_valid=0},W$=(t,r,s,a)=>{const c=2*r,d=2*s;return t[c]<t[d]||t[c]===t[d]&&a[r]<=a[s]},vM=(t,r,s)=>{const a=t.heap[s];let c=s<<1;for(;c<=t.heap_len&&(c<t.heap_len&&W$(r,t.heap[c+1],t.heap[c],t.depth)&&c++,!W$(r,a,t.heap[c],t.depth));)t.heap[s]=t.heap[c],s=c,c<<=1;t.heap[s]=a},G$=(t,r,s)=>{let a,c,d,h,m=0;if(t.sym_next!==0)do a=255&t.pending_buf[t.sym_buf+m++],a+=(255&t.pending_buf[t.sym_buf+m++])<<8,c=t.pending_buf[t.sym_buf+m++],a===0?Qh(t,c,r):(d=CT[c],Qh(t,d+mM+1,r),h=gM[d],h!==0&&(c-=_M[d],sl(t,c,h)),a--,d=V$(a),Qh(t,d,s),h=m1[d],h!==0&&(a-=g1[d],sl(t,a,h)));while(m<t.sym_next);Qh(t,256,r)},SM=(t,r)=>{const s=r.dyn_tree,a=r.stat_desc.static_tree,c=r.stat_desc.has_stree,d=r.stat_desc.elems;let h,m,g,E=-1;for(t.heap_len=0,t.heap_max=573,h=0;h<d;h++)s[2*h]!==0?(t.heap[++t.heap_len]=E=h,t.depth[h]=0):s[2*h+1]=0;for(;t.heap_len<2;)g=t.heap[++t.heap_len]=E<2?++E:0,s[2*g]=1,t.depth[g]=0,t.opt_len--,c&&(t.static_len-=a[2*g+1]);for(r.max_code=E,h=t.heap_len>>1;h>=1;h--)vM(t,s,h);g=d;do h=t.heap[1],t.heap[1]=t.heap[t.heap_len--],vM(t,s,1),m=t.heap[1],t.heap[--t.heap_max]=h,t.heap[--t.heap_max]=m,s[2*g]=s[2*h]+s[2*m],t.depth[g]=(t.depth[h]>=t.depth[m]?t.depth[h]:t.depth[m])+1,s[2*h+1]=s[2*m+1]=g,t.heap[1]=g++,vM(t,s,1);while(t.heap_len>=2);t.heap[--t.heap_max]=t.heap[1],((b,I)=>{const A=I.dyn_tree,k=I.max_code,W=I.stat_desc.static_tree,j=I.stat_desc.has_stree,B=I.stat_desc.extra_bits,ee=I.stat_desc.extra_base,Z=I.stat_desc.max_length;let oe,ye,_e,ue,Ce,Ue,ze=0;for(ue=0;ue<=bT;ue++)b.bl_count[ue]=0;for(A[2*b.heap[b.heap_max]+1]=0,oe=b.heap_max+1;oe<573;oe++)ye=b.heap[oe],ue=A[2*A[2*ye+1]+1]+1,ue>Z&&(ue=Z,ze++),A[2*ye+1]=ue,ye>k||(b.bl_count[ue]++,Ce=0,ye>=ee&&(Ce=B[ye-ee]),Ue=A[2*ye],b.opt_len+=Ue*(ue+Ce),j&&(b.static_len+=Ue*(W[2*ye+1]+Ce)));if(ze!==0){do{for(ue=Z-1;b.bl_count[ue]===0;)ue--;b.bl_count[ue]--,b.bl_count[ue+1]+=2,b.bl_count[Z]--,ze-=2}while(ze>0);for(ue=Z;ue!==0;ue--)for(ye=b.bl_count[ue];ye!==0;)_e=b.heap[--oe],_e>k||(A[2*_e+1]!==ue&&(b.opt_len+=(ue-A[2*_e+1])*A[2*_e],A[2*_e+1]=ue),ye--)}})(t,r),j$(s,E,t.bl_count)},H$=(t,r,s)=>{let a,c,d=-1,h=r[1],m=0,g=7,E=4;for(h===0&&(g=138,E=3),r[2*(s+1)+1]=65535,a=0;a<=s;a++)c=h,h=r[2*(a+1)+1],++m<g&&c===h||(m<E?t.bl_tree[2*c]+=m:c!==0?(c!==d&&t.bl_tree[2*c]++,t.bl_tree[32]++):m<=10?t.bl_tree[34]++:t.bl_tree[36]++,m=0,d=c,h===0?(g=138,E=3):c===h?(g=6,E=3):(g=7,E=4))},$$=(t,r,s)=>{let a,c,d=-1,h=r[1],m=0,g=7,E=4;for(h===0&&(g=138,E=3),a=0;a<=s;a++)if(c=h,h=r[2*(a+1)+1],!(++m<g&&c===h)){if(m<E)do Qh(t,c,t.bl_tree);while(--m!=0);else c!==0?(c!==d&&(Qh(t,c,t.bl_tree),m--),Qh(t,16,t.bl_tree),sl(t,m-3,2)):m<=10?(Qh(t,17,t.bl_tree),sl(t,m-3,3)):(Qh(t,18,t.bl_tree),sl(t,m-11,7));m=0,d=c,h===0?(g=138,E=3):c===h?(g=6,E=3):(g=7,E=4)}};let K$=!1;const q$=(t,r,s,a)=>{sl(t,0+(a?1:0),3),z$(t),RT(t,s),RT(t,~s),s&&t.pending_buf.set(t.window.subarray(r,r+s),t.pending),t.pending+=s};var X_e=t=>{K$||((()=>{let r,s,a,c,d;const h=new Array(16);for(a=0,c=0;c<28;c++)for(_M[c]=a,r=0;r<1<<gM[c];r++)CT[a++]=c;for(CT[a-1]=c,d=0,c=0;c<16;c++)for(g1[c]=d,r=0;r<1<<m1[c];r++)TT[d++]=c;for(d>>=7;c<ST;c++)for(g1[c]=d<<7,r=0;r<1<<m1[c]-7;r++)TT[256+d++]=c;for(s=0;s<=bT;s++)h[s]=0;for(r=0;r<=143;)gf[2*r+1]=8,r++,h[8]++;for(;r<=255;)gf[2*r+1]=9,r++,h[9]++;for(;r<=279;)gf[2*r+1]=7,r++,h[7]++;for(;r<=287;)gf[2*r+1]=8,r++,h[8]++;for(j$(gf,287,h),r=0;r<ST;r++)wT[2*r+1]=5,wT[2*r]=F$(r,5);L$=new yM(gf,gM,257,D$,bT),M$=new yM(wT,m1,0,ST,bT),U$=new yM(new Array(0),Y_e,0,19,7)})(),K$=!0),t.l_desc=new EM(t.dyn_ltree,L$),t.d_desc=new EM(t.dyn_dtree,M$),t.bl_desc=new EM(t.bl_tree,U$),t.bi_buf=0,t.bi_valid=0,B$(t)},J_e=(t,r,s,a)=>{let c,d,h=0;t.level>0?(t.strm.data_type===2&&(t.strm.data_type=(m=>{let g,E=4093624447;for(g=0;g<=31;g++,E>>>=1)if(1&E&&m.dyn_ltree[2*g]!==0)return 0;if(m.dyn_ltree[18]!==0||m.dyn_ltree[20]!==0||m.dyn_ltree[26]!==0)return 1;for(g=32;g<mM;g++)if(m.dyn_ltree[2*g]!==0)return 1;return 0})(t)),SM(t,t.l_desc),SM(t,t.d_desc),h=(m=>{let g;for(H$(m,m.dyn_ltree,m.l_desc.max_code),H$(m,m.dyn_dtree,m.d_desc.max_code),SM(m,m.bl_desc),g=18;g>=3&&m.bl_tree[2*x$[g]+1]===0;g--);return m.opt_len+=3*(g+1)+5+5+4,g})(t),c=t.opt_len+3+7>>>3,d=t.static_len+3+7>>>3,d<=c&&(c=d)):c=d=s+5,s+4<=c&&r!==-1?q$(t,r,s,a):t.strategy===4||d===c?(sl(t,2+(a?1:0),3),G$(t,gf,wT)):(sl(t,4+(a?1:0),3),((m,g,E,b)=>{let I;for(sl(m,g-257,5),sl(m,E-1,5),sl(m,b-4,4),I=0;I<b;I++)sl(m,m.bl_tree[2*x$[I]+1],3);$$(m,m.dyn_ltree,g-1),$$(m,m.dyn_dtree,E-1)})(t,t.l_desc.max_code+1,t.d_desc.max_code+1,h+1),G$(t,t.dyn_ltree,t.dyn_dtree)),B$(t),a&&z$(t)},Q_e=(t,r,s)=>(t.pending_buf[t.sym_buf+t.sym_next++]=r,t.pending_buf[t.sym_buf+t.sym_next++]=r>>8,t.pending_buf[t.sym_buf+t.sym_next++]=s,r===0?t.dyn_ltree[2*s]++:(t.matches++,r--,t.dyn_ltree[2*(CT[s]+mM+1)]++,t.dyn_dtree[2*V$(r)]++),t.sym_next===t.sym_end),Z_e=t=>{sl(t,2,3),Qh(t,256,gf),(r=>{r.bi_valid===16?(RT(r,r.bi_buf),r.bi_buf=0,r.bi_valid=0):r.bi_valid>=8&&(r.pending_buf[r.pending++]=255&r.bi_buf,r.bi_buf>>=8,r.bi_valid-=8)})(t)},eye={_tr_init:X_e,_tr_stored_block:q$,_tr_flush_block:J_e,_tr_tally:Q_e,_tr_align:Z_e},IT=(t,r,s,a)=>{let c=65535&t|0,d=t>>>16&65535|0,h=0;for(;s!==0;){h=s>2e3?2e3:s,s-=h;do c=c+r[a++]|0,d=d+c|0;while(--h);c%=65521,d%=65521}return c|d<<16|0};const tye=new Uint32Array((()=>{let t,r=[];for(var s=0;s<256;s++){t=s;for(var a=0;a<8;a++)t=1&t?3988292384^t>>>1:t>>>1;r[s]=t}return r})());var ia=(t,r,s,a)=>{const c=tye,d=a+s;t^=-1;for(let h=a;h<d;h++)t=t>>>8^c[255&(t^r[h])];return-1^t},my={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"},_1={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_MEM_ERROR:-4,Z_BUF_ERROR:-5,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_UNKNOWN:2,Z_DEFLATED:8};const{_tr_init:nye,_tr_stored_block:bM,_tr_flush_block:rye,_tr_tally:sg,_tr_align:iye}=eye,{Z_NO_FLUSH:og,Z_PARTIAL_FLUSH:sye,Z_FULL_FLUSH:oye,Z_FINISH:Gu,Z_BLOCK:Y$,Z_OK:Ca,Z_STREAM_END:X$,Z_STREAM_ERROR:Zh,Z_DATA_ERROR:aye,Z_BUF_ERROR:wM,Z_DEFAULT_COMPRESSION:cye,Z_FILTERED:lye,Z_HUFFMAN_ONLY:y1,Z_RLE:uye,Z_FIXED:dye,Z_DEFAULT_STRATEGY:hye,Z_UNKNOWN:pye,Z_DEFLATED:E1}=_1,TM=286,fye=30,mye=19,gye=2*TM+1,_ye=15,gy=258,ep=262,y0=42,_y=113,AT=666,yy=(t,r)=>(t.msg=my[r],r),J$=t=>2*t-(t>4?9:0),ag=t=>{let r=t.length;for(;--r>=0;)t[r]=0},yye=t=>{let r,s,a,c=t.w_size;r=t.hash_size,a=r;do s=t.head[--a],t.head[a]=s>=c?s-c:0;while(--r);r=c,a=r;do s=t.prev[--a],t.prev[a]=s>=c?s-c:0;while(--r)};let cg=(t,r,s)=>(r<<t.hash_shift^s)&t.hash_mask;const Kl=t=>{const r=t.state;let s=r.pending;s>t.avail_out&&(s=t.avail_out),s!==0&&(t.output.set(r.pending_buf.subarray(r.pending_out,r.pending_out+s),t.next_out),t.next_out+=s,r.pending_out+=s,t.total_out+=s,t.avail_out-=s,r.pending-=s,r.pending===0&&(r.pending_out=0))},ql=(t,r)=>{rye(t,t.block_start>=0?t.block_start:-1,t.strstart-t.block_start,r),t.block_start=t.strstart,Kl(t.strm)},hi=(t,r)=>{t.pending_buf[t.pending++]=r},PT=(t,r)=>{t.pending_buf[t.pending++]=r>>>8&255,t.pending_buf[t.pending++]=255&r},CM=(t,r,s,a)=>{let c=t.avail_in;return c>a&&(c=a),c===0?0:(t.avail_in-=c,r.set(t.input.subarray(t.next_in,t.next_in+c),s),t.state.wrap===1?t.adler=IT(t.adler,r,c,s):t.state.wrap===2&&(t.adler=ia(t.adler,r,c,s)),t.next_in+=c,t.total_in+=c,c)},Q$=(t,r)=>{let s,a,c=t.max_chain_length,d=t.strstart,h=t.prev_length,m=t.nice_match;const g=t.strstart>t.w_size-ep?t.strstart-(t.w_size-ep):0,E=t.window,b=t.w_mask,I=t.prev,A=t.strstart+gy;let k=E[d+h-1],W=E[d+h];t.prev_length>=t.good_match&&(c>>=2),m>t.lookahead&&(m=t.lookahead);do if(s=r,E[s+h]===W&&E[s+h-1]===k&&E[s]===E[d]&&E[++s]===E[d+1]){d+=2,s++;do;while(E[++d]===E[++s]&&E[++d]===E[++s]&&E[++d]===E[++s]&&E[++d]===E[++s]&&E[++d]===E[++s]&&E[++d]===E[++s]&&E[++d]===E[++s]&&E[++d]===E[++s]&&d<A);if(a=gy-(A-d),d=A-gy,a>h){if(t.match_start=r,h=a,a>=m)break;k=E[d+h-1],W=E[d+h]}}while((r=I[r&b])>g&&--c!=0);return h<=t.lookahead?h:t.lookahead},E0=t=>{const r=t.w_size;let s,a,c;do{if(a=t.window_size-t.lookahead-t.strstart,t.strstart>=r+(r-ep)&&(t.window.set(t.window.subarray(r,r+r-a),0),t.match_start-=r,t.strstart-=r,t.block_start-=r,t.insert>t.strstart&&(t.insert=t.strstart),yye(t),a+=r),t.strm.avail_in===0)break;if(s=CM(t.strm,t.window,t.strstart+t.lookahead,a),t.lookahead+=s,t.lookahead+t.insert>=3)for(c=t.strstart-t.insert,t.ins_h=t.window[c],t.ins_h=cg(t,t.ins_h,t.window[c+1]);t.insert&&(t.ins_h=cg(t,t.ins_h,t.window[c+3-1]),t.prev[c&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=c,c++,t.insert--,!(t.lookahead+t.insert<3)););}while(t.lookahead<ep&&t.strm.avail_in!==0)},Z$=(t,r)=>{let s,a,c,d=t.pending_buf_size-5>t.w_size?t.w_size:t.pending_buf_size-5,h=0,m=t.strm.avail_in;do{if(s=65535,c=t.bi_valid+42>>3,t.strm.avail_out<c||(c=t.strm.avail_out-c,a=t.strstart-t.block_start,s>a+t.strm.avail_in&&(s=a+t.strm.avail_in),s>c&&(s=c),s<d&&(s===0&&r!==Gu||r===og||s!==a+t.strm.avail_in)))break;h=r===Gu&&s===a+t.strm.avail_in?1:0,bM(t,0,0,h),t.pending_buf[t.pending-4]=s,t.pending_buf[t.pending-3]=s>>8,t.pending_buf[t.pending-2]=~s,t.pending_buf[t.pending-1]=~s>>8,Kl(t.strm),a&&(a>s&&(a=s),t.strm.output.set(t.window.subarray(t.block_start,t.block_start+a),t.strm.next_out),t.strm.next_out+=a,t.strm.avail_out-=a,t.strm.total_out+=a,t.block_start+=a,s-=a),s&&(CM(t.strm,t.strm.output,t.strm.next_out,s),t.strm.next_out+=s,t.strm.avail_out-=s,t.strm.total_out+=s)}while(h===0);return m-=t.strm.avail_in,m&&(m>=t.w_size?(t.matches=2,t.window.set(t.strm.input.subarray(t.strm.next_in-t.w_size,t.strm.next_in),0),t.strstart=t.w_size,t.insert=t.strstart):(t.window_size-t.strstart<=m&&(t.strstart-=t.w_size,t.window.set(t.window.subarray(t.w_size,t.w_size+t.strstart),0),t.matches<2&&t.matches++,t.insert>t.strstart&&(t.insert=t.strstart)),t.window.set(t.strm.input.subarray(t.strm.next_in-m,t.strm.next_in),t.strstart),t.strstart+=m,t.insert+=m>t.w_size-t.insert?t.w_size-t.insert:m),t.block_start=t.strstart),t.high_water<t.strstart&&(t.high_water=t.strstart),h?4:r!==og&&r!==Gu&&t.strm.avail_in===0&&t.strstart===t.block_start?2:(c=t.window_size-t.strstart,t.strm.avail_in>c&&t.block_start>=t.w_size&&(t.block_start-=t.w_size,t.strstart-=t.w_size,t.window.set(t.window.subarray(t.w_size,t.w_size+t.strstart),0),t.matches<2&&t.matches++,c+=t.w_size,t.insert>t.strstart&&(t.insert=t.strstart)),c>t.strm.avail_in&&(c=t.strm.avail_in),c&&(CM(t.strm,t.window,t.strstart,c),t.strstart+=c,t.insert+=c>t.w_size-t.insert?t.w_size-t.insert:c),t.high_water<t.strstart&&(t.high_water=t.strstart),c=t.bi_valid+42>>3,c=t.pending_buf_size-c>65535?65535:t.pending_buf_size-c,d=c>t.w_size?t.w_size:c,a=t.strstart-t.block_start,(a>=d||(a||r===Gu)&&r!==og&&t.strm.avail_in===0&&a<=c)&&(s=a>c?c:a,h=r===Gu&&t.strm.avail_in===0&&s===a?1:0,bM(t,t.block_start,s,h),t.block_start+=s,Kl(t.strm)),h?3:1)},RM=(t,r)=>{let s,a;for(;;){if(t.lookahead<ep){if(E0(t),t.lookahead<ep&&r===og)return 1;if(t.lookahead===0)break}if(s=0,t.lookahead>=3&&(t.ins_h=cg(t,t.ins_h,t.window[t.strstart+3-1]),s=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart),s!==0&&t.strstart-s<=t.w_size-ep&&(t.match_length=Q$(t,s)),t.match_length>=3)if(a=sg(t,t.strstart-t.match_start,t.match_length-3),t.lookahead-=t.match_length,t.match_length<=t.max_lazy_match&&t.lookahead>=3){t.match_length--;do t.strstart++,t.ins_h=cg(t,t.ins_h,t.window[t.strstart+3-1]),s=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart;while(--t.match_length!=0);t.strstart++}else t.strstart+=t.match_length,t.match_length=0,t.ins_h=t.window[t.strstart],t.ins_h=cg(t,t.ins_h,t.window[t.strstart+1]);else a=sg(t,0,t.window[t.strstart]),t.lookahead--,t.strstart++;if(a&&(ql(t,!1),t.strm.avail_out===0))return 1}return t.insert=t.strstart<2?t.strstart:2,r===Gu?(ql(t,!0),t.strm.avail_out===0?3:4):t.sym_next&&(ql(t,!1),t.strm.avail_out===0)?1:2},v0=(t,r)=>{let s,a,c;for(;;){if(t.lookahead<ep){if(E0(t),t.lookahead<ep&&r===og)return 1;if(t.lookahead===0)break}if(s=0,t.lookahead>=3&&(t.ins_h=cg(t,t.ins_h,t.window[t.strstart+3-1]),s=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart),t.prev_length=t.match_length,t.prev_match=t.match_start,t.match_length=2,s!==0&&t.prev_length<t.max_lazy_match&&t.strstart-s<=t.w_size-ep&&(t.match_length=Q$(t,s),t.match_length<=5&&(t.strategy===lye||t.match_length===3&&t.strstart-t.match_start>4096)&&(t.match_length=2)),t.prev_length>=3&&t.match_length<=t.prev_length){c=t.strstart+t.lookahead-3,a=sg(t,t.strstart-1-t.prev_match,t.prev_length-3),t.lookahead-=t.prev_length-1,t.prev_length-=2;do++t.strstart<=c&&(t.ins_h=cg(t,t.ins_h,t.window[t.strstart+3-1]),s=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart);while(--t.prev_length!=0);if(t.match_available=0,t.match_length=2,t.strstart++,a&&(ql(t,!1),t.strm.avail_out===0))return 1}else if(t.match_available){if(a=sg(t,0,t.window[t.strstart-1]),a&&ql(t,!1),t.strstart++,t.lookahead--,t.strm.avail_out===0)return 1}else t.match_available=1,t.strstart++,t.lookahead--}return t.match_available&&(a=sg(t,0,t.window[t.strstart-1]),t.match_available=0),t.insert=t.strstart<2?t.strstart:2,r===Gu?(ql(t,!0),t.strm.avail_out===0?3:4):t.sym_next&&(ql(t,!1),t.strm.avail_out===0)?1:2};function tp(t,r,s,a,c){this.good_length=t,this.max_lazy=r,this.nice_length=s,this.max_chain=a,this.func=c}const kT=[new tp(0,0,0,0,Z$),new tp(4,4,8,4,RM),new tp(4,5,16,8,RM),new tp(4,6,32,32,RM),new tp(4,4,16,16,v0),new tp(8,16,32,32,v0),new tp(8,16,128,128,v0),new tp(8,32,128,256,v0),new tp(32,128,258,1024,v0),new tp(32,258,258,4096,v0)];function Eye(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=E1,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new Uint16Array(2*gye),this.dyn_dtree=new Uint16Array(2*(2*fye+1)),this.bl_tree=new Uint16Array(2*(2*mye+1)),ag(this.dyn_ltree),ag(this.dyn_dtree),ag(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new Uint16Array(_ye+1),this.heap=new Uint16Array(2*TM+1),ag(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new Uint16Array(2*TM+1),ag(this.depth),this.sym_buf=0,this.lit_bufsize=0,this.sym_next=0,this.sym_end=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}const OT=t=>{if(!t)return 1;const r=t.state;return!r||r.strm!==t||r.status!==y0&&r.status!==57&&r.status!==69&&r.status!==73&&r.status!==91&&r.status!==103&&r.status!==_y&&r.status!==AT?1:0},eK=t=>{if(OT(t))return yy(t,Zh);t.total_in=t.total_out=0,t.data_type=pye;const r=t.state;return r.pending=0,r.pending_out=0,r.wrap<0&&(r.wrap=-r.wrap),r.status=r.wrap===2?57:r.wrap?y0:_y,t.adler=r.wrap===2?0:1,r.last_flush=-2,nye(r),Ca},tK=t=>{const r=eK(t);return r===Ca&&(s=>{s.window_size=2*s.w_size,ag(s.head),s.max_lazy_match=kT[s.level].max_lazy,s.good_match=kT[s.level].good_length,s.nice_match=kT[s.level].nice_length,s.max_chain_length=kT[s.level].max_chain,s.strstart=0,s.block_start=0,s.lookahead=0,s.insert=0,s.match_length=s.prev_length=2,s.match_available=0,s.ins_h=0})(t.state),r},nK=(t,r,s,a,c,d)=>{if(!t)return Zh;let h=1;if(r===cye&&(r=6),a<0?(h=0,a=-a):a>15&&(h=2,a-=16),c<1||c>9||s!==E1||a<8||a>15||r<0||r>9||d<0||d>dye||a===8&&h!==1)return yy(t,Zh);a===8&&(a=9);const m=new Eye;return t.state=m,m.strm=t,m.status=y0,m.wrap=h,m.gzhead=null,m.w_bits=a,m.w_size=1<<m.w_bits,m.w_mask=m.w_size-1,m.hash_bits=c+7,m.hash_size=1<<m.hash_bits,m.hash_mask=m.hash_size-1,m.hash_shift=~~((m.hash_bits+3-1)/3),m.window=new Uint8Array(2*m.w_size),m.head=new Uint16Array(m.hash_size),m.prev=new Uint16Array(m.w_size),m.lit_bufsize=1<<c+6,m.pending_buf_size=4*m.lit_bufsize,m.pending_buf=new Uint8Array(m.pending_buf_size),m.sym_buf=m.lit_bufsize,m.sym_end=3*(m.lit_bufsize-1),m.level=r,m.strategy=d,m.method=s,tK(t)};var vye=(t,r)=>{if(OT(t)||r>Y$||r<0)return t?yy(t,Zh):Zh;const s=t.state;if(!t.output||t.avail_in!==0&&!t.input||s.status===AT&&r!==Gu)return yy(t,t.avail_out===0?wM:Zh);const a=s.last_flush;if(s.last_flush=r,s.pending!==0){if(Kl(t),t.avail_out===0)return s.last_flush=-1,Ca}else if(t.avail_in===0&&J$(r)<=J$(a)&&r!==Gu)return yy(t,wM);if(s.status===AT&&t.avail_in!==0)return yy(t,wM);if(s.status===y0&&s.wrap===0&&(s.status=_y),s.status===y0){let c=E1+(s.w_bits-8<<4)<<8,d=-1;if(d=s.strategy>=y1||s.level<2?0:s.level<6?1:s.level===6?2:3,c|=d<<6,s.strstart!==0&&(c|=32),c+=31-c%31,PT(s,c),s.strstart!==0&&(PT(s,t.adler>>>16),PT(s,65535&t.adler)),t.adler=1,s.status=_y,Kl(t),s.pending!==0)return s.last_flush=-1,Ca}if(s.status===57){if(t.adler=0,hi(s,31),hi(s,139),hi(s,8),s.gzhead)hi(s,(s.gzhead.text?1:0)+(s.gzhead.hcrc?2:0)+(s.gzhead.extra?4:0)+(s.gzhead.name?8:0)+(s.gzhead.comment?16:0)),hi(s,255&s.gzhead.time),hi(s,s.gzhead.time>>8&255),hi(s,s.gzhead.time>>16&255),hi(s,s.gzhead.time>>24&255),hi(s,s.level===9?2:s.strategy>=y1||s.level<2?4:0),hi(s,255&s.gzhead.os),s.gzhead.extra&&s.gzhead.extra.length&&(hi(s,255&s.gzhead.extra.length),hi(s,s.gzhead.extra.length>>8&255)),s.gzhead.hcrc&&(t.adler=ia(t.adler,s.pending_buf,s.pending,0)),s.gzindex=0,s.status=69;else if(hi(s,0),hi(s,0),hi(s,0),hi(s,0),hi(s,0),hi(s,s.level===9?2:s.strategy>=y1||s.level<2?4:0),hi(s,3),s.status=_y,Kl(t),s.pending!==0)return s.last_flush=-1,Ca}if(s.status===69){if(s.gzhead.extra){let c=s.pending,d=(65535&s.gzhead.extra.length)-s.gzindex;for(;s.pending+d>s.pending_buf_size;){let m=s.pending_buf_size-s.pending;if(s.pending_buf.set(s.gzhead.extra.subarray(s.gzindex,s.gzindex+m),s.pending),s.pending=s.pending_buf_size,s.gzhead.hcrc&&s.pending>c&&(t.adler=ia(t.adler,s.pending_buf,s.pending-c,c)),s.gzindex+=m,Kl(t),s.pending!==0)return s.last_flush=-1,Ca;c=0,d-=m}let h=new Uint8Array(s.gzhead.extra);s.pending_buf.set(h.subarray(s.gzindex,s.gzindex+d),s.pending),s.pending+=d,s.gzhead.hcrc&&s.pending>c&&(t.adler=ia(t.adler,s.pending_buf,s.pending-c,c)),s.gzindex=0}s.status=73}if(s.status===73){if(s.gzhead.name){let c,d=s.pending;do{if(s.pending===s.pending_buf_size){if(s.gzhead.hcrc&&s.pending>d&&(t.adler=ia(t.adler,s.pending_buf,s.pending-d,d)),Kl(t),s.pending!==0)return s.last_flush=-1,Ca;d=0}c=s.gzindex<s.gzhead.name.length?255&s.gzhead.name.charCodeAt(s.gzindex++):0,hi(s,c)}while(c!==0);s.gzhead.hcrc&&s.pending>d&&(t.adler=ia(t.adler,s.pending_buf,s.pending-d,d)),s.gzindex=0}s.status=91}if(s.status===91){if(s.gzhead.comment){let c,d=s.pending;do{if(s.pending===s.pending_buf_size){if(s.gzhead.hcrc&&s.pending>d&&(t.adler=ia(t.adler,s.pending_buf,s.pending-d,d)),Kl(t),s.pending!==0)return s.last_flush=-1,Ca;d=0}c=s.gzindex<s.gzhead.comment.length?255&s.gzhead.comment.charCodeAt(s.gzindex++):0,hi(s,c)}while(c!==0);s.gzhead.hcrc&&s.pending>d&&(t.adler=ia(t.adler,s.pending_buf,s.pending-d,d))}s.status=103}if(s.status===103){if(s.gzhead.hcrc){if(s.pending+2>s.pending_buf_size&&(Kl(t),s.pending!==0))return s.last_flush=-1,Ca;hi(s,255&t.adler),hi(s,t.adler>>8&255),t.adler=0}if(s.status=_y,Kl(t),s.pending!==0)return s.last_flush=-1,Ca}if(t.avail_in!==0||s.lookahead!==0||r!==og&&s.status!==AT){let c=s.level===0?Z$(s,r):s.strategy===y1?((d,h)=>{let m;for(;;){if(d.lookahead===0&&(E0(d),d.lookahead===0)){if(h===og)return 1;break}if(d.match_length=0,m=sg(d,0,d.window[d.strstart]),d.lookahead--,d.strstart++,m&&(ql(d,!1),d.strm.avail_out===0))return 1}return d.insert=0,h===Gu?(ql(d,!0),d.strm.avail_out===0?3:4):d.sym_next&&(ql(d,!1),d.strm.avail_out===0)?1:2})(s,r):s.strategy===uye?((d,h)=>{let m,g,E,b;const I=d.window;for(;;){if(d.lookahead<=gy){if(E0(d),d.lookahead<=gy&&h===og)return 1;if(d.lookahead===0)break}if(d.match_length=0,d.lookahead>=3&&d.strstart>0&&(E=d.strstart-1,g=I[E],g===I[++E]&&g===I[++E]&&g===I[++E])){b=d.strstart+gy;do;while(g===I[++E]&&g===I[++E]&&g===I[++E]&&g===I[++E]&&g===I[++E]&&g===I[++E]&&g===I[++E]&&g===I[++E]&&E<b);d.match_length=gy-(b-E),d.match_length>d.lookahead&&(d.match_length=d.lookahead)}if(d.match_length>=3?(m=sg(d,1,d.match_length-3),d.lookahead-=d.match_length,d.strstart+=d.match_length,d.match_length=0):(m=sg(d,0,d.window[d.strstart]),d.lookahead--,d.strstart++),m&&(ql(d,!1),d.strm.avail_out===0))return 1}return d.insert=0,h===Gu?(ql(d,!0),d.strm.avail_out===0?3:4):d.sym_next&&(ql(d,!1),d.strm.avail_out===0)?1:2})(s,r):kT[s.level].func(s,r);if(c!==3&&c!==4||(s.status=AT),c===1||c===3)return t.avail_out===0&&(s.last_flush=-1),Ca;if(c===2&&(r===sye?iye(s):r!==Y$&&(bM(s,0,0,!1),r===oye&&(ag(s.head),s.lookahead===0&&(s.strstart=0,s.block_start=0,s.insert=0))),Kl(t),t.avail_out===0))return s.last_flush=-1,Ca}return r!==Gu?Ca:s.wrap<=0?X$:(s.wrap===2?(hi(s,255&t.adler),hi(s,t.adler>>8&255),hi(s,t.adler>>16&255),hi(s,t.adler>>24&255),hi(s,255&t.total_in),hi(s,t.total_in>>8&255),hi(s,t.total_in>>16&255),hi(s,t.total_in>>24&255)):(PT(s,t.adler>>>16),PT(s,65535&t.adler)),Kl(t),s.wrap>0&&(s.wrap=-s.wrap),s.pending!==0?Ca:X$)},Sye=(t,r)=>{let s=r.length;if(OT(t))return Zh;const a=t.state,c=a.wrap;if(c===2||c===1&&a.status!==y0||a.lookahead)return Zh;if(c===1&&(t.adler=IT(t.adler,r,s,0)),a.wrap=0,s>=a.w_size){c===0&&(ag(a.head),a.strstart=0,a.block_start=0,a.insert=0);let g=new Uint8Array(a.w_size);g.set(r.subarray(s-a.w_size,s),0),r=g,s=a.w_size}const d=t.avail_in,h=t.next_in,m=t.input;for(t.avail_in=s,t.next_in=0,t.input=r,E0(a);a.lookahead>=3;){let g=a.strstart,E=a.lookahead-2;do a.ins_h=cg(a,a.ins_h,a.window[g+3-1]),a.prev[g&a.w_mask]=a.head[a.ins_h],a.head[a.ins_h]=g,g++;while(--E);a.strstart=g,a.lookahead=2,E0(a)}return a.strstart+=a.lookahead,a.block_start=a.strstart,a.insert=a.lookahead,a.lookahead=0,a.match_length=a.prev_length=2,a.match_available=0,t.next_in=h,t.input=m,t.avail_in=d,a.wrap=c,Ca},NT={deflateInit:(t,r)=>nK(t,r,E1,15,8,hye),deflateInit2:nK,deflateReset:tK,deflateResetKeep:eK,deflateSetHeader:(t,r)=>OT(t)||t.state.wrap!==2?Zh:(t.state.gzhead=r,Ca),deflate:vye,deflateEnd:t=>{if(OT(t))return Zh;const r=t.state.status;return t.state=null,r===_y?yy(t,aye):Ca},deflateSetDictionary:Sye,deflateInfo:"pako deflate (from Nodeca project)"};const bye=(t,r)=>Object.prototype.hasOwnProperty.call(t,r);var v1={assign:function(t){const r=Array.prototype.slice.call(arguments,1);for(;r.length;){const s=r.shift();if(s){if(typeof s!="object")throw new TypeError(s+"must be non-object");for(const a in s)bye(s,a)&&(t[a]=s[a])}}return t},flattenChunks:t=>{let r=0;for(let a=0,c=t.length;a<c;a++)r+=t[a].length;const s=new Uint8Array(r);for(let a=0,c=0,d=t.length;a<d;a++){let h=t[a];s.set(h,c),c+=h.length}return s}};let rK=!0;try{String.fromCharCode.apply(null,new Uint8Array(1))}catch{rK=!1}const DT=new Uint8Array(256);for(let t=0;t<256;t++)DT[t]=t>=252?6:t>=248?5:t>=240?4:t>=224?3:t>=192?2:1;DT[254]=DT[254]=1;var xT={string2buf:t=>{if(typeof TextEncoder=="function"&&TextEncoder.prototype.encode)return new TextEncoder().encode(t);let r,s,a,c,d,h=t.length,m=0;for(c=0;c<h;c++)s=t.charCodeAt(c),(64512&s)==55296&&c+1<h&&(a=t.charCodeAt(c+1),(64512&a)==56320&&(s=65536+(s-55296<<10)+(a-56320),c++)),m+=s<128?1:s<2048?2:s<65536?3:4;for(r=new Uint8Array(m),d=0,c=0;d<m;c++)s=t.charCodeAt(c),(64512&s)==55296&&c+1<h&&(a=t.charCodeAt(c+1),(64512&a)==56320&&(s=65536+(s-55296<<10)+(a-56320),c++)),s<128?r[d++]=s:s<2048?(r[d++]=192|s>>>6,r[d++]=128|63&s):s<65536?(r[d++]=224|s>>>12,r[d++]=128|s>>>6&63,r[d++]=128|63&s):(r[d++]=240|s>>>18,r[d++]=128|s>>>12&63,r[d++]=128|s>>>6&63,r[d++]=128|63&s);return r},buf2string:(t,r)=>{const s=r||t.length;if(typeof TextDecoder=="function"&&TextDecoder.prototype.decode)return new TextDecoder().decode(t.subarray(0,r));let a,c;const d=new Array(2*s);for(c=0,a=0;a<s;){let h=t[a++];if(h<128){d[c++]=h;continue}let m=DT[h];if(m>4)d[c++]=65533,a+=m-1;else{for(h&=m===2?31:m===3?15:7;m>1&&a<s;)h=h<<6|63&t[a++],m--;m>1?d[c++]=65533:h<65536?d[c++]=h:(h-=65536,d[c++]=55296|h>>10&1023,d[c++]=56320|1023&h)}}return((h,m)=>{if(m<65534&&h.subarray&&rK)return String.fromCharCode.apply(null,h.length===m?h:h.subarray(0,m));let g="";for(let E=0;E<m;E++)g+=String.fromCharCode(h[E]);return g})(d,c)},utf8border:(t,r)=>{(r=r||t.length)>t.length&&(r=t.length);let s=r-1;for(;s>=0&&(192&t[s])==128;)s--;return s<0||s===0?r:s+DT[t[s]]>r?s:r}},iK=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0};const sK=Object.prototype.toString,{Z_NO_FLUSH:wye,Z_SYNC_FLUSH:Tye,Z_FULL_FLUSH:Cye,Z_FINISH:Rye,Z_OK:S1,Z_STREAM_END:Iye,Z_DEFAULT_COMPRESSION:Aye,Z_DEFAULT_STRATEGY:Pye,Z_DEFLATED:kye}=_1;function b1(t){this.options=v1.assign({level:Aye,method:kye,chunkSize:16384,windowBits:15,memLevel:8,strategy:Pye},t||{});let r=this.options;r.raw&&r.windowBits>0?r.windowBits=-r.windowBits:r.gzip&&r.windowBits>0&&r.windowBits<16&&(r.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new iK,this.strm.avail_out=0;let s=NT.deflateInit2(this.strm,r.level,r.method,r.windowBits,r.memLevel,r.strategy);if(s!==S1)throw new Error(my[s]);if(r.header&&NT.deflateSetHeader(this.strm,r.header),r.dictionary){let a;if(a=typeof r.dictionary=="string"?xT.string2buf(r.dictionary):sK.call(r.dictionary)==="[object ArrayBuffer]"?new Uint8Array(r.dictionary):r.dictionary,s=NT.deflateSetDictionary(this.strm,a),s!==S1)throw new Error(my[s]);this._dict_set=!0}}function Oye(t,r){const s=new b1(r);if(s.push(t,!0),s.err)throw s.msg||my[s.err];return s.result}b1.prototype.push=function(t,r){const s=this.strm,a=this.options.chunkSize;let c,d;if(this.ended)return!1;for(d=r===~~r?r:r===!0?Rye:wye,typeof t=="string"?s.input=xT.string2buf(t):sK.call(t)==="[object ArrayBuffer]"?s.input=new Uint8Array(t):s.input=t,s.next_in=0,s.avail_in=s.input.length;;)if(s.avail_out===0&&(s.output=new Uint8Array(a),s.next_out=0,s.avail_out=a),(d===Tye||d===Cye)&&s.avail_out<=6)this.onData(s.output.subarray(0,s.next_out)),s.avail_out=0;else{if(c=NT.deflate(s,d),c===Iye)return s.next_out>0&&this.onData(s.output.subarray(0,s.next_out)),c=NT.deflateEnd(this.strm),this.onEnd(c),this.ended=!0,c===S1;if(s.avail_out!==0){if(d>0&&s.next_out>0)this.onData(s.output.subarray(0,s.next_out)),s.avail_out=0;else if(s.avail_in===0)break}else this.onData(s.output)}return!0},b1.prototype.onData=function(t){this.chunks.push(t)},b1.prototype.onEnd=function(t){t===S1&&(this.result=v1.flattenChunks(this.chunks)),this.chunks=[],this.err=t,this.msg=this.strm.msg};var Nye={deflate:Oye};const w1=16209;var Dye=function(t,r){let s,a,c,d,h,m,g,E,b,I,A,k,W,j,B,ee,Z,oe,ye,_e,ue,Ce,Ue,ze;const Je=t.state;s=t.next_in,Ue=t.input,a=s+(t.avail_in-5),c=t.next_out,ze=t.output,d=c-(r-t.avail_out),h=c+(t.avail_out-257),m=Je.dmax,g=Je.wsize,E=Je.whave,b=Je.wnext,I=Je.window,A=Je.hold,k=Je.bits,W=Je.lencode,j=Je.distcode,B=(1<<Je.lenbits)-1,ee=(1<<Je.distbits)-1;e:do{k<15&&(A+=Ue[s++]<<k,k+=8,A+=Ue[s++]<<k,k+=8),Z=W[A&B];t:for(;;){if(oe=Z>>>24,A>>>=oe,k-=oe,oe=Z>>>16&255,oe===0)ze[c++]=65535&Z;else{if(!(16&oe)){if((64&oe)==0){Z=W[(65535&Z)+(A&(1<<oe)-1)];continue t}if(32&oe){Je.mode=16191;break e}t.msg="invalid literal/length code",Je.mode=w1;break e}ye=65535&Z,oe&=15,oe&&(k<oe&&(A+=Ue[s++]<<k,k+=8),ye+=A&(1<<oe)-1,A>>>=oe,k-=oe),k<15&&(A+=Ue[s++]<<k,k+=8,A+=Ue[s++]<<k,k+=8),Z=j[A&ee];n:for(;;){if(oe=Z>>>24,A>>>=oe,k-=oe,oe=Z>>>16&255,!(16&oe)){if((64&oe)==0){Z=j[(65535&Z)+(A&(1<<oe)-1)];continue n}t.msg="invalid distance code",Je.mode=w1;break e}if(_e=65535&Z,oe&=15,k<oe&&(A+=Ue[s++]<<k,k+=8,k<oe&&(A+=Ue[s++]<<k,k+=8)),_e+=A&(1<<oe)-1,_e>m){t.msg="invalid distance too far back",Je.mode=w1;break e}if(A>>>=oe,k-=oe,oe=c-d,_e>oe){if(oe=_e-oe,oe>E&&Je.sane){t.msg="invalid distance too far back",Je.mode=w1;break e}if(ue=0,Ce=I,b===0){if(ue+=g-oe,oe<ye){ye-=oe;do ze[c++]=I[ue++];while(--oe);ue=c-_e,Ce=ze}}else if(b<oe){if(ue+=g+b-oe,oe-=b,oe<ye){ye-=oe;do ze[c++]=I[ue++];while(--oe);if(ue=0,b<ye){oe=b,ye-=oe;do ze[c++]=I[ue++];while(--oe);ue=c-_e,Ce=ze}}}else if(ue+=b-oe,oe<ye){ye-=oe;do ze[c++]=I[ue++];while(--oe);ue=c-_e,Ce=ze}for(;ye>2;)ze[c++]=Ce[ue++],ze[c++]=Ce[ue++],ze[c++]=Ce[ue++],ye-=3;ye&&(ze[c++]=Ce[ue++],ye>1&&(ze[c++]=Ce[ue++]))}else{ue=c-_e;do ze[c++]=ze[ue++],ze[c++]=ze[ue++],ze[c++]=ze[ue++],ye-=3;while(ye>2);ye&&(ze[c++]=ze[ue++],ye>1&&(ze[c++]=ze[ue++]))}break}}break}}while(s<a&&c<h);ye=k>>3,s-=ye,k-=ye<<3,A&=(1<<k)-1,t.next_in=s,t.next_out=c,t.avail_in=s<a?a-s+5:5-(s-a),t.avail_out=c<h?h-c+257:257-(c-h),Je.hold=A,Je.bits=k};const T1=15,xye=new Uint16Array([3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0]),Lye=new Uint8Array([16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78]),Mye=new Uint16Array([1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0]),Uye=new Uint8Array([16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64]);var LT=(t,r,s,a,c,d,h,m)=>{const g=m.bits;let E,b,I,A,k,W,j=0,B=0,ee=0,Z=0,oe=0,ye=0,_e=0,ue=0,Ce=0,Ue=0,ze=null;const Je=new Uint16Array(16),hn=new Uint16Array(16);let vn,Xt,nr,Kn=null;for(j=0;j<=T1;j++)Je[j]=0;for(B=0;B<a;B++)Je[r[s+B]]++;for(oe=g,Z=T1;Z>=1&&Je[Z]===0;Z--);if(oe>Z&&(oe=Z),Z===0)return c[d++]=20971520,c[d++]=20971520,m.bits=1,0;for(ee=1;ee<Z&&Je[ee]===0;ee++);for(oe<ee&&(oe=ee),ue=1,j=1;j<=T1;j++)if(ue<<=1,ue-=Je[j],ue<0)return-1;if(ue>0&&(t===0||Z!==1))return-1;for(hn[1]=0,j=1;j<T1;j++)hn[j+1]=hn[j]+Je[j];for(B=0;B<a;B++)r[s+B]!==0&&(h[hn[r[s+B]]++]=B);if(t===0?(ze=Kn=h,W=20):t===1?(ze=xye,Kn=Lye,W=257):(ze=Mye,Kn=Uye,W=0),Ue=0,B=0,j=ee,k=d,ye=oe,_e=0,I=-1,Ce=1<<oe,A=Ce-1,t===1&&Ce>852||t===2&&Ce>592)return 1;for(;;){vn=j-_e,h[B]+1<W?(Xt=0,nr=h[B]):h[B]>=W?(Xt=Kn[h[B]-W],nr=ze[h[B]-W]):(Xt=96,nr=0),E=1<<j-_e,b=1<<ye,ee=b;do b-=E,c[k+(Ue>>_e)+b]=vn<<24|Xt<<16|nr|0;while(b!==0);for(E=1<<j-1;Ue&E;)E>>=1;if(E!==0?(Ue&=E-1,Ue+=E):Ue=0,B++,--Je[j]==0){if(j===Z)break;j=r[s+h[B]]}if(j>oe&&(Ue&A)!==I){for(_e===0&&(_e=oe),k+=ee,ye=j-_e,ue=1<<ye;ye+_e<Z&&(ue-=Je[ye+_e],!(ue<=0));)ye++,ue<<=1;if(Ce+=1<<ye,t===1&&Ce>852||t===2&&Ce>592)return 1;I=Ue&A,c[I]=oe<<24|ye<<16|k-d|0}}return Ue!==0&&(c[k+Ue]=j-_e<<24|64<<16|0),m.bits=oe,0};const{Z_FINISH:oK,Z_BLOCK:Vye,Z_TREES:C1,Z_OK:Ey,Z_STREAM_END:Fye,Z_NEED_DICT:jye,Z_STREAM_ERROR:Hu,Z_DATA_ERROR:aK,Z_MEM_ERROR:cK,Z_BUF_ERROR:Bye,Z_DEFLATED:lK}=_1,R1=16180,I1=16190,_f=16191,IM=16192,AM=16194,A1=16199,P1=16200,PM=16206,ms=16209,uK=t=>(t>>>24&255)+(t>>>8&65280)+((65280&t)<<8)+((255&t)<<24);function zye(){this.strm=null,this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new Uint16Array(320),this.work=new Uint16Array(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}const vy=t=>{if(!t)return 1;const r=t.state;return!r||r.strm!==t||r.mode<R1||r.mode>16211?1:0},dK=t=>{if(vy(t))return Hu;const r=t.state;return t.total_in=t.total_out=r.total=0,t.msg="",r.wrap&&(t.adler=1&r.wrap),r.mode=R1,r.last=0,r.havedict=0,r.flags=-1,r.dmax=32768,r.head=null,r.hold=0,r.bits=0,r.lencode=r.lendyn=new Int32Array(852),r.distcode=r.distdyn=new Int32Array(592),r.sane=1,r.back=-1,Ey},hK=t=>{if(vy(t))return Hu;const r=t.state;return r.wsize=0,r.whave=0,r.wnext=0,dK(t)},pK=(t,r)=>{let s;if(vy(t))return Hu;const a=t.state;return r<0?(s=0,r=-r):(s=5+(r>>4),r<48&&(r&=15)),r&&(r<8||r>15)?Hu:(a.window!==null&&a.wbits!==r&&(a.window=null),a.wrap=s,a.wbits=r,hK(t))},fK=(t,r)=>{if(!t)return Hu;const s=new zye;t.state=s,s.strm=t,s.window=null,s.mode=R1;const a=pK(t,r);return a!==Ey&&(t.state=null),a};let kM,OM,mK=!0;const Wye=t=>{if(mK){kM=new Int32Array(512),OM=new Int32Array(32);let r=0;for(;r<144;)t.lens[r++]=8;for(;r<256;)t.lens[r++]=9;for(;r<280;)t.lens[r++]=7;for(;r<288;)t.lens[r++]=8;for(LT(1,t.lens,0,288,kM,0,t.work,{bits:9}),r=0;r<32;)t.lens[r++]=5;LT(2,t.lens,0,32,OM,0,t.work,{bits:5}),mK=!1}t.lencode=kM,t.lenbits=9,t.distcode=OM,t.distbits=5},gK=(t,r,s,a)=>{let c;const d=t.state;return d.window===null&&(d.wsize=1<<d.wbits,d.wnext=0,d.whave=0,d.window=new Uint8Array(d.wsize)),a>=d.wsize?(d.window.set(r.subarray(s-d.wsize,s),0),d.wnext=0,d.whave=d.wsize):(c=d.wsize-d.wnext,c>a&&(c=a),d.window.set(r.subarray(s-a,s-a+c),d.wnext),(a-=c)?(d.window.set(r.subarray(s-a,s),0),d.wnext=a,d.whave=d.wsize):(d.wnext+=c,d.wnext===d.wsize&&(d.wnext=0),d.whave<d.wsize&&(d.whave+=c))),0};var Gye=(t,r)=>{let s,a,c,d,h,m,g,E,b,I,A,k,W,j,B,ee,Z,oe,ye,_e,ue,Ce,Ue=0;const ze=new Uint8Array(4);let Je,hn;const vn=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]);if(vy(t)||!t.output||!t.input&&t.avail_in!==0)return Hu;s=t.state,s.mode===_f&&(s.mode=IM),h=t.next_out,c=t.output,g=t.avail_out,d=t.next_in,a=t.input,m=t.avail_in,E=s.hold,b=s.bits,I=m,A=g,Ce=Ey;e:for(;;)switch(s.mode){case R1:if(s.wrap===0){s.mode=IM;break}for(;b<16;){if(m===0)break e;m--,E+=a[d++]<<b,b+=8}if(2&s.wrap&&E===35615){s.wbits===0&&(s.wbits=15),s.check=0,ze[0]=255&E,ze[1]=E>>>8&255,s.check=ia(s.check,ze,2,0),E=0,b=0,s.mode=16181;break}if(s.head&&(s.head.done=!1),!(1&s.wrap)||(((255&E)<<8)+(E>>8))%31){t.msg="incorrect header check",s.mode=ms;break}if((15&E)!==lK){t.msg="unknown compression method",s.mode=ms;break}if(E>>>=4,b-=4,ue=8+(15&E),s.wbits===0&&(s.wbits=ue),ue>15||ue>s.wbits){t.msg="invalid window size",s.mode=ms;break}s.dmax=1<<s.wbits,s.flags=0,t.adler=s.check=1,s.mode=512&E?16189:_f,E=0,b=0;break;case 16181:for(;b<16;){if(m===0)break e;m--,E+=a[d++]<<b,b+=8}if(s.flags=E,(255&Oo(s))!==lK){t.msg="unknown compression method",s.mode=ms;break}if(57344&Oo(s)){t.msg="unknown header flags set",s.mode=ms;break}s.head&&(s.head.text=E>>8&1),512&Oo(s)&&4&s.wrap&&(ze[0]=255&E,ze[1]=E>>>8&255,s.check=ia(s.check,ze,2,0)),E=0,b=0,s.mode=16182;case 16182:for(;b<32;){if(m===0)break e;m--,E+=a[d++]<<b,b+=8}s.head&&(s.head.time=E),512&Oo(s)&&4&s.wrap&&(ze[0]=255&E,ze[1]=E>>>8&255,ze[2]=E>>>16&255,ze[3]=E>>>24&255,s.check=ia(s.check,ze,4,0)),E=0,b=0,s.mode=16183;case 16183:for(;b<16;){if(m===0)break e;m--,E+=a[d++]<<b,b+=8}s.head&&(s.head.xflags=255&E,s.head.os=E>>8),512&Oo(s)&&4&s.wrap&&(ze[0]=255&E,ze[1]=E>>>8&255,s.check=ia(s.check,ze,2,0)),E=0,b=0,s.mode=16184;case 16184:if(1024&Oo(s)){for(;b<16;){if(m===0)break e;m--,E+=a[d++]<<b,b+=8}s.length=E,s.head&&(s.head.extra_len=E),512&Oo(s)&&4&s.wrap&&(ze[0]=255&E,ze[1]=E>>>8&255,s.check=ia(s.check,ze,2,0)),E=0,b=0}else s.head&&(s.head.extra=null);s.mode=16185;case 16185:if(1024&Oo(s)&&(k=s.length,k>m&&(k=m),k&&(s.head&&(ue=s.head.extra_len-s.length,s.head.extra||(s.head.extra=new Uint8Array(s.head.extra_len)),s.head.extra.set(a.subarray(d,d+k),ue)),512&Oo(s)&&4&s.wrap&&(s.check=ia(s.check,a,k,d)),m-=k,d+=k,s.length-=k),s.length))break e;s.length=0,s.mode=16186;case 16186:if(2048&Oo(s)){if(m===0)break e;k=0;do ue=a[d+k++],s.head&&ue&&s.length<65536&&(s.head.name+=String.fromCharCode(ue));while(ue&&k<m);if(512&Oo(s)&&4&s.wrap&&(s.check=ia(s.check,a,k,d)),m-=k,d+=k,ue)break e}else s.head&&(s.head.name=null);s.length=0,s.mode=16187;case 16187:if(4096&Oo(s)){if(m===0)break e;k=0;do ue=a[d+k++],s.head&&ue&&s.length<65536&&(s.head.comment+=String.fromCharCode(ue));while(ue&&k<m);if(512&Oo(s)&&4&s.wrap&&(s.check=ia(s.check,a,k,d)),m-=k,d+=k,ue)break e}else s.head&&(s.head.comment=null);s.mode=16188;case 16188:if(512&Oo(s)){for(;b<16;){if(m===0)break e;m--,E+=a[d++]<<b,b+=8}if(4&s.wrap&&E!==(65535&s.check)){t.msg="header crc mismatch",s.mode=ms;break}E=0,b=0}s.head&&(s.head.hcrc=Oo(s)>>9&1,s.head.done=!0),t.adler=s.check=0,s.mode=_f;break;case 16189:for(;b<32;){if(m===0)break e;m--,E+=a[d++]<<b,b+=8}t.adler=s.check=uK(E),E=0,b=0,s.mode=I1;case I1:if(s.havedict===0)return t.next_out=h,t.avail_out=g,t.next_in=d,t.avail_in=m,s.hold=E,s.bits=b,jye;t.adler=s.check=1,s.mode=_f;case _f:if(r===Vye||r===C1)break e;case IM:if(s.last){E>>>=7&b,b-=7&b,s.mode=PM;break}for(;b<3;){if(m===0)break e;m--,E+=a[d++]<<b,b+=8}switch(s.last=1&E,E>>>=1,b-=1,3&E){case 0:s.mode=16193;break;case 1:if(Wye(s),s.mode=A1,r===C1){E>>>=2,b-=2;break e}break;case 2:s.mode=16196;break;case 3:t.msg="invalid block type",s.mode=ms}E>>>=2,b-=2;break;case 16193:for(E>>>=7&b,b-=7&b;b<32;){if(m===0)break e;m--,E+=a[d++]<<b,b+=8}if((65535&E)!=(E>>>16^65535)){t.msg="invalid stored block lengths",s.mode=ms;break}if(s.length=65535&E,E=0,b=0,s.mode=AM,r===C1)break e;case AM:s.mode=16195;case 16195:if(k=s.length,k){if(k>m&&(k=m),k>g&&(k=g),k===0)break e;c.set(a.subarray(d,d+k),h),m-=k,d+=k,g-=k,h+=k,s.length-=k;break}s.mode=_f;break;case 16196:for(;b<14;){if(m===0)break e;m--,E+=a[d++]<<b,b+=8}if(s.nlen=257+(31&E),E>>>=5,b-=5,s.ndist=1+(31&E),E>>>=5,b-=5,s.ncode=4+(15&E),E>>>=4,b-=4,s.nlen>286||s.ndist>30){t.msg="too many length or distance symbols",s.mode=ms;break}s.have=0,s.mode=16197;case 16197:for(;s.have<s.ncode;){for(;b<3;){if(m===0)break e;m--,E+=a[d++]<<b,b+=8}s.lens[vn[s.have++]]=7&E,E>>>=3,b-=3}for(;s.have<19;)s.lens[vn[s.have++]]=0;if(s.lencode=s.lendyn,s.lenbits=7,Je={bits:s.lenbits},Ce=LT(0,s.lens,0,19,s.lencode,0,s.work,Je),s.lenbits=Je.bits,Ce){t.msg="invalid code lengths set",s.mode=ms;break}s.have=0,s.mode=16198;case 16198:for(;s.have<s.nlen+s.ndist;){for(;Ue=s.lencode[E&(1<<s.lenbits)-1],B=Ue>>>24,ee=Ue>>>16&255,Z=65535&Ue,!(B<=b);){if(m===0)break e;m--,E+=a[d++]<<b,b+=8}if(Z<16)E>>>=B,b-=B,s.lens[s.have++]=Z;else{if(Z===16){for(hn=B+2;b<hn;){if(m===0)break e;m--,E+=a[d++]<<b,b+=8}if(E>>>=B,b-=B,s.have===0){t.msg="invalid bit length repeat",s.mode=ms;break}ue=s.lens[s.have-1],k=3+(3&E),E>>>=2,b-=2}else if(Z===17){for(hn=B+3;b<hn;){if(m===0)break e;m--,E+=a[d++]<<b,b+=8}E>>>=B,b-=B,ue=0,k=3+(7&E),E>>>=3,b-=3}else{for(hn=B+7;b<hn;){if(m===0)break e;m--,E+=a[d++]<<b,b+=8}E>>>=B,b-=B,ue=0,k=11+(127&E),E>>>=7,b-=7}if(s.have+k>s.nlen+s.ndist){t.msg="invalid bit length repeat",s.mode=ms;break}for(;k--;)s.lens[s.have++]=ue}}if(s.mode===ms)break;if(s.lens[256]===0){t.msg="invalid code -- missing end-of-block",s.mode=ms;break}if(s.lenbits=9,Je={bits:s.lenbits},Ce=LT(1,s.lens,0,s.nlen,s.lencode,0,s.work,Je),s.lenbits=Je.bits,Ce){t.msg="invalid literal/lengths set",s.mode=ms;break}if(s.distbits=6,s.distcode=s.distdyn,Je={bits:s.distbits},Ce=LT(2,s.lens,s.nlen,s.ndist,s.distcode,0,s.work,Je),s.distbits=Je.bits,Ce){t.msg="invalid distances set",s.mode=ms;break}if(s.mode=A1,r===C1)break e;case A1:s.mode=P1;case P1:if(m>=6&&g>=258){t.next_out=h,t.avail_out=g,t.next_in=d,t.avail_in=m,s.hold=E,s.bits=b,Dye(t,A),h=t.next_out,c=t.output,g=t.avail_out,d=t.next_in,a=t.input,m=t.avail_in,E=s.hold,b=s.bits,s.mode===_f&&(s.back=-1);break}for(s.back=0;Ue=s.lencode[E&(1<<s.lenbits)-1],B=Ue>>>24,ee=Ue>>>16&255,Z=65535&Ue,!(B<=b);){if(m===0)break e;m--,E+=a[d++]<<b,b+=8}if(ee&&(240&ee)==0){for(oe=B,ye=ee,_e=Z;Ue=s.lencode[_e+((E&(1<<oe+ye)-1)>>oe)],B=Ue>>>24,ee=Ue>>>16&255,Z=65535&Ue,!(oe+B<=b);){if(m===0)break e;m--,E+=a[d++]<<b,b+=8}E>>>=oe,b-=oe,s.back+=oe}if(E>>>=B,b-=B,s.back+=B,s.length=Z,ee===0){s.mode=16205;break}if(32&ee){s.back=-1,s.mode=_f;break}if(64&ee){t.msg="invalid literal/length code",s.mode=ms;break}s.extra=15&ee,s.mode=16201;case 16201:if(s.extra){for(hn=s.extra;b<hn;){if(m===0)break e;m--,E+=a[d++]<<b,b+=8}s.length+=E&(1<<s.extra)-1,E>>>=s.extra,b-=s.extra,s.back+=s.extra}s.was=s.length,s.mode=16202;case 16202:for(;Ue=s.distcode[E&(1<<s.distbits)-1],B=Ue>>>24,ee=Ue>>>16&255,Z=65535&Ue,!(B<=b);){if(m===0)break e;m--,E+=a[d++]<<b,b+=8}if((240&ee)==0){for(oe=B,ye=ee,_e=Z;Ue=s.distcode[_e+((E&(1<<oe+ye)-1)>>oe)],B=Ue>>>24,ee=Ue>>>16&255,Z=65535&Ue,!(oe+B<=b);){if(m===0)break e;m--,E+=a[d++]<<b,b+=8}E>>>=oe,b-=oe,s.back+=oe}if(E>>>=B,b-=B,s.back+=B,64&ee){t.msg="invalid distance code",s.mode=ms;break}s.offset=Z,s.extra=15&ee,s.mode=16203;case 16203:if(s.extra){for(hn=s.extra;b<hn;){if(m===0)break e;m--,E+=a[d++]<<b,b+=8}s.offset+=E&(1<<s.extra)-1,E>>>=s.extra,b-=s.extra,s.back+=s.extra}if(s.offset>s.dmax){t.msg="invalid distance too far back",s.mode=ms;break}s.mode=16204;case 16204:if(g===0)break e;if(k=A-g,s.offset>k){if(k=s.offset-k,k>s.whave&&s.sane){t.msg="invalid distance too far back",s.mode=ms;break}k>s.wnext?(k-=s.wnext,W=s.wsize-k):W=s.wnext-k,k>s.length&&(k=s.length),j=s.window}else j=c,W=h-s.offset,k=s.length;k>g&&(k=g),g-=k,s.length-=k;do c[h++]=j[W++];while(--k);s.length===0&&(s.mode=P1);break;case 16205:if(g===0)break e;c[h++]=s.length,g--,s.mode=P1;break;case PM:if(s.wrap){for(;b<32;){if(m===0)break e;m--,E|=a[d++]<<b,b+=8}if(A-=g,t.total_out+=A,s.total+=A,4&s.wrap&&A&&(t.adler=s.check=Oo(s)?ia(s.check,c,A,h-A):IT(s.check,c,A,h-A)),A=g,4&s.wrap&&(Oo(s)?E:uK(E))!==s.check){t.msg="incorrect data check",s.mode=ms;break}E=0,b=0}s.mode=16207;case 16207:if(s.wrap&&Oo(s)){for(;b<32;){if(m===0)break e;m--,E+=a[d++]<<b,b+=8}if(4&s.wrap&&E!==(4294967295&s.total)){t.msg="incorrect length check",s.mode=ms;break}E=0,b=0}s.mode=16208;case 16208:Ce=Fye;break e;case ms:Ce=aK;break e;case 16210:return cK;default:return Hu}return t.next_out=h,t.avail_out=g,t.next_in=d,t.avail_in=m,s.hold=E,s.bits=b,(s.wsize||A!==t.avail_out&&s.mode<ms&&(s.mode<PM||r!==oK))&&gK(t,t.output,t.next_out,A-t.avail_out),I-=t.avail_in,A-=t.avail_out,t.total_in+=I,t.total_out+=A,s.total+=A,4&s.wrap&&A&&(t.adler=s.check=Oo(s)?ia(s.check,c,A,t.next_out-A):IT(s.check,c,A,t.next_out-A)),t.data_type=s.bits+(s.last?64:0)+(s.mode===_f?128:0)+(s.mode===A1||s.mode===AM?256:0),(I===0&&A===0||r===oK)&&Ce===Ey&&(Ce=Bye),Ce},yf={inflateReset:hK,inflateReset2:pK,inflateResetKeep:dK,inflateInit:t=>fK(t,15),inflateInit2:fK,inflate:Gye,inflateEnd:t=>{if(vy(t))return Hu;let r=t.state;return r.window&&(r.window=null),t.state=null,Ey},inflateGetHeader:(t,r)=>{if(vy(t))return Hu;const s=t.state;return(2&s.wrap)==0?Hu:(s.head=r,r.done=!1,Ey)},inflateSetDictionary:(t,r)=>{const s=r.length;let a,c,d;return vy(t)?Hu:(a=t.state,a.wrap!==0&&a.mode!==I1?Hu:a.mode===I1&&(c=1,c=IT(c,r,s,0),c!==a.check)?aK:(d=gK(t,r,s,s),d?(a.mode=16210,cK):(a.havedict=1,Ey)))},inflateInfo:"pako inflate (from Nodeca project)"},Hye=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1};const _K=Object.prototype.toString,{Z_NO_FLUSH:$ye,Z_FINISH:Kye,Z_OK:MT,Z_STREAM_END:NM,Z_NEED_DICT:DM,Z_STREAM_ERROR:qye,Z_DATA_ERROR:yK,Z_MEM_ERROR:Yye}=_1;function k1(t){this.options=v1.assign({chunkSize:65536,windowBits:15,to:""},t||{});const r=this.options;r.raw&&r.windowBits>=0&&r.windowBits<16&&(r.windowBits=-r.windowBits,r.windowBits===0&&(r.windowBits=-15)),!(r.windowBits>=0&&r.windowBits<16)||t&&t.windowBits||(r.windowBits+=32),r.windowBits>15&&r.windowBits<48&&(15&r.windowBits)==0&&(r.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new iK,this.strm.avail_out=0;let s=yf.inflateInit2(this.strm,r.windowBits);if(s!==MT)throw new Error(my[s]);if(this.header=new Hye,yf.inflateGetHeader(this.strm,this.header),r.dictionary&&(typeof r.dictionary=="string"?r.dictionary=xT.string2buf(r.dictionary):_K.call(r.dictionary)==="[object ArrayBuffer]"&&(r.dictionary=new Uint8Array(r.dictionary)),r.raw&&(s=yf.inflateSetDictionary(this.strm,r.dictionary),s!==MT)))throw new Error(my[s])}function Xye(t,r){const s=new k1(r);if(s.push(t),s.err)throw s.msg||my[s.err];return s.result}k1.prototype.push=function(t,r){const s=this.strm,a=this.options.chunkSize,c=this.options.dictionary;let d,h,m;if(this.ended)return!1;for(h=r===~~r?r:r===!0?Kye:$ye,_K.call(t)==="[object ArrayBuffer]"?s.input=new Uint8Array(t):s.input=t,s.next_in=0,s.avail_in=s.input.length;;){for(s.avail_out===0&&(s.output=new Uint8Array(a),s.next_out=0,s.avail_out=a),d=yf.inflate(s,h),d===DM&&c&&(d=yf.inflateSetDictionary(s,c),d===MT?d=yf.inflate(s,h):d===yK&&(d=DM));s.avail_in>0&&d===NM&&s.state.wrap>0&&t[s.next_in]!==0;)yf.inflateReset(s),d=yf.inflate(s,h);switch(d){case qye:case yK:case DM:case Yye:return this.onEnd(d),this.ended=!0,!1}if(m=s.avail_out,s.next_out&&(s.avail_out===0||d===NM))if(this.options.to==="string"){let g=xT.utf8border(s.output,s.next_out),E=s.next_out-g,b=xT.buf2string(s.output,g);s.next_out=E,s.avail_out=a-E,E&&s.output.set(s.output.subarray(g,g+E),0),this.onData(b)}else this.onData(s.output.length===s.next_out?s.output:s.output.subarray(0,s.next_out));if(d!==MT||m!==0){if(d===NM)return d=yf.inflateEnd(this.strm),this.onEnd(d),this.ended=!0,!0;if(s.avail_in===0)break}}return!0},k1.prototype.onData=function(t){this.chunks.push(t)},k1.prototype.onEnd=function(t){t===MT&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=v1.flattenChunks(this.chunks)),this.chunks=[],this.err=t,this.msg=this.strm.msg};var Jye={inflate:Xye};const{deflate:Qye}=Nye,{inflate:Zye}=Jye;var eEe=Qye,tEe=Zye,EK=function(t){return t[t.ONE_BYTE=0]="ONE_BYTE",t[t.TWO_BYTE=1]="TWO_BYTE",t}(EK||{});class nEe{constructor(){Y(this,"_sequence",0),Y(this,"_startTime",Date.now()),Y(this,"isUseOneByte",!0)}get startTime(){const r=Date.now()-this._startTime;return r<Math.pow(2,16)?r:(this._startTime+=Math.pow(2,16),this.startTime)}get sequence(){return this._sequence<Math.pow(2,32)?this._sequence++:(this._sequence-=Math.pow(2,32),this.sequence)}serialize(r){const s={commonPacketHeader:{length:0,reserved:0,extension:0,sequence:this.sequence},commonStreamHeader:this.startTime,extension:void 0,payload:r};if(r.byteLength>128){const m=new Uint8Array(4);m.set([1,0,0,0]);const g={id:0,length:4,data:m.buffer},E={profile:this.isUseOneByte?0:1,length:this.isUseOneByte?5:6,datas:[g]};s.commonPacketHeader.extension=1,s.extension=E,s.payload=this.compress(r),s.commonPacketHeader.length=8+(s.extension.length+2)+s.payload.byteLength}else s.commonPacketHeader.length=8+s.payload.byteLength;se("SHOW_DATASTREAM2_LOG")&&x.debug("send data header: ".concat(JSON.stringify(s.commonPacketHeader)));const a=new ArrayBuffer(s.commonPacketHeader.length),c=new Uint8Array(a),d=new DataView(a);let h=0;if(d.setUint16(h,s.commonPacketHeader.extension<<15|s.commonPacketHeader.reserved<<14|s.commonPacketHeader.length,!0),h+=2,d.setUint32(h,s.commonPacketHeader.sequence,!0),h+=4,d.setUint16(h,s.commonStreamHeader,!0),h+=2,s.extension){const m=this.serializeExtension(s.extension);c.set(new Uint8Array(m),h),h+=m.byteLength}if(c.set(new Uint8Array(s.payload),h),h+=s.payload.byteLength,h!==s.commonPacketHeader.length)throw Error("serialize error!");return a}deserialize(r){if(r.byteLength<4)return new ArrayBuffer(0);const s=new DataView(r);let a=0;const c=s.getUint16(a,!0);a+=2;const d={length:16383&c,reserved:(16384&c)>>14,extension:(32768&c)>>15,sequence:s.getUint16(a+2,!0)<<16|s.getUint16(a,!0)};let h,m;if(a+=4,se("SHOW_DATASTREAM2_LOG")&&x.debug("receive data header: ".concat(JSON.stringify(d))),s.getUint16(a,!0),a+=2,d.extension){m=this.deserializeExtension(r.slice(a)),a+=2+m.length,h=r.slice(a);let g=!1;if(m.datas.length>0){const E=m.datas.find(b=>b.id===0);E&&(g=(1&new DataView(E.data).getUint32(0,!0))==1)}h=g?this.decompress(h):h}else h=r.slice(8);return h}serializeExtension(r){const{profile:s,length:a,datas:c}=r,d=new ArrayBuffer(a+2),h=new Uint8Array(d),m=new DataView(d);let g=0;if(m.setUint8(g++,s),m.setUint8(g++,a),c.forEach(E=>{s?(m.setUint8(g++,E.id),m.setUint8(g++,E.length),h.set(new Uint8Array(E.data),g),g+=E.data.byteLength):(m.setUint8(g++,E.id|E.length<<4),h.set(new Uint8Array(E.data),g),g+=E.data.byteLength)}),g!==a+2)throw Error("serialize extension error, is ".concat(g,"!==").concat(a+2));return d}deserializeExtension(r){const s=new DataView(r);let a=0;const c=s.getUint8(a);a++;const d=s.getUint8(a);a++;const h=c===EK.TWO_BYTE,m=[],g=new DataView(r,2);let E=0;for(;E<d;){let b=0,I=0,A=new ArrayBuffer(0);h?(b=g.getUint8(E),E++,I=g.getUint8(E),E++):(b=15&g.getUint8(E),I=g.getUint8(E)>>4,E++),I>0&&(A=g.buffer.slice(E+2,E+2+I),E+=A.byteLength),m.push({id:b,length:I,data:A})}if(E!==d)throw Error("parse error");return{profile:c,length:d,datas:m}}decompress(r){return tEe(new Uint8Array(r))}compress(r){return eEe(new Uint8Array(r))}}const rEe={name:"DataStream",create:(t,r)=>{const s=r?new uge(t):new dge(t);return s.useDataStream(new nEe),s}};class iEe extends Jr{constructor(r,s,a){super(),Y(this,"ws",void 0),Y(this,"requestId",1),Y(this,"heartBeatTimer",void 0),Y(this,"joinInfo",void 0),Y(this,"clientId",void 0),Y(this,"onOpen",()=>{this.emit("open"),this.startHeartBeatCheck()}),Y(this,"onClose",c=>{this.emit("close"),this.dispose()}),Y(this,"onMessage",c=>{const d=JSON.parse(c.data);if(!d||d.command!=="serverResponse"||!d.requestId)return d&&d.command==="serverStatus"&&d.serverStatus&&d.serverStatus.command?(this.emit("status",d.serverStatus),void this.emit(d.serverStatus.command,d.serverStatus)):void 0;this.emit("req_".concat(d.requestId),d)}),this.joinInfo=r,this.clientId=s,this.ws=new cT("cross-channel-".concat(this.clientId),a),this.ws.on(an.RECONNECTING,()=>{this.ws.reconnectMode="retry",this.emit("reconnecting")}),this.ws.on(an.CONNECTED,this.onOpen),this.ws.on(an.ON_MESSAGE,this.onMessage),this.ws.on(an.CLOSED,this.onClose)}isConnect(){return this.ws.state==="connected"}sendMessage(r){const s=this.requestId++;return r.requestId=s,r.seq=s,this.ws.sendMessage(r),s}waitStatus(r){return new pt((s,a)=>{const c=window.setTimeout(()=>{a(new Pe(te.TIMEOUT,"wait status timeout, status: ".concat(r)))},5e3);this.once(r,d=>{window.clearTimeout(c),d.state&&d.state!==0?a(new Pe(te.CROSS_CHANNEL_WAIT_STATUS_ERROR,"wait status error, status: ".concat(r))):s(void 0)}),this.once("dispose",()=>{window.clearTimeout(c),a(new Pe(te.WS_ABORT))})})}async request(r){if(this.ws.state==="closed")throw new Pe(te.WS_DISCONNECT);const s=()=>new pt((h,m)=>{this.ws.once(an.CLOSED,()=>m(new Pe(te.WS_ABORT))),this.ws.once(an.CONNECTED,h)});this.ws.state!=="connected"&&await s();const a=this.sendMessage(r),c=new pt((h,m)=>{const g=()=>{m(new Pe(te.WS_ABORT))};this.ws.once(an.RECONNECTING,g),this.ws.once(an.CLOSED,g),this.once("req_".concat(a),h),bs(3e3).then(()=>{this.removeAllListeners("req_".concat(a)),this.ws.off(an.RECONNECTING,g),this.ws.off(an.CLOSED,g),m(new Pe(te.TIMEOUT,"cross channel ws request timeout"))})}),d=await c;if(!d||d.code!==200)throw new Pe(te.CROSS_CHANNEL_SERVER_ERROR_RESPONSE,"response: ".concat(JSON.stringify(d)));return d}async connect(r){this.ws.removeAllListeners(an.REQUEST_NEW_URLS),this.ws.on(an.REQUEST_NEW_URLS,s=>{s(r)}),await this.ws.init(r)}dispose(){this.clearHeartBeatCheck(),this.emit("dispose"),this.removeAllListeners(),this.ws.close()}sendPing(r){const s=this.requestId++;return r.requestId=s,this.ws.sendMessage(r),s}startHeartBeatCheck(){this.heartBeatTimer&&window.clearInterval(this.heartBeatTimer),this.heartBeatTimer=window.setInterval(()=>{this.sendPing({command:"ping",appId:this.joinInfo.appId,cname:this.joinInfo.cname,uid:this.joinInfo.uid.toString(),sid:this.joinInfo.sid,ts:+new Date,requestId:0})},3e3)}clearHeartBeatCheck(){window.clearInterval(this.heartBeatTimer),this.heartBeatTimer=void 0}}class sEe extends Jr{set state(r){r!==this._state&&(r!==Ja.RELAY_STATE_FAILURE&&(this.errorCode=i0.RELAY_OK),this.emit("state",r,this.errorCode),this._state=r)}get state(){return this._state}constructor(r,s,a,c,d){super(),Y(this,"joinInfo",void 0),Y(this,"sid",void 0),Y(this,"clientId",void 0),Y(this,"cancelToken",Sa.CancelToken.source()),Y(this,"workerToken",void 0),Y(this,"requestId",0),Y(this,"signal",void 0),Y(this,"prevChannelMediaConfig",void 0),Y(this,"httpRetryConfig",void 0),Y(this,"_resolution",void 0),Y(this,"_state",Ja.RELAY_STATE_IDLE),Y(this,"errorCode",i0.RELAY_OK),Y(this,"onStatus",h=>{x.debug("[".concat(this.clientId,"] ChannelMediaStatus: ").concat(JSON.stringify(h))),h&&h.command&&(h.command==="onAudioPacketReceived"&&this.emit("event",hf.PACKET_RECEIVED_AUDIO_FROM_SRC),h.command==="onVideoPacketReceived"&&this.emit("event",hf.PACKET_RECEIVED_VIDEO_FROM_SRC),h.command==="onSrcTokenPrivilegeDidExpire"&&(this.errorCode=i0.SRC_TOKEN_EXPIRED,this.state=Ja.RELAY_STATE_FAILURE),h.command==="onDestTokenPrivilegeDidExpire"&&(this.errorCode=i0.DEST_TOKEN_EXPIRED,this.state=Ja.RELAY_STATE_FAILURE))}),Y(this,"onReconnect",async()=>{x.debug("[".concat(this.clientId,"] ChannelMediaSocket disconnect, reconnecting")),this.emit("event",hf.NETWORK_DISCONNECTED),this.state=Ja.RELAY_STATE_IDLE,this.prevChannelMediaConfig&&this.sendStartRelayMessage(this.prevChannelMediaConfig).catch(h=>{this.state!==Ja.RELAY_STATE_IDLE&&(x.error("auto restart channel media relay failed",h.toString()),this.errorCode=i0.SERVER_CONNECTION_LOST,this.state=Ja.RELAY_STATE_FAILURE)})}),this.joinInfo=r,this.clientId=s,this.sid=ty(),this.signal=new iEe(this.joinInfo,this.clientId,a),this.httpRetryConfig=c,this._resolution=d}async startChannelMediaRelay(r){if(this.state!==Ja.RELAY_STATE_IDLE)throw new Pe(te.INVALID_OPERATION);this.state=Ja.RELAY_STATE_CONNECTING,await this.connect(),x.debug("[".concat(this.clientId,"] startChannelMediaRelay: connect success"));try{await this.sendStartRelayMessage(r)}catch(s){throw s.data&&s.data.serverResponse&&s.data.serverResponse.command==="SetSourceChannel"?new Pe(te.CROSS_CHANNEL_FAILED_JOIN_SRC):s.data&&s.data.serverResponse&&s.serverResponse.command==="SetDestChannelStatus"?new Pe(te.CROSS_CHANNEL_FAILED_JOIN_DEST):s.data&&s.data.serverResponse&&s.serverResponse.command==="StartPacketTransfer"?new Pe(te.CROSS_CHANNEL_FAILED_PACKET_SENT_TO_DEST):s}this.prevChannelMediaConfig=r}async updateChannelMediaRelay(r){if(this.state!==Ja.RELAY_STATE_RUNNING)throw new Pe(te.INVALID_OPERATION);await this.sendUpdateMessage(r),this.prevChannelMediaConfig=r}async setVideoProfile(r){if(this._resolution=r,this.state!==Ja.RELAY_STATE_RUNNING)throw new Pe(te.INVALID_OPERATION);const s=this.genMessage(ra.SetVideoProfile);await this.signal.request(s),x.debug("[".concat(this.clientId,"] startChannelMediaRelay: setVideoProfile success"))}async stopChannelMediaRelay(){await this.sendStopRelayMessage(),x.debug("[".concat(this.clientId,"] stopChannelMediaRelay: send stop message success")),this.state=Ja.RELAY_STATE_IDLE,this.dispose()}dispose(){x.debug("[".concat(this.clientId,"] disposeChannelMediaRelay")),this.cancelToken.cancel(),this.cancelToken=Sa.CancelToken.source(),this.state=Ja.RELAY_STATE_IDLE,this.emit("dispose"),this.signal.dispose(),this.prevChannelMediaConfig=void 0}async connect(){const r=await g_e(this.joinInfo,this.cancelToken.token,this.httpRetryConfig);this.workerToken=r.workerToken,await this.signal.connect(r.addressList),this.emit("event",hf.NETWORK_CONNECTED),this.signal.on("status",this.onStatus),this.signal.on("reconnecting",this.onReconnect)}async sendStartRelayMessage(r){const s=this.genMessage(ra.StopPacketTransfer);await this.signal.request(s),await this.signal.waitStatus("Normal Quit"),x.debug("[".concat(this.clientId,"] startChannelMediaRelay: StopPacketTransfer success"));const a=this.genMessage(ra.SetSdkProfile,r);await this.signal.request(a),x.debug("[".concat(this.clientId,"] startChannelMediaRelay: SetSdkProfile success"));const c=this.genMessage(ra.SetSourceChannel,r);await this.signal.request(c),await this.signal.waitStatus("SetSourceChannelStatus"),this.emit("event",hf.PACKET_JOINED_SRC_CHANNEL),x.debug("[".concat(this.clientId,"] startChannelMediaRelay: SetSourceChannel success"));const d=this.genMessage(ra.SetSourceUserId,r);await this.signal.request(d),x.debug("[".concat(this.clientId,"] startChannelMediaRelay: SetSourceUserId success"));const h=this.genMessage(ra.SetDestChannel,r);await this.signal.request(h),await this.signal.waitStatus("SetDestChannelStatus"),this.emit("event",hf.PACKET_JOINED_DEST_CHANNEL),x.debug("[".concat(this.clientId,"] startChannelMediaRelay: SetDestChannel success"));const m=this.genMessage(ra.StartPacketTransfer,r);await this.signal.request(m),this.emit("event",hf.PACKET_SENT_TO_DEST_CHANNEL),this.state=Ja.RELAY_STATE_RUNNING,x.debug("[".concat(this.clientId,"] startChannelMediaRelay: StartPacketTransfer success")),this.setVideoProfile(this._resolution)}async sendUpdateMessage(r){const s=this.genMessage(ra.UpdateDestChannel,r);await this.signal.request(s),this.emit("event",hf.PACKET_UPDATE_DEST_CHANNEL),x.debug("[".concat(this.clientId,"] sendUpdateMessage: UpdateDestChannel success"))}async sendStopRelayMessage(){const r=this.genMessage(ra.StopPacketTransfer);await this.signal.request(r),x.debug("[".concat(this.clientId,"] sendStopRelayMessage: StopPacketTransfer success"))}genMessage(r,s){const a=[],c=[],d=[];this.requestId+=1;const h={appId:this.joinInfo.appId,cname:this.joinInfo.cname,uid:this.joinInfo.uid.toString(),sdkVersion:Bl,sid:this.sid,ts:Date.now(),requestId:this.requestId,seq:this.requestId,allocate:!0,clientRequest:{}};h.sdkVersion==="4.24.0"&&(h.sdkVersion="0.0.1");let m=null,g=null;switch(r){case ra.SetSdkProfile:return h.clientRequest={command:"SetSdkProfile",type:"multi_channel"},h;case ra.SetSourceChannel:if(g=s&&s.getSrcChannelMediaInfo(),!g)throw new Pe(te.UNEXPECTED_ERROR,"can not find source config");return h.clientRequest={command:"SetSourceChannel",uid:"0",channelName:g.channelName,token:g.token||this.joinInfo.appId},h;case ra.SetSourceUserId:if(g=s&&s.getSrcChannelMediaInfo(),!g)throw new Pe(te.UNEXPECTED_ERROR,"can not find source config");return h.clientRequest={command:"SetSourceUserId",uid:g.uid+""},h;case ra.SetDestChannel:if(m=s&&s.getDestChannelMediaInfo(),!m)throw new Pe(te.UNEXPECTED_ERROR,"can not find dest config");return m.forEach(E=>{a.push(E.channelName),c.push(E.uid+""),d.push(E.token||this.joinInfo.appId)}),h.clientRequest={command:"SetDestChannel",channelName:a,uid:c,token:d},h;case ra.StartPacketTransfer:return h.clientRequest={command:"StartPacketTransfer"},h;case ra.Reconnect:return h.clientRequest={command:"Reconnect"},h;case ra.StopPacketTransfer:return h.clientRequest={command:"StopPacketTransfer"},h;case ra.UpdateDestChannel:if(m=s&&s.getDestChannelMediaInfo(),!m)throw new Pe(te.UNEXPECTED_ERROR,"can not find dest config");return m.forEach(E=>{a.push(E.channelName),c.push(E.uid+""),d.push(E.token||this.joinInfo.appId)}),h.clientRequest={command:"UpdateDestChannel",channelName:a,uid:c,token:d},h;case ra.SetVideoProfile:h.clientRequest={command:"SetVideoProfile",width:this._resolution.width,height:this._resolution.height}}return h}}const oEe={name:"ChannelMediaRelay",create:function(t){return new sEe(t.joinInfo,t.clientId,t.websocketRetryConfig||Mi,t.httpRetryConfig||Mi,t.resolution)}};function vK(t,r){var s=Object.keys(t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);r&&(a=a.filter(function(c){return Object.getOwnPropertyDescriptor(t,c).enumerable})),s.push.apply(s,a)}return s}function UT(t){for(var r=1;r<arguments.length;r++){var s=arguments[r]!=null?arguments[r]:{};r%2?vK(Object(s),!0).forEach(function(a){Y(t,a,s[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(s)):vK(Object(s)).forEach(function(a){Object.defineProperty(t,a,Object.getOwnPropertyDescriptor(s,a))})}return t}class aEe extends Jr{constructor(r,s,a,c){super(),Y(this,"spec",void 0),Y(this,"token",void 0),Y(this,"websocket",void 0),Y(this,"pingpongTimer",void 0),Y(this,"reconnectMode","retry"),Y(this,"serviceMode",void 0),Y(this,"reqId",0),Y(this,"commandReqId",0),Y(this,"handleWebSocketOpen",()=>{this.reconnectMode="retry",this.startPingPong()}),Y(this,"handleWebSocketMessage",d=>{if(!d.data)return;const h=JSON.parse(d.data);h.requestId?this.emit("@".concat(h.requestId,"-").concat(h.sid),h):(At.workerEvent(this.spec.sid,{actionType:"status",serverCode:h.code,workerType:this.serviceMode===df.TRANSCODE?1:2}),this.emit(Km.PUBLISH_STREAM_STATUS,h))}),this.spec=s,this.token=r,this.serviceMode=c,this.websocket=new cT("live-streaming",a),this.websocket.on(an.CONNECTED,this.handleWebSocketOpen),this.websocket.on(an.ON_MESSAGE,this.handleWebSocketMessage),this.websocket.on(an.REQUEST_NEW_URLS,(d,h)=>{Ms(this,Km.REQUEST_NEW_ADDRESS).then(d).catch(h)}),this.websocket.on(an.RECONNECTING,()=>{this.websocket.reconnectMode=this.reconnectMode})}init(r){return this.websocket.init(r)}async request(r,s,a,c){this.reqId+=1,r==="request"&&(this.commandReqId+=1);const d=this.commandReqId,h=this.reqId;if(!h||!this.websocket)throw new Pe(te.UNEXPECTED_ERROR);const m=UT({command:r,sdkVersion:Bl==="4.24.0"?"0.0.1":Bl,seq:h,requestId:h,allocate:a,cname:this.spec.cname,appId:this.spec.appId,sid:this.spec.sid,uid:this.spec.uid.toString(),ts:Math.floor(Date.now()/1e3)},s);if(this.websocket.state==="closed")throw new Pe(te.WS_DISCONNECT);const g=()=>new pt((A,k)=>{this.websocket.once(an.CLOSED,()=>k(new Pe(te.WS_ABORT))),this.websocket.once(an.CONNECTED,A)});this.websocket.state!=="connected"&&await g(),m.clientRequest&&(m.clientRequest.workerToken=this.token);const E=new pt((A,k)=>{const W=()=>{k(new Pe(te.WS_ABORT))};this.websocket.once(an.RECONNECTING,W),this.websocket.once(an.CLOSED,W),this.once("@".concat(h,"-").concat(this.spec.sid),j=>{A(j)})});c&&At.workerEvent(this.spec.sid,UT(UT({},c),{},{requestId:d,actionType:"request",payload:JSON.stringify(s.clientRequest),serverCode:0,code:0}));const b=Date.now();this.websocket.sendMessage(m);let I=null;try{I=await E}catch(A){if(this.websocket.state==="closed")throw A;return await g(),await this.request(r,s,a)}return c&&At.workerEvent(this.spec.sid,UT(UT({},c),{},{requestId:d,actionType:"response",payload:JSON.stringify(I.serverResponse),serverCode:I.code,success:I.code===200,responseTime:Date.now()-b})),I.code!==200&&this.handleResponseError(I),I}tryNextAddress(){this.reconnectMode="tryNext",this.websocket.reconnect("tryNext")}close(){const r=Bl==="4.24.0"?"0.0.1":Bl;this.reqId+=1,this.websocket.state==="connected"?(this.websocket.sendMessage({command:"request",appId:this.spec.appId,cname:this.spec.cname,uid:this.spec.uid.toString(),sdkVersion:r,sid:this.spec.sid,seq:this.reqId,ts:Math.floor(Date.now()/1e3),requestId:this.reqId,clientRequest:{command:"DestroyWorker"}}),this.websocket.close(!1,!0)):this.websocket.close(!1),this.pingpongTimer&&(window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0)}handleResponseError(r){switch(r.code){case Wi.LIVE_STREAM_RESPONSE_ALREADY_EXISTS_STREAM:return void x.warning("live stream response already exists stream");case Wi.LIVE_STREAM_RESPONSE_TRANSCODING_PARAMETER_ERROR:case Wi.LIVE_STREAM_RESPONSE_BAD_STREAM:case Wi.LIVE_STREAM_RESPONSE_WM_PARAMETER_ERROR:return new Pe(te.LIVE_STREAMING_INVALID_ARGUMENT,"",{code:r.code}).throw();case Wi.LIVE_STREAM_RESPONSE_WM_WORKER_NOT_EXIST:if(r.serverResponse.command==="UnpublishStream")return;throw new Pe(te.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"live stream response wm worker not exist",{retry:!0});case Wi.LIVE_STREAM_RESPONSE_NOT_AUTHORIZED:return new Pe(te.LIVE_STREAMING_PUBLISH_STREAM_NOT_AUTHORIZED,"",{code:r.code}).throw();case Wi.LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE:{const s=new Pe(te.LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE);return this.emit(Km.WARNING,s,r.serverResponse.url)}case Wi.LIVE_STREAM_RESPONSE_REQUEST_TOO_OFTEN:{const s=new Pe(te.LIVE_STREAMING_WARN_FREQUENT_REQUEST);return this.emit(Km.WARNING,s,r.serverResponse.url)}case Wi.LIVE_STREAM_RESPONSE_NOT_FOUND_PUBLISH:throw new Pe(te.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"live stream response wm worker not exist",{retry:!0});case Wi.LIVE_STREAM_RESPONSE_NOT_SUPPORTED:return new Pe(te.LIVE_STREAMING_TRANSCODING_NOT_SUPPORTED,"",{code:r.code}).throw();case Wi.LIVE_STREAM_RESPONSE_MAX_STREAM_NUM:{const s=new Pe(te.LIVE_STREAMING_WARN_STREAM_NUM_REACH_LIMIT);return this.emit(Km.WARNING,s,r.serverResponse.url)}case Wi.LIVE_STREAM_RESPONSE_INTERNAL_SERVER_ERROR:return new Pe(te.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"",{code:r.code}).throw();case Wi.LIVE_STREAM_RESPONSE_RESOURCE_LIMIT:throw new Pe(te.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"live stream resource limit",{retry:!0,changeAddress:!0});case Wi.LIVE_STREAM_RESPONSE_WORKER_LOST:case Wi.LIVE_STREAM_RESPONSE_WORKER_QUIT:if(r.serverResponse.command==="UnpublishStream")return;throw new Pe(te.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"error fail send message",{retry:!0,changeAddress:!0});case Wi.ERROR_FAIL_SEND_MESSAGE:if(r.serverResponse.command==="UnpublishStream")return;if(r.serverResponse.command==="UpdateTranscoding"||r.serverResponse.command==="ControlStream")return new Pe(te.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"error fail send message",{code:r.code}).throw();throw new Pe(te.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"error fail send message",{retry:!0,changeAddress:!0});case Wi.PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN:case Wi.PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT:case Wi.PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE:case Wi.PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH:return new Pe(te.LIVE_STREAMING_CDN_ERROR,"",{code:r.code}).throw()}}startPingPong(){this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(()=>{this.websocket.state==="connected"&&this.request("ping",{}).catch(mP)},6e3)}}function SK(t,r){var s=Object.keys(t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);r&&(a=a.filter(function(c){return Object.getOwnPropertyDescriptor(t,c).enumerable})),s.push.apply(s,a)}return s}function Qa(t){for(var r=1;r<arguments.length;r++){var s=arguments[r]!=null?arguments[r]:{};r%2?SK(Object(s),!0).forEach(function(a){Y(t,a,s[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(s)):SK(Object(s)).forEach(function(a){Object.defineProperty(t,a,Object.getOwnPropertyDescriptor(s,a))})}return t}class cEe extends Jr{constructor(r){let s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:Mi,a=arguments.length>2&&arguments[2]!==void 0?arguments[2]:Mi;super(),Y(this,"onLiveStreamWarning",void 0),Y(this,"onLiveStreamError",void 0),Y(this,"spec",void 0),Y(this,"retryTimeout",1e4),Y(this,"connection",void 0),Y(this,"httpRetryConfig",void 0),Y(this,"wsRetryConfig",void 0),Y(this,"streamingTasks",new Map),Y(this,"isStartingStreamingTask",!1),Y(this,"taskMutex",new Ys("live-streaming")),Y(this,"cancelToken",Sa.CancelToken.source()),Y(this,"transcodingConfig",void 0),Y(this,"uapResponse",void 0),Y(this,"lastTaskId",1),Y(this,"statusError",new Map),this.spec=r,this.httpRetryConfig=a,this.wsRetryConfig=s}async setTranscodingConfig(r){const s=Qa(Qa({},qge),r);s.videoCodecProfile!==66&&s.videoCodecProfile!==77&&s.videoCodecProfile!==100&&(x.debug("[".concat(this.spec.clientId,"] set transcoding config, fix video codec profile: ").concat(s.videoCodecProfile," -> 100")),s.videoCodecProfile=100),s.transcodingUsers||(s.transcodingUsers=s.userConfigs),s.transcodingUsers&&(s.transcodingUsers=s.transcodingUsers.map(h=>Qa(Qa(Qa({},Kge),h),{},{zOrder:h.zOrder?h.zOrder+1:1}))),function(h){ri(h.width)||_r(h.width,"config.width",0,1e4),ri(h.height)||_r(h.height,"config.height",0,1e4),ri(h.videoBitrate)||_r(h.videoBitrate,"config.videoBitrate",1,1e6),ri(h.videoFrameRate)||_r(h.videoFrameRate,"config.videoFrameRate"),ri(h.lowLatency)||Bd(h.lowLatency,"config.lowLatency"),ri(h.audioSampleRate)||Yi(h.audioSampleRate,"config.audioSampleRate",[32e3,44100,48e3]),ri(h.audioBitrate)||_r(h.audioBitrate,"config.audioBitrate",1,128),ri(h.audioChannels)||Yi(h.audioChannels,"config.audioChannels",[1,2,3,4,5]),ri(h.videoGop)||_r(h.videoGop,"config.videoGop"),ri(h.videoCodecProfile)||Yi(h.videoCodecProfile,"config.videoCodecProfile",[66,77,100]),ri(h.userCount)||_r(h.userCount,"config.userCount",0,17),ri(h.backgroundColor)||_r(h.backgroundColor,"config.backgroundColor",0,16777215),ri(h.userConfigExtraInfo)||Ss(h.userConfigExtraInfo,"config.userConfigExtraInfo",0,4096,!1),h.transcodingUsers&&!ri(h.transcodingUsers)&&(uf(h.transcodingUsers,"config.transcodingUsers"),h.transcodingUsers.forEach((m,g)=>{FP(m.uid),ri(m.x)||_r(m.x,"transcodingUser[".concat(g,"].x"),0,1e4),ri(m.y)||_r(m.y,"transcodingUser[".concat(g,"].y"),0,1e4),ri(m.width)||_r(m.width,"transcodingUser[".concat(g,"].width"),0,1e4),ri(m.height)||_r(m.height,"transcodingUser[".concat(g,"].height"),0,1e4),ri(m.zOrder)||_r(m.zOrder-1,"transcodingUser[".concat(g,"].zOrder"),0,100),ri(m.alpha)||_r(m.alpha,"transcodingUser[".concat(g,"].alpha"),0,1,!1)})),ri(h.watermark)||N2(h.watermark,"watermark"),ri(h.backgroundImage)||N2(h.backgroundImage,"backgroundImage"),h.images&&!ri(h.images)&&(uf(h.images,"config.images"),h.images.forEach((m,g)=>{N2(m,"images[".concat(g,"]"))}))}(s);const a=[];s.images&&a.push(...s.images.map(h=>Qa(Qa(Qa({},O2),h),{},{zOrder:255}))),s.backgroundImage&&(a.push(Qa(Qa(Qa({},O2),s.backgroundImage),{},{zOrder:0})),delete s.backgroundImage),s.watermark&&(a.push(Qa(Qa(Qa({},O2),s.watermark),{},{zOrder:255})),delete s.watermark),s.images=a,s.transcodingUsers&&(s.userConfigs=s.transcodingUsers.map(h=>Qa({},h)),s.userCount=s.transcodingUsers.length,delete s.transcodingUsers);const c=(s.userConfigs||[]).map(h=>typeof h.uid=="number"?pt.resolve(h.uid):KH(h.uid,this.spec,this.cancelToken.token,this.httpRetryConfig));if((await pt.all(c)).forEach((h,m)=>{s.userConfigs&&s.userConfigs[m]&&(s.userConfigs[m].uid=h)}),this.transcodingConfig=s,this.connection)try{var d;const h=await this.connection.request("request",{clientRequest:{command:"UpdateTranscoding",transcodingConfig:this.transcodingConfig}},!1,{command:"UpdateTranscoding",workerType:1,requestByUser:!0,tid:Array.from(Sc(d=this.streamingTasks).call(d)).map(m=>m.taskId).join("#")});x.debug("[".concat(this.spec.clientId,"] update live transcoding config success, code: ").concat(h.code,", config:"),JSON.stringify(this.transcodingConfig))}catch(h){if(!h.data||!h.data.retry)throw h;h.data.changeAddress&&this.connection.tryNextAddress(),this.streamingTasks.forEach(m=>{x.warning("[".concat(this.spec.clientId,"] live streaming receive error"),h.toString(),"try to republish",m.url),this.startLiveStreamingTask(m.url,m.mode,h).then(()=>{x.debug("[".concat(this.spec.clientId,"] live streaming republish ").concat(m.url," success"))}).catch(g=>{x.error("[".concat(this.spec.clientId,"] live streaming republish failed"),m.url,g.toString()),this.onLiveStreamError&&this.onLiveStreamError(m.url,g)})})}}async startLiveStreamingTask(r,s,a){if(!this.transcodingConfig&&s===df.TRANSCODE)throw new Pe(te.INVALID_OPERATION,"[LiveStreaming] no transcoding config found, can not start transcoding streaming task");const c={command:"PublishStream",ts:Date.now(),url:r,uid:this.spec.uid.toString(),autoDestroyTime:100,acceptImageTimeout:!0};x.debug("[".concat(this.spec.clientId,"] start live streaming ").concat(r,", mode: ").concat(s));const d=await this.taskMutex.lock();if(!this.connection&&a)return void d();if(this.streamingTasks.get(r)&&!a)return d(),new Pe(te.LIVE_STREAMING_TASK_CONFLICT).throw();try{this.connection||(this.connection=await this.connect(s))}catch(m){throw d(),m}switch(s){case df.TRANSCODE:c.transcodingConfig=Qa({},this.transcodingConfig)}this.uapResponse&&this.uapResponse.vid&&(c.vid=this.uapResponse.vid),this.isStartingStreamingTask=!0;const h=this.lastTaskId++;try{const m=new pt((E,b)=>{bs(this.retryTimeout).then(()=>{if(a)return b(a);const I=this.statusError.get(r);return I?(this.statusError.delete(r),b(I)):void 0})}),g=await pt.race([this.connection.request("request",{clientRequest:c},!0,{url:r,command:"PublishStream",workerType:s===df.TRANSCODE?1:2,requestByUser:!a,tid:h.toString()}),m]);this.isStartingStreamingTask=!1,x.debug("[".concat(this.spec.clientId,"] live streaming started, code: ").concat(g.code)),this.streamingTasks.set(r,{clientRequest:c,mode:s,url:r,taskId:h}),d()}catch(m){if(d(),this.isStartingStreamingTask=!1,!m.data||!m.data.retry||a)throw m;return m.data.changeAddress?(this.connection.tryNextAddress(),await this.startLiveStreamingTask(r,s,m)):await this.startLiveStreamingTask(r,s,m)}}stopLiveStreamingTask(r){return new pt((s,a)=>{const c=this.streamingTasks.get(r);if(!c||!this.connection)return new Pe(te.UNEXPECTED_ERROR,"can not find streaming task to stop").throw();const d=c.mode;c.abortTask=()=>{x.debug("[".concat(this.spec.clientId,"] stop live streaming success(worker exception)")),this.streamingTasks.delete(r),s()},this.connection.request("request",{clientRequest:{command:"UnpublishStream",url:c.url}},!1,{url:r,command:"UnPublishStream",workerType:d===df.TRANSCODE?1:2,requestByUser:!0,tid:(this.lastTaskId++).toString()}).then(h=>{x.debug("[".concat(this.spec.clientId,"] stop live streaming success, code: ").concat(h.code)),this.streamingTasks.delete(r),this.streamingTasks.size===0&&(this.connection&&this.connection.close(),this.connection=void 0),s()}).catch(a)})}resetAllTask(){var r;const s=Array.from(Sc(r=this.streamingTasks).call(r));this.terminate();for(const a of s)this.startLiveStreamingTask(a.url,a.mode).catch(c=>{this.onLiveStreamError&&this.onLiveStreamError(a.url,c)})}terminate(){this.cancelToken&&this.cancelToken.cancel(),this.streamingTasks=new Map,this.isStartingStreamingTask=!1,this.statusError=new Map,this.cancelToken=Sa.CancelToken.source(),this.uapResponse=void 0,this.connection&&this.connection.close(),this.connection=void 0}async connect(r){if(this.connection)throw new Pe(te.UNEXPECTED_ERROR,"live streaming connection has already connected");const s=await Ms(this,D2.REQUEST_WORKER_MANAGER_LIST,r);return this.uapResponse=s,this.connection=new aEe(s.workerToken,this.spec,this.wsRetryConfig,r),this.connection.on(Km.WARNING,(a,c)=>this.onLiveStreamWarning&&this.onLiveStreamWarning(c,a)),this.connection.on(Km.PUBLISH_STREAM_STATUS,a=>this.handlePublishStreamServer(a)),this.connection.on(Km.REQUEST_NEW_ADDRESS,(a,c)=>{if(!this.connection)return c(new Pe(te.UNEXPECTED_ERROR,"can not get new live streaming address list"));Ms(this,D2.REQUEST_WORKER_MANAGER_LIST,r).then(d=>{this.uapResponse=d,a(d.addressList)}).catch(c)}),await this.connection.init(s.addressList),this.connection}handlePublishStreamServer(r){const s=r.serverStatus&&r.serverStatus.url||"empty_url",a=this.streamingTasks.get(s),c=r.reason;switch(r.code){case Wi.PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN:case Wi.PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT:case Wi.PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE:case Wi.PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH:{const h=new Pe(te.LIVE_STREAMING_CDN_ERROR,"",{code:r.code});if(a)return x.error(h.toString()),this.onLiveStreamError&&this.onLiveStreamError(s,h);if(!this.isStartingStreamingTask)return;this.statusError.set(s,h)}case Wi.LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE:{const h=new Pe(te.LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE,c);return this.onLiveStreamWarning&&this.onLiveStreamWarning(s,h)}case Wi.LIVE_STREAM_RESPONSE_WORKER_LOST:case Wi.LIVE_STREAM_RESPONSE_WORKER_QUIT:{var d;if(!this.connection)return;this.connection.tryNextAddress();const h=Array.from(Sc(d=this.streamingTasks).call(d));for(const m of h)m.abortTask?m.abortTask():(x.warning("[".concat(this.spec.clientId,"] publish stream status code"),r.code,"try to republish",m.url),this.startLiveStreamingTask(m.url,m.mode,new Pe(te.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"",{code:r.code})).then(()=>{x.debug("[".concat(this.spec.clientId,"] republish live stream success"),m.url)}).catch(g=>{x.error(g.toString()),this.onLiveStreamError&&this.onLiveStreamError(m.url,g)}));return}}}hasUrl(r){return this.streamingTasks.has(r)}}const lEe={name:"LiveStreaming",create:function(t){return new cEe(t.joinInfo,t.websocketRetryConfig||Mi,t.httpRetryConfig||Mi)}};function uEe(t){let r=TK();return function(s,a){let c=s.appId;c!==void 0&&(lr(a,10),np(a,c));let d=s.cid;d!==void 0&&(lr(a,16),lr(a,d));let h=s.cname;h!==void 0&&(lr(a,26),np(a,h));let m=s.deviceId;m!==void 0&&(lr(a,34),np(a,m));let g=s.elapse;g!==void 0&&(lr(a,40),lg(a,g));let E=s.fileSize;E!==void 0&&(lr(a,48),lg(a,S0(E)));let b=s.height;b!==void 0&&(lr(a,56),lg(a,S0(b)));let I=s.jpg;I!==void 0&&(lr(a,66),lr(a,I.length),function(eo,Be){let st=b0(eo,Be.length);eo.bytes.set(Be,st)}(a,I));let A=s.networkType;A!==void 0&&(lr(a,72),lg(a,S0(A)));let k=s.osType;k!==void 0&&(lr(a,80),lg(a,S0(k)));let W=s.requestId;W!==void 0&&(lr(a,90),np(a,W));let j=s.sdkVersion;j!==void 0&&(lr(a,98),np(a,j));let B=s.sequence;B!==void 0&&(lr(a,104),lg(a,S0(B)));let ee=s.sid;ee!==void 0&&(lr(a,114),np(a,ee));let Z=s.timestamp;Z!==void 0&&(lr(a,120),lg(a,Z));let oe=s.uid;oe!==void 0&&(lr(a,128),lr(a,oe));let ye=s.vid;ye!==void 0&&(lr(a,136),lr(a,ye));let _e=s.width;_e!==void 0&&(lr(a,144),lg(a,S0(_e)));let ue=s.service;ue!==void 0&&(lr(a,152),lr(a,ue));let Ce=s.callbackData;Ce!==void 0&&(lr(a,162),np(a,Ce));let Ue=s.jpgEncryption;Ue!==void 0&&(lr(a,168),lr(a,Ue));let ze=s.requestType;ze!==void 0&&(lr(a,176),lr(a,ze));let Je=s.scorePorn;Je!==void 0&&(lr(a,185),VM(a,Je));let hn=s.scoreSexy;hn!==void 0&&(lr(a,193),VM(a,hn));let vn=s.scoreNeutral;vn!==void 0&&(lr(a,201),VM(a,vn));let Xt=s.scene;Xt!==void 0&&(lr(a,208),lr(a,Xt));let nr=s.ossFilePrefix;nr!==void 0&&(lr(a,218),np(a,nr));let Kn=s.serviceVendor;if(Kn!==void 0)for(let eo of Kn){lr(a,226);let Be=TK();pEe(eo,Be),lr(a,Be.limit),_Ee(a,Be),gEe(Be)}}(t,r),function(s){let a=s.bytes,c=s.limit;return a.length===c?a:a.subarray(0,c)}(r)}function dEe(t){return function(s){let a={};e:for(;!CK(s);){let c=rp(s);switch(c>>>3){case 0:break e;case 1:a.code=rp(s);break;case 2:a.msg=RK(s,rp(s));break;case 3:{let d=fEe(s);a.data=hEe(s),s.limit=d;break}default:bK(s,7&c)}}return a}({bytes:r=t,offset:0,limit:r.length});var r}function hEe(t){let r={};e:for(;!CK(t);){let s=rp(t);switch(s>>>3){case 0:break e;case 1:r.requestId=RK(t,rp(t));break;case 2:r.requestType=rp(t)>>>0;break;case 3:r.scorePorn=UM(t);break;case 4:r.scoreSexy=UM(t);break;case 5:r.scoreNeutral=UM(t);break;case 6:r.requestScene=rp(t)>>>0;break;case 7:r.scene=rp(t)>>>0;break;default:bK(t,7&s)}}return r}function pEe(t,r){let s=t.service;s!==void 0&&(lr(r,8),lr(r,s));let a=t.vendor;a!==void 0&&(lr(r,16),lr(r,a));let c=t.token;c!==void 0&&(lr(r,26),np(r,c));let d=t.callbackUrl;d!==void 0&&(lr(r,34),np(r,d))}function fEe(t){let r=rp(t),s=t.limit;return t.limit=t.offset+r,s}function bK(t,r){switch(r){case 0:for(;128&IK(t););break;case 2:LM(t,rp(t));break;case 5:LM(t,4);break;case 1:LM(t,8);break;default:throw new Error("Unimplemented type: "+r)}}let mEe=new Float32Array(1);new Uint8Array(mEe.buffer);let xM=new Float64Array(1),Za=new Uint8Array(xM.buffer);function S0(t){return{low:t|=0,high:t>>31,unsigned:t>=0}}let wK=[];function TK(){const t=wK.pop();return t?(t.offset=t.limit=0,t):{bytes:new Uint8Array(64),offset:0,limit:0}}function gEe(t){wK.push(t)}function LM(t,r){if(t.offset+r>t.limit)throw new Error("Skip past limit");t.offset+=r}function CK(t){return t.offset>=t.limit}function b0(t,r){let s=t.bytes,a=t.offset,c=t.limit,d=a+r;if(d>s.length){let h=new Uint8Array(2*d);h.set(s),t.bytes=h}return t.offset=d,d>c&&(t.limit=d),a}function MM(t,r){let s=t.offset;if(s+r>t.limit)throw new Error("Read past limit");return t.offset+=r,s}function RK(t,r){let s=MM(t,r),a=String.fromCharCode,c=t.bytes,d="",h="";for(let m=0;m<r;m++){let g,E,b,I,A=c[m+s];(128&A)==0?h+=a(A):(224&A)==192?m+1>=r?h+=d:(g=c[m+s+1],(192&g)!=128?h+=d:(I=(31&A)<<6|63&g,I<128?h+=d:(h+=a(I),m++))):(240&A)==224?m+2>=r?h+=d:(g=c[m+s+1],E=c[m+s+2],(49344&(g|E<<8))!=32896?h+=d:(I=(15&A)<<12|(63&g)<<6|63&E,I<2048||I>=55296&&I<=57343?h+=d:(h+=a(I),m+=2))):(248&A)==240?m+3>=r?h+=d:(g=c[m+s+1],E=c[m+s+2],b=c[m+s+3],(12632256&(g|E<<8|b<<16))!=8421504?h+=d:(I=(7&A)<<18|(63&g)<<12|(63&E)<<6|63&b,I<65536||I>1114111?h+=d:(I-=65536,h+=a(55296+(I>>10),56320+(1023&I)),m+=3))):h+=d}return h}function np(t,r){let s=r.length,a=0;for(let h=0;h<s;h++){let m=r.charCodeAt(h);m>=55296&&m<=56319&&h+1<s&&(m=(m<<10)+r.charCodeAt(++h)-56613888),a+=m<128?1:m<2048?2:m<65536?3:4}lr(t,a);let c=b0(t,a),d=t.bytes;for(let h=0;h<s;h++){let m=r.charCodeAt(h);m>=55296&&m<=56319&&h+1<s&&(m=(m<<10)+r.charCodeAt(++h)-56613888),m<128?d[c++]=m:(m<2048?d[c++]=m>>6&31|192:(m<65536?d[c++]=m>>12&15|224:(d[c++]=m>>18&7|240,d[c++]=m>>12&63|128),d[c++]=m>>6&63|128),d[c++]=63&m|128)}}function _Ee(t,r){let s=b0(t,r.limit),a=t.bytes,c=r.bytes;for(let d=0,h=r.limit;d<h;d++)a[d+s]=c[d]}function IK(t){return t.bytes[MM(t,1)]}function AK(t,r){let s=b0(t,1);t.bytes[s]=r}function UM(t){let r=MM(t,8),s=t.bytes;return Za[0]=s[r++],Za[1]=s[r++],Za[2]=s[r++],Za[3]=s[r++],Za[4]=s[r++],Za[5]=s[r++],Za[6]=s[r++],Za[7]=s[r++],xM[0]}function VM(t,r){let s=b0(t,8),a=t.bytes;xM[0]=r,a[s++]=Za[0],a[s++]=Za[1],a[s++]=Za[2],a[s++]=Za[3],a[s++]=Za[4],a[s++]=Za[5],a[s++]=Za[6],a[s++]=Za[7]}function rp(t){let r,s=0,a=0;do r=IK(t),s<32&&(a|=(127&r)<<s),s+=7;while(128&r);return a}function lr(t,r){for(r>>>=0;r>=128;)AK(t,127&r|128),r>>>=7;AK(t,r)}function lg(t,r){let s=r.low>>>0,a=(r.low>>>28|r.high<<4)>>>0,c=r.high>>>24,d=c===0?a===0?s<16384?s<128?1:2:s<1<<21?3:4:a<16384?a<128?5:6:a<1<<21?7:8:c<128?9:10,h=b0(t,d),m=t.bytes;switch(d){case 10:m[h+9]=c>>>7&1;case 9:m[h+8]=d!==9?128|c:127&c;case 8:m[h+7]=d!==8?a>>>21|128:a>>>21&127;case 7:m[h+6]=d!==7?a>>>14|128:a>>>14&127;case 6:m[h+5]=d!==6?a>>>7|128:a>>>7&127;case 5:m[h+4]=d!==5?128|a:127&a;case 4:m[h+3]=d!==4?s>>>21|128:s>>>21&127;case 3:m[h+2]=d!==3?s>>>14|128:s>>>14&127;case 2:m[h+1]=d!==2?s>>>7|128:s>>>7&127;case 1:m[h]=d!==1?128|s:127&s}}function PK(t,r){var s=Object.keys(t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);r&&(a=a.filter(function(c){return Object.getOwnPropertyDescriptor(t,c).enumerable})),s.push.apply(s,a)}return s}const yEe=new Map([["moderation",1],["supervise",2]]);class EEe extends Jr{get connectionState(){return this._connectionState}set connectionState(r){if(this._connectionState===r)return;const s=this._connectionState;this._connectionState=r,this.emit(fs.CONNECTION_STATE_CHANGE,s,r)}get inspectType(){return this._inspectType}set inspectType(r){var s;this._inspectMode=Wa(s=r.map(a=>yEe.get(a)||0)).call(s,(a,c)=>a+c),this._inspectType=r}get quality(){return this._quality}set quality(r){this._quality=r>1?1:r<.1?.1:r,this.qualityTimer&&(window.clearTimeout(this.qualityTimer),this.qualityTimer=null),this._quality>=1||(this.qualityTimer=window.setTimeout(()=>{this.quality=this._quality/this.qualityRatio},6e4))}constructor(r){super(),Y(this,"name","AgoraRTCVideoContentInspect"),Y(this,"_connectionState",Fu.CONNECTING),Y(this,"_innerConnectionState",void 0),Y(this,"sequence",0),Y(this,"inspectStartTime",void 0),Y(this,"workerManagerConnection",void 0),Y(this,"workerConnection",void 0),Y(this,"workerMessageLengthLimit",void 0),Y(this,"inspectIntervalMinimum",void 0),Y(this,"qualityRatio",void 0),Y(this,"_connectInfo",void 0),Y(this,"_cancelTokenSource",Sa.CancelToken.source()),Y(this,"_retryConfig",void 0),Y(this,"wmSequence",0),Y(this,"inspectInterval",void 0),Y(this,"inspectTimer",null),Y(this,"ossFilePrefix",void 0),Y(this,"extraInfo",void 0),Y(this,"_inspectType",void 0),Y(this,"_inspectMode",void 0),Y(this,"_quality",1),Y(this,"qualityTimer",null),Y(this,"_inspectId",void 0),Y(this,"_needWorkUrlOnly",!1),Y(this,"inspectImage",()=>{if(this.connectionState!==Fu.CONNECTED)throw new Pe(te.OPERATION_ABORTED,"content inspect service connection status is ".concat(this.connectionState));this.inspectTimer&&(window.clearInterval(this.inspectTimer),this.inspectTimer=null),this.inspectTimer=window.setInterval(()=>{this.connectionState===Fu.CONNECTED?this.requestToInspectImage():x.debug("[".concat(this._inspectId,"] Inspect State is not connected , "),this.connectionState)},this.inspectInterval<this.inspectIntervalMinimum?this.inspectIntervalMinimum:this.inspectInterval),this.requestToInspectImage()}),this._inspectId=vr(5,"inspect-"),this.workerMessageLengthLimit=se("VIDEO_INSPECT_WORKER_MESSAGE_LENGTH_LIMIT"),this.inspectIntervalMinimum=se("VIDEO_INSPECT_INTERVAL_MINIMUM"),this.qualityRatio=se("VIDEO_INSPECT_QUALITY_RATIO"),this.inspectInterval=r.interval,this.ossFilePrefix=r.ossFilePrefix,this.extraInfo=r.extraInfo,this.inspectType=r.inspectType,this.inspectStartTime=Number(Date.now()),this.workerManagerConnection=new cT("worker-manager-"+this._inspectId,Mi),this.on(fs.STATE_CHANGE,(s,a)=>{this._innerConnectionState=s,x.debug("[".concat(this._inspectId,"] Inspect operation :").concat(ju[s]," ").concat(a||""))}),this.handleWorkerManagerEvents(),this.workerConnection=new cT("worker-"+this._inspectId,Mi),this.handleWorkerEvents()}async init(r,s){this.emit(fs.STATE_CHANGE,ju.CONNECT_AP),this._connectInfo=r;const a=this._cancelTokenSource.token;return this._retryConfig=s,new pt((c,d)=>{this.on(fs.CONNECTION_STATE_CHANGE,(h,m)=>{m===Fu.CONNECTED&&c()}),this.requestAP(r,a,s).then(h=>{this.connectWorkerManager(h)}).catch(h=>{d(h)})})}async requestAP(r,s,a){const c=se("WEBCS_DOMAIN").map(m=>"https://".concat(m,"/api/v1")),d=await function(m,g,E,b){let{appId:I,areaCode:A,cname:k,sid:W,token:j,uid:B}=g;d0++;const ee="image_moderation_api",Z={service_name:ee,json_body:JSON.stringify({appId:I,areaCode:A,cname:k,command:"allocateEdge",requestId:d0,seq:d0,sid:W,token:j,ts:Date.now(),uid:B+""})};let oe,ye,_e=m[0];return zd(async()=>{oe=Date.now();const ue=await Kd(_e,{data:Z,cancelToken:E,headers:{"X-Packet-Service-Type":"0","X-Packet-URI":"61"},params:{action:"wrtc_gateway"}});if(ye=Date.now()-oe,ue.code!==0){const Je=new Pe(te.UNEXPECTED_RESPONSE,"image inspect ap error, code"+ue.code,{retry:!0,responseTime:ye});throw x.error(Je.toString()),Je}const Ce=JSON.parse(ue.json_body);if(Ce.code!==200){const Je=new Pe(te.UNEXPECTED_RESPONSE,"image inspect ap error, code: ".concat(Ce.code,", reason: ").concat(Ce.reason),{code:Ce.code,responseTime:ye});throw x.error(Je.toString()),Je}if(!Ce.servers||!Array.isArray(Ce.servers)||Ce.servers.length===0){const Je=new Pe(te.UNEXPECTED_RESPONSE,"image inspect ap empty server",{code:Ce.code,responseTime:ye});throw x.error(Je.toString()),Je}const Ue=se("VIDEO_INSPECT_WORKER_MANAGER_HOST"),ze=se("VIDEO_INSPECT_WORKER_MANAGER_PORT");return{addressList:Ce.servers.map(Je=>{let{address:hn,wss:vn}=Je;if(hn&&vn)return"wss://".concat(hn.replace(/\./g,"-"),".").concat(Ue,":").concat(ze||vn)}).filter(Je=>!!Je),workerToken:Ce.workerToken,vid:Ce.vid,responseTime:ye}},(ue,Ce)=>(At.apworkerEvent(W,{success:!0,sc:200,serviceName:ee,responseDetail:JSON.stringify(ue.addressList),firstSuccess:Ce===0,responseTime:ye,serverIp:m[Ce%m.length]}),!1),(ue,Ce)=>(At.apworkerEvent(W,{success:!1,sc:ue.data&&ue.data.code||200,serviceName:ee,responseTime:ye,serverIp:m[Ce%m.length]}),!!(ue.code!==te.OPERATION_ABORTED&&ue.code!==te.UNEXPECTED_RESPONSE||ue.data&&ue.data.retry)&&(_e=m[(Ce+1)%m.length],!0)),b)}(c,r,s,a);this.emit(fs.STATE_CHANGE,ju.AP_CONNECTED);const{addressList:h}=d;return this.wmSequence++,h}async connectWorkerManager(r){let s=arguments.length>1&&arguments[1]!==void 0&&arguments[1];this._needWorkUrlOnly=s,this.emit(fs.STATE_CHANGE,ju.CONNECT_WORKER_MANAGER),await this.workerManagerConnection.init(r,1e4)}async connectWorker(r){await this.workerConnection.init([r])}handleWorkerManagerEvents(){this.workerManagerConnection.on(an.CONNECTED,async()=>{this.emit(fs.STATE_CHANGE,ju.WORKER_MANAGER_CONNECTED,this.workerManagerConnection.url),this.workerManagerConnection.sendMessage({appId:this._connectInfo.appId,cname:this._connectInfo.cname,uid:this._connectInfo.uid+"",sdkVersion:"4.24.0",sid:this._connectInfo.sid,seq:this.wmSequence,ts:Number(Date.now()),requestId:Math.floor(1e12*Math.random()),allocate:!0,clientRequest:{command:"join"}},!0)}),this.workerManagerConnection.on(an.CLOSED,()=>{this._innerConnectionState<ju.GET_WORKER_MANAGER_RESPONSE&&x.debug("[".concat(this._inspectId,"] Inspect worker manager is closed before connecting worker"))}),this.workerManagerConnection.on(an.FAILED,()=>{this._innerConnectionState<ju.GET_WORKER_MANAGER_RESPONSE&&x.debug("[".concat(this._inspectId,"] Connecting inspect worker manager is failed before connecting worker"))}),this.workerManagerConnection.on(an.RECONNECTING,()=>{this._innerConnectionState<ju.GET_WORKER_MANAGER_RESPONSE&&x.debug("[".concat(this._inspectId,"] Inspect worker manager is reconnecting before connecting worker"))}),this.workerManagerConnection.on(an.ON_MESSAGE,async r=>{this.emit(fs.STATE_CHANGE,ju.GET_WORKER_MANAGER_RESPONSE);const s=this.workerManagerConnection.url;this.workerManagerConnection.close();const a=JSON.parse(r.data);if(a.code!==200)throw x.error("[".concat(this._inspectId,"] Unexpected code ").concat(a.code," from worker manager")),new Pe(te.UNEXPECTED_RESPONSE,"response code of worker is unexpected",a);if(!(a.serverResponse&&a.serverResponse.portWss&&s))throw x.error("[".concat(this._inspectId,"] Unexpected content from worker manager : ").concat(JSON.stringify(a))),new Pe(te.UNEXPECTED_RESPONSE,"response content of worker is unexpected",a);{const c=se("VIDEO_INSPECT_WORKER_PORT")||a.serverResponse.portWss,d=s.replace(/:\d+\/?$/,":".concat(c));this.emit(fs.STATE_CHANGE,ju.CONNECT_WORKER,d),this._needWorkUrlOnly?this.emit(fs.REQUEST_NEW_WORKER_URL,d):await this.connectWorker(d)}}),this.workerManagerConnection.on(an.WILL_RECONNECT,(r,s,a)=>{a(r)}),this.workerManagerConnection.on(an.REQUEST_NEW_URLS,(r,s)=>{this.requestAP(this._connectInfo,this._cancelTokenSource.token,this._retryConfig).then(r).catch(s)})}handleWorkerEvents(){this.workerConnection.on(an.CONNECTED,async()=>{this.emit(fs.STATE_CHANGE,ju.WORKER_CONNECTED,this.workerConnection.url),this.connectionState=Fu.CONNECTED}),this.workerConnection.on(an.ON_MESSAGE,async r=>{if(r.data instanceof ArrayBuffer){const a=dEe(new Uint8Array(r.data));if(se("SHOW_VIDEO_INSPECT_WORKER_MESSAGE")&&x.debug("[".concat(this._inspectId,"] Response message for worker of inspect content "),JSON.stringify(a)),a.code===200){if(Array.isArray(this.inspectType)&&this.inspectType.length===1&&this.inspectType[0]==="supervise")return void this.emit(fs.INSPECT_RESULT,void 0,void 0);if(a.data&&a.data.scorePorn&&a.data.scoreSexy&&a.data.scoreNeutral){var s;const c={porn:a.data.scorePorn,sexy:a.data.scoreSexy,neutral:a.data.scoreNeutral},d=Wa(s=Object.keys(c)).call(s,(m,g)=>c[m]>c[g]?m:g,"porn"),h=Object.keys(c).find(m=>m===d);this.emit(fs.INSPECT_RESULT,h)}else this.emit(fs.INSPECT_RESULT,void 0,new Pe(te.UNEXPECTED_RESPONSE,a.code+"","There is an unexpected data on message"))}else this.emit(fs.INSPECT_RESULT,void 0,new Pe(te.UNEXPECTED_RESPONSE,a.code+"",a.msg))}else x.error("[".concat(this._inspectId,"] Unexpected message type from worker")),this.emit(fs.INSPECT_RESULT,void 0,new Pe(te.UNEXPECTED_RESPONSE,"invalid worker message type"))}),this.workerConnection.on(an.CLOSED,()=>{this.connectionState=Fu.CLOSED}),this.workerConnection.on(an.FAILED,()=>{this.connectionState=Fu.CLOSED}),this.workerConnection.on(an.RECONNECTING,()=>{this.connectionState=this.connectionState===Fu.CONNECTED?Fu.RECONNECTING:Fu.CONNECTING}),this.workerConnection.on(an.WILL_RECONNECT,(r,s,a)=>{r==="recover"&&a(r),a("tryNext")}),this.workerConnection.on(an.REQUEST_NEW_URLS,(r,s)=>{this.workerManagerConnection.close(),this.once(fs.REQUEST_NEW_WORKER_URL,a=>{r([a])}),this.requestAP(this._connectInfo,this._cancelTokenSource.token,this._retryConfig).then(a=>{this.connectWorkerManager(a,!0)}).catch(a=>{s(a)})})}async requestToInspectImage(){this.sequence++;const r=Yc(this,fs.CLIENT_LOCAL_VIDEO_TRACK),s={appId:this._connectInfo.appId,cname:this._connectInfo.cname,cid:this._connectInfo.cid,sid:this._connectInfo.sid,uid:this._connectInfo.uid,vid:this._connectInfo.vid};if(r){if(!r.isPlaying)return void this.emit(fs.INSPECT_RESULT,void 0,new Pe(te.INVALID_OPERATION,"Only the track being played can be inspected"));const a=await this.generateRequestData(r,s);this.workerConnection.sendMessage(a,!0,!0)}else this.emit(fs.INSPECT_RESULT,void 0,new Pe(te.INVALID_OPERATION,"Only the track being published can be inspected"))}async generateRequestData(r,s){let{appId:a,cname:c,cid:d,vid:h,sid:m,uid:g}=s;const E=Date.now(),b=await r.getCurrentFrameImage("image/jpeg",this.quality),I=await u9(b,a,c),A=this.sequence+"-"+d+"-"+g+"-"+E+"-"+vr(12,""),k={appId:a,cid:d,cname:c,deviceId:"",elapse:(W=Number(E-this.inspectStartTime),{low:W|=0,high:W>>31,unsigned:W>=0}),fileSize:I.byteLength,jpgEncryption:2,height:b.height,width:b.width,jpg:I,networkType:6,osType:7,requestId:A,sdkVersion:"4.24.0",sequence:this.sequence,sid:m,timestamp:U7(E),uid:g,vid:h,service:this._inspectMode,callbackData:this.extraInfo,ossFilePrefix:this.ossFilePrefix};var W;this.extraInfo===void 0&&delete k.callbackData,this.ossFilePrefix===void 0&&delete k.ossFilePrefix;const j=uEe(k);if(j.byteLength<this.workerMessageLengthLimit){if(se("SHOW_VIDEO_INSPECT_WORKER_MESSAGE")){const B=function(ee){for(var Z=1;Z<arguments.length;Z++){var oe=arguments[Z]!=null?arguments[Z]:{};Z%2?PK(Object(oe),!0).forEach(function(ye){Y(ee,ye,oe[ye])}):Object.getOwnPropertyDescriptors?Object.defineProperties(ee,Object.getOwnPropertyDescriptors(oe)):PK(Object(oe)).forEach(function(ye){Object.defineProperty(ee,ye,Object.getOwnPropertyDescriptor(oe,ye))})}return ee}({},k);delete B.jpg,x.debug("[".concat(this._inspectId,"] Request message for worker of inspect content "),JSON.stringify(B))}return j}{const B=this.quality*this.qualityRatio;return this.quality=B,await this.generateRequestData(r,{appId:a,cname:c,cid:d,vid:h,sid:m,uid:g})}}close(){this._cancelTokenSource.cancel(),this._cancelTokenSource=Sa.CancelToken.source(),this.workerManagerConnection&&this.workerManagerConnection.close(),this.workerConnection&&this.workerConnection.close(),this.inspectTimer&&window.clearInterval(this.inspectTimer),this.inspectTimer=null,this.connectionState=Fu.CLOSED,this.emit(fs.STATE_CHANGE,ju.CLOSED)}}const vEe={name:"ContentInspect",create:function(t){let{config:r}=t;return function(s){if(!s)throw new Pe(te.INVALID_PARAMS,"inspectConfig is necessary.");if(!s.inspectType||!Array.isArray(s.inspectType))throw new Pe(te.INVALID_PARAMS,"inspectConfig.inspectType is necessary and is an instance of Array.");{const a=[...new Set(s.inspectType)];a.forEach(c=>{var d;if(!rt(d=["supervise","moderation"]).call(d,c))throw new Pe(te.INVALID_PARAMS,"".concat(c," is not a valid inspect type."))}),s.inspectType=a}if(s&&s.extraInfo&&s.extraInfo.length>1024)throw new Pe(te.INVALID_PARAMS,"inspectConfig.extraInfo length cannot exceed 1024 bytes")}(r),new EEe(r)}};var kK=l(Ne.Object.getOwnPropertySymbols),SEe=Gn,bEe=yd.indexOf,wEe=o_,FM=ne([].indexOf),OK=!!FM&&1/FM([1],1,-0)<0;SEe({target:"Array",proto:!0,forced:OK||!wEe("indexOf")},{indexOf:function(t){var r=arguments.length>1?arguments[1]:void 0;return OK?FM(this,t,r)||0:bEe(this,t,r)}});var TEe=mc("Array","indexOf"),CEe=N,REe=TEe,jM=Array.prototype,IEe=function(t){var r=t.indexOf;return t===jM||CEe(jM,t)&&r===jM.indexOf?REe:r},NK=l(IEe);function AEe(t,r){if(t==null)return{};var s,a,c=function(h,m){if(h==null)return{};var g={};for(var E in h)if({}.hasOwnProperty.call(h,E)){if(NK(m).call(m,E)!==-1)continue;g[E]=h[E]}return g}(t,r);if(kK){var d=kK(t);for(a=0;a<d.length;a++)s=d[a],NK(r).call(r,s)===-1&&{}.propertyIsEnumerable.call(t,s)&&(c[s]=t[s])}return c}let DK=class{get localCapabilities(){return Kr(this._localCapabilities)}get rtpCapabilities(){return Kr(this._rtpCapabilities)}get candidates(){return Kr(this._candidates)}get iceParameters(){return Kr(this._iceParameters)}get dtlsParameters(){return Kr(this._dtlsParameters)}constructor(t){Y(this,"sessionDesc",void 0),Y(this,"_localCapabilities",void 0),Y(this,"_rtpCapabilities",void 0),Y(this,"_candidates",void 0),Y(this,"_iceParameters",void 0),Y(this,"_dtlsParameters",void 0),Y(this,"setup",void 0),Y(this,"currentMidIndex",void 0),Y(this,"cname","o/i14u9pJrxRKAsu"),Y(this,"firefoxSsrcMidMap",new Map),t=Kr(t);const{remoteIceParameters:r,remoteDtlsParameters:s,candidates:a,remoteRTPCapabilities:c,localCapabilities:d,direction:h,setup:m,videoCodec:g,audioCodec:E}=t;let b;this.setup=m,b=h===na.RECEIVE_ONLY?Ya(`v=0
o=- 0 0 IN IP4 127.0.0.1
s=AgoraGateway
t=0 0
a=group:BUNDLE 0 1
a=msid-semantic: WMS
a=extmap-allow-mixed
m=video 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendonly
a=rtcp-mux
a=rtcp-rsize
a=mid:0
m=audio 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendonly
a=rtcp-mux
a=rtcp-rsize
a=mid:1
`):Ya(`v=0
o=- 0 0 IN IP4 127.0.0.1
s=AgoraGateway
t=0 0
a=group:BUNDLE 0 1
a=msid-semantic: WMS
a=extmap-allow-mixed
m=video 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=recvonly
a=rtcp-mux
a=rtcp-rsize
a=mid:0
m=audio 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=recvonly
a=rtcp-mux
a=rtcp-rsize
a=mid:1
`),this._rtpCapabilities=c,this._candidates=a,this._iceParameters=r,this._dtlsParameters=s,this._localCapabilities=d;const I=h===na.RECEIVE_ONLY?this.rtpCapabilities.send:this.rtpCapabilities.recv,A=h===na.RECEIVE_ONLY?this._localCapabilities.recv:this._localCapabilities.send,k=h===na.RECEIVE_ONLY?c.send.videoCodecs:hT(yt.VIDEO,I,A,g),W=h===na.RECEIVE_ONLY?c.send.audioCodecs:hT(yt.AUDIO,I,A,E);for(const j of b.mediaDescriptions)j.attributes.iceUfrag=r.iceUfrag,j.attributes.icePwd=r.icePwd,j.attributes.fingerprints=s.fingerprints,j.attributes.candidates=a,j.attributes.setup=this.setup,j.media.mediaType==="application"&&(j.attributes.sctpPort="5000"),j.media.mediaType==="video"&&(j.media.fmts=k.map(B=>B.payloadType.toString(10)),j.attributes.payloads=k,j.attributes.extmaps=I.videoExtensions),j.media.mediaType==="audio"&&(j.media.fmts=W.map(B=>B.payloadType.toString(10)),j.attributes.payloads=W,j.attributes.extmaps=I.audioExtensions,u0(j));this.sessionDesc=b,this.currentMidIndex=b.mediaDescriptions.length-1}toString(){return Hm(this.sessionDesc)}hasMid(t){return Array.isArray(t)?t.every(r=>this.hasMid(r)):this.sessionDesc.mediaDescriptions.some(r=>r.attributes.mid===t)}send(t,r,s,a,c){s=s.replace(/ /g,"-");const{ssrcs:d,ssrcGroups:h}=dT(r,this.cname,se("SYNC_GROUP")?s:void 0),m=this.findPreloadMediaDesc(d);if(m){if(ni()&&this.firefoxSsrcMidMap.set(d[0].ssrcId,m.attributes.mid),c&&(c.twcc||c.remb)){const g=this.sessionDesc.mediaDescriptions.indexOf(m);return this.sessionDesc.mediaDescriptions[g]=this.mungSendMediaDesc(m,c),{mid:m.attributes.mid,needExchangeSDP:!0}}return{mid:m.attributes.mid,needExchangeSDP:!1}}{const g=this.findAvailableMediaIndex(t,d,a);let E;return g===-1?(E=this.createOrRecycleSendMedia(t,d,h,"sendonly",a,c),this.updateBundleMids()):(E=Kr(this.sessionDesc.mediaDescriptions[g]),E.attributes.direction="sendonly",E.attributes.ssrcs=d,E.attributes.ssrcGroups=h,this.sessionDesc.mediaDescriptions[g]=this.mungSendMediaDesc(E,c)),ni()&&this.firefoxSsrcMidMap.set(d[0].ssrcId,E.attributes.mid),{needExchangeSDP:!0,mid:E.attributes.mid}}}stopSending(t){const r=this.sessionDesc.mediaDescriptions.filter(s=>s.attributes.mid&&t.indexOf(s.attributes.mid)!==-1);if(r.length!==t.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.stopSending.");r.forEach(s=>{s.attributes.ssrcs=[]}),this.updateBundleMids()}receive(t,r,s){const a=[];return t.forEach(c=>{const d=c._mediaStreamTrack.kind,h=this.findAvailableRecvMediaIndex(d);let m,g=!1;h===-1?(g=!0,m=this.createOrRecycleRecvMedia(c,[],"recvonly",r,s),this.updateBundleMids()):(m=Kr(this.sessionDesc.mediaDescriptions[h]),m.attributes.direction="recvonly"),a.push({mid:m.attributes.mid,needCreateTransceiver:g})}),a}stopReceiving(t){const r=this.sessionDesc.mediaDescriptions.filter(s=>t.indexOf(s.attributes.mid)!==-1);if(r.length!==t.length)throw new Error("MediaDescriptions' length doesn't match mids's length when calling RemoteSDP.receive.");r.forEach(s=>{s.media.port="0",s.attributes.direction="inactive"}),this.updateBundleMids()}addRemoteCandidate(t){const{foundation:r,protocol:s,address:a,port:c,type:d,relatedAddress:h,relatedPort:m,priority:g}=new RTCIceCandidate(t),E={foundation:r??"",componentId:"1",transport:s??"",priority:g?g+"":"",connectionAddress:a??"",port:c?c+"":"",type:d?d+"":"",relAddr:h??"",relPort:m?m+"":"",extension:{}};this.candidates.some(b=>b.priority===E.priority&&b.connectionAddress===E.connectionAddress&&b.port===E.port)||(this._candidates.push(E),this.sessionDesc.mediaDescriptions.forEach(b=>{b.attributes.candidates=this.candidates}))}clearRemoteCandidate(){this._candidates=[],this.sessionDesc.mediaDescriptions[0].attributes.candidates=this._candidates}createOrRecycleRecvMedia(t,r,s,a,c){const d=t._mediaStreamTrack.kind,h=this.rtpCapabilities.recv,m=hT(d,h,this.localCapabilities.send,d===yt.AUDIO?c:a),g=d===yt.VIDEO?h.videoExtensions:h.audioExtensions,E="".concat(++this.currentMidIndex);let b={media:{mediaType:d,port:"9",protos:["UDP","TLS","RTP","SAVPF"],fmts:m.map(A=>A.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:[],extmaps:g,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:r,ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:m,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:s,rtcpMux:!0,rtcpRsize:!0,mid:"".concat(E)}};b=this.mungRecvMediaDsec(b,t);const I=this.findFirstClosedMedia(d);if(I){const A=this.sessionDesc.mediaDescriptions.indexOf(I);this.sessionDesc.mediaDescriptions[A]=b}else this.sessionDesc.mediaDescriptions.push(b);return b}muteRemote(t){const r=this.sessionDesc.mediaDescriptions.filter(s=>rt(t).call(t,s.attributes.mid||""));if(r.length!==t.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");r.forEach(s=>{s.attributes.direction="inactive"})}unmuteRemote(t){const r=this.sessionDesc.mediaDescriptions.filter(s=>rt(t).call(t,s.attributes.mid||""));if(r.length!==t.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");r.forEach(s=>{s.attributes.direction="recvonly"})}findAvailableMediaIndex(t,r,s){return this.sessionDesc.mediaDescriptions.findIndex(a=>{const c=a.media.mediaType===t&&a.media.port!=="0"&&(a.attributes.direction==="sendonly"||a.attributes.direction==="sendrecv")&&a.attributes.ssrcs.length===0;if(ni()){if(c){const d=this.firefoxSsrcMidMap.get(r[0].ssrcId);return!(d||a.attributes.mid!=="0"&&a.attributes.mid!=="1")||!(!d||d!==a.attributes.mid)}return!1}return c&&a.attributes.mid===s})}findAvailableRecvMediaIndex(t){return this.sessionDesc.mediaDescriptions.findIndex(r=>{const s=r.media.mediaType===t&&r.media.port!=="0"&&(r.attributes.direction==="recvonly"||r.attributes.direction==="sendrecv");return r.attributes.mid!=="0"&&r.attributes.mid!=="1"&&s})}predictReceivingMids(t){const r=[];for(let s=0;s<t;s++)r.push((this.currentMidIndex+s+1).toString(10));return r}restartICE(t){t=Kr(t),this._iceParameters=t,this.sessionDesc.mediaDescriptions.forEach(r=>{r.attributes.iceUfrag=t.iceUfrag,r.attributes.icePwd=t.icePwd})}createOrRecycleSendMedia(t,r,s,a,c,d){const h=this.rtpCapabilities.send,m=t===yt.VIDEO?h.videoCodecs:h.audioCodecs,g=t===yt.VIDEO?h.videoExtensions:h.audioExtensions;ni()&&(c="".concat(++this.currentMidIndex));let E={media:{mediaType:t,port:"9",protos:["UDP","TLS","RTP","SAVPF"],fmts:m.map(I=>I.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:[],extmaps:g,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:r,ssrcGroups:s,rtcpFeedbackWildcards:[],payloads:m,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:a,rtcpMux:!0,rtcpRsize:!0,mid:c}};E=this.mungSendMediaDesc(E,d);const b=this.findFirstClosedMedia(t);if(b){const I=this.sessionDesc.mediaDescriptions.indexOf(b);this.sessionDesc.mediaDescriptions[I]=E}else this.sessionDesc.mediaDescriptions.push(E);return E}mungRecvMediaDsec(t,r,s){const a=Kr(t);return F2(a),l0(a,r),j2(a,r),IH(a),KP(a,s,this.localCapabilities.send),a}mungSendMediaDesc(t,r){const s=Kr(t);return KP(s,r,this.localCapabilities.recv),u0(s),s}updateRecvMedia(t,r){const s=this.sessionDesc.mediaDescriptions.findIndex(a=>a.attributes.mid===t);if(s!==-1){const a=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[s],r);this.sessionDesc.mediaDescriptions[s]=a}}updateBundleMids(){this.sessionDesc.attributes.groups[0].identificationTag=this.sessionDesc.mediaDescriptions.filter(t=>t.media.port!=="0").map(t=>t.attributes.mid)}findPreloadMediaDesc(t){return this.sessionDesc.mediaDescriptions.find(r=>{var s;return((s=r.attributes)===null||s===void 0||(s=s.ssrcs[0])===null||s===void 0?void 0:s.ssrcId)===t[0].ssrcId})}findFirstClosedMedia(t){return this.sessionDesc.mediaDescriptions.find(r=>ni()?r.media.port==="0"&&r.media.mediaType===t:r.media.port==="0")}};const PEe=["sdp"];var xr;function xK(t,r){var s=Object.keys(t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);r&&(a=a.filter(function(c){return Object.getOwnPropertyDescriptor(t,c).enumerable})),s.push.apply(s,a)}return s}function ug(t){for(var r=1;r<arguments.length;r++){var s=arguments[r]!=null?arguments[r]:{};r%2?xK(Object(s),!0).forEach(function(a){Y(t,a,s[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(s)):xK(Object(s)).forEach(function(a){Object.defineProperty(t,a,Object.getOwnPropertyDescriptor(s,a))})}return t}let LK=(xr=class U0 extends lH{get currentLocalDescription(){return this.peerConnection.currentLocalDescription}get currentRemoteDescription(){return this.peerConnection.currentRemoteDescription}get peerConnectionState(){return this.peerConnection.connectionState}get iceConnectionState(){return this.peerConnection.iceConnectionState}get dtlsTransportState(){var r,s;return(r=(s=this.peerConnection.getReceivers()[0])===null||s===void 0||(s=s.transport)===null||s===void 0?void 0:s.state)!==null&&r!==void 0?r:null}get localCodecs(){return[]}set isInRestartIce(r){this._isInRestartIce=r}get isInRestartIce(){return this._isInRestartIce}constructor(r,s,a){super(r,s),Y(this,"direction",void 0),Y(this,"name",void 0),Y(this,"store",void 0),Y(this,"spec",void 0),Y(this,"peerConnection",void 0),Y(this,"initialOffer",void 0),Y(this,"transport",void 0),Y(this,"statsFilter",void 0),Y(this,"localCandidateCount",0),Y(this,"_isInRestartIce",!1),Y(this,"mutex",void 0),Y(this,"onLocalCandidate",void 0),Y(this,"remoteSDP",void 0),Y(this,"pendingCandidates",[]),Y(this,"localCapabilities",void 0),Y(this,"isReady",!1),Y(this,"restartCnt",0),Y(this,"curTurnServerIndex",0),this.store=s,this.spec=r,this.mutex=new Ys("P2PConnection-mutex",s.clientId),this.peerConnection=new RTCPeerConnection(U0.resolvePCConfiguration(r,s.p2pTransport),{optional:[{googDscp:!0}]}),this.direction=a??na.SEND_ONLY,this.name=this.direction===na.SEND_ONLY?"sendP2PConnection":"recvP2PConnection",this.statsFilter=qL(this.peerConnection,se("STATS_UPDATE_INTERVAL"),void 0,ni()?1200:void 0),this.bindPCEvents(),this.bindStatsEvents(),this.store.p2pId=this.store.p2pId+1}async establish(r){try{const s=await PH();if(this.localCapabilities=qP(s),r){const{sdp:a}=r,c=AEe(r,PEe),d=function(){const b={audioCodecs:[],videoCodecs:[],audioExtensions:[],videoExtensions:[]},I=uT(arguments.length>2?arguments[2]:void 0,arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},"sendonly"),A={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},k={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},W={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]};if(Bu(I,b,"videoExtensions",A,k,W),Bu(I,b,"videoCodecs",A,k,W),Bu(I,b,"audioExtensions",A,k,W),Bu(I,b,"audioCodecs",A,k,W),se("RAISE_H264_BASELINE_PRIORITY")){const j=W.videoCodecs.findIndex(B=>B.rtpMap&&B.rtpMap.encodingName.toLocaleLowerCase()==="h264"&&B.fmtp&&B.fmtp.parameters["profile-level-id"]==="42001f");if(j!==-1){const B=W.videoCodecs.findIndex(ee=>ee.rtpMap&&ee.rtpMap.encodingName.toLocaleLowerCase()==="h264");if(B<j){x.debug("raising H264 baseline profile priority");const ee=W.videoCodecs[j];W.videoCodecs.splice(j,1),W.videoCodecs.splice(B,0,ee)}B!==-1&&se("FILTER_SEND_H264_BASELINE")&&(A.videoCodecs=A.videoCodecs.filter(ee=>!(ee.rtpMap&&ee.rtpMap.encodingName.toLocaleLowerCase()==="h264"&&ee.fmtp&&ee.fmtp.parameters["profile-level-id"]!=="42001f")))}}return{send:A,recv:k,sendrecv:W}}({},{},a);this.remoteSDP=new DK({remoteIceParameters:c.iceParameters,remoteDtlsParameters:c.dtlsParameters,candidates:[],remoteRTPCapabilities:d,localCapabilities:this.localCapabilities,direction:this.direction,setup:"actpass",videoCodec:this.store.codec,audioCodec:this.store.audioCodec}),await this.setRemoteDescription({type:"offer",sdp:this.remoteSDP.toString()}),this.isReady=!0;const h=await this.peerConnection.createAnswer();if(!h.sdp)throw new Error("Cannot get answer sdp when trying to establish PeerConnection.");const m=Jm(h.sdp);await this.peerConnection.setLocalDescription(h);const g=await kH({},{},h.sdp);this.localCapabilities=qP(g);const E=this.peerConnection.getTransceivers()[0];return E!=null&&E.receiver&&E.receiver.transport&&this.tryBindTransportEvents(E.receiver.transport),ug(ug({},m),{},{sdp:h.sdp})}{this.peerConnection.addTransceiver("video",{direction:"sendonly"}),this.peerConnection.addTransceiver("audio",{direction:"sendonly"});const a=await this.peerConnection.createOffer();if(!a.sdp)throw new Error("Cannot get initialOffer.sdp when trying to establish PeerConnection.");const c=Jm(a.sdp);return this.initialOffer=a,ug(ug({},c),{},{sdp:a.sdp})}}catch(s){throw new Le(te.GET_LOCAL_CONNECTION_PARAMS_FAILED,s.toString())}}async connect(r){try{if(!this.initialOffer)throw new Error("Cannot establish P2PConnection without initial offer.");await this.peerConnection.setLocalDescription(this.initialOffer);const{sdp:s,iceParameters:a,dtlsParameters:c}=r,d=await kH({},{},s);this.remoteSDP=new DK({remoteIceParameters:a,remoteDtlsParameters:c,candidates:[],remoteRTPCapabilities:d,localCapabilities:this.localCapabilities,direction:this.direction,setup:"active",videoCodec:this.store.codec,audioCodec:this.store.audioCodec}),await this.setRemoteDescription({type:"answer",sdp:this.remoteSDP.toString()});const h=this.peerConnection.getTransceivers()[0];h!=null&&h.sender&&h.sender.transport&&this.tryBindTransportEvents(h.sender.transport)}catch(s){throw new Le(te.EXCHANGE_SDP_FAILED,"P2PConnection.connect failed; ".concat(s.toString()))}}async addRemoteCandidate(r){try{r&&this.pendingCandidates.push(r),this.peerConnection.remoteDescription&&this.isReady&&(this.pendingCandidates.forEach(s=>{this.peerConnection.addIceCandidate(s)}),this.pendingCandidates=[])}catch(s){throw new Le(te.ADD_CANDIDATE_FAILED,"P2PConnection.addRemoteCandidate failed; ".concat(s.toString()))}}send(r,s,a){var c=this;return jl(function*(){const d=yield Fn(c.mutex.lock("From P2PConnection.send"));try{if(!c.remoteSDP)throw new Error("Cannot call P2PConnection.send before remote SDP created");const h=[],m=c.remoteSDP.receive(r,s,a);r.forEach((B,ee)=>{if(m[ee].needCreateTransceiver){const Z=c.peerConnection.addTransceiver(B._mediaStreamTrack,{direction:"sendonly"});h.push(Z),B._updateRtpTransceiver(Z)}else{const Z=c.peerConnection.getTransceivers().find(oe=>oe.mid===m[ee].mid);if(!Z)throw new Error("cannot find transceiver when sendPeerconnection send, mid is ".concat(m[ee].mid));h.push(Z),B._updateRtpTransceiver(Z)}}),ni()&&se("SIMULCAST")===!0&&(yield Fn(c.applySimulcastForFirefox(h,r)));const g=m.map(B=>B.mid),E=yield Fn(c.peerConnection.createOffer()),b=c.mungSendOfferSDP(E.sdp,r,g),I=Ya(b),A=g.map(B=>{const ee=I.mediaDescriptions.find(Z=>Z.attributes.mid===B);if(!ee)throw new Error("Cannot extract ssrc from mediaDescription.");return TH(ee,se("USE_PUB_RTX"))}),k=h.map((B,ee)=>{const Z=g[ee];return{localSSRC:A[ee],id:Z}});yield Fn(c.peerConnection.setLocalDescription({type:"offer",sdp:b}));try{yield k}catch(B){const ee=c.remoteSDP.toString();throw yield Fn(c.peerConnection.setLocalDescription({type:"offer",sdp:b})),yield Fn(c.peerConnection.setRemoteDescription({type:"answer",sdp:ee})),yield Fn(c.stopSending(g,!0)),B}yield Fn(c.applySimulcastEncodings(h,r)),yield Fn(c.applySendEncodings(h,r));const W=c.remoteSDP.toString(),j=c.logSDPExchange(b,"offer","local","send");return j==null||j(W),yield Fn(c.setRemoteDescription({type:"answer",sdp:W})),h.map((B,ee)=>{const Z=g[ee];return{localSSRC:A[ee],id:Z}})}catch(h){throw h instanceof Le?h:new Le(te.EXCHANGE_SDP_FAILED,"P2PConnection.send failed; ".concat(h.toString()))}finally{d()}})()}async stopSending(r,s){const a=s?void 0:await this.mutex.lock("From P2PConnection.stopSending");try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopSending before remote SDP created");const c=this.peerConnection.getTransceivers().filter(g=>r.indexOf(g.mid)!==-1);if(c.length!==r.length)throw new Error("Transceivers' length (".concat(c.length,") doesn't match mids' length (").concat(r.length,") when trying to call P2PConnection.stopSending."));c.map(g=>{var E;g.direction="inactive",(E=g.stop)===null||E===void 0||E.call(g)});const d=await this.peerConnection.createOffer(),h=this.logSDPExchange(d.sdp||"","offer","local","stopSending");await this.peerConnection.setLocalDescription(d),this.remoteSDP.stopReceiving(r);const m=this.remoteSDP.toString();h==null||h(m),await this.setRemoteDescription({type:"answer",sdp:m})}catch(c){throw new Le(te.EXCHANGE_SDP_FAILED,"P2PConnection.stopSending failed; ".concat(c.toString()))}finally{a&&a()}}async receive(r,s,a,c){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.receive ".concat(r," before remoteSDP created."));const{mid:d,needExchangeSDP:h}=this.remoteSDP.send(r,s,a,c);if(h){const g=this.remoteSDP.toString(),E=this.logSDPExchange(g,"offer","remote","receive");await this.setRemoteDescription({type:"offer",sdp:g});const b=await this.peerConnection.createAnswer(),I=this.mungReceiveAnswerSDP(b.sdp,d,r);E==null||E(I||""),await this.peerConnection.setLocalDescription({type:"answer",sdp:I}),x.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(r," by exchanging SDP."))}else x.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(r," no need to exchange SDP."));const m=this.peerConnection.getTransceivers().find(g=>g.mid===d);if(!m||m.mid===null)throw new Error("Cannot get transceiver after setLocalDescription.");return{track:m.receiver.track,mid:m.mid,transceiver:m}}catch(d){throw new Le(te.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(d.toString()))}}async mockReceive(r,s,a,c){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.receive ".concat(r," before remoteSDP created."));const{mid:d,needExchangeSDP:h}=this.remoteSDP.send(r,s,a,c);if(h){const m=this.remoteSDP.toString(),g=this.logSDPExchange(m,"offer","remote","receive");await this.setRemoteDescription({type:"offer",sdp:m});const E=await this.peerConnection.createAnswer(),b=this.mungReceiveAnswerSDP(E.sdp,d,r);g==null||g(b||""),await this.peerConnection.setLocalDescription({type:"answer",sdp:b}),x.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(r," by exchanging SDP."))}else x.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(r," no need to exchange SDP."))}catch(d){throw new Le(te.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(d.toString()))}}async stopReceiving(r){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopReceiving before remote SDP created.");this.remoteSDP.stopSending(r);const s=this.remoteSDP.toString(),a=this.logSDPExchange(s,"offer","remote","stopReceiving");await this.setRemoteDescription({type:"offer",sdp:s});const c=await this.peerConnection.createAnswer();a==null||a(c.sdp||""),await this.peerConnection.setLocalDescription(c)}catch(s){throw new Le(te.EXCHANGE_SDP_FAILED,"P2PConnection stopReceiving failed; ".concat(s.toString()))}}async restartICE(r){try{if(this.store.p2pTransport===ny.Auto&&(this.store.p2pTransport=ny.SdRtn,jn().supportPCSetConfiguration&&this.peerConnection.setConfiguration(U0.resolvePCConfiguration(this.spec,this.store.p2pTransport))),this.restartCnt>3&&(this.restartCnt=0,jn().supportPCSetConfiguration&&this.peerConnection.setConfiguration(U0.resolvePCConfiguration(this.spec,this.store.p2pTransport,++this.curTurnServerIndex))),!r){this.restartCnt++,this.isReady=!1;const s=await this.peerConnection.createOffer({iceRestart:!0});if(!s.sdp)throw new Error("Cannot restartICE because restart offer SDP does not exist.");const{iceParameters:a}=Jm(s.sdp);return this.store.descriptionStart(),this.direction===na.SEND_ONLY&&await this.peerConnection.setLocalDescription(s),a}if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopReceiving before remote SDP created.");if(this.remoteSDP.restartICE(r),this.store.descriptionStart(),this.direction===na.RECEIVE_ONLY){this.restartCnt++,await this.setRemoteDescription({type:"offer",sdp:this.remoteSDP.toString()});const s=await this.peerConnection.createAnswer();if(!s.sdp)throw new Error("Cannot get answer sdp when trying to iceRestart.");const{iceParameters:a}=Jm(s.sdp);return await this.peerConnection.setLocalDescription(s),a}await this.setRemoteDescription({type:"answer",sdp:this.remoteSDP.toString()}),this.isReady=!0}catch(s){throw new Le(te.EXCHANGE_SDP_FAILED,"P2PConnection stopReceiving failed; ".concat(s.toString()))}}close(){var r;this.peerConnection.close(),this.peerConnection.onicecandidate=null,(r=this.onConnectionStateChange)===null||r===void 0||r.call(this,"closed"),this.tryUnbindTransportEvents(),this.unbindPCEvents(),this.unbindStatsEvents(),this.transport=void 0,this.statsFilter.destroy()}getStats(){return this.statsFilter.getStats()}getRemoteVideoIsReady(r){return this.statsFilter.getVideoIsReady(r)}async updateEncoderConfig(r,s){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.updateEncoderConfig before remote SDP created.");const a=await this.peerConnection.createOffer(),c=this.mungSendOfferSDP(a.sdp,[s],[r]);this.remoteSDP.updateRecvMedia(r,s);const d=this.remoteSDP.toString(),h=this.logSDPExchange(c,"offer","local","updateEncoderConfig");await this.peerConnection.setLocalDescription({type:"offer",sdp:c}),h==null||h(d),await this.peerConnection.setRemoteDescription({type:"answer",sdp:d})}catch(a){throw new Le(te.EXCHANGE_SDP_FAILED,a.toString())}}async updateSendParameters(r,s){const a=this.peerConnection.getTransceivers().filter(c=>c.mid===r);a.length===1&&(this.isVP8Simulcast(s)?ni()||await this.applySimulcastEncodings(a,[s]):await this.applySendEncodings(a,[s]))}setStatsRemoteVideoIsReady(r,s){this.statsFilter.setVideoIsReady2(r,s)}async replaceTrack(r,s){const a=this.peerConnection.getTransceivers().find(c=>c.mid===s);a&&await a.sender.replaceTrack(r._mediaStreamTrack)}async getSelectedCandidatePair(){const r=this.peerConnection.getReceivers();if(r.length>0&&r[0].transport&&r[0].transport.iceTransport&&r[0].transport.iceTransport.getSelectedCandidatePair&&r[0].transport.iceTransport.getSelectedCandidatePair()){const s=r[0].transport.iceTransport,{local:a,remote:c}=s.getSelectedCandidatePair();return{local:ug(ug({},Hh),{},{candidateType:a.type,protocol:a.protocol,address:a.address,port:a.port}),remote:ug(ug({},Hh),{},{candidateType:c.type,protocol:c.protocol,address:c.address,port:c.port})}}return this.statsFilter.getSelectedCandidatePair()}bindPCEvents(){this.peerConnection.oniceconnectionstatechange=()=>{var r,s;rt(r=["connected","completed"]).call(r,this.peerConnection.iceConnectionState)&&(this.isReady=!1),(s=this.onICEConnectionStateChange)===null||s===void 0||s.call(this,this.peerConnection.iceConnectionState)},this.peerConnection.onconnectionstatechange=()=>{var r;this.peerConnection.connectionState==="connected"&&(this.restartCnt=0),(r=this.onConnectionStateChange)===null||r===void 0||r.call(this,this.peerConnection.connectionState)},this.startICECandidate()}startICECandidate(){this.peerConnection.onicecandidate||(this.localCandidateCount=0,this.peerConnection.onicecandidate=r=>{if(r.candidate){var s;r.candidate.candidate&&((s=this.onLocalCandidate)===null||s===void 0||s.call(this,r.candidate.toJSON())),this.localCandidateCount+=1}else x.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] local candidate count"),this.localCandidateCount)})}unbindPCEvents(){this.peerConnection.oniceconnectionstatechange=null,this.peerConnection.onconnectionstatechange=null,this.peerConnection.onsignalingstatechange=null,this.peerConnection.onicecandidateerror=null,this.peerConnection.onicecandidate=null,this.peerConnection.ontrack=null}static resolvePCConfiguration(r,s){let a=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0;const c={iceServers:[]};var d;return r.iceServers?c.iceServers=r.iceServers:r.turnServer&&r.turnServer.mode!=="off"&&(Yw(r.turnServer.servers)?c.iceServers=r.turnServer.servers:(c.iceServers&&c.iceServers.push(...U0.turnServerConfigToIceServers(r.turnServer.servers,s,a)),se("USE_TURN_SERVER_OF_GATEWAY")&&c.iceServers&&r.turnServer.serversFromGateway&&c.iceServers.push(...U0.turnServerConfigToIceServers(r.turnServer.serversFromGateway,s,a)),rt(d=[ny.Relay,ny.SdRtn]).call(d,s)&&(c.iceTransportPolicy="relay"),se("FORCE_TURN_TCP")?c.iceTransportPolicy="relay":r.turnServer.servers.concat(r.turnServer.serversFromGateway||[]).forEach(h=>{h.forceturn&&(c.iceTransportPolicy="relay")}))),se("ENABLE_ENCODED_TRANSFORM")&&jn().supportWebRTCEncodedTransform&&(c.encodedInsertableStreams=!0),x.debug("P2PConnection p2pTransport is ".concat(s)),c}static turnServerConfigToIceServers(r,s){let a=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0;const c=[],d=r.filter(m=>m.tcpport);x.debug("P2PConnection turnServers is ".concat(d,", current index is ").concat(a));const h=d.length>a?d[a]:d[0];switch(s){case ny.SdRtn:const m=r.filter(E=>{var b;return rt(b=E.username).call(b,"glb:")&&E.turnServerURL==E.turnServerURL}),g=m.length>a?m[a]:m[0];g&&(c.push({username:g.username,credential:g.password,credentialType:"password",urls:"turn:".concat(Ym(g.turnServerURL),":").concat(g.tcpport,"?transport=udp")}),c.push({username:g.username,credential:g.password,credentialType:"password",urls:"turns:".concat(Ym(g.turnServerURL),":").concat(g.tcpport,"?transport=tcp")}));break;case ny.Relay:h&&(c.push({username:h.username,credential:h.password,credentialType:"password",urls:"turn:".concat(h.turnServerURL,":").concat(h.tcpport,"?transport=udp")}),c.push({username:h.username,credential:h.password,credentialType:"password",urls:"turns:".concat(Ym(h.turnServerURL),":").concat(h.tcpport,"?transport=tcp")}));break;default:h&&(c.push({username:h.username,credential:h.password,credentialType:"password",urls:"turn:".concat(h.turnServerURL,":").concat(h.tcpport,"?transport=udp")}),c.push({username:h.username,credential:h.password,credentialType:"password",urls:"turns:".concat(Ym(h.turnServerURL),":").concat(h.tcpport,"?transport=tcp")}),c.push({username:h.username,credential:h.password,credentialType:"password",urls:"stun:".concat(h.turnServerURL,":").concat(h.tcpport)}))}return c}tryBindTransportEvents(r){if(r){this.transport=r,r.onstatechange=()=>{var a;r!=null&&r.state&&((a=this.onDTLSTransportStateChange)===null||a===void 0||a.call(this,r.state))},r.onerror=a=>{var c;(c=this.onDTLSTransportError)===null||c===void 0||c.call(this,"error"in a?a.error:a)};const s=r.iceTransport;s&&(s.onstatechange=()=>{const a=r==null?void 0:r.iceTransport.state;var c;a&&((c=this.onICETransportStateChange)===null||c===void 0||c.call(this,a))},s.getSelectedCandidatePair&&(s.onselectedcandidatepairchange=()=>{if(s.getSelectedCandidatePair()){const{local:a,remote:c}=s.getSelectedCandidatePair()||{};if(a&&c){const d=a.address+":"+a.port,h=c.address+":"+c.port;x.info("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] selectedcandidatepairchange: local ").concat(JSON.stringify(uy(d)),", remote ").concat(JSON.stringify(uy(h))))}}}))}}tryUnbindTransportEvents(){this.transport&&(this.transport.onstatechange=null,this.transport.onerror=null,this.transport.iceTransport&&(this.transport.iceTransport.onstatechange=null))}async updateRtpSenderEncodings(r,s){var a;if(s||(s=this.peerConnection.getSenders().find(b=>b.track===r._mediaStreamTrack)),!s)return x.warn("[".concat(r.getTrackId(),"] no rtpSender found}"));if(this.isVP8Simulcast(r))return x.warn("[updateRtpSenderEncodings] Track is VP8 simulcast, please apply simulcast encodings");if(!jn().supportSetRtpSenderParameters)return x.warn("[updateRtpSenderEncodings] Browser not support set rtp-sender parameters");const c={},d={};switch(r._optimizationMode){case"motion":c.degradationPreference="maintain-framerate";break;case"detail":c.degradationPreference="maintain-resolution";break;default:c.degradationPreference="balanced"}if(r._encoderConfig){var h;const{bitrateMax:b,frameRate:I,scaleResolutionDownBy:A}=r._encoderConfig;b&&(d.maxBitrate=1e3*b),rt(h=r._hints).call(h,yr.LOW_STREAM)&&(I&&(d.maxFramerate=Cc(I)),A&&A>=1&&(d.scaleResolutionDownBy=A))}if(se("DSCP_TYPE")&&lf()){var m;const b=se("DSCP_TYPE");rt(m=["very-low","low","medium","high"]).call(m,b)&&(d.networkPriority=b)}const g=s.getParameters(),E=(a=g.encodings)===null||a===void 0?void 0:a[0];ni()&&!E&&(c.encodings=[d]),E&&Object.assign(E,d),Object.assign(g,c),x.debug("[".concat(r.getTrackId(),"] updateRtpSenderEncodings: ").concat(JSON.stringify(g.encodings))),await s.setParameters(g)}async applySendEncodings(r,s){try{if(!jn().supportSetRtpSenderParameters||r.length!==s.length)return;for(let a=0;a<r.length;a++){const c=r[a],d=s[a];d instanceof Dr&&!this.isVP8Simulcast(d)&&await this.updateRtpSenderEncodings(d,c.sender)}}catch{x.debug("[".concat(this.store.clientId,"] Apply RTPSendEncodings failed."))}}mungSendOfferSDP(r,s,a){const c=Ya(r);return s.forEach((d,h)=>{const m=a[h],g=c.mediaDescriptions.find(E=>E.attributes.mid===m);g&&(l0(g,d),AH(g,d,this.store.codec))}),Hm(c)}bindStatsEvents(){this.statsFilter.onFirstAudioReceived=r=>{var s;(s=this.onFirstAudioReceived)===null||s===void 0||s.call(this,r)},this.statsFilter.onFirstVideoReceived=r=>{var s;(s=this.onFirstVideoReceived)===null||s===void 0||s.call(this,r)},this.statsFilter.onFirstAudioDecoded=r=>{var s;(s=this.onFirstAudioDecoded)===null||s===void 0||s.call(this,r)},this.statsFilter.onFirstVideoDecoded=(r,s,a)=>{var c;(c=this.onFirstVideoDecoded)===null||c===void 0||c.call(this,r,s,a)},this.statsFilter.onSelectedLocalCandidateChanged=(r,s)=>{var a;(a=this.onSelectedLocalCandidateChanged)===null||a===void 0||a.call(this,r,s)},this.statsFilter.onSelectedRemoteCandidateChanged=(r,s)=>{var a;(a=this.onSelectedRemoteCandidateChanged)===null||a===void 0||a.call(this,r,s)},this.statsFilter.onFirstVideoDecodedTimeout=r=>{var s;(s=this.onFirstVideoDecodedTimeout)===null||s===void 0||s.call(this,r)}}unbindStatsEvents(){this.statsFilter.onFirstAudioReceived=void 0,this.statsFilter.onFirstVideoReceived=void 0,this.statsFilter.onFirstAudioDecoded=void 0,this.statsFilter.onFirstVideoDecoded=void 0,this.statsFilter.onSelectedLocalCandidateChanged=void 0,this.statsFilter.onSelectedRemoteCandidateChanged=void 0,this.statsFilter.onFirstVideoDecodedTimeout=void 0}async applySimulcastForFirefox(r,s){if(r.length===s.length)for(let g=0;g<r.length;g++){var a,c,d,h,m;const E=r[g],b=s[g];if(b instanceof Dr&&!rt(a=b._hints).call(a,yr.LOW_STREAM)&&(c=b._encoderConfig)!==null&&c!==void 0&&c.bitrateMax&&((d=b._encoderConfig)===null||d===void 0?void 0:d.bitrateMax)>200&&(h=b._scalabilityMode)!==null&&h!==void 0&&h.numSpatialLayers&&((m=b._scalabilityMode)===null||m===void 0?void 0:m.numSpatialLayers)>1&&this.store.codec==="vp8"){const I={},A={high:1e3*(b._encoderConfig.bitrateMax-50),medium:5e4};I.encodings=[{rid:"m",active:!0,maxBitrate:A.medium,scaleResolutionDownBy:4},{rid:"h",active:!0,maxBitrate:A.high}];const k=E.sender.getParameters();await E.sender.setParameters(Object.assign(k,I))}}}async applySimulcastEncodings(r,s){if(!ni()&&r.length===s.length)for(let a=0;a<r.length;a++){const c=s[a];if(c instanceof Dr&&this.isVP8Simulcast(c)){const d=r[a],h={},m={high:1e3*(c._encoderConfig.bitrateMax-50),medium:5e4};h.encodings=[{active:!0,adaptivePtime:!1,networkPriority:"high",priority:"high",maxBitrate:m.high},{active:!0,adaptivePtime:!1,networkPriority:"low",priority:"low",maxBitrate:m.medium,scaleResolutionDownBy:4}];const g=d.sender.getParameters();await d.sender.setParameters(Object.assign(g,h))}}}isVP8Simulcast(r){var s,a,c,d,h;return!!(r instanceof Dr&&se("SIMULCAST")&&this.store.codec==="vp8"&&!rt(s=r._hints).call(s,yr.LOW_STREAM)&&(a=r._encoderConfig)!==null&&a!==void 0&&a.bitrateMax&&((c=r._encoderConfig)===null||c===void 0?void 0:c.bitrateMax)>200&&(d=r._scalabilityMode)!==null&&d!==void 0&&d.numSpatialLayers&&((h=r._scalabilityMode)===null||h===void 0?void 0:h.numSpatialLayers)>1)}logSDPExchange(r,s,a,c){if(se("SDP_LOGGING"))return x.upload("[".concat(this.store.clientId,"] exchanging ").concat(a," ").concat(s," SDP during P2PConnection.").concat(c,`
`),r),s==="offer"?d=>{this.logSDPExchange(d,"answer",a==="local"?"remote":"local",c)}:void 0}async muteLocal(r){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.muteLocal before remote SDP created.");const s=this.peerConnection.getTransceivers().filter(h=>h.mid&&r.indexOf(h.mid)!==-1);if(s.length!==r.length)throw new Error("Transceivers' length doesn't match mids' length.");s.map(h=>{h.direction="inactive"});const a=await this.peerConnection.createOffer(),c=this.logSDPExchange(a.sdp||"","offer","local","muteLocal");await this.peerConnection.setLocalDescription(a),this.remoteSDP.muteRemote(r);const d=this.remoteSDP.toString();c==null||c(d),await this.setRemoteDescription({type:"answer",sdp:d})}catch(s){throw new Le(te.EXCHANGE_SDP_FAILED,"P2PConnection.muteLocal failed; ".concat(s.toString()))}}async unmuteLocal(r){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.unmuteLocal before remote SDP created.");const s=this.peerConnection.getTransceivers().filter(h=>h.mid&&r.indexOf(h.mid)!==-1);if(s.length!==r.length)throw new Error("Transceivers' length doesn't match mids' length.");s.map(async h=>{h.direction="sendonly"});const a=await this.peerConnection.createOffer(),c=this.logSDPExchange(a.sdp||"","offer","local","unmuteLocal");await this.peerConnection.setLocalDescription(a),this.remoteSDP.unmuteRemote(r);const d=this.remoteSDP.toString();c==null||c(d),await this.setRemoteDescription({type:"answer",sdp:d})}catch(s){throw new Le(te.EXCHANGE_SDP_FAILED,"P2PConnection.unmuteLocal failed; ".concat(s.toString()))}}async getRemoteSSRC(r,s){var a;if(s=s??((a=this.currentRemoteDescription)===null||a===void 0?void 0:a.sdp)){var c;const d=(c=Ya(s).mediaDescriptions.find(h=>h.attributes.mid===r))===null||c===void 0?void 0:c.attributes.ssrcs;return d==null?void 0:d[0].ssrcId}}async setRemoteDescription(r){var s;await this.peerConnection.setRemoteDescription(r),rt(s=["connected","completed"]).call(s,this.peerConnection.iceConnectionState)||(this.isReady=!0,this.addRemoteCandidate())}mungReceiveAnswerSDP(r,s,a){const c=Ya(r),d=c.mediaDescriptions.find(h=>h.attributes.mid===s);return d&&a===yt.AUDIO&&d.media.mediaType==="audio"&&u0(d),Hm(c)}},Rt(xr.prototype,"establish",[$u],Object.getOwnPropertyDescriptor(xr.prototype,"establish"),xr.prototype),Rt(xr.prototype,"connect",[$u],Object.getOwnPropertyDescriptor(xr.prototype,"connect"),xr.prototype),Rt(xr.prototype,"receive",[$u],Object.getOwnPropertyDescriptor(xr.prototype,"receive"),xr.prototype),Rt(xr.prototype,"mockReceive",[$u],Object.getOwnPropertyDescriptor(xr.prototype,"mockReceive"),xr.prototype),Rt(xr.prototype,"stopReceiving",[$u],Object.getOwnPropertyDescriptor(xr.prototype,"stopReceiving"),xr.prototype),Rt(xr.prototype,"restartICE",[$u],Object.getOwnPropertyDescriptor(xr.prototype,"restartICE"),xr.prototype),Rt(xr.prototype,"close",[$u],Object.getOwnPropertyDescriptor(xr.prototype,"close"),xr.prototype),Rt(xr.prototype,"updateEncoderConfig",[$u],Object.getOwnPropertyDescriptor(xr.prototype,"updateEncoderConfig"),xr.prototype),Rt(xr.prototype,"updateSendParameters",[$u],Object.getOwnPropertyDescriptor(xr.prototype,"updateSendParameters"),xr.prototype),Rt(xr.prototype,"replaceTrack",[$u],Object.getOwnPropertyDescriptor(xr.prototype,"replaceTrack"),xr.prototype),Rt(xr.prototype,"muteLocal",[$u],Object.getOwnPropertyDescriptor(xr.prototype,"muteLocal"),xr.prototype),Rt(xr.prototype,"unmuteLocal",[$u],Object.getOwnPropertyDescriptor(xr.prototype,"unmuteLocal"),xr.prototype),xr);function $u(t,r,s){const a=t[r];if(typeof a!="function")throw new Error("Cannot use mutex on object property.");return s.value=async function(){const c=this.mutex,d=await c.lock("From P2PConnection.".concat(r));try{for(var h=arguments.length,m=new Array(h),g=0;g<h;g++)m[g]=arguments[g];return await a.apply(this,m)}finally{d()}},s}let Xd=function(t){return t.SEND_ONLY="SEND_ONLY",t.RECEIVE_ONLY="RECEIVE_ONLY",t}({});var MK,UK,VK,FK,jK,BK,zK,WK,GK,HK,$K,qr;function KK(t,r){var s=Object.keys(t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);r&&(a=a.filter(function(c){return Object.getOwnPropertyDescriptor(t,c).enumerable})),s.push.apply(s,a)}return s}function O1(t){for(var r=1;r<arguments.length;r++){var s=arguments[r]!=null?arguments[r]:{};r%2?KK(Object(s),!0).forEach(function(a){Y(t,a,s[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(s)):KK(Object(s)).forEach(function(a){Object.defineProperty(t,a,Object.getOwnPropertyDescriptor(s,a))})}return t}let kEe=(MK=Jd(Xd.SEND_ONLY),UK=Jd(Xd.SEND_ONLY),VK=Jd(),FK=Jd(Xd.RECEIVE_ONLY),jK=Jd(Xd.RECEIVE_ONLY),BK=Jd(Xd.RECEIVE_ONLY),zK=Jd(Xd.RECEIVE_ONLY),WK=Jd(Xd.RECEIVE_ONLY),GK=Jd(Xd.RECEIVE_ONLY),HK=Jd(),$K=Jd(Xd.RECEIVE_ONLY),qr=class extends Jr{get state(){return this._state}set state(t){const r=this._state;this._state=t,this.emit(Vt.StateChange,r,this._state)}constructor(t,r){super(),Y(this,"isPlanB",!1),Y(this,"store",void 0),Y(this,"statsUploader",void 0),Y(this,"sendConnection",void 0),Y(this,"recvConnection",void 0),Y(this,"localTrackMap",new Map),Y(this,"remoteUserMap",new Map),Y(this,"localDataChannels",[]),Y(this,"pendingLocalTracks",[]),Y(this,"pendingRemoteTracks",[]),Y(this,"statsCollector",void 0),Y(this,"dtlsFailedCount",0),Y(this,"sendMutex",void 0),Y(this,"recvMutex",void 0),Y(this,"_state",ir.Disconnected),Y(this,"_restartStates",["disconnected","failed"]),Y(this,"reconnectInterval",void 0),Y(this,"uploadUnplinkStarted",!1),Y(this,"uploadDownlinkStarted",!1),Y(this,"uplinkStateUploadInterval",void 0),Y(this,"downlinkStatsUploadInterval",void 0),Y(this,"handleMuteLocalTrack",async(s,a,c)=>{const d=await this.sendMutex.lock("Locking from P2PChannel2.handleMuteLocalTrack");try{if(!this.sendConnection||this.state!==ir.Connected)return void c(new Le(te.INVALID_OPERATION,"Cannot call P2PChannel2.handleMuteLocalTrack before sendConnection established."));const g=this.filterTobeMutedTracks(s);if(g.length===0)return void a();const E=g.find(k=>k[0]==="videoLowTrack");E&&E[1].track._originMediaStreamTrack.stop(),await this.sendConnection.muteLocal(g.map(k=>{let[,{id:W}]=k;return W}));let b=!1;var h,m;s.trackMediaType==="video"?b=!((h=this.localTrackMap.get(qe.LocalAudioTrack))===null||h===void 0||!h.track._muted):b=((m=this.localTrackMap.get(qe.LocalVideoTrack))===null||m===void 0?void 0:m.id)===void 0;const I=this.createMuteMessage(g);await Er(this,Vt.RequestMuteLocal,I);const A=s.trackMediaType==="video"?qm.MUTE_LOCAL_VIDEO:qm.MUTE_LOCAL_AUDIO;await Er(this,Vt.RequestP2PMuteLocal,{action:A,message:I,isMuteAll:b}),a()}catch(g){c(g)}finally{d()}}),Y(this,"handleUnmuteLocalTrack",async(s,a,c)=>{const d=await this.sendMutex.lock("Locking from P2PChannel2.handleUnmuteLocalTrack");try{if(!this.sendConnection||this.state!==ir.Connected)return void c(new Le(te.INVALID_OPERATION,"Cannot call P2PChannel2.handleUnmuteLocalTrack before sendConnection established."));const h=this.filterTobeUnmutedTracks(s);if(h.length===0)return void a();await this.sendConnection.unmuteLocal(h.map(E=>{let[,{id:b}]=E;return b}));const m=this.createUnmuteMessage(h),g=s.trackMediaType==="video"?qm.UNMUTE_LOCAL_VIDEO:qm.UNMUTE_LOCAL_AUDIO;await Er(this,Vt.RequestP2PMuteLocal,{action:g,message:m}),a()}catch(h){c(h)}finally{d()}}),Y(this,"handleUpdateVideoEncoder",async(s,a,c,d)=>{let h;typeof d=="boolean"&&d||(h=await this.sendMutex.lock("Locking from P2PChannel2.handleUpdateVideoEncoder"));try{const g=this.localTrackMap.get(qe.LocalVideoTrack);if(!this.sendConnection||!g||g.track!==s||this.state!==ir.Connected)return void a();const{id:E,track:b}=g;E&&(await this.sendConnection.updateSendParameters(E,b),await this.sendConnection.updateEncoderConfig(E,b),this.emit(Vt.UpdateVideoEncoder,b)),a()}catch(g){c(g)}finally{var m;(m=h)===null||m===void 0||m()}}),Y(this,"handleUpdateVideoSendParameters",async(s,a,c)=>{const d=await this.sendMutex.lock("Locking from P2PChannel2.handleUpdateVideoSendParameters");try{const h=this.localTrackMap.get(qe.LocalVideoTrack);if(!this.sendConnection||!h||h.track!==s||this.state!==ir.Connected)return void a();const{id:m,track:g}=h;m&&await this.sendConnection.updateSendParameters(m,g),a()}catch(h){c(h)}finally{d()}}),Y(this,"handleReplaceTrack",async(s,a,c,d)=>{let h;x.debug("[".concat(this.store.clientId,"] P2PChannel2 handleReplaceTrack for [track-id-").concat(s.getTrackId(),"]")),typeof d=="boolean"&&d||(h=await this.sendMutex.lock("From P2PChannel2.handleReplaceTrack"));try{var m;const E=Array.from(this.localTrackMap.entries()).find(b=>{let[,{track:I}]=b;return s===I});if(!this.sendConnection||!E||E[1].id===void 0||this.state!==ir.Connected)return void a();if(await((m=this.sendConnection)===null||m===void 0?void 0:m.replaceTrack(s,E[1].id)),E[0]===qe.LocalVideoTrack&&jn().supportDualStreamEncoding){const b=this.localTrackMap.get(qe.LocalVideoLowTrack);if(b){const I=s._mediaStreamTrack.clone();b.track._originMediaStreamTrack.stop(),b.track._mediaStreamTrack=I,b.track._originMediaStreamTrack=I,await new pt((A,k)=>{this.handleReplaceTrack(b.track,A,k,!0)})}}a()}catch(E){c(E)}finally{var g;(g=h)===null||g===void 0||g()}}),Y(this,"handleGetLocalVideoStats",s=>{s(this.statsCollector.getLocalVideoTrackStats())}),Y(this,"handleGetLocalAudioStats",s=>{s(this.statsCollector.getLocalAudioTrackStats())}),Y(this,"handleGetRemoteVideoStats",s=>this.statsCollector.getRemoteVideoTrackStats(s.uid)[s.uid]),Y(this,"handleGetRemoteAudioStats",s=>this.statsCollector.getRemoteAudioTrackStats(s.uid)[s.uid]),this.store=t,this.statsCollector=r,this.statsCollector.addP2PChannel(this),this.statsUploader=new d7(t),this.bindStatsUploaderEvents(),this.sendMutex=new Ys("P2PChannel2-send-mutex",t.clientId),this.recvMutex=new Ys("P2PChannel2-recv-mutex",t.clientId),this.reconnectInterval=window.setInterval(()=>{[this.sendConnection,this.recvConnection].forEach(s=>{s&&(s.iceConnectionState!=="disconnected"&&s.iceConnectionState!=="failed"||this.handleDisconnect(s.direction))})},se("ICE_RESTART_INTERVAL"))}async startP2PConnection(t,r){throw new Le(te.NOT_SUPPORTED,"p2p mode does not support startP2PConnection.")}async connect(t){throw new Le(te.NOT_SUPPORTED,"p2p mode does not support connect.")}async startP2P(t,r){let s;try{if(r){this.recvConnection&&(x.warning("[".concat(this.store.clientId,"] P2PChannel.startP2P reset recvConnection.")),this.recvConnection.close(),this.unbindConnectionEvents(this.recvConnection)),s=await this.recvMutex.lock("From P2PChannel.startP2P"),this.recvConnection=new LK(t,this.store,na.RECEIVE_ONLY),this.bindConnectionEvents(this.recvConnection);const a=await this.recvConnection.establish(r);return{iceParameters:a.iceParameters,dtlsParameters:a.dtlsParameters,sdp:a.sdp}}{this.state=ir.New,this.sendConnection&&(x.warning("[".concat(this.store.clientId,"] P2PChannel.startP2P reset sendConnection.")),this.sendConnection.close(),this.unbindConnectionEvents(this.sendConnection)),s=await this.sendMutex.lock("From P2PChannel.startP2P"),this.sendConnection=new LK(t,this.store),this.store.peerConnectionStart(),this.bindConnectionEvents(this.sendConnection);const a=await this.sendConnection.establish();return{iceParameters:a.iceParameters,dtlsParameters:a.dtlsParameters,sdp:a.sdp}}}finally{s&&s()}}async p2pConnect(t){if(!this.sendConnection)throw new Le(te.UNEXPECTED_ERROR,"Cannot P2PChannel2.p2pConnect before P2PChannel2.startP2PConnection .");this.store.peerConnectionStart(),await this.sendConnection.connect(t),this.statsUploader.startUploadTransportStats(),this.statsUploader.startUploadExtensionUsageStats(),this.state=ir.Connected}async addRemoteCandidate(t,r){if(r===na.RECEIVE_ONLY){if(!this.sendConnection)throw new Le(te.UNEXPECTED_ERROR,"Cannot P2PChannel2.connect before P2PChannel2.addRemoteCandidate .");await this.sendConnection.addRemoteCandidate(t)}else{if(!this.recvConnection)throw new Le(te.UNEXPECTED_ERROR,"Cannot P2PChannel2.connect before P2PChannel2.addRemoteCandidate .");await this.recvConnection.addRemoteCandidate(t)}}publish(t,r,s){var a=this;return jl(function*(){const c=yield Fn(a.sendMutex.lock("From P2PChannel.publish"));try{if(!a.sendConnection||a.state!==ir.Connected){a.throwIfTrackTypeNotMatch(t);const E=t.filter(b=>a.pendingLocalTracks.indexOf(b)===-1);return void(a.pendingLocalTracks=a.pendingLocalTracks.concat(E))}a.store.pubId=a.store.pubId+1,Zs.markPublishStart(a.store.clientId,a.store.pubId);const d=a.filterTobePublishedTracks(t,r,s);if(d.length===0)return void(yield Fn(a.tryToUnmuteAudio(t)));d.forEach(E=>{let{track:b,type:I}=E;const A=Date.now();a.store.publish(b.getTrackId(),I===qe.LocalAudioTrack?"audio":"video",A)}),a.bindLocalTrackEvents(d);const h=yield Fn(a.sendConnection.send(d.map(E=>{let{track:b}=E;return b}),a.store.codec,a.store.audioCodec)),m=(yield Fn(h.next())).value,g=a.createGatewayPublishMessage(d,m);try{yield g}catch(E){throw h.throw(E),(E==null?void 0:E.code)===te.WS_ABORT&&d.forEach(b=>{let{track:I}=b;a.pendingLocalTracks.indexOf(I)===-1&&a.pendingLocalTracks.push(I)}),a.unbindLocalTrackEvents(d),E}yield Fn(h.next()),d.forEach(E=>{let{type:b}=E;a.statsCollector.addLocalStats(b)}),a.statsUploader.startUploadOutboundStats(),a.assignLocalTracks(d,m),d.forEach(E=>{let{track:b,type:I}=E;const A=Date.now();a.store.publish(b.getTrackId(),I===qe.LocalAudioTrack?"audio":"video",void 0,A)}),a.startUploadUplinkState()}finally{c()}})()}async unpublish(t){if(!this.sendConnection||this.state!==ir.Connected)return void(t.length===0?this.pendingLocalTracks.length=0:this.pendingLocalTracks=this.pendingLocalTracks.filter(c=>!rt(t).call(t,c)));const r=this.filterTobeUnpublishedTracks(t);if(r.length===0)return;const s=r.find(c=>c[0]==="videoLowTrack");s&&s[1].track.close();const a=this.createGatewayUnpublishMessage(r);if(await this.sendConnection.stopSending(r.map(c=>{let[,{id:d}]=c;return d})),this.withdrawLocalTracks(r),this.unbindLocalTrackEvents(r.map(c=>{let[d,{track:h}]=c;return{type:d,track:h}})),r.forEach(c=>{let[d]=c;this.statsCollector.removeLocalStats(d)}),this.localTrackMap.size===0&&(this.statsUploader.stopUploadOutboundStats(),this.stopUploadUplinkState()),this.sendConnection&&this.state===ir.Connected)return s&&s[1].track.close(),a;t.forEach(c=>{const d=this.pendingLocalTracks.indexOf(c);d!==-1&&this.pendingLocalTracks.splice(d,1)})}startUploadUplinkState(){if(this.uploadUnplinkStarted)return;this.uploadUnplinkStarted=!0,this.uplinkStateUploadInterval&&window.clearInterval(this.uplinkStateUploadInterval);const t=()=>{const r=[],s=[];Array.from(this.localTrackMap.entries()).forEach(a=>{let[c,{track:d,ssrcs:h}]=a;const m={stream_type:S_e(d,c),ssrcs:h};d._muted||!d._enabled?r.push(m):s.push(m)}),r.length>0&&r.forEach(a=>{Er(this,Vt.RequestMuteLocal,[a])}),s.length>0&&s.forEach(a=>{Er(this,Vt.RequestUnmuteLocal,[a])})};t(),this.uplinkStateUploadInterval=window.setInterval(()=>{t()},3e3)}stopUploadUplinkState(){this.uploadUnplinkStarted&&(this.uploadUnplinkStarted=!1,this.uplinkStateUploadInterval&&window.clearInterval(this.uplinkStateUploadInterval))}publishLowStream(t){return jl(function*(){throw new Le(te.NOT_SUPPORTED,"p2p mode does not support publishLowStream.")})()}async republish(){this.pendingLocalTracks.length>0&&(x.debug("[".concat(this.store.clientId,"] Emit P2PChannelEvents.RequestRePublish to republish tracks.")),await Ms(this,Vt.RequestRePublish,this.pendingLocalTracks),this.emit(Vt.MediaReconnectEnd,this.store.uid),this.pendingLocalTracks=[])}async unpublishLowStream(){throw new Le(te.NOT_SUPPORTED,"p2p mode does not support unpublishLowStream.")}async subscribe(t,r,s,a){var c;if(!this.recvConnection)throw new Le(te.INVALID_OPERATION,"Cannot subscribe remote user when recvConnection disconnected.");if((c=this.remoteUserMap.get(t))!==null&&c!==void 0&&c.has(r))return;const{track:d,mid:h,transceiver:m}=await this.recvConnection.receive(r,[{ssrcId:s}],String(t.uid),a);r===yt.AUDIO?(t._audioTrack?t._audioTrack._updateOriginMediaStreamTrack(d):(t._audioTrack=new t0(d,t.uid,t._uintid,this.store),x.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote audio track: ").concat(t._audioTrack.getTrackId()))),m&&t._audioTrack._updateRtpTransceiver(m),this.bindRemoteTrackEvents(t,t._audioTrack)):(t._videoSSRC=s,t._videoTrack?t._videoTrack._updateOriginMediaStreamTrack(d):(t._videoTrack=new e0(d,t.uid,t._uintid,this.store),x.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote video track: ").concat(t._videoTrack.getTrackId()))),m&&t._videoTrack._updateRtpTransceiver(m),this.bindRemoteTrackEvents(t,t._videoTrack));const g=this.remoteUserMap.get(t);g?g.set(r,h):this.remoteUserMap.set(t,new Map([[r,h]])),this.statsCollector.addRemoteStats(t.uid),this.statsUploader.startUploadInboundStats(),this.startUploadDownlinkState();const E=this.pendingRemoteTracks.findIndex(b=>{let{user:I,kind:A}=b;return I.uid===t.uid&&r===A});E!==-1&&(this.pendingRemoteTracks.splice(E,1),this.emit(Vt.MediaReconnectEnd,t.uid))}async mockSubscribe(t,r,s,a){if(!this.recvConnection)throw new Le(te.INVALID_OPERATION,"Cannot subscribe remote user when recvConnection disconnected.");await this.recvConnection.mockReceive(r,[{ssrcId:s}],String(t.uid),a)}async unsubscribe(t,r,s){const a=this.pendingRemoteTracks.filter(d=>{let{user:h,kind:m}=d;return r!==void 0?h.uid===t.uid&&r===m:h.uid===t.uid});if(a.forEach(d=>{const h=this.pendingRemoteTracks.indexOf(d);this.pendingRemoteTracks.splice(h,1)}),this.recvConnection||s||a.forEach(d=>{let{kind:h}=d;var m;if(h===yt.AUDIO)(m=t._audioTrack)===null||m===void 0||m._destroy(),t._audioTrack=void 0;else if(h===yt.VIDEO){var g;(g=t._videoTrack)===null||g===void 0||g._destroy(),t._videoTrack=void 0}}),!this.recvConnection)return;const c=this.filterTobeUnSubscribedTracks(t,r);c.length!==0&&(await this.recvConnection.stopReceiving(c.map(d=>{let[,{id:h}]=d;return h})),this.withdrawRemoteTracks(c),this.remoteUserMap.size===0&&(this.statsUploader.stopUploadInboundStats(),this.stopUploadDownlinkState()),c.forEach(d=>{let[h,{kind:m}]=d;var g,E;if(m===yt.VIDEO&&h._videoSSRC&&((g=this.recvConnection)===null||g===void 0||g.setStatsRemoteVideoIsReady(h._videoSSRC,!1)),m===yt.VIDEO)this.unbindRemoteTrackEvents(h._videoTrack),s||((E=h._videoTrack)===null||E===void 0||E._destroy(),h._videoTrack=void 0);else if(m===yt.AUDIO){var b;this.unbindRemoteTrackEvents(h._audioTrack),!s&&((b=h._audioTrack)===null||b===void 0||b._destroy(),h._audioTrack=void 0)}}),c.forEach(d=>{let[,{kind:h}]=d;Er(this,Vt.RequestP2PMuteRemote,h)}))}startUploadDownlinkState(){if(this.uploadDownlinkStarted)return;this.uploadDownlinkStarted=!0,this.downlinkStatsUploadInterval&&window.clearInterval(this.downlinkStatsUploadInterval);const t=()=>Array.from(this.remoteUserMap.entries()).forEach(r=>{let[,s]=r;[yt.VIDEO,yt.AUDIO].forEach(a=>{s.has(a)?Er(this,Vt.RequestP2PUnmuteRemote,a):Er(this,Vt.RequestP2PMuteRemote,a)})});t(),this.downlinkStatsUploadInterval=window.setInterval(()=>{t()},3e3)}stopUploadDownlinkState(){this.uploadDownlinkStarted&&(this.uploadDownlinkStarted=!1,this.downlinkStatsUploadInterval&&window.clearInterval(this.downlinkStatsUploadInterval))}getAllDataChannels(){return this.localDataChannels}async massSubscribe(t){throw new Le(te.NOT_SUPPORTED,"p2p mode does not support massSubscribe.")}async massSubscribeNoLock(t){throw new Le(te.NOT_SUPPORTED,"p2p mode does not support massSubscribeNoLock.")}async massUnsubscribe(t){throw new Le(te.NOT_SUPPORTED,"p2p mode does not support massUnsubscribe.")}async massUnsubscribeNoLock(t){throw new Le(te.NOT_SUPPORTED,"p2p mode does not support massUnsubscribeNoLock.")}async muteRemote(t,r){if(!this.recvConnection)return;const s=this.remoteUserMap.get(t);if(!s)return void x.warning("[".concat(this.store.clientId,"] P2PChannel2.muteRemote has no remote user ").concat(t.uid,"."));if(!s.get(r))return void x.warning("[".concat(this.store.clientId,"] P2PChannel2.muteRemote has no remote user ").concat(t.uid," media type ").concat(r,"."));const a=r===yt.VIDEO?t._videoSSRC:t._audioSSRC;a!==void 0&&this.recvConnection.setStatsRemoteVideoIsReady(a,!1)}async unmuteRemote(t,r){return this.unmuteRemoteNoLock(t,r)}async unmuteRemoteNoLock(t,r){if(!this.recvConnection)return;const s=this.remoteUserMap.get(t);if(!s)return void x.warning("[".concat(this.store.clientId,"] P2PChannel2.unmuteRemote has no remote user ").concat(t.uid,"."));s.get(r)||x.warning("[".concat(this.store.clientId,"] P2PChannel2.unmuteRemote has no remote user ").concat(t.uid," media type ").concat(r,"."))}getAllTracks(t){const r=this.localTrackMap.get(qe.LocalAudioTrack);if((r==null?void 0:r.track)instanceof zi){const s=r.track;return Array.from(this.localTrackMap.entries()).filter(a=>{let[c]=a;return c!==qe.LocalAudioTrack}).filter(a=>{let[c]=a;return!(t&&c===qe.LocalVideoLowTrack)}).map(a=>{let[,{track:c}]=a;return c}).concat(s.trackList)}return Array.from(this.localTrackMap.entries()).filter(s=>{let[a]=s;return!(t&&a===qe.LocalVideoLowTrack)}).map(s=>{let[,{track:a}]=s;return a})}reportPublishEvent(t,r,s,a,c){if(t){const h=this.localTrackMap.get(qe.LocalAudioTrack),m=a?this.localTrackMap.get(qe.LocalVideoLowTrack):this.localTrackMap.get(qe.LocalVideoTrack);At.publish(this.store.sessionId,{eventElapse:Zs.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:t,ec:r,audioName:h==null?void 0:h.track.getTrackLabel(),videoName:m==null?void 0:m.track.getTrackLabel(),screenshare:(m==null?void 0:m.track._hints.indexOf(yr.SCREEN_TRACK))!==-1,audio:!!h,video:!!m,p2pid:this.store.p2pId,publishRequestid:this.store.pubId,extend:c})}else{var d;s||(s=[]);const h=s.find(g=>g instanceof ci),m=a?(d=this.localTrackMap.get(qe.LocalVideoTrack))===null||d===void 0?void 0:d.track:s.find(g=>g instanceof Dr);At.publish(this.store.sessionId,{eventElapse:Zs.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:t,ec:r,audioName:h==null?void 0:h.getTrackLabel(),videoName:m==null?void 0:m.getTrackLabel(),screenshare:(m==null?void 0:m._hints.indexOf(yr.SCREEN_TRACK))!==-1,audio:!!h,video:!!m,p2pid:this.store.p2pId,publishRequestid:this.store.pubId,extend:c})}}reportSubscribeEvent(t,r,s,a){const c=a===yt.VIDEO?s._videoSSRC:s._audioSSRC;c&&At.subscribe(this.store.sessionId,{succ:t,ec:r,video:a===yt.VIDEO,audio:a===yt.AUDIO,peerid:s.uid,subscribeRequestid:a===yt.VIDEO?s._videoSSRC:s._audioSSRC,p2pid:this.store.p2pId,eventElapse:Zs.measureFromSubscribeStart(this.store.clientId,c)})}reset(){x.debug("[".concat(this.store.clientId,"] P2PChannel2.reset")),this.sendMutex=new Ys("P2PChannel2-send-mutex",this.store.clientId),this.sendMutex=new Ys("P2PChannel2-recv-mutex",this.store.clientId),this.sendConnection&&(this.sendConnection.close(),this.unbindConnectionEvents(this.sendConnection),this.sendConnection=void 0),this.recvConnection&&(this.recvConnection.close(),this.unbindConnectionEvents(this.recvConnection),this.recvConnection=void 0),this.statsUploader.stopUploadOutboundStats(),this.statsUploader.stopUploadInboundStats(),this.statsUploader.stopUploadTransportStats(),this.statsUploader.stopUploadExtensionUsageStats(),this.stopUploadUplinkState(),this.stopUploadDownlinkState(),this.unbindLocalTrackEvents(),this.unbindAllRemoteTrackEvents(),this.unbindRtpTransceiver();const t=this.localTrackMap.get(qe.LocalAudioTrack);if((t==null?void 0:t.track)instanceof zi){if(t.track.trackList.length>0){const r=t.track;t.track.trackList.forEach(s=>{r.removeAudioTrack(s)})}t.track.close()}this.localTrackMap.clear(),this.remoteUserMap.clear(),this.statsCollector.removeRemoteStats(),this.statsCollector.removeLocalStats(),this.dtlsFailedCount=0,this.pendingLocalTracks=[],this.pendingRemoteTracks=[],this.reconnectInterval&&(window.clearInterval(this.reconnectInterval),this.reconnectInterval=void 0),this.state=ir.Disconnected}getStats(t){var r,s;return t?(s=this.recvConnection)===null||s===void 0?void 0:s.getStats():(r=this.sendConnection)===null||r===void 0?void 0:r.getStats()}getRemoteVideoIsReady(t){var r;return((r=this.recvConnection)===null||r===void 0?void 0:r.getRemoteVideoIsReady(t))||!1}getLocalAudioVolume(){const t=this.localTrackMap.get(qe.LocalAudioTrack);if(t)return t.track.getVolumeLevel()}getLocalVideoSize(){const t=this.localTrackMap.get(qe.LocalVideoTrack);if(t)return{width:t.track.videoWidth||0,height:t.track.videoHeight||0}}getEncoderConfig(t){const r=this.localTrackMap.get(t);return r&&r.track instanceof Dr||r&&r.track instanceof ci?r.track._encoderConfig:void 0}getLocalMedia(t){return this.localTrackMap.get(t)}hasLocalMedia(){return this.localTrackMap.size>0}hasRemoteMedia(t,r){if(!t)return this.remoteUserMap.size>0;const s=this.remoteUserMap.get(t);return!!s&&(!r||s.has(r))}async hasRemoteMediaWithLock(t,r){if(!t)return this.remoteUserMap.size>0;const s=this.remoteUserMap.get(t);return!!s&&(!r||s.has(r))}getRemoteMedia(t){var r;const s=Array.from(Xa(r=this.remoteUserMap).call(r)).find(a=>a.uid===t);return s?{audioTrack:s.audioTrack,audioSSRC:s._audioSSRC,videoTrack:s.videoTrack,videoSSRC:s._videoSSRC}:{}}getAudioLevels(){let t=Array.from(this.remoteUserMap.entries()).map(s=>{let[a]=s;return{uid:a.uid,level:a.audioTrack?100*a.audioTrack._source.getAccurateVolumeLevel():0}});const r=this.localTrackMap.get(qe.LocalAudioTrack);return r&&t.push({level:100*r.track._source.getAccurateVolumeLevel(),uid:this.store.uid}),t=G_(t).call(t,(s,a)=>s.level-a.level),t}async disconnectForReconnect(){this.sendConnection&&this.recvConnection&&(x.debug("[".concat(this.store.clientId,"] P2PChannel2.disconnectForReconnect closing P2PConnection")),this.state=ir.Reconnecting,se("KEEP_LAST_FRAME")&&this.remoteUserMap.size!==0&&Array.from(this.remoteUserMap.entries()).forEach(t=>{let[r]=t;var s;r._videoTrack&&r._videoTrack._player&&((s=r._videoTrack._player.getVideoElement())===null||s===void 0||s.pause(),r._videoTrack._player.isKeepLastFrame=!0,r._videoTrack._originMediaStreamTrack.stop())}),this.sendConnection.close(),this.unbindConnectionEvents(this.sendConnection),this.sendConnection=void 0,this.recvConnection.close(),this.unbindConnectionEvents(this.recvConnection),this.recvConnection=void 0,this.localTrackMap.size!==0&&(Array.from(this.localTrackMap.entries()).forEach(t=>{var r;let[s,{track:a}]=t;switch(s){case qe.LocalVideoTrack:rt(r=a._hints).call(r,yr.LOW_STREAM)?a.close():this.pendingLocalTracks.push(a);break;case qe.LocalAudioTrack:a instanceof zi?this.pendingLocalTracks=this.pendingLocalTracks.concat(a.trackList):this.pendingLocalTracks.push(a);case qe.LocalVideoLowTrack:}}),this.emit(Vt.MediaReconnectStart,this.store.uid)),this.unbindLocalTrackEvents(),this.localTrackMap.clear(),this.remoteUserMap.size!==0&&Array.from(this.remoteUserMap.entries()).forEach(t=>{let[r,s]=t;Array.from(Xa(s).call(s)).forEach(a=>{this.setPendingRemoteMedia(r,a)}),this.emit(Vt.MediaReconnectStart,r.uid)}),this.unbindAllRemoteTrackEvents(),this.remoteUserMap.clear(),this.stopUploadUplinkState(),this.stopUploadDownlinkState(),this.statsUploader.stopUploadOutboundStats(),this.statsUploader.stopUploadInboundStats(),this.statsUploader.stopUploadTransportStats(),x.debug("[".concat(this.store.clientId,"] P2PChannel2 disconnected, waiting to reconnect.")))}hasPendingRemoteMedia(t,r){for(const s of this.pendingRemoteTracks){const{user:a,kind:c}=s;if((t instanceof tg?t.uid:t)===a.uid&&r===c)return!0}return!1}setPendingRemoteMedia(t,r){this.hasPendingRemoteMedia(t,r)||this.pendingRemoteTracks.push({user:t,kind:r})}async restartICE(t,r){let s,a;if(t===na.SEND_ONLY){if(!this.sendConnection)throw new Le(te.INVALID_OPERATION,"Cannot call P2PChannel2.handleMuteLocalTrack before sendConnection established.");s=await this.sendMutex.lock("From P2PChannel.restartICE"),a=this.sendConnection}else{if(!this.recvConnection)throw new Le(te.INVALID_OPERATION,"Cannot call P2PChannel2.handleMuteLocalTrack before recvConnection established.");s=await this.recvMutex.lock("From P2PChannel.restartICE"),a=this.recvConnection}try{if(r){const c=await a.restartICE(r);return a.isInRestartIce=!1,c}{const c=await a.restartICE();if(c){const d=await Ms(this,Vt.RequestP2PRestartICE,{direction:na.RECEIVE_ONLY,iceParameter:c});await a.restartICE(d),a.isInRestartIce=!1}}}finally{s()}}getUplinkNetworkQuality(){if(!this.sendConnection)return 0;const t=this.sendConnection.getStats(),r=this.localTrackMap.get(qe.LocalVideoTrack),s=this.localTrackMap.get(qe.LocalAudioTrack),a=t.videoSend.find(k=>{var W;return k.ssrc===(r==null||(W=r.ssrcs)===null||W===void 0?void 0:W[0].ssrcId)}),c=t.audioSend.find(k=>{var W;return k.ssrc===(s==null||(W=s.ssrcs)===null||W===void 0?void 0:W[0].ssrcId)});if(!a||!c)return 1;const d=Yc(this,Vt.NeedSignalRTT),h=a?a.rttMs:void 0,m=c?c.rttMs:void 0,g=h&&m?(h+m)/2:h||m,E=(g&&d?(g+d)/2:g||d)||0,b=100*t.sendPacketLossRate*.7/50+.3*E/1500,I=b<.17?1:b<.36?2:b<.59?3:b<.1?4:5,A=r==null?void 0:r.track;if(A&&A._encoderConfig&&A._hints.indexOf(yr.SCREEN_TRACK)===-1){const k=A._encoderConfig.bitrateMax,W=t.bitrate.actualEncoded;if(k&&W){const j=(1e3*k-W)/(1e3*k);return tH[j<.15?0:j<.3?1:j<.45?2:j<.6?3:4][I]}}return I}getDownlinkNetworkQuality(){if(!this.recvConnection)return 0;const t=this.recvConnection.getStats();let r=0;return Array.from(this.remoteUserMap.entries()).forEach(s=>{let[a]=s;const c=a._audioSSRC,d=a._videoSSRC,h=t.audioRecv.find(W=>W.ssrc===c),m=t.videoRecv.find(W=>W.ssrc===d);if(!h&&!m)return void(r+=1);const g=Yc(this,Vt.NeedSignalRTT),E=t.rtt,b=(E&&g?(E+g)/2:E||g)||0,I=h?h.jitterMs:void 0,A=t.recvPacketLossRate;let k=.7*A*100/50+.3*b/1500;I&&(k=.6*A*100/50+.2*b/1500+.2*I/400),r+=k<.1?1:k<.17?2:k<.36?3:k<.59?4:5}),this.remoteUserMap.size>0?Math.round(r/this.remoteUserMap.size):r}async muteLocalTrack(t){return new pt((r,s)=>{this.handleMuteLocalTrack(t,r,s)})}filterTobePublishedTracks(t,r,s){const a=[],c=jn(),d=this.getAllTracks();t=Bv(t=t.filter(g=>d.indexOf(g)===-1));let h=!1,m=!1;for(const g of t){if(g instanceof Dr&&(this.localTrackMap.has(qe.LocalVideoTrack)||h?new Le(te.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS).throw():(a.push({track:g,type:qe.LocalVideoTrack}),h=!0),r)){const E=this.getLowVideoTrack(g,s);a.push({track:E,type:qe.LocalVideoLowTrack})}if(g instanceof ci){const E=this.localTrackMap.get(qe.LocalAudioTrack);if(E){if(!(E.track instanceof zi))throw new Le(te.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser does not support audio mixing");if(g._bypassWebAudio)throw new Le(te.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio");E.track.addAudioTrack(g),this.bindLocalAudioTrackEvents(g,!0)}else if(m){const b=a.find(I=>{let{type:A}=I;return A===qe.LocalAudioTrack});if(!(b.track instanceof zi))throw new Le(te.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser does not support audio mixing");if(g._bypassWebAudio)throw new Le(te.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio");b.track.addAudioTrack(g)}else{if(!c.webAudioMediaStreamDest||g instanceof zi||g._bypassWebAudio)a.push({track:g,type:qe.LocalAudioTrack});else{const b=new zi;b.addAudioTrack(g),a.push({track:b,type:qe.LocalAudioTrack})}m=!0}}}return a}filterTobeUnpublishedTracks(t){const r=[],s=this.getAllTracks();t=Bv(t=t.filter(a=>s.indexOf(a)!==-1));for(const a of t){if(a instanceof ci){const c=this.localTrackMap.get(qe.LocalAudioTrack);if(!c)continue;c.track instanceof zi?(c.track.removeAudioTrack(a),this.unbindLocalAudioTrackEvents(a),c.track.trackList.length===0&&(r.push([qe.LocalAudioTrack,c]),c.track.close())):r.push([qe.LocalAudioTrack,c])}if(a instanceof Dr){const c=this.localTrackMap.get(qe.LocalVideoTrack);if(!c)continue;r.push([qe.LocalVideoTrack,c]);const d=this.localTrackMap.get(qe.LocalVideoLowTrack);d&&r.push([qe.LocalVideoLowTrack,d])}}return r}bindLocalTrackEvents(t){t.forEach(r=>{let{track:s,type:a}=r;switch(a){case qe.LocalVideoTrack:s.addListener(Tt.GET_STATS,this.handleGetLocalVideoStats),s.addListener(Tt.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),s.addListener(Tt.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),s.addListener(Tt.NEED_UPDATE_VIDEO_ENCODER,this.handleUpdateVideoEncoder),s.addListener(Tt.NEED_UPDATE_VIDEO_SEND_PARAMETERS,this.handleUpdateVideoSendParameters),s.addListener(Tt.NEED_REPLACE_TRACK,this.handleReplaceTrack),s.addListener(Tt.NEED_MUTE_TRACK,this.handleMuteLocalTrack),s.addListener(Tt.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack);break;case qe.LocalAudioTrack:this.bindLocalAudioTrackEvents(s);case qe.LocalVideoLowTrack:}})}bindLocalAudioTrackEvents(t,r){t instanceof zi?t.trackList.forEach(s=>{s.addListener(Tt.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),s.addListener(Tt.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),s.addListener(Tt.GET_STATS,this.handleGetLocalAudioStats),s.addListener(Tt.NEED_MUTE_TRACK,this.handleMuteLocalTrack),s.addListener(Tt.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack)}):(t.addListener(Tt.GET_STATS,this.handleGetLocalAudioStats),t.addListener(Tt.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),t.addListener(Tt.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),t.addListener(Tt.NEED_MUTE_TRACK,this.handleMuteLocalTrack),t.addListener(Tt.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack),r||t.addListener(Tt.NEED_REPLACE_TRACK,this.handleReplaceTrack))}unbindLocalTrackEvents(t){t||(t=Array.from(this.localTrackMap.entries()).map(r=>{let[s,{track:a}]=r;return{track:a,type:s}})),t.forEach(r=>{let{track:s,type:a}=r;switch(a){case qe.LocalVideoTrack:s.off(Tt.GET_STATS,this.handleGetLocalVideoStats),s.off(Tt.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),s.off(Tt.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),s.off(Tt.NEED_UPDATE_VIDEO_ENCODER,this.handleUpdateVideoEncoder),s.off(Tt.NEED_UPDATE_VIDEO_SEND_PARAMETERS,this.handleUpdateVideoSendParameters),s.off(Tt.NEED_REPLACE_TRACK,this.handleReplaceTrack),s.off(Tt.NEED_MUTE_TRACK,this.handleMuteLocalTrack),s.off(Tt.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack);break;case qe.LocalAudioTrack:this.unbindLocalAudioTrackEvents(s);case qe.LocalVideoLowTrack:}})}unbindLocalAudioTrackEvents(t){t instanceof zi?t.trackList.forEach(r=>{r.off(Tt.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),r.off(Tt.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),r.off(Tt.GET_STATS,this.handleGetLocalAudioStats),r.off(Tt.NEED_MUTE_TRACK,this.handleMuteLocalTrack),r.off(Tt.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack)}):(t.off(Tt.GET_STATS,this.handleGetLocalAudioStats),t.off(Tt.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),t.off(Tt.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),t.off(Tt.NEED_REPLACE_TRACK,this.handleReplaceTrack),t.off(Tt.NEED_MUTE_TRACK,this.handleMuteLocalTrack),t.off(Tt.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack))}bindRemoteTrackEvents(t,r){r instanceof e0&&r.addListener(Tt.GET_STATS,s=>{s(this.handleGetRemoteVideoStats(t))}),r instanceof t0&&r.addListener(Tt.GET_STATS,s=>{s(this.handleGetRemoteAudioStats(t))})}unbindRemoteTrackEvents(t){t&&t.removeAllListeners(Tt.GET_STATS)}unbindAllRemoteTrackEvents(){Array.from(this.remoteUserMap.entries()).forEach(t=>{let[r,s]=t;s.has(yt.AUDIO)&&this.unbindRemoteTrackEvents(r._audioTrack),s.has(yt.VIDEO)&&this.unbindRemoteTrackEvents(r._videoTrack)})}createGatewayPublishMessage(t,r){return t.map((s,a)=>{var c;let d,{track:h,type:m}=s;switch(m){case qe.LocalAudioTrack:d=or.Audio;break;case qe.LocalVideoTrack:d=rt(c=h._hints).call(c,yr.SCREEN_TRACK)?or.Screen:or.High;break;case qe.LocalVideoLowTrack:d=or.Low}return{kind:m===qe.LocalAudioTrack?yt.AUDIO:yt.VIDEO,stream_type:d,mid:r[a].id,ssrcs:r[a].localSSRC,isMuted:h.muted||!h.enabled}})}createGatewayUnpublishMessage(t){return t.map(r=>{var s;let a,[c,{track:d,ssrcs:h,id:m}]=r;switch(c){case qe.LocalVideoTrack:a=rt(s=d._hints).call(s,yr.SCREEN_TRACK)?or.Screen:or.High;break;case qe.LocalAudioTrack:a=or.Audio;break;case qe.LocalVideoLowTrack:a=or.Low}return{stream_type:a,ssrcs:h,mid:m}})}assignLocalTracks(t,r){t.forEach((s,a)=>{let{track:c,type:d}=s;this.localTrackMap.set(d,{track:c,id:r[a].id,ssrcs:r[a].localSSRC})})}withdrawLocalTracks(t){t.forEach(r=>{let[s]=r;this.localTrackMap.delete(s)})}bindConnectionEvents(t){t.onConnectionStateChange=async r=>{var s;x.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: ").concat(t.name,".onConnectionStateChange(").concat(r,")")),this.emit(Vt.PeerConnectionStateChange,r),r!=="connected"||this.store.keyMetrics.peerConnectionEnd||this.store.peerConnectionEnd(),r==="connected"&&(t.isInRestartIce=!1),rt(s=this._restartStates).call(s,r)&&!t.isInRestartIce&&(r==="disconnected"&&await bs(800),t.iceConnectionState!=="disconnected"&&t.iceConnectionState!=="failed"||this.handleDisconnect(t.direction))},t.onICEConnectionStateChange=r=>{r!=="connected"||this.store.keyMetrics.iceConnectionEnd||this.store.iceConnectionEnd(),x.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICEConnectionStateChange(").concat(r,")")),At.reportApiInvoke(this.store.sessionId,{name:"ICEConnectionStateChange",options:r,tag:$r.TRACER}).onSuccess(),this.emit(Vt.IceConnectionStateChange,r)},t.onICETransportStateChange=r=>{x.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICETransportStateChange(").concat(r,")"))},t.onDTLSTransportStateChange=r=>{x.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onDTLSTransportStateChange(").concat(r,")"))},t.onDTLSTransportError=r=>{x.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onDTLSTransportError(").concat(r,")"))},t.onFirstAudioDecoded=r=>{var s;const a=Array.from(Xa(s=this.remoteUserMap).call(s)).find(d=>d._audioSSRC===r);var c;a&&(this.store.subscribe(a.uid,"audio",void 0,void 0,void 0,Date.now()),(c=a.audioTrack)===null||c===void 0||c.emit(Wl.FIRST_FRAME_DECODED),At.firstRemoteFrame(this.store.sessionId,Xi.FIRST_AUDIO_DECODE,Wr.FIRST_AUDIO_DECODE,{peer:a._uintid,subscribeElapse:Zs.measureFromSubscribeStart(this.store.clientId,r),subscribeRequestid:r,p2pid:this.store.p2pId}))},t.onFirstAudioReceived=r=>{var s;const a=Array.from(Xa(s=this.remoteUserMap).call(s)).find(c=>c._audioSSRC===r);a&&At.firstRemoteFrame(this.store.sessionId,Xi.FIRST_AUDIO_RECEIVED,Wr.FIRST_AUDIO_RECEIVED,{peer:a._uintid,subscribeElapse:Zs.measureFromSubscribeStart(this.store.clientId,r),subscribeRequestid:r,p2pid:this.store.p2pId})},t.onFirstVideoDecoded=(r,s,a)=>{this.reportVideoFirstFrameDecoded(r,s,a)},t.onFirstVideoReceived=r=>{var s;const a=Array.from(Xa(s=this.remoteUserMap).call(s)).find(c=>c._videoSSRC===r);a&&At.firstRemoteFrame(this.store.sessionId,Xi.FIRST_VIDEO_RECEIVED,Wr.FIRST_VIDEO_RECEIVED,{peer:a._uintid,subscribeElapse:Zs.measureFromSubscribeStart(this.store.clientId,r),subscribeRequestid:r,p2pid:this.store.p2pId})},t.onSelectedLocalCandidateChanged=(r,s)=>{const a=r.candidateType==="relay",c=s.candidateType==="relay";s.candidateType!=="unknown"&&a===c||this.emit(Vt.ConnectionTypeChange,a),x.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.SelectedLocalCandidateChanged(").concat(JSON.stringify(Xm(s))," -> ").concat(JSON.stringify(Xm(r)),")"))},t.onSelectedRemoteCandidateChanged=(r,s)=>{x.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.SelectedRemoteCandidateChanged(").concat(JSON.stringify(Xm(s))," -> ").concat(JSON.stringify(Xm(r)),")"))},t.onFirstVideoDecodedTimeout=r=>{this.reportVideoFirstFrameDecoded(r,void 0,void 0,!0)},t.onLocalCandidate=r=>{this.emit(Vt.LocalCandidate,{candidate:r,direction:t.direction})}}unbindConnectionEvents(t){t.onConnectionStateChange=void 0,t.onICEConnectionStateChange=void 0,t.onICETransportStateChange=void 0,t.onDTLSTransportStateChange=void 0,t.onDTLSTransportError=void 0,t.onFirstAudioDecoded=void 0,t.onFirstAudioReceived=void 0,t.onFirstVideoDecoded=void 0,t.onFirstVideoReceived=void 0,t.onSelectedLocalCandidateChanged=void 0,t.onSelectedRemoteCandidateChanged=void 0,t.onFirstVideoDecodedTimeout=void 0,t.onLocalCandidate=void 0}async handleDisconnect(t){const r=t===na.SEND_ONLY?this.sendConnection:this.recvConnection;r&&!r.isInRestartIce&&(r.isInRestartIce=!0,x.debug("[".concat(this.store.clientId,"] [P2PChannel-").concat(r.name,"] start use restartICE")),t===na.SEND_ONLY?this.restartICE(t):Ms(this,Vt.RequestP2PRestartICE,{direction:na.SEND_ONLY}))}filterTobeMutedTracks(t){const r=[];if(this.getAllTracks().indexOf(t)===-1)return r;const s=this.localTrackMap.get(qe.LocalAudioTrack);if(t instanceof ci&&(s==null?void 0:s.track)instanceof zi)return s.track.isActive||r.push([qe.LocalAudioTrack,s]),r;const a=Array.from(this.localTrackMap.entries()).find(c=>{let[,{track:d}]=c;return t===d});if(a&&(r.push(a),a[0]===qe.LocalVideoTrack)){const c=this.localTrackMap.get(qe.LocalVideoLowTrack);c&&r.push([qe.LocalVideoLowTrack,c])}return r}filterTobeUnmutedTracks(t){const r=[],s=this.localTrackMap.get(qe.LocalAudioTrack);if(t instanceof ci&&(s==null?void 0:s.track)instanceof zi)return s.track.isActive&&r.push([qe.LocalAudioTrack,s]),r;const a=Array.from(this.localTrackMap.entries()).find(c=>{let[,{track:d}]=c;return t===d});if(a)if(a[0]===qe.LocalVideoTrack){r.push(a);const c=this.localTrackMap.get(qe.LocalVideoLowTrack);c&&r.push([qe.LocalVideoLowTrack,c])}else r.push(a);return r}createMuteMessage(t){return t.map(r=>{var s;let a,[c,{track:d,ssrcs:h,id:m}]=r;switch(c){case qe.LocalAudioTrack:a=or.Audio;break;case qe.LocalVideoTrack:a=rt(s=d._hints).call(s,yr.SCREEN_TRACK)?or.Screen:or.High;break;case qe.LocalVideoLowTrack:a=or.Low}return{stream_type:a,ssrcs:h,mid:m}})}createUnmuteMessage(t){return t.map(r=>{var s;let a,[c,{track:d,ssrcs:h,id:m}]=r;switch(c){case qe.LocalAudioTrack:a=or.Audio;break;case qe.LocalVideoTrack:a=rt(s=d._hints).call(s,yr.SCREEN_TRACK)?or.Screen:or.High;break;case qe.LocalVideoLowTrack:a=or.Low}return{stream_type:a,ssrcs:h,mid:m}})}filterTobeUnSubscribedTracks(t,r){const s=[],a=this.remoteUserMap.get(t);if(!a)return s;if(r){const c=a.get(r);if(!c)return s;s.push([t,{kind:r,id:c}])}else Array.from(a.entries()).forEach(c=>{let[d,h]=c;s.push([t,{kind:d,id:h}])});return s}createUnsubscribeMessage(t){const r=[];return t.forEach(s=>{let[a,{kind:c,id:d}]=s;switch(c){case yt.VIDEO:return void(a._videoSSRC&&r.push({stream_type:yt.VIDEO,ssrcId:a._videoSSRC}));case yt.AUDIO:return void(a._audioSSRC&&r.push({stream_type:yt.AUDIO,ssrcId:a._audioSSRC}))}}),r}withdrawRemoteTracks(t){t.forEach(r=>{let[s,{kind:a}]=r;const c=this.remoteUserMap.get(s);c&&(c.delete(a),Array.from(c.entries()).length===0&&this.remoteUserMap.delete(s))})}async updateBitrateLimit(t){const r=this.localTrackMap.get(qe.LocalVideoTrack),s=this.localTrackMap.get(qe.LocalVideoLowTrack);r&&(await r.track.setBitrateLimit(t.uplink),await new pt((a,c)=>{this.handleUpdateVideoEncoder(r.track,a,c,!0)})),s&&t.low_stream_uplink&&(await s.track.setBitrateLimit({max_bitrate:t.low_stream_uplink.bitrate,min_bitrate:t.low_stream_uplink.bitrate||0}),await new pt((a,c)=>{this.handleUpdateVideoEncoder(s.track,a,c,!0)}))}isP2PDisconnected(){if(this.sendConnection&&this.recvConnection){const t=this.sendConnection.peerConnectionState,r=this.recvConnection.peerConnectionState;return t!=="connected"&&r!=="connected"}return!0}async tryToUnmuteAudio(t){for(let r=0;r<t.length;r++)if(t[r]instanceof ci){const s=this.filterTobeUnmutedTracks(t[r]);if(s.length===0)continue;const a=this.createUnmuteMessage(s);return void await Er(this,Vt.RequestUnmuteLocal,a)}}bindStatsUploaderEvents(){this.statsUploader.requestStats=t=>this.getStats(t),this.statsUploader.requestLocalMedia=()=>Array.from(this.localTrackMap.entries()).filter(t=>{let[,{ssrcs:r}]=t;return!!r}),this.statsUploader.requestRemoteMedia=()=>Array.from(this.remoteUserMap.entries()),this.statsUploader.requestVideoIsReady=t=>{var r;return!((r=this.recvConnection)===null||r===void 0||!r.getRemoteVideoIsReady(t))},this.statsUploader.requestUpload=(t,r)=>this.emit(Vt.RequestUpload,t,r),this.statsUploader.requestUploadStats=t=>this.emit(Vt.RequestUploadStats,t),this.statsUploader.requestAllTracks=()=>this.getAllTracks()}unbindStatsUploaderEvents(){this.statsUploader.requestStats=void 0,this.statsUploader.requestLocalMedia=void 0,this.statsUploader.requestRemoteMedia=void 0,this.statsUploader.requestVideoIsReady=void 0}async requestReconnect(){this.dtlsFailedCount+=1,await bs(zL(this.dtlsFailedCount,Mi)),this.emit(Vt.RequestReconnect)}async reconnectP2P(){}canPublishLowStream(){return this.localTrackMap.has(qe.LocalVideoTrack)||this.pendingLocalTracks.some(t=>t instanceof Dr)}throwIfTrackTypeNotMatch(t){if(t.filter(r=>r instanceof Dr).length>1)throw new Le(te.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS);if(t.filter(r=>r instanceof ci).length>1&&(t.some(r=>r instanceof ci&&r._bypassWebAudio)||!jn().webAudioMediaStreamDest))throw new Le(te.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser doesn't support MediaStreamDestNode");for(const r of t){if(r instanceof Dr&&this.pendingLocalTracks.some(s=>s instanceof Dr))throw new Le(te.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS);if(r instanceof ci&&this.pendingLocalTracks.some(s=>s instanceof ci)&&(!jn().webAudioMediaStreamDest||r._bypassWebAudio||this.pendingLocalTracks.some(s=>s instanceof ci&&s._bypassWebAudio)))throw new Le(te.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser doesn't support MediaStreamDestNode")}}getLowVideoTrack(t,r){const s=!se("DISABLE_DUAL_STREAM_USE_ENCODING")&&jn().supportDualStreamEncoding,a=O1(O1({},{width:160,height:120,framerate:15,bitrate:50}),r);let c;c=s?t._mediaStreamTrack.clone():iM(t,a);const d=vr(8,"track-low-"),h=new Dr(c,O1(O1({},s&&{scaleResolutionDownBy:V2(a,t)}),{},{frameRate:a.framerate,bitrateMax:a.bitrate,bitrateMin:a.bitrate}),void 0,void 0,d);return h.on(ry.TRANSCEIVER_UPDATED,m=>{t._updateRtpTransceiver(m,qv.LOW_STREAM)}),h._hints.push(yr.LOW_STREAM),t.addListener(Tt.NEED_CLOSE,()=>{h.close()}),h}async globalLock(){return this.recvMutex.lock("From P2PChannel2.globalLock")}reportVideoFirstFrameDecoded(t,r,s,a){var c;const d=Array.from(Xa(c=this.remoteUserMap).call(c)).find(h=>h._videoSSRC===t);if(d){a||this.store.subscribe(d.uid,"video",void 0,void 0,void 0,void 0,Date.now());const h=this.store.keyMetrics,m=h.subscribe.find(g=>g.userId===d.uid&&g.type==="video");At.firstRemoteVideoDecode(this.store.sessionId,Xi.FIRST_VIDEO_DECODE,Wr.FIRST_VIDEO_DECODE,{peer:d._uintid,videowidth:r,videoheight:s,subscribeElapse:Zs.measureFromSubscribeStart(this.store.clientId,t),subscribeRequestid:t,p2pid:this.store.p2pId,apEnd:h.requestAPEnd||0,apStart:h.requestAPStart||0,joinGwEnd:h.joinGatewayEnd||0,joinGwStart:h.joinGatewayStart||0,pcEnd:h.peerConnectionEnd||0,pcStart:h.peerConnectionStart||0,subscriberEnd:(m==null?void 0:m.subscribeEnd)||0,subscriberStart:(m==null?void 0:m.subscribeStart)||0,videoAddNotify:(m==null?void 0:m.streamAdded)||0,state:a?1:0})}}async remoteMediaSsrcChanged(t,r,s){if(!this.recvConnection)return!1;const a=this.remoteUserMap.get(t);if(!a)return!1;const c=a.get(r);if(!c)return!1;const d=await this.recvConnection.getRemoteSSRC(c);return d!==void 0&&d!==s}isPreSubScribe(t){return!1}async publishDataChannel(t){throw new Le(te.NOT_SUPPORTED)}async unpublishDataChannel(t){throw new Le(te.NOT_SUPPORTED)}async subscribeDataChannel(t,r){throw new Le(te.NOT_SUPPORTED)}async unsubscribeDataChannel(t,r){throw new Le(te.NOT_SUPPORTED)}hasPendingRemoteDataChannel(t,r){throw new Le(te.NOT_SUPPORTED)}setPendingRemoteDataChannel(t,r){throw new Le(te.NOT_SUPPORTED)}async preConnect(t){throw new Le(te.NOT_SUPPORTED)}getEstablishParams(){throw new Le(te.NOT_SUPPORTED)}async reSubscribe(t){throw new Le(te.NOT_SUPPORTED)}reportVideoFirstFrameRender(t){}async updateVideoStreamParameter(t,r){throw new Le(te.NOT_SUPPORTED)}unbindRtpTransceiver(){this.localTrackMap.size!==0&&Array.from(this.localTrackMap.entries()).forEach(t=>{let[r,{track:s}]=t;r===qe.LocalVideoLowTrack?s._updateRtpTransceiver(void 0,qv.LOW_STREAM):s._updateRtpTransceiver(void 0)})}},Rt(qr.prototype,"p2pConnect",[MK],Object.getOwnPropertyDescriptor(qr.prototype,"p2pConnect"),qr.prototype),Rt(qr.prototype,"unpublish",[UK],Object.getOwnPropertyDescriptor(qr.prototype,"unpublish"),qr.prototype),Rt(qr.prototype,"unpublishLowStream",[VK],Object.getOwnPropertyDescriptor(qr.prototype,"unpublishLowStream"),qr.prototype),Rt(qr.prototype,"subscribe",[FK],Object.getOwnPropertyDescriptor(qr.prototype,"subscribe"),qr.prototype),Rt(qr.prototype,"mockSubscribe",[jK],Object.getOwnPropertyDescriptor(qr.prototype,"mockSubscribe"),qr.prototype),Rt(qr.prototype,"unsubscribe",[BK],Object.getOwnPropertyDescriptor(qr.prototype,"unsubscribe"),qr.prototype),Rt(qr.prototype,"muteRemote",[zK],Object.getOwnPropertyDescriptor(qr.prototype,"muteRemote"),qr.prototype),Rt(qr.prototype,"unmuteRemote",[WK],Object.getOwnPropertyDescriptor(qr.prototype,"unmuteRemote"),qr.prototype),Rt(qr.prototype,"hasRemoteMediaWithLock",[GK],Object.getOwnPropertyDescriptor(qr.prototype,"hasRemoteMediaWithLock"),qr.prototype),Rt(qr.prototype,"disconnectForReconnect",[HK],Object.getOwnPropertyDescriptor(qr.prototype,"disconnectForReconnect"),qr.prototype),Rt(qr.prototype,"remoteMediaSsrcChanged",[$K],Object.getOwnPropertyDescriptor(qr.prototype,"remoteMediaSsrcChanged"),qr.prototype),qr);function Jd(t){return function(r,s,a){const c=r[s];if(typeof c!="function")throw new Error("Cannot use mutex on object property.");return a.value=async function(){for(var d=arguments.length,h=new Array(d),m=0;m<d;m++)h[m]=arguments[m];switch(t){case Xd.SEND_ONLY:{const g=await this.sendMutex.lock("From P2PChannel2.".concat(s));try{return await c.apply(this,h)}finally{g()}}case Xd.RECEIVE_ONLY:{const g=await this.recvMutex.lock("From P2PChannel2.".concat(s));try{return await c.apply(this,h)}finally{g()}}default:{const g=await this.sendMutex.lock("From P2PChannel2.".concat(s)),E=await this.recvMutex.lock("From P2PChannel2.".concat(s));try{return await c.apply(this,h)}finally{g(),E()}}}},a}}class Sy extends Jr{constructor(r,s){super(),Y(this,"signal",void 0),Y(this,"token",void 0),Y(this,"tokenTimeout",void 0),Y(this,"tokenInterval",void 0),Y(this,"_sequence",0),Y(this,"userMap",new Map),Y(this,"encoder",new TextEncoder),this.signal=r,this.token=s;const a=()=>{this.signal.connectionState===Pr.CONNECTED&&this.check(),this.userMap.size===0?this.tokenInterval=window.setTimeout(a,1e3):this.tokenInterval=window.setTimeout(a,3*se("P2P_TOKEN_INTERVAL"))};a()}async send(r,s,a,c,d){var h;if(this.userMap.size===0)return;const m=Array.from(Sc(h=this.userMap).call(h))[0].token;typeof s!="string"&&(s=JSON.stringify(s)),c=c??vr(6,""),d=d??this._sequence++;const g={_id:c,_type:r,_seq:d,_message:s,token:"".concat(this.token,"_").concat(m)};se("SHOW_P2P_LOG")&&x.debug("send message",g,"noNeedResponse : ".concat(a)),this.splitMessage(JSON.stringify(g)).forEach(b=>{this.signal.request(qt.DATA_STREAM,{payload:Gm(this.encoder.encode(b))})});const E=new pt((b,I)=>{const A=window.setTimeout(()=>{this.off("res-@".concat(c,"_ack"),k),this.off("res-@".concat(c),j),this.off(o0.ABORT,W),x.debug("[external-signal] request timeout, type: ".concat(r,", requestId: ").concat(c)),this.userMap.size===0?I(new Le(te.INVALID_REMOTE_USER)):I(new Le(te.TIMEOUT))},se("EXTERNAL_SIGNAL_REQUEST_TIMEOUT")),k=()=>{A&&window.clearTimeout(A),this.off(o0.ABORT,W),a&&b()},W=()=>{A&&window.clearTimeout(A),this.off("res-@".concat(c,"_ack"),k),this.off("res-@".concat(c),j),I(new Le(te.EXTERNAL_SIGNAL_ABORT,"type: ".concat(r,", requestId: ").concat(c)))};this.once(o0.ABORT,W),this.once("res-@".concat(c,"_ack"),k);const j=(ee,Z)=>{B=!0,A&&window.clearTimeout(A),this.off("res-@".concat(c,"_ack"),k),this.off(o0.ABORT,W),ee==="success"?b(Z):I(new Le(te.P2P_MESSAGE_FAILED,"request ".concat(r," failed, requestId: ").concat(c)))};let B=!1;a||(this.once("res-@".concat(c),j),bs(se("SIGNAL_REQUEST_TIMEOUT")).then(()=>{B||x.warning("external_signal request timeout, type: ".concat(r,", requestId: ").concat(c,", ").concat(g))}))});try{return await E}catch(b){if(b.code===te.TIMEOUT)return await this.send(r,s,a,c,d);throw b}}onMessage(r){var s;const{_uid:a}=r;let c,d=this.userMap.get(a);if(d)c=d.splitMessageMap;else{if(this.userMap.size>0||!("_type"in r)||r._type!==Ei.CHECK)return;const{token:E}=r;c=new Map,d={uid:a,isStart:!0,token:E,splitMessageMap:c,nextExpectedSequenceNumber:0,receivedMessagesMap:new Map},this.userMap.set(a,d),this.signal.emit(An.ON_USER_ONLINE,{uid:a}),this.handleUserOnline()}if("id"in r&&"total"in r){var h;const{id:E,total:b}=r,I=(h=c.get(E))!==null&&h!==void 0?h:[];if(I.push(r),c.has(E)||c.set(E,I),I.length!==b)return;{const A=G_(I).call(I,(k,W)=>k.index-W.index).map(k=>k.payload).join("");c.delete(E),(r=JSON.parse(A))._uid=a}}const{_type:m,token:g}=r;if(rt(s=[Ei.ACK,Ei.CHECK]).call(s,m))return m===Ei.CHECK&&this.handleCheckToken(d,g),void this.receiveMessage(r);g==="".concat(d.token,"_").concat(this.token)?this.handleReceivedMessage(r):x.debug('Receive unexpected message", '.concat(g,", cur_token: ").concat(d.token,"_").concat(this.token),r)}check(){const r={_id:vr(6,""),token:this.token,_type:Ei.CHECK};se("SHOW_P2P_LOG")&&x.debug("send message",r),this.signal.request(qt.DATA_STREAM,{payload:Gm(this.encoder.encode(JSON.stringify(r)))})}ack(r){const s={_id:r,_type:Ei.ACK,token:this.token};se("SHOW_P2P_LOG")&&x.debug("send message",s),this.signal.request(qt.DATA_STREAM,{payload:Gm(this.encoder.encode(JSON.stringify(s)))})}response(r,s,a){this.send(Ei.RESPONSE,JSON.stringify({success:!a,message:s}),!0,r)}handleReceivedMessage(r){const s=()=>{this.userMap.forEach(E=>{const{receivedMessagesMap:b,nextExpectedSequenceNumber:I}=E;for(;b.has(I);){const A=b.get(I);b.delete(I),this.receiveMessage(A),E.nextExpectedSequenceNumber++}})};if(!r)return void s();const{_uid:a,_seq:c}=r,d=this.userMap.get(a),{receivedMessagesMap:h,isStart:m,nextExpectedSequenceNumber:g}=d;if(c<g)return this.ack(r._id),void x.debug("[external-signal] receive old message, seq: ".concat(c,", ").concat(r._message));h.set(c,r),m&&c===g&&(this.receiveMessage(r),h.delete(g),d.nextExpectedSequenceNumber++,s())}receiveMessage(r){const{_id:s,_type:a,_message:c,_uid:d}=r;if(se("SHOW_P2P_LOG")&&x.debug("receive message",r),s){let h;switch(r._type!==Ei.ACK&&(c&&(h=JSON.parse(c)),this.ack(r._id)),r._type){case Ei.CANDIDATE:case Ei.CONTROL:this.signal.emit(a,h,d);break;case Ei.PUBLISH:case Ei.UNPUBLISH:case Ei.RESTART_ICE:case Ei.CALL:h.uid=d,Ms(this.signal,a,h).then(m=>{this.response(r._id,m)}).catch(()=>{this.response(r._id,void 0,!0)});break;case Ei.ACK:this.getListeners("res-@".concat(s,"_ack")).length>0&&this.emit("res-@".concat(s,"_ack"));break;case Ei.RESPONSE:{const{success:m,message:g}=h;this.emit("res-@".concat(s),m?"success":"failed",g);break}}}}splitMessage(r){if(r.length<Sy.MAX_MESSAGE_SIZE)return[r];const s=[],{remoteToken:a}=JSON.parse(r),c=vr(6,"");let d=0,h=800;const m=Math.ceil(r.length/h);for(;r.length>0;){d++;const g={id:c,index:d,total:m,payload:r.slice(0,h),token:"".concat(this.token,"_").concat(a)};JSON.stringify(g).length>Sy.MAX_MESSAGE_SIZE?h-=50:(s.push(g),r=r.slice(h))}return s.map(g=>JSON.stringify(g))}handleCheckToken(r,s){return r.token!==s?(x.debug("token changed, from ".concat(r.token," to ").concat(s)),this.reset(r.uid,s),!1):(this.tokenTimeout&&(window.clearTimeout(this.tokenTimeout),this.tokenTimeout=void 0),this.tokenTimeout=window.setTimeout(()=>{x.debug("token timeout, ".concat(s)),this.reset(r.uid)},se("MAX_P2P_TIMEOUT")),!0)}async handleUserOnline(){const r=await Ms(this.signal,Ei.CALL,void 0),s=await this.send(Ei.CALL,r);this.signal.emit(Jt.P2P_CONNECTION,s,!0)}async reset(r,s){const a=this.userMap.get(r);a&&(this.emit(o0.ABORT),this.signal.emit(An.ON_USER_OFFLINE,{uid:a.uid,reason:Yge.P2P_TOKEN_CHANGED}),this._sequence=0,this.userMap.clear(),s||(x.debug("change local token from ".concat(s," to ").concat(s)),this.token=vr(6,"")))}clear(){this._sequence=0,this.userMap.clear(),this.tokenInterval&&window.clearTimeout(this.tokenInterval),this.tokenInterval=void 0,this.tokenTimeout&&window.clearTimeout(this.tokenTimeout),this.tokenTimeout=void 0,this.emit(o0.ABORT)}}Y(Sy,"MAX_SIZE",1),Y(Sy,"MAX_MESSAGE_SIZE",1024);class OEe extends Jr{get connectionState(){return this._connectionState}set connectionState(r){r!==this._connectionState&&(this._connectionState=r,r===Pr.CONNECTED?this.emit(Jt.WS_CONNECTED):r===Pr.RECONNECTING?this.emit(Jt.WS_RECONNECTING,this._websocketReconnectReason):r===Pr.CLOSED&&this.emit(Jt.WS_CLOSED,this._disconnectedReason))}get currentURLIndex(){return this.websocket.currentURLIndex}get url(){return this.websocket&&this.websocket.url||null}get rtt(){return this.rttRolling.mean()}constructor(r,s){super(),Y(this,"_disconnectedReason",void 0),Y(this,"_websocketReconnectReason",void 0),Y(this,"_connectionState",Pr.CLOSED),Y(this,"reconnectToken",void 0),Y(this,"p2pToken",void 0),Y(this,"websocket",void 0),Y(this,"openConnectionTime",void 0),Y(this,"clientId",void 0),Y(this,"lastMsgTime",Date.now()),Y(this,"uploadCache",[]),Y(this,"uploadCacheInterval",void 0),Y(this,"rttRolling",new wW(5)),Y(this,"pingpongTimer",void 0),Y(this,"pingpongTimeoutCount",0),Y(this,"joinResponse",void 0),Y(this,"multiIpOption",void 0),Y(this,"initError",void 0),Y(this,"spec",void 0),Y(this,"store",void 0),Y(this,"_external_signal",void 0),Y(this,"onWebsocketMessage",a=>{if(a.data instanceof ArrayBuffer)return void this.emit(Jt.ON_BINARY_DATA,a.data);const c=JSON.parse(a.data);if(this.lastMsgTime=Date.now(),Object.prototype.hasOwnProperty.call(c,"_id")){const d="res-@".concat(c._id);this.emit(d,c._result,c._message)}else if(Object.prototype.hasOwnProperty.call(c,"_type")){switch(c._type){case An.ON_DATA_STREAM:return void this.handleDataStream(c._message);case An.MUTE_AUDIO:case An.MUTE_VIDEO:case An.ON_P2P_LOST:case An.ON_USER_ONLINE:return;case An.ON_USER_OFFLINE:const{uid:d}=c._message;return x.debug("[".concat(this.clientId,"] user-offline uid: ").concat(d)),void this._external_signal.reset(d)}if(this.emit(c._type,c._message),c._type===An.ON_NOTIFICATION&&this.handleNotification(c._message),c._type===An.ON_USER_BANNED)switch(c._message.error_code){case 14:this.close(rr.UID_BANNED);break;case 15:this.close(rr.IP_BANNED);break;case 16:this.close(rr.CHANNEL_BANNED)}if(c._type===An.ON_USER_LICENSE_BANNED)switch(c._message.error_code){case zt.ERR_LICENSE_MISSING:this.close(rr.LICENSE_MISSING);break;case zt.ERR_LICENSE_EXPIRED:this.close(rr.LICENSE_EXPIRED);break;case zt.ERR_LICENSE_MINUTES_EXCEEDED:this.close(rr.LICENSE_MINUTES_EXCEEDED);break;case zt.ERR_LICENSE_PERIOD_INVALID:this.close(rr.LICENSE_PERIOD_INVALID);break;case zt.ERR_LICENSE_MULTIPLE_SDK_SERVICE:this.close(rr.LICENSE_MULTIPLE_SDK_SERVICE);break;case zt.ERR_LICENSE_ILLEGAL:this.close(rr.LICENSE_ILLEGAL);break;default:this.close()}}}),this.clientId=r.clientId,this.spec=r,this.store=s,this.websocket=new M2("gateway-".concat(this.clientId),this.spec.retryConfig,!0,se("JOIN_GATEWAY_USE_DUAL_DOMAIN"),se("JOIN_GATEWAY_USE_443PORT_ONLY"),s),this.handleWebsocketEvents(),window.addEventListener("offline",()=>{this.connectionState===Pr.CONNECTED&&this.reconnect("retry",Ls.OFFLINE)}),this.p2pToken=vr(6,""),this._external_signal=new Sy(this,this.p2pToken)}async request(r,s,a,c){const d=vr(6,""),h={_id:d,_type:r,_message:s},m=this.websocket.connectionID,g=()=>new pt((W,j)=>{if(this.connectionState===Pr.CONNECTED)return W();const B=()=>{this.off(Jt.WS_CLOSED,ee),W()},ee=()=>{this.off(Jt.WS_CONNECTED,B),j(new Le(te.WS_ABORT))};this.once(Jt.WS_CONNECTED,B),this.once(Jt.WS_CLOSED,ee)});if(this.connectionState!==Pr.CONNECTING&&this.connectionState!==Pr.RECONNECTING||r===qt.JOIN||r===qt.REJOIN||await g(),this.websocket.sendMessage(h,!0),c)return;const E=new pt((W,j)=>{let B=!1;const ee=(oe,ye)=>{B=!0,W({isSuccess:oe==="success",message:ye||{}}),this.off(Jt.WS_CLOSED,Z),this.off(Jt.WS_RECONNECTING,Z),this.emit(Jt.REQUEST_SUCCESS,r,s)};this.once("res-@".concat(d),ee);const Z=()=>{j(new Le(te.WS_ABORT,"type: ".concat(r))),this.off(Jt.WS_CLOSED,Z),this.off(Jt.WS_RECONNECTING,Z),this.off("res-@".concat(d),ee)};this.once(Jt.WS_CLOSED,Z),this.once(Jt.WS_RECONNECTING,Z),bs(se("SIGNAL_REQUEST_TIMEOUT")).then(()=>{this.websocket.connectionID!==m||B||(x.warning("[".concat(this.clientId,"] ws request timeout, type: ").concat(r)),this.emit(Jt.REQUEST_TIMEOUT,r,s))})});let b=null;try{b=await E}catch(W){if(this.connectionState===Pr.CLOSED||r===qt.LEAVE)throw new Le(te.WS_ABORT);return!this.spec.forceWaitGatewayResponse||a?W.throw():r===qt.JOIN||r===qt.REJOIN?null:(await g(),await this.request(r,s))}if(b.isSuccess)return b.message;const I=Number(b.message.error_code||b.message.code),A=aT(I),k=new Le(te.UNEXPECTED_RESPONSE,"".concat(A.desc,": ").concat(b.message.error_str),{code:I,data:b.message,desc:A.desc});return A.action==="success"?b.message:(x.warning("[".concat(this.clientId,"] [").concat(this.websocket.connectionID,"] unexpected response from type ").concat(r,", error_code: ").concat(I,", message: ").concat(A.desc,", action: ").concat(A.action)),I===zt.ERR_TOO_MANY_BROADCASTERS?((r===qt.JOIN||r===qt.REJOIN)&&(this.initError=k,this.close()),k.throw()):A.action==="failed"?k.throw():A.action==="quit"?(this.initError=k,this.close(),k.throw()):(I===zt.ERR_JOIN_BY_MULTI_IP?(this.multiIpOption=b.message.option,x.warning("[".concat(this.clientId,"] detect multi ip, recover")),this.reconnect("recover",Ls.MULTI_IP)):this.reconnect(A.action,Ls.SERVER_ERROR),r===qt.JOIN||r===qt.REJOIN?null:await this.request(r,s)))}waitMessage(r,s){return new pt(a=>{const c=d=>{(!s||s(d))&&(this.off(r,c),a(d))};this.on(r,c)})}uploadWRTCStats(r){if(!this.store.sessionId)return void x.warn("[".concat(this.clientId,"] no session id when upload wrtc stats"));const s={lts:Date.now(),sid:this.store.sessionId,uid:this.store.intUid,stats:r};this.upload(sT.WRTC_STATS,s)}upload(r,s){const a={_type:r,_message:s};try{this.websocket.sendMessage(a)}catch{const d=se("MAX_UPLOAD_CACHE")||50;this.uploadCache.push(a),this.uploadCache.length>d&&this.uploadCache.splice(0,1),this.uploadCache.length>0&&!this.uploadCacheInterval&&(this.uploadCacheInterval=window.setInterval(()=>{if(this.connectionState!==Pr.CONNECTED)return;const h=this.uploadCache.splice(0,1)[0];this.uploadCache.length===0&&(window.clearInterval(this.uploadCacheInterval),this.uploadCacheInterval=void 0),this.upload(h._type,h._message)},se("UPLOAD_CACHE_INTERVAL")||2e3))}}send(r,s){const a={_type:r,_message:s};this.websocket.sendMessage(a)}async sendExtensionMessage(r,s,a){return await this._external_signal.send(r,s,a)}init(r){return this.initError=void 0,this.multiIpOption=void 0,this.joinResponse=void 0,this.reconnectToken=void 0,this.openConnectionTime=void 0,new pt((s,a)=>{this.once(Jt.WS_CONNECTED,()=>s(this.joinResponse)),this.once(Jt.WS_CLOSED,()=>a(this.initError||new Le(te.WS_ABORT))),this.connectionState=Pr.CONNECTING,this.websocket.init(r).catch(a)})}close(r){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.reconnectToken=void 0,this.joinResponse=void 0,this._external_signal.clear(),this._disconnectedReason=r||rr.LEAVE,this.connectionState=Pr.CLOSED,x.debug("[".concat(this.clientId,"] ")+"will close websocket in signal"),this.websocket.close(),this.p2pToken=vr(6,""),this._external_signal.clear(),this._external_signal=new Sy(this,this.p2pToken)}async join(){if(!this.joinResponse){this.emit(Jt.ABORT_P2P_EXECUTION);const r=await Ms(this,Jt.REQUEST_JOIN_INFO),s=await this.request(qt.JOIN,r);if(!s)return this.emit(Jt.REPORT_JOIN_GATEWAY,te.TIMEOUT,this.url||""),!1;this.joinResponse=s,this.emit(Jt.JOIN_RESPONSE,this.joinResponse),this.reconnectToken=this.joinResponse.rejoin_token}return this.connectionState=Pr.CONNECTED,this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(this.handlePingPong.bind(this),3e3),!0}reconnect(r,s){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.websocket.reconnect(r,s)}async downgradeCodec(r){return!1}handleDataStream(r){try{var s;const a=ey(r.payload),c=new TextDecoder().decode(a),d=JSON.parse(c);"total"in d&&"id"in d||rt(s=Object.values(Ei)).call(s,d._type)?(d._uid=r.uid,this._external_signal.onMessage(d)):this.emit(An.ON_DATA_STREAM,r)}catch{this.emit(An.ON_DATA_STREAM,r)}}handleNotification(r){x.debug("[".concat(this.clientId,"] receive notification: "),r);const s=aT(r.code);if(s.action!=="success"){if(s.action!=="failed")return s.action==="quit"?(s.desc==="ERR_REPEAT_JOIN_CHANNEL"&&this.close(rr.UID_BANNED),void this.close()):void this.reconnect(s.action,Ls.SERVER_ERROR);x.error("[".concat(this.clientId,"] ignore error: "),s.desc)}}handlePingPong(){if(!this.websocket||this.websocket.state!=="connected")return;this.pingpongTimeoutCount>0&&this.rttRolling.add(3e3),this.pingpongTimeoutCount+=1;const r=se("PING_PONG_TIME_OUT"),s=Date.now();this.pingpongTimeoutCount>=r&&(x.warning("[".concat(this.clientId,"] PINGPONG Timeout. Last Socket Message: ").concat(s-this.lastMsgTime,"ms")),s-this.lastMsgTime>se("WEBSOCKET_TIMEOUT_MIN"))?this.reconnect("retry",Ls.TIMEOUT):this.request(qt.PING,void 0,!0).then(()=>{this.pingpongTimeoutCount=0;const a=Date.now()-s;this.rttRolling.add(a),se("REPORT_STATS")&&this.send(qt.PING_BACK,{pingpongElapse:a})}).catch(a=>{})}handleWebsocketEvents(){this.websocket.on(an.RECONNECT_CREATE_CONNECTION,r=>{this.emit(Jt.WS_RECONNECT_CREATE_CONNECTION,r)}),this.websocket.on(an.ON_MESSAGE,this.onWebsocketMessage),this.websocket.on(an.CLOSED,()=>{this.connectionState=Pr.CLOSED}),this.websocket.on(an.FAILED,()=>{this._disconnectedReason=rr.NETWORK_ERROR,this.connectionState=Pr.CLOSED}),this.websocket.on(an.RECONNECTING,r=>{this._websocketReconnectReason=r,this.joinResponse=void 0,this.connectionState===Pr.CONNECTED?this.connectionState=Pr.RECONNECTING:this.connectionState=Pr.CONNECTING}),this.websocket.on(an.WILL_RECONNECT,(r,s,a)=>{r!=="retry"?(x.debug("".concat(this.clientId," websocket will_connect event, renewSession reconnectMode is ").concat(r)),this.reconnectToken=void 0):x.debug("".concat(this.clientId," reconnect mode is retry, no need to renew session")),a(r)}),this.websocket.on(an.CONNECTED,()=>{this.openConnectionTime=Date.now(),this.join().catch(r=>{if(this.emit(Jt.REPORT_JOIN_GATEWAY,r,this.url||""),r instanceof Le&&r.code===te.UNEXPECTED_RESPONSE&&r.data.code===zt.ERR_NO_AUTHORIZED)return x.warning("[".concat(this.clientId,"] reconnect no authorized, recover")),void this.reconnect("recover",Ls.SERVER_ERROR);x.error("[".concat(this.clientId,"] join gateway request failed"),r.toString()),this.spec.forceWaitGatewayResponse?this.reconnect("tryNext",Ls.SERVER_ERROR):(this.initError=r,this.close())})}),this.websocket.on(an.REQUEST_NEW_URLS,(r,s)=>{Ms(this,Jt.REQUEST_RECOVER,this.multiIpOption).then(r).catch(s)}),this.websocket.on(an.ON_TOKEN_PRIVILEGE_DID_EXPIRE,()=>{this.emit(An.ON_TOKEN_PRIVILEGE_DID_EXPIRE)})}}const NEe={name:"P2PChannel",create:function(t){let{store:r,statsCollector:s}=t;return new kEe(r,s)},createSubmodule:function(t){let{store:r,spec:s}=t;return new OEe(s,r)}};function qK(t,r){var s=Object.keys(t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);r&&(a=a.filter(function(c){return Object.getOwnPropertyDescriptor(t,c).enumerable})),s.push.apply(s,a)}return s}function YK(t){for(var r=1;r<arguments.length;r++){var s=arguments[r]!=null?arguments[r]:{};r%2?qK(Object(s),!0).forEach(function(a){Y(t,a,s[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(s)):qK(Object(s)).forEach(function(a){Object.defineProperty(t,a,Object.getOwnPropertyDescriptor(s,a))})}return t}class DEe{constructor(r){Y(this,"sessionDesc",void 0),Y(this,"localCapabilities",void 0),Y(this,"rtpCapabilities",void 0),Y(this,"candidates",void 0),Y(this,"_originCandidates",void 0),Y(this,"iceParameters",void 0),Y(this,"dtlsParameters",void 0),Y(this,"setup",void 0),Y(this,"currentMidIndex",void 0),Y(this,"cname",void 0),r=Kr(r);const{iceParameters:s,dtlsParameters:a,candidates:c,rtpCapabilities:d,setup:h,localCapabilities:m,sdkCodec:g,cname:E}=r,b=Ya(`v=0
o=- 0 0 IN IP4 127.0.0.1
s=AgoraGateway
t=0 0
a=group:BUNDLE audio video
a=msid-semantic: WMS
a=ice-lite
m=audio 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendrecv
a=rtcp-mux
a=rtcp-rsize
a=mid:audio
m=video 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendrecv
a=rtcp-mux
a=rtcp-rsize
a=mid:video
`);this.rtpCapabilities=d,this.candidates=c,this._originCandidates=Kr(c),this.iceParameters=s,this.dtlsParameters=a,this.setup=h,this.localCapabilities=m,this.cname=E;for(let I=0;I<b.mediaDescriptions.length;I++){const A=b.mediaDescriptions[I];if(A.attributes.iceUfrag=s.iceUfrag,A.attributes.icePwd=s.icePwd,A.attributes.fingerprints=a.fingerprints,A.attributes.candidates=c,A.attributes.setup=h,A.media.mediaType==="video"){A.media.fmts=d.videoCodecs.map(j=>j.payloadType.toString(10));const k=d.videoCodecs.filter(j=>{var B,ee;return(B=j.rtpMap)===null||B===void 0?void 0:rt(ee=B.encodingName.toLowerCase()).call(ee,g)}),W=d.videoCodecs.filter(j=>!rt(k).call(k,j));A.attributes.payloads=[...k,...W],A.attributes.extmaps=d.videoExtensions}A.media.mediaType==="audio"&&(A.media.fmts=d.audioCodecs.map(k=>k.payloadType.toString(10)),A.attributes.payloads=d.audioCodecs,A.attributes.extmaps=d.audioExtensions),b.mediaDescriptions[I]=this.mungMediaDesc(A)}this.sessionDesc=b,this.currentMidIndex=b.mediaDescriptions.length-1}toString(){return Hm(this.sessionDesc)}send(r,s,a){const{ssrcs:c,ssrcGroups:d}=dT(s,this.cname),h=this.sessionDesc.mediaDescriptions.find(E=>r===yt.VIDEO?E.media.mediaType==="video":E.media.mediaType==="audio"),m=c[0].attributes.label,g=c[0].attributes.mslabel;return h.attributes.ssrcs=h.attributes.ssrcs.concat(c),h.attributes.ssrcGroups=h.attributes.ssrcGroups.concat(d),{id:m,mslabel:g}}batchSend(r){return r.map(s=>{let{kind:a,ssrcMsg:c}=s;return this.send(a,c,void 0)})}stopSending(r){this.sessionDesc.mediaDescriptions.forEach(s=>{const a=[],c=[],d=[];s.attributes.ssrcs.forEach(h=>{rt(r).call(r,h.attributes.label||"")?d.push(h):a.push(h)}),s.attributes.ssrcGroups.forEach(h=>{var m;rt(m=d.map(g=>g.ssrcId)).call(m,h.ssrcIds[0])||c.push(h)}),s.attributes.ssrcs=a,s.attributes.ssrcGroups=c})}mute(r){const s=this.sessionDesc.mediaDescriptions.find(a=>a.attributes.mid===r);if(!s)throw new Error("mediaDescription not found with ".concat(r," in remote SDP when calling RemoteSDP.mute."));s.attributes.direction="inactive"}unmute(r){const s=this.sessionDesc.mediaDescriptions.find(a=>a.attributes.mid===r);if(!s)throw new Error("mediaDescription not found with ".concat(r," in remote SDP when calling RemoteSDP.unmute."));s.attributes.direction="sendonly"}receive(r,s,a){r.forEach((c,d)=>{const h=c._mediaStreamTrack,m=this.sessionDesc.mediaDescriptions.findIndex(E=>E.attributes.mid===h.kind),g=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[m],c);this.sessionDesc.mediaDescriptions[m]=g})}stopReceiving(r){}updateCandidates(r){const s=this._originCandidates.filter(c=>c.transport==="udp"),a=[];if(s.forEach(c=>{a.push(YK(YK({},c),{},{foundation:"tcpcandidate",priority:Number(c.priority)-1+"",transport:"tcp",port:Number(c.port)+90+""}))}),s.length!==0){switch(r){case Qs.TCP_RELAY:this.candidates=a;break;case Qs.UDP_TCP_RELAY:case Qs.RELAY:this.candidates=[...s,...a];break;default:this.candidates=s}for(const c of this.sessionDesc.mediaDescriptions)c.attributes.candidates=this.candidates}}restartICE(r){r=Kr(r),this.iceParameters=r,this.sessionDesc.mediaDescriptions.forEach(s=>{s.attributes.iceUfrag=r.iceUfrag,s.attributes.icePwd=r.icePwd})}predictReceivingMids(r){const s=[];for(let a=0;a<r;a++)s.push((this.currentMidIndex+a+1).toString(10));return s}mungRecvMediaDsec(r,s){const a=Kr(r);return l0(a,s),j2(a,s),a}updateRecvMedia(r,s){const a=this.sessionDesc.mediaDescriptions.findIndex(c=>c.attributes.mid===r);if(a!==-1){const c=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[a],s);this.sessionDesc.mediaDescriptions[a]=c}}bumpMid(r){this.currentMidIndex+=r}updateTrackLabel(r,s,a){const c=this.sessionDesc.mediaDescriptions.find(h=>r===yt.VIDEO?h.attributes.mid==="video":h.attributes.mid==="audio");if(c){const h=c.attributes.ssrcs.find(m=>m.attributes.label===s);var d;h&&(h.attributes.label=a,(d=h.attributes.msid)===null||d===void 0||d.replace(s,a))}}mungMediaDesc(r){const s=Kr(r);return F2(s),function(a){const c=a.attributes.extmaps.find(d=>$P(d.extensionName));c&&a.attributes.extmaps.splice(a.attributes.extmaps.indexOf(c),1),a.attributes.payloads.forEach(d=>{const h=d.rtcpFeedbacks.findIndex(m=>m.type==="transport-cc");h!==-1&&d.rtcpFeedbacks.splice(h,1)})}(s),s}getSSRC(r){for(const s of this.sessionDesc.mediaDescriptions)for(const a of s.attributes.ssrcs)if(a.attributes.label===r)return[a]}}var Sr;function XK(t,r){var s=Object.keys(t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);r&&(a=a.filter(function(c){return Object.getOwnPropertyDescriptor(t,c).enumerable})),s.push.apply(s,a)}return s}function N1(t){for(var r=1;r<arguments.length;r++){var s=arguments[r]!=null?arguments[r]:{};r%2?XK(Object(s),!0).forEach(function(a){Y(t,a,s[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(s)):XK(Object(s)).forEach(function(a){Object.defineProperty(t,a,Object.getOwnPropertyDescriptor(s,a))})}return t}let xEe=(Sr=class bC extends uH{get peerConnectionState(){return this.peerConnection.connectionState}get iceConnectionState(){return this.peerConnection.iceConnectionState}get currentLocalDescription(){return this.peerConnection.currentLocalDescription}get currentRemoteDescription(){return this.peerConnection.currentRemoteDescription}get localCodecs(){return[...new Set(this.localCapabilities&&this.localCapabilities.videoCodecs.map(r=>r.rtpMap&&r.rtpMap.encodingName.toLowerCase()||"").filter(r=>{var s;return rt(s=Object.keys(eT)).call(s,r)}))]}constructor(r,s){super(r,s),Y(this,"store",void 0),Y(this,"peerConnection",void 0),Y(this,"remoteSDP",void 0),Y(this,"initialOffer",void 0),Y(this,"statsFilter",void 0),Y(this,"useRTX",!1),Y(this,"localCapabilities",void 0),Y(this,"localCandidateCount",0),Y(this,"allCandidatesReceived",!1),Y(this,"establishPromise",void 0),Y(this,"mutex",void 0),this.store=s,this.mutex=new Ys("P2PConnection-mutex",s.clientId),this.peerConnection=new RTCPeerConnection(bC.resolvePCConfiguration(r),{optional:[{googDscp:!0}]}),this.statsFilter=qL(this.peerConnection,se("STATS_UPDATE_INTERVAL"),void 0,ni()?1200:void 0),this.bindPCEvents(),this.bindStatsEvents(),this.store.p2pId=this.store.p2pId+1,this.establishPromise=this.establish()}async establish(){try{const r=await this.peerConnection.createOffer({offerToReceiveAudio:!0,offerToReceiveVideo:!0});if(!r.sdp)throw new Error("Cannot get initialOffer.sdp when trying to establish PeerConnection.");const s=Jm(r.sdp),a=uT(r.sdp,{filterRTX:!this.useRTX,filterVideoFec:se("FILTER_VIDEO_FEC"),filterAudioFec:se("FILTER_AUDIO_FEC"),filterAudioCodec:["opus"]});return this.localCapabilities=a,this.initialOffer=r,N1(N1({},s),{},{rtpCapabilities:{send:{audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},recv:{audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},sendrecv:a},offerSDP:r.sdp})}catch(r){throw new Le(te.GET_LOCAL_CONNECTION_PARAMS_FAILED,r.toString())}}async updateRemoteConnect(){}async connect(r){try{if(!this.initialOffer)throw new Error("Cannot establish P2PConnection without initial offer.");this.remoteSDP=new DEe(N1(N1({},r),{},{rtpCapabilities:r.rtpCapabilities.send,localCapabilities:this.localCapabilities,sdkCodec:this.store.codec}));const s=this.remoteSDP.toString();await this.peerConnection.setLocalDescription(this.initialOffer),await this.peerConnection.setRemoteDescription({type:"answer",sdp:s})}catch(s){throw new Le(te.EXCHANGE_SDP_FAILED,"P2PConnection.connect failed; ".concat(s.toString()))}}async updateRemoteRTPCapabilities(r,s){throw new Le(te.NOT_SUPPORTED,"Planb mode does not support createDataChannels.")}getPreMedia(r){}send(r,s){var a=this;return jl(function*(){const c=yield Fn(a.mutex.lock());try{if(!a.remoteSDP)throw new Error("Cannot call P2PConnection.send before remote SDP created");const d=r.map(A=>a.peerConnection.addTrack(A._mediaStreamTrack)),h=yield Fn(a.peerConnection.createOffer()),m=Ya(h.sdp),g=r.map(A=>{const k=A._mediaStreamTrack,W=m.mediaDescriptions.find(j=>j.attributes.mid===k.kind);if(!W)throw new Error("Cannot extract ssrc from mediaDescription.");return function(j,B,ee){const Z=j.attributes.ssrcs.filter(ye=>ye.attributes.label===B),oe=j.attributes.ssrcGroups;if(Z.length===0)throw new Error("Cannot extract ssrc from plan-b SDP.");if(oe&&Z.length>1){const ye=oe.find(_e=>_e.ssrcIds.indexOf(Z[0].ssrcId)!==-1);return ye?[{ssrcId:ye.ssrcIds[0],rtx:ee?ye.ssrcIds[1]:void 0}]:[{ssrcId:Z[0].ssrcId}]}return[{ssrcId:Z[0].ssrcId}]}(W,k.id,a.useRTX)});let E;try{E=yield g}catch(A){throw d.forEach(k=>{xs()&&k.replaceTrack(null),a.peerConnection.removeTrack(k)}),A}const b=a.mungSendOfferSDP(h.sdp,r);a.remoteSDP.receive(r,s,E);const I=a.remoteSDP.toString();return yield Fn(a.peerConnection.setLocalDescription({type:"offer",sdp:b})),yield Fn(a.applySendEncodings(d,r)),yield Fn(a.peerConnection.setRemoteDescription({type:"answer",sdp:I})),r.map((A,k)=>{const W=A._mediaStreamTrack.id;return{localSSRC:g[k],id:W}})}catch(d){throw new Le(te.EXCHANGE_SDP_FAILED,"P2PConnection.send failed; ".concat(d.toString()))}finally{c()}})()}async stopSending(r){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopSending before remote SDP created");const s=this.peerConnection.getSenders().filter(d=>{var h;return r.indexOf(((h=d.track)===null||h===void 0?void 0:h.id)||"")!==-1});if(s.length!==r.length)throw new Error("Transceivers' length doesn't match mids' length when trying to call P2PConnection.stopSending.");s.map(d=>{xs()&&d.replaceTrack(null),this.peerConnection.removeTrack(d)});const a=await this.peerConnection.createOffer();await this.peerConnection.setLocalDescription(a),this.remoteSDP.stopReceiving(r);const c=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"answer",sdp:c})}catch(s){throw new Le(te.EXCHANGE_SDP_FAILED,"P2PConnection.stopSending failed; ".concat(s.toString()))}}async receive(r,s,a,c){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.receive ".concat(r," before remoteSDP created."));const{id:d,mslabel:h}=this.remoteSDP.send(r,s,c),m=new pt((b,I)=>{const A=setTimeout(()=>{I(new Error("Cannot receive track, id: ".concat(d)))},1e4),k=W=>{const j=xn();if((j.name==="Safari"&&Number(j.version)===11||fo())&&W.track.id!==d&&W.streams[0].id===h){var B;const ee=W.streams[0].getTracks()[0];return(B=this.remoteSDP)===null||B===void 0||B.updateTrackLabel(r,d,W.track.id),this.peerConnection.removeEventListener("track",k),clearTimeout(A),void b(ee)}if(W.track.id===d)return this.peerConnection.removeEventListener("track",k),clearTimeout(A),void b(W.track)};this.peerConnection.addEventListener("track",k)}),g=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:g});const E=await this.peerConnection.createAnswer();return await this.peerConnection.setLocalDescription(E),{track:await m,id:d}}catch(d){throw new Le(te.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(d.toString()))}}async stopReceiving(r){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopReceiving before remote SDP created.");this.remoteSDP.stopSending(r);const s=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:s});const a=await this.peerConnection.createAnswer();await this.peerConnection.setLocalDescription(a)}catch(s){throw new Le(te.EXCHANGE_SDP_FAILED,"P2PConnection stopReceiving failed; ".concat(s.toString()))}}async muteRemote(r){}async unmuteRemote(r){}async muteLocal(r){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.muteLocal before remote SDP created.");const s=this.peerConnection.getSenders().filter(a=>{var c;return r.indexOf(((c=a.track)===null||c===void 0?void 0:c.id)||"")!==-1});if(s.length!==r.length)throw new Error("sender' length doesn't match mids' length.");s.map(a=>{if(xs()&&a.track)a.track.enabled=!1;else{const c=a.getParameters();c.encodings.forEach(d=>d.active=!1),a.setParameters(c)}})}catch(s){throw new Le(te.EXCHANGE_SDP_FAILED,"P2PConnection.muteLocal failed; ".concat(s.toString()))}}async unmuteLocal(r){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.unmuteLocal before remote SDP created.");const s=this.peerConnection.getSenders().filter(d=>{var h;return r.indexOf(((h=d.track)===null||h===void 0?void 0:h.id)||"")!==-1});if(s.length!==r.length)throw new Error("Senders' length doesn't match mids' length.");s.map(async d=>{if(xs()&&d.track)d.track.enabled=!0;else{const h=d.getParameters();h.encodings.forEach(m=>m.active=!0),await d.setParameters(h)}});const a=await this.peerConnection.createOffer();await this.peerConnection.setLocalDescription(a);const c=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"answer",sdp:c})}catch(s){throw new Le(te.EXCHANGE_SDP_FAILED,"P2PConnection.unmuteLocal failed; ".concat(s.toString()))}}restartICE(r){var s=this;return jl(function*(){const a=yield Fn(s.mutex.lock("From P2PConnection.restartICE"));try{if(!s.remoteSDP)throw new Error("Cannot restartICE before remoteSDP created.");const c=jn().supportPCSetConfiguration;if(r===Qs.RELAY&&!c)return;if(c){const E=s.peerConnection.getConfiguration(),b=r===Qs.RELAY?"relay":"all";E.iceTransportPolicy!==b&&(x.debug("[".concat(s.store.clientId,"] restartICE change iceTransportPolicy from [").concat(E.iceTransportPolicy,"] to [").concat(b,"]")),E.iceTransportPolicy=b,s.peerConnection.setConfiguration(E))}r!==Qs.RELAY&&s.remoteSDP.updateCandidates(r);const d=yield Fn(s.peerConnection.createOffer({iceRestart:!0}));if(!d.sdp)throw new Error("Cannot restartICE because restart offer SDP does not exist.");const h=Jm(d.sdp),{remoteIceParameters:m}=yield h.iceParameters;s.remoteSDP.restartICE(m);const g=s.remoteSDP.toString();yield Fn(s.peerConnection.setLocalDescription(d)),yield Fn(s.peerConnection.setRemoteDescription({type:"answer",sdp:g}))}catch(c){x.warning("[".concat(s.store.clientId,"] restart ICE failed, abort operation"),c)}finally{a()}})()}close(){var r;this.peerConnection.close(),(r=this.onConnectionStateChange)===null||r===void 0||r.call(this,"closed"),this.unbindPCEvents(),this.unbindStatsEvents(),this.removeAllListeners(),this.statsFilter.destroy()}getStats(){return this.statsFilter.getStats()}getRemoteVideoIsReady(r){return this.statsFilter.getVideoIsReady(r)}async updateEncoderConfig(r,s){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.updateEncoderConfig before remote SDP created.");const a=await this.peerConnection.createOffer(),c=this.mungSendOfferSDP(a.sdp,[s]);this.remoteSDP.updateRecvMedia(s._mediaStreamTrack.kind,s);const d=this.remoteSDP.toString();await this.peerConnection.setLocalDescription({type:"offer",sdp:c}),await this.peerConnection.setRemoteDescription({type:"answer",sdp:d})}catch(a){throw new Le(te.EXCHANGE_SDP_FAILED,a.toString())}}async updateSendParameters(r,s){const a=this.peerConnection.getSenders().filter(c=>{var d;return((d=c.track)===null||d===void 0?void 0:d.id)===r});a.length===1&&await this.applySendEncodings(a,[s])}setStatsRemoteVideoIsReady(r,s){this.statsFilter.setVideoIsReady2(r,s)}async replaceTrack(r,s){const a=this.peerConnection.getSenders().find(c=>{var d;return((d=c.track)===null||d===void 0?void 0:d.id)===s});a&&await a.replaceTrack(r._mediaStreamTrack)}createDataChannels(r,s){throw new Le(te.NOT_SUPPORTED,"Planb mode does not support createDataChannels.")}stopDataChannels(r){throw new Le(te.NOT_SUPPORTED,"Planb mode does not support stopDataChannels.")}bindPCEvents(){this.peerConnection.oniceconnectionstatechange=()=>{var r;(r=this.onICEConnectionStateChange)===null||r===void 0||r.call(this,this.peerConnection.iceConnectionState)},this.peerConnection.onconnectionstatechange=()=>{var r;(r=this.onConnectionStateChange)===null||r===void 0||r.call(this,this.peerConnection.connectionState)},this.peerConnection.onicecandidate=r=>{r.candidate?this.localCandidateCount+=1:(this.peerConnection.onicecandidate=null,this.allCandidatesReceived=!0,x.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] local candidate count"),this.localCandidateCount))},setTimeout(()=>{this.allCandidatesReceived||(this.allCandidatesReceived=!0,x.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] onicecandidate timeout, local candidate count"),this.localCandidateCount))},se("CANDIDATE_TIMEOUT"))}unbindPCEvents(){this.peerConnection.oniceconnectionstatechange=null,this.peerConnection.onconnectionstatechange=null,this.peerConnection.onsignalingstatechange=null,this.peerConnection.onicecandidateerror=null,this.peerConnection.onicecandidate=null,this.peerConnection.ontrack=null}static resolvePCConfiguration(r){const s={iceServers:[],sdpSemantics:"plan-b"};return r.iceServers?s.iceServers=r.iceServers:r.turnServer&&r.turnServer.mode!=="off"&&(Yw(r.turnServer.servers)?s.iceServers=r.turnServer.servers:(s.iceServers&&s.iceServers.push(...bC.turnServerConfigToIceServers(r.turnServer.servers)),se("USE_TURN_SERVER_OF_GATEWAY")&&s.iceServers&&r.turnServer.serversFromGateway&&s.iceServers.push(...bC.turnServerConfigToIceServers(r.turnServer.serversFromGateway)),r.turnServer.servers.concat(r.turnServer.serversFromGateway||[]).forEach(a=>{a.forceturn&&(s.iceTransportPolicy="relay")}))),s}static turnServerConfigToIceServers(r){const s=[];return r.forEach(a=>{a.security?a.tcpport&&s.push({username:a.username,credential:a.password,credentialType:"password",urls:"turns:".concat(a.turnServerURL,":").concat(a.tcpport,"?transport=tcp")}):(a.udpport&&s.push({username:a.username,credential:a.password,credentialType:"password",urls:"turn:".concat(a.turnServerURL,":").concat(a.udpport,"?transport=udp")}),a.tcpport&&s.push({username:a.username,credential:a.password,credentialType:"password",urls:"turn:".concat(a.turnServerURL,":").concat(a.tcpport,"?transport=tcp")}))}),s}async updateRtpSenderEncodings(r,s){var a;if(s||(s=this.peerConnection.getSenders().find(E=>{var b;return((b=E.track)===null||b===void 0?void 0:b.id)===r._mediaStreamTrack.id})),!s)return x.warn("[".concat(r.getTrackId(),"] no rtpSender found}"));if(!jn().supportSetRtpSenderParameters)return x.warn("Browser not support set rtp-sender parameters");const c={},d={};if(r instanceof Dr)switch(r._optimizationMode){case"motion":c.degradationPreference="maintain-framerate";break;case"detail":c.degradationPreference="maintain-resolution";break;default:c.degradationPreference="balanced"}if(se("DSCP_TYPE")&&lf()){var h;const E=se("DSCP_TYPE");rt(h=["very-low","low","medium","high"]).call(h,E)&&(d.networkPriority=E)}const m=s.getParameters(),g=(a=m.encodings)===null||a===void 0?void 0:a[0];g&&Object.assign(g,d),Object.assign(m,c),x.debug("[".concat(r.getTrackId(),"] updateRtpSenderEncodings: ").concat(JSON.stringify(m.encodings))),await s.setParameters(m)}async applySendEncodings(r,s){try{if(!jn().supportSetRtpSenderParameters||r.length!==s.length)return;for(let a=0;a<r.length;a++){const c=r[a],d=s[a];c&&d&&await this.updateRtpSenderEncodings(d,c)}}catch{x.debug("[".concat(this.store.clientId,"] Apply RTPSendEncodings failed."))}}mungSendOfferSDP(r,s){const a=Ya(r);return s.forEach((c,d)=>{const h=c._mediaStreamTrack,m=a.mediaDescriptions.find(g=>g.attributes.mid===h.kind);m&&l0(m,c)}),Hm(a)}bindStatsEvents(){this.statsFilter.onFirstAudioReceived=r=>{var s;(s=this.onFirstAudioReceived)===null||s===void 0||s.call(this,r)},this.statsFilter.onFirstVideoReceived=r=>{var s;(s=this.onFirstVideoReceived)===null||s===void 0||s.call(this,r)},this.statsFilter.onFirstAudioDecoded=r=>{var s;(s=this.onFirstAudioDecoded)===null||s===void 0||s.call(this,r)},this.statsFilter.onFirstVideoDecoded=(r,s,a)=>{var c;(c=this.onFirstVideoDecoded)===null||c===void 0||c.call(this,r,s,a)},this.statsFilter.onSelectedLocalCandidateChanged=(r,s)=>{var a;(a=this.onSelectedLocalCandidateChanged)===null||a===void 0||a.call(this,r,s)},this.statsFilter.onSelectedRemoteCandidateChanged=(r,s)=>{var a;(a=this.onSelectedRemoteCandidateChanged)===null||a===void 0||a.call(this,r,s)}}unbindStatsEvents(){this.statsFilter.onFirstAudioReceived=void 0,this.statsFilter.onFirstVideoReceived=void 0,this.statsFilter.onFirstAudioDecoded=void 0,this.statsFilter.onFirstVideoDecoded=void 0,this.statsFilter.onSelectedLocalCandidateChanged=void 0,this.statsFilter.onSelectedRemoteCandidateChanged=void 0}async batchReceive(r){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.batchReceive before remoteSDP created.");const s=this.remoteSDP.batchSend(r).map((d,h)=>{let{id:m,mslabel:g}=d;const{kind:E}=r[h];return new pt((b,I)=>{const A=setTimeout(()=>{I(new Error("Cannot receive track, id: ".concat(m)))},1e4),k=W=>{const j=xn();if(j.name==="Safari"&&Number(j.version)===11&&W.track.id!==m&&W.streams[0].id===g){var B;const ee=W.streams[0].getTracks()[0];return(B=this.remoteSDP)===null||B===void 0||B.updateTrackLabel(E,m,W.track.id),this.peerConnection.removeEventListener("track",k),clearTimeout(A),void b({track:ee,id:m})}if(W.track.id===m)return this.peerConnection.removeEventListener("track",k),clearTimeout(A),void b({track:W.track,id:m})};this.peerConnection.addEventListener("track",k)})}),a=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:a});const c=await this.peerConnection.createAnswer();return await this.peerConnection.setLocalDescription(c),await pt.all(s)}catch(s){throw new Le(te.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(s.toString()))}}async getRemoteSSRC(r){if(!this.remoteSDP)return;const s=this.remoteSDP.getSSRC(r);return s==null?void 0:s[0].ssrcId}setConfiguration(r){if(jn().supportPCSetConfiguration){const s=bC.resolvePCConfiguration(r);this.peerConnection.setConfiguration(s)}}},Rt(Sr.prototype,"connect",[Yl],Object.getOwnPropertyDescriptor(Sr.prototype,"connect"),Sr.prototype),Rt(Sr.prototype,"stopSending",[Yl],Object.getOwnPropertyDescriptor(Sr.prototype,"stopSending"),Sr.prototype),Rt(Sr.prototype,"receive",[Yl],Object.getOwnPropertyDescriptor(Sr.prototype,"receive"),Sr.prototype),Rt(Sr.prototype,"stopReceiving",[Yl],Object.getOwnPropertyDescriptor(Sr.prototype,"stopReceiving"),Sr.prototype),Rt(Sr.prototype,"muteRemote",[Yl],Object.getOwnPropertyDescriptor(Sr.prototype,"muteRemote"),Sr.prototype),Rt(Sr.prototype,"unmuteRemote",[Yl],Object.getOwnPropertyDescriptor(Sr.prototype,"unmuteRemote"),Sr.prototype),Rt(Sr.prototype,"muteLocal",[Yl],Object.getOwnPropertyDescriptor(Sr.prototype,"muteLocal"),Sr.prototype),Rt(Sr.prototype,"unmuteLocal",[Yl],Object.getOwnPropertyDescriptor(Sr.prototype,"unmuteLocal"),Sr.prototype),Rt(Sr.prototype,"close",[Yl],Object.getOwnPropertyDescriptor(Sr.prototype,"close"),Sr.prototype),Rt(Sr.prototype,"updateEncoderConfig",[Yl],Object.getOwnPropertyDescriptor(Sr.prototype,"updateEncoderConfig"),Sr.prototype),Rt(Sr.prototype,"updateSendParameters",[Yl],Object.getOwnPropertyDescriptor(Sr.prototype,"updateSendParameters"),Sr.prototype),Rt(Sr.prototype,"replaceTrack",[Yl],Object.getOwnPropertyDescriptor(Sr.prototype,"replaceTrack"),Sr.prototype),Rt(Sr.prototype,"getRemoteSSRC",[Yl],Object.getOwnPropertyDescriptor(Sr.prototype,"getRemoteSSRC"),Sr.prototype),Sr);function Yl(t,r,s){const a=t[r];if(typeof a!="function")throw new Error("Cannot use mutex on object property.");return s.value=async function(){const c=this.mutex,d=await c.lock("Locking from P2PConnection.".concat(r));try{for(var h=arguments.length,m=new Array(h),g=0;g<h;g++)m[g]=arguments[g];return await a.apply(this,m)}finally{d()}},s}const LEe={name:"PlanBConnection",create:function(t){let{store:r,spec:s}=t;return new xEe(s,r)}},MEe={interceptLocalAudioFrame:async function(t){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(!jn().supportWebRTCEncodedTransform)return void x.warning("browser not support audio encoded transform");if(PP.has(t)||!t.track)return;const s={track:t.track};if(cf()){if(!t.createEncodedStreams)return void x.warning("browser not support createEncodedStreams() API");let c=null;try{c=t.createEncodedStreams()}catch(h){return void x.error("create audio-encoded-streams error",h&&h.message)}const d=new TransformStream({transform(h,m){s.controller||(s.controller=m),t.track&&t.track.id!==s.track.id&&(x.debug("audio track changed: ".concat(s.track.id," => ").concat(t.track.id)),s.track.removeEventListener("ended",a),s.track=t.track,s.track.addEventListener("ended",a));const g=r.metadata&&r.metadata();g?function(E,b){const{chunk:I,controller:A}=b,k=$m.METADATA;I.data=function(W,j,B){const ee=B.byteLength,Z=ee+E2+KG,oe=_2+y2+Z,ye=new ArrayBuffer(W.byteLength+oe),_e=new DataView(ye);_e.setUint8(0,$G),_e.setUint16(1,Z),_e.setUint8(3,j),_e.setUint16(4,ee);for(let Ce=0;Ce<ee;Ce++)_e.setUint8(6+Ce,B[Ce]);const ue=new Uint8Array(_e.buffer);return ue.set(new Uint8Array(W),oe),ue.buffer}(I.data,k,E),A.enqueue(I)}(g,{chunk:h,controller:m}):m.enqueue(h)}});c.readable.pipeThrough(d).pipeTo(c.writable)}else if(xs()){if(typeof RTCRtpScriptTransform>"u")return void x.warning("browser not support RTCRtpScriptTransform");const c=AP(),d=new MessageChannel;await new pt(m=>c.onmessage=g=>{g.data==="registered"&&m(void 0)});const h=new RTCRtpScriptTransform(c,{name:"audio-metadata-tx",port:d.port2},[d.port2]);t.transform=h,await new pt(m=>c.onmessage=g=>{g.data==="started"&&m(void 0)}),d.port1.onmessage=m=>{var g;if(m.data.transformed&&t.track&&((g=t.track)===null||g===void 0?void 0:g.id)!==s.track.id)x.debug("audio track changed: ".concat(s.track.id," => ").concat(t.track.id)),s.track.removeEventListener("ended",a),s.track=t.track,s.track.addEventListener("ended",a);else if(m.data.getMetadata){const E=r.metadata&&r.metadata();E&&d.port1.postMessage({metadata:E})}},s.worker=c}function a(){if(t.track){if(this.id!==t.track.id)return;t.track.removeEventListener("ended",a)}const c=PP.get(t);if(c){PP.delete(t);try{var d,h;(d=c.controller)===null||d===void 0||d.terminate(),(h=c.worker)===null||h===void 0||h.terminate()}catch(m){x.warning(m&&m.message)}}}PP.set(t,s),t.track.addEventListener("ended",a)},interceptRemoteAudioFrame:async function(t){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(!jn().supportWebRTCEncodedTransform)return void x.warning("browser not support audio encoded transform");if(LP.has(t))return;const s={track:t.track,onMetadata:r.onMetadata,onPts:r.onPts};if(cf()&&!fo()){if(!t.createEncodedStreams)return void x.warning("browser not support createEncodedStreams() API");AL(Hn.CHROME,87,116)||(r.enableTopn=!1);let c=null;try{c=t.createEncodedStreams()}catch(h){return void x.error("create audio-encoded-streams error",h&&h.message)}const d=new TransformStream({transform(h,m){s.controller||(s.controller=m),t.track&&t.track.id!==s.track.id&&(x.debug("audio track changed: ".concat(s.track.id," => ").concat(t.track.id)),s.track.removeEventListener("ended",a),s.track=t.track,s.track.addEventListener("ended",a)),r.enableTopn?function(g,E,b){var I;const A=v2(new DataView(E.data));if(!A)return b.enqueue(E);const k=g.track.id;gge.set(k,g.track);const W=(I=A.tlv.find(ye=>ye.tag===$m.AUDIO_LEVEL))===null||I===void 0?void 0:I.value;let j=0;typeof W=="number"&&(j=127-W);const B=Math.round(Math.pow(10,j/60)-1),{selected:ee,speaker:Z}=function(ye,_e){let ue=n0.get(ye);if(ue||(ue=function(Ce){const Ue=new YG;return n0.set(Ce,Ue),Gd||(Gd=new fge(se("TOPN_SILENCE_THRESHOLD")||500),Gd.on("ActiveSpeakerChanged",ze=>{ze!=null&&(NP=ze)})),Gd.addSpeakers([Ue]),Ue}(ye)),n0.size<=XG)return{selected:!0,speaker:ue};if(!Gd)throw new Error("no active speaker detector");return Gd.levelChanged(ue.id,_e),ay=Gd.loudest.map(Ce=>Ce.id),NP&&!rt(ay).call(ay,NP)&&ay.length>=XG&&ay.pop(),{selected:rt(ay).call(ay,ue.id)||ue.id===NP,speaker:ue}}(g,B),oe=function(ye,_e,ue){const Ce=Hd.get(ye)||new mge(ye,_e);return Ce.score=ue,Hd.set(ye,Ce),function(Ue){if(DP.set(Ue,!0),!xP)return void(xP=Date.now());const ze=Date.now();ze-xP>1e3&&(DP.get(Ue)?DP.set(Ue,!1):(JG(Ue),DP.delete(Ue)),xP=ze)}(ye),Ce}(k,g.track,Z.energyScore);oe.addSample(ee),oe.active&&(E.data=A.frame.buffer,b.enqueue(E))}(t,h,m):r.enableMetadata||r.enablePts?function(g,E,b,I){const A=new DataView(g.data),k=A.getUint8(0);let W;if((128&k)!=0&&k!==71){const ee=function(Z){if(Z.byteLength<=0)return[];const oe=[];let ye=0;for(;ye<Z.byteLength;){const ue=(128&Z.getUint8(ye))>>7,Ce=127&Z.getUint8(ye);if(!(ue&&ye+4<=Z.byteLength)){ye++;break}{const Ue=Z.getUint32(ye,!1),ze=(16776192&Ue)>>10,Je=1023&Ue;oe.push({pt:Ce,ts_offset:ze,length:Je,data:new Uint8Array}),ye+=4}}let _e=Z.byteLength-ye;for(const ue of oe){if(ue.length>_e)return console.warn("Broken red payload"),[];ue.length>0&&(ue.data=new Uint8Array(Z.buffer,Z.byteOffset+ye,ue.length),ye+=ue.length,_e-=ue.length)}if(_e>0){const ue={pt:oe.length>0?oe[oe.length-1].pt:0,ts_offset:0,length:_e,data:new Uint8Array(Z.buffer,Z.byteOffset+ye,_e)};oe.push(ue)}return oe}(A);if(ee.length>0){const Z=function(oe){let ye=0;for(let Ce=0;Ce<oe.length;Ce++)ye+=Ce<oe.length-1?4:1,ye+=oe[Ce].length;const _e=new Uint8Array(ye);let ue=0;for(let Ce=0;Ce<oe.length;Ce++)if(Ce<oe.length-1){const Ue=(2147483648|(127&oe[Ce].pt)<<24|(262143&oe[Ce].ts_offset)<<10|1023&oe[Ce].length)>>>0;_e[ue++]=Ue>>24&255,_e[ue++]=Ue>>16&255,_e[ue++]=Ue>>8&255,_e[ue++]=255&Ue}else _e[ue++]=127&oe[Ce].pt;for(const Ce of oe)_e.set(Ce.data,ue),ue+=Ce.length;return _e}(ee.map(oe=>{const ye=new Uint8Array(oe.length);ye.set(oe.data);const _e=v2(new DataView(ye.buffer));return _e!=null&&_e.frame&&(oe.data=_e==null?void 0:_e.frame),W=_e,oe}));g.data=Z.buffer}}else W=v2(A),W&&(g.data=W.frame.buffer);if(E.enqueue(g),!W)return;const j=W.tlv.find(ee=>ee.tag===$m.METADATA);j&&b&&j.value instanceof Uint8Array&&b(j.value);const B=W.tlv.find(ee=>ee.tag===$m.AUDIO_64_BIT_PTS);B&&I&&B.value instanceof Uint8Array&&B.value.length==8&&I(new DataView(B.value.buffer).getBigUint64(0,!0))}(h,m,r.onMetadata,r.onPts):m.enqueue(h)}});c.readable.pipeThrough(d).pipeTo(c.writable)}else{if(typeof RTCRtpScriptTransform>"u")return void x.warning("browser not support RTCRtpScriptTransform");const c=AP(),d=new MessageChannel;await new pt(m=>c.onmessage=g=>{g.data==="registered"&&m(void 0)});const h=new RTCRtpScriptTransform(c,{name:"audio-metadata-rx",port:d.port2},[d.port2]);t.transform=h,await new pt(m=>c.onmessage=g=>{g.data==="started"&&m(void 0)}),d.port1.onmessage=m=>{var g;m.data.transformed&&t.track&&((g=t.track)===null||g===void 0?void 0:g.id)!==s.track.id?(x.debug("audio track changed: ".concat(s.track.id," => ").concat(t.track.id)),s.track.removeEventListener("ended",a),s.track=t.track,s.track.addEventListener("ended",a)):m.data.metadata&&s.onMetadata?s.onMetadata(m.data.metadata):m.data.pts&&s.onPts&&s.onPts(m.data.pts)},s.worker=c}function a(){t.track.removeEventListener("ended",a),function(c){const d=LP.get(c);if(d){(function(g){const E=n0.get(g);E&&(n0.delete(g),Gd&&(Gd.removeSpeakers([E]),n0.size===0&&(Gd.destroy(),Gd=null)))})(c),JG(c.track.id),LP.delete(c);try{var h,m;(h=d.controller)===null||h===void 0||h.terminate(),(m=d.worker)===null||m===void 0||m.terminate()}catch(g){x.warning(g&&g.message)}}}(t)}LP.set(t,s),t.track.addEventListener("ended",a)},interceptLocalVideoFrame:async function(t,r){if(!jn().supportWebRTCEncodedTransform)return void x.warning("browser not support video encoded transform");if(MP.has(t)||!t.track)return;const s={track:t.track};if(cf()){if(!t.createEncodedStreams)return void x.warning("browser not support createEncodedStreams() API");let c=null;try{c=t.createEncodedStreams()}catch(m){return void x.error("create video-encoded-streams error",m&&m.message)}const d=[];r.on("sei-to-send",m=>{d.push(m)});const h=new TransformStream({transform(m,g){s.controller||(s.controller=g),t.track&&t.track.id!==s.track.id&&(x.debug("video track changed: ".concat(s.track.id," => ").concat(t.track.id)),s.track.removeEventListener("ended",a),s.track=t.track,s.track.addEventListener("ended",a));const E=eH(new Uint8Array(m.data)),b=d.shift();if(b){const I=function(A,k,W){switch(W){case T2:return function(j,B){const ee=ZG(B),Z=ee.length,oe=Math.floor(Z/255),ye=Z%255,_e=new Uint8Array(6+oe+1+Z+j.byteLength);_e[0]=0,_e[1]=0,_e[2]=0,_e[3]=1,_e[4]=6,_e[5]=101;let ue=0;for(;ue<oe;)_e[6+ue]=255,ue++;return _e[6+ue]=ye,ue++,_e.set(ee,6+ue),_e.set(new Uint8Array(j),6+ue+Z),_e.buffer}(A,k);case C2:return function(j,B){const ee=ZG(B),Z=ee.length,oe=Math.floor(Z/255),ye=Z%255,_e=new Uint8Array(7+oe+1+Z+1+j.byteLength);_e[0]=0,_e[1]=0,_e[2]=0,_e[3]=1,_e[4]=78,_e[5]=1,_e[6]=101;let ue=0;for(;ue<oe;)_e[7+ue]=255,ue++;return _e[7+ue]=ye,ue++,_e.set(ee,7+ue),ue+=Z,_e[7+ue]=128,ue++,_e.set(new Uint8Array(j),7+ue),_e.buffer}(A,k);default:return null}}(m.data,b,E);I&&(m.data=I)}g.enqueue(m)}});c.readable.pipeThrough(h).pipeTo(c.writable)}else{if(!xs())return;{if(typeof RTCRtpScriptTransform>"u")return void x.warning("browser not support RTCRtpScriptTransform");const c=AP(),d=new MessageChannel;await new pt(m=>c.onmessage=g=>{g.data==="registered"&&m(void 0)});const h=new RTCRtpScriptTransform(c,{name:"sei-tx",port:d.port2},[d.port2]);t.transform=h,await new pt(m=>c.onmessage=g=>{g.data==="started"&&m(void 0)}),r.on("sei-to-send",m=>{d.port1.postMessage({sei:m})}),d.port1.onmessage=m=>{var g;m.data.transformed&&t.track&&((g=t.track)===null||g===void 0?void 0:g.id)!==s.track.id&&(x.debug("video track changed: ".concat(s.track.id," => ").concat(t.track.id)),s.track.removeEventListener("ended",a),s.track=t.track,s.track.addEventListener("ended",a))},s.worker=c}}function a(){if(t.track){if(this.id!==t.track.id)return;t.track.removeEventListener("ended",a)}const c=MP.get(t);if(c){MP.delete(t);try{var d,h;(d=c.controller)===null||d===void 0||d.terminate(),(h=c.worker)===null||h===void 0||h.terminate()}catch(m){x.warning(m&&m.message)}}}MP.set(t,s),t.track.addEventListener("ended",a)},interceptRemoteVideoFrame:async function(t){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(!jn().supportWebRTCEncodedTransform)return void x.warning("browser not support video encoded transform");if(!t.track)return;if(iT.has(t)){const c=iT.get(t);return void(c&&(c.onSei=r.onSei))}const s={track:t.track,onSei:r.onSei};if(cf()){if(!t.createEncodedStreams)return void x.warning("browser not support createEncodedStreams() API");let c=null;try{c=t.createEncodedStreams()}catch(h){return void x.error("create video-encoded-streams error",h&&h.message)}const d=new TransformStream({transform(h,m){s.controller||(s.controller=m),t.track&&t.track.id!==s.track.id&&(x.debug("video track changed: ".concat(s.track.id," => ").concat(t.track.id)),s.track.removeEventListener("ended",a),s.track=t.track,s.track.addEventListener("ended",a));const g=function(E,b){switch(b){case T2:return function(I){const A=new DataView(I.data);let k=0;for(;k+4<I.data.byteLength;){if(A.getUint8(k+0)===0&&A.getUint8(k+1)===0&&A.getUint8(k+2)===0&&A.getUint8(k+3)===1&&A.getUint8(k+4)===6){let W=k+6,j=0,B=0;for(;(B=A.getUint8(W++))===255;)j+=255;j+=B;const ee=QG(I.data,W,j);return new Uint8Array(ee)}k++}return null}(E);case C2:return function(I){const A=new DataView(I.data);let k=0;for(;k+5<I.data.byteLength;){if(A.getUint8(k+0)===0&&A.getUint8(k+1)===0&&A.getUint8(k+2)===0&&A.getUint8(k+3)===1&&A.getUint8(k+4)===78&&A.getUint8(k+5)===1&&A.getUint8(k+6)===101){let W=k+7,j=0,B=0;for(;(B=A.getUint8(W++))===255;)j+=255;j+=B;const ee=QG(I.data,W,j);return new Uint8Array(ee)}k++}return null}(E);default:return null}}(h,eH(new Uint8Array(h.data)));g&&s.onSei&&s.onSei(g),m.enqueue(h)}});c.readable.pipeThrough(d).pipeTo(c.writable)}else if(xs()){if(typeof RTCRtpScriptTransform>"u")return void x.warning("browser not support RTCRtpScriptTransform");const c=AP(),d=new MessageChannel;await new pt(m=>c.onmessage=g=>{g.data==="registered"&&m(void 0)});const h=new RTCRtpScriptTransform(c,{name:"sei-rx",port:d.port2},[d.port2]);t.transform=h,await new pt(m=>c.onmessage=g=>{g.data==="started"&&m(void 0)}),d.port1.onmessage=m=>{var g;m.data.transformed&&t.track&&((g=t.track)===null||g===void 0?void 0:g.id)!==s.track.id?(x.debug("video track changed: ".concat(s.track.id," => ").concat(t.track.id)),s.track.removeEventListener("ended",a),s.track=t.track,s.track.addEventListener("ended",a)):m.data.sei&&s.onSei&&s.onSei(m.data.sei)},s.worker=c}function a(){if(t.track){if(this.id!==t.track.id)return;t.track.removeEventListener("ended",a)}(function(c){const d=iT.get(c);if(d){iT.delete(c);try{var h,m;(h=d.controller)===null||h===void 0||h.terminate(),(m=d.worker)===null||m===void 0||m.terminate()}catch(g){x.warning(g&&g.message)}}})(t)}iT.set(t,s),t.track.addEventListener("ended",a)}},UEe={name:"InterceptFrame",create:()=>MEe};YL(),pr("PROCESS_ID","process-".concat(vr(8,""),"-").concat(vr(4,""),"-").concat(vr(4,""),"-").concat(vr(4,""),"-").concat(vr(12,""))),function(){let t;try{t=window.localStorage.getItem("websdk_ng_global_parameter")}catch(r){return void x.error("Error loading sdk config",r.message)}if(t)try{const r=JSON.parse(window.atob(t)),s=Date.now();x.debug("Loading global parameters from cache",r),Object.keys(r).forEach(a=>{if(Object.prototype.hasOwnProperty.call(zr,a)){const{value:c,expires:d}=r[a];if(d&&d<=s)return;Wd[a]=c,zr[a]=c}})}catch(r){x.error("Error loading mutableParamsCache: ".concat(t),r.message)}}(),Array.isArray(Wd.AREAS)&&Wd.AREAS.length>0&&G2(Wd.AREAS,!0);const JK=(t,r,s)=>{x.debug("setParameter key:".concat(t,", value:").concat(JSON.stringify(r))),pr(t,r,s)};eg(oEe,!1),eg(lEe,!1),eg(z_e,!1),eg(vEe,!1),eg(rEe,!1),eg(NEe,!1),eg(LEe,!1),eg(UEe,!1);const Ui=function(t){const r=new Jr,s=t,a={getListeners:r.getListeners.bind(r),on:(c,d)=>(function(h,m){h===Yh.SECURITY_POLICY_VIOLATION&&O$(m,!0)}(c,d),r.on.bind(r)(c,d)),addListener:r.addListener.bind(r),once:r.once.bind(r),off:r.off.bind(r),removeAllListeners:r.removeAllListeners.bind(r),emit:r.emit.bind(r),safeEmit:r.safeEmit.bind(r)};return k$(k$({},s),a)}({__TRACK_LIST__:Kv,VERSION:Bl,BUILD:QL,ESM_BUNDLER:!1,ESM:!1,UMD:!0,DEV:!1,setParameter:JK,getParameter:se,getSupportedCodec:async function(){let t={audio:[],video:[]};try{let r=new RTCPeerConnection;const s=await async function(a){let c;return jn().supportUnifiedPlan?(a.addTransceiver("video",{direction:"recvonly"}),a.addTransceiver("audio",{direction:"recvonly"}),c=(await a.createOffer()).sdp):c=(await a.createOffer({offerToReceiveAudio:!0,offerToReceiveVideo:!0})).sdp,c}(r);if(!s)return t;r.close(),r=null,t=function(a){const c={video:[],audio:[]};return a.match(/ VP8/i)&&c.video.push("VP8"),a.match(/ VP9/i)&&c.video.push("VP9"),a.match(/ AV1/i)&&c.video.push("AV1"),a.match(/ H264/i)&&c.video.push("H264"),a.match(/ H265/i)&&c.video.push("H265"),a.match(/ opus/i)&&c.audio.push("OPUS"),a.match(/ PCMU/i)&&c.audio.push("PCMU"),a.match(/ PCMA/i)&&c.audio.push("PCMA"),a.match(/ G722/i)&&c.audio.push("G722"),c}(s)}catch(r){throw new Pe(te.CREATE_OFFER_FAILED,r.toString&&r.toString()).print()}return t},checkSystemRequirements:function(){const t=At.reportApiInvoke(null,{name:di.CHECK_SYSTEM_REQUIREMENTS,options:[],tag:$r.TRACER});let r=!1;try{const d=window.RTCPeerConnection,h=navigator.mediaDevices&&navigator.mediaDevices.getUserMedia,m=window.WebSocket;r=!!(d&&h&&m),r&&xL()&&Q8(75)&&new d().close()}catch(d){return x.error("check system requirement failed: ",d),!1}let s=!1;const a=xn();a.name===Hn.CHROME&&Number(a.version)>=58&&(jd.engine.name!=="WebKit"||function(){const d=xn();if(dP()){if(d.os===is.MAC_OS)return!0;if(d.os===is.IOS){const h=jd.os.version&&jd.os.version.split(".");if(h&&Number(h[0])===14&&h[1]&&Number(h[1])>=3||h&&Number(h[0])>14)return!0}}return!1}())&&(s=!0),(a.name===Hn.FIREFOX&&Number(a.version)>=56||a.name===Hn.OPERA&&Number(a.version)>=45||a.name===Hn.SAFARI&&Number(a.version)>=11||a.name==="WebKit"&&(fo()||xu())&&a.osVersion&&Number(a.osVersion.split(".")[0])>=11||iW()||xn().name===Hn.QQ)&&(s=!0),x.debug("checkSystemRequirements, api:",r,"browser",s);const c=r&&s;return t.onSuccess(c),c},getDevices:function(t){return tl.enumerateDevices(!0,!0,t)},getMicrophones:function(t){return tl.getRecordingDevices(t)},getCameras:function(t){return tl.getCamerasDevices(t)},getElectronScreenSources:QW,getPlaybackDevices:function(t){return tl.getSpeakers(t)},createClient:function(){var t;let r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{codec:"vp8",audioCodec:"opus",mode:"rtc"};const s=vr(5,"client-"),a=At.reportApiInvoke(null,{id:s,name:di.CREATE_CLIENT,options:[r],tag:$r.TRACER});try{(function(c){Yi(c.codec,"config.codec",["vp8","vp9","av1","h264","h265"]),Yi(c.mode,"config.mode",["rtc","live","p2p"]),c.audioCodec!==void 0&&Yi(c.audioCodec,"config.audioCodec",["opus","pcmu","pcma","g722"]),c.proxyServer!==void 0&&Ss(c.proxyServer,"config.proxyServer",1,1e4),c.turnServer!==void 0&&hW(c.turnServer),c.httpRetryConfig!==void 0&&dW(c.httpRetryConfig),c.websocketRetryConfig!==void 0&&dW(c.websocketRetryConfig)})(r)}catch(c){throw a.onError(c),c}return(tW(16,0)||OL(16,0,!0))&&(r.codec==="vp9"&&(r.codec="vp8",x.debug("browser not support vp9, force use vp8")),pr("UNSUPPORTED_VIDEO_CODEC",["vp9"])),r.audioCodec===void 0&&(r.audioCodec="opus"),a.onSuccess(),new W_e(Wu(Wu({forceWaitGatewayResponse:!0},r),{},{role:rt(t=["rtc","p2p"]).call(t,r.mode)?"host":r.role||"audience"}),s)},createCameraVideoTrack:async function(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const r=se("CAMERA_CAPTURE_CONFIG"),s=vr(8,"track-cam-"),a=At.reportApiInvoke(null,{id:s,tag:$r.TRACER,name:di.CREATE_CAM_VIDEO_TRACK,options:[Ar({},t),r]});r&&(t.encoderConfig=r);const c=RP(t);let d=null;x.info("start create camera video track with config",JSON.stringify(t),"trackId",s);try{d=(await el({video:c},s)).getVideoTracks()[0]||null}catch(m){throw a.onError(m),m}if(!d){const m=new Le(te.UNEXPECTED_ERROR,"can not find track in media stream");return a.onError(m),m.throw(x)}if(t.optimizationMode&&g2(s,d,t,Uu(t.encoderConfig)),se("USE_STANDARD_BITRATE_DEFAULT")){const m=Uu(t.encoderConfig);t.encoderConfig=m,delete m.bitrateMax,delete m.bitrateMin}const h=new IP(d,t,c,t.scalabiltyMode?bP(t.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},t.optimizationMode,s);return a.onSuccess(h.getTrackId()),x.info("create camera video success, trackId:",s),h},createCustomVideoTrack:function(t){const r=vr(8,"track-cus-"),s=At.reportApiInvoke(null,{id:r,tag:$r.TRACER,name:di.CREATE_CUSTOM_VIDEO_TRACK,options:[t]});se("USE_STANDARD_BITRATE_DEFAULT")&&(delete t.bitrateMax,delete t.bitrateMin);const a=new Dr(t.mediaStreamTrack,{width:t.width,height:t.height,frameRate:t.frameRate,bitrateMax:t.bitrateMax,bitrateMin:t.bitrateMin},t.scalabiltyMode?bP(t.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},t.optimizationMode,r,[yr.CUSTOM_TRACK]);return s.onSuccess(a.getTrackId()),x.info("create custom video track success with config",t,"trackId",a.getTrackId()),a},createScreenVideoTrack:async function(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"disable";const s=typeof r=="object"?function(A){return c9(A)}(r):void 0;s&&(r="auto");const a=vr(8,"track-scr-v-"),c=At.reportApiInvoke(null,{id:a,tag:$r.TRACER,name:di.CREATE_SCREEN_VIDEO_TRACK,options:[Ar({},t),r]});t.encoderConfig?typeof t.encoderConfig=="string"||t.encoderConfig.width&&t.encoderConfig.height||(t.encoderConfig.width={max:1920},t.encoderConfig.height={max:1080}):t.encoderConfig="1080p_2";const d=function(A){const k={};A.screenSourceType&&(k.mediaSource=A.screenSourceType),A.extensionId&&cf()&&(k.extensionId=A.extensionId);const{displaySurface:W,selfBrowserSurface:j,surfaceSwitching:B,systemAudio:ee,preferCurrentTab:Z}=A;(Vv(107)||PL(107)||NL(93))&&(W&&(Yi(W,"displaySurface",["browser","window","monitor"]),k.displaySurface=W),j?(Yi(j,"selfBrowserSurface",["exclude","include"]),k.selfBrowserSurface=j):k.selfBrowserSurface="include",B&&(Yi(B,"surfaceSwitching",["exclude","include"]),k.surfaceSwitching=B)),(Vv(105)||PL(105)||NL(91))&&ee&&(Yi(ee,"systemAudio",["exclude","include"]),k.systemAudio=ee),(Vv(94)||PL(94)||NL(80))&&Z&&(k.preferCurrentTab=!0),A.electronScreenSourceId&&(k.sourceId=A.electronScreenSourceId);const oe=A.encoderConfig?i2(A.encoderConfig):null;return k.mandatory={chromeMediaSource:"desktop",maxWidth:oe?oe.width:void 0,maxHeight:oe?oe.height:void 0},oe&&(oe.frameRate&&(typeof oe.frameRate=="number"?(k.mandatory.maxFrameRate=oe.frameRate,k.mandatory.minFrameRate=oe.frameRate):(k.mandatory.maxFrameRate=oe.frameRate.max||oe.frameRate.ideal||oe.frameRate.exact||void 0,k.mandatory.minFrameRate=oe.frameRate.min||oe.frameRate.ideal||oe.frameRate.exact||void 0),k.frameRate=oe.frameRate),oe.width&&(k.width=oe.width),oe.height&&(k.height=oe.height)),k}(t);let h=null,m=null;const g=jn();if(!g.supportShareAudio&&r==="enable"){const A=new Le(te.NOT_SUPPORTED,"your browser or platform is not support share-screen with audio");return c.onError(A),A.throw(x)}x.info("start create screen video track with config",t,"withAudio",r,"trackId",a);const E=g.supportShareAudio&&r!=="disable";try{const A=await el({screen:d,screenAudio:E?s||!0:void 0},a);h=A.getVideoTracks()[0]||null,m=A.getAudioTracks()[0]||null}catch(A){throw c.onError(A),A}if(!h){const A=new Le(te.UNEXPECTED_ERROR,"can not find track in media stream");return c.onError(A),A.throw(x)}if(!m&&r==="enable"){h&&h.stop();const A=new Le(te.SHARE_AUDIO_NOT_ALLOWED);return c.onError(A),A.throw(x)}t.optimizationMode||(t.optimizationMode="detail"),t.optimizationMode&&(g2(a,h,t,t.encoderConfig&&i2(t.encoderConfig)||void 0),t.encoderConfig&&typeof t.encoderConfig!="string"&&(t.encoderConfig.bitrateMin=t.encoderConfig.bitrateMax));const b=new Dr(h,t.encoderConfig?i2(t.encoderConfig):{},t.scalabiltyMode?bP(t.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},t.optimizationMode,a,[yr.SCREEN_TRACK]);if(!m)return c.onSuccess(b.getTrackId()),x.info("create screen video track success","video:",b.getTrackId()),b;const I=new ci(m,void 0,vr(8,"track-scr-a-"),!1);return c.onSuccess([b.getTrackId(),I.getTrackId()]),x.info("create screen video track success","video:",b.getTrackId(),"audio:",I.getTrackId()),[b,I]},createMicrophoneAndCameraTracks:async function(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const s=se("CAMERA_CAPTURE_CONFIG"),a=vr(8,"track-mic-"),c=vr(8,"track-cam-"),d=At.reportApiInvoke(null,{id:"".concat(a,"-").concat(c),tag:$r.TRACER,name:di.CREATE_MIC_AND_CAM_TRACKS,options:[t,r,s]});s&&(r.encoderConfig=s);const h=RP(r),m=l9(t);let g=null,E=null;x.info("start create camera video track(".concat(c,") and microphone audio track(").concat(a,") with config, audio: ").concat(JSON.stringify(t),", video: ").concat(JSON.stringify(r)));try{const A=await el({audio:m,video:h},"".concat(a,"-").concat(c));g=A.getAudioTracks()[0],E=A.getVideoTracks()[0]}catch(A){throw d.onError(A),A}if(!g||!E){const A=new Le(te.UNEXPECTED_ERROR,"can not find tracks in media stream");return d.onError(A),A.throw(x)}if(r.optimizationMode&&g2(c,E,r,Uu(r.encoderConfig)),se("USE_STANDARD_BITRATE_DEFAULT")){const A=Uu(r.encoderConfig);r.encoderConfig=A,delete A.bitrateMax,delete A.bitrateMin}const b=new rT(g,t,m,a),I=new IP(E,r,h,r.scalabiltyMode?bP(r.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},r.optimizationMode,c);return d.onSuccess([b.getTrackId(),I.getTrackId()]),x.info("create camera video track(".concat(c,") and microphone audio track(").concat(a,") success")),[b,I]},createMicrophoneAudioTrack:async function(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const r=vr(8,"track-mic-"),s=At.reportApiInvoke(null,{id:r,tag:$r.TRACER,name:di.CREATE_MIC_AUDIO_TRACK,options:[t]}),a=l9(t);let c=null;x.info("start create microphone audio track with config",JSON.stringify(t),"trackId",r);try{c=(await el({audio:a},r)).getAudioTracks()[0]||null}catch(h){throw s.onError(h),h}if(!c){const h=new Le(te.UNEXPECTED_ERROR,"can not find track in media stream");return s.onError(h),h.throw(x)}const d=new rT(c,t,a,r);return s.onSuccess(d.getTrackId()),x.info("create microphone audio track success, trackId:",r),d},createCustomAudioTrack:function(t){const r=vr(8,"track-cus-"),s=At.reportApiInvoke(null,{id:r,tag:$r.TRACER,name:di.CREATE_CUSTOM_AUDIO_TRACK,options:[t]}),a=new ci(t.mediaStreamTrack,t.encoderConfig?wP(t.encoderConfig):{},r,!1);return x.info("create custom audio track success with config",t,"trackId",a.getTrackId()),s.onSuccess(a.getTrackId()),a},createBufferSourceAudioTrack:async function(t){var r;const{cacheOnlineFile:s,encoderConfig:a}=t;let{source:c}=t;const d={source:c instanceof AudioBuffer?"AudioBuffer":c instanceof File?(r=File.name)!==null&&r!==void 0?r:"File":c,cacheOnlineFile:s,encoderConfig:a},h=vr(8,"track-buf-"),m=At.reportApiInvoke(null,{id:h,tag:$r.TRACER,name:di.CREATE_BUFFER_AUDIO_TRACK,options:[d]});if(se("DISABLE_WEBAUDIO"))throw new Le(te.NOT_SUPPORTED,"can not create BufferSourceAudioTrack when WebAudio disabled");x.info("start create buffer source audio track with config",JSON.stringify(d),"trackId",h);const g=c;if(!(c instanceof AudioBuffer))try{c=await async function(I,A){let k=null;if(typeof I=="string"){const j=Y9.get(I);if(j)return x.debug("use cached audio resource: ",I),j;try{k=(await zd(()=>Sa.get(I,{responseType:"arraybuffer"}),void 0,void 0,{maxRetryCount:3})).data}catch(B){throw new Le(te.FETCH_AUDIO_FILE_FAILED,B.toString())}}else k=await new pt((B,ee)=>{const Z=new FileReader;Z.onload=oe=>{oe.target?B(oe.target.result):ee(new Le(te.READ_LOCAL_AUDIO_FILE_ERROR))},Z.onerror=()=>{ee(new Le(te.READ_LOCAL_AUDIO_FILE_ERROR))},Z.readAsArrayBuffer(I)});const W=await function(j){const B=Qv();return new pt((ee,Z)=>{B.decodeAudioData(j,oe=>{ee(oe)},oe=>{Z(new Le(te.DECODE_AUDIO_FILE_FAILED,oe.toString()))})})}(k);return typeof I=="string"&&A&&Y9.set(I,W),W}(c,s)}catch(I){return m.onError(I),I.throw(x)}const E=new lge(c),b=new cge(g,E,a?wP(a):{},h);return x.info("create buffer source audio track success, trackId:",h),m.onSuccess(b.getTrackId()),b},setAppType:function(t){if(x.debug("setAppType: ".concat(t)),!(Number.isInteger(t)&&t>=0))throw x.debug("Invalid appType"),new Pe(te.INVALID_PARAMS,"invalid app type",t);pr("APP_TYPE",Math.floor(t))},setLogLevel:function(t){x.setLogLevel(t)},enableLogUpload:function(){se("USE_NEW_LOG")?pr("UPLOAD_LOG",!0):x.enableLogUpload()},disableLogUpload:function(){se("USE_NEW_LOG")?pr("UPLOAD_LOG",!1):x.disableLogUpload()},createChannelMediaRelayConfiguration:function(){return new QH},checkAudioTrackIsActive:async function(t){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:5e3;const s=At.reportApiInvoke(null,{tag:$r.TRACER,name:di.CHECK_AUDIO_TRACK_IS_ACTIVE,options:[r]});if(!(t instanceof ci||t instanceof t0)){const g=new Pe(te.INVALID_TRACK,"the parameter is not a audio track");return s.onError(g),g.throw()}r&&r<1e3&&(r=1e3);const a=t instanceof ci?t.getTrackLabel():"remote_track",c=t.getVolumeLevel();let d=c,h=c;const m=Date.now();return new pt(g=>{const E=setInterval(()=>{const b=t.getVolumeLevel();d=b>d?b:d,h=b<h?b:h;const I=d-h>1e-4,A=Date.now()-m;if(I||A>r){clearInterval(E);const k=I,W={duration:A,deviceLabel:a,maxVolumeLevel:d,result:k};x.info("[track-".concat(t.getTrackId(),"] check audio track active completed. ").concat(JSON.stringify(W))),s.onSuccess(W),g(k)}},200)})},checkVideoTrackIsActive:async function(t){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:5e3;const s=At.reportApiInvoke(null,{tag:$r.TRACER,name:di.CHECK_VIDEO_TRACK_IS_ACTIVE,options:[r]});if(!(t instanceof Dr||t instanceof e0)){const I=new Pe(te.INVALID_TRACK,"the parameter is not a video track");return s.onError(I),I.throw()}r&&r<1e3&&(r=1e3);const a=t instanceof Dr?t.getTrackLabel():"remote_track",c=t.getMediaStreamTrack(!0),d=document.createElement("video");d.style.width="1px",d.style.height="1px",d.setAttribute("muted",""),d.muted=!0,d.setAttribute("playsinline",""),d.controls=!1,(xs()||dP())&&(d.style.opacity="0.01",d.style.position="fixed",d.style.left="0",d.style.top="0",document.body.appendChild(d)),d.srcObject=new MediaStream([c]),d.play();const h=document.createElement("canvas");h.width=160,h.height=120;let m=0,g=0;try{const I=Date.now();m=await function(A,k,W,j){let B,ee=0,Z=null;return new pt((oe,ye)=>{function _e(){ee>j&&B&&(B(),oe(ee));const ue=W.getContext("2d");if(!ue){const ze=new Pe(te.UNEXPECTED_ERROR,"can not get canvas 2d context.");return x.error(ze.toString()),void ye(ze)}ue.drawImage(A,0,0,160,120);const Ce=ue.getImageData(0,0,W.width,W.height),Ue=Math.floor(Ce.data.length/3);if(Z){for(let ze=0;ze<Ue;ze+=3)if(Ce.data[ze]!==Z[ze])return ee+=1,void(Z=Ce.data);Z=Ce.data}else Z=Ce.data}setTimeout(()=>{B&&(B(),oe(ee))},k),B=l2(()=>{_e()},30)})}(d,r,h,4),g=Date.now()-I}catch(I){throw s.onError(I),I}A_e===Hn.SAFARI&&(d.pause(),d.remove()),d.srcObject=null;const E=m>4,b={duration:g,changedPicNum:m,deviceLabel:a,result:E};return x.info("[track-".concat(t.getTrackId(),"] check video track active completed. ").concat(JSON.stringify(b))),s.onSuccess(b),E},setArea:G2,audioElementPlayCenter:ba,resumeAudioContext:function(){ba.autoResumeAfterInterruption(!0)},processExternalMediaAEC:function(t){H_e.processExternalMediaAEC(t)},registerExtensions:function(t){const r=se("PLUGIN_INFO")||[];t.forEach(s=>{"name"in s&&!rt(r).call(r,s.name)&&r.push(s.name);const a=s;a.__registered__=!0,a.logger.hookLog=x.extLog,a.reporter.hookApiInvoke=At.extApiInvoke,a.parameters&&Object.keys(a.parameters).forEach(c=>{a.parameters[c]=se(c)})}),JK("PLUGIN_INFO",r)},ChannelMediaRelayError:i0,ChannelMediaRelayEvent:hf,ChannelMediaRelayState:Ja,RemoteStreamFallbackType:tge,RemoteStreamType:ege,ConnectionDisconnectedReason:rr,AudienceLatencyLevelType:Ome,AREAS:Jn,preload:async function(t,r,s,a){return b7(t,r,s,a)}});return Object.defineProperties(Ui,{onAudioAutoplayFailed:{get:()=>nl.onAudioAutoplayFailed,set:t=>{nl.onAudioAutoplayFailed=t}},onAutoplayFailed:{get:()=>nl.onAutoplayFailed,set:t=>{nl.onAutoplayFailed=t}},_onSecurityPolicyViolation:{value:void 0,writable:!0},_cspEventHandlerPointer:{value:void 0,writable:!0},onSecurityPolicyViolation:{get:()=>Ui._onSecurityPolicyViolation,set(t){Ui._onSecurityPolicyViolation=t,O$(t)}},__CLIENT_LIST__:{get:()=>se("SHOW_GLOBAL_CLIENT_LIST")?cy:[]}}),tl.on(iy.CAMERA_DEVICE_CHANGED,t=>{x.info("camera device changed",JSON.stringify(t)),Ui.onCameraChanged&&Ui.onCameraChanged(t),Ui.safeEmit(Yh.CAMERA_CHANGED,t)}),tl.on(iy.RECORDING_DEVICE_CHANGED,t=>{x.info("microphone device changed",JSON.stringify(t)),Ui.onMicrophoneChanged&&Ui.onMicrophoneChanged(t),Ui.safeEmit(Yh.MICROPHONE_CHANGED,t)}),tl.on(iy.PLAYOUT_DEVICE_CHANGED,t=>{x.debug("playout device changed",JSON.stringify(t)),Ui.onPlaybackDeviceChanged&&Ui.onPlaybackDeviceChanged(t),Ui.safeEmit(Yh.PLAYBACK_DEVICE_CHANGED,t)}),ba.onAutoplayFailed=()=>{x.info("detect audio element autoplay failed"),nl.onAudioAutoplayFailed&&nl.onAudioAutoplayFailed()},fr.on("autoplay-failed",()=>{x.info("detect webaudio autoplay failed"),nl.onAudioAutoplayFailed&&nl.onAudioAutoplayFailed(),Ui.safeEmit(Yh.AUTOPLAY_FAILED)}),fr.on(Ts.STATE_CHANGE,(t,r)=>{x.info("audio context state changed: ".concat(r," => ").concat(t)),Ui.onAudioContextStateChanged&&Ui.onAudioContextStateChanged(t,r),Ui.safeEmit(Yh.AUDIO_CONTEXT_STATE_CHANGED,t,r)}),Ci.on(jv.NETWORK_STATE_CHANGE,(t,r)=>{x.info("[network-indicator] network state changed, ".concat(r," => ").concat(t))}),window&&(window.__ARTC__=Ui),Ui})}(Jk)),Jk.exports}var l9e=c9e();const SR=$g(l9e),u9e="a2a7f4eb05284449b1063eb71d8301dc",d9e=SR.createClient({mode:"rtc",codec:"vp8"});let tC=null;const $ae=O.createContext(null),Kae=({children:n,appId:e=u9e,channel:i=null,token:o=null,uid:l=null,enabled:u=!0,startMuted:p=!0,onClientReady:y=()=>{}})=>{const[v,w]=O.useState(!1),[C,R]=O.useState(!1),[N,M]=O.useState([]),[L,U]=O.useState(null),[z,J]=O.useState(null),[q,re]=O.useState(null),[ce,ae]=O.useState(!1),[pe,H]=O.useState(!1),[X,Q]=O.useState(!1),[ne,he]=O.useState(null),[fe,de]=O.useState(!1),ke=Da(),De=O.useRef(d9e),je=O.useRef({appId:e,channel:i,uid:l,enabled:u}),Te=O.useRef(!1),we=O.useRef(null);O.useRef(null),O.useEffect(()=>{je.current={appId:e,channel:i,uid:l,enabled:u}},[e,i,l,u]),O.useEffect(()=>{J(i)},[i]),O.useEffect(()=>{if(!De.current)return;const nt=mt=>{K.log(`Connection state changed to: ${mt}`),mt==="DISCONNECTED"?(w(!1),K.log("Disconnected from Agora")):mt==="CONNECTED"&&(w(!0),U(null))};return De.current.on("connection-state-change",nt),()=>{De.current.off("connection-state-change",nt)}},[]),O.useEffect(()=>{if(!i||!u)return;const nt=async(ft,Ct)=>{K.log(`User published: ${ft.uid}, mediaType: ${Ct}`);try{await De.current.subscribe(ft,Ct),Ct==="audio"&&ft.audioTrack.play(),M(ut=>ut.some(Ft=>Ft.uid===ft.uid)?ut:[...ut,ft])}catch(ut){K.error("Error subscribing to user:",ut)}},mt=(ft,Ct)=>{K.log(`User unpublished: ${ft.uid}, mediaType: ${Ct}`),Ct==="audio"&&ft.audioTrack&&ft.audioTrack.stop()},et=ft=>{K.log(`User joined: ${ft.uid}`),M(Ct=>Ct.some(ut=>ut.uid===ft.uid)?Ct:[...Ct,ft])},St=ft=>{K.log(`User left: ${ft.uid}`),M(Ct=>Ct.filter(ut=>ut.uid!==ft.uid))};return De.current.on("user-published",nt),De.current.on("user-unpublished",mt),De.current.on("user-joined",et),De.current.on("user-left",St),(async()=>{if(Te.current){K.log("Already initializing, skipping duplicate initialization");return}Te.current=!0;try{if(v&&we.current===i){K.log(`Already joined to channel ${i}`),ae(!0),y(De.current);return}if(De.current.connectionState==="CONNECTING"||De.current.connectionState==="CONNECTED")if(we.current&&we.current!==i){K.log("Connected to different channel, leaving first");try{await ve()}catch(ft){K.error("Error leaving channel:",ft)}}else{w(!0),ae(!0),we.current=i,tC=i,y(De.current);return}K.log(`Joining channel ${i}`),await Oe(),K.log("Join channel completed")}catch(ft){K.error("Error during initialization:",ft)}finally{Te.current=!1}})(),()=>{K.log("Cleaning up event listeners"),De.current.off("user-published",nt),De.current.off("user-unpublished",mt),De.current.off("user-joined",et),De.current.off("user-left",St)}},[i,u,l,y,v]);const Ie=async()=>{if(!u||q)return q;K.log("Initializing microphone");try{const nt=await SR.createMicrophoneAudioTrack();return await nt.setMuted(p),re(nt),K.log("Microphone initialized successfully"),nt}catch(nt){return K.error("Error initializing microphone:",nt),U("Failed to initialize microphone. Please check your permissions."),null}};O.useEffect(()=>{(async()=>{if(i)try{const St=await sd(i);St&&St.voiceDisabled?(K.log("Voice is disabled for this space"),de(!0),v&&await ve()):de(!1)}catch(et){K.error("Error checking if voice is disabled:",et)}})();const mt=et=>{et.detail&&typeof et.detail.voiceDisabled=="boolean"&&(K.log("Voice setting changed:",et.detail.voiceDisabled),de(et.detail.voiceDisabled),et.detail.voiceDisabled&&v?ve():!et.detail.voiceDisabled&&!v&&u&&i&&Oe())};return window.addEventListener("SpaceVoiceSettingChanged",mt),()=>{window.removeEventListener("SpaceVoiceSettingChanged",mt)}},[i,v,u]);const Oe=async()=>{if(!u)return K.log("Agora is disabled, not joining channel"),!1;if(fe)return K.log("Voice is disabled for this space, not joining channel"),U("Voice chat is disabled for this space"),!1;if(!i)return K.error("AgoraProvider: No channel specified"),U("No channel specified"),!1;if(K.log(`joinChannel called for channel ${i} with UID ${l}`),K.log("Current state:",{isJoined:v,isJoining:pe,connectionState:De.current.connectionState,joinedChannel:we.current}),v&&we.current===i)return K.log(`Already joined to channel: ${i}`),!0;if(pe)return K.log("AgoraProvider: Already in the process of joining"),!1;if(De.current.connectionState==="CONNECTED")if(we.current&&we.current!==i){K.log("Connected to different channel, leaving first");try{await ve()}catch(nt){K.error("Error leaving channel:",nt)}}else return K.log("Client already connected, setting joined state to true"),w(!0),ae(!0),we.current=i,tC=i,y(De.current),!0;if(De.current.connectionState==="CONNECTING")return K.log("Client already connecting, waiting for connection"),H(!0),new Promise(nt=>{const mt=setInterval(()=>{De.current.connectionState==="CONNECTED"&&(clearInterval(mt),w(!0),H(!1),ae(!0),we.current=i,tC=i,y(De.current),nt(!0))},500);setTimeout(()=>{clearInterval(mt),K.log("AgoraProvider: Connection timeout, considering join failed"),H(!1),nt(!1)},1e4)});try{if(K.log(`Joining channel: ${i} with UID: ${l||"random"}`),K.log(`Using appId: ${e}, Type: ${typeof e}, Length: ${e.length}`),!e||e.trim()===""){const mt="AgoraProvider: App ID is empty or invalid";return K.error(mt),U(mt),H(!1),!1}H(!0);const nt=l||Math.floor(Math.random()*1e6);return await De.current.join(e,i,o,nt),K.log(`Joined channel successfully with UID: ${De.current.uid}`),w(!0),H(!1),ae(!0),we.current=i,tC=i,y(De.current),!0}catch(nt){return K.error("Error joining channel:",nt),U(`Error joining channel: ${nt.toString()}`),H(!1),!1}},ve=async()=>{if(v)try{q&&await De.current.unpublish(q),await De.current.leave(),tC=null,we.current=null,K.log("Left channel successfully"),w(!1),M([])}catch(nt){K.error("Error leaving channel:",nt),U(nt.message||"Failed to leave channel")}};O.useEffect(()=>()=>{q&&q.close()},[]),O.useEffect(()=>{u&&i&&(!v||we.current!==i)&&Oe()},[u,i,v]);const xe=()=>{if(!q)return!1;try{return q.isActive&&!q.muted}catch(nt){return K.error("Error checking microphone status:",nt),!1}};O.useEffect(()=>{const nt=()=>{const et=xe();et!==C&&(K.log("Syncing microphone state:",{actualStatus:et,currentState:C}),R(et),window.dispatchEvent(new CustomEvent("VoiceToggled",{detail:{enabled:et}})),window.agoraClient&&(window.agoraClient.isVoiceEnabled=et,window.agoraClient.microphoneTrack=q))};q&&nt();const mt=setInterval(nt,1e3);return()=>{clearInterval(mt)}},[q,C]);const Ge=async()=>{var nt;if(fe)return K.log("Voice is disabled for this space, cannot toggle"),ke({title:"Voice Chat Disabled",description:"Voice chat has been disabled for this space by the owner.",status:"info",duration:3e3,isClosable:!0}),!1;try{const mt=C!==void 0?C:q?!q.muted:!1;if(K.log("AgoraProvider: Toggling voice, current state:",{isVoiceEnabled:C,currentState:mt,hasMicTrack:!!q,trackMuted:q==null?void 0:q.muted}),!q&&(K.log("AgoraProvider: No microphone track, initializing..."),!await Ie()))return K.error("AgoraProvider: Failed to initialize microphone"),mt;const et=!mt;if(K.log("AgoraProvider: New voice state will be:",et),mt){if(q)try{K.log("AgoraProvider: Muting microphone track"),await q.setMuted(!0),q.muted||(K.warn("AgoraProvider: Track not muted after setMuted(true), trying again"),await q.setEnabled(!1)),K.log("AgoraProvider: Microphone track muted successfully, muted state:",q.muted)}catch(St){return K.error("Error muting track:",St),mt}}else if(q)try{De.current&&v&&!((nt=De.current.localTracks)!=null&&nt.includes(q))&&(K.log("AgoraProvider: Publishing microphone track"),await De.current.publish(q),K.log("AgoraProvider: Microphone track published successfully")),K.log("AgoraProvider: Unmuting microphone track"),await q.setMuted(!1),q.muted&&(K.warn("AgoraProvider: Track still muted after setMuted(false), trying again"),await q.setEnabled(!0)),K.log("AgoraProvider: Microphone track unmuted successfully, muted state:",q.muted)}catch(St){return K.error("Error unmuting track:",St),mt}return R(et),et}catch(mt){return K.error("Error toggling voice:",mt),C}},Ze=async nt=>{try{re(nt),K.log("Microphone track updated successfully")}catch(mt){throw K.error("Error updating microphone track:",mt),mt}},lt=async()=>{if(!De.current||!i)return K.error("AgoraProvider: Voice chat not connected"),!1;try{if(X)return K.log("AgoraProvider: Stopping screen share"),ne&&(Array.isArray(ne)?(await De.current.unpublish(ne),ne.forEach(nt=>nt.close())):(await De.current.unpublish(ne),ne.close()),he(null)),Q(!1),K.log("AgoraProvider: Screen sharing stopped"),typeof window<"u"&&(window.agoraClient||(window.agoraClient={}),window.agoraClient.isScreenSharing=!1,window.agoraClient.screenTrack=null,window.dispatchEvent(new CustomEvent("ScreenShareToggled",{detail:{enabled:!1}}))),!1;K.log("AgoraProvider: Starting screen share");try{const nt=await SR.createScreenVideoTrack({encoderConfig:"1080p_1",optimizationMode:"detail"});return K.log("AgoraProvider: Screen track created:",nt),nt.on("track-ended",()=>{K.log("AgoraProvider: Screen sharing ended by browser UI"),De.current.unpublish(nt),nt.close(),he(null),Q(!1),typeof window<"u"&&(window.agoraClient||(window.agoraClient={}),window.agoraClient.isScreenSharing=!1,window.agoraClient.screenTrack=null,window.dispatchEvent(new CustomEvent("ScreenShareToggled",{detail:{enabled:!1}})))}),await De.current.publish(nt),he(nt),Q(!0),K.log("AgoraProvider: Screen sharing started"),typeof window<"u"&&(window.agoraClient||(window.agoraClient={}),window.agoraClient.isScreenSharing=!0,window.agoraClient.screenTrack=nt,window.dispatchEvent(new CustomEvent("ScreenShareToggled",{detail:{enabled:!0}}))),!0}catch(nt){return K.error("AgoraProvider: Error creating screen track:",nt),Q(!1),he(null),!1}}catch(nt){return K.error("AgoraProvider: Error toggling screen share:",nt),Q(!1),he(null),!1}};O.useEffect(()=>{if(K.log("AgoraProvider: Initializing window.agoraClient"),typeof window<"u"){window.agoraClient={isVoiceEnabled:!1,isJoined:!1,client:De.current,isScreenSharing:!1,screenTrack:null};const nt=et=>{K.log("AgoraProvider: Received ToggleScreenShare event"),lt().then(St=>{et.detail&&et.detail.callback&&et.detail.callback(!0,St)}).catch(St=>{K.error("AgoraProvider: Error handling ToggleScreenShare event:",St),et.detail&&et.detail.callback&&et.detail.callback(!1,X)})},mt=et=>{K.log("AgoraProvider: Received JoinVoiceChat event"),Oe().then(St=>{et.detail&&et.detail.callback&&et.detail.callback(St)}).catch(St=>{K.error("AgoraProvider: Error handling JoinVoiceChat event:",St),et.detail&&et.detail.callback&&et.detail.callback(!1)})};return window.addEventListener("ToggleScreenShare",nt),window.addEventListener("JoinVoiceChat",mt),()=>{window.removeEventListener("ToggleScreenShare",nt),window.removeEventListener("JoinVoiceChat",mt),typeof window<"u"&&window.agoraClient&&(K.log("AgoraProvider: Cleaning up window.agoraClient"),window.agoraClient=null)}}return()=>{typeof window<"u"&&window.agoraClient&&(K.log("AgoraProvider: Cleaning up window.agoraClient"),window.agoraClient=null)}},[]),O.useEffect(()=>{K.log("AgoraProvider: Voice enabled state changed:",C),typeof window<"u"&&(window.agoraClient||(window.agoraClient={}),window.agoraClient.isVoiceEnabled=C,window.agoraClient.microphoneTrack=q,window.agoraClient.client=De.current,window.dispatchEvent(new CustomEvent("VoiceToggled",{detail:{enabled:C}})),K.log("AgoraProvider: Updated window.agoraClient and dispatched event:",{isVoiceEnabled:C}))},[C,q]);const vt={client:De.current,isJoined:v,isVoiceEnabled:C,users:N,error:L,channel:z,appId:e,toggleVoice:Ge,leaveChannel:ve,joinChannel:Oe,microphoneTrack:q,isReady:ce,createMicrophoneTrack:Ze,isScreenSharing:X,screenTrack:ne,toggleScreenShare:lt,voiceDisabled:fe};return S.jsx($ae.Provider,{value:vt,children:n})},qae=()=>{const n=O.useContext($ae);if(!n)throw new Error("useAgoraContext must be used within an AgoraProvider");return n};Kae.propTypes={children:Tn.node.isRequired,appId:Tn.string.isRequired,channel:Tn.string.isRequired,token:Tn.string,uid:Tn.oneOfType([Tn.string,Tn.number])};const h9e=()=>{var Te,we;const{client:n,isVoiceEnabled:e,isJoined:i,users:o,error:l,microphoneTrack:u,isReady:p,channel:y,appId:v,toggleVoice:w,joinChannel:C,leaveChannel:R,createMicrophoneTrack:N,isScreenSharing:M,screenTrack:L,toggleScreenShare:U,voiceDisabled:z}=qae(),[J,q]=O.useState(e!==void 0?e:((Te=window.agoraClient)==null?void 0:Te.isVoiceEnabled)||!1),[re,ce]=O.useState(M!==void 0?M:((we=window.agoraClient)==null?void 0:we.isScreenSharing)||!1),[ae,pe]=O.useState(z!==void 0?z:!1),[H,X]=O.useState(!0);O.useEffect(()=>{var Ie;e!==void 0?q(e):((Ie=window.agoraClient)==null?void 0:Ie.isVoiceEnabled)!==void 0?q(window.agoraClient.isVoiceEnabled):u&&q(!u.muted)},[e,u]),O.useEffect(()=>{var Ie;M!==void 0?ce(M):((Ie=window.agoraClient)==null?void 0:Ie.isScreenSharing)!==void 0&&ce(window.agoraClient.isScreenSharing)},[M]),O.useEffect(()=>{z!==void 0&&pe(z)},[z]);const Q=O.useRef({isVoiceEnabled:J,isScreenSharing:re,isJoined:i,users:o,error:l,isReady:p,channel:y,appId:v,voiceDisabled:ae});O.useEffect(()=>{Q.current={isVoiceEnabled:J,isScreenSharing:re,isJoined:i,users:o,error:l,isReady:p,channel:y,appId:v,voiceDisabled:ae}},[J,re,i,o,l,p,y,v,ae]),O.useEffect(()=>{const Ie=setTimeout(()=>{X(!1)},5e3);return()=>clearTimeout(Ie)},[]),O.useEffect(()=>{p&&X(!1)},[p]),O.useEffect(()=>{console.log("useVoiceChat context:",{contextIsVoiceEnabled:e,localVoiceEnabled:J,contextIsScreenSharing:M,localScreenSharing:re,isJoined:i,users:o.length,error:l,isReady:p,channel:y,appId:v,hasMicrophoneTrack:!!u,trackMuted:u==null?void 0:u.muted,hasScreenTrack:!!L})},[e,J,M,re,i,o,l,p,y,v,u,L]);const ne=async()=>{try{console.log("useVoiceChat: Toggling voice from:",J);const Ie=await w();if(console.log("useVoiceChat: Toggle result:",Ie),Ie!==void 0)q(Ie);else{const Oe=!J;q(Oe),window.agoraClient&&(window.agoraClient.isVoiceEnabled=Oe)}return Ie!==void 0?Ie:!J}catch(Ie){return console.error("useVoiceChat: Error toggling voice:",Ie),J}},he=async()=>{try{console.log("useVoiceChat: Toggling screen share from:",re);const Ie=await U();if(console.log("useVoiceChat: Screen share toggle result:",Ie),Ie!==void 0)ce(Ie);else{const Oe=!re;ce(Oe),window.agoraClient&&(window.agoraClient.isScreenSharing=Oe)}return Ie!==void 0?Ie:!re}catch(Ie){return console.error("useVoiceChat: Error toggling screen share:",Ie),re}},fe=async()=>{J&&u&&await ne()},de=async()=>{!J&&u&&await ne()},ke=Ie=>o.some(Oe=>{var ve;return Oe.uid===Ie&&((ve=Oe.audioTrack)==null?void 0:ve.isPlaying)}),De=O.useCallback(()=>{if(!u||!J)return 0;try{return u.getVolumeLevel()}catch(Ie){return console.error("Error getting volume level:",Ie),0}},[u,J]);return{isVoiceEnabled:J,isScreenSharing:re,isJoined:i,users:o,error:l,toggleVoice:ne,toggleScreenShare:he,mute:fe,unmute:de,isUserSpeaking:ke,getVolumeLevel:De,microphoneTrack:u,screenTrack:L,isLoading:H,channel:y,appId:v,joinChannel:C,leaveChannel:R,client:n,setMicrophoneDevice:async Ie=>{try{if(!Ie){console.error("No device ID provided");return}if(!n||!i){console.error("Client not initialized or not joined to a channel");return}u&&(J&&await n.unpublish(u),await u.close());const Oe=await SR.createMicrophoneAudioTrack({microphoneId:Ie,encoderConfig:"music_standard"});N&&await N(Oe),J&&await n.publish(Oe),console.log("Microphone device changed successfully")}catch(Oe){throw console.error("Error changing microphone device:",Oe),Oe}},voiceDisabled:ae}},p9e=({size:n="md",tooltipPlacement:e="top",defaultMuted:i=!0,joinOnClick:o=!0,className:l="voice-button"})=>{const{isVoiceEnabled:u,toggleVoice:p,isJoined:y,joinChannel:v,channel:w,client:C,voiceDisabled:R}=h9e(),[N,M]=O.useState(!1),[L,U]=O.useState(!1);O.useEffect(()=>{const q=()=>{K.log("VoiceButton: Player instantiated, showing button"),U(!0)};return window.addEventListener("PlayerInstantiated",q),window.isPlayerInstantiated&&(K.log("VoiceButton: Player was already instantiated"),U(!0)),()=>{window.removeEventListener("PlayerInstantiated",q)}},[]),O.useEffect(()=>{console.log("VoiceButton: State:",{isVoiceEnabled:u,isJoined:y,channel:w,hasClient:!!C,clientState:C==null?void 0:C.connectionState,windowAgoraClient:window.agoraClient,isPlayerReady:L,voiceDisabled:R})},[u,y,w,C,L,R]);const z=async()=>{if(!(N||R)){M(!0),console.log("VoiceButton: Handling click, current state:",{isVoiceEnabled:u,isJoined:y});try{if(!y&&o)try{console.log("VoiceButton: Not joined, attempting to join channel"),await v(),console.log("VoiceButton: Joined channel successfully")}catch(re){re.message&&re.message.includes("already in connecting/connected state")?console.log("VoiceButton: Already connected to channel"):console.error("VoiceButton: Error joining channel:",re)}console.log("VoiceButton: Toggling voice state from:",u);const q=await p();console.log("VoiceButton: Voice toggled, new state:",q)}catch(q){console.error("VoiceButton: Error toggling voice:",q)}finally{M(!1)}}},J=()=>R?"Voice chat is disabled for this space":L?N?"Processing...":y?u?"Turn microphone off":"Turn microphone on":"Connecting to voice chat...":"Waiting for player to be ready...";return!L||R?null:S.jsx(Uf,{label:J(),placement:e,hasArrow:!0,children:S.jsxs(ct,{position:"relative",cursor:"pointer",onClick:z,children:[S.jsx(ml,{size:n,borderRadius:"full",bg:u?"green.500":"red.500",icon:u?S.jsx(zae,{color:"white"}):S.jsx(Bae,{color:"white"}),borderWidth:"1px",borderColor:"whiteAlpha.300",className:l,"data-testid":"voice-button"}),N&&S.jsx(ct,{position:"absolute",top:"0",left:"0",right:"0",bottom:"0",display:"flex",alignItems:"center",justifyContent:"center",bg:"rgba(0, 0, 0, 0.6)",borderRadius:"full",children:S.jsx(ld,{size:"sm",color:"white"})})]})})},f9e=bi.createContext({user:null}),m9e=({userNickname:n})=>{const{client:e,channel:i,screenTrack:o,isScreenSharing:l,toggleScreenShare:u}=qae(),[p,y]=O.useState([]),[v,w]=O.useState(!1),[C,R]=O.useState(!0);O.useRef({});const N=O.useRef(null);O.useRef(null);const{user:M}=O.useContext(f9e)||{user:null},[L,U]=O.useState({}),z=O.useRef(o),[J,q]=O.useState(null),{isOpen:re,onOpen:ce,onClose:ae}=od(),[pe,H]=O.useState(!1),X=O.useRef(null),Q=O.useRef(null);O.useEffect(()=>{z.current=o},[o]),O.useEffect(()=>{if(!e||!i){w(!1);return}const ke=setTimeout(()=>{R(!1)},5e3);console.log("Setting up screen share display with existing client:",e),console.log("Current channel:",i);const De=e.connectionState;if(console.log("Current connection state:",De),De==="CONNECTED")w(!0),R(!1);else{w(!1);const je=Te=>{console.log("Connection state changed:",Te),Te==="CONNECTED"?(w(!0),R(!1)):w(!1)};return e.on("connection-state-change",je),()=>{e.off("connection-state-change",je),clearTimeout(ke)}}return()=>{clearTimeout(ke)}},[e,i]),O.useEffect(()=>{const ke=async()=>{const De={...L};let je=!1;for(const Te of p){if(L[Te.uid])continue;let we=null,Ie=Te.uid;if(typeof Ie=="string"&&(Ie.includes("-")?(we=Ie.split("-")[0],Ie=Ie.split("-")[1]):Ie.includes("_")&&(we=Ie.split("_")[0],Ie=Ie.split("_")[1])),Ie)try{console.log("Trying to fetch nickname for user ID:",Ie);const Oe=await su(Ie);Oe&&Oe.Nickname?(console.log("Found nickname in Firebase for user ID:",Ie,"Nickname:",Oe.Nickname),De[Te.uid]=Oe.Nickname,je=!0):we?(console.log("Using extracted name for user ID:",Ie,"Name:",we),De[Te.uid]=we,je=!0):(De[Te.uid]="User",je=!0)}catch(Oe){console.error("Error fetching user profile:",Oe),we?(De[Te.uid]=we,je=!0):(De[Te.uid]="User",je=!0)}else we?(De[Te.uid]=we,je=!0):(De[Te.uid]="User",je=!0)}je&&U(De)};p.length>0&&ke()},[p,L]),O.useEffect(()=>{if(!e||!i||!v)return;console.log("Setting up screen share event handlers");const ke=async(Te,we)=>{if(console.log("User published:",Te.uid,we,Te),we==="video"){console.log("Remote video track detected:",Te.uid);try{await e.subscribe(Te,we),console.log("Subscribed to remote video track:",Te.uid),y(Ie=>Ie.some(Oe=>Oe.uid===Te.uid)?Ie:[...Ie,Te])}catch(Ie){console.error("Error subscribing to remote video track:",Ie)}}},De=(Te,we)=>{if(console.log("User unpublished:",Te.uid,we),we==="video"){if(console.log("Remote video track unpublished:",Te.uid),Te.videoTrack)try{Te.videoTrack.stop()}catch(Ie){console.error("Error stopping video track:",Ie)}if(y(Ie=>Ie.filter(Oe=>Oe.uid!==Te.uid)),l&&z.current&&N.current)try{console.log("Ensuring local screen track is still playing after remote user unpublished"),z.current.play(N.current)}catch(Ie){console.error("Error replaying local screen track:",Ie)}}},je=Te=>{console.log("User left:",Te.uid);const we=p.find(Ie=>Ie.uid===Te.uid);if(we&&we.videoTrack)try{we.videoTrack.stop()}catch(Ie){console.error("Error stopping video track:",Ie)}if(y(Ie=>Ie.filter(Oe=>Oe.uid!==Te.uid)),l&&z.current&&N.current)try{console.log("Ensuring local screen track is still playing after remote user left"),z.current.play(N.current)}catch(Ie){console.error("Error replaying local screen track:",Ie)}};return e.on("user-published",ke),e.on("user-unpublished",De),e.on("user-left",je),()=>{e.off("user-published",ke),e.off("user-unpublished",De),e.off("user-left",je)}},[e,i,v,p,l]),O.useEffect(()=>{if(console.log("Remote screens changed:",p.length,p),p.forEach(ke=>{if(ke.videoTrack)try{console.log("Playing video track for:",ke.uid),ke.videoTrack.play(`video-container-${ke.uid}`)}catch(De){console.error("Error playing video track:",De)}}),l&&z.current&&N.current)try{console.log("Ensuring local screen track is still playing after remote screens changed"),z.current.play(N.current)}catch(ke){console.error("Error replaying local screen track:",ke)}},[p,l]),O.useEffect(()=>{if(console.log("Local screen sharing state changed:",l,o),l&&o&&N.current)try{console.log("Playing local screen track"),o.play(N.current)}catch(ke){console.error("Error playing local screen track:",ke)}},[l,o]),O.useEffect(()=>()=>{if(p.forEach(ke=>{if(ke.videoTrack)try{ke.videoTrack.stop()}catch(De){console.error("Error stopping video track on unmount:",De)}}),o)try{o.stop()}catch(ke){console.error("Error stopping local screen track on unmount:",ke)}},[p,o]);const ne=()=>{console.log("Stopping local screen share"),u()},he=ke=>(console.log("Getting display name for UID:",ke,"type:",typeof ke),l&&M&&(ke===M.uid||ke===(e==null?void 0:e.uid))?n||"You":L[ke]?L[ke]:typeof ke=="string"?ke.includes("-")?ke.split("-")[0]:ke.includes("_")?ke.split("_")[0]:ke:"User"),fe=ke=>{console.log("Opening modal for remote screen",ke),q(ke),ce()},de=()=>{console.log("Opening modal for local screen"),q({isLocal:!0}),ce()};return O.useEffect(()=>{re&&J?(console.log("Modal opened, activeScreen:",J),setTimeout(()=>{if(J.isLocal&&z.current)try{console.log("Playing local screen in modal"),z.current.play("modal-screen-container"),H(!0)}catch(ke){console.error("Error playing local screen in modal:",ke)}else if(J.videoTrack)try{console.log("Playing remote screen in modal"),J.videoTrack.play("modal-screen-container"),H(!0)}catch(ke){console.error("Error playing remote screen in modal:",ke)}},500)):re||(H(!1),q(null),setTimeout(()=>{if(l&&z.current)try{z.current.play("local-screen-container")}catch(ke){console.error("Error playing local screen in small container:",ke)}p.forEach(ke=>{if(ke.videoTrack)try{ke.videoTrack.play(`video-container-${ke.uid}`)}catch(De){console.error(`Error playing remote screen ${ke.uid} in small container:`,De)}})},500))},[re,J,l,p]),!v||C&&p.length===0&&!l||p.length===0&&!l?null:S.jsxs(S.Fragment,{children:[!re&&S.jsxs(ct,{position:"fixed",top:"20px",left:"20px",zIndex:1e4,overflow:"visible",ref:X,children:[l&&o&&S.jsxs(ct,{position:"relative",mb:4,borderRadius:"md",overflow:"hidden",boxShadow:"xl",bg:"black",width:"200px",height:"120px",cursor:"pointer",transition:"all 0.2s",_hover:{filter:"brightness(0.8)",transform:"scale(1.05)"},onClick:de,children:[S.jsx(ct,{id:"local-screen-container",width:"100%",height:"100%",position:"relative"}),S.jsx(ct,{position:"absolute",bottom:2,left:2,color:"white",fontSize:"xs",bg:"rgba(0,0,0,0.5)",px:2,py:1,borderRadius:"md",zIndex:5,children:n?`${n}'s Screen`:"Your Screen"})]}),p.map(ke=>{const De=L[ke.uid]||he(ke.uid);return S.jsxs(ct,{position:"relative",mb:4,borderRadius:"md",overflow:"hidden",boxShadow:"xl",bg:"black",width:"200px",height:"120px",cursor:"pointer",transition:"all 0.2s",_hover:{filter:"brightness(0.8)",transform:"scale(1.05)"},onClick:()=>fe(ke),children:[S.jsx(ct,{id:`video-container-${ke.uid}`,width:"100%",height:"100%",position:"relative"}),S.jsx(ct,{position:"absolute",bottom:2,left:2,color:"white",fontSize:"xs",bg:"rgba(0,0,0,0.5)",px:2,py:1,borderRadius:"md",zIndex:5,children:`${De}'s Screen`})]},ke.uid)})]}),re&&S.jsx(ct,{position:"fixed",top:"0",left:"0",width:"100vw",height:"100vh",bg:"rgba(0,0,0,0.8)",zIndex:1e4,display:"flex",justifyContent:"center",alignItems:"center",onClick:ae,children:S.jsxs(ct,{width:"80vw",height:"80vh",bg:"black",borderRadius:"md",overflow:"hidden",position:"relative",onClick:ke=>ke.stopPropagation(),children:[!pe&&S.jsxs(ct,{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",color:"white",textAlign:"center",children:[S.jsx(ld,{size:"xl"}),S.jsx(Ye,{mt:4,children:"Loading screen share..."})]}),S.jsx(ct,{id:"modal-screen-container",width:"100%",height:"100%",position:"relative",ref:Q}),S.jsx(ct,{position:"absolute",top:2,right:2,color:"white",bg:"rgba(0,0,0,0.5)",borderRadius:"full",width:"30px",height:"30px",display:"flex",justifyContent:"center",alignItems:"center",cursor:"pointer",onClick:ae,children:""}),S.jsx(ct,{position:"absolute",bottom:4,left:4,color:"white",fontSize:"sm",bg:"rgba(0,0,0,0.5)",px:3,py:2,borderRadius:"md",children:J!=null&&J.isLocal?n?`${n}'s Screen`:"Your Screen":`${L[J==null?void 0:J.uid]||he(J==null?void 0:J.uid)}'s Screen`}),(J==null?void 0:J.isLocal)&&S.jsx(ct,{position:"absolute",bottom:4,right:4,children:S.jsx(Nn,{colorScheme:"red",size:"sm",onClick:ne,children:"Stop Sharing"})})]})})]})},g9e=({onClose:n})=>{const e=Da(),[i,o]=O.useState(!1),[l,u]=O.useState(!1);O.useEffect(()=>{const v=()=>{window.agoraClient&&u(!!window.agoraClient.isScreenSharing)};v();const w=setInterval(v,1e3),C=()=>{v()};return window.addEventListener("ScreenShareToggled",C),()=>{clearInterval(w),window.removeEventListener("ScreenShareToggled",C)}},[]);const p=async v=>{if(v.preventDefault(),v.stopPropagation(),n&&n(),!window.agoraClient||!window.agoraClient.client){e({title:"Screen sharing not available",description:"Voice chat must be connected to use screen sharing",status:"warning",duration:3e3,isClosable:!0});return}try{if(o(!0),window.agoraClient.isJoined)y();else{console.log("ScreenShareMenuOption: Not joined to voice chat, joining automatically");const w=new CustomEvent("JoinVoiceChat",{detail:{callback:C=>{if(!C){console.error("ScreenShareMenuOption: Failed to join voice chat"),e({title:"Connection failed",description:"Could not connect to voice chat",status:"error",duration:3e3,isClosable:!0}),o(!1);return}y()}}});window.dispatchEvent(w)}}catch(w){console.error("Error in screen share handler:",w),o(!1),e({title:"Screen sharing error",description:w.message||"Failed to toggle screen sharing",status:"error",duration:5e3,isClosable:!0})}},y=async()=>{try{const v=new CustomEvent("ToggleScreenShare",{detail:{callback:(w,C)=>{o(!1),w?(u(C),e(C?{title:"Screen sharing started",status:"success",duration:3e3,isClosable:!0}:{title:"Screen sharing stopped",status:"info",duration:3e3,isClosable:!0})):e({title:"Screen sharing error",description:"Failed to toggle screen sharing",status:"error",duration:5e3,isClosable:!0})}}});window.dispatchEvent(v)}catch(v){console.error("Error toggling screen share:",v),o(!1),e({title:"Screen sharing error",description:v.message||"Failed to toggle screen sharing",status:"error",duration:5e3,isClosable:!0})}};return S.jsx(Ye,{fontSize:"sm",cursor:"pointer",_hover:{bg:"whiteAlpha.200"},p:1.5,borderRadius:"md",onClick:p,color:l?"red.300":"white",children:i?"Connecting...":l?"Stop Screen Sharing":"Share Screen"})};function _9e({open:n,onClose:e}){const[i,o]=O.useState(0);return S.jsxs(ls,{isOpen:n,onClose:e,size:"md",isCentered:!0,children:[S.jsx(ds,{backdropFilter:"blur(4px)"}),S.jsxs(us,{bg:"rgba(23, 25, 35, 0.95)",color:"white",borderRadius:"md",boxShadow:"0 4px 20px rgba(0, 0, 0, 0.5)",maxW:"600px",h:"350px",overflow:"hidden",children:[S.jsx(co,{borderBottom:"1px solid",borderColor:"whiteAlpha.200",py:2,fontSize:"md",fontWeight:"600",children:"Controls"}),S.jsx(Is,{size:"sm",color:"whiteAlpha.700",_hover:{color:"white",bg:"whiteAlpha.100"}}),S.jsx(gs,{p:0,display:"flex",children:S.jsxs(kS,{orientation:"vertical",variant:"unstyled",index:i,onChange:o,display:"flex",flexGrow:1,children:[S.jsxs(OS,{bg:"rgba(0, 0, 0, 0.2)",w:"80px",py:4,borderRight:"1px solid",borderColor:"whiteAlpha.200",children:[S.jsxs(Ia,{display:"flex",flexDirection:"column",alignItems:"center",py:3,_selected:{bg:"whiteAlpha.100",color:"blue.300"},_hover:{bg:"whiteAlpha.50"},children:[S.jsx(Sn,{as:$We,mb:1}),S.jsx(Ye,{fontSize:"xs",children:"Movement"})]}),S.jsxs(Ia,{display:"flex",flexDirection:"column",alignItems:"center",py:3,_selected:{bg:"whiteAlpha.100",color:"blue.300"},_hover:{bg:"whiteAlpha.50"},children:[S.jsx(Sn,{as:KWe,mb:1}),S.jsx(Ye,{fontSize:"xs",children:"Camera"})]}),S.jsxs(Ia,{display:"flex",flexDirection:"column",alignItems:"center",py:3,_selected:{bg:"whiteAlpha.100",color:"blue.300"},_hover:{bg:"whiteAlpha.50"},children:[S.jsx(Sn,{as:GWe,mb:1}),S.jsx(Ye,{fontSize:"xs",children:"Actions"})]}),S.jsxs(Ia,{display:"flex",flexDirection:"column",alignItems:"center",py:3,_selected:{bg:"whiteAlpha.100",color:"blue.300"},_hover:{bg:"whiteAlpha.50"},children:[S.jsx(Sn,{as:HWe,mb:1}),S.jsx(Ye,{fontSize:"xs",children:"Tips"})]})]}),S.jsxs(lR,{flexGrow:1,display:"flex",flexDirection:"column",children:[S.jsxs(Ic,{p:4,display:"flex",flexDirection:"column",h:"100%",children:[S.jsx(Ye,{fontSize:"sm",fontWeight:"600",mb:3,color:"blue.300",children:"Movement Controls"}),S.jsxs(Ur,{wrap:"wrap",gap:3,children:[S.jsx(Ql,{keyLabel:"W",description:"Move Forward"}),S.jsx(Ql,{keyLabel:"A",description:"Move Left"}),S.jsx(Ql,{keyLabel:"S",description:"Move Backward"}),S.jsx(Ql,{keyLabel:"D",description:"Move Right"}),S.jsx(Ql,{keyLabel:"Shift",description:"Run"}),S.jsx(Ql,{keyLabel:"Space",description:"Jump / Double Jump"})]})]}),S.jsxs(Ic,{p:4,display:"flex",flexDirection:"column",h:"100%",children:[S.jsx(Ye,{fontSize:"sm",fontWeight:"600",mb:3,color:"blue.300",children:"Camera Controls"}),S.jsxs(Ur,{wrap:"wrap",gap:3,children:[S.jsx(Ql,{keyLabel:"Mouse",description:"Look Around"}),S.jsx(Ql,{keyLabel:"Click + Drag",description:"Rotate Camera"}),S.jsx(Ql,{keyLabel:"Scroll",description:"Zoom In/Out"})]})]}),S.jsxs(Ic,{p:4,display:"flex",flexDirection:"column",h:"100%",children:[S.jsx(Ye,{fontSize:"sm",fontWeight:"600",mb:3,color:"blue.300",children:"Action Controls"}),S.jsxs(Ur,{wrap:"wrap",gap:3,children:[S.jsx(Ql,{keyLabel:"E",description:"Interact"}),S.jsx(Ql,{keyLabel:"F",description:"Emote Menu"}),S.jsx(Ql,{keyLabel:"T",description:"Chat"}),S.jsx(Ql,{keyLabel:"M",description:"Mute Mic"})]})]}),S.jsxs(Ic,{p:4,display:"flex",flexDirection:"column",h:"100%",children:[S.jsx(Ye,{fontSize:"sm",fontWeight:"600",mb:3,color:"blue.300",children:"Tips & Tricks"}),S.jsxs(Ir,{align:"stretch",spacing:2,children:[S.jsx(Ye,{fontSize:"xs",children:" Double-tap Shift to auto-run"}),S.jsx(Ye,{fontSize:"xs",children:" Press ESC to access settings"}),S.jsx(Ye,{fontSize:"xs",children:" Click on players to view their profile"}),S.jsx(Ye,{fontSize:"xs",children:" Use the minimap to navigate"})]})]})]})]})})]})]})}const Ql=({keyLabel:n,description:e})=>S.jsx(ct,{bg:"whiteAlpha.100",borderRadius:"md",p:2,minW:"120px",maxW:"180px",children:S.jsxs(Qn,{spacing:2,children:[S.jsx(ct,{bg:"whiteAlpha.200",borderRadius:"md",px:2,py:1,fontSize:"xs",fontWeight:"bold",minW:"30px",textAlign:"center",children:n}),S.jsx(Ye,{fontSize:"xs",children:e})]})}),y9e=({isOpen:n,onClose:e,containerRef:i})=>{const[o,l]=O.useState([]),[u,p]=O.useState(""),[y,v]=O.useState(0),[w,C]=O.useState(100),[R,N]=O.useState(100),[M,L]=O.useState(!0),[U,z]=O.useState(!0),[J,q]=O.useState(!1),[re,ce]=O.useState(null),[ae,pe]=O.useState(null),[H,X]=O.useState(null);O.useEffect(()=>{if(!n)return;(async()=>{try{await navigator.mediaDevices.getUserMedia({audio:!0});const ke=await SR.getMicrophones();l(ke),ke.length>0&&p(ke[0].deviceId)}catch(ke){console.error("Error getting audio devices:",ke)}})()},[n]),O.useEffect(()=>{if(!n||!J){v(0);return}let de;return(async()=>{try{const De=await navigator.mediaDevices.getUserMedia({audio:{deviceId:u?{exact:u}:void 0}});X(De);const je=new(window.AudioContext||window.webkitAudioContext),Te=je.createAnalyser(),we=je.createMediaStreamSource(De);Te.fftSize=256,Te.smoothingTimeConstant=.8,we.connect(Te),ce(je),pe(Te);const Ie=new Uint8Array(Te.frequencyBinCount),Oe=()=>{Te.getByteFrequencyData(Ie);const ve=Math.sqrt(Ie.reduce((Ze,lt)=>Ze+lt*lt,0)/Ie.length),Ge=Math.min(ve*3,255)/255*100*(w/100);v(Math.min(Ge,100)),J&&n&&(de=requestAnimationFrame(Oe))};Oe()}catch(De){console.error("Error setting up audio analysis:",De),v(0)}})(),()=>{de&&cancelAnimationFrame(de),H&&(H.getTracks().forEach(De=>De.stop()),X(null)),re&&(re.close(),ce(null)),pe(null),v(0)}},[J,n,u,w]);const Q=de=>{const ke=de.target.value;p(ke),console.log("Microphone changed to:",ke)},ne=de=>{C(de),console.log("Microphone volume set to:",de)},he=de=>{N(de),console.log("Speaker volume set to:",de)},fe=()=>{q(!J)};return S.jsx(Nc,{containerRef:i,children:S.jsxs(ls,{isOpen:n,onClose:e,size:"md",isCentered:!0,children:[S.jsx(ds,{bg:"rgba(0, 0, 0, 0.8)",backdropFilter:"blur(8px)"}),S.jsxs(us,{bg:"#1a1a1a",color:"white",borderRadius:"xl",border:"1px solid #333",maxW:"500px",children:[S.jsx(co,{fontSize:"md",fontWeight:"600",pb:1,pt:3,px:4,color:"white",children:"Voice Chat Settings"}),S.jsx(Is,{color:"white",bg:"rgba(255,255,255,0.1)",_hover:{color:"gray.400",bg:"transparent"},borderRadius:"full",size:"sm",top:2,right:3}),S.jsx(gs,{px:4,py:3,children:S.jsxs(Ir,{spacing:4,align:"stretch",children:[S.jsxs(br,{children:[S.jsxs(gi,{fontSize:"sm",fontWeight:"500",color:"white",mb:2,children:["Microphone",S.jsx(sh,{ml:2,bg:J?"rgba(34, 197, 94, 0.2)":"rgba(239, 68, 68, 0.2)",color:J?"#22c55e":"#ef4444",fontSize:"xs",px:2,py:1,borderRadius:"full",children:J?"Enabled":"Muted"})]}),S.jsxs(rie,{value:u,onChange:Q,bg:"rgba(255,255,255,0.05)",borderColor:"rgba(255,255,255,0.15)",_hover:{borderColor:"rgba(255,255,255,0.3)"},_focus:{borderColor:"rgba(255,255,255,0.5)",boxShadow:"0 0 0 1px rgba(255,255,255,0.3)"},borderRadius:"lg",size:"sm",fontSize:"xs",children:[o.map(de=>S.jsx("option",{value:de.deviceId,style:{backgroundColor:"#1a1a1a",color:"white"},children:de.label||`Microphone ${de.deviceId.slice(0,5)}...`},de.deviceId)),o.length===0&&S.jsx("option",{value:"",style:{backgroundColor:"#1a1a1a",color:"white"},children:"No microphones found"})]})]}),S.jsxs(ct,{children:[S.jsx(Ye,{fontSize:"sm",fontWeight:"500",color:"white",mb:2,children:"Microphone Level"}),S.jsx(qy,{value:y,colorScheme:"green",size:"sm",borderRadius:"full",bg:"rgba(255,255,255,0.1)",hasStripe:y>20,isAnimated:y>20,sx:{"& > div":{backgroundColor:"#22c55e !important"}}})]}),S.jsxs(br,{children:[S.jsxs(gi,{fontSize:"sm",fontWeight:"500",color:"white",mb:2,children:["Microphone Volume: ",w,"%"]}),S.jsxs(aS,{value:w,onChange:ne,min:0,max:100,step:1,colorScheme:"gray",children:[S.jsx(lS,{bg:"rgba(255,255,255,0.1)",h:"6px",borderRadius:"full",children:S.jsx(uS,{})}),S.jsx(cS,{boxSize:4})]})]}),S.jsxs(br,{children:[S.jsxs(gi,{fontSize:"sm",fontWeight:"500",color:"white",mb:2,children:["Speaker Volume: ",R,"%"]}),S.jsxs(aS,{value:R,onChange:he,min:0,max:100,step:1,colorScheme:"gray",children:[S.jsx(lS,{bg:"rgba(255,255,255,0.1)",h:"6px",borderRadius:"full",children:S.jsx(uS,{})}),S.jsx(cS,{boxSize:4})]})]}),S.jsxs(br,{display:"flex",alignItems:"center",justifyContent:"space-between",children:[S.jsx(gi,{mb:"0",fontSize:"sm",fontWeight:"500",color:"white",children:"Microphone Enabled"}),S.jsx(Mf,{isChecked:J,onChange:fe,colorScheme:"gray",size:"md"})]}),S.jsxs(br,{display:"flex",alignItems:"center",justifyContent:"space-between",children:[S.jsx(gi,{mb:"0",fontSize:"sm",fontWeight:"500",color:"white",children:"Echo Cancellation"}),S.jsx(Mf,{isChecked:M,onChange:()=>L(!M),colorScheme:"gray",size:"md"})]}),S.jsxs(br,{display:"flex",alignItems:"center",justifyContent:"space-between",children:[S.jsx(gi,{mb:"0",fontSize:"sm",fontWeight:"500",color:"white",children:"Noise Suppression"}),S.jsx(Mf,{isChecked:U,onChange:()=>z(!U),colorScheme:"gray",size:"md"})]}),S.jsx(ct,{mt:2,p:3,bg:"rgba(255,255,255,0.05)",borderRadius:"lg",border:"1px solid rgba(255,255,255,0.1)",children:S.jsx(Ye,{fontSize:"xs",color:"gray.400",children:"Note: These settings will be applied when you join a voice chat."})})]})})]})]})})};function E9e({open:n,onClose:e,containerRef:i}){const[o,l]=O.useState(!1),[u,p]=O.useState(100),[y,v]=O.useState(100),[w,C]=O.useState(100),R=lc(),N=()=>{l(!0)},M=()=>{l(!1)},L=J=>{p(J),R("SetMasterVolume",{volume:J/100})},U=J=>{v(J),R("SetMusicVolume",{volume:J/100})},z=J=>{C(J),R("SetSFXVolume",{volume:J/100})};return n?S.jsxs(S.Fragment,{children:[S.jsx(Nc,{containerRef:i,children:S.jsx(ct,{position:"absolute",top:"0",left:"0",right:"0",bottom:"0",backdropFilter:"blur(2px)",bg:"rgba(0, 0, 0, 0.3)",zIndex:"999",opacity:n?1:0,visibility:n?"visible":"hidden",transition:"opacity 0.3s ease-in-out, visibility 0.3s ease-in-out",pointerEvents:n?"auto":"none",onClick:e})}),S.jsx(Nc,{containerRef:i,children:S.jsxs(ct,{position:"absolute",top:"0",right:"0",bottom:"0",width:"35%",minWidth:"600px",bg:"rgba(26, 32, 44, 0.95)",backdropFilter:"blur(10px)",borderLeft:"1px solid rgba(255, 255, 255, 0.1)",zIndex:"1000",color:"white",overflowY:"auto",transform:n?"translateX(0)":"translateX(100%)",transition:"transform 0.4s cubic-bezier(0.4, 0, 0.2, 1)",maxHeight:"100vh",children:[S.jsx(ct,{p:4,borderBottom:"1px solid rgba(255, 255, 255, 0.1)",position:"sticky",top:"0",bg:"rgba(26, 32, 44, 0.95)",backdropFilter:"blur(10px)",zIndex:"1001",children:S.jsxs(Qn,{justify:"space-between",align:"center",children:[S.jsx(Ye,{fontSize:"xl",fontWeight:"bold",children:"Settings"}),S.jsx(Nn,{variant:"ghost",size:"xs",onClick:e,color:"white",_hover:{bg:"whiteAlpha.200"},"aria-label":"Close settings",minW:"auto",h:"auto",p:1,children:""})]})}),S.jsx(ct,{p:4,children:S.jsxs(kS,{variant:"unstyled",colorScheme:"blue",children:[S.jsxs(OS,{mb:4,bg:"rgba(255, 255, 255, 0.1)",borderRadius:"md",p:.5,children:[S.jsx(Ia,{_selected:{bg:"blue.500",color:"white",borderRadius:"sm"},color:"whiteAlpha.700",_hover:{color:"white"},flex:"1",fontWeight:"medium",fontSize:"sm",py:2,px:3,children:"Audio & Video"}),S.jsx(Ia,{_selected:{bg:"blue.500",color:"white",borderRadius:"sm"},color:"whiteAlpha.700",_hover:{color:"white"},flex:"1",fontWeight:"medium",fontSize:"sm",py:2,px:3,children:"Graphics"})]}),S.jsxs(lR,{children:[S.jsx(Ic,{p:0,children:S.jsxs(Ir,{spacing:6,align:"stretch",children:[S.jsxs(ct,{children:[S.jsx(Ye,{fontSize:"lg",fontWeight:"bold",mb:4,color:"white",children:"Audio"}),S.jsxs(Ir,{spacing:3,align:"stretch",children:[S.jsxs(Qn,{justify:"space-between",align:"center",children:[S.jsx(Ye,{fontSize:"sm",color:"white",minW:"120px",children:"Master Volume"}),S.jsxs(Qn,{spacing:3,flex:"1",justify:"flex-end",children:[S.jsxs(Ye,{fontSize:"sm",color:"whiteAlpha.800",minW:"50px",textAlign:"right",children:[u,"%"]}),S.jsx(ct,{width:"180px",children:S.jsxs(aS,{value:u,onChange:L,min:0,max:100,step:1,colorScheme:"blue",size:"sm",children:[S.jsx(lS,{bg:"whiteAlpha.300",h:"4px",children:S.jsx(uS,{})}),S.jsx(cS,{boxSize:4})]})})]})]}),S.jsxs(Qn,{justify:"space-between",align:"center",children:[S.jsx(Ye,{fontSize:"sm",color:"white",minW:"120px",children:"Music Volume"}),S.jsxs(Qn,{spacing:3,flex:"1",justify:"flex-end",children:[S.jsxs(Ye,{fontSize:"sm",color:"whiteAlpha.800",minW:"50px",textAlign:"right",children:[y,"%"]}),S.jsx(ct,{width:"180px",children:S.jsxs(aS,{value:y,onChange:U,min:0,max:100,step:1,colorScheme:"green",size:"sm",children:[S.jsx(lS,{bg:"whiteAlpha.300",h:"4px",children:S.jsx(uS,{})}),S.jsx(cS,{boxSize:4})]})})]})]}),S.jsxs(Qn,{justify:"space-between",align:"center",children:[S.jsx(Ye,{fontSize:"sm",color:"white",minW:"120px",children:"Sound Effects Volume"}),S.jsxs(Qn,{spacing:3,flex:"1",justify:"flex-end",children:[S.jsxs(Ye,{fontSize:"sm",color:"whiteAlpha.800",minW:"50px",textAlign:"right",children:[w,"%"]}),S.jsx(ct,{width:"180px",children:S.jsxs(aS,{value:w,onChange:z,min:0,max:100,step:1,colorScheme:"orange",size:"sm",children:[S.jsx(lS,{bg:"whiteAlpha.300",h:"4px",children:S.jsx(uS,{})}),S.jsx(cS,{boxSize:4})]})})]})]})]})]}),S.jsxs(ct,{children:[S.jsx(Ye,{fontSize:"lg",fontWeight:"bold",mb:4,color:"white",children:"Voice Chat"}),S.jsxs(Qn,{justify:"space-between",align:"center",children:[S.jsx(Ye,{fontSize:"sm",color:"white",children:"Microphone"}),S.jsx(Nn,{onClick:N,variant:"outline",size:"sm",colorScheme:"gray",borderColor:"whiteAlpha.400",color:"white",_hover:{bg:"whiteAlpha.200"},rightIcon:S.jsx(ct,{as:"span",children:""}),px:4})]})]})]})}),S.jsx(Ic,{p:0,children:S.jsxs(Ir,{spacing:4,align:"stretch",children:[S.jsx(Ye,{fontSize:"md",fontWeight:"semibold",children:"Graphics Settings"}),S.jsx(ct,{p:4,bg:"whiteAlpha.100",borderRadius:"md",border:"1px solid",borderColor:"whiteAlpha.200",children:S.jsx(Ye,{color:"whiteAlpha.700",fontSize:"sm",children:"Graphics settings will be available here."})})]})})]})]})})]})}),o&&S.jsx(y9e,{isOpen:o,onClose:M,containerRef:i})]}):null}function v9e(n){return Vr({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"circle",attr:{cx:"12",cy:"8",r:"7"}},{tag:"polyline",attr:{points:"8.21 13.89 7 23 12 20 17 23 15.79 13.88"}}]})(n)}function S9e(n){return Vr({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"path",attr:{d:"M23 19a2 2 0 0 1-2 2H3a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h4l2-3h6l2 3h4a2 2 0 0 1 2 2z"}},{tag:"circle",attr:{cx:"12",cy:"13",r:"4"}}]})(n)}function gZ(n){return Vr({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"rect",attr:{x:"2",y:"2",width:"20",height:"20",rx:"2.18",ry:"2.18"}},{tag:"line",attr:{x1:"7",y1:"2",x2:"7",y2:"22"}},{tag:"line",attr:{x1:"17",y1:"2",x2:"17",y2:"22"}},{tag:"line",attr:{x1:"2",y1:"12",x2:"22",y2:"12"}},{tag:"line",attr:{x1:"2",y1:"7",x2:"7",y2:"7"}},{tag:"line",attr:{x1:"2",y1:"17",x2:"7",y2:"17"}},{tag:"line",attr:{x1:"17",y1:"17",x2:"22",y2:"17"}},{tag:"line",attr:{x1:"17",y1:"7",x2:"22",y2:"7"}}]})(n)}function Uy(n){return Vr({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"rect",attr:{x:"3",y:"3",width:"18",height:"18",rx:"2",ry:"2"}},{tag:"circle",attr:{cx:"8.5",cy:"8.5",r:"1.5"}},{tag:"polyline",attr:{points:"21 15 16 10 5 21"}}]})(n)}function b9e(n){return Vr({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"circle",attr:{cx:"12",cy:"12",r:"10"}},{tag:"line",attr:{x1:"12",y1:"16",x2:"12",y2:"12"}},{tag:"line",attr:{x1:"12",y1:"8",x2:"12.01",y2:"8"}}]})(n)}function w9e(n){return Vr({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"path",attr:{d:"M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"}},{tag:"path",attr:{d:"M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"}}]})(n)}function T9e(n){return Vr({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"circle",attr:{cx:"12",cy:"12",r:"3"}},{tag:"path",attr:{d:"M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"}}]})(n)}function C9e(n){return Vr({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"polygon",attr:{points:"12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"}}]})(n)}function _S(n){return Vr({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"polyline",attr:{points:"3 6 5 6 21 6"}},{tag:"path",attr:{d:"M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"}},{tag:"line",attr:{x1:"10",y1:"11",x2:"10",y2:"17"}},{tag:"line",attr:{x1:"14",y1:"11",x2:"14",y2:"17"}}]})(n)}function Qk(n){return Vr({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"path",attr:{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"}},{tag:"polyline",attr:{points:"17 8 12 3 7 8"}},{tag:"line",attr:{x1:"12",y1:"3",x2:"12",y2:"15"}}]})(n)}function R9e(n){return Vr({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"path",attr:{d:"M16 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"}},{tag:"circle",attr:{cx:"8.5",cy:"7",r:"4"}},{tag:"line",attr:{x1:"23",y1:"11",x2:"17",y2:"11"}}]})(n)}function I9e(n){return Vr({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"path",attr:{d:"M16 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"}},{tag:"circle",attr:{cx:"8.5",cy:"7",r:"4"}},{tag:"line",attr:{x1:"20",y1:"8",x2:"20",y2:"14"}},{tag:"line",attr:{x1:"23",y1:"11",x2:"17",y2:"11"}}]})(n)}function _Z(n){return Vr({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"path",attr:{d:"M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"}},{tag:"circle",attr:{cx:"9",cy:"7",r:"4"}},{tag:"path",attr:{d:"M23 21v-2a4 4 0 0 0-3-3.87"}},{tag:"path",attr:{d:"M16 3.13a4 4 0 0 1 0 7.75"}}]})(n)}function GC(n){return Vr({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"polygon",attr:{points:"23 7 16 12 23 17 23 7"}},{tag:"rect",attr:{x:"1",y:"5",width:"15",height:"14",rx:"2",ry:"2"}}]})(n)}function A9e(n){return Vr({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"polygon",attr:{points:"11 5 6 9 2 9 2 15 6 15 11 19 11 5"}},{tag:"path",attr:{d:"M19.07 4.93a10 10 0 0 1 0 14.14M15.54 8.46a5 5 0 0 1 0 7.07"}}]})(n)}const P9e=async()=>{try{K.log("tagsFirestore: Fetching all tags");const n=El(Yn,"tags"),e=await id(n),i=[];return e.forEach(o=>{i.push({id:o.id,...o.data()})}),i}catch(n){throw K.error("tagsFirestore: Error fetching tags:",n),n}},k9e=async n=>{try{K.log(`tagsFirestore: Fetching tag with ID: ${n}`);const e=wr(Yn,"tags",n),i=await Bo(e);return i.exists()?{id:i.id,...i.data()}:(K.warn(`tagsFirestore: Tag with ID ${n} not found`),null)}catch(e){throw K.error(`tagsFirestore: Error fetching tag with ID ${n}:`,e),e}},O9e=async({id:n,name:e,color:i,description:o})=>{try{K.log(`tagsFirestore: Creating new tag: ${e}`);const l={name:e,color:i||"#808080",description:o||"",createdAt:new Date,updatedAt:new Date};let u;if(n){const p=wr(Yn,"tags",n);await Hg(p,l),u=n}else{const p=El(Yn,"tags");u=(await d6e(p,l)).id}return{id:u,...l}}catch(l){throw K.error("tagsFirestore: Error creating tag:",l),l}},N9e=async(n,e)=>{try{K.log(`tagsFirestore: Adding tag ${e} to space ${n}`);const i=wr(Yn,"tags",e);if(!(await Bo(i)).exists())throw new Error(`Tag with ID ${e} does not exist`);const l=wr(Yn,"spaces",n);return await lo(l,{tags:h6e(e)}),!0}catch(i){throw K.error(`tagsFirestore: Error adding tag ${e} to space ${n}:`,i),i}},D9e=async(n,e)=>{try{K.log(`tagsFirestore: Removing tag ${e} from space ${n}`);const i=wr(Yn,"spaces",n);return await lo(i,{tags:Woe(e)}),!0}catch(i){throw K.error(`tagsFirestore: Error removing tag ${e} from space ${n}:`,i),i}},x9e=async n=>{try{K.log(`tagsFirestore: Getting tags for space ${n}`);const e=wr(Yn,"spaces",n),i=await Bo(e);if(!i.exists())throw new Error(`Space with ID ${n} not found`);const l=i.data().tags||[];if(l.length===0)return[];const u=[];for(const p of l){const y=await k9e(p);y&&u.push(y)}return u}catch(e){throw K.error(`tagsFirestore: Error getting tags for space ${n}:`,e),e}},L9e=async()=>{K.log("tagsFirestore: Initializing default tags");const n=[{id:"collaboration",name:"Collaboration",color:"#4287f5",description:"Spaces designed for team collaboration and meetings"},{id:"social",name:"Social",color:"#f54242",description:"Social gathering and networking spaces"},{id:"education",name:"Education",color:"#42f581",description:"Learning and educational environments"},{id:"events",name:"Events",color:"#f5a742",description:"Spaces optimized for hosting events"},{id:"showcase",name:"Showcase",color:"#9f42f5",description:"Spaces for exhibiting content and creations"},{id:"entertainment",name:"Entertainment",color:"#f542b3",description:"Entertainment and leisure spaces"},{id:"productivity",name:"Productivity",color:"#42dbf5",description:"Spaces focused on work and productivity"},{id:"featured",name:"Featured",color:"#f5f242",description:"Featured and highlighted spaces"}];try{let e=0,i=0;for(const o of n){K.log(`tagsFirestore: Processing tag: ${o.name}`);const l=wr(Yn,"tags",o.id);(await Bo(l)).exists()?(K.log(`tagsFirestore: Tag ${o.id} already exists, skipping`),i++):(await O9e(o),e++,K.log(`tagsFirestore: Created tag: ${o.name}`))}return K.log(`tagsFirestore: Tags initialization complete. Created: ${e}, Skipped: ${i}`),{created:e,skipped:i}}catch(e){throw K.error("tagsFirestore: Error initializing default tags:",e),e}},Yae=({spaceID:n})=>{const[e,i]=O.useState([]),[o,l]=O.useState([]),[u,p]=O.useState(!0),[y,v]=O.useState(!1),[w,C]=O.useState(!1),[R,N]=O.useState(null),{isOpen:M,onOpen:L,onClose:U}=od(),z=Da(),{user:J}=O.useContext(Zi),q=(J==null?void 0:J.groups)&&(J.groups.includes("disruptiveAdmin")||J.groups.includes("admin"));O.useEffect(()=>{re()},[n]);const re=async()=>{p(!0);try{let Q=[];try{Q=await P9e(),i(Q)}catch(ne){K.error("SpaceTagsManager: Error loading available tags:",ne),i([]),z({title:"Error loading tags",description:"Failed to load available tags. Please try again later.",status:"error",duration:3e3,isClosable:!0})}if(n)try{const ne=await x9e(n);l(ne)}catch(ne){K.error("SpaceTagsManager: Error loading space tags:",ne),l([]),z({title:"Error loading space tags",description:"Failed to load this space's tags. Please try again later.",status:"error",duration:3e3,isClosable:!0})}}catch(Q){K.error("SpaceTagsManager: Error in loadTags:",Q),z({title:"Error loading tags",description:"Failed to load tags. Please try again later.",status:"error",duration:3e3,isClosable:!0})}finally{p(!1)}},ce=async()=>{C(!0),N(null);try{const Q=await L9e();console.log("Tag initialization result:",Q),N(Q),z({title:"Tags initialized",description:`Successfully created ${Q.created} tags. Skipped ${Q.skipped} existing tags.`,status:"success",duration:4e3,isClosable:!0}),await re()}catch(Q){K.error("SpaceTagsManager: Error initializing tags:",Q),N(!1),z({title:"Error initializing tags",description:"Failed to initialize tags. Please try again later.",status:"error",duration:4e3,isClosable:!0})}finally{C(!1)}},ae=async Q=>{if(!(!n||!Q)){v(!0);try{await N9e(n,Q);const ne=e.find(he=>he.id===Q);ne&&l(he=>[...he,ne]),z({title:"Tag added",description:"Tag has been added to the space.",status:"success",duration:2e3,isClosable:!0})}catch(ne){K.error(`SpaceTagsManager: Error adding tag ${Q} to space:`,ne),z({title:"Error adding tag",description:"Failed to add tag to the space.",status:"error",duration:3e3,isClosable:!0})}finally{v(!1)}}},pe=async Q=>{if(!(!n||!Q)){v(!0);try{await D9e(n,Q),l(ne=>ne.filter(he=>he.id!==Q)),z({title:"Tag removed",description:"Tag has been removed from the space.",status:"info",duration:2e3,isClosable:!0})}catch(ne){K.error(`SpaceTagsManager: Error removing tag ${Q} from space:`,ne),z({title:"Error removing tag",description:"Failed to remove tag from the space.",status:"error",duration:3e3,isClosable:!0})}finally{v(!1)}}},H=()=>{const Q=o.map(ne=>ne.id);return e.filter(ne=>!Q.includes(ne.id))},X=H().length===0;return S.jsxs(ct,{children:[S.jsx(Ur,{mb:3,justifyContent:"space-between",alignItems:"center",children:S.jsxs(Qn,{spacing:2,ml:"auto",children:[q&&S.jsx(Nn,{size:"xs",leftIcon:S.jsx(y8e,{}),onClick:L,variant:"outline",colorScheme:"purple",children:"Admin"}),S.jsxs(VR,{children:[S.jsx(FR,{as:Nn,size:"xs",leftIcon:S.jsx(_8e,{}),rightIcon:S.jsx(fae,{}),isDisabled:u||y||X,children:X?"No Available Tags":"Add Tag"}),S.jsx(jR,{zIndex:1e3,bg:"gray.800",borderColor:"gray.700",color:"white",children:H().length>0?H().map(Q=>S.jsx(mp,{onClick:()=>ae(Q.id),icon:S.jsx(ct,{width:"12px",height:"12px",borderRadius:"full",bg:Q.color||"#888"}),_hover:{bg:"gray.700"},_focus:{bg:"gray.700"},_active:{bg:"gray.700"},_focusVisible:{bg:"gray.700"},bg:"gray.800",color:"white",children:Q.name},Q.id)):S.jsx(mp,{isDisabled:!0,bg:"gray.800",color:"gray.400",children:"No available tags to add"})})]})]})}),u?S.jsx(Ur,{justify:"center",py:4,children:S.jsx(ld,{size:"sm",color:"blue.300"})}):e.length===0?S.jsx(ct,{children:S.jsxs(Ye,{fontSize:"sm",color:"red.400",mb:2,children:["No tags have been created in the system yet.",q?" Use the Admin button to initialize tags.":" Ask an admin to initialize tags."]})}):o.length===0?S.jsx(Ye,{fontSize:"sm",color:"gray.400",fontStyle:"italic",children:"No tags assigned to this space."}):S.jsx(fie,{spacing:2,children:o.map(Q=>S.jsx(O5,{children:S.jsxs(lie,{size:"md",borderRadius:"full",variant:"subtle",colorScheme:"gray",boxShadow:`0 0 0 1px ${Q.color||"#888"}`,children:[S.jsx(ct,{width:"8px",height:"8px",borderRadius:"full",bg:Q.color||"#888",mr:1}),S.jsx(uie,{children:Q.name}),S.jsx(hie,{onClick:()=>pe(Q.id),isDisabled:y})]})},Q.id))}),S.jsxs(ls,{isOpen:M,onClose:U,size:"md",children:[S.jsx(ds,{backdropFilter:"blur(4px)"}),S.jsxs(us,{bg:"gray.800",color:"white",children:[S.jsx(co,{fontSize:"md",children:"Tag System Administration"}),S.jsx(Is,{}),S.jsxs(gs,{children:[S.jsx(Ye,{fontSize:"sm",mb:4,children:"Initialize the default tags in your Firestore database. This will create a set of predefined tags if they don't already exist."}),R&&S.jsxs(Ig,{status:"success",mb:4,borderRadius:"md",size:"sm",children:[S.jsx(Ag,{}),S.jsxs(Ye,{fontSize:"sm",children:["Tags initialized. Created: ",S.jsx("b",{children:R.created}),", Skipped: ",S.jsx("b",{children:R.skipped})]})]}),S.jsx(Nn,{colorScheme:"blue",onClick:ce,isLoading:w,loadingText:"Initializing...",size:"sm",width:"full",children:"Initialize Default Tags"})]}),S.jsx(uh,{children:S.jsx(Nn,{variant:"ghost",size:"sm",onClick:U,children:"Close"})})]})]})]})};Yae.propTypes={spaceID:Tn.string.isRequired};const M9e=({isOpen:n,onClose:e})=>{const{spaceID:i}=So(),[o,l]=O.useState(0),[u,p]=O.useState(""),[y,v]=O.useState(""),[w,C]=O.useState(!1),[R,N]=O.useState(null),[M,L]=O.useState(null),[U,z]=O.useState(!1),[J,q]=O.useState(0),[re,ce]=O.useState(null),ae=O.useRef(null),[pe,H]=O.useState(null),[X,Q]=O.useState(null),[ne,he]=O.useState(!1),[fe,de]=O.useState(0),[ke,De]=O.useState(null),je=O.useRef(null),[Te,we]=O.useState(null),[Ie,Oe]=O.useState(null),[ve,xe]=O.useState(!1),[Ge,Ze]=O.useState(0),[lt,vt]=O.useState(null),nt=O.useRef(null),[mt,et]=O.useState([]),[St,un]=O.useState([]),[ft,Ct]=O.useState(!1),[ut,Ft]=O.useState([]),[on,Ht]=O.useState(null),[Se,Ne]=O.useState(!1),[$e,Pt]=O.useState(!0),[Ot,Et]=O.useState(!1),[xt,pn]=O.useState(!1),[Cn,En]=O.useState(""),[It,cr]=O.useState(""),[Lt,Yt]=O.useState(""),[Or,Oi]=O.useState(!1),{setHLSStreamUrl:ji,savedStreamData:Fr}=kae(),Xn=Da();O.useEffect(()=>{n&&i&&oa()},[n,i]);const oa=async()=>{try{const gt=await sd(i);gt.logoUrl&&ce(gt.logoUrl),gt.backgroundUrl&&De(gt.backgroundUrl),gt.videoBackgroundUrl&&vt(gt.videoBackgroundUrl),gt.voiceDisabled!==void 0&&Ne(gt.voiceDisabled),gt.accessibleToAllUsers!==void 0&&Pt(gt.accessibleToAllUsers),p(gt.name||""),v(gt.description||"");try{const _n=await dae(i);if(_n){En(_n.streamUrl||""),cr(_n.rtmpUrl||""),Yt(_n.streamKey||"");const jr=_n.enabled===!0;pn(jr),K.log("SpaceManageModal: Directly loaded streaming enabled state from Firebase:",{enabled:jr,rawValue:_n.enabled})}else pn(!1),K.log("SpaceManageModal: No stream data found in Firebase, defaulting enabled to false")}catch(_n){if(K.error("Error fetching stream data directly:",_n),Fr){En(Fr.streamUrl||""),cr(Fr.rtmpUrl||""),Yt(Fr.streamKey||"");const jr=Fr.enabled===!0;pn(jr),K.log("SpaceManageModal: Loaded streaming enabled state from savedStreamData:",{enabled:jr,rawValue:Fr.enabled})}else pn(!1),K.log("SpaceManageModal: No savedStreamData available, defaulting enabled to false")}Ki(gt)}catch(gt){K.error("Error fetching space data:",gt),Xn({title:"Error",description:"Failed to load space data",status:"error",duration:3e3,isClosable:!0})}};O.useEffect(()=>{if(Fr){if(!Or){En(Fr.streamUrl||""),cr(Fr.rtmpUrl||""),Yt(Fr.streamKey||"");const gt=Fr.enabled===!0;pn(gt),K.log("SpaceManageModal: Updated streaming enabled state from savedStreamData:",{enabled:gt,rawValue:Fr.enabled})}}else n&&!Or&&K.log("SpaceManageModal: No savedStreamData available but NOT defaulting enabled to false (preserving current state)")},[Fr,Or,n]);const Ki=async gt=>{if(i&&n){Ct(!0);try{const _n=$k(),jr=`space_${i}_owners`,Ni=LO(El(_n,"users"),NQ("groups","array-contains",jr)),uu=await id(Ni),es=[];for(const Ko of uu.docs){const ei=Ko.data(),In=await su(Ko.id);es.push({uid:Ko.id,email:ei.email,displayName:ei.displayName||In.Nickname||"Unknown User",photoURL:ei.photoURL||In.photoURL,firstName:In.firstName,lastName:In.lastName})}et(es);const bl=`space_${i}_hosts`,$o=LO(El(_n,"users"),NQ("groups","array-contains",bl)),hd=await id($o),Lc=[];for(const Ko of hd.docs){const ei=Ko.data(),In=await su(Ko.id);Lc.push({uid:Ko.id,email:ei.email,displayName:ei.displayName||In.Nickname||"Unknown User",photoURL:ei.photoURL||In.photoURL,firstName:In.firstName,lastName:In.lastName})}un(Lc);const wl=El(_n,`spaces/${i}/BannedUsers`),ca=await id(wl),dc=[];for(const Ko of ca.docs){const ei=Ko.id;try{const In=await su(ei);dc.push({uid:ei,displayName:(In==null?void 0:In.Nickname)||ei,firstName:In==null?void 0:In.firstName,lastName:In==null?void 0:In.lastName,photoURL:In==null?void 0:In.photoURL})}catch{dc.push({uid:ei,displayName:ei})}}Ft(dc)}catch(_n){K.error("Error fetching space users:",_n),Xn({title:"Error",description:"Failed to load space users",status:"error",duration:3e3,isClosable:!0})}finally{Ct(!1)}}};O.useEffect(()=>{i&&n&&o===4&&Ki()},[i,n,o]);const xa=gt=>{const _n=gt.target.files[0];if(_n){if(!_n.type.startsWith("image/")){Xn({title:"Invalid file type",description:"Please select an image file",status:"error",duration:5e3,isClosable:!0});return}N(_n);const jr=new FileReader;jr.onloadend=()=>{L(jr.result)},jr.readAsDataURL(_n)}},Sl=gt=>{const _n=gt.target.files[0];if(_n){if(!_n.type.startsWith("image/")){Xn({title:"Invalid file type",description:"Please select an image file",status:"error",duration:5e3,isClosable:!0});return}H(_n);const jr=new FileReader;jr.onloadend=()=>{Q(jr.result)},jr.readAsDataURL(_n)}},Ps=gt=>{const _n=gt.target.files[0];if(_n){if(!_n.type.startsWith("video/")){Xn({title:"Invalid file type",description:"Please select a video file",status:"error",duration:5e3,isClosable:!0});return}const jr=5*1024*1024;if(_n.size>jr){Xn({title:"File too large",description:"Video file must be smaller than 5MB",status:"error",duration:5e3,isClosable:!0});return}we(_n);const Ni=new FileReader;Ni.onloadend=()=>{Oe(Ni.result)},Ni.readAsDataURL(_n)}},La=async()=>{if(!R){Xn({title:"No file selected",description:"Please select a file to upload",status:"warning",duration:5e3,isClosable:!0});return}try{z(!0);const gt=setInterval(()=>{q(jr=>{const Ni=jr+10;return Ni>=90?90:Ni})},300),_n=await c8e(i,R);clearInterval(gt),q(100),ce(_n),Xn({title:"Upload successful",description:"Space logo has been updated",status:"success",duration:5e3,isClosable:!0}),setTimeout(()=>{N(null),L(null),q(0),z(!1)},1e3),window.dispatchEvent(new CustomEvent("SpaceLogoUpdated",{detail:{logoUrl:_n}}))}catch(gt){console.error("Error uploading logo:",gt),Xn({title:"Upload failed",description:gt.message||"An error occurred during upload",status:"error",duration:5e3,isClosable:!0}),z(!1),q(0)}},Wo=async()=>{if(!pe){Xn({title:"No file selected",description:"Please select a file to upload",status:"warning",duration:5e3,isClosable:!0});return}try{he(!0);const gt=setInterval(()=>{de(jr=>{const Ni=jr+10;return Ni>=90?90:Ni})},300),_n=await u8e(i,pe);clearInterval(gt),de(100),De(_n),Xn({title:"Upload successful",description:"Space background has been updated",status:"success",duration:5e3,isClosable:!0}),setTimeout(()=>{H(null),Q(null),de(0),he(!1)},1e3),window.dispatchEvent(new CustomEvent("SpaceBackgroundUpdated",{detail:{backgroundUrl:_n}}))}catch(gt){console.error("Error uploading background:",gt),Xn({title:"Upload failed",description:gt.message||"An error occurred during upload",status:"error",duration:5e3,isClosable:!0}),he(!1),de(0)}},uo=async()=>{if(re)try{z(!0),await l8e(i),ce(null),Xn({title:"Logo removed",description:"Space logo has been removed",status:"info",duration:5e3,isClosable:!0}),z(!1),window.dispatchEvent(new CustomEvent("SpaceLogoUpdated",{detail:{logoUrl:null}}))}catch(gt){console.error("Error deleting logo:",gt),Xn({title:"Deletion failed",description:gt.message||"An error occurred during deletion",status:"error",duration:5e3,isClosable:!0}),z(!1)}},ud=async()=>{if(ke)try{he(!0),await d8e(i),De(null),Xn({title:"Background removed",description:"Space background has been removed",status:"info",duration:5e3,isClosable:!0}),he(!1),window.dispatchEvent(new CustomEvent("SpaceBackgroundUpdated",{detail:{backgroundUrl:null}}))}catch(gt){console.error("Error deleting background:",gt),Xn({title:"Deletion failed",description:gt.message||"An error occurred during deletion",status:"error",duration:5e3,isClosable:!0}),he(!1)}},Go=async()=>{if(!Te){Xn({title:"No file selected",description:"Please select a file to upload",status:"warning",duration:5e3,isClosable:!0});return}try{xe(!0);const gt=setInterval(()=>{Ze(jr=>{const Ni=jr+10;return Ni>=90?90:Ni})},300),_n=await f8e(i,Te);clearInterval(gt),Ze(100),vt(_n),Xn({title:"Upload successful",description:"Space video background has been updated",status:"success",duration:5e3,isClosable:!0}),setTimeout(()=>{we(null),Oe(null),Ze(0),xe(!1)},1e3),window.dispatchEvent(new CustomEvent("SpaceVideoBackgroundUpdated",{detail:{videoBackgroundUrl:_n}}))}catch(gt){console.error("Error uploading video background:",gt),Xn({title:"Upload failed",description:gt.message||"An error occurred during upload",status:"error",duration:5e3,isClosable:!0}),xe(!1),Ze(0)}},dd=async()=>{if(lt)try{xe(!0),await m8e(i),vt(null),Xn({title:"Video background removed",description:"Space video background has been removed",status:"info",duration:5e3,isClosable:!0}),xe(!1),window.dispatchEvent(new CustomEvent("SpaceVideoBackgroundUpdated",{detail:{videoBackgroundUrl:null}}))}catch(gt){console.error("Error deleting video background:",gt),Xn({title:"Deletion failed",description:gt.message||"An error occurred during deletion",status:"error",duration:5e3,isClosable:!0}),xe(!1)}},uc=()=>{ae.current&&ae.current.click()},bo=()=>{je.current&&je.current.click()},Tr=()=>{nt.current&&nt.current.click()},lu=async()=>{Et(!0);try{await z3(i,{voiceDisabled:!Se}),Ne(!Se),Xn({title:"Settings Updated",description:`Voice chat has been ${Se?"enabled":"disabled"} for this space.`,status:"success",duration:3e3,isClosable:!0})}catch(gt){K.error("Error updating voice settings:",gt),Xn({title:"Error",description:"Failed to update voice settings",status:"error",duration:3e3,isClosable:!0})}finally{Et(!1)}},aa=async()=>{Et(!0);try{await p8e(i,!$e),Pt(!$e),Xn({title:"Settings Updated",description:`Space is now ${$e?"not accessible":"accessible"} to all users.`,status:"success",duration:3e3,isClosable:!0})}catch(gt){K.error("Error updating accessibility settings:",gt),Xn({title:"Error",description:"Failed to update accessibility settings",status:"error",duration:3e3,isClosable:!0})}finally{Et(!1)}},Ma=async()=>{if(i){C(!0);try{const gt=$k(),_n=wr(gt,"spaces",i);await lo(_n,{name:u,description:y}),Xn({title:"Success",description:"Space details updated successfully",status:"success",duration:3e3,isClosable:!0}),window.dispatchEvent(new CustomEvent("SpaceDetailsUpdated",{detail:{name:u,description:y}}))}catch(gt){K.error("Error updating space details:",gt),Xn({title:"Error",description:"Failed to update space details",status:"error",duration:3e3,isClosable:!0})}finally{C(!1)}}},xc=async()=>{if(i){Oi(!0);try{const gt={enabled:xt,streamUrl:Cn,rtmpUrl:It,streamKey:Lt,playerIndex:"0",updatedAt:new Date().toISOString()};K.log("SpaceManageModal: Saving stream settings to Firebase:",{enabled:xt,url:Cn,hasRtmp:!!It,hasKey:!!Lt});try{await jF(i,gt),K.log("SpaceManageModal: Successfully updated stream settings in Firebase directly")}catch(_n){throw K.error("SpaceManageModal: Error updating stream settings directly in Firebase:",_n),_n}await ji(Cn,0,{enabled:xt,rtmpUrl:It,streamKey:Lt}),window.dispatchEvent(new CustomEvent("StreamSettingsChanged",{detail:{enabled:xt,spaceId:i}})),Xn({title:"Success",description:`Stream settings updated successfully. Streaming is now ${xt?"enabled":"disabled"}.`,status:"success",duration:3e3,isClosable:!0}),setTimeout(()=>{oa()},500)}catch(gt){K.error("Error updating stream settings:",gt),Xn({title:"Error",description:"Failed to update stream settings",status:"error",duration:3e3,isClosable:!0})}finally{Oi(!1)}}},Ho=async gt=>{try{Ht(gt);const _n=$k();await u6e(wr(_n,`spaces/${i}/BannedUsers`,gt));const jr=wr(_n,"users",gt),Ni=`space_${i}_banned`;await lo(jr,{groups:Woe(Ni)}),Ft(uu=>uu.filter(es=>es.uid!==gt)),Xn({title:"User Unbanned",description:"User can now re-enter this space.",status:"success",duration:3e3,isClosable:!0})}catch(_n){K.error("Error unbanning user:",_n),Xn({title:"Error",description:"Failed to unban user",status:"error",duration:3e3,isClosable:!0})}finally{Ht(null)}};return S.jsxs(ls,{isOpen:n,onClose:e,size:"lg",isCentered:!0,children:[S.jsx(ds,{bg:"rgba(0, 0, 0, 0.8)",backdropFilter:"blur(8px)"}),S.jsxs(us,{bg:"#1a1a1a",color:"white",borderRadius:"xl",border:"1px solid #333",maxW:"800px",maxH:"90vh",overflow:"hidden",children:[S.jsx(co,{fontSize:"md",fontWeight:"600",pb:1,pt:3,px:4,color:"white",borderBottom:"1px solid",borderColor:"whiteAlpha.200",children:"Manage Space"}),S.jsx(Is,{color:"white",bg:"rgba(255,255,255,0.1)",_hover:{color:"gray.400",bg:"transparent"},borderRadius:"full",size:"sm",top:2,right:3}),S.jsx(gs,{p:0,display:"flex",overflow:"hidden",children:S.jsxs(kS,{orientation:"vertical",variant:"unstyled",index:o,onChange:l,display:"flex",width:"100%",height:"100%",children:[S.jsxs(OS,{bg:"rgba(0, 0, 0, 0.2)",w:"80px",py:4,borderRight:"1px solid",borderColor:"whiteAlpha.200",flexShrink:0,children:[S.jsxs(Ia,{display:"flex",flexDirection:"column",alignItems:"center",py:3,_selected:{bg:"whiteAlpha.100",color:"blue.300"},_hover:{bg:"whiteAlpha.50"},children:[S.jsx(Sn,{as:b9e,mb:1}),S.jsx(Ye,{fontSize:"xs",children:"Details"})]}),S.jsxs(Ia,{display:"flex",flexDirection:"column",alignItems:"center",py:3,_selected:{bg:"whiteAlpha.100",color:"blue.300"},_hover:{bg:"whiteAlpha.50"},children:[S.jsx(Sn,{as:Uy,mb:1}),S.jsx(Ye,{fontSize:"xs",children:"Logo"})]}),S.jsxs(Ia,{display:"flex",flexDirection:"column",alignItems:"center",py:3,_selected:{bg:"whiteAlpha.100",color:"blue.300"},_hover:{bg:"whiteAlpha.50"},children:[S.jsx(Sn,{as:S9e,mb:1}),S.jsx(Ye,{fontSize:"xs",children:"Background"})]}),S.jsxs(Ia,{display:"flex",flexDirection:"column",alignItems:"center",py:3,_selected:{bg:"whiteAlpha.100",color:"blue.300"},_hover:{bg:"whiteAlpha.50"},children:[S.jsx(Sn,{as:T9e,mb:1}),S.jsx(Ye,{fontSize:"xs",children:"Settings"})]}),S.jsxs(Ia,{display:"flex",flexDirection:"column",alignItems:"center",py:3,_selected:{bg:"whiteAlpha.100",color:"blue.300"},_hover:{bg:"whiteAlpha.50"},children:[S.jsx(Sn,{as:_Z,mb:1}),S.jsx(Ye,{fontSize:"xs",children:"Users"})]}),S.jsxs(Ia,{display:"flex",flexDirection:"column",alignItems:"center",py:3,_selected:{bg:"whiteAlpha.100",color:"blue.300"},_hover:{bg:"whiteAlpha.50"},children:[S.jsx(Sn,{as:GC,mb:1}),S.jsx(Ye,{fontSize:"xs",children:"Stream"})]})]}),S.jsxs(lR,{flexGrow:1,display:"flex",flexDirection:"column",overflowY:"auto",css:{"&::-webkit-scrollbar":{width:"8px"},"&::-webkit-scrollbar-track":{background:"rgba(0,0,0,0.1)"},"&::-webkit-scrollbar-thumb":{background:"rgba(255,255,255,0.3)",borderRadius:"4px"}},children:[S.jsxs(Ic,{p:4,display:"flex",flexDirection:"column",children:[S.jsx(Ye,{fontSize:"sm",fontWeight:"600",mb:3,color:"white",children:"Space Details"}),S.jsxs(Ir,{spacing:4,align:"stretch",children:[S.jsxs(br,{children:[S.jsx(gi,{fontSize:"xs",color:"white",children:"Space Name"}),S.jsx(li,{value:u,onChange:gt=>p(gt.target.value),placeholder:"Enter space name",size:"sm",bg:"whiteAlpha.100",borderColor:"whiteAlpha.200",_hover:{borderColor:"whiteAlpha.300"},_focus:{borderColor:"blue.300",boxShadow:"0 0 0 1px #63B3ED"},color:"white",maxLength:100})]}),S.jsxs(br,{children:[S.jsx(gi,{fontSize:"xs",color:"white",children:"Description"}),S.jsx(pie,{value:y,onChange:gt=>v(gt.target.value),placeholder:"Enter space description",size:"sm",bg:"whiteAlpha.100",borderColor:"whiteAlpha.200",_hover:{borderColor:"whiteAlpha.300"},_focus:{borderColor:"blue.300",boxShadow:"0 0 0 1px #63B3ED"},rows:4,resize:"vertical",maxLength:500})]}),S.jsxs(br,{children:[S.jsx(gi,{fontSize:"xs",color:"white",children:"Space Tags"}),S.jsx(ct,{p:3,bg:"whiteAlpha.50",borderWidth:"1px",borderColor:"whiteAlpha.200",borderRadius:"md",children:i?S.jsx(Yae,{spaceID:i}):S.jsxs(Ig,{status:"warning",variant:"subtle",borderRadius:"md",children:[S.jsx(Ag,{}),S.jsx(DC,{fontSize:"sm",children:"Space ID missing"}),S.jsx(xC,{fontSize:"xs",children:"Unable to load tags without a valid space ID."})]})})]}),S.jsx(Nn,{colorScheme:"blue",size:"sm",onClick:Ma,isLoading:w,loadingText:"Saving...",alignSelf:"flex-start",mt:2,children:"Save Details"})]})]}),S.jsxs(Ic,{p:4,display:"flex",flexDirection:"column",children:[S.jsx(Ye,{fontSize:"sm",fontWeight:"600",mb:3,color:"white",children:"Space Logo"}),S.jsx(Ye,{fontSize:"xs",mb:4,children:"Upload a logo for your space. This will be displayed during loading."}),(re||M)&&S.jsxs(Ur,{direction:{base:"column",md:"row"},gap:4,mb:4,children:[re&&S.jsxs(ct,{borderWidth:"1px",borderRadius:"md",p:3,bg:"whiteAlpha.50",borderColor:"whiteAlpha.200",flex:"1",children:[S.jsx(Ye,{fontSize:"xs",fontWeight:"medium",mb:2,children:"Current Logo"}),S.jsx(yp,{src:re,alt:"Space Logo",maxH:"120px",mx:"auto",objectFit:"contain"}),S.jsx(Nn,{mt:3,colorScheme:"red",leftIcon:S.jsx(Sn,{as:_S}),onClick:uo,isLoading:U,loadingText:"Removing...",size:"xs",variant:"ghost",children:"Remove Logo"})]}),M&&S.jsxs(ct,{borderWidth:"1px",borderRadius:"md",p:3,bg:"whiteAlpha.50",borderColor:"whiteAlpha.200",flex:"1",children:[S.jsx(Ye,{fontSize:"xs",fontWeight:"medium",mb:2,children:"Preview"}),S.jsx(yp,{src:M,alt:"Preview",maxH:"120px",mx:"auto",objectFit:"contain"})]})]}),S.jsxs(br,{children:[S.jsx(gi,{fontSize:"xs",color:"white",children:"Upload New Logo"}),S.jsx(li,{type:"file",accept:"image/*",onChange:xa,ref:ae,display:"none"}),U&&S.jsxs(ct,{mt:3,mb:3,children:[S.jsxs(Ye,{fontSize:"xs",mb:1,children:["Uploading... ",J,"%"]}),S.jsx(qy,{value:J,size:"xs",colorScheme:"blue",borderRadius:"full"})]}),S.jsxs(Qn,{mt:3,spacing:3,children:[S.jsx(Nn,{colorScheme:"blue",leftIcon:S.jsx(Sn,{as:Uy}),onClick:uc,isDisabled:U,size:"sm",variant:"outline",children:"Browse"}),S.jsx(Nn,{colorScheme:"green",leftIcon:S.jsx(Sn,{as:Qk}),onClick:La,isLoading:U,loadingText:"Uploading...",isDisabled:!R||U,size:"sm",children:"Upload"})]}),S.jsx(Hy,{fontSize:"xs",color:"whiteAlpha.700",mt:2,children:"Recommended: PNG format with transparent background. Max height: 400px."})]})]}),S.jsxs(Ic,{p:4,display:"flex",flexDirection:"column",children:[S.jsx(Ye,{fontSize:"sm",fontWeight:"600",mb:3,color:"white",children:"Background"}),S.jsx(Ye,{fontSize:"xs",mb:4,children:"Upload a background for your space. This will be displayed during loading."}),S.jsxs(kS,{variant:"enclosed",colorScheme:"blue",size:"md",mb:4,borderColor:"blue.300",children:[S.jsxs(OS,{children:[S.jsxs(Ia,{fontSize:"sm",fontWeight:"medium",_selected:{color:"blue.300",bg:"whiteAlpha.200"},p:3,children:[S.jsx(Sn,{as:Uy,mr:2}),"Image"]}),S.jsxs(Ia,{fontSize:"sm",fontWeight:"medium",_selected:{color:"blue.300",bg:"whiteAlpha.200"},p:3,children:[S.jsx(Sn,{as:gZ,mr:2}),"Video (max 5MB)"]})]}),S.jsxs(lR,{mt:4,children:[S.jsxs(Ic,{p:0,children:[(ke||X)&&S.jsxs(Ur,{direction:{base:"column",md:"row"},gap:4,mb:4,children:[ke&&S.jsxs(ct,{borderWidth:"1px",borderRadius:"md",p:3,bg:"whiteAlpha.50",borderColor:"whiteAlpha.200",flex:"1",children:[S.jsx(Ye,{fontSize:"xs",fontWeight:"medium",mb:2,children:"Current Background"}),S.jsx(yp,{src:ke,alt:"Space Background",maxH:"120px",mx:"auto",objectFit:"contain"}),S.jsx(Nn,{mt:3,colorScheme:"red",leftIcon:S.jsx(Sn,{as:_S}),onClick:ud,isLoading:ne,loadingText:"Removing...",size:"xs",variant:"ghost",children:"Remove Background"})]}),X&&S.jsxs(ct,{borderWidth:"1px",borderRadius:"md",p:3,bg:"whiteAlpha.50",borderColor:"whiteAlpha.200",flex:"1",children:[S.jsx(Ye,{fontSize:"xs",fontWeight:"medium",mb:2,children:"Preview"}),S.jsx(yp,{src:X,alt:"Preview",maxH:"120px",mx:"auto",objectFit:"contain"})]})]}),S.jsxs(br,{children:[S.jsx(gi,{fontSize:"xs",color:"white",children:"Upload New Background Image"}),S.jsx(li,{type:"file",accept:"image/*",onChange:Sl,ref:je,display:"none"}),ne&&S.jsxs(ct,{mt:3,mb:3,children:[S.jsxs(Ye,{fontSize:"xs",mb:1,children:["Uploading... ",fe,"%"]}),S.jsx(qy,{value:fe,size:"xs",colorScheme:"blue",borderRadius:"full"})]}),S.jsxs(Qn,{mt:3,spacing:3,children:[S.jsx(Nn,{colorScheme:"blue",leftIcon:S.jsx(Sn,{as:Uy}),onClick:bo,isDisabled:ne,size:"sm",variant:"outline",children:"Browse"}),S.jsx(Nn,{colorScheme:"green",leftIcon:S.jsx(Sn,{as:Qk}),onClick:Wo,isLoading:ne,loadingText:"Uploading...",isDisabled:!pe||ne,size:"sm",children:"Upload"})]}),S.jsx(Hy,{fontSize:"xs",color:"whiteAlpha.700",mt:2,children:"Recommended: High-quality image (1920x1080 or higher) that works well with the frosted glass overlay."})]})]}),S.jsxs(Ic,{p:0,children:[(lt||Ie)&&S.jsxs(Ur,{direction:{base:"column",md:"row"},gap:4,mb:4,children:[lt&&S.jsxs(ct,{borderWidth:"1px",borderRadius:"md",p:3,bg:"whiteAlpha.50",borderColor:"whiteAlpha.200",flex:"1",children:[S.jsx(Ye,{fontSize:"xs",fontWeight:"medium",mb:2,children:"Current Video Background"}),S.jsx(ct,{maxH:"160px",overflow:"hidden",position:"relative",children:S.jsx("video",{src:lt,controls:!0,muted:!0,style:{width:"100%",maxHeight:"120px",objectFit:"contain"}})}),S.jsx(Nn,{mt:3,colorScheme:"red",leftIcon:S.jsx(Sn,{as:_S}),onClick:dd,isLoading:ve,loadingText:"Removing...",size:"xs",variant:"ghost",children:"Remove Video"})]}),Ie&&S.jsxs(ct,{borderWidth:"1px",borderRadius:"md",p:3,bg:"whiteAlpha.50",borderColor:"whiteAlpha.200",flex:"1",children:[S.jsx(Ye,{fontSize:"xs",fontWeight:"medium",mb:2,children:"Preview"}),S.jsx(ct,{maxH:"160px",overflow:"hidden",children:S.jsx("video",{src:Ie,controls:!0,muted:!0,style:{width:"100%",maxHeight:"120px",objectFit:"contain"}})})]})]}),S.jsxs(br,{children:[S.jsx(gi,{fontSize:"xs",color:"white",children:"Upload New Video Background"}),S.jsx(li,{type:"file",accept:"video/*",onChange:Ps,ref:nt,display:"none"}),ve&&S.jsxs(ct,{mt:3,mb:3,children:[S.jsxs(Ye,{fontSize:"xs",mb:1,children:["Uploading... ",Ge,"%"]}),S.jsx(qy,{value:Ge,size:"xs",colorScheme:"blue",borderRadius:"full"})]}),S.jsxs(Qn,{mt:3,spacing:3,children:[S.jsx(Nn,{colorScheme:"blue",leftIcon:S.jsx(Sn,{as:gZ}),onClick:Tr,isDisabled:ve,size:"sm",variant:"outline",children:"Browse"}),S.jsx(Nn,{colorScheme:"green",leftIcon:S.jsx(Sn,{as:Qk}),onClick:Go,isLoading:ve,loadingText:"Uploading...",isDisabled:!Te||ve,size:"sm",children:"Upload"})]}),S.jsx(Hy,{fontSize:"xs",color:"whiteAlpha.700",mt:2,children:"Recommended: MP4 format. Maximum file size: 5MB. Short looping videos work best."})]})]})]})]})]}),S.jsxs(Ic,{p:4,display:"flex",flexDirection:"column",children:[S.jsx(Ye,{fontSize:"sm",fontWeight:"600",mb:3,color:"white",children:"Space Settings"}),S.jsx(Ye,{fontSize:"xs",mb:4,children:"Configure settings for your space."}),S.jsxs(Ir,{spacing:4,align:"stretch",children:[S.jsx(ct,{borderWidth:"1px",borderRadius:"md",p:3,bg:"whiteAlpha.50",borderColor:"whiteAlpha.200",children:S.jsxs(Qn,{justify:"space-between",align:"center",children:[S.jsxs(ct,{children:[S.jsxs(Qn,{mb:1,spacing:2,children:[S.jsxs(ct,{position:"relative",w:"16px",h:"16px",children:[S.jsx(Sn,{as:A9e,color:Se?"red.400":"green.400"}),Se&&S.jsx(ct,{position:"absolute",top:"50%",left:"0",right:"0",height:"2px",bg:"red.400",transform:"rotate(45deg)",transformOrigin:"center"})]}),S.jsx(Ye,{fontSize:"sm",fontWeight:"600",children:"Voice Chat"})]}),S.jsx(Ye,{fontSize:"xs",color:"whiteAlpha.800",children:Se?"Voice chat is currently disabled for all users in this space.":"Voice chat is currently enabled for all users in this space."})]}),S.jsx(Mf,{isChecked:!Se,onChange:lu,colorScheme:"green",size:"md",isDisabled:Ot})]})}),S.jsx(ct,{borderWidth:"1px",borderRadius:"md",p:3,bg:"whiteAlpha.50",borderColor:"whiteAlpha.200",children:S.jsxs(Qn,{justify:"space-between",align:"center",children:[S.jsxs(ct,{children:[S.jsxs(Qn,{mb:1,spacing:2,children:[S.jsx(ct,{position:"relative",w:"16px",h:"16px",children:S.jsx(Sn,{as:_Z,color:$e?"green.400":"red.400"})}),S.jsx(Ye,{fontSize:"sm",fontWeight:"600",children:"Public Access"})]}),S.jsx(Ye,{fontSize:"xs",color:"whiteAlpha.800",children:$e?"This space is accessible to all users in the 'users' group.":"This space is only accessible to specific users."}),S.jsx(Ye,{fontSize:"xs",color:"whiteAlpha.700",mt:1,children:"Note: Space owners and hosts will always have access regardless of this setting."})]}),S.jsx(Mf,{isChecked:$e,onChange:aa,colorScheme:"green",size:"md",isDisabled:Ot})]})}),S.jsxs(Ig,{status:"info",variant:"subtle",bg:"whiteAlpha.100",borderRadius:"md",borderWidth:"1px",borderColor:"blue.800",children:[S.jsx(Ag,{color:"blue.300"}),S.jsxs(ct,{children:[S.jsx(DC,{fontSize:"xs",fontWeight:"medium",children:"Coming Soon"}),S.jsx(xC,{fontSize:"xs",children:"Additional space configuration options will be available in a future update."})]})]})]})]}),S.jsxs(Ic,{p:4,display:"flex",flexDirection:"column",children:[S.jsx(Ye,{fontSize:"sm",fontWeight:"600",mb:3,color:"white",children:"Manage Users"}),S.jsx(Ye,{fontSize:"xs",mb:4,children:"View and manage the owners and hosts of this space."}),ft?S.jsx(Ur,{justify:"center",align:"center",h:"200px",children:S.jsx(ld,{color:"blue.300"})}):S.jsxs(Ir,{spacing:4,align:"stretch",children:[S.jsxs(ct,{children:[S.jsxs(Qn,{mb:2,children:[S.jsx(Sn,{as:v9e,color:"green.400"}),S.jsx(Ye,{fontSize:"sm",fontWeight:"600",children:"Owners"}),S.jsx(sh,{colorScheme:"green",ml:2,children:mt.length})]}),S.jsx(ct,{borderWidth:"1px",borderRadius:"md",p:2,bg:"whiteAlpha.50",borderColor:"whiteAlpha.200",maxH:"120px",overflowY:"auto",css:{"&::-webkit-scrollbar":{width:"4px"},"&::-webkit-scrollbar-track":{background:"rgba(0,0,0,0.1)"},"&::-webkit-scrollbar-thumb":{background:"rgba(255,255,255,0.3)",borderRadius:"2px"}},children:mt.length===0?S.jsx(Ye,{fontSize:"xs",color:"whiteAlpha.600",children:"No owners found"}):S.jsx(Ir,{spacing:1,align:"stretch",children:mt.map(gt=>S.jsxs(Qn,{spacing:2,p:1,borderRadius:"md",_hover:{bg:"whiteAlpha.100"},children:[S.jsx(ml,{size:"xs",src:gt.photoURL,name:gt.displayName}),S.jsxs(ct,{children:[S.jsx(Ye,{fontSize:"xs",children:gt.displayName}),S.jsx(Ye,{fontSize:"xs",color:"whiteAlpha.600",children:gt.firstName&&gt.lastName?`${gt.firstName} ${gt.lastName}`:"Full name not available"})]}),S.jsx(dS,{}),S.jsx(sh,{colorScheme:"green",variant:"solid",fontSize:"2xs",children:"Owner"})]},gt.uid))})})]}),S.jsxs(ct,{children:[S.jsxs(Qn,{mb:2,children:[S.jsx(Sn,{as:C9e,color:"purple.400"}),S.jsx(Ye,{fontSize:"sm",fontWeight:"600",children:"Hosts"}),S.jsx(sh,{colorScheme:"purple",ml:2,children:St.length})]}),S.jsx(ct,{borderWidth:"1px",borderRadius:"md",p:2,bg:"whiteAlpha.50",borderColor:"whiteAlpha.200",maxH:"120px",overflowY:"auto",css:{"&::-webkit-scrollbar":{width:"4px"},"&::-webkit-scrollbar-track":{background:"rgba(0,0,0,0.1)"},"&::-webkit-scrollbar-thumb":{background:"rgba(255,255,255,0.3)",borderRadius:"2px"}},children:St.length===0?S.jsx(Ye,{fontSize:"xs",color:"whiteAlpha.600",children:"No hosts found"}):S.jsx(Ir,{spacing:1,align:"stretch",children:St.map(gt=>S.jsxs(Qn,{spacing:2,p:1,borderRadius:"md",_hover:{bg:"whiteAlpha.100"},children:[S.jsx(ml,{size:"xs",src:gt.photoURL,name:gt.displayName}),S.jsxs(ct,{children:[S.jsx(Ye,{fontSize:"xs",children:gt.displayName}),S.jsx(Ye,{fontSize:"xs",color:"whiteAlpha.600",children:gt.firstName&&gt.lastName?`${gt.firstName} ${gt.lastName}`:"Full name not available"})]}),S.jsx(dS,{}),S.jsx(sh,{colorScheme:"purple",variant:"solid",fontSize:"2xs",children:"Host"})]},gt.uid))})})]}),S.jsxs(ct,{children:[S.jsxs(Qn,{mb:2,children:[S.jsx(Sn,{as:R9e,color:"red.400"}),S.jsx(Ye,{fontSize:"sm",fontWeight:"600",children:"Banned Users"}),S.jsx(sh,{colorScheme:"red",ml:2,children:ut.length})]}),S.jsx(ct,{borderWidth:"1px",borderRadius:"md",p:2,bg:"whiteAlpha.50",borderColor:"whiteAlpha.200",maxH:"120px",overflowY:"auto",css:{"&::-webkit-scrollbar":{width:"4px"},"&::-webkit-scrollbar-thumb":{background:"rgba(255,255,255,0.3)",borderRadius:"2px"}},children:ut.length===0?S.jsx(Ye,{fontSize:"xs",color:"whiteAlpha.600",children:"No banned users"}):S.jsx(Ir,{spacing:1,align:"stretch",children:ut.map(gt=>S.jsxs(Qn,{spacing:2,p:1,borderRadius:"md",_hover:{bg:"whiteAlpha.100"},children:[S.jsx(ml,{size:"xs",src:gt.photoURL,name:gt.displayName}),S.jsxs(ct,{children:[S.jsx(Ye,{fontSize:"xs",children:gt.displayName}),gt.firstName&&S.jsxs(Ye,{fontSize:"xs",color:"whiteAlpha.600",children:[gt.firstName," ",gt.lastName]})]}),S.jsx(dS,{}),S.jsxs(Qn,{spacing:2,children:[S.jsx(Nn,{size:"xs",colorScheme:"green",isLoading:on===gt.uid,onClick:()=>Ho(gt.uid),leftIcon:S.jsx(Sn,{as:I9e}),children:"Unban"}),S.jsx(sh,{colorScheme:"red",variant:"solid",fontSize:"2xs",children:"Banned"})]})]},gt.uid))})})]})]})]}),S.jsxs(Ic,{p:4,display:"flex",flexDirection:"column",children:[S.jsx(Ye,{fontSize:"sm",fontWeight:"600",mb:3,color:"white",children:"Stream Settings"}),S.jsxs(Ir,{spacing:4,align:"stretch",children:[S.jsx(ct,{borderWidth:"1px",borderRadius:"md",p:3,bg:"whiteAlpha.50",borderColor:"whiteAlpha.200",children:S.jsxs(Qn,{justify:"space-between",align:"center",children:[S.jsx(ct,{children:S.jsxs(Qn,{mb:1,spacing:2,children:[S.jsx(ct,{position:"relative",w:"16px",h:"16px",children:S.jsx(Sn,{as:GC,color:xt?"green.400":"red.400"})}),S.jsx(Ye,{fontSize:"sm",fontWeight:"600",children:"Streaming Enabled"})]})}),S.jsx(Mf,{isChecked:xt,onChange:async()=>{const gt=!xt;pn(gt),Oi(!0);try{K.log("SpaceManageModal: Auto-saving streaming enabled state:",gt);const _n={enabled:gt,streamUrl:Cn||"",rtmpUrl:It||"",streamKey:Lt||"",playerIndex:"0",updatedAt:new Date().toISOString()};try{await jF(i,_n),K.log("SpaceManageModal: Successfully updated streaming enabled state in Firebase directly")}catch(jr){throw K.error("SpaceManageModal: Error updating streaming state directly in Firebase:",jr),jr}await ji(Cn,0,{enabled:gt,rtmpUrl:It,streamKey:Lt}),window.dispatchEvent(new CustomEvent("StreamSettingsChanged",{detail:{enabled:gt,spaceId:i}})),Xn({title:"Streaming "+(gt?"Enabled":"Disabled"),description:`Streaming is now ${gt?"enabled":"disabled"}.`,status:"success",duration:2e3,isClosable:!0})}catch(_n){K.error("Error auto-saving streaming state:",_n),pn(!gt),Xn({title:"Error",description:"Failed to update streaming status",status:"error",duration:3e3,isClosable:!0})}finally{Oi(!1),setTimeout(()=>{oa()},500)}},colorScheme:"green",size:"md",isDisabled:Or})]})}),S.jsxs(ct,{borderWidth:"1px",borderRadius:"md",p:4,bg:"whiteAlpha.50",borderColor:"whiteAlpha.200",children:[S.jsx(Ye,{fontSize:"sm",fontWeight:"600",mb:3,children:"Stream Configuration"}),S.jsxs(br,{mb:4,children:[S.jsx(gi,{fontSize:"xs",color:"white",children:"Stream URL"}),S.jsx(li,{value:Cn,onChange:gt=>En(gt.target.value),placeholder:"https://example.com/stream.m3u8",size:"sm",bg:"whiteAlpha.100",borderColor:"whiteAlpha.200",_hover:{borderColor:"whiteAlpha.300"},_focus:{borderColor:"blue.300",boxShadow:"0 0 0 1px #63B3ED"},color:"white",isDisabled:Or})]}),S.jsx(Ug,{my:3,borderColor:"whiteAlpha.200"}),S.jsx(Ye,{fontSize:"sm",fontWeight:"600",mb:3,children:"RTMP Configuration"}),S.jsxs(br,{mb:3,children:[S.jsx(gi,{fontSize:"xs",color:"white",children:"RTMP URL"}),S.jsx(li,{value:It,onChange:gt=>cr(gt.target.value),placeholder:"rtmp://example.com/live",size:"sm",bg:"whiteAlpha.100",borderColor:"whiteAlpha.200",_hover:{borderColor:"whiteAlpha.300"},_focus:{borderColor:"blue.300",boxShadow:"0 0 0 1px #63B3ED"},color:"white",isDisabled:Or})]}),S.jsxs(br,{mb:3,children:[S.jsx(gi,{fontSize:"xs",color:"white",children:"Stream Key"}),S.jsx(li,{value:Lt,onChange:gt=>Yt(gt.target.value),placeholder:"xxxxxxxxxxxxxxxxxxxxxxxx",size:"sm",bg:"whiteAlpha.100",borderColor:"whiteAlpha.200",_hover:{borderColor:"whiteAlpha.300"},_focus:{borderColor:"blue.300",boxShadow:"0 0 0 1px #63B3ED"},color:"white",isDisabled:Or,type:"password"})]})]}),S.jsx(Nn,{colorScheme:"blue",size:"sm",onClick:xc,isLoading:Or,loadingText:"Saving...",alignSelf:"flex-start",mt:2,display:xt?"inline-flex":"none",children:"Save Stream Settings"}),S.jsxs(Ig,{status:"info",variant:"subtle",bg:"whiteAlpha.100",borderRadius:"md",borderWidth:"1px",borderColor:"blue.800",mt:2,mb:8,children:[S.jsx(Ag,{color:"blue.300"}),S.jsxs(ct,{children:[S.jsx(DC,{fontSize:"xs",fontWeight:"medium",children:"HLS Streaming"}),S.jsx(xC,{fontSize:"xs",children:"After saving, the stream will be available on all screens. Player index: 0"})]})]})]})]})]})]})})]})]})},Xae="spaces",Jae="portals",U9e=async(n,e,i)=>{try{const o=wr(Yn,Xae,n,Jae,e),l={...i,sourceSpaceId:n,portalId:e,createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()};return await Hg(o,l),K.log(`Saved portal ${e} to space ${n}`),!0}catch(o){return K.error("Error saving portal:",o),!1}},yZ=async(n,e,i)=>{try{const o=wr(Yn,Xae,n,Jae,e),l={...i,updatedAt:new Date().toISOString()};return await lo(o,l),K.log(`Updated portal ${e} in space ${n}`),!0}catch(o){return K.error("Error updating portal:",o),!1}},V9e=({isOpen:n,onClose:e,currentSpaceId:i})=>{const[o,l]=O.useState([]),[u,p]=O.useState(!1),[y,v]=O.useState(null),[w,C]=O.useState(!1),R=Da(),{placePortal:N,directPlacePortal:M}=Dae(),L=Cg("rgba(240, 240, 240, 0.95)","rgba(35, 35, 35, 0.95)"),U=Cg("gray.800","white"),z=Cg("gray.200","whiteAlpha.200"),J=Cg("gray.200","whiteAlpha.300");O.useEffect(()=>{n&&(async()=>{p(!0),v(null),l([]);try{const ae=El(Yn,"spaces"),H=(await id(ae)).docs.map(X=>({id:X.id,name:X.data().name||`Space ID: ${X.id}`}));l(H)}catch(ae){K.error("PortalAdminModal: Error fetching spaces:",ae),v("Failed to load spaces. Please check your connection and try again.")}p(!1)})()},[n]);const q=async(ce,ae)=>{if(!i){K.error("PortalAdminModal: currentSpaceId is not defined. Cannot save portal."),R({title:"Error",description:"Cannot place portal: Current space ID is missing.",status:"error",duration:5e3,isClosable:!0});return}C(!0),K.log(`PortalAdminModal: Attempting to place portal to ${ae} (${ce}) in space ${i}`);try{const pe=await sd(ce);if(!pe)throw new Error(`Failed to fetch target space data for ${ce}`);const H=pe.backgroundUrl||pe.backgroundGsUrl;H||K.warn(`PortalAdminModal: No background image URL found for target space: ${ce}`);const X="PortalObjectPrefab",Q={x:0,y:1.5,z:0},ne={x:0,y:0,z:0},he={x:1,y:1,z:1},fe=`portal_${i}_${ce}_${Date.now()}`;if(!await U9e(i,fe,{type:"portal",targetSpaceId:ce,targetSpaceName:ae,portalId:fe,position:Q,rotation:ne,scale:he,prefabName:X,initialImageUrl:H})){K.error(`PortalAdminModal: Failed to save portal data to Firebase for space ${i}.`),R({title:"Save Error",description:"Failed to save portal data to database.",status:"error",duration:5e3,isClosable:!0}),C(!1);return}K.log(`PortalAdminModal: Portal data saved to Firebase for space ${i}.`);let De=!1;try{const je={portalId:fe,prefabName:X,position:Q,rotation:ne,scale:he,initialImageUrl:H};De=N(fe,X,Q,ne,he,H),De||(De=M(fe,X,Q,ne,he,H)),K.log("PortalAdminModal: Portal placement in Unity:",De)}catch(je){K.error("PortalAdminModal: Error placing portal in Unity:",je)}De?(R({title:"Portal Placed",description:`Portal to ${ae} created successfully.`,status:"success",duration:3e3,isClosable:!0}),e()):(R({title:"Portal Saved",description:"Portal data saved. It will appear when Unity is ready.",status:"info",duration:5e3,isClosable:!0}),e())}catch(pe){K.error("PortalAdminModal: Error creating portal:",pe),R({title:"Error",description:"Failed to create portal. Please try again.",status:"error",duration:5e3,isClosable:!0})}finally{C(!1)}},re=u||w;return S.jsxs(ls,{isOpen:n,onClose:e,size:"lg",isCentered:!0,scrollBehavior:"inside",children:[S.jsx(ds,{bg:"blackAlpha.700",backdropFilter:"blur(8px)"}),S.jsxs(us,{bg:L,backdropFilter:"blur(18px)",color:U,borderRadius:"lg",maxHeight:"80vh",boxShadow:"2xl",children:[S.jsx(co,{borderBottom:"1px solid",borderColor:J,fontSize:"lg",fontWeight:"semibold",children:"Select a Space to Create Portal To"}),S.jsx(Is,{}),S.jsxs(gs,{p:6,children:[re&&S.jsxs(Ir,{justifyContent:"center",alignItems:"center",height:"200px",children:[S.jsx(ld,{size:"xl",thickness:"4px",speed:"0.65s",emptyColor:"gray.200",color:"blue.500"}),S.jsx(Ye,{mt:3,children:"Loading Spaces..."})]}),y&&S.jsxs(Ig,{status:"error",borderRadius:"md",variant:"subtle",children:[S.jsx(Ag,{}),y]}),!u&&!y&&o.length===0&&S.jsx(Ye,{textAlign:"center",py:10,children:"No spaces found or you may not have permission to view them."}),!u&&!y&&o.length>0&&S.jsx(pN,{spacing:3,children:o.map(ce=>S.jsx(wre,{p:3,borderRadius:"md",_hover:{bg:z,cursor:re?"not-allowed":"pointer",transform:re?"none":"scale(1.02)"},transition:"background-color 0.2s ease-in-out, transform 0.2s ease-in-out",onClick:()=>!re&&q(ce.id,ce.name),borderWidth:"1px",borderColor:"transparent",_focus:{boxShadow:"outline"},opacity:re?.7:1,pointerEvents:re?"none":"auto",children:ce.name},ce.id))})]})]})]})},EZ=["Recent","Furniture","Objects","Upload","Portals"],F9e={Furniture:"chair",Objects:"misc"},j9e=({isOpen:n,onClose:e,settings:i})=>{const[o,l]=O.useState(EZ[0]),[u,p]=O.useState(""),[y,v]=O.useState(!1),[w,C]=O.useState(!1),[R,N]=O.useState([]),[M,L]=O.useState(!0),[U,z]=O.useState(null),{placeCatalogueItem:J}=xae(),q=Cg("blue.500","blue.300"),re=Cg("gray.500","gray.400"),ce=Cg("whiteAlpha.200","whiteAlpha.200");O.useEffect(()=>{n&&(async()=>{L(!0),z(null),N([]);try{const fe=El(Yn,"catalogue"),de=await id(fe),ke=[];de.forEach(De=>{var we,Ie;const je=De.data(),Te=["chair","misc"];je.glbUrl&&((we=je.categories)!=null&&we.some(Oe=>Te.includes(Oe)))&&ke.push({id:De.id,name:je.name||"Unnamed Item",thumbnail:((Ie=je.thumbnail)==null?void 0:Ie.src)||"https://via.placeholder.com/150",glbUrl:je.glbUrl,categories:je.categories})}),N(ke)}catch(fe){console.error("Error fetching catalogue items:",fe),z("Failed to load catalogue items. Please check your connection and try again.")}L(!1)})()},[n]);const ae=he=>{l(he),p(""),v(he==="Portals")},pe=(he,fe)=>{const de=F9e[fe];let ke=he;return de&&(ke=ke.filter(De=>{var je;return(je=De.categories)==null?void 0:je.includes(de)})),u&&(ke=ke.filter(De=>De.name.toLowerCase().includes(u.toLowerCase()))),ke},H=["Furniture","Objects"].includes(o)?pe(R,o):[],X=async he=>{console.log(`Placing item: ${he.name}`);try{if(!he.glbUrl){console.error("Item is missing GLB URL");return}const fe=`item_${i.spaceID}_${Date.now()}`,de={x:0,y:0,z:0},ke={x:0,y:0,z:0},De={x:1,y:1,z:1},je={itemId:fe,name:he.name||"Unnamed Item",glbUrl:he.glbUrl,thumbnail:he.thumbnail||"https://via.placeholder.com/150",position:de,rotation:ke,scale:De,createdAt:Date.now(),updatedAt:Date.now(),categories:he.categories||[]};if(!je.glbUrl)throw new Error("GLB URL is required");await Hg(wr(Yn,"spaces",i.spaceID,"catalogue",fe),je),J(fe,je.glbUrl,de,ke,De)?e():console.error("Failed to place item in Unity")}catch(fe){console.error("Error placing item:",fe)}},Q=()=>{C(!0)},ne=()=>{C(!1)};return S.jsxs(ls,{isOpen:n,onClose:e,size:"5xl",isCentered:!0,children:[S.jsx(ds,{bg:"rgba(0, 0, 0, 0.8)",backdropFilter:"blur(8px)"}),S.jsxs(us,{bg:"#1a1a1a",color:"white",borderRadius:"xl",border:"1px solid #333",height:"85vh",maxHeight:"750px",width:"85vw",maxWidth:"1200px",overflow:"hidden",children:[S.jsx(co,{fontSize:"md",fontWeight:"600",pb:1,pt:3,px:4,color:"white",borderBottom:"1px solid",borderColor:"whiteAlpha.300",children:y?"Create New Portal":"Content Catalogue"}),S.jsx(Is,{color:"white",bg:"rgba(255,255,255,0.1)",_hover:{color:"gray.400",bg:"transparent"},borderRadius:"full",size:"sm",top:2,right:3}),S.jsxs(gs,{p:0,display:"flex",flexDirection:"column",height:"calc(100% - 60px)",children:[S.jsxs(Qn,{spacing:4,p:4,borderBottom:"1px solid",borderColor:"whiteAlpha.300",overflowX:"auto",children:[EZ.filter(he=>he!=="Portals").map(he=>S.jsx(Nn,{variant:"ghost",size:"md",fontWeight:o===he?"semibold":"normal",color:o===he?"white":re,bg:o===he?ce:"transparent",borderBottom:o===he?`2px solid ${q}`:"2px solid transparent",borderRadius:"md",_hover:{bg:o!==he?"whiteAlpha.100":ce,color:"white"},onClick:()=>ae(he),px:4,whiteSpace:"nowrap",children:he},he)),S.jsx(dS,{}),S.jsx(Nn,{variant:"ghost",size:"md",fontWeight:o==="Portals"?"semibold":"normal",color:o==="Portals"?"white":re,bg:o==="Portals"?ce:"transparent",borderBottom:o==="Portals"?`2px solid ${q}`:"2px solid transparent",borderRadius:"md",_hover:{bg:o!=="Portals"?"whiteAlpha.100":ce,color:"white"},onClick:()=>ae("Portals"),px:4,whiteSpace:"nowrap",children:"Portals"},"Portals")]}),y&&o==="Portals"?S.jsx(ct,{p:4,flexGrow:1,display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",children:S.jsx(Nn,{size:"lg",colorScheme:"blue",onClick:Q,children:"Browse"})}):S.jsxs(S.Fragment,{children:[S.jsx(ct,{p:4,children:S.jsx(li,{placeholder:`Search in ${o}...`,value:u,onChange:he=>p(he.target.value),bg:"rgba(255, 255, 255, 0.05)",borderColor:"rgba(255, 255, 255, 0.2)",borderRadius:"md",size:"md",_placeholder:{color:"whiteAlpha.500"}})}),S.jsx(ct,{p:4,pt:0,overflowY:"auto",flexGrow:1,children:S.jsx(E5,{templateColumns:"repeat(auto-fill, minmax(140px, 1fr))",gap:4,children:M?S.jsx(Ye,{color:"whiteAlpha.700",children:"Loading items..."}):H.length>0?H.map(he=>S.jsxs(ct,{p:2,bg:"whiteAlpha.100",borderRadius:"lg",textAlign:"center",cursor:"pointer",_hover:{bg:"whiteAlpha.300",transform:"scale(1.03)"},onClick:()=>X(he),transition:"all 0.2s ease-in-out",display:"flex",flexDirection:"column",children:[S.jsx(ct,{bgImage:`url(${he.thumbnail})`,bgSize:"contain",bgRepeat:"no-repeat",bgPos:"center",borderRadius:"md",h:"100px",mb:2,flexShrink:0}),S.jsx(Ye,{fontSize:"xs",noOfLines:2,flexGrow:1,display:"flex",alignItems:"center",justifyContent:"center",children:he.name})]},he.id)):S.jsxs(Ye,{color:"whiteAlpha.700",children:[o==="Furniture"&&"No chairs found in the catalogue.",o==="Objects"&&"No miscellaneous objects found in the catalogue.",!["Furniture","Objects"].includes(o)&&`No items found in "${o}"${u&&` matching "${u}"`}.`]})})})]})]})]}),S.jsx(V9e,{isOpen:w,onClose:ne,currentSpaceId:i==null?void 0:i.spaceID})]})},B9e=({onTogglePlayerList:n,spaceID:e,containerRef:i})=>{const{fullscreenRef:o}=fh(),[l,u]=O.useState(!0),[p,y]=O.useState(!1),[v,w]=O.useState(!1),[C,R]=O.useState(!1),[N,M]=O.useState(!1),[L,U]=O.useState(!1),[z,J]=O.useState(!1),[q,re]=O.useState(null),[ce,ae]=O.useState(!1),[pe,H]=O.useState(!1),[X,Q]=O.useState(!1),[ne,he]=O.useState(!1),fe=Da(),{user:de}=O.useContext(Zi),ke=(de==null?void 0:de.Nickname)||"Unknown",[De,je]=O.useState(!1),Te=async()=>{if(de!=null&&de.uid&&e)try{const nt=await su(de.uid);let mt=!1,et=!1;if(nt.groups){const un=`space_${e}_owners`,ft=`space_${e}_hosts`;mt=nt.groups.includes(un),et=nt.groups.includes(ft)}const St=await Koe(de.uid,"disruptiveAdmin");if(he(St),re({rpmURL:nt.rpmURL?nt.rpmURL.replace(".glb",".png?scene=fullbody-portrait-closeupfront&w=640&q=75"):null}),H(mt||St),Q(et),!mt&&!St&&ce){ae(!1);const un=new CustomEvent("editModeChanged",{detail:{enabled:!1}});window.dispatchEvent(un),fe({title:"Edit Mode Disabled",description:"You don't have permission to edit this space.",status:"warning",duration:5e3,isClosable:!0,position:"top"})}}catch(nt){console.error("Error fetching profile data:",nt),H(!1),Q(!1),he(!1)}else H(!1),Q(!1),he(!1)};O.useEffect(()=>{Te()},[de==null?void 0:de.uid,e,ce]),O.useEffect(()=>{const nt=()=>{u(!0)};return window.addEventListener("PlayerInstantiated",nt),()=>{window.removeEventListener("PlayerInstantiated",nt)}},[]),O.useEffect(()=>{(async()=>{try{window.agoraClient&&typeof window.agoraClient.voiceDisabled=="boolean"&&je(window.agoraClient.voiceDisabled)}catch(et){console.error("Error checking if voice is disabled:",et)}})();const mt=et=>{et.detail&&typeof et.detail.voiceDisabled=="boolean"&&(console.log("Voice setting changed:",et.detail.voiceDisabled),je(et.detail.voiceDisabled))};return window.addEventListener("SpaceVoiceSettingChanged",mt),()=>{window.removeEventListener("SpaceVoiceSettingChanged",mt)}},[]);const we=()=>{w(!v),v||lt()},Ie=()=>R(!C),Oe=()=>{U(!L),lt()},ve=()=>{M(!1),Te()},xe=()=>{J(!1)},Ge=()=>{J(!0),lt()},Ze=nt=>{nt.stopPropagation(),typeof n=="function"&&(K.log("CanvasMainMenu: Toggling player list"),n())},lt=()=>{y(!1)},vt=nt=>{if(nt.stopPropagation(),!pe){fe({title:"Permission Denied",description:"You don't have permission to edit this space. Only space owners can use Edit Mode.",status:"error",duration:5e3,isClosable:!0,position:"top"});return}const mt=!ce;ae(mt);const et=new CustomEvent("editModeChanged",{detail:{enabled:mt}});window.dispatchEvent(et),fe({title:mt?"Edit Mode Enabled":"Edit Mode Disabled",description:mt?"You can now make changes to the scene.":"Scene editing is now disabled.",status:mt?"info":"success",duration:3e3,isClosable:!0,position:"top"})};return S.jsxs(S.Fragment,{children:[S.jsxs(VR,{isOpen:p,onClose:()=>y(!1),children:[S.jsx(FR,{as:Pc,icon:S.jsx(b8e,{}),"aria-label":"Main menu",variant:"ghost",color:"white",bg:p?"whiteAlpha.400":"whiteAlpha.200",_hover:{bg:p?"whiteAlpha.500":"whiteAlpha.300"},size:"md",onClick:()=>y(!p)}),S.jsx(Nc,{containerRef:o,children:S.jsx(jR,{bg:"rgba(0,0,0,0.4)",backdropFilter:"blur(10px)",border:"none",boxShadow:"lg",color:"white",width:"300px",p:3,borderRadius:"lg",zIndex:9999,transform:"none !important",children:S.jsxs(Ir,{align:"stretch",spacing:3,children:[S.jsxs(Qn,{spacing:3,children:[S.jsx(ml,{size:"sm",src:q==null?void 0:q.rpmURL,bg:"white",name:" ",borderWidth:"1px",borderColor:"whiteAlpha.300"}),S.jsxs(Ir,{align:"start",spacing:0,children:[S.jsxs(Qn,{children:[S.jsx(Ye,{fontWeight:"bold",fontSize:"sm",children:ke}),pe&&!ne&&S.jsx(Uf,{label:"Owner",placement:"top",hasArrow:!0,zIndex:1e4,openDelay:300,gutter:8,portalProps:{containerRef:o},children:S.jsx(ct,{display:"inline-block",children:S.jsx(Sn,{as:YF,color:"green.400",boxSize:2.5})})}),!pe&&X&&!ne&&S.jsx(Uf,{label:"Host",placement:"top",hasArrow:!0,zIndex:1e4,openDelay:300,gutter:8,portalProps:{containerRef:o},children:S.jsx(ct,{display:"inline-block",children:S.jsx(Sn,{as:XF,color:"purple.400",boxSize:2.5})})}),ne&&S.jsx(Uf,{label:"Admin",placement:"top",hasArrow:!0,zIndex:1e4,openDelay:300,gutter:8,portalProps:{containerRef:o},children:S.jsx(ct,{display:"inline-block",children:S.jsx(Sn,{as:YWe,color:"blue.400",boxSize:2.5})})})]}),S.jsx(Ye,{fontSize:"xs",color:"whiteAlpha.800",children:"Spaces Metaverse"})]})]}),S.jsxs(Qn,{spacing:3,justify:"center",children:[S.jsx(Pc,{icon:S.jsx(JWe,{}),variant:"ghost",colorScheme:"whiteAlpha",size:"sm","aria-label":"People",_hover:{bg:"whiteAlpha.200"},onClick:Ze}),pe&&S.jsx(Pc,{icon:S.jsx(zWe,{}),variant:"ghost",colorScheme:ce?"green":"whiteAlpha",size:"sm","aria-label":"Edit Mode",_hover:{bg:"whiteAlpha.200"},onClick:vt}),!ce&&S.jsx(Pc,{icon:S.jsx(ct,{w:"4",h:"4"}),variant:"ghost",colorScheme:"whiteAlpha",size:"sm","aria-label":"Action 3",_hover:{bg:"whiteAlpha.200"},isDisabled:!0}),ce&&S.jsx(Pc,{icon:S.jsx(BWe,{}),variant:"ghost",colorScheme:"whiteAlpha",size:"sm","aria-label":"Catalogue",_hover:{bg:"whiteAlpha.200"},onClick:Ge}),S.jsx(Pc,{icon:S.jsx(ct,{w:"4",h:"4"}),variant:"ghost",colorScheme:"whiteAlpha",size:"sm","aria-label":"Action 4",_hover:{bg:"whiteAlpha.200"}})]}),S.jsx(Ug,{borderColor:"whiteAlpha.300"}),S.jsxs(Ir,{align:"stretch",spacing:1,children:[pe&&S.jsxs(Qn,{p:1.5,borderRadius:"md",_hover:{bg:"whiteAlpha.200"},justify:"space-between",children:[S.jsx(Ye,{fontSize:"sm",children:"Edit Mode"}),S.jsx(Mf,{id:"edit-mode-toggle",isChecked:ce,onChange:vt,colorScheme:"green",sx:{"& .chakra-switch__track":{bg:ce?"green.500":"black"}}})]}),pe&&S.jsx(Ye,{fontSize:"sm",cursor:"pointer",_hover:{bg:"whiteAlpha.200"},p:1.5,borderRadius:"md",onClick:Oe,children:"Manage Space"}),de&&e&&!De&&S.jsx(g9e,{onClose:lt}),S.jsx(Ye,{fontSize:"sm",cursor:"pointer",_hover:{bg:"whiteAlpha.200"},p:1.5,borderRadius:"md",onClick:we,children:"Settings"}),S.jsx(Ye,{fontSize:"sm",cursor:"pointer",_hover:{bg:"whiteAlpha.200"},p:1.5,borderRadius:"md",onClick:Ie,children:"Controls"}),S.jsx(Ye,{fontSize:"sm",cursor:"pointer",_hover:{bg:"whiteAlpha.200"},p:1.5,borderRadius:"md",onClick:()=>window.open("https://support.spacesmetaverse.com/","_blank"),children:"Support"}),S.jsx(Ye,{fontSize:"sm",cursor:"pointer",_hover:{bg:"whiteAlpha.200"},p:1.5,borderRadius:"md",color:"red.300",children:"Leave"})]})]})})})]}),C&&S.jsx(_9e,{open:C,onClose:Ie}),v&&S.jsx(E9e,{open:v,onClose:we,containerRef:i}),N&&S.jsx(Wae,{open:N,onClose:ve}),S.jsx(M9e,{isOpen:L,onClose:Oe}),S.jsx(j9e,{isOpen:z,onClose:xe,settings:{spaceID:e}})]})},z9e=({isOpen:n,onClose:e,mediaScreenId:i,onImageChange:o})=>{const{spaceID:l}=So(),u=lc(),p=Da(),y=O.useRef(null),v=O.useRef(null),w=O.useRef(),[C,R]=O.useState(null),[N,M]=O.useState(""),[L,U]=O.useState(!1),[z,J]=O.useState(0),[q,re]=O.useState(null),[ce,ae]=O.useState(!0),[pe,H]=O.useState(!1),[X,Q]=O.useState(!1),[ne,he]=O.useState(0),[fe,de]=O.useState("image"),[ke,De]=O.useState(""),[je,Te]=O.useState(!1);O.useEffect(()=>{(async()=>{if(n&&i&&l){ae(!0);try{const St=await aE(l,i);if(St&&(St.imageUrl||St.videoUrl)){re(St);const un=St.mediaType==="video";de(un?"video":"image"),Te(St.displayAsVideo||!1),un&&St.videoUrl&&(De(St.videoUrl),he(1))}else re(null)}catch(St){K.error("Error fetching existing image:",St),re(null)}finally{ae(!1)}}})()},[n,i,l]),O.useEffect(()=>{n||(R(null),M(""),J(0),De(""))},[n]);const we=O.useCallback(et=>{et.preventDefault(),et.stopPropagation(),Q(!0)},[]),Ie=O.useCallback(et=>{et.preventDefault(),et.stopPropagation(),Q(!1)},[]),Oe=O.useCallback(et=>{et.preventDefault(),et.stopPropagation()},[]),ve=O.useCallback(et=>{if(et.preventDefault(),et.stopPropagation(),Q(!1),et.dataTransfer.files&&et.dataTransfer.files.length>0){const St=et.dataTransfer.files[0];xe(St)}},[]);O.useEffect(()=>{const et=v.current;if(et)return et.addEventListener("dragenter",we),et.addEventListener("dragleave",Ie),et.addEventListener("dragover",Oe),et.addEventListener("drop",ve),()=>{et.removeEventListener("dragenter",we),et.removeEventListener("dragleave",Ie),et.removeEventListener("dragover",Oe),et.removeEventListener("drop",ve)}},[we,Ie,Oe,ve]);const xe=et=>{if(!et)return;if(!et.type.startsWith("image/")){p({title:"Invalid file type",description:"Please select an image file (PNG, JPEG, etc.)",status:"error",duration:5e3,isClosable:!0});return}R(et);const St=new FileReader;St.onloadend=()=>{M(St.result)},St.readAsDataURL(et)},Ge=et=>{const St=et.target.files[0];xe(St)},Ze=async et=>{const St=et.target.checked;if(Te(St),q)try{await _We(l,i,St),St?u("SetMediaScreenImage",{mediaScreenId:i,imageUrl:null,videoUrl:q.videoUrl||null,mediaType:q.mediaType||"image",displayAsVideo:!0}):u("SetMediaScreenImage",{mediaScreenId:i,imageUrl:q.imageUrl||null,videoUrl:q.videoUrl||null,mediaType:q.mediaType||"image",displayAsVideo:!1}),re({...q,displayAsVideo:St}),p({title:"Display mode updated",description:`The media screen will now be displayed as ${St?"video":"image"}`,status:"success",duration:3e3,isClosable:!0}),K.log(`Updated display mode for media screen ${i} to ${St?"video":"image"}`),o&&o({type:"update",mediaScreenId:i,displayAsVideo:St})}catch(un){K.error("Error updating display mode:",un),p({title:"Update failed",description:un.message||"An error occurred while updating the display mode",status:"error",duration:5e3,isClosable:!0}),Te(!St)}},lt=async()=>{if(fe==="image"&&!C){p({title:"No file selected",description:"Please select an image to upload",status:"warning",duration:5e3,isClosable:!0});return}if(fe==="video"&&!ke){p({title:"No video URL",description:"Please enter a video URL",status:"warning",duration:5e3,isClosable:!0});return}try{U(!0);const et=setInterval(()=>{J(Ct=>{const ut=Ct+10;return ut>=90?90:ut})},300);let St;fe==="image"?St=await lZ(l,i,C,{mediaType:fe,displayAsVideo:je}):(St=ke,await lZ(l,i,null,{mediaType:"video",directUrl:ke,displayAsVideo:je})),clearInterval(et),J(100);let un=null,ft=null;fe==="image"?(un=je?null:St,ft=(q==null?void 0:q.videoUrl)||null):(un=!je&&(q!=null&&q.imageUrl)?q.imageUrl:null,ft=St),u("SetMediaScreenImage",{mediaScreenId:i,imageUrl:un,videoUrl:ft,mediaType:fe,displayAsVideo:je}),K.log(`Uploaded and sent ${fe} for media screen ${i} (display as video: ${je})`),o&&o({type:"upload",mediaScreenId:i,imageUrl:fe==="image"?St:q==null?void 0:q.imageUrl,videoUrl:fe==="video"?St:q==null?void 0:q.videoUrl,mediaType:fe,displayAsVideo:je}),p({title:"Upload successful",description:`The ${fe} has been uploaded and applied to the media screen`,status:"success",duration:5e3,isClosable:!0}),setTimeout(()=>{R(null),M(""),U(!1),J(0),e()},1e3)}catch(et){K.error(`Error uploading ${fe}:`,et),p({title:"Upload failed",description:et.message||`An error occurred while uploading the ${fe}`,status:"error",duration:5e3,isClosable:!0}),U(!1),J(0)}},vt=async()=>{H(!1);try{U(!0),await gWe(l,i),u("SetMediaScreenImage",{mediaScreenId:i,imageUrl:fe==="image"?null:(q==null?void 0:q.imageUrl)||null,videoUrl:fe==="video"?null:(q==null?void 0:q.videoUrl)||null,mediaType:null,displayAsVideo:!1}),K.log(`Deleted ${fe} for media screen ${i}`),o&&o({type:"delete",mediaScreenId:i}),p({title:`${fe==="image"?"Image":"Video"} deleted`,description:`The ${fe} has been removed from the media screen`,status:"success",duration:5e3,isClosable:!0}),re(null),U(!1),De(""),Te(!1),setTimeout(()=>{e()},500)}catch(et){K.error(`Error deleting ${fe}:`,et),p({title:"Deletion failed",description:et.message||`An error occurred while deleting the ${fe}`,status:"error",duration:5e3,isClosable:!0}),U(!1)}},nt=()=>{L||(R(null),M(""),J(0),e())},mt=et=>{he(et),de(et===0?"image":"video")};return S.jsxs(S.Fragment,{children:[S.jsxs(ls,{isOpen:n,onClose:nt,size:"lg",children:[S.jsx(ds,{bg:"rgba(0, 0, 0, 0.8)",backdropFilter:"blur(8px)"}),S.jsxs(us,{bg:"#1a1a1a",color:"white",maxW:"650px",borderRadius:"xl",border:"1px solid #333",children:[S.jsx(co,{fontSize:"md",fontWeight:"600",pb:1,pt:3,px:4,color:"white",children:"Media Screen"}),S.jsx(Is,{isDisabled:L,color:"gray.400",_hover:{color:"white",bg:"rgba(255,255,255,0.1)"},borderRadius:"full",size:"sm",top:3,right:3}),S.jsxs(ct,{px:4,pb:1,children:[S.jsxs(Ur,{justify:"space-between",align:"center",bg:"rgba(255,255,255,0.03)",p:2,borderRadius:"lg",mb:1,border:"1px solid rgba(255,255,255,0.08)",children:[S.jsxs(Qn,{spacing:2,children:[S.jsx(Ye,{fontWeight:"500",fontSize:"xs",color:"gray.300",children:"Display:"}),S.jsxs(Qn,{spacing:2,children:[S.jsx(Sn,{as:Uy,color:je?"gray.500":"white",size:"sm"}),S.jsx(Mf,{colorScheme:"gray",size:"sm",isChecked:je,onChange:Ze}),S.jsx(Sn,{as:GC,color:je?"white":"gray.500",size:"sm"})]})]}),S.jsx(sh,{bg:"rgba(255,255,255,0.1)",color:"gray.300",fontSize:"xs",px:2,py:1,borderRadius:"md",fontWeight:"500",children:je?"Video":"Image"})]}),S.jsxs(Ye,{fontSize:"xs",color:"gray.500",children:["ID: ",i]})]}),S.jsx(gs,{px:4,py:1,children:S.jsxs(Ur,{children:[S.jsx(kS,{orientation:"vertical",variant:"unstyled",index:ne,onChange:mt,h:"100%",minW:"75px",mr:3,children:S.jsxs(OS,{spacing:1,children:[S.jsxs(Ia,{_selected:{color:"white",bg:"rgba(255,255,255,0.1)",borderRadius:"lg"},_hover:{bg:"rgba(255,255,255,0.05)"},mb:1,py:1.5,px:2.5,justifyContent:"flex-start",borderRadius:"lg",fontSize:"xs",fontWeight:"500",color:"gray.400",w:"full",children:[S.jsx(Sn,{as:Uy,mr:1.5,size:"sm"})," Image"]}),S.jsxs(Ia,{_selected:{color:"white",bg:"rgba(255,255,255,0.1)",borderRadius:"lg"},_hover:{bg:"rgba(255,255,255,0.05)"},py:1.5,px:2.5,justifyContent:"flex-start",borderRadius:"lg",fontSize:"xs",fontWeight:"500",color:"gray.400",w:"full",children:[S.jsx(Sn,{as:GC,mr:1.5,size:"sm"})," Video"]})]})}),S.jsx(ct,{flex:"1",children:ce?S.jsx(Ur,{justify:"center",align:"center",h:"120px",children:S.jsx(ld,{size:"lg",color:"white"})}):S.jsxs(S.Fragment,{children:[S.jsx(ct,{children:ne===0?S.jsxs(Ir,{spacing:4,align:"stretch",children:[q&&q.imageUrl&&fe==="image"&&S.jsxs(ct,{children:[S.jsx(Ye,{fontWeight:"semibold",mb:2,children:"Current Image:"}),S.jsxs(Ur,{children:[S.jsx(ct,{borderWidth:"1px",borderRadius:"md",overflow:"hidden",mb:2,maxW:"200px",mr:4,children:S.jsx(yp,{src:q.imageUrl,alt:"Current image",maxHeight:"150px",width:"100%",objectFit:"contain"})}),S.jsxs(Ir,{align:"flex-start",spacing:2,children:[S.jsxs(Ye,{fontSize:"xs",color:"gray.400",children:["Uploaded: ",new Date(q.uploadedAt).toLocaleString()]}),S.jsxs(Ye,{fontSize:"xs",color:"gray.400",children:["Display Mode: ",q.displayAsVideo?"Video":"Image"]}),S.jsx(Nn,{size:"sm",colorScheme:"red",variant:"outline",leftIcon:S.jsx(Sn,{as:_S}),onClick:()=>H(!0),isDisabled:L,children:"Delete"})]})]}),S.jsx(Ug,{my:4})]}),S.jsx(Ye,{fontWeight:"semibold",mb:2,children:q&&q.imageUrl&&fe==="image"?"Replace with new image:":"Upload new image:"}),S.jsxs(ct,{ref:v,borderWidth:"2px",borderRadius:"md",borderStyle:"dashed",borderColor:X?"rgba(255,255,255,0.3)":"rgba(255,255,255,0.15)",bg:X?"rgba(255,255,255,0.08)":"rgba(255,255,255,0.03)",p:4,textAlign:"center",transition:"all 0.2s ease",_hover:{borderColor:"rgba(255,255,255,0.3)",bg:"rgba(255,255,255,0.06)"},cursor:"pointer",onClick:()=>y.current.click(),children:[N?S.jsx(ct,{borderRadius:"md",overflow:"hidden",maxH:"200px",children:S.jsx(yp,{src:N,alt:"Preview",maxHeight:"200px",width:"100%",objectFit:"contain"})}):S.jsxs(Ir,{spacing:2,children:[S.jsx(Sn,{as:Qk,boxSize:"20px",color:"gray.400"}),S.jsxs(Ir,{spacing:0,children:[S.jsx(Ye,{fontSize:"xs",fontWeight:"500",color:"white",children:"Drop image or click to browse"}),S.jsx(Ye,{fontSize:"xs",color:"gray.500",children:"PNG, JPG, JPEG, GIF"})]})]}),S.jsx(li,{type:"file",accept:"image/*",onChange:Ge,ref:y,display:"none"})]}),C&&S.jsxs(Ye,{fontSize:"xs",color:"gray.400",bg:"rgba(255,255,255,0.05)",p:2,borderRadius:"md",border:"1px solid rgba(255,255,255,0.1)",children:[C.name," (",Math.round(C.size/1024)," KB)"]})]}):S.jsxs(Ir,{spacing:4,align:"stretch",children:[q&&q.videoUrl&&fe==="video"&&S.jsxs(ct,{children:[S.jsx(Ye,{fontWeight:"500",mb:1,fontSize:"xs",color:"gray.400",children:"Current Video URL:"}),S.jsxs(Ur,{children:[S.jsx(ct,{borderWidth:"1px",borderRadius:"md",p:3,mb:2,flex:"1",mr:4,bg:"gray.700",children:S.jsx(Ye,{fontSize:"sm",wordBreak:"break-all",children:q.videoUrl})}),S.jsxs(Ir,{align:"flex-start",spacing:2,children:[S.jsxs(Ye,{fontSize:"xs",color:"gray.400",children:["Added: ",new Date(q.uploadedAt).toLocaleString()]}),S.jsxs(Ye,{fontSize:"xs",color:"gray.400",children:["Display Mode: ",q.displayAsVideo?"Video":"Image"]}),S.jsx(Nn,{size:"sm",colorScheme:"red",variant:"outline",leftIcon:S.jsx(Sn,{as:_S}),onClick:()=>H(!0),isDisabled:L,children:"Delete"})]})]}),S.jsx(Ug,{my:4})]}),S.jsxs(br,{children:[S.jsx(gi,{fontSize:"xs",fontWeight:"500",color:"white",mb:1.5,children:"Video URL"}),S.jsx(li,{placeholder:"https://youtube.com/watch?v=...",value:ke,onChange:et=>De(et.target.value),bg:"rgba(255,255,255,0.05)",borderColor:"rgba(255,255,255,0.15)",_hover:{borderColor:"rgba(255,255,255,0.3)"},_focus:{borderColor:"rgba(255,255,255,0.5)",boxShadow:"0 0 0 1px rgba(255,255,255,0.3)"},size:"sm",borderRadius:"lg",color:"white",fontSize:"xs",_placeholder:{color:"gray.500",fontSize:"xs"}})]}),ke&&S.jsxs(ct,{mt:2,p:2,bg:"rgba(255,255,255,0.05)",borderRadius:"lg",border:"1px solid rgba(255,255,255,0.1)",children:[S.jsxs(Qn,{mb:1,children:[S.jsx(Sn,{as:w9e,color:"gray.400",size:"sm"}),S.jsx(Ye,{fontWeight:"500",fontSize:"xs",color:"white",children:"Preview"})]}),S.jsx(Ye,{fontSize:"xs",wordBreak:"break-all",color:"gray.400",children:ke})]})]})}),L&&S.jsxs(ct,{mt:3,children:[S.jsxs(Ye,{mb:2,fontSize:"sm",fontWeight:"500",color:"white",children:["Uploading: ",z,"%"]}),S.jsx(qy,{value:z,colorScheme:"gray",size:"sm",borderRadius:"full",bg:"rgba(255,255,255,0.1)"})]})]})})]})}),S.jsx(uh,{pt:2,pb:3,px:4,children:S.jsxs(Ur,{w:"full",gap:3,children:[S.jsx(Nn,{variant:"outline",flex:1,onClick:nt,isDisabled:L,color:"gray.400",borderColor:"rgba(255,255,255,0.2)",_hover:{bg:"rgba(255,255,255,0.05)",borderColor:"rgba(255,255,255,0.3)"},borderRadius:"lg",size:"sm",fontSize:"xs",fontWeight:"500",children:"Cancel"}),S.jsx(Nn,{bg:"#6b7280",color:"white",flex:2,onClick:lt,isLoading:L,loadingText:"Saving",isDisabled:fe==="image"&&!C||fe==="video"&&!ke||L||ce,leftIcon:S.jsx(Sn,{as:fe==="image"?Uy:GC,size:"sm"}),_hover:{bg:"#4b5563"},_active:{bg:"#374151"},_disabled:{bg:"#374151",opacity:.5},borderRadius:"lg",size:"sm",fontSize:"xs",fontWeight:"600",children:fe==="image"?"Upload":"Save URL"})]})})]})]}),S.jsx(eUe,{isOpen:pe,leastDestructiveRef:w,onClose:()=>H(!1),children:S.jsx(ds,{bg:"rgba(0, 0, 0, 0.8)",children:S.jsxs(tUe,{bg:"#1a1a1a",color:"white",borderRadius:"xl",border:"1px solid #333",maxW:"350px",children:[S.jsxs(co,{fontSize:"md",fontWeight:"600",pt:4,pb:2,color:"white",children:["Delete ",fe==="video"?"Video":"Image"]}),S.jsx(gs,{py:2,color:"gray.400",fontSize:"sm",children:"Are you sure? This will revert the media screen to its blank state."}),S.jsx(uh,{pt:3,pb:4,children:S.jsxs(Ur,{w:"full",gap:2,children:[S.jsx(Nn,{ref:w,onClick:()=>H(!1),variant:"outline",flex:1,color:"gray.400",borderColor:"rgba(255,255,255,0.2)",_hover:{bg:"rgba(255,255,255,0.05)"},borderRadius:"lg",size:"sm",fontSize:"sm",children:"Cancel"}),S.jsx(Nn,{bg:"#dc2626",color:"white",onClick:vt,flex:1,leftIcon:S.jsx(Sn,{as:_S,size:"sm"}),_hover:{bg:"#b91c1c"},borderRadius:"lg",fontWeight:"600",size:"sm",fontSize:"sm",children:"Delete"})]})})]})})})]})},W9e=n=>{const[e,i]=O.useState(null),[o,l]=O.useState(""),[u,p]=O.useState(null),[y,v]=O.useState(!1),w=Dc(),{spaceID:C}=So(),R=O.useCallback(L=>{var U,z;try{if(!L)return null;if(L.includes("youtube.com")||L.includes("youtu.be")){let J="";return L.includes("youtube.com/watch")?J=new URLSearchParams(new URL(L).search).get("v"):L.includes("youtu.be/")&&(J=L.split("youtu.be/")[1].split("?")[0]),J?`https://www.youtube.com/embed/${J}?autoplay=1`:L}if(L.includes("vimeo.com")){if(L.includes("player.vimeo.com/video"))return L;const J=(z=(U=L.split("vimeo.com/")[1])==null?void 0:U.split("?")[0])==null?void 0:z.split("/")[0];return J?`https://player.vimeo.com/video/${J}?autoplay=1`:L}return L}catch(J){return K.error("Error converting to embed URL:",J),L}},[]),N=O.useCallback(()=>{setTimeout(()=>{v(!1),K.log("Video processing state reset")},100)},[]);O.useEffect(()=>{let L=!0,U=null;const J=w("PlayMediaScreenVideo",async q=>{try{console.log("[DEBUG] PlayMediaScreenVideo event received:",q,"isEditMode:",n),console.log("PlayMediaScreenVideo event received:",q);const{mediaScreenId:re,videoUrl:ce}=q||{};if(!re){K.error("Media screen ID is missing in Unity event data."),N();return}if(n){console.log(`[DEBUG] Edit mode is active for screen ${re}, setting ID but not playing video`),K.log("Edit mode is active, setting media screen ID but not playing video"),p(re);return}if(v(!0),U=setTimeout(()=>{L&&(K.warn("Video processing timeout reached, resetting state"),v(!1))},5e3),ce){if(console.log(`Using direct video URL from event: ${ce}`),L)try{const ae=R(ce);console.log(`Setting video URL to: ${ae} (original: ${ce})`),i(ae),l(`Media Screen ${re}`),p(re),K.log("Media screen video URL set directly from event:",ae)}catch(ae){K.error("Error setting video URL from direct URL:",ae)}finally{N(),clearTimeout(U)}return}console.log(`Fetching media screen data for ID: ${re}`);try{const ae=await aE(C,re);if(console.log("Media screen data from Firestore:",ae),!ae||!ae.videoUrl){K.error("No video URL found for media screen:",re),N(),clearTimeout(U);return}if(!ae.displayAsVideo){K.log("Media screen is not set to display as video:",re),console.log("displayAsVideo flag is false for this media screen"),N(),clearTimeout(U);return}if(L)try{const pe=R(ae.videoUrl);console.log(`Setting video URL to: ${pe} (original: ${ae.videoUrl})`);const H=ae.title||`Media Screen ${re}`;i(pe),l(H),p(re),K.log("Media screen video URL set to:",pe)}catch(pe){K.error("Error setting video URL from Firestore:",pe)}finally{N(),clearTimeout(U)}}catch(ae){K.error(`Error fetching media screen data for ${re}:`,ae),N(),clearTimeout(U)}}catch(re){K.error("Error handling media screen video play:",re),console.error("Error handling media screen video play:",re),N(),clearTimeout(U)}});return()=>{L=!1,U&&clearTimeout(U),J()}},[w,C,n,R,N]);const M=O.useCallback(()=>{i(null),l(""),p(null),v(!1),K.log("Video player state reset")},[]);return[e,o,u,M,y]},G9e=()=>{const{spaceID:n}=So(),e=lc(),i=Dc(),[o,l]=O.useState(!1);O.useEffect(()=>{if(window.isPlayerInstantiated){K.log("useMediaScreenThumbnails: Unity already ready (via window flag)"),l(!0);return}const w=()=>{K.log("useMediaScreenThumbnails: Unity is now ready (PlayerInstantiated event)"),l(!0)};return window.addEventListener("PlayerInstantiated",w),()=>{window.removeEventListener("PlayerInstantiated",w)}},[]);const u=O.useCallback(async w=>{try{return w.includes("vimeo.com")?await p(w):w.includes("youtube.com")||w.includes("youtu.be")?await y(w):"https://via.placeholder.com/640x360?text=Video"}catch(C){return K.error(`Error fetching thumbnail for ${w}:`,C),"https://via.placeholder.com/640x360?text=Error"}},[]),p=async w=>{try{const C=`https://vimeo.com/api/oembed.json?url=${encodeURIComponent(w)}`,R=await fetch(C);if(!R.ok)throw new Error(`Failed to fetch Vimeo thumbnail: ${R.statusText}`);const N=await R.json(),M=N.thumbnail_url.replace(/_\d+x\d+/,""),L=["640x360","295x166"];let U=null;for(let z of L){const J=`https://i.vimeocdn.com/filter/overlay?src0=${encodeURIComponent(`${M}_${z}`)}&src1=http://f.vimeocdn.com/p/images/crawler_play.png`;try{if((await fetch(J,{method:"HEAD"})).ok){U=J;break}}catch(q){K.warn(`Failed to validate thumbnail URL: ${J}`,q)}}return U||N.thumbnail_url}catch(C){return K.error(`Error fetching Vimeo thumbnail: ${C.message}`),"https://via.placeholder.com/640x360?text=Vimeo+Video"}},y=async w=>{let C="";if(w.includes("youtube.com/watch")?C=new URLSearchParams(new URL(w).search).get("v"):w.includes("youtu.be/")&&(C=w.split("youtu.be/")[1].split("?")[0]),!C)throw new Error("Could not extract YouTube video ID");const R=`https://img.youtube.com/vi/${C}/maxresdefault.jpg`;try{if((await fetch(R,{method:"HEAD"})).ok)return R}catch(N){K.warn(`Failed to validate maxresdefault thumbnail for YouTube video ${C}`,N)}return`https://img.youtube.com/vi/${C}/hqdefault.jpg`},v=O.useCallback(async w=>{try{if(!n||!w)return;K.log(`Refreshing thumbnail for media screen ${w}`);const C=await aE(n,w);if(!C){K.log(`No media screen found with ID ${w}`);return}if(K.log("Media screen data:",C),!C.displayAsVideo||!C.videoUrl){K.log(`Media screen ${w} is not set to display as video or has no video URL`);return}const R=await u(C.videoUrl);e("SetMediaScreenThumbnail",{mediaScreenId:w,thumbnailUrl:R}),K.log(`Sent refreshed thumbnail for media screen ${w}: ${R}`)}catch(C){K.error(`Error refreshing thumbnail for media screen ${w}:`,C)}},[n,u,e]);O.useEffect(()=>{if(!o){K.log("useMediaScreenThumbnails: Waiting for Unity to be ready before setting up thumbnail listeners");return}K.log("useMediaScreenThumbnails: Unity is ready, now setting up thumbnail listeners");const C=i("SetMediaScreenThumbnail",async R=>{try{const{mediaScreenId:N,thumbnailUrl:M}=R;M==="refresh"&&N&&(console.log(`Received request to refresh thumbnail for media screen ${N}`),await v(N))}catch(N){console.error("Error handling SetMediaScreenThumbnail event:",N)}});return()=>{C()}},[i,v,o]),O.useEffect(()=>{if(!o){K.log("useMediaScreenThumbnails: Waiting for Unity to be ready before fetching thumbnails");return}K.log("useMediaScreenThumbnails: Unity is ready, now fetching thumbnails");const w=async()=>{try{if(!n)throw new Error("spaceID is not defined.");K.log("Fetching media screens for thumbnails...");const R=await X3(n);K.log("All media screens:",R);const N=R.filter(U=>U.displayAsVideo&&U.videoUrl);if(K.log("Media screens set to display as videos:",N),N.length===0){K.log("No media screens set to display as videos found.");return}K.log(`Found ${N.length} media screens set to display as videos.`);const M=N.map(async U=>{try{const z=await u(U.videoUrl);return K.log(`Fetched thumbnail for ${U.id}: ${z}`),{mediaScreenId:U.id,thumbnailUrl:z}}catch(z){return K.error(`Error processing thumbnail for media screen ${U.id}:`,z),{mediaScreenId:U.id,thumbnailUrl:"https://via.placeholder.com/640x360?text=Error"}}}),L=await Promise.all(M);K.log("Fetched Media Screen Thumbnails",L),L.forEach(({mediaScreenId:U,thumbnailUrl:z})=>{e("SetMediaScreenThumbnail",{mediaScreenId:U,thumbnailUrl:z}),K.log(`Sent thumbnail to Unity for media screen ${U}: ${z}`)})}catch(R){K.error("Error fetching media screen thumbnails:",R)}};w();const C=setInterval(w,5*60*1e3);return()=>{clearInterval(C)}},[e,n,u,o])},vZ={iframeContainer:{position:"relative",paddingBottom:"56.25%",height:0,overflow:"hidden",width:"100%",pointerEvents:"auto !important"},iframe:{position:"absolute",top:0,left:0,width:"100%",height:"100%",border:"none",pointerEvents:"auto !important",zIndex:1e4}},H9e=()=>S.jsx("style",{dangerouslySetInnerHTML:{__html:`
        /* Disable pointer events on Unity elements when modal is open */
        body.unity-input-disabled #unity-container,
        body.unity-input-disabled #unity-canvas {
          pointer-events: none !important;
        }
        
        /* Make sure the modal is above Unity */
        .chakra-modal__overlay {
          z-index: 1001 !important;
          pointer-events: auto !important;
        }
        
        .chakra-modal__content {
          z-index: 1002 !important;
          pointer-events: auto !important;
        }
        
        /* Make sure the iframe is visible and interactive */
        .video-iframe {
          z-index: 1003 !important;
          pointer-events: auto !important;
        }
        
        /* Make sure the close button is accessible */
        .chakra-modal__close-btn {
          z-index: 1004 !important;
        }
        
        /* Ensure the iframe container allows clicks */
        .iframe-container {
          pointer-events: auto !important;
        }
        
        /* Remove the full-screen blocker */
      `}}),$9e=({videoUrl:n,videoTitle:e,mediaScreenId:i,isOpen:o,onClose:l})=>{const{fullscreenRef:u}=fh();return rD(o,`video-modal-${i}`),O.useEffect(()=>{if(o){const p=w=>{w.target.classList&&w.target.classList.contains("chakra-modal__overlay")&&(w.stopPropagation(),w.preventDefault())};document.addEventListener("mousemove",p,!0),document.addEventListener("mousedown",p,!0),document.addEventListener("mouseup",p,!0),document.addEventListener("click",p,!0),document.addEventListener("wheel",p,!0);const y=document.getElementById("unity-canvas"),v=document.getElementById("unity-container");if(y&&(y.style.pointerEvents="none"),v&&(v.style.pointerEvents="none"),document.body.classList.add("unity-input-disabled"),window.unityInstance)try{window.unityInstance.SendMessage("WebGLInputManager","Disable"),window.unityInstance.SendMessage("CameraController","DisableInput","VideoModal")}catch(w){console.error("Error disabling Unity input:",w)}return()=>{if(document.removeEventListener("mousemove",p,!0),document.removeEventListener("mousedown",p,!0),document.removeEventListener("mouseup",p,!0),document.removeEventListener("click",p,!0),document.removeEventListener("wheel",p,!0),y&&(y.style.pointerEvents="auto"),v&&(v.style.pointerEvents="auto"),document.body.classList.remove("unity-input-disabled"),window.unityInstance)try{window.unityInstance.SendMessage("WebGLInputManager","Enable"),window.unityInstance.SendMessage("CameraController","EnableInput","VideoModal")}catch(w){console.error("Error re-enabling Unity input:",w)}}}},[o]),S.jsxs(S.Fragment,{children:[S.jsx(H9e,{}),S.jsxs(ls,{isOpen:o,onClose:l,size:"xl",isCentered:!0,portalProps:{containerRef:u},closeOnOverlayClick:!0,closeOnEsc:!0,id:`video-modal-${i}`,children:[S.jsx(ds,{bg:"rgba(0, 0, 0, 0.8)",onClick:p=>{p.target===p.currentTarget&&(l(),p.stopPropagation(),p.preventDefault())},onMouseMove:p=>{p.target===p.currentTarget&&(p.stopPropagation(),p.preventDefault())},onMouseDown:p=>{p.target===p.currentTarget&&(p.stopPropagation(),p.preventDefault())},onMouseUp:p=>{p.target===p.currentTarget&&(p.stopPropagation(),p.preventDefault())},onWheel:p=>{p.target===p.currentTarget&&(p.stopPropagation(),p.preventDefault())},style:{pointerEvents:"auto"}}),S.jsxs(us,{bg:"gray.900",color:"white",borderRadius:"lg",overflow:"hidden",maxWidth:"80vw",maxHeight:"80vh",className:"video-modal-content",children:[S.jsx(Is,{size:"lg",bg:"gray.700",color:"white",borderRadius:"full",zIndex:"10004",_hover:{bg:"gray.600"},position:"absolute",top:"10px",right:"10px"}),S.jsx(gs,{p:0,width:"100%",children:n?S.jsx(ct,{className:"iframe-container",style:vZ.iframeContainer,children:S.jsx("iframe",{className:"video-iframe",src:n,style:vZ.iframe,allow:"autoplay; fullscreen",allowFullScreen:!0,title:e||"Video Player"})}):S.jsxs(Ur,{direction:"column",align:"center",justify:"center",h:"400px",children:[S.jsx(ld,{size:"xl",mb:4}),S.jsx(Ye,{children:"Unable to load video"}),S.jsx(Ye,{fontSize:"sm",color:"gray.400",mt:2,children:"No video URL provided"})]})})]})]})]})},K9e=5e3,q9e=n=>{if(!(n!=null&&n.includes("firebasestorage.googleapis.com")))return n;try{const e=new URL(n),i=e.searchParams.get("alt"),o=e.searchParams.get("token");return e.search="",i&&e.searchParams.set("alt",i),o&&e.searchParams.set("token",o),e.toString()}catch(e){return console.error("Error cleaning Firebase URL:",e),n}},Y9e=()=>{const{isOpen:n,onOpen:e,onClose:i}=od(),[o,l]=O.useState(null),[u,p]=O.useState("image"),y=O.useRef(null);rD(n,"image-viewer-modal");const v=O.useCallback(R=>R.stopPropagation(),[]);return O.useEffect(()=>{if(!n||!y.current)return;const R=y.current,N=document.getElementById("unity-canvas"),M=["mousemove","mousedown","mouseup","wheel"];return M.forEach(L=>R.addEventListener(L,v)),N&&(N.style.pointerEvents="none"),()=>{M.forEach(L=>R.removeEventListener(L,v)),N&&(N.style.pointerEvents="auto")}},[n,v]),{isOpen:n,currentImageUrl:o,currentMediaType:u,openImageViewer:(R,N="image")=>{const M=typeof R=="string"&&(R.match(/\.(jpeg|jpg|gif|png|webp)($|\?)/i)||R.includes("firebasestorage")&&!R.includes("video"));l(R),p(M?"image":N),e()},closeImageViewer:()=>{i(),setTimeout(()=>{l(null),p("image")},300)},modalContentRef:y,preventPropagation:v}},X9e=()=>S.jsx("style",{dangerouslySetInnerHTML:{__html:`
      body.unity-input-disabled #unity-container,
      body.unity-input-disabled #unity-canvas { pointer-events: none !important; }
      .image-viewer-modal-content,
      .chakra-modal__overlay { pointer-events: auto !important; }
    `}}),J9e=()=>{const[n,e]=O.useState([]),[i,o]=O.useState(!1),[l,u]=O.useState(null),[p,y]=O.useState(!1),v=O.useCallback((C,R)=>{e(N=>Array.isArray(N)&&N.some(L=>L.mediaScreenId===C)?N.map(L=>L.mediaScreenId===C?{...L,...R,lastUpdated:new Date().toISOString()}:L):[...Array.isArray(N)?N:[],{mediaScreenId:C,...R,firstDetected:new Date().toISOString(),lastUpdated:new Date().toISOString()}])},[]),w=O.useCallback(C=>Array.isArray(n)?n.find(R=>R.mediaScreenId===C):null,[n]);return{mediaScreens:n,setMediaScreens:e,isEditMode:i,setIsEditMode:o,selectedScreen:l,setSelectedScreen:u,unityReady:p,setUnityReady:y,updateMediaScreen:v,getScreenData:w}},Q9e=()=>{const{spaceID:n}=So(),{isOpen:e,onOpen:i,onClose:o}=od(),l=lc(),{fullscreenRef:u}=fh(),p=Dc(),{trackReactEvent:y}=_E(n),{setMediaScreens:v,isEditMode:w,setIsEditMode:C,selectedScreen:R,setSelectedScreen:N,unityReady:M,setUnityReady:L,updateMediaScreen:U,getScreenData:z}=J9e(),{isOpen:J,currentImageUrl:q,currentMediaType:re,openImageViewer:ce,closeImageViewer:ae,modalContentRef:pe,preventPropagation:H}=Y9e(),[X,Q,ne,he,fe]=W9e(w),{isOpen:de,onOpen:ke,onClose:De}=od();G9e(),Oae(),O.useEffect(()=>{if(window.isPlayerInstantiated){L(!0);return}const Oe=()=>L(!0);return window.addEventListener("PlayerInstantiated",Oe),()=>window.removeEventListener("PlayerInstantiated",Oe)},[L]);const je=O.useCallback(async Oe=>{const ve=z(Oe);if(ve)return{screen:ve,imageUrl:ve.imageUrl,videoUrl:ve.videoUrl,mediaType:ve.mediaType||"image",displayAsVideo:ve.displayAsVideo||!1};if(q)return{screen:{mediaScreenId:Oe},imageUrl:q,videoUrl:null,mediaType:"image",displayAsVideo:!1};if(n&&Oe)try{const xe=await aE(n,Oe);if(xe)return U(Oe,{...xe,hasImage:!!xe.imageUrl,source:"firestore-fetch"}),{screen:xe,imageUrl:xe.imageUrl,videoUrl:xe.videoUrl,mediaType:xe.mediaType||"image",displayAsVideo:xe.displayAsVideo||!1}}catch(xe){console.error(`Error fetching media screen data for ${Oe}:`,xe)}return null},[z,q,n,U]),Te=O.useCallback(async Oe=>{if(N(Oe),w){i();return}if(de&&ne===Oe)return;const ve=await je(Oe);if(ve){if(ve.displayAsVideo&&ve.videoUrl)l("PlayMediaScreenVideo",{mediaScreenId:Oe,videoUrl:ve.videoUrl});else if(ve.imageUrl){const xe=q9e(ve.imageUrl);ce(xe,ve.mediaType||"image")}}},[w,i,de,ne,je,l,ce]);O.useEffect(()=>{if(!M||!n)return;const Oe=async()=>{try{const ve=await X3(n),xe={};ve.forEach(Ge=>{Ge.id&&Ge.imageUrl&&(xe[Ge.id]=Ge.imageUrl)}),v(Ge=>Ge.map(Ze=>({...Ze,hasImage:!!xe[Ze.mediaScreenId],imageUrl:xe[Ze.mediaScreenId],mediaType:Ze.mediaType||"image"})))}catch(ve){console.error("Error fetching media screen images:",ve)}};if(Oe(),w){const ve=setInterval(Oe,K9e);return()=>clearInterval(ve)}},[n,w,M,v]);const we=O.useCallback(Oe=>{const{mediaScreenId:ve,type:xe,imageUrl:Ge,mediaType:Ze}=Oe;xe==="upload"?U(ve,{hasImage:!0,imageUrl:Ge,mediaType:Ze||"image"}):xe==="delete"&&setTimeout(()=>{v(lt=>lt.filter(vt=>vt.mediaScreenId!==ve))},100)},[U,v]);O.useEffect(()=>{const Oe=ve=>{const xe=ve.detail.enabled;C(xe),l("SetMediaScreenEditMode",{enabled:xe,showUploadIcon:xe})};return window.addEventListener("editModeChanged",Oe),()=>window.removeEventListener("editModeChanged",Oe)},[l,C]),O.useEffect(()=>(window.JsSendMediaScreenClick=Oe=>{try{const ve=JSON.parse(Oe);window.dispatchEvent(new CustomEvent("MediaScreenClick",{detail:JSON.stringify(ve)}))}catch(ve){console.error("Error processing MediaScreenClick data:",ve)}},window.handleMediaScreenClick=Oe=>{Te(Oe)},window.TestJavaScriptFromUnity=Oe=>{console.log("Unity called JavaScript:",Oe)},()=>{delete window.JsSendMediaScreenClick,delete window.handleMediaScreenClick,delete window.TestJavaScriptFromUnity}),[Te]),O.useEffect(()=>{const Oe=Ze=>{try{const lt=JSON.parse(Ze.detail);U(lt.mediaScreenId,{...lt,source:"event"}),w&&l("SetMediaScreenEditMode",{mediaScreenId:lt.mediaScreenId,enabled:!0,showUploadIcon:!0}),n&&lt.mediaScreenId&&aE(n,lt.mediaScreenId).then(vt=>{vt!=null&&vt.displayAsVideo&&(vt!=null&&vt.videoUrl)&&l("SetMediaScreenImage",{mediaScreenId:lt.mediaScreenId,imageUrl:null,displayAsVideo:!0})}).catch(vt=>console.error("Error fetching media screen data:",vt))}catch(lt){console.error("Error handling MediaScreen registration:",lt)}},ve=Ze=>{try{let lt;typeof Ze=="string"?lt=Ze:lt=JSON.parse(Ze.detail).mediaScreenId,Te(lt)}catch(lt){console.error("Error handling MediaScreen click:",lt)}},Ge=[["RegisterMediaScreen",Oe],["MediaScreenClick",ve],["reactUnityEvent",Ze=>{const{eventName:lt,eventData:vt}=Ze.detail||{};switch(lt){case"RegisterMediaScreen":Oe({detail:vt});break;case"MediaScreenClick":ve({detail:vt});break;case"SetMediaScreenImage":try{const nt=JSON.parse(vt);nt.mediaScreenId&&U(nt.mediaScreenId,{imageUrl:nt.imageUrl,hasImage:!!nt.imageUrl,displayAsVideo:nt.displayAsVideo||!1,source:"set-media-screen-image"})}catch(nt){console.error("Error handling SetMediaScreenImage event:",nt)}break}}]];return Ge.forEach(([Ze,lt])=>window.addEventListener(Ze,lt)),()=>{Ge.forEach(([Ze,lt])=>window.removeEventListener(Ze,lt))}},[w,l,n,U,Te]),O.useEffect(()=>{X&&(ke(),y(ro.REACT.VIDEO_CLICK,{mediaScreenId:ne,videoUrl:X,videoTitle:Q,source:"media_screen_controller",trigger:"video_modal_open"}))},[X,ke,y,ne,Q]);const Ie=O.useCallback(()=>{he(),De()},[he,De]);return O.useEffect(()=>{const ve=p("RegisterMediaScreen",Ge=>{Ge!=null&&Ge.mediaScreenId&&(U(Ge.mediaScreenId,{...Ge,source:"direct-event"}),w&&l("SetMediaScreenEditMode",{mediaScreenId:Ge.mediaScreenId,enabled:!0,showUploadIcon:!0}))}),xe=p("MediaScreenClick",Ge=>{Ge!=null&&Ge.mediaScreenId&&Te(Ge.mediaScreenId)});return()=>{ve(),xe()}},[p,w,l,U,Te]),O.useEffect(()=>{w&&ne&&(N(ne),i(),he())},[w,ne,i,he,N]),S.jsxs(S.Fragment,{children:[S.jsx(z9e,{isOpen:e,onClose:o,mediaScreenId:R,onImageChange:we}),S.jsx(X9e,{}),S.jsx(Nc,{containerRef:u,children:S.jsxs(ls,{isOpen:J,onClose:ae,size:"lg",isCentered:!0,portalProps:{containerRef:u},id:"image-viewer-modal",blockScrollOnMount:!0,children:[S.jsx(ds,{bg:"rgba(0, 0, 0, 0.8)",onClick:H,onMouseMove:H,onMouseDown:H,onMouseUp:H,onWheel:H}),S.jsxs(us,{ref:pe,bg:"gray.900",color:"white",borderRadius:"lg",overflow:"hidden",maxWidth:"80vw",maxHeight:"80vh",display:"flex",justifyContent:"center",alignItems:"center",position:"relative",zIndex:"10000",className:"image-viewer-modal-content",onClick:H,onMouseMove:H,onMouseDown:H,onMouseUp:H,onWheel:H,children:[S.jsx(Is,{size:"lg",bg:"gray.700",color:"white",borderRadius:"full",zIndex:"modal",_hover:{bg:"gray.600"},_focus:{boxShadow:"none"},position:"absolute",top:"10px",right:"10px"}),S.jsx(gs,{p:0,width:"100%",onClick:H,onMouseMove:H,onMouseDown:H,onMouseUp:H,onWheel:H,children:q?S.jsx(ct,{position:"relative",width:"100%",height:"100%",display:"flex",justifyContent:"center",alignItems:"center",onClick:H,onMouseMove:H,onMouseDown:H,onMouseUp:H,onWheel:H,children:re==="image"?S.jsx(yp,{src:q,maxWidth:"100%",maxHeight:"80vh",objectFit:"contain",alt:"Media Screen Image",onLoad:()=>console.log("Image loaded successfully:",q),onError:Oe=>console.error("Error loading image:",Oe,q),onClick:H}):S.jsxs(ct,{width:"100%",textAlign:"center",onClick:H,onMouseMove:H,onMouseDown:H,onMouseUp:H,onWheel:H,children:[S.jsx(Ye,{mb:4,fontSize:"lg",children:"Video URL:"}),S.jsx(Ye,{p:3,bg:"gray.800",borderRadius:"md",fontSize:"sm",wordBreak:"break-all",maxWidth:"100%",children:q}),S.jsx(Ye,{mt:4,fontSize:"sm",color:"gray.400",children:"Video playback will be implemented in a future update"})]})}):S.jsx(Ur,{direction:"column",align:"center",justify:"center",h:"400px",onClick:H,onMouseMove:H,onMouseDown:H,onMouseUp:H,onWheel:H,children:S.jsx(Ye,{children:"No image available"})})})]})]})}),S.jsx($9e,{videoUrl:X,videoTitle:Q,mediaScreenId:ne,isOpen:de,onClose:Ie})]})},Qae=({backgroundUrl:n=null,videoBackgroundUrl:e=null,containerRef:i})=>{const[o,l]=O.useState(!1),[u,p]=O.useState(n),[y,v]=O.useState(e),w=O.useRef(null),C=O.useRef(null),R=O.useRef(null),N=O.useRef(!1),M=O.useRef(!1);O.useEffect(()=>{if(!(N.current||M.current)){if(M.current=!0,console.log(` PersistentBackground: Initializing with props - videoUrl: ${e}, imageUrl: ${n}`),e){console.log(` PersistentBackground: Using provided video URL: ${e}`),U(e),N.current=!0;return}if(n){console.log(` PersistentBackground: No video available, using image: ${n}`),z(n),N.current=!0;return}L()}},[n,e]),O.useEffect(()=>{const re=ce=>{const{videoBackgroundUrl:ae}=ce.detail;console.log(` PersistentBackground: Received video background update event: ${ae}`),ae&&!N.current&&(U(ae),N.current=!0)};return window.addEventListener("SpaceVideoBackgroundUpdated",re),()=>{window.removeEventListener("SpaceVideoBackgroundUpdated",re)}},[]);const L=()=>{const ce=window.location.pathname.match(/\/space\/([^\/]+)/);if(!ce||!ce[1]){console.warn(" PersistentBackground: Couldn't extract space ID from URL");return}const ae=ce[1];console.log(` PersistentBackground: Found space ID: ${ae}`),sd(ae).then(pe=>{if(console.log(` PersistentBackground: Retrieved space data for ${ae}:`,pe?"success":"null"),pe&&pe.videoBackgroundUrl)console.log(` PersistentBackground: VIDEO FOUND: ${pe.videoBackgroundUrl}`),U(pe.videoBackgroundUrl),N.current=!0;else if(pe&&(pe.backgroundUrl||pe.backgroundGsUrl)){const H=pe.backgroundUrl||pe.backgroundGsUrl;console.log(` PersistentBackground: No video available, using image backdrop: ${H}`),z(H),N.current=!0}}).catch(pe=>{console.error(" PersistentBackground: Error fetching space data:",pe)})},U=re=>{if(!i||!i.current)return;console.log(` PersistentBackground: Setting up video background: ${re}`),q();const ce=document.createElement("video");R.current=ce,ce.autoplay=!0,ce.loop=!0,ce.muted=!0,ce.playsInline=!0,ce.setAttribute("playsinline",""),ce.setAttribute("webkit-playsinline",""),ce.setAttribute("preload","auto"),ce.src=re,Object.assign(ce.style,{position:"absolute",top:"0",left:"0",width:"100%",height:"100%",objectFit:"cover",zIndex:"20",transition:"opacity 1.5s ease-in-out",pointerEvents:"none"}),i.current.appendChild(ce),J(),ce.load();try{ce.play().then(()=>console.log(" VIDEO PLAYING SUCCESSFULLY")).catch(ae=>{console.warn(" First video play attempt failed:",ae);const pe=()=>{ce.play().then(()=>console.log(" Video started after user interaction")).catch(H=>console.error(" Video still failed to play:",H))};window.addEventListener("click",pe,{once:!0}),window.addEventListener("touchstart",pe,{once:!0}),setTimeout(()=>{ce.play().then(()=>console.log(" Video started after timeout")).catch(H=>console.error(" Video still failed to play after timeout:",H))},1e3)})}catch(ae){console.error(" Error attempting to play video:",ae)}},z=re=>{if(!i||!i.current||!re)return;console.log(` PersistentBackground: Setting up image background: ${re}`);const ce=document.createElement("div");w.current=ce,Object.assign(ce.style,{position:"absolute",top:"0",left:"0",width:"100%",height:"100%",backgroundImage:`url('${re}')`,backgroundSize:"cover",backgroundPosition:"center",backgroundRepeat:"no-repeat",zIndex:"19",transition:"opacity 1.5s ease-in-out",pointerEvents:"none"}),i.current.appendChild(ce),J()},J=()=>{if(!i||!i.current)return;const re=document.createElement("div");C.current=re,Object.assign(re.style,{position:"absolute",top:"0",left:"0",width:"100%",height:"100%",backdropFilter:"blur(5px)",WebkitBackdropFilter:"blur(5px)",backgroundColor:"rgba(255, 255, 255, 0.08)",zIndex:"21",transition:"opacity 1.5s ease-in-out",pointerEvents:"none"}),i.current.appendChild(re)},q=()=>{!i||!i.current||(w.current&&i.current.contains(w.current)&&(i.current.removeChild(w.current),w.current=null),R.current&&i.current.contains(R.current)&&(R.current.pause(),R.current.src="",R.current.load(),i.current.removeChild(R.current),R.current=null),C.current&&i.current.contains(C.current)&&(i.current.removeChild(C.current),C.current=null))};return O.useEffect(()=>{if(!i||!i.current)return;const re=()=>{console.log(" PersistentBackground: Player instantiated, removing background"),l(!0),w.current&&(w.current.style.opacity="0"),R.current&&(R.current.style.opacity="0"),C.current&&(C.current.style.opacity="0"),setTimeout(()=>{q()},1500)};if(window.isPlayerInstantiated){console.log(" PersistentBackground: Player was already instantiated"),re();return}lh.subscribe(ch.playerInstantiated,re),window.addEventListener("PlayerInstantiated",re);const ce=setTimeout(()=>{console.log(" PersistentBackground: Timeout reached, removing background"),re()},3e4);return()=>{lh.unsubscribe(ch.playerInstantiated,re),window.removeEventListener("PlayerInstantiated",re),clearTimeout(ce),q()}},[i]),null};Qae.propTypes={backgroundUrl:Tn.string,videoBackgroundUrl:Tn.string,containerRef:Tn.shape({current:Tn.instanceOf(Element)})};const SZ="https://www.spacesmetaverse.com/assets/images/SpacesLogo_Loader.png",Zae=({containerRef:n})=>{const{spaceID:e}=So(),{isUserBannedFromSpace:i}=O.useContext(Zi),[o,l]=O.useState(!1),[u,p]=O.useState(!1),[y,v]=O.useState(!1),[w,C]=O.useState(0),[R,N]=O.useState("Initialising World"),[M,L]=O.useState(null),U=O.useRef(null),z=O.useRef(null),J=O.useRef(null),q=O.useRef(null),re=O.useRef(null),ce=O.useRef(null);O.useEffect(()=>(K.log("PersistentLoader: Component mounted with spaceID:",e),K.log("PersistentLoader: Container ref:",n),()=>{K.log("PersistentLoader: Component unmounting")}),[]);const{error:ae}=So(),[pe,H]=O.useState(!1);return O.useEffect(()=>{ae&&(K.error("PersistentLoader: Unity error detected:",ae),H(!0),setTimeout(()=>{if(U.current){const X=U.current.querySelector("div:first-child");X&&(X.textContent="Reconnecting...")}},3e3))},[ae]),O.useEffect(()=>{(async()=>{if(e){K.log(`PersistentLoader: Fetching logo for space ${e}`);try{const Q=await sd(e);Q&&Q.logoUrl?(K.log(`PersistentLoader: Found logo URL: ${Q.logoUrl}`),L(Q.logoUrl)):K.log(`PersistentLoader: No logo URL found for space ${e}`)}catch(Q){K.error("PersistentLoader: Error fetching space logo:",Q)}}else K.warn("PersistentLoader: No spaceID provided, cannot fetch logo")})()},[e]),O.useEffect(()=>{const X=Q=>{const{logoUrl:ne}=Q.detail;K.log(`PersistentLoader: Logo update event received with URL: ${ne}`),L(ne),z.current?ne?(K.log("PersistentLoader: Updating logo element with new URL"),z.current.src=ne,J.current.style.display="flex"):(K.log("PersistentLoader: Hiding logo element (no URL)"),J.current.style.display="none"):K.warn("PersistentLoader: Logo ref is null during update")};return K.log("PersistentLoader: Adding SpaceLogoUpdated event listener"),window.addEventListener("SpaceLogoUpdated",X),()=>{K.log("PersistentLoader: Removing SpaceLogoUpdated event listener"),window.removeEventListener("SpaceLogoUpdated",X)}},[]),O.useEffect(()=>{(async()=>{if(e&&i)try{await i(e)&&(K.warn(`PersistentLoader: user banned from space ${e}`),l(!0))}catch(Q){K.error("PersistentLoader: error checking ban status",Q)}})()},[e,i]),O.useEffect(()=>{if(!n||!n.current){K.error("PersistentLoader: Container ref missing");return}if(o){const Oe=document.createElement("div");return Object.assign(Oe.style,{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",color:"red",background:"rgba(0,0,0,0.7)",padding:"20px",borderRadius:"8px",zIndex:"100",fontSize:"18px",fontWeight:"bold",textAlign:"center"}),Oe.textContent="Access Denied: You have been banned from this space.",n.current.appendChild(Oe),()=>{n.current.removeChild(Oe)}}K.log("PersistentLoader: Creating loader elements");const X=document.createElement("div");if(U.current=X,Object.assign(X.style,{position:"absolute",top:"60%",left:"50%",transform:"translate(-50%, -50%)",width:"300px",padding:"16px",display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"center",zIndex:"50",transition:"opacity 0.8s ease-in-out",pointerEvents:"none",color:"white",fontFamily:"Arial, sans-serif",backgroundColor:"rgba(0, 0, 0, 0.4)",backdropFilter:"blur(10px)",WebkitBackdropFilter:"blur(10px)",borderRadius:"12px",boxShadow:"0 0 20px rgba(0, 0, 0, 0.3), inset 0 0 1px rgba(255, 255, 255, 0.3)",border:"1px solid rgba(255, 255, 255, 0.1)",opacity:"0"}),M){K.log(`PersistentLoader: Creating logo element with URL: ${M}`);const Oe=document.createElement("div");J.current=Oe,Object.assign(Oe.style,{position:"absolute",top:"37.5%",left:"50%",transform:"translate(-50%, -50%)",display:"flex",justifyContent:"center",alignItems:"center",zIndex:"50",transition:"opacity 0.8s ease-in-out",pointerEvents:"none",padding:"8px",width:"280px",opacity:"0"});const ve=document.createElement("img");z.current=ve,ve.src=M,ve.alt="Space Logo",ve.style.maxHeight="100px",ve.style.maxWidth="100%",ve.style.objectFit="contain",ve.style.filter="drop-shadow(0 0 8px rgba(0, 0, 0, 0.7))",Oe.appendChild(ve),n.current.appendChild(Oe),K.log("PersistentLoader: Logo container added to main container")}else K.log("PersistentLoader: No logo URL available, skipping logo creation");const Q=document.createElement("style");Q.textContent=`
      @keyframes progress-glow {
        0% { background-position: 0% 50%; }
        50% { background-position: 100% 50%; }
        100% { background-position: 0% 50%; }
      }
    `,document.head.appendChild(Q),K.log("PersistentLoader: Animation styles added to document head");const ne=document.createElement("div");ne.style.fontSize="16px",ne.style.fontWeight="bold",ne.style.textAlign="center",ne.style.marginBottom="16px",ne.style.color="#ffffff",ne.textContent="Initialising World";const he=document.createElement("div");he.style.width="240px",he.style.height="100px",he.style.position="relative",he.style.marginBottom="15px",he.style.padding="0px",he.style.overflow="hidden",he.style.boxSizing="border-box",he.style.transition="opacity 0.8s ease-in-out",he.style.opacity="0";const fe=document.createElement("div");fe.style.width="100%",fe.style.height="100%",fe.style.position="absolute",fe.style.top="0",fe.style.left="0",fe.style.maskImage=`url(${SZ})`,fe.style.maskSize="contain",fe.style.maskPosition="center",fe.style.maskRepeat="no-repeat",fe.style.webkitMaskImage=`url(${SZ})`,fe.style.webkitMaskSize="contain",fe.style.webkitMaskPosition="center",fe.style.webkitMaskRepeat="no-repeat",fe.style.background="linear-gradient(to right, #4facfe 0%, #00f2fe 15%, white 15%, white 100%)",fe.style.backgroundSize="100% 100%",fe.style.transition="background 0.5s ease-out",q.current=fe,re.current=null,he.appendChild(fe);const de=document.createElement("div");de.style.marginTop="8px",de.style.fontSize="14px",de.style.fontWeight="bold",de.style.color="#ffffff",de.textContent="0%",X.appendChild(ne),X.appendChild(he),X.appendChild(de),n.current.appendChild(X),K.log("PersistentLoader: Loader element added to container"),setTimeout(()=>{J.current&&(J.current.style.opacity="1"),X.style.opacity="1",he.style.opacity="1"},500);const ke=Oe=>{C(Oe);const ve=Math.round(Oe*100),xe=`linear-gradient(to right, #4facfe 0%, #00f2fe ${ve}%, white ${ve}%, white 100%)`;fe.style.background=xe,de.textContent=`${ve}%`,K.log(`PersistentLoader: Progress updated to ${ve}%`)},De=Oe=>{N(Oe),ne.textContent=Oe,K.log(`PersistentLoader: Loading stage updated to "${Oe}"`)},je=[{stage:"Initialising World",progress:.33},{stage:"Loading Assets",progress:.66},{stage:"Loading User",progress:1}];pe&&(je[0].stage="Connecting to Space",je[1].stage="Reconnecting...",je[2].stage="Please Wait"),De(je[0].stage),ke(.25);const Te=Oe=>{const ve=Oe.detail.progress;K.log(`PersistentLoader: Progress event received with value: ${ve}`),ke(ve),ve<.33?De(je[0].stage):ve<.66?De(je[1].stage):De(je[2].stage)},we=()=>{K.log("PersistentLoader: First scene loaded event received"),p(!0),De(je[1].stage),ke(.66)},Ie=()=>{if(K.log("PersistentLoader: Player instantiated event received"),ce.current&&(clearInterval(ce.current),K.log("PersistentLoader: Progress interval cleared")),v(!0),De(je[2].stage),ke(1),pe){K.log("PersistentLoader: Keeping loader visible due to Unity error");return}X.style.transition="all 0.5s ease-in-out",he.style.transition="opacity 1.2s ease-in-out",ne.style.transition="opacity 0.4s ease-in-out",de.style.transition="opacity 0.4s ease-in-out",J.current&&(J.current.style.transition="opacity 0.5s ease-in-out"),X.style.backgroundColor="rgba(0, 0, 0, 0)",X.style.backdropFilter="blur(0px)",X.style.WebkitBackdropFilter="blur(0px)",X.style.boxShadow="0 0 0 rgba(0, 0, 0, 0)",X.style.border="1px solid rgba(255, 255, 255, 0)",ne.style.opacity="0",de.style.opacity="0",J.current&&(J.current.style.opacity="0"),setTimeout(()=>{he.style.opacity="0",setTimeout(()=>{n.current&&n.current.contains(X)?(n.current.removeChild(X),K.log("PersistentLoader: Loader element removed after fade")):K.warn("PersistentLoader: Could not remove loader element (not found in container)"),J.current&&n.current&&n.current.contains(J.current)?(n.current.removeChild(J.current),K.log("PersistentLoader: Logo container removed after fade")):J.current&&K.warn("PersistentLoader: Could not remove logo container (not found in container)")},1300)},400)};if(window.isPlayerInstantiated)K.log("PersistentLoader: Player was already instantiated"),Ie();else{K.log("PersistentLoader: Subscribing to playerInstantiated event"),lh.subscribe(ch.playerInstantiated,Ie);const Oe=()=>Ie();K.log("PersistentLoader: Adding PlayerInstantiated event listener"),window.addEventListener("PlayerInstantiated",Oe),K.log("PersistentLoader: Adding firstSceneLoaded event listener"),lh.subscribe(ch.firstSceneLoaded,we),K.log("PersistentLoader: Adding UnityProgress event listener"),window.addEventListener("UnityProgress",Te),ce.current=setInterval(()=>{y||C(xe=>{const Ge=Math.min(xe+.02,.95);return ke(Ge),Ge<.33&&R!==je[0].stage?De(je[0].stage):Ge>=.33&&Ge<.66&&R!==je[1].stage?De(je[1].stage):Ge>=.66&&R!==je[2].stage&&De(je[2].stage),Ge})},300);const ve=setTimeout(()=>{K.log("PersistentLoader: Forcing loader removal after timeout"),Ie()},6e4);return()=>{K.log("PersistentLoader: Cleaning up event listeners"),lh.unsubscribe(ch.playerInstantiated,Ie),window.removeEventListener("PlayerInstantiated",Oe),lh.unsubscribe(ch.firstSceneLoaded,we),window.removeEventListener("UnityProgress",Te),clearInterval(ce.current),clearTimeout(ve),n.current&&n.current.contains(X)&&(n.current.removeChild(X),K.log("PersistentLoader: Loader element removed during cleanup")),J.current&&n.current&&n.current.contains(J.current)&&(n.current.removeChild(J.current),K.log("PersistentLoader: Logo container removed during cleanup"))}}},[M,n]),null};Zae.propTypes={containerRef:Tn.shape({current:Tn.instanceOf(Element)})};const Z9e=({size:n="md",tooltipPlacement:e="top",className:i="livestream-button"})=>{const[o,l]=O.useState(!1),[u,p]=O.useState(!1),{savedStreamData:y,reloadStreamData:v}=kae(),{spaceID:w}=So(),{user:C}=O.useContext(Zi),R=Da(),[N,M]=O.useState(!1),L=_q((y==null?void 0:y.rtmpUrl)||""),U=_q((y==null?void 0:y.streamKey)||"");O.useEffect(()=>{if(w){K.log("LiveStreamButton: Forcing reload of stream data"),v();const q=()=>{K.log("LiveStreamButton: Stream settings changed, reloading data"),v()};return window.addEventListener("StreamSettingsChanged",q),()=>{window.removeEventListener("StreamSettingsChanged",q)}}},[w,v]),O.useEffect(()=>{(async()=>{if(!(C!=null&&C.uid)||!w){M(!1);return}try{const re=await B6e(C.uid,"disruptiveAdmin"),ce=await $6e(C,w);M(re||ce)}catch(re){K.error("Error checking user permissions:",re),M(!1)}})()},[C==null?void 0:C.uid,w]),O.useEffect(()=>{K.log("LiveStreamButton: Current streaming data:",{enabled:y==null?void 0:y.enabled,hasRtmpUrl:!!(y!=null&&y.rtmpUrl),hasStreamKey:!!(y!=null&&y.streamKey),hasPermission:N,isPlayerReady:u})},[y,N,u]),O.useEffect(()=>{const q=()=>{K.log("LiveStreamButton: Player instantiated, showing button"),p(!0)};return window.addEventListener("PlayerInstantiated",q),window.isPlayerInstantiated&&(K.log("LiveStreamButton: Player was already instantiated"),p(!0)),()=>{window.removeEventListener("PlayerInstantiated",q)}},[]);const z=()=>{window.dispatchEvent(new Event("modal-opened")),l(!0)},J=()=>{window.dispatchEvent(new Event("modal-closed")),l(!1)};return!u||!N||(y==null?void 0:y.enabled)!==!0?(K.log("LiveStreamButton: Not rendering button because:",{playerNotReady:!u,noPermission:!N,streamingDisabled:(y==null?void 0:y.enabled)!==!0,enabledValue:y==null?void 0:y.enabled}),null):S.jsxs(S.Fragment,{children:[S.jsx(Uf,{label:"Live Stream Info",placement:e,hasArrow:!0,children:S.jsx(ml,{size:n,borderRadius:"full",bg:"black",icon:S.jsx(QWe,{color:"white"}),borderWidth:"1px",borderColor:"whiteAlpha.300",className:i,"data-testid":"livestream-button",cursor:"pointer",onClick:z})}),S.jsxs(ls,{isOpen:o,onClose:J,isCentered:!0,size:"md",children:[S.jsx(ds,{backdropFilter:"blur(4px)"}),S.jsxs(us,{bg:"rgba(23, 25, 35, 0.95)",color:"white",borderRadius:"md",boxShadow:"0 4px 20px rgba(0, 0, 0, 0.5)",children:[S.jsx(co,{borderBottom:"1px solid",borderColor:"whiteAlpha.200",py:2,fontSize:"md",fontWeight:"600",children:"Live Stream Info"}),S.jsx(Is,{size:"sm",color:"whiteAlpha.700",_hover:{color:"white",bg:"whiteAlpha.100"}}),S.jsx(gs,{p:4,children:y!=null&&y.rtmpUrl&&(y!=null&&y.streamKey)?S.jsxs(ct,{children:[S.jsx(Ye,{fontSize:"sm",mb:4,color:"white",children:"Copy these details to your streaming software (OBS, Streamlabs, etc.)"}),S.jsxs(ct,{mb:4,children:[S.jsx(Ye,{fontSize:"xs",fontWeight:"600",mb:1,color:"white",children:"RTMP URL"}),S.jsx(Ur,{children:S.jsxs(Pg,{size:"sm",children:[S.jsx(li,{value:y.rtmpUrl,isReadOnly:!0,bg:"whiteAlpha.100",borderColor:"whiteAlpha.200",_hover:{borderColor:"whiteAlpha.300"},pr:"2.5rem",color:"white"}),S.jsx(hO,{children:S.jsx(Pc,{"aria-label":"Copy RTMP URL",icon:L.hasCopied?S.jsx(hZ,{}):S.jsx(pZ,{}),size:"xs",colorScheme:L.hasCopied?"green":"blue",onClick:()=>{L.onCopy(),R({title:"RTMP URL copied",status:"success",duration:2e3,isClosable:!0,position:"top"})}})})]})})]}),S.jsxs(ct,{mb:4,children:[S.jsx(Ye,{fontSize:"xs",fontWeight:"600",mb:1,color:"white",children:"Stream Key"}),S.jsx(Ur,{children:S.jsxs(Pg,{size:"sm",children:[S.jsx(li,{value:y.streamKey,isReadOnly:!0,bg:"whiteAlpha.100",borderColor:"whiteAlpha.200",_hover:{borderColor:"whiteAlpha.300"},pr:"2.5rem",type:"password",color:"white"}),S.jsx(hO,{children:S.jsx(Pc,{"aria-label":"Copy Stream Key",icon:U.hasCopied?S.jsx(hZ,{}):S.jsx(pZ,{}),size:"xs",colorScheme:U.hasCopied?"green":"blue",onClick:()=>{U.onCopy(),R({title:"Stream Key copied",status:"success",duration:2e3,isClosable:!0,position:"top"})}})})]})})]}),S.jsx(Ye,{fontSize:"xs",color:"whiteAlpha.800",mt:4,children:"Stream to this RTMP server using the Stream Key above. View and manage stream settings in the Space Manager."})]}):S.jsxs(ct,{textAlign:"center",p:4,children:[S.jsx(Ye,{color:"white",children:"No stream configuration found for this space."}),S.jsx(Ye,{fontSize:"xs",mt:2,color:"whiteAlpha.800",children:"Configure streaming in the Space Manager under Stream tab."})]})})]})]})]})};function eGe(n,e,i){const o=O.useRef();O.useEffect(()=>(o.current&&clearTimeout(o.current),o.current=setTimeout(n,e),()=>clearTimeout(o.current)),i)}const tGe=({isOpen:n,onClose:e,portal:i,spaceId:o,style:l})=>{if(!n||!i)return null;const[u,p]=O.useState({x:0,y:1.5,z:0}),[y,v]=O.useState({x:0,y:0,z:0}),[w,C]=O.useState({x:1,y:1,z:1}),R=lc(),N=Da();O.useEffect(()=>{i&&(p(i.position||{x:0,y:1.5,z:0}),v(i.rotation||{x:0,y:0,z:0}),C(i.scale||{x:1,y:1,z:1}))},[i]),O.useEffect(()=>{R("UpdatePortalTransform",{portalId:i.portalId,position:u,rotation:y,scale:w})},[u,y,w,i.portalId,R]),eGe(()=>{const L={...i,position:u,rotation:y,scale:w};yZ(o,i.portalId,L)},300,[u,y,w,o,i.portalId]);const M=async()=>{try{if(R("DeletePortal",{portalId:i.portalId}),await yZ(o,i.portalId,null))N({title:"Portal Deleted",description:"The portal has been removed.",status:"success",duration:3e3,isClosable:!0}),e();else throw new Error("Failed to delete portal from Firebase")}catch{N({title:"Delete Error",description:"Failed to delete portal. Please try again.",status:"error",duration:5e3,isClosable:!0})}};return S.jsxs(ct,{position:"absolute",top:"72px",right:"24px",zIndex:2e3,minW:"340px",maxW:"360px",bg:"rgba(255,255,255,0.15)",boxShadow:"0 8px 32px 0 rgba(31, 38, 135, 0.18)",borderRadius:"2xl",p:6,border:"1px solid rgba(255,255,255,0.2)",style:{backdropFilter:"blur(18px)",WebkitBackdropFilter:"blur(18px)",...l},color:"gray.900",children:[S.jsx(ct,{fontWeight:"bold",fontSize:"lg",mb:2,children:"Edit Portal"}),S.jsxs(Ir,{spacing:4,align:"stretch",children:[S.jsxs(br,{children:[S.jsx(gi,{children:"Position"}),S.jsxs(Qn,{children:[S.jsxs(xo,{value:u.x,onChange:(L,U)=>p(z=>({...z,x:U})),step:.1,precision:2,children:[S.jsx(Mo,{placeholder:"X"}),S.jsxs(Lo,{children:[S.jsx(Vo,{}),S.jsx(Uo,{})]})]}),S.jsxs(xo,{value:u.y,onChange:(L,U)=>p(z=>({...z,y:U})),step:.1,precision:2,children:[S.jsx(Mo,{placeholder:"Y"}),S.jsxs(Lo,{children:[S.jsx(Vo,{}),S.jsx(Uo,{})]})]}),S.jsxs(xo,{value:u.z,onChange:(L,U)=>p(z=>({...z,z:U})),step:.1,precision:2,children:[S.jsx(Mo,{placeholder:"Z"}),S.jsxs(Lo,{children:[S.jsx(Vo,{}),S.jsx(Uo,{})]})]})]})]}),S.jsxs(br,{children:[S.jsx(gi,{children:"Rotation"}),S.jsxs(Qn,{children:[S.jsxs(xo,{value:y.x,onChange:(L,U)=>v(z=>({...z,x:U})),step:1,children:[S.jsx(Mo,{placeholder:"X"}),S.jsxs(Lo,{children:[S.jsx(Vo,{}),S.jsx(Uo,{})]})]}),S.jsxs(xo,{value:y.y,onChange:(L,U)=>v(z=>({...z,y:U})),step:1,children:[S.jsx(Mo,{placeholder:"Y"}),S.jsxs(Lo,{children:[S.jsx(Vo,{}),S.jsx(Uo,{})]})]}),S.jsxs(xo,{value:y.z,onChange:(L,U)=>v(z=>({...z,z:U})),step:1,children:[S.jsx(Mo,{placeholder:"Z"}),S.jsxs(Lo,{children:[S.jsx(Vo,{}),S.jsx(Uo,{})]})]})]})]}),S.jsxs(br,{children:[S.jsx(gi,{children:"Scale"}),S.jsxs(Qn,{children:[S.jsxs(xo,{value:w.x,onChange:(L,U)=>C(z=>({...z,x:U})),step:.1,precision:2,min:.1,children:[S.jsx(Mo,{placeholder:"X"}),S.jsxs(Lo,{children:[S.jsx(Vo,{}),S.jsx(Uo,{})]})]}),S.jsxs(xo,{value:w.y,onChange:(L,U)=>C(z=>({...z,y:U})),step:.1,precision:2,min:.1,children:[S.jsx(Mo,{placeholder:"Y"}),S.jsxs(Lo,{children:[S.jsx(Vo,{}),S.jsx(Uo,{})]})]}),S.jsxs(xo,{value:w.z,onChange:(L,U)=>C(z=>({...z,z:U})),step:.1,precision:2,min:.1,children:[S.jsx(Mo,{placeholder:"Z"}),S.jsxs(Lo,{children:[S.jsx(Vo,{}),S.jsx(Uo,{})]})]})]})]}),S.jsx(Qn,{spacing:4,width:"100%",justify:"flex-end",children:S.jsx(Nn,{colorScheme:"red",onClick:M,variant:"outline",children:"Delete Portal"})}),S.jsx(Nn,{mt:2,variant:"ghost",colorScheme:"whiteAlpha",onClick:e,children:"Close"})]})]})},nGe=n=>{if(!n)return null;try{if(n.includes("firebasestorage.googleapis.com")){const e=new URL(n),i=e.searchParams.get("alt"),o=e.searchParams.get("token");return e.search="",i&&e.searchParams.set("alt",i),o&&e.searchParams.set("token",o),console.log(`Cleaned Firebase URL from ${n} to ${e.toString()}`),e.toString()}return n}catch(e){return console.error("Error cleaning Firebase URL:",e),n}},rGe=()=>{const{spaceID:n}=So(),e=lc(),[i,o]=O.useState(!1);O.useEffect(()=>{if(window.isPlayerInstantiated){K.log("useUnityPortalImages: Unity already ready (via window flag)"),o(!0);return}const l=()=>{K.log("useUnityPortalImages: Unity is now ready (PlayerInstantiated event)"),o(!0)};return window.addEventListener("PlayerInstantiated",l),()=>{window.removeEventListener("PlayerInstantiated",l)}},[]),O.useEffect(()=>{if(!i){K.log("useUnityPortalImages: Waiting for Unity to be ready before loading portal images");return}K.log("useUnityPortalImages: Unity is ready, now loading portal images"),(async()=>{try{if(!n)throw new Error("spaceID is not defined.");const u=El(Yn,"spaces",n,"portals"),p=await id(u);if(p.empty){K.log("useUnityPortalImages: No portals found for space:",n);return}K.log(`useUnityPortalImages: Found ${p.size} portals for space ${n}`);for(const y of p.docs){const v=y.data(),w=v.portalId,C=v.targetSpaceId;if(!C){K.warn(`useUnityPortalImages: No target space ID found for portal: ${w}`);continue}const R=await sd(C);if(!R){K.warn(`useUnityPortalImages: No space data found for target space: ${C}`);continue}const N=R.backgroundUrl||R.backgroundGsUrl;if(!N){K.warn(`useUnityPortalImages: No background image URL found for target space: ${C}`);continue}const M=nGe(N);e("SetPortalImage",JSON.stringify({portalId:w,imageUrl:M})),K.log(`Sent portal image data to Unity for portal ${w}: ${M}`)}}catch(u){K.error("Error fetching portal images:",u)}})()},[e,n,i])},iGe=()=>(rGe(),null);function sGe(n,e,i){const o=O.useRef();O.useEffect(()=>(o.current&&clearTimeout(o.current),o.current=setTimeout(n,e),()=>clearTimeout(o.current)),i)}const oGe=({isOpen:n,onClose:e,item:i,spaceId:o,style:l})=>{if(!n||!i)return null;const[u,p]=O.useState({x:0,y:0,z:0}),[y,v]=O.useState({x:0,y:0,z:0}),[w,C]=O.useState({x:1,y:1,z:1}),R=lc(),N=Da();O.useEffect(()=>{i&&(p(i.position||{x:0,y:0,z:0}),v(i.rotation||{x:0,y:0,z:0}),C(i.scale||{x:1,y:1,z:1}))},[i]),O.useEffect(()=>{R("UpdateCatalogueItem",{hotspotId:i.hotspotId,position:u,rotation:y,scale:w})},[u,y,w,i.hotspotId,R]),sGe(()=>{const L=wr(Yn,"spaces",o,"catalogue",i.hotspotId);lo(L,{position:u,rotation:y,scale:w,updatedAt:Date.now()})},300,[u,y,w,o,i.hotspotId]);const M=async()=>{try{R("DeleteCatalogueItem",{hotspotId:i.hotspotId});const L=wr(Yn,"spaces",o,"catalogue",i.hotspotId);await lo(L,{deleted:!0}),N({title:"Item Deleted",description:"The item has been removed.",status:"success",duration:3e3,isClosable:!0}),e()}catch{N({title:"Delete Error",description:"Failed to delete item. Please try again.",status:"error",duration:5e3,isClosable:!0})}};return S.jsxs(ct,{position:"absolute",top:"72px",right:"24px",zIndex:2e3,minW:"340px",maxW:"360px",bg:"rgba(255,255,255,0.15)",boxShadow:"0 8px 32px 0 rgba(31, 38, 135, 0.18)",borderRadius:"2xl",p:6,border:"1px solid rgba(255,255,255,0.2)",style:{backdropFilter:"blur(18px)",WebkitBackdropFilter:"blur(18px)",...l},color:"gray.900",children:[S.jsx(ct,{fontWeight:"bold",fontSize:"lg",mb:2,children:"Edit Catalogue Item"}),S.jsxs(Ir,{spacing:4,align:"stretch",children:[S.jsxs(br,{children:[S.jsx(gi,{children:"Position"}),S.jsxs(Qn,{children:[S.jsxs(xo,{value:u.x,onChange:(L,U)=>p(z=>({...z,x:U})),step:.1,precision:2,children:[S.jsx(Mo,{placeholder:"X"}),S.jsxs(Lo,{children:[S.jsx(Vo,{}),S.jsx(Uo,{})]})]}),S.jsxs(xo,{value:u.y,onChange:(L,U)=>p(z=>({...z,y:U})),step:.1,precision:2,children:[S.jsx(Mo,{placeholder:"Y"}),S.jsxs(Lo,{children:[S.jsx(Vo,{}),S.jsx(Uo,{})]})]}),S.jsxs(xo,{value:u.z,onChange:(L,U)=>p(z=>({...z,z:U})),step:.1,precision:2,children:[S.jsx(Mo,{placeholder:"Z"}),S.jsxs(Lo,{children:[S.jsx(Vo,{}),S.jsx(Uo,{})]})]})]})]}),S.jsxs(br,{children:[S.jsx(gi,{children:"Rotation"}),S.jsxs(Qn,{children:[S.jsxs(xo,{value:y.x,onChange:(L,U)=>v(z=>({...z,x:U})),step:1,children:[S.jsx(Mo,{placeholder:"X"}),S.jsxs(Lo,{children:[S.jsx(Vo,{}),S.jsx(Uo,{})]})]}),S.jsxs(xo,{value:y.y,onChange:(L,U)=>v(z=>({...z,y:U})),step:1,children:[S.jsx(Mo,{placeholder:"Y"}),S.jsxs(Lo,{children:[S.jsx(Vo,{}),S.jsx(Uo,{})]})]}),S.jsxs(xo,{value:y.z,onChange:(L,U)=>v(z=>({...z,z:U})),step:1,children:[S.jsx(Mo,{placeholder:"Z"}),S.jsxs(Lo,{children:[S.jsx(Vo,{}),S.jsx(Uo,{})]})]})]})]}),S.jsxs(br,{children:[S.jsx(gi,{children:"Scale"}),S.jsxs(Qn,{children:[S.jsxs(xo,{value:w.x,onChange:(L,U)=>C(z=>({...z,x:U})),step:.1,precision:2,min:.1,children:[S.jsx(Mo,{placeholder:"X"}),S.jsxs(Lo,{children:[S.jsx(Vo,{}),S.jsx(Uo,{})]})]}),S.jsxs(xo,{value:w.y,onChange:(L,U)=>C(z=>({...z,y:U})),step:.1,precision:2,min:.1,children:[S.jsx(Mo,{placeholder:"Y"}),S.jsxs(Lo,{children:[S.jsx(Vo,{}),S.jsx(Uo,{})]})]}),S.jsxs(xo,{value:w.z,onChange:(L,U)=>C(z=>({...z,z:U})),step:.1,precision:2,min:.1,children:[S.jsx(Mo,{placeholder:"Z"}),S.jsxs(Lo,{children:[S.jsx(Vo,{}),S.jsx(Uo,{})]})]})]})]}),S.jsx(Qn,{spacing:4,width:"100%",justify:"flex-end",children:S.jsx(Nn,{colorScheme:"red",onClick:M,variant:"outline",children:"Delete Item"})}),S.jsx(Nn,{mt:2,variant:"ghost",colorScheme:"whiteAlpha",onClick:e,children:"Close"})]})]})};function aGe(){const{clickedItem:n,clearClickedItem:e}=Mae(),[i,o]=O.useState(!1);O.useEffect(()=>{const p=y=>{y!=null&&y.detail&&typeof y.detail.enabled=="boolean"&&(o(y.detail.enabled),y.detail.enabled||e())};return window.addEventListener("editModeChanged",p),()=>window.removeEventListener("editModeChanged",p)},[e]);const l=()=>{e()};let u="";if(n!=null&&n.hotspotId){const p=n.hotspotId.split("_");p.length>=3&&(u=p.slice(1,-1).join("_"))}return S.jsx(S.Fragment,{children:n&&i&&S.jsx(oGe,{isOpen:!!n&&i,onClose:l,item:n,spaceId:u})})}const cGe=(n,e={})=>{const{user:i}=O.useContext(Zi),{trackUnityEvent:o,isReady:l}=_E(n,{enableDebugLogs:e.enableDebugLogs||!1}),u=Dc();return O.useEffect(()=>{if(!l||!i)return;K.log(" Unity Analytics: Setting up event listeners");const p=u("PlayVideo",L=>{K.log(" Unity Analytics: Video play event detected",L),o(ro.UNITY.VIDEO_PLAY,{category:io.MEDIA_INTERACTION,videoId:L==null?void 0:L.gameObjectName,videoUrl:L==null?void 0:L.videoUrl,isEditMode:(L==null?void 0:L.isEditMode)||!1,timestamp:new Date().toISOString(),...L})}),y=u("PlayMediaScreenVideo",L=>{K.log(" Unity Analytics: Media screen click event detected",L),o(ro.UNITY.MEDIA_SCREEN_CLICK,{category:io.MEDIA_INTERACTION,mediaScreenId:L==null?void 0:L.mediaScreenId,videoUrl:L==null?void 0:L.videoUrl,isEditMode:(L==null?void 0:L.isEditMode)||!1,timestamp:new Date().toISOString(),...L})}),v=u("OpenNameplateModal",L=>{K.log(" Unity Analytics: Nameplate click event detected",L),o(ro.UNITY.NAMEPLATE_CLICK,{category:io.SOCIAL_INTERACTION,targetUserId:L==null?void 0:L.uid,targetPlayerName:L==null?void 0:L.playerName,targetPlayerId:L==null?void 0:L.playerId,isLocalPlayer:(L==null?void 0:L.isLocalPlayer)||!1,timestamp:new Date().toISOString(),...L})}),w=u("PlayerInstantiated",L=>{K.log(" Unity Analytics: Player spawn event detected",L),o(ro.UNITY.PLAYER_SPAWN,{category:io.SYSTEM_EVENT,timestamp:new Date().toISOString(),...L})}),C=u("FirstSceneLoaded",L=>{K.log(" Unity Analytics: First scene loaded event detected",L),o(ro.UNITY.SPACE_READY,{category:io.SYSTEM_EVENT,timestamp:new Date().toISOString(),...L})}),R=u("SeatingHotspotClicked",L=>{K.log(" Unity Analytics: Catalogue item click event detected",L),o(ro.UNITY.OBJECT_INTERACT,{category:io.CONTENT_INTERACTION,objectType:"catalogue_item",hotspotId:L==null?void 0:L.hotspotId,itemId:L==null?void 0:L.itemId,position:L==null?void 0:L.position,timestamp:new Date().toISOString(),...L})}),N=u("UpdatePlayerList",L=>{L!=null&&L.players&&Array.isArray(L.players)&&(K.log(" Unity Analytics: Player list update event detected",L),o(ro.UNITY.PLAYER_MOVE,{category:io.SOCIAL_INTERACTION,activePlayerCount:L.players.length,playerList:L.players.map(U=>({playerId:U.playerId,playerName:U.playerName,isLocalPlayer:U.isLocalPlayer})),timestamp:new Date().toISOString()}))}),M=u("RequestUserForUnity",L=>{K.log(" Unity Analytics: Unity user request event detected",L),o(ro.UNITY.SPACE_LOAD,{category:io.SYSTEM_EVENT,requestType:"user_data",timestamp:new Date().toISOString(),...L})});return()=>{K.log(" Unity Analytics: Cleaning up event listeners"),p(),y(),v(),w(),C(),R(),N(),M()}},[l,i,o,u]),{isReady:l,trackUnityEvent:o}},lGe="a2a7f4eb05284449b1063eb71d8301dc",pV=()=>document.querySelector("canvas")||document.getElementById("unity-canvas"),J3=O.forwardRef(({settings:n},e)=>{const{unityProvider:i,isLoaded:o,error:l}=So(),u=pWe();mWe();const p=lc(),y=xWe(u),{user:v}=O.useContext(Zi),[w,C]=O.useState(!1),[R,N]=O.useState(window.devicePixelRatio),[M,L]=fWe();Nae().find(ft=>ft.isLocalPlayer);const[z,J]=O.useState(!0),[q,re]=O.useState(!0),ce=n.spaceID||"default";NWe(),kWe(ce),cGe(ce,{enableDebugLogs:!0});const{trackUnityEvent:ae}=_E(ce,{enableDebugLogs:!0}),[pe,H]=O.useState(!1),[X,Q]=O.useState(!1),[ne,he]=O.useState(!1),fe=O.useMemo(()=>{const ut=new URLSearchParams(window.location.search).get("sessionId")||ce;return console.log("WebGLRenderer: Using session ID:",ut),ut},[ce]),[de,ke]=O.useState(null);O.useEffect(()=>{v!=null&&v.uid&&su(v.uid).then(ft=>{ke(ft),console.log("WebGLRenderer: User profile loaded:",(ft==null?void 0:ft.Nickname)||"Unknown")}).catch(ft=>{console.error("Error fetching user profile:",ft)})},[v==null?void 0:v.uid]),O.useEffect(()=>{if(l||!v){console.log("WebGLRenderer: User not logged in or Unity error, showing sign-in modal");const ft=setTimeout(()=>{Q(!0),he(!0)},1e3);return()=>clearTimeout(ft)}else Q(!1)},[l,v]),O.useEffect(()=>{console.log("WebGLRenderer: Setting up player instantiation listener");const ft=()=>{console.log("WebGLRenderer: Player instantiated event received"),re(!0),window.dispatchEvent(new CustomEvent("PlayerInstantiated")),window.isPlayerInstantiated=!0};window.isPlayerInstantiated&&(console.log("WebGLRenderer: Player was already instantiated from previous mount"),re(!0)),lh.subscribe(ch.playerInstantiated,ft);const Ct=setTimeout(()=>{q||(console.log("WebGLRenderer: Forcing player instantiation after timeout"),re(!0),window.isPlayerInstantiated=!0,window.dispatchEvent(new CustomEvent("PlayerInstantiated")))},5e3);return()=>{lh.unsubscribe(ch.playerInstantiated,ft),clearTimeout(Ct)}},[q]),O.useEffect(()=>{const ft=()=>{console.log("WebGLRenderer: Modal opened"),he(!0)},Ct=()=>{console.log("WebGLRenderer: Modal closed"),he(!1)};return window.addEventListener("modal-opened",ft),window.addEventListener("modal-closed",Ct),()=>{window.removeEventListener("modal-opened",ft),window.removeEventListener("modal-closed",Ct)}},[]),O.useEffect(()=>{he(M!==null)},[M]),O.useEffect(()=>{o||u?setTimeout(()=>{C(!0),console.log("WebGLRenderer: Unity is ready to receive messages.")},5e3):console.warn("WebGLRenderer: Unity is NOT ready yet.")},[o,u]),O.useEffect(()=>{o&&i&&setTimeout(()=>{if(window.unityInstance)try{console.log("WebGLRenderer: Disabling Unity keyboard capture on initialization"),window.unityInstance.SendMessage("WebGLInput","SetCaptureAllKeyboardInput",!1)}catch(ft){console.error("WebGLRenderer: Error disabling Unity keyboard capture:",ft)}},1e3)},[o,i]),O.useEffect(()=>{const ft=document.getElementById("webgl-root");return ft?(console.log("WebGLRenderer: Found webgl-root element, ensuring it is visible"),ft.style.display="block",ft.getAttribute("data-space-id")!==ce&&(ft.setAttribute("data-space-id",ce),console.log(`WebGLRenderer: Set data-space-id attribute to ${ce}`))):console.error("WebGLRenderer: Could not find webgl-root element"),()=>{}},[ce]),O.useEffect(()=>{const ft=()=>{const Ft=pV();Ft?(console.log("WebGLRenderer: Configuring Unity canvas for keyboard input"),Ft.tabIndex=1,Ft.style.outline="none",Ft.addEventListener("click",()=>{console.log("WebGLRenderer: Unity canvas clicked, enabling keyboard capture"),ne||X0(!0)}),console.log("WebGLRenderer: Unity canvas configured with tabIndex=1")):console.warn("WebGLRenderer: Could not find Unity canvas to configure")};ft();const Ct=setTimeout(ft,1e3),ut=()=>{console.log("WebGLRenderer: Received unityReady event, configuring canvas"),ft()};return window.addEventListener("unityReady",ut),()=>{clearTimeout(Ct),window.removeEventListener("unityReady",ut)}},[o,ne]);const De=O.useCallback(()=>{console.log("WebGLRenderer: Unity canvas clicked, enabling keyboard capture"),ne||X0(!0)},[ne]);O.useEffect(()=>{if(o&&i){const ft=pV();if(ft)return console.log("WebGLRenderer: Adding click handler to Unity canvas"),ft.addEventListener("click",De),()=>{ft.removeEventListener("click",De)}}},[o,i,De]),O.useEffect(()=>{if(o&&i){console.log("WebGLRenderer: Setting up global click handler for focus management");const ft=Ct=>{if(ne){console.log("WebGLRenderer: Modal is open, not refocusing Unity on click");return}if(Ct.target.tagName==="INPUT"||Ct.target.tagName==="TEXTAREA"||Ct.target.tagName==="SELECT"||Ct.target.tagName==="BUTTON"){console.log("WebGLRenderer: Clicked on form element, not refocusing Unity");return}if(Ct.target.closest(".chakra-modal__content")||Ct.target.closest('[role="dialog"]')||Ct.target.closest('[role="menu"]')||Ct.target.closest(".chakra-popover__content")||Ct.target.closest('[role="tooltip"]')){console.log("WebGLRenderer: Clicked inside modal/dialog content, not refocusing Unity");return}const ut=pV();if(ut&&(Ct.target===ut||ut.contains(Ct.target)))return;if(Ct.target.closest(".webgl-overlay")||Ct.target.closest(".game-ui")||Ct.target.closest(".player-list")||Ct.target.closest(".unity-ui-overlay")){console.log("WebGLRenderer: Clicked on UI overlay that should allow keyboard events"),setTimeout(()=>{ne||X0(!0)},50);return}console.log("WebGLRenderer: Clicked outside forms/modals/special UI, refocusing Unity canvas"),setTimeout(()=>{ut&&!ne&&((ut.tabIndex===void 0||ut.tabIndex<0)&&(ut.tabIndex=1),ut.focus(),X0(!0))},50)};return document.addEventListener("click",ft,!0),()=>{document.removeEventListener("click",ft,!0)}}},[o,i,ne]),O.useEffect(()=>{const ft=Ct=>{console.log("WebGLRenderer: Received 'sendUserToUnity' event"),p("FirebaseUserFromReact",Ct)};return lh.subscribe(ch.sendUserToUnity,ft),()=>lh.unsubscribe(ch.sendUserToUnity,ft)},[p]);const{setFullscreenRef:je,fullscreenRef:Te}=fh();O.useEffect(()=>{je(e.current)},[e,je]);const we=()=>{J(!z)},Ie=v&&n.enableVoiceChat;console.log("WebGLRenderer: Render with state:",{user:!!v,userId:v==null?void 0:v.uid,isPlayerInstantiated:q,showVoiceChat:Ie,sessionId:fe}),O.useEffect(()=>{const ft=Ct=>{console.log("Edit mode changed event:",Ct.detail),H(Ct.detail.enabled)};return window.addEventListener("editModeChanged",ft),()=>{window.removeEventListener("editModeChanged",ft)}},[]),Oae(),EWe();const Oe=O.useRef(null),{clickedPortal:ve,clearClickedPortal:xe}=OWe(),[Ge,Ze]=O.useState(!1),[lt,vt]=O.useState(!1),[nt,mt]=O.useState(""),[et,St]=O.useState("");O.useEffect(()=>{async function ft(){if(mt(""),St(""),ve&&!pe){let Ct=ve.targetSpaceId;if(!Ct&&ve.portalId)try{const ut=wr(Yn,"spaces",ce,"portals",ve.portalId),Ft=await Bo(ut);Ft.exists()&&(Ct=Ft.data().targetSpaceId)}catch{}if(Ct)try{const ut=await sd(Ct);mt((ut==null?void 0:ut.name)||Ct),St((ut==null?void 0:ut.slug)||""),vt(!0)}catch{mt(Ct),St(""),vt(!0)}else mt(""),St(""),vt(!0)}}ve&&pe&&Ze(!0),ve&&!pe&&ft()},[ve,pe,ce]);const un=()=>{console.log("Closing portal editor"),Ze(!1),xe()};return console.log("WebGLRenderer render state:",{isPortalEditorOpen:Ge,clickedPortal:ve,isEditMode:pe}),DWe(ce),Mae(),S.jsxs(ct,{className:"webgl-renderer",children:[n.urlLoadingBackground&&S.jsx(Qae,{backgroundUrl:n.urlLoadingBackground,videoBackgroundUrl:n.videoBackgroundUrl,containerRef:Oe}),!X&&S.jsx(Zae,{containerRef:Oe}),X&&S.jsx(ct,{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",zIndex:"100",width:"100%",height:"100%",display:"flex",justifyContent:"center",alignItems:"center",children:S.jsx(sD,{mode:"button",label:"Sign In",initialIsOpen:!0,buttonProps:{size:"lg",colorScheme:"blue"}})}),S.jsx(aGe,{spaceId:ce,isEditMode:pe}),S.jsx(gj,{containerRef:Te.current?Te:document.body,children:S.jsxs("div",{ref:e,style:{width:"100%",height:"100%",aspectRatio:"auto",position:"absolute"},children:[S.jsxs(ct,{position:"absolute",zIndex:"10",top:4,right:4,display:"flex",alignItems:"center",gap:2,children:[n.showAuthButton&&S.jsx(MWe,{}),v&&S.jsx(Z9e,{size:"md"}),Ie&&S.jsxs(Kae,{appId:lGe,channel:fe,uid:v==null?void 0:v.uid,enabled:!0,children:[S.jsx(p9e,{size:"md",defaultMuted:!0,joinOnClick:!0}),S.jsx(m9e,{userNickname:de==null?void 0:de.Nickname})]}),S.jsx(e9e,{}),S.jsx(ct,{position:"relative",zIndex:"9999",children:S.jsx(B9e,{onTogglePlayerList:we,spaceID:ce,containerRef:Oe})})]}),S.jsxs(ct,{ref:Oe,position:"relative",overflow:"hidden",width:"100%",height:"100%",bgRepeat:"no-repeat",bgSize:"cover",bgPosition:"center",bgColor:"#666666",children:[S.jsx(ct,{position:"absolute",top:"0",left:"0",width:"100%",height:"100%",backdropFilter:"blur(8px)",backgroundColor:"rgba(255, 255, 255, 0.1)",zIndex:"0"}),S.jsx(ct,{...y,width:"100%",height:"100%",position:"absolute",zIndex:"1",children:i?S.jsx(Pae.Unity,{unityProvider:i,style:{width:"100%",height:"100%"},devicePixelRatio:R,tabIndex:1}):S.jsx(ct,{width:"100%",height:"100%"})}),S.jsx(ct,{position:"absolute",zIndex:"6",width:"100%",height:"100%",style:{display:"none"},children:S.jsx(LWe,{})})]}),S.jsx(ct,{...y,position:"absolute",zIndex:"2",top:4,left:4,display:"flex",alignItems:"flex-start",gap:3,height:"50px",children:n.showDisruptiveLogo&&S.jsx(yp,{src:n.urlDisruptiveLogo,width:"100px",alt:"Disruptive Logo"})}),S.jsxs(ct,{...y,position:"absolute",zIndex:"2",bottom:4,right:4,display:"flex",alignItems:"flex-start",gap:3,children:[n.showHelpButton&&S.jsx(UWe,{}),S.jsx(r9e,{})]}),S.jsx(i9e,{}),S.jsx(s9e,{isOpen:M!==null,onClose:()=>{console.log(" Closing nameplate modal"),L()},playerName:(M==null?void 0:M.playerName)||"Unknown Player",playerId:(M==null?void 0:M.playerId)||"Unknown ID"}),S.jsx(o9e,{isVisible:z,onToggleVisibility:J,spaceID:ce}),S.jsx(Q9e,{}),S.jsx(ct,{position:"absolute",top:4,right:4,zIndex:1e3,children:Ge&&ve&&S.jsx(tGe,{isOpen:Ge,onClose:un,portal:ve,spaceId:ce})}),!pe&&lt&&S.jsxs(ls,{isOpen:lt,onClose:()=>{vt(!1),xe(),mt(""),St("")},isCentered:!0,children:[S.jsx(ds,{bg:"rgba(0, 0, 0, 0.8)",backdropFilter:"blur(8px)"}),S.jsxs(us,{bg:"#1a1a1a",borderRadius:"xl",border:"1px solid #333",maxW:"420px",p:0,children:[S.jsx(co,{fontSize:"md",fontWeight:"600",pb:1,pt:3,px:4,color:"white",textAlign:"center",children:nt?`Visit ${nt}?`:"Visit Space?"}),S.jsx(Is,{color:"white",bg:"rgba(255,255,255,0.1)",_hover:{color:"gray.400",bg:"transparent"},borderRadius:"full",size:"sm",top:2,right:3}),S.jsx(gs,{pb:8,pt:2,px:8,children:S.jsxs(Ur,{mt:4,gap:6,justify:"center",children:[S.jsx(Nn,{variant:"outline",borderColor:"whiteAlpha.400",color:"white",fontWeight:"bold",borderRadius:"2xl",px:10,py:6,fontSize:"lg",onClick:()=>{vt(!1),xe(),mt(""),St("")},_hover:{bg:"whiteAlpha.100"},children:"Cancel"}),S.jsx(Nn,{colorScheme:"whiteAlpha",bg:"white",color:"#181818",fontWeight:"bold",borderRadius:"2xl",px:10,py:6,fontSize:"lg",onClick:async()=>{if(ve&&v){let ft=null;if(ve.portalId){const Ct=ve.portalId.split("_");Ct.length>=3&&(ft=Ct[2])}await ae(ro.UNITY.PORTAL_NAVIGATE,{category:io.NAVIGATION,portalId:ve.portalId,targetSpaceId:ft,sourceSpaceId:ce,targetSpaceName:nt,targetSpaceSlug:et,isEditMode:!1,navigationType:"confirmed",timestamp:new Date().toISOString()}),console.log(" Analytics: Portal navigation event tracked for:",ve.portalId,"",ft)}et&&window.open(`https://www.spacesmetaverse.com/w/${et}`,"_blank","noopener"),vt(!1),xe(),mt(""),St("")},_hover:{bg:"gray.100"},children:"Visit"})]})})]})]}),S.jsx(iGe,{})]})})]})});J3.displayName="WebGLRenderer";J3.propTypes={settings:Tn.shape({urlLoadingBackground:Tn.string,videoBackgroundUrl:Tn.string,showAuthButton:Tn.bool,showDisruptiveLogo:Tn.bool,urlDisruptiveLogo:Tn.string,showHelpButton:Tn.bool,enableVoiceChat:Tn.bool,spaceID:Tn.string})};typeof window<"u"&&!window.MultipleView&&(console.log("Defining fallback MultipleView class - scripts may not be loaded yet"),window.MultipleView=class{constructor(){console.log("HISPlayer: Fallback MultipleView constructor called"),this.multiView={getPlayer:()=>(console.log("HISPlayer: getPlayer called from fallback"),{isPlaying:!1,play:()=>(console.log("HISPlayer: play called"),!0),pause:()=>(console.log("HISPlayer: pause called"),!0),mute:e=>(console.log("HISPlayer: mute called with state:",e),!0),isMuted:!1,seek:e=>(console.log("HISPlayer: seek called with time:",e),!0),setVolume:e=>(console.log("HISPlayer: setVolume called with volume:",e),!0),getVolume:()=>(console.log("HISPlayer: getVolume called"),1),getCurrentTime:()=>(console.log("HISPlayer: getCurrentTime called"),0),getDuration:()=>(console.log("HISPlayer: getDuration called"),100)}),initialize:()=>(console.log("HISPlayer: initialize called"),!0),setUnityContext:e=>(console.log("HISPlayer: setUnityContext called with:",e),window.hisPlayerContextId=e,!0),release:()=>(console.log("HISPlayer: release called"),!0),setProperties:e=>(console.log("HISPlayer: setProperties called with:",e),!0),setMultiPaths:e=>(console.log("HISPlayer: setMultiPaths called with:",e),window._hisplayer_paths=e,!0)}}});if(typeof window<"u"&&!window._hisPlayerInitialized){if(K.log("WebGLLoader: Initializing HISPlayer functions"),window._hisPlayerInitialized=!0,window._hisplayer_event_queue=window._hisplayer_event_queue||[],window._hisplayer_error_queue=window._hisplayer_error_queue||[],!document.getElementById("hisplayer-error")){const n=document.createElement("div");n.id="hisplayer-error",n.style.position="absolute",n.style.top="10px",n.style.left="50%",n.style.transform="translateX(-50%)",n.style.color="red",n.style.zIndex="9999",document.body.appendChild(n),K.log("WebGLLoader: Created hisplayer-error div")}window.isErrorQueueEmpty=window.isErrorQueueEmpty||function(){return window._hisplayer_error_queue.length===0},window.getNextError=window.getNextError||function(){return window._hisplayer_error_queue.length>0?window._hisplayer_error_queue.shift():""},window.isEventQueueEmpty=window.isEventQueueEmpty||function(){return window._hisplayer_event_queue.length===0},window.getNextEvent=window.getNextEvent||function(){return window._hisplayer_event_queue.length>0?window._hisplayer_event_queue.shift():""},window.setUpContext=window.setUpContext||function(n){console.log("HISPlayer: setUpContext called with contextId:",n),window.hisPlayerContextId=n;try{if(window.MultipleView){console.log("HISPlayer: Creating MultipleView instance");const e=new window.MultipleView;if(e&&e.multiView&&typeof e.multiView.setUnityContext=="function")return e.multiView.setUnityContext(n),window._hisplayer_instance=e,console.log("HISPlayer: Successfully set Unity context ID"),!0;console.error("HISPlayer: Player initialization failed - missing expected methods")}else{console.error("HISPlayer: MultipleView class not found"),window.MultipleView=class{constructor(){console.log("HISPlayer: Backup MultipleView constructor called"),this.multiView={getPlayer:()=>(console.log("HISPlayer: getPlayer called from backup"),{isPlaying:!1,play:()=>!0,pause:()=>!0,mute:()=>!0,isMuted:!1,seek:()=>!0,setVolume:()=>!0,getVolume:()=>1,getCurrentTime:()=>0,getDuration:()=>100}),initialize:()=>!0,setUnityContext:o=>(window.hisPlayerContextId=o,!0),release:()=>!0,setProperties:()=>!0,setMultiPaths:()=>!0}}},console.log("HISPlayer: Trying again with backup MultipleView");const e=new window.MultipleView;return e.multiView.setUnityContext(n),window._hisplayer_instance=e,!0}}catch(e){console.error("HISPlayer: Error in setUpContext:",e);const i=document.getElementById("hisplayer-error");i&&(i.innerHTML="Error: "+e.message)}return!1}}const Q3=({spaceID:n,overrideSettings:e})=>{const i=O.useRef(null),[o,l]=O.useState(!0),{loading:u,isUserBannedFromSpace:p,user:y}=O.useContext(Zi),[v,w]=O.useState(!1),[C,R]=O.useState({spaceID:n,loaderUrl:"",dataUrl:"",frameworkUrl:"",codeUrl:""}),[N,M]=O.useState({urlDisruptiveLogo:"gs://disruptive-metaverse.appspot.com/common/images/Disruptive-logo-white-p-500.png",urlLoadingBackground:"",videoBackgroundUrl:"",showDisruptiveLogo:null,showAuthButton:null,showHelpButton:null,enableVoiceChat:!0,spaceID:n});return O.useEffect(()=>{(async()=>{try{const U=await sd(n);if(U){console.log("Space data: ",U),R(re=>({...re,spaceID:n,loaderUrl:U.loaderUrl,dataUrl:U.dataUrl,frameworkUrl:U.frameworkUrl,codeUrl:U.codeUrl}));const z=await qk(N.urlDisruptiveLogo);let J="";if(U.backgroundUrl)J=U.backgroundUrl;else if(U.backgroundGsUrl)try{J=await qk(U.backgroundGsUrl)}catch(re){K.warn("WebGLLoader: Error fetching background from GS URL:",re)}else if(U.gsUrlLoadingBackground)try{J=await qk(U.gsUrlLoadingBackground)}catch(re){K.warn("WebGLLoader: Error fetching background from legacy GS URL:",re)}let q="";U.videoBackgroundUrl&&(q=U.videoBackgroundUrl,console.log("WebGLLoader: Found video background URL:",q)),M(re=>({...re,urlLoadingBackground:J,videoBackgroundUrl:q,showAuthButton:U.showAuthButton!==void 0?U.showAuthButton:!0,showDisruptiveLogo:U.showDisruptiveLogo!==void 0?U.showDisruptiveLogo:!0,showHelpButton:U.showHelpButton!==void 0?U.showHelpButton:!0,enableVoiceChat:U.enableVoiceChat!==void 0?U.enableVoiceChat:!0,urlDisruptiveLogo:z,spaceID:n,...e||{}})),q&&(console.log("WebGLLoader: Dispatching video background event with URL:",q),window.dispatchEvent(new CustomEvent("SpaceVideoBackgroundUpdated",{detail:{videoBackgroundUrl:q}}))),l(!1)}else K.error(`WebGLLoader: No configuration found for spaceID: ${n}`)}catch(U){K.error("WebGLLoader: Error fetching space data:",U)}finally{l(!1)}})()},[n,N.urlDisruptiveLogo,e]),O.useEffect(()=>{(async()=>{if(!u&&y&&p)try{const U=await p(n);w(U)}catch(U){K.error("WebGLLoader: ban check error",U)}})()},[u,y,n,p]),O.useEffect(()=>{o||(K.log("WebGLLoader: Unity config from Firebase",C),K.log("WebGLLoader: Space settings from Firebase",N))},[o]),u?S.jsx("div",{className:"flex justify-center items-center h-full mt-12",children:"Loading user"}):v?S.jsx("div",{className:"flex justify-center items-center h-full mt-12 text-red-500",children:"Access Denied: You have been banned from this space."}):n?S.jsx(S.Fragment,{children:o?S.jsx("div",{className:"flex justify-center items-center h-full mt-12",children:"Getting space data..."}):S.jsx(hWe,{...C,children:S.jsx(J3,{ref:i,settings:N})})}):null};Q3.propTypes={spaceID:Tn.string.isRequired,overrideSettings:Tn.object};function bZ(){const n=document.getElementById("webgl-root");if(n){const e=n.getAttribute("data-space-id"),i=n.getAttribute("data-theme")||"default",o=()=>{const[l,u]=O.useState(null);return O.useEffect(()=>{dR(i).then(u)},[]),l?S.jsx(uN,{theme:l,children:S.jsx(eD,{children:S.jsx(W3,{children:S.jsx(Q3,{spaceID:e})})})}):S.jsx("div",{children:"Loading theme..."})};try{GO.createRoot(n).render(S.jsx(o,{}))}catch(l){console.warn("Error initializing WebGL:",l)}}}typeof window<"u"&&(document.readyState==="loading"?document.addEventListener("DOMContentLoaded",bZ):bZ());const uGe=(n,e)=>{try{const i=El(Yn,`spaces/${n}/chatMessages`),o=new Date,l=LO(i,i6e("timestamp","asc"),o6e(o));return Boe(l,u=>{const p=[];u.docChanges().forEach(y=>{if(y.type==="added"){const v=y.doc.data();console.log("Firestore document data:",v),p.push({id:y.doc.id,...v})}}),p.length>0&&e(p)})}catch(i){throw K.error("Error subscribing to space chat messages:",i),i}};function mh(n){const e=Object.prototype.toString.call(n);return n instanceof Date||typeof n=="object"&&e==="[object Date]"?new n.constructor(+n):typeof n=="number"||e==="[object Number]"||typeof n=="string"||e==="[object String]"?new Date(n):new Date(NaN)}function cE(n,e){return n instanceof Date?new n.constructor(e):new Date(e)}const ece=6048e5,dGe=864e5;let hGe={};function oD(){return hGe}function bR(n,e){var y,v,w,C;const i=oD(),o=(e==null?void 0:e.weekStartsOn)??((v=(y=e==null?void 0:e.locale)==null?void 0:y.options)==null?void 0:v.weekStartsOn)??i.weekStartsOn??((C=(w=i.locale)==null?void 0:w.options)==null?void 0:C.weekStartsOn)??0,l=mh(n),u=l.getDay(),p=(u<o?7:0)+u-o;return l.setDate(l.getDate()-p),l.setHours(0,0,0,0),l}function WO(n){return bR(n,{weekStartsOn:1})}function tce(n){const e=mh(n),i=e.getFullYear(),o=cE(n,0);o.setFullYear(i+1,0,4),o.setHours(0,0,0,0);const l=WO(o),u=cE(n,0);u.setFullYear(i,0,4),u.setHours(0,0,0,0);const p=WO(u);return e.getTime()>=l.getTime()?i+1:e.getTime()>=p.getTime()?i:i-1}function wZ(n){const e=mh(n);return e.setHours(0,0,0,0),e}function TZ(n){const e=mh(n),i=new Date(Date.UTC(e.getFullYear(),e.getMonth(),e.getDate(),e.getHours(),e.getMinutes(),e.getSeconds(),e.getMilliseconds()));return i.setUTCFullYear(e.getFullYear()),+n-+i}function pGe(n,e){const i=wZ(n),o=wZ(e),l=+i-TZ(i),u=+o-TZ(o);return Math.round((l-u)/dGe)}function fGe(n){const e=tce(n),i=cE(n,0);return i.setFullYear(e,0,4),i.setHours(0,0,0,0),WO(i)}function mGe(n){return n instanceof Date||typeof n=="object"&&Object.prototype.toString.call(n)==="[object Date]"}function gGe(n){if(!mGe(n)&&typeof n!="number")return!1;const e=mh(n);return!isNaN(Number(e))}function _Ge(n){const e=mh(n),i=cE(n,0);return i.setFullYear(e.getFullYear(),0,1),i.setHours(0,0,0,0),i}const yGe={lessThanXSeconds:{one:"less than a second",other:"less than {{count}} seconds"},xSeconds:{one:"1 second",other:"{{count}} seconds"},halfAMinute:"half a minute",lessThanXMinutes:{one:"less than a minute",other:"less than {{count}} minutes"},xMinutes:{one:"1 minute",other:"{{count}} minutes"},aboutXHours:{one:"about 1 hour",other:"about {{count}} hours"},xHours:{one:"1 hour",other:"{{count}} hours"},xDays:{one:"1 day",other:"{{count}} days"},aboutXWeeks:{one:"about 1 week",other:"about {{count}} weeks"},xWeeks:{one:"1 week",other:"{{count}} weeks"},aboutXMonths:{one:"about 1 month",other:"about {{count}} months"},xMonths:{one:"1 month",other:"{{count}} months"},aboutXYears:{one:"about 1 year",other:"about {{count}} years"},xYears:{one:"1 year",other:"{{count}} years"},overXYears:{one:"over 1 year",other:"over {{count}} years"},almostXYears:{one:"almost 1 year",other:"almost {{count}} years"}},EGe=(n,e,i)=>{let o;const l=yGe[n];return typeof l=="string"?o=l:e===1?o=l.one:o=l.other.replace("{{count}}",e.toString()),i!=null&&i.addSuffix?i.comparison&&i.comparison>0?"in "+o:o+" ago":o};function fV(n){return(e={})=>{const i=e.width?String(e.width):n.defaultWidth;return n.formats[i]||n.formats[n.defaultWidth]}}const vGe={full:"EEEE, MMMM do, y",long:"MMMM do, y",medium:"MMM d, y",short:"MM/dd/yyyy"},SGe={full:"h:mm:ss a zzzz",long:"h:mm:ss a z",medium:"h:mm:ss a",short:"h:mm a"},bGe={full:"{{date}} 'at' {{time}}",long:"{{date}} 'at' {{time}}",medium:"{{date}}, {{time}}",short:"{{date}}, {{time}}"},wGe={date:fV({formats:vGe,defaultWidth:"full"}),time:fV({formats:SGe,defaultWidth:"full"}),dateTime:fV({formats:bGe,defaultWidth:"full"})},TGe={lastWeek:"'last' eeee 'at' p",yesterday:"'yesterday at' p",today:"'today at' p",tomorrow:"'tomorrow at' p",nextWeek:"eeee 'at' p",other:"P"},CGe=(n,e,i,o)=>TGe[n];function nC(n){return(e,i)=>{const o=i!=null&&i.context?String(i.context):"standalone";let l;if(o==="formatting"&&n.formattingValues){const p=n.defaultFormattingWidth||n.defaultWidth,y=i!=null&&i.width?String(i.width):p;l=n.formattingValues[y]||n.formattingValues[p]}else{const p=n.defaultWidth,y=i!=null&&i.width?String(i.width):n.defaultWidth;l=n.values[y]||n.values[p]}const u=n.argumentCallback?n.argumentCallback(e):e;return l[u]}}const RGe={narrow:["B","A"],abbreviated:["BC","AD"],wide:["Before Christ","Anno Domini"]},IGe={narrow:["1","2","3","4"],abbreviated:["Q1","Q2","Q3","Q4"],wide:["1st quarter","2nd quarter","3rd quarter","4th quarter"]},AGe={narrow:["J","F","M","A","M","J","J","A","S","O","N","D"],abbreviated:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],wide:["January","February","March","April","May","June","July","August","September","October","November","December"]},PGe={narrow:["S","M","T","W","T","F","S"],short:["Su","Mo","Tu","We","Th","Fr","Sa"],abbreviated:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],wide:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"]},kGe={narrow:{am:"a",pm:"p",midnight:"mi",noon:"n",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},abbreviated:{am:"AM",pm:"PM",midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},wide:{am:"a.m.",pm:"p.m.",midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"}},OGe={narrow:{am:"a",pm:"p",midnight:"mi",noon:"n",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"},abbreviated:{am:"AM",pm:"PM",midnight:"midnight",noon:"noon",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"},wide:{am:"a.m.",pm:"p.m.",midnight:"midnight",noon:"noon",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"}},NGe=(n,e)=>{const i=Number(n),o=i%100;if(o>20||o<10)switch(o%10){case 1:return i+"st";case 2:return i+"nd";case 3:return i+"rd"}return i+"th"},DGe={ordinalNumber:NGe,era:nC({values:RGe,defaultWidth:"wide"}),quarter:nC({values:IGe,defaultWidth:"wide",argumentCallback:n=>n-1}),month:nC({values:AGe,defaultWidth:"wide"}),day:nC({values:PGe,defaultWidth:"wide"}),dayPeriod:nC({values:kGe,defaultWidth:"wide",formattingValues:OGe,defaultFormattingWidth:"wide"})};function rC(n){return(e,i={})=>{const o=i.width,l=o&&n.matchPatterns[o]||n.matchPatterns[n.defaultMatchWidth],u=e.match(l);if(!u)return null;const p=u[0],y=o&&n.parsePatterns[o]||n.parsePatterns[n.defaultParseWidth],v=Array.isArray(y)?LGe(y,R=>R.test(p)):xGe(y,R=>R.test(p));let w;w=n.valueCallback?n.valueCallback(v):v,w=i.valueCallback?i.valueCallback(w):w;const C=e.slice(p.length);return{value:w,rest:C}}}function xGe(n,e){for(const i in n)if(Object.prototype.hasOwnProperty.call(n,i)&&e(n[i]))return i}function LGe(n,e){for(let i=0;i<n.length;i++)if(e(n[i]))return i}function MGe(n){return(e,i={})=>{const o=e.match(n.matchPattern);if(!o)return null;const l=o[0],u=e.match(n.parsePattern);if(!u)return null;let p=n.valueCallback?n.valueCallback(u[0]):u[0];p=i.valueCallback?i.valueCallback(p):p;const y=e.slice(l.length);return{value:p,rest:y}}}const UGe=/^(\d+)(th|st|nd|rd)?/i,VGe=/\d+/i,FGe={narrow:/^(b|a)/i,abbreviated:/^(b\.?\s?c\.?|b\.?\s?c\.?\s?e\.?|a\.?\s?d\.?|c\.?\s?e\.?)/i,wide:/^(before christ|before common era|anno domini|common era)/i},jGe={any:[/^b/i,/^(a|c)/i]},BGe={narrow:/^[1234]/i,abbreviated:/^q[1234]/i,wide:/^[1234](th|st|nd|rd)? quarter/i},zGe={any:[/1/i,/2/i,/3/i,/4/i]},WGe={narrow:/^[jfmasond]/i,abbreviated:/^(jan|feb|mar|apr|may|jun|jul|aug|sep|oct|nov|dec)/i,wide:/^(january|february|march|april|may|june|july|august|september|october|november|december)/i},GGe={narrow:[/^j/i,/^f/i,/^m/i,/^a/i,/^m/i,/^j/i,/^j/i,/^a/i,/^s/i,/^o/i,/^n/i,/^d/i],any:[/^ja/i,/^f/i,/^mar/i,/^ap/i,/^may/i,/^jun/i,/^jul/i,/^au/i,/^s/i,/^o/i,/^n/i,/^d/i]},HGe={narrow:/^[smtwf]/i,short:/^(su|mo|tu|we|th|fr|sa)/i,abbreviated:/^(sun|mon|tue|wed|thu|fri|sat)/i,wide:/^(sunday|monday|tuesday|wednesday|thursday|friday|saturday)/i},$Ge={narrow:[/^s/i,/^m/i,/^t/i,/^w/i,/^t/i,/^f/i,/^s/i],any:[/^su/i,/^m/i,/^tu/i,/^w/i,/^th/i,/^f/i,/^sa/i]},KGe={narrow:/^(a|p|mi|n|(in the|at) (morning|afternoon|evening|night))/i,any:/^([ap]\.?\s?m\.?|midnight|noon|(in the|at) (morning|afternoon|evening|night))/i},qGe={any:{am:/^a/i,pm:/^p/i,midnight:/^mi/i,noon:/^no/i,morning:/morning/i,afternoon:/afternoon/i,evening:/evening/i,night:/night/i}},YGe={ordinalNumber:MGe({matchPattern:UGe,parsePattern:VGe,valueCallback:n=>parseInt(n,10)}),era:rC({matchPatterns:FGe,defaultMatchWidth:"wide",parsePatterns:jGe,defaultParseWidth:"any"}),quarter:rC({matchPatterns:BGe,defaultMatchWidth:"wide",parsePatterns:zGe,defaultParseWidth:"any",valueCallback:n=>n+1}),month:rC({matchPatterns:WGe,defaultMatchWidth:"wide",parsePatterns:GGe,defaultParseWidth:"any"}),day:rC({matchPatterns:HGe,defaultMatchWidth:"wide",parsePatterns:$Ge,defaultParseWidth:"any"}),dayPeriod:rC({matchPatterns:KGe,defaultMatchWidth:"any",parsePatterns:qGe,defaultParseWidth:"any"})},XGe={code:"en-US",formatDistance:EGe,formatLong:wGe,formatRelative:CGe,localize:DGe,match:YGe,options:{weekStartsOn:0,firstWeekContainsDate:1}};function JGe(n){const e=mh(n);return pGe(e,_Ge(e))+1}function QGe(n){const e=mh(n),i=+WO(e)-+fGe(e);return Math.round(i/ece)+1}function nce(n,e){var C,R,N,M;const i=mh(n),o=i.getFullYear(),l=oD(),u=(e==null?void 0:e.firstWeekContainsDate)??((R=(C=e==null?void 0:e.locale)==null?void 0:C.options)==null?void 0:R.firstWeekContainsDate)??l.firstWeekContainsDate??((M=(N=l.locale)==null?void 0:N.options)==null?void 0:M.firstWeekContainsDate)??1,p=cE(n,0);p.setFullYear(o+1,0,u),p.setHours(0,0,0,0);const y=bR(p,e),v=cE(n,0);v.setFullYear(o,0,u),v.setHours(0,0,0,0);const w=bR(v,e);return i.getTime()>=y.getTime()?o+1:i.getTime()>=w.getTime()?o:o-1}function ZGe(n,e){var y,v,w,C;const i=oD(),o=(e==null?void 0:e.firstWeekContainsDate)??((v=(y=e==null?void 0:e.locale)==null?void 0:y.options)==null?void 0:v.firstWeekContainsDate)??i.firstWeekContainsDate??((C=(w=i.locale)==null?void 0:w.options)==null?void 0:C.firstWeekContainsDate)??1,l=nce(n,e),u=cE(n,0);return u.setFullYear(l,0,o),u.setHours(0,0,0,0),bR(u,e)}function eHe(n,e){const i=mh(n),o=+bR(i,e)-+ZGe(i,e);return Math.round(o/ece)+1}function Ai(n,e){const i=n<0?"-":"",o=Math.abs(n).toString().padStart(e,"0");return i+o}const fg={y(n,e){const i=n.getFullYear(),o=i>0?i:1-i;return Ai(e==="yy"?o%100:o,e.length)},M(n,e){const i=n.getMonth();return e==="M"?String(i+1):Ai(i+1,2)},d(n,e){return Ai(n.getDate(),e.length)},a(n,e){const i=n.getHours()/12>=1?"pm":"am";switch(e){case"a":case"aa":return i.toUpperCase();case"aaa":return i;case"aaaaa":return i[0];case"aaaa":default:return i==="am"?"a.m.":"p.m."}},h(n,e){return Ai(n.getHours()%12||12,e.length)},H(n,e){return Ai(n.getHours(),e.length)},m(n,e){return Ai(n.getMinutes(),e.length)},s(n,e){return Ai(n.getSeconds(),e.length)},S(n,e){const i=e.length,o=n.getMilliseconds(),l=Math.trunc(o*Math.pow(10,i-3));return Ai(l,e.length)}},N0={midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},CZ={G:function(n,e,i){const o=n.getFullYear()>0?1:0;switch(e){case"G":case"GG":case"GGG":return i.era(o,{width:"abbreviated"});case"GGGGG":return i.era(o,{width:"narrow"});case"GGGG":default:return i.era(o,{width:"wide"})}},y:function(n,e,i){if(e==="yo"){const o=n.getFullYear(),l=o>0?o:1-o;return i.ordinalNumber(l,{unit:"year"})}return fg.y(n,e)},Y:function(n,e,i,o){const l=nce(n,o),u=l>0?l:1-l;if(e==="YY"){const p=u%100;return Ai(p,2)}return e==="Yo"?i.ordinalNumber(u,{unit:"year"}):Ai(u,e.length)},R:function(n,e){const i=tce(n);return Ai(i,e.length)},u:function(n,e){const i=n.getFullYear();return Ai(i,e.length)},Q:function(n,e,i){const o=Math.ceil((n.getMonth()+1)/3);switch(e){case"Q":return String(o);case"QQ":return Ai(o,2);case"Qo":return i.ordinalNumber(o,{unit:"quarter"});case"QQQ":return i.quarter(o,{width:"abbreviated",context:"formatting"});case"QQQQQ":return i.quarter(o,{width:"narrow",context:"formatting"});case"QQQQ":default:return i.quarter(o,{width:"wide",context:"formatting"})}},q:function(n,e,i){const o=Math.ceil((n.getMonth()+1)/3);switch(e){case"q":return String(o);case"qq":return Ai(o,2);case"qo":return i.ordinalNumber(o,{unit:"quarter"});case"qqq":return i.quarter(o,{width:"abbreviated",context:"standalone"});case"qqqqq":return i.quarter(o,{width:"narrow",context:"standalone"});case"qqqq":default:return i.quarter(o,{width:"wide",context:"standalone"})}},M:function(n,e,i){const o=n.getMonth();switch(e){case"M":case"MM":return fg.M(n,e);case"Mo":return i.ordinalNumber(o+1,{unit:"month"});case"MMM":return i.month(o,{width:"abbreviated",context:"formatting"});case"MMMMM":return i.month(o,{width:"narrow",context:"formatting"});case"MMMM":default:return i.month(o,{width:"wide",context:"formatting"})}},L:function(n,e,i){const o=n.getMonth();switch(e){case"L":return String(o+1);case"LL":return Ai(o+1,2);case"Lo":return i.ordinalNumber(o+1,{unit:"month"});case"LLL":return i.month(o,{width:"abbreviated",context:"standalone"});case"LLLLL":return i.month(o,{width:"narrow",context:"standalone"});case"LLLL":default:return i.month(o,{width:"wide",context:"standalone"})}},w:function(n,e,i,o){const l=eHe(n,o);return e==="wo"?i.ordinalNumber(l,{unit:"week"}):Ai(l,e.length)},I:function(n,e,i){const o=QGe(n);return e==="Io"?i.ordinalNumber(o,{unit:"week"}):Ai(o,e.length)},d:function(n,e,i){return e==="do"?i.ordinalNumber(n.getDate(),{unit:"date"}):fg.d(n,e)},D:function(n,e,i){const o=JGe(n);return e==="Do"?i.ordinalNumber(o,{unit:"dayOfYear"}):Ai(o,e.length)},E:function(n,e,i){const o=n.getDay();switch(e){case"E":case"EE":case"EEE":return i.day(o,{width:"abbreviated",context:"formatting"});case"EEEEE":return i.day(o,{width:"narrow",context:"formatting"});case"EEEEEE":return i.day(o,{width:"short",context:"formatting"});case"EEEE":default:return i.day(o,{width:"wide",context:"formatting"})}},e:function(n,e,i,o){const l=n.getDay(),u=(l-o.weekStartsOn+8)%7||7;switch(e){case"e":return String(u);case"ee":return Ai(u,2);case"eo":return i.ordinalNumber(u,{unit:"day"});case"eee":return i.day(l,{width:"abbreviated",context:"formatting"});case"eeeee":return i.day(l,{width:"narrow",context:"formatting"});case"eeeeee":return i.day(l,{width:"short",context:"formatting"});case"eeee":default:return i.day(l,{width:"wide",context:"formatting"})}},c:function(n,e,i,o){const l=n.getDay(),u=(l-o.weekStartsOn+8)%7||7;switch(e){case"c":return String(u);case"cc":return Ai(u,e.length);case"co":return i.ordinalNumber(u,{unit:"day"});case"ccc":return i.day(l,{width:"abbreviated",context:"standalone"});case"ccccc":return i.day(l,{width:"narrow",context:"standalone"});case"cccccc":return i.day(l,{width:"short",context:"standalone"});case"cccc":default:return i.day(l,{width:"wide",context:"standalone"})}},i:function(n,e,i){const o=n.getDay(),l=o===0?7:o;switch(e){case"i":return String(l);case"ii":return Ai(l,e.length);case"io":return i.ordinalNumber(l,{unit:"day"});case"iii":return i.day(o,{width:"abbreviated",context:"formatting"});case"iiiii":return i.day(o,{width:"narrow",context:"formatting"});case"iiiiii":return i.day(o,{width:"short",context:"formatting"});case"iiii":default:return i.day(o,{width:"wide",context:"formatting"})}},a:function(n,e,i){const l=n.getHours()/12>=1?"pm":"am";switch(e){case"a":case"aa":return i.dayPeriod(l,{width:"abbreviated",context:"formatting"});case"aaa":return i.dayPeriod(l,{width:"abbreviated",context:"formatting"}).toLowerCase();case"aaaaa":return i.dayPeriod(l,{width:"narrow",context:"formatting"});case"aaaa":default:return i.dayPeriod(l,{width:"wide",context:"formatting"})}},b:function(n,e,i){const o=n.getHours();let l;switch(o===12?l=N0.noon:o===0?l=N0.midnight:l=o/12>=1?"pm":"am",e){case"b":case"bb":return i.dayPeriod(l,{width:"abbreviated",context:"formatting"});case"bbb":return i.dayPeriod(l,{width:"abbreviated",context:"formatting"}).toLowerCase();case"bbbbb":return i.dayPeriod(l,{width:"narrow",context:"formatting"});case"bbbb":default:return i.dayPeriod(l,{width:"wide",context:"formatting"})}},B:function(n,e,i){const o=n.getHours();let l;switch(o>=17?l=N0.evening:o>=12?l=N0.afternoon:o>=4?l=N0.morning:l=N0.night,e){case"B":case"BB":case"BBB":return i.dayPeriod(l,{width:"abbreviated",context:"formatting"});case"BBBBB":return i.dayPeriod(l,{width:"narrow",context:"formatting"});case"BBBB":default:return i.dayPeriod(l,{width:"wide",context:"formatting"})}},h:function(n,e,i){if(e==="ho"){let o=n.getHours()%12;return o===0&&(o=12),i.ordinalNumber(o,{unit:"hour"})}return fg.h(n,e)},H:function(n,e,i){return e==="Ho"?i.ordinalNumber(n.getHours(),{unit:"hour"}):fg.H(n,e)},K:function(n,e,i){const o=n.getHours()%12;return e==="Ko"?i.ordinalNumber(o,{unit:"hour"}):Ai(o,e.length)},k:function(n,e,i){let o=n.getHours();return o===0&&(o=24),e==="ko"?i.ordinalNumber(o,{unit:"hour"}):Ai(o,e.length)},m:function(n,e,i){return e==="mo"?i.ordinalNumber(n.getMinutes(),{unit:"minute"}):fg.m(n,e)},s:function(n,e,i){return e==="so"?i.ordinalNumber(n.getSeconds(),{unit:"second"}):fg.s(n,e)},S:function(n,e){return fg.S(n,e)},X:function(n,e,i){const o=n.getTimezoneOffset();if(o===0)return"Z";switch(e){case"X":return IZ(o);case"XXXX":case"XX":return ky(o);case"XXXXX":case"XXX":default:return ky(o,":")}},x:function(n,e,i){const o=n.getTimezoneOffset();switch(e){case"x":return IZ(o);case"xxxx":case"xx":return ky(o);case"xxxxx":case"xxx":default:return ky(o,":")}},O:function(n,e,i){const o=n.getTimezoneOffset();switch(e){case"O":case"OO":case"OOO":return"GMT"+RZ(o,":");case"OOOO":default:return"GMT"+ky(o,":")}},z:function(n,e,i){const o=n.getTimezoneOffset();switch(e){case"z":case"zz":case"zzz":return"GMT"+RZ(o,":");case"zzzz":default:return"GMT"+ky(o,":")}},t:function(n,e,i){const o=Math.trunc(n.getTime()/1e3);return Ai(o,e.length)},T:function(n,e,i){const o=n.getTime();return Ai(o,e.length)}};function RZ(n,e=""){const i=n>0?"-":"+",o=Math.abs(n),l=Math.trunc(o/60),u=o%60;return u===0?i+String(l):i+String(l)+e+Ai(u,2)}function IZ(n,e){return n%60===0?(n>0?"-":"+")+Ai(Math.abs(n)/60,2):ky(n,e)}function ky(n,e=""){const i=n>0?"-":"+",o=Math.abs(n),l=Ai(Math.trunc(o/60),2),u=Ai(o%60,2);return i+l+e+u}const AZ=(n,e)=>{switch(n){case"P":return e.date({width:"short"});case"PP":return e.date({width:"medium"});case"PPP":return e.date({width:"long"});case"PPPP":default:return e.date({width:"full"})}},rce=(n,e)=>{switch(n){case"p":return e.time({width:"short"});case"pp":return e.time({width:"medium"});case"ppp":return e.time({width:"long"});case"pppp":default:return e.time({width:"full"})}},tHe=(n,e)=>{const i=n.match(/(P+)(p+)?/)||[],o=i[1],l=i[2];if(!l)return AZ(n,e);let u;switch(o){case"P":u=e.dateTime({width:"short"});break;case"PP":u=e.dateTime({width:"medium"});break;case"PPP":u=e.dateTime({width:"long"});break;case"PPPP":default:u=e.dateTime({width:"full"});break}return u.replace("{{date}}",AZ(o,e)).replace("{{time}}",rce(l,e))},nHe={p:rce,P:tHe},rHe=/^D+$/,iHe=/^Y+$/,sHe=["D","DD","YY","YYYY"];function oHe(n){return rHe.test(n)}function aHe(n){return iHe.test(n)}function cHe(n,e,i){const o=lHe(n,e,i);if(console.warn(o),sHe.includes(n))throw new RangeError(o)}function lHe(n,e,i){const o=n[0]==="Y"?"years":"days of the month";return`Use \`${n.toLowerCase()}\` instead of \`${n}\` (in \`${e}\`) for formatting ${o} to the input \`${i}\`; see: https://github.com/date-fns/date-fns/blob/master/docs/unicodeTokens.md`}const uHe=/[yYQqMLwIdDecihHKkms]o|(\w)\1*|''|'(''|[^'])+('|$)|./g,dHe=/P+p+|P+|p+|''|'(''|[^'])+('|$)|./g,hHe=/^'([^]*?)'?$/,pHe=/''/g,fHe=/[a-zA-Z]/;function mHe(n,e,i){var C,R,N,M;const o=oD(),l=o.locale??XGe,u=o.firstWeekContainsDate??((R=(C=o.locale)==null?void 0:C.options)==null?void 0:R.firstWeekContainsDate)??1,p=o.weekStartsOn??((M=(N=o.locale)==null?void 0:N.options)==null?void 0:M.weekStartsOn)??0,y=mh(n);if(!gGe(y))throw new RangeError("Invalid time value");let v=e.match(dHe).map(L=>{const U=L[0];if(U==="p"||U==="P"){const z=nHe[U];return z(L,l.formatLong)}return L}).join("").match(uHe).map(L=>{if(L==="''")return{isToken:!1,value:"'"};const U=L[0];if(U==="'")return{isToken:!1,value:gHe(L)};if(CZ[U])return{isToken:!0,value:L};if(U.match(fHe))throw new RangeError("Format string contains an unescaped latin alphabet character `"+U+"`");return{isToken:!1,value:L}});l.localize.preprocessor&&(v=l.localize.preprocessor(y,v));const w={firstWeekContainsDate:u,weekStartsOn:p,locale:l};return v.map(L=>{if(!L.isToken)return L.value;const U=L.value;(aHe(U)||oHe(U))&&cHe(U,e,String(n));const z=CZ[U[0]];return z(y,U,l.localize,w)}).join("")}function gHe(n){const e=n.match(hHe);return e?e[1].replace(pHe,"'"):n}const _He=Dp(ct),ice=({name:n,timestamp:e,text:i,isCurrentUser:o})=>{console.log("Message props:",{name:n,timestamp:e,text:i,isCurrentUser:o});const l=e&&e.toDate?mHe(e.toDate(),"HH:mm"):"Invalid date";return S.jsxs(_He,{display:"flex",flexDirection:"column",alignItems:o?"flex-end":"flex-start",initial:{opacity:0},animate:{opacity:1},transition:{duration:.5},children:[S.jsxs(ct,{w:"auto",maxW:"80%",bg:o?"secondary.500":"primary.200",color:o?"white":"black",p:"10px",borderRadius:"10px",alignSelf:o?"flex-end":"flex-start",wordBreak:"break-word",children:[S.jsx(Ye,{fontWeight:"bold",children:n}),S.jsx(Ye,{children:i})]}),S.jsx(Ye,{color:"copy.light",fontSize:"xs",mt:"4px",mx:"6px",mb:"10px",textAlign:o?"right":"left",children:l})]})};ice.propTypes={name:Tn.string.isRequired,timestamp:Tn.object,text:Tn.string.isRequired,isCurrentUser:Tn.bool.isRequired};const yHe=({spaceID:n})=>{const[e,i]=O.useState([]),{user:o}=O.useContext(Zi),l=O.useRef(null);return O.useEffect(()=>{const u=uGe(n,p=>{console.log("New messages received:",p),i(y=>[...y,...p]),K.log("Messages updated:",p)});return()=>u()},[n]),O.useEffect(()=>{l.current&&l.current.scrollIntoView({behavior:"smooth"})},[e]),S.jsxs(ct,{className:"messages-container",display:"flex",flexDirection:"column",my:"10px",overflowY:"auto",maxHeight:"80vh",children:[e.map(u=>{const p=u.uid===(o==null?void 0:o.uid);return S.jsx(ice,{name:u.user,timestamp:u.timestamp,text:u.text,isCurrentUser:p},u.id)}),S.jsx("div",{ref:l})]})},EHe=({spaceID:n})=>{},sce=({spaceID:n})=>{const{user:e}=O.useContext(Zi);return e?S.jsxs(ct,{children:[S.jsx(ct,{height:"400px",overflowY:"auto",border:"1px solid #ccc",backgroundColor:"tertiaryAlpha.600",padding:"10px",children:S.jsx(yHe,{spaceID:n})}),S.jsx(ct,{mt:"8px",children:S.jsx(EHe,{spaceID:n})})]}):(console.log("No user found, returning login message"),S.jsx(ct,{children:S.jsx(Ye,{children:"Please log in to view the chat."})}))},fk=document.getElementById("chat-root");if(fk){const n=fk.getAttribute("data-space-id"),e=fk.getAttribute("data-theme")||"default",i=()=>{const[o,l]=O.useState(null);return O.useEffect(()=>{dR(e).then(l)},[]),o?S.jsx(uN,{theme:o,children:S.jsx(eD,{children:S.jsx(sce,{spaceID:n})})}):S.jsx("div",{children:"Loading theme..."})};GO.createRoot(fk).render(S.jsx(i,{}))}else console.error("Root element 'chat-root' not found.");class vHe extends O.Component{constructor(e){super(e),this.state={hasError:!1}}static getDerivedStateFromError(e){return{hasError:!0}}componentDidCatch(e,i){console.error("WebGL Error:",e,i)}render(){return this.state.hasError?S.jsx(ct,{p:4,bg:"red.100",color:"red.900",borderRadius:"md",children:S.jsx(Ye,{children:"WebGL component error. Please refresh the page."})}):this.props.children}}const mk=document.getElementById("root");if(mk){const n=mk.getAttribute("data-space-id"),e=mk.getAttribute("data-theme")||"default",i=()=>{const[o,l]=O.useState(null);return O.useEffect(()=>{dR(e).then(l);const u=()=>{document.hidden||dR(e).then(l)};return document.addEventListener("visibilitychange",u),()=>{document.removeEventListener("visibilitychange",u)}},[]),o?S.jsx(uN,{theme:o,children:S.jsx(eD,{children:S.jsx(W3,{children:S.jsxs(Ir,{spacing:4,align:"stretch",children:[S.jsxs(Ur,{justify:"space-between",align:"center",p:4,bg:"gray.700",m:0,position:"relative",zIndex:"100",children:[S.jsx(Ye,{fontSize:"xl",fontWeight:"bold",color:"white",children:"LOGO"}),S.jsx(ct,{zIndex:"100",position:"relative",children:S.jsx(Iae,{})})]}),S.jsx(JV,{maxW:"container.xl",p:0,zIndex:"1",children:S.jsx(Dne,{ratio:16/9,bg:"blue.100",m:0,children:S.jsx(ct,{id:"webgl-root","data-space-id":n,w:"100%",m:0,children:S.jsx(vHe,{children:S.jsx(Q3,{spaceID:n})})})})}),S.jsx(JV,{maxW:"container.xl",p:0,children:S.jsx(sce,{spaceID:n})})]})})})}):S.jsx("div",{children:"Loading theme..."})};GO.createRoot(mk).render(S.jsx(i,{}))}else console.error("Root element 'root' not found.");export{ave as a,DSe as b,Qi as c,kSe as d,bHe as e,SHe as f,bSe as g,ed as i,_p as m,OIe as t};
